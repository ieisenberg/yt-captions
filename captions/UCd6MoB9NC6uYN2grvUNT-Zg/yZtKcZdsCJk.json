[
  {
    "start": "0",
    "end": "34000"
  },
  {
    "text": "my name is Eric Brown wine and I'm with the AWS security team but back when I",
    "start": "30",
    "end": "5490"
  },
  {
    "text": "joined Amazon I was with the team that defined and launched V PC and that's what we're gonna be talking about today",
    "start": "5490",
    "end": "11840"
  },
  {
    "text": "I first gave the version of this talk a few years ago at reinvents I gave it",
    "start": "11840",
    "end": "18480"
  },
  {
    "text": "again at reinvent last year so there's some new content but it's largely a",
    "start": "18480",
    "end": "23699"
  },
  {
    "text": "reprise of the previous talk I would rather you leave angry and disappointed early in the talk than",
    "start": "23699",
    "end": "28830"
  },
  {
    "text": "angry and disappointed the end of the talk so this is your your caveat the",
    "start": "28830",
    "end": "35270"
  },
  {
    "start": "34000",
    "end": "34000"
  },
  {
    "text": "problem that we're trying to solve here is that we've got the cloud and we're AWS we like the cloud and the cloud is",
    "start": "35270",
    "end": "43500"
  },
  {
    "text": "full of all sorts of goodness the we started off with ec2 its compute you can",
    "start": "43500",
    "end": "48600"
  },
  {
    "text": "get various sized instances from us but there's all sorts of other things that you can get in the cloud all sorts of",
    "start": "48600",
    "end": "54300"
  },
  {
    "text": "compute and networking primitives that you can connect to it things like elastic load balancing the elastic block",
    "start": "54300",
    "end": "59789"
  },
  {
    "text": "store relational database service Amazon redshift ElastiCache we keep launching",
    "start": "59789",
    "end": "66210"
  },
  {
    "text": "new services we keep adding things to the cloud but customers have data",
    "start": "66210",
    "end": "71970"
  },
  {
    "start": "71000",
    "end": "71000"
  },
  {
    "text": "centers and these are perfectly good data centers they're expensive data centers they're data centers that",
    "start": "71970",
    "end": "77340"
  },
  {
    "text": "customers don't want to abandon there's all sorts of hardware in there that's still useful and they want to take",
    "start": "77340",
    "end": "83130"
  },
  {
    "text": "advantage of it there's going to be no Big Bang migration and so like all good",
    "start": "83130",
    "end": "88650"
  },
  {
    "start": "87000",
    "end": "87000"
  },
  {
    "text": "engineers we go to the whiteboard and you or perhaps more likely your boss is just going to draw an arrow on the",
    "start": "88650",
    "end": "94259"
  },
  {
    "text": "whiteboard and say we need to connect the data center to the cloud how hard could this possibly be this is going to",
    "start": "94259",
    "end": "101610"
  },
  {
    "text": "be an insanely important deployment scenario for us this morning Matt talked about the the journey to the cloud I",
    "start": "101610",
    "end": "108479"
  },
  {
    "text": "mean even as we have customers that are going all-in and turning off their existing data centers we've got another",
    "start": "108479",
    "end": "114299"
  },
  {
    "text": "customer that's just starting out on this journey and so we're always going to have customers that are at some point",
    "start": "114299",
    "end": "119700"
  },
  {
    "text": "in the journey where they're going to need to connect their existing resources and their on-premise data centers to",
    "start": "119700",
    "end": "125579"
  },
  {
    "text": "their resources in the cloud and our poster child here is Amazon we had data",
    "start": "125579",
    "end": "133800"
  },
  {
    "text": "center before we had the cloud and there were pretty remarkable data centers it was from our own data centers that the idea",
    "start": "133800",
    "end": "140580"
  },
  {
    "text": "for AWS grew but there's still not AWS and we had to move our applications",
    "start": "140580",
    "end": "146490"
  },
  {
    "text": "starting with among other things the retail website which hopefully all of you are familiar with into the cloud and",
    "start": "146490",
    "end": "153090"
  },
  {
    "text": "this could not be a Big Bang migration there was no magical forklift that would drive and pick the website up and drop",
    "start": "153090",
    "end": "159870"
  },
  {
    "text": "it off into the cloud we had to move incrementally just as all of our customers do and VPC played a critical",
    "start": "159870",
    "end": "166230"
  },
  {
    "text": "role in that migration Laura grit did a talk on this at the first re-invent entitled drinking your own champagne",
    "start": "166230",
    "end": "172200"
  },
  {
    "text": "that's available on YouTube if anyone's interested so the whiteboard engineering",
    "start": "172200",
    "end": "179010"
  },
  {
    "text": "is easy you draw the arrow when you're done but in the real world there's technical challenges and ec2 as we",
    "start": "179010",
    "end": "185730"
  },
  {
    "text": "originally launched it you would launch an instance and it would have an IP address and this IP address was",
    "start": "185730",
    "end": "191010"
  },
  {
    "text": "effectively a 32 bit random number it was your 32 bit random number we guaranteed that no other instance had",
    "start": "191010",
    "end": "196860"
  },
  {
    "text": "this 32 bit random number but it wasn't meaningful it they weren't grouped together if you launched another",
    "start": "196860",
    "end": "201989"
  },
  {
    "text": "instance it would get a different 32 bit random number and complete strangers",
    "start": "201989",
    "end": "207150"
  },
  {
    "text": "could launch right next to you another customer could launch an instance and you can see 12.4 and 12.5 are adjacent",
    "start": "207150",
    "end": "212820"
  },
  {
    "text": "IP addresses and the fact that those two IP addresses are close together doesn't mean that they're owned by the same",
    "start": "212820",
    "end": "218430"
  },
  {
    "text": "people that they're performing the same tasks that they're related to each other in any way shape or form and so as this",
    "start": "218430",
    "end": "223830"
  },
  {
    "text": "would go on with customers launching and terminating instances they would get these IP addresses that were effectively randomly assigned so when you draw that",
    "start": "223830",
    "end": "232440"
  },
  {
    "start": "231000",
    "end": "231000"
  },
  {
    "text": "out on the whiteboard and you attempt to connect your data center to the cloud you run into problems this customer has",
    "start": "232440",
    "end": "239970"
  },
  {
    "text": "chosen to number their data center out of 192 168 / 16 this is neither a good",
    "start": "239970",
    "end": "245220"
  },
  {
    "text": "choice nor a bad choice it's just a choice it's a slider block they picked it they probably built this data center",
    "start": "245220",
    "end": "250769"
  },
  {
    "text": "before AWS even existed they weren't thinking about cloud migration heck if the network engineer that designed this",
    "start": "250769",
    "end": "256260"
  },
  {
    "text": "had started talking about cloud migration they would have fired him and gotten someone that could build a data center so this is a number we're gonna",
    "start": "256260",
    "end": "264630"
  },
  {
    "text": "have a router this is going to be a sheetmetal appliance it's going to the blue or green or some other color",
    "start": "264630",
    "end": "270060"
  },
  {
    "text": "and it's gonna have a routing table and the routing table is going to say 192 168 0 0 / 16 stays here this is mine it",
    "start": "270060",
    "end": "276870"
  },
  {
    "text": "stays here so as we launch instances we need to tell this router ah 10.40 4.12",
    "start": "276870",
    "end": "284970"
  },
  {
    "text": "dot 4 that goes to AWS and as new destinations show up in AWS we have to",
    "start": "284970",
    "end": "290759"
  },
  {
    "text": "add them to the routing table but remember the IP address right next door might not be yours so we're fourth to add / 32 host routes",
    "start": "290759",
    "end": "298349"
  },
  {
    "text": "we can't add a larger aggregate so every time this orange customer launches an",
    "start": "298349",
    "end": "303599"
  },
  {
    "text": "instance we have to add something to their routing table every time they terminate an instance we have to make",
    "start": "303599",
    "end": "310530"
  },
  {
    "text": "sure we pull that route from their routing table because that IP address could be reassigned to another customer later",
    "start": "310530",
    "end": "316280"
  },
  {
    "text": "so we've now made it such that the routing table at the customer data center 1 is as large as the number of",
    "start": "316280",
    "end": "323340"
  },
  {
    "text": "instances that they've launched we have customers that are running tens of thousands of instances this is a good way to break routers and to the routing",
    "start": "323340",
    "end": "331440"
  },
  {
    "text": "table changes with the velocity of instance launch and terminate which is an even better way to break routers but",
    "start": "331440",
    "end": "338550"
  },
  {
    "text": "that's not all what if back in the dawn of time the network engineer had picked 10.40 4/16",
    "start": "338550",
    "end": "344940"
  },
  {
    "text": "this is neither a good nor bad choice the cloud didn't exist they weren't thinking about moving to AWS there's",
    "start": "344940",
    "end": "350550"
  },
  {
    "text": "absolutely nothing you can put in that routing table that will teach that router that some of 10.40 4 lives here",
    "start": "350550",
    "end": "356310"
  },
  {
    "text": "and some of 10.40 4 lives there if you've got a 10.40 4 dot 12.4 here and it's all them 10.40 4 dot 12.4 there",
    "start": "356310",
    "end": "363409"
  },
  {
    "text": "you're done that that IP address is no longer unique within your namespace and you can't reliably route to it now",
    "start": "363409",
    "end": "370529"
  },
  {
    "text": "someone out there in the audience is thinking double NAT double net does technically solve the problem I once",
    "start": "370529",
    "end": "377130"
  },
  {
    "text": "mentioned double NAT back at the office it turns out network engineers have a stash of torches and pitchforks in their",
    "start": "377130",
    "end": "385319"
  },
  {
    "text": "offices for just such cases so double mounts a bad thing we need to figure out",
    "start": "385319",
    "end": "390990"
  },
  {
    "text": "how to resolve this routing conflict and customers have already built their data",
    "start": "390990",
    "end": "396089"
  },
  {
    "text": "centers they've already laid out their IP space there is no block of addresses that a priori we",
    "start": "396089",
    "end": "401790"
  },
  {
    "text": "is not going to be in the conflict with any customer so in order to do this in",
    "start": "401790",
    "end": "407760"
  },
  {
    "text": "order to actually pull this off in the real world not just the whiteboard we need customer selected IP addresses",
    "start": "407760",
    "end": "413400"
  },
  {
    "text": "customers got to be able to bring their own IP range for whatever reasons they want to use it it's their IP range and",
    "start": "413400",
    "end": "419880"
  },
  {
    "text": "it's perfectly valid and we need to stop breaking routers we can't have routing",
    "start": "419880",
    "end": "425370"
  },
  {
    "text": "table updates being driven with instance launch and terminate it has to be under the gross Network change scale and we",
    "start": "425370",
    "end": "432900"
  },
  {
    "text": "need to conform with existing network designs people have already designed networks and again they aren't good or",
    "start": "432900",
    "end": "439260"
  },
  {
    "text": "bad they're what they have a lot of our customers have design standards security standards compliance standards in order",
    "start": "439260",
    "end": "445710"
  },
  {
    "text": "to build an application in company comm you have to do these things and I don't",
    "start": "445710",
    "end": "451290"
  },
  {
    "text": "want to have to have the conversation with every customer about how you rebuild your infrastructure so you can adopt AWS I want you to be able to bring",
    "start": "451290",
    "end": "457110"
  },
  {
    "text": "your existing infrastructure and to use as much of it as possible in the cloud and then iterate on it as you need to",
    "start": "457110",
    "end": "463050"
  },
  {
    "text": "change things so as an example we had one early beta customer and this",
    "start": "463050",
    "end": "468810"
  },
  {
    "text": "customers post provisioning tools host management tools assume that all networks were slashed 24 and they told",
    "start": "468810",
    "end": "475440"
  },
  {
    "text": "us there's no way we can use this product unless you support slash 24 networks now the cool thing is that that",
    "start": "475440",
    "end": "483060"
  },
  {
    "text": "was one API called by them they just defined slash 24 subnets they actually didn't even need to talk to us about it and honestly scouts honor that customer",
    "start": "483060",
    "end": "491460"
  },
  {
    "text": "was Amazon we we had this amazing programmatic infrastructure but it was",
    "start": "491460",
    "end": "497130"
  },
  {
    "text": "all bespoke no one built that infrastructure had ever assumed it would run outside of our data centers and all",
    "start": "497130",
    "end": "504030"
  },
  {
    "text": "of the networks each rack was its own slash 24 there was never anything that wasn't a slash 24 the tools didn't",
    "start": "504030",
    "end": "509970"
  },
  {
    "text": "account for it and so they had these fragile tools they were really robust in the face of their normal workload but",
    "start": "509970",
    "end": "515789"
  },
  {
    "text": "they were fragile when you took them outside of their environment fine we'll make flesh 24 networks in the cloud the host provisioning tools work just fine",
    "start": "515790",
    "end": "522830"
  },
  {
    "text": "so that leads us to the presentation that the product definition that we want to give to customers you've got a data",
    "start": "522830",
    "end": "530670"
  },
  {
    "text": "center on-premise you create a VP C part of creating a VP C is",
    "start": "530670",
    "end": "535690"
  },
  {
    "text": "plus with a cider block you can pick any cider block you want literally I don't care what it is routable IP space IP",
    "start": "535690",
    "end": "542350"
  },
  {
    "text": "space you own IP space you don't on RFC 1918 you give us a site or block we administrative lille emmitt you to a",
    "start": "542350",
    "end": "548440"
  },
  {
    "text": "slash 16 in the api's but during testing we actually created slash 0v pcs it's",
    "start": "548440",
    "end": "553900"
  },
  {
    "text": "hard to talk to them you can't get packets in or out but it's completely functional you create a VPN gateway this",
    "start": "553900",
    "end": "563020"
  },
  {
    "start": "559000",
    "end": "559000"
  },
  {
    "text": "is our end of a private connection with your data center then you declare a customer gateway there is no API for",
    "start": "563020",
    "end": "569530"
  },
  {
    "text": "creating a router on your promise but there is an API for telling us about a router that already exists and then you",
    "start": "569530",
    "end": "575650"
  },
  {
    "text": "bring up a VPN connection between the two and when your router learns about the new route you get one new route for",
    "start": "575650",
    "end": "582190"
  },
  {
    "text": "that V PC so we've added one route to your routers route table this is this is",
    "start": "582190",
    "end": "587410"
  },
  {
    "text": "a good way to not break routers this is something that routers are good at and that route comes and goes is that VPN",
    "start": "587410",
    "end": "592480"
  },
  {
    "text": "tunnel comes and goes which is relatively and frequently you can now layout subnets inside of your V PC again",
    "start": "592480",
    "end": "598210"
  },
  {
    "text": "this is all API driven and then you can launch and terminate instances to your heart's content and only the aggregate",
    "start": "598210",
    "end": "605290"
  },
  {
    "text": "for the V PC appears in your route table and your router doesn't need to know about the velocity of instance launched in terminate just saying I stuck around",
    "start": "605290",
    "end": "613870"
  },
  {
    "start": "612000",
    "end": "612000"
  },
  {
    "text": "for this like you're going to tell me about virtual networking this is existed for decades I've been able to buy this",
    "start": "613870",
    "end": "619420"
  },
  {
    "text": "it's built into the Linux kernel like what are you talking about the thing that you're calling a subnet is just a",
    "start": "619420",
    "end": "625090"
  },
  {
    "text": "VLAN the thing that you're calling a VPC there's a router in the middle of it to connect all of these subnets together",
    "start": "625090",
    "end": "630670"
  },
  {
    "text": "that's just a vrf virtual routing and forwarding ah but the design that we're",
    "start": "630670",
    "end": "637540"
  },
  {
    "text": "talking about has that same presentation but the requirements for it the the",
    "start": "637540",
    "end": "643150"
  },
  {
    "text": "implementation requirements for it are very different if we were to do this using traditional networking primitives",
    "start": "643150",
    "end": "648940"
  },
  {
    "text": "we would be operating far outside the common envelope so d LAN space 12 bits",
    "start": "648940",
    "end": "657420"
  },
  {
    "start": "653000",
    "end": "653000"
  },
  {
    "text": "4096 and you know someone who's writing the RFC and this is one of those hard-fought things like 12 is a weird",
    "start": "657420",
    "end": "662980"
  },
  {
    "text": "number you know they were arguing over which bits went where and whether they needed to make it 8000 or they could get",
    "start": "662980",
    "end": "668560"
  },
  {
    "text": "away with mm but in reality if you look at a typical data center like are you really gonna carve an l2 domain up into more",
    "start": "668560",
    "end": "675120"
  },
  {
    "text": "than 4000 chunks like 12 bits is perfectly reasonable for traditional networking but I was watching an Andy",
    "start": "675120",
    "end": "683640"
  },
  {
    "text": "Jesse presentation recently and we publicly claimed over a million customers a million is larger than 4,000",
    "start": "683640",
    "end": "692060"
  },
  {
    "text": "vrf support there are routers that claim multiple thousands of V ahrefs",
    "start": "692060",
    "end": "698750"
  },
  {
    "text": "but you talk to the vendors you talk to the customers that have adopted these",
    "start": "698750",
    "end": "703800"
  },
  {
    "text": "features and none of them are using it at anywhere near that scale they're they're using tens low hundreds they're",
    "start": "703800",
    "end": "709620"
  },
  {
    "text": "not using thousands of them and there's a name for people that are the first to use a feature like that in production",
    "start": "709620",
    "end": "715170"
  },
  {
    "text": "you're called a beta tester and that was not the position we want it to be and when we were building this product but",
    "start": "715170",
    "end": "721350"
  },
  {
    "text": "that's not all even by the numbers just looking at this we think it's tough but",
    "start": "721350",
    "end": "726510"
  },
  {
    "text": "there's a fixed ratio of VLANs to VRS and we'll see how that's a problem in a moment we talked about these big routers",
    "start": "726510",
    "end": "734670"
  },
  {
    "start": "732000",
    "end": "732000"
  },
  {
    "text": "and they're physically big like they're impressive devices it's a whole rack some of them are multi rack they're the",
    "start": "734670",
    "end": "741810"
  },
  {
    "text": "power delivered to some of these routers is measured in tens of kilowatts these are literally blast furnace devices like",
    "start": "741810",
    "end": "748470"
  },
  {
    "text": "if you stood behind them you could cook but what we're talking about there is really the data plane this is the the",
    "start": "748470",
    "end": "755400"
  },
  {
    "text": "esoteric memory and the custom Asics and the high bandwidth fabric cards this is where you talk about terabytes this is",
    "start": "755400",
    "end": "761850"
  },
  {
    "text": "where you talk about all of the big impressive numbers and buried in that big router is a little tiny control",
    "start": "761850",
    "end": "768990"
  },
  {
    "text": "plane it has less power than this laptop it is less memory than this laptop on the plus side it's the most expensive",
    "start": "768990",
    "end": "774360"
  },
  {
    "text": "memory I've ever bought there's less power than the machine that I'm using to drive PowerPoint today and that's what's",
    "start": "774360",
    "end": "781080"
  },
  {
    "text": "actually the brain of the router and it's connected to the data plane via what's effectively a tiny little straw",
    "start": "781080",
    "end": "786990"
  },
  {
    "text": "and the way you get availability with this seeing these things is you buy another one and you bring up 1+1",
    "start": "786990",
    "end": "793980"
  },
  {
    "text": "failover but it's the control planes that are talking to each other and you know that millions of times someone has",
    "start": "793980",
    "end": "801360"
  },
  {
    "text": "tripped over a power cord knock one of these things out in the BGP session between the Murray converges this happens all the time that code path",
    "start": "801360",
    "end": "808170"
  },
  {
    "text": "is well trod it works we know it works it's happening constantly bring up a",
    "start": "808170",
    "end": "813540"
  },
  {
    "text": "thousand MP bgp sessions between those two control planes we actually were able",
    "start": "813540",
    "end": "818820"
  },
  {
    "text": "on one router model to cause it to bury the cpu so hard they would miss a",
    "start": "818820",
    "end": "824370"
  },
  {
    "text": "watchdog and the surviving device would reload and so the first device would come up and attempt to establish a",
    "start": "824370",
    "end": "830670"
  },
  {
    "text": "thousand MP bgp sessions miss a watchdog in reloads so you have this bouncing router pair and it would actually never",
    "start": "830670",
    "end": "837300"
  },
  {
    "text": "reconverge to to anything that would pass packets we had to intervene bump the configs this is not the position you",
    "start": "837300",
    "end": "844140"
  },
  {
    "text": "want to be in another way that we were stressing these things out routers are",
    "start": "844140",
    "end": "849540"
  },
  {
    "start": "846000",
    "end": "846000"
  },
  {
    "text": "configured using text files or ordinary plain-jane text files if you assume that a router configuration is about 50",
    "start": "849540",
    "end": "855959"
  },
  {
    "text": "characters it takes about 10 lines to configure a VP C set up the vrf all of",
    "start": "855959",
    "end": "861810"
  },
  {
    "text": "the the BGP stuff that you need customers use on average for subnets per VPC it takes about five lines to",
    "start": "861810",
    "end": "868709"
  },
  {
    "text": "configure a subnet the total config and we have about 2,000 customers it's",
    "start": "868709",
    "end": "875640"
  },
  {
    "text": "reasonable about two kV RFS it's a 3 megabyte text file in reality when we",
    "start": "875640",
    "end": "882870"
  },
  {
    "text": "were testing this in the lab we were pushing config files of about 5 megabytes it took one of these devices",
    "start": "882870",
    "end": "889829"
  },
  {
    "text": "five minutes to parse the config she would hit return and for five minutes",
    "start": "889829",
    "end": "895350"
  },
  {
    "text": "the control plane would do nothing while it was parsing the configuration and it's not that these are bad devices it's",
    "start": "895350",
    "end": "902279"
  },
  {
    "text": "that we are operating them far outside of their intended envelope this is a design that the designer of the router",
    "start": "902279",
    "end": "907680"
  },
  {
    "text": "never considered it wasn't even in their thoughts when they built this thing which is fine it's a perfectly good",
    "start": "907680",
    "end": "914130"
  },
  {
    "text": "device but routers are built by human beings they're just strange computers with expensive hardware on them and they",
    "start": "914130",
    "end": "920040"
  },
  {
    "text": "have the same sets of bugs in the same sets of implicit assumptions that go into all of the software that we all",
    "start": "920040",
    "end": "925079"
  },
  {
    "text": "right we had another device where they used linked lists to manage certain",
    "start": "925079",
    "end": "930449"
  },
  {
    "text": "internal structures typical users of this feature had between 5 and 10 of these things",
    "start": "930449",
    "end": "935760"
  },
  {
    "text": "chasing a linked list that's ten items long is noise it's a couple of clock",
    "start": "935760",
    "end": "941070"
  },
  {
    "text": "cycles it's a few memory accesses you don't even notice it we had a router can fix that hit",
    "start": "941070",
    "end": "946350"
  },
  {
    "text": "thousands of these things and so as the config gets longer parsing the config",
    "start": "946350",
    "end": "951449"
  },
  {
    "text": "takes longer and chasing down that length list gets longer and the router",
    "start": "951449",
    "end": "956550"
  },
  {
    "text": "falls over we had another router and this bug was present since the very early versions of",
    "start": "956550",
    "end": "962279"
  },
  {
    "text": "this router vendors firmware and no one had ever run into it it turns out that when you committed the config on this",
    "start": "962279",
    "end": "967529"
  },
  {
    "text": "router it would leak forwards of memory how often does a router have its config",
    "start": "967529",
    "end": "972720"
  },
  {
    "text": "committed you can figure out what half a dozen times when the router is new you get it as a good upstanding member of",
    "start": "972720",
    "end": "978870"
  },
  {
    "text": "the network heck it'll probably reload before you have to configure it again we're driving configured these devices",
    "start": "978870",
    "end": "984750"
  },
  {
    "text": "at the rate at which our customers are making API calls and so and plus we're",
    "start": "984750",
    "end": "990029"
  },
  {
    "text": "doing one plus one failover but you have to have two routers so that you can configure the customers high",
    "start": "990029",
    "end": "995190"
  },
  {
    "text": "availability you want the customers objects to be configured on two routers so we're driving config to two devices",
    "start": "995190",
    "end": "1000529"
  },
  {
    "text": "in lockstep leaking memory and they both ran out of memory at almost exactly the",
    "start": "1000529",
    "end": "1006139"
  },
  {
    "text": "same time so later correlated failure this is a mature router vendor they'd been in the market for years and this",
    "start": "1006139",
    "end": "1011600"
  },
  {
    "text": "bug had existed in the market for years because no one ran into it we're outside of the common envelope this is not the",
    "start": "1011600",
    "end": "1017959"
  },
  {
    "text": "way to build a service so by the numbers",
    "start": "1017959",
    "end": "1023600"
  },
  {
    "text": "the the protocols don't work if a VLAN is a subnet that means that everywhere",
    "start": "1023600",
    "end": "1029209"
  },
  {
    "text": "that a customer has instances within a subnet I have to stretch that VLAN and as VLANs get larger and larger",
    "start": "1029209",
    "end": "1036100"
  },
  {
    "text": "pitchforks and torches start appearing we like owning our own destiny as the",
    "start": "1036100",
    "end": "1043010"
  },
  {
    "text": "example that I've just gone through show we run into strange corner cases unusual bugs and these devices they're not the",
    "start": "1043010",
    "end": "1049520"
  },
  {
    "text": "things that a lot of customers of these router vendors are going to run into and we want to be able to fix them on our",
    "start": "1049520",
    "end": "1054530"
  },
  {
    "text": "own timescales they're very important to us they're not important to the aggregate of that router vendors customer base and we want to be able to",
    "start": "1054530",
    "end": "1062450"
  },
  {
    "text": "change our minds we want to be able to move from vendor to vendor depending on pricing and availability and",
    "start": "1062450",
    "end": "1068440"
  },
  {
    "text": "local support and things like that and when you get into these advanced features interoperability is poor but",
    "start": "1068440",
    "end": "1076000"
  },
  {
    "text": "that's not all we all talk about horizontal scaling Amazon is very",
    "start": "1076000",
    "end": "1083019"
  },
  {
    "start": "1078000",
    "end": "1078000"
  },
  {
    "text": "familiar with horizontal scaling and this looks like horizontal scaling but it's not horizontal scaling it's silos",
    "start": "1083019",
    "end": "1088450"
  },
  {
    "text": "of capacity so I stopped at for VP C's per router pair and 40 instances per",
    "start": "1088450",
    "end": "1094779"
  },
  {
    "text": "router pair because I didn't want to draw all the little boxes in in PowerPoint but it's a realistic example",
    "start": "1094779",
    "end": "1101519"
  },
  {
    "text": "the customer shows up I've got these two silos available and I arbitrarily choose",
    "start": "1101519",
    "end": "1106779"
  },
  {
    "text": "the left one so I place customer a in the left silo I've consumed three instances worth of capacity one VPC is",
    "start": "1106779",
    "end": "1112840"
  },
  {
    "text": "worth of capacity customer B shows up I place them on the right I've got some",
    "start": "1112840",
    "end": "1118029"
  },
  {
    "text": "sort of load balancing algorithm it could be as simple as complicated as we want customer C shows up I Robin back to",
    "start": "1118029",
    "end": "1125110"
  },
  {
    "text": "the left customer D I place them on the right life is good so far customer a launches",
    "start": "1125110",
    "end": "1133120"
  },
  {
    "text": "two more instances their VP C is in the left router pair I must place their new",
    "start": "1133120",
    "end": "1138340"
  },
  {
    "text": "instances in the left router pair otherwise they're not in that VP C customer e I choose to place them on the",
    "start": "1138340",
    "end": "1145269"
  },
  {
    "text": "left as well it's only one instance this is a very important customer this is the",
    "start": "1145269",
    "end": "1150549"
  },
  {
    "text": "getting started instance this is a customer that just signed up with a credit card every single one of our customers was once a one instance",
    "start": "1150549",
    "end": "1157059"
  },
  {
    "text": "customer everyone got started really small and we don't know if this customer",
    "start": "1157059",
    "end": "1162159"
  },
  {
    "text": "a is going to be the next Netflix or Philips they may also just stay on one instance customer forever customer F",
    "start": "1162159",
    "end": "1169809"
  },
  {
    "text": "this was a large enterprise customer that moved over this was a predicted move we forecasted this capacity that",
    "start": "1169809",
    "end": "1175299"
  },
  {
    "text": "was easy and then customer G this router is full",
    "start": "1175299",
    "end": "1180429"
  },
  {
    "text": "I'm out of V PC capacity I can sell the remaining instance capacity to any of",
    "start": "1180429",
    "end": "1187480"
  },
  {
    "text": "the customers that are on that left router pair but I can't sell it to anyone else and I can hide this if I",
    "start": "1187480",
    "end": "1192970"
  },
  {
    "text": "have to behind higher prices I'm gonna have to maintain a slush fund I might have to",
    "start": "1192970",
    "end": "1198490"
  },
  {
    "text": "maintain a buffer and so I'm gonna drive down the utilization of my instance capacity but",
    "start": "1198490",
    "end": "1204400"
  },
  {
    "text": "I can hide this from customers now customer B this is a social media app",
    "start": "1204400",
    "end": "1210160"
  },
  {
    "text": "that went viral they're having the best day of their lives they've exhausted instance capacity on that route right",
    "start": "1210160",
    "end": "1215920"
  },
  {
    "text": "router pair and we're out there's no more instance capacity for them if they",
    "start": "1215920",
    "end": "1221200"
  },
  {
    "text": "want one more instance we're gonna have to do something unnatural they're gonna have to create another V PC there's gonna be some break in the customer",
    "start": "1221200",
    "end": "1227560"
  },
  {
    "text": "experience and this I can't hide this is something that customers will run into",
    "start": "1227560",
    "end": "1233380"
  },
  {
    "text": "and we see customer fluctuations into thousands of instances on a regular basis that's a huge slush fund to have",
    "start": "1233380",
    "end": "1240160"
  },
  {
    "text": "to maintain on a per silo basis so that leads us to the implementation",
    "start": "1240160",
    "end": "1245680"
  },
  {
    "start": "1244000",
    "end": "1244000"
  },
  {
    "text": "requirements the things that we have to have in the actual implementation and this was a literal statement from our",
    "start": "1245680",
    "end": "1251620"
  },
  {
    "text": "design documents we needed to be able to support millions of environments the size of amazon.com so there's there's a",
    "start": "1251620",
    "end": "1258070"
  },
  {
    "text": "little bit of a think big in there and we must not further constrain the placement problem placement is a",
    "start": "1258070",
    "end": "1264700"
  },
  {
    "text": "miserable problem when you add in things like placement grips you want all of your instances linked together with a",
    "start": "1264700",
    "end": "1270850"
  },
  {
    "text": "tight high bandwidth network in different instance types and the location of your EBS volumes there",
    "start": "1270850",
    "end": "1276340"
  },
  {
    "text": "enough constraints on the placement problem as it is the network must add no new constraints so that leads us to the",
    "start": "1276340",
    "end": "1283390"
  },
  {
    "start": "1282000",
    "end": "1282000"
  },
  {
    "text": "implementation that we actually fielded we have servers",
    "start": "1283390",
    "end": "1288670"
  },
  {
    "text": "someone has to own the sheetmetal in the case of AWS that's us and they have IP addresses",
    "start": "1288670",
    "end": "1294070"
  },
  {
    "text": "it's no secret room on a physical network with IP addresses on it on those",
    "start": "1294070",
    "end": "1300100"
  },
  {
    "text": "physical servers we place instances the instances also get IP addresses but they're pulled from the customer's VPC",
    "start": "1300100",
    "end": "1306100"
  },
  {
    "text": "range these instances are grouped together into V pcs and I am using color",
    "start": "1306100",
    "end": "1312940"
  },
  {
    "text": "to indicate V PC ID so we've got three different V pcs running around here and then there's one more component that's",
    "start": "1312940",
    "end": "1319990"
  },
  {
    "text": "not exposed to customers but it's the linchpin around which all of the EPC revolves and that's the mapping service",
    "start": "1319990",
    "end": "1326430"
  },
  {
    "text": "let's do a quick Ethernet refresher we've got two hosts they're connected",
    "start": "1326430",
    "end": "1332740"
  },
  {
    "text": "back to back across and Ethernet switch everything is freshly booted and working correctly 10002 is going to ARP for 10003 the",
    "start": "1332740",
    "end": "1341530"
  },
  {
    "text": "Ethernet switch is going to have no idea where anything is because it's freshly booted so it's going to flood that our proquest out all ports including the",
    "start": "1341530",
    "end": "1347679"
  },
  {
    "text": "port to which 1000 3 is connected 1000 3 is going to respond to that ARP request",
    "start": "1347679",
    "end": "1354880"
  },
  {
    "text": "here I'm using the Mac of IP address it's shorthand it's easier to line things up and it's easier than typing",
    "start": "1354880",
    "end": "1360700"
  },
  {
    "text": "out 48 bit numbers feel free to substitute almost any 48 bit number I once said any 48 bit number and one of",
    "start": "1360700",
    "end": "1367750"
  },
  {
    "text": "my co-workers helpfully pointed out that not all 48 bit numbers are valid MAC addresses so the Ethernet switch learns",
    "start": "1367750",
    "end": "1375400"
  },
  {
    "text": "where 10003 is and what the mapping is in terms of LT to l3 and responds so at",
    "start": "1375400",
    "end": "1382360"
  },
  {
    "text": "this point we've got the MAC address for our destination so now we can send an IP",
    "start": "1382360",
    "end": "1387880"
  },
  {
    "text": "packet the l2 and l3 source and destination match up because this is traffic within an l2 domain and the",
    "start": "1387880",
    "end": "1394330"
  },
  {
    "text": "switch can deliver the packet to the end this is Ethernet as it's been used for decades we have to make it work in the",
    "start": "1394330",
    "end": "1401020"
  },
  {
    "text": "cloud so as always the guest is going to ARP for its destination it's going to",
    "start": "1401020",
    "end": "1408070"
  },
  {
    "text": "say who has 1000 3 we're gonna trap that our packet in our physical server we're gonna send it to the mapping service and",
    "start": "1408070",
    "end": "1414190"
  },
  {
    "text": "we're gonna say we need to know where blue 1000 3 is the mapping service is",
    "start": "1414190",
    "end": "1419320"
  },
  {
    "text": "going to tell us that blue 1000 3 is down there in the lower right corner at 1 9 2 1 6 8 1.4 and by the way here's",
    "start": "1419320",
    "end": "1425530"
  },
  {
    "text": "its MAC address and so using that we can send the ARP request back to the guest so at this point 1000 2 believes that it",
    "start": "1425530",
    "end": "1434770"
  },
  {
    "text": "is arced for its peer it turns out and you can actually test this in V PC we don't ever actually propagate the ARP",
    "start": "1434770",
    "end": "1439960"
  },
  {
    "text": "request to the destination it turns out that doesn't matter none of the Ethernet implementations",
    "start": "1439960",
    "end": "1446020"
  },
  {
    "text": "that exist in the world depend on that and so at this point 1000 2 has everything it needs to send a packet so",
    "start": "1446020",
    "end": "1453730"
  },
  {
    "text": "we're gonna craft exactly the same packet that we would have sent on a physical network this instance is not",
    "start": "1453730",
    "end": "1458740"
  },
  {
    "text": "aware that it's running in a V PC we're gonna trap that packet we're going to wrap it with a V PC header they're going",
    "start": "1458740",
    "end": "1465550"
  },
  {
    "text": "to wrap it with a physical network header so we're going from one nine to one six eight zero three two one nine two one",
    "start": "1465550",
    "end": "1470710"
  },
  {
    "text": "six 81.4 we can send that packet straight to the destination now one nine two one six 81.4 it just",
    "start": "1470710",
    "end": "1478929"
  },
  {
    "text": "gets this packet out of the blue like what what on earth is this thing so it's going to ask the mapping service is this",
    "start": "1478929",
    "end": "1484750"
  },
  {
    "text": "cool I just got a packet from 0.3 claiming to be on behalf of blue 1000 -",
    "start": "1484750",
    "end": "1490169"
  },
  {
    "text": "should this packet exist mapping service is good yep it's cool it also happens to",
    "start": "1490169",
    "end": "1496150"
  },
  {
    "text": "include the MAC address for 1000 - so we can reconstruct the original packet that the customer sent and deliver it to the",
    "start": "1496150",
    "end": "1502419"
  },
  {
    "text": "instance so this is Ethernet off the operating system DVD these two guests",
    "start": "1502419",
    "end": "1507549"
  },
  {
    "text": "have not been altered in any way this is a traditional network as far as the guests are concerned in order for these",
    "start": "1507549",
    "end": "1514090"
  },
  {
    "text": "two instances to communicate as if they were in a V PC subnet they have to be able to talk to the mapping service and",
    "start": "1514090",
    "end": "1519909"
  },
  {
    "text": "they have to be able to exchange IP packets but that's a solved problem we already know how to build IP networks",
    "start": "1519909",
    "end": "1526270"
  },
  {
    "text": "that span the globe these two physical machines could be located literally anywhere and they could participate in",
    "start": "1526270",
    "end": "1532510"
  },
  {
    "text": "the same VPC subnet and so that means the V PCL - topology is completely",
    "start": "1532510",
    "end": "1538120"
  },
  {
    "text": "decoupled from the physical topology I don't need large physical l2 domains I can lay out the l2 in the physical",
    "start": "1538120",
    "end": "1544090"
  },
  {
    "text": "network however I want however the network engineers deemed best for that data center so let's dig in for a moment",
    "start": "1544090",
    "end": "1551169"
  },
  {
    "text": "on that reverse mapping check on receipt of a packet I said earlier that we",
    "start": "1551169",
    "end": "1558309"
  },
  {
    "start": "1554000",
    "end": "1554000"
  },
  {
    "text": "created / 0 V pcs in testing there's a fun way to test this software is not a",
    "start": "1558309",
    "end": "1563620"
  },
  {
    "text": "useful thing to ever do in the real world but literally this guest can scan",
    "start": "1563620",
    "end": "1568690"
  },
  {
    "text": "the entire ipv4 space any 32-bit number they can cram into the destination they can scan for and when we query the",
    "start": "1568690",
    "end": "1576190"
  },
  {
    "text": "mapping service we're gonna query it in the context of their V PC they can't physically cram bits into the header to",
    "start": "1576190",
    "end": "1583840"
  },
  {
    "text": "cause a packet to be addressed across V PC boundaries now what if for whatever",
    "start": "1583840",
    "end": "1590049"
  },
  {
    "text": "reason the query is awry they're gonna query on behalf of blue",
    "start": "1590049",
    "end": "1597590"
  },
  {
    "text": "the mapping service knows there aren't any blue instances on that lower-left physical server there are no blue",
    "start": "1597590",
    "end": "1603110"
  },
  {
    "text": "instances on 0.4 so the mapping service is going to deny the mapping and it's going to call for a human and we know",
    "start": "1603110",
    "end": "1610460"
  },
  {
    "text": "this works because it goes off when we test this is an alarm that we test regularly and so this server here one on",
    "start": "1610460",
    "end": "1617570"
  },
  {
    "text": "two one six eight zero four can't even fetch mappings for which it is not authorized if by some series of events",
    "start": "1617570",
    "end": "1625930"
  },
  {
    "text": "we obtain the mapping and we can construct the packet and send it across the physical network we're going to do",
    "start": "1625930",
    "end": "1633380"
  },
  {
    "text": "the reverse mapping check the mapping service still knows that 192 168 0 4 shouldn't be hosting any blue instances",
    "start": "1633380",
    "end": "1639430"
  },
  {
    "text": "we're gonna let the destination server know that the mapping is invalid that the package should be dropped in again we call the human and so what this means",
    "start": "1639430",
    "end": "1649370"
  },
  {
    "text": "is that packets cannot and will not flow unless every participant to source the destination and the mapping service",
    "start": "1649370",
    "end": "1655940"
  },
  {
    "text": "agree where everything is placed in the network this is a property you don't get in physical networks spoofing in the V",
    "start": "1655940",
    "end": "1662630"
  },
  {
    "text": "PC network is not possible so that's l2 we also need to propagate l3 IP packets",
    "start": "1662630",
    "end": "1669860"
  },
  {
    "text": "I'm assuming a slash 24 net mask here and again this is IP as it's been",
    "start": "1669860",
    "end": "1675440"
  },
  {
    "text": "working for decades straight off the operating system DVD so the Ethernet switch is going to do the exact same",
    "start": "1675440",
    "end": "1681830"
  },
  {
    "text": "flooding dance learn the MAC address but in this case we're our ping for the",
    "start": "1681830",
    "end": "1687680"
  },
  {
    "text": "Gateway because we know based on the net mask the eventual destination 1001 3",
    "start": "1687680",
    "end": "1693170"
  },
  {
    "text": "isn't in the local subnet so we need to ARP for the Gateway we are for the Gateway we learn the MAC address for it",
    "start": "1693170",
    "end": "1698840"
  },
  {
    "text": "now we can send a packet this packet is different the destination MAC address is",
    "start": "1698840",
    "end": "1703940"
  },
  {
    "text": "the gateway into the Mac of 1000:1 the l3 destination the destination IP address is the eventual destination",
    "start": "1703940",
    "end": "1709970"
  },
  {
    "text": "across the router we send the packet to the router the router transforms the",
    "start": "1709970",
    "end": "1715550"
  },
  {
    "text": "packet it replaces the l2 source with its own MAC address in the 1001 slash 24",
    "start": "1715550",
    "end": "1721910"
  },
  {
    "text": "Network decrements the TTL puts in the destination MAC address of the eventual",
    "start": "1721910",
    "end": "1727040"
  },
  {
    "text": "destination and propagates it across the second Ethernet switch again Ethernet off the operating system",
    "start": "1727040",
    "end": "1734209"
  },
  {
    "text": "DVD so I swapped out 1000 three for 1001",
    "start": "1734209",
    "end": "1739879"
  },
  {
    "text": "3 in the lower right corner there we have to propagate this exact same packet flow without altering the software",
    "start": "1739879",
    "end": "1744919"
  },
  {
    "text": "that's running on the guests so again the exact same thing happens we are for",
    "start": "1744919",
    "end": "1749989"
  },
  {
    "text": "the gateway send it to the mapping service get back a mapping and in this",
    "start": "1749989",
    "end": "1756679"
  },
  {
    "text": "case the host isn't the physical server in our network it's tagged as a gateway this tells the server that packets sent",
    "start": "1756679",
    "end": "1762619"
  },
  {
    "text": "to this destination this l2 destination need to be handled specially so at this",
    "start": "1762619",
    "end": "1768319"
  },
  {
    "text": "point the guest believes that it's art for its gateway now we can craft that",
    "start": "1768319",
    "end": "1773509"
  },
  {
    "text": "exact same packet this is going to be trapped because the destination l2 MAC",
    "start": "1773509",
    "end": "1779779"
  },
  {
    "text": "address is a gateway we're going to trap it we're going to do a secondary query to the mapping service and this time we're going to look up the destination",
    "start": "1779779",
    "end": "1786649"
  },
  {
    "text": "IP address not the destination MAC address because this packet needs to be routed we're going to get a mapping it",
    "start": "1786649",
    "end": "1792440"
  },
  {
    "text": "turns out that we returned the MAC address for the host that's on the far side of the router we don't propagate it",
    "start": "1792440",
    "end": "1797539"
  },
  {
    "text": "back to the guest but it turns out we actually do propagate it so now that we've got the all the information we",
    "start": "1797539",
    "end": "1803809"
  },
  {
    "text": "need for a mapping we construct the packet wrap it with a VPC header wrap it",
    "start": "1803809",
    "end": "1809059"
  },
  {
    "text": "with the exact same physical network header and deliver it across the network",
    "start": "1809059",
    "end": "1814209"
  },
  {
    "text": "we're gonna do the same mapping check on receipt please validate that this blue",
    "start": "1814209",
    "end": "1819649"
  },
  {
    "text": "1000 2 is actually from this physical source we're going to get an indication",
    "start": "1819649",
    "end": "1824869"
  },
  {
    "text": "that the mapping is kosher at that point we can swap MAC addresses and deliver the packet to the destination so this is",
    "start": "1824869",
    "end": "1836359"
  },
  {
    "text": "exactly the same properties as the l2 flow any two physical servers anywhere",
    "start": "1836359",
    "end": "1842869"
  },
  {
    "text": "on earth can participate in the same VPC as long as they have IP connectivity with each other and they can both talk",
    "start": "1842869",
    "end": "1848690"
  },
  {
    "text": "to the mapping service so for both l2 and l3 we have placed 0 additional",
    "start": "1848690",
    "end": "1854719"
  },
  {
    "text": "constraints on placement we can drive the same utilization of our network of our physical servers that we could",
    "start": "1854719",
    "end": "1861440"
  },
  {
    "text": "before the addition of VPC so we have reduced the capacity management problem of EPC to the capacity management",
    "start": "1861440",
    "end": "1867440"
  },
  {
    "text": "problem of ec2 now there's a problem",
    "start": "1867440",
    "end": "1873709"
  },
  {
    "text": "here there's that I trap the packet it's one thing to trap Arps Arps aren't",
    "start": "1873709",
    "end": "1879649"
  },
  {
    "text": "actually in the customer data flow if you're Arps take a little bit longer no one notices and they happen infrequently",
    "start": "1879649",
    "end": "1885429"
  },
  {
    "text": "trapping customer packets you're going into debt you're queuing them customers care about their packets they're",
    "start": "1885429",
    "end": "1891319"
  },
  {
    "text": "precious and the network the physical network they don't get lost and so we don't want them to get lost here so that",
    "start": "1891319",
    "end": "1897049"
  },
  {
    "text": "means we need to save them but then you have to allocate space to save them and customers using the network and all",
    "start": "1897049",
    "end": "1902690"
  },
  {
    "text": "sorts of interesting and exciting ways and you don't know how much queue space you need and so what we actually do is",
    "start": "1902690",
    "end": "1910399"
  },
  {
    "text": "we have a cache of the mapping service on every single one of our physical",
    "start": "1910399",
    "end": "1915679"
  },
  {
    "text": "servers and they all subscribe to the mapping service so all of the behavior that I described earlier it is how the",
    "start": "1915679",
    "end": "1922429"
  },
  {
    "text": "system actually behaves everything is organized into topics individual servers subscribe the topics they can't",
    "start": "1922429",
    "end": "1928909"
  },
  {
    "text": "subscribe the topics that they shouldn't have access to so for example 1 9 2 1 6 8 0 3 is a lot",
    "start": "1928909",
    "end": "1934639"
  },
  {
    "text": "to subscribe to the blue topic and the green topic but one nine to one six eight zero four in the lower left corner",
    "start": "1934639",
    "end": "1940009"
  },
  {
    "text": "it's only hosting gray instances it's not allowed to subscribe to the blue topic if it attempts to subscribe to the blue topic we deny it and we call the",
    "start": "1940009",
    "end": "1947149"
  },
  {
    "text": "human and so in reality we didn't even implement the cache miss path we have a",
    "start": "1947149",
    "end": "1953509"
  },
  {
    "text": "hundred percent cache hit ratio 100 percent of the mappings that a server needs can be satisfied locally out of",
    "start": "1953509",
    "end": "1959239"
  },
  {
    "text": "this cache replicas without going off box and that allows us to provide dead-flat network latency",
    "start": "1959239",
    "end": "1966789"
  },
  {
    "text": "so that's how you talk within the VPC but the whole point of this product was",
    "start": "1966929",
    "end": "1972809"
  },
  {
    "text": "plugging the VPC into your on-prem data center and so we've talked about how l 2 flows work within a subnet we've talked",
    "start": "1972809",
    "end": "1979409"
  },
  {
    "text": "about how L 3 flows work between subnets and we've solved the high velocity",
    "start": "1979409",
    "end": "1984899"
  },
  {
    "text": "routing table updates we've allowed you to bring your own IP addresses but you need to be able to send this packet",
    "start": "1984899",
    "end": "1990979"
  },
  {
    "text": "that's fine it's a packet it's going from 10007 which is one of your instances it's going to some IP address",
    "start": "1990979",
    "end": "1998339"
  },
  {
    "text": "in your data center our router and our site totally knows how to send that packet we can wrap it with a V PC hat or",
    "start": "1998339",
    "end": "2005629"
  },
  {
    "text": "I don't know what your router is going to do with a V PC header but then we're gonna wrap it with a physical network",
    "start": "2005629",
    "end": "2011389"
  },
  {
    "text": "header I have no idea what to plug in for that destination IP address plus I",
    "start": "2011389",
    "end": "2018440"
  },
  {
    "text": "mean if I did if you if you gave me an IP address like what is your router going to do upon receipt of this Amazon",
    "start": "2018440",
    "end": "2024769"
  },
  {
    "text": "proprietary packet and so we're gonna introduce a new concept here and that's",
    "start": "2024769",
    "end": "2031159"
  },
  {
    "text": "edges we've got this mapping service replica running on every host and it's",
    "start": "2031159",
    "end": "2036349"
  },
  {
    "text": "got all of the mappings that it needs to communicate with in the V PC well there's also cider mappings so in this",
    "start": "2036349",
    "end": "2043070"
  },
  {
    "text": "case we've got a mapping that says 172 16.0 dot 0 / 6 teen has to go to this",
    "start": "2043070",
    "end": "2048079"
  },
  {
    "text": "edge and this is the the implementation this is the physical implementation of routing tables in the V PC and so if you",
    "start": "2048079",
    "end": "2056329"
  },
  {
    "text": "look at this packet flow it looks exactly like the packet flow we had before we're gonna take the packet we're",
    "start": "2056329",
    "end": "2062990"
  },
  {
    "text": "gonna wrap it we're gonna send it across the physical network the edge is going to do the reverse mapping check and then",
    "start": "2062990",
    "end": "2068929"
  },
  {
    "text": "what so in this case we're talking about a VPN connection the edge",
    "start": "2068929",
    "end": "2075260"
  },
  {
    "start": "2070000",
    "end": "2070000"
  },
  {
    "text": "it's an AWS own device it's a Linux box with a whole bunch of NICs in it running our software and so it knows how to",
    "start": "2075260",
    "end": "2081980"
  },
  {
    "text": "interpret this V PC packet format so we send it to the edge we strip off all of",
    "start": "2081980",
    "end": "2089029"
  },
  {
    "text": "the V PC proprietary stuff we wrap it with an IPSec header and a physical",
    "start": "2089029",
    "end": "2096108"
  },
  {
    "text": "Internet header and in this case the the source and destination IP address is Internet routable that source is",
    "start": "2096109",
    "end": "2102470"
  },
  {
    "text": "actually one of our V PC head ends and the destination well you can look it up yourselves but if I send this across the",
    "start": "2102470",
    "end": "2109339"
  },
  {
    "text": "internet it is conceivable that you have a device in your data center that can handle this packet but can unwrap the",
    "start": "2109339",
    "end": "2116630"
  },
  {
    "text": "IPSec header inside extract the original packet and so now we've enabled an instance inside of a V PC to talk to a",
    "start": "2116630",
    "end": "2122960"
  },
  {
    "text": "router and a data center through a router in the data center to a host in a data center using IPSec which is I don't",
    "start": "2122960",
    "end": "2129650"
  },
  {
    "text": "know it's supposed to be standard it's mostly standard kind of we also have AWS",
    "start": "2129650",
    "end": "2135440"
  },
  {
    "text": "direct connect rather than doing IPSec and crypto over the internet you can get",
    "start": "2135440",
    "end": "2140690"
  },
  {
    "text": "a line a physical connection to AWS one gigabit 10 gigabit and in that case we",
    "start": "2140690",
    "end": "2147260"
  },
  {
    "text": "do exactly the same thing we deliver the traffic to an edge in this case it's an A to B less Direct Connect edge rather",
    "start": "2147260",
    "end": "2152630"
  },
  {
    "text": "than a VPN edge we strip off all of the Amazon proprietary stuff we wrap it in a",
    "start": "2152630",
    "end": "2158960"
  },
  {
    "text": "VLAN tag and we deliver the packet these VLANs are pretty short I said earlier 12",
    "start": "2158960",
    "end": "2166069"
  },
  {
    "text": "bits 4096 is a problem this is literally the cable from our edge to the Direct",
    "start": "2166069",
    "end": "2171380"
  },
  {
    "text": "Connect router and so when 4096 isn't enough well you've probably saturated the bandwidth on that link anyway and",
    "start": "2171380",
    "end": "2178430"
  },
  {
    "text": "you get another link in reality we've never come anywhere close to the 4096 limit these VLANs are literally",
    "start": "2178430",
    "end": "2184549"
  },
  {
    "text": "single-digit meters long and then people",
    "start": "2184549",
    "end": "2189740"
  },
  {
    "text": "like talking to the Internet there's there's good stuff on the internet actually a lot of us live on the internet you want to talk to your",
    "start": "2189740",
    "end": "2195619"
  },
  {
    "text": "instances so we have to do that and we all know that sending an IP a packet",
    "start": "2195619",
    "end": "2201950"
  },
  {
    "text": "with a 1000 to IP address out to the internet like you're totally allowed to it completely works you're just never",
    "start": "2201950",
    "end": "2207500"
  },
  {
    "text": "ever gonna hear back from them so we need to send this out and it turns out we actually just want to send IP traffic",
    "start": "2207500",
    "end": "2213559"
  },
  {
    "text": "we don't want it to be wrapped with anything so we extract the packet and this is where we do elastic IPS we swap",
    "start": "2213559",
    "end": "2221390"
  },
  {
    "text": "out the source IP address so it's source net on the way out its destination out on the way back in we swap out the IP",
    "start": "2221390",
    "end": "2227599"
  },
  {
    "text": "address so that someone out on the internet that chooses to respond to you has an IP address that's actually",
    "start": "2227599",
    "end": "2233329"
  },
  {
    "text": "routable back to you and so this is how we do Internet connectivity in VPC with it",
    "start": "2233329",
    "end": "2238990"
  },
  {
    "text": "elastic IP addresses so these are the the three edge types that we support in",
    "start": "2238990",
    "end": "2244780"
  },
  {
    "text": "VPC so tux the Linux mascot is a penguin",
    "start": "2244780",
    "end": "2251740"
  },
  {
    "start": "2247000",
    "end": "2247000"
  },
  {
    "text": "there's a lot of penguin metaphors running around in the Linux world we are not immune to this turns out that ec2 a",
    "start": "2251740",
    "end": "2260710"
  },
  {
    "text": "good chunk of ec2 got its start in Cape Town South Africa which interestingly enough if you take a globe and you put",
    "start": "2260710",
    "end": "2266890"
  },
  {
    "text": "it on a drill press and you start in Seattle you come out in the Indian Ocean just off the east coast of South Africa",
    "start": "2266890",
    "end": "2272020"
  },
  {
    "text": "this is almost as far as it's possible to get without leaving the planet just",
    "start": "2272020",
    "end": "2277960"
  },
  {
    "text": "south of Cape Town is boulders beach and on boulders beach there's the African penguin they're also known as the",
    "start": "2277960",
    "end": "2284470"
  },
  {
    "text": "Jackass penguin it's very disconcerting they really do sound like donkeys but they're also known as the black foot",
    "start": "2284470",
    "end": "2290110"
  },
  {
    "text": "penguin for obvious reasons and so when we built a Linux networking appliance",
    "start": "2290110",
    "end": "2295210"
  },
  {
    "text": "its Linux and it's Amazon and it's ec2 and ec2 got its start in Cape Town we",
    "start": "2295210",
    "end": "2300340"
  },
  {
    "text": "named it Blackfoot which is also where the building in Seattle where a lot of us work got its name recently I heard",
    "start": "2300340",
    "end": "2309190"
  },
  {
    "start": "2307000",
    "end": "2307000"
  },
  {
    "text": "that we had dropped prices in AWS for the 51st time none of these have been",
    "start": "2309190",
    "end": "2315610"
  },
  {
    "text": "VPC price drops the EPC does not participate in the grand amazon tradition of dropping prices because due",
    "start": "2315610",
    "end": "2322510"
  },
  {
    "text": "to the implementation that we have we haven't additionally constrained placement so we haven't driven down utilization we",
    "start": "2322510",
    "end": "2328300"
  },
  {
    "text": "aren't using expensive routers with weird Asics in them so the cost per VPC",
    "start": "2328300",
    "end": "2333670"
  },
  {
    "text": "is zero go in go into the console go into the api's create a bunch of e pcs it will not affect your bill at all",
    "start": "2333670",
    "end": "2339750"
  },
  {
    "text": "subnets are also free and most importantly the difference in price",
    "start": "2339750",
    "end": "2345160"
  },
  {
    "text": "between an instance that's connected to a V PC in an instance that isn't a zero",
    "start": "2345160",
    "end": "2350849"
  },
  {
    "text": "this is the date that we turned off the last physical web server in US retail",
    "start": "2351450",
    "end": "2358420"
  },
  {
    "text": "and if any of you are familiar with the way retail works in its annual cycle",
    "start": "2358420",
    "end": "2363880"
  },
  {
    "text": "that's a scary date that's very close to Black Friday and so",
    "start": "2363880",
    "end": "2369280"
  },
  {
    "text": "in 2010 we carried 100% of US retails traffic in VPC so this is not a science",
    "start": "2369280",
    "end": "2376690"
  },
  {
    "text": "project for us all of the slides that I went through would have made an interesting conference paper but it's",
    "start": "2376690",
    "end": "2381970"
  },
  {
    "text": "not a I don't have a beautiful law tech format a document unfortunately but we",
    "start": "2381970",
    "end": "2386980"
  },
  {
    "text": "do have working software and this is working software that's carried the US retail load for five years now this is",
    "start": "2386980",
    "end": "2393940"
  },
  {
    "text": "the software that we bet our business on this is how we operate Amazon today so this is not a research project this is",
    "start": "2393940",
    "end": "2400690"
  },
  {
    "text": "this is a real honest-to-god launched product and it's been a lot of fun watching it evolve it's been around for",
    "start": "2400690",
    "end": "2407710"
  },
  {
    "start": "2404000",
    "end": "2404000"
  },
  {
    "text": "a while and we've always had the ability to attach instances to it we've added a",
    "start": "2407710",
    "end": "2413290"
  },
  {
    "text": "whole bunch of other resources to VPC so now you can have an RDS database and so",
    "start": "2413290",
    "end": "2418510"
  },
  {
    "text": "you can have you could have clients you can have end users in your offices in",
    "start": "2418510",
    "end": "2423609"
  },
  {
    "text": "your data centers that are talking to this RDS database as if it were a seamless part of your network you can",
    "start": "2423609",
    "end": "2429010"
  },
  {
    "text": "have redshift clusters data warehousing clusters running in your V PC consuming",
    "start": "2429010",
    "end": "2435369"
  },
  {
    "text": "data from data sources on-premise it's a seamless network that spans both your data center and AWS and you can mix and",
    "start": "2435369",
    "end": "2443500"
  },
  {
    "text": "match resources and we keep adding services to V PC so in ec2 we didn't say",
    "start": "2443500",
    "end": "2449530"
  },
  {
    "text": "much about the network you had an IP address you had a public IP address but",
    "start": "2449530",
    "end": "2454990"
  },
  {
    "text": "that was really all we said about the network like you had an IP address you could send packets to it and you would get packets back from it and that was",
    "start": "2454990",
    "end": "2461140"
  },
  {
    "text": "the entire network abstraction and it was great because it was easy to get started you'd click and you'd get an instance and you could SSH to it and",
    "start": "2461140",
    "end": "2467200"
  },
  {
    "text": "life was good but there was nothing more you could do with the network and so we've added VPN and Direct Connect and",
    "start": "2467200",
    "end": "2473609"
  },
  {
    "text": "this is the platform on which we do all of our network innovation now so security group egress filtering was a",
    "start": "2473609",
    "end": "2479440"
  },
  {
    "text": "common customer asked that's available in V PC Network Ackles a lot of",
    "start": "2479440",
    "end": "2484990"
  },
  {
    "text": "traditional networks you group like things together like as you physically build the data center this subnet is",
    "start": "2484990",
    "end": "2491140"
  },
  {
    "text": "over here and all of the web servers are over here all of the payment servers are over there and so it doesn't have to be",
    "start": "2491140",
    "end": "2496780"
  },
  {
    "text": "that way but in many customers minds and this neither a good thing or a bad thing it's how they think IP addresses that are",
    "start": "2496780",
    "end": "2503130"
  },
  {
    "text": "close together are related to each other that's fine put them on a subnet together put a network Akal in front of it you can lay out your network that way",
    "start": "2503130",
    "end": "2509969"
  },
  {
    "text": "we added routing tables this allows you to have granular control completely driven via api's over where your traffic",
    "start": "2509969",
    "end": "2516479"
  },
  {
    "text": "flows in your V PC and this allows you to interpose network appliances inside of your V PC to say all traffic between",
    "start": "2516479",
    "end": "2523170"
  },
  {
    "text": "this subnet and that drive that subnet is going to flow across this appliance which we now support multiple en I is",
    "start": "2523170",
    "end": "2529469"
  },
  {
    "text": "elastic network interfaces on an instance and so you can build a network appliance and we've got a whole",
    "start": "2529469",
    "end": "2535109"
  },
  {
    "text": "marketplace full of vendors that provide network appliances that work in V PC and",
    "start": "2535109",
    "end": "2540349"
  },
  {
    "text": "multiple IP addresses per Eni and so we've got this platform now where we're",
    "start": "2540349",
    "end": "2545700"
  },
  {
    "text": "constantly adding new features and one of the cool things is that because it's delivered as a service there's no deployment there's no upgrade",
    "start": "2545700",
    "end": "2552749"
  },
  {
    "text": "when we release a new VP C feature all of our customers can take advantage of it immediately it's an API call away and",
    "start": "2552749",
    "end": "2559130"
  },
  {
    "start": "2559000",
    "end": "2559000"
  },
  {
    "text": "one of the coolest things that we've launched recently is s3 endpoints so",
    "start": "2559130",
    "end": "2564509"
  },
  {
    "text": "prior to a3 endpoints if you wanted to talk to s3 you need it to egress to the internet somehow you could do this down",
    "start": "2564509",
    "end": "2570989"
  },
  {
    "text": "your Direct Connect or VPN link to your data center and then back but that's that's the long way",
    "start": "2570989",
    "end": "2575999"
  },
  {
    "text": "ec2 lives here s3 lives here your data center is over there you're paying the speed of light twice you're paying",
    "start": "2575999",
    "end": "2581549"
  },
  {
    "text": "bandwidth twice you know in some cases that's the right thing you've got some set of security appliances or inspection",
    "start": "2581549",
    "end": "2587719"
  },
  {
    "text": "on-premise and you want to apply that that's fine we support that configuration but the latency and the",
    "start": "2587719",
    "end": "2593039"
  },
  {
    "text": "performance aren't going to be there and so you've gotta have some way of egressing to the internet whether it's",
    "start": "2593039",
    "end": "2598349"
  },
  {
    "text": "an Internet gateway a local tier V PC or down a Direct Connect private link and then you need to hit s3 in that case you",
    "start": "2598349",
    "end": "2606119"
  },
  {
    "text": "must have a public IP address s3 has to be able to send packets back to you if you egress with an RFC 1918 IP address",
    "start": "2606119",
    "end": "2612630"
  },
  {
    "text": "we're not gonna be able to talk back to you so customers didn't like this configuration they gave us feedback we",
    "start": "2612630",
    "end": "2619499"
  },
  {
    "text": "listened and so now you can declare an s3 endpoint it's an API call just like",
    "start": "2619499",
    "end": "2625079"
  },
  {
    "text": "everything else and you say I wish I had an s3 endpoint attached to this VPC",
    "start": "2625079",
    "end": "2631130"
  },
  {
    "text": "your instances talk to your s3 end point without needing to have public IP",
    "start": "2631369",
    "end": "2637160"
  },
  {
    "text": "addresses and the end point takes care of talking to s3 and I'll tell you how",
    "start": "2637160",
    "end": "2642349"
  },
  {
    "text": "in a moment and so now you've effectively moved s3 into your V PC you don't need to have any internet exposure",
    "start": "2642349",
    "end": "2648440"
  },
  {
    "text": "whatsoever in your V PC you can talk to s3 via the fast path you don't have to hold things back to your home data",
    "start": "2648440",
    "end": "2653839"
  },
  {
    "text": "center and the way it works is we edit a new kind of edge and so the V PC network",
    "start": "2653839",
    "end": "2661490"
  },
  {
    "text": "itself doesn't need to change at all V PC doesn't know if it's delivering to a VPN edge or a Direct Connect edge or an",
    "start": "2661490",
    "end": "2667339"
  },
  {
    "text": "s3 endpoint edge so this allowed us to decouple our engineering and so all we have to do is say like you're going to",
    "start": "2667339",
    "end": "2674210"
  },
  {
    "text": "s3 us East one if you're going to this named prefix worth of IP addresses send it to this one nine two one six eight",
    "start": "2674210",
    "end": "2680119"
  },
  {
    "text": "4.4 edge and so we're gonna send something to s3 it's probably going to",
    "start": "2680119",
    "end": "2686180"
  },
  {
    "text": "be HTTP at least if you want to response back we're gonna do exactly the same",
    "start": "2686180",
    "end": "2691430"
  },
  {
    "text": "wrapping that we've talked about before we're gonna send it to the destination edge it's going to do exactly the same reverse mapping check and now we've got",
    "start": "2691430",
    "end": "2699200"
  },
  {
    "text": "this thing we're gonna send it to the edge and what we're gonna do is we're",
    "start": "2699200",
    "end": "2704869"
  },
  {
    "text": "gonna unwrap your packet and we're gonna re wrap it with a rapper that s3",
    "start": "2704869",
    "end": "2710960"
  },
  {
    "text": "understands we taught s3 how to understand endpoints and so when this packet arrives at s3 we don't NAT the",
    "start": "2710960",
    "end": "2719660"
  },
  {
    "text": "source IP address there is still 1000 - and the VPC endpoint ID is encoded in",
    "start": "2719660",
    "end": "2725239"
  },
  {
    "text": "that packet header so when s3 gets this packet it knows which VPC and which VPC",
    "start": "2725239",
    "end": "2730400"
  },
  {
    "text": "endpoint were used to reach your bucket and that leads to some interesting",
    "start": "2730400",
    "end": "2735859"
  },
  {
    "text": "features you can apply policy to the",
    "start": "2735859",
    "end": "2741920"
  },
  {
    "start": "2737000",
    "end": "2737000"
  },
  {
    "text": "endpoint itself and in this case I've got a resource allow statement in this",
    "start": "2741920",
    "end": "2748069"
  },
  {
    "text": "policy and the only thing that's accessible from this VPC is my secure",
    "start": "2748069",
    "end": "2755329"
  },
  {
    "text": "bucket any attempts to get to any other bucket from that VPC going to be met",
    "start": "2755329",
    "end": "2761450"
  },
  {
    "text": "with a permission denied you'll actually get a permission denied error as three saying I'm sorry that's",
    "start": "2761450",
    "end": "2766760"
  },
  {
    "text": "disallowed by policy and so now you can control which buckets your VPC can get",
    "start": "2766760",
    "end": "2772880"
  },
  {
    "text": "to you can also apply policy to your bucket you've always been able to do this but now we've added the ability to",
    "start": "2772880",
    "end": "2781160"
  },
  {
    "text": "specify an endpoint ID and so this is a deny clause that says if the endpoint ID",
    "start": "2781160",
    "end": "2789350"
  },
  {
    "text": "isn't this specific endpoint deny the request you now have a bucket that is",
    "start": "2789350",
    "end": "2794660"
  },
  {
    "text": "only accessible from within your VPC I could create this configuration I could give you my AWS credentials and you",
    "start": "2794660",
    "end": "2801890"
  },
  {
    "text": "still wouldn't be able to access my bucket and so now from VPC to s3 all the",
    "start": "2801890",
    "end": "2808310"
  },
  {
    "text": "way through using the same standard AWS policy and I am controls you have complete control over your traffic",
    "start": "2808310",
    "end": "2814820"
  },
  {
    "text": "end-to-end so in product design we often face",
    "start": "2814820",
    "end": "2820700"
  },
  {
    "text": "attention you've got products that are simple products that are complex and the",
    "start": "2820700",
    "end": "2825770"
  },
  {
    "text": "products that are simple tend to be limited and the rich complex products tend to be more flexible but they tend",
    "start": "2825770",
    "end": "2831530"
  },
  {
    "text": "to be harder to use and this isn't a value spectrum I own both a multimeter and an oscilloscope they're both good",
    "start": "2831530",
    "end": "2837590"
  },
  {
    "text": "tools I use them for different jobs I wouldn't want to get rid of one for the other but if you're trying to figure out",
    "start": "2837590",
    "end": "2843830"
  },
  {
    "text": "if the battery is good getting your oscilloscope out is really silly if you're trying to debug a clock circuit",
    "start": "2843830",
    "end": "2848840"
  },
  {
    "text": "the multi tester is just gonna stare at you blankly and what we had was two",
    "start": "2848840",
    "end": "2854450"
  },
  {
    "text": "separate experiences we had ec2 and we had V PC and customers would use ec2",
    "start": "2854450",
    "end": "2860960"
  },
  {
    "text": "again through no bad thinking there's the getting started guide it has like three steps you want an instance you",
    "start": "2860960",
    "end": "2867080"
  },
  {
    "text": "need to create a key pair you need to pick an ami you need to launch the instance you're in oh wait you wanted a VPN tunnel we're sorry you need to be in",
    "start": "2867080",
    "end": "2873440"
  },
  {
    "text": "a V PC it's not a good customer message so a few years ago actually in March of",
    "start": "2873440",
    "end": "2880190"
  },
  {
    "start": "2877000",
    "end": "2877000"
  },
  {
    "text": "2013 we launched default V PC this is what all this is the experience that all",
    "start": "2880190",
    "end": "2886670"
  },
  {
    "text": "new AWS accounts get so you can go through the getting started guide the getting started guide from 2010 back",
    "start": "2886670",
    "end": "2894110"
  },
  {
    "text": "before ec2 had all all of these features back before V PC existed you can launch into you can terminate instances it's",
    "start": "2894110",
    "end": "2900960"
  },
  {
    "text": "completely code compatible with ec2 and so the code that was written by us and more importantly the code that was",
    "start": "2900960",
    "end": "2906030"
  },
  {
    "text": "written by our customers by the ecosystem of people that have been using ec2 for years continues to work and if",
    "start": "2906030",
    "end": "2913350"
  },
  {
    "text": "you ever want any of the rich advanced features of the PC you break the glass and it turns out there was a V PC behind you all the time and now you can bring",
    "start": "2913350",
    "end": "2921540"
  },
  {
    "text": "up VPN tunnels using exactly the same sequence of API calls you have made if you'd explicitly declared that V PC so",
    "start": "2921540",
    "end": "2928560"
  },
  {
    "text": "we take care of all of that initial mock for you we don't impose that comp complexity on customers but then when",
    "start": "2928560",
    "end": "2934530"
  },
  {
    "text": "they want it is there for them and so as a result we've now got a single product",
    "start": "2934530",
    "end": "2939750"
  },
  {
    "text": "that spans a fairly broad swath of this spectrum and customers can incrementally",
    "start": "2939750",
    "end": "2945120"
  },
  {
    "text": "tackle this complexity they can adopt these features as they're useful to them but they don't need to deal with them",
    "start": "2945120",
    "end": "2950610"
  },
  {
    "text": "until they're useful thank you for sticking around hopefully you're not",
    "start": "2950610",
    "end": "2955800"
  },
  {
    "text": "leaving disappointed",
    "start": "2955800",
    "end": "2958610"
  }
]