[
  {
    "text": "welcome back it is day number four of",
    "start": "939",
    "end": "6799"
  },
  {
    "text": "the in-depth Postgres training and I'm ready to dive in I've got the happiness",
    "start": "6799",
    "end": "12500"
  },
  {
    "text": "since up on the board we've actually hit a whole bunch of these happiness hits hints already I don't know if you've",
    "start": "12500",
    "end": "18020"
  },
  {
    "text": "been paying attention you know we've talked we've talked about p IE m PG Sat",
    "start": "18020",
    "end": "23869"
  },
  {
    "text": "statements talked about a couple of the alarming things yesterday we talked about temp usage we've talked about",
    "start": "23869",
    "end": "29810"
  },
  {
    "text": "upgrades now and and the the updates and everything we've touched on vacuuming",
    "start": "29810",
    "end": "35870"
  },
  {
    "text": "and what vacuuming is really actually",
    "start": "35870",
    "end": "41269"
  },
  {
    "text": "we're gonna finish these out today so and yeah and actually along those lines",
    "start": "41269",
    "end": "48940"
  },
  {
    "text": "what I'm gonna do is before we jump in",
    "start": "48940",
    "end": "55609"
  },
  {
    "text": "to so today is break fixed day that is our title for the day and this is my favorite day of the week by the way by",
    "start": "55609",
    "end": "63859"
  },
  {
    "text": "far but before I get into that content just we've been going through the",
    "start": "63859",
    "end": "70490"
  },
  {
    "text": "happiness since there wasn't really anywhere else I saw to fit this one in this week but I wanted just real quickly",
    "start": "70490",
    "end": "75710"
  },
  {
    "text": "touch on connection floors I'm not gonna like spend a long time on this but this",
    "start": "75710",
    "end": "81490"
  },
  {
    "text": "this is a pretty important strategy for Postgres I think one of the reasons that",
    "start": "81490",
    "end": "88609"
  },
  {
    "text": "it's important is that in one thing about Postgres is that it's memory",
    "start": "88609",
    "end": "98030"
  },
  {
    "text": "management can be a bit of a challenge and if and if you need to carefully manage connections if you start getting",
    "start": "98030",
    "end": "103520"
  },
  {
    "text": "into really really high connection counts and they're long-lived and they're doing things you can get into",
    "start": "103520",
    "end": "109429"
  },
  {
    "text": "situations that that gets you into trouble in fact you know the other there was",
    "start": "109429",
    "end": "116149"
  },
  {
    "text": "also huge pages you saw as a happy innocent and these two things are closely are both related or they're both",
    "start": "116149",
    "end": "122749"
  },
  {
    "text": "yeah they're both related to not running out of memory on your Postgres server",
    "start": "122749",
    "end": "127759"
  },
  {
    "text": "both of them helped quite a bit with that so that up here in connection pools",
    "start": "127759",
    "end": "133340"
  },
  {
    "text": "assists there's really two different models for this a lot of people have connection pools built in your application already",
    "start": "133340",
    "end": "139670"
  },
  {
    "text": "and that's one approach to take there is also another approach that people sometimes take of doing a centralized",
    "start": "139670",
    "end": "145209"
  },
  {
    "text": "connection Pooler and this is where you're actually putting sort of a connection pool in between your",
    "start": "145209",
    "end": "150830"
  },
  {
    "text": "application in the database you're setting up like a server and there's some difference some software packages people use regardless of what connection",
    "start": "150830",
    "end": "159080"
  },
  {
    "text": "pool technology you're using one thing that I just want to specifically call out on this slide is this max-age idea",
    "start": "159080",
    "end": "166599"
  },
  {
    "text": "which and even the bullet point here you see it helps reclaim bloat so one thing",
    "start": "166599",
    "end": "172430"
  },
  {
    "text": "about Postgres that I've noticed is that sort of over the life soap and this is",
    "start": "172430",
    "end": "178280"
  },
  {
    "text": "the thing with with the connection pool that you'll make a connection Postgres will start up a background",
    "start": "178280",
    "end": "183560"
  },
  {
    "text": "process and that process is going to stay there as long as the connections alive and over the lifetime of that",
    "start": "183560",
    "end": "189430"
  },
  {
    "text": "process it's you know it it might run a query at some point that needs a lot of",
    "start": "189430",
    "end": "194690"
  },
  {
    "text": "memory so it's gonna allocate you maybe it's doing a sort maybe it's just buffering some stuff and what I have",
    "start": "194690",
    "end": "203150"
  },
  {
    "text": "observed is that so Postgres will like try to release some of that memory but it doesn't always get released back out",
    "start": "203150",
    "end": "209650"
  },
  {
    "text": "efficiently and effectively so over time like what we often see is if you have",
    "start": "209650",
    "end": "214819"
  },
  {
    "text": "really long lived connections the memory just kind of starts to climb so that's one of the reasons it's it's it's pretty",
    "start": "214819",
    "end": "221930"
  },
  {
    "text": "widely considered a best practice to make sure that you age out your your connections in your connection pool and",
    "start": "221930",
    "end": "228019"
  },
  {
    "text": "just kind of recycle them periodically and that's what max-age will do oh and look at that and the huge pages is even",
    "start": "228019",
    "end": "234709"
  },
  {
    "text": "specifically mentioned on here I'd forgotten that that was the last bullet so right there that covers two more of",
    "start": "234709",
    "end": "241430"
  },
  {
    "text": "our happiness cents that I said we'd try to touch on this week okay with that out",
    "start": "241430",
    "end": "248959"
  },
  {
    "text": "of the way let's dive into my favorite day of the week which is break fixed day",
    "start": "248959",
    "end": "253970"
  },
  {
    "text": "so this is the day we get to try to break stuff which I've just always enjoyed doing for some reason so first",
    "start": "253970",
    "end": "262940"
  },
  {
    "text": "of all I would like everybody to get out your your little pirate patch for your eyes that's what we're gonna",
    "start": "262940",
    "end": "269419"
  },
  {
    "text": "start with and we're gonna talk about all the things that all the things that",
    "start": "269419",
    "end": "274700"
  },
  {
    "text": "you really came to class for this week right what did you really come here to hear about all the fun stuff corruptions",
    "start": "274700",
    "end": "283180"
  },
  {
    "text": "inconsistencies failures all of the great things right this is a lot of fun",
    "start": "283180",
    "end": "292010"
  },
  {
    "text": "is corruptions it's crushed in a bad word maybe is that too harsh maybe I should like soften it up a little bit",
    "start": "292010",
    "end": "298180"
  },
  {
    "text": "but know you guys have been around software for a while right I mean you know software has bugs it happens when",
    "start": "298180",
    "end": "305540"
  },
  {
    "text": "we think about failures in Postgres I find it helpful sort of break them down",
    "start": "305540",
    "end": "311090"
  },
  {
    "text": "into three large categories and this is actually kind of a terminology that I hear a lot in a lot of different places",
    "start": "311090",
    "end": "318400"
  },
  {
    "text": "when we think about a a database in general I think that there's sort of",
    "start": "318400",
    "end": "325430"
  },
  {
    "text": "three jobs the database has that are really important and these are going to be in order the first job of a database",
    "start": "325430",
    "end": "331610"
  },
  {
    "text": "is durability right and what durability means is not losing your data that's",
    "start": "331610",
    "end": "336950"
  },
  {
    "text": "that's job number one if you are responsible for the database and",
    "start": "336950",
    "end": "342680"
  },
  {
    "text": "somebody needs to be you know whether whether you're a DBA or not your job number one is making sure that you're",
    "start": "342680",
    "end": "348890"
  },
  {
    "text": "that you're that you are protecting the durability of your data don't lose your data right job number",
    "start": "348890",
    "end": "355400"
  },
  {
    "text": "one number two is availability so number",
    "start": "355400",
    "end": "360410"
  },
  {
    "text": "one is don't lose the data all right so once we've got that we know we have the data then the next thing is making sure",
    "start": "360410",
    "end": "365690"
  },
  {
    "text": "that you can access it making sure it's available to your application and the third thing is performance and there is",
    "start": "365690",
    "end": "371300"
  },
  {
    "text": "kind of a fourth area too like when you get into the when you start thinking from like a security perspective you'll",
    "start": "371300",
    "end": "376460"
  },
  {
    "text": "start thinking about confidentiality in the CV and the CVE or the CBS s scoring",
    "start": "376460",
    "end": "382850"
  },
  {
    "text": "system they'll talk they they actually use the word integrity I kind of think of that as durability so there are a",
    "start": "382850",
    "end": "388430"
  },
  {
    "text": "couple other categories to look at but these are right here I think are in order the three important jobs of a",
    "start": "388430",
    "end": "395000"
  },
  {
    "text": "database and and I think that this is a very helpful way to think about categorizing some of the failures that",
    "start": "395000",
    "end": "400280"
  },
  {
    "text": "we're going to see so I'm kind of starting out high level here but maybe this is helpful just to",
    "start": "400280",
    "end": "407000"
  },
  {
    "text": "sort of list out some different kinds of failures and and put them underneath those headings I the thing that probably",
    "start": "407000",
    "end": "415070"
  },
  {
    "text": "like when you think of like you know corruption dramatic failures that",
    "start": "415070",
    "end": "420710"
  },
  {
    "text": "probably the first thing that comes to mind is like this you know it's completely losing everything and I've got my share of war stories about this",
    "start": "420710",
    "end": "427100"
  },
  {
    "text": "too I remember one of a previous job where I was a DBA where we had somebody",
    "start": "427100",
    "end": "433430"
  },
  {
    "text": "who punched in a command and do they they had two windows open another desktop and they just ran the command in",
    "start": "433430",
    "end": "438680"
  },
  {
    "text": "the wrong window one was the prod server the other one was they were setting up a new dev server and they knocked out the disk",
    "start": "438680",
    "end": "443960"
  },
  {
    "text": "headers on all of the disks on this production cluster and that was not",
    "start": "443960",
    "end": "449600"
  },
  {
    "text": "something that was easily recoverable outside of spending about 10 hours pulling stuff off a backup tapes it's a",
    "start": "449600",
    "end": "456470"
  },
  {
    "text": "long outage that was like you know the that's like the classic dramatic story",
    "start": "456470",
    "end": "461510"
  },
  {
    "text": "of yeah I mean we didn't lose the data in the end but it was a long outage",
    "start": "461510",
    "end": "467599"
  },
  {
    "text": "while we were pulling stuff off of tapes well I'd not tapes technically in that case that but it took a very long time",
    "start": "467599",
    "end": "475060"
  },
  {
    "text": "but there's a lot more types of failures there's one or two that I think I would",
    "start": "475060",
    "end": "482030"
  },
  {
    "text": "point out because you because you might not think of these at first as failures like for example wrong query results",
    "start": "482030",
    "end": "488169"
  },
  {
    "text": "underneath the durability category and the reason for that is that you know if",
    "start": "488169",
    "end": "494180"
  },
  {
    "text": "you think about what your database is doing so you say yes you want to have the correct data on the disk right but",
    "start": "494180",
    "end": "501740"
  },
  {
    "text": "you're constantly what you're constantly doing is is your application is like looking at data processing that data and",
    "start": "501740",
    "end": "508010"
  },
  {
    "text": "then updating that data right and if a query makes a mistake if you run a query",
    "start": "508010",
    "end": "513380"
  },
  {
    "text": "that says you know update this record and double the salaries but then if the",
    "start": "513380",
    "end": "519110"
  },
  {
    "text": "query actually triples the salaries instead of doubling them you see now you've introduced you've introduced it",
    "start": "519110",
    "end": "524360"
  },
  {
    "text": "you've introduced a failure into the system that that's really that's really a loss of data that's really a durability problem so even things up and",
    "start": "524360",
    "end": "532280"
  },
  {
    "text": "like the query processing system can be a durability fail as well another thing to think about is",
    "start": "532280",
    "end": "538100"
  },
  {
    "text": "like sometimes we think about like maintenance windows you know we don't",
    "start": "538100",
    "end": "543170"
  },
  {
    "text": "really think of those as like big dramatic failures like I had a scheduled outage but like something for example on",
    "start": "543170",
    "end": "549769"
  },
  {
    "text": "the RTS side that we think about is we think about availability is making sure that maintenance things happen within a",
    "start": "549769",
    "end": "556579"
  },
  {
    "text": "reasonable period of time like if if some maintenance operation is taking",
    "start": "556579",
    "end": "562220"
  },
  {
    "text": "like 45 minutes or an hour you know even if it was an expected scheduled thing like the customer you know I clicked a",
    "start": "562220",
    "end": "568970"
  },
  {
    "text": "button and I started that process like an upgrade or something right but it stretches out and out and out that that",
    "start": "568970",
    "end": "574640"
  },
  {
    "text": "becomes an availability event at some point this is a sad conversation that I",
    "start": "574640",
    "end": "584810"
  },
  {
    "text": "personally observed in the Postgres slack room public slack channel and I've",
    "start": "584810",
    "end": "593060"
  },
  {
    "text": "blurred out the names to protect the innocent and you don't have to read through all of it but this was a sad",
    "start": "593060",
    "end": "600410"
  },
  {
    "text": "conversation with somebody really begging for help because they had made a mistake and lost",
    "start": "600410",
    "end": "606980"
  },
  {
    "text": "the date and they did not have a backup in this case and if there's sort of one",
    "start": "606980",
    "end": "612260"
  },
  {
    "text": "point I said this a moment ago I'm gonna say it one more time um I think as I introduce my break in",
    "start": "612260",
    "end": "618170"
  },
  {
    "text": "fixed date one thing that I'm gonna do is draw a little bit on my background as a DBA and and just try to sort of",
    "start": "618170",
    "end": "624649"
  },
  {
    "text": "emphasize some things that like if you've been a DBA this should sound really familiar to you but it's really",
    "start": "624649",
    "end": "630770"
  },
  {
    "text": "important things I find well increasingly we're all involved in operations whether you're a software",
    "start": "630770",
    "end": "636649"
  },
  {
    "text": "developer whether your DBA whether you're a sysadmin and there was one thing that got drilled into my head over",
    "start": "636649",
    "end": "645140"
  },
  {
    "text": "years and years and years of database administration which is that job number one is don't lose the data job number",
    "start": "645140",
    "end": "652100"
  },
  {
    "text": "one is don't lose the data like when I went through Oracle certifications I",
    "start": "652100",
    "end": "657860"
  },
  {
    "text": "remember like the first thing was backup in recovery like you know how to backup and you know how to recover a database",
    "start": "657860",
    "end": "664339"
  },
  {
    "text": "and that's like that's job everything else is after that like you you could be the best query tuner in the",
    "start": "664339",
    "end": "671540"
  },
  {
    "text": "world but if you don't keep the data safe like you know you're not the right person for this job like you have one",
    "start": "671540",
    "end": "678950"
  },
  {
    "text": "job your first job and I think that this is a good thing you know as I start",
    "start": "678950",
    "end": "684140"
  },
  {
    "text": "getting into ways to break the database as we start talking about how to how different kinds of failure modes and",
    "start": "684140",
    "end": "691760"
  },
  {
    "text": "what to do about those I just want to kind of put this in perspective and set the stage and sort of and and remind us",
    "start": "691760",
    "end": "700910"
  },
  {
    "text": "that sort of the first job and then this is like this is easy to say now and I'm I'm emphasizing this now while we're in",
    "start": "700910",
    "end": "706790"
  },
  {
    "text": "a class because when something actually happens to your application like when",
    "start": "706790",
    "end": "712370"
  },
  {
    "text": "the real thing happens it's actually it's surprisingly easy to forget this",
    "start": "712370",
    "end": "718660"
  },
  {
    "text": "it's easy to jump ahead and start thinking about all sorts of other things like finding the bug for example or like",
    "start": "718660",
    "end": "726500"
  },
  {
    "text": "how you're gonna like you know what you're going to do next it's it's surprising as opposed to just remembering job number one is just don't",
    "start": "726500",
    "end": "732440"
  },
  {
    "text": "lose data be very careful you know take your time that kind of a thing okay so",
    "start": "732440",
    "end": "738730"
  },
  {
    "text": "the promise would do some interesting stuff we'd break some things and we are going to but before we break things I'm",
    "start": "738730",
    "end": "746630"
  },
  {
    "text": "going to talk about you know safety first right safety first there's some pretty important safety",
    "start": "746630",
    "end": "753350"
  },
  {
    "text": "equipment and I kind of ensured I mentioned the first one just a moment ago for my experiences your first safety",
    "start": "753350",
    "end": "760790"
  },
  {
    "text": "tools backups right in the world of RDS backups are based on snapshots and then",
    "start": "760790",
    "end": "766970"
  },
  {
    "text": "we take the wall logs periodically and push them off we do both so for when it",
    "start": "766970",
    "end": "772700"
  },
  {
    "text": "comes to recovery you can do both this type of recovery where you just take them grab a snapshot and just pull the",
    "start": "772700",
    "end": "778160"
  },
  {
    "text": "snapshot and then there's the second kind of recovery where you do a roll forward where you apply wall logs and",
    "start": "778160",
    "end": "783980"
  },
  {
    "text": "actually roll to a point in time so you know you can say just give me the",
    "start": "783980",
    "end": "789080"
  },
  {
    "text": "snapshot that was taken last night during the backup window or you can say",
    "start": "789080",
    "end": "794410"
  },
  {
    "text": "recover the database to 151 p.m. today and 13 seconds",
    "start": "794410",
    "end": "800570"
  },
  {
    "text": "and what will happen is it will start with a snapshot and replay all of the change records and tell exactly that",
    "start": "800570",
    "end": "806720"
  },
  {
    "text": "point in time and stop there it's it's really important that you have a solid",
    "start": "806720",
    "end": "812960"
  },
  {
    "text": "understanding of these safety tools before you get into a situation where",
    "start": "812960",
    "end": "818510"
  },
  {
    "text": "you're dealing with a problem and I'll get into some of the reasons because this stuff becomes very tactical when",
    "start": "818510",
    "end": "824360"
  },
  {
    "text": "you think about how you're gonna move forward with solving problems so yeah the first thing is backups the second",
    "start": "824360",
    "end": "831020"
  },
  {
    "text": "thing is going to be multi a-z and we talked about mass a lot this is sort of a pretty well-established well",
    "start": "831020",
    "end": "836690"
  },
  {
    "text": "architected principle you know people at AWS are always saying this all across the org you should always design across",
    "start": "836690",
    "end": "843950"
  },
  {
    "text": "daisies you know architect your applications across daisies and and this",
    "start": "843950",
    "end": "849230"
  },
  {
    "text": "is an important tool and from an architecture perspective so I mentioned backups when it comes to mass probably",
    "start": "849230",
    "end": "856760"
  },
  {
    "text": "most of us are familiar with this but we'll just kind of make sure in case anybody in mass the what happens is you",
    "start": "856760",
    "end": "866030"
  },
  {
    "text": "have in your primary you have a database and you have your stores your EBS",
    "start": "866030",
    "end": "872090"
  },
  {
    "text": "storage and then in another AZ you have another ec2 instance and it has its own",
    "start": "872090",
    "end": "878420"
  },
  {
    "text": "EBS storage and then what happens is the this database just accesses the storage",
    "start": "878420",
    "end": "885200"
  },
  {
    "text": "and then there's storage level replication that happens okay so that means that like the database is not",
    "start": "885200",
    "end": "892430"
  },
  {
    "text": "doesn't know even really know that it's being replicated the database is just doing IO to a block device but when the",
    "start": "892430",
    "end": "899420"
  },
  {
    "text": "database does our block right the storage layer is going to take that block ship it over to the other AZ and",
    "start": "899420",
    "end": "905720"
  },
  {
    "text": "it won't acknowledge the right until both both EBS volumes have the right",
    "start": "905720",
    "end": "910940"
  },
  {
    "text": "down on disk that's going to become increasingly important as we go on later right so that's how multi AZ works the",
    "start": "910940",
    "end": "918050"
  },
  {
    "text": "second really important point to know so there's two important things that you need to have really solid these are",
    "start": "918050",
    "end": "923960"
  },
  {
    "text": "these are fundamentals this is just like knowing how to take a backup and do a recovery all right fundamentals a is",
    "start": "923960",
    "end": "929660"
  },
  {
    "text": "understand masamune storage replication B is understand that backups come from this secondary that's very you need to know",
    "start": "929660",
    "end": "936769"
  },
  {
    "text": "where the backups are coming from because again you'll see this is all going to become very tactical when we",
    "start": "936769",
    "end": "942769"
  },
  {
    "text": "start seeing problems so remember that always remember that when you're doing a",
    "start": "942769",
    "end": "948560"
  },
  {
    "text": "mass and you're if you're an RDS you have a math setup and you start taking in yeah if you that's it if you're in",
    "start": "948560",
    "end": "955640"
  },
  {
    "text": "RDS you have mass then then your backups will come off of your secondary not off",
    "start": "955640",
    "end": "961160"
  },
  {
    "text": "of your primary ok if you trigger a failover you you know move your primary",
    "start": "961160",
    "end": "966500"
  },
  {
    "text": "over there the backups will begin to come from this side instead of the other side ok",
    "start": "966500",
    "end": "971570"
  },
  {
    "text": "so at the next backup window the next snapshots gonna come from here the next",
    "start": "971570",
    "end": "979970"
  },
  {
    "text": "tool in our tool belt is going to be replicas this is important because this is the important point here is that this",
    "start": "979970",
    "end": "987380"
  },
  {
    "text": "is going to be different this is not block level replication with RDS",
    "start": "987380",
    "end": "992510"
  },
  {
    "text": "Postgres this is a wall based physical replication so in the picture here you",
    "start": "992510",
    "end": "997579"
  },
  {
    "text": "see I have I have my mass cluster on the left with my primary secondary and then I have to read replicas so whereas with",
    "start": "997579",
    "end": "1004690"
  },
  {
    "text": "mass we're doing block level replication this is different with with read",
    "start": "1004690",
    "end": "1010899"
  },
  {
    "text": "replicas it is the wall records are being shipped over and that read replica is a physical replica meaning it's bit",
    "start": "1010899",
    "end": "1017649"
  },
  {
    "text": "for a bit going to look pretty close nearly identical but it's wall records",
    "start": "1017649",
    "end": "1023380"
  },
  {
    "text": "that in the database is very aware that this this replica is happening ok and",
    "start": "1023380",
    "end": "1029650"
  },
  {
    "text": "there's one last tool one last tool that's in our tool belt and the last tool that we have in our tool belt is",
    "start": "1029650",
    "end": "1036308"
  },
  {
    "text": "these logical exports and by the way if you didn't notice we just finished hitting all the bullet points on the",
    "start": "1036309",
    "end": "1042188"
  },
  {
    "text": "happiness since these are the last three right so logical exports are generally",
    "start": "1042189",
    "end": "1050140"
  },
  {
    "text": "done with a tool called PG dump PG dump",
    "start": "1050140",
    "end": "1055450"
  },
  {
    "text": "is on your in your lab environment so this is something you can fiddle around with if you're not familiar with it and I would encourage you to do that there's",
    "start": "1055450",
    "end": "1063550"
  },
  {
    "text": "also a PD there's a PG dump all that you can look at as well PG dump all is sort of an easier way to get",
    "start": "1063550",
    "end": "1069780"
  },
  {
    "text": "multiple data the entire database out there's multiple levels that we can",
    "start": "1069780",
    "end": "1075730"
  },
  {
    "text": "operate out here so this is what you're going to use I didn't make a slide for this but there's one other thing worth",
    "start": "1075730",
    "end": "1080799"
  },
  {
    "text": "mentioning which is logical replication as well but we'll get into I guess we'll get into replication stuff tomorrow when",
    "start": "1080799",
    "end": "1088390"
  },
  {
    "text": "if you ever get to the point you're dealing with a problem you want to know every copy of your data where it is and",
    "start": "1088390",
    "end": "1094840"
  },
  {
    "text": "how it's how it comes about right so that's why I'm starting by cataloging all of these things and in particular",
    "start": "1094840",
    "end": "1102910"
  },
  {
    "text": "the logical exports and the multi a-z are things that you know we consider",
    "start": "1102910",
    "end": "1108280"
  },
  {
    "text": "just sort of standard operating procedure if it's a production database we you should be mass and if it's a",
    "start": "1108280",
    "end": "1116049"
  },
  {
    "text": "production database you you really should be periodically take a logical you you want you don't want to just rely",
    "start": "1116049",
    "end": "1122380"
  },
  {
    "text": "on a single technology for backups this is just kind of this is sort of an age old philosophy kind of a thing it's it's",
    "start": "1122380",
    "end": "1129370"
  },
  {
    "text": "good to have sort of a backup for your backup so to speak so you just don't",
    "start": "1129370",
    "end": "1134860"
  },
  {
    "text": "rely on one technology have to so it would be okay by the way if you have you",
    "start": "1134860",
    "end": "1141850"
  },
  {
    "text": "know I mean like I would be okay if you have like logical replication or DMS or something like that I mean that that",
    "start": "1141850",
    "end": "1146919"
  },
  {
    "text": "also works as a second choice instead of logical exports although there's some differences there because logical",
    "start": "1146919",
    "end": "1152890"
  },
  {
    "text": "exports you know you grab a copy every day or every week and then you keep that for a while whereas with logical replication you've",
    "start": "1152890",
    "end": "1158590"
  },
  {
    "text": "only got the data as of right now so Ferguson again like we're back to like",
    "start": "1158590",
    "end": "1163690"
  },
  {
    "text": "if it's it's still a good practice though so the main point and the main takeaway is two things just don't just",
    "start": "1163690",
    "end": "1171010"
  },
  {
    "text": "rely on one technology to save your life when you need it have-have - all right with all of that",
    "start": "1171010",
    "end": "1179919"
  },
  {
    "text": "said I now want to jump into a deck I'm going to actually switch decks here to a",
    "start": "1179919",
    "end": "1185080"
  },
  {
    "text": "different one to talk about a little bit about database corruptions and this is",
    "start": "1185080",
    "end": "1190630"
  },
  {
    "text": "going to be specific to that we're going to talk about sort of generic Postgres and and some different corruptions and",
    "start": "1190630",
    "end": "1197710"
  },
  {
    "text": "generic Postgres so let's see here bring that over and",
    "start": "1197710",
    "end": "1205750"
  },
  {
    "text": "down and where is the button I want here",
    "start": "1205750",
    "end": "1212760"
  },
  {
    "text": "there we go all right database corruptions in Postgres fun stuff that's where the fun",
    "start": "1212760",
    "end": "1221380"
  },
  {
    "text": "really starts right whoops all right what kind of things can",
    "start": "1221380",
    "end": "1229240"
  },
  {
    "text": "be corrupted into the database pretty much anything right anything you've got in the database and so we've",
    "start": "1229240",
    "end": "1235600"
  },
  {
    "text": "listed a couple things out here so I mean tables and indexes are easy enough [Music] we haven't talked a lot about well so",
    "start": "1235600",
    "end": "1244840"
  },
  {
    "text": "the transaction log that's the wall the right ahead log is what that's talking about that was the old name for it we",
    "start": "1244840",
    "end": "1252309"
  },
  {
    "text": "haven't talked a lot about the commit log we I think we've mentioned it this week in class but we haven't gone in",
    "start": "1252309",
    "end": "1258100"
  },
  {
    "text": "depth yet we haven't I don't think talked about what toast is at all this week the catalog as well it really",
    "start": "1258100",
    "end": "1267309"
  },
  {
    "text": "anywhere in your database and and I would say that over the past couple of years working with RDS I I've seen",
    "start": "1267309",
    "end": "1279790"
  },
  {
    "text": "almost all of these at some point in time like like it does happen it does",
    "start": "1279790",
    "end": "1286000"
  },
  {
    "text": "happen so so how do you know when you have a corruption what does it look like well here's a couple examples of things",
    "start": "1286000",
    "end": "1292540"
  },
  {
    "text": "that you might see okay you might see something like invalid page header in",
    "start": "1292540",
    "end": "1299049"
  },
  {
    "text": "this block do we have one something else you might see there's not an example up here but",
    "start": "1299049",
    "end": "1305500"
  },
  {
    "text": "you might see something that says like invalid checksum one thing that in an RDS Postgres we don't allow you to turn",
    "start": "1305500",
    "end": "1312730"
  },
  {
    "text": "this off but Postgres will checksum your put a checksum on every block and so if even",
    "start": "1312730",
    "end": "1318730"
  },
  {
    "text": "like one little bit gets flipped it's it knows that because when it when it reads the block in is going to check the",
    "start": "1318730",
    "end": "1324340"
  },
  {
    "text": "checksum and it'll see that there it'll see something is wrong with this block and it'll immediately report an error",
    "start": "1324340",
    "end": "1331090"
  },
  {
    "text": "that happens other things like this this timestamp err this the PGX log that's",
    "start": "1331090",
    "end": "1337630"
  },
  {
    "text": "old that now should say PG wall starting in version 10 they renamed X log to wall",
    "start": "1337630",
    "end": "1343500"
  },
  {
    "text": "the reason for that was because it's a little bit more clear of what it is",
    "start": "1343500",
    "end": "1349770"
  },
  {
    "text": "could not access the status of transactions arrow that would be transact ID transaction logs this",
    "start": "1349770",
    "end": "1356920"
  },
  {
    "text": "unexpected chunk sighs oh man I remember seeing that and that's like an infuriating one that specifically has to",
    "start": "1356920",
    "end": "1363430"
  },
  {
    "text": "do with the toast tables when toast tables start getting messed up so these are the couple of the different things",
    "start": "1363430",
    "end": "1368830"
  },
  {
    "text": "that you you might see in a Postgres and and when we get to our lab section",
    "start": "1368830",
    "end": "1375190"
  },
  {
    "text": "hopefully you will see some of these too I hope everybody has a chance to try",
    "start": "1375190",
    "end": "1380650"
  },
  {
    "text": "some of this out what do you do when you see when you see a corruption this is your playbook right here okay the first",
    "start": "1380650",
    "end": "1388600"
  },
  {
    "text": "the first thing that you can do now this is specifically oriented toward if",
    "start": "1388600",
    "end": "1393640"
  },
  {
    "text": "you're running it and you kind of have full control of it yourself now if you if you're this is Postgres like in your",
    "start": "1393640",
    "end": "1400000"
  },
  {
    "text": "lab environment Postgres on me see to instance that your mat self-managing you",
    "start": "1400000",
    "end": "1405760"
  },
  {
    "text": "have the ability to sort of you want to kind of stop pause right sort of take a timeout so and this line number two take",
    "start": "1405760",
    "end": "1415120"
  },
  {
    "text": "a full backup one sort of general principle that's always good to keep in",
    "start": "1415120",
    "end": "1420760"
  },
  {
    "text": "mind really kind of in any crisis situation is to never delete anything i-i've really been surprised how often",
    "start": "1420760",
    "end": "1427810"
  },
  {
    "text": "I've sat down with people doing operations and working through and it's",
    "start": "1427810",
    "end": "1435030"
  },
  {
    "text": "it's it's it's for me it's just sort of like automatic like when I'm typing I'll always type move instead of delete move",
    "start": "1435030",
    "end": "1442180"
  },
  {
    "text": "instead of remove like just move a file out or rename it and I'll come back later and clean up but you know it's",
    "start": "1442180",
    "end": "1448780"
  },
  {
    "text": "something you always want to kind of keep in mind is is don't delete anything now as far as you're able to if you have",
    "start": "1448780",
    "end": "1457660"
  },
  {
    "text": "a disk space situation where you have to clear out some space on the disk then what you want to do is if possible copy",
    "start": "1457660",
    "end": "1463840"
  },
  {
    "text": "things off before you get rid of them but the last thing that you want to do is get",
    "start": "1463840",
    "end": "1468970"
  },
  {
    "text": "yourself in a situation where you've made it worse and you can't go backwards so the next thing sort of yes he says",
    "start": "1468970",
    "end": "1477850"
  },
  {
    "text": "here on this slide for the ec2 we say restore from a previous backup if possible so the first thing that you can",
    "start": "1477850",
    "end": "1484150"
  },
  {
    "text": "look at the first thing you can look at is like can I just recover use the",
    "start": "1484150",
    "end": "1489190"
  },
  {
    "text": "backup to get back where I wasn't me to go and fix it that way and in the context of RDS what that's going to mean",
    "start": "1489190",
    "end": "1495730"
  },
  {
    "text": "and I'll have this on a slide another slide later that's more RDS specific and the context of RDS what that means is",
    "start": "1495730",
    "end": "1501400"
  },
  {
    "text": "the first thing you're gonna do is think about is go look at you know what snapshots do you have and an RDS you",
    "start": "1501400",
    "end": "1507760"
  },
  {
    "text": "just you start clicking buttons and you just say you know let's just do restore so you know spin up restore the snapshot",
    "start": "1507760",
    "end": "1513370"
  },
  {
    "text": "to a point in time restore and just see see if that works and then at the bottom",
    "start": "1513370",
    "end": "1520809"
  },
  {
    "text": "there they have diagnosed further if a backup is not available now the reason I",
    "start": "1520809",
    "end": "1528429"
  },
  {
    "text": "say see if it works is because you know we talked about a lot of different types of corruptions so there's an awful lot",
    "start": "1528429",
    "end": "1536020"
  },
  {
    "text": "that depends on what kind of corruption you're running into and where it is and so I we've seen things all over the map",
    "start": "1536020",
    "end": "1544210"
  },
  {
    "text": "when it comes to like just bugs and Postgres that can cause a corruption just over many years right well you know",
    "start": "1544210",
    "end": "1551679"
  },
  {
    "text": "actually and I'll let me dig into that in a couple of minutes but let me keep moving through these first so logical",
    "start": "1551679",
    "end": "1559900"
  },
  {
    "text": "exports are the next sort of level an important tool I if you're not able to",
    "start": "1559900",
    "end": "1565390"
  },
  {
    "text": "if you're and I've been in these situations before with Postgres where if you're not able if the backup and if the",
    "start": "1565390",
    "end": "1571900"
  },
  {
    "text": "restore is not an option if you're not able to use the backup to get back up and running and get your data back online then you might be in a situation",
    "start": "1571900",
    "end": "1578980"
  },
  {
    "text": "where you need to sort of pull as much useable data out of a database as possible and try to work with that so",
    "start": "1578980",
    "end": "1585850"
  },
  {
    "text": "we're just talking about sort of steps try to get out of pain right now so pg dump you can give that a try that",
    "start": "1585850",
    "end": "1593110"
  },
  {
    "text": "it's an advantage to try to dump the entire database sometimes actually I would say off",
    "start": "1593110",
    "end": "1598630"
  },
  {
    "text": "if you see an error message something",
    "start": "1598630",
    "end": "1603820"
  },
  {
    "text": "caused a corruption so you what will happen is you try to access some particular row and then you trigger an",
    "start": "1603820",
    "end": "1609820"
  },
  {
    "text": "error message you to access that row right because maybe that row is in a block and the block is messed up maybe",
    "start": "1609820",
    "end": "1616059"
  },
  {
    "text": "there's an index that's messed up but that's quite possibly not the only corruption because cuz there had to be a",
    "start": "1616059",
    "end": "1622870"
  },
  {
    "text": "bug somewhere some unique set of circumstances that's very you know uncommon or unusual that somehow you you",
    "start": "1622870",
    "end": "1629649"
  },
  {
    "text": "know a situation came about or that bug was triggered and if it happened once it's quite possible that it could have",
    "start": "1629649",
    "end": "1634690"
  },
  {
    "text": "happened more than once so a big advantage of something like just immediate you know sort of immediately",
    "start": "1634690",
    "end": "1639700"
  },
  {
    "text": "starting to look remember we've taken a backup the first thing that you do is you get that backup in the context of",
    "start": "1639700",
    "end": "1646629"
  },
  {
    "text": "RDS you can even kick off a snapshot that would always be the right thing to do in RDS like if something is wrong",
    "start": "1646629",
    "end": "1653740"
  },
  {
    "text": "snapshot now right first thing run a snapshot that's something you can pass",
    "start": "1653740",
    "end": "1659889"
  },
  {
    "text": "along as well if you know just if somebody's worried first thing just tell them you know just run a snapshot right",
    "start": "1659889",
    "end": "1665080"
  },
  {
    "text": "now just it keeps you safe something to think about is that some corruptions are",
    "start": "1665080",
    "end": "1671230"
  },
  {
    "text": "some problems can be in the wall stream I've absolutely seen those I've seen",
    "start": "1671230",
    "end": "1676570"
  },
  {
    "text": "issues where there's like a problem on the disk and then if I take my snapshot",
    "start": "1676570",
    "end": "1681700"
  },
  {
    "text": "and i replay my redo logs it replays the problem like it actually can recalls the same issue so you can't always even rely",
    "start": "1681700",
    "end": "1690970"
  },
  {
    "text": "on you know it just totally depends on what you're running into on whether the point in time recovery most of the time",
    "start": "1690970",
    "end": "1697360"
  },
  {
    "text": "point in time recovery works but maybe you ran into something that's embedded in the wall stream right so that's that",
    "start": "1697360",
    "end": "1704860"
  },
  {
    "text": "that's one reason to grab the snapshot guy out of the backup once we've done that we can always go back to that",
    "start": "1704860",
    "end": "1711340"
  },
  {
    "text": "snapshot and that's another thing to like when you grab a snapshot in RDS you don't need to do any wall replay to",
    "start": "1711340",
    "end": "1719379"
  },
  {
    "text": "restore that snapshot that's really important that once you grab that snapshot you can now go to that point in",
    "start": "1719379",
    "end": "1726639"
  },
  {
    "text": "time and you don't have to rely on the replay so you don't have to worry about if there's a bug or an issue related to",
    "start": "1726639",
    "end": "1731740"
  },
  {
    "text": "the it's another reason to grab the snapshot right away once that's out of the way we can start to look a little closer so we",
    "start": "1731740",
    "end": "1737260"
  },
  {
    "text": "can do things like trying trying the PG dump and just seeing if it triggers or",
    "start": "1737260",
    "end": "1742300"
  },
  {
    "text": "if it unearths more problems in the database so we know what's the state of the world right if we don't run into any",
    "start": "1742300",
    "end": "1750130"
  },
  {
    "text": "problems it is entirely possible that you could hit you know and get an error",
    "start": "1750130",
    "end": "1755260"
  },
  {
    "text": "message on a block right but that could",
    "start": "1755260",
    "end": "1760600"
  },
  {
    "text": "be on here well here's actually something I've seen before that like I got an error message trying to read a",
    "start": "1760600",
    "end": "1765670"
  },
  {
    "text": "row but the row had been deleted and my transaction could still see it right what that means is when I run a PG dump",
    "start": "1765670",
    "end": "1773980"
  },
  {
    "text": "it's going to work fine because the PG dump doesn't need that row does that make sense because my transaction",
    "start": "1773980",
    "end": "1779980"
  },
  {
    "text": "started like 30 minutes ago so he still needs to see the dead records but when",
    "start": "1779980",
    "end": "1785170"
  },
  {
    "text": "you run the PG dump the PG dump is running right now so it'll it can ignore that row and the PG dump might just be",
    "start": "1785170",
    "end": "1790780"
  },
  {
    "text": "totally fine and if you're able to do that well you've just you've got your data now right it's out so you can move",
    "start": "1790780",
    "end": "1797020"
  },
  {
    "text": "on with that one of the more common types of corruption is index corruptions",
    "start": "1797020",
    "end": "1804330"
  },
  {
    "text": "index corruptions right the great thing about index corruptions that indexes are",
    "start": "1804330",
    "end": "1809560"
  },
  {
    "text": "a secondary data structure so the thing with the next corruptions is that you can always drop and rebuild the index as",
    "start": "1809560",
    "end": "1816220"
  },
  {
    "text": "long as there's no issues on the table this and this is something that we see pretty frequently that we in fact I was",
    "start": "1816220",
    "end": "1821830"
  },
  {
    "text": "just looking at tickets this week were where this has happened page corruption",
    "start": "1821830",
    "end": "1831690"
  },
  {
    "text": "so so page corruption now we're talking about once we get down into into the",
    "start": "1831690",
    "end": "1836710"
  },
  {
    "text": "tables and the one useful thing in the",
    "start": "1836710",
    "end": "1842440"
  },
  {
    "text": "system this is also something I've used before in the past is that there's this is called a developer option this is not",
    "start": "1842440",
    "end": "1849460"
  },
  {
    "text": "something that customers can set an RDS Postgres but there is an option to the database called zero damaged pages and",
    "start": "1849460",
    "end": "1855630"
  },
  {
    "text": "what what you can do with Postgres is you can shut down the database set this",
    "start": "1855630",
    "end": "1860860"
  },
  {
    "text": "option and then start the database up actually I don't think you even need to shut it down I just learned that Reese",
    "start": "1860860",
    "end": "1866080"
  },
  {
    "text": "I think you can actually set it you might be upset that right in a session once you turn this flag on if Postgres",
    "start": "1866080",
    "end": "1874360"
  },
  {
    "text": "tries to read a page that has like a checksum failure or is damaged in some other way",
    "start": "1874360",
    "end": "1879400"
  },
  {
    "text": "what Postgres can actually do is just just zero that page out as like an empty",
    "start": "1879400",
    "end": "1885160"
  },
  {
    "text": "page and what that can enable in this note is very important you could lose data if you do that with",
    "start": "1885160",
    "end": "1890620"
  },
  {
    "text": "a table right so if you do a table the advantage the thing is like so if you do",
    "start": "1890620",
    "end": "1895810"
  },
  {
    "text": "with an index that doesn't necessarily you're gonna have to rebuild the index because you're now missing like links",
    "start": "1895810",
    "end": "1902020"
  },
  {
    "text": "right between like if you know if that was like a leaf node now you're not you've lost links to a whole bunch of",
    "start": "1902020",
    "end": "1907180"
  },
  {
    "text": "sorry if that was a branching node you've lost links to a bunch of your",
    "start": "1907180",
    "end": "1913150"
  },
  {
    "text": "your leaf nodes but like in a heap structure in a table it's just the",
    "start": "1913150",
    "end": "1918730"
  },
  {
    "text": "blocks aren't interconnected so you can 0 will block out and it just means that whatever rows were in that block are",
    "start": "1918730",
    "end": "1924310"
  },
  {
    "text": "lost but the rest of the table is now fine and now you don't have the error anymore so that's an option that can be",
    "start": "1924310",
    "end": "1931480"
  },
  {
    "text": "used to get out of trouble yeah I once used that specifically with with a",
    "start": "1931480",
    "end": "1937300"
  },
  {
    "text": "customer who who had some issued with some damaged pages and we were in the",
    "start": "1937300",
    "end": "1943270"
  },
  {
    "text": "end able to pull out we pulled out everything we could there were just a handful of pages we had them validate",
    "start": "1943270",
    "end": "1949990"
  },
  {
    "text": "the data and and it turned out that they didn't lose any any important data from their table at all this is an example of",
    "start": "1949990",
    "end": "1960520"
  },
  {
    "text": "what that might look like right so here you see that we did a select count star",
    "start": "1960520",
    "end": "1966430"
  },
  {
    "text": "and the select count star worked fine but then when we did a select star it failed so the count star I didn't set",
    "start": "1966430",
    "end": "1975580"
  },
  {
    "text": "this test up but what it looks to me like is that that's probably using an index right and that's why you don't get",
    "start": "1975580",
    "end": "1982000"
  },
  {
    "text": "an error there but when you do the Select star that actually has to go down and read the blocks of the table because",
    "start": "1982000",
    "end": "1987370"
  },
  {
    "text": "now we're asking for all the columns not just the columns and the index so the",
    "start": "1987370",
    "end": "1992560"
  },
  {
    "text": "error message will look something like this and see how it's telling you the block number and it's telling you the",
    "start": "1992560",
    "end": "1997840"
  },
  {
    "text": "the relation number the sorry the relation path so this is actually a path to a filename and we",
    "start": "1997840",
    "end": "2004110"
  },
  {
    "text": "haven't dug into this a ton but there's two numbers in here the first number identifies which database you're in",
    "start": "2004110",
    "end": "2010320"
  },
  {
    "text": "remember how in Postgres you can have multiple databases and the second number is Scott demonstrated this during our",
    "start": "2010320",
    "end": "2016530"
  },
  {
    "text": "lab session the other day when he showed how that was the OID not the OID the file node which starts out as the OID",
    "start": "2016530",
    "end": "2023850"
  },
  {
    "text": "but he was showing how when you do a table right the file node will change but the OID always stays the same so",
    "start": "2023850",
    "end": "2030750"
  },
  {
    "text": "that's what that is it's just a number that identifies the name of the file where the data is stored here's an",
    "start": "2030750",
    "end": "2039240"
  },
  {
    "text": "example of recovering that page corruption we set the zero damaged pages on it is sessions edible I was right",
    "start": "2039240",
    "end": "2044850"
  },
  {
    "text": "about that and then you just run the Select statement again and you see what happens in the log messages it tells you",
    "start": "2044850",
    "end": "2050760"
  },
  {
    "text": "that I hit an error and I'm zeroing out the page okay after you've done that the",
    "start": "2050760",
    "end": "2062040"
  },
  {
    "text": "next thing that we'll do is make a new copy of the table and we'll copy the",
    "start": "2062040",
    "end": "2067110"
  },
  {
    "text": "data out and this is where now in this case we don't need to use the PG dump we're just doing a create table to",
    "start": "2067110",
    "end": "2073560"
  },
  {
    "text": "select which is also fine because we're not planning to move to a new database we just want to get rid of this one file",
    "start": "2073560",
    "end": "2080780"
  },
  {
    "text": "that is always a good policy to do like if you've had corruptions at a table",
    "start": "2080780",
    "end": "2086540"
  },
  {
    "text": "it's a very good idea to just kind of start clean like get a clean a new clean",
    "start": "2086540",
    "end": "2091560"
  },
  {
    "text": "table setup move the data into that clean new table and then just delete the old stuff just a good hygiene kind of",
    "start": "2091560",
    "end": "2098640"
  },
  {
    "text": "thing here all right transaction log corruption what does that look like here's a couple of different error",
    "start": "2098640",
    "end": "2105090"
  },
  {
    "text": "messages that will indicate to you that you're seeing transaction log corruption",
    "start": "2105090",
    "end": "2111350"
  },
  {
    "text": "here's an example where we reset the",
    "start": "2111350",
    "end": "2117600"
  },
  {
    "text": "transaction log and then we start up the database and let's see what happens there oh no I'm sorry that's an example",
    "start": "2117600",
    "end": "2125970"
  },
  {
    "text": "of trying to how you can fix the transaction log corruption so the reason for that",
    "start": "2125970",
    "end": "2132540"
  },
  {
    "text": "is that that will the PG reset X log - f",
    "start": "2132540",
    "end": "2139530"
  },
  {
    "text": "you know I need to double-check the man page on that that's doing what I think it is before I before I say it I'll",
    "start": "2139530",
    "end": "2145590"
  },
  {
    "text": "circle back to that in a minute okay I'm going to skip over these lab exercises for now and we'll get into our",
    "start": "2145590",
    "end": "2152220"
  },
  {
    "text": "second session section tied into that which is a debugging section all right",
    "start": "2152220",
    "end": "2158130"
  },
  {
    "text": "tools that you have for debugging Postgres and for starting to dig job",
    "start": "2158130",
    "end": "2163530"
  },
  {
    "text": "number one is don't lose your data I was emphasizing that and we'll start there once you're out of pain then you can",
    "start": "2163530",
    "end": "2170370"
  },
  {
    "text": "start thinking about trying to figure out what was going on right finding your root cause so at that point in time you",
    "start": "2170370",
    "end": "2178500"
  },
  {
    "text": "know so we've recovered our database fits back up and running the other thing would be cut you know you've cut your",
    "start": "2178500",
    "end": "2184350"
  },
  {
    "text": "new backup right as soon as you're up you you cut another backup these are kind of basic 101 kind of database",
    "start": "2184350",
    "end": "2190440"
  },
  {
    "text": "management things and at this point of time we can now start trying to do some debugging and see if we can figure out what's going on so some of the tools",
    "start": "2190440",
    "end": "2196740"
  },
  {
    "text": "that we've got in Postgres first of all Postgres has an insane amount of logging",
    "start": "2196740",
    "end": "2202470"
  },
  {
    "text": "that it can do and this is this is session settable so you've got the the",
    "start": "2202470",
    "end": "2208980"
  },
  {
    "text": "basic logging parameters they were kind of like UNIX logging where you have like there's like seven different logging",
    "start": "2208980",
    "end": "2214380"
  },
  {
    "text": "levels and you what we're gonna do here is set it down to debug five and then take a look at the amount of this is how",
    "start": "2214380",
    "end": "2221520"
  },
  {
    "text": "much log data you start getting dumped out when you set the debug level down so you can see it's just it's dumping a ton",
    "start": "2221520",
    "end": "2227910"
  },
  {
    "text": "of data out so that's that's level one the way that you do logging in Postgres is you're going to look at this",
    "start": "2227910",
    "end": "2234090"
  },
  {
    "text": "parameter here that says log min messages there's also a there's a like a",
    "start": "2234090",
    "end": "2242340"
  },
  {
    "text": "log client min messages the word client isn't and that will control what how many messages are actually coming out to",
    "start": "2242340",
    "end": "2249210"
  },
  {
    "text": "your terminal that you're seeing so that's that's a useful one to watch for as well then we have some debug messages",
    "start": "2249210",
    "end": "2257940"
  },
  {
    "text": "which are shown at the bottom and oh okay this is still showing some of the",
    "start": "2257940",
    "end": "2263100"
  },
  {
    "text": "some of the verbose logging that you can get this is showing a plan and you can see the level of detail that",
    "start": "2263100",
    "end": "2268660"
  },
  {
    "text": "you can get out of that right right and",
    "start": "2268660",
    "end": "2276190"
  },
  {
    "text": "we don't have an example of the other ones that I was hoping for single user",
    "start": "2276190",
    "end": "2281380"
  },
  {
    "text": "mode a single user mode is a special startup mode for a Postgres database",
    "start": "2281380",
    "end": "2287109"
  },
  {
    "text": "this is this is something that you would this is something you would use on ec2",
    "start": "2287109",
    "end": "2292690"
  },
  {
    "text": "or self managed in the RDS ecosystem and the in the aurora ecosystem this is",
    "start": "2292690",
    "end": "2298839"
  },
  {
    "text": "something that the service team would use in a crisis right but it's not something that is exposed to customers",
    "start": "2298839",
    "end": "2305069"
  },
  {
    "text": "but it's important right so this the",
    "start": "2305069",
    "end": "2310569"
  },
  {
    "text": "single user mode is actually I think some other databases have similar concepts it's it's where it starts the",
    "start": "2310569",
    "end": "2316269"
  },
  {
    "text": "database up in a special mode where where no other connections are allowed which gives you the ability to do some",
    "start": "2316269",
    "end": "2323019"
  },
  {
    "text": "really some important administrative operations that you wouldn't otherwise do you can use it to repair damage the",
    "start": "2323019",
    "end": "2330369"
  },
  {
    "text": "system catalogues it is it is not P",
    "start": "2330369",
    "end": "2335799"
  },
  {
    "text": "sequel the thing actually that I always remember this for single user mode is also what you have to do if you get into",
    "start": "2335799",
    "end": "2342009"
  },
  {
    "text": "a wraparound situation so we talked about transaction ID wrap around a few times is that 32-bit identifier if you",
    "start": "2342009",
    "end": "2349119"
  },
  {
    "text": "run out of transaction IDs you get up to 2 billion and you hit that point then what what you generally have to do at",
    "start": "2349119",
    "end": "2355539"
  },
  {
    "text": "that point is somebody has to go attach and send a user mode and run a vacuum because the database will stop running",
    "start": "2355539",
    "end": "2361900"
  },
  {
    "text": "it just it has to stop to avoid corrupting the data where do I go okay",
    "start": "2361900",
    "end": "2372339"
  },
  {
    "text": "here we are here's an example of what that would look like you put the - - single up at the top and that starts it",
    "start": "2372339",
    "end": "2379059"
  },
  {
    "text": "up in a single user mode and then you can see here that they were looking at well this is just a query on the catalog",
    "start": "2379059",
    "end": "2386140"
  },
  {
    "text": "view because this is in this case this is how you would address problems with",
    "start": "2386140",
    "end": "2391299"
  },
  {
    "text": "the with the catalogs the global the global catalogs some of the catalog",
    "start": "2391299",
    "end": "2397210"
  },
  {
    "text": "views are interesting too because they are so remember I showed",
    "start": "2397210",
    "end": "2402639"
  },
  {
    "text": "you the pathname I highlighted that a few slides back to the table and it had the database directory and then it had a",
    "start": "2402639",
    "end": "2408999"
  },
  {
    "text": "number for identifying the object there is a special database directory just for",
    "start": "2408999",
    "end": "2414609"
  },
  {
    "text": "the global the global catalogs and metadata so you have a couple of there's",
    "start": "2414609",
    "end": "2422199"
  },
  {
    "text": "just a couple of these but there are things like your PG database you know that's a global view your users and your",
    "start": "2422199",
    "end": "2428409"
  },
  {
    "text": "roles your security privileges for for like at a user level this much of that",
    "start": "2428409",
    "end": "2436779"
  },
  {
    "text": "is global level thing so those are stored in a special area on your disk and again so any issues that you ran",
    "start": "2436779",
    "end": "2445899"
  },
  {
    "text": "into in the in the catalog you would use single user mode to address them stack",
    "start": "2445899",
    "end": "2451809"
  },
  {
    "text": "traces probably familiar with these this is I won't stay here for long because",
    "start": "2451809",
    "end": "2457419"
  },
  {
    "text": "this is just kind of stuff that we've probably all seen before here we they're using G so you got like P stack is one",
    "start": "2457419",
    "end": "2464109"
  },
  {
    "text": "tool that can do it gdb is M tool you can do BT for back trace inside of gdb you know what they",
    "start": "2464109",
    "end": "2471189"
  },
  {
    "text": "don't mention in here my favorite tool for getting stack traces is perf by far",
    "start": "2471189",
    "end": "2477239"
  },
  {
    "text": "in fact they didn't have per fond the slides in here but perf can do a lot a",
    "start": "2477239",
    "end": "2482499"
  },
  {
    "text": "lot they can really do a lot it conduced it can do profiling I can do this so you",
    "start": "2482499",
    "end": "2488619"
  },
  {
    "text": "can kind of gather stack traces the other really cool thing that perf does that not a lot of I haven't seen many",
    "start": "2488619",
    "end": "2494469"
  },
  {
    "text": "people use it but it's super useful is that you can you can put custom probes you can insert custom probes on any",
    "start": "2494469",
    "end": "2500469"
  },
  {
    "text": "function and your any function in your binary and then every time that phone",
    "start": "2500469",
    "end": "2505899"
  },
  {
    "text": "that probe gets crossed it can emit a log message so basically you can put trace points and it's it's not as like",
    "start": "2505899",
    "end": "2512889"
  },
  {
    "text": "sophisticated as D traces although they're they're actually continually enhancing while BPF is kind of the new",
    "start": "2512889",
    "end": "2520779"
  },
  {
    "text": "thing but that's closely related to perf so read about perf sometime it's a great",
    "start": "2520779",
    "end": "2526029"
  },
  {
    "text": "tool and it can also do things like this again a stack trace I've read so many of these the the Postgres stack traces I",
    "start": "2526029",
    "end": "2533710"
  },
  {
    "text": "I think are fairly readable let me just walk through this real quick so let's what's this guy doing so if we look at",
    "start": "2533710",
    "end": "2540220"
  },
  {
    "text": "the stack trace we'll see there's the most grass main is the main loop portal",
    "start": "2540220",
    "end": "2546220"
  },
  {
    "text": "run a portal is think of that a little bit like a connection or a session",
    "start": "2546220",
    "end": "2551740"
  },
  {
    "text": "inside of the database it's or connected with a statement all right and in this case we're running a select statement is",
    "start": "2551740",
    "end": "2559300"
  },
  {
    "text": "what we're doing here so then in order to run it we do the execute so remember we talked about",
    "start": "2559300",
    "end": "2565210"
  },
  {
    "text": "phases of processing sequel there was the parsing the planning the rules",
    "start": "2565210",
    "end": "2570400"
  },
  {
    "text": "engine the executing it and this tells us we're in the execution phase right there and then as we go up now as you'll",
    "start": "2570400",
    "end": "2578140"
  },
  {
    "text": "see these things to talk about nodes like this exit proc node a node means",
    "start": "2578140",
    "end": "2584230"
  },
  {
    "text": "like one element of the the execution plan and then underneath that it tells you what kind of note it is it's a scan",
    "start": "2584230",
    "end": "2590830"
  },
  {
    "text": "so we're running a scan and then executes a projection project is a projection means choosing which columns",
    "start": "2590830",
    "end": "2598150"
  },
  {
    "text": "I need to get back there's a function and then there's a PG sleep so this is",
    "start": "2598150",
    "end": "2603400"
  },
  {
    "text": "run a function and that's what the function actually is so it looks like this is doing a select PG sleep let's go",
    "start": "2603400",
    "end": "2609100"
  },
  {
    "text": "back and see what they did select PG sleep one from generate series",
    "start": "2609100",
    "end": "2615130"
  },
  {
    "text": "that's that that's the query to 6 to 6 and that's what it ended up looking like",
    "start": "2615130",
    "end": "2622210"
  },
  {
    "text": "right there last but not least core",
    "start": "2622210",
    "end": "2628900"
  },
  {
    "text": "dumps core dumps are turned off by default that is also well that's also",
    "start": "2628900",
    "end": "2636130"
  },
  {
    "text": "true and RDS Postgres we're not courting up the disk with core dumps all the time by default however they are very useful",
    "start": "2636130",
    "end": "2644080"
  },
  {
    "text": "and very important when you have a problem that you're trying to find and especially especially if like you know",
    "start": "2644080",
    "end": "2649540"
  },
  {
    "text": "that you're a going to be able to generate a crash right like flip on coordinates generate the crash you'll get the dump you can load up a core dump",
    "start": "2649540",
    "end": "2656950"
  },
  {
    "text": "with gdb see we have a so here's we built the example function all right",
    "start": "2656950",
    "end": "2663790"
  },
  {
    "text": "then they run the function so this is kind of neat they built a function that there actually loading into the database does",
    "start": "2663790",
    "end": "2670330"
  },
  {
    "text": "the PG function info means as a Postgres function and then so it's called forced",
    "start": "2670330",
    "end": "2675910"
  },
  {
    "text": "dump core they loaded it so they could just run it with a sequel query so now I just do a select force core dump and",
    "start": "2675910",
    "end": "2681880"
  },
  {
    "text": "what happens is you get this is all the error messages you get when a court up happens actually and this is another",
    "start": "2681880",
    "end": "2688570"
  },
  {
    "text": "thing that I've certainly seen before in the world of RDS this server closed the",
    "start": "2688570",
    "end": "2694840"
  },
  {
    "text": "connection unexpectedly as an example of that there was maybe like seven months",
    "start": "2694840",
    "end": "2702580"
  },
  {
    "text": "ago sometime last year I remember there was a bug in PG hint plan and I read the",
    "start": "2702580",
    "end": "2710710"
  },
  {
    "text": "description I was never able to actually reproduce the bug but somebody was because they fixed it and I read the",
    "start": "2710710",
    "end": "2716920"
  },
  {
    "text": "description of the fix but it had something you had to get like some very specific combination of prepared",
    "start": "2716920",
    "end": "2722560"
  },
  {
    "text": "statements and vine variables and in the write executions and you can get into a",
    "start": "2722560",
    "end": "2728170"
  },
  {
    "text": "thing where PG hit plan tried to dereference a null pointer basically and seg faulted so this is exactly what you",
    "start": "2728170",
    "end": "2736000"
  },
  {
    "text": "would see because what happen is is trying to process a query and the process of doing the play like the planning or the execution whichever one",
    "start": "2736000",
    "end": "2742720"
  },
  {
    "text": "it was it calls the code for PG hit plan and PG hint plan would get this",
    "start": "2742720",
    "end": "2748090"
  },
  {
    "text": "segmentation fault and the whole thing just the whole thing crashes at that point it's not able to recover it and so",
    "start": "2748090",
    "end": "2755590"
  },
  {
    "text": "the this is what this is what I saw tell me until the patch came in and the patch",
    "start": "2755590",
    "end": "2761920"
  },
  {
    "text": "was deployed across the fleet we saw something like this",
    "start": "2761920",
    "end": "2767160"
  },
  {
    "text": "things to watch for so you know what you're looking at it tells you the other",
    "start": "2769640",
    "end": "2776090"
  },
  {
    "text": "thing to be aware of is that in Postgres",
    "start": "2776090",
    "end": "2781960"
  },
  {
    "text": "in Aurora Postgres in particular there are many many situations where if you're",
    "start": "2781960",
    "end": "2789470"
  },
  {
    "text": "back into crashes it will cause the whole Postgres system to restart the",
    "start": "2789470",
    "end": "2795530"
  },
  {
    "text": "reason for that is that it all depends where the crash happens if the process crashes in a section of code that has",
    "start": "2795530",
    "end": "2803240"
  },
  {
    "text": "been designated as what is called a critical section which is a good bit of the code and it for some reason crashes",
    "start": "2803240",
    "end": "2810230"
  },
  {
    "text": "I feel like they like to happen in the critical places I don't know Murphy's Law or something if it's in a",
    "start": "2810230",
    "end": "2817220"
  },
  {
    "text": "critical section what that means is that we can't guarantee the state of memory after the crash happens and so in the",
    "start": "2817220",
    "end": "2826130"
  },
  {
    "text": "absence of having any way to really make sure that there isn't like a memory corruption the safest thing to do in",
    "start": "2826130",
    "end": "2831890"
  },
  {
    "text": "that circumstance is just to like just just restart the Postgres processes it goes very quick it's just you know shut",
    "start": "2831890",
    "end": "2836990"
  },
  {
    "text": "down start up for the processes you know grant talks about an Aurora you have survivable buffer cache so we don't even",
    "start": "2836990",
    "end": "2842990"
  },
  {
    "text": "lose our cache it's all still there in memory it really is just a quick process bounce but you'll notice it when it",
    "start": "2842990",
    "end": "2850370"
  },
  {
    "text": "happens because everybody will have to reconnect pulling it into gdb just like",
    "start": "2850370",
    "end": "2859330"
  },
  {
    "text": "I was saying if you're not familiar with this it's it's pretty cool like how",
    "start": "2859330",
    "end": "2865430"
  },
  {
    "text": "capable or just how powerful these tools are and I guess one other thing that I",
    "start": "2865430",
    "end": "2871760"
  },
  {
    "text": "would point out too is don't think that just because you're on RDS this stuff is irrelevant to you because it's not at",
    "start": "2871760",
    "end": "2878240"
  },
  {
    "text": "all like the PG hit plan bug that I was just talking about that was a bug in PG head plan you can I think that it can be",
    "start": "2878240",
    "end": "2886520"
  },
  {
    "text": "very useful for anybody any customer who's running an RDS I think it's very useful to have a playground in ec2 you",
    "start": "2886520",
    "end": "2894800"
  },
  {
    "text": "know have a sandbox environment have some Postgres code on ec2 box that you can really go poke around at where you",
    "start": "2894800",
    "end": "2901160"
  },
  {
    "text": "can do things like this you can you can attach a debugger you can do perf you know it doesn't actually",
    "start": "2901160",
    "end": "2907310"
  },
  {
    "text": "your production system but but it's really good to have a sandbox and reproduce things RDS Postgres is you",
    "start": "2907310",
    "end": "2915290"
  },
  {
    "text": "know with the exception of kind of some security oriented things you know the only changes are the bare minimum that",
    "start": "2915290",
    "end": "2921350"
  },
  {
    "text": "is required for us to run it as a service other than that it is just the community Postgres code alright and then",
    "start": "2921350",
    "end": "2931640"
  },
  {
    "text": "we had some a lab exercise at the end so that's that's that's my corruption deck",
    "start": "2931640",
    "end": "2937670"
  },
  {
    "text": "there which is talking about community Postgres but now let's come back and",
    "start": "2937670",
    "end": "2945290"
  },
  {
    "text": "talk a little bit more about specifically in RDS so I want to",
    "start": "2945290",
    "end": "2952040"
  },
  {
    "text": "highlight now I'm going to come back and just reiterate a couple of the important strategies a little bit of this is stuff",
    "start": "2952040",
    "end": "2958190"
  },
  {
    "text": "that I said a moment ago it's a guy named Paul Valle",
    "start": "2958190",
    "end": "2963830"
  },
  {
    "text": "he runs a company called Pythian they're based out of Ottawa up in Canada and",
    "start": "2963830",
    "end": "2970190"
  },
  {
    "text": "Paul read a book called the checklist manifesto and he was that that book is",
    "start": "2970190",
    "end": "2976880"
  },
  {
    "text": "about the importance of checklists in in in disciplines were like reliability and",
    "start": "2976880",
    "end": "2983270"
  },
  {
    "text": "safety is really important and the author of that book of the checklist manifesto like talks about aerospace",
    "start": "2983270",
    "end": "2988760"
  },
  {
    "text": "industry he talks about he looks at construction he looks at a whole bunch",
    "start": "2988760",
    "end": "2993950"
  },
  {
    "text": "of places and just talks about the importance of checklist right Paul got",
    "start": "2993950",
    "end": "2999109"
  },
  {
    "text": "really inspired and Paul runs a managed services company that does an awful lot",
    "start": "2999109",
    "end": "3004510"
  },
  {
    "text": "of database administration and so up holded running that company was he",
    "start": "3004510",
    "end": "3009550"
  },
  {
    "text": "decide he want to come up with a checklist for his DBAs and he came up with fit a sir and I've just been a fan",
    "start": "3009550",
    "end": "3015820"
  },
  {
    "text": "of this ever since I first heard about it but and this just reinforces what",
    "start": "3015820",
    "end": "3023290"
  },
  {
    "text": "I've been saying that like if you get into a crisis if you get when you're when you see a corruption or you have an",
    "start": "3023290",
    "end": "3030220"
  },
  {
    "text": "outage first thing you do is you slow down and you focus and then you can you",
    "start": "3030220",
    "end": "3036460"
  },
  {
    "text": "know I like this checklist it kind of walks through the things that you should do having the second pair of eyes look over your shoulder before you press the Enter key",
    "start": "3036460",
    "end": "3042580"
  },
  {
    "text": "on any really critical command this is something that I do as a regular practice and I don't think I don't think",
    "start": "3042580",
    "end": "3051100"
  },
  {
    "text": "that there's any level I'll ever get to where I would not want if anything like just the more that I the longer that I'm",
    "start": "3051100",
    "end": "3058720"
  },
  {
    "text": "in the industry the more that I realize how essential it is to have that second pair of eyes look over my shoulder no",
    "start": "3058720",
    "end": "3063970"
  },
  {
    "text": "matter how confident I am that I'm about to do the right thing if it's you know when you're in a high-pressure situation",
    "start": "3063970",
    "end": "3070050"
  },
  {
    "text": "it's just it's always good you know just hey I'm about to hit enter you know I I",
    "start": "3070050",
    "end": "3076210"
  },
  {
    "text": "mean not necessarily you don't have to do it when you're typing LS right I mean the point is like okay I'm about to like",
    "start": "3076210",
    "end": "3081850"
  },
  {
    "text": "copy the files you know I'm about to shut down the database I'm about to",
    "start": "3081850",
    "end": "3086980"
  },
  {
    "text": "start up the database you know just there's a second there's kind of a CEO and and I've even done this to like you",
    "start": "3086980",
    "end": "3093310"
  },
  {
    "text": "know it's if I'm working from home you know or if it's it you know it could be",
    "start": "3093310",
    "end": "3098650"
  },
  {
    "text": "the weekend and I got paged like you know usually there's a chime bridge you know a bridge that's open so I'm still",
    "start": "3098650",
    "end": "3104920"
  },
  {
    "text": "you know able to do that sort of thing and we'll even do screen shares like if there's another one of the on-call people will will set up a screen share",
    "start": "3104920",
    "end": "3111940"
  },
  {
    "text": "so if somebody can just kind of like see what I'm and I'll just put my stuff right on the screen share just you know do my work right there so that you know",
    "start": "3111940",
    "end": "3119140"
  },
  {
    "text": "one or two other engineers are able to when they're looking they can look and then I can just kind of shout out on the",
    "start": "3119140",
    "end": "3124780"
  },
  {
    "text": "bridge line if I'm about to do something important just hey somebody take a quick look I got you know just sanity check",
    "start": "3124780",
    "end": "3131860"
  },
  {
    "text": "this for me I'm not not it's not doing this at the wrong time or anything like that so this is where I want to circle",
    "start": "3131860",
    "end": "3140470"
  },
  {
    "text": "back real quickly and talk about the importance of the tactical importance of knowing the RDS architecture so the real",
    "start": "3140470",
    "end": "3148120"
  },
  {
    "text": "value of understanding all those tools in your tool belt is that you can start to figure a lot of things out about",
    "start": "3148120",
    "end": "3154740"
  },
  {
    "text": "failures that you see as an example let's just walk through some scenarios",
    "start": "3154740",
    "end": "3161380"
  },
  {
    "text": "well actually let me just start at the top so this is I kind of wrote this out like a simple flow chart top to bottom",
    "start": "3161380",
    "end": "3167560"
  },
  {
    "text": "of sort of steps to take very very first thing you should do is just save everything right it's even even I have",
    "start": "3167560",
    "end": "3176350"
  },
  {
    "text": "to remind myself like okay cut and paste the error message I just saw and just get it in the ticket like put everything",
    "start": "3176350",
    "end": "3182830"
  },
  {
    "text": "in the ticket or put everything in a text file put everything somewhere you want to always kind of save that output",
    "start": "3182830",
    "end": "3188470"
  },
  {
    "text": "all the important outputs the important commands don't lose them log files take",
    "start": "3188470",
    "end": "3193990"
  },
  {
    "text": "backups that's part of saving everything you fire off that snapshot immediately another thing that I would say when I",
    "start": "3193990",
    "end": "3203200"
  },
  {
    "text": "say save everything you've got to pay attention to retention as well sometimes",
    "start": "3203200",
    "end": "3210150"
  },
  {
    "text": "you might want to take a snapshot manual snapshot of your oldest backup like the",
    "start": "3210810",
    "end": "3216910"
  },
  {
    "text": "one that's about to roll off right you it would be a very good idea probably to",
    "start": "3216910",
    "end": "3223120"
  },
  {
    "text": "just download all of your Postgres logs especially the old ones that are about to roll off there's like nothing more",
    "start": "3223120",
    "end": "3229210"
  },
  {
    "text": "frustrating than working on something for eight hours and then realizing that two hours ago the log file that I needed",
    "start": "3229210",
    "end": "3235210"
  },
  {
    "text": "just rolled off and it was cleaned up I mean it is the most frustrating feeling of the world like so that's why I say",
    "start": "3235210",
    "end": "3241450"
  },
  {
    "text": "the first thing to do here is just save this stuff you know save save your your",
    "start": "3241450",
    "end": "3247390"
  },
  {
    "text": "output get your log files take a snapshot of the backup so it doesn't disappear the thing that you cannot save",
    "start": "3247390",
    "end": "3254380"
  },
  {
    "text": "an RDS unfortunately there's no way to do this is the wall logs like once those",
    "start": "3254380",
    "end": "3260680"
  },
  {
    "text": "were all off they roll off so that is one of the reasons one of the reasons that and our happiness hints we say and",
    "start": "3260680",
    "end": "3267880"
  },
  {
    "text": "I I hope everybody does this set your backup window to the maximum of 35 days",
    "start": "3267880",
    "end": "3274710"
  },
  {
    "text": "because it also has nothing more frustrating than like you know you're wrestling with the corruption and then you look and they've got the backup",
    "start": "3274710",
    "end": "3280870"
  },
  {
    "text": "retention set to like one day or something ridiculous you like that which has absolutely happened for production",
    "start": "3280870",
    "end": "3287770"
  },
  {
    "text": "systems like I've seen this you know two and three here are are are kind of",
    "start": "3287770",
    "end": "3296800"
  },
  {
    "text": "closely related but you know starting to research the failure you know just look at what errors look at what log messages",
    "start": "3296800",
    "end": "3304059"
  },
  {
    "text": "one of the symptoms oh and what I try to do here was like the second column is sort of like the object and the third",
    "start": "3304059",
    "end": "3310630"
  },
  {
    "text": "column is the thing that you're doing right so you're making copies and screenshots have backup and logs you're",
    "start": "3310630",
    "end": "3316930"
  },
  {
    "text": "going to look at the errors the log messages and symptoms and what you want to do is is document your findings and",
    "start": "3316930",
    "end": "3322719"
  },
  {
    "text": "the other thing that is almost always helpful is to start assembling a timeline as soon as possible so cut and pasting the exact time stamps",
    "start": "3322719",
    "end": "3330130"
  },
  {
    "text": "down to the second or or down to like the millisecond or the microsecond like whatever you have cut and paste don't",
    "start": "3330130",
    "end": "3336339"
  },
  {
    "text": "lose any precision of every like important event that you see on the",
    "start": "3336339",
    "end": "3342160"
  },
  {
    "text": "backup side there remember you got your three types of backups you've got you",
    "start": "3342160",
    "end": "3349059"
  },
  {
    "text": "know the point in time recovery and the snapshots which are your two regular backups and then you've got if you have",
    "start": "3349059",
    "end": "3354579"
  },
  {
    "text": "logical backups going on as well you want to just take an inventory and know what you've got to work with another",
    "start": "3354579",
    "end": "3361180"
  },
  {
    "text": "thing from the backup so now we're gonna start getting into kind of the tactical value with these bottom two I've got a",
    "start": "3361180",
    "end": "3368349"
  },
  {
    "text": "corruption will say I've got like a row a table that I can't access one of the",
    "start": "3368349",
    "end": "3373630"
  },
  {
    "text": "things I want to do is figure out a time line well one of the strategies for that is when you start looking at you know",
    "start": "3373630",
    "end": "3379539"
  },
  {
    "text": "pull yesterday's backup and just say is it corrupted there if so you can pull a",
    "start": "3379539",
    "end": "3385209"
  },
  {
    "text": "backup from like three hours ago was it corrupted there you can start to get a sense of like when the corruption happened by looking at the backups when",
    "start": "3385209",
    "end": "3394929"
  },
  {
    "text": "I have seen corruptions that were embedded in the wall stream they tend to",
    "start": "3394929",
    "end": "3401259"
  },
  {
    "text": "replay without causing any errors so just rolling for the logs like it's not",
    "start": "3401259",
    "end": "3406809"
  },
  {
    "text": "going to stop when it hits the corruption right it's just that like I'll just find out that if I do if I",
    "start": "3406809",
    "end": "3412359"
  },
  {
    "text": "restored at two o'clock it's not corrupt if I are sort of three o'clock it's corrupt so somewhere between two and three there's a bad wall record that's",
    "start": "3412359",
    "end": "3419229"
  },
  {
    "text": "actually causing the corruption to happen that sort of thing can happen and",
    "start": "3419229",
    "end": "3424959"
  },
  {
    "text": "that's where so taken inventory there last is comparing your environments and this is where we really get down to some",
    "start": "3424959",
    "end": "3431920"
  },
  {
    "text": "really interesting things that you can figure out so you've got a math setup",
    "start": "3431920",
    "end": "3437430"
  },
  {
    "text": "right let's say we have a math setup and let's say that we try to read the block and we've got a we've got a checksum",
    "start": "3437430",
    "end": "3443490"
  },
  {
    "text": "mismatch all right well you know I'll tell you one of the things that in database engineering we always do is the",
    "start": "3443490",
    "end": "3449670"
  },
  {
    "text": "first thing we say is is it mass okay is it mass well I'm gonna just go look at the other side of that cluster and I'm",
    "start": "3449670",
    "end": "3455250"
  },
  {
    "text": "gonna look at exactly the same block and it should be the same corrupt block",
    "start": "3455250",
    "end": "3462200"
  },
  {
    "text": "usually is every now and then it's not if it's not what does that mean it means",
    "start": "3462200",
    "end": "3469349"
  },
  {
    "text": "that the the problem is underneath that layer not above that layer right because",
    "start": "3469349",
    "end": "3476700"
  },
  {
    "text": "if they're different then what you know the storage replication technology is",
    "start": "3476700",
    "end": "3481859"
  },
  {
    "text": "keeping everything the same like that's what it's doing unless there's a bug in the replication technology itself but it",
    "start": "3481859",
    "end": "3488190"
  },
  {
    "text": "means like the bug is not above the replication technology right if the replication technology was working",
    "start": "3488190",
    "end": "3493619"
  },
  {
    "text": "correctly in the storage and working correctly they will be identical if they're not identical something is wrong at that layer of the stack it's either",
    "start": "3493619",
    "end": "3500849"
  },
  {
    "text": "the replication bits or it's the storage so it's like you can start looking at",
    "start": "3500849",
    "end": "3506940"
  },
  {
    "text": "these things and you can me to make it you can do exactly the same thing with the Reap replica all right if I have a",
    "start": "3506940",
    "end": "3513240"
  },
  {
    "text": "read replica than I'm just right away just go see if it's corrupt on the read replica if it is corrupt on the read",
    "start": "3513240",
    "end": "3519780"
  },
  {
    "text": "replica what does that tell me that tells me it must be embedded in the wall stream because the wall stream is the",
    "start": "3519780",
    "end": "3526500"
  },
  {
    "text": "only thing there is no storage replication the wall stream is the only thing that feeds over to the reader Baca",
    "start": "3526500",
    "end": "3531660"
  },
  {
    "text": "so like literally that takes like five minutes and in five minutes",
    "start": "3531660",
    "end": "3537119"
  },
  {
    "text": "I can figure out is the source of my corruption in the wall stream or is the source of my corruption down of the",
    "start": "3537119",
    "end": "3543059"
  },
  {
    "text": "storage storage layer under is it in the database or out of the database is this a Postgres bug or is this not a Postgres",
    "start": "3543059",
    "end": "3550049"
  },
  {
    "text": "bug that little piece of information is really valuable as you start thinking",
    "start": "3550049",
    "end": "3556049"
  },
  {
    "text": "about root causing and things like that so that's why I said here multi AZ and replicas in particular and you can start",
    "start": "3556049",
    "end": "3562200"
  },
  {
    "text": "thinking about where the failure likely originated so that moves you into the",
    "start": "3562200",
    "end": "3569940"
  },
  {
    "text": "root causing area but just as one final reminder because",
    "start": "3569940",
    "end": "3575069"
  },
  {
    "text": "I'll say this again and again you got to stay focused when when you're when you're in these situations you know step",
    "start": "3575069",
    "end": "3583289"
  },
  {
    "text": "one is get out of pain and I've sat with operators I've even sat with operators in the service team and we have to remind each",
    "start": "3583289",
    "end": "3588599"
  },
  {
    "text": "other like oh I know your brain is racing and you're thinking about where is the bug but okay step one just get",
    "start": "3588599",
    "end": "3594420"
  },
  {
    "text": "out of pain first you know and not only just get out of pain but slow down",
    "start": "3594420",
    "end": "3600170"
  },
  {
    "text": "focus make sure you know you're typing in the right terminal window you don't want to type a command in the wrong",
    "start": "3600170",
    "end": "3605309"
  },
  {
    "text": "window you know you move slowly work with the partner and first priority is",
    "start": "3605309",
    "end": "3612089"
  },
  {
    "text": "get out of pain and then after that we'll start thinking about the root cause so that was the high level",
    "start": "3612089",
    "end": "3623450"
  },
  {
    "text": "introduction to corruption now let's get",
    "start": "3623450",
    "end": "3629069"
  },
  {
    "text": "into some specifics this is where I think it'll start really getting interesting",
    "start": "3629069",
    "end": "3636200"
  }
]