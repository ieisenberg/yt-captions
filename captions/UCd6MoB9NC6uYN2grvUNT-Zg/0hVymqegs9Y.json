[
  {
    "start": "0",
    "end": "42000"
  },
  {
    "text": "okay I think we'll get started um so first of all congratulations you've made it to the",
    "start": "1160",
    "end": "6359"
  },
  {
    "text": "last day of reinvent um but actually I think more impressively you've made it into this room at 9:00 a. this morning",
    "start": "6359",
    "end": "11880"
  },
  {
    "text": "after last night so thank you very much for coming um so it's Magento we're here to talk about today um and in particular",
    "start": "11880",
    "end": "18199"
  },
  {
    "text": "how to run and scale Magento on the AWS platform uh my name is sha Pierce I'm a Solutions architect for AWS based out",
    "start": "18199",
    "end": "25160"
  },
  {
    "text": "the UK um and I'm also pleased to say we're joined by one of our partners illisa so Zach will be up a little bit",
    "start": "25160",
    "end": "31160"
  },
  {
    "text": "later on talking about how to actually run magenta on AWS they run a managed platform for their customers so can give",
    "start": "31160",
    "end": "37719"
  },
  {
    "text": "us some good insight into that so what's the what's the goal of",
    "start": "37719",
    "end": "42760"
  },
  {
    "start": "42000",
    "end": "42000"
  },
  {
    "text": "today um so as was putting this together it became pretty simple so I've previously managed operational teams",
    "start": "42760",
    "end": "49480"
  },
  {
    "text": "that have looked after e-commerce platforms and other web properties um and I know how painful it is when these",
    "start": "49480",
    "end": "55280"
  },
  {
    "text": "things don't work when they don't scale and they're not highly available you're up at night putting in fix is you're uh",
    "start": "55280",
    "end": "61280"
  },
  {
    "text": "waking up at 2: a.m. to kind of restart servers and all this kind of stuff um and it's it's not a very nice place to",
    "start": "61280",
    "end": "67240"
  },
  {
    "text": "be so the goal of today really is just to allow you to go away with some practical tips and techniques that you",
    "start": "67240",
    "end": "73200"
  },
  {
    "text": "can hopefully Implement on your platforms um and really just make running magenta boring right this is",
    "start": "73200",
    "end": "79240"
  },
  {
    "text": "this is the ultimate goal we don't want it to be exciting we want it to be a very boring thing um just quick shave",
    "start": "79240",
    "end": "84560"
  },
  {
    "text": "hands so who's actually using Magento on AWS at the moment okay good few of you so keep your hands up if you never have",
    "start": "84560",
    "end": "90840"
  },
  {
    "text": "any operational issues it scales beautifully it works yeah one that's",
    "start": "90840",
    "end": "97960"
  },
  {
    "text": "cheating okay so before we um before we get too much into the technology I just wanted to start off by just sort of",
    "start": "98159",
    "end": "104159"
  },
  {
    "text": "taking a step back have a quick look at online retail and why speed is is so important in the",
    "start": "104159",
    "end": "109240"
  },
  {
    "text": "industry so this these um numbers were taken from a recent industry survey that",
    "start": "109240",
    "end": "114680"
  },
  {
    "text": "looked at the um the relationship between page load times and consumer behavior on e-commerce sites and it",
    "start": "114680",
    "end": "121039"
  },
  {
    "text": "found that 40% of users would actually um abandon a page if it takes more than 3 seconds to load um and on top of that",
    "start": "121039",
    "end": "127840"
  },
  {
    "text": "nearly 80% of users would actually if they're dissatisfied with site performance may never come back again so",
    "start": "127840",
    "end": "134120"
  },
  {
    "text": "these two things combined it means that if we have these kind of temporary performance issues on our sides um not",
    "start": "134120",
    "end": "139519"
  },
  {
    "text": "only are we affecting sales that are happening now but potentially kind of future sales as well so very important we get this",
    "start": "139519",
    "end": "145599"
  },
  {
    "text": "right and of course retail is a seasonal business so this is a typical traffic profile for amazon.com in November um",
    "start": "145599",
    "end": "152720"
  },
  {
    "text": "you can see us really ramping up towards the end of um end of November as we get into peak season and actually another",
    "start": "152720",
    "end": "159120"
  },
  {
    "text": "industry survey found that um industrywide sort of year-on-year e-commerce sales over the holiday period",
    "start": "159120",
    "end": "165599"
  },
  {
    "text": "in 2013 we're up about 12% so kind of annual growth we come to expect in the industry but actually there was a huge",
    "start": "165599",
    "end": "172360"
  },
  {
    "text": "54% increase and what they called last minute uh shopping orders and what they mean by sort of last minute orders are",
    "start": "172360",
    "end": "178480"
  },
  {
    "text": "users coming in on the last possible day they can to make a purchase before delivery at Christmas and so for me that",
    "start": "178480",
    "end": "184840"
  },
  {
    "text": "means as we as we get better at the logistics that sit behind these e-commerce stores us are going to users",
    "start": "184840",
    "end": "190200"
  },
  {
    "text": "are going to leave it to the last minute more and more they're going to be more and more confident in leaving those orders to the last minute so we're can",
    "start": "190200",
    "end": "196120"
  },
  {
    "text": "continue to see this kind of compounded growth going forward and then the final point is",
    "start": "196120",
    "end": "202319"
  },
  {
    "text": "holiday season we get a lot of notice for that right but what about the um the email campaigns the tv ads all the other",
    "start": "202319",
    "end": "209200"
  },
  {
    "text": "things that happen happen where we get very little notice or often very little notice but obviously our sites are still",
    "start": "209200",
    "end": "214760"
  },
  {
    "text": "our sites still need to to perform so how do we address this with",
    "start": "214760",
    "end": "221120"
  },
  {
    "text": "magenta um well let's let's start off by looking at some of the challenges so it's it's safe to say that",
    "start": "221120",
    "end": "227159"
  },
  {
    "text": "plenty of people struggle with magenta out there right there's you quick Google search you'll find thousands of articles",
    "start": "227159",
    "end": "232519"
  },
  {
    "text": "on 101 reasons my Magento site is slow seven ways to speed up my Magento site",
    "start": "232519",
    "end": "238239"
  },
  {
    "text": "but for me it's it's really important that we sort of understand the underlying characteristics of the application why do people struggle so",
    "start": "238239",
    "end": "244239"
  },
  {
    "text": "that we can develop an architecture that that addresses those and kind of mitigates those risks so a couple of",
    "start": "244239",
    "end": "249480"
  },
  {
    "text": "things that jump out of me so the first thing we need to be aware of is this eav data model so the data model that makes",
    "start": "249480",
    "end": "254799"
  },
  {
    "text": "Magento so flexible and why most of us use it um also can really cause some performance",
    "start": "254799",
    "end": "261040"
  },
  {
    "text": "issues um Magento isn't a cloud native application right it requires things like shared storage and these can be",
    "start": "261040",
    "end": "266759"
  },
  {
    "text": "challenging in a a dynamic Cloud environment and then lastly we see a lot of customers that are you know making",
    "start": "266759",
    "end": "272560"
  },
  {
    "text": "use of the the great Community out there there's lots of extensions out there that you can purchase or open source",
    "start": "272560",
    "end": "277800"
  },
  {
    "text": "ones that you can download quite quickly add functionality to your Magento site but you really need to be aware of what",
    "start": "277800",
    "end": "283240"
  },
  {
    "text": "you're installing and what impact that potentially can have on performance so what process should we",
    "start": "283240",
    "end": "290039"
  },
  {
    "text": "follow then to take magenta and make sure that it it meets our requirements um so for me what we need to do is start",
    "start": "290039",
    "end": "296080"
  },
  {
    "text": "with a stable base so let's get something that's high available very stable and use that as a foundation and",
    "start": "296080",
    "end": "303120"
  },
  {
    "text": "then we can look at that architecture we can start to say where's the bottleneck likely to be and we can iterate on that",
    "start": "303120",
    "end": "309360"
  },
  {
    "text": "architecture we can um improve it we can remove that bottleneck and that of course will expose another bottleneck",
    "start": "309360",
    "end": "315199"
  },
  {
    "text": "somewhere else and we can carry on with that iterative process and that's going to leave us with a platform that's highly available but also very stable",
    "start": "315199",
    "end": "322520"
  },
  {
    "text": "and can really scale to meet our needs so what does that highly available",
    "start": "322520",
    "end": "328039"
  },
  {
    "text": "base that Foundation look like so this is what I'm kind of terming our our minimal viable products for Magento",
    "start": "328039",
    "end": "334080"
  },
  {
    "text": "production implementation um and we're just spend some time just stepping through this so the first thing you see so we've",
    "start": "334080",
    "end": "341000"
  },
  {
    "text": "deployed Magento onto multiple ec2 instances um those instances sit in separate availability zones and then",
    "start": "341000",
    "end": "347280"
  },
  {
    "text": "we've got an elastic load balancer at the top there which is Distributing requests to those instances so that",
    "start": "347280",
    "end": "352600"
  },
  {
    "text": "that's automatically much more available much more stable than just a single instance um we can use health checks on",
    "start": "352600",
    "end": "358520"
  },
  {
    "text": "the load balancer to detect any kind of Hardware or software failure on those instances and automatically um only send",
    "start": "358520",
    "end": "364960"
  },
  {
    "text": "requests to the healthy ones um and actually here we've gone one step further so we've wrapped those instances at the top there in an",
    "start": "364960",
    "end": "371120"
  },
  {
    "text": "autoscaling group uh and this gives us a self-healing nature to the platform so now if we have a hardware failure or",
    "start": "371120",
    "end": "377280"
  },
  {
    "text": "software failure autoscaling can kick in it can detect that failure terminate the instance throw it away provision a new",
    "start": "377280",
    "end": "383880"
  },
  {
    "text": "one and put that into service so that's another thing we're not getting out of bed at 2: a.m. to kind of fix and and do",
    "start": "383880",
    "end": "389039"
  },
  {
    "text": "ourselves now there's some work there that you're going to need to do so you need to think about how you're going to bootstrap",
    "start": "389039",
    "end": "394800"
  },
  {
    "text": "those Magento instances so do you take the operating system all of your Magento code all of your configuration and bake",
    "start": "394800",
    "end": "401000"
  },
  {
    "text": "that into an Ami uh or do you use software configuration management tools like Chef or puppet and that's something",
    "start": "401000",
    "end": "407240"
  },
  {
    "text": "that Zach's going to talk a little bit later on about how they kind of solve those those operational issues um of course when you're running",
    "start": "407240",
    "end": "413759"
  },
  {
    "text": "multiple instances you need to think about things like sessions so if you just go through the default magenta",
    "start": "413759",
    "end": "418960"
  },
  {
    "text": "implementation you'll be storing your sessions in its file store so on the local instance um and that's that's not",
    "start": "418960",
    "end": "424960"
  },
  {
    "text": "going to work in a multi- instance autoscaling environment so what we'd probably advise at this point is to push",
    "start": "424960",
    "end": "430759"
  },
  {
    "text": "those sessions down to the database so natively supported by Magento you just need to configure it at installation",
    "start": "430759",
    "end": "436840"
  },
  {
    "text": "time and then that leaves you with all of your instances being able to serve any request to any user at any time so",
    "start": "436840",
    "end": "442560"
  },
  {
    "text": "much more flexible um the database itself so you'll notice we we're using RDS so",
    "start": "442560",
    "end": "448120"
  },
  {
    "text": "we've got my SQL 5.6 running in RDS um I'm not going to talk too much about",
    "start": "448120",
    "end": "453160"
  },
  {
    "text": "kind of operational benefits of RDS there's there's been talks on that but you will notice that we're deployed in a",
    "start": "453160",
    "end": "458479"
  },
  {
    "text": "highly available manner so RDS is going to worry about deploying instances in multiple availability zones it's going",
    "start": "458479",
    "end": "464120"
  },
  {
    "text": "to worry about the synchronization between the instances and it's going to worry about a failover and how that would take place if",
    "start": "464120",
    "end": "469800"
  },
  {
    "text": "needed um at this point it's probably also worth noting so when we were developing this architecture it was",
    "start": "469800",
    "end": "474919"
  },
  {
    "text": "tested and we created it with uh 56 um obviously we've got Aurora now um so I'm",
    "start": "474919",
    "end": "480479"
  },
  {
    "text": "very keen to start you know testing that with Magento as well given the 56 compatibility you know I think we're",
    "start": "480479",
    "end": "485599"
  },
  {
    "text": "going to see some some great improvements there as well but something you need to test of as you get access on your",
    "start": "485599",
    "end": "491199"
  },
  {
    "text": "platforms um and then finally shared storage so you see here that we're running NFS on",
    "start": "491199",
    "end": "497280"
  },
  {
    "text": "ec2 um I'm not again going to go into a huge detail about running highly available NFS Stores um one it's it's a",
    "start": "497280",
    "end": "504159"
  },
  {
    "text": "talk in itself um but also as we look to evolve this architecture so as we go through this presentation we're going to",
    "start": "504159",
    "end": "509960"
  },
  {
    "text": "look at alternatives to NFS and how we can hopefully remove it completely if you are interested then um",
    "start": "509960",
    "end": "517518"
  },
  {
    "start": "516000",
    "end": "516000"
  },
  {
    "text": "there was a great talk by one of my colleagues last year at reinvent 2013 so NFS is sifs options for AWS it's",
    "start": "517519",
    "end": "524159"
  },
  {
    "text": "available on YouTube so do check that out it goes through um how to run your own NFS Services as well as having a",
    "start": "524159",
    "end": "529920"
  },
  {
    "text": "look at the van the vendor landscape out there as well okay so back to our architecture so",
    "start": "529920",
    "end": "536839"
  },
  {
    "text": "we've got that high availability now we can deal with Hardware failure we can recover um we've got a solid platform so",
    "start": "536839",
    "end": "543680"
  },
  {
    "text": "we're going to see more traffic hopefully we've got a popular e-commerce site um as that evolves we're going to see our first bottleneck um and where",
    "start": "543680",
    "end": "550760"
  },
  {
    "text": "that is will depend on your application it depends on your code it depends on how your users are going to interact with your",
    "start": "550760",
    "end": "556519"
  },
  {
    "text": "store but actually more than likely with Magento it's going to be a CPU constraint in Magento itself so how do",
    "start": "556519",
    "end": "563560"
  },
  {
    "text": "we solve this one well actually this this one is easy right so we've actually already done all the hard work so we've",
    "start": "563560",
    "end": "569279"
  },
  {
    "text": "moved our sessions down to our database we've got a shared storage platform to allow sharing things like slash media um",
    "start": "569279",
    "end": "576279"
  },
  {
    "text": "and we've already done the autoscaling so we've got some bootstrapping in place we can bring instances into service so",
    "start": "576279",
    "end": "581800"
  },
  {
    "text": "actually we just turn up the dial so turn up autoscaling let's bring new instances in um they can join the fleet",
    "start": "581800",
    "end": "588200"
  },
  {
    "text": "and they can start taking some load and actually we can go one step further so we can have scaling policies in place as",
    "start": "588200",
    "end": "594160"
  },
  {
    "text": "well and that will allow us to automatically bring instances in and out um according to CP utilization",
    "start": "594160",
    "end": "599760"
  },
  {
    "text": "so again not something we're having to do manually now when you've got those",
    "start": "599760",
    "end": "605240"
  },
  {
    "text": "multiple instances of course you're going to be sending more and more requests down to the database um and at some point that's then going to manifest",
    "start": "605240",
    "end": "611560"
  },
  {
    "text": "itself as a bottleneck as well so how do we solve this one so a great opportunity",
    "start": "611560",
    "end": "617560"
  },
  {
    "text": "to bring in a centralized backend cache for Magento um and actually the so the latest versions of magenta have native",
    "start": "617560",
    "end": "624240"
  },
  {
    "text": "support for redis built in now um and I think reddis has some great advantages over alternative techn Oles like MC D in",
    "start": "624240",
    "end": "630519"
  },
  {
    "text": "this particular use case so reddis allows you to group similar cache items together so something known as tagging",
    "start": "630519",
    "end": "637200"
  },
  {
    "text": "and then that gives magenta the ability to have much more control over how it purges the cach and therefore makes that cash a lot more",
    "start": "637200",
    "end": "643519"
  },
  {
    "text": "efficient um you can run reddis on ec2 but here we're using elasticache so our own service to really remove some of",
    "start": "643519",
    "end": "650120"
  },
  {
    "text": "that operational complexity um and in particular here we're using one of the latest features which is a multi-az",
    "start": "650120",
    "end": "655880"
  },
  {
    "text": "reddis deployment so you'll see we're running or elastic the cash is actually deployed a master the reddest node in",
    "start": "655880",
    "end": "661839"
  },
  {
    "text": "one availability Zone um it then deploys multiple readed slaves into separate availability zones um and it really",
    "start": "661839",
    "end": "668880"
  },
  {
    "text": "monitors the health of that node if there's an issue with the node itself with connectivity to that node it can",
    "start": "668880",
    "end": "674079"
  },
  {
    "text": "initiate a fail over so it promotes the slave it will actually reprovision a new slave to replace it um and then it will",
    "start": "674079",
    "end": "680519"
  },
  {
    "text": "do all the DNS rewiring needed so we don't need to touch our application but we get that data durability and that",
    "start": "680519",
    "end": "686120"
  },
  {
    "text": "high availability as well um once you've got Reddit in place",
    "start": "686120",
    "end": "691240"
  },
  {
    "text": "uh you can also move your sessions so although we needed those to be in the database right at the start latest",
    "start": "691240",
    "end": "697000"
  },
  {
    "text": "versions of magenta also have native support for sessions in redis as well so let's take them out of that relational",
    "start": "697000",
    "end": "702440"
  },
  {
    "text": "data store and let's put them into an in-memory data store where we're we get better performance and we kind of alleviate some of that database load as",
    "start": "702440",
    "end": "710120"
  },
  {
    "text": "well um so for moderately sized Magento sites you you probably decide to run a",
    "start": "710120",
    "end": "715639"
  },
  {
    "text": "single elasticache cluster and you can put your sessions and your caches in there um you can configure it in your",
    "start": "715639",
    "end": "721200"
  },
  {
    "text": "local.xml file like this um one thing to be aware of so use separate database identifiers for your cash and for your",
    "start": "721200",
    "end": "728079"
  },
  {
    "text": "sessions this gives you a bit of isolation within the Reddit instance it allows you to tear down sessions without",
    "start": "728079",
    "end": "733760"
  },
  {
    "text": "affecting cash or vice versa so much better isolation of those two use cases",
    "start": "733760",
    "end": "738880"
  },
  {
    "text": "there um as you look to grow Magento so you're serving more and more traffic you might decide to run separate independent",
    "start": "738880",
    "end": "745160"
  },
  {
    "start": "741000",
    "end": "741000"
  },
  {
    "text": "elastic cach clusters for things like sessions backend cache and if you're running Enterprise Magento then the the",
    "start": "745160",
    "end": "750639"
  },
  {
    "text": "full page cache as well so this gives you the obvious benefit of being able to scale out the amount of adressable",
    "start": "750639",
    "end": "756120"
  },
  {
    "text": "memory for your redist tier um you can still run separate Masters and slaves in different availability zones for that",
    "start": "756120",
    "end": "762440"
  },
  {
    "text": "durability um but it also gives the ability to further isolate your your different use cases so now you can tune",
    "start": "762440",
    "end": "768800"
  },
  {
    "text": "the way you're using elasticache you can run different node sizes for different use cases um get faster or slower CPUs",
    "start": "768800",
    "end": "775240"
  },
  {
    "text": "for different use cases so so really tune the way you're using it",
    "start": "775240",
    "end": "780839"
  },
  {
    "text": "okay so we're back to the architecture so we've got that caching in place now um but what about those operational",
    "start": "781760",
    "end": "787040"
  },
  {
    "text": "scenarios where we need to clear cash um we all try and avoid it we don't want to do sort of mass evictions of cash but",
    "start": "787040",
    "end": "793079"
  },
  {
    "text": "there may be big breaking deployments there may be um big different changes to your data structure that require you to",
    "start": "793079",
    "end": "798720"
  },
  {
    "text": "essentially clear out the whole cach or or the majority of it so when that happens you got a cold cache you get a",
    "start": "798720",
    "end": "804680"
  },
  {
    "text": "stampede down to the database all those requests that were hitting cash are now hitting your database space and again",
    "start": "804680",
    "end": "810040"
  },
  {
    "text": "you're going to see this become a bottleneck within those times and we really need an architecture that allows",
    "start": "810040",
    "end": "816279"
  },
  {
    "text": "us to do that we don't want to be scared of clearing cach we need to be able to kind of survive those kind of operational",
    "start": "816279",
    "end": "821680"
  },
  {
    "text": "scenarios so one way of solving this is to introduce read replicas um so RDS",
    "start": "821680",
    "end": "827240"
  },
  {
    "text": "provides uh sort of oneclick deployment of read replicas into multiple availability zones um and Magento can",
    "start": "827240",
    "end": "833800"
  },
  {
    "text": "support read replicas just by kind of adding the end points into your local.xml file um one thing to be aware",
    "start": "833800",
    "end": "839560"
  },
  {
    "text": "of so if you're running custom extensions do be aware of how they're going to deal with read replicas so do they honor the read replicas do they how",
    "start": "839560",
    "end": "846399"
  },
  {
    "text": "do they deal with the asynchronous replication lag that you're going to see even if it's just you know a few seconds",
    "start": "846399",
    "end": "852120"
  },
  {
    "text": "or less than that um again with Aurora we're going to see significantly reduced replication lag with read replicas so I",
    "start": "852120",
    "end": "858680"
  },
  {
    "text": "think that's something that's really going to help but definitely something that needs to be tested so at this point we can scale out",
    "start": "858680",
    "end": "865639"
  },
  {
    "text": "our front end further so you see we've added more front end instan we got a data tier that now can can serve more",
    "start": "865639",
    "end": "871759"
  },
  {
    "text": "content so we can run more magenta instances and serve more more pages to the end",
    "start": "871759",
    "end": "876839"
  },
  {
    "text": "users now the thing to remember here is that for every page we're now serving we're potentially also going to be",
    "start": "876839",
    "end": "882480"
  },
  {
    "text": "serving three four five multiple images and all of those images are coming from that NFS server so again at some point",
    "start": "882480",
    "end": "889320"
  },
  {
    "text": "NFS is going to come that bottleneck now you can scale up NFS you can run a faster ec2 instance with more",
    "start": "889320",
    "end": "896000"
  },
  {
    "text": "Network bandwidth you can have provisioned iops on the EBS volumes lots of things you can do there but actually",
    "start": "896000",
    "end": "901800"
  },
  {
    "text": "at this point I would consider using Amazon S3 to start to serve some of that content so S3 has been designed for near",
    "start": "901800",
    "end": "909360"
  },
  {
    "text": "linear scalability so it's a great platform not just to store the content but also to serve static web content",
    "start": "909360",
    "end": "914800"
  },
  {
    "text": "directly to end users now once you've got that working you can also introduce cloudfront so",
    "start": "914800",
    "end": "921600"
  },
  {
    "text": "cloudfront is our content distribution Network um and that has so 52 geographical pops around the world and",
    "start": "921600",
    "end": "927959"
  },
  {
    "text": "this allows you to start store uh caching and serving that content from locations very close to end users so",
    "start": "927959",
    "end": "934040"
  },
  {
    "text": "again that's going to lower the latency of those requests and much quicker image loads really kind of increases the",
    "start": "934040",
    "end": "939240"
  },
  {
    "text": "perceived performance of pages it feels much snappier more performance to users now there are lots of extensions",
    "start": "939240",
    "end": "946639"
  },
  {
    "text": "out there that help you to do this so fre extensions you can download that give you that integration but a couple",
    "start": "946639",
    "end": "951959"
  },
  {
    "text": "of things to be aware of so the the first thing is is that they don't actually remove the need for shared storage Al together so many of them will",
    "start": "951959",
    "end": "959560"
  },
  {
    "text": "require some shared storage for your admin instance that you see in the bottom left hand side there to be able to share original images to the front",
    "start": "959560",
    "end": "966199"
  },
  {
    "text": "end instances that will then do a resize and upload to S3 on first request so it",
    "start": "966199",
    "end": "971519"
  },
  {
    "text": "kind of removes some of the it removes NFS from that critical path but it doesn't remove it all together um and that's one of the",
    "start": "971519",
    "end": "977839"
  },
  {
    "text": "reasons I'm work with a number of customers at the moment that are developing their own extensions that can completely remove NFS from from the",
    "start": "977839",
    "end": "984480"
  },
  {
    "text": "architecture Al together the way they do that they follow a similar set of steps and we'll step through those now so the",
    "start": "984480",
    "end": "991360"
  },
  {
    "text": "first thing that's going to happen is an admin user uploads an image to our admin instance so a new new image for a new",
    "start": "991360",
    "end": "997480"
  },
  {
    "text": "product what we want our extension to do is use our apis to directly push that to S3 so no more no more putting not on",
    "start": "997480",
    "end": "1005160"
  },
  {
    "text": "disk now at some point we're going to get our first request for that image um and that means that the front end",
    "start": "1005160",
    "end": "1010959"
  },
  {
    "text": "instance needs to go to the database and check whether that image has yet to be resized if it hasn't been resized it",
    "start": "1010959",
    "end": "1017240"
  },
  {
    "text": "goes to S3 it retrieves the image it can do the resizing and then pushes those resized images back up to",
    "start": "1017240",
    "end": "1024280"
  },
  {
    "text": "S3 and then finally it stores that in the database so it records the fact that the resize has happened and now the next",
    "start": "1024280",
    "end": "1030640"
  },
  {
    "text": "time an image a request for a page comes through with those images checking the database we see the image is resized and",
    "start": "1030640",
    "end": "1036319"
  },
  {
    "text": "we serve the page up directly with those S3 URLs so we're removing that need for NFS for for media storage and",
    "start": "1036319",
    "end": "1044600"
  },
  {
    "text": "serving so couple of things to take note so the first one is when you're pushing content to S3 to actually serve directly",
    "start": "1044760",
    "end": "1051880"
  },
  {
    "text": "make sure you're setting appropriate cache control headers so this is going to instruct the user's browser and the",
    "start": "1051880",
    "end": "1057400"
  },
  {
    "text": "CDN so cloudfront itself to actually cache those images appropriately and increase the cache",
    "start": "1057400",
    "end": "1063080"
  },
  {
    "text": "efficiency the other thing is you're going to need to serve these images over both HTTP but also https for secure",
    "start": "1063080",
    "end": "1070280"
  },
  {
    "text": "areas of the site so if you're happy with serving under cloudfronts own domain then you can use cloudfronts SSL",
    "start": "1070280",
    "end": "1077159"
  },
  {
    "text": "certificates just start calling over https and and we'll serve if you want to use your own domain",
    "start": "1077159",
    "end": "1083720"
  },
  {
    "text": "so let's say you know images. mysite.com or something like that then you need to upload your own SSL certificates to",
    "start": "1083720",
    "end": "1089799"
  },
  {
    "text": "cloudfront but again something that's supported um and then the last three points so when configuring cloudfront",
    "start": "1089799",
    "end": "1096720"
  },
  {
    "text": "just make sure you don't pass through headers cookies or query strings back to S3 so this is static content there's no",
    "start": "1096720",
    "end": "1103440"
  },
  {
    "text": "need to dilute our cache by including those kind of things in the requests and again by doing that we're more likely to",
    "start": "1103440",
    "end": "1108880"
  },
  {
    "text": "serve from cloudfront and therefore increase the latency okay so back to our architecture",
    "start": "1108880",
    "end": "1115919"
  },
  {
    "text": "so we've removed NFS now we've removed that bottleneck and this gives us the ability to continue to scale up those",
    "start": "1115919",
    "end": "1121600"
  },
  {
    "text": "Magento instances so more instances load balance serving more and more",
    "start": "1121600",
    "end": "1127240"
  },
  {
    "text": "requests now again what you'll find is that as you do that each one of those images will be serving repetitive",
    "start": "1127600",
    "end": "1134919"
  },
  {
    "text": "content so the same Pages the same product pages the same same catalog pages each and every time so actually to",
    "start": "1134919",
    "end": "1141120"
  },
  {
    "text": "make this more efficient why not add a cache in front of those Magento instances as well um and here you'll see",
    "start": "1141120",
    "end": "1146880"
  },
  {
    "text": "we're using varnish so varnish is a great HTTP accelerator um and the reason",
    "start": "1146880",
    "end": "1152000"
  },
  {
    "text": "we select varnish is it has such great support within the Magento Community itself so there are already extensions",
    "start": "1152000",
    "end": "1157480"
  },
  {
    "text": "out there that help you to extend Magento to actually use varnish so it allows Magento to set appropriate cache",
    "start": "1157480",
    "end": "1163360"
  },
  {
    "text": "control headers to tell varnish what to cach and for how long for um and it also allows gento to purge the varnish cache",
    "start": "1163360",
    "end": "1170280"
  },
  {
    "text": "so if certain events happen like a change in stock control we need to reflect that on the site as quickly as possible and so varnish Magento can",
    "start": "1170280",
    "end": "1177840"
  },
  {
    "text": "actually Purge explicit pieces of the varnish cach very quickly um on top of that you also",
    "start": "1177840",
    "end": "1185080"
  },
  {
    "text": "you're also going to have even greater um support for varnish within Magento 2 so looking at that product going forward",
    "start": "1185080",
    "end": "1190919"
  },
  {
    "text": "it's going to have inbuilt support for varnish you can actually produce vcl configuration straight from Magento so",
    "start": "1190919",
    "end": "1197159"
  },
  {
    "text": "it's it's the right accelerator for this particular use case now I'm not going to talk too much",
    "start": "1197159",
    "end": "1203120"
  },
  {
    "text": "more about the integration with magenta and varnish I think do check out these extensions um and test them with your",
    "start": "1203120",
    "end": "1209080"
  },
  {
    "text": "sites make sure they work but what I do want to do is talk a little bit about how to successfully run a varish cach on",
    "start": "1209080",
    "end": "1215039"
  },
  {
    "text": "AWS uh and to do that there's a few things you need to know about how our elastic load balancing service works and",
    "start": "1215039",
    "end": "1220840"
  },
  {
    "text": "also about how varnish has been designed and how it operates so what we see here is um a",
    "start": "1220840",
    "end": "1228440"
  },
  {
    "text": "request coming into our platform so if we see that we've got the our customer the end user on the left hand side there",
    "start": "1228440",
    "end": "1235159"
  },
  {
    "text": "they're going to send a request into our platform and the first thing that's going to do is hit an an external",
    "start": "1235159",
    "end": "1240520"
  },
  {
    "text": "elastic load balancer uh that load balancer will then distribute requests to multiple varnish nodes that's doing",
    "start": "1240520",
    "end": "1246640"
  },
  {
    "text": "the caching in this diagram we're just seeing one and then from there if the cach is cold or the the cash item isn't",
    "start": "1246640",
    "end": "1253559"
  },
  {
    "text": "there varnish is going to have to go and then request that from Magento and you can see here is going via an internal",
    "start": "1253559",
    "end": "1259400"
  },
  {
    "text": "elastic load balancer so a second load balancing tier and that load balancer will then be responsible for Distributing request to",
    "start": "1259400",
    "end": "1266799"
  },
  {
    "text": "magenta now when you create a load balancer an elastic load balancer you'll be given a DNS name and it's that DNS",
    "start": "1266799",
    "end": "1272919"
  },
  {
    "text": "name that we expect clients to send request to but we expect a client to first of all resolve that DNS name and",
    "start": "1272919",
    "end": "1279720"
  },
  {
    "text": "if there are multiple IP addresses that are returned then we expect the client to deliver round robin load balancing to",
    "start": "1279720",
    "end": "1286000"
  },
  {
    "text": "those different IP addresses um and we also expect the client to obey the TTL",
    "start": "1286000",
    "end": "1291039"
  },
  {
    "text": "so if we're saying to R resolve every 60 seconds we need that client to RR resolve every 60 seconds and take into",
    "start": "1291039",
    "end": "1296640"
  },
  {
    "text": "account any changes in that IP address space and what this allows us to do is essentially scale the load balancing",
    "start": "1296640",
    "end": "1302799"
  },
  {
    "text": "service on your behalf depending on how much load we're seeing now varnish on the other hand has",
    "start": "1302799",
    "end": "1308320"
  },
  {
    "text": "been designed for Speed so what it will actually do is you'll give it a DNS name in the uh the vcl configuration and when",
    "start": "1308320",
    "end": "1315919"
  },
  {
    "text": "you start varnish it will resolve that DNS name but it will take the first IP address and it will continue to just use that IP",
    "start": "1315919",
    "end": "1322120"
  },
  {
    "text": "address for the the lifetime of that process running or until the configuration is reloaded and this creates an issue like",
    "start": "1322120",
    "end": "1328799"
  },
  {
    "text": "we see here so what we end up doing is sending all of our requests back to a single IP address to that elastic load",
    "start": "1328799",
    "end": "1334919"
  },
  {
    "text": "balancer so that's going to cause a few issues so we're no longer spreading our load across all of the underlying",
    "start": "1334919",
    "end": "1340360"
  },
  {
    "text": "infrastructure that's running our load balancer um if we scale up in response to additional load from you you're not",
    "start": "1340360",
    "end": "1346559"
  },
  {
    "text": "going to be using those additional addresses and actually the worst one we might actually be sending traffic to an",
    "start": "1346559",
    "end": "1352000"
  },
  {
    "text": "IP address that's no longer associated with our load balancer so those requests are just going to be dropped and we're not going to see the",
    "start": "1352000",
    "end": "1357799"
  },
  {
    "text": "responses so how do we solve this one so a lot of customers will decide to",
    "start": "1357799",
    "end": "1363200"
  },
  {
    "start": "1362000",
    "end": "1362000"
  },
  {
    "text": "remove that second layer of load balancing so instead of having that internal load balancer why don't we use",
    "start": "1363200",
    "end": "1368720"
  },
  {
    "text": "varnish to just load balance to those instances so varnish can load balance we can take the IP addresses from each one",
    "start": "1368720",
    "end": "1374480"
  },
  {
    "text": "of our backend magenta instances put them in the vcl start start up and we'll get load balancing and that that will",
    "start": "1374480",
    "end": "1381279"
  },
  {
    "text": "work but we need to think about the fact that we're in a dynamic environment so those Magento instances are sitting in",
    "start": "1381279",
    "end": "1387640"
  },
  {
    "text": "an autoscaling group they can come and go at any time so how do we deal with that so again many customers will write",
    "start": "1387640",
    "end": "1394200"
  },
  {
    "text": "scripts to deal with this so write the script put it on a cron every minute wake up have a look at the environment",
    "start": "1394200",
    "end": "1401080"
  },
  {
    "text": "what IP addresses are out there what's running Is this different for my vcl if it is rewrite the vcl reload the config",
    "start": "1401080",
    "end": "1408000"
  },
  {
    "text": "go to sleep wake up in a minute and do it all over again it will work but you can see there's lots of moving Parts",
    "start": "1408000",
    "end": "1414440"
  },
  {
    "text": "there there's lots there's code you need to write there code you need to support in a production",
    "start": "1414440",
    "end": "1419480"
  },
  {
    "text": "environment so one alternative is to use engine X for your DNS resolution so in",
    "start": "1419480",
    "end": "1425720"
  },
  {
    "start": "1420000",
    "end": "1420000"
  },
  {
    "text": "this configuration you continue to use varnish to do all of the the good caching and the integration into Magento that's already there but when varnish",
    "start": "1425720",
    "end": "1432880"
  },
  {
    "text": "needs to send a request back to the application tier sends it back to a Magento process sorry an engine X",
    "start": "1432880",
    "end": "1438480"
  },
  {
    "text": "process running on the same ec2 instance so Local Host at80 engine X on the other hand is is",
    "start": "1438480",
    "end": "1444880"
  },
  {
    "text": "can do this DNS resolution as we expect so it can it can re resolve the IP addresses according to the TTL it can",
    "start": "1444880",
    "end": "1451960"
  },
  {
    "text": "round robin load balances to the IP addresses it gets back so that will work and it removes the need for any of that",
    "start": "1451960",
    "end": "1458640"
  },
  {
    "text": "additional code that you need to write now if you're going to set this up",
    "start": "1458640",
    "end": "1463960"
  },
  {
    "text": "there's a couple of kind of pointers you're going to need to look out for so the first thing you need to tell engine X where to resolve DNS um it doesn't",
    "start": "1463960",
    "end": "1471039"
  },
  {
    "text": "listen to the operating system it won't just do it on your behalf um so you can see here what we've done is we've passed",
    "start": "1471039",
    "end": "1476960"
  },
  {
    "text": "the IP address of the DNS server to the resolver within the engine X config now if you're running in a",
    "start": "1476960",
    "end": "1483480"
  },
  {
    "text": "virtual private Cloud we will provide a DNS server for you on your behalf and it's always located at the base of the",
    "start": "1483480",
    "end": "1490080"
  },
  {
    "text": "IP range of your VPC plus two so if you create a VPC which has an IP range of",
    "start": "1490080",
    "end": "1496760"
  },
  {
    "text": "10.60 then the IP address will sorry the DNS server will always be at",
    "start": "1496760",
    "end": "1502840"
  },
  {
    "text": "102 and then the other one that sort of I picked up in testing was all current",
    "start": "1502840",
    "end": "1508600"
  },
  {
    "text": "versions of engine X don't actually um or can't re resolve DNS if you pass that",
    "start": "1508600",
    "end": "1514399"
  },
  {
    "text": "DNS string straight to the proxy pass which is the piece of configuration in engine X where it needs to go um if you",
    "start": "1514399",
    "end": "1520919"
  },
  {
    "text": "do that it will resolve once on Startup and not re- resolve and again you won't pick up on those changes in the IP",
    "start": "1520919",
    "end": "1526440"
  },
  {
    "text": "addresses so what you need to do is just take the DNS name pass it to a variable and then pass that variable into the",
    "start": "1526440",
    "end": "1532520"
  },
  {
    "text": "proxy pass that may be something that's addressed in future versions of engine X but as it stands now you need to just",
    "start": "1532520",
    "end": "1538440"
  },
  {
    "text": "make sure you're doing that as well Okay so we've talked a lot about um",
    "start": "1538440",
    "end": "1547080"
  },
  {
    "start": "1543000",
    "end": "1543000"
  },
  {
    "text": "resolution and getting engine X up and running um as we add more layers into our architecture it's also worth",
    "start": "1547080",
    "end": "1552760"
  },
  {
    "text": "thinking about a health checking strategy um so many customers will tend to do what we call called Deep health",
    "start": "1552760",
    "end": "1558440"
  },
  {
    "text": "checks um and by Deep health checks I mean every layer of the application actually reaching right back into the",
    "start": "1558440",
    "end": "1565640"
  },
  {
    "text": "application lay to magenta itself to check whether magenta is up and it's healthy um and this can cause something",
    "start": "1565640",
    "end": "1571679"
  },
  {
    "text": "that we call a shared fate scenario and I'll talk through what that means so we've got our um health checks",
    "start": "1571679",
    "end": "1578640"
  },
  {
    "text": "on magenta so some PHP file that's running within magent that's that's telling our internal load balancer that",
    "start": "1578640",
    "end": "1584320"
  },
  {
    "text": "we're we're up and running we're healthy um varnish is doing the same so varnish is actually reaching back",
    "start": "1584320",
    "end": "1589799"
  },
  {
    "text": "through and checking that same file to make sure that everything is healthy so everything's up and running but let's say we make a",
    "start": "1589799",
    "end": "1596600"
  },
  {
    "text": "deployment and it's it's a bad deployment we didn't test it for some reason it's gone through and it stops Magento from being able to respond so",
    "start": "1596600",
    "end": "1604279"
  },
  {
    "text": "all of a sudden Magento can't respond to any health checks and what that means is our internal elastic load balancer is",
    "start": "1604279",
    "end": "1610679"
  },
  {
    "text": "going to see that issue and it will start to take those those instances out of service as it detects that they're",
    "start": "1610679",
    "end": "1616600"
  },
  {
    "text": "unhealthy but the problem is in addition to that is that varnish will then not be able to respond to its health checks",
    "start": "1616600",
    "end": "1622159"
  },
  {
    "text": "from its load balancer and before you know it you'll also have those instances out of service as well and this is kind",
    "start": "1622159",
    "end": "1627880"
  },
  {
    "text": "of worst case scenario right so we've made a bad deployment and now we've got no healthy instances we're not serving",
    "start": "1627880",
    "end": "1633440"
  },
  {
    "text": "any content and are stores down and actually the worst thing is is",
    "start": "1633440",
    "end": "1638520"
  },
  {
    "text": "that varnish probably had a whole load of popular Pages cashed and ready to serve but they've now been torn down",
    "start": "1638520",
    "end": "1644200"
  },
  {
    "text": "because the the instances were unhealthy so alternatively what you want to do is just keep those health checks",
    "start": "1644200",
    "end": "1650399"
  },
  {
    "text": "on the back end so and continue to have the internal load balancer checking those instances making sure they're",
    "start": "1650399",
    "end": "1655840"
  },
  {
    "text": "healthy but run a completely separate and Independent Health check for your varnish layer and actually if we've got",
    "start": "1655840",
    "end": "1662600"
  },
  {
    "text": "the the architecture that we've got here you really want to serve that health check out of engine X and then you know that your external outside load balancer",
    "start": "1662600",
    "end": "1669640"
  },
  {
    "text": "is checking the health of the varnish process and the engine X process now in the same scenario Magento goes down",
    "start": "1669640",
    "end": "1676240"
  },
  {
    "text": "we've made a bad deployment but our varnish instances will all stay up they stay healthy they continue to serve",
    "start": "1676240",
    "end": "1681640"
  },
  {
    "text": "product pages home pages and everything else like that okay so back to the architecture",
    "start": "1681640",
    "end": "1689279"
  },
  {
    "text": "there's a few other things we need to do here before we complete and the first one is is tuning of the cache so the",
    "start": "1689279",
    "end": "1695440"
  },
  {
    "text": "goal really should be that varnish is serving the vast majority of all of our pages so anything that's cachable comes",
    "start": "1695440",
    "end": "1701640"
  },
  {
    "text": "from varish and actually that ends up with only a very small number of requests coming back to the Magento instances themselves",
    "start": "1701640",
    "end": "1707960"
  },
  {
    "text": "so the magenta instances are there to process orders to serve out checkout workflows and maybe some personalized",
    "start": "1707960",
    "end": "1713960"
  },
  {
    "text": "content and actually at that point what we can do is scale in the architecture so we no long longer need to run these",
    "start": "1713960",
    "end": "1720799"
  },
  {
    "text": "um heavy compute instances running magenta we can bring those in and we can actually lower the cost of of ownership",
    "start": "1720799",
    "end": "1726039"
  },
  {
    "text": "of the platform okay so that's all I wanted to",
    "start": "1726039",
    "end": "1732159"
  },
  {
    "text": "cover from an architecture point of view um thanks for listening I know that um or we all know really that that",
    "start": "1732159",
    "end": "1738320"
  },
  {
    "text": "designing a scalable architecture is only really half the issue it's only solving half the problem what we also need to do is have the operational tools",
    "start": "1738320",
    "end": "1744960"
  },
  {
    "text": "and the processes in place to run it so for that I'm going to hand over to Zach",
    "start": "1744960",
    "end": "1750518"
  },
  {
    "text": "thanks thank you Sean so yes I'm Zach uh I'm co-founder",
    "start": "1753120",
    "end": "1759840"
  },
  {
    "text": "and Chief Architect at elera uh we provide a fully managed platform for",
    "start": "1759840",
    "end": "1765640"
  },
  {
    "text": "Magento uh we've been running for around about a year and a half but our story starts a little over 10 years ago when I",
    "start": "1765640",
    "end": "1772159"
  },
  {
    "text": "worked with my co-founder osalo at a company called vendor uh vendor were early pioneers of software as a service",
    "start": "1772159",
    "end": "1779440"
  },
  {
    "text": "e-commerce uh we found that retailers loved a lot of things about software as a service um they loved that they didn't",
    "start": "1779440",
    "end": "1786799"
  },
  {
    "text": "have any headaches and they could focus on running their business so to steal a phrase from the keynote yesterday",
    "start": "1786799",
    "end": "1792200"
  },
  {
    "text": "morning um uh undifferentiated heavy lifting uh the op operations folks in the audience",
    "start": "1792200",
    "end": "1798720"
  },
  {
    "text": "can probably grudgingly agree that in the retail world most of operations is",
    "start": "1798720",
    "end": "1803960"
  },
  {
    "text": "undifferentiated heavy lifting uh if you mess up your performance you'll probably lose some sales uh if you mess up your",
    "start": "1803960",
    "end": "1811240"
  },
  {
    "text": "availability you're definitely going to lose some business if you mess up your security you might lose your whole business but people aren't going to",
    "start": "1811240",
    "end": "1818279"
  },
  {
    "text": "choose which shop to buy from just on the basis of how good their operations team is uh so that's where we fit in we",
    "start": "1818279",
    "end": "1824039"
  },
  {
    "text": "wanted to allow uh businesses to build on mag have control over their Destiny but not have to worry about these",
    "start": "1824039",
    "end": "1830519"
  },
  {
    "text": "headaches so we're building a platform um that might seem like a little bit of",
    "start": "1830519",
    "end": "1837159"
  },
  {
    "text": "a specialized Niche kind of thing that you won't be able to relate to but our objectives as a platform provider are",
    "start": "1837159",
    "end": "1843279"
  },
  {
    "text": "probably uh the same thing that most um agencies most individual uh Merchants",
    "start": "1843279",
    "end": "1848399"
  },
  {
    "text": "are going to have as well uh we need to be able to run Magento code as it comes to us from our client uh if you've",
    "start": "1848399",
    "end": "1854640"
  },
  {
    "start": "1850000",
    "end": "1850000"
  },
  {
    "text": "already got a Magento site on some other platform the AWS and you want to migrate it you don't want to have to re-engineer",
    "start": "1854640",
    "end": "1859880"
  },
  {
    "text": "the whole thing to move it across uh we need to be able to manage many Magento sites uh but so do you even if it's just",
    "start": "1859880",
    "end": "1866880"
  },
  {
    "text": "Devon test environments alongside your production environment uh and we need to be able to easily evolve our",
    "start": "1866880",
    "end": "1872840"
  },
  {
    "text": "infrastructure uh that can be as we learn new things and we want to roll that out across our customer base it",
    "start": "1872840",
    "end": "1878679"
  },
  {
    "text": "could be uh as the as our customers grow and we need to step through this process that that Sean's described of",
    "start": "1878679",
    "end": "1885279"
  },
  {
    "text": "identifying bottlenecks and growing out the architecture to support those our standard architecture will",
    "start": "1885279",
    "end": "1892360"
  },
  {
    "text": "look somewhat familiar from earlier in this conversation uh we to call out a couple of differences we don't use read",
    "start": "1892360",
    "end": "1898919"
  },
  {
    "text": "replicas as a standard part of our architecture just because we do need to qualify those with a particular Magento",
    "start": "1898919",
    "end": "1904600"
  },
  {
    "text": "site to make sure it performs correctly uh we also use multiple cloudfront distributions uh that way the um",
    "start": "1904600",
    "end": "1910880"
  },
  {
    "text": "customers browser can have more requests in parallel to get things like CSS and JavaScript and media and so on",
    "start": "1910880",
    "end": "1917919"
  },
  {
    "text": "uh now even at a high level uh there's a lot of moving Parts there in this",
    "start": "1917919",
    "end": "1923000"
  },
  {
    "start": "1920000",
    "end": "1920000"
  },
  {
    "text": "architecture uh we've got the basics uh the cloud front ec2 RDS elb uh but",
    "start": "1923000",
    "end": "1929279"
  },
  {
    "text": "there's a bunch of other resources that you need to be concerned about for security and operational uh reasons the",
    "start": "1929279",
    "end": "1935000"
  },
  {
    "text": "vpcs um elastic IPS Cloud watch alarms and so on and so forth um we needed to",
    "start": "1935000",
    "end": "1941279"
  },
  {
    "text": "have a way of managing all of these disparate pieces as a single Hole uh and",
    "start": "1941279",
    "end": "1946760"
  },
  {
    "text": "that's where we started to use uh AWS cloudfront um I'm not going to go into a",
    "start": "1946760",
    "end": "1952360"
  },
  {
    "text": "great deal of detail about cloudfront uh if you are using it there are a couple of fantastic sessions earlier this week",
    "start": "1952360",
    "end": "1958279"
  },
  {
    "text": "so you should check them out when they go up online uh if you're not familiar with sorry cloud formation not Cloud one",
    "start": "1958279",
    "end": "1964039"
  },
  {
    "text": "uh if you uh are not familiar with it it is a service from Amazon that allows you to describe a bunch of infrastructure as",
    "start": "1964039",
    "end": "1970720"
  },
  {
    "text": "a Json document you feed it into a tool and it will go and make everything for you uh without any pointy click in the",
    "start": "1970720",
    "end": "1977440"
  },
  {
    "text": "web interface required uh when you want to make changes in the future you update your Json document you feed it back into",
    "start": "1977440",
    "end": "1983159"
  },
  {
    "text": "the tool and again it will go and do everything for you when you're getting started out with cloud formation uh the",
    "start": "1983159",
    "end": "1989480"
  },
  {
    "text": "easy way to approach it is to have a single document you open your word processor your text editor uh and you",
    "start": "1989480",
    "end": "1995840"
  },
  {
    "text": "fill things out until you've got all the resources that you need for your Magento site uh if you're not currently using",
    "start": "1995840",
    "end": "2001039"
  },
  {
    "text": "Cloud information that's a fine way to start that's the way that I started um don't let me discourage you from doing that uh but it does have a problem um if",
    "start": "2001039",
    "end": "2008240"
  },
  {
    "text": "you want to make another site that looks exactly like the one that you've already built that's fine not a problem uh great",
    "start": "2008240",
    "end": "2014080"
  },
  {
    "text": "for Devon test environments for example but if you want to evolve your site in some way uh you run into a problem now",
    "start": "2014080",
    "end": "2020679"
  },
  {
    "text": "say you wanted to add a second site uh your first site is just for the US and",
    "start": "2020679",
    "end": "2025880"
  },
  {
    "text": "then you're going to have a second Magento site uh to go International and you want to be able to serve customers",
    "start": "2025880",
    "end": "2031360"
  },
  {
    "text": "from a couple of different countries they've each got their own domain names they each need their own SSL certificates you can't easily use two",
    "start": "2031360",
    "end": "2038320"
  },
  {
    "text": "different SSL certificates on one elb so you're probably going to need to have a slightly different infrastructure with",
    "start": "2038320",
    "end": "2044120"
  },
  {
    "text": "two elbs and different certificates now if you put everything into one template uh the problem here is that you're going",
    "start": "2044120",
    "end": "2050158"
  },
  {
    "text": "to have to copy that template change the one part of it and now you've got two different templates to maintain and if you want to change one of the common",
    "start": "2050159",
    "end": "2056040"
  },
  {
    "text": "parts uh you're going to have to cut and paste that uh that change into both pieces uh it's not really great from a",
    "start": "2056040",
    "end": "2062040"
  },
  {
    "text": "maintenance perspective and obviously uh while it's a small problem the first time you do it over time becomes a big",
    "start": "2062040",
    "end": "2067679"
  },
  {
    "text": "issue uh instead structure your uh your cloud formation into a number of",
    "start": "2067679",
    "end": "2073800"
  },
  {
    "text": "different templates dealing with different concerns of your site and that way if you do need to customize just one layer you only need to have one",
    "start": "2073800",
    "end": "2080280"
  },
  {
    "text": "variation of the templates everything else can be the same and you can go about your Merry",
    "start": "2080280",
    "end": "2086078"
  },
  {
    "text": "way the other thing that is worth mentioning about cloud formation uh an infrastructure's code uh which is a term",
    "start": "2086399",
    "end": "2092839"
  },
  {
    "text": "I'm sure you've all heard over this week uh is the way that it promotes quality now obviously uh code is not magically",
    "start": "2092839",
    "end": "2100200"
  },
  {
    "text": "bug free you do have a process to go through to make sure that you don't have any issues there but uh coming from an",
    "start": "2100200",
    "end": "2105880"
  },
  {
    "text": "operations background and having run books and things to make changes uh I do know the the silly mistakes that you can",
    "start": "2105880",
    "end": "2112680"
  },
  {
    "text": "make if you have to do maintenance out of hours and you're a bit tired and the coffee machine's broken and whatever um",
    "start": "2112680",
    "end": "2118480"
  },
  {
    "text": "so by putting everything into code you can avoid a lot of these kind of issues and one of the examples that we found was when we were starting to run more",
    "start": "2118480",
    "end": "2124920"
  },
  {
    "text": "recent versions of Magento uh version uh the Enterprise version 1.13 onwards and",
    "start": "2124920",
    "end": "2131040"
  },
  {
    "text": "Community 1.18 onwards uh is they started doing some more clever things with the the database they use triggers",
    "start": "2131040",
    "end": "2136440"
  },
  {
    "text": "and Views and so on uh and by default uh RDS won't let you uh create those uh",
    "start": "2136440",
    "end": "2142440"
  },
  {
    "text": "when you come from a random myql dump from another platform so uh we put these parameters into uh into IDs uh into",
    "start": "2142440",
    "end": "2150119"
  },
  {
    "text": "cloud formation uh we had to do that the one time when we first discovered it and then we never have to think about it again it's not a problem that's ever",
    "start": "2150119",
    "end": "2156280"
  },
  {
    "text": "come back so by putting the fixes into your code uh you only need to learn these lessons",
    "start": "2156280",
    "end": "2162040"
  },
  {
    "text": "once um Auto scaling is a really valuable uh part of the AWS platform um",
    "start": "2162040",
    "end": "2168200"
  },
  {
    "text": "over time uh your load increases and decreases and so you want to be able to spin up and tear down servers but it's",
    "start": "2168200",
    "end": "2173839"
  },
  {
    "text": "not always a a gradual uh a gradual change in load um when somebody's sending out a newsletter you can see a",
    "start": "2173839",
    "end": "2179839"
  },
  {
    "text": "great Spike like two times or three times the number of customers hit your site in a period of just a couple of",
    "start": "2179839",
    "end": "2185720"
  },
  {
    "text": "minutes that's the example that we're showing here uh and what you'll typically find if you're not using autoscaling is that the CPU utilization",
    "start": "2185720",
    "end": "2192599"
  },
  {
    "start": "2190000",
    "end": "2190000"
  },
  {
    "text": "across your cluster is going to fairly closely track the number of visitors or hits on the site nothing really uh",
    "start": "2192599",
    "end": "2198520"
  },
  {
    "text": "particularly surprising there now if we take um 80% utilization as a bit of a",
    "start": "2198520",
    "end": "2203960"
  },
  {
    "text": "proxy for where the performance on your site might start to degrade uh this is a problem um you send out the newsletter",
    "start": "2203960",
    "end": "2210720"
  },
  {
    "text": "and suddenly you've got a long period of degraded service just when youve spent a bunch of money to send customers to your site they're having a bad time probably",
    "start": "2210720",
    "end": "2217440"
  },
  {
    "text": "they're going to leave so you need to consider how quickly can you actually scale when Auto scaling needs to kick in",
    "start": "2217440",
    "end": "2223800"
  },
  {
    "text": "uh in this diagram uh the green part is what we get when we start up our instance uh the orange part is what we",
    "start": "2223800",
    "end": "2229640"
  },
  {
    "text": "do as runtime configuration so if you're building uh basic operating system from uh Amazon Linux or or so forth and then",
    "start": "2229640",
    "end": "2235960"
  },
  {
    "text": "adding everything at run time it can take you uh some period of time to get everything up and running perhaps 20 or",
    "start": "2235960",
    "end": "2241200"
  },
  {
    "text": "25 minutes uh depending upon where you're setting your scaleup Tri trigger you might find that while Auto scaling helps",
    "start": "2241200",
    "end": "2247560"
  },
  {
    "text": "you uh minimize the amount of unhappy customers it doesn't remove that uh that consideration entirely you can improve",
    "start": "2247560",
    "end": "2254440"
  },
  {
    "text": "this situation a little bit by starting to bake some more of the software into your Ami so build a custom Ami with uh",
    "start": "2254440",
    "end": "2260800"
  },
  {
    "text": "you know your web server PHP any other tooling that you need uh in this way uh",
    "start": "2260800",
    "end": "2266480"
  },
  {
    "text": "we might find that it takes only 5 minutes to start up a new site and so uh we further reduce the period of",
    "start": "2266480",
    "end": "2272319"
  },
  {
    "text": "unhappiness that uh the customers are going to have when they come to the site can we do better than this well there's",
    "start": "2272319",
    "end": "2278440"
  },
  {
    "text": "a couple of options um one of them is to lower our scale up trigger uh and if you've got to deal with unpredictable",
    "start": "2278440",
    "end": "2284560"
  },
  {
    "text": "spikes in load that and you'd prefer to manage performance at the uh the cost of",
    "start": "2284560",
    "end": "2289800"
  },
  {
    "text": "increased cost that can be a good thing to do but newsletters and other marketing activities are usually planned",
    "start": "2289800",
    "end": "2295119"
  },
  {
    "text": "somebody in your organization knows what's going to go uh what's going to be happening uh they can talk to you ahead of time and you can scale up proactively",
    "start": "2295119",
    "end": "2302319"
  },
  {
    "text": "and if you do this you're effectively using all of your resources without causing any unhappiness to your",
    "start": "2302319",
    "end": "2309480"
  },
  {
    "text": "customers finally I'm going to talk a little bit about deployment um this is a section that I perhaps could have",
    "start": "2309720",
    "end": "2315079"
  },
  {
    "text": "Rewritten in light of uh this week's announcements but uh if you're thinking about using the uh deployment service",
    "start": "2315079",
    "end": "2320880"
  },
  {
    "text": "this will give you some thoughts about how you might want to go about implementing that for Magento the first question that we ended",
    "start": "2320880",
    "end": "2326880"
  },
  {
    "text": "up having when we thought about our own deployment process is should we bake the code in if we bake in all the other",
    "start": "2326880",
    "end": "2332000"
  },
  {
    "text": "software to uh improve the amount of time it takes for us to scale up can't we just bake in the whole Magento code",
    "start": "2332000",
    "end": "2338240"
  },
  {
    "text": "if you've just got one site that might be a good option uh obviously it does mean that when you're deploying you have to go through the whole process of",
    "start": "2338240",
    "end": "2343960"
  },
  {
    "text": "baking an Ami cycling your instances and so on we decided instead that we were just going to build a Ami that knew how",
    "start": "2343960",
    "end": "2351839"
  },
  {
    "text": "to retrieve its code at startup uh what we did in the same way that the deploy service works is to decide that putting",
    "start": "2351839",
    "end": "2358280"
  },
  {
    "text": "the code onto an S3 bucket was the way to go so our deployment architecture looks something like this uh we have a",
    "start": "2358280",
    "end": "2365480"
  },
  {
    "text": "deployment server that coordinates our uh deploy activities we have an S3 bucket which keeps the uh the magenta",
    "start": "2365480",
    "end": "2371520"
  },
  {
    "text": "code in it uh and obviously we have our various stacks of of infrastructure the first step in the",
    "start": "2371520",
    "end": "2377599"
  },
  {
    "text": "deployment process is a developer triggering a deploy um the deployment server could have had code pushed to it",
    "start": "2377599",
    "end": "2383440"
  },
  {
    "text": "by the developer it could retrieve it from a git or subversion repository uh but one way or another after it's",
    "start": "2383440",
    "end": "2388480"
  },
  {
    "text": "triggered it builds a package of code and it uploads that into the deployment bucket now you might be thinking why",
    "start": "2388480",
    "end": "2394960"
  },
  {
    "text": "don't we actually just push the code if deployment servers already got it there uh why why bother going with the bucket",
    "start": "2394960",
    "end": "2400560"
  },
  {
    "text": "in the first place and there's a couple of reasons uh one of them is it's a little bit more efficient uh this way",
    "start": "2400560",
    "end": "2406000"
  },
  {
    "text": "the deployment server only needs to push the bites around once otherwise the network bandwidth requirement for the",
    "start": "2406000",
    "end": "2411200"
  },
  {
    "text": "deployment server would be vastly different if we had two Magento servers running or 200 uh by putting things",
    "start": "2411200",
    "end": "2417480"
  },
  {
    "text": "through an S3 bucket it's constant uh the other issue is that we need to deal with auto scaling um having the",
    "start": "2417480",
    "end": "2423440"
  },
  {
    "text": "deployment server push things when a to a bunch of Maga servers that are running is all fine but uh when other servers",
    "start": "2423440",
    "end": "2429359"
  },
  {
    "text": "start up they need to be able to get the code from somewhere the next consideration is the",
    "start": "2429359",
    "end": "2434520"
  },
  {
    "text": "deployment server needs to know uh where the Magento servers are running uh if you're based on a physical platform you",
    "start": "2434520",
    "end": "2440640"
  },
  {
    "text": "probably know exactly what the IP addresses of your Magento servers are because they don't change very often uh",
    "start": "2440640",
    "end": "2446040"
  },
  {
    "text": "that's not something you can rely upon uh in AWS there's a couple of ways that you can deal with this uh the deployment",
    "start": "2446040",
    "end": "2452040"
  },
  {
    "text": "service lets you uh look at Auto scaling groups or it lets you look at uh tags on your ec2 instances those are both good",
    "start": "2452040",
    "end": "2458800"
  },
  {
    "text": "ways to go we use a system called M Collective which has a published subscribed message cue kind of thing",
    "start": "2458800",
    "end": "2465400"
  },
  {
    "text": "going on uh so the deployment server can broadcast out a message saying uh what are the live Magento servers and get a",
    "start": "2465400",
    "end": "2471520"
  },
  {
    "text": "list back so that's what it does the first thing it does it sends out a message to all of the Magento servers for the environment it's deploying to",
    "start": "2471520",
    "end": "2478000"
  },
  {
    "text": "saying go ahead and prepare the uh the code the Magento servers download that from the S3 bucket and then they unpack",
    "start": "2478000",
    "end": "2484640"
  },
  {
    "text": "it ready for use now the code's not live at that point it's just sitting alongside the code which is",
    "start": "2484640",
    "end": "2490359"
  },
  {
    "text": "live that gives us an opportunity to deal with another problem uh which is magento's upgrade scripts now if you're",
    "start": "2490359",
    "end": "2496480"
  },
  {
    "text": "familiar with uh this process Magento gives you a way of um scripting updates to the site things like schema",
    "start": "2496480",
    "end": "2503280"
  },
  {
    "text": "migrations adding attributes and so on uh the problem is that if you're running in a multi-server environment",
    "start": "2503280",
    "end": "2509119"
  },
  {
    "text": "particularly with a lot of load uh these scripts can run multiple times because Magento on every single hit will look at",
    "start": "2509119",
    "end": "2514760"
  },
  {
    "text": "whether there's any update scripts to run so what we do to avoid this is the deployment server first sends a message",
    "start": "2514760",
    "end": "2521599"
  },
  {
    "text": "to the admin server saying go ahead and running run any pending update scripts now this happens before any customer",
    "start": "2521599",
    "end": "2527560"
  },
  {
    "text": "requests are actually coming to the new code after the update scripts have run we send another request uh another",
    "start": "2527560",
    "end": "2534079"
  },
  {
    "text": "message across to all of the Magento servers to say go ahead switch over to the new code now at this point if you're",
    "start": "2534079",
    "end": "2540880"
  },
  {
    "text": "using the uh magento's merging features for CSS and JavaScript uh new versions",
    "start": "2540880",
    "end": "2546839"
  },
  {
    "text": "of those files are going to be created uh this is because magenta uses the full path to the file uh when it's",
    "start": "2546839",
    "end": "2552319"
  },
  {
    "text": "constructing the hashed file name uh so it's something to be aware of if you're going down the road that uh that Sean",
    "start": "2552319",
    "end": "2558520"
  },
  {
    "text": "has talked about and that we use to push all of your media assets onto S3 you'll need to have some kind of mechanism of",
    "start": "2558520",
    "end": "2564480"
  },
  {
    "text": "pushing these merged files up as well more generally you're going to want to be able to uh either avoid purging",
    "start": "2564480",
    "end": "2571079"
  },
  {
    "text": "objects from the CDN or uh or otherwise dealing with um stale objects on the CDN",
    "start": "2571079",
    "end": "2576760"
  },
  {
    "text": "uh one way recommended by cloudfront is to put a version number uh either in the file name or into the directory name um",
    "start": "2576760",
    "end": "2584960"
  },
  {
    "text": "this is something that uh you can do in Magento by setting the Bas skin URL and the base JavaScript URL for each of your",
    "start": "2584960",
    "end": "2590599"
  },
  {
    "text": "storefronts uh to include the version number that you're deploying when you go ahead uh and",
    "start": "2590599",
    "end": "2597079"
  },
  {
    "text": "you've got the new code running and serving request from the customer you then run some config updates to point",
    "start": "2597079",
    "end": "2602240"
  },
  {
    "text": "out the new version of the directory uh and at that point you can flush the cache and all of the URLs generated by",
    "start": "2602240",
    "end": "2608800"
  },
  {
    "text": "magenta will use this new uh new variable that way you don't actually need to purge anything from the CDN",
    "start": "2608800",
    "end": "2615119"
  },
  {
    "text": "because everything's going to be a new object so we do our reconfiguration uh",
    "start": "2615119",
    "end": "2620920"
  },
  {
    "text": "and then we report back success to the uh developer and we're done so I'm going to end with a little",
    "start": "2620920",
    "end": "2627680"
  },
  {
    "text": "story that I thought was a little bit amusing about a deployment that kind of went wrong kind of went right uh one",
    "start": "2627680",
    "end": "2634160"
  },
  {
    "text": "thing that Magento does is it sizes all of your images for you on the Fly uh you just need to upload a full size image",
    "start": "2634160",
    "end": "2640200"
  },
  {
    "text": "and it will figure out based on your templates what kind of size it uh it wants to be using um one day a customer",
    "start": "2640200",
    "end": "2646960"
  },
  {
    "text": "pushed up a new deployment onto the site and we noticed that the network bandwidth was higher than usual um it's",
    "start": "2646960",
    "end": "2652640"
  },
  {
    "text": "usually see a a spike in network bandwidth when you do a a deployment you clear the cache there's a bunch more new",
    "start": "2652640",
    "end": "2659000"
  },
  {
    "text": "objects to get out of the database and so on uh but this is higher than usual and the CPU load was up for a longer",
    "start": "2659000",
    "end": "2664480"
  },
  {
    "text": "period of time than usual Auto scaling kicked in and added a few more Magento servers uh and we we watched and we",
    "start": "2664480",
    "end": "2670880"
  },
  {
    "text": "thought well let's see what happens here um and in a couple of minutes later autoscaling kicked in again and it it",
    "start": "2670880",
    "end": "2676000"
  },
  {
    "text": "added a few more servers and things were still pegged pretty pretty close to the Limit and it turned out when we dug into",
    "start": "2676000",
    "end": "2681720"
  },
  {
    "text": "this a little bit more that uh our uh our customer had completely redesigned the site they hadn't really worked with",
    "start": "2681720",
    "end": "2687480"
  },
  {
    "text": "us to to you know get ready for that uh and so suddenly they had 20,000 new resized images that they needed to uh to",
    "start": "2687480",
    "end": "2694280"
  },
  {
    "text": "build so uh you know Auto scaling kept on adding servers adding servers we went and added a bunch more uh and in the",
    "start": "2694280",
    "end": "2700920"
  },
  {
    "text": "space of half an hour or so we'd finally caught up and all the new assets have been created and pushed to S3 uh which",
    "start": "2700920",
    "end": "2707119"
  },
  {
    "text": "is great because if they were in a legacy environment um instead of you know adding 20 servers just to get these",
    "start": "2707119",
    "end": "2712800"
  },
  {
    "text": "imagery sizes done uh literally the next two days would have been spent with terrible performance on that site uh as",
    "start": "2712800",
    "end": "2718839"
  },
  {
    "text": "it struggled to keep up so even though Magento is not really designed to run in",
    "start": "2718839",
    "end": "2725040"
  },
  {
    "text": "a cloud environment I do think that AWS is a great platform for it if you build things out the right way it gives you",
    "start": "2725040",
    "end": "2730440"
  },
  {
    "text": "all the tools that you need to uh support the unpredictability of retail uh and of Magento",
    "start": "2730440",
    "end": "2737359"
  },
  {
    "text": "development and now I will bring up Sean to",
    "start": "2737359",
    "end": "2742039"
  },
  {
    "text": "close yes so thank you very much for coming um I just encourage everyone to to please do fill out evaluation forms",
    "start": "2745359",
    "end": "2751720"
  },
  {
    "text": "um and also Zach and I will be out for questions just in the hallway so please do come grabis thanks very much thank",
    "start": "2751720",
    "end": "2759240"
  },
  {
    "text": "you",
    "start": "2759240",
    "end": "2762240"
  }
]