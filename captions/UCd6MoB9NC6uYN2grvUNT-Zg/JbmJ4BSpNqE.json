[
  {
    "start": "0",
    "end": "390000"
  },
  {
    "text": "Al righty let's get started um so you're in uh security 403 which has been titled",
    "start": "6799",
    "end": "12200"
  },
  {
    "text": "building AWS partner applications using IM am roles as I kind of give a little bit of an intro here I have I'm going to",
    "start": "12200",
    "end": "18240"
  },
  {
    "text": "be showing you guys code samples today um because that sounds like a great idea right this is a a 400 level talk so uh",
    "start": "18240",
    "end": "25279"
  },
  {
    "text": "if you've got your laptop open and you feel like going here you can take a look at the source code that's not going to be on the screen which might be easier",
    "start": "25279",
    "end": "30759"
  },
  {
    "text": "for you to read uh and then I'm also going to be showing an open source project that uh my company has built an",
    "start": "30759",
    "end": "37840"
  },
  {
    "text": "open sourc for building um I am policies in Python we think it's a little bit better than writing Json by hand um for",
    "start": "37840",
    "end": "44280"
  },
  {
    "text": "any of you who've ever done it and you know had the whole trailing comma problem um this helps you avoid that um",
    "start": "44280",
    "end": "51000"
  },
  {
    "text": "so I come from this company named bracket Computing I will not going to tell you too much of what we do because I don't think most of you actually",
    "start": "51000",
    "end": "56879"
  },
  {
    "text": "really care in this talk right now but I want to give you a little bit of background because I think it's going to help um kind of give context for where",
    "start": "56879",
    "end": "62680"
  },
  {
    "text": "this talk is coming from um bracket provides um we allow customers to come",
    "start": "62680",
    "end": "69080"
  },
  {
    "text": "to us to sign up for an account we then provision an Amazon account for them behind the scenes uh and then we have",
    "start": "69080",
    "end": "74880"
  },
  {
    "text": "this multi-tenant um control plane or management plane that sits in front of that uh that then acts on behalf of",
    "start": "74880",
    "end": "81759"
  },
  {
    "text": "those customers inside of their own individual Amazon accounts and so this might be familiar to some of you I think",
    "start": "81759",
    "end": "87000"
  },
  {
    "text": "uh some of you in the audience might be doing very similar things or basically ially a customer either you give them an Amazon account or they come to you with",
    "start": "87000",
    "end": "92920"
  },
  {
    "text": "an Amazon account and um you then need to to act inside of that and there are two basic ways to do that we're going to",
    "start": "92920",
    "end": "99399"
  },
  {
    "text": "um talk about one of them I'm going to call one of them an anti- pattern and I'm going to show you the other one um",
    "start": "99399",
    "end": "105560"
  },
  {
    "text": "so the use cases that we're kind of thinking about here today Cloud management platform is is kind of a very",
    "start": "105560",
    "end": "111840"
  },
  {
    "text": "simplified version of of what bracket does we we think we do a whole lot more fun stuff than just that but Cloud",
    "start": "111840",
    "end": "116960"
  },
  {
    "text": "management platform um managing a cloud uh managing other Amazon um customer accounts uh log",
    "start": "116960",
    "end": "125200"
  },
  {
    "text": "analysis is one that comes up a lot I talked to a fair number of of um log analysis vendors and uh they want access",
    "start": "125200",
    "end": "131760"
  },
  {
    "text": "to our log files maybe our log files are in S3 and they come to us uh they go great generate like an access key for us",
    "start": "131760",
    "end": "137319"
  },
  {
    "text": "and here's this IM IM policy you might might use before you generate that access key in the secret access key um",
    "start": "137319",
    "end": "143760"
  },
  {
    "text": "that's another kind of use case for what we're talking about today in general it's just whenever you need to go talk",
    "start": "143760",
    "end": "149080"
  },
  {
    "text": "to another account you you can authenticate with Amazon using one account and then get access to another",
    "start": "149080",
    "end": "154879"
  },
  {
    "text": "one that well that's what we're talking about today how many of you I'm kind of curious and this is like a 400 talk and",
    "start": "154879",
    "end": "160800"
  },
  {
    "text": "thanks for coming out by the way uh I know most of you really feel like you should probably be taking naps and getting ready for the party tonight I",
    "start": "160800",
    "end": "166120"
  },
  {
    "text": "know I kind of wish I was it's been a pretty long day it's 5:30 on Thursday right who went too hard last",
    "start": "166120",
    "end": "171760"
  },
  {
    "text": "night nobody that's why you're all here yeah",
    "start": "171760",
    "end": "177879"
  },
  {
    "text": "uh um great okay we can Dive Right In um",
    "start": "177879",
    "end": "183840"
  },
  {
    "text": "anti-patterns I think I consider an anti-pattern um these are things that you probably don't want to do and I know",
    "start": "183840",
    "end": "189400"
  },
  {
    "text": "that that you know there are exceptions to every rule but in general asking your customers to generate an access key ID",
    "start": "189400",
    "end": "195560"
  },
  {
    "text": "and a secret access key uh copy and paste it put it in some web form and and send it to you um that's I think we're",
    "start": "195560",
    "end": "203440"
  },
  {
    "text": "going to talk about today is a better way of doing it instead uh and really what it comes down to is um you you have",
    "start": "203440",
    "end": "208560"
  },
  {
    "text": "to keep secrets and keeping secrets is really hard right we see um where",
    "start": "208560",
    "end": "213680"
  },
  {
    "text": "companies have been attacked and been compromised all the time um sometimes it's credit card numbers but wow you're",
    "start": "213680",
    "end": "219040"
  },
  {
    "text": "not supposed to store credit card numbers either um sometimes it's passwords where they put the passwords into the database instead of like um",
    "start": "219040",
    "end": "224640"
  },
  {
    "text": "hashing them that's pretty bad in this case you you do actually need to store what is effectively a username and a password and maybe you encrypt it but",
    "start": "224640",
    "end": "231439"
  },
  {
    "text": "the keys are probably sitting on the box right so keeping secrets is really hard and so I'm going to show you how to do this without Keeping a Secret um another",
    "start": "231439",
    "end": "237879"
  },
  {
    "text": "anti- pattern is is asking users for too much um too much permission you you give",
    "start": "237879",
    "end": "243120"
  },
  {
    "text": "them this sample policy and you say hey generate this access key for me or maybe we're going to do AUM roll uh and you do",
    "start": "243120",
    "end": "248640"
  },
  {
    "text": "something like Star I want all the actions um that's you're asking you",
    "start": "248640",
    "end": "253879"
  },
  {
    "text": "potentially maybe you're a cloud management platform and you actually need access to everything but but uh we're going to talk a fair bit today or",
    "start": "253879",
    "end": "258959"
  },
  {
    "text": "we're going to weave in um least privilege wherever we",
    "start": "258959",
    "end": "263880"
  },
  {
    "text": "can um so as we go through this we're actually going to kind of build a really lame application as we go through this",
    "start": "265280",
    "end": "271560"
  },
  {
    "text": "talk right it's it's only 45 minutes and I've got to show it to you on a big screen but um we're going to actually try to build a small Cloud management",
    "start": "271560",
    "end": "277960"
  },
  {
    "text": "platform and so the requirements for this are that we're going to of course act within another Amazon account we want to take on a subset of permissions",
    "start": "277960",
    "end": "283520"
  },
  {
    "text": "this are just the permissions that we require to perform the things that we want to do and we're going to say we're not going to keep any secrets we don't",
    "start": "283520",
    "end": "289759"
  },
  {
    "text": "we don't trust ourselves to keep secrets we don't want to be compromised we don't want to be uh on a KBS on security um",
    "start": "289759",
    "end": "295360"
  },
  {
    "text": "blog post so how are we going to do this this talk really what we're we're going to do today is a deep dive on assum Roll",
    "start": "295360",
    "end": "301520"
  },
  {
    "text": "I think we're going to have a bit of fun with it so this is straight out of the documentation it returns a set of temporary security credentials you can",
    "start": "301520",
    "end": "307199"
  },
  {
    "text": "use these to access other AWS resources um typically um going into someone",
    "start": "307199",
    "end": "312280"
  },
  {
    "text": "else's account now you can of course assume roll into your own account um you can use that to uh maybe you've got a",
    "start": "312280",
    "end": "317840"
  },
  {
    "text": "box running that has a reduced set of privileges but it can then use a sual to get you know use STS get a set of",
    "start": "317840",
    "end": "323120"
  },
  {
    "text": "temporary tokon tokens take on some other set of functionality you can do that as well I don't think I'm going to",
    "start": "323120",
    "end": "328840"
  },
  {
    "text": "show that to you today um but it's the same thing it's just a different trust policy we'll show you trust policies today so what we want to do or what",
    "start": "328840",
    "end": "335720"
  },
  {
    "text": "we're going to do now I already said we're going to dive in we're going to dive in again this is a double dive in right here we're going to describe",
    "start": "335720",
    "end": "341800"
  },
  {
    "text": "instances example so given that a customer comes to us with an account ID and a region we want to be able to go",
    "start": "341800",
    "end": "348199"
  },
  {
    "text": "into that region do a describe instances across those instances and just print out the the instances that are running",
    "start": "348199",
    "end": "353720"
  },
  {
    "text": "in their account so what do we need to do this I assume most of you actually done assume roll or at least looked at",
    "start": "353720",
    "end": "358840"
  },
  {
    "text": "it once or twice so so I'm kind of skipping over some details here but what we need to do is we need to set up an IM",
    "start": "358840",
    "end": "363919"
  },
  {
    "text": "role in the customer account obviously the customer needs to do this the first time so you're going to be able to provide to them hey here's a sample role",
    "start": "363919",
    "end": "371039"
  },
  {
    "text": "obviously they have the the opportunity to edit it hopefully they don't but they could they can also audit it to make sure that you're only taking access to",
    "start": "371039",
    "end": "377360"
  },
  {
    "text": "things that they think you need access to and we also need to establish a trust policy and so what the customer is going",
    "start": "377360",
    "end": "382440"
  },
  {
    "text": "to tell Amazon is hey this role that that grants this set of permissions um I",
    "start": "382440",
    "end": "387560"
  },
  {
    "text": "trust me um um to assume that role and to take on the permissions that that",
    "start": "387560",
    "end": "393080"
  },
  {
    "start": "390000",
    "end": "735000"
  },
  {
    "text": "thing gives all right so let's try this out we're going to press the little button here bam and uh for those of you",
    "start": "393080",
    "end": "399680"
  },
  {
    "text": "in the back just mahes I hope you can read this code uh like I said it's on",
    "start": "399680",
    "end": "405039"
  },
  {
    "text": "it's on GitHub so um what I want to show you first let's show you the customer half so this stuff's on GitHub I'm going",
    "start": "405039",
    "end": "411360"
  },
  {
    "text": "to kind of cruise on through it um it's got some documentation in it um I tried to make it that if you were looking at",
    "start": "411360",
    "end": "417280"
  },
  {
    "text": "this after the talk or maybe you're watching a video um you can go and you can look at the source code and hopefully understand it and learn something from it just by looking at the",
    "start": "417280",
    "end": "423319"
  },
  {
    "text": "code instead of having to listen to Just me um so here we are we're generated an IM policy this is our access policy this",
    "start": "423319",
    "end": "430639"
  },
  {
    "text": "looks an awful lot like something you might type into uh you know the custom policy",
    "start": "430639",
    "end": "436039"
  },
  {
    "text": "section of of IM am um except this is obviously not a string it's not Json this is python this is the awax library",
    "start": "436039",
    "end": "442560"
  },
  {
    "text": "I was telling you about before uh we basically map one: one we just give you a little bit of syntax checking um and and of course you can",
    "start": "442560",
    "end": "450160"
  },
  {
    "text": "use Python to generate these things so here's our access policy it says I'm going to allow um describe instances and",
    "start": "450160",
    "end": "456919"
  },
  {
    "text": "create tags across any resource this is a fairly forgiving policy um we're going",
    "start": "456919",
    "end": "462080"
  },
  {
    "text": "to start to lock things down a little bit more as we go here today uh and now here's our trust policy and this is where when the customer creates this",
    "start": "462080",
    "end": "468520"
  },
  {
    "text": "access policy they throw this trust policy on it at the same time and this says that uh Hey Amazon trust this other",
    "start": "468520",
    "end": "474360"
  },
  {
    "text": "account uh in this case I've defined it as CMP account ID so this is an actual real Amazon account if you guys feel",
    "start": "474360",
    "end": "479800"
  },
  {
    "text": "like trying to break into this violate somebody's terms of service agreement um so here's an AR specifying that account",
    "start": "479800",
    "end": "487120"
  },
  {
    "text": "ID this is our trust policy it says you're allowed to call AUM roll uh and who's allowed to do it who's the principal in this case it's the cloud",
    "start": "487120",
    "end": "493000"
  },
  {
    "text": "management platform it's us great and so when I run the script for you today we're going to print these things out so you can kind of get a feel for like what",
    "start": "493000",
    "end": "499840"
  },
  {
    "text": "aox is doing it's it's actually not a whole lot but it's still really nice to use uh there's also included in GitHub",
    "start": "499840",
    "end": "506400"
  },
  {
    "text": "um that I guess is open source now um is this little module called am I am utils and what",
    "start": "506400",
    "end": "513959"
  },
  {
    "text": "we're doing here is um this is a lot simpler than using BTO obviously I'm just wrapping up a bunch of Bot calls to",
    "start": "513959",
    "end": "520000"
  },
  {
    "text": "uh update the or to create this trust policy and to attach that access policy to it uh so here today when I'm running",
    "start": "520000",
    "end": "526200"
  },
  {
    "text": "all of these things you can see that I have two terminals open this one on the right is for the customer side and this one over on the left is the CMP or the",
    "start": "526200",
    "end": "532200"
  },
  {
    "text": "cloud management platform so when I run this I'm using uh my customer credentials so I can just say customer",
    "start": "532200",
    "end": "538560"
  },
  {
    "text": "setup go and as I told you it's going to print out the access policy it's going to print out the trust policy and here's",
    "start": "538560",
    "end": "544760"
  },
  {
    "text": "a little print statement showing that we actually added this thing that's basically it so this is the part that your customer is going to do when they",
    "start": "544760",
    "end": "550440"
  },
  {
    "text": "sign up for your service now we come over to the CMP side what would we have to",
    "start": "550440",
    "end": "555760"
  },
  {
    "text": "do uh on the CM now we actually want to use this",
    "start": "555760",
    "end": "561320"
  },
  {
    "text": "we've got the CMP what's the software we've written to actually call AUM roll well this is it um we need the account",
    "start": "561320",
    "end": "567079"
  },
  {
    "text": "ID of the customer we need to know the name of the role so when you give that customer that access policy they need to name it in a in a particular way",
    "start": "567079",
    "end": "573320"
  },
  {
    "text": "otherwise you'll never be able to find it uh in this case we've called it easy describe uh we're going to use STS to",
    "start": "573320",
    "end": "579360"
  },
  {
    "text": "get uh temporary tokens uh given that information we can put together the orn of the role that",
    "start": "579360",
    "end": "585279"
  },
  {
    "text": "we're going to assume uh and then we call in this case we're using Botto we've created an STS connection and",
    "start": "585279",
    "end": "590360"
  },
  {
    "text": "we're going to assume that role um the two required Arguments for assume roll and we're going to actually go in in",
    "start": "590360",
    "end": "595480"
  },
  {
    "text": "pretty deep here on the the various requirements to assume roll the first one is the AR that you're uh assuming and the second one is the",
    "start": "595480",
    "end": "601560"
  },
  {
    "text": "rooll session name and we're going to show you this um quite a bit in a little bit and how this applies to auditing um",
    "start": "601560",
    "end": "607399"
  },
  {
    "text": "what your customers can see what you can see when these things show up in for example Cod Trail logs um once we've",
    "start": "607399",
    "end": "613000"
  },
  {
    "text": "gotten our assumed role our temporary credentials we can then go back to Botto and say cool now I want an ec2",
    "start": "613000",
    "end": "618600"
  },
  {
    "text": "connection uh I want to go to West two uh here are my access key my secret and my token uh that came back from assumed",
    "start": "618600",
    "end": "625760"
  },
  {
    "text": "rooll and once we have that now we're just in straight up bot land right we have our ec2 connection object great",
    "start": "625760",
    "end": "631640"
  },
  {
    "text": "called get only instances which is basically doing describe instances we're going to Loop over those instances print the ID and some tag information why not",
    "start": "631640",
    "end": "640000"
  },
  {
    "text": "uh what I've also done here is to kind of as we when this is executing I'll show you some of the fun stuff that",
    "start": "640000",
    "end": "646000"
  },
  {
    "text": "comes back from that assumed roll call uh I'm not going to print out any secrets for us today but uh here's the access key ID um your STS when you call",
    "start": "646000",
    "end": "654040"
  },
  {
    "text": "into STS these things expire this is the like the iso format time for when that thing expires this is the Arn of the",
    "start": "654040",
    "end": "661240"
  },
  {
    "text": "this is the AR of the um user that you're now acting as inside of that",
    "start": "661240",
    "end": "666680"
  },
  {
    "text": "other account and this is the uh the RO ID and so you get to see what all those look like when I run",
    "start": "666680",
    "end": "673480"
  },
  {
    "text": "this sweet so what did we do we ran remember we were going to Loop over the all of the instances and print the",
    "start": "673480",
    "end": "678880"
  },
  {
    "text": "instance IDs here's our instance ID here are the tags that are attached to that instance currently um we have a name",
    "start": "678880",
    "end": "685320"
  },
  {
    "text": "security 403 demo machine yeah created just for this uh and tag named key with",
    "start": "685320",
    "end": "690959"
  },
  {
    "text": "a value of value I got really creative when I was doing this stuff uh access key here's the expiration again ISO",
    "start": "690959",
    "end": "696120"
  },
  {
    "text": "timeout ISO format time um in UTC if somebody wants to do the",
    "start": "696120",
    "end": "702320"
  },
  {
    "text": "math it's probably about uh 30 minutes from now that's the default value for the expiration and these are the values",
    "start": "702320",
    "end": "709000"
  },
  {
    "text": "for the things that I described a moment ago so that's uh that's describe instances this is super right there are",
    "start": "709000",
    "end": "715760"
  },
  {
    "text": "um given the the sheer number of people in the room you know normally there's questions after the fact but I mean if",
    "start": "715760",
    "end": "721320"
  },
  {
    "text": "you guys want to make this fun I'm totally willing to make this fun you guys can like raise your hand or start",
    "start": "721320",
    "end": "726680"
  },
  {
    "text": "yelling stuff like man let's go let's make this interesting um so if you guys",
    "start": "726680",
    "end": "731800"
  },
  {
    "text": "have questions or want to interject go for it so far so good we'll keep",
    "start": "731800",
    "end": "738199"
  },
  {
    "start": "735000",
    "end": "913000"
  },
  {
    "text": "rolling great that was our describe instances example where we going next we already went to the console sual",
    "start": "738199",
    "end": "744199"
  },
  {
    "text": "parameters here we go we're going into all of them there are here are four and then I think we're",
    "start": "744199",
    "end": "749560"
  },
  {
    "text": "going to talk about two or three other ones in in extreme depth so the easy ones the ones that are totally obvious",
    "start": "749560",
    "end": "754639"
  },
  {
    "text": "you read the docs you get it right so the duration you pass in a duration this is how long that those temporary",
    "start": "754639",
    "end": "759720"
  },
  {
    "text": "credentials that you get back uh are going to be valid for the minimum time is 15 minutes the maximum time is an hour on the maximum time there's nothing",
    "start": "759720",
    "end": "766199"
  },
  {
    "text": "I can do to help you if you need them longer than an hour you're just going to have to call AUM roll again um bracket of course has to do this we have this",
    "start": "766199",
    "end": "771680"
  },
  {
    "text": "control plane it's continuously running it's continually getting uh continuously acting on behalf of customers um we uh",
    "start": "771680",
    "end": "779680"
  },
  {
    "text": "look at the expiration time on the credentials if we think they're about to expire I think the threshold is 2 minutes we assume well it would be",
    "start": "779680",
    "end": "785839"
  },
  {
    "text": "pretty bad if we were like halfway through some transaction or through some operation all of a sudden our credentials expired so we consider 2",
    "start": "785839",
    "end": "791480"
  },
  {
    "text": "minutes a threshold and at that point we start renewing credentials instead of using them something to consider if you",
    "start": "791480",
    "end": "796760"
  },
  {
    "text": "are bumping up against the end of your expiration time um if you want to go shorter than 900 seconds Amazon won't do",
    "start": "796760",
    "end": "802199"
  },
  {
    "text": "it for you but I'm going to show you an example towards the end here where you can tell Amazon this policy is valid so long as the time is less than this time",
    "start": "802199",
    "end": "809160"
  },
  {
    "text": "time now you've got to trust your clock and you've got to trust that Amazon's clock is in sync with yours but you might also know that like TLS for",
    "start": "809160",
    "end": "815079"
  },
  {
    "text": "example doesn't work if clocks aren't correct so you can rest assured your clock is probably kind of accurate um",
    "start": "815079",
    "end": "820760"
  },
  {
    "text": "but you can actually make this go shorter I'm going to give you an example where we have credentials for two minutes instead of 15 minutes um the",
    "start": "820760",
    "end": "826079"
  },
  {
    "text": "roll AR I showed you it in that last example you've got to build an AR that effectively the the key pieces of",
    "start": "826079",
    "end": "831360"
  },
  {
    "text": "information there are the customer ID and the name of the role that you're assuming uh if you're doing",
    "start": "831360",
    "end": "837519"
  },
  {
    "text": "MFA uh you need to tell Amazon which MFA you're using if you've got a jamalo right you",
    "start": "837519",
    "end": "843240"
  },
  {
    "text": "saw them down in the expo center today you need the serial number of your jamalo and you need the the the code that's currently on the screen if you're",
    "start": "843240",
    "end": "849000"
  },
  {
    "text": "using Google Authenticator it's the current code uh and you need to give the AR the Arn is",
    "start": "849000",
    "end": "855279"
  },
  {
    "text": "pretty straightforward okay so now we're going to have more fun with um these",
    "start": "855279",
    "end": "860440"
  },
  {
    "text": "parameters the the policy parameter you can pass in what you're able to do here is to actually step down your",
    "start": "860440",
    "end": "865680"
  },
  {
    "text": "permissions um you when a customer created that access policy initially you handed it to them you said great these",
    "start": "865680",
    "end": "871920"
  },
  {
    "text": "are all the things I need to do but maybe when you actually go to a call assume role uh maybe you're a cloud management platform you need the ability",
    "start": "871920",
    "end": "877720"
  },
  {
    "text": "to launch instances from time to time but maybe this time the call you're about to make all you're going to do is describe instances when we think about",
    "start": "877720",
    "end": "883399"
  },
  {
    "text": "least privilege we think about where are those credentials cashed and we think about what could happen in the event of a compromise of course nobody wants to",
    "start": "883399",
    "end": "889480"
  },
  {
    "text": "be compromised we never think it'll happen to us but what if so in this case what you can do when you call a sual is",
    "start": "889480",
    "end": "894959"
  },
  {
    "text": "you can pass in um an additional policy that's going to say these are the credentials that I actually want now you",
    "start": "894959",
    "end": "900680"
  },
  {
    "text": "can only step down you can't Step Up of course that'd be like violating some trust with your customers um but you can",
    "start": "900680",
    "end": "906279"
  },
  {
    "text": "reduce your set of privileges such that those credentials um you limit what can happen if an",
    "start": "906279",
    "end": "912199"
  },
  {
    "text": "attacker gets a hold of them um I think I covered",
    "start": "912199",
    "end": "919680"
  },
  {
    "start": "913000",
    "end": "1366000"
  },
  {
    "text": "this and we have an example who's excited for this",
    "start": "919680",
    "end": "925680"
  },
  {
    "text": "example yes yes everybody code I like you guys are getting into",
    "start": "925680",
    "end": "930959"
  },
  {
    "text": "this go Ben go dude in the pink shirt",
    "start": "930959",
    "end": "940440"
  },
  {
    "text": "yes you know and so that's an interesting question at bracket we don't",
    "start": "981480",
    "end": "987199"
  },
  {
    "text": "um okay so I'm going to repeat the question Ben's basically asking um when you go to set up access policies I've",
    "start": "987199",
    "end": "993880"
  },
  {
    "text": "just kind of said your customer does this uh and I've left it as an exercise for the audience to figure out how to tell your customer how to do that um and",
    "start": "993880",
    "end": "1000720"
  },
  {
    "text": "that's basically what it is at bracket because we control the customer account in addition to to the bracket account",
    "start": "1000720",
    "end": "1007560"
  },
  {
    "text": "we're able to initially we don't actually do this after the initial bootstrapping but we're able to initially log in one of those accounts",
    "start": "1007560",
    "end": "1014199"
  },
  {
    "text": "using Botto and some scripts it's all automated of course and um create these policies establish trust back to the ban",
    "start": "1014199",
    "end": "1020800"
  },
  {
    "text": "production account um that's what we're able to do if you're in that same situation I would recommend doing that",
    "start": "1020800",
    "end": "1026199"
  },
  {
    "text": "uh if you're not and you have real customers maybe you are that log Analysis company you've got the free trial you sign up um you know building a",
    "start": "1026199",
    "end": "1032199"
  },
  {
    "text": "set of instructions that show your customers uh how to set up the access policies where to put in the trust policy I've seen um vendors or other",
    "start": "1032199",
    "end": "1040120"
  },
  {
    "text": "Amazon partners that do that um that's certainly an option uh if you had a customer that were a little more Savvy",
    "start": "1040120",
    "end": "1046160"
  },
  {
    "text": "and maybe you were pretty sure they had Python and bought installed um then you could give them a python script that",
    "start": "1046160",
    "end": "1051400"
  },
  {
    "text": "would do it like the one I wrote here and and set it up automatically um I guess kind of the options are somewhat",
    "start": "1051400",
    "end": "1057520"
  },
  {
    "text": "Limitless it's just how much work do you want to do how Savvy is your customer base are they capable of running scripts",
    "start": "1057520",
    "end": "1063240"
  },
  {
    "text": "are they capable of writing scripts or do you just need to teach them how to log into the console real quick and I think it depends on it varies based on",
    "start": "1063240",
    "end": "1070280"
  },
  {
    "text": "your customer and potentially if your customer base is very uh diverse maybe you can give them all three options kind",
    "start": "1070280",
    "end": "1076080"
  },
  {
    "text": "of depends",
    "start": "1076080",
    "end": "1079200"
  },
  {
    "text": "yes we're always thinking about least privilege yes what's the least amount of privilege we need to perform the operation we're going to do obviously",
    "start": "1083840",
    "end": "1090000"
  },
  {
    "text": "you guys need to consider performance requirements how often am I calling AUM roll if I every single time I do what I",
    "start": "1090000",
    "end": "1095280"
  },
  {
    "text": "call a su roll and do a step down policy for exactly what I'm about to do on the next line of code that's probably not going to scale you're probably not",
    "start": "1095280",
    "end": "1100919"
  },
  {
    "text": "actually providing any security benefit there either now all you're doing is managing lots of credentials and um",
    "start": "1100919",
    "end": "1107080"
  },
  {
    "text": "that's not very fun okay",
    "start": "1107080",
    "end": "1113640"
  },
  {
    "text": "um clear these out so now we're running in the second stage I've named these",
    "start": "1113640",
    "end": "1119320"
  },
  {
    "text": "things that I can't possibly mess up right so for number two here all we're going to look at is CMP usage we already",
    "start": "1119320",
    "end": "1124799"
  },
  {
    "text": "set up the customer side of the account we're going to use the roles that we set up already",
    "start": "1124799",
    "end": "1130400"
  },
  {
    "text": "cool some of this should look really familiar we Define you know what do you need to call the Su roll well you need to have the customer ID you need to have",
    "start": "1130400",
    "end": "1136360"
  },
  {
    "text": "the name of the role that you're doing we assemble this into an arm we create an STS connection pretty straightforward",
    "start": "1136360",
    "end": "1142200"
  },
  {
    "text": "uh I told you we were going to do something where we're going to step um make our policy instead of having that minimum of 15 minutes in this case we're",
    "start": "1142200",
    "end": "1147840"
  },
  {
    "text": "actually making it two and so we do a little bit of math here where we tell um python to put together an ISO formatted",
    "start": "1147840",
    "end": "1153840"
  },
  {
    "text": "string except python doesn't actually know what ISO format is so we have to manually append the Z to the end uh",
    "start": "1153840",
    "end": "1159720"
  },
  {
    "text": "we're going to put together an ISO formatted time string and we're going to tell Amazon down here in our access policy our step down policy the you can",
    "start": "1159720",
    "end": "1167120"
  },
  {
    "text": "do all of the things in this policy so so long as the the date the current time is less than the time I'm giving you so",
    "start": "1167120",
    "end": "1172799"
  },
  {
    "text": "I'm going to assemble this date or this time stamp I'm going to say it's 2 minutes in the future this policy only works if we're within that two-minute",
    "start": "1172799",
    "end": "1179840"
  },
  {
    "text": "period uh and the gist of what we're trying to do in this example is we're going to try to tag an instance um",
    "start": "1179840",
    "end": "1186679"
  },
  {
    "text": "pretty straightforward you saw when we set up that initial customer policy it had two permissions one was describe instances the other was called create",
    "start": "1186679",
    "end": "1193720"
  },
  {
    "text": "Tex um what we're going to do in our step down policy to kind of prove to you that this stuff works is we're going to take away our ability to call create",
    "start": "1193720",
    "end": "1199960"
  },
  {
    "text": "tags and then we're going to try to set tags and what do you think is going to happen right this demo is going to go off without a hitch we're going to get an unauthorized operation yep and that's",
    "start": "1199960",
    "end": "1207640"
  },
  {
    "text": "what's going to happen in this case when we catch that exception coming out of Auto we're going to print out that we were unable to set the tags then we're",
    "start": "1207640",
    "end": "1213200"
  },
  {
    "text": "going to go and we're going to call assume roll so that was where we're here we're doing assume roll with the reduced access policy great here we're calling",
    "start": "1213200",
    "end": "1218919"
  },
  {
    "text": "assume roll taking on the full policy we're going to call that same function again create tags we're going to see",
    "start": "1218919",
    "end": "1224280"
  },
  {
    "text": "that it actually worked ask you guys to bet me that'd be kind of fun on right could step this",
    "start": "1224280",
    "end": "1230200"
  },
  {
    "text": "step this up a little bit totally kidding anyway exactly what I said was",
    "start": "1230200",
    "end": "1235280"
  },
  {
    "text": "going to happen we try with the reduceed Privileges uh unauthorized operation we weren't able to set the tags now we're trying with a full Privileges and it",
    "start": "1235280",
    "end": "1241919"
  },
  {
    "text": "worked um you can see that I kind of cheated I've been running this all day making sure that it's actually going to work and so I forgot to clear the tags",
    "start": "1241919",
    "end": "1248480"
  },
  {
    "text": "on this instance before the demo that's why you see it in both cases um you could actually run these scripts",
    "start": "1248480",
    "end": "1254400"
  },
  {
    "text": "yourself if you wanted to you'd probably just have to change the Amazon IDs yeah",
    "start": "1254400",
    "end": "1260240"
  },
  {
    "text": "kind of like an eventually consistent like an eventually consistent kind of operation so you have creds and then you",
    "start": "1271360",
    "end": "1276480"
  },
  {
    "text": "go back to Amazon and they say never",
    "start": "1276480",
    "end": "1280080"
  },
  {
    "text": "mind yeah I think I understand so yeah the gist of it would you would call a su roll you get back that three Tuple of",
    "start": "1284360",
    "end": "1290760"
  },
  {
    "text": "credential information on the next line you'd create that ec2 connection object you maybe go to call describe instances and Amazon comes back and says these",
    "start": "1290760",
    "end": "1297080"
  },
  {
    "text": "credentials are invalid I've never seen them before yeah um we um it's really interesting to ask that question I don't",
    "start": "1297080",
    "end": "1303600"
  },
  {
    "text": "think that it it's generally a problem for us um we've probably seen it I have",
    "start": "1303600",
    "end": "1309360"
  },
  {
    "text": "a feeling that we have and it kind of just falls into the noise for us yeah it wouldn't surprise me at all",
    "start": "1309360",
    "end": "1316840"
  },
  {
    "text": "kind of given the distributed nature of of how Amazon does everything that they do that there is potential for a little bit of latency there um I am being one",
    "start": "1316840",
    "end": "1324080"
  },
  {
    "text": "of the services that's usually pretty tight um wouldn't surprise me at all we probably have seen it we don't generally",
    "start": "1324080",
    "end": "1331679"
  },
  {
    "text": "run into it it's not generally a problem for us because um we're caching the credentials so we we cash them in memory",
    "start": "1331679",
    "end": "1338880"
  },
  {
    "text": "so we do is we go off and we ask Amazon for 60 Minute creds because that's as long as they let us go although 60 Minutes seems like a pretty good number",
    "start": "1338880",
    "end": "1344760"
  },
  {
    "text": "anyway uh we go off and we ask them for 60-minute creds we store them in we're python shop on the on the control plane",
    "start": "1344760",
    "end": "1351120"
  },
  {
    "text": "um so we're going to store them in a python dictionary we've got a fun little data structure that's going to help us um keep track of when credentials are",
    "start": "1351120",
    "end": "1356559"
  },
  {
    "text": "about to expire and um kind of like behind the scenes go back and and get new credits so that's something that",
    "start": "1356559",
    "end": "1362320"
  },
  {
    "text": "we've done to so if you get it the first time it'll work the second time is kind of what's happening for us",
    "start": "1362320",
    "end": "1370278"
  },
  {
    "start": "1366000",
    "end": "1399000"
  },
  {
    "text": "uh no but I'm going to show you at the very end when we put all this together where we're using like um so we're an",
    "start": "1381919",
    "end": "1387120"
  },
  {
    "text": "Amazon shop as well so our control plan is all running Amazon we're using ec2 instance profiles to specify and we're",
    "start": "1387120",
    "end": "1392320"
  },
  {
    "text": "multi-tenant as well so um the the service nodes they're going to be calling AUM roll need the ability to do",
    "start": "1392320",
    "end": "1398039"
  },
  {
    "text": "it across all of our customers so actually we're in the customer ID field for I'll show you that that policy it'll",
    "start": "1398039",
    "end": "1403679"
  },
  {
    "text": "be it's uh you'll see where we Grant assum roll access to ourselves",
    "start": "1403679",
    "end": "1409880"
  },
  {
    "text": "the next parameter that we're going to kind of dive into is R session name and this one you would think is kind of fairly boring right you've seen in my",
    "start": "1409880",
    "end": "1416240"
  },
  {
    "text": "example so far I just kept typing in like security 403 demo or this is the roll session name um it's actually",
    "start": "1416240",
    "end": "1422120"
  },
  {
    "text": "really fun so there are some limitations here and and you can read those all by yourself but the real fun part is that",
    "start": "1422120",
    "end": "1427520"
  },
  {
    "text": "this is useful for auditing it's going to show up in your cloud trail logs in um in two different places um one of the",
    "start": "1427520",
    "end": "1435640"
  },
  {
    "text": "things where where we use this so there's let's kind of step away from our our CMP example for a moment and pretend",
    "start": "1435640",
    "end": "1442760"
  },
  {
    "text": "maybe you have some other kind of application where you take in users come to your platform whatever it may be and",
    "start": "1442760",
    "end": "1448760"
  },
  {
    "text": "maybe it's just a script that your operations staff are running um they've authenticated with that somehow maybe",
    "start": "1448760",
    "end": "1453919"
  },
  {
    "text": "against a an active directory server an ldap server whatever and you you have user identity information at that point",
    "start": "1453919",
    "end": "1459480"
  },
  {
    "text": "and you call aumr and you start acting inside of that Amazon account and you've You've Lost That identity information",
    "start": "1459480",
    "end": "1464720"
  },
  {
    "text": "one of the things you can do is you can take like the user ID that you got from your eler app thing when you call AUM",
    "start": "1464720",
    "end": "1470120"
  },
  {
    "text": "roll uh you can make the role session name contain that user ID and now all of a sudden you have kind of like this",
    "start": "1470120",
    "end": "1475480"
  },
  {
    "text": "continuity when you get into your audit logs you get into cloud trail and you're saying like who who called describe instance create tags or did whatever it",
    "start": "1475480",
    "end": "1481039"
  },
  {
    "text": "was that was granted by the assumer RO call um you're going to be able to see who is actually doing it without having",
    "start": "1481039",
    "end": "1486360"
  },
  {
    "text": "to really unwind or or like artificially generate logs in some way um so uh we do",
    "start": "1486360",
    "end": "1493880"
  },
  {
    "text": "that so stain with roll session name where does it appear so if you've got cloud trail enabled your account you're",
    "start": "1493880",
    "end": "1499039"
  },
  {
    "text": "calling assum roll of course cloud trail is logging the fact that you called assum roll it shows all the parameters that you passed into the assume roll",
    "start": "1499039",
    "end": "1505240"
  },
  {
    "text": "call roll session name hi Mom hi Mom is the example here uh now what's happening inside of",
    "start": "1505240",
    "end": "1511320"
  },
  {
    "text": "your customer account um so you have this user identity which is an Arn that",
    "start": "1511320",
    "end": "1517640"
  },
  {
    "text": "says it's an and you can the the ellipses there is really truncated there's more stuff in there that I didn't think was important um the role",
    "start": "1517640",
    "end": "1525760"
  },
  {
    "text": "name that you assumed uh I think in our case so far we've been using something called easy describe so it would be easy describe there for rle name and then the",
    "start": "1525760",
    "end": "1532240"
  },
  {
    "text": "hon part that's the that's the RO session name um so when you type something in here just I the joke I like",
    "start": "1532240",
    "end": "1537880"
  },
  {
    "text": "to tell people is when you put um a roll session name in there maybe one of your customers has been misbehaving and you're mad at them and you type in",
    "start": "1537880",
    "end": "1544640"
  },
  {
    "text": "something mean about your customer to say this is the role session name we would never do this you shouldn't either just your customer can see it be careful",
    "start": "1544640",
    "end": "1551960"
  },
  {
    "text": "uh does show up in both P both places that's kind of what I'm trying to tell you uh and um",
    "start": "1551960",
    "end": "1560240"
  },
  {
    "text": "auditing this is just a further example of what's coming out of cloud trail it's going to tell you at what time what Ro",
    "start": "1561960",
    "end": "1568159"
  },
  {
    "text": "was being used again the RO session name so when you're auditing things you can go through we do um depending on the",
    "start": "1568159",
    "end": "1573760"
  },
  {
    "text": "tool that was being used in this case you see the prefix is admin Hub or ADM Hub it stands for admin and hub um",
    "start": "1573760",
    "end": "1579640"
  },
  {
    "text": "that's kind of the name of the application that was doing stuff and then the username of the person that was actually performing that",
    "start": "1579640",
    "end": "1585399"
  },
  {
    "text": "operation uh I've kind of blanked out the customer the Amazon IDs in this case but uh everything else here is straight",
    "start": "1585399",
    "end": "1591520"
  },
  {
    "text": "out of cloud trail uh we're assuma logic shop I don't know if any else of you are this is and",
    "start": "1591520",
    "end": "1598640"
  },
  {
    "text": "you're just going to have to paste this out of the slides if they get posted somewhere uh if you're a su logic shop and you want to look in your uh cloud",
    "start": "1598640",
    "end": "1605559"
  },
  {
    "text": "trail logs this is one of the things that we do to kind of parse those out and you can have fun with this as well um AWS Eagle of course was the code name",
    "start": "1605559",
    "end": "1612399"
  },
  {
    "start": "1610000",
    "end": "1722000"
  },
  {
    "text": "for cloud trail before it got launched last year at reinvent I think it was all right external ID this is going",
    "start": "1612399",
    "end": "1617960"
  },
  {
    "text": "to be really fun one uh external ID is a pre-shared secret between you and your customer uh and it's used to prevent",
    "start": "1617960",
    "end": "1624760"
  },
  {
    "text": "what Amazon uh and security researchers would call the confused Deputy problem um what is a confused Deputy uh it's a",
    "start": "1624760",
    "end": "1631960"
  },
  {
    "text": "computer Pro program that is innocently fooled by some other party into misusing its Authority so um let's do this let's",
    "start": "1631960",
    "end": "1639360"
  },
  {
    "text": "uh let's confuse the deputy uh assume that we're we're building this Cloud management platform that we've been talking about so far today um and the",
    "start": "1639360",
    "end": "1646520"
  },
  {
    "text": "the difference so I've talked a little bit about bracket bracket controls the customer account this problem actually doesn't apply to bracket but if you are",
    "start": "1646520",
    "end": "1653360"
  },
  {
    "text": "one of those Cloud uh or Cloud one of those log analysis platforms or or something else where a customer brings",
    "start": "1653360",
    "end": "1658559"
  },
  {
    "text": "their own Amazon account to you um this is really important um you want to really make sure you're using external",
    "start": "1658559",
    "end": "1664159"
  },
  {
    "text": "ID you want to make sure you're using it correctly to try to walk you through it so um",
    "start": "1664159",
    "end": "1669679"
  },
  {
    "text": "imagine You've Got This Cloud management platform or customers bring their own Amazon account they come to you they",
    "start": "1669679",
    "end": "1675519"
  },
  {
    "text": "fill out their name their email address and they paste in their 12 digit Amazon account ID great this is pretty straightforward unfortunately at this",
    "start": "1675519",
    "end": "1681679"
  },
  {
    "text": "point once we click the Go Button we're already kind of we're busted uh but you could you click the Go Button great um",
    "start": "1681679",
    "end": "1688159"
  },
  {
    "text": "and now all of a sudden you show the customer and these are the instructions that Ben was asking about earlier um here are your instructions thanks for",
    "start": "1688159",
    "end": "1694200"
  },
  {
    "text": "signing signing up go log into your account use this as the access policy um Amazon's going to prompt you for a",
    "start": "1694200",
    "end": "1700279"
  },
  {
    "text": "12-digit ID paste this one in right this is this is a very uh succinct version of those instructions I I wouldn't",
    "start": "1700279",
    "end": "1706440"
  },
  {
    "text": "recommend using these for your customers um the gist of it the real the key thing here is that I've said to leave the",
    "start": "1706440",
    "end": "1712480"
  },
  {
    "text": "external ID field blank this is where now we've officially confused the deputy and I went and I found this picture in",
    "start": "1712480",
    "end": "1718120"
  },
  {
    "text": "the public domain so that I was allowed to use it here today in this presentation there's a deputy he's confused just like an all the episodes",
    "start": "1718120",
    "end": "1725159"
  },
  {
    "text": "right yeah yeah good all right so we've been owned so at this point what what's",
    "start": "1725159",
    "end": "1731720"
  },
  {
    "text": "possible is that an attacker um the gist of it U we never",
    "start": "1731720",
    "end": "1737600"
  },
  {
    "text": "authentic indicated that the person providing that 12-digit Amazon ID actually owned or was uh in control of",
    "start": "1737600",
    "end": "1743519"
  },
  {
    "text": "that account and so what can happen is maybe one of your legitimate customers comes along signs up gives you your",
    "start": "1743519",
    "end": "1748559"
  },
  {
    "text": "12-digit ID goes through the process of creating the access policy and setting up trust they're all set to trust you",
    "start": "1748559",
    "end": "1753960"
  },
  {
    "text": "that's great now they log into your platform and they perform all these operations using the functionality that",
    "start": "1753960",
    "end": "1760360"
  },
  {
    "text": "you provide great now the attacker comes along all the attacker needs to do to compromise that customer via your",
    "start": "1760360",
    "end": "1766320"
  },
  {
    "text": "platform is determine the 12 ID of the customer now these aren't generally",
    "start": "1766320",
    "end": "1771760"
  },
  {
    "text": "regarded as Secrets I was allowed to put them in the slides those are real account IDs I've been using today right Amazon doesn't treat those as Secrets",
    "start": "1771760",
    "end": "1777760"
  },
  {
    "text": "we're allowed to kind of talk about them um it's highly probable that this could",
    "start": "1777760",
    "end": "1783360"
  },
  {
    "text": "be stolen I guess as my point an attacker comes along provides somebody else's Amazon account ID we don't",
    "start": "1783360",
    "end": "1789679"
  },
  {
    "text": "validate that they actually own that account ID and now all a sudden our platform is giving access to this",
    "start": "1789679",
    "end": "1794880"
  },
  {
    "text": "attacker down into uh someone else's Amazon account um this is kind of funny",
    "start": "1794880",
    "end": "1801399"
  },
  {
    "text": "right this is this is actually reasonably difficult to explain I think the um is this making sense do you guys",
    "start": "1801399",
    "end": "1808720"
  },
  {
    "text": "maybe maybe",
    "start": "1808720",
    "end": "1812600"
  },
  {
    "text": "um I guess the again the gist of it the Crux of it is that we need to authenticate that the person coming to",
    "start": "1814760",
    "end": "1820799"
  },
  {
    "text": "us actually owns that account because if we don't we can be confused as a deputy into granting access to that account um",
    "start": "1820799",
    "end": "1828279"
  },
  {
    "text": "to somebody that shouldn't have access to that account basically the person that actually controls that account set up all this trust and says oh you're um",
    "start": "1828279",
    "end": "1836080"
  },
  {
    "text": "This Cloud management platform or this log analysis platform I totally trust you guys to go look at all my log files and I trust that you're going to",
    "start": "1836080",
    "end": "1842000"
  },
  {
    "text": "properly protect access to that that you're not going to become compromised um but if we're not using external ID",
    "start": "1842000",
    "end": "1847799"
  },
  {
    "text": "and I'll show you how to use it in a second then we're um allowing anyone to come along with any 12-digit ID that has",
    "start": "1847799",
    "end": "1854039"
  },
  {
    "text": "already signed up for our service that's the one prerequisite um and we just grant them access uh as another way to",
    "start": "1854039",
    "end": "1860519"
  },
  {
    "text": "to you can almost solve this problem um if you imagine that when a customer signs up they give you that 12-digit ID",
    "start": "1860519",
    "end": "1866639"
  },
  {
    "text": "maybe you're using just a standard relational database you put a unique on the Amazon ID right now what you've done",
    "start": "1866639",
    "end": "1872039"
  },
  {
    "text": "is you've said well only the first person to come along I wouldn't recommend doing that we should just use external ID that's the best practice but",
    "start": "1872039",
    "end": "1878120"
  },
  {
    "text": "you can kind of Imagine like is that as a potential solution maybe that helps illustrate what the problem actually",
    "start": "1878120",
    "end": "1883880"
  },
  {
    "text": "is so what went wrong we never verified that they actually own the account okay so how do we uh how do we avoid",
    "start": "1884799",
    "end": "1891799"
  },
  {
    "text": "confusing ourselves or confusing the deputy so all I've done we have that same form in the beginning that says",
    "start": "1891799",
    "end": "1897519"
  },
  {
    "text": "give me your name your email address and your 12-digit account ID great the difference is that in our instructions we generate in this case I used a uid or",
    "start": "1897519",
    "end": "1904320"
  },
  {
    "text": "uid version 4 for those of you that really care you can validate it it's a real one um we just generate some random",
    "start": "1904320",
    "end": "1911720"
  },
  {
    "text": "stuff and we give that to the customer now what the customer needs to do is they need to take that external ID and give it to Amazon and what this is",
    "start": "1911720",
    "end": "1917960"
  },
  {
    "text": "actually doing if you any of you have ever set up like Google sites or something like that where they say well you need to verify there are Web Master",
    "start": "1917960",
    "end": "1923880"
  },
  {
    "text": "tools you need to verify that you actually own this domain before we allow you to like control the SEO around it",
    "start": "1923880",
    "end": "1929200"
  },
  {
    "text": "it's very very similar so we're going to ask our customers to take that random bit in our",
    "start": "1929200",
    "end": "1936360"
  },
  {
    "start": "1934000",
    "end": "2046000"
  },
  {
    "text": "case of UI uuid 128 bits and and put it down in there to prove that they own the",
    "start": "1936360",
    "end": "1941679"
  },
  {
    "text": "account so now what's going to happen is that um when we call AUM roll we need to pass",
    "start": "1941679",
    "end": "1948120"
  },
  {
    "text": "in that external ID so we generated that uu ID we're storing it in a database somewhere U we call a su roll we",
    "start": "1948120",
    "end": "1953600"
  },
  {
    "text": "generate the r on that contains the customer ID we know the role that we want to assume and then we also toss in that external ID and that's saying that",
    "start": "1953600",
    "end": "1961440"
  },
  {
    "text": "uh only if the person that actually owned that account and that had the ability to create this role and to set up the trust and to paste in that same",
    "start": "1961440",
    "end": "1967639"
  },
  {
    "text": "external ID that we have um we know we're talking to the right one the attacker comes along let's go through",
    "start": "1967639",
    "end": "1973000"
  },
  {
    "text": "that same scenario the attacker comes along signs up for the service pastes in the wrong 12-digit account ID we we generate a brand new unique external ID",
    "start": "1973000",
    "end": "1981320"
  },
  {
    "text": "now when we call AUM roll to try to get into that other account that they're not supposed to have access to we use the wrong external ID Amazon says no no you",
    "start": "1981320",
    "end": "1988240"
  },
  {
    "text": "don't have access to do this that's how this is working to prevent the attack and I",
    "start": "1988240",
    "end": "1995200"
  },
  {
    "text": "yeah oh so when they log in assuming that and I'm kind of imagining all this in my head I know it's not totally",
    "start": "1998279",
    "end": "2003919"
  },
  {
    "text": "explicit imagine you have like a a row in the database that's kind of like a customer ID and then this external ID",
    "start": "2003919",
    "end": "2009559"
  },
  {
    "text": "and so when the customer comes in and authenticates maybe you've got like a session cookie that stores the session or the customer ID you go to the",
    "start": "2009559",
    "end": "2015559"
  },
  {
    "text": "database you exchange the session ID for the external ID so that's still going to work if the correct customer is logged",
    "start": "2015559",
    "end": "2021519"
  },
  {
    "text": "in we go to grab that external ID we get the right one uh versus when the the attacker comes in and logs in their",
    "start": "2021519",
    "end": "2028519"
  },
  {
    "text": "customer ID is associated with a different external ID the assume roll call",
    "start": "2028519",
    "end": "2033679"
  },
  {
    "text": "fails it's yeah it's it's a little tricky I the good news is if you guys want to like run through this on your",
    "start": "2034000",
    "end": "2039240"
  },
  {
    "text": "own um this example that we're going to show next as we also kind of slide into a slightly different topic um it's going",
    "start": "2039240",
    "end": "2046919"
  },
  {
    "start": "2046000",
    "end": "2140000"
  },
  {
    "text": "to show how we use external ID you could then take this code sample and um play with it and try to understand",
    "start": "2046919",
    "end": "2054358"
  },
  {
    "text": "further it it's a it's a tricky concept to explain um and then once you get it you're like oh yeah it's totally obvious",
    "start": "2054359",
    "end": "2060158"
  },
  {
    "text": "uh which is why I'm actually having kind of struggled a little bit to explain it to you",
    "start": "2060159",
    "end": "2065359"
  },
  {
    "text": "guys the external ID",
    "start": "2065440",
    "end": "2069720"
  },
  {
    "text": "it's not so much a secret as that the customer is not allowed to control it so it could be public uh it could be public",
    "start": "2073520",
    "end": "2079800"
  },
  {
    "text": "information what needs to not be allowed is that if the attacker discovers that external ID and can somehow change in",
    "start": "2079800",
    "end": "2086800"
  },
  {
    "text": "your platform that this customer ID has this external ID so if the attacker's customer ID could be associated with the",
    "start": "2086800",
    "end": "2093919"
  },
  {
    "text": "correct external ID that would be bad and that's why kind of one of the key pieces of this is that you need you as",
    "start": "2093919",
    "end": "2099960"
  },
  {
    "text": "the CMP need to generate the external ID you can't let the customer choose it like don't let them type in their",
    "start": "2099960",
    "end": "2106000"
  },
  {
    "text": "mother's maiden name or something like that okay so now we're going to go",
    "start": "2106000",
    "end": "2111640"
  },
  {
    "text": "earlier I said we were going to talk about ec2 instance profiles and how we call AUM roll this is where we're going to do it we're going to talk putting all",
    "start": "2111640",
    "end": "2118119"
  },
  {
    "text": "this together it's going to be amazing ready yeah yeah I'm trying to",
    "start": "2118119",
    "end": "2124040"
  },
  {
    "text": "have a little bit of fun geez don't do that we're going to build our Cloud",
    "start": "2124040",
    "end": "2130560"
  },
  {
    "text": "management platform on AWS we're going to use easy2 instance profiles how many of you guys are and girls are using easy2 instance",
    "start": "2130560",
    "end": "2136520"
  },
  {
    "text": "profiles one two three probably some others that just don't feel like raising their hand because who wants to raise",
    "start": "2136520",
    "end": "2142440"
  },
  {
    "start": "2140000",
    "end": "2437000"
  },
  {
    "text": "their hand at a conference um and the other thing we're going to look at here is the something",
    "start": "2142440",
    "end": "2148200"
  },
  {
    "text": "that I like to do that I think is a good best practice is to um you know the closer you are to the edge of the",
    "start": "2148200",
    "end": "2153440"
  },
  {
    "text": "internet the closer you are to an unprivileged attacker the few your uh",
    "start": "2153440",
    "end": "2159079"
  },
  {
    "text": "privilege you want associated with that so if I'm developing kind of like a standard architecture in Amazon and I've",
    "start": "2159079",
    "end": "2165319"
  },
  {
    "text": "got my elb up there going into a web server autoscaling group there's some other load balancer that's in front of",
    "start": "2165319",
    "end": "2170960"
  },
  {
    "text": "my app tier dropping messages into sqs further isolating them away from worker nodes right on the left side of this",
    "start": "2170960",
    "end": "2177480"
  },
  {
    "text": "diagram we want to not have much privilege right the ability to call a sual from your web server into any of",
    "start": "2177480",
    "end": "2182720"
  },
  {
    "text": "your customer accounts and take on any access if we look at like the number of attacks that occur on the internet especially the publish publish sized",
    "start": "2182720",
    "end": "2189280"
  },
  {
    "text": "ones it's like oh well it was the vulnerability in the web application and then like they got root somehow okay so",
    "start": "2189280",
    "end": "2194640"
  },
  {
    "text": "if you root your web server and it has ec2 instance profiles and it's allowed to call a suum roll that's that's bad your web",
    "start": "2194640",
    "end": "2202079"
  },
  {
    "text": "application is now gating all of the functionality that's behind it it kind of like sidesteps all of the controls",
    "start": "2202079",
    "end": "2207400"
  },
  {
    "text": "you've potentially put into your web application uh your app tier in this case what we're going to show you is that the app tier has a little bit more",
    "start": "2207400",
    "end": "2213480"
  },
  {
    "text": "privilege and this is a fairly contrived example um to kind of make this fit into some slides uh the app tier has a little",
    "start": "2213480",
    "end": "2219520"
  },
  {
    "text": "bit more privilege and then you go behind sqs where you think you've got to like serialize data it's going to be really hard for an attacker to do fun",
    "start": "2219520",
    "end": "2225240"
  },
  {
    "text": "things behind a queue the workers then get all of the privilege and manam we're going back to",
    "start": "2225240",
    "end": "2231160"
  },
  {
    "text": "some code I know you guys get really excited when we go to the code so got to contain it for a little bit we're almost",
    "start": "2231160",
    "end": "2238240"
  },
  {
    "text": "done though we got eight minutes left uh what does the customer have to",
    "start": "2238240",
    "end": "2245160"
  },
  {
    "text": "do again there's a little bit of documentation so you guys can if you're not completely keeping up with me uh you",
    "start": "2245880",
    "end": "2251359"
  },
  {
    "text": "can come back and look at this later uh I tried to document it it's in GitHub you could send me messages say dude I",
    "start": "2251359",
    "end": "2256880"
  },
  {
    "text": "don't understand what you were talking about tell me more I'd be happy to help you guys out um we're going to generate",
    "start": "2256880",
    "end": "2262119"
  },
  {
    "text": "two policies one's a readon access policy it's allowed to call describe instances this is a modifying instances",
    "start": "2262119",
    "end": "2267240"
  },
  {
    "text": "policy it can start and stop instances we're going to build a really basic application here that's not going to use a queue but we're going to pretend that",
    "start": "2267240",
    "end": "2273119"
  },
  {
    "text": "it does it's able to start and stop instances and then here is a trust policy and so here's where we're using",
    "start": "2273119",
    "end": "2279839"
  },
  {
    "text": "this is how the trust policy is actually encoded if you go to Amazon and kind of like run through the guey it's just going to ask you it paste in the",
    "start": "2279839",
    "end": "2285680"
  },
  {
    "text": "external ID what they're actually doing for you behind the scenes is generating a trust policy looks like this condition",
    "start": "2285680",
    "end": "2291319"
  },
  {
    "text": "string equals external ID the random thing that we generated this is where we set up those",
    "start": "2291319",
    "end": "2297520"
  },
  {
    "text": "two policies inside of the customer account so if we call this customer setup it",
    "start": "2297520",
    "end": "2303920"
  },
  {
    "text": "worked uh there's two pieces to do on the",
    "start": "2303920",
    "end": "2309119"
  },
  {
    "text": "uh CMP side one is the ec2 instance profiles and I put a lot of docks in",
    "start": "2309119",
    "end": "2314240"
  },
  {
    "text": "here because I I I'm reasonably passionate about this part so I typed more um we're going to",
    "start": "2314240",
    "end": "2320440"
  },
  {
    "text": "do um we have two different access policies I'll talk about the app tier first even though it falls down here",
    "start": "2320440",
    "end": "2325599"
  },
  {
    "text": "lower we're going to say that the app tier so what the app tier was going to do is it was going to be able to uh",
    "start": "2325599",
    "end": "2330640"
  },
  {
    "text": "describe instances so it needs to be able to call a sual and get that readon access policy it also needs to be able",
    "start": "2330640",
    "end": "2335680"
  },
  {
    "text": "to generate messages and drop them into the the que so it needs to be able to send a message into the sqs um and we're",
    "start": "2335680",
    "end": "2341200"
  },
  {
    "text": "limiting it it's not just you can call send message anywhere you want we're saying you can only do it against the queue we've specified up above great",
    "start": "2341200",
    "end": "2347319"
  },
  {
    "text": "worker access policy means a little bit more permission we're going to say that it is allowed to call assume Roll But",
    "start": "2347319",
    "end": "2353079"
  },
  {
    "text": "against the modify instances role so this is where we're saying you further down you go the more access you're",
    "start": "2353079",
    "end": "2359200"
  },
  {
    "text": "allowed to get when you call assum roll and this is how we enforce that you're also allowed to call receive message",
    "start": "2359200",
    "end": "2365119"
  },
  {
    "text": "against sqs against the queue that we specified here sweet and we create those",
    "start": "2365119",
    "end": "2372559"
  },
  {
    "text": "policies sweet then putting it all together and",
    "start": "2373760",
    "end": "2380200"
  },
  {
    "text": "actually calling AUM roll and we just got really short and I guess I got lazy here's where we're this is kind of like that database row that I talked about",
    "start": "2380200",
    "end": "2385960"
  },
  {
    "text": "before this is the customer ID we're mapping it to the external ID that we generated before so that when we call aume roll we're doing that right here we",
    "start": "2385960",
    "end": "2393119"
  },
  {
    "text": "know which external ID to use um get our credentials we an ec2 connection and",
    "start": "2393119",
    "end": "2399359"
  },
  {
    "text": "we're going to stop that instance made this really short so it",
    "start": "2399359",
    "end": "2405560"
  },
  {
    "text": "fits and we stopped it I could show you that in the console if you really wanted to see it I don't think that's all that",
    "start": "2406920",
    "end": "2412240"
  },
  {
    "text": "valuable uh that is all I wanted to show you guys do you have any questions on",
    "start": "2412240",
    "end": "2417920"
  },
  {
    "text": "this second half and then I can like flip over and show you my that's the end you guys have any more",
    "start": "2417920",
    "end": "2425839"
  },
  {
    "text": "questions I'll also hang around afterwards so uh",
    "start": "2425839",
    "end": "2431280"
  },
  {
    "text": "if you don't want to yell and have it be recorded through the microphone I can talk to you um",
    "start": "2431280",
    "end": "2437960"
  },
  {
    "text": "independently great thanks guys",
    "start": "2439160",
    "end": "2443799"
  }
]