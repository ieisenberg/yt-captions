[
  {
    "text": "um so i guess we'll go ahead and kick things off uh i'm trotter cashing you guys",
    "start": "960",
    "end": "6640"
  },
  {
    "text": "are watching me speak about deploying the league of legends data pipeline with chef if that was not your intention uh you",
    "start": "6640",
    "end": "13040"
  },
  {
    "text": "may want to leave now or hang out uh hopefully you'll be good and you'll enjoy yourself uh i'm an engineering manager at riot",
    "start": "13040",
    "end": "19439"
  },
  {
    "text": "games a little bit about us uh we make a video game called league of legends uh it's played",
    "start": "19439",
    "end": "25760"
  },
  {
    "text": "on pc and mac we launched in 2009. uh it's a team ointed game so you're",
    "start": "25760",
    "end": "31039"
  },
  {
    "text": "playing with other people it's five versus five and you're trying to destroy the enemy team's base and you you control this one champion to do so",
    "start": "31039",
    "end": "38320"
  },
  {
    "text": "we have over 100 plus champions you can play as and i think it's a lot of fun that's why i work at the company so here's a dude",
    "start": "38320",
    "end": "43760"
  },
  {
    "text": "playing it you can kind of see it over there he's you know moving his champion around using some effect right now having a good time",
    "start": "43760",
    "end": "49360"
  },
  {
    "text": "uh for the context of this talk i'll be covering how we deployed our data pipeline and",
    "start": "49360",
    "end": "55039"
  },
  {
    "text": "that data pipeline does about 7 billion events per day uh we test it up test it at up to 70",
    "start": "55039",
    "end": "60719"
  },
  {
    "text": "billion events a day uh we have a seven petabyte game event data set we have over 100 plus tables",
    "start": "60719",
    "end": "66159"
  },
  {
    "text": "in our hive database um we're dealing with a large amount of data",
    "start": "66159",
    "end": "71520"
  },
  {
    "text": "right this is not a trivial system that i was working on on the weekend i'll be talking about something that we've actually done in",
    "start": "71520",
    "end": "77280"
  },
  {
    "text": "production and that is still running in production our agenda today is we'll just do",
    "start": "77280",
    "end": "82960"
  },
  {
    "text": "kind of continue this little overview we got going on uh then we'll get into some core concepts that are foundational to the final three",
    "start": "82960",
    "end": "89600"
  },
  {
    "text": "parts which is really a case study and how we used uh chef along with aws to make our lives",
    "start": "89600",
    "end": "94960"
  },
  {
    "text": "a lot better so we kind of took a three-step approach in doing so we started off we're like we know nothing about aws",
    "start": "94960",
    "end": "101680"
  },
  {
    "text": "but we know chef solo and we know chef okay fine we'll just do chef solo and we'll try and make this work with aws",
    "start": "101680",
    "end": "107040"
  },
  {
    "text": "we then moved on we're like okay managing all this stuff is hard will you try out chef server chef server got us a little bit further",
    "start": "107040",
    "end": "113119"
  },
  {
    "text": "but we had a few problems there and we eventually moved on to a golden image based approach where we're doing that with amis but you could use it with",
    "start": "113119",
    "end": "120240"
  },
  {
    "text": "any golden image type of thing you wanted right you want to use docker containers find use docker containers",
    "start": "120240",
    "end": "125840"
  },
  {
    "text": "so we'll kind of go through all those things as we get there as i said this is based on real world usage",
    "start": "125840",
    "end": "132000"
  },
  {
    "text": "i was even though i'm an engineering manager now and spend all my time in outlook doing no useful work at all",
    "start": "132000",
    "end": "138560"
  },
  {
    "text": "back then a year ago from april 2012 to 2013 i was actually",
    "start": "138560",
    "end": "143760"
  },
  {
    "text": "a software engineer doing real work on the big data team and so myself and another guy aaron fung we were the",
    "start": "143760",
    "end": "150720"
  },
  {
    "text": "two kind of you know how people say devops and they really mean ops we we were kind of the bordering the",
    "start": "150720",
    "end": "157440"
  },
  {
    "text": "line between devops and ops guys on this project building out a nice automated deployment pipeline so that we could handle",
    "start": "157440",
    "end": "164080"
  },
  {
    "text": "the who knows how much traffic we're going to get when we turn on a data pipeline this also incorporates a little bit of",
    "start": "164080",
    "end": "169920"
  },
  {
    "text": "extra work that i've done as part of the player accounts team and in this role i'm actually an engineering manager so i'm not really",
    "start": "169920",
    "end": "176239"
  },
  {
    "text": "getting hands-on i'm more just kind of talking with my team about how they can better handle their deployments to aws",
    "start": "176239",
    "end": "183599"
  },
  {
    "text": "so to really kick this off um we i want to ask what do we want from an",
    "start": "183599",
    "end": "188720"
  },
  {
    "text": "automated infrastructure right we were sitting there we're going okay we need a data pipeline uh we know we need to automate our",
    "start": "188720",
    "end": "193840"
  },
  {
    "text": "deployments but what does that mean right what do we need it to actually do i don't want to just go off on like some",
    "start": "193840",
    "end": "200400"
  },
  {
    "text": "techno technological happy land where we build some magical thing that is of no use",
    "start": "200400",
    "end": "207040"
  },
  {
    "text": "to us we just built it because it was cool and so to really answer that question right we have to ask what do we want to be able to do",
    "start": "207040",
    "end": "214239"
  },
  {
    "text": "for our players right building an ultimate infrastructure just for fun",
    "start": "214239",
    "end": "219920"
  },
  {
    "text": "who cares you really want to do it because your players need some value from it it's going to give some value to what you're delivering to your",
    "start": "219920",
    "end": "225519"
  },
  {
    "text": "players or in maybe your cases if you're not making a game just to your users in general right",
    "start": "225519",
    "end": "231680"
  },
  {
    "text": "so in our case what our players want is they want to be able to play league of legends they they came to us for one reason only",
    "start": "231680",
    "end": "238239"
  },
  {
    "text": "they want to play a game so we want to make sure that we minimize unplanned downtime because that means",
    "start": "238239",
    "end": "244239"
  },
  {
    "text": "people aren't playing the game though in the context of the data pipeline obviously they're still going to play the game so what it really means is we aren't",
    "start": "244239",
    "end": "250560"
  },
  {
    "text": "collecting cool data that will allow us to make the game better for them so we always want to be up so we're",
    "start": "250560",
    "end": "256320"
  },
  {
    "text": "always getting this cool this interesting data about you know who killed who in the jungle right now so that we can",
    "start": "256320",
    "end": "262320"
  },
  {
    "text": "make sure that we make the game better so we want to make sure that downtime doesn't happen we want to make sure that",
    "start": "262320",
    "end": "267680"
  },
  {
    "text": "we do rolling deploys because that lets us minimize our planned downtime if you're doing rolling deploys you don't need to bring the service down",
    "start": "267680",
    "end": "273600"
  },
  {
    "text": "when you do a deploy people are happier we also want to make sure we can expand capacity on a whim",
    "start": "273600",
    "end": "279120"
  },
  {
    "text": "as i said when we first started building this data pipeline we had no idea how much traffic we would do and",
    "start": "279120",
    "end": "285840"
  },
  {
    "text": "that's the whole reason we went to aws in the first place because we went to our ops team we said hey we're building a data pipeline we're going to collect some data",
    "start": "285840",
    "end": "291919"
  },
  {
    "text": "and they said how many boxes do you need and we said we don't know how about 10. and they said oh 10 okay",
    "start": "291919",
    "end": "297919"
  },
  {
    "text": "that'll be like a week or two we're like oh well what happens when we need 10 more because we were wrong like well that's gonna be another week",
    "start": "297919",
    "end": "303919"
  },
  {
    "text": "or two and we say oh well we can't handle we can't have that right we need to be able to expand capacity on a whim",
    "start": "303919",
    "end": "309280"
  },
  {
    "text": "so that when another team comes to us and says i really want to track this really cool stat we don't have to say no you have to wait",
    "start": "309280",
    "end": "315280"
  },
  {
    "text": "a few weeks while we get more boxes the other thing that players really want is new features right so",
    "start": "315280",
    "end": "322160"
  },
  {
    "text": "you don't want to spend all your time working on your automated infrastructure because that's time you're not spending",
    "start": "322160",
    "end": "329039"
  },
  {
    "text": "uh delivering value to your customers right if you're spending all your time worrying about deploys you're not running that interesting new feature so",
    "start": "329039",
    "end": "335199"
  },
  {
    "text": "that you can collect that new bit of data or analyze it in an interesting way so it really needs to be a low maintenance system one that once",
    "start": "335199",
    "end": "341199"
  },
  {
    "text": "you have it set up you don't have to worry about you also want to make sure that there's a low barrier for new services",
    "start": "341199",
    "end": "347840"
  },
  {
    "text": "it's decently well accepted these days that service oriented architectures are pretty good for building nicely",
    "start": "347840",
    "end": "354479"
  },
  {
    "text": "encapsulated relatively decoupled uh applications you know you add a new feature",
    "start": "354479",
    "end": "359759"
  },
  {
    "text": "and sweet you don't have to go change all your other code to make it work but if your automated infrastructure",
    "start": "359759",
    "end": "366000"
  },
  {
    "text": "structure if your deployment system is so complex and so difficult to use and it's so hard to add a new service",
    "start": "366000",
    "end": "371039"
  },
  {
    "text": "because you have to go write for freaking chef cookbooks to do so you're not going to do it you're going to say screw that i'm not making a new",
    "start": "371039",
    "end": "377759"
  },
  {
    "text": "service i'm just going to shoehorn it into the existing service and you're left with a monolithic platform",
    "start": "377759",
    "end": "383280"
  },
  {
    "text": "so this is another thing we really want our deployment tools to do is to make it easy for us to go okay i've got a new service no big",
    "start": "383280",
    "end": "390080"
  },
  {
    "text": "deal let me just like write six lines of code and magic it's on the internet right this is what heroku did really well heroku said do a",
    "start": "390080",
    "end": "396639"
  },
  {
    "text": "git push success you're running and we want the same thing from what we're deploying internally on",
    "start": "396639",
    "end": "402639"
  },
  {
    "text": "our own so the core of this is really the system should always be up and easy to deploy",
    "start": "402639",
    "end": "408400"
  },
  {
    "text": "and like no obviously that's what we want um but it's good to examine it in that",
    "start": "408400",
    "end": "413840"
  },
  {
    "text": "more fine grain view as we'll see as we go further because always up easy to deploy is a little more nuanced",
    "start": "413840",
    "end": "420160"
  },
  {
    "text": "so now i want to get into some core concepts these are really core to the way that we view aws and i figure a lot of you guys use",
    "start": "420160",
    "end": "426800"
  },
  {
    "text": "aws quite a bit so some of it you may go oh yeah i know that some of it may be new to start off with",
    "start": "426800",
    "end": "433199"
  },
  {
    "text": "let's just talk about the underlying components so that when i use weird acronyms we all know what's going on so if we've",
    "start": "433199",
    "end": "438720"
  },
  {
    "text": "got a player and he's playing the game and he you know kills some dude in a fierce battle and we want to track you",
    "start": "438720",
    "end": "445120"
  },
  {
    "text": "know how much damage was dealt and who killed him he's playing this game and that needs that data is going to need to go to the elb",
    "start": "445120",
    "end": "452800"
  },
  {
    "text": "and the elb is just the elastic load balancer and it's going to say okay sweet i'm going to send this somewhere and that elb is running in the elastic",
    "start": "452800",
    "end": "458560"
  },
  {
    "text": "compute cloud ec2 and then the data is going to go off to one of many vpcs so",
    "start": "458560",
    "end": "463680"
  },
  {
    "text": "you have one vpc per availability zone and it's going to pick one of those and",
    "start": "463680",
    "end": "468960"
  },
  {
    "text": "head to availably zone a or b or c or whatever now when we actually provision the",
    "start": "468960",
    "end": "474639"
  },
  {
    "text": "system we may store assets internally those assets in order to get them we're going to go through the virtual private",
    "start": "474639",
    "end": "479759"
  },
  {
    "text": "gateway which is our vpn connection back to the data center there's also some cases where we're pulling assets off s3",
    "start": "479759",
    "end": "486319"
  },
  {
    "text": "and in the case of our data pipeline storing a lot of data on s3 and s3 is just a simple storage service",
    "start": "486319",
    "end": "491919"
  },
  {
    "text": "nice buckets away we go now i want to cover data center versus",
    "start": "491919",
    "end": "497199"
  },
  {
    "text": "the cloud so this is a concept that we struggled with when we first started using aws is that",
    "start": "497199",
    "end": "503759"
  },
  {
    "text": "it's very easy to say okay i'm using aws fantastic i'm in the cloud and i'm going to argue",
    "start": "503759",
    "end": "509919"
  },
  {
    "text": "that you're not quite you kind of are right but you're likely treating as a data center and what you're doing is you're saying",
    "start": "509919",
    "end": "516000"
  },
  {
    "text": "hey i'm going to behave with amazon the same way i would behave with an ops team i'm going to say i need x number of",
    "start": "516000",
    "end": "521599"
  },
  {
    "text": "boxes please give them to me so to illustrate this let's talk about the case where you've got two web",
    "start": "521599",
    "end": "526880"
  },
  {
    "text": "servers and three game servers that you want to be running let's say i just need two web servers and three game servers in the",
    "start": "526880",
    "end": "532880"
  },
  {
    "text": "data center approach what you're going to do is you're going to say hey that's five boxes i need five machines please",
    "start": "532880",
    "end": "539360"
  },
  {
    "text": "and you're gonna get five machines so this is the same thing as going into aws and saying give me five instances",
    "start": "539360",
    "end": "544640"
  },
  {
    "text": "you know ec2 start instances five and then you're going to say okay i'm going to go in",
    "start": "544640",
    "end": "549839"
  },
  {
    "text": "there and i'm going to install a web server on two i'm going to install a game server on three of them great maybe you did that manually maybe",
    "start": "549839",
    "end": "556240"
  },
  {
    "text": "you did it with bash maybe you did it with chef but the core here is that you installed it all yourself",
    "start": "556240",
    "end": "562160"
  },
  {
    "text": "after the instance is booted now one day you've realized you've hit 85 cpu usage",
    "start": "562160",
    "end": "568640"
  },
  {
    "text": "and you say okay guess we need more boxes because we're going to hit capacity soon we're going to start 503",
    "start": "568640",
    "end": "573920"
  },
  {
    "text": "and that's going to be bad okay well we need to go get one more box and we need to install a web server on",
    "start": "573920",
    "end": "579200"
  },
  {
    "text": "it now we're good right so really you're still in this world of capacity planning of thinking like",
    "start": "579200",
    "end": "584480"
  },
  {
    "text": "okay i'm at this amount of load i need this many boxes i need to be well aware of that",
    "start": "584480",
    "end": "590240"
  },
  {
    "text": "and this has some benefits uh no chef is required that's nice you don't have to have",
    "start": "590240",
    "end": "596000"
  },
  {
    "text": "automated provisioning you can go do it by hand when you're just getting started this is a really easy way to think about things",
    "start": "596000",
    "end": "601120"
  },
  {
    "text": "it's very similar to the way that you already do it and it's the way we started when we started with chef solo we're like okay",
    "start": "601120",
    "end": "606959"
  },
  {
    "text": "sweet start some instances run chef solo uh when we initially moved with chef server like",
    "start": "606959",
    "end": "613040"
  },
  {
    "text": "just playing and learning that you can do like knife ec2 start for chef solo you can do knife solo",
    "start": "613040",
    "end": "618640"
  },
  {
    "text": "provision right these are the easy ways you do it with chef and with knife",
    "start": "618640",
    "end": "623519"
  },
  {
    "text": "the downside though is it is manual scaling and there's this operational overhead you have to be thinking about",
    "start": "623839",
    "end": "628880"
  },
  {
    "text": "when do we scale when do we not if a service goes down in the night someone has to wake up and start it again",
    "start": "628880",
    "end": "634320"
  },
  {
    "text": "right it doesn't automatically restart now contrast this with the auto scaling cloud model right i put",
    "start": "634320",
    "end": "640399"
  },
  {
    "text": "auto scaling on the front so you're not just like oh cloud hi it's all the cloud whatever um no we're talking about one that auto",
    "start": "640399",
    "end": "646320"
  },
  {
    "text": "scales and in this model what you have to do is instead of saying i want five boxes you say here is what it means to be a",
    "start": "646320",
    "end": "653360"
  },
  {
    "text": "web server and here is what it means to be a game server maybe do that with an ami maybe do it with userdata.sh but in some",
    "start": "653360",
    "end": "660560"
  },
  {
    "text": "way you say this is what it means to be that and then you go to amazon and you say hey",
    "start": "660560",
    "end": "665760"
  },
  {
    "text": "buddy what's up i want like two to four web servers i want three to six game servers or three",
    "start": "665760",
    "end": "671120"
  },
  {
    "text": "to five game servers whatever just give them to me and then amazon goes okay cool minimum two uh minimum of three",
    "start": "671120",
    "end": "677519"
  },
  {
    "text": "we're good to go i've started them for you and now if one dies it'll automatically restart because you've hooked up your elb to do",
    "start": "677519",
    "end": "683360"
  },
  {
    "text": "health checks against a good health check url not one that just says okay one that checks and says like",
    "start": "683360",
    "end": "689200"
  },
  {
    "text": "hey is the disk full can i actually talk the databases i need to talk to it's checking against that if it returns",
    "start": "689200",
    "end": "695120"
  },
  {
    "text": "no then you've also hooked up your auto scaling group to say hey if the elb says this thing's",
    "start": "695120",
    "end": "700560"
  },
  {
    "text": "not healthy i should kill it and start it again and this can all happen because you've told amazon",
    "start": "700560",
    "end": "706079"
  },
  {
    "text": "this is what it means to be a web server and this is what it means to be a game server so the big benefits here automatic",
    "start": "706079",
    "end": "711519"
  },
  {
    "text": "scaling yay perfect if we need to scale up in the middle of the night because a lot of people in china want to play a game uh we can we don't have to worry",
    "start": "711519",
    "end": "718560"
  },
  {
    "text": "about it but you do require automated provisioning you can't do this by hand you can't say oh sweet auto scale but",
    "start": "718560",
    "end": "724880"
  },
  {
    "text": "call me and i'll come in and manually type yum install that doesn't work",
    "start": "724880",
    "end": "730399"
  },
  {
    "text": "so the next concept i want to cover is userdata.sh with userdata.sh uh this is basically",
    "start": "730399",
    "end": "737040"
  },
  {
    "text": "a convention that a lot of amis have standard on that if your user data which is a piece of metadata you can apply to",
    "start": "737040",
    "end": "743360"
  },
  {
    "text": "a running instance between instance when you start it um if that user data starts with a shebang then it will automatically run",
    "start": "743360",
    "end": "749600"
  },
  {
    "text": "that so let's look at this in the context of a simple goal we want to publish hello world",
    "start": "749600",
    "end": "755360"
  },
  {
    "text": "instantly and automatically to the internet just a simple web server like have apache running and an html file that just says hello",
    "start": "755360",
    "end": "761680"
  },
  {
    "text": "world because who doesn't like to say hello world so what will happen is on first boot of your instance",
    "start": "761680",
    "end": "768240"
  },
  {
    "text": "it's going to go and fetch the user data which will have a nice shebang in it and that just says yum install apache",
    "start": "768240",
    "end": "773440"
  },
  {
    "text": "wget hello world put in the apache spot and we're good to go all right that cool um but we don't want",
    "start": "773440",
    "end": "780399"
  },
  {
    "text": "to maintain all of our provisioning information in bash it becomes unwieldy trust like i did that at a previous company",
    "start": "780399",
    "end": "786560"
  },
  {
    "text": "what four or five years ago it was a terrible experience we felt really cool at first doing everything in bash",
    "start": "786560",
    "end": "791680"
  },
  {
    "text": "and then we felt really dumb when we had to deal with multiple environments and variables and things of that nature",
    "start": "791680",
    "end": "797040"
  },
  {
    "text": "so it's much better if we just replace that with a nice little chef bit saying hey go get the first boot json and then run chef client",
    "start": "797040",
    "end": "803279"
  },
  {
    "text": "or in the case of chef solo we're on chef solo the final concept i want to cover is the",
    "start": "803279",
    "end": "810000"
  },
  {
    "text": "concept of immutable servers and this is one that really changed our lives at riot when we started looking at",
    "start": "810000",
    "end": "815360"
  },
  {
    "text": "these things that we were running in an auto scaling group as an immutable servers uh life became easier it simplified",
    "start": "815360",
    "end": "822160"
  },
  {
    "text": "things right like dhh and ruby on rails you have this thing that constraints can be liberating",
    "start": "822160",
    "end": "827360"
  },
  {
    "text": "and i agree with that uh when the constraints are good and immutable servers are a fantastic constraint so what you're",
    "start": "827360",
    "end": "834079"
  },
  {
    "text": "doing is you're limiting yourself to two actions with the server you say we can do two things one we can start it",
    "start": "834079",
    "end": "839600"
  },
  {
    "text": "and we can provision it and then the only other thing that a human will ever do with that",
    "start": "839600",
    "end": "845519"
  },
  {
    "text": "machine is to kill it you don't ssh in you don't change things you don't even need user accounts on",
    "start": "845519",
    "end": "851600"
  },
  {
    "text": "those machines because you're not going to go into them big big benefit here is you prevent",
    "start": "851600",
    "end": "857680"
  },
  {
    "text": "unexpected changes to servers you know nothing will change you know that if you boot web server version one",
    "start": "857680",
    "end": "864160"
  },
  {
    "text": "that instance will be web server version one till the end of time it will never change it will not",
    "start": "864160",
    "end": "869360"
  },
  {
    "text": "spontaneously upgrade the web version 2 because you change some config somewhere it will always be version 1.",
    "start": "869360",
    "end": "876639"
  },
  {
    "text": "so to put this in a little perspective with immutable servers i've got five web server version ones and i'm going to go do a deploy",
    "start": "876639",
    "end": "883519"
  },
  {
    "text": "i'm gonna upgrade one to version two i'm gonna upgrade the next to version two the next version two the next the next",
    "start": "883519",
    "end": "890079"
  },
  {
    "text": "and so forth um with the immutable server model because i don't get to change anything",
    "start": "890079",
    "end": "896480"
  },
  {
    "text": "i'm instead gonna have my five at version one and then i'm gonna go up deploy time let's start five of version two and then",
    "start": "896480",
    "end": "903279"
  },
  {
    "text": "i'll turn off version one when i know those are good great e simple easy rolling deploys you get",
    "start": "903279",
    "end": "908800"
  },
  {
    "text": "that with immutable servers uh if something went wrong and we needed to go back to version one",
    "start": "908800",
    "end": "914160"
  },
  {
    "text": "it's as simple as just redirecting traffic back to version one if we happen to have killed version one",
    "start": "914160",
    "end": "919760"
  },
  {
    "text": "uh if you're using a golden image based approach like i'll talk about later it's really easy to actually just start up version one again anew and who cares",
    "start": "919760",
    "end": "928079"
  },
  {
    "text": "um again the benefits here are no snowflakes rollbacks are super simple and deploys",
    "start": "928240",
    "end": "933680"
  },
  {
    "text": "really become a lot cleaner you're no longer worried about okay i know i have five machines and in order to do an upgrade a",
    "start": "933680",
    "end": "941360"
  },
  {
    "text": "rolling deploy upgrade i need to pull one from the load balancer upgrade to the next version",
    "start": "941360",
    "end": "946720"
  },
  {
    "text": "okay cool put it back in the load balancer remove the next one roll it to the next version okay cool go on down the list instead what you get",
    "start": "946720",
    "end": "954079"
  },
  {
    "text": "to say because you're on amazon and you can do this because it's amazon you say i'm just going to replicate the",
    "start": "954079",
    "end": "959120"
  },
  {
    "text": "whole damn thing and then i'll move traffic over and we're good to go",
    "start": "959120",
    "end": "965199"
  },
  {
    "text": "so let's talk about what we what we did right how did this work for us how did we actually like",
    "start": "966480",
    "end": "973199"
  },
  {
    "text": "live this somewhat of a dream of using aws and chef together and bang ourselves in the head until we",
    "start": "973199",
    "end": "978800"
  },
  {
    "text": "finally got it working the way we wanted um starting with chef seller right for so what what was required for chef so",
    "start": "978800",
    "end": "984160"
  },
  {
    "text": "when we first looked up we said okay we need to get all of our cookbooks in one tarball uh we then need somewhere to put that",
    "start": "984160",
    "end": "990560"
  },
  {
    "text": "tarball so the instance can get it and then we gotta tell instances how to provision with the tarble pretty easy",
    "start": "990560",
    "end": "995759"
  },
  {
    "text": "right so to package those up we use burkshelf uh if you guys are using chef heavily and you don't use berkshelf",
    "start": "995759",
    "end": "1002720"
  },
  {
    "text": "you're kind of doing it wrong uh i said i said it with the caveat that riot actually developed berkshelf",
    "start": "1002720",
    "end": "1010000"
  },
  {
    "text": "um when the team that was developing it was making it i looked and i said what are you doing that for librarian",
    "start": "1010000",
    "end": "1015759"
  },
  {
    "text": "exists that handles cookbook dependencies why do we need burkeshealth and then they finished it and i said oh",
    "start": "1015759",
    "end": "1021120"
  },
  {
    "text": "because it's so much better that's why we need burger shelf it really does a good job of resolving dependencies",
    "start": "1021120",
    "end": "1026558"
  },
  {
    "text": "makes it very easy to work on your cookbooks to develop them because it has tight integration with vagrant",
    "start": "1026559",
    "end": "1032240"
  },
  {
    "text": "and it makes it very easy to upload them to a chef server or package them into a tarball like i'm showing here",
    "start": "1032240",
    "end": "1037438"
  },
  {
    "text": "you basically run very shelf package in the name of your cookbook it will pull your cookbook and all dependencies",
    "start": "1037439",
    "end": "1043280"
  },
  {
    "text": "into the cookbooks directory of the current working directory and then you just turn that up sweet success made a tarball that's",
    "start": "1043280",
    "end": "1049679"
  },
  {
    "text": "super freaking easy to script two line bash file in terms of storage options",
    "start": "1049679",
    "end": "1055440"
  },
  {
    "text": "uh you can really choose between using s3 or an internal asset server this is assuming that you're going the",
    "start": "1055440",
    "end": "1060480"
  },
  {
    "text": "auto scaling cloud model if you're going the um the data center model then you also have the additional option you can just",
    "start": "1060480",
    "end": "1066559"
  },
  {
    "text": "scp the damn thing up there right sweet it's a fresh box just running centos lscp",
    "start": "1066559",
    "end": "1072160"
  },
  {
    "text": "but assuming you want to do things well and go with auto scaling model you really get s3 or an internal asset server",
    "start": "1072160",
    "end": "1077679"
  },
  {
    "text": "and with s3 we used s3 cmd it's a great little command line tool for interacting with s3",
    "start": "1077679",
    "end": "1082960"
  },
  {
    "text": "uh makes it super simple to browse all your buckets to upload things to those buckets so we use that within our scripts",
    "start": "1082960",
    "end": "1088080"
  },
  {
    "text": "to upload tar balls up the target the cookbook tar balls up to the appropriate bucket um",
    "start": "1088080",
    "end": "1094720"
  },
  {
    "text": "we also though later moved to using an internal asset server and this is because of a fun little thing that happened when we were first",
    "start": "1094720",
    "end": "1101039"
  },
  {
    "text": "testing out uh deploying to ec2 we'd like you know we had like a simple dummy app something dumb",
    "start": "1101039",
    "end": "1107600"
  },
  {
    "text": "not the real app that we pushed up to the bucket and we started our auto scaling groups",
    "start": "1107600",
    "end": "1114559"
  },
  {
    "text": "and everything deployed and it was great and everything was running and then two weeks later we looked at that bucket and noticed it was public",
    "start": "1114559",
    "end": "1120880"
  },
  {
    "text": "because it's kind of easy to accidentally make an s3 bucket public and that you don't want to do that",
    "start": "1120880",
    "end": "1126480"
  },
  {
    "text": "because it turns out then your your cool code is sitting there on the internet so thankfully this was just like a dummy app that we were just trying to",
    "start": "1126480",
    "end": "1132960"
  },
  {
    "text": "deploy with not the real code um so that's why we ended up moving to an",
    "start": "1132960",
    "end": "1138720"
  },
  {
    "text": "internal asset server so we wouldn't make a boneheaded mistake again and instead infosec was like nope this",
    "start": "1138720",
    "end": "1143760"
  },
  {
    "text": "asset server nicely locked down everything's good the only way you're getting to it is from a via the virtual",
    "start": "1143760",
    "end": "1148799"
  },
  {
    "text": "private gateway so we are safe and we said thank you we are safe the downside to using the internal asset",
    "start": "1148799",
    "end": "1155039"
  },
  {
    "text": "server is it takes a little while for data to go through the virtual private gateway up",
    "start": "1155039",
    "end": "1160799"
  },
  {
    "text": "to your machine so with s3 when you have all your cookbook tarball there and all your dependencies there and everything's sitting on s3",
    "start": "1160799",
    "end": "1166559"
  },
  {
    "text": "your provisioning happens pretty quickly whenever running on an internal asset server and you're moving around a 60 meg jar it",
    "start": "1166559",
    "end": "1174080"
  },
  {
    "text": "takes a little bit longer and deploys take a little bit longer and as we'll get into later uh that's bad",
    "start": "1174080",
    "end": "1179840"
  },
  {
    "text": "even though you're using auto scaling group and you're like oh sweet it still it came up in 25 minutes uh that's bad yeah it's better than the",
    "start": "1179840",
    "end": "1187440"
  },
  {
    "text": "old days where it was like oh i need a new machine it's going to be two weeks uh but 25 minutes still bad",
    "start": "1187440",
    "end": "1192799"
  },
  {
    "text": "in terms of actually doing the provisioning the userdata.sh is pretty simple uh all it needs to do is get the",
    "start": "1192799",
    "end": "1197919"
  },
  {
    "text": "cookbooks get your first boot json and the first boot.json is going to tell",
    "start": "1197919",
    "end": "1203120"
  },
  {
    "text": "this instance hey you're going to be a web server and here's a few attributes you care about such as you know what version",
    "start": "1203120",
    "end": "1208799"
  },
  {
    "text": "of the web server you're going to be for generating the first boot json we actually we went",
    "start": "1208799",
    "end": "1214400"
  },
  {
    "text": "with getting off s3 at first and then we quickly moved to just dropping that in the userdata.sh",
    "start": "1214400",
    "end": "1220159"
  },
  {
    "text": "and having the userdata.sh just write it out the reason being is it was a little bit simpler based on the way",
    "start": "1220159",
    "end": "1226960"
  },
  {
    "text": "that we were generating the user data we had a nice little script that would generate it for us and why ship something off to s3 if we",
    "start": "1226960",
    "end": "1234159"
  },
  {
    "text": "don't have to we did the same thing with the solo.rb solo.rb is just your config of hey here's where the",
    "start": "1234159",
    "end": "1240799"
  },
  {
    "text": "cookbooks are so you point at var chef cookbooks where you just put them and it also says you know write out any",
    "start": "1240799",
    "end": "1247600"
  },
  {
    "text": "logs over here do this over here and blah blah blah just your simple config then you run chef solo bob's your uncle all done yay we've",
    "start": "1247600",
    "end": "1254159"
  },
  {
    "text": "deployed so where's this work right where is it good when do you want to use this",
    "start": "1254159",
    "end": "1260159"
  },
  {
    "text": "approach i think you should use it when you're first getting started because you don't know what you're doing",
    "start": "1260159",
    "end": "1266480"
  },
  {
    "text": "and it's easy it's really easy to start with this approach",
    "start": "1266480",
    "end": "1271520"
  },
  {
    "text": "especially if you're using the the data center model which when you're really first getting started are like",
    "start": "1271840",
    "end": "1278400"
  },
  {
    "text": "if you're like hey yo this airbrushing is cool i'm gonna go to a conference and learn about it uh start with the data center model and",
    "start": "1278400",
    "end": "1285360"
  },
  {
    "text": "chef solo it'll be super super easy um rapidly transition to try the auto scaling group",
    "start": "1285360",
    "end": "1291600"
  },
  {
    "text": "model but you can start nice and simple using the data center model",
    "start": "1291600",
    "end": "1297280"
  },
  {
    "text": "this works very well when your chevron is fast when your chevron slows down you're not going to scale up as quickly as you want and that's a problem",
    "start": "1297280",
    "end": "1303679"
  },
  {
    "text": "another big benefit is there no there is no single point of failure so if you're going the chef server model which we'll",
    "start": "1303679",
    "end": "1308799"
  },
  {
    "text": "get into in a little bit we found that there are quite a few single points of failure there and it can really hurt when your auto",
    "start": "1308799",
    "end": "1315039"
  },
  {
    "text": "scaling groups don't actually launch instances whereas with chef solo you're cool things are you can be relatively sure",
    "start": "1315039",
    "end": "1321360"
  },
  {
    "text": "things are going to launch uh it does fail occasionally though so say you put some assets on an internal",
    "start": "1321360",
    "end": "1327039"
  },
  {
    "text": "asset server like we did and you have a network blip or you have a really large file and you happen to time out the download of it",
    "start": "1327039",
    "end": "1333200"
  },
  {
    "text": "after like 10 minutes then your instance won't come up and that will suck uh typically though",
    "start": "1333200",
    "end": "1339120"
  },
  {
    "text": "it gets resolved because that instance will then get killed because it didn't properly come up so it will fail a health check",
    "start": "1339120",
    "end": "1344400"
  },
  {
    "text": "and then you'll start a new one and hopefully you won't hit the network blip that calls a timeout in the first place and you'll boot again not great",
    "start": "1344400",
    "end": "1352000"
  },
  {
    "text": "but if your auto scaling threshold is low enough uh then you'll boot a new instance and plenty of time to",
    "start": "1352000",
    "end": "1357120"
  },
  {
    "text": "handle whatever traffic's coming through this model also kind of fails for configuration changes",
    "start": "1357120",
    "end": "1362799"
  },
  {
    "text": "uh because all your configuration is handled with your first boot json it's essentially all a node attribute",
    "start": "1362799",
    "end": "1367919"
  },
  {
    "text": "if you're used to chef serverland in order to change anything you're doing a whole new deploy",
    "start": "1367919",
    "end": "1373280"
  },
  {
    "text": "you're going to start a brand new auto scaling group it's going to have a brand new userdata.sh and your configuration will change that",
    "start": "1373280",
    "end": "1379200"
  },
  {
    "text": "way now you may think that's silly i can just ssh into the box and change the config and then things",
    "start": "1379200",
    "end": "1385120"
  },
  {
    "text": "are okay i'll just run chef solo again on that box right um bad one you're no longer doing the",
    "start": "1385120",
    "end": "1391679"
  },
  {
    "text": "immutable server thing which trust me makes your life better but the other bad thing is that yes you fixed the running instances",
    "start": "1391679",
    "end": "1399919"
  },
  {
    "text": "but any of the new instances that come up because of auto scaling are now still going to have the old config so",
    "start": "1399919",
    "end": "1405760"
  },
  {
    "text": "you're still boned so don't do that yes you have to do a whole new deploy so that means make sure that doing a deploy is cheap",
    "start": "1405760",
    "end": "1411840"
  },
  {
    "text": "and easy and that you have that well automated this also fails in terms of service discovery but",
    "start": "1411840",
    "end": "1418080"
  },
  {
    "text": "you know i put this in here and i've struggled with having it in here because in my opinion chef in general fails with service discovery",
    "start": "1418080",
    "end": "1423840"
  },
  {
    "text": "uh chef search is terrible don't use it um i'll get more into that later it's",
    "start": "1423840",
    "end": "1430080"
  },
  {
    "text": "just don't touch it uh so you're gonna need your own service discovery mechanisms we've found that uh there's this one",
    "start": "1430080",
    "end": "1436240"
  },
  {
    "text": "that's existed like since the internet called dns works pretty dang well um you can also",
    "start": "1436240",
    "end": "1441760"
  },
  {
    "text": "use zookeeper if you're doing something that's more persistent connection based have things connect with zookeeper and say okay i'm",
    "start": "1441760",
    "end": "1447039"
  },
  {
    "text": "here and then you can go check zookeeper and see who's around we've also used netflix's eureka",
    "start": "1447039",
    "end": "1452559"
  },
  {
    "text": "eureka is pretty good as well we like it so in terms of what players want we're",
    "start": "1452559",
    "end": "1458159"
  },
  {
    "text": "doing pretty well on minimizing unplanned downtime getting rolling to poise and expanding capacity the reason is because all of these are",
    "start": "1458159",
    "end": "1464480"
  },
  {
    "text": "pretty tightly coupled in terms of will your deploy work if if a box will come up while you're",
    "start": "1464480",
    "end": "1471120"
  },
  {
    "text": "asleep all of these things are going to be okay right as long as you don't have some weird external dependency then you're",
    "start": "1471120",
    "end": "1477520"
  },
  {
    "text": "going to be pretty good in terms of being low maintenance it wasn't quite as low maintenance as we wanted because we were having to manage configs",
    "start": "1477520",
    "end": "1485039"
  },
  {
    "text": "via new deploys uh and we didn't have that well automated at the time we weren't really getting",
    "start": "1485039",
    "end": "1490480"
  },
  {
    "text": "great benefits along those lines we were doing a lot of work maintaining this deployment system especially when we started to add new",
    "start": "1490480",
    "end": "1495919"
  },
  {
    "text": "apps so when we started we just had like one application we're running there's a beacon server it took that",
    "start": "1495919",
    "end": "1501360"
  },
  {
    "text": "took in information wrote it to disk and then uploaded it to s3 and then hive happened",
    "start": "1501360",
    "end": "1506480"
  },
  {
    "text": "and it was fine and we got our data uh that's great works a little bit but you start to end up with really terrible",
    "start": "1506480",
    "end": "1512000"
  },
  {
    "text": "hive tables you want a better system so we started to add new application new applications and this meant we had like",
    "start": "1512000",
    "end": "1519360"
  },
  {
    "text": "all this code around just orchestrating what we were doing with chef solo and there's not really good open source",
    "start": "1519360",
    "end": "1525600"
  },
  {
    "text": "orchestration tools along those lines so you're going to spend a bit of time just doing that and that that was not",
    "start": "1525600",
    "end": "1531440"
  },
  {
    "text": "good it also wasn't really good when we're adding new services and you'll see this as a theme for",
    "start": "1531440",
    "end": "1537200"
  },
  {
    "text": "basically every single one of these approaches throughout the talk and and the reason i think it's not good for",
    "start": "1537200",
    "end": "1544000"
  },
  {
    "text": "adding new services is that you're writing cookbooks and writing cookbooks if you're doing an",
    "start": "1544000",
    "end": "1549840"
  },
  {
    "text": "application cookbook go look at all of your application cookbooks right if you do rails if you",
    "start": "1549840",
    "end": "1556240"
  },
  {
    "text": "do java if you do php if you do python right look at all of your python cookbooks look at all your java ones uh consider",
    "start": "1556240",
    "end": "1563200"
  },
  {
    "text": "them together and you will notice they're all the same damn thing they all install the",
    "start": "1563200",
    "end": "1569200"
  },
  {
    "text": "application on the disk they have a giant list of attributes of things you may want to change and they write that giant list of",
    "start": "1569200",
    "end": "1575279"
  },
  {
    "text": "attributes to a template right some config maybe it's three or four config files maybe it's just one",
    "start": "1575279",
    "end": "1580720"
  },
  {
    "text": "in java it's usually just one giant config.properties and all your cookbooks are the same thing and so this is frustrating",
    "start": "1580720",
    "end": "1587600"
  },
  {
    "text": "when you're like i'm going to make a new service oh great i'm going to go copy and paste that cookbook that i've done a million times",
    "start": "1587600",
    "end": "1593360"
  },
  {
    "text": "and you can say oh we'll use the library cookbook pattern that's what you should do here it still kind of sucks we tried that",
    "start": "1593360",
    "end": "1599120"
  },
  {
    "text": "it's not great later on in the talk i'll get into what we did to kind of fix that a little bit",
    "start": "1599120",
    "end": "1604559"
  },
  {
    "text": "so my recommendation here is use chef solo when you're getting started stop when you have multiple applications",
    "start": "1604559",
    "end": "1612720"
  },
  {
    "text": "and that was it good so um the next approach i want to cover is chef server so we were doing the chef",
    "start": "1612720",
    "end": "1619200"
  },
  {
    "text": "solo thing it was great uh until we had multiple applications we said we need to change we got to fix this we need a new method",
    "start": "1619200",
    "end": "1626960"
  },
  {
    "text": "a bunch of guys internally we're already running chef server we have a we have a lot of data centers",
    "start": "1626960",
    "end": "1632480"
  },
  {
    "text": "and most of those are using chef nine to deploy things because that's what we were using back",
    "start": "1632480",
    "end": "1639039"
  },
  {
    "text": "in the day and we're not upgrading it yet uh we built a lot of tooling around it some of the newer stuff though is using",
    "start": "1639039",
    "end": "1644720"
  },
  {
    "text": "chef 10 and guys we're running chef tim we're like okay sweet we're going to jump on the chef 10 train you're already running chef server we",
    "start": "1644720",
    "end": "1650640"
  },
  {
    "text": "don't have to worry about maintaining it as i'll get into like maintaining a server no fun at all so we're like",
    "start": "1650640",
    "end": "1655919"
  },
  {
    "text": "we're going to use what you got great so what we needed is we needed a chef server we needed to upload those",
    "start": "1655919",
    "end": "1662720"
  },
  {
    "text": "cookbooks and we needed to tell instances how to provision with chef server you really have two choices when running",
    "start": "1662720",
    "end": "1669600"
  },
  {
    "text": "chess server you can run your own you can use hosted chef now you could also use opsworks i guess i have not",
    "start": "1669600",
    "end": "1675039"
  },
  {
    "text": "used opsworks that's why i'm not mentioning it here um we just haven't gone that path so i can't talk about whether it's really",
    "start": "1675039",
    "end": "1680399"
  },
  {
    "text": "good or really bad i have no clue but in terms of chef server you can run your own which",
    "start": "1680399",
    "end": "1686640"
  },
  {
    "text": "is worth it financially when you get enough instances uh is not worth it when you're a startup",
    "start": "1686640",
    "end": "1692399"
  },
  {
    "text": "with you know five to ten instances so when we're starting this project if like if we had not had the dudes",
    "start": "1692399",
    "end": "1698559"
  },
  {
    "text": "already running a chef server we probably would have gone with hosted chef uh it's a little bit easier you",
    "start": "1698559",
    "end": "1703760"
  },
  {
    "text": "just kind of go oh sweet there's my chef server away we go you need a way to get your cookbooks on",
    "start": "1703760",
    "end": "1709279"
  },
  {
    "text": "there right uh again bookshelf fantastic just do burke's upload cookbook name it will upload your",
    "start": "1709279",
    "end": "1715360"
  },
  {
    "text": "cookbook and all of its dependencies so if you've ever gone hey i need to upload my",
    "start": "1715360",
    "end": "1720799"
  },
  {
    "text": "cookbooks to the chef server right now and then you uploaded it and said oh missing a dependency and then you go",
    "start": "1720799",
    "end": "1727039"
  },
  {
    "text": "to the chef community site and you're like okay let me find that okay cool found the cookbook i depend on let me download it okay cool",
    "start": "1727039",
    "end": "1732720"
  },
  {
    "text": "i'll upload that first and then goes cool you thought that was the only dependency you had but you've got two others because that one has a dependency",
    "start": "1732720",
    "end": "1738799"
  },
  {
    "text": "and you've played that game a bit uh use burkshelf you won't play that game anymore it'll be great",
    "start": "1738799",
    "end": "1745279"
  },
  {
    "text": "in terms of provisioning it's very similar to what we did in chef solo the one difference is that instead of",
    "start": "1745279",
    "end": "1750880"
  },
  {
    "text": "going and fetching the cookbooks we fetch a validation pim the validation pim is what allows the chef client to say hey i'm a new client",
    "start": "1750880",
    "end": "1758000"
  },
  {
    "text": "server trust me because i got this little secret that we both share so you know i'm me and that i can start",
    "start": "1758000",
    "end": "1763679"
  },
  {
    "text": "up you then get your first boot.json you get your client rb run chef client boom you're running",
    "start": "1763679",
    "end": "1769440"
  },
  {
    "text": "live's great uh now from this and me saying you know hey we used it because we have more",
    "start": "1769440",
    "end": "1775520"
  },
  {
    "text": "applications we had a lot of stuff we had to do you might think i would be like yo chef server worked pretty well it was great um no",
    "start": "1775520",
    "end": "1781200"
  },
  {
    "text": "did not we ran into a lot of trouble and a lot of that was us just us not knowing what we were doing",
    "start": "1781200",
    "end": "1786640"
  },
  {
    "text": "and i think some of it was kind of the chef server model so i think it it works",
    "start": "1786640",
    "end": "1792080"
  },
  {
    "text": "if you're going to be using chef server to manage literally only feature flag",
    "start": "1792080",
    "end": "1798000"
  },
  {
    "text": "configuration so if you're doing some feature flag that says hey turn on this feature right now",
    "start": "1798000",
    "end": "1803440"
  },
  {
    "text": "and you want to use chef to propagate that change amongst all your running instances great",
    "start": "1803440",
    "end": "1808640"
  },
  {
    "text": "you can have chef server running in daemon mode and that's the only thing you'll update uh but be warned that if you have chef",
    "start": "1808640",
    "end": "1815760"
  },
  {
    "text": "server running in daemon mode it's going to limit your ability to to do rolling deploys",
    "start": "1815760",
    "end": "1822240"
  },
  {
    "text": "and the reason behind this is that chef gives you the ability to lock cookbooks",
    "start": "1822240",
    "end": "1827279"
  },
  {
    "text": "in your environment file your environment file is shared amongst all instances in that environment so",
    "start": "1827279",
    "end": "1834240"
  },
  {
    "text": "when you spin up uh a new auto scaling group of let's say i've got my five web servers again right",
    "start": "1834240",
    "end": "1840000"
  },
  {
    "text": "yeah five web servers and i want to upgrade to version two so i stand up my five new ones yay sweet well it turns out that version two of my",
    "start": "1840000",
    "end": "1846399"
  },
  {
    "text": "web server needs a slightly different cookbook right i've got some new attributes that are going to get set we got a new cookbook version so i'm going to go bump",
    "start": "1846399",
    "end": "1853039"
  },
  {
    "text": "my environment file to have the new cookbook version fantastic turn on my new web servers",
    "start": "1853039",
    "end": "1859679"
  },
  {
    "text": "okay oh that didn't work quite right we want to roll back to version one and you go look at your version one machines and guess",
    "start": "1859679",
    "end": "1865120"
  },
  {
    "text": "what they've done they've converged using the new cookbook and they're all broken and you can't",
    "start": "1865120",
    "end": "1872000"
  },
  {
    "text": "roll back you're gonna be really sad so what you have to do instead is you say okay cool we're doing the feature flag thing and",
    "start": "1872000",
    "end": "1878880"
  },
  {
    "text": "when we start a deploy we the first thing we do is we go into the old auto scaling group we break the immutable server model",
    "start": "1878880",
    "end": "1884960"
  },
  {
    "text": "we go in and we turn off chef damon now we can be sure that when we update our environment file",
    "start": "1884960",
    "end": "1890880"
  },
  {
    "text": "nothing's gonna change we're gonna be okay um you do have to make sure though that",
    "start": "1890880",
    "end": "1896240"
  },
  {
    "text": "if you need to roll back you have to undo all the changes you did to the environment file so if you're keeping your um the version",
    "start": "1896240",
    "end": "1902960"
  },
  {
    "text": "of the software you deploy in that environment file which in many ways i would say you should be doing uh because that should be in the",
    "start": "1902960",
    "end": "1911120"
  },
  {
    "text": "attributes of the the cookbook itself right the cookbook version should be tied to a particular",
    "start": "1911120",
    "end": "1916640"
  },
  {
    "text": "version of your code you're deploying because it's tightly coupled right it has these these attributes and this",
    "start": "1916640",
    "end": "1922159"
  },
  {
    "text": "config that applies to that application um you have to make sure you go and",
    "start": "1922159",
    "end": "1927840"
  },
  {
    "text": "change your environment file to to have the old one and then you can turn chef damon mode back on on the old servers",
    "start": "1927840",
    "end": "1932960"
  },
  {
    "text": "it's pain in the butt but you can make that work so the other place that this approach",
    "start": "1932960",
    "end": "1938720"
  },
  {
    "text": "doesn't really work or another place is did you have the single point of failure in chef server",
    "start": "1938720",
    "end": "1944480"
  },
  {
    "text": "so we had some fun times occasionally where middle of the night something would go wrong with chef's server and it would go",
    "start": "1944480",
    "end": "1950399"
  },
  {
    "text": "down uh cool that's normally fine someone will fix it in the morning nobody's",
    "start": "1950399",
    "end": "1955440"
  },
  {
    "text": "doing deploys but um we use auto scaling groups so we are doing deploys in the middle of the",
    "start": "1955440",
    "end": "1961919"
  },
  {
    "text": "night when everyone's asleep and not aware of what's going on and the new instance boots up and it",
    "start": "1961919",
    "end": "1967039"
  },
  {
    "text": "can't run and it dies and it boots up again and it can't run and it dies and so we don't scale until someone",
    "start": "1967039",
    "end": "1973840"
  },
  {
    "text": "wakes up and fixes the chef's server and this gets even worse uh or was even worse for us because when",
    "start": "1973840",
    "end": "1980320"
  },
  {
    "text": "we first started using uh auto scaling groups",
    "start": "1980320",
    "end": "1985600"
  },
  {
    "text": "you may not know this right the auto scaling group has different ways in which can it can determine if it should",
    "start": "1985600",
    "end": "1990960"
  },
  {
    "text": "restart an instance and one of those is based on the elb health check and at least when we were starting with",
    "start": "1990960",
    "end": "1997519"
  },
  {
    "text": "this that was not the default way to determine whether or not you should restart your your instances",
    "start": "1997519",
    "end": "2003679"
  },
  {
    "text": "so our things would boot they'd fail their eel be health check and then they'd stay running great we",
    "start": "2003679",
    "end": "2011360"
  },
  {
    "text": "have an instance doing nothing uh this got even worse because the auto scaling group",
    "start": "2011360",
    "end": "2017360"
  },
  {
    "text": "was deciding whether or not it should scale based on cpu usage so it says okay we scale up at 80",
    "start": "2017360",
    "end": "2024480"
  },
  {
    "text": "well in time to scale let's boot a new instance oh that instance fails to boot guess what it's cpu utilization is",
    "start": "2024480",
    "end": "2031120"
  },
  {
    "text": "zero you know that does that brings down your overall level of cpu usage and the",
    "start": "2031120",
    "end": "2036240"
  },
  {
    "text": "oscillating group goes yeah everything's fine life is great and then all your instances all the ones",
    "start": "2036240",
    "end": "2042559"
  },
  {
    "text": "that actually have software are running at 100 freaking percent they're starting to 503 and people get",
    "start": "2042559",
    "end": "2047760"
  },
  {
    "text": "mad at you so make sure that when you start these auto scaling groups you set them up so that they use the elb health check",
    "start": "2047760",
    "end": "2054480"
  },
  {
    "text": "assuming that you're actually using an elb another problem we had was",
    "start": "2054480",
    "end": "2059520"
  },
  {
    "text": "long-running uh long chef runs when a chef run takes",
    "start": "2059520",
    "end": "2064800"
  },
  {
    "text": "25 minutes which if any of you guys have like used chef for an extended period of time you'll be like oh yeah",
    "start": "2064800",
    "end": "2070800"
  },
  {
    "text": "i know that problem happens all the time we wrote a lot of cookbooks we have this base cookbook with this other cookbook and we downloaded all these assets from over",
    "start": "2070800",
    "end": "2076800"
  },
  {
    "text": "here and over here and over here and our chef runs now take 25 to 30 minutes",
    "start": "2076800",
    "end": "2082638"
  },
  {
    "text": "fine no big deal in data center land because you sat down you did capacity planning you're like sweet we need 10 boxes i'll set those up",
    "start": "2082639",
    "end": "2089679"
  },
  {
    "text": "today or tomorrow it'll be fine uh when you're auto scaling and you have a burst of traffic come in",
    "start": "2089679",
    "end": "2094960"
  },
  {
    "text": "so we we have a few of our the people that send data into the data pipeline",
    "start": "2094960",
    "end": "2100240"
  },
  {
    "text": "like to send data when they experience errors so in particular one thing says oh i",
    "start": "2100240",
    "end": "2105680"
  },
  {
    "text": "can't communicate this other service i'm going to note that in the data pipeline",
    "start": "2105680",
    "end": "2112000"
  },
  {
    "text": "when we do deploys the service goes down and that other service goes hey i can't talk to you anymore i'm going to send a",
    "start": "2112000",
    "end": "2117920"
  },
  {
    "text": "lot of errors right now to the data pipeline like you know a million right now and we need to scale up very",
    "start": "2117920",
    "end": "2125440"
  },
  {
    "text": "quickly right because it's going to be doing that as long as things are down or who knows where right other things could get bursty as well and we need to go now",
    "start": "2125440",
    "end": "2132240"
  },
  {
    "text": "we can't go 25 minutes from now sometimes what happens is it will burst for 15 minutes",
    "start": "2132240",
    "end": "2139119"
  },
  {
    "text": "and so we will stand up a new instance and we'll have 15 minutes of our boxes just being killed killed killed killed",
    "start": "2139119",
    "end": "2145280"
  },
  {
    "text": "and they'll not be killed and then 10 minutes later we'll bring up that other box that would have helped him out",
    "start": "2145280",
    "end": "2150560"
  },
  {
    "text": "and that sucks you really want to minimize the amount of time those chef runs take not so much those chef runs but the",
    "start": "2150560",
    "end": "2156640"
  },
  {
    "text": "amount of time it takes for an instance to come up period",
    "start": "2156640",
    "end": "2162078"
  },
  {
    "text": "the other place this failed for us was we are a decently large organization we have a lot of engineers working on a",
    "start": "2162480",
    "end": "2168720"
  },
  {
    "text": "lot of things and we do things in a devops way very every team is responsible for the chef cookbooks for their software",
    "start": "2168720",
    "end": "2175040"
  },
  {
    "text": "to make sure it deploys and then we have another team that handles kind of common common things right so we need to make",
    "start": "2175040",
    "end": "2181599"
  },
  {
    "text": "sure that we harden the system that we we have a settings for where the the",
    "start": "2181599",
    "end": "2187200"
  },
  {
    "text": "asset servers are right so that not everyone has to know oh that's where the internal asset server is today and there's a cookbook",
    "start": "2187200",
    "end": "2193280"
  },
  {
    "text": "that tells you where it is great that's that's wonderful we have this team doing that for us",
    "start": "2193280",
    "end": "2198560"
  },
  {
    "text": "uh but sometimes they make a change you know it always happens right sometimes you have bugs and things don't work and that gets",
    "start": "2198560",
    "end": "2206320"
  },
  {
    "text": "pushed at the end of the day and then middle of the night you scale up and you use that cookbook that's",
    "start": "2206320",
    "end": "2211680"
  },
  {
    "text": "broken and you don't scale all your new instances just fail",
    "start": "2211680",
    "end": "2216720"
  },
  {
    "text": "um this is a problem we've had we solved it kind of by locking cookbook versions you go okay",
    "start": "2216720",
    "end": "2222480"
  },
  {
    "text": "sweet i want cookbook version to version 10 of that base cookbook that everybody depends on and you're really good until someone",
    "start": "2222480",
    "end": "2228640"
  },
  {
    "text": "moves that asset server and they update the cookbook to reflect the asset server move",
    "start": "2228640",
    "end": "2233760"
  },
  {
    "text": "but you don't get the updated cookbook because you're locked to a previous version so without really good communication",
    "start": "2233760",
    "end": "2239040"
  },
  {
    "text": "within your large organization you may not know that happened even with good communication you may not know that happened because people make",
    "start": "2239040",
    "end": "2245440"
  },
  {
    "text": "mistakes um and when you don't know your chef run will fail",
    "start": "2245440",
    "end": "2250640"
  },
  {
    "text": "and you will not be scaling and that means you have to wake up and i know i don't want to wake up in the in the middle of the night to fix",
    "start": "2250640",
    "end": "2257119"
  },
  {
    "text": "things i would rather the software do it itself so in terms of what players want um this",
    "start": "2257119",
    "end": "2263040"
  },
  {
    "text": "is really how i feel about using chef server and aws for the most part you don't get any of it",
    "start": "2263040",
    "end": "2268960"
  },
  {
    "text": "now maybe you could right maybe you're gonna do things better than we did uh my assumption is we made a lot of",
    "start": "2268960",
    "end": "2275040"
  },
  {
    "text": "mistakes here the other assumption is that we need to work better with the chef community to say hey",
    "start": "2275040",
    "end": "2280160"
  },
  {
    "text": "this is where we've had problems right we work pretty closely with ops code in the first place and i know that they're working on some",
    "start": "2280160",
    "end": "2286800"
  },
  {
    "text": "of these things so don't expect this to always be the case but for this point in time this is the",
    "start": "2286800",
    "end": "2291839"
  },
  {
    "text": "way i feel about it chef server you don't really get to minimize unplanned downtime because if an",
    "start": "2291839",
    "end": "2297280"
  },
  {
    "text": "instance dies and the auto scaling group goes to restart it and it can't because a new instance can't come up",
    "start": "2297280",
    "end": "2304079"
  },
  {
    "text": "you're kind of boned uh same thing as revolving deploys and expanding your capacity if you can't get these new instances up",
    "start": "2304079",
    "end": "2310400"
  },
  {
    "text": "then you're going to be hurting in the rolling deploy case if you make a mistake and you forget to turn off chef damon on the old auto",
    "start": "2310400",
    "end": "2316079"
  },
  {
    "text": "scaling group sweet you just completely killed your ability to do it wrong deploy right now",
    "start": "2316079",
    "end": "2322079"
  },
  {
    "text": "now thankfully in terms you'll see the check mark on low maintenance interesting low maintenance how do you",
    "start": "2322079",
    "end": "2328400"
  },
  {
    "text": "reconcile that with the other bit where things don't come up well when you take out that other bit where things",
    "start": "2328400",
    "end": "2333440"
  },
  {
    "text": "don't come up chef server at least does give you an easy way to say hey what's running what what version are all these servers at",
    "start": "2333440",
    "end": "2339839"
  },
  {
    "text": "right you can chef search is good when you use it from the command line not within your cookbook so within the",
    "start": "2339839",
    "end": "2345440"
  },
  {
    "text": "command line you say chef search give me all web server nodes of version two and they'll tell you where they are",
    "start": "2345440",
    "end": "2351359"
  },
  {
    "text": "that's nice it's handy uh it's also handy that all the cookbooks are in one spot right",
    "start": "2351359",
    "end": "2356400"
  },
  {
    "text": "you're not now man you're not managing version tar balls of cookbooks on s3 like we were with chef solo",
    "start": "2356400",
    "end": "2363200"
  },
  {
    "text": "the chef server handles all that for you so in that sense i consider it kind of low maintenance it's not too bad",
    "start": "2363200",
    "end": "2370079"
  },
  {
    "text": "again for new services you're still writing chef cookbooks still going to take you too freaking long you're still going to be frustrated with",
    "start": "2370079",
    "end": "2375760"
  },
  {
    "text": "it so i don't consider it great there so my recommendation here use chef",
    "start": "2375760",
    "end": "2382079"
  },
  {
    "text": "server when you're managing feature flags but be careful make sure you're not going to screw yourself by having chef",
    "start": "2382079",
    "end": "2387440"
  },
  {
    "text": "damon running it's also not bad when you have multiple applications to deploy when you first move into that world from oh i'm just",
    "start": "2387440",
    "end": "2393200"
  },
  {
    "text": "deploying one time deploying five chef server gives you a pretty easy way to manage all those cookbooks and the things of that nature",
    "start": "2393200",
    "end": "2399920"
  },
  {
    "text": "a few pro tips here we ran into a really fun case where you'll notice a lot of my stories",
    "start": "2399920",
    "end": "2405839"
  },
  {
    "text": "involve us kind of being a little bit dumb because you know when you're like stumbling through something you don't know what you're doing you're gonna make",
    "start": "2405839",
    "end": "2410880"
  },
  {
    "text": "a lot of dumb mistakes uh we thought it'd be really cool to set our host names",
    "start": "2410880",
    "end": "2416960"
  },
  {
    "text": "to our ip address um when you run inside of vpc you have a",
    "start": "2416960",
    "end": "2422960"
  },
  {
    "text": "set number of ip addresses you know like say 255 of them uh chef for those of you that don't know",
    "start": "2422960",
    "end": "2429680"
  },
  {
    "text": "decides uniqueness of clients based on the host name",
    "start": "2429680",
    "end": "2435359"
  },
  {
    "text": "so if you have 255 possible host names in your entire universe and you're scaling up and down say maybe",
    "start": "2435359",
    "end": "2442640"
  },
  {
    "text": "10 instances per day it doesn't take you that long to run through your available list of hostnames",
    "start": "2442640",
    "end": "2450160"
  },
  {
    "text": "and then when you go to register you go to auto scale in the middle in the middle of the night uh you'll also notice a lot of my stories involve",
    "start": "2450160",
    "end": "2456400"
  },
  {
    "text": "the middle of the night um because that's when i really don't want to have to deal with uh so middle of the night thing tries to",
    "start": "2456400",
    "end": "2464240"
  },
  {
    "text": "scale up and this chef server goes yeah really glad you want to scale right now but",
    "start": "2464240",
    "end": "2469359"
  },
  {
    "text": "um i don't believe you are who you say you are you have a validation pim but you don't",
    "start": "2469359",
    "end": "2474800"
  },
  {
    "text": "have the client pim and you should have that because i've got your host i'm in my system",
    "start": "2474800",
    "end": "2480800"
  },
  {
    "text": "the trick here use a shutdown script to remove instances from the chef server so throw that sucker in etsy init",
    "start": "2480800",
    "end": "2489440"
  },
  {
    "text": "have it run on shutdown and when you shut down you run knife node delete and then knife client",
    "start": "2489440",
    "end": "2495760"
  },
  {
    "text": "delete be sure you do it in that order because if you delete your client first you can't delete your node",
    "start": "2495760",
    "end": "2501359"
  },
  {
    "text": "um when we first went to so to give you an idea of when we were doing this when we first went to do that",
    "start": "2501359",
    "end": "2508079"
  },
  {
    "text": "um chef server did not support deleting your own client so the node could delete itself like the",
    "start": "2508079",
    "end": "2514319"
  },
  {
    "text": "actual node but it couldn't delete the client so we had to write this really complicated garbage collector that would go through and make be like okay what's running in",
    "start": "2514319",
    "end": "2520640"
  },
  {
    "text": "aws what's running in chef server all right i'm gonna go reap all the things that shouldn't be there um you may still want to do that even",
    "start": "2520640",
    "end": "2528160"
  },
  {
    "text": "with the shutdown script just in case something goes wrong sucks uh we should totally open source that at",
    "start": "2528160",
    "end": "2534480"
  },
  {
    "text": "some point so you don't have to do that but you don't want our version it doesn't work that well",
    "start": "2534480",
    "end": "2540560"
  },
  {
    "text": "also as i mentioned before only use chef in demon mode if you're certain you're only changing feature",
    "start": "2540560",
    "end": "2545599"
  },
  {
    "text": "flags if that's the only thing you're changing fine if you're changing anything more serious than a feature flag",
    "start": "2545599",
    "end": "2550960"
  },
  {
    "text": "um i am very much of the opinion that your configuration is the same",
    "start": "2550960",
    "end": "2557520"
  },
  {
    "text": "thing as your code and it should be versioned just like code so if you're doing serious configuration changes it's a deploy",
    "start": "2557520",
    "end": "2564960"
  },
  {
    "text": "it's a new version and make sure that chef running in damon mode won't pick up one of those changes",
    "start": "2564960",
    "end": "2570960"
  },
  {
    "text": "so let's get down to the final approach we took right we're looking at we still got a little bit of time left",
    "start": "2570960",
    "end": "2576240"
  },
  {
    "text": "if we run out of time here for like q a at the end don't worry we we actually have a booth downstairs and you can come",
    "start": "2576240",
    "end": "2582079"
  },
  {
    "text": "and hang out and we can talk about it as much as you want i'll expand even more than i have up here about things i love",
    "start": "2582079",
    "end": "2587440"
  },
  {
    "text": "and don't love about these approaches but back to the talk golden images what you need is you need",
    "start": "2587440",
    "end": "2593599"
  },
  {
    "text": "a way to make a golden image uh and for the purposes of what we were doing at riot at the time",
    "start": "2593599",
    "end": "2599040"
  },
  {
    "text": "we were doing amis so when i say golden image that's synonymous with ami",
    "start": "2599040",
    "end": "2604560"
  },
  {
    "text": "currently we're playing with other technologies right docker containers are like the cool thing now you could take an",
    "start": "2604560",
    "end": "2610480"
  },
  {
    "text": "approach like this with a docker container that too is a golden image you are making a thing",
    "start": "2610480",
    "end": "2615839"
  },
  {
    "text": "that is essentially a mold that says this is what a web server is stamp stamp stamp stamp suite five web",
    "start": "2615839",
    "end": "2622319"
  },
  {
    "text": "servers success um so you need that money to make your golden image and you need a way to do configuration management",
    "start": "2622319",
    "end": "2629119"
  },
  {
    "text": "because if you build your image ahead of time the good thing to do is not to build an",
    "start": "2629119",
    "end": "2634240"
  },
  {
    "text": "image per environment if you build an image for dev an image for qa and and an image for prod",
    "start": "2634240",
    "end": "2639920"
  },
  {
    "text": "i can almost guarantee you that you will at some point in this process build version one on dev",
    "start": "2639920",
    "end": "2647119"
  },
  {
    "text": "test it out everything's great build version two on qa test out everything's great and then magically build version three",
    "start": "2647119",
    "end": "2653359"
  },
  {
    "text": "in prod and nothing works it's gonna hurt so what you wanna do is make an ami that you promote",
    "start": "2653359",
    "end": "2659839"
  },
  {
    "text": "through your various environ various environments so make this ami you run it in dev suite works there okay",
    "start": "2659839",
    "end": "2665440"
  },
  {
    "text": "we promote it to qa suite works there promote it to prod wonderful it's all great",
    "start": "2665440",
    "end": "2671040"
  },
  {
    "text": "but that means we're putting all of our config on that box right now when we make it or we're",
    "start": "2671040",
    "end": "2677200"
  },
  {
    "text": "telling it where configuration services they can go ask and say hey i happen to be in dev right",
    "start": "2677200",
    "end": "2682800"
  },
  {
    "text": "now can you tell me which config to use please thank you so for making that image we",
    "start": "2682800",
    "end": "2688560"
  },
  {
    "text": "went back to chef solo we found chef solo was a great way to make an image now you could take other approaches",
    "start": "2688560",
    "end": "2695359"
  },
  {
    "text": "right um you could say screw it i'm just going to boot an instance go in type yum install all my things",
    "start": "2695359",
    "end": "2701040"
  },
  {
    "text": "and save that off as an image you could just use bash because bash is simple why not",
    "start": "2701040",
    "end": "2706240"
  },
  {
    "text": "um i highly recommend chef solo because it is nice to keep these keep",
    "start": "2706240",
    "end": "2712160"
  },
  {
    "text": "the definition of what a server is in code and chef is kind of the chef cookbooks are kind of the best way we",
    "start": "2712160",
    "end": "2717839"
  },
  {
    "text": "have to do that right now so i recommend you use chef solo and it has the side benefit that if one day",
    "start": "2717839",
    "end": "2723440"
  },
  {
    "text": "your boss comes to you and says you know i'm really glad we're running in aws but we're now running a thousand",
    "start": "2723440",
    "end": "2729440"
  },
  {
    "text": "instances and this dude over here has a data center that we can run a thousand",
    "start": "2729440",
    "end": "2734640"
  },
  {
    "text": "instances for half the price you don't have to go oh well no we made a bunch of amis and we can't",
    "start": "2734640",
    "end": "2742640"
  },
  {
    "text": "move them you instead say okay well i recommend against this because i'm now going to have massive operational overhead",
    "start": "2742640",
    "end": "2748400"
  },
  {
    "text": "but i can run chef solo there and make a bunch of instances if you really want that's what you think is best",
    "start": "2748400",
    "end": "2755759"
  },
  {
    "text": "as a small side note we solved our chef cookbook problem at this step in our process and",
    "start": "2755839",
    "end": "2762480"
  },
  {
    "text": "unfortunately that's basically like another presentation unto itself so definitely come ask me afterwards if",
    "start": "2762480",
    "end": "2768160"
  },
  {
    "text": "you want to know about it what we found was that within the data pipeline all of your applications were",
    "start": "2768160",
    "end": "2774079"
  },
  {
    "text": "java and one day one of the technical directors on the team this guy jerome",
    "start": "2774079",
    "end": "2779119"
  },
  {
    "text": "boulong he came up to me and he goes i'm not going to write a chef cookbook",
    "start": "2779119",
    "end": "2785119"
  },
  {
    "text": "and i said well that sucks because we do devops and you're gonna write a chef cookbook and he goes",
    "start": "2785119",
    "end": "2790480"
  },
  {
    "text": "no i'm not i'd really like it if we could figure out something else i was like well you seem like a smart",
    "start": "2790480",
    "end": "2796400"
  },
  {
    "text": "guy you've been smart up to this point um maybe maybe we can look into this and",
    "start": "2796400",
    "end": "2802640"
  },
  {
    "text": "figure something out right maybe there's something we can do so i went and looked we talked to the dudes that wrote berkshire off and we're",
    "start": "2802640",
    "end": "2808319"
  },
  {
    "text": "like what do we do and they said use a library cookbook like awesome so we went to use the library cookbook",
    "start": "2808319",
    "end": "2813760"
  },
  {
    "text": "and we found well we're still kind of managing a ton of attributes in these template files and that's annoying and jerome looked at and said nope",
    "start": "2813760",
    "end": "2819760"
  },
  {
    "text": "that's still going to make me do a bunch of chef i said oh okay well maybe",
    "start": "2819760",
    "end": "2825280"
  },
  {
    "text": "everything seems the same we already need a different way of doing configuration management",
    "start": "2825280",
    "end": "2830480"
  },
  {
    "text": "what if we just kept all of our config on disk we had a config.properties then we had a config",
    "start": "2830480",
    "end": "2835839"
  },
  {
    "text": "dev config qa config dot properties which archive is conveniently from netflix works on this model",
    "start": "2835839",
    "end": "2843200"
  },
  {
    "text": "and you can merge those together based on whatever environment you're in uh and then we just build an rpm take",
    "start": "2843200",
    "end": "2848559"
  },
  {
    "text": "the jar drop it in make an upstart file drop that in there just install the rpm and good to go and then to maintain compatibility with",
    "start": "2848559",
    "end": "2855280"
  },
  {
    "text": "everything else in case we need to run this inside the data center not on aws we have one cookbook that cookbook knows",
    "start": "2855280",
    "end": "2862160"
  },
  {
    "text": "how to install rpms and it has one attribute and that attribute is a list of rpms the other thing it does is installs java",
    "start": "2862160",
    "end": "2868480"
  },
  {
    "text": "for us make sure things are all set up in the way we need kind of handles all this stuff around",
    "start": "2868480",
    "end": "2873760"
  },
  {
    "text": "you know dependencies that that um all of our rpms may have for specific dependencies though rpms",
    "start": "2873760",
    "end": "2879839"
  },
  {
    "text": "conveniently enough know how to do dependencies so if you depend on nginx you can have your rpm just say",
    "start": "2879839",
    "end": "2884960"
  },
  {
    "text": "give me some engine x please so we use that approach and it worked out really well we got it down to a six line long yaml",
    "start": "2884960",
    "end": "2891920"
  },
  {
    "text": "file uh in the worst case in the best case a one line yaml file that said this is my main class",
    "start": "2891920",
    "end": "2898240"
  },
  {
    "text": "and if you told this little tool we had what the main class was uh then it would make the rpm for you",
    "start": "2898240",
    "end": "2903359"
  },
  {
    "text": "and you were good to go that's something that will hopefully open source at some point it's not quite to the level that we'd like it uh",
    "start": "2903359",
    "end": "2909200"
  },
  {
    "text": "documentation wise to do so this moment though but you know follow us on the twitters or the",
    "start": "2909200",
    "end": "2915680"
  },
  {
    "text": "our engineering blogs or whatever uh and at some point we will open source that",
    "start": "2915680",
    "end": "2920800"
  },
  {
    "text": "and you can check it out and use it in terms of configuration management we went with archives you could go with any",
    "start": "2920800",
    "end": "2927119"
  },
  {
    "text": "on disk config archives is written in java runs with the jvm right so if you're a jvm based",
    "start": "2927119",
    "end": "2932640"
  },
  {
    "text": "language archive is great if you're not um python i believe has a port of archives",
    "start": "2932640",
    "end": "2938720"
  },
  {
    "text": "if you're working in another language i strongly request that you",
    "start": "2938720",
    "end": "2945760"
  },
  {
    "text": "implement archives in that language i would really appreciate it so that when i go use go i don't have to",
    "start": "2945760",
    "end": "2951359"
  },
  {
    "text": "write it and i can use whatever you wrote and we can all be happy with our archive",
    "start": "2951359",
    "end": "2957440"
  },
  {
    "text": "setup we also have a a configuration server that it can talk to so archives can work off disk",
    "start": "2957440",
    "end": "2963440"
  },
  {
    "text": "based config or it can also work off dynamodb and one other means of i think cassandra",
    "start": "2963440",
    "end": "2970400"
  },
  {
    "text": "for getting the config so we have a simple rest based service that you can query for the config",
    "start": "2970400",
    "end": "2976640"
  },
  {
    "text": "and we're going to open source that at some point your other option is oddly enough to use chef for configuration",
    "start": "2976640",
    "end": "2982240"
  },
  {
    "text": "management so when you have this ami on the first boot you can have it run a small set of cookbooks",
    "start": "2982240",
    "end": "2987839"
  },
  {
    "text": "that set up the configuration for that particular environment we didn't do this uh but in theory",
    "start": "2987839",
    "end": "2994000"
  },
  {
    "text": "it could work that's definitely one approach you can take if you're just if you're in a land where you can't use archives or something",
    "start": "2994000",
    "end": "2999200"
  },
  {
    "text": "similar we might as well try this chef approach see how it works",
    "start": "2999200",
    "end": "3004400"
  },
  {
    "text": "so where this works really really well is your rollbacks are perfect your instances always boot and they come up fast come up really fast it is great we",
    "start": "3004400",
    "end": "3011839"
  },
  {
    "text": "went from having these 25 minute long instance boots down to like two or three minutes and we",
    "start": "3011839",
    "end": "3017359"
  },
  {
    "text": "handled our spikes like champs and we knew that stuff would always",
    "start": "3017359",
    "end": "3022880"
  },
  {
    "text": "boot the beauty of the golden image approach is that you don't have external dependencies for boot time",
    "start": "3022880",
    "end": "3030559"
  },
  {
    "text": "so when you start you start you don't have to worry that someone moved an asset server",
    "start": "3030559",
    "end": "3035680"
  },
  {
    "text": "you don't have to worry that oh you know that that thing over there just got filled up so we took off those old",
    "start": "3035680",
    "end": "3041280"
  },
  {
    "text": "versions of the software and i'm sorry you want to deploy that thing you deployed two weeks ago but you know the jar is gone you're out",
    "start": "3041280",
    "end": "3048480"
  },
  {
    "text": "of luck instead no always will boot this is like the in my mind the perfect thing about",
    "start": "3048480",
    "end": "3054800"
  },
  {
    "text": "the golden image approach as i cover though you do need another method of configuration management",
    "start": "3054800",
    "end": "3060480"
  },
  {
    "text": "you need another method for service discovery uh and you if you're releasing patches it's going",
    "start": "3060480",
    "end": "3066960"
  },
  {
    "text": "to require an entirely new build um that sucks at first it really sucked",
    "start": "3066960",
    "end": "3073920"
  },
  {
    "text": "for us it was hard uh we didn't have our deployment we didn't have our image creation automated",
    "start": "3073920",
    "end": "3079200"
  },
  {
    "text": "well enough to easily boot uh or easily do a new",
    "start": "3079200",
    "end": "3084319"
  },
  {
    "text": "deploy but when things hurt do them often and then you will automate your way through",
    "start": "3084319",
    "end": "3089520"
  },
  {
    "text": "it and then this is not such a big deal releasing a patch and doing a build isn't so bad",
    "start": "3089520",
    "end": "3094559"
  },
  {
    "text": "um mentioning the service discovery though makes me remember that i didn't actually tell you guys why i hate chef",
    "start": "3094559",
    "end": "3100400"
  },
  {
    "text": "search uh the reason i hate it is that it allows the application to pretend as",
    "start": "3100400",
    "end": "3107119"
  },
  {
    "text": "if the services it depends on will always be there and your applications should not do that",
    "start": "3107119",
    "end": "3114319"
  },
  {
    "text": "if you are writing a distributed application and by the way if you use auto scaling groups",
    "start": "3114319",
    "end": "3119680"
  },
  {
    "text": "you are writing a distributed application things will suddenly show up and things will suddenly disappear",
    "start": "3119680",
    "end": "3125839"
  },
  {
    "text": "and chef search cannot handle that situation appropriately you want your application",
    "start": "3125839",
    "end": "3131760"
  },
  {
    "text": "to be aware of service discovery you want it to be intimately involved so that if something goes wrong and knows",
    "start": "3131760",
    "end": "3137119"
  },
  {
    "text": "how to fail over and it knows where to go look to fail over at that moment during that request not 30 minutes later",
    "start": "3137119",
    "end": "3143520"
  },
  {
    "text": "when it converges that's my little rant i'm happy to rant more later",
    "start": "3143520",
    "end": "3148640"
  },
  {
    "text": "but we're going to run out of time so let's keep moving uh in terms of the golden image approach it works pretty",
    "start": "3148640",
    "end": "3153760"
  },
  {
    "text": "well uh because instances are always booting they always boot fast unplanned downtime thing of the past we",
    "start": "3153760",
    "end": "3160720"
  },
  {
    "text": "had times where oops forgot to add a log rotate everybody's done this right like service has been running fine for",
    "start": "3160720",
    "end": "3167839"
  },
  {
    "text": "like a month and then suddenly they all die because they filled up their disk because you forgot this one little place",
    "start": "3167839",
    "end": "3174240"
  },
  {
    "text": "over here like apache log or something that you didn't add a log rotate on and it's just gonna kill you well",
    "start": "3174240",
    "end": "3181520"
  },
  {
    "text": "if your instances boot really quickly really easily uh when that happens and they start to fail their health check",
    "start": "3181520",
    "end": "3186720"
  },
  {
    "text": "the autoscaling group will restart them and you sleep right through it it is awesome that is like the ultimate",
    "start": "3186720",
    "end": "3194960"
  },
  {
    "text": "solution to any ephemeral bug you have in your application is to kill it and start it anew the immutable server model",
    "start": "3194960",
    "end": "3201280"
  },
  {
    "text": "and using auto scaling groups and golden images makes that just a breeze uh rolling deploys are also extremely",
    "start": "3201280",
    "end": "3207440"
  },
  {
    "text": "easy we used asgard demand to do the orchestration so we had a nice orchestration tool for this",
    "start": "3207440",
    "end": "3212559"
  },
  {
    "text": "and it worked great uh also this this approach ends up being relatively low maintenance once your servers have started they're",
    "start": "3212559",
    "end": "3219680"
  },
  {
    "text": "running once your infrastructure is built you're good to go it's basically going to take care of itself",
    "start": "3219680",
    "end": "3225680"
  },
  {
    "text": "uh i left off the check mark for the low barrier for new services primarily because if you don't have the",
    "start": "3225680",
    "end": "3233200"
  },
  {
    "text": "fancy rpm approach that we built um you're still writing chef cookbooks it's still going to take you a while",
    "start": "3233200",
    "end": "3239359"
  },
  {
    "text": "and you're still going to be sad i cannot stress this enough if you are writing multiple applications",
    "start": "3239359",
    "end": "3245119"
  },
  {
    "text": "find the commonality in those cookbooks and abstract it away so that when you add new services",
    "start": "3245119",
    "end": "3250559"
  },
  {
    "text": "you don't have to go through a lot of pain you instead just say fine you know what yeah you may have to write a chef cookbook but it's going to",
    "start": "3250559",
    "end": "3255920"
  },
  {
    "text": "be a two-liner you just need to add a few attributes and you're good to go do that and you're going to be a lot happier and",
    "start": "3255920",
    "end": "3261200"
  },
  {
    "text": "you'll end up with a much better service oriented architecture it's my recommendation here use this",
    "start": "3261200",
    "end": "3267920"
  },
  {
    "text": "when autoscaling is a must but keep in mind that this requires an upfront effort to get going",
    "start": "3267920",
    "end": "3274240"
  },
  {
    "text": "so there's not enough good tooling for the golden image approach yet yes you have asgard to be able to manage",
    "start": "3274240",
    "end": "3280880"
  },
  {
    "text": "your uh your role your auto scaling groups yes you have amnator to help you with building the amis but you still you got to go in and set",
    "start": "3280880",
    "end": "3287200"
  },
  {
    "text": "up all the jenkins jobs yourself you got to go make all your cookbooks and whatever you gotta um it's gonna like take care of a",
    "start": "3287200",
    "end": "3293280"
  },
  {
    "text": "bit right not enough people are doing this yet none of people have open source something they just go hey here's this magical tool give it a",
    "start": "3293280",
    "end": "3299760"
  },
  {
    "text": "few things and success you're running whereas with chef solo and chef search people kind of",
    "start": "3299760",
    "end": "3305040"
  },
  {
    "text": "have been using those longer and there's more tooling around it so definitely make sure you can afford to do this in the sense that if you're a",
    "start": "3305040",
    "end": "3312160"
  },
  {
    "text": "small startup and you're wondering if you're gonna get that next round of funding i don't know i'm not sure this is the",
    "start": "3312160",
    "end": "3318480"
  },
  {
    "text": "best approach right you need to be worried about what your users need just go ahead use chef solo use the damn",
    "start": "3318480",
    "end": "3324880"
  },
  {
    "text": "data center model and deploy five instances whatever you need just let them run",
    "start": "3324880",
    "end": "3330400"
  },
  {
    "text": "fine it was cheap it took you maybe a few days and you're done and that means you're developing things",
    "start": "3330400",
    "end": "3335920"
  },
  {
    "text": "that your users really want and then you're gonna be happy because they're gonna come and say hey we love",
    "start": "3335920",
    "end": "3341520"
  },
  {
    "text": "what you just made we want to give you money to buy whatever you just tried to sell us we love you and then you get to like go",
    "start": "3341520",
    "end": "3348799"
  },
  {
    "text": "home and be a happy person instead of stay up late at night because you need to get some features done because you spent the past two weeks",
    "start": "3348799",
    "end": "3354960"
  },
  {
    "text": "working on a deployment system uh the main pro tip here use the netflix stack uh",
    "start": "3354960",
    "end": "3360960"
  },
  {
    "text": "if you're on the jvm it's going to make your life a lot easier you get asgard you've got aminator which helps with",
    "start": "3360960",
    "end": "3366400"
  },
  {
    "text": "making those amis and you got archives which helps with your configuration management they've also got a ton of other tools",
    "start": "3366400",
    "end": "3372400"
  },
  {
    "text": "go check that stack out i know they've been talking a lot at this conference it is there's a lot of really really",
    "start": "3372400",
    "end": "3378000"
  },
  {
    "text": "really good stuff in there those guys have been using aws for a very long time and they know what",
    "start": "3378000",
    "end": "3383040"
  },
  {
    "text": "they're doing you can learn from them so with that thank you if you have any",
    "start": "3383040",
    "end": "3388319"
  },
  {
    "text": "questions use this microphone also i was requested to say that",
    "start": "3388319",
    "end": "3393599"
  },
  {
    "text": "they they have feedback that they would love for you guys to give feedback because much like us right we're very player focused we want to do what makes our",
    "start": "3393599",
    "end": "3400000"
  },
  {
    "text": "players happy amazon wants to do what makes their users happy and for you guys here sitting in the audience they don't know",
    "start": "3400000",
    "end": "3406240"
  },
  {
    "text": "if you like these talks unless you go rate them so rate them so they can get good speakers next year so thank you",
    "start": "3406240",
    "end": "3419839"
  },
  {
    "text": "cool",
    "start": "3421200",
    "end": "3424000"
  }
]