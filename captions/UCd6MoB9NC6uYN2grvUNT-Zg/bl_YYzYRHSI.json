[
  {
    "start": "0",
    "end": "134000"
  },
  {
    "text": "all right hello everyone thanks for coming I'm going to be talking to you about how situs data scales our postgres",
    "start": "140",
    "end": "9510"
  },
  {
    "text": "and how it does it on AWS so my name is",
    "start": "9510",
    "end": "21359"
  },
  {
    "text": "will lion or bear you can get in contact me by number on twitter our website is situs data and so just to go over the",
    "start": "21359",
    "end": "29789"
  },
  {
    "text": "overview of what's going to happen in this talk there's two major parts of the talk first is what situs is how it works",
    "start": "29789",
    "end": "37170"
  },
  {
    "text": "how it works as an extension on postgres and then the second part is how we've built a cloud service for it and you",
    "start": "37170",
    "end": "46620"
  },
  {
    "text": "know those sorts of things and so the first part situs is an extension on top",
    "start": "46620",
    "end": "52860"
  },
  {
    "text": "of postgres and we're going to get into our talk about how that enables you to",
    "start": "52860",
    "end": "58109"
  },
  {
    "text": "scale out postcards both in terms of disk storage but also the memory usage",
    "start": "58109",
    "end": "63449"
  },
  {
    "text": "so you can control how much is cached in RAM and also if you need to scale out",
    "start": "63449",
    "end": "69540"
  },
  {
    "text": "your compute and so using situs you can scale out all those different components of your database and then the second",
    "start": "69540",
    "end": "76680"
  },
  {
    "text": "half is the orchestration part of how we built a cloud service on amazon and even",
    "start": "76680",
    "end": "82439"
  },
  {
    "text": "if you're you know not going to be using our cloud service hopefully there's some",
    "start": "82439",
    "end": "87930"
  },
  {
    "text": "tips and tricks that we've learned over the years to that you can use your your own developments of postgres or other",
    "start": "87930",
    "end": "94470"
  },
  {
    "text": "sorts of cloud services and we're going to go over things that worked surprisingly well disaster recovery a",
    "start": "94470",
    "end": "101520"
  },
  {
    "text": "little bit on microservice monitoring and those sorts of things I just curious here who uses postgres today okay that's",
    "start": "101520",
    "end": "109290"
  },
  {
    "text": "that's nice good you all have good choices and taste secondly just it just",
    "start": "109290",
    "end": "115770"
  },
  {
    "text": "curious does anyone know I tried situs before okay call people that's nice all",
    "start": "115770",
    "end": "120899"
  },
  {
    "text": "right um yeah this isn't okay so to",
    "start": "120899",
    "end": "127079"
  },
  {
    "text": "understand to get to the second part to understand the design of the service you first have to know a little bit about how situs works",
    "start": "127079",
    "end": "133530"
  },
  {
    "text": "um so the first most important thing is earlier this year we open source situs",
    "start": "133530",
    "end": "138900"
  },
  {
    "start": "134000",
    "end": "134000"
  },
  {
    "text": "and made it just an extension on top of postgres rather than it being a fork of",
    "start": "138900",
    "end": "144590"
  },
  {
    "text": "postgres where you would be a you know modification and that would make it harder to stay up to date with advances",
    "start": "144590",
    "end": "152190"
  },
  {
    "text": "that put this post crest advances currently it's just an extension on top and that way it's it's still a little",
    "start": "152190",
    "end": "158160"
  },
  {
    "text": "bit of work on our end but it's pretty easy to for us to when the new version",
    "start": "158160",
    "end": "163620"
  },
  {
    "text": "of post gross comes out like when 96 came out and next when postgres 10 comes out to port our think forward so the",
    "start": "163620",
    "end": "171450"
  },
  {
    "text": "extension continues to work and the upside is people who use situs can get a good take advantage of new post Coast",
    "start": "171450",
    "end": "178830"
  },
  {
    "text": "features almost on day one and you know for those of you in many of you were using postgres you know that every year",
    "start": "178830",
    "end": "185640"
  },
  {
    "text": "postgres you know maybe there's not a huge release over a year but there's always something nice that you want to",
    "start": "185640",
    "end": "190860"
  },
  {
    "text": "be taking advantage of and because we're an extension it's very easy for us to continue to support those things so what",
    "start": "190860",
    "end": "200280"
  },
  {
    "start": "198000",
    "end": "198000"
  },
  {
    "text": "the slightest does is it makes turns postgres into a distributed database many apps you know eventually outgrow",
    "start": "200280",
    "end": "207209"
  },
  {
    "text": "single node postgres either you know maybe you know data starts becoming you",
    "start": "207209",
    "end": "212700"
  },
  {
    "text": "know it coming in an increasing rate or you know very frequently people don't no longer start deleting their data I give",
    "start": "212700",
    "end": "219900"
  },
  {
    "text": "a talk once on some strategies to mitigate your postgres growth you know",
    "start": "219900",
    "end": "225720"
  },
  {
    "text": "to keep to try to stay inside single node postgres by you know actually",
    "start": "225720",
    "end": "230760"
  },
  {
    "text": "deleting your old data and I really wanted people to do that but it turns out organizations they just you know",
    "start": "230760",
    "end": "235980"
  },
  {
    "text": "have an addiction to a storing as much data as they possibly can and just end up never deleting anything and now now",
    "start": "235980",
    "end": "242040"
  },
  {
    "text": "that site of something that's fine you should keep all your data forever and use a nice distributed postgres but even",
    "start": "242040",
    "end": "247799"
  },
  {
    "text": "even outside of that there is a you know plenty of reasons for you know legitimate reasons why you have a lot of",
    "start": "247799",
    "end": "252870"
  },
  {
    "text": "data and you need and it's just you know too much for single node postgres",
    "start": "252870",
    "end": "258209"
  },
  {
    "text": "usually people start hitting limits on the amount of RAM that you can have in",
    "start": "258209",
    "end": "263640"
  },
  {
    "text": "one machine I know you know you know uh now recently over the last couple months and",
    "start": "263640",
    "end": "268680"
  },
  {
    "text": "today you know more and more bigger amazon machines with more moran but still you know there's a limit to how how big that can get and then also",
    "start": "268680",
    "end": "276330"
  },
  {
    "text": "postgres itself the 96 i believe has some some advantages with parallel query",
    "start": "276330",
    "end": "283070"
  },
  {
    "text": "doing sequential stands in parallel but really like aggregates and stuff in",
    "start": "283070",
    "end": "288720"
  },
  {
    "text": "parallel like being able to scale out your CPU I've seen some you know going",
    "start": "288720",
    "end": "293760"
  },
  {
    "text": "on some customers calls I've seen using equivalent amount of spend on single",
    "start": "293760",
    "end": "298770"
  },
  {
    "text": "note postgres to a small cluster of situs up to like 100 150 x improvements",
    "start": "298770",
    "end": "304410"
  },
  {
    "text": "because they were CPU bound and post go Spidey fell just has one back end and you're limited mostly more more or less",
    "start": "304410",
    "end": "310770"
  },
  {
    "text": "with some caveats to one processor working on the data and so cited takes",
    "start": "310770",
    "end": "315810"
  },
  {
    "text": "care of charting the data too many nodes it takes care of routing queries to the appropriate node paralyzing the queries",
    "start": "315810",
    "end": "322050"
  },
  {
    "text": "to do all the work in parallel and the exciting thing is the worker nodes there's nothing special there just",
    "start": "322050",
    "end": "327690"
  },
  {
    "text": "postgres instances and what I mean by that in the terminology that we use tend",
    "start": "327690",
    "end": "333540"
  },
  {
    "start": "330000",
    "end": "330000"
  },
  {
    "text": "to use a lot we have you know worker zero worker one so on and so forth and on these workers there's shards of data",
    "start": "333540",
    "end": "339660"
  },
  {
    "text": "and so we can have you know your one table could be split into maybe let's say 64 128 shards you know some of those",
    "start": "339660",
    "end": "347700"
  },
  {
    "text": "will be on the first worker some of the maybe on the next worker and so on and what's really going on is these are just",
    "start": "347700",
    "end": "353580"
  },
  {
    "start": "352000",
    "end": "352000"
  },
  {
    "text": "servers and tables so each one of these is a normal postcode server that you're if you're operating yourself it operates",
    "start": "353580",
    "end": "360690"
  },
  {
    "text": "in much the same way similar backup disaster recovery sorts of things and",
    "start": "360690",
    "end": "365729"
  },
  {
    "text": "the actual shards just show up as tables and to just to drive that home a little",
    "start": "365729",
    "end": "371729"
  },
  {
    "text": "bit I on the coordinator note here that takes care of running some queries I'm",
    "start": "371729",
    "end": "377760"
  },
  {
    "text": "listing you know using backslash dnp sequel to list what tables I have and this is actually a production database",
    "start": "377760",
    "end": "383790"
  },
  {
    "text": "that I use myself and we'll get into some of what these tables are later I just have two little tables here but",
    "start": "383790",
    "end": "391050"
  },
  {
    "text": "when you go to one of the worker nodes and run it you can see here now there's the same tables but with their shard",
    "start": "391050",
    "end": "397620"
  },
  {
    "text": "number placed on them and if you do connect to this you can't actually just look at it and it's just the normal table but split up into these",
    "start": "397620",
    "end": "404290"
  },
  {
    "text": "little pieces so when a right comes in",
    "start": "404290",
    "end": "411100"
  },
  {
    "text": "like an insert update delete we look at how it started so when you make a table",
    "start": "411100",
    "end": "417310"
  },
  {
    "text": "you say i want this table to be charted by this column and so when the query",
    "start": "417310",
    "end": "423670"
  },
  {
    "text": "comes in to do a right we know where that's going to end up we hash that value we know which shard and by and",
    "start": "423670",
    "end": "430660"
  },
  {
    "text": "therefore which server to go to and we go and do that right operation and the",
    "start": "430660",
    "end": "437470"
  },
  {
    "text": "way we do the hashing there's a little what you call it the catalogue table and",
    "start": "437470",
    "end": "444400"
  },
  {
    "text": "you can see here that the first shard takes you know- you know two billion",
    "start": "444400",
    "end": "451060"
  },
  {
    "text": "whatever to the next next version so on and so forth and those are where this that's how we know where the shard ends",
    "start": "451060",
    "end": "457510"
  },
  {
    "text": "up and that's how that's all rights go no matter what now there's two models",
    "start": "457510",
    "end": "464170"
  },
  {
    "text": "two sorts of ways that we see people using situs most frequently one is like",
    "start": "464170",
    "end": "469570"
  },
  {
    "text": "a real-time sequel event data and the other is sort of a multi-tenant model",
    "start": "469570",
    "end": "475240"
  },
  {
    "text": "and i'm going to get into both of these and so the first one the multi-tenant",
    "start": "475240",
    "end": "480730"
  },
  {
    "start": "477000",
    "end": "477000"
  },
  {
    "text": "model this is if it's the system of record for your you're like",
    "start": "480730",
    "end": "486550"
  },
  {
    "text": "multi-tenancy ASAP let's say you have an application that you have individual customers they each to get their own",
    "start": "486550",
    "end": "493030"
  },
  {
    "text": "silo of data but it's the same set of tables for each of your customers and",
    "start": "493030",
    "end": "498240"
  },
  {
    "text": "you know for example you know Salesforce you know other sorts of reporting you",
    "start": "498240",
    "end": "505810"
  },
  {
    "text": "know sort of apps where if you were going to char this yourself in the application layer what you would do is",
    "start": "505810",
    "end": "511750"
  },
  {
    "text": "have a you know a number of post cross-post dresses maybe maybe using",
    "start": "511750",
    "end": "516880"
  },
  {
    "text": "I've seen this a lot unfortunately using the post kosis schemas to do the sharding which that if anyone's doing",
    "start": "516880",
    "end": "523390"
  },
  {
    "text": "that right now be aware that like PG dump starts to fail over after you get a certain number of tenants and that can",
    "start": "523390",
    "end": "528820"
  },
  {
    "text": "be I saw one we're just planning queries took minutes because of",
    "start": "528820",
    "end": "535300"
  },
  {
    "text": "all the different schema objects and it was a nightmare so anyway but that's I",
    "start": "535300",
    "end": "540400"
  },
  {
    "text": "see you know that's an approach that so every single customer has their own sets of tables and if you use that on situs I",
    "start": "540400",
    "end": "549780"
  },
  {
    "text": "instead of having to put that logic in your application you can have the database take care of doing the logic of",
    "start": "549780",
    "end": "555370"
  },
  {
    "text": "charting out each one of these tenants for you and the nice thing about this",
    "start": "555370",
    "end": "561190"
  },
  {
    "text": "sort of multi design approach is it's easy to do migrations it's easy to migrate from both Dubai grey shins of",
    "start": "561190",
    "end": "567580"
  },
  {
    "text": "your source you know when you're adding columns and such because you only have to do it in one spot you don't have to track down each of your your columns",
    "start": "567580",
    "end": "574420"
  },
  {
    "text": "each of your tables across like databases you can do the ddl in one spot you know that works very nicely it's all",
    "start": "574420",
    "end": "581830"
  },
  {
    "text": "so simple to go if you're already doing this on a single postgres now you can migrate into multi-node site is fairly",
    "start": "581830",
    "end": "588160"
  },
  {
    "text": "straightforward you don't really have to rewrite much of your application you know you get I think pretty much all",
    "start": "588160",
    "end": "594640"
  },
  {
    "text": "postgres just works in this model it's easy to maintain you know h-hi",
    "start": "594640",
    "end": "601450"
  },
  {
    "text": "availability works the same way as you would use in your postgres backups you can use BG dumps you can use while while",
    "start": "601450",
    "end": "607930"
  },
  {
    "text": "shipping that all works fine and it's easy to scale both vertically by making",
    "start": "607930",
    "end": "613480"
  },
  {
    "text": "the worker nodes individually larger instances or you can add new nodes to",
    "start": "613480",
    "end": "618610"
  },
  {
    "text": "the cluster as your as you need more as your demands increase and just to get",
    "start": "618610",
    "end": "626530"
  },
  {
    "text": "into how this works it's important that all of the tables have the same shard",
    "start": "626530",
    "end": "632740"
  },
  {
    "text": "key and so for if you had you know customer ID or 10 an ID or organization",
    "start": "632740",
    "end": "638920"
  },
  {
    "text": "ID those are the common ones I see each table you doubt so each table has that",
    "start": "638920",
    "end": "644830"
  },
  {
    "text": "reference and then as long as the queries all go in reference that same column when you're doing the charting",
    "start": "644830",
    "end": "650470"
  },
  {
    "text": "everything works just nice and just to you know illustrate this a little bit more let's say it's we're using org ID",
    "start": "650470",
    "end": "657460"
  },
  {
    "text": "as our key the query comes in and it says you know whatever whatever whatever",
    "start": "657460",
    "end": "662770"
  },
  {
    "text": "and then where org ID equals 3 we know how to shard that we know how to",
    "start": "662770",
    "end": "668650"
  },
  {
    "text": "you know what chart it goes to what server goes to the query gets routed there it executes and you get your data",
    "start": "668650",
    "end": "675520"
  },
  {
    "text": "there and this is you know pretty much you know nothing's magical is going on here this is like exactly as you would",
    "start": "675520",
    "end": "682570"
  },
  {
    "text": "do it yourself were you to push the appt push the charting logic into your own",
    "start": "682570",
    "end": "687760"
  },
  {
    "text": "application the other model is pretty exciting the sort of parallel kind of no",
    "start": "687760",
    "end": "695800"
  },
  {
    "start": "690000",
    "end": "690000"
  },
  {
    "text": "sequel ish model and this you can do normal sequel pretty much on you know",
    "start": "695800",
    "end": "704290"
  },
  {
    "text": "trillions of events for like real-time analytics sort of the advantages here is",
    "start": "704290",
    "end": "709750"
  },
  {
    "text": "that you still get to use postgres you get to use your post cuts drivers it's you know more familiar than having to go",
    "start": "709750",
    "end": "716140"
  },
  {
    "text": "to a complete complete rewrite system like Cassandra or something else you",
    "start": "716140",
    "end": "721600"
  },
  {
    "text": "could to keep more of your experience in house lower costs you can you know use your existing team skills also for",
    "start": "721600",
    "end": "728410"
  },
  {
    "text": "orchestrating and managing like you know it still feels the same as post crest and you get to take advantage of",
    "start": "728410",
    "end": "735250"
  },
  {
    "text": "accessible features for example when JSON be landed our release or two ago that makes it you know great you know",
    "start": "735250",
    "end": "741970"
  },
  {
    "text": "great store for being able to have indexes on sort of you know semi relational data and sort of you know mix",
    "start": "741970",
    "end": "749530"
  },
  {
    "text": "the two having you know real columns and sort of like an amorphous you know extra",
    "start": "749530",
    "end": "756220"
  },
  {
    "text": "data and be able to do you know computation on both and the other thing",
    "start": "756220",
    "end": "762820"
  },
  {
    "text": "that's nice just going back to the cost thing because it is postgres you can spill to disk you can have you for you",
    "start": "762820",
    "end": "770440"
  },
  {
    "text": "know some some solutions in this thing or in memory only and that can get very expensive as you have to keep adding new",
    "start": "770440",
    "end": "776830"
  },
  {
    "text": "machines to just because ram is very very expensive because it's as postgres it operates the same way you can have",
    "start": "776830",
    "end": "782170"
  },
  {
    "text": "you know just a portion of your data set in RAM and the rest spilling to disk and",
    "start": "782170",
    "end": "788700"
  },
  {
    "text": "the way this works is when the query comes in you know now we're starting on something different maybe we're starting",
    "start": "788700",
    "end": "794560"
  },
  {
    "text": "just on a uuid to distribute the data randomly maybe we're starting on you know timestamp or you know depending",
    "start": "794560",
    "end": "802570"
  },
  {
    "text": "on this is you know depending on your application choosing the right shard can this is important and it's you know sort",
    "start": "802570",
    "end": "809350"
  },
  {
    "text": "of application specific but when the query comes in because you're not saying that same chart key what happens is the",
    "start": "809350",
    "end": "815350"
  },
  {
    "text": "query gets paralyzed and it hits every single one of your servers and in this",
    "start": "815350",
    "end": "820750"
  },
  {
    "text": "way the the computation happens in parallel across not only all the servers",
    "start": "820750",
    "end": "826870"
  },
  {
    "text": "in your cluster but all the CPU cores in your in your cluster and so you can put your entire your entire cluster to work",
    "start": "826870",
    "end": "833709"
  },
  {
    "text": "doing aggregations that can be pushed down and then then the data that as a",
    "start": "833709",
    "end": "842200"
  },
  {
    "text": "you know the stuff that can't be pushed down gets brought back up to one of the nodes and you know further aggregations",
    "start": "842200",
    "end": "849130"
  },
  {
    "text": "done there and then it returns back one of the things though because this is splitting off the work and doing you",
    "start": "849130",
    "end": "855790"
  },
  {
    "text": "know stuff in parallel now you start giving into a couple trade-offs some complicated ct's can't work but you know",
    "start": "855790",
    "end": "864519"
  },
  {
    "text": "it's a lot of sequel but it's not you know all sequel whereas before in the other model because it was going to a",
    "start": "864519",
    "end": "869649"
  },
  {
    "text": "single node we're able to do you know full sequel coverage this because we're splitting you know things apart you know",
    "start": "869649",
    "end": "876070"
  },
  {
    "text": "certain aggregations that rely on accessing all the data at one time those are harder to do and we're increasing",
    "start": "876070",
    "end": "883480"
  },
  {
    "text": "our sequel coverage over time but right now this is where you might run into a couple stumbling blocks and if any of",
    "start": "883480",
    "end": "889060"
  },
  {
    "text": "you do are using situs and you run into something when you're doing this we have a very active slack channel and people",
    "start": "889060",
    "end": "896829"
  },
  {
    "text": "were we can you know help you walk you through this because this is maybe of all the places where there might be a stumbling block this is maybe maybe one",
    "start": "896829",
    "end": "903820"
  },
  {
    "text": "of them but it's not so bad and because of this i mentioned before this is one",
    "start": "903820",
    "end": "909730"
  },
  {
    "text": "of the customers where we saw like a hundred 200 x improvement because their workload was cpu-bound being able to",
    "start": "909730",
    "end": "916060"
  },
  {
    "text": "push it out and hit all of the nodes that's how you get you know some pretty",
    "start": "916060",
    "end": "921220"
  },
  {
    "text": "incredible performance increases",
    "start": "921220",
    "end": "924360"
  },
  {
    "start": "923000",
    "end": "923000"
  },
  {
    "text": "and one of the more recent things that we announced back in September is situs",
    "start": "926630",
    "end": "931860"
  },
  {
    "text": "MX and I'm pretty excited about this all the previous ones when you would issue a",
    "start": "931860",
    "end": "937080"
  },
  {
    "text": "query it would go to one coordinator node and that would do the work of by aggregating of the data side SMX now you",
    "start": "937080",
    "end": "944130"
  },
  {
    "text": "can when you connect to it you get assigned to any one of the nodes in your",
    "start": "944130",
    "end": "949770"
  },
  {
    "text": "cluster and it sort of is you know sort of a no master kind of approach and with",
    "start": "949770",
    "end": "956370"
  },
  {
    "text": "this approach the rights just the right scale and goes really huge and we have",
    "start": "956370",
    "end": "961440"
  },
  {
    "text": "an example here that I'm going to show I was a little bit too nervous to do the",
    "start": "961440",
    "end": "966450"
  },
  {
    "text": "example outside one of my colleagues I recorded a demo I didn't want to attempt the the Wi-Fi demo God's here but just",
    "start": "966450",
    "end": "974910"
  },
  {
    "text": "an overview of how it works when you there's still a coordinator node but all it's used for is when you're doing ddl",
    "start": "974910",
    "end": "982170"
  },
  {
    "text": "so that's you know create table alter table and that's just to keep everything consistent when you're doing those very",
    "start": "982170",
    "end": "987870"
  },
  {
    "text": "infrequent but very important updates to your schema the rest of it the inserts updates deletes enquiries they go to a",
    "start": "987870",
    "end": "995390"
  },
  {
    "text": "round robin DNS to go randomly to one of",
    "start": "995390",
    "end": "1000410"
  },
  {
    "text": "the the worker nodes and and so this is how all of the rights can be happening",
    "start": "1000410",
    "end": "1006890"
  },
  {
    "text": "in parallel not bottlenecked on a single on a single thing and so this is a I",
    "start": "1006890",
    "end": "1013040"
  },
  {
    "text": "think about four minute example of using situs cloud to provision one of these sites MX and going through the YC SB I",
    "start": "1013040",
    "end": "1022370"
  },
  {
    "text": "think the Yahoo cloud benchmark to do to do that and I think I do that in this",
    "start": "1022370",
    "end": "1030170"
  },
  {
    "text": "demo we will set aside as an exclamation using decide about consciousness i will",
    "start": "1030170",
    "end": "1035300"
  },
  {
    "text": "use for notes and high availability little toad meaning each node has a hot standby which automatically takes over",
    "start": "1035300",
    "end": "1041839"
  },
  {
    "text": "the case until early early 15 formation is ready ready ready I will see this out",
    "start": "1041839",
    "end": "1047030"
  },
  {
    "text": "where I can monitor and change my formation and I will find my where else to connect you to recommend to the post",
    "start": "1047030",
    "end": "1052790"
  },
  {
    "text": "post business I can get started with size by connecting typically namely the coordinator is a small",
    "start": "1052790",
    "end": "1059120"
  },
  {
    "text": "additional posters mode which I only use for it whispers if you man sighs an",
    "start": "1059120",
    "end": "1064700"
  },
  {
    "text": "extension post which adds the ability to distribute tables across servers I can",
    "start": "1064700",
    "end": "1070820"
  },
  {
    "text": "create a distributed renewable by first creating it was personable and then specifying my institution column and",
    "start": "1070820",
    "end": "1077299"
  },
  {
    "text": "creating a number of shark each shard to contain a different set of advice I sizes after creating a stir it is table",
    "start": "1077299",
    "end": "1085970"
  },
  {
    "text": "I can start using this data at around out which connects Hayes to Iran brand a diode every of data contains a different",
    "start": "1085970",
    "end": "1093500"
  },
  {
    "text": "set of a number charge as well as the district is capable people right right as a distributive table are routed to a",
    "start": "1093500",
    "end": "1099799"
  },
  {
    "text": "particular chart based on the device I cycling if I then connect it into a",
    "start": "1099799",
    "end": "1104929"
  },
  {
    "text": "different mode I will see the same miss you sit at a table with all preceding right rights and consistent manner now",
    "start": "1104929",
    "end": "1112340"
  },
  {
    "text": "let's add some more data network marketer capable this duel starts a number of the red red switch send the",
    "start": "1112340",
    "end": "1118100"
  },
  {
    "text": "individual channel search through the database biodata am getting a quick tour around around 10000 SEK SEK if I want to",
    "start": "1118100",
    "end": "1125870"
  },
  {
    "text": "I or higher to it I can easily scale out my cluster by adding the nose cited",
    "start": "1125870",
    "end": "1131000"
  },
  {
    "text": "constantly after a while you know notes online without doubt eruption and I can",
    "start": "1131000",
    "end": "1137029"
  },
  {
    "text": "see my space with increasing my lady draw draw because my fries are now going to bio knows that or how ever ever my",
    "start": "1137029",
    "end": "1145309"
  },
  {
    "text": "data is still on the original store no to solve this is I can run the sharp FX processors which automatically move",
    "start": "1145309",
    "end": "1152149"
  },
  {
    "text": "shards are between the data tables 1 by 11 while the shark amount is running where is on the distributive table will",
    "start": "1152149",
    "end": "1159200"
  },
  {
    "text": "continue as normal except right right in the shard are currently being the full experience I relate lately once the char",
    "start": "1159200",
    "end": "1167419"
  },
  {
    "text": "dham dham dham the data is redistributed and I can see my strength living with each piece dirty browser sexy a clinic",
    "start": "1167419",
    "end": "1173750"
  },
  {
    "text": "twice twice we had my treat change while I am sure its are on roaming I can still",
    "start": "1173750",
    "end": "1180380"
  },
  {
    "text": "build fast unlike like such a history for a particular device which goes to a six HR",
    "start": "1180380",
    "end": "1185810"
  },
  {
    "text": "or disagree across all devices which side they're Eliza and frost you might",
    "start": "1185810",
    "end": "1192860"
  },
  {
    "text": "be wondering how fast inside us this week so I set up another formation g33",
    "start": "1192860",
    "end": "1198350"
  },
  {
    "text": "trigger notes on which everyone run why seas adventure why sleazy is a benchmark",
    "start": "1198350",
    "end": "1204050"
  },
  {
    "text": "more tests can query through through through with reads and writes in particular i use the white boys javelin",
    "start": "1204050",
    "end": "1210590"
  },
  {
    "text": "which connected post-prison jjc and configured in 0 to 10 million rows 100 x",
    "start": "1210590",
    "end": "1217250"
  },
  {
    "text": "by 2 r under a little venture where i set up at 32 driver is 180 days to run",
    "start": "1217250",
    "end": "1224390"
  },
  {
    "text": "the white lies a command been shipped of them i use yukia's eh engine which runs Rises age commands para verlo after a",
    "start": "1224390",
    "end": "1231830"
  },
  {
    "text": "while I can I see the results coming in in and each no note or more around it seems out in search your second deck",
    "start": "1231830",
    "end": "1238190"
  },
  {
    "text": "which adds up some over Wi-Fi mcdowell team searcher per second and these are consistent through more right right",
    "start": "1238190",
    "end": "1244640"
  },
  {
    "text": "using decided I loud obnoxious if you need even be higher throughput you can",
    "start": "1244640",
    "end": "1250850"
  },
  {
    "text": "use the copy command to attend the raw data file i recollected initiative inescapable we put a file at 10 million",
    "start": "1250850",
    "end": "1257060"
  },
  {
    "text": "rows on each of the driver I prices and load using haha the whole process of",
    "start": "1257060",
    "end": "1262400"
  },
  {
    "text": "loading 320 million rows took only 45 seconds which is 70 million euros per",
    "start": "1262400",
    "end": "1267920"
  },
  {
    "text": "second if you're interested in using sided imac next so yeah so that's the",
    "start": "1267920",
    "end": "1274460"
  },
  {
    "start": "1273000",
    "end": "1273000"
  },
  {
    "text": "copy is a little bit cheating because it is just bulk loading it's not doing it but it is so we don't like to advertise",
    "start": "1274460",
    "end": "1280400"
  },
  {
    "text": "the number too much because it's just because it's you know it's only if you do have data to bulk load but the but",
    "start": "1280400",
    "end": "1287390"
  },
  {
    "text": "the the random inserts of the yahoo benchmark is very nice because it's more more accurately simulates what a",
    "start": "1287390",
    "end": "1294650"
  },
  {
    "text": "production load might be and of course that's hard to do and in a benchmark it's hard to you know do you know real",
    "start": "1294650",
    "end": "1302060"
  },
  {
    "text": "production use into a synthetic benchmark but as far as benchmark goes I like the yahoo one a lot because it is",
    "start": "1302060",
    "end": "1307340"
  },
  {
    "text": "more random writes in different locations and the bulk loading that can",
    "start": "1307340",
    "end": "1312710"
  },
  {
    "text": "go so fast because postgres copy is very fast and we can route that to the right node and then postgres copy just pretty much just",
    "start": "1312710",
    "end": "1320340"
  },
  {
    "text": "splats the the tuples you know straight to disk and so that that's limited mostly on your disk throughput and so",
    "start": "1320340",
    "end": "1328770"
  },
  {
    "text": "you sort of have two choices with sinus you can run it yourself it's open source you can go take it play with it today",
    "start": "1328770",
    "end": "1334380"
  },
  {
    "text": "and there's nothing wrong with running it yourself but there is you know a little bit more effort into keeping a",
    "start": "1334380",
    "end": "1342000"
  },
  {
    "text": "cluster of post gross machines happy and healthy and running than it is to just",
    "start": "1342000",
    "end": "1347420"
  },
  {
    "text": "11 postgres and it's maybe a couple replicas and so because of that I joined",
    "start": "1347420",
    "end": "1353330"
  },
  {
    "text": "you know situs a little while ago to help build their cloud service and I",
    "start": "1353330",
    "end": "1360950"
  },
  {
    "start": "1360000",
    "end": "1360000"
  },
  {
    "text": "there are some trade-offs too you're not running yourself and there are some",
    "start": "1360950",
    "end": "1366870"
  },
  {
    "text": "benefits to not run yourself one of the benefits is that as you know sort of a centralized point we get to see the",
    "start": "1366870",
    "end": "1373500"
  },
  {
    "text": "failure modes of you know many different customers and sort of take that expertise and you know put that across",
    "start": "1373500",
    "end": "1378810"
  },
  {
    "text": "you know and hope everyone out and we see you know see more failures than or",
    "start": "1378810",
    "end": "1384390"
  },
  {
    "text": "weird edge cases you know dealing with Amazon then you would yourself running",
    "start": "1384390",
    "end": "1389550"
  },
  {
    "text": "just an application for your one company the downside though of course is it is a",
    "start": "1389550",
    "end": "1394830"
  },
  {
    "text": "loss of control if you're running it yourself you have full control of everything but you know you do also have all of the blame and so this is sort of",
    "start": "1394830",
    "end": "1401730"
  },
  {
    "text": "the two trade-offs I do have to get a little bit into the origins many of the",
    "start": "1401730",
    "end": "1406950"
  },
  {
    "text": "original decisions that went into this actually started five six years ago with",
    "start": "1406950",
    "end": "1413030"
  },
  {
    "text": "my former team kuroko postgres I see some of my former colleagues here thank",
    "start": "1413030",
    "end": "1419220"
  },
  {
    "text": "you very much for for coming and and so you know you know we were able to",
    "start": "1419220",
    "end": "1427080"
  },
  {
    "text": "leverage you know many of the decisions and learnings about dealing with a cloud service on Amazon having you know come",
    "start": "1427080",
    "end": "1433110"
  },
  {
    "text": "through and done this you know sort of you know this is maybe I mean it's not not not really but it's maybe like the",
    "start": "1433110",
    "end": "1438660"
  },
  {
    "text": "sixth year of running databases on amazon and I can't overstate like the",
    "start": "1438660",
    "end": "1444000"
  },
  {
    "text": "confidence and that that that that experience gave us and so",
    "start": "1444000",
    "end": "1450900"
  },
  {
    "start": "1449000",
    "end": "1449000"
  },
  {
    "text": "the way we're doing this just to you know set the stage a little bit we're using a ruby thing called Sinatra which",
    "start": "1450900",
    "end": "1458760"
  },
  {
    "text": "is a small API framework to do the orchestration and one of the things I don't know does anyone here use the",
    "start": "1458760",
    "end": "1465270"
  },
  {
    "text": "sequel library and poster for Berube yeah like if you are using Ruby the",
    "start": "1465270",
    "end": "1471770"
  },
  {
    "text": "sequel is one of the best run projects that I've ever come across it's a one",
    "start": "1471770",
    "end": "1478020"
  },
  {
    "text": "guy Jeremy Evans mainly coordinating the the project and if you if you go to see a github com / jeremy evans / seek well",
    "start": "1478020",
    "end": "1485550"
  },
  {
    "text": "if you go there and look at the issues right now there's probably zero issues and that's not because people aren't",
    "start": "1485550",
    "end": "1490950"
  },
  {
    "text": "reporting it that's because he closes the issues almost immediately it's like and there's the other thing that I",
    "start": "1490950",
    "end": "1497130"
  },
  {
    "text": "really love about sequel is there's one release every month and it's just the accumulation of some small changes it's",
    "start": "1497130",
    "end": "1503490"
  },
  {
    "text": "not you know some other software projects where you know every once in a while there's a big release and you have to do a lot of work to get on top of it",
    "start": "1503490",
    "end": "1509700"
  },
  {
    "text": "and you know fix things this you know sort of incremental changes has been it's a joy to use so I try to I try to",
    "start": "1509700",
    "end": "1516930"
  },
  {
    "text": "tell people about it as much as i can because it's a it's a great you know little-known project some people ask me",
    "start": "1516930",
    "end": "1524730"
  },
  {
    "start": "1523000",
    "end": "1523000"
  },
  {
    "text": "you know will why are you doing you know something in Ruby isn't it slow isn't it you know this and that but the biggest",
    "start": "1524730",
    "end": "1532650"
  },
  {
    "text": "reason the hands down the biggest reason that I used Ruby again for this project was the interactive console being able",
    "start": "1532650",
    "end": "1539940"
  },
  {
    "text": "to you know you know fart you know firefighting situation and it may be you know something is wrong with these 10",
    "start": "1539940",
    "end": "1545370"
  },
  {
    "text": "servers maybe you know servers on this particular am I have some sort of",
    "start": "1545370",
    "end": "1550500"
  },
  {
    "text": "problem you know the you know just any sort of situation being able to open an interactive console in production grab",
    "start": "1550500",
    "end": "1558540"
  },
  {
    "text": "the servers that I need to fix fire off commands is just you know such a huge",
    "start": "1558540",
    "end": "1565200"
  },
  {
    "text": "performance increase rather you know just on my time rather than having to you know muck around with the CLI tool",
    "start": "1565200",
    "end": "1572490"
  },
  {
    "text": "or you know have to make API calls or whatever having it having the the tool",
    "start": "1572490",
    "end": "1578490"
  },
  {
    "text": "that I operate the service would be the same the same concepts the same",
    "start": "1578490",
    "end": "1583890"
  },
  {
    "text": "programming models as the code itself is just removes a you know impedance mismatch that would would be there were",
    "start": "1583890",
    "end": "1592380"
  },
  {
    "text": "there not a nice interactive console the other big thing that carried over in",
    "start": "1592380",
    "end": "1599760"
  },
  {
    "start": "1595000",
    "end": "1595000"
  },
  {
    "text": "idea is having mostly immutable servers oh we always prefer to throw away a",
    "start": "1599760",
    "end": "1605490"
  },
  {
    "text": "server entirely rather than go in and muck about with the configuration or",
    "start": "1605490",
    "end": "1610970"
  },
  {
    "text": "whatever now this you know I say mostly you know sometimes if there's a very important you know very important very",
    "start": "1610970",
    "end": "1617670"
  },
  {
    "text": "time sensitive security improvement you know you know let's say SSL I don't know if that ever has any security things but",
    "start": "1617670",
    "end": "1624090"
  },
  {
    "text": "sometimes it does that is easy to go in right away and just patch that but if",
    "start": "1624090",
    "end": "1629910"
  },
  {
    "text": "it's something you know less time sensitive it's we always prefer to make a new am I spin up a replica of the",
    "start": "1629910",
    "end": "1638670"
  },
  {
    "text": "server that we're going to take down and then do a controlled switch and that way we know you know there's not we you know",
    "start": "1638670",
    "end": "1646230"
  },
  {
    "text": "servers don't get weird you know configurations because they got monkeyed with a little bit you know things are",
    "start": "1646230",
    "end": "1652260"
  },
  {
    "text": "pretty pretty standard pretty you know non surprising and the other nice thing",
    "start": "1652260",
    "end": "1659040"
  },
  {
    "text": "about the servers being mostly immutable is that if the main monitoring orchestration app goes down the",
    "start": "1659040",
    "end": "1666240"
  },
  {
    "text": "databases aren't dependent on that they live on and the way we do this is by",
    "start": "1666240",
    "end": "1671340"
  },
  {
    "start": "1671000",
    "end": "1671000"
  },
  {
    "text": "having outside in Isis hnp sequel checks and so rather than have an agent on the",
    "start": "1671340",
    "end": "1680190"
  },
  {
    "text": "box you know spitting out you know metrics and something that we'd have to go and update as we wanted to do new",
    "start": "1680190",
    "end": "1686220"
  },
  {
    "text": "chucks all we have to do is update the central monitoring application and it starts doing new checks new health",
    "start": "1686220",
    "end": "1693150"
  },
  {
    "text": "checks new you know metrics gathering and so on and this is how you know",
    "start": "1693150",
    "end": "1698190"
  },
  {
    "text": "there's no the server itself doesn't need to know that it's being monitored it doesn't need to be sending stuff you",
    "start": "1698190",
    "end": "1704610"
  },
  {
    "text": "know it we just connect do some checks and the other nice thing is because we're doing these connections frequently",
    "start": "1704610",
    "end": "1711870"
  },
  {
    "text": "we can sort of know if there's maybe a network interruption rather than if the",
    "start": "1711870",
    "end": "1716980"
  },
  {
    "text": "there was a monitoring agent on the box any metrics out we might not be able to notice that you know there's some sort",
    "start": "1716980",
    "end": "1723250"
  },
  {
    "text": "of networking problem I I do want to go on a little bit of a small I don't wanna",
    "start": "1723250",
    "end": "1732100"
  },
  {
    "text": "use the word grant but something like that on microservices you know so essentially as things grow like you know",
    "start": "1732100",
    "end": "1738280"
  },
  {
    "text": "we need you know an approach to you know breaking up the coding and you know",
    "start": "1738280",
    "end": "1743679"
  },
  {
    "text": "growing the service I'm sure you know many of you are familiar already with Conway's law but just to reiterate",
    "start": "1743679",
    "end": "1750360"
  },
  {
    "start": "1746000",
    "end": "1746000"
  },
  {
    "text": "organized organizations which design systems are constrained to produce designs which are copies of the",
    "start": "1750360",
    "end": "1755410"
  },
  {
    "text": "communication structures of the organization and when I first heard about this you know I don't know how",
    "start": "1755410",
    "end": "1761110"
  },
  {
    "text": "long ago I I thought you know this is something to be avoided like you know the system should be designed as the system should be and you know just",
    "start": "1761110",
    "end": "1767500"
  },
  {
    "text": "because there's people involved like that we shouldn't you know that's unfortunate that we have to you know that's silly we should fight against but",
    "start": "1767500",
    "end": "1773650"
  },
  {
    "text": "now I think that it's maybe just unavoidable and just kind of embrace that that it's going to happen and keep",
    "start": "1773650",
    "end": "1779860"
  },
  {
    "text": "that in mind when developing your teams when splitting out teams rather than try and fight it from the engineering side I",
    "start": "1779860",
    "end": "1788669"
  },
  {
    "start": "1788000",
    "end": "1788000"
  },
  {
    "text": "so the you know the upsides of microscope is of course you know the people got on and on about that for you",
    "start": "1788669",
    "end": "1793750"
  },
  {
    "text": "know years now two years maybe the the downsides though is I you can no longer",
    "start": "1793750",
    "end": "1800380"
  },
  {
    "text": "look in a single place single point of truth now you have to do API calls and like to figure out what's going on and",
    "start": "1800380",
    "end": "1806080"
  },
  {
    "text": "while each individual app might be simpler all that complexity is pushed into the communication channels between",
    "start": "1806080",
    "end": "1812410"
  },
  {
    "text": "the apps which is you know much orders of magnitude harder to debug and reason about and so when building this I wanted",
    "start": "1812410",
    "end": "1820210"
  },
  {
    "text": "to keep it as few services as possible but it's still we still needed sort of",
    "start": "1820210",
    "end": "1826419"
  },
  {
    "text": "two different services that it made sense to do it that way one of them is",
    "start": "1826419",
    "end": "1835049"
  },
  {
    "text": "the external you I that we saw in the demo video that that web page it that",
    "start": "1835049",
    "end": "1842740"
  },
  {
    "text": "thing takes care of you no user facing things and the other one is the inner turtle control plane which is",
    "start": "1842740",
    "end": "1848930"
  },
  {
    "text": "handles managing the fleet and so on to go into detail about the two things the",
    "start": "1848930",
    "end": "1855140"
  },
  {
    "text": "council we also yeah we also do billing we show metrics and the reason this",
    "start": "1855140",
    "end": "1861920"
  },
  {
    "text": "makes sense is a separate thing is because this you know doesn't get interacted with that off and it's only ever responding to people going in and",
    "start": "1861920",
    "end": "1868400"
  },
  {
    "text": "clicking around there's not you know it's not an automated service that you know computers are talking to it's just you know a human interaction thing and",
    "start": "1868400",
    "end": "1876260"
  },
  {
    "text": "for this one we do use rails but we swapped out active record for sequel just because I already want my you know",
    "start": "1876260",
    "end": "1884180"
  },
  {
    "text": "how much I love it but it was great and",
    "start": "1884180",
    "end": "1889600"
  },
  {
    "text": "the control plane this is what does the server provisioning it does the",
    "start": "1889600",
    "end": "1894650"
  },
  {
    "text": "monitoring it does healing of you know disaster recovery it's really the you",
    "start": "1894650",
    "end": "1899870"
  },
  {
    "text": "know that's sort of the brains behind the cloud service and this one uses Sinatra and seek well and that's going",
    "start": "1899870",
    "end": "1906110"
  },
  {
    "text": "to be the focus for the rest of the remainder of the talk you know the",
    "start": "1906110",
    "end": "1912140"
  },
  {
    "start": "1910000",
    "end": "1910000"
  },
  {
    "text": "commonalities are you know Ruby and sequel which I mentioned and before your",
    "start": "1912140",
    "end": "1917930"
  },
  {
    "start": "1914000",
    "end": "1914000"
  },
  {
    "text": "father need to introduce some of the the concepts that I'm going to be you know talking about how we model running a",
    "start": "1917930",
    "end": "1923630"
  },
  {
    "text": "service on amazon one is the formation and server so affirmation is the entire",
    "start": "1923630",
    "end": "1931120"
  },
  {
    "start": "1926000",
    "end": "1926000"
  },
  {
    "text": "situs cluster you know how you know it's all the the primary machines they're doing the work all of their replicas",
    "start": "1931120",
    "end": "1938210"
  },
  {
    "text": "that are there for disaster recovery a server is an AWS instance and you know",
    "start": "1938210",
    "end": "1945350"
  },
  {
    "text": "this we started with just this we've made it a little more complicated because you know servers get replaced over time but they have the same like",
    "start": "1945350",
    "end": "1952100"
  },
  {
    "text": "role like you know worker one is always work or one even if the Amazon server behind it changes due to failover and",
    "start": "1952100",
    "end": "1961240"
  },
  {
    "start": "1960000",
    "end": "1960000"
  },
  {
    "text": "just before I maybe say something is anyone here from AWS okay so as you know",
    "start": "1962620",
    "end": "1970310"
  },
  {
    "text": "amazon can be a hostile place to run apps especially databases and so because",
    "start": "1970310",
    "end": "1975710"
  },
  {
    "text": "of this over time we've you know developed different ways to you know",
    "start": "1975710",
    "end": "1980810"
  },
  {
    "text": "handle failover handle rep education and durability the main tool that we use to do that is tool called",
    "start": "1980810",
    "end": "1988010"
  },
  {
    "start": "1983000",
    "end": "1983000"
  },
  {
    "text": "wally and data protection i see this as the most important thing you know higher",
    "start": "1988010",
    "end": "1993830"
  },
  {
    "text": "than availability if if a customer's loses their data you know perhaps their",
    "start": "1993830",
    "end": "2000220"
  },
  {
    "text": "entire business could be down you know if it's just down time you know you know I'll avoid downtime as much as possible",
    "start": "2000220",
    "end": "2005530"
  },
  {
    "text": "but losing or corrupting data is often much much worse and so what Wally does",
    "start": "2005530",
    "end": "2012070"
  },
  {
    "text": "is it takes post-crisis archives command and every 16 megabytes or one minute",
    "start": "2012070",
    "end": "2017500"
  },
  {
    "text": "which is the default post rest configuration you can tune that a little bit it takes that wall found sends it off to ask three and so if you even if",
    "start": "2017500",
    "end": "2024160"
  },
  {
    "text": "you're not using you know my service here if you are running postgres on 80 yes please please please please use",
    "start": "2024160",
    "end": "2030970"
  },
  {
    "text": "Wally I can't you know count the number of times that you know having the wall",
    "start": "2030970",
    "end": "2036220"
  },
  {
    "text": "off the machine is has saved us and so",
    "start": "2036220",
    "end": "2042160"
  },
  {
    "text": "the other thing it does is that once once the day you can script it to take a base backup which is the entire archive",
    "start": "2042160",
    "end": "2047980"
  },
  {
    "text": "of the database and then do the wall for that and the other thing that this allows you to do is point I'm recovery",
    "start": "2047980",
    "end": "2054909"
  },
  {
    "text": "and so a timeline of a database each one of these diamonds is the base backup set",
    "start": "2054910",
    "end": "2062800"
  },
  {
    "start": "2055000",
    "end": "2055000"
  },
  {
    "text": "it happens once a day and then then in between here you have the incremental wall segments and so what you can do is",
    "start": "2062800",
    "end": "2070780"
  },
  {
    "start": "2069000",
    "end": "2069000"
  },
  {
    "text": "you can set up you know easily with if you have this setup you can bring on read replicas by taking down the last",
    "start": "2070780",
    "end": "2076690"
  },
  {
    "text": "base back up and having it replay the wall off of s3 until it gets caught up",
    "start": "2076690",
    "end": "2082990"
  },
  {
    "text": "and up to switch into streaming replication and then you have you know very fast replica ready to go for",
    "start": "2082990",
    "end": "2089470"
  },
  {
    "text": "failover or what have you and these replicas of course are read only because",
    "start": "2089470",
    "end": "2095649"
  },
  {
    "text": "that's how postgres is streaming replication works and then if we do a",
    "start": "2095650",
    "end": "2100780"
  },
  {
    "start": "2099000",
    "end": "2099000"
  },
  {
    "text": "few recovery for some reason we promote one of those standbys to be the new primary for its role you know if it's",
    "start": "2100780",
    "end": "2107920"
  },
  {
    "text": "work or one work of two it becomes the new primary it starts generating the",
    "start": "2107920",
    "end": "2113260"
  },
  {
    "text": "wall segments and then we throw away the old one yeah and so that if the replica exists",
    "start": "2113260",
    "end": "2118690"
  },
  {
    "text": "we can do that very quickly but even if it doesn't exist and the server's just down because everything is off the",
    "start": "2118690",
    "end": "2125559"
  },
  {
    "text": "machine on s3 it that we don't necessarily need the primary to be still be running to create the replacement and",
    "start": "2125559",
    "end": "2135369"
  },
  {
    "start": "2134000",
    "end": "2134000"
  },
  {
    "text": "there's so there's lots of reasons to cycle machines one is you know unavoidable unexpected downtime the",
    "start": "2135369",
    "end": "2141099"
  },
  {
    "text": "other one is if we want to experiment with new disk layouts you do scheduled maintenance a--'s from you know AWS",
    "start": "2141099",
    "end": "2147400"
  },
  {
    "text": "saying the census is about to retired we can use this to quickly switch over to a",
    "start": "2147400",
    "end": "2152920"
  },
  {
    "text": "standby rather than go through the restart and because both disaster recovery and sort of scheduled known",
    "start": "2152920",
    "end": "2159579"
  },
  {
    "text": "maintence a--'s are using the same mechanism the disaster recovery gets battle-tested more frequently than an",
    "start": "2159579",
    "end": "2167890"
  },
  {
    "text": "unexpected outage the other thing that model that has worked very well is sort",
    "start": "2167890",
    "end": "2175270"
  },
  {
    "start": "2170000",
    "end": "2170000"
  },
  {
    "text": "of doing video game development one of my my first managers spent some time in",
    "start": "2175270",
    "end": "2180369"
  },
  {
    "text": "a video game field and applied that to Amazon I put this slide once in a talk I",
    "start": "2180369",
    "end": "2186819"
  },
  {
    "text": "gave in Moscow and I thought they would like it because it was Tetris and was from Russia but they didn't laugh so and",
    "start": "2186819",
    "end": "2195760"
  },
  {
    "text": "so there's two phases to this video game development one is a feel or an",
    "start": "2195760",
    "end": "2201220"
  },
  {
    "text": "observation of what the world is so this is the health checks that go in we see",
    "start": "2201220",
    "end": "2206559"
  },
  {
    "text": "we look at the environment to see what is true and then the second phase is a tick and we operate on those",
    "start": "2206559",
    "end": "2211660"
  },
  {
    "text": "observations we just saw and what we do then is we perhaps change state or we",
    "start": "2211660",
    "end": "2219849"
  },
  {
    "start": "2217000",
    "end": "2217000"
  },
  {
    "text": "stay in the same state so this is a simplification of sort of how we how we reason about Amazon instances the first",
    "start": "2219849",
    "end": "2228220"
  },
  {
    "text": "stage is creating and that's when we are you know provisioning the machine we're",
    "start": "2228220",
    "end": "2234099"
  },
  {
    "text": "waiting for it to come up were waiting for the network interfaces to attach so on and so forth and then it goes into",
    "start": "2234099",
    "end": "2240369"
  },
  {
    "text": "the available state and once it's here this is the you know it will stay here for a majority of the time and then if",
    "start": "2240369",
    "end": "2247540"
  },
  {
    "text": "we notice that something went wrong maybe we weren't able to connect to postgres two weren't able to ssh in will go to an",
    "start": "2247540",
    "end": "2253509"
  },
  {
    "text": "uncertain state rather than just immediately call the machine offline and go through failover you know perhaps",
    "start": "2253509",
    "end": "2259779"
  },
  {
    "text": "it's just you know some sort of you know short Network blip and so we wait in the",
    "start": "2259779",
    "end": "2265210"
  },
  {
    "text": "uncertain state for a minute or two just to be sure that we're not going to you",
    "start": "2265210",
    "end": "2270910"
  },
  {
    "text": "know go through disaster recovery when it's not necessary and if the everything",
    "start": "2270910",
    "end": "2276249"
  },
  {
    "text": "goes back then we'll pop it back and available otherwise we'll go into the unavailable state and start doing",
    "start": "2276249",
    "end": "2281259"
  },
  {
    "text": "disaster recovery well we'll try to restart the machine will at the same time bring up Reed replicas and all and",
    "start": "2281259",
    "end": "2286900"
  },
  {
    "text": "so on so forth and the key here is that",
    "start": "2286900",
    "end": "2292180"
  },
  {
    "text": "we're always trying to converge to that available state no matter what what happens we want to get back to that",
    "start": "2292180",
    "end": "2298719"
  },
  {
    "text": "state and one of the things that you know is nice there was a earlier this",
    "start": "2298719",
    "end": "2305019"
  },
  {
    "text": "year I forget exactly when there was some sort of elastic IP outage in u.s.",
    "start": "2305019",
    "end": "2311170"
  },
  {
    "text": "East or forget the details but what what you needed to do was the associate the",
    "start": "2311170",
    "end": "2316989"
  },
  {
    "text": "eip and reattach it and rather than have to write a new script and go through and do that Franz and says we were able to",
    "start": "2316989",
    "end": "2324130"
  },
  {
    "text": "just reassociate all of the IPS and trust that the state machine would do",
    "start": "2324130",
    "end": "2329650"
  },
  {
    "text": "the right thing and converge and do the reattachment and that's a you know very nice way to a very nice thing to rely on",
    "start": "2329650",
    "end": "2336670"
  },
  {
    "text": "it means the other thing is the other one of the last parts is these job Cui's",
    "start": "2336670",
    "end": "2345099"
  },
  {
    "text": "job queues and that's doing what's doing all of the work to do the health checks",
    "start": "2345099",
    "end": "2351729"
  },
  {
    "text": "and so on and spend some time looking at a couple different side couple different",
    "start": "2351729",
    "end": "2358809"
  },
  {
    "start": "2353000",
    "end": "2353000"
  },
  {
    "text": "queueing services and so on but sad kick is a ruby one that a couple other",
    "start": "2358809",
    "end": "2364839"
  },
  {
    "text": "languages and it uses red us for the store it's very you know very fast very performant and the first sort of",
    "start": "2364839",
    "end": "2373059"
  },
  {
    "start": "2370000",
    "end": "2370000"
  },
  {
    "text": "iteration on this relied on jobs rien queuing themselves so they would they would server would do the server work to",
    "start": "2373059",
    "end": "2379150"
  },
  {
    "text": "check and then rien Q itself back into the queue and that worked pretty well but then sometimes when there'd be a big",
    "start": "2379150",
    "end": "2385789"
  },
  {
    "text": "exception a big you know big problem they would fall out and it wouldn't rien",
    "start": "2385789",
    "end": "2391970"
  },
  {
    "text": "q itself and I so and I spent some time",
    "start": "2391970",
    "end": "2397940"
  },
  {
    "text": "trying to go through the Q and see what was missing and re-add those but that you know God's you know eventually gets",
    "start": "2397940",
    "end": "2403400"
  },
  {
    "text": "low as the number of servers you monitor increase and so the approach we use now",
    "start": "2403400",
    "end": "2409250"
  },
  {
    "text": "is every 5-10 seconds we look at the",
    "start": "2409250",
    "end": "2414680"
  },
  {
    "text": "size of the queue and if it's starting to get small then we r Ian q the work for looking at all the servers again and",
    "start": "2414680",
    "end": "2421430"
  },
  {
    "text": "again and so that way the queue never runs empty but it's never you know it",
    "start": "2421430",
    "end": "2426770"
  },
  {
    "text": "doesn't overflow it's not super it's not super full the other thing that's",
    "start": "2426770",
    "end": "2432740"
  },
  {
    "start": "2430000",
    "end": "2430000"
  },
  {
    "text": "interesting is so we have you know all these servers doing all these checks potentially making very important",
    "start": "2432740",
    "end": "2439430"
  },
  {
    "text": "decisions to you know kill a server because we want to you know make sure it's down before we bring up the replica",
    "start": "2439430",
    "end": "2445849"
  },
  {
    "text": "and so we want to make sure that we're never there's no races that you know",
    "start": "2445849",
    "end": "2451160"
  },
  {
    "text": "we're not you know don't run into any concurrency problems and the approach that my colleague Dan freenode settled",
    "start": "2451160",
    "end": "2458210"
  },
  {
    "text": "on was this semaphore approach and so for example this example we're adding an",
    "start": "2458210",
    "end": "2464210"
  },
  {
    "text": "ode to a formation to increase the you know total number of the total compute size of the of the situs cluster and so",
    "start": "2464210",
    "end": "2471410"
  },
  {
    "text": "we when we're going to add it so we need to add a server for its placement and then for each of the servers the",
    "start": "2471410",
    "end": "2478430"
  },
  {
    "text": "existing servers we need to go in and reconfigure them so they know the existence of this new note and the",
    "start": "2478430",
    "end": "2485270"
  },
  {
    "text": "cluster but we don't want to you know accidentally if you know if you press",
    "start": "2485270",
    "end": "2490760"
  },
  {
    "text": "the button to add the node twice we want to make sure that we reconfigure correctly twice you know two times and",
    "start": "2490760",
    "end": "2498230"
  },
  {
    "text": "if we didn't have this sort of semaphore thing in it would be easy to do it once",
    "start": "2498230",
    "end": "2503839"
  },
  {
    "text": "and say say we're done and then miss out on the second one and then on the other",
    "start": "2503839",
    "end": "2509089"
  },
  {
    "text": "hand we look to see if the semaphores positive we if it is that means we do",
    "start": "2509089",
    "end": "2514700"
  },
  {
    "text": "have some work to do you and we swap the state into configuring and then in the the thing on",
    "start": "2514700",
    "end": "2520710"
  },
  {
    "text": "the right here when we're doing the configuration we decrement it once do the work and that way when someone press",
    "start": "2520710",
    "end": "2527430"
  },
  {
    "text": "the add server button twice we know we're still neat going to need to do this work the second time for the second",
    "start": "2527430",
    "end": "2532830"
  },
  {
    "text": "server that is a very brief thing if that sort of you know thing excites you",
    "start": "2532830",
    "end": "2539970"
  },
  {
    "start": "2535000",
    "end": "2535000"
  },
  {
    "text": "about using the store castrate your servers on Amazon this blog post goes into very very in-depth detail it's a",
    "start": "2539970",
    "end": "2550370"
  },
  {
    "text": "very long blog post it took me a long time to read my colleague read it and so",
    "start": "2550370",
    "end": "2558030"
  },
  {
    "text": "the the last sort of thing is how we do metrics collection and also this gives",
    "start": "2558030",
    "end": "2563520"
  },
  {
    "text": "an example of how to use situs if you're going to use yourself and so customer visible metrics if you go into the",
    "start": "2563520",
    "end": "2570930"
  },
  {
    "start": "2566000",
    "end": "2566000"
  },
  {
    "text": "dashboard you can see you know symmetrix that we're using to to see the health of",
    "start": "2570930",
    "end": "2577320"
  },
  {
    "text": "your own your own service and the way that this one is stored you saw the CW",
    "start": "2577320",
    "end": "2583200"
  },
  {
    "text": "metrics table a little bit earlier and this is a sample row from what it looks like the CW's for COD wats we're just",
    "start": "2583200",
    "end": "2589800"
  },
  {
    "text": "taking cloud watch metrics and storing them in our own database so we can do our own manipulations our own",
    "start": "2589800",
    "end": "2596630"
  },
  {
    "text": "investigations on the cloud watch data and so we have a server ID and this is just a uuid to randomly distribute out",
    "start": "2597080",
    "end": "2603390"
  },
  {
    "text": "across you know have the data be distributed across the situs cluster we",
    "start": "2603390",
    "end": "2608940"
  },
  {
    "text": "have the AWS ID this is the you know instanceid you know and love and then we have the the metrics name the timestamp",
    "start": "2608940",
    "end": "2615480"
  },
  {
    "text": "of when that metric was taken and then the cloud watch information and the",
    "start": "2615480",
    "end": "2621150"
  },
  {
    "text": "index we have on here is a compound index of server ID the timestamp the ada",
    "start": "2621150",
    "end": "2627330"
  },
  {
    "text": "boise ID in the name and the reason it's the primary key is so wide rather than just being one column is this ensures",
    "start": "2627330",
    "end": "2633870"
  },
  {
    "text": "that the tool i wrote to go and you know take cloud watch data and dump it into",
    "start": "2633870",
    "end": "2639240"
  },
  {
    "text": "our site is cluster if it ever gets like you know out of sync and starts grabbing the same data twice because the primary",
    "start": "2639240",
    "end": "2645600"
  },
  {
    "text": "key includes the metrics name and the eid in the timestamp and everything I prevents you'll get a for a primary key",
    "start": "2645600",
    "end": "2653819"
  },
  {
    "text": "violation and it won't you know in suit insert duplicate data and also when we",
    "start": "2653819",
    "end": "2660339"
  },
  {
    "text": "do queries on it usually we do all the way up to the Amazon ID and then we can",
    "start": "2660339",
    "end": "2665890"
  },
  {
    "text": "you know that query that index is pushed down to each order the nodes and so the",
    "start": "2665890",
    "end": "2670930"
  },
  {
    "text": "index can be we can take advantage of it in parallel the other exciting metrics",
    "start": "2670930",
    "end": "2678250"
  },
  {
    "start": "2675000",
    "end": "2675000"
  },
  {
    "text": "thing is admin metrics only so this is when I log into the administration plane this is what I see and originally I was",
    "start": "2678250",
    "end": "2688990"
  },
  {
    "text": "using a application level exception tracker to store both exceptions that",
    "start": "2688990",
    "end": "2695160"
  },
  {
    "text": "were unexpected but also these sort of expected exceptions one of them like",
    "start": "2695160",
    "end": "2701589"
  },
  {
    "text": "being a timeout error so this is as we're connecting to a server but it's not yet quite up that's essential",
    "start": "2701589",
    "end": "2707799"
  },
  {
    "text": "timeout or you know if we're connected currently to postgres and then it dies",
    "start": "2707799",
    "end": "2714759"
  },
  {
    "text": "in the middle that might be the database connection error you know connection refused you know so on there's a handful",
    "start": "2714759",
    "end": "2721299"
  },
  {
    "text": "of these exceptions because we're doing these constant health checks that we sort of expect to see and I was putting",
    "start": "2721299",
    "end": "2726970"
  },
  {
    "text": "them in the exception tracker with the exceptions that I actually want to know about and do code fix because they're",
    "start": "2726970",
    "end": "2732759"
  },
  {
    "text": "actual bugs and having those two sorts of things in the same place was not not ideal and being able to graph them like",
    "start": "2732759",
    "end": "2741490"
  },
  {
    "text": "this though we can see you know here on that Friday you see that the on the",
    "start": "2741490",
    "end": "2747549"
  },
  {
    "text": "first metric there something something went wrong there nothing is catastrophic Lee wrong otherwise we'd be getting",
    "start": "2747549",
    "end": "2753279"
  },
  {
    "text": "paged but there's obviously some sort of change when in Friday probably right",
    "start": "2753279",
    "end": "2758470"
  },
  {
    "text": "before someone at home for the weekend and you know something is something is going wrong but you know don't quite",
    "start": "2758470",
    "end": "2764019"
  },
  {
    "text": "know what and so by storing these sorts of exceptions in in in our own internal",
    "start": "2764019",
    "end": "2770950"
  },
  {
    "text": "situs cluster we can you know sort of when we notice that the pattern has",
    "start": "2770950",
    "end": "2776710"
  },
  {
    "text": "changed we can go and investigate and see what's wrong and all this table is is a random ID uid the name of the",
    "start": "2776710",
    "end": "2785380"
  },
  {
    "text": "exception the time and then a JSON B column and so we can store any sort of data we want in there and so this is",
    "start": "2785380",
    "end": "2791950"
  },
  {
    "text": "helpful like we can sort part of the back-trace we can store maybe what server was being looked at at the time",
    "start": "2791950",
    "end": "2797530"
  },
  {
    "text": "and those graphs that we did there this",
    "start": "2797530",
    "end": "2802540"
  },
  {
    "text": "you know a very simple query to do a select count star the name truncated",
    "start": "2802540",
    "end": "2807580"
  },
  {
    "text": "down to the hour and then just look at the last week and because we have an index on on the created out there we",
    "start": "2807580",
    "end": "2815320"
  },
  {
    "text": "have an index on that being able to just slice out the last week of data from our you know ever growing data set that",
    "start": "2815320",
    "end": "2823410"
  },
  {
    "text": "index can be used just like any other postcodes index and it's a very fast way",
    "start": "2823410",
    "end": "2829590"
  },
  {
    "start": "2829000",
    "end": "2829000"
  },
  {
    "text": "so I do want to end with one little story of a misadventure that we ran into",
    "start": "2829650",
    "end": "2835740"
  },
  {
    "text": "when I when we started we looked at ZFS on Linux even though you know it's",
    "start": "2835740",
    "end": "2841420"
  },
  {
    "text": "better on bsd but like the ZFS analytics it's been around for a little while like let's let's give this a shot and the",
    "start": "2841420",
    "end": "2846670"
  },
  {
    "text": "initial results that we saw were very very impressive we were seeing four to",
    "start": "2846670",
    "end": "2852520"
  },
  {
    "text": "five x compression on the data drives and sometimes up to 70 x compression on the right ahead wall the wall drive and",
    "start": "2852520",
    "end": "2859110"
  },
  {
    "text": "the storage compression isn't what we were going for but because he's on EBS having that compressed over the network",
    "start": "2859110",
    "end": "2865660"
  },
  {
    "text": "from the reverie BSS to the instance the performance increases that we're seeing",
    "start": "2865660",
    "end": "2871810"
  },
  {
    "text": "were very very incredible unfortunately I can't this is the misadventure slide",
    "start": "2871810",
    "end": "2878560"
  },
  {
    "text": "it didn't go well there was some times we started seeing in the kernel ZFS",
    "start": "2878560",
    "end": "2885280"
  },
  {
    "text": "trying to allocate memory and it would block the entire machine up for sometimes minutes and that was not",
    "start": "2885280",
    "end": "2891480"
  },
  {
    "text": "acceptable and so we went back and rolled that out I'm keeping a little bit",
    "start": "2891480",
    "end": "2897670"
  },
  {
    "text": "of an eye on those bug reports to see it maybe they get fixed we can go back to using ZFS because it was aside from you",
    "start": "2897670",
    "end": "2904450"
  },
  {
    "text": "know locking the Machine up four minutes I was good but that's a bit of a downside thank you very much happy to",
    "start": "2904450",
    "end": "2911770"
  },
  {
    "text": "answer some questions i also have a couple of the people from the the company is craig here so but so happy to",
    "start": "2911770",
    "end": "2922000"
  },
  {
    "text": "answer questions and then we also have a booth at 2020 if you want to come down any time to we have some socks we also",
    "start": "2922000",
    "end": "2929950"
  },
  {
    "text": "have some socks here if you're interested but thank you very much",
    "start": "2929950",
    "end": "2935610"
  }
]