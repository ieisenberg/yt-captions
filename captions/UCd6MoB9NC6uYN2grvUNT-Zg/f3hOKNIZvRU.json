[
  {
    "start": "0",
    "end": "163000"
  },
  {
    "text": "um okay keep your questions granted like you said grant covered like a ton of",
    "start": "0",
    "end": "5130"
  },
  {
    "text": "material there there's there's one or two tapas in there we'll see if you",
    "start": "5130",
    "end": "10200"
  },
  {
    "text": "managed to hit a topic that I can't actually go deep on there there are one or two but I'm not gonna tell you what they are so ask me anything most of it",
    "start": "10200",
    "end": "17460"
  },
  {
    "text": "in there I can field questions from I do want to just sort of two things from two",
    "start": "17460",
    "end": "22560"
  },
  {
    "text": "or three extras real quick to add on to the presentation we just watched I mentioned this in the room here while we",
    "start": "22560",
    "end": "29789"
  },
  {
    "text": "were watching it but logical replication boy there's a lot of animations in the",
    "start": "29789",
    "end": "35850"
  },
  {
    "text": "slide this this is now shipped the logical replication I just want to point that out that the that yeah yeah we do",
    "start": "35850",
    "end": "44489"
  },
  {
    "text": "now have a pathological now as of today it doesn't have PG the extension called",
    "start": "44489",
    "end": "53010"
  },
  {
    "text": "PG logical is not currently supported on or or Postgres yes you but but the",
    "start": "53010",
    "end": "58829"
  },
  {
    "text": "native built-in sort of published and subscribe logical replication that that",
    "start": "58829",
    "end": "65640"
  },
  {
    "text": "is out is it is it in preview or as a ga I think it's GA yeah I think it is",
    "start": "65640",
    "end": "73049"
  },
  {
    "text": "sometimes been a real busy with a bunch of other stuff and I haven't paid super close attention so that was one another",
    "start": "73049",
    "end": "79290"
  },
  {
    "text": "thing that he didn't mention at all is database activity strange but this is another thing which is also now out I'm",
    "start": "79290",
    "end": "85290"
  },
  {
    "text": "not going to talk about it a ton it's it's it's a cool product is kind of",
    "start": "85290",
    "end": "91110"
  },
  {
    "text": "designed for as like an auditing solution it also there is also an extension called PG audit which we do",
    "start": "91110",
    "end": "97920"
  },
  {
    "text": "support as well what PG audit will do is it'll it's another auditing framework that you plug",
    "start": "97920",
    "end": "103740"
  },
  {
    "text": "into Postgres if you need to have and if you need to sort of know whenever certain events happen in your database",
    "start": "103740",
    "end": "108799"
  },
  {
    "text": "PG audit puts all that information into the Postgres log it's a tool that's pretty well established the community",
    "start": "108799",
    "end": "115320"
  },
  {
    "text": "been around for a while this product database activitystreams is a little bit different it sits outside of the",
    "start": "115320",
    "end": "121979"
  },
  {
    "text": "database and rather than putting to the Postgres log as you can see illustration here it's pulling the information and",
    "start": "121979",
    "end": "128940"
  },
  {
    "text": "putting it into a Kinesis stream and really did the this database activity string product one of the big driving",
    "start": "128940",
    "end": "135670"
  },
  {
    "text": "use cases for this was integration with some like widely used third-party solutions like they mentioned McAfee on",
    "start": "135670",
    "end": "143230"
  },
  {
    "text": "here but you know there are some customers who have existed you know especially for something auditing they",
    "start": "143230",
    "end": "148750"
  },
  {
    "text": "have existing relationships you have a certain partner they work with who locks up all the audit logs and we wanted to",
    "start": "148750",
    "end": "156040"
  },
  {
    "text": "support that so that was a piece of this as well you can read more about that look it up I just want to mention it I",
    "start": "156040",
    "end": "161950"
  },
  {
    "text": "mean get it out there now Grant talked about vacuuming permits this was something that I just just realized that",
    "start": "161950",
    "end": "167769"
  },
  {
    "start": "163000",
    "end": "594000"
  },
  {
    "text": "I wanted to mention he talked about the Aurora bolt prefetch that we were doing",
    "start": "167769",
    "end": "174540"
  },
  {
    "text": "and by the way prefetch is kind of a cool thing in general at Aurora does it's something to be aware of you can",
    "start": "174540",
    "end": "181000"
  },
  {
    "text": "bump into prefetch in other places too you'll know you're getting prefetch you'll see a distinct way to that for it when prefetch is happening so what grant",
    "start": "181000",
    "end": "188920"
  },
  {
    "text": "did not mention was there's there's another improvement as well in Aurora which is that in Aurora which we've",
    "start": "188920",
    "end": "195040"
  },
  {
    "text": "changed the auto vacuum some of the parameter fault values for some of these parameters and probably there's room for",
    "start": "195040",
    "end": "205690"
  },
  {
    "text": "improvement and RDS Postgres in this area as well the thing with these parameters is is that like I said before",
    "start": "205690",
    "end": "212260"
  },
  {
    "text": "we're very rigorous about when we choose to change a default value like if we're",
    "start": "212260",
    "end": "218829"
  },
  {
    "text": "gonna change the default we we want to know that it's it's not a good idea to change the default if it like kind of",
    "start": "218829",
    "end": "225250"
  },
  {
    "text": "helps 90 percent of the time but then there's 10% of our customers where it gets really bad you know in those cases",
    "start": "225250",
    "end": "232000"
  },
  {
    "text": "the 90% of customers it's almost like grant said about the explain plans like its stability is often more valued than",
    "start": "232000",
    "end": "240579"
  },
  {
    "text": "like you know squeezing every little the last little bit of performance if there's a risk that yeah I can squeeze",
    "start": "240579",
    "end": "246099"
  },
  {
    "text": "one more percent out but maybe in this case over here the thing just totally tips over I'd rather just have",
    "start": "246099",
    "end": "252340"
  },
  {
    "text": "predictability and have it not fall over then have like you know get a little bit more performance at far so with that",
    "start": "252340",
    "end": "259359"
  },
  {
    "text": "mentality we're very rigorous about defaults we spent a lot of time validating this on Aurora and we found",
    "start": "259359",
    "end": "264490"
  },
  {
    "text": "that we do this and so these changing these two settings makes Auto vacuum a lot more aggressive just to show you real quickly",
    "start": "264490",
    "end": "272320"
  },
  {
    "text": "the impact of that something that I did what a while ago was that I ran I did I",
    "start": "272320",
    "end": "280720"
  },
  {
    "text": "did a simple benchmark where I set up PG bench and and there's a simple tweak",
    "start": "280720",
    "end": "286870"
  },
  {
    "text": "that I did a PG bench all right I took in addition to the standard stuff the PG bench does I made a little script that",
    "start": "286870",
    "end": "292270"
  },
  {
    "text": "just did a sub transaction so it it did an update to the accounts table but it",
    "start": "292270",
    "end": "297610"
  },
  {
    "text": "did that update inside of sub transaction and the reason that that or the effect of that is that when you",
    "start": "297610",
    "end": "304630"
  },
  {
    "text": "start a so you know two sub transaction is you have a you start at you know a transaction is a sub transaction means",
    "start": "304630",
    "end": "311169"
  },
  {
    "text": "that I have like something inside that can be committed or rolled back without rolling back my entire transaction right",
    "start": "311169",
    "end": "318280"
  },
  {
    "text": "so if I had an error I can just roll back that one sequel command or those two sequel commands but I don't lose all",
    "start": "318280",
    "end": "323650"
  },
  {
    "text": "the work that I did well what in Postgres when you start a transaction you need an identifier it's called a",
    "start": "323650",
    "end": "330280"
  },
  {
    "text": "transaction ID we've talked about this several times when you start a sub transaction you also need another transaction identifier so the impact of",
    "start": "330280",
    "end": "337720"
  },
  {
    "text": "the script was that I dramatically increased the rate at which I was just",
    "start": "337720",
    "end": "343810"
  },
  {
    "text": "meeting new transaction identifiers and what I was curious about was if vacuum",
    "start": "343810",
    "end": "349690"
  },
  {
    "text": "would be able to keep up or if a database would wrap around so I started",
    "start": "349690",
    "end": "354820"
  },
  {
    "text": "with a brand new database pristine spun up a new database and then I just ran PG",
    "start": "354820",
    "end": "359830"
  },
  {
    "text": "bench with this additional little tweak and you can see at a custom script at",
    "start": "359830",
    "end": "365290"
  },
  {
    "text": "one the regular bench market two and then just defaults that's all I did when",
    "start": "365290",
    "end": "373120"
  },
  {
    "text": "I did that what happened was RDS Postgres let's see here do I have a I",
    "start": "373120",
    "end": "380400"
  },
  {
    "text": "don't it's down at the bottom so RDS Postgres these are the X ID graphs every",
    "start": "380400",
    "end": "389860"
  },
  {
    "text": "single so oh the other thing I should mention is that I also tested a matrix",
    "start": "389860",
    "end": "395200"
  },
  {
    "text": "so I did three different Issa's classes ranging or large to a 16x and I do two different versions",
    "start": "395200",
    "end": "400449"
  },
  {
    "text": "I did 9 6 8 and 10 for both I just want to see if there were any differences so I did both versions on all three it says",
    "start": "400449",
    "end": "406539"
  },
  {
    "text": "classes so I had six different I had sis different Postgres systems six different",
    "start": "406539",
    "end": "411550"
  },
  {
    "text": "Aurora systems just to compare right well what happened is every single RDS",
    "start": "411550",
    "end": "416830"
  },
  {
    "text": "system wrapped around went from brand-new to wrap around I believe within a day I have the timings at the",
    "start": "416830",
    "end": "423310"
  },
  {
    "text": "very bottom so this was the output from the run when you see the word finish run",
    "start": "423310",
    "end": "428949"
  },
  {
    "text": "that's when it wrapped around oh no so there's a couple days for some of them",
    "start": "428949",
    "end": "434220"
  },
  {
    "text": "but for some of them like this guy right here wrapped around at 5 hours the the large the see the yes which is a 16 X",
    "start": "434220",
    "end": "443349"
  },
  {
    "text": "the 16 X says they wrapped around and if you look at what the X ID graphs looks like - you can kind of see it it's kind",
    "start": "443349",
    "end": "449830"
  },
  {
    "text": "of funny so this is the cloud watch graph that shows you the how many transaction IDs you've used up but this",
    "start": "449830",
    "end": "455830"
  },
  {
    "text": "is 2 billion and that's where you wrap around right and it's just like a straight line Shoop right up there to 2",
    "start": "455830",
    "end": "461349"
  },
  {
    "text": "billion and then in that that system went right down now Aurora on the other",
    "start": "461349",
    "end": "466479"
  },
  {
    "text": "hand again I didn't tweak the vacuum this is with the default vacuum settings exact same workload no difference this",
    "start": "466479",
    "end": "474190"
  },
  {
    "text": "was all scripted so I mean literally I just like ran a script and it provision the service and ran the same thing everywhere and Aurora was a different",
    "start": "474190",
    "end": "481930"
  },
  {
    "text": "story on Aurora there were two of them",
    "start": "481930",
    "end": "487030"
  },
  {
    "text": "that there were two of them that wrapped around it was by instance class let me find it where is it at it's",
    "start": "487030",
    "end": "497440"
  },
  {
    "text": "probably it's up toward the top of this whole section right there so on Aurora",
    "start": "497440",
    "end": "502509"
  },
  {
    "text": "they are four large and the for the large and the 4x never wrapped around and auto vacuum was able to keep up",
    "start": "502509",
    "end": "509110"
  },
  {
    "text": "completely with the default settings even with this kind of like insane I was allocating transaction IDs as fast",
    "start": "509110",
    "end": "516070"
  },
  {
    "text": "as I could and this is what it looked like this is the photos this is for the large right here and you can in this by",
    "start": "516070",
    "end": "523959"
  },
  {
    "text": "the way you'll see this with this isn't important this is you'll see this in cloud watch I'm this screenshot is from",
    "start": "523959",
    "end": "530350"
  },
  {
    "text": "the the operator console view right of the same cloud watch metric that like",
    "start": "530350",
    "end": "537220"
  },
  {
    "text": "support would see and and but this shape is really common you'll see the line will go up in two hundred thousand two",
    "start": "537220",
    "end": "544000"
  },
  {
    "text": "hundred the default settings are that two hundred thousand was were vacuum kicks in and you can see there that it",
    "start": "544000",
    "end": "549610"
  },
  {
    "text": "is kind of like it goes up to two hundred thousand and then it drops down and that's when vacuum finished and it was able to push it down back up to two",
    "start": "549610",
    "end": "555430"
  },
  {
    "text": "hundred thousand drops down so that's that's what it looks like and it kind of",
    "start": "555430",
    "end": "560680"
  },
  {
    "text": "kept going down it stayed stable state stable so you see the vacuum was able to keep up with the default settings that's",
    "start": "560680",
    "end": "565959"
  },
  {
    "text": "I think that's worth mentioning that that's just another another improvement",
    "start": "565959",
    "end": "571060"
  },
  {
    "text": "to vacuum that we've done in Aurora as well after like real careful real",
    "start": "571060",
    "end": "576850"
  },
  {
    "text": "careful work there all right one more section I want to talk about with Aurora",
    "start": "576850",
    "end": "582910"
  },
  {
    "text": "where I go just a little bit deeper than what we initially talked about and then after this I'm gonna use this as a",
    "start": "582910",
    "end": "588850"
  },
  {
    "text": "launch pad to do a bit of white boarding and this is sort of the area of backup and crash recovery first thing just to",
    "start": "588850",
    "end": "597579"
  },
  {
    "start": "594000",
    "end": "746000"
  },
  {
    "text": "supplement one other thing that we talked about in the presentation now grant had this little offhand comment",
    "start": "597579",
    "end": "603220"
  },
  {
    "text": "that he made at one point that you want to be multi AZ so you can failover faster and have higher availability that",
    "start": "603220",
    "end": "609370"
  },
  {
    "text": "might be like the understatement of the day we treat not not that we treat it it",
    "start": "609370",
    "end": "617199"
  },
  {
    "text": "it behaves very very differently when you have when you don't have any readers",
    "start": "617199",
    "end": "622290"
  },
  {
    "text": "and you only have a write node a writer node or a read/write node so if you only",
    "start": "622290",
    "end": "628389"
  },
  {
    "text": "have a read write node if there's some sort of a problem that whole read write node has to be replaced there's nowhere",
    "start": "628389",
    "end": "634540"
  },
  {
    "text": "to failover to it can take on the order of a couple of minutes for that whole process if I have to spin up a whole new",
    "start": "634540",
    "end": "640240"
  },
  {
    "text": "ec2 box and I have to spin this one down and then I have to you know do all of the the things that need to happen there",
    "start": "640240",
    "end": "645639"
  },
  {
    "text": "that can be a very long and not only that but the thresholds for detecting a",
    "start": "645639",
    "end": "653860"
  },
  {
    "text": "problem are more generous and there's some reasons for this in the way that it's engineered but what that means is",
    "start": "653860",
    "end": "659560"
  },
  {
    "text": "that if you only have a write node a writer node it's going to wait little bit longer partly because of the",
    "start": "659560",
    "end": "666430"
  },
  {
    "text": "cost of replacing it right it's gonna wait a little bit longer before it really decides okay you know if it's",
    "start": "666430",
    "end": "672129"
  },
  {
    "text": "just hung for about ten seconds like if a right just hangs for ten seconds like we're not gonna kill we're like well if",
    "start": "672129",
    "end": "677470"
  },
  {
    "text": "it might come back like in two seconds it's completely different",
    "start": "677470",
    "end": "682990"
  },
  {
    "text": "once you even have a single reader known as soon as you add your first reader now it's a whole different ballgame because",
    "start": "682990",
    "end": "689259"
  },
  {
    "text": "now you can do fail overs and and so once the reader is in the picture even",
    "start": "689259",
    "end": "695259"
  },
  {
    "text": "the logical that does the health checking it takes a different path and it's like okay well you know what",
    "start": "695259",
    "end": "701290"
  },
  {
    "text": "now I'm gonna really really prioritize making sure that this thing is really up and running and healthy and it's not",
    "start": "701290",
    "end": "708069"
  },
  {
    "text": "gonna let that thing hang for like say a minute or something like that like it'll be in the order of seconds it'll",
    "start": "708069",
    "end": "713110"
  },
  {
    "text": "absolutely be in the order of seconds that if there's an issue that you'll see a failover happen and you'll see that reader get promoted up",
    "start": "713110",
    "end": "719529"
  },
  {
    "text": "to a writer if that's necessary so it does make a really big of a lability is",
    "start": "719529",
    "end": "726579"
  },
  {
    "text": "something that's important to you and it's like having making sure that your system is accepting rights and accepting",
    "start": "726579",
    "end": "732370"
  },
  {
    "text": "reads and accepting queries and you're running on Aurora you do want to make sure that you have a reader and if",
    "start": "732370",
    "end": "738970"
  },
  {
    "text": "you're troubleshooting stuff on Aurora it's kind of helpful to know that you might see things looking a little different if you don't have any readers",
    "start": "738970",
    "end": "745300"
  },
  {
    "text": "there alright borrowing a couple of slides this is the part I want to start",
    "start": "745300",
    "end": "751470"
  },
  {
    "start": "746000",
    "end": "1092000"
  },
  {
    "text": "digging a little bit more into a wara this is a slide that just kind of talks",
    "start": "751470",
    "end": "757689"
  },
  {
    "text": "about the backup process in Aurora and this is something I pulled from one of my sequel decks but it's about the",
    "start": "757689",
    "end": "763420"
  },
  {
    "text": "storage nodes and it all works the same the UM the important points let me see",
    "start": "763420",
    "end": "773740"
  },
  {
    "text": "what my next slide was here",
    "start": "773740",
    "end": "776910"
  },
  {
    "text": "the important I think one of the important things I want to say about sort of you start thinking about Aurora",
    "start": "778860",
    "end": "784660"
  },
  {
    "text": "and Aurora storage alright now they they have these segments each segment is going to be 10 gigs right so we're",
    "start": "784660",
    "end": "790750"
  },
  {
    "text": "backing up each segment and they're they're gonna sort of pull each individual block and push the blocks out",
    "start": "790750",
    "end": "796629"
  },
  {
    "text": "to s3 the the backups that we're doing in a war are continuous they're",
    "start": "796629",
    "end": "802990"
  },
  {
    "text": "different from in when you're in RDS Postgres what happens is is you have to take a wall file and copy that file to",
    "start": "802990",
    "end": "809410"
  },
  {
    "text": "s3 in and what that means is you can't start copying the file until the file is complete you can't you want to a partial",
    "start": "809410",
    "end": "815199"
  },
  {
    "text": "copy so that's one of the reasons that we have a five minute you know we say it'll be within five minutes and if you",
    "start": "815199",
    "end": "820990"
  },
  {
    "text": "watch your there's there's a metric for this if you watch that you you can see",
    "start": "820990",
    "end": "829060"
  },
  {
    "text": "that like it'll kind of vary sometimes it's 30 seconds sometimes it's maybe two minutes since the last wall file went up",
    "start": "829060",
    "end": "835240"
  },
  {
    "text": "and that's what you're that's what you're that's just sort of like your window of loss of everything kind of disappeared if you had to lose lose the",
    "start": "835240",
    "end": "841930"
  },
  {
    "text": "host completely you know you might go back two minutes if you had to go out to the out to the s3 that that's a",
    "start": "841930",
    "end": "850959"
  },
  {
    "text": "different picture on our war because it's sort of continually pushing the stuff off and it's able to keep up much",
    "start": "850959",
    "end": "856720"
  },
  {
    "text": "better it's also able to be continuous it doesn't have to wait for anything to be able to push the change records out",
    "start": "856720",
    "end": "862120"
  },
  {
    "text": "to s3 when we do the recovery when we do",
    "start": "862120",
    "end": "869559"
  },
  {
    "text": "a recovery we're able to sort of roll these things back we also have this was also something I don't know if grant",
    "start": "869559",
    "end": "874600"
  },
  {
    "text": "touched on this but there's something called backtrack and what backtrack is so backtrack is going to tie right back",
    "start": "874600",
    "end": "881620"
  },
  {
    "text": "into the backups all right so what backtrack is is backtrack is kind of the",
    "start": "881620",
    "end": "887470"
  },
  {
    "text": "ability to rewind your database and basically and and it's okay so it's it's",
    "start": "887470",
    "end": "893019"
  },
  {
    "text": "it's the ability to do a rewind only within sort of a small window of time that you control right it's with within",
    "start": "893019",
    "end": "901300"
  },
  {
    "text": "a smallest you you're not necessarily gonna go like three months back but you could go like an hour back and it",
    "start": "901300",
    "end": "907959"
  },
  {
    "text": "doesn't have to go to s3 doesn't go to the backup system in order and to pull that data it's able to just pull",
    "start": "907959",
    "end": "913680"
  },
  {
    "text": "the blocks back out that it needs and then it's able to to roll forward the blocks will for the changes very quickly",
    "start": "913680",
    "end": "919260"
  },
  {
    "text": "and then you sort of see the illustration here right it's able to sort of back up to T one point in time",
    "start": "919260",
    "end": "925290"
  },
  {
    "text": "and then start a new ver and then restart the database there and now you're on the blue line and then you can",
    "start": "925290",
    "end": "930690"
  },
  {
    "text": "do it again at say point in time T three the reason that they have this T 2 so",
    "start": "930690",
    "end": "937470"
  },
  {
    "text": "the way that backtrack works you're not losing any history okay so this is and",
    "start": "937470",
    "end": "943800"
  },
  {
    "text": "we'll just say this is one o'clock two o'clock three o'clock four o'clock it's a little easier for me to do verbally so",
    "start": "943800",
    "end": "949770"
  },
  {
    "text": "what happened here is the user at two o'clock they realize that something bad had happened they needed to rewind so at",
    "start": "949770",
    "end": "955740"
  },
  {
    "text": "two o'clock they said okay rewind it I need to go back to one o'clock so what happened was Aurora",
    "start": "955740",
    "end": "961920"
  },
  {
    "text": "the Aurora stores just it undid all the changes and it in a restore the database to the state it was at one o'clock and",
    "start": "961920",
    "end": "968130"
  },
  {
    "text": "it did that at 2:00 so then we start a new version at 2:00 o'clock now when you",
    "start": "968130",
    "end": "973290"
  },
  {
    "text": "get here to three o'clock in this example let's see they keep going in at",
    "start": "973290",
    "end": "979320"
  },
  {
    "text": "four o'clock they do another rewind two three you could still rewind back to 1:30 and",
    "start": "979320",
    "end": "984870"
  },
  {
    "text": "that would put you back on the Green Line right they don't erase this history for one two two when they go back to one",
    "start": "984870",
    "end": "992780"
  },
  {
    "text": "all right you should be able to yeah I",
    "start": "992780",
    "end": "1004340"
  },
  {
    "text": "mean you would go to like a time yeah he'd go essentially right to there right before you yes I should okay I'm sorry",
    "start": "1004340",
    "end": "1011450"
  },
  {
    "text": "let me just rephrase the question since we're recording the the question",
    "start": "1011450",
    "end": "1018140"
  },
  {
    "text": "was like if you could rewind and then go right back to the point where you rewound from and and yes yes because as",
    "start": "1018140",
    "end": "1025010"
  },
  {
    "text": "long as you're not losing that green bar essentially what you do is pause activity on the system to make sure you have a clean point and then you go back",
    "start": "1025010",
    "end": "1031640"
  },
  {
    "text": "export your day they get your data now I mean if that's what you were doing it would probably make more sense to use like a fast clone or to do a point in",
    "start": "1031640",
    "end": "1038390"
  },
  {
    "text": "time occur to a different system if you already knew that you're just doing an exporting going back there's probably other strategies out of a person",
    "start": "1038390",
    "end": "1044688"
  },
  {
    "text": "but yes that should work so that's backtrack how does backtrack work under",
    "start": "1044689",
    "end": "1050629"
  },
  {
    "text": "the covers it's it's doing its it's doing the same thing with those backups",
    "start": "1050629",
    "end": "1056929"
  },
  {
    "text": "the only difference is is that it's keeping all the log records on the storage notes so that it doesn't have to go to the backup system all right",
    "start": "1056929",
    "end": "1068059"
  },
  {
    "text": "there's a slide in here on crash recovery and then there's gonna be one more slide about crash recovery and I",
    "start": "1068059",
    "end": "1073700"
  },
  {
    "text": "want that crash recovery slide to be kind of my launching point just start whiteboarding a bit on a couple other",
    "start": "1073700",
    "end": "1079460"
  },
  {
    "text": "arora scenarios so oh wow and it's",
    "start": "1079460",
    "end": "1084769"
  },
  {
    "text": "already 11 okay all right so you know I'm gonna skip this slide and just jump",
    "start": "1084769",
    "end": "1090980"
  },
  {
    "text": "straight to the next one there's a couple of concepts that we have an Aurora and this is this is where I'm",
    "start": "1090980",
    "end": "1096679"
  },
  {
    "start": "1092000",
    "end": "1416000"
  },
  {
    "text": "gonna go I think I think we didn't introduce some of these some of this terminology but I really want to because",
    "start": "1096679",
    "end": "1102860"
  },
  {
    "text": "it's really useful to know so that a couple of things I've been throughout",
    "start": "1102860",
    "end": "1109820"
  },
  {
    "text": "this entire week I've been giving a lot of examples where I say 1 o'clock 2 o'clock 3 o'clock you know like rerun",
    "start": "1109820",
    "end": "1115340"
  },
  {
    "text": "the database to one o'clock or there's a there's a reed replica and the database",
    "start": "1115340",
    "end": "1120620"
  },
  {
    "text": "the master might think that it's 2 o'clock but the reed roughness is 159 now in reality the database is not",
    "start": "1120620",
    "end": "1128269"
  },
  {
    "text": "tracking time stamps the database actually has another thing which is called an LS N or a logical sequence",
    "start": "1128269",
    "end": "1134360"
  },
  {
    "text": "number and this is kind of a concept that's common to a lot of relational databases that you have this you really",
    "start": "1134360",
    "end": "1142700"
  },
  {
    "text": "there's we've talked a lot about transaction IDs and the transaction ID is sort of one counter the LSN is like",
    "start": "1142700",
    "end": "1148220"
  },
  {
    "text": "the other lower level really critical like clock or counter that's that's always moving forward in the system",
    "start": "1148220",
    "end": "1154549"
  },
  {
    "text": "LS NS are not 32 bits thankfully they're much bigger than that Allison's are",
    "start": "1154549",
    "end": "1159769"
  },
  {
    "text": "always moving forward and the LS n ok oh yeah and this is a really important in",
    "start": "1159769",
    "end": "1165620"
  },
  {
    "text": "RDS Postgres in regular Postgres the LS n is as super simple it is if you look",
    "start": "1165620",
    "end": "1173960"
  },
  {
    "text": "at like the LS n from one of the catalog views what the LS n actually is literally just an offset into a file",
    "start": "1173960",
    "end": "1180710"
  },
  {
    "text": "it's just an address like you could take you take the first half of the LSN and",
    "start": "1180710",
    "end": "1186080"
  },
  {
    "text": "it tells you the name of a file and you just open that file you take the second half of the LS end and you just go to that offset and that's that's literally",
    "start": "1186080",
    "end": "1192680"
  },
  {
    "text": "like the wall record you need to replay starts on that byte so the LS end points",
    "start": "1192680",
    "end": "1198350"
  },
  {
    "text": "to where you are in the reduced stream or in the wall stream that's like and what that means in community Postgres",
    "start": "1198350",
    "end": "1205130"
  },
  {
    "text": "there's there's some implications of that it's first of all if you have an LS n it's super easy to know what to do",
    "start": "1205130",
    "end": "1211610"
  },
  {
    "text": "with it right you can go straight to a log record that LS n just references log record it also means that they don't",
    "start": "1211610",
    "end": "1217520"
  },
  {
    "text": "monotonically increase right like if you have one LS n the next LS n is going to",
    "start": "1217520",
    "end": "1223730"
  },
  {
    "text": "be dependent on the length of the log record that that one points to make",
    "start": "1223730",
    "end": "1228860"
  },
  {
    "text": "sense so they're going to so the LS NS could go from like 100 to 200 30 to 250",
    "start": "1228860",
    "end": "1236770"
  },
  {
    "text": "to 292 for hundred and that could be how LS ends are they're kind of jumpy like",
    "start": "1236770",
    "end": "1242750"
  },
  {
    "text": "that in Postgres and RDS postcards it also means that on the flip side if you look at two LS ends you know how many",
    "start": "1242750",
    "end": "1249170"
  },
  {
    "text": "bytes of wall are in between them because you just subtract it's very simple you don't need to do anything extra so it's an interesting approach",
    "start": "1249170",
    "end": "1256120"
  },
  {
    "text": "when we built Aurora Postgres well I",
    "start": "1256120",
    "end": "1261470"
  },
  {
    "text": "wasn't here at that time but they redefined the LS n of how the whole thing works and an Aurora Postgres the",
    "start": "1261470",
    "end": "1268430"
  },
  {
    "text": "LS n is not a physical address that that's just kind of important because if",
    "start": "1268430",
    "end": "1274190"
  },
  {
    "text": "like for example you have some sort of a query that's some tracks to LS ends and you're assuming that tells you just like",
    "start": "1274190",
    "end": "1281360"
  },
  {
    "text": "how much data was changed that that won't work on a wor Postgres I'm not I",
    "start": "1281360",
    "end": "1287540"
  },
  {
    "text": "don't think that well actually I'm not sure whether it just monotonically increases like 1 2 3 4 5 or whether it's",
    "start": "1287540",
    "end": "1293330"
  },
  {
    "text": "different but I know for sure it is not the offsets so that that change can",
    "start": "1293330",
    "end": "1298910"
  },
  {
    "text": "become significant at some point in time and when you ask for an LS N and Aurora Postgres you're going to see like the",
    "start": "1298910",
    "end": "1304460"
  },
  {
    "text": "Aurora idea of what the LS n is it doesn't try to do any translation or make it look Postgres e okay",
    "start": "1304460",
    "end": "1312070"
  },
  {
    "text": "now that inter-war we do have an allison it's the same sort of thing it's",
    "start": "1312070",
    "end": "1317690"
  },
  {
    "text": "identifying some you know where you are in the in the stream of changes although and you can maybe call it it's not",
    "start": "1317690",
    "end": "1325220"
  },
  {
    "text": "really wall because in aurora it's not it is a similar format to the wall",
    "start": "1325220",
    "end": "1332059"
  },
  {
    "text": "records but it's not identical alright it's you know we kind of started with",
    "start": "1332059",
    "end": "1337820"
  },
  {
    "text": "the wall records and so this is another really interesting thing about a warrant",
    "start": "1337820",
    "end": "1343400"
  },
  {
    "text": "if the way that Aurora works we've talked a lot about those storage nodes there's Postgres code running in that",
    "start": "1343400",
    "end": "1350000"
  },
  {
    "text": "storage node and my sequel code alright and this is also by the way you can pull down the paper that we wrote about Laura",
    "start": "1350000",
    "end": "1356210"
  },
  {
    "text": "that went into the ACM journal like the public paper and and you can get all this right out of there too it's a great",
    "start": "1356210",
    "end": "1362240"
  },
  {
    "text": "paper to read man I should mention that are right at the top if you want to go deep on Aurora one of the things I always tell people is read the ACM paper",
    "start": "1362240",
    "end": "1368960"
  },
  {
    "text": "it's not super long it's like six to eight pages it's very technical and it's",
    "start": "1368960",
    "end": "1374720"
  },
  {
    "text": "just it's it's a great paper and it's public to like anybody can get it anybody can read it you can just search",
    "start": "1374720",
    "end": "1380539"
  },
  {
    "text": "for it on the internet so that paper talks about how they started with my sequel code and they worked from there",
    "start": "1380539",
    "end": "1386600"
  },
  {
    "text": "and yeah the storage nodes you know we've talked about the or architecture of how the storage nodes so it sends",
    "start": "1386600",
    "end": "1393140"
  },
  {
    "text": "like the wall record is basically sent over the network to the storage node and then the storage node do I have a",
    "start": "1393140",
    "end": "1398539"
  },
  {
    "text": "picture I don't think Oh at one point I had a picture oh god there's a really",
    "start": "1398539",
    "end": "1407720"
  },
  {
    "text": "good picture I do have it I just left it in the middle of the deck when I thought",
    "start": "1407720",
    "end": "1414049"
  },
  {
    "text": "that I was going to give this presentation myself this is a nice picture so this was the one that grant",
    "start": "1414049",
    "end": "1420140"
  },
  {
    "start": "1416000",
    "end": "1704000"
  },
  {
    "text": "used which is like super simplified right from the talk that we gave today I",
    "start": "1420140",
    "end": "1425440"
  },
  {
    "text": "personally like this one a little bit better it's different formatted but a",
    "start": "1425440",
    "end": "1431059"
  },
  {
    "text": "little bit more detail too and this gives you its it's the same stuff that you saw on the other slide really that",
    "start": "1431059",
    "end": "1438620"
  },
  {
    "text": "were it's just not anime I think grant likes doing animations and there are",
    "start": "1438620",
    "end": "1443659"
  },
  {
    "text": "they're nice I but they give some of the different steps the so what's happening here is",
    "start": "1443659",
    "end": "1449620"
  },
  {
    "text": "that your what sometimes we call this the head node that's kind of like just sort of an internal lingo that we use",
    "start": "1449620",
    "end": "1455830"
  },
  {
    "text": "and we call this a storage node so if you hear somebody say head node what they're talking about is is here and",
    "start": "1455830",
    "end": "1461350"
  },
  {
    "text": "that's largely operating like like Postgres I mean there's they're still",
    "start": "1461350",
    "end": "1466840"
  },
  {
    "text": "like you know your you'll hear more and more things the survivable buffer cache the cluster cache management there are",
    "start": "1466840",
    "end": "1472600"
  },
  {
    "text": "places on the my sequel side I think they've made even more changes to the engine itself but that still largely",
    "start": "1472600",
    "end": "1479590"
  },
  {
    "text": "operates like a database server the storage node is largely operating like a",
    "start": "1479590",
    "end": "1484900"
  },
  {
    "text": "storage server but it has database code it has Postgres code we call that the",
    "start": "1484900",
    "end": "1490059"
  },
  {
    "text": "part that kind of has the Postgres code we call it a page writer that's kind of the name that we usually use for it the",
    "start": "1490059",
    "end": "1496650"
  },
  {
    "text": "the page it's it's the page writer is the part it's kind of this module that",
    "start": "1496650",
    "end": "1503110"
  },
  {
    "text": "is based on Postgres code that does recovery right because Postgres recovery",
    "start": "1503110",
    "end": "1508900"
  },
  {
    "text": "code what does it do it it reads a wall record it applies it to a block so that's the piece of code that you need",
    "start": "1508900",
    "end": "1515830"
  },
  {
    "text": "in the storage node just logically makes sense so you take that code from my sequel or from Postgres or wherever and",
    "start": "1515830",
    "end": "1522669"
  },
  {
    "text": "what does that code do well it writes the changes to the block what sort of name for a block a page so it's a page",
    "start": "1522669",
    "end": "1528610"
  },
  {
    "text": "writer makes sense that's why it's called that that little piece of code a",
    "start": "1528610",
    "end": "1533799"
  },
  {
    "text": "little bit of Postgres code that is the one little bit of code that actually lives in the storage node so these log",
    "start": "1533799",
    "end": "1539980"
  },
  {
    "text": "records which it's you know we had to like build a network protocol and do",
    "start": "1539980",
    "end": "1546100"
  },
  {
    "text": "some things like that but the information in here is the same information that would be in the wall record because we're doing but we're",
    "start": "1546100",
    "end": "1552490"
  },
  {
    "text": "doing the same thing we're taking a change right it's the same thing that happens when you do crash recovery on a",
    "start": "1552490",
    "end": "1557830"
  },
  {
    "text": "database you have to replay these these records that were in the wall stream that's what we're just doing it all the",
    "start": "1557830",
    "end": "1563350"
  },
  {
    "text": "time so it's the same information that we need comes to the log records and this is where they say they talk about",
    "start": "1563350",
    "end": "1569830"
  },
  {
    "text": "the scene now this is this cuing bit there's no nothing we're there's no post rest code here all",
    "start": "1569830",
    "end": "1575020"
  },
  {
    "text": "this is doing is just taking those records and putting them on the disk so that we that this guy isn't blocked get him",
    "start": "1575020",
    "end": "1581020"
  },
  {
    "text": "unblocked make the right path super fast so he keep moving it's this piece that",
    "start": "1581020",
    "end": "1586390"
  },
  {
    "text": "coalesce that coalesce and you know they say data blocks here but blocks pages",
    "start": "1586390",
    "end": "1592420"
  },
  {
    "text": "same thing that's the piece this number five we call it coalescing but that's",
    "start": "1592420",
    "end": "1598960"
  },
  {
    "text": "the piece where you actually have some database code because that's a piece that reads the lock record and applies",
    "start": "1598960",
    "end": "1606220"
  },
  {
    "text": "it to a date now the reason we call it coalescing is the other thing is that",
    "start": "1606220",
    "end": "1612300"
  },
  {
    "text": "what we're actually doing is that we actually have kind of like this stream these data blocks are not stored in a",
    "start": "1612300",
    "end": "1620110"
  },
  {
    "text": "different separate place from the log records we actually is I think this is kind of neat they're all stored together so what we actually it's almost like law",
    "start": "1620110",
    "end": "1627310"
  },
  {
    "text": "there's there's a thing now like log structured storage there's some some vendors making storage arrays like I",
    "start": "1627310",
    "end": "1634660"
  },
  {
    "text": "would say like at one previous company like I worked at we had in it some nimble storage I think they do this for",
    "start": "1634660",
    "end": "1640060"
  },
  {
    "text": "example they're one of the vendors doing this there's a bunch of them out there that are doing like log structured storage what end it's actually it might",
    "start": "1640060",
    "end": "1648490"
  },
  {
    "text": "be a good parallel I mean I don't what we are doing is that we have a single place and it's kind of like that it's a",
    "start": "1648490",
    "end": "1654970"
  },
  {
    "text": "stream of you know change record change record change record and at some point in time what we do is we need to sort of",
    "start": "1654970",
    "end": "1660820"
  },
  {
    "text": "so we have to keep the full block that's back at the beginning because if I need to reconstruct a page I'm going to start",
    "start": "1660820",
    "end": "1667180"
  },
  {
    "text": "with the full block and then I'm going to move forward and we call it coalescing because what we're going to",
    "start": "1667180",
    "end": "1673180"
  },
  {
    "text": "do is we're going to take that full block apply all the changes to it and then just write a new copy of the full",
    "start": "1673180",
    "end": "1678460"
  },
  {
    "text": "block down once we've done that right at that point in the log it's now safe to",
    "start": "1678460",
    "end": "1683530"
  },
  {
    "text": "take all the old log records and once you've archived them off to s3 you can remove them out of memory you don't need",
    "start": "1683530",
    "end": "1689950"
  },
  {
    "text": "to keep them on the storage node anymore and once you know that you don't that you also have to be sure none of the",
    "start": "1689950",
    "end": "1696490"
  },
  {
    "text": "reader nodes are going to need those old blocks as well so slide 19",
    "start": "1696490",
    "end": "1703650"
  },
  {
    "text": "that's almost ah so that gets into this",
    "start": "1703650",
    "end": "1709240"
  },
  {
    "start": "1704000",
    "end": "2120000"
  },
  {
    "text": "right here so now we're here all right this little line is UCS is a",
    "start": "1709240",
    "end": "1714920"
  },
  {
    "text": "list of log records that's the line that I was just describing that's the series of log records that Aurora has in the storage and each one of those records",
    "start": "1714920",
    "end": "1723170"
  },
  {
    "text": "has an LS N and that's that's what we also call it in Aurora an LS sign",
    "start": "1723170",
    "end": "1728810"
  },
  {
    "text": "identifies a log record all right now in Aurora so we've got this series of log",
    "start": "1728810",
    "end": "1736280"
  },
  {
    "text": "records now there's actually some full blocks in here as well and we occasionally do coalescing and we get",
    "start": "1736280",
    "end": "1742370"
  },
  {
    "text": "new full blocks in here there's a couple of important sort of pointers or and that's what this slide is actually",
    "start": "1742370",
    "end": "1748460"
  },
  {
    "text": "pointing I love that they have this slide that they're they get to this level of detail with our customers in",
    "start": "1748460",
    "end": "1755390"
  },
  {
    "text": "reinvent I think that's awesome and and that's what we need to do now I'm going to point out a couple of them one thing",
    "start": "1755390",
    "end": "1760580"
  },
  {
    "text": "that you'll notice is these gaps the reason that we have gaps is because remember what we were saying earlier or",
    "start": "1760580",
    "end": "1766040"
  },
  {
    "text": "grant was talking about how Aurora will just kind of like batch all those updates and just push them down as fast as it can right they don't come",
    "start": "1766040",
    "end": "1773450"
  },
  {
    "text": "in order so what you can totally have is like if you could have a couple of",
    "start": "1773450",
    "end": "1780310"
  },
  {
    "text": "records coming down but you might still be waiting for the records that were in",
    "start": "1780310",
    "end": "1785660"
  },
  {
    "text": "between and this is totally valid like eventually these other records will come",
    "start": "1785660",
    "end": "1790700"
  },
  {
    "text": "and then things will be fine but they don't need to come in order however if",
    "start": "1790700",
    "end": "1796580"
  },
  {
    "text": "there is a crash right at this instant and we have some gaps in here well now",
    "start": "1796580",
    "end": "1802310"
  },
  {
    "text": "we need to like after the crash we're going to start the database back up and in order for the database to start up",
    "start": "1802310",
    "end": "1807770"
  },
  {
    "text": "the database needs to needs to know like what's the like point in time where I'm",
    "start": "1807770",
    "end": "1814550"
  },
  {
    "text": "starting am i starting as a so if you crashed at one o'clock are you gonna",
    "start": "1814550",
    "end": "1819980"
  },
  {
    "text": "start as of 12:55 or 1258 like how much data did I lose and how much data do I",
    "start": "1819980",
    "end": "1826790"
  },
  {
    "text": "have was it like two milliseconds 10 milliseconds what was it right now keep",
    "start": "1826790",
    "end": "1833030"
  },
  {
    "text": "in mind when I talk about like losing data now I'm not talking about losing any data in your database this is like",
    "start": "1833030",
    "end": "1839350"
  },
  {
    "text": "just when I'm going to lose the bits on the disk because",
    "start": "1839350",
    "end": "1844270"
  },
  {
    "text": "it there will be some data that disappears it's gonna all be uncommitted data right because there's always like",
    "start": "1844490",
    "end": "1852170"
  },
  {
    "text": "the uncommitted data we don't we certainly don't wait for the commit to put the data on the disk like we're",
    "start": "1852170",
    "end": "1857870"
  },
  {
    "text": "continually putting data pushing data down to the storage and down to the disk and then commit is just the point where",
    "start": "1857870",
    "end": "1863870"
  },
  {
    "text": "you have to like pause for just a moment and when your application says commit we",
    "start": "1863870",
    "end": "1869480"
  },
  {
    "text": "don't acknowledge the commit until we know and this is what we're going to come to actually so in order now you get",
    "start": "1869480",
    "end": "1876410"
  },
  {
    "text": "to sort of see the guts of what a commit means inside of Arora okay inside of Arora when you want to do a commit what",
    "start": "1876410",
    "end": "1883820"
  },
  {
    "text": "you need to know is that if there's a crash that commit is safe so what does that mean well let's talk about doing",
    "start": "1883820",
    "end": "1890960"
  },
  {
    "text": "the crash recovery and that's what this slide is all about where so if I have all of these gaps the point right before",
    "start": "1890960",
    "end": "1897260"
  },
  {
    "text": "the gap that's the point where I have complete data so basically this is the",
    "start": "1897260",
    "end": "1903110"
  },
  {
    "text": "point in time where I if I go after this point in time I think this would be corrupt because I'm missing something",
    "start": "1903110",
    "end": "1908240"
  },
  {
    "text": "there's I'm missing something and I replay in this other log record that that that would corrupt my disk so this",
    "start": "1908240",
    "end": "1914210"
  },
  {
    "text": "right here we and we have names for these things we usually use the acronyms but we use them all the time and what we",
    "start": "1914210",
    "end": "1920600"
  },
  {
    "text": "say here this is the volume complete LSN all right so this point is the point",
    "start": "1920600",
    "end": "1926660"
  },
  {
    "text": "where it's complete meaning we're not missing any records however that is",
    "start": "1926660",
    "end": "1932870"
  },
  {
    "text": "actually not the point at which all right so that we have we have",
    "start": "1932870",
    "end": "1938030"
  },
  {
    "text": "explanations over on the right they say it's the highest point where all the records have met the quorum but that's",
    "start": "1938030",
    "end": "1944570"
  },
  {
    "text": "different ah right okay the consistency",
    "start": "1944570",
    "end": "1950270"
  },
  {
    "text": "point we track one more thing as well we track something called a consistency point Ellison that's right and the",
    "start": "1950270",
    "end": "1957350"
  },
  {
    "text": "consistency point Allison is just saying the commit record go to the last commit because basically what you wind up with",
    "start": "1957350",
    "end": "1963830"
  },
  {
    "text": "here is if this guy was a commit these two records ahead of that commitment really need those anyway right because",
    "start": "1963830",
    "end": "1970490"
  },
  {
    "text": "those were on there were no other commits after this one in the stream so or at least none that that",
    "start": "1970490",
    "end": "1977960"
  },
  {
    "text": "there could be a commit here what would that mean if there's a commit here what it would mean is that like the commit",
    "start": "1977960",
    "end": "1983299"
  },
  {
    "text": "had gotten down to disk but it had not yet been acknowledged to the client because this comes back to what does it",
    "start": "1983299",
    "end": "1989539"
  },
  {
    "text": "commit mean and aurorus so in Aurora we don't just have to put so commit records",
    "start": "1989539",
    "end": "1995659"
  },
  {
    "text": "are different commit you know other things just you get to the disk and they're durable right but a commit",
    "start": "1995659",
    "end": "2001179"
  },
  {
    "text": "record doesn't just need to the disk the commit record needs to be consistent so",
    "start": "2001179",
    "end": "2006450"
  },
  {
    "text": "when you commit data in Aurora it'll actually pause and make sure it's",
    "start": "2006450",
    "end": "2011710"
  },
  {
    "text": "recoverable to that point and because it has to be recoverable to that point and then you can acknowledge it back to the",
    "start": "2011710",
    "end": "2017890"
  },
  {
    "text": "client so if there's a commit here that just means okay we're in the process of committing but we never sent that",
    "start": "2017890",
    "end": "2023919"
  },
  {
    "text": "message back to the client we never told the client this data's committed the client was trying to commit something",
    "start": "2023919",
    "end": "2029980"
  },
  {
    "text": "and the system crashed while the client was trying to commit that's that's what it would mean if you saw like a commit",
    "start": "2029980",
    "end": "2035350"
  },
  {
    "text": "record out here but it had not been acknowledged back to the client therefore you know that commit does not",
    "start": "2035350",
    "end": "2042730"
  },
  {
    "text": "represent any data that was lost so what happens when you do crash recovery",
    "start": "2042730",
    "end": "2048669"
  },
  {
    "text": "here's basically everything gets cleared after the consistency point Ellison or",
    "start": "2048669",
    "end": "2053710"
  },
  {
    "text": "the CPL so that's the that's this",
    "start": "2053710",
    "end": "2060638"
  },
  {
    "text": "picture here and this is where I'm going to shift gears and so we talked about",
    "start": "2060639",
    "end": "2067118"
  },
  {
    "text": "the consistency point LSN and the vault the volume complete ellis of the VCL but",
    "start": "2067119",
    "end": "2075638"
  },
  {
    "text": "now i want to just go back and i'm going to do a little bit of white boarding and there's two pictures that i want you to",
    "start": "2075639",
    "end": "2085358"
  },
  {
    "text": "keep in your head as i switch over to the whiteboard okay the first one was this storage node picture because i'm",
    "start": "2085359",
    "end": "2091898"
  },
  {
    "text": "going to talk a little bit of more about this for a moment and we're way over do I have time to this prayer should I just",
    "start": "2091899",
    "end": "2097839"
  },
  {
    "text": "skip the whiteboard I got to do this this is like really important stuff I'm",
    "start": "2097839",
    "end": "2103210"
  },
  {
    "text": "glad to know though that I I'm not going to like not have enough calm when I said at the beginning I was like",
    "start": "2103210",
    "end": "2109570"
  },
  {
    "text": "I'm worried I won't have enough to fill two hours well I was wrong",
    "start": "2109570",
    "end": "2115170"
  },
  {
    "text": "yeah all right the second picture that I want you to keep in your head is this",
    "start": "2115170",
    "end": "2121390"
  },
  {
    "text": "one or this yeah this guy here sort of all right okay",
    "start": "2121390",
    "end": "2128950"
  },
  {
    "text": "I'm going to shift gears so what I'm going to do right now is just to help",
    "start": "2128950",
    "end": "2136720"
  },
  {
    "text": "him out I'm going to black that out and",
    "start": "2136720",
    "end": "2142330"
  },
  {
    "text": "I'm gonna hop over here and draw on the whiteboard a little bit for you guys so",
    "start": "2142330",
    "end": "2149820"
  },
  {
    "text": "all right",
    "start": "2151080",
    "end": "2156660"
  },
  {
    "text": "here's where we're starting we've got",
    "start": "2157470",
    "end": "2166330"
  },
  {
    "text": "I'm gonna sort of replicate that picture we have a reader node two readers and a",
    "start": "2166330",
    "end": "2172330"
  },
  {
    "text": "writer okay and then what we've got here",
    "start": "2172330",
    "end": "2178510"
  },
  {
    "text": "is down these these are of course and three different a Z's right and then we",
    "start": "2178510",
    "end": "2186580"
  },
  {
    "text": "have the Aurora storage that sits in all of these three a Z's okay and what do we",
    "start": "2186580",
    "end": "2193390"
  },
  {
    "text": "have going on here we have we talked about this grant talked about this a little bit in his presentation but the",
    "start": "2193390",
    "end": "2199000"
  },
  {
    "text": "each generally speaking no they're they're kind of they're continually testing so every so often these guys",
    "start": "2199000",
    "end": "2205930"
  },
  {
    "text": "will like try to do a read from a different AZ just to kind of check but I mean naturally what's gonna wind up",
    "start": "2205930",
    "end": "2212410"
  },
  {
    "text": "happening is they you know the the reason that they could potentially end up finding it being faster is if like if",
    "start": "2212410",
    "end": "2218500"
  },
  {
    "text": "they were happy to be talking to like one particular remember they have six copies but like",
    "start": "2218500",
    "end": "2224470"
  },
  {
    "text": "for this for a certain block like that that block has two copies in this AZ",
    "start": "2224470",
    "end": "2230950"
  },
  {
    "text": "right the block doesn't have six copies of this AZ if both of those copies maybe",
    "start": "2230950",
    "end": "2236500"
  },
  {
    "text": "could can see I can't imagine this happening but like the only thing I can think of as if like those two copies of",
    "start": "2236500",
    "end": "2243040"
  },
  {
    "text": "the block were on servers that were just like momentarily we're really really busy maybe it would be quicker",
    "start": "2243040",
    "end": "2248500"
  },
  {
    "text": "especially with the latencies between our a Aziz keep getting smaller and smaller maybe the court could go",
    "start": "2248500",
    "end": "2253780"
  },
  {
    "text": "somewhere else but generally local AZ right so they each are talking down now",
    "start": "2253780",
    "end": "2260230"
  },
  {
    "text": "there's something that so we talked about LS ends now I'm gonna go back to time stamps for just a minute but an RTS",
    "start": "2260230",
    "end": "2268150"
  },
  {
    "text": "post so they're really I think one of the most confusing things about Aurora",
    "start": "2268150",
    "end": "2273160"
  },
  {
    "text": "for a lot of people is is so we've talked about read replicas so is Aurora",
    "start": "2273160",
    "end": "2281620"
  },
  {
    "text": "more like I don't like an Oracle terminology is it data guard or is it",
    "start": "2281620",
    "end": "2288040"
  },
  {
    "text": "rack like which one is it and I actually really think this this is a really",
    "start": "2288040",
    "end": "2295030"
  },
  {
    "text": "confusing thing a lot of the time is this more like like a standby database or is it more like a cluster now the",
    "start": "2295030",
    "end": "2304270"
  },
  {
    "text": "answer what I'm gonna say what I'm gonna propose the the answer should really you should always lean",
    "start": "2304270",
    "end": "2310660"
  },
  {
    "text": "more toward cluster it really behaves more like a cluster in most ways but there's these there's a couple things",
    "start": "2310660",
    "end": "2316710"
  },
  {
    "text": "one of the ways it doesn't is that like if you know in Oracle for example with real application clusters or o-p-s back",
    "start": "2316710",
    "end": "2323410"
  },
  {
    "text": "to 8 like Oracle does the thing where it tries to maintain global consistency in a single global image of the database",
    "start": "2323410",
    "end": "2329590"
  },
  {
    "text": "meaning that all of the nodes like are at the exact same point in time it's",
    "start": "2329590",
    "end": "2334720"
  },
  {
    "text": "it's there's this this cluster wide global consistency it has a lot of sophisticated stuff to do that as a",
    "start": "2334720",
    "end": "2340780"
  },
  {
    "text": "global lock manager has global link the global enqueue services that do the locking and has cache fusion and global",
    "start": "2340780",
    "end": "2347110"
  },
  {
    "text": "cache services there's there's a lot that goes into that in Aurora one of the",
    "start": "2347110",
    "end": "2353950"
  },
  {
    "text": "things is we have these like what we call reader nodes and then we have the writer node and the reader nodes this is",
    "start": "2353950",
    "end": "2361480"
  },
  {
    "text": "this is different the reader nodes actually acts like this is why I think it is confusing for two reasons first of",
    "start": "2361480",
    "end": "2367090"
  },
  {
    "text": "all because we called them read we call them read replicas I think way too much",
    "start": "2367090",
    "end": "2373050"
  },
  {
    "text": "they are but that's the same word that we used in RDS Postgres and I think that's",
    "start": "2373050",
    "end": "2379840"
  },
  {
    "text": "that just causes confusion a lot of times right in Aurora and you know I",
    "start": "2379840",
    "end": "2385660"
  },
  {
    "text": "mean I hope this is like abundantly clear from the first presentation that has shared storage that this guy you know it's is not the same kind of read",
    "start": "2385660",
    "end": "2392290"
  },
  {
    "text": "replica however there is something that is similar and that's the fact that of the lag you don't there's there's no",
    "start": "2392290",
    "end": "2399369"
  },
  {
    "text": "concept of lag in Oracle RAC there is an Aurora so the writer might think that",
    "start": "2399369",
    "end": "2404500"
  },
  {
    "text": "it's three you know he sees the database a picture of the database as the database looks right now at three",
    "start": "2404500",
    "end": "2410320"
  },
  {
    "text": "o'clock this reader he sees a consistent",
    "start": "2410320",
    "end": "2416530"
  },
  {
    "text": "picture of the database the way the database may be the way the database looked at 2:57 hopefully you're not",
    "start": "2416530",
    "end": "2423970"
  },
  {
    "text": "really gonna get that much lag but this just makes the easier numbers to work with okay now one important thing about that",
    "start": "2423970",
    "end": "2432460"
  },
  {
    "text": "like when I say 257 that doesn't mean that like some of the blocks from 3",
    "start": "2432460",
    "end": "2438490"
  },
  {
    "text": "o'clock are here but they're just hidden it's it's completely consistent as of",
    "start": "2438490",
    "end": "2443760"
  },
  {
    "text": "257 he's it's almost like he's travelling back in time and looking at the database and maybe this reader sees",
    "start": "2443760",
    "end": "2450430"
  },
  {
    "text": "it at say 259 now how does that work the",
    "start": "2450430",
    "end": "2457150"
  },
  {
    "text": "way that that works and I think this is kind one of the really important things to understand is that in the protocol the storage protocol when this guy reads",
    "start": "2457150",
    "end": "2464410"
  },
  {
    "text": "a block from storage he sends two different things in that message he",
    "start": "2464410",
    "end": "2469990"
  },
  {
    "text": "first tells what block do I want I want block okay I want block number 24 and I",
    "start": "2469990",
    "end": "2476859"
  },
  {
    "text": "want that block from 257 now I'm using the times but you know what's actually",
    "start": "2476859",
    "end": "2482770"
  },
  {
    "text": "it's using right the LSN so we've been we kind of try to CLS sense those those LS ends are the things that we're going",
    "start": "2482770",
    "end": "2489010"
  },
  {
    "text": "to use so each reader has like its read LS n that's another place where LS ns",
    "start": "2489010",
    "end": "2495550"
  },
  {
    "text": "are going to pop up and the lag how what's the lag the lag is the difference between the difference from the Rideau",
    "start": "2495550",
    "end": "2501490"
  },
  {
    "text": "SN to the writer or the current Allison that's your difference so it's it's built into the protocol and",
    "start": "2501490",
    "end": "2509109"
  },
  {
    "text": "then we had that picture of the storage servers right well the storage servers are smart enough to understand this and",
    "start": "2509109",
    "end": "2515800"
  },
  {
    "text": "they can reconstruct a block as of any point in time okay so this storage",
    "start": "2515800",
    "end": "2522070"
  },
  {
    "text": "server and remember this storage server might be receiving requests from both the reader and the writer so the storage",
    "start": "2522070",
    "end": "2528130"
  },
  {
    "text": "server does not have like a point in time the storage server has all the blocks right all the pages with a couple",
    "start": "2528130",
    "end": "2536560"
  },
  {
    "text": "of full pages in there and okay so maybe he has a copy of the block from 2:59 and",
    "start": "2536560",
    "end": "2544119"
  },
  {
    "text": "then one from 255 and he says Oh 257",
    "start": "2544119",
    "end": "2549130"
  },
  {
    "text": "okay I'll start with the 255 block replay the changes up to 257 and then",
    "start": "2549130",
    "end": "2554740"
  },
  {
    "text": "I'll ship that version of the block up to the reader so that's what's going on it's in it's it's really cool it's very",
    "start": "2554740",
    "end": "2561369"
  },
  {
    "text": "smart storage that it's able to do that right so that's what's going on there",
    "start": "2561369",
    "end": "2566710"
  },
  {
    "text": "the let's see picture number three so",
    "start": "2566710",
    "end": "2575650"
  },
  {
    "text": "that's the block and the time that's the storage node it reconstructs the version all right so then that gets into the",
    "start": "2575650",
    "end": "2585280"
  },
  {
    "text": "next question see I have the picture I want to draw I don't remember the",
    "start": "2585280",
    "end": "2591099"
  },
  {
    "text": "question of the reason so the next thing ah because I think",
    "start": "2591099",
    "end": "2597670"
  },
  {
    "text": "that the question people sometimes wonder is what if I have like if I have",
    "start": "2597670",
    "end": "2605140"
  },
  {
    "text": "like a long-running transaction on the reader is that going to like somehow block this reader from advancing okay",
    "start": "2605140",
    "end": "2611530"
  },
  {
    "text": "the question under the question here is on people a replica lag is like the hot topic of the day with Aurora where just",
    "start": "2611530",
    "end": "2618040"
  },
  {
    "start": "2614000",
    "end": "2780000"
  },
  {
    "text": "I I mean I've been getting so many questions about like you know I just want to understand reader lag on the",
    "start": "2618040",
    "end": "2625329"
  },
  {
    "text": "readers and like you know why is it happening what's going on and that's that's the thing I want to get at so one",
    "start": "2625329",
    "end": "2631180"
  },
  {
    "text": "question that has come up in the past when we've when we've talked about this kind of stuff people is they're like okay well then then it must be that like",
    "start": "2631180",
    "end": "2639849"
  },
  {
    "text": "if have a transaction going on I can't you know let this thing advance because I still need to see the data from 257",
    "start": "2639849",
    "end": "2646210"
  },
  {
    "text": "right that's not the way it works so in fact we're still relying on the Postgres",
    "start": "2646210",
    "end": "2652779"
  },
  {
    "text": "MVCC for all of that right so we can let this guy this is an Ellison this is",
    "start": "2652779",
    "end": "2658359"
  },
  {
    "text": "different from X IDs or still X IDs there's still vacuum there's still",
    "start": "2658359",
    "end": "2665980"
  },
  {
    "text": "multiple versions of rows in every block right all of that's there so we can still let the thing advance well what",
    "start": "2665980",
    "end": "2671859"
  },
  {
    "text": "does that mean that means now what about vacuum so in Aurora the way it all works",
    "start": "2671859",
    "end": "2678430"
  },
  {
    "text": "is we do not let you disable hot standby feedback it's it's turned on and it's",
    "start": "2678430",
    "end": "2685960"
  },
  {
    "text": "cannot be edited it can't be disabled and that's basically what happens and then also in addition Aurora is not",
    "start": "2685960",
    "end": "2692829"
  },
  {
    "text": "using it's not actually Postgres code that's even doing the hosta and my",
    "start": "2692829",
    "end": "2698049"
  },
  {
    "text": "feedback to be honest there's a rora specific code there's something to call it client-side daemon that's running",
    "start": "2698049",
    "end": "2703839"
  },
  {
    "text": "that's in here and actually it's yeah it's just like I was saying the LS NS",
    "start": "2703839",
    "end": "2709119"
  },
  {
    "text": "are kind of different nor a specific there's an Aurora specific mechanism for doing the communication between the",
    "start": "2709119",
    "end": "2714730"
  },
  {
    "text": "nodes so that's a piece of that's a piece of Aurora specific code but it's",
    "start": "2714730",
    "end": "2720130"
  },
  {
    "text": "the same mechanism in that so basically what happens is you know I've got a",
    "start": "2720130",
    "end": "2725260"
  },
  {
    "text": "report running over here okay and let's say I started my report at 2:30 so you",
    "start": "2725260",
    "end": "2731950"
  },
  {
    "text": "got this report running over here and he's connected to this reader alright well what happens is we have this",
    "start": "2731950",
    "end": "2740200"
  },
  {
    "text": "basically this kind of global state over the whole cluster as well where we're",
    "start": "2740200",
    "end": "2745359"
  },
  {
    "text": "maintaining what is the what is the oldest open transaction and so we're",
    "start": "2745359",
    "end": "2754329"
  },
  {
    "text": "going to track that and we will know it's that the oldest open transaction is 2:30 and then what'll happen is vacuum",
    "start": "2754329",
    "end": "2761470"
  },
  {
    "text": "running on the writer vacuum is always gonna have to run on the writer because only the writer can change blocks he's",
    "start": "2761470",
    "end": "2766630"
  },
  {
    "text": "gonna track that which is global at the cluster level of just the oldest open transaction he just vacuumed and make",
    "start": "2766630",
    "end": "2771970"
  },
  {
    "text": "sure I'm not going to move any rows so he's gonna leave all those rows on the disk and tell that report finishes and then vacuum can go",
    "start": "2771970",
    "end": "2777850"
  },
  {
    "text": "down and clean it up so pros and cons",
    "start": "2777850",
    "end": "2783150"
  },
  {
    "start": "2780000",
    "end": "2937000"
  },
  {
    "text": "all right the great benefit of this is",
    "start": "2783150",
    "end": "2788830"
  },
  {
    "text": "that we have no lag from having open transactions what are the cons same",
    "start": "2788830",
    "end": "2795730"
  },
  {
    "text": "thing and by the way this applies to having read replicas with house and by feedback enabled to the con here is any",
    "start": "2795730",
    "end": "2804790"
  },
  {
    "text": "of like I say exactly the same thing with cross region replicas or any replica with feedback remember when we",
    "start": "2804790",
    "end": "2810880"
  },
  {
    "text": "talked about hot updates how that like longest open transaction can have",
    "start": "2810880",
    "end": "2816640"
  },
  {
    "text": "sometimes have a surprising impact on table growth and index growth right and",
    "start": "2816640",
    "end": "2822250"
  },
  {
    "text": "that that applies here as well so table",
    "start": "2822250",
    "end": "2828700"
  },
  {
    "text": "index growth basically it means that like it's very important to watch that",
    "start": "2828700",
    "end": "2834910"
  },
  {
    "text": "that oldest open transaction so where",
    "start": "2834910",
    "end": "2839980"
  },
  {
    "text": "did I want to jump to next yes one more quick thing what can cause rep but what",
    "start": "2839980",
    "end": "2847570"
  },
  {
    "text": "can cause replica lag so this doesn't then the big obvious question is next is",
    "start": "2847570",
    "end": "2852700"
  },
  {
    "text": "what does right because it clearly is happening well there are actually",
    "start": "2852700",
    "end": "2861010"
  },
  {
    "text": "there's the easiest way to illustrate this in hora post Chris I'm gonna list a couple of things out in a moment but",
    "start": "2861010",
    "end": "2868600"
  },
  {
    "text": "before I do that yeah I have just two more things I want to talk about so what",
    "start": "2868600",
    "end": "2875200"
  },
  {
    "text": "does calls are up at a leg well the first thing is something called heart conflicts so what's a hard conflict back",
    "start": "2875200",
    "end": "2881710"
  },
  {
    "text": "up here I've got my reader and I've got my writer all right so let's say I'm over on I'm over on say this reader on",
    "start": "2881710",
    "end": "2887770"
  },
  {
    "text": "the on the right this time okay and this",
    "start": "2887770",
    "end": "2893770"
  },
  {
    "text": "guy does opens a transaction begin and",
    "start": "2893770",
    "end": "2899200"
  },
  {
    "text": "then he does a select from test",
    "start": "2899200",
    "end": "2905900"
  },
  {
    "text": "and then he goes to lunch right and he forgets to like you know close his",
    "start": "2905900",
    "end": "2911150"
  },
  {
    "text": "window cuz he was working really hard now what happens now I'm the writer drop",
    "start": "2911150",
    "end": "2919400"
  },
  {
    "text": "test I think I talked about this",
    "start": "2919400",
    "end": "2924760"
  },
  {
    "text": "yesterday the day before right this is called a hard conflict so in the",
    "start": "2924760",
    "end": "2930410"
  },
  {
    "text": "Postgres docs you can look this up I don't remember if I talked about this did I talk about this yet no I have it",
    "start": "2930410",
    "end": "2937250"
  },
  {
    "start": "2937000",
    "end": "3185000"
  },
  {
    "text": "ah great key word hard conflicts one of my are lat one of the things I think I put in the lab exercises for tonight was",
    "start": "2937250",
    "end": "2944090"
  },
  {
    "text": "see if you can find that in the docs without me telling you where it is it's a fun one there's a list Postgres talks are great this is one of",
    "start": "2944090",
    "end": "2950840"
  },
  {
    "text": "them this is like a really obvious one so the thing is if you're in Oracle this",
    "start": "2950840",
    "end": "2956780"
  },
  {
    "text": "is the there's only two approaches to this kind of a conflict there's a",
    "start": "2956780",
    "end": "2963350"
  },
  {
    "text": "pessimistic and an optimistic approach right the pessimistic approach is that you have locks and use locking but these",
    "start": "2963350",
    "end": "2970610"
  },
  {
    "text": "are two wholly totally different machines and that's what that's called is like a distributor lock manager or global locking or a dlm is the lingo",
    "start": "2970610",
    "end": "2979760"
  },
  {
    "text": "that people use like who are around the stuff all way too much we don't we have",
    "start": "2979760",
    "end": "2986360"
  },
  {
    "text": "made the decision to favor throughput and to be optimistic about things like",
    "start": "2986360",
    "end": "2991820"
  },
  {
    "text": "this rather than trying to put at this point in time put a DLM on top or a",
    "start": "2991820",
    "end": "2999980"
  },
  {
    "text": "global lock measure top of reward so what that means is we let this go through we're not trying because the downside is",
    "start": "2999980",
    "end": "3006190"
  },
  {
    "text": "if you want to do locking what that means is that every single time you do an operation on a reader you have to",
    "start": "3006190",
    "end": "3012940"
  },
  {
    "text": "check like you have to it's just an introduced is a huge amount of communication between the nodes it's not",
    "start": "3012940",
    "end": "3020020"
  },
  {
    "text": "impossible to do it can be done but it is not it's not cheap right and when I",
    "start": "3020020",
    "end": "3025330"
  },
  {
    "text": "say it's not cheap I'm talking to terms of performance not dollars although it's probably true dollars too so so we let",
    "start": "3025330",
    "end": "3033910"
  },
  {
    "text": "it go through we tweet we're not doing that all of that coordination that's required to like you know again may",
    "start": "3033910",
    "end": "3039550"
  },
  {
    "text": "tange global state and also have like global locking so we let this go through because the writer doesn't know now if",
    "start": "3039550",
    "end": "3046270"
  },
  {
    "text": "you ran that on the writer he would block that drop test statement oh and just so just block this and this is he",
    "start": "3046270",
    "end": "3053170"
  },
  {
    "text": "would try to be getting exclusive an access exclusive lock this isn't stuff we talked about yesterday you needed to have that lock timeout so you don't take",
    "start": "3053170",
    "end": "3059260"
  },
  {
    "text": "down your death your system although on a drop table is probably not a big deal so he would he'll block but if you run",
    "start": "3059260",
    "end": "3067060"
  },
  {
    "text": "it on a reader and this is again exactly the same thing that happened on regular Postgres with replicas if you run this",
    "start": "3067060",
    "end": "3073960"
  },
  {
    "text": "on a reader that's still going to go through so you have a drop record goes in your wall log this will go to the",
    "start": "3073960",
    "end": "3080140"
  },
  {
    "text": "storage and alright this the fun thing here is that Aurora my sequel and Aurora",
    "start": "3080140",
    "end": "3087100"
  },
  {
    "text": "Postgres work completely different if you're on Aurora my sequel what will happen in this situation is that this",
    "start": "3087100",
    "end": "3095050"
  },
  {
    "text": "transaction will immediately die just be like you replays the record oh somebody",
    "start": "3095050",
    "end": "3101200"
  },
  {
    "text": "was trying to access a table well too bad for you kill the connection throw an error message out you're done instantly",
    "start": "3101200",
    "end": "3108900"
  },
  {
    "text": "Postgres is different Aurora Postgres what we do is we give it at this point",
    "start": "3108900",
    "end": "3116560"
  },
  {
    "text": "in time is not configurable though we're talking about making this actually opening this up and letting customers configure it with us and boundaries",
    "start": "3116560",
    "end": "3123040"
  },
  {
    "text": "right now we have it just configured as xxxii grace period so what happens in",
    "start": "3123040",
    "end": "3132580"
  },
  {
    "text": "art and Postgres or our Postgres is if you do a drop and if you do that drop the record will come and what's actually",
    "start": "3132580",
    "end": "3139270"
  },
  {
    "text": "going to happen is the record by the way we'll go over the network right because what we're doing is we're sending cache invalidation records we are sending",
    "start": "3139270",
    "end": "3146170"
  },
  {
    "text": "changes over the network directly between the nodes to invalidate the cache or update the cache and the drop",
    "start": "3146170",
    "end": "3152440"
  },
  {
    "text": "will come across - so they'll come across the network and when it gets there and a counter a little timer",
    "start": "3152440",
    "end": "3160620"
  },
  {
    "text": "immediately starts as soon as this guy as soon as this guy sees that record he",
    "start": "3160620",
    "end": "3168400"
  },
  {
    "text": "will give you 30 seconds just in the off chance that you're not at lunch and you were about to finish anyway",
    "start": "3168400",
    "end": "3174219"
  },
  {
    "text": "he'll give you 30 seconds to finish what you were doing he doesn't tell you this but he just does it as soon as 30",
    "start": "3174219",
    "end": "3180519"
  },
  {
    "text": "seconds are up and then it kills the session that's how it works in Postgres so that's an",
    "start": "3180519",
    "end": "3186400"
  },
  {
    "start": "3185000",
    "end": "3599000"
  },
  {
    "text": "example of sort of a really obvious and that can cause that can cause a the",
    "start": "3186400",
    "end": "3193869"
  },
  {
    "text": "replica to lag behind a bit right six",
    "start": "3193869",
    "end": "3200499"
  },
  {
    "text": "seven oh these are in a different order all right now there are I'm gonna erase",
    "start": "3200499",
    "end": "3209829"
  },
  {
    "text": "this and then I'm gonna actually now that's kind of like the expected thing",
    "start": "3209829",
    "end": "3216339"
  },
  {
    "text": "but there's a couple other things sort of expected that we've seen as well you",
    "start": "3216339",
    "end": "3222339"
  },
  {
    "text": "know I'll just do this I won't write all these out but I'll just kind of go through them so the common stuff that we",
    "start": "3222339",
    "end": "3228609"
  },
  {
    "text": "other common things that we see and that we kind of expect to see causing replicas lag and this is important to",
    "start": "3228609",
    "end": "3234249"
  },
  {
    "text": "know about because this is something that's being talked about a lot right now there's kind of two different things",
    "start": "3234249",
    "end": "3240339"
  },
  {
    "text": "first of all that we see is if you're four people that are on very small instance classes our smallest Aurora",
    "start": "3240339",
    "end": "3247119"
  },
  {
    "text": "instance class is the r4 dot large and we see people when they run really big",
    "start": "3247119",
    "end": "3253089"
  },
  {
    "text": "workloads on those that the literally the reader just oh oh in what we've also",
    "start": "3253089",
    "end": "3260199"
  },
  {
    "text": "especially seen is that somebody will have sometimes they run like maybe a 4x or an 8x writer but then they spin up",
    "start": "3260199",
    "end": "3267880"
  },
  {
    "text": "like a tiny reader because they're thinking I'll save some money here like that's totally fine as long as you're",
    "start": "3267880",
    "end": "3274029"
  },
  {
    "text": "not actually doing anything on the writer but if the writer is like if the writers like running hard full speed and",
    "start": "3274029",
    "end": "3282159"
  },
  {
    "text": "if it's it depends again on what's it's doing if it's doing a bunch of queries that might not be a big deal but then",
    "start": "3282159",
    "end": "3288099"
  },
  {
    "text": "because your reader is doing if you exhaust the resources on your reader I mean you can exhaust resources",
    "start": "3288099",
    "end": "3294459"
  },
  {
    "text": "to the point where just can't keep up so the first thing we've seen is just CPU exhaustion on the reader so one of the",
    "start": "3294459",
    "end": "3300369"
  },
  {
    "text": "things that we check for is if you have replica lag and you're wondering let's",
    "start": "3300369",
    "end": "3306159"
  },
  {
    "text": "go on one of the first things we look at is just like look at the CPU utilization was the CPU pegged at a hundred percent",
    "start": "3306159",
    "end": "3312170"
  },
  {
    "text": "for a like a little while when when it got behind if the CPU is pegged I mean",
    "start": "3312170",
    "end": "3318680"
  },
  {
    "text": "this it doesn't prove it but it's highly suspicious and that is and we know for",
    "start": "3318680",
    "end": "3325010"
  },
  {
    "text": "sure that that does happen and so that's something we look for Network saturation is the other thing also so on the small",
    "start": "3325010",
    "end": "3332150"
  },
  {
    "text": "sis now there's something different on the big incident we've seen another thing that's fairly common on the on the 16 X is the largest ones which is that",
    "start": "3332150",
    "end": "3339290"
  },
  {
    "text": "in Postgres there are a small number of operations you can do which require",
    "start": "3339290",
    "end": "3345710"
  },
  {
    "text": "scanning the entire buffer cache for those operations to complete the the",
    "start": "3345710",
    "end": "3350869"
  },
  {
    "text": "really notable ones are dropping a table or truncating a table when you drop a table",
    "start": "3350869",
    "end": "3356109"
  },
  {
    "text": "Postgres does not so Postgres is a buffer cache right the buffer cache is",
    "start": "3356109",
    "end": "3361400"
  },
  {
    "text": "all these little 8k blocks and it's just a cache and stuff on the disk Postgres does not maintain any kind of reverse",
    "start": "3361400",
    "end": "3367880"
  },
  {
    "text": "index that says for this object tell me all the blocks in memory that are",
    "start": "3367880",
    "end": "3373310"
  },
  {
    "text": "associated with that object ID so that's not usually a big deal because it's rare",
    "start": "3373310",
    "end": "3378800"
  },
  {
    "text": "that you need to do that sort of thing usually yeah that's rare that you would",
    "start": "3378800",
    "end": "3384619"
  },
  {
    "text": "need to do that sort of thing usually you're looking for a specific block and you know the block that you want and you",
    "start": "3384619",
    "end": "3390140"
  },
  {
    "text": "go looking for it dropping and truncating objects in Postgres require yeah requires scanning through the",
    "start": "3390140",
    "end": "3395150"
  },
  {
    "text": "entire buffer cache which so what that by itself is not a big deal but what",
    "start": "3395150",
    "end": "3400430"
  },
  {
    "text": "we've seen is we've seen a couple of workloads like for example workloads",
    "start": "3400430",
    "end": "3406070"
  },
  {
    "text": "where you're making heavy use of temporary tables you're like create create create create you know create 30",
    "start": "3406070",
    "end": "3411500"
  },
  {
    "text": "temp tables do some stuff drop 30 temp tables in a row and then you get like you know 100 connections doing that at",
    "start": "3411500",
    "end": "3418849"
  },
  {
    "text": "the same time and all of a sudden you got you know 300 or 3,000 table drops right in a row and that's absolutely",
    "start": "3418849",
    "end": "3426260"
  },
  {
    "text": "something that we have seen take down largest large readers because all of they're trying to replay those what",
    "start": "3426260",
    "end": "3433010"
  },
  {
    "text": "happens is each time they want to replay that drop command on the reader they",
    "start": "3433010",
    "end": "3438349"
  },
  {
    "text": "have to scan the entire buffer cache can you write",
    "start": "3438349",
    "end": "3444869"
  },
  {
    "text": "that down that's a good question stick it in the chime room because I want to answer that whenever it with everybody actually not just here the the other I",
    "start": "3444869",
    "end": "3454019"
  },
  {
    "text": "mean so those are those are the three kind of really sorry the four sort of like common expected things that I know",
    "start": "3454019",
    "end": "3460680"
  },
  {
    "text": "of so far for causing lag there are also like a handful of there's a couple of",
    "start": "3460680",
    "end": "3469079"
  },
  {
    "text": "bugs there's that that are in the process of getting fixed right now I'll probably tell you about a one",
    "start": "3469079",
    "end": "3474959"
  },
  {
    "text": "particularly fun one later because in the lab because you can actually use it to like trigger a read or restart",
    "start": "3474959",
    "end": "3480749"
  },
  {
    "text": "whatever you want for now but not for long because they've already fixed it so it's just a matter of time until that gets",
    "start": "3480749",
    "end": "3486420"
  },
  {
    "text": "pushed out but it's kind of fun to exploit something like that like you know on the like couple of days you get",
    "start": "3486420",
    "end": "3491940"
  },
  {
    "text": "it's it's great for actually kind of studying the engine so outside of those",
    "start": "3491940",
    "end": "3497339"
  },
  {
    "text": "things if you see issues of lag popping up that's what we want to hear about it as of right now because we're this is",
    "start": "3497339",
    "end": "3505769"
  },
  {
    "text": "really important and we're looking to improve it now how much lag is okay I mentioned something there which I hadn't",
    "start": "3505769",
    "end": "3512519"
  },
  {
    "text": "really said before this which was reader restarts and that's of course the big",
    "start": "3512519",
    "end": "3517859"
  },
  {
    "text": "reason everybody wants to know about replica lag is because they're like hey my reader just like restarted itself",
    "start": "3517859",
    "end": "3524519"
  },
  {
    "text": "what's what gives right that's like the driving thing so here's a picture that I",
    "start": "3524519",
    "end": "3532199"
  },
  {
    "text": "hope will help with that so I'm going to draw a line here c21 boomp boomp boomp",
    "start": "3532199",
    "end": "3542569"
  },
  {
    "text": "okay one minute all right",
    "start": "3542569",
    "end": "3551180"
  },
  {
    "text": "so the writer this is lag okay so that's the writer",
    "start": "3553609",
    "end": "3565710"
  },
  {
    "text": "and then this is lag so your reader your reader gets behind by by how much right",
    "start": "3565710",
    "end": "3573119"
  },
  {
    "text": "this is in minutes but you know me a little tick marks every 15 seconds this is my most up-to-date understanding of",
    "start": "3573119",
    "end": "3583680"
  },
  {
    "text": "how this works all right I had to really like I had to really",
    "start": "3583680",
    "end": "3589380"
  },
  {
    "text": "throw some people up the wall to figure all of this out it's it turns out it's actually really complicated it's not",
    "start": "3589380",
    "end": "3594810"
  },
  {
    "text": "just like it's not just like some one number we're like oh if you get to this number of lag then you get restarted",
    "start": "3594810",
    "end": "3601670"
  },
  {
    "text": "unfortunately it's not that simple at all I wish it was but basically the way",
    "start": "3601670",
    "end": "3607590"
  },
  {
    "text": "Aurora was engineered it was designed I mean people were trying to think of like clever ways to make it available I",
    "start": "3607590",
    "end": "3614310"
  },
  {
    "text": "actually think we as I've been trying to understand this I don't know it may be",
    "start": "3614310",
    "end": "3619560"
  },
  {
    "text": "it may be in a month or two like this will all become really clear and easy to distill down maybe not I'm not right now",
    "start": "3619560",
    "end": "3627630"
  },
  {
    "text": "I'm wondering a free over engineered it but I don't think so we're trying to keep systems up it's just like what I said earlier like",
    "start": "3627630",
    "end": "3633420"
  },
  {
    "text": "sometimes I prefer predictability over over other things or like I loved it it",
    "start": "3633420",
    "end": "3639390"
  },
  {
    "text": "was easier to explain all right so the first 15 seconds are green we all so for",
    "start": "3639390",
    "end": "3650760"
  },
  {
    "text": "15 seconds you're like green light you can have 15 seconds of lag and as far as",
    "start": "3650760",
    "end": "3656130"
  },
  {
    "text": "I know like for my reading of the comments and the code and for my talking to engineers I don't think that we ever",
    "start": "3656130",
    "end": "3662190"
  },
  {
    "text": "like knowingly cause something bad to happen and with 15 seconds of life after",
    "start": "3662190",
    "end": "3669660"
  },
  {
    "text": "15 seconds you get into you start getting into the gray zone so from 15",
    "start": "3669660",
    "end": "3675150"
  },
  {
    "text": "side the next phase is from 15 seconds to one minute and I'm calling this blue",
    "start": "3675150",
    "end": "3680180"
  },
  {
    "text": "because this section is theirs is generally safe",
    "start": "3680180",
    "end": "3686060"
  },
  {
    "text": "there's only there's kind of two things that I'm aware of that can cause a restart here all right where I actually",
    "start": "3686060",
    "end": "3696020"
  },
  {
    "text": "would make this yellow if we had a yellow marker this is like kind of like the caution zone I would say yeah that's",
    "start": "3696020",
    "end": "3704450"
  },
  {
    "text": "what we're gonna do we're gonna call this caution it's not not danger necessarily boy that's unreadable try",
    "start": "3704450",
    "end": "3712690"
  },
  {
    "text": "try that again looks like I was like making artwork instead of drawing letters all right the",
    "start": "3712690",
    "end": "3722810"
  },
  {
    "text": "two things there that that I know of is that first of all so for the caution",
    "start": "3722810",
    "end": "3729920"
  },
  {
    "text": "zone the the storage nodes themselves if",
    "start": "3729920",
    "end": "3737840"
  },
  {
    "text": "they I haven't actually seen this happen but I've seen code for it so theoretically it can happen so that",
    "start": "3737840",
    "end": "3744670"
  },
  {
    "text": "supposedly the storage nodes if if they need to throttle or to slow you down or",
    "start": "3744670",
    "end": "3752210"
  },
  {
    "text": "something's going on like if they if I don't know the reason the the wording is",
    "start": "3752210",
    "end": "3757250"
  },
  {
    "text": "throttling that's the word that's kind of like use like I said I've never actually seen it happen on a system yet",
    "start": "3757250",
    "end": "3762760"
  },
  {
    "text": "but but the code says that from 15 seconds to 1 minute the storage nodes",
    "start": "3762760",
    "end": "3768859"
  },
  {
    "text": "can send a message that will trigger an error condition that causes a reader to",
    "start": "3768859",
    "end": "3774500"
  },
  {
    "text": "be sort of restarted so it can just catch up right and that can happen after 15 seconds the second thing after 15",
    "start": "3774500",
    "end": "3783200"
  },
  {
    "text": "seconds is theirs so there's something called a transport buffer I believe",
    "start": "3783200",
    "end": "3791690"
  },
  {
    "text": "that's on the writer I believe and that",
    "start": "3791690",
    "end": "3798260"
  },
  {
    "text": "transport buffer is it's basically like a buffer in memory that's kind of like",
    "start": "3798260",
    "end": "3803570"
  },
  {
    "text": "holding changes that need to get sent over the network to the reader so basically this this is I believe the",
    "start": "3803570",
    "end": "3809240"
  },
  {
    "text": "network throttling case we're like if I don't have enough or bandwidth right I should just rewrite",
    "start": "3809240",
    "end": "3816490"
  },
  {
    "text": "that so I I'm gonna double-check that with the engineers too I think that is the I need to find because I know the",
    "start": "3816490",
    "end": "3825369"
  },
  {
    "text": "message and the fresh to check the logs because that would be really useful to know I if I'm right about this then what",
    "start": "3825369",
    "end": "3831640"
  },
  {
    "text": "that means is after fifteen seconds is the point where you can start seeing Network related restarts because your",
    "start": "3831640",
    "end": "3838060"
  },
  {
    "text": "network is throttled so what do you do if you're hitting this that transport",
    "start": "3838060",
    "end": "3843400"
  },
  {
    "text": "buffer it the size of it is just based on your instance class so you basically",
    "start": "3843400",
    "end": "3849310"
  },
  {
    "text": "the answer is you scale up because when you scale up first of all you get more network if you're on the time I mean we",
    "start": "3849310",
    "end": "3855849"
  },
  {
    "text": "don't ever see these issues on our big instances this happens when you're on a small instance that's the only time we",
    "start": "3855849",
    "end": "3860980"
  },
  {
    "text": "ever see it because as you get to largest you both get more network bandwidth and you also have bigger",
    "start": "3860980",
    "end": "3867099"
  },
  {
    "text": "buffers as well so you can so it's just this tiny instances and by the way when we were",
    "start": "3867099",
    "end": "3873099"
  },
  {
    "text": "last when we release support 40 class all of this stuff is going to get even more important right because that'll be",
    "start": "3873099",
    "end": "3879609"
  },
  {
    "text": "coming out so there's something you want to keep in mind that's the caution zone after the caution zone we get into it",
    "start": "3879609",
    "end": "3886390"
  },
  {
    "text": "I'm gonna call the danger zone all right the danger zone is for one minute to two",
    "start": "3886390",
    "end": "3893320"
  },
  {
    "text": "minutes okay once you're in the danger",
    "start": "3893320",
    "end": "3903099"
  },
  {
    "text": "zone once you're over a minute all that has to happen really is you just have to",
    "start": "3903099",
    "end": "3909550"
  },
  {
    "text": "be unlucky so what happens after 60 seconds the way the aurorus the way were",
    "start": "3909550",
    "end": "3917500"
  },
  {
    "text": "is designed right now is that so I think the and I guess the other really",
    "start": "3917500",
    "end": "3923380"
  },
  {
    "text": "important thing oh I forgot to write down this part but there's a tension okay that we're balancing here okay when",
    "start": "3923380",
    "end": "3932020"
  },
  {
    "text": "you just have a little bit of lag the system is designed to favor reader",
    "start": "3932020",
    "end": "3938859"
  },
  {
    "text": "availability but the more lag that you see the system",
    "start": "3938859",
    "end": "3946070"
  },
  {
    "text": "begins to try to and because what you're doing that at your you're doing that at",
    "start": "3946070",
    "end": "3951200"
  },
  {
    "text": "the expense of something alright and that's why its attention you're keeping your readers up yes true but you're",
    "start": "3951200",
    "end": "3958310"
  },
  {
    "text": "doing that at the expense of writer throughput right your you essentially",
    "start": "3958310",
    "end": "3966830"
  },
  {
    "text": "you have to throttle your writer to keep the readers available alright and so",
    "start": "3966830",
    "end": "3972530"
  },
  {
    "text": "we're balancing this tension between reader availability and writer through point as you get into the danger zone",
    "start": "3972530",
    "end": "3981230"
  },
  {
    "text": "what happens is is now you're getting in the place where we're gonna say look we",
    "start": "3981230",
    "end": "3986450"
  },
  {
    "text": "we can't just like we can't stop the writer just to keep your reader available so at this point we're going",
    "start": "3986450",
    "end": "3993740"
  },
  {
    "text": "to favor the writer over the reader like we can't have both either the writer is going to get stuck and the reader will",
    "start": "3993740",
    "end": "3999740"
  },
  {
    "text": "stay up or we've got to like just do a quick restart of the reader and the writer can keep on going so in the",
    "start": "3999740",
    "end": "4007210"
  },
  {
    "text": "danger zone we favor the writer through a book what happens after 60 seconds and this is this as the throw this is the",
    "start": "4007210",
    "end": "4012610"
  },
  {
    "text": "threshold where changes in 60 seconds at 60 seconds it will the writer so you",
    "start": "4012610",
    "end": "4018400"
  },
  {
    "text": "know how you have those feedback messages that tell the writer well the writer will start just going ahead and advancing oh and that's that's when we",
    "start": "4018400",
    "end": "4025000"
  },
  {
    "text": "get into the thing there's one other kind of really important act which we talk about LS ends every cluster in that",
    "start": "4025000",
    "end": "4030160"
  },
  {
    "text": "global state that I talked about I forgot to write this on there but it it maintains something that we call the",
    "start": "4030160",
    "end": "4037320"
  },
  {
    "text": "minimum read point Ellison so it's the",
    "start": "4037320",
    "end": "4047710"
  },
  {
    "text": "minimum read point that means if you try to read an LS n lower than this so what",
    "start": "4047710",
    "end": "4054160"
  },
  {
    "text": "this actually is this is the LS n and so",
    "start": "4054160",
    "end": "4059350"
  },
  {
    "text": "it's the head node the writer head node is the guy who gets to decide this miss Ellison and what do you this is the LS n",
    "start": "4059350",
    "end": "4067090"
  },
  {
    "text": "that he sends to the storage and he says okay this is the oldest LS n that you need to keep after this LS n",
    "start": "4067090",
    "end": "4075190"
  },
  {
    "text": "you can go ahead and start back them up to ask three and then clear them off of your desk all right but this is the",
    "start": "4075190",
    "end": "4082090"
  },
  {
    "text": "oldest one you need to keep is this minimum read point Ellison or what we",
    "start": "4082090",
    "end": "4087130"
  },
  {
    "text": "often call it is the ripple yeah that's what I've heard the engineering team say",
    "start": "4087130",
    "end": "4092650"
  },
  {
    "text": "a whole bunch of times is the purple so the minimum repoint allison that tell us the storage no so what that means",
    "start": "4092650",
    "end": "4099549"
  },
  {
    "text": "that 60 seconds the writer will start it will now calculate a mer pool and it",
    "start": "4099550",
    "end": "4105580"
  },
  {
    "text": "will disregard the reader so what that means is the writer has given permission",
    "start": "4105580",
    "end": "4110799"
  },
  {
    "text": "to the storage to do cleanup of records that I might still need to read so once",
    "start": "4110800",
    "end": "4116440"
  },
  {
    "text": "you're in the danger zone all it takes is you need just to do a single IO right",
    "start": "4116440",
    "end": "4123730"
  },
  {
    "text": "that was a lot lower than it needs to be",
    "start": "4123730",
    "end": "4128370"
  },
  {
    "text": "below the mer pool and if you do a single IO below that purple you're out",
    "start": "4128970",
    "end": "4136240"
  },
  {
    "text": "you're toast your host the storage will say I do not have that you know not here",
    "start": "4136240",
    "end": "4142240"
  },
  {
    "text": "and then you get an error message saying read below purple that is a fatal error and that immediately triggers a reader restart two minutes I said the Dames",
    "start": "4142240",
    "end": "4151750"
  },
  {
    "text": "Islander this line up to two minutes and two minutes or there abouts is basically",
    "start": "4151750",
    "end": "4157770"
  },
  {
    "text": "the Death Zone I like that",
    "start": "4157770",
    "end": "4163140"
  },
  {
    "text": "only from the perspective of readers though it's I love this this is a great",
    "start": "4167240",
    "end": "4174350"
  },
  {
    "text": "grant I kind of made this up on the fly but yes so once you get the two minutes and they're actually that's where at two",
    "start": "4174350",
    "end": "4180529"
  },
  {
    "text": "minutes the code will just say look two minutes you can't go past two minutes and and regardless of everything else",
    "start": "4180530",
    "end": "4187130"
  },
  {
    "text": "we're just going to restart this reader by the time it comes because what will happen on a restart it's all it is is",
    "start": "4187130",
    "end": "4192920"
  },
  {
    "text": "this like kill the process restart the process but when the process restarts he just he doesn't have to replay anything",
    "start": "4192920",
    "end": "4200090"
  },
  {
    "text": "he doesn't have to catch up it's just like oh okay I'll just take this LSN and start doing",
    "start": "4200090",
    "end": "4206300"
  },
  {
    "text": "my reads from this Ellison so it's like an instant ketchup to just like stop the process and restart it and that's what",
    "start": "4206300",
    "end": "4212390"
  },
  {
    "text": "we're going for so the idea is is that you know again I think that this sort of",
    "start": "4212390",
    "end": "4218000"
  },
  {
    "text": "tension is sort of the key thought that what we're doing is we're balancing attention between reader availability",
    "start": "4218000",
    "end": "4223430"
  },
  {
    "text": "and writer throughput and the more that you lag the the more that we're going to",
    "start": "4223430",
    "end": "4228950"
  },
  {
    "text": "favor the writer all right that was the",
    "start": "4228950",
    "end": "4234770"
  },
  {
    "text": "end of what I had to talk about today I hope that is useful",
    "start": "4234770",
    "end": "4241840"
  }
]