[
  {
    "text": "[Music]",
    "start": "5010",
    "end": "7580"
  },
  {
    "text": "so really excited to be here share some",
    "start": "7580",
    "end": "10320"
  },
  {
    "text": "details of our experience growing strata",
    "start": "10320",
    "end": "12570"
  },
  {
    "text": "and our infrastructure on eight of us",
    "start": "12570",
    "end": "14240"
  },
  {
    "text": "but first let me just spend a little bit",
    "start": "14240",
    "end": "16710"
  },
  {
    "text": "of time introducing myself",
    "start": "16710",
    "end": "18029"
  },
  {
    "text": "my name is Jacob Stoltz I manage the",
    "start": "18029",
    "end": "19890"
  },
  {
    "text": "infrastructure team so the",
    "start": "19890",
    "end": "21240"
  },
  {
    "text": "infrastructure team at Strava more",
    "start": "21240",
    "end": "23250"
  },
  {
    "text": "broadly is responsible for our core",
    "start": "23250",
    "end": "25199"
  },
  {
    "text": "server-side systems that support our",
    "start": "25199",
    "end": "26939"
  },
  {
    "text": "application so this is mainly sort of",
    "start": "26939",
    "end": "29250"
  },
  {
    "text": "everything necessary to run our",
    "start": "29250",
    "end": "30599"
  },
  {
    "text": "application in production I've been here",
    "start": "30599",
    "end": "32578"
  },
  {
    "text": "for just over five years the",
    "start": "32579",
    "end": "34110"
  },
  {
    "text": "infrastructure team throughout that time",
    "start": "34110",
    "end": "35969"
  },
  {
    "text": "and before I came to Strava I had a",
    "start": "35969",
    "end": "38309"
  },
  {
    "text": "background in kernel and database",
    "start": "38309",
    "end": "40110"
  },
  {
    "text": "development this photo is probably the",
    "start": "40110",
    "end": "44309"
  },
  {
    "text": "simultaneous best and worst photo of me",
    "start": "44309",
    "end": "46440"
  },
  {
    "text": "ever so like you know sort of typical",
    "start": "46440",
    "end": "49649"
  },
  {
    "text": "people put like photos themselves in",
    "start": "49649",
    "end": "50879"
  },
  {
    "text": "extreme situations which I think that",
    "start": "50879",
    "end": "52199"
  },
  {
    "text": "qualifies so that sort of accurately",
    "start": "52199",
    "end": "56070"
  },
  {
    "text": "reflects my state of mind for the past",
    "start": "56070",
    "end": "57120"
  },
  {
    "text": "year or so since I had my twins so let",
    "start": "57120",
    "end": "59309"
  },
  {
    "text": "me introduce strata so Strava is a",
    "start": "59309",
    "end": "61530"
  },
  {
    "text": "social network for athletes but I want",
    "start": "61530",
    "end": "63270"
  },
  {
    "text": "to clarify that we use the term athletes",
    "start": "63270",
    "end": "64830"
  },
  {
    "text": "a little more broadly than some made",
    "start": "64830",
    "end": "66900"
  },
  {
    "text": "sort of normally interpreted as strata",
    "start": "66900",
    "end": "69180"
  },
  {
    "text": "isn't just intended for elite in",
    "start": "69180",
    "end": "70830"
  },
  {
    "text": "professional athletes like Kilian Jornet",
    "start": "70830",
    "end": "72000"
  },
  {
    "text": "climbing Everest though we do have",
    "start": "72000",
    "end": "74040"
  },
  {
    "text": "plenty of loot international athletes as",
    "start": "74040",
    "end": "76080"
  },
  {
    "text": "well it's more broadly just for people",
    "start": "76080",
    "end": "78450"
  },
  {
    "text": "who sweat and our goal is really to",
    "start": "78450",
    "end": "80909"
  },
  {
    "text": "connect and inspire those people in",
    "start": "80909",
    "end": "83070"
  },
  {
    "text": "their active endeavors athletes upload",
    "start": "83070",
    "end": "86310"
  },
  {
    "text": "activities to us runs rides etc the",
    "start": "86310",
    "end": "90750"
  },
  {
    "text": "either our mobile app which provides a",
    "start": "90750",
    "end": "92369"
  },
  {
    "text": "record experience or you know GPS",
    "start": "92369",
    "end": "95009"
  },
  {
    "text": "devices smartwatches Garmin cycling",
    "start": "95009",
    "end": "97530"
  },
  {
    "text": "computers etc and so they can then view",
    "start": "97530",
    "end": "99750"
  },
  {
    "text": "and track their activity over time",
    "start": "99750",
    "end": "100850"
  },
  {
    "text": "compare it with others performance or",
    "start": "100850",
    "end": "102930"
  },
  {
    "text": "their own performance over time share",
    "start": "102930",
    "end": "104820"
  },
  {
    "text": "experiences you know add photos that's",
    "start": "104820",
    "end": "106649"
  },
  {
    "text": "their thing as well as discover new new",
    "start": "106649",
    "end": "109409"
  },
  {
    "text": "ways to be active through clubs routes",
    "start": "109409",
    "end": "111680"
  },
  {
    "text": "etc historically struggle is sort of",
    "start": "111680",
    "end": "114899"
  },
  {
    "text": "really originally built intended as an",
    "start": "114899",
    "end": "117659"
  },
  {
    "text": "experience for cyclists but these days",
    "start": "117659",
    "end": "119520"
  },
  {
    "text": "we actually support more than 35",
    "start": "119520",
    "end": "120930"
  },
  {
    "text": "different activity types so we have",
    "start": "120930",
    "end": "122640"
  },
  {
    "text": "about 170 employees over a few",
    "start": "122640",
    "end": "125009"
  },
  {
    "text": "continents you know as mentioned about",
    "start": "125009",
    "end": "126270"
  },
  {
    "text": "35 million members and notably you know",
    "start": "126270",
    "end": "128670"
  },
  {
    "text": "Shar mentioned that we're you know",
    "start": "128670",
    "end": "130259"
  },
  {
    "text": "pretty much global but not just like in",
    "start": "130259",
    "end": "132060"
  },
  {
    "text": "terms of",
    "start": "132060",
    "end": "132569"
  },
  {
    "text": "I'll reach it's really international net",
    "start": "132569",
    "end": "134250"
  },
  {
    "text": "over 82% of those users are outside the",
    "start": "134250",
    "end": "137010"
  },
  {
    "text": "United States",
    "start": "137010",
    "end": "138750"
  },
  {
    "text": "and collectively they've uploaded over",
    "start": "138750",
    "end": "140579"
  },
  {
    "text": "well over a billion activities in the",
    "start": "140579",
    "end": "142560"
  },
  {
    "text": "past nine years or so so a little bit of",
    "start": "142560",
    "end": "146069"
  },
  {
    "text": "background around strobus architecture",
    "start": "146069",
    "end": "147689"
  },
  {
    "text": "and some of the history there and how",
    "start": "147689",
    "end": "148739"
  },
  {
    "text": "we've scaled so we started in 2009 and",
    "start": "148739",
    "end": "151890"
  },
  {
    "text": "at the time is before I joined but",
    "start": "151890",
    "end": "153750"
  },
  {
    "text": "you've really sort of optimized for",
    "start": "153750",
    "end": "155670"
  },
  {
    "text": "building quickly and we settled on Ruby",
    "start": "155670",
    "end": "158639"
  },
  {
    "text": "on Rails and my sequel which I think was",
    "start": "158639",
    "end": "160620"
  },
  {
    "text": "a pretty reasonable trade-off at the",
    "start": "160620",
    "end": "161760"
  },
  {
    "text": "time but then we grew and that",
    "start": "161760",
    "end": "164939"
  },
  {
    "text": "infrastructure began to struggle I'm",
    "start": "164939",
    "end": "166739"
  },
  {
    "text": "gonna highlight two particular areas",
    "start": "166739",
    "end": "167970"
  },
  {
    "text": "that we had the sort of challenges in so",
    "start": "167970",
    "end": "171180"
  },
  {
    "text": "one is scaling our data storage and",
    "start": "171180",
    "end": "172739"
  },
  {
    "text": "retrieval systems and the other is",
    "start": "172739",
    "end": "174599"
  },
  {
    "text": "scaling our application logic and both",
    "start": "174599",
    "end": "176129"
  },
  {
    "text": "of those really tie in more to the tie",
    "start": "176129",
    "end": "178560"
  },
  {
    "text": "into the more in-depth discussion that",
    "start": "178560",
    "end": "179970"
  },
  {
    "text": "you'll hear from Jeff so first on the",
    "start": "179970",
    "end": "181500"
  },
  {
    "text": "data storage side you know single my",
    "start": "181500",
    "end": "183359"
  },
  {
    "text": "sequel instance that we had originally",
    "start": "183359",
    "end": "184620"
  },
  {
    "text": "was was clearly not really gonna cut it",
    "start": "184620",
    "end": "186419"
  },
  {
    "text": "forever we did a number of things over",
    "start": "186419",
    "end": "188189"
  },
  {
    "text": "time so the first thing was we started",
    "start": "188189",
    "end": "189599"
  },
  {
    "text": "simply so we we just spun out more",
    "start": "189599",
    "end": "191760"
  },
  {
    "text": "databases and we partitioned those",
    "start": "191760",
    "end": "193349"
  },
  {
    "text": "logically by table so if we had you know",
    "start": "193349",
    "end": "196579"
  },
  {
    "text": "you know particularly large tables or",
    "start": "196579",
    "end": "198870"
  },
  {
    "text": "groups of tables with really high read",
    "start": "198870",
    "end": "201120"
  },
  {
    "text": "low read or write load we would sort of",
    "start": "201120",
    "end": "202949"
  },
  {
    "text": "move them off into their own databases",
    "start": "202949",
    "end": "204810"
  },
  {
    "text": "that outgrew the original database to",
    "start": "204810",
    "end": "206129"
  },
  {
    "text": "isolate that and allow us to scale",
    "start": "206129",
    "end": "207720"
  },
  {
    "text": "horizontally that way the next step that",
    "start": "207720",
    "end": "209489"
  },
  {
    "text": "we took over time was to really improve",
    "start": "209489",
    "end": "211829"
  },
  {
    "text": "our read scaling capacity and our high",
    "start": "211829",
    "end": "213479"
  },
  {
    "text": "availability story with a cluster",
    "start": "213479",
    "end": "214979"
  },
  {
    "text": "database system so we did research on",
    "start": "214979",
    "end": "217530"
  },
  {
    "text": "sort of several options a couple of",
    "start": "217530",
    "end": "219060"
  },
  {
    "text": "years ago and we eventually settled on",
    "start": "219060",
    "end": "220349"
  },
  {
    "text": "Arora which I gathered from the database",
    "start": "220349",
    "end": "222510"
  },
  {
    "text": "we could gender over there you're",
    "start": "222510",
    "end": "223409"
  },
  {
    "text": "probably all familiar with this point",
    "start": "223409",
    "end": "225090"
  },
  {
    "text": "and then finally we another really big",
    "start": "225090",
    "end": "228060"
  },
  {
    "text": "theme was looking at certain like really",
    "start": "228060",
    "end": "231090"
  },
  {
    "text": "heavy inexpensive read patterns and like",
    "start": "231090",
    "end": "234409"
  },
  {
    "text": "pre materializing the results of those",
    "start": "234409",
    "end": "236790"
  },
  {
    "text": "reads as denormalized data sets and",
    "start": "236790",
    "end": "238560"
  },
  {
    "text": "primarily we use Cassandra for that and",
    "start": "238560",
    "end": "240720"
  },
  {
    "text": "secondly on the scaling of the",
    "start": "240720",
    "end": "242579"
  },
  {
    "text": "application logic side we have a pretty",
    "start": "242579",
    "end": "244439"
  },
  {
    "text": "rich feature set and some member actions",
    "start": "244439",
    "end": "246989"
  },
  {
    "text": "notably activity upload they really",
    "start": "246989",
    "end": "249659"
  },
  {
    "text": "trigger a lot of expensive downstream",
    "start": "249659",
    "end": "251189"
  },
  {
    "text": "actions performing all of them in",
    "start": "251189",
    "end": "254220"
  },
  {
    "text": "process in our rails application was",
    "start": "254220",
    "end": "256109"
  },
  {
    "text": "clearly untenable not just from a",
    "start": "256109",
    "end": "258509"
  },
  {
    "text": "performance standpoint but also like",
    "start": "258509",
    "end": "259949"
  },
  {
    "text": "just in terms of application complexity",
    "start": "259949",
    "end": "261870"
  },
  {
    "text": "and all that so we ended up building out",
    "start": "261870",
    "end": "264630"
  },
  {
    "text": "a lot",
    "start": "264630",
    "end": "265620"
  },
  {
    "text": "more robust event-based background",
    "start": "265620",
    "end": "268440"
  },
  {
    "text": "processing systems so sort of a final",
    "start": "268440",
    "end": "270690"
  },
  {
    "text": "note here one of the things I really",
    "start": "270690",
    "end": "272100"
  },
  {
    "text": "want to highlight is that I think the",
    "start": "272100",
    "end": "274020"
  },
  {
    "text": "impact that individual engineers that",
    "start": "274020",
    "end": "275400"
  },
  {
    "text": "Strava have we have a lot of like again",
    "start": "275400",
    "end": "277740"
  },
  {
    "text": "rich feature set a lot of structured",
    "start": "277740",
    "end": "279240"
  },
  {
    "text": "data and a lot of really interesting",
    "start": "279240",
    "end": "281220"
  },
  {
    "text": "challenges on the boundary between",
    "start": "281220",
    "end": "282479"
  },
  {
    "text": "products and infrastructure the scale",
    "start": "282479",
    "end": "284490"
  },
  {
    "text": "breath and reach of our product on a per",
    "start": "284490",
    "end": "287310"
  },
  {
    "text": "engineer basis I think is really high",
    "start": "287310",
    "end": "288720"
  },
  {
    "text": "for instance on the infrastructure team",
    "start": "288720",
    "end": "290790"
  },
  {
    "text": "we've got this like very large user base",
    "start": "290790",
    "end": "292800"
  },
  {
    "text": "and I only manage five people and so",
    "start": "292800",
    "end": "296160"
  },
  {
    "text": "we're just the six of us are basically",
    "start": "296160",
    "end": "298050"
  },
  {
    "text": "responsible for all that and it's it's",
    "start": "298050",
    "end": "299580"
  },
  {
    "text": "it's a it's a lot of it's it's a really",
    "start": "299580",
    "end": "302370"
  },
  {
    "text": "interesting challenge a lot of the time",
    "start": "302370",
    "end": "303810"
  },
  {
    "text": "and that potential to have impact that",
    "start": "303810",
    "end": "307050"
  },
  {
    "text": "broadly is really the main reason I'm",
    "start": "307050",
    "end": "308400"
  },
  {
    "text": "still a Strava five years after starting",
    "start": "308400",
    "end": "309780"
  },
  {
    "text": "and still pretty happy but that's it for",
    "start": "309780",
    "end": "312720"
  },
  {
    "text": "me",
    "start": "312720",
    "end": "313050"
  },
  {
    "text": "so now Jeff we'll get into some of the",
    "start": "313050",
    "end": "315389"
  },
  {
    "text": "real content so I can talk to you about",
    "start": "315389",
    "end": "317310"
  },
  {
    "text": "what a segment leaderboard is in talk",
    "start": "317310",
    "end": "319080"
  },
  {
    "text": "about how we used to host them with",
    "start": "319080",
    "end": "320669"
  },
  {
    "text": "previous architectures and then kind of",
    "start": "320669",
    "end": "322860"
  },
  {
    "text": "a a love-hate love relationship with",
    "start": "322860",
    "end": "324990"
  },
  {
    "text": "Redis where we used it initially early",
    "start": "324990",
    "end": "328410"
  },
  {
    "text": "on that worked great and then we kind of",
    "start": "328410",
    "end": "329610"
  },
  {
    "text": "had scaling challenges with it and then",
    "start": "329610",
    "end": "331229"
  },
  {
    "text": "how we basically then used it as a user",
    "start": "331229",
    "end": "334470"
  },
  {
    "text": "than a new way to kind of help scale our",
    "start": "334470",
    "end": "336479"
  },
  {
    "text": "signal leaderboard system so a little",
    "start": "336479",
    "end": "338070"
  },
  {
    "text": "bit about me I'm a senior platform",
    "start": "338070",
    "end": "339990"
  },
  {
    "text": "engineer at Strava minutes travel for",
    "start": "339990",
    "end": "341910"
  },
  {
    "text": "three years but other than I've been",
    "start": "341910",
    "end": "343410"
  },
  {
    "text": "working in technology primarily at web",
    "start": "343410",
    "end": "345960"
  },
  {
    "text": "technology companies a startups for",
    "start": "345960",
    "end": "347849"
  },
  {
    "text": "about ten years usually on web tech or",
    "start": "347849",
    "end": "349860"
  },
  {
    "text": "in distributed systems I like being",
    "start": "349860",
    "end": "352229"
  },
  {
    "text": "outside duck bikes and dogs I don't have",
    "start": "352229",
    "end": "354450"
  },
  {
    "text": "twins but I do would they go backpacking",
    "start": "354450",
    "end": "356700"
  },
  {
    "text": "English or a couple of years ago so this",
    "start": "356700",
    "end": "358169"
  },
  {
    "text": "picture is me being being outside talk",
    "start": "358169",
    "end": "360539"
  },
  {
    "text": "about seven leaderboards which are",
    "start": "360539",
    "end": "362250"
  },
  {
    "text": "basically a segment which has been",
    "start": "362250",
    "end": "363389"
  },
  {
    "text": "discussed before and also a leaderboard",
    "start": "363389",
    "end": "365479"
  },
  {
    "text": "segments are within the stronger product",
    "start": "365479",
    "end": "367800"
  },
  {
    "text": "our user created sections of the earth",
    "start": "367800",
    "end": "370560"
  },
  {
    "text": "usually they're a road or a trail but",
    "start": "370560",
    "end": "372570"
  },
  {
    "text": "I'll explain how they cannot be",
    "start": "372570",
    "end": "373680"
  },
  {
    "text": "sometimes there's specific gen activity",
    "start": "373680",
    "end": "375930"
  },
  {
    "text": "types so there may be a cycling segment",
    "start": "375930",
    "end": "378870"
  },
  {
    "text": "like you have a climb for example that",
    "start": "378870",
    "end": "380520"
  },
  {
    "text": "is specific to bike to bike riding",
    "start": "380520",
    "end": "383430"
  },
  {
    "text": "there's also running segments which may",
    "start": "383430",
    "end": "384810"
  },
  {
    "text": "be the same section of road but are a",
    "start": "384810",
    "end": "386370"
  },
  {
    "text": "different activity type so runners can",
    "start": "386370",
    "end": "388530"
  },
  {
    "text": "be with runners cyclists Kapila cyclist",
    "start": "388530",
    "end": "390060"
  },
  {
    "text": "we currently have millions of segments",
    "start": "390060",
    "end": "391710"
  },
  {
    "text": "around the world and more being created",
    "start": "391710",
    "end": "393060"
  },
  {
    "text": "every day we also have virtual segments",
    "start": "393060",
    "end": "396270"
  },
  {
    "text": "so this is a software park that we we",
    "start": "396270",
    "end": "398190"
  },
  {
    "text": "don't own",
    "start": "398190",
    "end": "399030"
  },
  {
    "text": "a separate company called Swift and they",
    "start": "399030",
    "end": "400800"
  },
  {
    "text": "have virtual ride so you'll see on the",
    "start": "400800",
    "end": "403500"
  },
  {
    "text": "map there's this red line starts on the",
    "start": "403500",
    "end": "404850"
  },
  {
    "text": "ocean and can use up a mountain and",
    "start": "404850",
    "end": "406410"
  },
  {
    "text": "around that's actually there the",
    "start": "406410",
    "end": "408690"
  },
  {
    "text": "activity is mapped to or to a real",
    "start": "408690",
    "end": "410400"
  },
  {
    "text": "portion of Earth but you ride your bike",
    "start": "410400",
    "end": "412470"
  },
  {
    "text": "on a trainer in your apartment attached",
    "start": "412470",
    "end": "414780"
  },
  {
    "text": "to a computer and so this Strickler",
    "start": "414780",
    "end": "416460"
  },
  {
    "text": "segment has like a lot of activities on",
    "start": "416460",
    "end": "419370"
  },
  {
    "text": "it because basically anybody who's",
    "start": "419370",
    "end": "421710"
  },
  {
    "text": "training in the winter for cycling or",
    "start": "421710",
    "end": "423120"
  },
  {
    "text": "who wants to ride at home we write down",
    "start": "423120",
    "end": "425340"
  },
  {
    "text": "a virtual segment this one has a million",
    "start": "425340",
    "end": "428760"
  },
  {
    "text": "attempts in about 167 thousand people",
    "start": "428760",
    "end": "430860"
  },
  {
    "text": "that have a leader board so then",
    "start": "430860",
    "end": "433860"
  },
  {
    "text": "leaderboards when you upload an activity",
    "start": "433860",
    "end": "435840"
  },
  {
    "text": "the Strava with a GPS feed anytime your",
    "start": "435840",
    "end": "439650"
  },
  {
    "text": "activity traverses a segment we call",
    "start": "439650",
    "end": "442020"
  },
  {
    "text": "that a segment effort so for example if",
    "start": "442020",
    "end": "444150"
  },
  {
    "text": "you go to Golden Gate Park and you right",
    "start": "444150",
    "end": "446910"
  },
  {
    "text": "around the polo fields which is a",
    "start": "446910",
    "end": "448500"
  },
  {
    "text": "cycling track that polo field lab has",
    "start": "448500",
    "end": "450840"
  },
  {
    "text": "one one effort one second effort you may",
    "start": "450840",
    "end": "452820"
  },
  {
    "text": "have multiple segment efforts on the",
    "start": "452820",
    "end": "453960"
  },
  {
    "text": "same segment for activity or you may",
    "start": "453960",
    "end": "455430"
  },
  {
    "text": "have one it just depends your fastest",
    "start": "455430",
    "end": "457770"
  },
  {
    "text": "segment effort for you is ranked on a",
    "start": "457770",
    "end": "460650"
  },
  {
    "text": "segment leaderboard so if you did your",
    "start": "460650",
    "end": "462690"
  },
  {
    "text": "climb and your fastest time was 10",
    "start": "462690",
    "end": "464190"
  },
  {
    "text": "minutes even though you may have like a",
    "start": "464190",
    "end": "466410"
  },
  {
    "text": "living that time our 12-minute time we",
    "start": "466410",
    "end": "467790"
  },
  {
    "text": "take your fastest ten-minute time and",
    "start": "467790",
    "end": "469110"
  },
  {
    "text": "that's your ranking on the leaderboard a",
    "start": "469110",
    "end": "471000"
  },
  {
    "text": "couple initial challenges with",
    "start": "471000",
    "end": "473760"
  },
  {
    "text": "leaderboards are complexity and scale so",
    "start": "473760",
    "end": "476430"
  },
  {
    "text": "in terms of the product we offer a lot",
    "start": "476430",
    "end": "479010"
  },
  {
    "text": "of different combinations of",
    "start": "479010",
    "end": "480000"
  },
  {
    "text": "leaderboards so there's 18 static kind",
    "start": "480000",
    "end": "482400"
  },
  {
    "text": "of base leaderboards those are usually",
    "start": "482400",
    "end": "483930"
  },
  {
    "text": "for age groups or weight classes there's",
    "start": "483930",
    "end": "486210"
  },
  {
    "text": "two what we call dynamic leaderboards so",
    "start": "486210",
    "end": "487920"
  },
  {
    "text": "those are things like a leaderboard of",
    "start": "487920",
    "end": "489600"
  },
  {
    "text": "people you're currently following right",
    "start": "489600",
    "end": "491040"
  },
  {
    "text": "now or people there are a member of a",
    "start": "491040",
    "end": "492900"
  },
  {
    "text": "club you can see leaderboards just of",
    "start": "492900",
    "end": "494610"
  },
  {
    "text": "those athletes and then from those 18",
    "start": "494610",
    "end": "497190"
  },
  {
    "text": "base static or dynamic - dynamic",
    "start": "497190",
    "end": "499590"
  },
  {
    "text": "leaderboards we offer sort of eight",
    "start": "499590",
    "end": "502410"
  },
  {
    "text": "combinations of filters or eight filters",
    "start": "502410",
    "end": "504090"
  },
  {
    "text": "rather that are either sort of temporal",
    "start": "504090",
    "end": "506850"
  },
  {
    "text": "so like this month this year or",
    "start": "506850",
    "end": "508670"
  },
  {
    "text": "gender-based so everybody or just just",
    "start": "508670",
    "end": "511470"
  },
  {
    "text": "men are just women what that ends up",
    "start": "511470",
    "end": "513330"
  },
  {
    "text": "being is about 300 different",
    "start": "513330",
    "end": "514620"
  },
  {
    "text": "permutations of leaderboards we do you",
    "start": "514620",
    "end": "517020"
  },
  {
    "text": "normalize so we keep sort of in a",
    "start": "517020",
    "end": "519360"
  },
  {
    "text": "database the 50 most popular D",
    "start": "519360",
    "end": "520890"
  },
  {
    "text": "normalizations and then for everything",
    "start": "520890",
    "end": "522840"
  },
  {
    "text": "else we kind of have to one of two",
    "start": "522840",
    "end": "525270"
  },
  {
    "text": "tactics either query our canonical",
    "start": "525270",
    "end": "527250"
  },
  {
    "text": "effort storage which is in my sequel or",
    "start": "527250",
    "end": "529040"
  },
  {
    "text": "we will scan the entire leaderboard",
    "start": "529040",
    "end": "531840"
  },
  {
    "text": "which is kind of",
    "start": "531840",
    "end": "532690"
  },
  {
    "text": "and then filter as we need to this is",
    "start": "532690",
    "end": "535449"
  },
  {
    "text": "this some numbers for scale we see a lot",
    "start": "535449",
    "end": "537519"
  },
  {
    "text": "of activities a week about 15,000,000",
    "start": "537519",
    "end": "539009"
  },
  {
    "text": "our traffic is very seasonal diurnal and",
    "start": "539009",
    "end": "544000"
  },
  {
    "text": "sort of is spiky so you time period",
    "start": "544000",
    "end": "547420"
  },
  {
    "text": "you'll see like 250 efforts a second it",
    "start": "547420",
    "end": "550480"
  },
  {
    "text": "really fast peak periods like on a",
    "start": "550480",
    "end": "551769"
  },
  {
    "text": "weekend Sunday morning for example will",
    "start": "551769",
    "end": "553300"
  },
  {
    "text": "see like 2500 efforts a second in",
    "start": "553300",
    "end": "556110"
  },
  {
    "text": "engross we do about half a billion",
    "start": "556110",
    "end": "558100"
  },
  {
    "text": "efforts a week which is a lot and then",
    "start": "558100",
    "end": "561189"
  },
  {
    "text": "as large segments kind of like that",
    "start": "561189",
    "end": "563259"
  },
  {
    "text": "Swift when I showed earlier the virtual",
    "start": "563259",
    "end": "564730"
  },
  {
    "text": "ride they have millions of attempts on",
    "start": "564730",
    "end": "567370"
  },
  {
    "text": "them and usually like hundreds of",
    "start": "567370",
    "end": "568779"
  },
  {
    "text": "thousands of athletes so we have pretty",
    "start": "568779",
    "end": "570220"
  },
  {
    "text": "big segments and in terms of reads to",
    "start": "570220",
    "end": "572170"
  },
  {
    "text": "the leaderboard system the pain upon",
    "start": "572170",
    "end": "573250"
  },
  {
    "text": "traffic again is somewhere between one",
    "start": "573250",
    "end": "575170"
  },
  {
    "text": "to five thousand requests a second from",
    "start": "575170",
    "end": "576759"
  },
  {
    "text": "users and then internal systems also use",
    "start": "576759",
    "end": "580300"
  },
  {
    "text": "segment leaderboards to do some other",
    "start": "580300",
    "end": "582160"
  },
  {
    "text": "features those have you know some 182",
    "start": "582160",
    "end": "583990"
  },
  {
    "text": "thousand requests a second so if I",
    "start": "583990",
    "end": "586990"
  },
  {
    "text": "mentioned before is like a highly",
    "start": "586990",
    "end": "587829"
  },
  {
    "text": "variable workload like it's like 10x",
    "start": "587829",
    "end": "589389"
  },
  {
    "text": "difference between low traffic and high",
    "start": "589389",
    "end": "591459"
  },
  {
    "text": "traffic those kind of how segments",
    "start": "591459",
    "end": "593410"
  },
  {
    "text": "leaderboards work we'll talk about a",
    "start": "593410",
    "end": "594699"
  },
  {
    "text": "very short history of the architecture",
    "start": "594699",
    "end": "596139"
  },
  {
    "text": "we've had so Java launched in 2009 and",
    "start": "596139",
    "end": "598540"
  },
  {
    "text": "then we used to do leaderboards back in",
    "start": "598540",
    "end": "600189"
  },
  {
    "text": "2010 right afterwards we added them",
    "start": "600189",
    "end": "602350"
  },
  {
    "text": "primarily done with sequel directly in",
    "start": "602350",
    "end": "604600"
  },
  {
    "text": "our rails application so we had a table",
    "start": "604600",
    "end": "605920"
  },
  {
    "text": "they had all of the efforts I mean we",
    "start": "605920",
    "end": "607689"
  },
  {
    "text": "basically write a sequel query that says",
    "start": "607689",
    "end": "609069"
  },
  {
    "text": "sort them this way with this filter and",
    "start": "609069",
    "end": "611290"
  },
  {
    "text": "will give you a leaderboard back that",
    "start": "611290",
    "end": "613329"
  },
  {
    "text": "worked really well early on but as we",
    "start": "613329",
    "end": "615160"
  },
  {
    "text": "scale the scale really poorly market is",
    "start": "615160",
    "end": "617470"
  },
  {
    "text": "set in groups we have more efforts to",
    "start": "617470",
    "end": "618819"
  },
  {
    "text": "query and then we also wanted to add",
    "start": "618819",
    "end": "620740"
  },
  {
    "text": "more filter leaderboards early on weibo",
    "start": "620740",
    "end": "622630"
  },
  {
    "text": "only did like one leaderboard per",
    "start": "622630",
    "end": "624310"
  },
  {
    "text": "segment we wanted to add more more",
    "start": "624310",
    "end": "625630"
  },
  {
    "text": "filter options so there's some work that",
    "start": "625630",
    "end": "627970"
  },
  {
    "text": "was done that ended in 2012 to actually",
    "start": "627970",
    "end": "629920"
  },
  {
    "text": "launch leaderboards on reticence what",
    "start": "629920",
    "end": "632110"
  },
  {
    "text": "this means is that we still controlled",
    "start": "632110",
    "end": "634930"
  },
  {
    "text": "effort addition or effort create and",
    "start": "634930",
    "end": "637839"
  },
  {
    "text": "delete within the rails application but",
    "start": "637839",
    "end": "639970"
  },
  {
    "text": "we use Redis as the datastore as opposed",
    "start": "639970",
    "end": "641620"
  },
  {
    "text": "to my sequel this worked really well",
    "start": "641620",
    "end": "643269"
  },
  {
    "text": "because the Redis has a sorted set data",
    "start": "643269",
    "end": "644769"
  },
  {
    "text": "structure and leaderboards are a sorted",
    "start": "644769",
    "end": "646839"
  },
  {
    "text": "data structure so ranking queries are",
    "start": "646839",
    "end": "649600"
  },
  {
    "text": "really easy and cheap we are so excited",
    "start": "649600",
    "end": "652209"
  },
  {
    "text": "about it wrote a blog post back in",
    "start": "652209",
    "end": "654550"
  },
  {
    "text": "September you can broke this up if you",
    "start": "654550",
    "end": "656199"
  },
  {
    "text": "want but the main reason I brought this",
    "start": "656199",
    "end": "657970"
  },
  {
    "text": "up is we in that blog post noted that we",
    "start": "657970",
    "end": "660069"
  },
  {
    "text": "were using one Redis server to host all",
    "start": "660069",
    "end": "662110"
  },
  {
    "text": "of our leaderboards and it was under 16",
    "start": "662110",
    "end": "663550"
  },
  {
    "text": "gigs of ram that was in 2012 so fast",
    "start": "663550",
    "end": "665620"
  },
  {
    "text": "forward to 22",
    "start": "665620",
    "end": "666339"
  },
  {
    "text": "teen at that point time had one engineer",
    "start": "666339",
    "end": "668769"
  },
  {
    "text": "working on leaderboards basically",
    "start": "668769",
    "end": "669939"
  },
  {
    "text": "full-time they were either fighting",
    "start": "669939",
    "end": "672370"
  },
  {
    "text": "fires fixing the current system or they",
    "start": "672370",
    "end": "675129"
  },
  {
    "text": "were working on the new kind of next",
    "start": "675129",
    "end": "677410"
  },
  {
    "text": "iteration we no longer had a 16 gigabyte",
    "start": "677410",
    "end": "680439"
  },
  {
    "text": "right it's known we had a 16 node",
    "start": "680439",
    "end": "682269"
  },
  {
    "text": "writers cluster with 1.8 terabytes of",
    "start": "682269",
    "end": "684430"
  },
  {
    "text": "available memory also that cluster was",
    "start": "684430",
    "end": "687189"
  },
  {
    "text": "in fronted not by a rails application",
    "start": "687189",
    "end": "689410"
  },
  {
    "text": "but by a leaderboard service it was",
    "start": "689410",
    "end": "690579"
  },
  {
    "text": "written in Scala and that was running",
    "start": "690579",
    "end": "692649"
  },
  {
    "text": "between weekday weekend's about 40 to 60",
    "start": "692649",
    "end": "694990"
  },
  {
    "text": "easy to notes we added a lot more",
    "start": "694990",
    "end": "696699"
  },
  {
    "text": "leaderboard filters I talked about this",
    "start": "696699",
    "end": "698170"
  },
  {
    "text": "before age and weight and then as we",
    "start": "698170",
    "end": "701860"
  },
  {
    "text": "kind of grew and got more traffic we",
    "start": "701860",
    "end": "702999"
  },
  {
    "text": "started to have many unsustainable",
    "start": "702999",
    "end": "705689"
  },
  {
    "text": "operational problems so the few",
    "start": "705689",
    "end": "708459"
  },
  {
    "text": "highlights from those problems are",
    "start": "708459",
    "end": "709480"
  },
  {
    "text": "basically the concurrency model of the",
    "start": "709480",
    "end": "711189"
  },
  {
    "text": "old system was really hard to kind of",
    "start": "711189",
    "end": "712360"
  },
  {
    "text": "reason about and and debug and diagnose",
    "start": "712360",
    "end": "714660"
  },
  {
    "text": "we saw lots of data inconsistency is",
    "start": "714660",
    "end": "717279"
  },
  {
    "text": "where we'd have like negative",
    "start": "717279",
    "end": "719050"
  },
  {
    "text": "leaderboard counts or people will be",
    "start": "719050",
    "end": "720339"
  },
  {
    "text": "missing things like that a few incidents",
    "start": "720339",
    "end": "723339"
  },
  {
    "text": "were caused by leaderboards of some call",
    "start": "723339",
    "end": "725319"
  },
  {
    "text": "site outages which are bad and then also",
    "start": "725319",
    "end": "727120"
  },
  {
    "text": "some cause upload outages which was",
    "start": "727120",
    "end": "728649"
  },
  {
    "text": "really bad for us so kind of",
    "start": "728649",
    "end": "730600"
  },
  {
    "text": "operationally really challenging in 2016",
    "start": "730600",
    "end": "732999"
  },
  {
    "text": "we decided lost some time diagnosing",
    "start": "732999",
    "end": "734559"
  },
  {
    "text": "these problems and kind of figure out",
    "start": "734559",
    "end": "736689"
  },
  {
    "text": "what to do I spent fry a couple months",
    "start": "736689",
    "end": "739660"
  },
  {
    "text": "looking at the old system understanding",
    "start": "739660",
    "end": "741160"
  },
  {
    "text": "how it worked what we wanted from",
    "start": "741160",
    "end": "742779"
  },
  {
    "text": "leaderboards and kind of identified a",
    "start": "742779",
    "end": "744370"
  },
  {
    "text": "bunch of systemic issues one of them not",
    "start": "744370",
    "end": "746470"
  },
  {
    "text": "not entirely but one of them I kind of",
    "start": "746470",
    "end": "748209"
  },
  {
    "text": "decided we talked about was our use of",
    "start": "748209",
    "end": "749649"
  },
  {
    "text": "Redis and and not the rest is inherently",
    "start": "749649",
    "end": "751420"
  },
  {
    "text": "bad was kind of how we chose to grow and",
    "start": "751420",
    "end": "753459"
  },
  {
    "text": "use it into the constants and problems",
    "start": "753459",
    "end": "754870"
  },
  {
    "text": "one is that race requires your working",
    "start": "754870",
    "end": "756850"
  },
  {
    "text": "set to be in memory so unlike my sequel",
    "start": "756850",
    "end": "759249"
  },
  {
    "text": "or Cassandra other databases where disk",
    "start": "759249",
    "end": "761499"
  },
  {
    "text": "is the primary storage Redis uses memory",
    "start": "761499",
    "end": "763420"
  },
  {
    "text": "which is great cuz it makes it really",
    "start": "763420",
    "end": "764769"
  },
  {
    "text": "really fast",
    "start": "764769",
    "end": "765550"
  },
  {
    "text": "however memory is very very expensive to",
    "start": "765550",
    "end": "768459"
  },
  {
    "text": "scale we were spending like a",
    "start": "768459",
    "end": "772059"
  },
  {
    "text": "non-trivial amount of money hosting",
    "start": "772059",
    "end": "773829"
  },
  {
    "text": "leaderboards and looking at upgrading to",
    "start": "773829",
    "end": "776319"
  },
  {
    "text": "the next level was like a substantial",
    "start": "776319",
    "end": "777670"
  },
  {
    "text": "chunk amount of more money because we",
    "start": "777670",
    "end": "780189"
  },
  {
    "text": "were sort of memory constrained we",
    "start": "780189",
    "end": "781209"
  },
  {
    "text": "actually had a fraction what data to",
    "start": "781209",
    "end": "782709"
  },
  {
    "text": "store so we limited our denormalization",
    "start": "782709",
    "end": "785110"
  },
  {
    "text": "of leaderboards just to two different",
    "start": "785110",
    "end": "787089"
  },
  {
    "text": "kinds the overall and in the female",
    "start": "787089",
    "end": "789040"
  },
  {
    "text": "leaderboard and then all of the data",
    "start": "789040",
    "end": "791470"
  },
  {
    "text": "structure or all other leaderboards were",
    "start": "791470",
    "end": "793029"
  },
  {
    "text": "serviced by one other data structure so",
    "start": "793029",
    "end": "795670"
  },
  {
    "text": "this meant that for a lot of updates to",
    "start": "795670",
    "end": "799149"
  },
  {
    "text": "to leader",
    "start": "799149",
    "end": "800020"
  },
  {
    "text": "or we would have a lot of qalaat of",
    "start": "800020",
    "end": "802750"
  },
  {
    "text": "contention because there'll only be like",
    "start": "802750",
    "end": "804460"
  },
  {
    "text": "a handful of segments for a leaderboard",
    "start": "804460",
    "end": "805899"
  },
  {
    "text": "that we had actually updates a lot",
    "start": "805899",
    "end": "807250"
  },
  {
    "text": "people are finding - right - that data",
    "start": "807250",
    "end": "809230"
  },
  {
    "text": "structure it's also wasteful to keep",
    "start": "809230",
    "end": "811360"
  },
  {
    "text": "everything in memory because while we",
    "start": "811360",
    "end": "813399"
  },
  {
    "text": "have millions of segments and you know",
    "start": "813399",
    "end": "815110"
  },
  {
    "text": "like tens and millions of leaderboards",
    "start": "815110",
    "end": "816490"
  },
  {
    "text": "only a small portion of them are",
    "start": "816490",
    "end": "818170"
  },
  {
    "text": "actually really read from at any one",
    "start": "818170",
    "end": "819550"
  },
  {
    "text": "time so we're paying money to host",
    "start": "819550",
    "end": "821920"
  },
  {
    "text": "leaderboards in memory and no one's",
    "start": "821920",
    "end": "823660"
  },
  {
    "text": "really reading from them so that's kind",
    "start": "823660",
    "end": "825520"
  },
  {
    "text": "of another another thing it was wasteful",
    "start": "825520",
    "end": "826899"
  },
  {
    "text": "in our book the second issue with Redis",
    "start": "826899",
    "end": "828670"
  },
  {
    "text": "sort of its lack of parallelism Redis a",
    "start": "828670",
    "end": "830980"
  },
  {
    "text": "single-threaded what that means is",
    "start": "830980",
    "end": "832300"
  },
  {
    "text": "basically it can only process one",
    "start": "832300",
    "end": "834399"
  },
  {
    "text": "command at a time it's really really",
    "start": "834399",
    "end": "836589"
  },
  {
    "text": "really fast it processing commands but",
    "start": "836589",
    "end": "838510"
  },
  {
    "text": "it's only one of the time this is",
    "start": "838510",
    "end": "840070"
  },
  {
    "text": "somewhat mitigated as we did a few shard",
    "start": "840070",
    "end": "841810"
  },
  {
    "text": "your data set you can have multiple",
    "start": "841810",
    "end": "843279"
  },
  {
    "text": "Redis instances but you're still sort of",
    "start": "843279",
    "end": "846190"
  },
  {
    "text": "limited by this one thread operated on",
    "start": "846190",
    "end": "848680"
  },
  {
    "text": "all commands that are sent that was bad",
    "start": "848680",
    "end": "850899"
  },
  {
    "text": "but additionally we had like a very",
    "start": "850899",
    "end": "851890"
  },
  {
    "text": "command intensive design so we started",
    "start": "851890",
    "end": "854709"
  },
  {
    "text": "by a segment ID which created hotspots",
    "start": "854709",
    "end": "856149"
  },
  {
    "text": "if like for a ride London was talked",
    "start": "856149",
    "end": "858070"
  },
  {
    "text": "about earlier if there's a London",
    "start": "858070",
    "end": "859899"
  },
  {
    "text": "segment through Liebig everyone's trying",
    "start": "859899",
    "end": "861130"
  },
  {
    "text": "to add their upload to it there's a lot",
    "start": "861130",
    "end": "863620"
  },
  {
    "text": "of contention on trying to update that",
    "start": "863620",
    "end": "864850"
  },
  {
    "text": "leaderboard in memory and then because",
    "start": "864850",
    "end": "867550"
  },
  {
    "text": "we were limited in our denormalization",
    "start": "867550",
    "end": "868990"
  },
  {
    "text": "options because of memory constraints we",
    "start": "868990",
    "end": "871740"
  },
  {
    "text": "had a lot of full leaderboard scans to",
    "start": "871740",
    "end": "875080"
  },
  {
    "text": "produce filtered leaderboards and then",
    "start": "875080",
    "end": "877240"
  },
  {
    "text": "the old system used distributed locks",
    "start": "877240",
    "end": "879209"
  },
  {
    "text": "for synchronization which because it was",
    "start": "879209",
    "end": "883120"
  },
  {
    "text": "using lock they had a lot of commands",
    "start": "883120",
    "end": "884350"
  },
  {
    "text": "for asking for a lock waiting for a walk",
    "start": "884350",
    "end": "886000"
  },
  {
    "text": "to be acquired releasing a lock and lock",
    "start": "886000",
    "end": "888250"
  },
  {
    "text": "and a lot of chatter I don't worry about",
    "start": "888250",
    "end": "889860"
  },
  {
    "text": "in the final of Redis issue that we had",
    "start": "889860",
    "end": "892600"
  },
  {
    "text": "it was kind of a very poor op story so",
    "start": "892600",
    "end": "894970"
  },
  {
    "text": "Redis is not easy to recover from a node",
    "start": "894970",
    "end": "897490"
  },
  {
    "text": "failure you can fail over to a replica",
    "start": "897490",
    "end": "900010"
  },
  {
    "text": "that's great but you have to run both a",
    "start": "900010",
    "end": "902050"
  },
  {
    "text": "primary reticent our replicas as standby",
    "start": "902050",
    "end": "904150"
  },
  {
    "text": "and even if you have a replica there's",
    "start": "904150",
    "end": "905800"
  },
  {
    "text": "still some downtime when you promote it",
    "start": "905800",
    "end": "907720"
  },
  {
    "text": "to a primary you can't serve traffic",
    "start": "907720",
    "end": "909250"
  },
  {
    "text": "which is bad in our situation because",
    "start": "909250",
    "end": "910990"
  },
  {
    "text": "we're trying to process leaderboard",
    "start": "910990",
    "end": "912550"
  },
  {
    "text": "writes for uploads and also leaderboard",
    "start": "912550",
    "end": "914230"
  },
  {
    "text": "reads as well and in our case we also",
    "start": "914230",
    "end": "916180"
  },
  {
    "text": "had 60 Redis nodes which is quite a lot",
    "start": "916180",
    "end": "918339"
  },
  {
    "text": "of surface area for failures to occur",
    "start": "918339",
    "end": "921120"
  },
  {
    "text": "additionally the recovery mechanism for",
    "start": "921120",
    "end": "923890"
  },
  {
    "text": "Redis to promote a replica is this thing",
    "start": "923890",
    "end": "925930"
  },
  {
    "text": "called write a sentinel which is not",
    "start": "925930",
    "end": "927910"
  },
  {
    "text": "really proven in production there's a",
    "start": "927910",
    "end": "930490"
  },
  {
    "text": "quote there from a blog post which I",
    "start": "930490",
    "end": "931930"
  },
  {
    "text": "know you can't click on",
    "start": "931930",
    "end": "932800"
  },
  {
    "text": "but if you look up Jepson Redis Redux",
    "start": "932800",
    "end": "935980"
  },
  {
    "text": "you can read it write a sentinel have",
    "start": "935980",
    "end": "938019"
  },
  {
    "text": "some issues with data loss or corruption",
    "start": "938019",
    "end": "941709"
  },
  {
    "text": "when there was sort of significant",
    "start": "941709",
    "end": "943149"
  },
  {
    "text": "errors and so that was a little scary",
    "start": "943149",
    "end": "945040"
  },
  {
    "text": "for us to kind of worry about for",
    "start": "945040",
    "end": "946149"
  },
  {
    "text": "economical storage and then finally",
    "start": "946149",
    "end": "948269"
  },
  {
    "text": "Redis is a little tedious to rebalance",
    "start": "948269",
    "end": "950319"
  },
  {
    "text": "so if let's say you have like a 69",
    "start": "950319",
    "end": "951910"
  },
  {
    "text": "cluster and you want to go to an 80 node",
    "start": "951910",
    "end": "953259"
  },
  {
    "text": "cluster you have to sort of manually",
    "start": "953259",
    "end": "956129"
  },
  {
    "text": "move data around and think about that",
    "start": "956129",
    "end": "958709"
  },
  {
    "text": "there are tools now and Redis to make",
    "start": "958709",
    "end": "961209"
  },
  {
    "text": "that a little bit easier but we were not",
    "start": "961209",
    "end": "963189"
  },
  {
    "text": "using them at the time and instead",
    "start": "963189",
    "end": "964809"
  },
  {
    "text": "there's a lot of manual work that people",
    "start": "964809",
    "end": "967720"
  },
  {
    "text": "had to do to kind of move shards of data",
    "start": "967720",
    "end": "969459"
  },
  {
    "text": "around to kind of rebalance as you",
    "start": "969459",
    "end": "970660"
  },
  {
    "text": "wanted to grow the cluster so we did all",
    "start": "970660",
    "end": "973179"
  },
  {
    "text": "this work analyzing our problem we want",
    "start": "973179",
    "end": "974529"
  },
  {
    "text": "to work on a more scalable solution to",
    "start": "974529",
    "end": "975939"
  },
  {
    "text": "leaderboards and so in late 2017 we",
    "start": "975939",
    "end": "978699"
  },
  {
    "text": "actually shipped it there's a blog post",
    "start": "978699",
    "end": "980230"
  },
  {
    "text": "series about this which I wrote which",
    "start": "980230",
    "end": "981790"
  },
  {
    "text": "you can read it talks about sort of the",
    "start": "981790",
    "end": "983829"
  },
  {
    "text": "new changes to the new system and some",
    "start": "983829",
    "end": "986199"
  },
  {
    "text": "background a lot of things that got",
    "start": "986199",
    "end": "987999"
  },
  {
    "text": "upgraded most of them are outside of the",
    "start": "987999",
    "end": "989769"
  },
  {
    "text": "scope of this talk but the two things to",
    "start": "989769",
    "end": "991269"
  },
  {
    "text": "take away we're that we switch from",
    "start": "991269",
    "end": "992589"
  },
  {
    "text": "Redis to Cassandra for our canonical",
    "start": "992589",
    "end": "995319"
  },
  {
    "text": "leaderboard storage and then we change",
    "start": "995319",
    "end": "997660"
  },
  {
    "text": "the leaderboard service from an RPC",
    "start": "997660",
    "end": "999549"
  },
  {
    "text": "system to a stream processing system",
    "start": "999549",
    "end": "1001259"
  },
  {
    "text": "this is sort of a very rough diagram of",
    "start": "1001259",
    "end": "1003689"
  },
  {
    "text": "the architecture previously all updates",
    "start": "1003689",
    "end": "1005850"
  },
  {
    "text": "to the datastore were done by a rails",
    "start": "1005850",
    "end": "1007139"
  },
  {
    "text": "application making a request on upload",
    "start": "1007139",
    "end": "1009059"
  },
  {
    "text": "and getting a response back instead with",
    "start": "1009059",
    "end": "1011009"
  },
  {
    "text": "the new system what happens is that the",
    "start": "1011009",
    "end": "1012299"
  },
  {
    "text": "rails as rails will log in an event that",
    "start": "1012299",
    "end": "1015360"
  },
  {
    "text": "an upload has occurred and then there's",
    "start": "1015360",
    "end": "1017160"
  },
  {
    "text": "a worker that consumes that at its own",
    "start": "1017160",
    "end": "1018660"
  },
  {
    "text": "pace",
    "start": "1018660",
    "end": "1018980"
  },
  {
    "text": "and then updates leaderboard storage and",
    "start": "1018980",
    "end": "1021509"
  },
  {
    "text": "then later bro storage has been read",
    "start": "1021509",
    "end": "1023459"
  },
  {
    "text": "from on the bottom of this graph to show",
    "start": "1023459",
    "end": "1026038"
  },
  {
    "text": "over API responses come back that said",
    "start": "1026039",
    "end": "1028350"
  },
  {
    "text": "Cassandra is not a panacea so it's great",
    "start": "1028350",
    "end": "1031020"
  },
  {
    "text": "Cassandra is great but it has sort of a",
    "start": "1031020",
    "end": "1032850"
  },
  {
    "text": "limited data model it's really good for",
    "start": "1032850",
    "end": "1034409"
  },
  {
    "text": "returning ordered rows in our case",
    "start": "1034409",
    "end": "1037558"
  },
  {
    "text": "leaderboard entries but for a direct",
    "start": "1037559",
    "end": "1039688"
  },
  {
    "text": "access like give me this rank of this",
    "start": "1039689",
    "end": "1041490"
  },
  {
    "text": "user who is in this leaderboard it's",
    "start": "1041490",
    "end": "1043709"
  },
  {
    "text": "actually kind of expensive and",
    "start": "1043709",
    "end": "1045329"
  },
  {
    "text": "necessitates effectively a full",
    "start": "1045329",
    "end": "1046649"
  },
  {
    "text": "leaderboard scan in testing a new",
    "start": "1046649",
    "end": "1049169"
  },
  {
    "text": "cluster with our traffic we actually had",
    "start": "1049169",
    "end": "1050940"
  },
  {
    "text": "some overwhelming or the cluster was",
    "start": "1050940",
    "end": "1054120"
  },
  {
    "text": "overwhelmed in our tests and so we",
    "start": "1054120",
    "end": "1055789"
  },
  {
    "text": "transferred out what we're gonna do",
    "start": "1055789",
    "end": "1057299"
  },
  {
    "text": "about this problem and when you've use",
    "start": "1057299",
    "end": "1059070"
  },
  {
    "text": "Redis before because it has a sort of",
    "start": "1059070",
    "end": "1060330"
  },
  {
    "text": "set data structure which is very natural",
    "start": "1060330",
    "end": "1062010"
  },
  {
    "text": "to leaderboards maybe we can have that",
    "start": "1062010",
    "end": "1063899"
  },
  {
    "text": "back as a cache",
    "start": "1063899",
    "end": "1066000"
  },
  {
    "text": "and so that's what we did basically is",
    "start": "1066000",
    "end": "1067470"
  },
  {
    "text": "we read use Redis as a cache and so we",
    "start": "1067470",
    "end": "1070920"
  },
  {
    "text": "noticed that with our request pattern",
    "start": "1070920",
    "end": "1072210"
  },
  {
    "text": "only a small portion of leader boards",
    "start": "1072210",
    "end": "1073620"
  },
  {
    "text": "actually read from as I mentioned",
    "start": "1073620",
    "end": "1075030"
  },
  {
    "text": "earlier these leader boards that are",
    "start": "1075030",
    "end": "1076710"
  },
  {
    "text": "read from tend to be the largest leader",
    "start": "1076710",
    "end": "1078510"
  },
  {
    "text": "boards which are also the most expensive",
    "start": "1078510",
    "end": "1079800"
  },
  {
    "text": "ones for Cassandra to serve so if we",
    "start": "1079800",
    "end": "1081900"
  },
  {
    "text": "catch them that would be great and then",
    "start": "1081900",
    "end": "1083750"
  },
  {
    "text": "Redis is then can be used as a thermal",
    "start": "1083750",
    "end": "1086010"
  },
  {
    "text": "cache so it can hold a portion of the",
    "start": "1086010",
    "end": "1087630"
  },
  {
    "text": "full data so that only the most",
    "start": "1087630",
    "end": "1088560"
  },
  {
    "text": "requested leader boards and if we lose",
    "start": "1088560",
    "end": "1090420"
  },
  {
    "text": "their cache no that's actually totally",
    "start": "1090420",
    "end": "1092040"
  },
  {
    "text": "okay because you can read from the",
    "start": "1092040",
    "end": "1095850"
  },
  {
    "text": "origin which from Cassandra if you need",
    "start": "1095850",
    "end": "1097740"
  },
  {
    "text": "to so as I mentioned before right it's a",
    "start": "1097740",
    "end": "1099480"
  },
  {
    "text": "server using arrays of the cache kind of",
    "start": "1099480",
    "end": "1100920"
  },
  {
    "text": "addresses many of our original",
    "start": "1100920",
    "end": "1101730"
  },
  {
    "text": "complaints we're no longer constrained",
    "start": "1101730",
    "end": "1103740"
  },
  {
    "text": "by memory we still have to keep",
    "start": "1103740",
    "end": "1105990"
  },
  {
    "text": "everything in memory but we can create a",
    "start": "1105990",
    "end": "1107550"
  },
  {
    "text": "data structure in memory that's much",
    "start": "1107550",
    "end": "1108690"
  },
  {
    "text": "richer and faster to query from and only",
    "start": "1108690",
    "end": "1111390"
  },
  {
    "text": "keep a portion of leaderboards in that",
    "start": "1111390",
    "end": "1112830"
  },
  {
    "text": "structure so much bigger commands speed",
    "start": "1112830",
    "end": "1115040"
  },
  {
    "text": "doesn't mention good OP story ever",
    "start": "1115040",
    "end": "1117240"
  },
  {
    "text": "notice fails we can replace it with an",
    "start": "1117240",
    "end": "1118560"
  },
  {
    "text": "empty one and it'll get filled back up",
    "start": "1118560",
    "end": "1119820"
  },
  {
    "text": "with cache misses that's totally okay",
    "start": "1119820",
    "end": "1122070"
  },
  {
    "text": "and then you have this option on during",
    "start": "1122070",
    "end": "1123630"
  },
  {
    "text": "a failover to read from Cassandra if",
    "start": "1123630",
    "end": "1124920"
  },
  {
    "text": "you'd like we looked at a bunch of Redis",
    "start": "1124920",
    "end": "1127410"
  },
  {
    "text": "solutions for doing cluster grace and",
    "start": "1127410",
    "end": "1128940"
  },
  {
    "text": "eventually settled on elastic cache from",
    "start": "1128940",
    "end": "1131340"
  },
  {
    "text": "AWS so we run a Redis three dot",
    "start": "1131340",
    "end": "1134580"
  },
  {
    "text": "something cluster and a tab us is great",
    "start": "1134580",
    "end": "1138180"
  },
  {
    "text": "because it handles ops health checking",
    "start": "1138180",
    "end": "1140190"
  },
  {
    "text": "failover we kind of just let it run and",
    "start": "1140190",
    "end": "1142440"
  },
  {
    "text": "it happily you know it doesn't seem so",
    "start": "1142440",
    "end": "1143910"
  },
  {
    "text": "going back to this diagram this is",
    "start": "1143910",
    "end": "1145410"
  },
  {
    "text": "basically what we added so when an",
    "start": "1145410",
    "end": "1147810"
  },
  {
    "text": "update is made to Cassandra say you got",
    "start": "1147810",
    "end": "1149850"
  },
  {
    "text": "a new a new PR on the climb that logs an",
    "start": "1149850",
    "end": "1153210"
  },
  {
    "text": "event that occurred and then there's a",
    "start": "1153210",
    "end": "1155400"
  },
  {
    "text": "worker consuming those events and",
    "start": "1155400",
    "end": "1156720"
  },
  {
    "text": "keeping the cache up-to-date and then",
    "start": "1156720",
    "end": "1158820"
  },
  {
    "text": "those cache responses are then available",
    "start": "1158820",
    "end": "1160950"
  },
  {
    "text": "to our API so it can choose to read from",
    "start": "1160950",
    "end": "1162930"
  },
  {
    "text": "a cache if there's a cache leaderboard",
    "start": "1162930",
    "end": "1164340"
  },
  {
    "text": "available if not it can then read from",
    "start": "1164340",
    "end": "1165780"
  },
  {
    "text": "Cassandra okay I want to talk about",
    "start": "1165780",
    "end": "1167640"
  },
  {
    "text": "updating the cache with changes which is",
    "start": "1167640",
    "end": "1169380"
  },
  {
    "text": "a little bit tricky and also interesting",
    "start": "1169380",
    "end": "1171600"
  },
  {
    "text": "I think if you think about leaderboards",
    "start": "1171600",
    "end": "1173730"
  },
  {
    "text": "as a cached data structure anytime",
    "start": "1173730",
    "end": "1176100"
  },
  {
    "text": "anybody gets a new PR on a segment let's",
    "start": "1176100",
    "end": "1179310"
  },
  {
    "text": "say go for a ride and your climb and you",
    "start": "1179310",
    "end": "1181350"
  },
  {
    "text": "get a new best best time you are were",
    "start": "1181350",
    "end": "1183780"
  },
  {
    "text": "ranked 1666 you're now ranked 500 your",
    "start": "1183780",
    "end": "1188310"
  },
  {
    "text": "row and the cache leader board is now",
    "start": "1188310",
    "end": "1189840"
  },
  {
    "text": "invalid and then the rankings have",
    "start": "1189840",
    "end": "1191550"
  },
  {
    "text": "shifted everybody who you've now",
    "start": "1191550",
    "end": "1192990"
  },
  {
    "text": "outpaced is now at a lower ranking and",
    "start": "1192990",
    "end": "1194760"
  },
  {
    "text": "their ranking is wrong so is near",
    "start": "1194760",
    "end": "1196800"
  },
  {
    "text": "constant invalidation for leaderboards",
    "start": "1196800",
    "end": "1198750"
  },
  {
    "text": "so we",
    "start": "1198750",
    "end": "1199990"
  },
  {
    "text": "you didn't be conscious of how to cash",
    "start": "1199990",
    "end": "1202600"
  },
  {
    "text": "thing or how to update things gonna",
    "start": "1202600",
    "end": "1204040"
  },
  {
    "text": "quickly and effectively with minimal",
    "start": "1204040",
    "end": "1206140"
  },
  {
    "text": "data staleness so the way that cash",
    "start": "1206140",
    "end": "1209050"
  },
  {
    "text": "leaderboards get populated is one of two",
    "start": "1209050",
    "end": "1211570"
  },
  {
    "text": "ways one is that if there's a cache miss",
    "start": "1211570",
    "end": "1213490"
  },
  {
    "text": "from the API there's an asynchronous",
    "start": "1213490",
    "end": "1215440"
  },
  {
    "text": "process that go fetch it the fetches the",
    "start": "1215440",
    "end": "1217060"
  },
  {
    "text": "whole leaderboard and puts it in cash",
    "start": "1217060",
    "end": "1218230"
  },
  {
    "text": "that's a populate and then any time",
    "start": "1218230",
    "end": "1220990"
  },
  {
    "text": "cassandra has a change we then do an",
    "start": "1220990",
    "end": "1224590"
  },
  {
    "text": "update to an equivalent cash flow your",
    "start": "1224590",
    "end": "1226210"
  },
  {
    "text": "board entry I'll talk more about how",
    "start": "1226210",
    "end": "1228040"
  },
  {
    "text": "that update works in a second but we",
    "start": "1228040",
    "end": "1230470"
  },
  {
    "text": "that was sort of the two modes that are",
    "start": "1230470",
    "end": "1232420"
  },
  {
    "text": "the leaderboard updates happen and then",
    "start": "1232420",
    "end": "1233830"
  },
  {
    "text": "we use an LRU which is less recently",
    "start": "1233830",
    "end": "1235780"
  },
  {
    "text": "used eviction strategy for leaderboards",
    "start": "1235780",
    "end": "1237640"
  },
  {
    "text": "to make sure that we only keep most",
    "start": "1237640",
    "end": "1239230"
  },
  {
    "text": "recently read from the most popular",
    "start": "1239230",
    "end": "1240640"
  },
  {
    "text": "leaderboards in cash during these",
    "start": "1240640",
    "end": "1242380"
  },
  {
    "text": "updates were actually writing many",
    "start": "1242380",
    "end": "1244480"
  },
  {
    "text": "separate writers commands and updating",
    "start": "1244480",
    "end": "1246430"
  },
  {
    "text": "many different data structures we do",
    "start": "1246430",
    "end": "1248260"
  },
  {
    "text": "that basically for performance reasons",
    "start": "1248260",
    "end": "1249430"
  },
  {
    "text": "to make sure that we have a way to",
    "start": "1249430",
    "end": "1251710"
  },
  {
    "text": "handle most leaderboard queries",
    "start": "1251710",
    "end": "1253510"
  },
  {
    "text": "effectively and quickly however between",
    "start": "1253510",
    "end": "1255430"
  },
  {
    "text": "those commands if you do a read you can",
    "start": "1255430",
    "end": "1258220"
  },
  {
    "text": "see incorrect data you can see corrupt",
    "start": "1258220",
    "end": "1259720"
  },
  {
    "text": "data or partial data or if we're",
    "start": "1259720",
    "end": "1261670"
  },
  {
    "text": "crashing in the middle of doing a right",
    "start": "1261670",
    "end": "1263560"
  },
  {
    "text": "we could corrupt the data so we really",
    "start": "1263560",
    "end": "1265270"
  },
  {
    "text": "want to run multiple rails commands",
    "start": "1265270",
    "end": "1267040"
  },
  {
    "text": "atomically but thankfully there's a",
    "start": "1267040",
    "end": "1268330"
  },
  {
    "text": "Redis is a solution for this which is to",
    "start": "1268330",
    "end": "1269920"
  },
  {
    "text": "use Louetta so Lua is a weird little",
    "start": "1269920",
    "end": "1272410"
  },
  {
    "text": "scripting language that Redis embeds in",
    "start": "1272410",
    "end": "1275220"
  },
  {
    "text": "itself is an embeddable engine and then",
    "start": "1275220",
    "end": "1278260"
  },
  {
    "text": "you can write Lua scripts and have them",
    "start": "1278260",
    "end": "1279430"
  },
  {
    "text": "run by Redis Retta scripts have access",
    "start": "1279430",
    "end": "1282010"
  },
  {
    "text": "to all the Redis commands you can write",
    "start": "1282010",
    "end": "1283750"
  },
  {
    "text": "them as needed and then they ran Tom",
    "start": "1283750",
    "end": "1285040"
  },
  {
    "text": "ently which is really great good for our",
    "start": "1285040",
    "end": "1286660"
  },
  {
    "text": "use case so we implemented sort of five",
    "start": "1286660",
    "end": "1289960"
  },
  {
    "text": "synthetic commands in Redis to update",
    "start": "1289960",
    "end": "1292150"
  },
  {
    "text": "leaderboards and they sort of managed",
    "start": "1292150",
    "end": "1294070"
  },
  {
    "text": "that for us there you say hey",
    "start": "1294070",
    "end": "1295810"
  },
  {
    "text": "leaderboard ad this athlete with this",
    "start": "1295810",
    "end": "1298780"
  },
  {
    "text": "injury to your leaderboard in it updates",
    "start": "1298780",
    "end": "1300220"
  },
  {
    "text": "the necessary data structures in one go",
    "start": "1300220",
    "end": "1301870"
  },
  {
    "text": "to keep everything to sync and then",
    "start": "1301870",
    "end": "1303610"
  },
  {
    "text": "returns a result when it's done this is",
    "start": "1303610",
    "end": "1305590"
  },
  {
    "text": "a graph of the hit rate to the cache for",
    "start": "1305590",
    "end": "1308710"
  },
  {
    "text": "various leaderboard commands so green",
    "start": "1308710",
    "end": "1310540"
  },
  {
    "text": "means there's a cache hit which I went",
    "start": "1310540",
    "end": "1311890"
  },
  {
    "text": "to Redis and then red means was cache",
    "start": "1311890",
    "end": "1313330"
  },
  {
    "text": "miss which went to Cassandra basically",
    "start": "1313330",
    "end": "1316510"
  },
  {
    "text": "70 75 % of all requests for most",
    "start": "1316510",
    "end": "1319420"
  },
  {
    "text": "leaderboard commands are cached there's",
    "start": "1319420",
    "end": "1321880"
  },
  {
    "text": "one the bottom left one is only about 48",
    "start": "1321880",
    "end": "1324310"
  },
  {
    "text": "35 % that one's not called as often so",
    "start": "1324310",
    "end": "1326860"
  },
  {
    "text": "it's not look much by concern for us and",
    "start": "1326860",
    "end": "1328390"
  },
  {
    "text": "then this graph is a graph of total",
    "start": "1328390",
    "end": "1331990"
  },
  {
    "text": "reads with Redis versus Poisson",
    "start": "1331990",
    "end": "1333720"
  },
  {
    "text": "Cerreta is blue and then cassandra is",
    "start": "1333720",
    "end": "1336750"
  },
  {
    "text": "green so you can see that for any given",
    "start": "1336750",
    "end": "1338820"
  },
  {
    "text": "time period the amount of Redis reads is",
    "start": "1338820",
    "end": "1342840"
  },
  {
    "text": "generally larger the amount of Cassandra",
    "start": "1342840",
    "end": "1344280"
  },
  {
    "text": "reads which shows that our cash is",
    "start": "1344280",
    "end": "1345480"
  },
  {
    "text": "working we're getting more reads to",
    "start": "1345480",
    "end": "1347790"
  },
  {
    "text": "Redis than we are - Cassandra that's a",
    "start": "1347790",
    "end": "1350580"
  },
  {
    "text": "good thing for Cassandra",
    "start": "1350580",
    "end": "1351690"
  },
  {
    "text": "in conclusion so I talked about our",
    "start": "1351690",
    "end": "1353940"
  },
  {
    "text": "historic scaling challenges kind of how",
    "start": "1353940",
    "end": "1356340"
  },
  {
    "text": "Redis was good initially but then kind",
    "start": "1356340",
    "end": "1358290"
  },
  {
    "text": "of as we grew it became a really poor",
    "start": "1358290",
    "end": "1359700"
  },
  {
    "text": "choice for canonical store or like a",
    "start": "1359700",
    "end": "1361890"
  },
  {
    "text": "large growing dataset that needs high",
    "start": "1361890",
    "end": "1364110"
  },
  {
    "text": "availability other data stores like",
    "start": "1364110",
    "end": "1366180"
  },
  {
    "text": "Cassandra and our case can meet those",
    "start": "1366180",
    "end": "1367470"
  },
  {
    "text": "needs well however Redis does have some",
    "start": "1367470",
    "end": "1371190"
  },
  {
    "text": "really great use cases one of them is in",
    "start": "1371190",
    "end": "1372480"
  },
  {
    "text": "the ephemeral cache so so we did we kind",
    "start": "1372480",
    "end": "1374610"
  },
  {
    "text": "of had a very targeted specific use case",
    "start": "1374610",
    "end": "1376830"
  },
  {
    "text": "for Redis and we did we use Redis to do",
    "start": "1376830",
    "end": "1378930"
  },
  {
    "text": "what it does really well and that allows",
    "start": "1378930",
    "end": "1380550"
  },
  {
    "text": "you to with with Redis and then lua",
    "start": "1380550",
    "end": "1382050"
  },
  {
    "text": "scripting you can kind of design optimal",
    "start": "1382050",
    "end": "1383460"
  },
  {
    "text": "data structures the beats your needs",
    "start": "1383460",
    "end": "1385020"
  },
  {
    "text": "reach your use cases really well and",
    "start": "1385020",
    "end": "1387060"
  },
  {
    "text": "provides really good very flexible",
    "start": "1387060",
    "end": "1391040"
  },
  {
    "text": "you",
    "start": "1398600",
    "end": "1400660"
  }
]