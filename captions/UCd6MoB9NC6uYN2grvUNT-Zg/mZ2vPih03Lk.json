[
  {
    "start": "0",
    "end": "20000"
  },
  {
    "text": "hi everyone how's it going",
    "start": "120",
    "end": "4319"
  },
  {
    "text": "wo uh so as you guys settle in uh feel free to add me on Twitter uh in case I",
    "start": "6520",
    "end": "12799"
  },
  {
    "text": "can't get to the questions at the end or if you think of anything after the talk",
    "start": "12799",
    "end": "18160"
  },
  {
    "text": "uh but let's get started so my name is Sean I work at Riot games and I'm on the insights Tech",
    "start": "18160",
    "end": "26080"
  },
  {
    "start": "20000",
    "end": "135000"
  },
  {
    "text": "team which is our big data team and the project I work on is our in-house ETL",
    "start": "26080",
    "end": "32320"
  },
  {
    "text": "tool which is really fun because it can uh touch all the data that comes into",
    "start": "32320",
    "end": "37559"
  },
  {
    "text": "our data warehouse uh but I'm not really going to talk about that too much today uh it plays a little part of the story",
    "start": "37559",
    "end": "45680"
  },
  {
    "text": "but uh before I go on to the next slide uh my roommate told me this morning that",
    "start": "45680",
    "end": "51760"
  },
  {
    "text": "uh I talk in my sleep so specifically he said I was giving this talk in my sleep",
    "start": "51760",
    "end": "60239"
  },
  {
    "text": "so hopefully conscious Shan can give a better talk than unconscious",
    "start": "60239",
    "end": "66200"
  },
  {
    "text": "Shan um you're welcome to my room later tonight if you want to hear that version of the",
    "start": "66200",
    "end": "72080"
  },
  {
    "text": "talk so uh what I'm actually here to talk about today is uh how our data team",
    "start": "72080",
    "end": "79280"
  },
  {
    "text": "moved from our data center into AWS uh we studied a bunch of reasons uh",
    "start": "79280",
    "end": "87360"
  },
  {
    "text": "why we wanted to make that transition and then we came to the decision to pull the trigger and do it but uh we didn't",
    "start": "87360",
    "end": "96320"
  },
  {
    "text": "do it right the first time uh I come here humbly before you to talk about",
    "start": "96320",
    "end": "102280"
  },
  {
    "text": "several mistakes that we made along the way and my hope is while you're watching this talk our pain will help you so that",
    "start": "102280",
    "end": "110759"
  },
  {
    "text": "you can avoid the mistakes that we've made and so that you can take that information when you're moving to",
    "start": "110759",
    "end": "118640"
  },
  {
    "text": "AWS uh finally you know once we were once we got everything working we got a",
    "start": "118640",
    "end": "124799"
  },
  {
    "text": "ton of cool new features that we could translate into features for our players",
    "start": "124799",
    "end": "131480"
  },
  {
    "text": "and other teams within Riot so let's get started uh if you haven't heard of Riot",
    "start": "131480",
    "end": "138440"
  },
  {
    "start": "135000",
    "end": "161000"
  },
  {
    "text": "games before we are the makers of League of Legends and League of Legends is a PC",
    "start": "138440",
    "end": "145680"
  },
  {
    "text": "or Mac game that was launched in 2009 uh it's online so you can play with your",
    "start": "145680",
    "end": "152080"
  },
  {
    "text": "friends or complete strangers and each game stands alone and lasts about 40 to",
    "start": "152080",
    "end": "158280"
  },
  {
    "text": "50 minutes uh in length uh the the game involves uh two teams battling for",
    "start": "158280",
    "end": "165159"
  },
  {
    "text": "control on a map and essentially at the beginning you choose a champion then you",
    "start": "165159",
    "end": "171560"
  },
  {
    "text": "team up with four other people and you try and destroy their base before they",
    "start": "171560",
    "end": "176959"
  },
  {
    "text": "destroy yours and it's very complicated there's a lot of data that transfers back and",
    "start": "176959",
    "end": "182959"
  },
  {
    "text": "forth between the clients and the servers uh like spell casts deaths",
    "start": "182959",
    "end": "188680"
  },
  {
    "text": "purchases things like that and games go on for 50 minutes long so we collect a",
    "start": "188680",
    "end": "194760"
  },
  {
    "text": "lot of data about this game uh the uh essentially in any given",
    "start": "194760",
    "end": "200760"
  },
  {
    "start": "197000",
    "end": "256000"
  },
  {
    "text": "day we'll collect around 12 billion game related events so these are essentially",
    "start": "200760",
    "end": "208040"
  },
  {
    "text": "anytime someone dies any any time you choose a champion or cast a spell or",
    "start": "208040",
    "end": "214680"
  },
  {
    "text": "anything like that and uh in addition to this we also collect a ton of telemetry",
    "start": "214680",
    "end": "220720"
  },
  {
    "text": "data about our servers so uh how can we debug this uh game client over here well",
    "start": "220720",
    "end": "229239"
  },
  {
    "text": "we can collect all of the logs from that and look at it in our data warehouse and",
    "start": "229239",
    "end": "234760"
  },
  {
    "text": "overall this is about translates to about 50 terabytes a day that we ingest",
    "start": "234760",
    "end": "240120"
  },
  {
    "text": "of uncompressed data uh since 2009 this amounts to a total of about 26 pedabytes",
    "start": "240120",
    "end": "247680"
  },
  {
    "text": "of data so you might be asking what do we do with all of this data right so",
    "start": "247680",
    "end": "256079"
  },
  {
    "start": "256000",
    "end": "290000"
  },
  {
    "text": "Riot games aspires to be the most player focused game company in the world but in",
    "start": "256079",
    "end": "261320"
  },
  {
    "text": "order to understand our players how they use the games uh their",
    "start": "261320",
    "end": "267040"
  },
  {
    "text": "desires uh things like that we need to understand uh how they're interacting with the tools and we can do that with",
    "start": "267040",
    "end": "274440"
  },
  {
    "text": "data so the insights Tech team is basically focused on allowing our",
    "start": "274440",
    "end": "280840"
  },
  {
    "text": "decision makers at Riot to make data informed design decisions about our game",
    "start": "280840",
    "end": "286080"
  },
  {
    "text": "using a lot of this data so why did we want to move right",
    "start": "286080",
    "end": "293039"
  },
  {
    "start": "290000",
    "end": "520000"
  },
  {
    "text": "well before we uh get into this directly let's take a look at what are our",
    "start": "293039",
    "end": "300240"
  },
  {
    "text": "ecosystem looked like in around 201122 at that time we were a",
    "start": "300240",
    "end": "307919"
  },
  {
    "text": "international game we were lucky enough that word of mouth spread across the world and uh we had a several data",
    "start": "307919",
    "end": "316479"
  },
  {
    "text": "centers that were piping data into our centralized data warehouse here in the",
    "start": "316479",
    "end": "321919"
  },
  {
    "text": "United States so the red icon is where our data warehouse was and the gray ones",
    "start": "321919",
    "end": "327240"
  },
  {
    "text": "are the different data centers so let's look at one of these data centers right this is very uh a common architecture",
    "start": "327240",
    "end": "334520"
  },
  {
    "text": "for any scalable system that you'll see you'll have uh a a large number of uh",
    "start": "334520",
    "end": "341000"
  },
  {
    "text": "application servers or we call them Game servers because our application is a game and uh players interact with these",
    "start": "341000",
    "end": "348680"
  },
  {
    "text": "Game servers through the client and uh through a series of load balancers and",
    "start": "348680",
    "end": "354880"
  },
  {
    "text": "firewalls and all the data gets stored locally in my SQL databases in that data",
    "start": "354880",
    "end": "361639"
  },
  {
    "text": "center but as our gra game grew we had more people joining and playing on our",
    "start": "361639",
    "end": "368880"
  },
  {
    "text": "servers which means we wanted to ensure that there wasn't lag latency and just a",
    "start": "368880",
    "end": "375120"
  },
  {
    "text": "general good performance for our players so we had to scale out horizontally and",
    "start": "375120",
    "end": "381120"
  },
  {
    "text": "add more game servers so all of these new players were generating a ton of new data",
    "start": "381120",
    "end": "389800"
  },
  {
    "text": "and our infrastructure team was racking servers at break neck Pace right their",
    "start": "389800",
    "end": "397599"
  },
  {
    "text": "hands were full now you take this growth and you amplify it because not only was",
    "start": "397599",
    "end": "403120"
  },
  {
    "text": "each data center growing the players in each location were playing more games",
    "start": "403120",
    "end": "410280"
  },
  {
    "text": "but we were adding new data centers and today League of Legends is played in",
    "start": "410280",
    "end": "415879"
  },
  {
    "text": "every continent except for Antarctica so uh our our infrastructure team was",
    "start": "415879",
    "end": "423720"
  },
  {
    "text": "really busy and so now let's zoom in on what our data center looked like our",
    "start": "423720",
    "end": "428919"
  },
  {
    "text": "data warehouse uh infrastructure looked like so in order to support all of this",
    "start": "428919",
    "end": "435039"
  },
  {
    "text": "data we had a 30 node Hadoop cluster uh running on cladera uh",
    "start": "435039",
    "end": "441520"
  },
  {
    "text": "distribution and it was essentially getting uh all the data was uh injected",
    "start": "441520",
    "end": "448840"
  },
  {
    "text": "using scoop and Uzi so we had these ETL jobs running and pulling from all of the",
    "start": "448840",
    "end": "455160"
  },
  {
    "text": "different MySQL data warehouses or my MySQL databases and putting them into",
    "start": "455160",
    "end": "461479"
  },
  {
    "text": "our Hadoop cluster uh these 30 Hadoop nodes essentially had uh 250 terabyte",
    "start": "461479",
    "end": "470000"
  },
  {
    "text": "capacity and it was getting full right we were drinking data out of a fire hose",
    "start": "470000",
    "end": "477039"
  },
  {
    "text": "and it got to a point where in order to accept more data into this uh 30 Hadoop",
    "start": "477039",
    "end": "484960"
  },
  {
    "text": "cluster we would we actually needed to reduce the replication factor of the",
    "start": "484960",
    "end": "490639"
  },
  {
    "text": "data right so we went from three copies of the data down to two which is like",
    "start": "490639",
    "end": "497280"
  },
  {
    "text": "risky right there's a chance that you are going to lose data uh and when you are forced to make",
    "start": "497280",
    "end": "505280"
  },
  {
    "text": "this decision of potentially losing data in order to take in more data you want",
    "start": "505280",
    "end": "511280"
  },
  {
    "text": "to consider a more scalable system than what you currently have now so one of",
    "start": "511280",
    "end": "518200"
  },
  {
    "text": "the things that's really cool about working at Riot is that we saw that our infrastructure team was overloaded and",
    "start": "518200",
    "end": "524279"
  },
  {
    "start": "520000",
    "end": "552000"
  },
  {
    "text": "we wanted to enable them to continue to have focus on the players and having",
    "start": "524279",
    "end": "531000"
  },
  {
    "text": "good performance directly for them so we wanted to to help offload their work we",
    "start": "531000",
    "end": "538040"
  },
  {
    "text": "wanted to own our own infrastructure and this helped unblocked us and it helped uh support their like focus on creating",
    "start": "538040",
    "end": "548160"
  },
  {
    "text": "new data centers and racking new servers so that was one reason we wanted to move",
    "start": "548160",
    "end": "554279"
  },
  {
    "start": "552000",
    "end": "691000"
  },
  {
    "text": "another reason that we wanted to move was so our primary data warehouse was",
    "start": "554279",
    "end": "559600"
  },
  {
    "text": "queried by the analyst we through Hive and we had a lot of data contention",
    "start": "559600",
    "end": "566440"
  },
  {
    "text": "so we had data analysts we had data scientists we had our ETL tool running",
    "start": "566440",
    "end": "572920"
  },
  {
    "text": "and loading data through that and we had our visualization",
    "start": "572920",
    "end": "578040"
  },
  {
    "text": "tools and at the time we were running High version 08 so this is very old",
    "start": "578040",
    "end": "584560"
  },
  {
    "text": "version this was before yarn uh if you're unfamiliar with yarn that is a uh",
    "start": "584560",
    "end": "591000"
  },
  {
    "text": "sort of Hardware Resource Management tool and so the if if there was a a a",
    "start": "591000",
    "end": "598279"
  },
  {
    "text": "situation where an analyst would take over an entire cluster with an intense",
    "start": "598279",
    "end": "604120"
  },
  {
    "text": "query then the other people would be affected right so an example of this",
    "start": "604120",
    "end": "611720"
  },
  {
    "text": "right as let me tell you a little story is we had uh this young naive young",
    "start": "611720",
    "end": "617880"
  },
  {
    "text": "wonderful analyst who just got hired and he was tasked with finding uh aggregate",
    "start": "617880",
    "end": "625880"
  },
  {
    "text": "creating an aggregate report of all of the store purchases is in our ecosystem so he's not super familiar",
    "start": "625880",
    "end": "633519"
  },
  {
    "text": "with Hive you know he's a statistics wizard he's a Excel wizard he sits down",
    "start": "633519",
    "end": "639040"
  },
  {
    "text": "he's he's like at The Hive console he says I'm just going to get all of the data put it into Excel and then I can",
    "start": "639040",
    "end": "646160"
  },
  {
    "text": "work my magic so he sits down he writes a query select star from",
    "start": "646160",
    "end": "653200"
  },
  {
    "text": "store so all right so from your laughs I can",
    "start": "653200",
    "end": "659000"
  },
  {
    "text": "tell that you know the ramification of this right this query is going",
    "start": "659000",
    "end": "664240"
  },
  {
    "text": "over several years of data several regions and it's just dominating this uh",
    "start": "664240",
    "end": "670560"
  },
  {
    "text": "this cluster and at the time if if that query is taking over the cluster our ETL",
    "start": "670560",
    "end": "676279"
  },
  {
    "text": "jobs can't pull in new data right they don't have the resources so resource",
    "start": "676279",
    "end": "681680"
  },
  {
    "text": "contention was a serious issue we're having and we couldn't just create new clusters because we were blocked by our",
    "start": "681680",
    "end": "688480"
  },
  {
    "text": "infrastructure team so this is what um the this is",
    "start": "688480",
    "end": "694360"
  },
  {
    "start": "691000",
    "end": "750000"
  },
  {
    "text": "essentially how things looked we were pulling things into hdfs from the different data centers and what I really",
    "start": "694360",
    "end": "701040"
  },
  {
    "text": "want to point out here uh that this will take account later in the story is that",
    "start": "701040",
    "end": "706760"
  },
  {
    "text": "we were pulling data in through like individual columns so what I mean by",
    "start": "706760",
    "end": "712519"
  },
  {
    "text": "that is we creating a data Lake such that there is a onetoone column uh EX",
    "start": "712519",
    "end": "719600"
  },
  {
    "text": "existence I guess between the source tables and the destination tables now what happened after this is",
    "start": "719600",
    "end": "728040"
  },
  {
    "text": "right we have our full data center and someone had the genius idea hey why",
    "start": "728040",
    "end": "733639"
  },
  {
    "text": "don't we collect even more data and this is where we started collecting the Telemetry data from the servers so error",
    "start": "733639",
    "end": "739920"
  },
  {
    "text": "logs and things like that but at that point we had the foresight we knew it wouldn't fit into this cluster so we",
    "start": "739920",
    "end": "746480"
  },
  {
    "text": "already put that into Amazon S3 so all of the server Telemetry we built",
    "start": "746480",
    "end": "752399"
  },
  {
    "start": "750000",
    "end": "780000"
  },
  {
    "text": "this tool to ingest all of the server Telemetry from all uh several different applications across our Enterprise and",
    "start": "752399",
    "end": "760040"
  },
  {
    "text": "that was getting stored in S3 but what I what you might notice is",
    "start": "760040",
    "end": "765839"
  },
  {
    "text": "that the format of the data is completely different from how the",
    "start": "765839",
    "end": "771040"
  },
  {
    "text": "transactional data is stored so for the server Telemetry we actually decided to",
    "start": "771040",
    "end": "777199"
  },
  {
    "text": "store it in a map col colum so let me take a quick aside from the story of how",
    "start": "777199",
    "end": "783480"
  },
  {
    "start": "780000",
    "end": "842000"
  },
  {
    "text": "we got to the cloud to talk about the map column type so the map column type",
    "start": "783480",
    "end": "790519"
  },
  {
    "text": "allows you to have keys and values in a single column in Hive and the problem",
    "start": "790519",
    "end": "796079"
  },
  {
    "text": "with this is that it slows performance down because Hive can't build indexes on that as well as it could on an",
    "start": "796079",
    "end": "802519"
  },
  {
    "text": "individual column but the advantage is that when you have a map structure if",
    "start": "802519",
    "end": "808839"
  },
  {
    "text": "you add a new column to a source table all you have to do is add a new key and a value in that record right and this",
    "start": "808839",
    "end": "816440"
  },
  {
    "text": "has been super valuable for us because we have a lot of Upstream changes so if",
    "start": "816440",
    "end": "822800"
  },
  {
    "text": "you have 15 different environments and you have new Champions coming out and",
    "start": "822800",
    "end": "827880"
  },
  {
    "text": "new game modes and things like that then just modifying your data warehouse and",
    "start": "827880",
    "end": "835800"
  },
  {
    "text": "adding columns is a job in itself so we found a lot of in this so what our Target goal was was to move this data to",
    "start": "835800",
    "end": "844880"
  },
  {
    "start": "842000",
    "end": "869000"
  },
  {
    "text": "the same location so we could join it right half of our data was in our data",
    "start": "844880",
    "end": "850880"
  },
  {
    "text": "center in hdfs and the other half was in the cloud in S3 and if you wanted to run",
    "start": "850880",
    "end": "857600"
  },
  {
    "text": "a query like how does latency affect the win rates of our players that wasn't",
    "start": "857600",
    "end": "865519"
  },
  {
    "text": "really something that was easily done so we wanted to move toward an architecture that was much more similar",
    "start": "865519",
    "end": "871880"
  },
  {
    "start": "869000",
    "end": "882000"
  },
  {
    "text": "to this right uh you'll notice that the transactional data is now converted to the map",
    "start": "871880",
    "end": "878120"
  },
  {
    "text": "format and everything is stored in the same place so we came up with this project",
    "start": "878120",
    "end": "886079"
  },
  {
    "start": "882000",
    "end": "953000"
  },
  {
    "text": "plan we're going to move everything over to the cloud so that it all works great",
    "start": "886079",
    "end": "892440"
  },
  {
    "text": "but as you can probably assume from this title and what I said before it didn't go",
    "start": "892440",
    "end": "897759"
  },
  {
    "text": "perfectly so so let me talk about the first attempt and actually I have a question for you so here's here's what",
    "start": "897759",
    "end": "905560"
  },
  {
    "text": "our project entailed right we wanted to First create a new uh EMR cluster that",
    "start": "905560",
    "end": "913360"
  },
  {
    "text": "can handle the etls from uh all of our transactional data in the data",
    "start": "913360",
    "end": "920720"
  },
  {
    "text": "centers uh we wanted to create a new cluster for all of our user accounts so",
    "start": "920720",
    "end": "927120"
  },
  {
    "text": "that the ETL job and the user queries didn't conflict with each other um and we also had the Telemetry",
    "start": "927120",
    "end": "934839"
  },
  {
    "text": "EMR uh cluster that was already there right like I mentioned that was already in S3 so we can use the metast store",
    "start": "934839",
    "end": "942839"
  },
  {
    "text": "that already exists for the Telemetry store and just point the new uh data to",
    "start": "942839",
    "end": "949720"
  },
  {
    "text": "use that metastore so uh underneath of that right",
    "start": "949720",
    "end": "955880"
  },
  {
    "start": "953000",
    "end": "1025000"
  },
  {
    "text": "we have a standard Hive uh structure where we have different databases or schemas and underneath of those are",
    "start": "955880",
    "end": "962440"
  },
  {
    "text": "tables with uh different partitions a majority of our tables are partitioned",
    "start": "962440",
    "end": "967800"
  },
  {
    "text": "by uh what environment they're coming from So Korea or Na and then some date",
    "start": "967800",
    "end": "973720"
  },
  {
    "text": "partition right uh the the date partition varies in size depending on",
    "start": "973720",
    "end": "979040"
  },
  {
    "text": "how big the table is so uh underneath of this uh Hive is storing all of the",
    "start": "979040",
    "end": "986160"
  },
  {
    "text": "actual data files into hdfs in a a very similar structure of nested folders so",
    "start": "986160",
    "end": "992319"
  },
  {
    "text": "you had the parent uh schema folder the parent table folder and then so forth",
    "start": "992319",
    "end": "998440"
  },
  {
    "text": "and so on until you get to the uh data files themselves and what we wanted to migrate",
    "start": "998440",
    "end": "1004480"
  },
  {
    "text": "this to is S3 right so we're going to keep the very similar nested directory",
    "start": "1004480",
    "end": "1010279"
  },
  {
    "text": "structure but we're going to store it in an S3 bucket instead of hdfs and so you",
    "start": "1010279",
    "end": "1015440"
  },
  {
    "text": "see the gray part down there at the bottom is all the Telemetry data which is already there and that's why it's",
    "start": "1015440",
    "end": "1020800"
  },
  {
    "text": "great out because we don't care about it it's already good uh so uh I want to ask you guys a",
    "start": "1020800",
    "end": "1027199"
  },
  {
    "start": "1025000",
    "end": "1096000"
  },
  {
    "text": "question if you were the project manager for this task given the fact that you're",
    "start": "1027199",
    "end": "1032640"
  },
  {
    "text": "moving about 60 terabytes of data right you're creating two EMR clusters and",
    "start": "1032640",
    "end": "1038760"
  },
  {
    "text": "then you're converting some of the data to this new map format how much time would you allocate for this project",
    "start": "1038760",
    "end": "1046880"
  },
  {
    "text": "right 6 months 6 months to year or a",
    "start": "1046880",
    "end": "1051919"
  },
  {
    "text": "year uh teams like 18 people maybe 10 to",
    "start": "1051919",
    "end": "1057200"
  },
  {
    "text": "18 people growing six months so we we thought it",
    "start": "1057200",
    "end": "1064880"
  },
  {
    "text": "would take less than six six months right all we're doing is copying a bunch of files to another location uh but it",
    "start": "1064880",
    "end": "1072080"
  },
  {
    "text": "actually ended up taking us over a year uh because of some mistakes that we made",
    "start": "1072080",
    "end": "1078600"
  },
  {
    "text": "so so hopefully you can learn from those mistakes but uh during that time we were also working on other projects as well",
    "start": "1078600",
    "end": "1085120"
  },
  {
    "text": "so it wasn't like we were just doing this we had you know emergent tickets from our analysts we had uh this concept",
    "start": "1085120",
    "end": "1092679"
  },
  {
    "text": "of playing around with a new real time system and things like that but the reason that we thought we could do it in",
    "start": "1092679",
    "end": "1098960"
  },
  {
    "start": "1096000",
    "end": "1124000"
  },
  {
    "text": "less than six months was because we are gung-ho about Hive and we're like Hive",
    "start": "1098960",
    "end": "1104880"
  },
  {
    "text": "is this awesome tool right you can point tables at different storage Loc locations so all we really need to do is",
    "start": "1104880",
    "end": "1111880"
  },
  {
    "text": "point a table at the new S3 storage location and then write all of the TA",
    "start": "1111880",
    "end": "1117760"
  },
  {
    "text": "data from that Source table into that new table and it will just do everything magically underneath it there and so",
    "start": "1117760",
    "end": "1124240"
  },
  {
    "start": "1124000",
    "end": "1203000"
  },
  {
    "text": "that was what our first project was right um the first thing we did right we",
    "start": "1124240",
    "end": "1129360"
  },
  {
    "text": "wanted to find a cutof date so uh the we have the etls pointed at",
    "start": "1129360",
    "end": "1137520"
  },
  {
    "text": "both the source and the destination um data warehouses so that new data is",
    "start": "1137520",
    "end": "1142559"
  },
  {
    "text": "coming in and then at that cut off point we're going to backload everything before there and we're going to assume",
    "start": "1142559",
    "end": "1149760"
  },
  {
    "text": "that those etls are loading data correctly once we have that date we'll copy all of the files before that cut",
    "start": "1149760",
    "end": "1156559"
  },
  {
    "text": "off day and move it to S3 and then we're going to do the map conversion right so",
    "start": "1156559",
    "end": "1162520"
  },
  {
    "text": "this is where we use Hive and we say let's make a temporary table we're going to convert everything to the map format",
    "start": "1162520",
    "end": "1169880"
  },
  {
    "text": "and then we're going to once it's in the map format copy it and put it back in",
    "start": "1169880",
    "end": "1175039"
  },
  {
    "text": "production uh the one thing I want to call out here is that uh this cutover date is really really useful to have",
    "start": "1175039",
    "end": "1181520"
  },
  {
    "text": "right because when you uh have your etls loading in both locations if something",
    "start": "1181520",
    "end": "1188000"
  },
  {
    "text": "goes wrong in your migration you can always tell your users to go back to the",
    "start": "1188000",
    "end": "1193080"
  },
  {
    "text": "original Source right it's not like you're moving all the new data over to this location so if something goes wrong",
    "start": "1193080",
    "end": "1199880"
  },
  {
    "text": "they still have upto-date data that they can fall back on so here's a wall of text right of",
    "start": "1199880",
    "end": "1206840"
  },
  {
    "start": "1203000",
    "end": "1251000"
  },
  {
    "text": "what our scripts look like and I had to do a little bit of code archaeology to get this code uh because this was",
    "start": "1206840",
    "end": "1213760"
  },
  {
    "text": "checked in around 2011 in GitHub so had to dig deep but uh really the first line",
    "start": "1213760",
    "end": "1220960"
  },
  {
    "text": "is just using the disc CP um tool that comes with dup to copy the files to S3",
    "start": "1220960",
    "end": "1227159"
  },
  {
    "text": "and notice that we're storing the out put into a log uh then we uh create this",
    "start": "1227159",
    "end": "1233080"
  },
  {
    "text": "new temporary table and we copy all of the data over from the production table",
    "start": "1233080",
    "end": "1239760"
  },
  {
    "text": "but we cast the the data into this map format and then finally once all of the",
    "start": "1239760",
    "end": "1246440"
  },
  {
    "text": "data is converted to the map format we move it back to production great so we got this script but we have",
    "start": "1246440",
    "end": "1255240"
  },
  {
    "start": "1251000",
    "end": "1301000"
  },
  {
    "text": "70 tables and 15 regions to move so instead of of customizing each table and",
    "start": "1255240",
    "end": "1261200"
  },
  {
    "text": "each environment and rewriting this we created a python script to automatically generate it then we put those scripts on",
    "start": "1261200",
    "end": "1269320"
  },
  {
    "text": "several different boxes and we ran it in parallel uh after a week or so we logged",
    "start": "1269320",
    "end": "1275360"
  },
  {
    "text": "in we scanned our our our log files didn't see any errors everything was",
    "start": "1275360",
    "end": "1280679"
  },
  {
    "text": "great right we're done talk is over thank you very much uh except for it wasn't right so",
    "start": "1280679",
    "end": "1289080"
  },
  {
    "text": "uh we we told our customers here you go here's the new Cloud structure you can",
    "start": "1289080",
    "end": "1294400"
  },
  {
    "text": "join your data you can do all this cool new stuff and uh what happened was uh",
    "start": "1294400",
    "end": "1303000"
  },
  {
    "start": "1301000",
    "end": "1324000"
  },
  {
    "text": "not as desirable so we had missing partitions we had corrupted partitions and when the",
    "start": "1303000",
    "end": "1311200"
  },
  {
    "text": "analysts finally got their hands on the cloud Hive they were waiting really long",
    "start": "1311200",
    "end": "1318080"
  },
  {
    "text": "time to run their queries so this is",
    "start": "1318080",
    "end": "1324120"
  },
  {
    "text": "disheartening and but one of the cool things about Ry is uh we're forgiving of",
    "start": "1324120",
    "end": "1329240"
  },
  {
    "text": "our mistakes and we rebooted we retroed and we tried to learn things so we could",
    "start": "1329240",
    "end": "1335520"
  },
  {
    "text": "move forward and serve our analysts better so uh what we did like out of our",
    "start": "1335520",
    "end": "1341919"
  },
  {
    "text": "first attempt was the disc CP tool it was very quick very easy to use um but what we didn't like was when",
    "start": "1341919",
    "end": "1350720"
  },
  {
    "text": "we were using Hive 08 to convert things to the map format so uh what we",
    "start": "1350720",
    "end": "1358320"
  },
  {
    "text": "discovered was there were several bugs specifically with this version of Hive that are J tickets that you can go look",
    "start": "1358320",
    "end": "1365200"
  },
  {
    "text": "up if you you're really curious uh with the insert overwrite command where uh",
    "start": "1365200",
    "end": "1371080"
  },
  {
    "text": "you would potentially get duplicates and uh potentially get partial loads and it",
    "start": "1371080",
    "end": "1376240"
  },
  {
    "text": "would fail silently uh so from that whole experience we also learned that we need to make sure that",
    "start": "1376240",
    "end": "1383520"
  },
  {
    "text": "every file gets copied and converted exactly and we need to audit after that",
    "start": "1383520",
    "end": "1389240"
  },
  {
    "text": "whole process is done and this was a big missing thing in our first product Pro first approach right so if you're",
    "start": "1389240",
    "end": "1396880"
  },
  {
    "text": "thinking about moving consider auditing as part of your",
    "start": "1396880",
    "end": "1402159"
  },
  {
    "text": "plan um don't underestimate simple problems and Big Data uh so we thought",
    "start": "1402159",
    "end": "1408279"
  },
  {
    "text": "this would be six weeks uh this is really targeted for the project managers out there uh even though you're moving",
    "start": "1408279",
    "end": "1415400"
  },
  {
    "text": "files moving 1.4 files can add significant complexity so anything at",
    "start": "1415400",
    "end": "1420600"
  },
  {
    "text": "scale can be more complex than what you would expect um part of the reason that our",
    "start": "1420600",
    "end": "1427120"
  },
  {
    "text": "analysts were struggling with performance is because we didn't allocate enough time to do performance",
    "start": "1427120",
    "end": "1432760"
  },
  {
    "text": "tuning in our AWS infrastructure so there are a lot of different variables that go into creating an Optimal",
    "start": "1432760",
    "end": "1439840"
  },
  {
    "text": "Performance for these queries such as uh your hive configuration for memory usage",
    "start": "1439840",
    "end": "1445360"
  },
  {
    "text": "and your instances the instance size themselves networking and security",
    "start": "1445360",
    "end": "1450559"
  },
  {
    "text": "configuration and things like that and we didn't really do that we just click the start EMR",
    "start": "1450559",
    "end": "1458799"
  },
  {
    "text": "button um and finally like lost trust is hard to gain so after we delivered this",
    "start": "1460320",
    "end": "1466559"
  },
  {
    "text": "to our analysts they didn't want to touch or look at Cloud hiive for the",
    "start": "1466559",
    "end": "1471600"
  },
  {
    "text": "next year and a half until we could provide them solid evidence that we had matched the everything and fixed fixed",
    "start": "1471600",
    "end": "1479159"
  },
  {
    "text": "all the problems all right so back to our problem right we have this data",
    "start": "1479159",
    "end": "1485159"
  },
  {
    "start": "1481000",
    "end": "1497000"
  },
  {
    "text": "warehouse now it's in the cloud but it has holes all over it's like swiss cheese so if you were in our position",
    "start": "1485159",
    "end": "1493159"
  },
  {
    "text": "what would your approach be to resolving this situation right would you fix the",
    "start": "1493159",
    "end": "1499039"
  },
  {
    "text": "holes and keep the good data or would you just wipe everything out and start from",
    "start": "1499039",
    "end": "1506240"
  },
  {
    "text": "scratch so we even though we were frustrated wanted to move to the woods",
    "start": "1506440",
    "end": "1512679"
  },
  {
    "text": "and give up we uh decided to fix the holes right we have a good set amount of",
    "start": "1512679",
    "end": "1518840"
  },
  {
    "text": "good of data in there let's just go through find the bad data and fix",
    "start": "1518840",
    "end": "1524720"
  },
  {
    "text": "it so that brings us to our second attempt but this this time we took it more seriously like a real",
    "start": "1524720",
    "end": "1531960"
  },
  {
    "start": "1525000",
    "end": "1601000"
  },
  {
    "text": "project so we thought about it and we did some analysis to try and figure out how long things would take and what we",
    "start": "1531960",
    "end": "1539720"
  },
  {
    "text": "our approach to solving these bad uh partitions was to leverage our ETL tool",
    "start": "1539720",
    "end": "1546200"
  },
  {
    "text": "so the ETL tool is pretty cool because uh it can you can write one uh ETL task",
    "start": "1546200",
    "end": "1552840"
  },
  {
    "text": "that can pull across all 15 different environments and 15 different tables and",
    "start": "1552840",
    "end": "1558000"
  },
  {
    "text": "com Bine it into one location it's also cool because it's item potent and so if",
    "start": "1558000",
    "end": "1564520"
  },
  {
    "text": "there's ever a situation where the ETL is running twice on the same data it",
    "start": "1564520",
    "end": "1569919"
  },
  {
    "text": "will ensure that you don't have duplication so we felt this would be a safer approach to solving all these gaps",
    "start": "1569919",
    "end": "1578240"
  },
  {
    "text": "so what we wanted to do is we wanted to go through and compare the row counts in Iron Hive uh our data center iron uh our",
    "start": "1578240",
    "end": "1586640"
  },
  {
    "text": "data center version of of Hive and uh compare the row Counts from that with the row counts in Cloud hiive anytime",
    "start": "1586640",
    "end": "1595360"
  },
  {
    "text": "they didn't match then we needed to load that data so this is sort of what that looked",
    "start": "1595360",
    "end": "1602720"
  },
  {
    "start": "1601000",
    "end": "1653000"
  },
  {
    "text": "like we pulled all of the row counts and stored them into a database for our personal analysis you just run queries",
    "start": "1602720",
    "end": "1609600"
  },
  {
    "text": "to figure out what what partitions were bad and what we found was that we had a lot of bad partitions so this is just",
    "start": "1609600",
    "end": "1617919"
  },
  {
    "text": "data from 2013 forward from January but uh since January 2013 forward we had a",
    "start": "1617919",
    "end": "1624360"
  },
  {
    "text": "total of 40,000 bad partitions and uh so we we decided okay",
    "start": "1624360",
    "end": "1631919"
  },
  {
    "text": "how long is this project going to take to complete right well using the ETL tool it takes 10 seconds to fix",
    "start": "1631919",
    "end": "1638520"
  },
  {
    "text": "duplicate uh partitions it takes 10 minutes to fix partitions where there's missing data and so uh calculating the",
    "start": "1638520",
    "end": "1647399"
  },
  {
    "text": "number of partition and the time it takes to run each one how long is this project going to",
    "start": "1647399",
    "end": "1653279"
  },
  {
    "start": "1653000",
    "end": "1726000"
  },
  {
    "text": "take the problem was that just figuring out what was broken took a long time",
    "start": "1653279",
    "end": "1660200"
  },
  {
    "text": "right we had hia it was very very immature and we didn't have statistics enabled on our tables which means that",
    "start": "1660200",
    "end": "1668200"
  },
  {
    "text": "every time you want to do select count star to get the row counts for your partition it actually has to run a map",
    "start": "1668200",
    "end": "1674880"
  },
  {
    "text": "reduce job it can't just pull that data from The Meta store so uh finding the bad partitions is very",
    "start": "1674880",
    "end": "1682399"
  },
  {
    "text": "expensive but once we found them all right we figured that the amount of time",
    "start": "1682399",
    "end": "1688360"
  },
  {
    "text": "it would take to repair 40,000 uh bad partitions would be about",
    "start": "1688360",
    "end": "1694320"
  },
  {
    "text": "266 days of consecutive compute time uh",
    "start": "1694320",
    "end": "1699440"
  },
  {
    "text": "for all time since 2009 787 days now uh",
    "start": "1699440",
    "end": "1705080"
  },
  {
    "text": "you can imagine the face that our manager made when we saw when he saw",
    "start": "1705080",
    "end": "1710159"
  },
  {
    "text": "these numbers right this is not gonna happen right we're gonna pull in new",
    "start": "1710159",
    "end": "1717039"
  },
  {
    "text": "data before all of this is done so plan B is the worst right we had to regroup",
    "start": "1717039",
    "end": "1723960"
  },
  {
    "text": "and figure out another solution so we did we retroed again um",
    "start": "1723960",
    "end": "1730960"
  },
  {
    "start": "1726000",
    "end": "1855000"
  },
  {
    "text": "and we we did find Value in like honestly calculating how long any type",
    "start": "1730960",
    "end": "1737559"
  },
  {
    "text": "of Migra like this would move and this is important information that you need when you're making this decision to to",
    "start": "1737559",
    "end": "1744960"
  },
  {
    "text": "allocate resources and things like that um and extrapolation seemed to be a a",
    "start": "1744960",
    "end": "1750519"
  },
  {
    "text": "good rough estimate of doing this um but",
    "start": "1750519",
    "end": "1756080"
  },
  {
    "text": "uh as you can imagine by now uh really repairing in in certain situations is",
    "start": "1756080",
    "end": "1762159"
  },
  {
    "text": "going to be a lot slower than actually wiping things out and starting again and so in our third try right we wiped",
    "start": "1762159",
    "end": "1768640"
  },
  {
    "text": "things out and started again because we learned that it it's much",
    "start": "1768640",
    "end": "1774039"
  },
  {
    "text": "faster so but I mean this is a decision that you will have to make hopefully",
    "start": "1774039",
    "end": "1779799"
  },
  {
    "text": "when you copy your data you won't have any errors at all and if you do it'll be one partition and you probably don't",
    "start": "1779799",
    "end": "1786480"
  },
  {
    "text": "want to start from scratch in that situation uh turn row count statistics",
    "start": "1786480",
    "end": "1791519"
  },
  {
    "text": "on hive uh if you don't have them on already this is just Standard General nice thing to have",
    "start": "1791519",
    "end": "1798679"
  },
  {
    "text": "uh don't assume your data warehouse is 100% accurate so while we were going",
    "start": "1798679",
    "end": "1804840"
  },
  {
    "text": "through and doing the comparison of our data center um our data center row",
    "start": "1804840",
    "end": "1810600"
  },
  {
    "text": "counts and our Cloud Hive row counts we actually found some situations where our data center etls were breaking so uh",
    "start": "1810600",
    "end": "1818279"
  },
  {
    "text": "that figuring out and debugging that was also another time sync for our team when",
    "start": "1818279",
    "end": "1823720"
  },
  {
    "text": "we were going through there um so in order to solve that",
    "start": "1823720",
    "end": "1830399"
  },
  {
    "text": "problem right uh make sure that your team has some sort of auditing solution",
    "start": "1830399",
    "end": "1836080"
  },
  {
    "text": "you want to be able to compare the source data so the actual tables from",
    "start": "1836080",
    "end": "1842440"
  },
  {
    "text": "the data centers around the world or whatever your ecosystem is those Source",
    "start": "1842440",
    "end": "1847640"
  },
  {
    "text": "tables you want to be able to compare the row counts of uh that and what's in",
    "start": "1847640",
    "end": "1852799"
  },
  {
    "text": "your data warehouse okay so finally third attempt",
    "start": "1852799",
    "end": "1858279"
  },
  {
    "text": "right we're getting there we're we're we're making mistakes left and right but each time we're stronger we're gaining",
    "start": "1858279",
    "end": "1864600"
  },
  {
    "text": "knowledge so we started from scratch right and we knew that the disc CP tool",
    "start": "1864600",
    "end": "1871159"
  },
  {
    "text": "was solid from our first try so we go back to using that but what's missing is",
    "start": "1871159",
    "end": "1877360"
  },
  {
    "text": "this auditing feature so we wanted to customize the disp tool a little bit to",
    "start": "1877360",
    "end": "1883639"
  },
  {
    "text": "make sure that everything that gets copied is done correctly",
    "start": "1883639",
    "end": "1889720"
  },
  {
    "text": "so uh that's actually what we did we we modified some of the code in the DCP uh",
    "start": "1889720",
    "end": "1895760"
  },
  {
    "text": "uh jars and we changed it so it would be a data driven tool so it recursively",
    "start": "1895760",
    "end": "1902080"
  },
  {
    "text": "listed all of the files in our hdfs uh Data Center and it saved them into a",
    "start": "1902080",
    "end": "1909240"
  },
  {
    "text": "database so once once they're in that database we can use it for auditing tracking and retrying if something fails",
    "start": "1909240",
    "end": "1917960"
  },
  {
    "text": "so whato so what that table looked like was",
    "start": "1917960",
    "end": "1924880"
  },
  {
    "text": "um on your far left you have a application ID which uh links to the map",
    "start": "1924880",
    "end": "1930720"
  },
  {
    "text": "ruce job that you're running to copy the data you have uh your Source location of",
    "start": "1930720",
    "end": "1936120"
  },
  {
    "text": "the file you have your Target location of the file uh source file size Target",
    "start": "1936120",
    "end": "1941399"
  },
  {
    "text": "file size Source check sum Target check sum and then the statuses of where each",
    "start": "1941399",
    "end": "1947320"
  },
  {
    "text": "file is in the process of getting moved to uh the",
    "start": "1947320",
    "end": "1952760"
  },
  {
    "text": "cloud so what we did was we we had our database table full of all of the files",
    "start": "1952760",
    "end": "1959639"
  },
  {
    "text": "and we just Loop through them we copy them from uh hdfs to S3 and then we",
    "start": "1959639",
    "end": "1965320"
  },
  {
    "text": "check the file size match and that the check sums match after they've been copied if something goes wrong then we",
    "start": "1965320",
    "end": "1973240"
  },
  {
    "text": "store that uh there's a failure status in the table if something goes right",
    "start": "1973240",
    "end": "1978600"
  },
  {
    "text": "then it continues on to the next row and moves that file so uh the right all the failed",
    "start": "1978600",
    "end": "1988320"
  },
  {
    "text": "files after that can just be rerun until you get things working um and then",
    "start": "1988320",
    "end": "1993960"
  },
  {
    "text": "you're good to go so that's this is an example of the same t uh Table after",
    "start": "1993960",
    "end": "1999480"
  },
  {
    "text": "everything has run and executed so you'll notice the highlighted uh uh rows",
    "start": "1999480",
    "end": "2004960"
  },
  {
    "text": "are two rows that have failed moving so the first one failed because for some",
    "start": "2004960",
    "end": "2010200"
  },
  {
    "text": "reason it didn't copy right maybe the uh the map Produce job ran out of memory",
    "start": "2010200",
    "end": "2016240"
  },
  {
    "text": "because the file was so big uh which happened to us several times maybe the",
    "start": "2016240",
    "end": "2022080"
  },
  {
    "text": "uh Network had a blip something like that uh but you can debug what the issue",
    "start": "2022080",
    "end": "2028039"
  },
  {
    "text": "was by looking at the application job ID in the map reduce logs and then the",
    "start": "2028039",
    "end": "2033480"
  },
  {
    "text": "other one just didn't match the check sums so you can see the underlining check sums don't match so after this we have a list of all the",
    "start": "2033480",
    "end": "2040639"
  },
  {
    "text": "files we know that they match one to one and so at this point right we can",
    "start": "2040639",
    "end": "2047519"
  },
  {
    "start": "2044000",
    "end": "2076000"
  },
  {
    "text": "use Hive to do our conversion but we're at a newer version of Hive so those bugs",
    "start": "2047519",
    "end": "2054240"
  },
  {
    "text": "don't exist and we have our auditing tool so we can make sure that everything is working correctly so at this point",
    "start": "2054240",
    "end": "2062638"
  },
  {
    "text": "we're confident of our data warehouse in the cloud uh through throughout this whole",
    "start": "2062639",
    "end": "2068398"
  },
  {
    "text": "process we're doing performance improvements on AWS infrastructure And Hive sites things like",
    "start": "2068399",
    "end": "2075320"
  },
  {
    "text": "that so uh we retroed again but this was a happier",
    "start": "2075320",
    "end": "2080358"
  },
  {
    "text": "retro um first off right thing that worked great for us was making sure that",
    "start": "2080359",
    "end": "2085878"
  },
  {
    "text": "this migration tool or your migration process is repeatable because you think that you're moving your data where data",
    "start": "2085879",
    "end": "2092599"
  },
  {
    "text": "to the warehouse once but there may be a situation where you want to move it again or to a different place or",
    "start": "2092599",
    "end": "2098960"
  },
  {
    "text": "something doesn't go right so you need to retry um part of uh the work that we did",
    "start": "2098960",
    "end": "2106920"
  },
  {
    "text": "when we were customizing the disc CP tool was making sure that the API calls",
    "start": "2106920",
    "end": "2113359"
  },
  {
    "text": "to S3 matched so we had high 08 and at",
    "start": "2113359",
    "end": "2119040"
  },
  {
    "text": "that point the uh S3 API had changed so much that the disc CP copy tool didn't",
    "start": "2119040",
    "end": "2126680"
  },
  {
    "text": "actually work so we actually had to go in and make some changes to that so don't wait too long to migrate or else d",
    "start": "2126680",
    "end": "2133040"
  },
  {
    "text": "CP might have some issues and you'll have to address those um create S3 permissions and",
    "start": "2133040",
    "end": "2141160"
  },
  {
    "text": "naming standards early uh for anyone doing anything in S3 this is important",
    "start": "2141160",
    "end": "2146240"
  },
  {
    "text": "because you don't want to have multiple different files that are the same thing",
    "start": "2146240",
    "end": "2152599"
  },
  {
    "text": "or the same name that are different files or weird things like that and you want to make sure sure that people can't",
    "start": "2152599",
    "end": "2159800"
  },
  {
    "text": "delete your S3 environment because one of the things about AWS is it empowers",
    "start": "2159800",
    "end": "2165359"
  },
  {
    "text": "all of us to do more and that can sometimes be a double-bladed sword",
    "start": "2165359",
    "end": "2172480"
  },
  {
    "text": "sword uh right don't forget to clean up your S3 files after you're done moving",
    "start": "2172520",
    "end": "2179160"
  },
  {
    "text": "which we still have to do",
    "start": "2179160",
    "end": "2184920"
  },
  {
    "text": "um uh upgrade your High version to more stable releases this was uh I'm I'm just",
    "start": "2184920",
    "end": "2191000"
  },
  {
    "text": "not a fan of hi8 uh being a developer who has spent serious time uh digging",
    "start": "2191000",
    "end": "2197839"
  },
  {
    "text": "into why these things aren't matching and then just finding out it's a bug with Hive has been a very frustrating",
    "start": "2197839",
    "end": "2204040"
  },
  {
    "text": "system so uh upgrading Hive uh to newer versions is a relatively easy process",
    "start": "2204040",
    "end": "2211520"
  },
  {
    "text": "and uh I encourage you to do that uh hire people smarter than",
    "start": "2211520",
    "end": "2217640"
  },
  {
    "text": "yourself so what this really bullet point really is about is",
    "start": "2217640",
    "end": "2222960"
  },
  {
    "text": "that while we were making this move to AWS we were learning ourselves right and",
    "start": "2222960",
    "end": "2230160"
  },
  {
    "text": "uh it would have gone a lot smoother had we had an AWS expert inhouse right away",
    "start": "2230160",
    "end": "2236359"
  },
  {
    "text": "and part of what made this third attempt so successful is because we hired an AWS",
    "start": "2236359",
    "end": "2242640"
  },
  {
    "text": "expert so uh I I realize this isn't an easy bu bullet point right everyone's",
    "start": "2242640",
    "end": "2249040"
  },
  {
    "text": "having a hard time trying to find the Big Data experts but this is important uh and finally Don't Stop",
    "start": "2249040",
    "end": "2256640"
  },
  {
    "text": "Believing uh I think that uh you know after so many attempts to get this data",
    "start": "2256640",
    "end": "2263599"
  },
  {
    "text": "to the cloud we finally did it uh it was there were times where we lost our",
    "start": "2263599",
    "end": "2270160"
  },
  {
    "text": "morale and things didn't go great but we finally did it also I was tired and I",
    "start": "2270160",
    "end": "2276280"
  },
  {
    "text": "wanted to put something funny in here all right cool so all of our data is in",
    "start": "2276280",
    "end": "2283240"
  },
  {
    "start": "2279000",
    "end": "2328000"
  },
  {
    "text": "the data warehouse now we have this cool tool that can move it again if we need to so I want to tell you a little bit a",
    "start": "2283240",
    "end": "2289839"
  },
  {
    "text": "little story uh right after we got our data into Data Warehouse and everything's",
    "start": "2289839",
    "end": "2295040"
  },
  {
    "text": "going great one of our Engineers comes in really smart guy logs in sees uh does",
    "start": "2295040",
    "end": "2302560"
  },
  {
    "text": "uh show schemas in Hive and sees this collection of databases",
    "start": "2302560",
    "end": "2308119"
  },
  {
    "text": "so what looks weird about this right what would you do if you see",
    "start": "2308119",
    "end": "2314960"
  },
  {
    "text": "see these delete me ones right man they're kind of an",
    "start": "2314960",
    "end": "2320000"
  },
  {
    "text": "eyesore someone must think it's safe to delete so let's just delete them right",
    "start": "2320000",
    "end": "2326440"
  },
  {
    "text": "and that's what our guy did but oops uh he deleted a significant",
    "start": "2326440",
    "end": "2333480"
  },
  {
    "start": "2328000",
    "end": "2407000"
  },
  {
    "text": "part of the data warehouse that we had just worked so hard to get",
    "start": "2333480",
    "end": "2339319"
  },
  {
    "text": "there and how this happened was these specific uh schemas were being part of",
    "start": "2339319",
    "end": "2346599"
  },
  {
    "text": "the the move process and once we had finished moving we decided we didn't need them anymore the problem is these",
    "start": "2346599",
    "end": "2353079"
  },
  {
    "text": "are all manage tables and when he deleted them he did Cascade delete so if",
    "start": "2353079",
    "end": "2359800"
  },
  {
    "text": "you are doing Cascade delete on manage tables that means you remove the underlying",
    "start": "2359800",
    "end": "2364960"
  },
  {
    "text": "data and it was pointed at our production data so the lesson here really is even",
    "start": "2364960",
    "end": "2372880"
  },
  {
    "text": "if something's named delete me one make sure that you go in and check that where",
    "start": "2372880",
    "end": "2380400"
  },
  {
    "text": "the tables are pointed before you delete it and make sure you talk to your team and make sure everything is a kosher",
    "start": "2380400",
    "end": "2386400"
  },
  {
    "text": "before deleting it uh also uh one thing that we found was you may want to think about turning on S3 versioning once your",
    "start": "2386400",
    "end": "2393640"
  },
  {
    "text": "data is there S3 versioning will make a copy of your exist data so that if a",
    "start": "2393640",
    "end": "2399240"
  },
  {
    "text": "situation does occur like that then you can use S3 uh versioning to restore",
    "start": "2399240",
    "end": "2407640"
  },
  {
    "text": "it so now that I've gone through we finally uh unlocked the potential that",
    "start": "2407640",
    "end": "2413440"
  },
  {
    "text": "AWS has we we we have all of our data collocated in one place and what can we",
    "start": "2413440",
    "end": "2418599"
  },
  {
    "text": "do from a technological perspective now so just a reminder this is what our",
    "start": "2418599",
    "end": "2424880"
  },
  {
    "text": "ecosystem looked like around uh December this year we finally got everything up",
    "start": "2424880",
    "end": "2430880"
  },
  {
    "text": "and running uh the etls pulling it uh data from the transactional data uh from",
    "start": "2430880",
    "end": "2436640"
  },
  {
    "text": "the transactional tables into our data warehouse uh and everything's going",
    "start": "2436640",
    "end": "2442480"
  },
  {
    "text": "great uh but because uh AWS frees us to",
    "start": "2442480",
    "end": "2447760"
  },
  {
    "text": "to from a lot of the sort of infrastructure overhead we've been able to grow our infrastructure in just eight",
    "start": "2447760",
    "end": "2454760"
  },
  {
    "start": "2451000",
    "end": "2585000"
  },
  {
    "text": "months to do a lot more things for our customers and our",
    "start": "2454760",
    "end": "2459920"
  },
  {
    "text": "players um so for compute we use uh Amazon EMR and ec2 and you'll see we",
    "start": "2459920",
    "end": "2467480"
  },
  {
    "text": "have uh individual clusters for each of our uh key stakeholders so data science",
    "start": "2467480",
    "end": "2473880"
  },
  {
    "text": "has their own cluster analytics has their own cluster so instead of them",
    "start": "2473880",
    "end": "2479119"
  },
  {
    "text": "stepping on each other each other's feet they can uh be in charge of their own",
    "start": "2479119",
    "end": "2485240"
  },
  {
    "text": "domain uh we were able to to get realtime ingestion working so we have a cluster for that we have our ETL cluster",
    "start": "2485240",
    "end": "2492920"
  },
  {
    "text": "plugging away uh platora is our visualization tool that we use uh across",
    "start": "2492920",
    "end": "2498640"
  },
  {
    "text": "Hive and that spins up and shuts down clusters left and right um and then we",
    "start": "2498640",
    "end": "2505119"
  },
  {
    "text": "have another cluster for loading data into Dynamo DB and I'll get to that in a second overall across uh EMR and ec2 we",
    "start": "2505119",
    "end": "2513760"
  },
  {
    "text": "have about 750 instances is running and uh Computing and crunching",
    "start": "2513760",
    "end": "2520440"
  },
  {
    "text": "data so all that data that we crunch gets stored into various different locations uh I talked a bunch today",
    "start": "2520440",
    "end": "2527720"
  },
  {
    "text": "about S3 and our metastore which is an RDS but uh RDS also enables us to uh",
    "start": "2527720",
    "end": "2534400"
  },
  {
    "text": "create storage for our other customers uh and uh we're also using Dynamo DB to",
    "start": "2534400",
    "end": "2541280"
  },
  {
    "text": "do quick Point lookups and we say feel safe with all of this ecosystem",
    "start": "2541280",
    "end": "2547800"
  },
  {
    "text": "uh in the cloud because we have some pretty solid protection with the AWS",
    "start": "2547800",
    "end": "2552839"
  },
  {
    "text": "sort of networking and security stuff so all of this is behind a a VPC uh to make",
    "start": "2552839",
    "end": "2558760"
  },
  {
    "text": "sure uh naughty people can't get into it and see all of our secrets and uh we we",
    "start": "2558760",
    "end": "2565319"
  },
  {
    "text": "also are uh using AWS Direct Connect so that we can ensure that the pipes",
    "start": "2565319",
    "end": "2570839"
  },
  {
    "text": "between our data warehouse in the cloud and our pipes between or and uh the",
    "start": "2570839",
    "end": "2577319"
  },
  {
    "text": "individual data centers around the world are clear and",
    "start": "2577319",
    "end": "2582960"
  },
  {
    "text": "uncongested so uh yeah from a technological perspective this new infrastructure has given us a lot of",
    "start": "2584800",
    "end": "2592160"
  },
  {
    "text": "opportunities so uh like like the story I told you before about our young uh",
    "start": "2592160",
    "end": "2598240"
  },
  {
    "text": "bright-eyed analyst taking over everything uh we can now avoid that situation by just spinning up his own",
    "start": "2598240",
    "end": "2604559"
  },
  {
    "text": "EMR cluster if it actually require re Ires that level of",
    "start": "2604559",
    "end": "2610319"
  },
  {
    "text": "computation uh as you saw in the previous slide we have clusters set up for the data science team the analytics",
    "start": "2610319",
    "end": "2616839"
  },
  {
    "text": "team and one of the nice things is we can get billing and Associate it with",
    "start": "2616839",
    "end": "2622119"
  },
  {
    "text": "each one of those teams based on the resources that they're using so before",
    "start": "2622119",
    "end": "2627760"
  },
  {
    "text": "in a data center how do you divide one cluster across all those different people It's Tricky I I would know how to",
    "start": "2627760",
    "end": "2635760"
  },
  {
    "text": "do it uh and then you know the there are other products like cloudwatch monitoring",
    "start": "2635760",
    "end": "2640960"
  },
  {
    "text": "built-in monitoring that make our lives easier just to if something breaks we can catch",
    "start": "2640960",
    "end": "2647440"
  },
  {
    "text": "it um so when we moved we moved 1.4",
    "start": "2647440",
    "end": "2653200"
  },
  {
    "text": "million partitions of data to the cloud right and the Telemetry data already",
    "start": "2653200",
    "end": "2660240"
  },
  {
    "text": "existed there and today we have 27 million partitions of data in our dat",
    "start": "2660240",
    "end": "2667520"
  },
  {
    "text": "Warehouse so uh we need a good solution for vertical scaling and I think that a",
    "start": "2667520",
    "end": "2674240"
  },
  {
    "text": "lot of people here at this conference we'll talk a lot about horizontal scaling but one of the nice features of",
    "start": "2674240",
    "end": "2679559"
  },
  {
    "text": "RDS is that it's really easy to upgrade one of your database instances to to go from 1.4 million",
    "start": "2679559",
    "end": "2687359"
  },
  {
    "text": "partitions to 27 million partitions if you were in a data center you would have",
    "start": "2687359",
    "end": "2693119"
  },
  {
    "text": "to shut everything down rack a new server back up the data database transfer that backup over to the new",
    "start": "2693119",
    "end": "2700160"
  },
  {
    "text": "server and spin it up and with AB we just push a",
    "start": "2700160",
    "end": "2705400"
  },
  {
    "text": "button uh and and really a lot of the sort of administrative tasks like",
    "start": "2705400",
    "end": "2711440"
  },
  {
    "text": "managing uh like job task processes and name node processes has been abstracted",
    "start": "2711440",
    "end": "2718720"
  },
  {
    "text": "away by S3 and EMR so that it frees our",
    "start": "2718720",
    "end": "2723880"
  },
  {
    "text": "team to build that infrastructure within the series of within within eight",
    "start": "2723880",
    "end": "2730720"
  },
  {
    "text": "months uh finally uh if you ever had a situation where you have to go in and",
    "start": "2730720",
    "end": "2736839"
  },
  {
    "text": "debug Hardware uh you can just reboot the instance so that's more time on your",
    "start": "2736839",
    "end": "2744200"
  },
  {
    "text": "hands to play League of Legends so all of this Tech has really",
    "start": "2744200",
    "end": "2750599"
  },
  {
    "text": "translated into uh some great tools for us to make our players have a better",
    "start": "2750599",
    "end": "2756559"
  },
  {
    "text": "experience overall uh one of these uh is a new",
    "start": "2756559",
    "end": "2761839"
  },
  {
    "start": "2759000",
    "end": "2821000"
  },
  {
    "text": "feature to our game uh if anyone in the audience plays League of Legends you might be familiar with this new feature",
    "start": "2761839",
    "end": "2768359"
  },
  {
    "text": "uh it's called Champion Mastery and how it works is the more you play a game the",
    "start": "2768359",
    "end": "2774280"
  },
  {
    "text": "more that you level up with that champion so you can compare your skill",
    "start": "2774280",
    "end": "2780800"
  },
  {
    "text": "level of the champion to the skill levels of other people who play that champion and this is a really intense of",
    "start": "2780800",
    "end": "2787720"
  },
  {
    "text": "query that was running that spanned every game across all time um and was a",
    "start": "2787720",
    "end": "2793800"
  },
  {
    "text": "lot of data uh but the value that it really brings is this new game mode that",
    "start": "2793800",
    "end": "2799960"
  },
  {
    "text": "really uh improves our uh player engagement and keeps people coming back to play more so this is not something we",
    "start": "2799960",
    "end": "2808000"
  },
  {
    "text": "would have been able to do with our data center so uh the query would have taken",
    "start": "2808000",
    "end": "2814599"
  },
  {
    "text": "everything over and no one else would have been able to do work during the two or three days that it",
    "start": "2814599",
    "end": "2821640"
  },
  {
    "start": "2821000",
    "end": "2953000"
  },
  {
    "text": "ran uh the next story I want to tell you is about our player support",
    "start": "2821640",
    "end": "2826960"
  },
  {
    "text": "team so our player support team uh they're the guys in the front line answering all of the questions like I",
    "start": "2826960",
    "end": "2834119"
  },
  {
    "text": "bought this item but it's not appearing in my inventory what's up",
    "start": "2834119",
    "end": "2839160"
  },
  {
    "text": "redo um so the the situation they were having is",
    "start": "2839160",
    "end": "2844559"
  },
  {
    "text": "they would log into their player support tool and they would look up that player to make sure that he actually bought it and",
    "start": "2844559",
    "end": "2850800"
  },
  {
    "text": "he isn't just lying to get free stuff and they would sit there for 15 minutes waiting for the data to",
    "start": "2850800",
    "end": "2857000"
  },
  {
    "text": "load so the player support tool needs to get every all of the information about",
    "start": "2857000",
    "end": "2862079"
  },
  {
    "text": "that player such as their purchases last time they logged in to be able to handle a large number of different",
    "start": "2862079",
    "end": "2869160"
  },
  {
    "text": "questions and the reason this was happening was because they were using the wrong backend database they were using vertica which",
    "start": "2869160",
    "end": "2876280"
  },
  {
    "text": "is a great tool for colner aggregation and Analysis but it's uh not used for",
    "start": "2876280",
    "end": "2882800"
  },
  {
    "text": "looking up a single row and a single player so what we did was we decided to",
    "start": "2882800",
    "end": "2887960"
  },
  {
    "text": "leverage Dynamo DB to increase that performance but in order to do that we",
    "start": "2887960",
    "end": "2893240"
  },
  {
    "text": "had to get all the data into Dynamo DB so we used uh a Dynamo DB Dynamic",
    "start": "2893240",
    "end": "2898960"
  },
  {
    "text": "partitions in Hive which is a feature that's specific to EMR and uh we copied the entire data",
    "start": "2898960",
    "end": "2906599"
  },
  {
    "text": "where W house in our Cloud to and put it into Dynam DV so now what once took 15",
    "start": "2906599",
    "end": "2913559"
  },
  {
    "text": "minutes for that support person to help answer that player's question they could",
    "start": "2913559",
    "end": "2919920"
  },
  {
    "text": "query that data within a second so uh if you uh thinking about",
    "start": "2919920",
    "end": "2927520"
  },
  {
    "text": "something like this right if you have a situation where your team is querying",
    "start": "2927520",
    "end": "2934640"
  },
  {
    "text": "data and you need a fast response time you need to be able to have different types of sort of access patterns to get",
    "start": "2934640",
    "end": "2942319"
  },
  {
    "text": "that data out of your data warehouse and because uh AWS is so easy to build our",
    "start": "2942319",
    "end": "2949240"
  },
  {
    "text": "own infrastructure we've been empowered to do that and finally uh chat detection so",
    "start": "2949240",
    "end": "2958079"
  },
  {
    "start": "2953000",
    "end": "3053000"
  },
  {
    "text": "there's an unfortunate fact that uh there's a minority of players in the",
    "start": "2958079",
    "end": "2963160"
  },
  {
    "text": "gaming community that uh ha have kind of rough language to put",
    "start": "2963160",
    "end": "2970119"
  },
  {
    "text": "delicately um some of these people are just negative some are just having a rough day because they're working hard",
    "start": "2970119",
    "end": "2977480"
  },
  {
    "text": "uh and they keep losing games but RI wants to help uh improve the environment",
    "start": "2977480",
    "end": "2983640"
  },
  {
    "text": "that our players uh have make it a safe environment so uh our data science team",
    "start": "2983640",
    "end": "2990760"
  },
  {
    "text": "had come up with this way of classifying our chat logs to determine whether there",
    "start": "2990760",
    "end": "2996160"
  },
  {
    "text": "was you know negative things being said or racist things things like that and uh",
    "start": "2996160",
    "end": "3001839"
  },
  {
    "text": "they had a series of sentiment analysis and classification algorithms that they were running on their",
    "start": "3001839",
    "end": "3007839"
  },
  {
    "text": "laptop this is silly right because you're loading a huge model in on a",
    "start": "3007839",
    "end": "3013520"
  },
  {
    "text": "laptop if something dies or you run out of memory uh you're going to have a bad",
    "start": "3013520",
    "end": "3018559"
  },
  {
    "text": "time so uh with ec2 we were able to spin up a uh spark cluster I think",
    "start": "3018559",
    "end": "3026040"
  },
  {
    "text": "specifically we're using uh data bricks uh data science platform which gives",
    "start": "3026040",
    "end": "3031520"
  },
  {
    "text": "them free reign to run these things and sort of optimize uh queries for uh detection and",
    "start": "3031520",
    "end": "3041520"
  },
  {
    "text": "and since this has been in place uh our players have had a safer environment to",
    "start": "3041520",
    "end": "3048400"
  },
  {
    "text": "play in and stuff all right so we're almost done uh",
    "start": "3048400",
    "end": "3056960"
  },
  {
    "start": "3053000",
    "end": "3213000"
  },
  {
    "text": "I just want to wrap up by saying that uh over the course of this talk I described",
    "start": "3056960",
    "end": "3064160"
  },
  {
    "text": "the many mistakes that we've made to in this process and part of it is because",
    "start": "3064160",
    "end": "3071200"
  },
  {
    "text": "the the ecosystem the the environment that big data is happening is fresh and young right uh building a big data",
    "start": "3071200",
    "end": "3079359"
  },
  {
    "text": "platform is like building a castle on shifting Sands because throughout this whole process we had new vers of Hive",
    "start": "3079359",
    "end": "3087280"
  },
  {
    "text": "come out new versions of Amazon EMR Amis coming out um and all sorts of different",
    "start": "3087280",
    "end": "3094280"
  },
  {
    "text": "changing like people were solidifying their Concepts around uh Cloud",
    "start": "3094280",
    "end": "3099680"
  },
  {
    "text": "architecture and things like that so we're we're we're in a good time now",
    "start": "3099680",
    "end": "3106160"
  },
  {
    "text": "because these products are maturing we can we can learn from our mistakes from",
    "start": "3106160",
    "end": "3111200"
  },
  {
    "text": "the past and then we can deliver this awesome player value to uh our customers",
    "start": "3111200",
    "end": "3117599"
  },
  {
    "text": "or our players for those of you who are in the gaming industry so um with that being said I",
    "start": "3117599",
    "end": "3125960"
  },
  {
    "text": "want to wrap up uh thank you for attending um so let me do a quick plug",
    "start": "3125960",
    "end": "3131599"
  },
  {
    "text": "for our brand new engineering blog uh there's some really cool information",
    "start": "3131599",
    "end": "3136760"
  },
  {
    "text": "that you guys might find on there uh including how our store and merchandise team H sets up their AWS infrastructure",
    "start": "3136760",
    "end": "3145160"
  },
  {
    "text": "uh or if you're more into the like nitty-gritty details of game design uh there's like vector programming",
    "start": "3145160",
    "end": "3151240"
  },
  {
    "text": "tutorials and things like that and uh this talk and more details will'll make",
    "start": "3151240",
    "end": "3156520"
  },
  {
    "text": "it onto there soon TM um after this uh later tonight right",
    "start": "3156520",
    "end": "3163640"
  },
  {
    "text": "it Wednesday is party night so there's the AWS Bar Crawl at 5:30 and once",
    "start": "3163640",
    "end": "3171240"
  },
  {
    "text": "you're done at the bar crawl keep the party going with us uh we're hosting an after party at uh 6: tonight uh at the",
    "start": "3171240",
    "end": "3180160"
  },
  {
    "text": "plazo tower um third floor so uh if you're interested in that come up I have",
    "start": "3180160",
    "end": "3186359"
  },
  {
    "text": "some invitations and then finally if you have any questions that we don't have time to get to uh feel free to add me on Twitter",
    "start": "3186359",
    "end": "3194200"
  },
  {
    "text": "or send me an email I'm happy to get in much more depth than what I got in today",
    "start": "3194200",
    "end": "3201319"
  },
  {
    "text": "and help you guys out because we're all one big happy family uh so with that being said",
    "start": "3201319",
    "end": "3207640"
  },
  {
    "text": "thank you for your time and stuff [Applause]",
    "start": "3207640",
    "end": "3215199"
  }
]