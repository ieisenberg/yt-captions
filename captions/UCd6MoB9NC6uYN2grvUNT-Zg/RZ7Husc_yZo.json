[
  {
    "start": "0",
    "end": "61000"
  },
  {
    "text": "well your customers are super demanding these days they want their content and",
    "start": "30",
    "end": "6420"
  },
  {
    "text": "website up 24 by 7 they want to be able to access it at home and whether",
    "start": "6420",
    "end": "12570"
  },
  {
    "text": "traveling halfway around the world and most of all they expect their content with features to be available right away",
    "start": "12570",
    "end": "20420"
  },
  {
    "text": "so how do you build your applications in a way that the resilient because you know something will go wrong how do you",
    "start": "20420",
    "end": "27269"
  },
  {
    "text": "build it that in in a scalable manner so start from one go 2,000 go 2 million maybe a billion customers and more",
    "start": "27269",
    "end": "35280"
  },
  {
    "text": "importantly how do you make it manageable so that you can actually make changes without taking down the whole",
    "start": "35280",
    "end": "40710"
  },
  {
    "text": "website or your application my name is Robert Chell I'm a product manager with",
    "start": "40710",
    "end": "47550"
  },
  {
    "text": "messenger group with AWS and I'm happy today to have with me Stephen Godwin",
    "start": "47550",
    "end": "52739"
  },
  {
    "text": "from the BBC to share with us his journey through micro services so today",
    "start": "52739",
    "end": "62640"
  },
  {
    "start": "61000",
    "end": "100000"
  },
  {
    "text": "what we're going to do what I'm going to do is I will give you a brief messaging overview think of this as your your",
    "start": "62640",
    "end": "68939"
  },
  {
    "text": "30-second ad in front of your YouTube video but you won't have the opportunity to skip it but I promise I'll be very",
    "start": "68939",
    "end": "75450"
  },
  {
    "text": "brief and then I'll invite Stephen up on stage and he'll give you sort of the background some of the challenges that",
    "start": "75450",
    "end": "81900"
  },
  {
    "text": "he was trying to solve and sort of his journey through the a micro services architecture some tips and tricks and",
    "start": "81900",
    "end": "88049"
  },
  {
    "text": "what he's learned and some hopefully some things that you can take away with you as well and then he's going to share",
    "start": "88049",
    "end": "94079"
  },
  {
    "text": "with us some of the exciting things that he's doing at the BBC today so typically",
    "start": "94079",
    "end": "101790"
  },
  {
    "text": "when you build a system you think about a compute block some storage and perhaps",
    "start": "101790",
    "end": "110009"
  },
  {
    "text": "database but for us we also think about messaging so this is a critical",
    "start": "110009",
    "end": "115380"
  },
  {
    "text": "component for us and the two surfaces that I'll talk about very briefly there",
    "start": "115380",
    "end": "121290"
  },
  {
    "text": "are actually very core surfaces without within AWS and within Amazon so almost",
    "start": "121290",
    "end": "127140"
  },
  {
    "text": "every in fact every single retail order that goes to ecommerce actually goes to",
    "start": "127140",
    "end": "132510"
  },
  {
    "text": "one of these so you think about prime day and then Black Friday and then just yesterday",
    "start": "132510",
    "end": "138710"
  },
  {
    "text": "Cyber Monday so every single retail order actually goes to these services so",
    "start": "138710",
    "end": "145320"
  },
  {
    "text": "the two services that I'm talking about are Amazon sqs AWS s and s so simple",
    "start": "145320",
    "end": "153990"
  },
  {
    "start": "147000",
    "end": "184000"
  },
  {
    "text": "queue services basically a queue allows you to send messages from one produce",
    "start": "153990",
    "end": "159600"
  },
  {
    "text": "you to consumer and consumed by one one consumer simple notification services",
    "start": "159600",
    "end": "165060"
  },
  {
    "text": "basically it's a pub/sub service so you can send to a mobile device HTTP",
    "start": "165060",
    "end": "170190"
  },
  {
    "text": "endpoint you can send to a land endpoint but a very common pattern is just to send it to an sqs queue so both of these",
    "start": "170190",
    "end": "178709"
  },
  {
    "text": "services are fully managed simple reliable and fully scalable so without",
    "start": "178709",
    "end": "186150"
  },
  {
    "start": "184000",
    "end": "209000"
  },
  {
    "text": "any further delay I'm going to invite Stephen up on stage so Stephen as a lead architect with with BBC he was",
    "start": "186150",
    "end": "193620"
  },
  {
    "text": "responsible for developing and leading BBC through their micro services journey with the I radio and the iPlayer",
    "start": "193620",
    "end": "200220"
  },
  {
    "text": "platform prior to that he spent many years with IBM but we won't hold that",
    "start": "200220",
    "end": "205890"
  },
  {
    "text": "against them so Stephen",
    "start": "205890",
    "end": "211640"
  },
  {
    "text": "thank you Robert good morning everyone",
    "start": "217989",
    "end": "223120"
  },
  {
    "text": "the BBC is the oldest broadcaster as earth is the biggest broadcaster in the",
    "start": "223120",
    "end": "229760"
  },
  {
    "text": "world and since its creation over 90",
    "start": "229760",
    "end": "235760"
  },
  {
    "text": "years ago technical innovation has been at the heart of what the BBC does in",
    "start": "235760",
    "end": "244750"
  },
  {
    "text": "1936 the BBC launched the world's first regular broadcast television service",
    "start": "244750",
    "end": "254469"
  },
  {
    "text": "technically in high-definition although high-definition meant something slightly different in 1936 - what it",
    "start": "256150",
    "end": "263330"
  },
  {
    "text": "means today the BBC launched its first regular",
    "start": "263330",
    "end": "270080"
  },
  {
    "text": "online video service in 1997 as part of the BBC News website and in 2005 the",
    "start": "270080",
    "end": "280520"
  },
  {
    "text": "same ye8 YouTube launched the BBC launched a trial of a service called BBC",
    "start": "280520",
    "end": "285560"
  },
  {
    "text": "iPlayer just under a decade ago on",
    "start": "285560",
    "end": "294310"
  },
  {
    "start": "288000",
    "end": "324000"
  },
  {
    "text": "Christmas Day 2007 iPlayer left beta and",
    "start": "294310",
    "end": "301930"
  },
  {
    "text": "went into full production today BBC",
    "start": "301930",
    "end": "309349"
  },
  {
    "text": "iPlayer provides the BBC's television and radio services online both live",
    "start": "309349",
    "end": "316190"
  },
  {
    "text": "content what's being broadcast now and catch-up content from the past 30 days",
    "start": "316190",
    "end": "323020"
  },
  {
    "text": "it's regularly used by over 30% of the adults in the UK it supports thousands",
    "start": "323830",
    "end": "332090"
  },
  {
    "start": "324000",
    "end": "366000"
  },
  {
    "text": "of different devices mobile phones tablets Smart TVs set-top boxes games",
    "start": "332090",
    "end": "339259"
  },
  {
    "text": "consoles and your pcs on your Macs",
    "start": "339259",
    "end": "344020"
  },
  {
    "text": "each and every week 10,000 hours of new media are published on the BBC iPlayer",
    "start": "345900",
    "end": "354949"
  },
  {
    "text": "every 15 minutes at least one new program becomes available online but if",
    "start": "356120",
    "end": "369870"
  },
  {
    "start": "366000",
    "end": "385000"
  },
  {
    "text": "you go back a few years ago to 2012 we",
    "start": "369870",
    "end": "376860"
  },
  {
    "text": "couldn't do all those things and in fact BBC iPlayer was having some trouble in",
    "start": "376860",
    "end": "384650"
  },
  {
    "start": "385000",
    "end": "630000"
  },
  {
    "text": "those in that time we were running on physical systems that are in our own",
    "start": "387919",
    "end": "394260"
  },
  {
    "text": "datacenters and they've been commissioned three or four years earlier and the systems were perfectly adequate",
    "start": "394260",
    "end": "402599"
  },
  {
    "text": "for the time that they were commissioned but over those three or four years we've added support for mobile devices for",
    "start": "402599",
    "end": "410010"
  },
  {
    "text": "tablets and for HD and the systems literally didn't have the resources",
    "start": "410010",
    "end": "416310"
  },
  {
    "text": "needed to do what we were asking them to do they were running out of CPU they were running out of disk throughput we",
    "start": "416310",
    "end": "422669"
  },
  {
    "text": "were any out of storage and so we were having to employ people",
    "start": "422669",
    "end": "428010"
  },
  {
    "text": "to go through the schedule each week and work out which programs we were going to",
    "start": "428010",
    "end": "433530"
  },
  {
    "text": "put online there were television programs we had the rights to make",
    "start": "433530",
    "end": "439349"
  },
  {
    "text": "available online but we weren't putting online simply because we lacked the",
    "start": "439349",
    "end": "444780"
  },
  {
    "text": "video processing capability even worse",
    "start": "444780",
    "end": "451099"
  },
  {
    "text": "the system wasn't terribly stable at the",
    "start": "451099",
    "end": "457680"
  },
  {
    "text": "heart of the system was a database with a table in that database it's actually",
    "start": "457680",
    "end": "463199"
  },
  {
    "text": "spread across a few tables but effectively it was a table in the database which listed the work that was",
    "start": "463199",
    "end": "468840"
  },
  {
    "text": "to be done and so for every job that needed to be done there was an entry in this table it was ok when everything was",
    "start": "468840",
    "end": "477599"
  },
  {
    "text": "in this he state but if there was a certain influx of workers certain influx of jobs",
    "start": "477599",
    "end": "482839"
  },
  {
    "text": "to be done or there was some sort of fold perhaps in another system and work",
    "start": "482839",
    "end": "489439"
  },
  {
    "text": "back top then this table would get bigger and bigger and bigger and fill up with pieces of work to be done that",
    "start": "489439",
    "end": "496629"
  },
  {
    "text": "meant it took longer to query that table and it took longer to add new entries to",
    "start": "496629",
    "end": "501770"
  },
  {
    "text": "that table because you're fighting over the index because the downstream things",
    "start": "501770",
    "end": "508909"
  },
  {
    "text": "that are actually processing the work were all reading this table as it took them longer to query the table they",
    "start": "508909",
    "end": "514610"
  },
  {
    "text": "themselves slowed down which meant the work started piling up more which meant the table got bigger and you ended up in",
    "start": "514610",
    "end": "520219"
  },
  {
    "text": "this cascade scenario where you couldn't process the work quickly enough and because you can process the work quickly",
    "start": "520219",
    "end": "526100"
  },
  {
    "text": "enough more things were adding to the table which slowed you down further to",
    "start": "526100",
    "end": "535519"
  },
  {
    "text": "get us back out of this situation we would regularly actually have to effectively dump the contents of this table to a text file and then feed the",
    "start": "535519",
    "end": "544430"
  },
  {
    "text": "stuff back in slowly so we didn't put too many entries in at the time and upset the system as you can imagine this",
    "start": "544430",
    "end": "551600"
  },
  {
    "text": "wasn't ideal this is effectively an anti-pattern of using a database as a cube so we decided we were going to",
    "start": "551600",
    "end": "560690"
  },
  {
    "text": "rewrite the system and we decided we were going to also move it up to the cloud the elastic nature of the cloud",
    "start": "560690",
    "end": "568220"
  },
  {
    "text": "was really attractive to us because of those because of how we'd run out of",
    "start": "568220",
    "end": "574579"
  },
  {
    "text": "resources previously the elastic nature of cloud meant I could add extra CPU I",
    "start": "574579",
    "end": "579709"
  },
  {
    "text": "could add extra storage and I didn't have to worry about buying a new rack it",
    "start": "579709",
    "end": "586430"
  },
  {
    "text": "was a sort of linear pricing model I could add extra storage as and went and CPU as and when I needed it even better",
    "start": "586430",
    "end": "596000"
  },
  {
    "text": "right - and business owners I could give them a effectively a charge",
    "start": "596000",
    "end": "601100"
  },
  {
    "text": "sheet or a pricing plan of how much it would cost - if they wanted for example",
    "start": "601100",
    "end": "607370"
  },
  {
    "text": "to double the amount of content in iPlayer I could say this is how much and those prices were pretty much linear",
    "start": "607370",
    "end": "614540"
  },
  {
    "text": "I could say or even better than linear could say this is how much it'll cost it's very predictable so at the end of",
    "start": "614540",
    "end": "626149"
  },
  {
    "text": "2012 we made a decision we were going to move this service up to the cloud and this graph gives you a really good idea",
    "start": "626149",
    "end": "633410"
  },
  {
    "start": "630000",
    "end": "742000"
  },
  {
    "text": "of the sorts of problems that we were facing that made it very attractive that",
    "start": "633410",
    "end": "638690"
  },
  {
    "text": "moved to the cloud so this is a graph of days of the week again a number of",
    "start": "638690",
    "end": "644209"
  },
  {
    "text": "requests to process video number of requests to put a new video into iPlayer and you can see there are five very big",
    "start": "644209",
    "end": "651110"
  },
  {
    "text": "peaks and a six smaller peak and these relate to the regional news programmes",
    "start": "651110",
    "end": "657560"
  },
  {
    "text": "that we broadcast and what happens is at 6:30 on a weekday evening BBC one our",
    "start": "657560",
    "end": "666470"
  },
  {
    "text": "main broadcast channel splits from being just one channel to being 19 separate",
    "start": "666470",
    "end": "672380"
  },
  {
    "text": "channels and each one of those channels represents a different nation or region of the UK so I get 19 live half-hour",
    "start": "672380",
    "end": "686060"
  },
  {
    "text": "programs all coming in at the same time the old system that the hardware based",
    "start": "686060",
    "end": "693500"
  },
  {
    "text": "system really struggled with this because it just didn't have the capacity to cope and so what would happen it",
    "start": "693500",
    "end": "700550"
  },
  {
    "text": "would take something like 16 17 hours sometimes to process those 19 videos",
    "start": "700550",
    "end": "706490"
  },
  {
    "text": "particularly because there also tended to be live programs later in the evening that got mixed up into this in the cloud",
    "start": "706490",
    "end": "716270"
  },
  {
    "text": "I can just allocate extra ec2 instances extra resources to process that content",
    "start": "716270",
    "end": "725630"
  },
  {
    "text": "and it's a very predictable you know we know it's going to happen at 6:30 on a weekday evening so it's a very",
    "start": "725630",
    "end": "731029"
  },
  {
    "text": "predictable pattern and we can just allocate the extra resources for the time we need it and then destroy them",
    "start": "731029",
    "end": "736670"
  },
  {
    "text": "afterwards",
    "start": "736670",
    "end": "739120"
  },
  {
    "text": "so here's the system I built we built at a very high level you can imagine this",
    "start": "741680",
    "end": "749700"
  },
  {
    "text": "is an architect's diagram it's actually a bit more complicated than this if you",
    "start": "749700",
    "end": "755040"
  },
  {
    "text": "look in the top left hand corner you can see where the broadcast video feeds come",
    "start": "755040",
    "end": "760290"
  },
  {
    "text": "into the system so we found some locations in our broadcast chain where",
    "start": "760290",
    "end": "766529"
  },
  {
    "text": "we could actually intersect the TV signals and get them at very high quality and the BBC has 24 television",
    "start": "766529",
    "end": "776370"
  },
  {
    "text": "stations particularly made up of those those variations for the nations and regions we wrote a video chunk of that",
    "start": "776370",
    "end": "787890"
  },
  {
    "text": "captured those very high definition but very high quality video and broke it",
    "start": "787890",
    "end": "795510"
  },
  {
    "text": "down into 80 megabytes and stored those up in s3 we then wrote this time",
    "start": "795510",
    "end": "802920"
  },
  {
    "text": "addressable media store which you can see in the middle and that enables us to ask for the video is broadcast on a",
    "start": "802920",
    "end": "810870"
  },
  {
    "text": "particular channel at a particular time so I could ask for the video it was broadcast on bbc1 between 9 and 10 p.m.",
    "start": "810870",
    "end": "817830"
  },
  {
    "text": "yesterday evening and what it would do under the covers is it would concatenate",
    "start": "817830",
    "end": "824430"
  },
  {
    "text": "together join together all the 80 mega bytes chunks that made up that period of",
    "start": "824430",
    "end": "829560"
  },
  {
    "text": "time and we're using a video format that that supports that concatenation process and it gives us back one large file that",
    "start": "829560",
    "end": "837690"
  },
  {
    "text": "represents that program or that time period we asked for is actually used as",
    "start": "837690",
    "end": "843990"
  },
  {
    "text": "a feature under the covers a cover that a lot of object stores support including s3 and so you can actually get that",
    "start": "843990",
    "end": "850680"
  },
  {
    "text": "concatenation to happen on the s3 side and you're not sort of downloading the files and having to join them together",
    "start": "850680",
    "end": "856110"
  },
  {
    "text": "yourself so we've now got effectively a",
    "start": "856110",
    "end": "862620"
  },
  {
    "text": "super video recorder which will have all",
    "start": "862620",
    "end": "868290"
  },
  {
    "text": "this content in high definition in actually better than High Definition very good quality",
    "start": "868290",
    "end": "874940"
  },
  {
    "text": "now we need the data that's coming in from the bottom left-hand corner that",
    "start": "875269",
    "end": "880709"
  },
  {
    "text": "play out event feed data that's data coming from our play out systems the",
    "start": "880709",
    "end": "885899"
  },
  {
    "text": "play out systems control what's being broadcast on our TV channels so they",
    "start": "885899",
    "end": "891300"
  },
  {
    "text": "control what's going out on BBC one BBC two etc they're almost you can think of them as the systems where somebody goes",
    "start": "891300",
    "end": "897300"
  },
  {
    "text": "in and sort of presses play to start an episode of Doctor Who playing on broadcast and from those systems we can",
    "start": "897300",
    "end": "906060"
  },
  {
    "text": "get time accurate we can get frame accurate timing data about the start and",
    "start": "906060",
    "end": "912029"
  },
  {
    "text": "end times of every programme so combining that data with the time",
    "start": "912029",
    "end": "919500"
  },
  {
    "text": "addressable media store we can get a source file for every program that we",
    "start": "919500",
    "end": "924569"
  },
  {
    "text": "broadcast a high resolution source video we pass that into our transcode service",
    "start": "924569",
    "end": "930029"
  },
  {
    "text": "and we wrote a sort generic transcode service layer that could sit in front of several different transcode backends and",
    "start": "930029",
    "end": "936079"
  },
  {
    "text": "so what the transcode service does is it takes that very high high resolution file and it converts it into formats",
    "start": "936079",
    "end": "944550"
  },
  {
    "text": "needed by all the different devices we support so you can imagine something like an iPhone doesn't want the video at",
    "start": "944550",
    "end": "951389"
  },
  {
    "text": "such a high resolution as something like a Smart TV originally we used ffmpeg in",
    "start": "951389",
    "end": "958860"
  },
  {
    "text": "our sort of proof of concepts but support all the different devices we needed - we ended up using elementals",
    "start": "958860",
    "end": "967110"
  },
  {
    "text": "platform as a service offering and elemental is now actually an Amazon product having converted that video into",
    "start": "967110",
    "end": "977339"
  },
  {
    "text": "the right formats we then store that in s3 and the final hop in the journey is",
    "start": "977339",
    "end": "982500"
  },
  {
    "text": "this media distribution service which takes which receives requests from the",
    "start": "982500",
    "end": "988079"
  },
  {
    "text": "audience and routes them to the video and it also is responsible for getting",
    "start": "988079",
    "end": "993990"
  },
  {
    "text": "that video out to the CDN and the various other endpoints we use to distribute the video to our audience",
    "start": "993990",
    "end": "1002019"
  },
  {
    "text": "so now I'm going to dig a little bit deeper inside one of these boxes and talk to you about how our live ingest",
    "start": "1004760",
    "end": "1011700"
  },
  {
    "start": "1005000",
    "end": "1263000"
  },
  {
    "text": "logic works",
    "start": "1011700",
    "end": "1014570"
  },
  {
    "text": "so the live ingest logic takes that data I was talking about from the playout",
    "start": "1020270",
    "end": "1025290"
  },
  {
    "text": "systems that frame accurate timing data and converts it from the rather old",
    "start": "1025290",
    "end": "1031589"
  },
  {
    "text": "format it comes out of the play out systems into JSON data we can usefully use and the rest of our applications and",
    "start": "1031589",
    "end": "1038819"
  },
  {
    "text": "that's what this broadcast event notifier system does and then it posts that data as events onto SNS topics and",
    "start": "1038820",
    "end": "1049290"
  },
  {
    "text": "in fact it posts it onto to SNS topics one for the start event saying the program has started and one for an end",
    "start": "1049290",
    "end": "1056100"
  },
  {
    "text": "event and rubber think yeah in fact just last week we announced a new feature for",
    "start": "1056100",
    "end": "1062940"
  },
  {
    "text": "the message filter for our SNS and that is much of message filtering and that actually gives the ability for the",
    "start": "1062940",
    "end": "1069060"
  },
  {
    "text": "subscribers to selectively choose the messages that they're actually interested in based on message",
    "start": "1069060",
    "end": "1074610"
  },
  {
    "text": "attributes so that's a new feature that we just launched a last week for our SNS",
    "start": "1074610",
    "end": "1079790"
  },
  {
    "text": "and so actually using that feature I wouldn't need two separate topics anymore for once one for start events",
    "start": "1079790",
    "end": "1085920"
  },
  {
    "text": "and one friend events I could actually indicate in the message header whether this was a start message or an end",
    "start": "1085920",
    "end": "1092370"
  },
  {
    "text": "message and then the subscribers could actually choose which type of messages",
    "start": "1092370",
    "end": "1097650"
  },
  {
    "text": "they were interested in and we have some systems that are interested only in end",
    "start": "1097650",
    "end": "1102810"
  },
  {
    "text": "messages and some systems that are only interested in start messages even better",
    "start": "1102810",
    "end": "1108900"
  },
  {
    "text": "actually we could now add a feature where we could add another header which",
    "start": "1108900",
    "end": "1114330"
  },
  {
    "text": "represented the TV station that the event was relative to it was rather than full and so a client come along and say",
    "start": "1114330",
    "end": "1121560"
  },
  {
    "text": "actually I only care about start events on bbc2 something like that",
    "start": "1121560",
    "end": "1128300"
  },
  {
    "text": "so as Robert mentioned earlier we've got common pattern here of an sqs Q subscribe to an SNS topic so it's",
    "start": "1130050",
    "end": "1137530"
  },
  {
    "text": "listening for those in actually this case in those that for those end events and the next component along is our",
    "start": "1137530",
    "end": "1143410"
  },
  {
    "text": "rights check is that make sure checks that we have the permission to make this particular program we've just ended",
    "start": "1143410",
    "end": "1148980"
  },
  {
    "text": "available online and if it doesn't it's all drops the message on the floor nothing carries on from that point",
    "start": "1148980",
    "end": "1156690"
  },
  {
    "text": "wouldn't the advantages of using SNS like this though is that those events are reusable by other systems inside the",
    "start": "1156690",
    "end": "1163750"
  },
  {
    "text": "BBC so our interactive TV services which actually work with the broadcast systems",
    "start": "1163750",
    "end": "1171370"
  },
  {
    "text": "and make various or red button options and things like that appear on digital",
    "start": "1171370",
    "end": "1176559"
  },
  {
    "text": "television those those services also take data from this SNS topic and there",
    "start": "1176559",
    "end": "1183250"
  },
  {
    "text": "are other services inside the BBC which also read this this these topics to get",
    "start": "1183250",
    "end": "1189580"
  },
  {
    "text": "data about when programs are starting and ending so we've come through here",
    "start": "1189580",
    "end": "1200470"
  },
  {
    "text": "we've got far as the rights checker hopefully we've got permission to put this program up online and then the",
    "start": "1200470",
    "end": "1207640"
  },
  {
    "text": "right to check her rights a message out to another queue which is then read by the time addressable media store and",
    "start": "1207640",
    "end": "1213760"
  },
  {
    "text": "passes onto the trans Cove service which so we create the high-res file from the",
    "start": "1213760",
    "end": "1220000"
  },
  {
    "text": "time dressed for media store pass a request with that onto the transcode service and eventually works its way",
    "start": "1220000",
    "end": "1225970"
  },
  {
    "text": "through the chain to the media distribution service this is actually quite a high level diagram in reality",
    "start": "1225970",
    "end": "1234730"
  },
  {
    "text": "the system's actually made up at this stage of about 30 separate micro services and it's daisy chaining like",
    "start": "1234730",
    "end": "1241450"
  },
  {
    "text": "this it's passing messages from one service to another and so by a synchronous mokra service style",
    "start": "1241450",
    "end": "1247260"
  },
  {
    "text": "throughout the works though",
    "start": "1247260",
    "end": "1250890"
  },
  {
    "text": "so now going to talk a little bit about some of the patterns we use for actually writing those individual microservices",
    "start": "1252620",
    "end": "1262389"
  },
  {
    "start": "1263000",
    "end": "1369000"
  },
  {
    "text": "so this is literally typically what one of our services would look like it's got",
    "start": "1263830",
    "end": "1269419"
  },
  {
    "text": "an input queue it takes a message from import queue it writes a message to an output queue and it does some processing",
    "start": "1269419",
    "end": "1276159"
  },
  {
    "text": "that's been in the middle that's indicated by the message what it should",
    "start": "1276159",
    "end": "1281450"
  },
  {
    "text": "do we use this style because it suits us",
    "start": "1281450",
    "end": "1290090"
  },
  {
    "text": "very well that a message is a unit of work it's something that we want to get done and queuing systems and particular",
    "start": "1290090",
    "end": "1297320"
  },
  {
    "text": "sqs are very good at sort promising you the integrity of those messages she's not going to lose a piece of work you're",
    "start": "1297320",
    "end": "1304250"
  },
  {
    "text": "not going to lose a message and in our case one of those units of work is something like getting an episode of",
    "start": "1304250",
    "end": "1309770"
  },
  {
    "text": "Sherlock on to iPlayer and if we were to lose it people would get upset and complain about you know why isn't it",
    "start": "1309770",
    "end": "1316100"
  },
  {
    "text": "often I play yeah where has it gone",
    "start": "1316100",
    "end": "1319450"
  },
  {
    "text": "and running on each service is actually",
    "start": "1324210",
    "end": "1329830"
  },
  {
    "text": "it's a java application we use the camel framework and in fact we've extended the",
    "start": "1329830",
    "end": "1336100"
  },
  {
    "text": "sqs support inside camel and fed that back into the open source project and",
    "start": "1336100",
    "end": "1344399"
  },
  {
    "text": "each of those applications is running on a c2 instance and doesn't really know",
    "start": "1344399",
    "end": "1349570"
  },
  {
    "text": "much about the cues it's interacting with it knows it's got an abstract concept of an input queue and an output queue the actual AR ends the actual",
    "start": "1349570",
    "end": "1356350"
  },
  {
    "text": "physical locations if you like of those queues aren't fed until deployment time and we feed them in through",
    "start": "1356350",
    "end": "1361990"
  },
  {
    "text": "CloudFormation so what happens if lots",
    "start": "1361990",
    "end": "1373929"
  },
  {
    "text": "of work backs up on one of these queues what happens if we suddenly get a rush of people trying to put content up onto",
    "start": "1373929",
    "end": "1380350"
  },
  {
    "text": "iPlayer do you get all these messages queue up now we don't actually normally",
    "start": "1380350",
    "end": "1388659"
  },
  {
    "text": "run just one copy of the service one instance of the service will normally run at least three instances in an auto",
    "start": "1388659",
    "end": "1396070"
  },
  {
    "text": "scaling group and each one of those instances is in a different availability zone but it's actually very easy with",
    "start": "1396070",
    "end": "1406059"
  },
  {
    "text": "the auto scaling group for us to increase the number of instances that were running and here we're using",
    "start": "1406059",
    "end": "1414190"
  },
  {
    "text": "something the the competing consumer pattern so when one of the nice properties of queues is when one of",
    "start": "1414190",
    "end": "1420159"
  },
  {
    "text": "these instances gets a message from the queue it effectively hides it from anybody any of the other instances that",
    "start": "1420159",
    "end": "1427510"
  },
  {
    "text": "are working on that same queue this means they don't tread on each of those toes they don't both try to do all",
    "start": "1427510",
    "end": "1433539"
  },
  {
    "text": "all try to do the same piece of work at the same time and the nice effect this",
    "start": "1433539",
    "end": "1441159"
  },
  {
    "text": "has for scaling is that I can go from these three instances to perhaps thirty instances and be pretty confident I'll",
    "start": "1441159",
    "end": "1448539"
  },
  {
    "text": "get a ten times increase in the speed that messages are taken away from the",
    "start": "1448539",
    "end": "1453610"
  },
  {
    "text": "queue because the instances are pretty much acting in dependent lis of each other and I'm going to tread on each other's toes and",
    "start": "1453610",
    "end": "1459450"
  },
  {
    "text": "get in each other's way in some cases we actually connect the cloud the metrics",
    "start": "1459450",
    "end": "1467670"
  },
  {
    "text": "from the Q the Q depth to the auto scaling group so that if the queue depth",
    "start": "1467670",
    "end": "1473160"
  },
  {
    "text": "reaches a particular threshold then we start automatically spinning up extra",
    "start": "1473160",
    "end": "1478260"
  },
  {
    "text": "instances to cope with the to cope with that extra workload",
    "start": "1478260",
    "end": "1483260"
  },
  {
    "text": "when you get a message from the queue you actually specify amount of time you",
    "start": "1491019",
    "end": "1498409"
  },
  {
    "text": "want the message to be hidden for and we",
    "start": "1498409",
    "end": "1504019"
  },
  {
    "text": "would typically use about 30 seconds and you can extend that you can say it's taking me a bit longer to take process",
    "start": "1504019",
    "end": "1509629"
  },
  {
    "text": "this message I want to extend the the period the message is hidden for give me another 30 seconds give me another",
    "start": "1509629",
    "end": "1515330"
  },
  {
    "text": "minute something like that but if the service fails for some reason you know",
    "start": "1515330",
    "end": "1522289"
  },
  {
    "text": "the java application crash is the ec2 instance goes away then that timeout",
    "start": "1522289",
    "end": "1527600"
  },
  {
    "text": "will be reached and the message will reappear on the queue ready for one of",
    "start": "1527600",
    "end": "1534919"
  },
  {
    "text": "the other instances perhaps to pick up and process and we rely on this because",
    "start": "1534919",
    "end": "1542330"
  },
  {
    "text": "not only is it the fact that ec2 instances can and do go away but we actually run chaos monkey in our",
    "start": "1542330",
    "end": "1547999"
  },
  {
    "text": "production systems so chaos monkey can come along quite happily and stomp on one of these instances blow it away",
    "start": "1547999",
    "end": "1555460"
  },
  {
    "text": "while it's in the middle of processing a message but 30 seconds later or up to 30",
    "start": "1555460",
    "end": "1563600"
  },
  {
    "text": "seconds later with our default visibility that message will become available again at the top of the queue",
    "start": "1563600",
    "end": "1569600"
  },
  {
    "text": "ready for one of the instances to process and also the auto scaling group will notice that an ec2 instance has",
    "start": "1569600",
    "end": "1576289"
  },
  {
    "text": "gone away and spin us up a new ec2 instance to replace it so here's an",
    "start": "1576289",
    "end": "1585529"
  },
  {
    "text": "example of the good path this is what should happen if everything's going well",
    "start": "1585529",
    "end": "1590769"
  },
  {
    "text": "instance takes the message off the queue we process the message within the time",
    "start": "1590769",
    "end": "1597799"
  },
  {
    "text": "the timeout period the period we keep the message hidden for and we place a message on the output cube only at this",
    "start": "1597799",
    "end": "1606109"
  },
  {
    "text": "point do we then delete the original message from the input queue so this does run the risk of us possibly",
    "start": "1606109",
    "end": "1612919"
  },
  {
    "text": "duplicating the message possibly putting two messages on the output queue but it means that at no point is the message",
    "start": "1612919",
    "end": "1620649"
  },
  {
    "text": "every point in the message is on at least q there's no point at which we're in",
    "start": "1620649",
    "end": "1625840"
  },
  {
    "text": "danger of if the app crashed at that exact moment we'd lose some data so we always have this pattern of writing the",
    "start": "1625840",
    "end": "1632200"
  },
  {
    "text": "output message first and then deleting the input message and you have to",
    "start": "1632200",
    "end": "1639190"
  },
  {
    "text": "generally design your apps for the you know sqs can duplicate messages on you I'll talk a little bit about that later",
    "start": "1639190",
    "end": "1645519"
  },
  {
    "text": "so you generally do design your apps to be idempotent anyway and be able to cope with duplicate messages so the risk of",
    "start": "1645519",
    "end": "1652899"
  },
  {
    "text": "us putting two output message do you know the same message twice on the output q is actually not too bad for us",
    "start": "1652899",
    "end": "1661019"
  },
  {
    "start": "1662000",
    "end": "1929000"
  },
  {
    "text": "so that gives us what I've just spoken out gives us a sort of standard way to cope with scaling across all our",
    "start": "1663480",
    "end": "1670179"
  },
  {
    "text": "microcircuits the very standard pattern we can easily use for pretty much any of our services",
    "start": "1670179",
    "end": "1677759"
  },
  {
    "text": "and now I'm going to talk a little bit about error handling our patterns we use for that so earlier I mentioned how",
    "start": "1677759",
    "end": "1687039"
  },
  {
    "text": "there is this visibility timeout you can hide messages and if the application crashes or the ec2 instance goes away",
    "start": "1687039",
    "end": "1693629"
  },
  {
    "text": "eventually the message will become visible again actually using a feature",
    "start": "1693629",
    "end": "1699249"
  },
  {
    "text": "of Kamel we take that a step further and if there's ever an exception we're not",
    "start": "1699249",
    "end": "1706029"
  },
  {
    "text": "expecting inside our application than with the way we've got the camel framework set up that message if it",
    "start": "1706029",
    "end": "1712629"
  },
  {
    "text": "propagates to the top layer will actually cause camel just to stop processing that message it'll basically forget about that message and give up on",
    "start": "1712629",
    "end": "1719080"
  },
  {
    "text": "it and that means again we'll hit the visibility timeout the message will reappear on the queue and another",
    "start": "1719080",
    "end": "1725200"
  },
  {
    "text": "instance will have a go at processing it reason this is quite nice is because",
    "start": "1725200",
    "end": "1731350"
  },
  {
    "text": "that actually smooths over an awful lots of sort of unexpected errors that you",
    "start": "1731350",
    "end": "1736450"
  },
  {
    "text": "might come across things like Network timeouts or systems not being available if there's a sort of glitch in the",
    "start": "1736450",
    "end": "1742690"
  },
  {
    "text": "system you know a temporary network problem actually giving the message sort of giving the system about 30 seconds to",
    "start": "1742690",
    "end": "1750039"
  },
  {
    "text": "you know hopefully go away and then retrying often just smooths over the",
    "start": "1750039",
    "end": "1755230"
  },
  {
    "text": "problem makes it go away and it gives us very standard error handling code we're not having to write anything special here this is",
    "start": "1755230",
    "end": "1761110"
  },
  {
    "text": "effectively built into our system and we're getting it for free so there's no chance of us making error you know",
    "start": "1761110",
    "end": "1767080"
  },
  {
    "text": "making mistakes in our error handling code that we only find out when things are already blowing up but there is a",
    "start": "1767080",
    "end": "1775150"
  },
  {
    "text": "problem you've got to be aware of what happens if that message is actually the",
    "start": "1775150",
    "end": "1783160"
  },
  {
    "text": "cause of the problem is it called pot this is poisoned message problem what happens if trying to process that",
    "start": "1783160",
    "end": "1788740"
  },
  {
    "text": "message actually caused your application to crash that would be really bad",
    "start": "1788740",
    "end": "1793990"
  },
  {
    "text": "because what would happen is you'd pick the message off the queue try to process it crash visibility timeout would be",
    "start": "1793990",
    "end": "1801400"
  },
  {
    "text": "reached message would reappear at the top of the queue another instance would try and pick up the message try and",
    "start": "1801400",
    "end": "1806560"
  },
  {
    "text": "process it crash and that you know you can see how that would get quite annoying over time lead to you spinning",
    "start": "1806560",
    "end": "1811990"
  },
  {
    "text": "up a lot of ec2 instances or restarting the application many times so there's a",
    "start": "1811990",
    "end": "1820570"
  },
  {
    "text": "feature in sqs called the we drive policy and sort of more generically it's",
    "start": "1820570",
    "end": "1825670"
  },
  {
    "text": "normally called a dead letter Q pattern and that counts the number of times we try to process the message and will",
    "start": "1825670",
    "end": "1832660"
  },
  {
    "text": "typically use something like five tries and if we try and process the message more than five times then the message",
    "start": "1832660",
    "end": "1838840"
  },
  {
    "text": "gets routed off to one side popping a dead letter Q and in our case we",
    "start": "1838840",
    "end": "1844720"
  },
  {
    "text": "actually just have an alert set on that queue which lets our monitoring team know that there are messages on that",
    "start": "1844720",
    "end": "1850420"
  },
  {
    "text": "queue that alert is literally set to go off if there's more than zero messages on that queue and the human can come",
    "start": "1850420",
    "end": "1856870"
  },
  {
    "text": "along and investigate why if we've got a message there what's gone wrong is there",
    "start": "1856870",
    "end": "1862180"
  },
  {
    "text": "some bigger outage it goes to our operations team who I mean the normal",
    "start": "1862180",
    "end": "1867940"
  },
  {
    "text": "case the normal case for these sorts of problems are that there's some dependent system that's down if some dependent",
    "start": "1867940",
    "end": "1874180"
  },
  {
    "text": "systems down we know that our operations team are already very aware and can see",
    "start": "1874180",
    "end": "1879880"
  },
  {
    "text": "yeah okay we've got messages piling up and a dead letter Q one of the nice side",
    "start": "1879880",
    "end": "1885760"
  },
  {
    "text": "effects of this is in cases where one of the systems depend on is down we can actually we",
    "start": "1885760",
    "end": "1891799"
  },
  {
    "text": "actually don't keep on hammering it will try five times but will then move the message to one side we want to sit there",
    "start": "1891799",
    "end": "1898059"
  },
  {
    "text": "increasingly trying to sort of process more and more work and hammering the system which is probably having trouble",
    "start": "1898059",
    "end": "1903549"
  },
  {
    "text": "harder and harder and we provide tools to our operations teams that they can easily respawn those messages from the",
    "start": "1903549",
    "end": "1910669"
  },
  {
    "text": "dead letter Q back onto the input q when they know everything is happy again and there are further further tools we have",
    "start": "1910669",
    "end": "1918049"
  },
  {
    "text": "that enable our development team to investigate the root causes of a dead letter message arriving on a dead letter",
    "start": "1918049",
    "end": "1923539"
  },
  {
    "text": "Q if it's not a scenario like that so",
    "start": "1923539",
    "end": "1930739"
  },
  {
    "start": "1929000",
    "end": "2122000"
  },
  {
    "text": "I've talked a little bit about some of our generic patterns for writing these and these message driven micro services",
    "start": "1930739",
    "end": "1936789"
  },
  {
    "text": "now I'm going to focus on another component in our systems time addressable media store at the heart of",
    "start": "1936789",
    "end": "1942979"
  },
  {
    "text": "the system I'm going to use that as an example of how we debug our systems how",
    "start": "1942979",
    "end": "1949999"
  },
  {
    "text": "we understand what's going on we've got",
    "start": "1949999",
    "end": "1955369"
  },
  {
    "text": "in the original 2013 version as they say architecture it was made up of about 30",
    "start": "1955369",
    "end": "1962299"
  },
  {
    "text": "micro services since then we've added support for radio we've added support for live television many other features",
    "start": "1962299",
    "end": "1969919"
  },
  {
    "text": "to the system downloads and things like that and so it's up to over a hundred micro services now each one of those is",
    "start": "1969919",
    "end": "1977419"
  },
  {
    "text": "typically running at least three instances you can imagine how much trouble it would be if you were going",
    "start": "1977419",
    "end": "1983960"
  },
  {
    "text": "through the system and trying to work out what had gone wrong and having to go through the individual log files on all those more than three hundred machines",
    "start": "1983960",
    "end": "1992320"
  },
  {
    "text": "so from the very start we built the system so that we could easily debug a",
    "start": "1992320",
    "end": "1997700"
  },
  {
    "text": "piece of work each message as it enters",
    "start": "1997700",
    "end": "2003009"
  },
  {
    "text": "the system so for example when we get that end event giving us the big",
    "start": "2003009",
    "end": "2008830"
  },
  {
    "text": "accurate times for a program each message that is at the start of the system gets given a unique identifier we",
    "start": "2008830",
    "end": "2016359"
  },
  {
    "text": "call the correlation ID and that message that correlation ID gets copied from message to message as",
    "start": "2016359",
    "end": "2024130"
  },
  {
    "text": "the piece of work progresses for the system then as each of our services are",
    "start": "2024130",
    "end": "2030559"
  },
  {
    "text": "actually doing work points that are important to the business they'll generate events and they actually",
    "start": "2030559",
    "end": "2037580"
  },
  {
    "text": "generate these as SNS events so in the example the time addressable media store",
    "start": "2037580",
    "end": "2042799"
  },
  {
    "text": "if it can find all the chunks it will generate that as an event if it's actually successfully created the new",
    "start": "2042799",
    "end": "2048440"
  },
  {
    "text": "high-resolution source file it'll generate that as an event it isn't at the same level as logging it's much more",
    "start": "2048440",
    "end": "2055280"
  },
  {
    "text": "sort of business focused it's I've made a decision or I've succeeded in doing something but there's still that several",
    "start": "2055280",
    "end": "2062089"
  },
  {
    "text": "key points for each service will generate these events we generate them to SNS to an SNS topic and we've",
    "start": "2062089",
    "end": "2068510"
  },
  {
    "text": "actually got a bridge that takes those events and puts them into our log analysis systems or use Blunk in our",
    "start": "2068510",
    "end": "2074480"
  },
  {
    "text": "case and that means I can take that correlation ID put it into Splunk and",
    "start": "2074480",
    "end": "2080540"
  },
  {
    "text": "see every much service that this piece of work has got every piece of work that's been triggered by a program a",
    "start": "2080540",
    "end": "2088429"
  },
  {
    "text": "particular program ending imagine this",
    "start": "2088429",
    "end": "2095628"
  },
  {
    "text": "makes it much much easier for us to see what's going on we can do all sorts of graphs and things of you know how many",
    "start": "2095629",
    "end": "2101720"
  },
  {
    "text": "how many messages we throw how many programs we've processed in the last hour and things like that and look at",
    "start": "2101720",
    "end": "2107750"
  },
  {
    "text": "all the different events and all the different systems very easily",
    "start": "2107750",
    "end": "2114760"
  },
  {
    "start": "2122000",
    "end": "2444000"
  },
  {
    "text": "and finally I'm going to talk a little bit about a slightly different pattern",
    "start": "2122710",
    "end": "2129490"
  },
  {
    "text": "here which is the media distribution service at the end so up to this point",
    "start": "2129490",
    "end": "2136060"
  },
  {
    "text": "all of the messages we've been working with have been around a message",
    "start": "2136060",
    "end": "2142910"
  },
  {
    "text": "representing a unit of work something we're actually trying to do and in this case actually a message is more of a",
    "start": "2142910",
    "end": "2148610"
  },
  {
    "text": "hint it's more of a there's something we'd quite like you to do but don't worry too much about it so the media",
    "start": "2148610",
    "end": "2156740"
  },
  {
    "text": "distribution service in this case it's actually audience facing it's taking requests from the audience every time",
    "start": "2156740",
    "end": "2162890"
  },
  {
    "text": "somebody's trying to play a video on iPlayer this service gets called and asked where's the best place for me to",
    "start": "2162890",
    "end": "2169190"
  },
  {
    "text": "get the video from what's the closest you know geographical location for me or network location for me which CDN should",
    "start": "2169190",
    "end": "2176330"
  },
  {
    "text": "I use that sort of thing that means it's a unique response for every user which",
    "start": "2176330",
    "end": "2183170"
  },
  {
    "text": "is a bit of a nuisance because it means I can't cash the responses but what we",
    "start": "2183170",
    "end": "2188390"
  },
  {
    "text": "do is we end up using a sort of mid tier cache to be able to at least generate those responses very quickly so using a",
    "start": "2188390",
    "end": "2195290"
  },
  {
    "text": "rusty cash and Redis in particular at this middle layer so we've got at the",
    "start": "2195290",
    "end": "2200900"
  },
  {
    "text": "back end and availability database which knows when a program should be made available who it should be made",
    "start": "2200900",
    "end": "2206750"
  },
  {
    "text": "available to in which in which areas it should be made available and that's",
    "start": "2206750",
    "end": "2214820"
  },
  {
    "text": "that's the source of truth in this case but it's a bit slow it's certainly you",
    "start": "2214820",
    "end": "2222410"
  },
  {
    "text": "know considering this is the gap between somebody pressing play and actually seeing the video they want to see we'd",
    "start": "2222410",
    "end": "2228410"
  },
  {
    "text": "like to keep this sort of down to below 20 milliseconds so we don't really want to do a big database lock up and",
    "start": "2228410",
    "end": "2235790"
  },
  {
    "text": "actually that available aid availability database is one of our older systems so it can sometimes take quite a little",
    "start": "2235790",
    "end": "2240950"
  },
  {
    "text": "while to get a response so we put this",
    "start": "2240950",
    "end": "2246980"
  },
  {
    "text": "last e cache layer in the middle so that we catch the result as we as we look it",
    "start": "2246980",
    "end": "2254750"
  },
  {
    "text": "up for the first and ideally you just leave the values",
    "start": "2254750",
    "end": "2261739"
  },
  {
    "text": "there but there's a problem with BBC",
    "start": "2261739",
    "end": "2267019"
  },
  {
    "text": "television programs particularly in that we're quite sensitive to sometimes needing to take a program down for a",
    "start": "2267019",
    "end": "2273349"
  },
  {
    "text": "reason that might be because we don't think that programmes particularly",
    "start": "2273349",
    "end": "2278809"
  },
  {
    "text": "suitable to being online anymore because of a news event that's happened there's",
    "start": "2278809",
    "end": "2284779"
  },
  {
    "text": "a case in the UK where if one of our documentary programmes has caused a",
    "start": "2284779",
    "end": "2290239"
  },
  {
    "text": "court case to start happening and that caught the legal proceedings to start happening and that court case actually",
    "start": "2290239",
    "end": "2295640"
  },
  {
    "text": "starts while that program still on iPlayer we have to take that program down there were seen as biasing the",
    "start": "2295640",
    "end": "2302150"
  },
  {
    "text": "trial so there's actually we only cache that",
    "start": "2302150",
    "end": "2307160"
  },
  {
    "text": "information for a few minutes because we want to be able to very quickly take a program down if it's updated in the",
    "start": "2307160",
    "end": "2313549"
  },
  {
    "text": "availability database and we're told we're no longer allowed to broadcast it",
    "start": "2313549",
    "end": "2318729"
  },
  {
    "text": "this Cape creates quite a challenge on that that middle layer because we've got",
    "start": "2318729",
    "end": "2325849"
  },
  {
    "text": "these you know 10 million 20 million audiences you know lots of people using iPlayer and lots of individual requests",
    "start": "2325849",
    "end": "2333769"
  },
  {
    "text": "coming in and they get a data cache where we can only have a relatively",
    "start": "2333769",
    "end": "2338930"
  },
  {
    "text": "limited cache time so what we do is when",
    "start": "2338930",
    "end": "2344420"
  },
  {
    "text": "we receive a message from the audience well request for the audience to the video we first check the cache the",
    "start": "2344420",
    "end": "2350119"
  },
  {
    "text": "ElastiCache Redis if the message is already in there great if the entry is",
    "start": "2350119",
    "end": "2355369"
  },
  {
    "text": "already in there great if it's not ok we have to go and make a synchronous call to the backend but if there's an entry",
    "start": "2355369",
    "end": "2362809"
  },
  {
    "text": "in the cache and it's it's fresh that's great we returned immediately to the",
    "start": "2362809",
    "end": "2368119"
  },
  {
    "text": "audience if it's not so fresh anymore if it's coming towards the end of its timeout period maybe it's a minute old",
    "start": "2368119",
    "end": "2373430"
  },
  {
    "text": "or something like that what we'll do is we'll put a message on a queue which is",
    "start": "2373430",
    "end": "2378529"
  },
  {
    "text": "read asynchronously by the availability database and that gives a hint that",
    "start": "2378529",
    "end": "2384259"
  },
  {
    "text": "system that would quite like you to go and update the cache it's not like super",
    "start": "2384259",
    "end": "2389869"
  },
  {
    "text": "urgent but we'd quite like you to do it and having put that message on the queue then we then immediately return to thee",
    "start": "2389869",
    "end": "2395390"
  },
  {
    "text": "to the audience member we don't wait for any response from the availability database before doing anything else but",
    "start": "2395390",
    "end": "2401990"
  },
  {
    "text": "this asynchronously keeps the the cache up-to-date that keeps on refreshing the",
    "start": "2401990",
    "end": "2407480"
  },
  {
    "text": "liveliness of the cash but messages here are sort of hints so we tend to put a a",
    "start": "2407480",
    "end": "2415190"
  },
  {
    "text": "time to live on the messages of about a minute or so because what we don't want",
    "start": "2415190",
    "end": "2420470"
  },
  {
    "text": "is perhaps there's some problem with availability dates based in a huge number of these requests start piling up",
    "start": "2420470",
    "end": "2425809"
  },
  {
    "text": "on the queue and by the time it gets around to processing them they probably wouldn't be rather than - any more than",
    "start": "2425809",
    "end": "2431809"
  },
  {
    "text": "might even be for a program that isn't available anymore so we put a time to live on the messages so they they expire",
    "start": "2431809",
    "end": "2438130"
  },
  {
    "text": "after a minute or so so just want to",
    "start": "2438130",
    "end": "2447109"
  },
  {
    "start": "2444000",
    "end": "2716000"
  },
  {
    "text": "summarize what we've managed to achieve by taking this approach not much happier",
    "start": "2447109",
    "end": "2453440"
  },
  {
    "text": "audiences you know previously at the start of the talk I was took mentioning we were having to employ people to go through",
    "start": "2453440",
    "end": "2459980"
  },
  {
    "text": "the schedules and work out which programs to put online we don't have to do that anymore we've got the rights to",
    "start": "2459980",
    "end": "2465680"
  },
  {
    "text": "put the program online we're going to put the program online that's led to",
    "start": "2465680",
    "end": "2471890"
  },
  {
    "text": "100% increase in the amount of content that's available on iPlayer immediately when we rolled out this system and a 700",
    "start": "2471890",
    "end": "2479329"
  },
  {
    "text": "percent increase in about HD content we were making available and that's only increased over time at the same time is",
    "start": "2479329",
    "end": "2489619"
  },
  {
    "text": "moving to the cloud and moving to this asynchronous microservices architecture we also moved to continuous delivery as",
    "start": "2489619",
    "end": "2496880"
  },
  {
    "text": "our development mechanism and that's worked really well in combination with this micro services architecture because",
    "start": "2496880",
    "end": "2503540"
  },
  {
    "text": "we're now when we deliver when we're releasing a new piece of software we're",
    "start": "2503540",
    "end": "2508579"
  },
  {
    "text": "just replacing one of these small micro services we have a very good idea of what the impact is going to be",
    "start": "2508579",
    "end": "2514950"
  },
  {
    "text": "we can see what the blast radius effectively will be and we've got tooling in place now that enables us to",
    "start": "2514950",
    "end": "2520589"
  },
  {
    "text": "deploy a change in 15 minutes we're",
    "start": "2520589",
    "end": "2526230"
  },
  {
    "text": "typically making about thirty deployments about thirty to I think it is at the moment deployments to live",
    "start": "2526230",
    "end": "2533900"
  },
  {
    "text": "each week and sees a development team of about thirty people so it's about you",
    "start": "2533900",
    "end": "2539280"
  },
  {
    "text": "know it's averaging out about one deployment to live per developer per week it's also this system with the",
    "start": "2539280",
    "end": "2551339"
  },
  {
    "text": "queues and how everything's wired together is very easy for us to adapt and add new pieces in and add extra",
    "start": "2551339",
    "end": "2557700"
  },
  {
    "text": "micro services and that's enabled us to first add radio into the system so radio",
    "start": "2557700",
    "end": "2563369"
  },
  {
    "text": "used to be a completely separate product use completely separate back-end but",
    "start": "2563369",
    "end": "2568589"
  },
  {
    "text": "actually has a lot of business logic in common with the video product so you can imagine getting the media files out to",
    "start": "2568589",
    "end": "2575940"
  },
  {
    "text": "the audience is basically the same problem it's getting it to a CDN telling them weather like right location it's",
    "start": "2575940",
    "end": "2581579"
  },
  {
    "text": "for them to find the files and there's a lot of actually the business logic before that point that is also shared so",
    "start": "2581579",
    "end": "2591240"
  },
  {
    "text": "using this approach this asynchronous Micra services approach it very easy to merge that extra functionality and put",
    "start": "2591240",
    "end": "2598200"
  },
  {
    "text": "bridging points in put decision points in where the systems did have to be different more recently we've added a",
    "start": "2598200",
    "end": "2605220"
  },
  {
    "text": "live into this system and that's actually been very useful that's you know similar house of what we call simulcast what's being broadcast now and",
    "start": "2605220",
    "end": "2611670"
  },
  {
    "text": "by merging that inter system we've actually been able to make some real",
    "start": "2611670",
    "end": "2617390"
  },
  {
    "text": "savings in terms of time because we're already transcoding the video once are actually the live version of the program",
    "start": "2617390",
    "end": "2623839"
  },
  {
    "text": "we can now actually reuse that video as the catch-up version that means I can",
    "start": "2623839",
    "end": "2629760"
  },
  {
    "text": "make a program perhaps something like a tennis match which might be three or four hours long it would normally take",
    "start": "2629760",
    "end": "2635280"
  },
  {
    "text": "it previously take duration for us to transcode it so it'd be three or four hours before the catch-up version that",
    "start": "2635280",
    "end": "2641310"
  },
  {
    "text": "program was up an AI player by merging the live system in with this",
    "start": "2641310",
    "end": "2647920"
  },
  {
    "text": "I'm now able to do that in about 10 minutes there's a much smaller delay for our audience in being able to watch a",
    "start": "2647920",
    "end": "2655840"
  },
  {
    "text": "tennis match for a sports event that I missed any life event what they missed",
    "start": "2655840",
    "end": "2662310"
  },
  {
    "text": "you can see the I talked about scalability earlier and the increase in",
    "start": "2662910",
    "end": "2669100"
  },
  {
    "text": "volumes were able to cope with we haven't we've yet to reach the upper bounds of the scalability of the system",
    "start": "2669100",
    "end": "2674770"
  },
  {
    "text": "we literally it's coped with everything we've thrown at it and yeah we're very",
    "start": "2674770",
    "end": "2680320"
  },
  {
    "text": "very happy with with that and we've got",
    "start": "2680320",
    "end": "2685810"
  },
  {
    "text": "improved resilience I mean the system I was talking about that we were running in 2012 was a single site system you",
    "start": "2685810",
    "end": "2691600"
  },
  {
    "text": "know we're now spread across the three availability zones we've got the auto scaling groups monitoring the health of",
    "start": "2691600",
    "end": "2698740"
  },
  {
    "text": "the ec2 instances and restarting them if they go away it's a much more reliable system and we've got the the sqs queues",
    "start": "2698740",
    "end": "2707880"
  },
  {
    "text": "making sure that the messages the units of work are durable and reliable",
    "start": "2707880",
    "end": "2714060"
  },
  {
    "start": "2716000",
    "end": "2879000"
  },
  {
    "text": "so what are the sort of lessons we learnt doing this piece of work well so",
    "start": "2717940",
    "end": "2723460"
  },
  {
    "text": "I mentioned earlier that it is possible for either during your own application",
    "start": "2723460",
    "end": "2728980"
  },
  {
    "text": "design or actually sqs can do it to you anyway into certain error conditions messages can get duplicated so you might",
    "start": "2728980",
    "end": "2736720"
  },
  {
    "text": "want to consider designing for idempotency but I think Robert has something to say on that yeah so",
    "start": "2736720",
    "end": "2742660"
  },
  {
    "text": "actually with sqs the queuing service we actually have two Q types there's a standard queued and we also have five",
    "start": "2742660",
    "end": "2748960"
  },
  {
    "text": "whole queues and with the five hole queues that provides once only delivery",
    "start": "2748960",
    "end": "2754530"
  },
  {
    "text": "okay so that means that in some cases actually in the systems when we",
    "start": "2754530",
    "end": "2760630"
  },
  {
    "text": "originally built this I would have to write components that would look for duplicates and things like that I don't have to do that anymore I could just",
    "start": "2760630",
    "end": "2766450"
  },
  {
    "text": "build on that piece of functionality the",
    "start": "2766450",
    "end": "2772780"
  },
  {
    "text": "elastic scaling is great for our sorts of scenarios if we suddenly get a burst of work you know something like the",
    "start": "2772780",
    "end": "2779470"
  },
  {
    "text": "Olympics is a really good example for the Rio Olympics we basically we ran a",
    "start": "2779470",
    "end": "2785230"
  },
  {
    "text": "set provide a second iPlayer effectively the amount of extra content we put through the system basically just",
    "start": "2785230",
    "end": "2791020"
  },
  {
    "text": "doubled the amount of video we were putting online during that fortnight and the elastic scaling great works great",
    "start": "2791020",
    "end": "2797589"
  },
  {
    "text": "for those sorts of scenarios but even better is the cost model is that I can",
    "start": "2797589",
    "end": "2803230"
  },
  {
    "text": "go to my business owners and sort of say look this is how much it's going to cost it's a very predictable cost and I don't",
    "start": "2803230",
    "end": "2808480"
  },
  {
    "text": "get these sudden sort of surprise spikes where I have to buy a new rack or I've run out of space in a data center or",
    "start": "2808480",
    "end": "2815440"
  },
  {
    "text": "those sorts of things this pattern of you know these reliable",
    "start": "2815440",
    "end": "2822279"
  },
  {
    "text": "pipelines and micro services that we've built with sqs in between them seem to",
    "start": "2822279",
    "end": "2829750"
  },
  {
    "text": "work really well for us in a nice way of us building a complicated workflow",
    "start": "2829750",
    "end": "2834930"
  },
  {
    "text": "that's reliable and can scale and can cope with a different different works",
    "start": "2834930",
    "end": "2841900"
  },
  {
    "text": "there were different types of work that come in at different types of day at times a day and depending on patterns of",
    "start": "2841900",
    "end": "2848349"
  },
  {
    "text": "use and yeah the final thing I guess I've mentioned is think about how if you're",
    "start": "2848349",
    "end": "2853940"
  },
  {
    "text": "going to build a system like this think about how you're going to debug it we're very very grateful we sort of built",
    "start": "2853940",
    "end": "2859520"
  },
  {
    "text": "those patterns in from the start which had the sub correlation IDs and the the",
    "start": "2859520",
    "end": "2864920"
  },
  {
    "text": "event logging so we could very easily see what was going on in the system and",
    "start": "2864920",
    "end": "2869930"
  },
  {
    "text": "weren't chasing through log files on the gazillion different machines trying to work out what was going on so I've",
    "start": "2869930",
    "end": "2881450"
  },
  {
    "start": "2879000",
    "end": "3109000"
  },
  {
    "text": "talked to you a little bit about what we've you know the journey we've been on how we've managed to build a much more",
    "start": "2881450",
    "end": "2887360"
  },
  {
    "text": "reliable system that can scale much better based on queuing technology now",
    "start": "2887360",
    "end": "2895100"
  },
  {
    "text": "we're not having to run around dumping the culprit the contents of databases",
    "start": "2895100",
    "end": "2900140"
  },
  {
    "text": "out to text files and feed them back in to make the system stable again we freed up a little bit of time so what we're",
    "start": "2900140",
    "end": "2906470"
  },
  {
    "text": "doing with that extra development time we've got available now so you can see",
    "start": "2906470",
    "end": "2912140"
  },
  {
    "text": "that iPlayer forms sort of if you like the IP distribution part of the BBC it's",
    "start": "2912140",
    "end": "2917450"
  },
  {
    "text": "the way we can get video and audio out the audience over the Internet we're now",
    "start": "2917450",
    "end": "2925490"
  },
  {
    "text": "actually coming to a stage where we're seeing cameras and audio devices microphones and things like that themselves start to become IP devices so",
    "start": "2925490",
    "end": "2934580"
  },
  {
    "text": "you're actually getting IP streams out of some of these devices this increasingly looks like the way the",
    "start": "2934580",
    "end": "2940490"
  },
  {
    "text": "industry is moving so wouldn't it be nice to be able to sort of join those",
    "start": "2940490",
    "end": "2947270"
  },
  {
    "text": "two systems together and not having to go back into the old non IP world while",
    "start": "2947270",
    "end": "2954590"
  },
  {
    "text": "we're getting content out the audience particularly things like the live content and so our R&D department have",
    "start": "2954590",
    "end": "2962150"
  },
  {
    "text": "been working on what they called IP studio and working with many of the standards bodies in the industry to",
    "start": "2962150",
    "end": "2969650"
  },
  {
    "text": "develop these standards around what it would look like to get IP out of a camera be able to store that raw video",
    "start": "2969650",
    "end": "2976910"
  },
  {
    "text": "coming out of the camera perhaps in something like s3 or some centralized store and then build tooling on top of that",
    "start": "2976910",
    "end": "2983780"
  },
  {
    "text": "which enables you to put a production gallery in the get cloud where the director is actually choosing which",
    "start": "2983780",
    "end": "2991040"
  },
  {
    "text": "camera we're broadcasting from but using these sort of cloud-based technologies",
    "start": "2991040",
    "end": "2997400"
  },
  {
    "text": "and be able to store all that raw video in something like s3 that means for",
    "start": "2997400",
    "end": "3004839"
  },
  {
    "text": "example if it's a take a music concert or something like that we can have video coming in from ten different cameras all",
    "start": "3004839",
    "end": "3011890"
  },
  {
    "text": "being stored in its raw form perhaps a production gallery in the cloud perhaps that production gallery can be remote because of that and we can make that",
    "start": "3011890",
    "end": "3021520"
  },
  {
    "text": "program available online but with something like a music concert we actually typically then want to edit the",
    "start": "3021520",
    "end": "3027670"
  },
  {
    "text": "event afterwards to make a cleaner version available for people to watch a cat on catch up this can be just editing",
    "start": "3027670",
    "end": "3034660"
  },
  {
    "text": "bits out that you know are perhaps particularly interesting to the audience as bands change and things like that or",
    "start": "3034660",
    "end": "3041589"
  },
  {
    "text": "it might be because we don't trust the artist not to swear onstage and we don't want that in the capture of content",
    "start": "3041589",
    "end": "3049170"
  },
  {
    "text": "using these sorts of technologies it's now possible or what it hopefully will be possible to actually have the editor",
    "start": "3049170",
    "end": "3056740"
  },
  {
    "text": "load in and decisions from the production gallery look at what decisions were made when the program",
    "start": "3056740",
    "end": "3062230"
  },
  {
    "text": "first was broadcast and then go well actually I've got the rule feed from all the video cameras perhaps on",
    "start": "3062230",
    "end": "3068980"
  },
  {
    "text": "switched that camera ten seconds earlier than they actually did in the live broadcast and so very easily make it",
    "start": "3068980",
    "end": "3073990"
  },
  {
    "text": "much better quality copy for us to put available as catch-up",
    "start": "3073990",
    "end": "3079390"
  },
  {
    "text": "and yet previously to do this you'd have to get hold of all the raw video export",
    "start": "3079390",
    "end": "3084970"
  },
  {
    "text": "that from those systems make your edits and then from your editing system export",
    "start": "3084970",
    "end": "3090040"
  },
  {
    "text": "that video again back into things like I play and that could be a sort of three or four hour turnaround time with these",
    "start": "3090040",
    "end": "3096010"
  },
  {
    "text": "sorts of technologies we're hoping we can actually sort of do that in 15 minutes half an hour and make a big",
    "start": "3096010",
    "end": "3101049"
  },
  {
    "text": "difference to the audience in how quickly they get hold of these these events",
    "start": "3101049",
    "end": "3108210"
  },
  {
    "start": "3109000",
    "end": "3166000"
  },
  {
    "text": "with that I think of that finish and Angie back to rubber",
    "start": "3109200",
    "end": "3114930"
  },
  {
    "text": "so thank you very much Stephen BBC is such an iconic broadcaster I know for me",
    "start": "3120610",
    "end": "3126010"
  },
  {
    "text": "when I travel I regularly tuned to the BBC to watch news catch up and a no",
    "start": "3126010",
    "end": "3131470"
  },
  {
    "text": "doubt when Prince Prince Harry gets married I'll probably be tuning into the BBC and watching his his wedding as well",
    "start": "3131470",
    "end": "3136740"
  },
  {
    "text": "so thanks for that thanks for sharing with us sort of Utley under the hood what's going on and giving us some tools",
    "start": "3136740",
    "end": "3142570"
  },
  {
    "text": "that we can use and as a product manager it's nothing more happy for me to then be able to see you know our customers",
    "start": "3142570",
    "end": "3148840"
  },
  {
    "text": "use it and make use of our the tools that we provide and I also want to thank the audience for taking this time to",
    "start": "3148840",
    "end": "3154750"
  },
  {
    "text": "join us today if you want further information on what the BBC is doing what we're doing on SQS and S&S please",
    "start": "3154750",
    "end": "3160450"
  },
  {
    "text": "feel free to visit our website thank you very much [Applause]",
    "start": "3160450",
    "end": "3167890"
  }
]