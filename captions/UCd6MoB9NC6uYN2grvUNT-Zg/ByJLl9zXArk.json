[
  {
    "text": "- [Instructor] AWS WAF now supports",
    "start": "1068",
    "end": "2940"
  },
  {
    "text": "evaluating multiple\nheaders in the HTTP request",
    "start": "2940",
    "end": "6690"
  },
  {
    "text": "without the need to specify\neach header individually",
    "start": "6690",
    "end": "9570"
  },
  {
    "text": "in the AWS WAF rules.",
    "start": "9570",
    "end": "11523"
  },
  {
    "text": "You can also use this new\nfeature to inspect all cookies",
    "start": "12510",
    "end": "15540"
  },
  {
    "text": "in the HTTP request",
    "start": "15540",
    "end": "17040"
  },
  {
    "text": "without the need to specify\neach cookie in the WAF rules.",
    "start": "17040",
    "end": "20283"
  },
  {
    "text": "This capability helps you\nprotect your applications",
    "start": "21150",
    "end": "23760"
  },
  {
    "text": "or API endpoints from attacks that try",
    "start": "23760",
    "end": "25920"
  },
  {
    "text": "to exploit a custom header or cookie",
    "start": "25920",
    "end": "28890"
  },
  {
    "text": "or a common header for which\nyou may not have created",
    "start": "28890",
    "end": "31170"
  },
  {
    "text": "a WAF rule.",
    "start": "31170",
    "end": "32133"
  },
  {
    "text": "You can also limit the scope",
    "start": "33150",
    "end": "34470"
  },
  {
    "text": "of inspection to only\nincluded or excluded headers",
    "start": "34470",
    "end": "37830"
  },
  {
    "text": "and inspect only the\nkeys or only the values",
    "start": "37830",
    "end": "40830"
  },
  {
    "text": "for the headers or cookies\nyou want to inspect.",
    "start": "40830",
    "end": "43263"
  },
  {
    "text": "For HTTP requests that\nmay include more headers",
    "start": "44700",
    "end": "47460"
  },
  {
    "text": "than WAF can inspect,",
    "start": "47460",
    "end": "49379"
  },
  {
    "text": "you can provide oversize\nhandling instructions",
    "start": "49380",
    "end": "51720"
  },
  {
    "text": "when you define your rule statement.",
    "start": "51720",
    "end": "53520"
  },
  {
    "text": "Oversize handling tells WAF\nwhat to do with a web request",
    "start": "54660",
    "end": "57930"
  },
  {
    "text": "when the number",
    "start": "57930",
    "end": "58770"
  },
  {
    "text": "or size of request headers\nis over the limits.",
    "start": "58770",
    "end": "61503"
  },
  {
    "text": "With oversized handling,",
    "start": "63005",
    "end": "64530"
  },
  {
    "text": "you can choose whether\nto continue inspection",
    "start": "64530",
    "end": "67020"
  },
  {
    "text": "or skip inspection and mark\nthe request as matching",
    "start": "67020",
    "end": "69840"
  },
  {
    "text": "or not matching the WAF rule.",
    "start": "69840",
    "end": "71673"
  },
  {
    "text": "There is no additional cost",
    "start": "72900",
    "end": "74220"
  },
  {
    "text": "for matching against all\nheaders or cookie details",
    "start": "74220",
    "end": "77370"
  },
  {
    "text": "but standard service charges\nfor AWS WAF still apply.",
    "start": "77370",
    "end": "80703"
  },
  {
    "text": "These features are available\nin all AWS WAF regions",
    "start": "81900",
    "end": "85500"
  },
  {
    "text": "and for each supported service",
    "start": "85500",
    "end": "87180"
  },
  {
    "text": "including Amazon CloudFront,\nApplication Load Balancer,",
    "start": "87180",
    "end": "91230"
  },
  {
    "text": "Amazon API Gateway, and AWS AppSync.",
    "start": "91230",
    "end": "94473"
  },
  {
    "text": "For a full list of\nrequest component options",
    "start": "95490",
    "end": "98220"
  },
  {
    "text": "that are supported, see the\nAWS WAF Developer Guide.",
    "start": "98220",
    "end": "101823"
  },
  {
    "text": "Attacks may look different than inspected",
    "start": "103020",
    "end": "105090"
  },
  {
    "text": "and they don't always succeed.",
    "start": "105090",
    "end": "107219"
  },
  {
    "text": "Often, threat actors are guessing how",
    "start": "107220",
    "end": "109170"
  },
  {
    "text": "to compromise a request.",
    "start": "109170",
    "end": "111390"
  },
  {
    "text": "Requests should be considered malicious",
    "start": "111390",
    "end": "113460"
  },
  {
    "text": "if there is malicious content\nin the header or cookies,",
    "start": "113460",
    "end": "116400"
  },
  {
    "text": "even if the attack fails.",
    "start": "116400",
    "end": "118173"
  },
  {
    "text": "When making custom rules in AWS WAF,",
    "start": "119340",
    "end": "121920"
  },
  {
    "text": "you can now inspect more\nthan a single header",
    "start": "121920",
    "end": "124020"
  },
  {
    "text": "or cookie in a single rule.",
    "start": "124020",
    "end": "126450"
  },
  {
    "text": "This allows you to identify a threat",
    "start": "126450",
    "end": "128250"
  },
  {
    "text": "even if you don't know exactly\nwhat you're looking for.",
    "start": "128250",
    "end": "131000"
  },
  {
    "text": "Because there are limits on the size",
    "start": "132510",
    "end": "134159"
  },
  {
    "text": "or the numbers of headers or cookies,",
    "start": "134160",
    "end": "136470"
  },
  {
    "text": "AWS WAF provides rule choices\non how to handle a request",
    "start": "136470",
    "end": "140280"
  },
  {
    "text": "if the content exceeds\nthe limit thresholds.",
    "start": "140280",
    "end": "143220"
  },
  {
    "text": "Now we're going to look at\nthis new feature in action.",
    "start": "143220",
    "end": "146520"
  },
  {
    "text": "In the demo, we will send\nrequests to a live system.",
    "start": "146520",
    "end": "150060"
  },
  {
    "text": "You will see how to configure\nnew rules in AWS WAF",
    "start": "150060",
    "end": "153450"
  },
  {
    "text": "to block the requests when they contain",
    "start": "153450",
    "end": "155459"
  },
  {
    "text": "objectionable header content.",
    "start": "155460",
    "end": "157740"
  },
  {
    "text": "First, let's have a look\nat the system architecture.",
    "start": "157740",
    "end": "160440"
  },
  {
    "text": "Here we have an Application Load Balancer",
    "start": "160440",
    "end": "162570"
  },
  {
    "text": "configured to route requests\nto a Lambda function.",
    "start": "162570",
    "end": "165810"
  },
  {
    "text": "For demonstration purposes,",
    "start": "165810",
    "end": "167220"
  },
  {
    "text": "the Lambda function\nwill simply respond back",
    "start": "167220",
    "end": "169320"
  },
  {
    "text": "to the requesting application",
    "start": "169320",
    "end": "171120"
  },
  {
    "text": "with the header sent in the request.",
    "start": "171120",
    "end": "173159"
  },
  {
    "text": "This will allow us to show when a request",
    "start": "173160",
    "end": "175140"
  },
  {
    "text": "was successfully routed",
    "start": "175140",
    "end": "176640"
  },
  {
    "text": "and see the content of the header sent.",
    "start": "176640",
    "end": "178590"
  },
  {
    "text": "AWS WAF will inspect the\nrequest before routing.",
    "start": "179675",
    "end": "182910"
  },
  {
    "text": "Any request blocked will\nsend an error response back",
    "start": "182910",
    "end": "185730"
  },
  {
    "text": "to the requesting application.",
    "start": "185730",
    "end": "187980"
  },
  {
    "text": "For the beginning of the demonstration,",
    "start": "187980",
    "end": "190170"
  },
  {
    "text": "we will send through a request",
    "start": "190170",
    "end": "191580"
  },
  {
    "text": "with several headers containing SQL.",
    "start": "191580",
    "end": "194310"
  },
  {
    "text": "SQL code in headers are\nindicators of a malicious request.",
    "start": "194310",
    "end": "197733"
  },
  {
    "text": "I'll also include an identifiable body",
    "start": "198720",
    "end": "201120"
  },
  {
    "text": "so that we can see that the\ndata sent is the data returned.",
    "start": "201120",
    "end": "204573"
  },
  {
    "text": "Because there are no WAF rules in place,",
    "start": "207990",
    "end": "210360"
  },
  {
    "text": "you can see that the request went through",
    "start": "210360",
    "end": "212850"
  },
  {
    "text": "and the Lambda function\nsent back the contents,",
    "start": "212850",
    "end": "215100"
  },
  {
    "text": "including all the headers.",
    "start": "215100",
    "end": "217080"
  },
  {
    "text": "Note that several headers are guesses",
    "start": "217080",
    "end": "218970"
  },
  {
    "text": "at possible server side variables",
    "start": "218970",
    "end": "220770"
  },
  {
    "text": "where my SQL injection could be executed.",
    "start": "220770",
    "end": "223620"
  },
  {
    "text": "As you can see, I have many versions",
    "start": "223620",
    "end": "225750"
  },
  {
    "text": "of possible user ID fields,\nsome passwords, and item IDs.",
    "start": "225750",
    "end": "230493"
  },
  {
    "text": "Now let's look at the WAF console.",
    "start": "232380",
    "end": "234480"
  },
  {
    "text": "For this demo, I have a\nweb ACL attached to my ALB,",
    "start": "234480",
    "end": "238172"
  },
  {
    "text": "but there are no rules.",
    "start": "240450",
    "end": "242370"
  },
  {
    "text": "Let's go ahead and create a rule",
    "start": "242370",
    "end": "243930"
  },
  {
    "text": "that will block any SQL showing\nup in the request headers.",
    "start": "243930",
    "end": "247172"
  },
  {
    "text": "First we'll click on Add Rules,",
    "start": "248040",
    "end": "250140"
  },
  {
    "text": "then we'll select Add My\nOwn Rules and Rule Groups.",
    "start": "250140",
    "end": "254163"
  },
  {
    "text": "This is the Add Rule form.",
    "start": "257490",
    "end": "259470"
  },
  {
    "text": "This makes it easy to\ncreate your own custom rule",
    "start": "259470",
    "end": "262140"
  },
  {
    "text": "to block the kinds of headers we just saw.",
    "start": "262140",
    "end": "264483"
  },
  {
    "text": "First, we'll add a name.",
    "start": "265890",
    "end": "267813"
  },
  {
    "text": "Then we'll tell AWS WAF what to inspect.",
    "start": "276540",
    "end": "279513"
  },
  {
    "text": "You can see we have many options",
    "start": "280740",
    "end": "283020"
  },
  {
    "text": "but we want to inspect all headers.",
    "start": "283020",
    "end": "285392"
  },
  {
    "text": "We have the option here to\ninspect all parts of the header",
    "start": "289140",
    "end": "292410"
  },
  {
    "text": "or we can specify to look at just the key",
    "start": "292410",
    "end": "295710"
  },
  {
    "text": "or just the value.",
    "start": "295710",
    "end": "296973"
  },
  {
    "text": "In the Content to Inspect section,",
    "start": "297900",
    "end": "300120"
  },
  {
    "text": "you can choose to allow\nWAF to inspect all headers",
    "start": "300120",
    "end": "303240"
  },
  {
    "text": "or just a subset.",
    "start": "303240",
    "end": "304650"
  },
  {
    "text": "For this demo, we'll go\nahead and look at them all.",
    "start": "304650",
    "end": "307199"
  },
  {
    "text": "For match type, we want\nto match on any header",
    "start": "310590",
    "end": "313560"
  },
  {
    "text": "that contains a SQL injection.",
    "start": "313560",
    "end": "315573"
  },
  {
    "text": "Oversize Handling is where\nwe would tell WAF what to do",
    "start": "319830",
    "end": "322770"
  },
  {
    "text": "with requests that exceed\nthe size or count limits.",
    "start": "322770",
    "end": "327389"
  },
  {
    "text": "We can choose to inspect just\nwhat's within these limits",
    "start": "327390",
    "end": "330480"
  },
  {
    "text": "or we can declare the request\na match or not a match.",
    "start": "330480",
    "end": "334290"
  },
  {
    "text": "For now, we're going to select Continue.",
    "start": "334290",
    "end": "337080"
  },
  {
    "text": "The rule will inspect what it can,",
    "start": "337080",
    "end": "338879"
  },
  {
    "text": "ignoring any content\noutside the size limits.",
    "start": "338880",
    "end": "342063"
  },
  {
    "text": "The Then section tells WAF what to do",
    "start": "344760",
    "end": "347430"
  },
  {
    "text": "in case of a rule match.",
    "start": "347430",
    "end": "349560"
  },
  {
    "text": "We will leave the action as block.",
    "start": "349560",
    "end": "351483"
  },
  {
    "text": "In the custom response,",
    "start": "353370",
    "end": "354960"
  },
  {
    "text": "I want to specify a 403 response code.",
    "start": "354960",
    "end": "358293"
  },
  {
    "text": "For this demo, I will\nalso return a custom body.",
    "start": "359460",
    "end": "363363"
  },
  {
    "text": "This is not always\nnecessary, but for the demo,",
    "start": "364470",
    "end": "367290"
  },
  {
    "text": "it will give us an easy indicator",
    "start": "367290",
    "end": "369120"
  },
  {
    "text": "that the rule is working as expected.",
    "start": "369120",
    "end": "371432"
  },
  {
    "text": "Now that we're done, we'll\ngo ahead and click Add Rule.",
    "start": "376620",
    "end": "379682"
  },
  {
    "text": "On this page, we set the rule priority.",
    "start": "383640",
    "end": "386520"
  },
  {
    "text": "Since it is the only rule,",
    "start": "386520",
    "end": "388680"
  },
  {
    "text": "we can go ahead and just hit save.",
    "start": "388680",
    "end": "390603"
  },
  {
    "text": "Now that the rule is applied,",
    "start": "393540",
    "end": "395040"
  },
  {
    "text": "we can go back to our demo\napplication and see the results.",
    "start": "395040",
    "end": "398853"
  },
  {
    "text": "Now, back to the application.",
    "start": "400830",
    "end": "403229"
  },
  {
    "text": "We will send the request again.",
    "start": "403230",
    "end": "404913"
  },
  {
    "text": "I'll change the request body so",
    "start": "406230",
    "end": "407820"
  },
  {
    "text": "that we can see that the data\nsent is the data returned.",
    "start": "407820",
    "end": "411333"
  },
  {
    "text": "The rule worked.",
    "start": "413040",
    "end": "414720"
  },
  {
    "text": "It correctly identified\nthe SQL code in the headers",
    "start": "414720",
    "end": "417540"
  },
  {
    "text": "and returned our custom body.",
    "start": "417540",
    "end": "419313"
  },
  {
    "text": "But what about an oversize request?",
    "start": "420240",
    "end": "422699"
  },
  {
    "text": "I'll add 200 headers to\npush the malicious headers",
    "start": "422700",
    "end": "425850"
  },
  {
    "text": "to the bottom of the list.",
    "start": "425850",
    "end": "427680"
  },
  {
    "text": "With the current rule,",
    "start": "427680",
    "end": "429180"
  },
  {
    "text": "the malicious headers will be invisible.",
    "start": "429180",
    "end": "431250"
  },
  {
    "text": "So when we execute this request,",
    "start": "431250",
    "end": "433440"
  },
  {
    "text": "the SQL code escapes detection",
    "start": "433440",
    "end": "435580"
  },
  {
    "text": "As you can see, the rule\nfailed to block this request",
    "start": "440910",
    "end": "443910"
  },
  {
    "text": "because the number of\nheaders was too large",
    "start": "443910",
    "end": "446250"
  },
  {
    "text": "and the malicious headers\nweren't matched to the rule.",
    "start": "446250",
    "end": "448950"
  },
  {
    "text": "So let's go back to the AWS WAF console.",
    "start": "449970",
    "end": "453780"
  },
  {
    "text": "To change our rule,",
    "start": "453780",
    "end": "455550"
  },
  {
    "text": "we're going to select it",
    "start": "455550",
    "end": "456819"
  },
  {
    "text": "and then click Edit.",
    "start": "458640",
    "end": "460353"
  },
  {
    "text": "Now back in the rule editor,",
    "start": "464250",
    "end": "466080"
  },
  {
    "text": "we'll scroll down to the\nOversize Handling section",
    "start": "466080",
    "end": "468909"
  },
  {
    "text": "and change the selection.",
    "start": "470130",
    "end": "471603"
  },
  {
    "text": "We're going to select Match,",
    "start": "475650",
    "end": "477389"
  },
  {
    "text": "because for this application,\nany request with more",
    "start": "477390",
    "end": "480330"
  },
  {
    "text": "than 200 headers would be trying\nto hide malicious content.",
    "start": "480330",
    "end": "484022"
  },
  {
    "text": "Now we'll save.",
    "start": "486270",
    "end": "487473"
  },
  {
    "text": "And save.",
    "start": "492870",
    "end": "494043"
  },
  {
    "text": "And now we'll go back to the application",
    "start": "497520",
    "end": "499919"
  },
  {
    "text": "and see how that works.",
    "start": "499920",
    "end": "501303"
  },
  {
    "text": "With our rule now changed to\nassume a match if the number",
    "start": "502680",
    "end": "505650"
  },
  {
    "text": "of headers exceeds the limit,",
    "start": "505650",
    "end": "507720"
  },
  {
    "text": "we'll execute the request again\nwith the 200 extra headers.",
    "start": "507720",
    "end": "511713"
  },
  {
    "text": "And now the request has been blocked.",
    "start": "513120",
    "end": "515400"
  },
  {
    "text": "When making your own rules,",
    "start": "515400",
    "end": "516900"
  },
  {
    "text": "you will have to assess what\nkind of oversize handling",
    "start": "516900",
    "end": "519750"
  },
  {
    "text": "would be best for your application.",
    "start": "519750",
    "end": "522360"
  },
  {
    "text": "To learn more about multi-header",
    "start": "522360",
    "end": "524039"
  },
  {
    "text": "and multi-cookie handling in AWS WAF,",
    "start": "524040",
    "end": "527009"
  },
  {
    "text": "visit the Developer Guide",
    "start": "527010",
    "end": "528300"
  },
  {
    "text": "and the feature announcement.",
    "start": "528300",
    "end": "530339"
  },
  {
    "text": "Both of these links can be\nfound in the description",
    "start": "530340",
    "end": "532620"
  },
  {
    "text": "of this video.",
    "start": "532620",
    "end": "533493"
  },
  {
    "text": "Thank you for taking the time to watch.",
    "start": "534540",
    "end": "536790"
  },
  {
    "text": "If this content was helpful,\nplease click the like icon.",
    "start": "536790",
    "end": "540870"
  },
  {
    "text": "Have a great day.",
    "start": "540870",
    "end": "541983"
  }
]