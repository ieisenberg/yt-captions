[
  {
    "text": "hey everybody my name is Zach Musgrave I'm a software engineer at Yelp I'm on What's",
    "start": "2240",
    "end": "9360"
  },
  {
    "text": "called the infrastructure team at Yelp which means we build developer tools we are interested in performance and",
    "start": "9360",
    "end": "14440"
  },
  {
    "text": "security and monitoring and pretty graphs and stuff like that and I'm here today at reinvent to talk to you about a",
    "start": "14440",
    "end": "21960"
  },
  {
    "text": "topic near and dear to my heart which is profiling code profiling performance",
    "start": "21960",
    "end": "27679"
  },
  {
    "text": "profiling in production the triple p this is using a couple different",
    "start": "27679",
    "end": "32840"
  },
  {
    "text": "Technologies but what we're going to be talking about is how we analyze web requests production web request at scale",
    "start": "32840",
    "end": "38879"
  },
  {
    "text": "using map reduce and storm so give you the quick overview of the talk before we really dive in first",
    "start": "38879",
    "end": "45960"
  },
  {
    "text": "we're going to talk about why this is important why do you care why should you profile your code why does this matter",
    "start": "45960",
    "end": "51600"
  },
  {
    "text": "then we're going to talk about how you create and analyze profiles how you get those profiles out of your web app and",
    "start": "51600",
    "end": "57399"
  },
  {
    "text": "into a place where you can then manipulate them how you can search them and sort them and tag them so that",
    "start": "57399",
    "end": "63519"
  },
  {
    "text": "they're useful to you how you can aggregate your profiles together so that they developers do not have to go",
    "start": "63519",
    "end": "70720"
  },
  {
    "text": "through thousands of files at a time talk about how we're going to do this in real time instead of as a batch job and",
    "start": "70720",
    "end": "76200"
  },
  {
    "text": "we're going to talk about what where we're going in the future at Yelp with profiling let's get",
    "start": "76200",
    "end": "81479"
  },
  {
    "text": "started in a magical world far far away apps don't",
    "start": "81479",
    "end": "87200"
  },
  {
    "text": "break they don't slow down developers actually think about scalability as a",
    "start": "87200",
    "end": "93040"
  },
  {
    "text": "matter of course instead of as an afterthought all your external Services run in 01 and they run an 01 all the",
    "start": "93040",
    "end": "99640"
  },
  {
    "text": "time and you know about all your bugs ahead of time it's Paradise there's beaches and palm trees in the world we",
    "start": "99640",
    "end": "107079"
  },
  {
    "text": "live in not so much accidents happen developers are not",
    "start": "107079",
    "end": "113000"
  },
  {
    "text": "syons they are people don't forget it and they make mistakes and then these",
    "start": "113000",
    "end": "118960"
  },
  {
    "text": "mistakes make it to uction and then we cry so one faithful day you have a graph",
    "start": "118960",
    "end": "126759"
  },
  {
    "text": "your graph looks like this this is a u this is a moving average of the 50th",
    "start": "126759",
    "end": "132560"
  },
  {
    "text": "percentile of web request response times for a certain page at Yelp and something",
    "start": "132560",
    "end": "139800"
  },
  {
    "text": "went wrong which results in this everyone wants to know who did this",
    "start": "139800",
    "end": "148680"
  },
  {
    "text": "why did we do this why is responses lagging by 25% at the 50th percentile and how can we fix this",
    "start": "148680",
    "end": "157480"
  },
  {
    "text": "quickly business cat says your performance needs",
    "start": "157480",
    "end": "164640"
  },
  {
    "text": "profiling I don't know how else to break it to you but it does so now let's talk about the actual",
    "start": "164640",
    "end": "172840"
  },
  {
    "text": "nuts and bolts of profiling and um this talk is entirely um based on python this",
    "start": "172840",
    "end": "178440"
  },
  {
    "text": "is because Yelp is mostly ay python shop and I know a lot of people in the audience probably use Python for their",
    "start": "178440",
    "end": "183599"
  },
  {
    "text": "web apps so hopefully even for those of you coming from a Java background this won't be too offputting",
    "start": "183599",
    "end": "190440"
  },
  {
    "text": "but I assume some fraction of the audience has dealt with code profiling before I hope so if you haven't the",
    "start": "190440",
    "end": "198440"
  },
  {
    "text": "upshot is the profiling is something you do at runtime with any program it generates deterministic",
    "start": "198440",
    "end": "204080"
  },
  {
    "text": "statistics how many times has a method been called how long is that method's runtime",
    "start": "204080",
    "end": "210280"
  },
  {
    "text": "what is that method called and where can I find its source and how much total runtime is devoted to a certain thing",
    "start": "210280",
    "end": "215720"
  },
  {
    "text": "over the entire execution of your program and in Python it's really easy",
    "start": "215720",
    "end": "221360"
  },
  {
    "text": "to use ad hoc you just run your script with the cprofile module turned on then",
    "start": "221360",
    "end": "227319"
  },
  {
    "text": "it wraps your script and it generates an output data file this is built into",
    "start": "227319",
    "end": "232720"
  },
  {
    "text": "python I think in auntu you have to install an apt package but this is this is already there for you profiling has",
    "start": "232720",
    "end": "238159"
  },
  {
    "text": "been around for a while it's nothing new and when you uh get your profiles you",
    "start": "238159",
    "end": "244560"
  },
  {
    "text": "end up looking at something like this so what you can see here is that for",
    "start": "244560",
    "end": "250799"
  },
  {
    "text": "example we have a part of our part of our website called the emergency capture that spends a lot of time calling",
    "start": "250799",
    "end": "256840"
  },
  {
    "text": "something called excess cookies and so you can drill down and see as you go",
    "start": "256840",
    "end": "262919"
  },
  {
    "text": "what each method's expensive part is and so this is obviously just a very",
    "start": "262919",
    "end": "270000"
  },
  {
    "text": "abbreviated part because one point font isn't very readable but as you can see",
    "start": "270000",
    "end": "276680"
  },
  {
    "text": "profiling data is structured and with structured data we can do analytics without even having to do all the",
    "start": "276680",
    "end": "282120"
  },
  {
    "text": "machine learning bits so we can diff them and so in this example we have a",
    "start": "282120",
    "end": "289199"
  },
  {
    "text": "tool called diff Pats that basically takes two profiles and compares the uh",
    "start": "289199",
    "end": "296840"
  },
  {
    "text": "some attributes in them to the before and the after and what we can see here is that um at",
    "start": "296840",
    "end": "302680"
  },
  {
    "text": "Yelp for example in the top in the top part we have a request Bucker and a couple months ago the request bucker",
    "start": "302680",
    "end": "309400"
  },
  {
    "text": "wasn't taking up that much uh that many calls but now it's taking up a lot of calls so that could be interesting if",
    "start": "309400",
    "end": "315400"
  },
  {
    "text": "you were trying to figure out why something was slow maybe there's something iffy about the request bucket or that's affecting more stuff now and",
    "start": "315400",
    "end": "322120"
  },
  {
    "text": "then down at the bottom we show based on cumulative amount of runtime between these two profile files so you see this",
    "start": "322120",
    "end": "329360"
  },
  {
    "text": "and you say well that's cool Zach I don't know how this is going to help me though I have a big",
    "start": "329360",
    "end": "336000"
  },
  {
    "text": "website so you ask how does this work in production everybody say hi to Darius",
    "start": "336000",
    "end": "342319"
  },
  {
    "text": "Darius is our mascot for this talk he's the profiling Hedgehog he's very nice",
    "start": "342319",
    "end": "347440"
  },
  {
    "text": "and he wants to help you build build more performant web",
    "start": "347440",
    "end": "352560"
  },
  {
    "text": "applications so Darius will tell you about how to acquire profiles from your web",
    "start": "352560",
    "end": "358039"
  },
  {
    "text": "app this part's actually sort of simple or sort of not it really depends on the architecture that you're already working",
    "start": "358039",
    "end": "363759"
  },
  {
    "text": "with but basically you make a context manager you wrap your application in it at a reasonably high level so you're",
    "start": "363759",
    "end": "370000"
  },
  {
    "text": "including all the pain points of your application and sometimes you return a",
    "start": "370000",
    "end": "375680"
  },
  {
    "text": "profiling context you have to have a place to put your profiles and we use a distributed",
    "start": "375680",
    "end": "383160"
  },
  {
    "text": "logging system originally uh created by Facebook called scribe I'm sure some of you are also familiar with scribe uh if",
    "start": "383160",
    "end": "390080"
  },
  {
    "text": "you don't use scribe or you know you can use another solution or save them to a local dis it really doesn't matter as",
    "start": "390080",
    "end": "395680"
  },
  {
    "text": "long as they eventually end up in the cloud in our case our scribe logs eventually end up in Amazon",
    "start": "395680",
    "end": "401639"
  },
  {
    "text": "S3 and um this makes the profiles easy to deal with you also have to add if you",
    "start": "401639",
    "end": "408680"
  },
  {
    "text": "want to actually be able to figure out which profile goes to what some sort of a logging stream that contains semantic data about your application once you do",
    "start": "408680",
    "end": "416080"
  },
  {
    "text": "this you can then go through the attributes of that logging stream and be like okay this profile matches this",
    "start": "416080",
    "end": "422639"
  },
  {
    "text": "thing so for a system diagram we have the internet we have two data centers",
    "start": "422639",
    "end": "429560"
  },
  {
    "text": "East Coast West Coast this is very idealized it's a lot more complex in real life and each data center has one",
    "start": "429560",
    "end": "435360"
  },
  {
    "text": "or more scribe aggregators which take all these lines of logs from all of the",
    "start": "435360",
    "end": "440639"
  },
  {
    "text": "web workers and eventually uploads them to S3 it also allows you to access them",
    "start": "440639",
    "end": "445840"
  },
  {
    "text": "in real time to do like log tailing and stuff like that but one once your stuff is an S3 you can then dig into the real",
    "start": "445840",
    "end": "452960"
  },
  {
    "text": "details of how you actually analyze it and how you make it usable so one thing I've noticed about",
    "start": "452960",
    "end": "459440"
  },
  {
    "text": "uh toic conferences like this is that not everybody includes code in their slides and it's hard to include code but",
    "start": "459440",
    "end": "466120"
  },
  {
    "text": "I'm going to try so I hope you'll bear with me and I'll try to explain as best I can so here's that context the context",
    "start": "466120",
    "end": "475120"
  },
  {
    "text": "that we were talking about wrapping your web app in basically when you enter the context all you do is you turn on the C",
    "start": "475120",
    "end": "483000"
  },
  {
    "text": "profiler and you enable it and when you leave the context so at the end of your",
    "start": "483000",
    "end": "489319"
  },
  {
    "text": "web apps internal execution you tell the profiler give me all the stats that you",
    "start": "489319",
    "end": "494720"
  },
  {
    "text": "created and then you create a dictionary in this case that has attributes for the",
    "start": "494720",
    "end": "500759"
  },
  {
    "text": "actual profiling data and for what in this example is called Ranger which is the logging attribute scheme that I",
    "start": "500759",
    "end": "507879"
  },
  {
    "text": "alluded to earlier at y this is called Ranger yours is probably called something different um so we take the",
    "start": "507879",
    "end": "514200"
  },
  {
    "text": "our request info and our profiling info and we use the clog library to dump them",
    "start": "514200",
    "end": "521320"
  },
  {
    "text": "into scribe so hopefully that's pretty",
    "start": "521320",
    "end": "526440"
  },
  {
    "text": "straightforward when you enter you turn on profiling when you exit you turn off profiling you take the stats you combine",
    "start": "526440",
    "end": "532680"
  },
  {
    "text": "the stats with the attributes and you write it out into whatever logging system dour you prefer",
    "start": "532680",
    "end": "539839"
  },
  {
    "text": "but it's important to note that profiling isn't free and maybe this",
    "start": "539839",
    "end": "545640"
  },
  {
    "text": "comes as no surprise because you're creating another data file and you're keeping track of all the stuff you normally won't keep track of but there",
    "start": "545640",
    "end": "551920"
  },
  {
    "text": "is an overhead um and anecdotally it's probably about 20% on your response time",
    "start": "551920",
    "end": "557120"
  },
  {
    "text": "so you don't want to profile all your traffic also you're going to generate a ton of files so you probably want a",
    "start": "557120",
    "end": "563240"
  },
  {
    "text": "context manager to decide whether or not you're going to use the context I just showed you so maybe you create something",
    "start": "563240",
    "end": "570320"
  },
  {
    "text": "should I profile this and so you look up the seret that you're working on and you",
    "start": "570320",
    "end": "576160"
  },
  {
    "text": "say you know some based on some random probability either profile it or don't and then you decide which manager",
    "start": "576160",
    "end": "583079"
  },
  {
    "text": "based on whether that random worked out one way or the other and if you have it",
    "start": "583079",
    "end": "588279"
  },
  {
    "text": "turned on then you send your profiles to scribe and if you don't you return a",
    "start": "588279",
    "end": "593519"
  },
  {
    "text": "noop a noop context that doesn't actually do anything so",
    "start": "593519",
    "end": "600399"
  },
  {
    "text": "once again overhead is a thing and you honestly don't really need to profile",
    "start": "600399",
    "end": "605600"
  },
  {
    "text": "all the traffic that you get but it's important to get you know something of a normal distribution of a",
    "start": "605600",
    "end": "612880"
  },
  {
    "text": "sample and you should also while you're at it since you're already digging into",
    "start": "612880",
    "end": "618680"
  },
  {
    "text": "sort of the sort of the lower layers of your web application you may as well think about maintaining a configuration",
    "start": "618680",
    "end": "623839"
  },
  {
    "text": "file because you have a default percentage of requests to profile um Ed",
    "start": "623839",
    "end": "629519"
  },
  {
    "text": "Yelp this number is very low it's under 1% um and you let's say you have a",
    "start": "629519",
    "end": "634800"
  },
  {
    "text": "specific servlet like your terms of service page nobody ever reads that and hopefully it's pretty static so it",
    "start": "634800",
    "end": "640839"
  },
  {
    "text": "doesn't have too many performance problems but maybe it does and so if you need to profile that and you want to actually get a decent sample size you",
    "start": "640839",
    "end": "647320"
  },
  {
    "text": "may need to turn up the actual amount of profiles that you're going to create",
    "start": "647320",
    "end": "653160"
  },
  {
    "text": "like instead of less than 1% maybe you take 5% or something like that so we use a Pyon Li python module",
    "start": "653160",
    "end": "660839"
  },
  {
    "text": "called ptic conf that allows you to read a AML file automatically reload the AML",
    "start": "660839",
    "end": "666000"
  },
  {
    "text": "file if you push that configuration change out and so you can set all this pretty",
    "start": "666000",
    "end": "671760"
  },
  {
    "text": "easily but now let's talk about what you do with all these profiles and how you make them searchable and",
    "start": "671760",
    "end": "678240"
  },
  {
    "text": "sortable usability is key I'm a tool Builder my",
    "start": "678240",
    "end": "684320"
  },
  {
    "text": "customers are the other engineers at Yelp they're not the customers who use Yelp every day to find great local",
    "start": "684320",
    "end": "689720"
  },
  {
    "text": "businesses they're actual Engineers who also work at the company but having",
    "start": "689720",
    "end": "694959"
  },
  {
    "text": "150,000 of anything per day is hard you need to be able to actually search sort",
    "start": "694959",
    "end": "700000"
  },
  {
    "text": "filter this stuff and you need to do it quickly because otherwise it gets stale if you notice that graph that I showed",
    "start": "700000",
    "end": "705959"
  },
  {
    "text": "you earlier and you say holy crap my website is 20% slower than it's supposed to be then you need to fix that",
    "start": "705959",
    "end": "714000"
  },
  {
    "text": "yesterday or at least right now because your bleeding performance and probably",
    "start": "714000",
    "end": "719639"
  },
  {
    "text": "bleeding traffic and your customers are getting upset with you because the page is slow so Darius wants to be fresh and",
    "start": "719639",
    "end": "726160"
  },
  {
    "text": "have fresh data and you should to and so I'll talk to you about our initial approach on how to do this which",
    "start": "726160",
    "end": "731680"
  },
  {
    "text": "is Amazon's elastic map reduce EMR and so if you're not familiar EMR",
    "start": "731680",
    "end": "738680"
  },
  {
    "text": "lets you run map reduce jobs in the cloud how big a cluster as big as you want it spins up on demand and it's",
    "start": "738680",
    "end": "744399"
  },
  {
    "text": "super easy to use with python and this is key for our purposes because all the code I'm going to show you is in Python",
    "start": "744399",
    "end": "749600"
  },
  {
    "text": "Yelp maintains what's called Mr job which is a library allowing you to write map reduce jobs in Python Darius and Mr",
    "start": "749600",
    "end": "756920"
  },
  {
    "text": "job or mascot here they're best buddies they work together all the",
    "start": "756920",
    "end": "762320"
  },
  {
    "text": "time so you want to take these lines of scri logs that you've been emitting out",
    "start": "762320",
    "end": "768120"
  },
  {
    "text": "of your context in your web app and parse them into the correct formats and you can do this in parallel because each",
    "start": "768120",
    "end": "775600"
  },
  {
    "text": "line is independent of one another they're not related at all and you can then save those into Amazon S3 one file",
    "start": "775600",
    "end": "782480"
  },
  {
    "text": "for the profile which allows you to keep it in a format that can be analyzed and one file for the logging data I believe",
    "start": "782480",
    "end": "788519"
  },
  {
    "text": "in our case we uh we use Json and you then analyze that data for searchable parameters which once again",
    "start": "788519",
    "end": "795839"
  },
  {
    "text": "you can do in parallel so it starts to smell like a map reduce job you might wonder what are these",
    "start": "795839",
    "end": "802880"
  },
  {
    "text": "parameters you say what does Yelp care about and I have been usted with telling you that we are interested in",
    "start": "802880",
    "end": "809839"
  },
  {
    "text": "is the user logged in or not what page did the user access which is split into three things site serlet action so",
    "start": "809839",
    "end": "817320"
  },
  {
    "text": "whether it's our main website or our website for business owners which data",
    "start": "817320",
    "end": "822480"
  },
  {
    "text": "center East Coast West Coast Best Coast some other coast when did this happen of",
    "start": "822480",
    "end": "827519"
  },
  {
    "text": "course and how did it happen was it get postp put and were we over or under a 1C",
    "start": "827519",
    "end": "835040"
  },
  {
    "text": "response honestly you can bucket how long on on anything that you want um we",
    "start": "835040",
    "end": "841600"
  },
  {
    "text": "choose to bucket just on one second because it's pretty straightforward and that's usually sufficient for really bad performance",
    "start": "841600",
    "end": "847480"
  },
  {
    "text": "analysis so let's show some map reduce code so this is the beginning of the",
    "start": "847480",
    "end": "854440"
  },
  {
    "text": "mapper for the first part of this job we're going to read in lines of scribe",
    "start": "854440",
    "end": "860759"
  },
  {
    "text": "logs that are actually coming out of S3 because scribe puts them there for us and the first thing that we do is we",
    "start": "860759",
    "end": "867040"
  },
  {
    "text": "process um these this data into formats that python understands so you end up",
    "start": "867040",
    "end": "872600"
  },
  {
    "text": "with you end up with a dictionary and a Pats object and then you decide where the",
    "start": "872600",
    "end": "880560"
  },
  {
    "text": "hell you're going to put those so in this case get base key name just returns a partial path to an S3 bucket so logs C",
    "start": "880560",
    "end": "888639"
  },
  {
    "text": "profile discreet year month day time stamp and then a hash so now that you",
    "start": "888639",
    "end": "894920"
  },
  {
    "text": "know where you're going to put them you can just put them there so just say just save them into S3 and um",
    "start": "894920",
    "end": "904240"
  },
  {
    "text": "you'll notice for the pythonistas in the crowd you'll notice that I'm using the Marshall module here and everybody says",
    "start": "904240",
    "end": "910600"
  },
  {
    "text": "don't ever use Marshall because it depends on the version of the code that you're running and it's really hard to reproduce and the reason we use Marshall",
    "start": "910600",
    "end": "917519"
  },
  {
    "text": "here is because Pats um which is related to C profile is a really old module and",
    "start": "917519",
    "end": "923240"
  },
  {
    "text": "it works best with Marshall just take my word on it this is one of the few times when using Marshall in your own code is",
    "start": "923240",
    "end": "928759"
  },
  {
    "text": "okay um and also that my helper function is called set object",
    "start": "928759",
    "end": "934920"
  },
  {
    "text": "gz so this just happens to gzip everything that it before it sends to S3",
    "start": "934920",
    "end": "941319"
  },
  {
    "text": "um also really important because as you'll see here in a little bit we generate a ton of data with this",
    "start": "941319",
    "end": "947680"
  },
  {
    "text": "pipeline but anyway once you've saved out these individual files you then want to create all the",
    "start": "947680",
    "end": "955759"
  },
  {
    "text": "attributes that are important so we treat these as as key/value",
    "start": "955759",
    "end": "962519"
  },
  {
    "text": "data center SFO West Coast logged in SL true serlet",
    "start": "962519",
    "end": "968120"
  },
  {
    "text": "slome and so we create all of these based on the attributes that we've",
    "start": "968120",
    "end": "973839"
  },
  {
    "text": "provided from our ranger line and we then yield them out so what this does is",
    "start": "973839",
    "end": "979480"
  },
  {
    "text": "it is it multiplexes these tags from the mapper into many into many reducers or",
    "start": "979480",
    "end": "985959"
  },
  {
    "text": "one entry in the mapper become goes into many reducers",
    "start": "985959",
    "end": "990920"
  },
  {
    "text": "going on to the reducer see the first thing that you see is that we're taking a tag key like data center SFO and then",
    "start": "991800",
    "end": "999240"
  },
  {
    "text": "we're taking some paths that match that first we have to figure out where",
    "start": "999240",
    "end": "1005759"
  },
  {
    "text": "we're going to save all our tags and so it would be conceivable that you'd want to put this stuff in some sort of a",
    "start": "1005759",
    "end": "1011720"
  },
  {
    "text": "database solution but because this is an internal tool and it's really the load",
    "start": "1011720",
    "end": "1017720"
  },
  {
    "text": "on the actual analysis doesn't have to be that high because you're only going to have a handful of Engineers using it at once we found that it's sufficient to",
    "start": "1017720",
    "end": "1025160"
  },
  {
    "text": "just put the tags in files in S3 and then just download the appropriate files",
    "start": "1025160",
    "end": "1030678"
  },
  {
    "text": "when you want to make a search and take an intersection and just be done with it it's a lot more straightforward and it's",
    "start": "1030679",
    "end": "1036640"
  },
  {
    "text": "persistent and you don't have to worry about stuff failing on you and all the various intricacies of database",
    "start": "1036640",
    "end": "1041880"
  },
  {
    "text": "Administration so we figure out where we're going to put these tags and there may already be tags there",
    "start": "1041880",
    "end": "1048880"
  },
  {
    "text": "depending on the nature of our runtime so we're going to pull down the previous object split it into a list add on the",
    "start": "1048880",
    "end": "1055960"
  },
  {
    "text": "matching list that we've been provided with and then write that back out into",
    "start": "1055960",
    "end": "1062559"
  },
  {
    "text": "another string save that to the uh save that up to the tag file and then we",
    "start": "1062559",
    "end": "1069240"
  },
  {
    "text": "yield out a debug about how many paths we actually processed in this reducer so that's the first step there's",
    "start": "1069240",
    "end": "1076919"
  },
  {
    "text": "really two map reduce jobs going on here that's the first one we took you from having a web app adding a context",
    "start": "1076919",
    "end": "1084640"
  },
  {
    "text": "getting profiling data coming out of the web app and into S3 and now you have individual profiles written out into S3",
    "start": "1084640",
    "end": "1091360"
  },
  {
    "text": "and a record of which ones are which and where they match all in like 100 lines of python so I think that's pretty cool",
    "start": "1091360",
    "end": "1099240"
  },
  {
    "text": "but now let's talk about aggregating similar profiles together and on the systems hacking level this is where",
    "start": "1099240",
    "end": "1105200"
  },
  {
    "text": "things get a little ugly the fact is is that no matter who you are any single profile doesn't tell",
    "start": "1105200",
    "end": "1113159"
  },
  {
    "text": "the whole story if you pick a certain file that you happen to you know certain profile you happen to save and you",
    "start": "1113159",
    "end": "1120039"
  },
  {
    "text": "download it and you analyze it maybe it'll show the bad behavior that you",
    "start": "1120039",
    "end": "1125240"
  },
  {
    "text": "experienced but maybe it won't you really don't have a guarantee so you need a bigger sample size problem is is",
    "start": "1125240",
    "end": "1132760"
  },
  {
    "text": "you have a big website and you're generating a lot of profiles you're going to have to analyze those",
    "start": "1132760",
    "end": "1137960"
  },
  {
    "text": "individual profiles one by one and no developer wants to do this because they're pressed for time and they want",
    "start": "1137960",
    "end": "1143840"
  },
  {
    "text": "to know why things broke um without having without having to write a big loop or to actually look through them by",
    "start": "1143840",
    "end": "1150039"
  },
  {
    "text": "hand one by one so we create aggregate profiles Darius would tell you that it's",
    "start": "1150039",
    "end": "1155480"
  },
  {
    "text": "hard to see the Hedgehogs for the trees but this is one way to combine many trees into one big tree and so per day",
    "start": "1155480",
    "end": "1164280"
  },
  {
    "text": "for each set of parameters that we generate data center user logged in in serve lit name whatever we will create a",
    "start": "1164280",
    "end": "1173280"
  },
  {
    "text": "single file for that day of everything that matches that so then we can see the big picture a little more",
    "start": "1173280",
    "end": "1179720"
  },
  {
    "text": "easily and that code starts to look a little something like this we're going to write another map reduce job this is",
    "start": "1179720",
    "end": "1185559"
  },
  {
    "text": "all based around um the Mr job module that Yelp maintains actually it's open",
    "start": "1185559",
    "end": "1190640"
  },
  {
    "text": "sourced on GitHub um we're going to read in path names",
    "start": "1190640",
    "end": "1195960"
  },
  {
    "text": "that may match for a certain day like the entire day's list of path names and so we're going to download the",
    "start": "1195960",
    "end": "1204360"
  },
  {
    "text": "logging data so that we can analyze that and then we're going to download the profiling data so that we can work with",
    "start": "1204360",
    "end": "1210840"
  },
  {
    "text": "that and combine it all and then we're going to generate the key examples data",
    "start": "1210840",
    "end": "1216039"
  },
  {
    "text": "center West Coast user logged in homepage serlet and you look at this and you say",
    "start": "1216039",
    "end": "1222200"
  },
  {
    "text": "Zack you already showed me this why do I care well the fact is is you do care",
    "start": "1222200",
    "end": "1227520"
  },
  {
    "text": "because this turns quickly into combinatoric hell because now what we're going to do",
    "start": "1227520",
    "end": "1233480"
  },
  {
    "text": "is we're going to generate every single matching path for all possible sizes of",
    "start": "1233480",
    "end": "1240400"
  },
  {
    "text": "attributes so if you have seven attributes total we're going to generate one that matches all seven then we're going to generate more and more and more",
    "start": "1240400",
    "end": "1247240"
  },
  {
    "text": "that match six five four and then everything's going to",
    "start": "1247240",
    "end": "1252360"
  },
  {
    "text": "match the no parameters file so yeah that's right we're taking every profile",
    "start": "1252360",
    "end": "1257440"
  },
  {
    "text": "we generate for a single day and cramming them all into one file you heard me right but we do all",
    "start": "1257440",
    "end": "1264159"
  },
  {
    "text": "this and eventually for for each one of these matches this turns into a huge",
    "start": "1264159",
    "end": "1269960"
  },
  {
    "text": "Multiplex we emit the path of the file of the specific file and the we oh I'm",
    "start": "1269960",
    "end": "1278080"
  },
  {
    "text": "sorry we actually emit the path of the aggregate file that we're eventually going to save into and then we emit the",
    "start": "1278080",
    "end": "1283200"
  },
  {
    "text": "data that we're going to put there and if you look at the uh this you",
    "start": "1283200",
    "end": "1289440"
  },
  {
    "text": "notice that there's a method called batch process paths and it's underlined and it's in green and that's not fitting",
    "start": "1289440",
    "end": "1297600"
  },
  {
    "text": "with the style that I'm using and that's because that function is messy the first",
    "start": "1297600",
    "end": "1303640"
  },
  {
    "text": "version looked a little like that I'm a recovering list programmer please don't",
    "start": "1303640",
    "end": "1308679"
  },
  {
    "text": "judge me but there's an XKCD for",
    "start": "1308679",
    "end": "1314720"
  },
  {
    "text": "everything someday lisp is coming back work my words",
    "start": "1316000",
    "end": "1321880"
  },
  {
    "text": "so aggregating into multiple requests let's talk about the reducer so given an",
    "start": "1321880",
    "end": "1328000"
  },
  {
    "text": "aggregate path and one or many entries that match that path going to build an",
    "start": "1328000",
    "end": "1334600"
  },
  {
    "text": "accumulator it's pretty straightforward and this code is somewhat reduced from the version that we're actually running",
    "start": "1334600",
    "end": "1340200"
  },
  {
    "text": "in production mostly for the sake of fitting it on the slides I reckon that if you go out and you intend to build it",
    "start": "1340200",
    "end": "1345799"
  },
  {
    "text": "you if you started from this you'd eventually figure out like the little nooks and crannies which is basically",
    "start": "1345799",
    "end": "1350880"
  },
  {
    "text": "exception handling so build an accumulator set Everything To None or empty and then for each entry that",
    "start": "1350880",
    "end": "1357240"
  },
  {
    "text": "you're given for this aggregate profile that you're going to generate combine",
    "start": "1357240",
    "end": "1363080"
  },
  {
    "text": "the P stats objects into a single piece stats object and this is made easy",
    "start": "1363080",
    "end": "1368919"
  },
  {
    "text": "because that module happens to have an ad method so this is built in from the get-go into the stock P stats and then",
    "start": "1368919",
    "end": "1375760"
  },
  {
    "text": "of course you want to add in your logging data together because this will create a big long Json list of",
    "start": "1375760",
    "end": "1382840"
  },
  {
    "text": "dictionaries of attributes the second part's on the second",
    "start": "1382840",
    "end": "1388159"
  },
  {
    "text": "slide um we now are going to generate the batch path name from the partial",
    "start": "1388159",
    "end": "1394840"
  },
  {
    "text": "from the partial key that we were given and save the combined profiles and the",
    "start": "1394840",
    "end": "1401120"
  },
  {
    "text": "combined attributes back into S3 into another location which is called uh data",
    "start": "1401120",
    "end": "1409120"
  },
  {
    "text": "C profile processed this batch batch runs and it's called processed because",
    "start": "1409120",
    "end": "1414960"
  },
  {
    "text": "this stuff can be easily regenerated actually if you keep your scribe logs forever in S3 either one of these can be",
    "start": "1414960",
    "end": "1420559"
  },
  {
    "text": "easily regenerated but this one in particular we already have the raw individual profile so we can go back and",
    "start": "1420559",
    "end": "1425840"
  },
  {
    "text": "run through this whenever we want and then once again yield out a",
    "start": "1425840",
    "end": "1431120"
  },
  {
    "text": "diagnostic about how many lines you we actually created um and and saved",
    "start": "1431120",
    "end": "1439440"
  },
  {
    "text": "going back to the uh system diagram end of the spectrum uh we start with a web request profile me",
    "start": "1439440",
    "end": "1446960"
  },
  {
    "text": "maybe and uh goes to scribe aggregator there's a first elastic map reduce job",
    "start": "1446960",
    "end": "1452840"
  },
  {
    "text": "which is when we upload them into individual profiles and tag them so we",
    "start": "1452840",
    "end": "1458600"
  },
  {
    "text": "have get discret profiles and logs and per attribute tags and then there's a second map reduce job that Aggregates",
    "start": "1458600",
    "end": "1465840"
  },
  {
    "text": "them into combined profiles which then writes those out of course into S3 again",
    "start": "1465840",
    "end": "1471279"
  },
  {
    "text": "as the combined profiles um you'll notice that there's in the top right there's the profis service and this is",
    "start": "1471279",
    "end": "1477960"
  },
  {
    "text": "where this is where Darius hangs out and this is basically a quick and dirty web app nothing too special from the web app",
    "start": "1477960",
    "end": "1484080"
  },
  {
    "text": "construction end of things but profis exposes the collected profiles you know",
    "start": "1484080",
    "end": "1491600"
  },
  {
    "text": "in a relatively easy to use interface probalistic will also allow you to start up ad hoc",
    "start": "1491600",
    "end": "1498520"
  },
  {
    "text": "combination map reduce jobs so we by default only create files for a single",
    "start": "1498520",
    "end": "1505679"
  },
  {
    "text": "day but let's say that you had a serlet and you wanted to know all the long",
    "start": "1505679",
    "end": "1510919"
  },
  {
    "text": "running profiles for that serlet over a week well we don't do that by default",
    "start": "1510919",
    "end": "1517520"
  },
  {
    "text": "but profis can do that for you and so all you do is provide profis with your email address and we'll run an ad hoc",
    "start": "1517520",
    "end": "1524440"
  },
  {
    "text": "job and you'll get an email notification once complete this actually does doesn't really take very long because at the",
    "start": "1524440",
    "end": "1529720"
  },
  {
    "text": "front end we can filter out all the records that don't match ahead of time so now here's what I'm going to",
    "start": "1529720",
    "end": "1536279"
  },
  {
    "text": "tell you we have for every possible combination a combined set of profile",
    "start": "1536279",
    "end": "1542559"
  },
  {
    "text": "statistics and a combined set of logging data for example if you debugging the biz details servlet which on Yelp is",
    "start": "1542559",
    "end": "1549919"
  },
  {
    "text": "when you actually you know see the photo of the business and the hours and the recommended reviews and all of that it's",
    "start": "1549919",
    "end": "1557279"
  },
  {
    "text": "one of our big important Pages as you might expect so Biz details slowed down",
    "start": "1557279",
    "end": "1562640"
  },
  {
    "text": "for some users and we start out thinking hm long running is bad of course and a",
    "start": "1562640",
    "end": "1571399"
  },
  {
    "text": "lot of times there's extra stuff that's added to the page when the user is logged in so as a as a shot in the dark",
    "start": "1571399",
    "end": "1578039"
  },
  {
    "text": "let's turn those two on and you get your profiles and you notice hm a higher",
    "start": "1578039",
    "end": "1583360"
  },
  {
    "text": "percentage of these are bad compared to the everything Biz details ever for that",
    "start": "1583360",
    "end": "1590440"
  },
  {
    "text": "day but some of them are still okay so then you think maybe something has gone wrong in our East Coast Data Center so",
    "start": "1590440",
    "end": "1597240"
  },
  {
    "text": "you filter by that and now you see okay I have a higher percent I have a higher still percentage of bad stuff then you",
    "start": "1597240",
    "end": "1604159"
  },
  {
    "text": "say maybe it was only post requests like rights to the database maybe so you do",
    "start": "1604159",
    "end": "1609799"
  },
  {
    "text": "that and then you realize that this problem is only defined to the main worldwide website the dubdub duub it",
    "start": "1609799",
    "end": "1617120"
  },
  {
    "text": "doesn't happen on the mobile doesn't happen on apis anything like that and so now we have gone from have from knowing",
    "start": "1617120",
    "end": "1623559"
  },
  {
    "text": "one parameter to knowing five and at this point everything looks terrible and so",
    "start": "1623559",
    "end": "1630000"
  },
  {
    "text": "now you have something to go off of because you have some idea of where this Behavior has come from and now you can go dig into the profiles with a lot more",
    "start": "1630000",
    "end": "1636200"
  },
  {
    "text": "knowledge and assurance that you have something to go on going back to this we",
    "start": "1636200",
    "end": "1642720"
  },
  {
    "text": "can see that uh diffing two piece stats from several months ago and from now",
    "start": "1642720",
    "end": "1648559"
  },
  {
    "text": "once you've narrowed it down that much makes a lot more sense so if you had one line in this file that for example had a",
    "start": "1648559",
    "end": "1654840"
  },
  {
    "text": "before of you know 200 calls and now has 20,000 calls you know what happened",
    "start": "1654840",
    "end": "1661480"
  },
  {
    "text": "somebody didn't optimize something and it's being done several orders of magnitude too much and so you can then",
    "start": "1661480",
    "end": "1669039"
  },
  {
    "text": "probably go and isolate that method and get blame it and find that person and talk to them",
    "start": "1669039",
    "end": "1675000"
  },
  {
    "text": "about why is this can we do this better it's not working out for",
    "start": "1675000",
    "end": "1682200"
  },
  {
    "text": "us but just like every good thing every nice Hedgehog you know he needs to need",
    "start": "1682200",
    "end": "1689080"
  },
  {
    "text": "you know rent needs to be paid for the Hedgehog right and at least the way we do it now rent on profiling at Yelp",
    "start": "1689080",
    "end": "1695120"
  },
  {
    "text": "isn't cheap these are per day we generate on this day and this",
    "start": "1695120",
    "end": "1701960"
  },
  {
    "text": "number is actually a little outdated um on this day we profiled 152,000 and",
    "start": "1701960",
    "end": "1707080"
  },
  {
    "text": "change discret web requests we created",
    "start": "1707080",
    "end": "1712720"
  },
  {
    "text": "40,500 aggregate combinations from no attributes to all seven attributes",
    "start": "1712720",
    "end": "1718000"
  },
  {
    "text": "turned on which created a total of 386,000 new files in Amazon",
    "start": "1718000",
    "end": "1725320"
  },
  {
    "text": "S3 luckily we gzip them because even when they're gzipped they take 62 gigs a",
    "start": "1725320",
    "end": "1731600"
  },
  {
    "text": "day oh and we don't delete anything ever so there's that right",
    "start": "1731600",
    "end": "1738760"
  },
  {
    "text": "storage is a problem of course you could very easily if you decided that maybe you",
    "start": "1738760",
    "end": "1744919"
  },
  {
    "text": "didn't care about your profiles from a year ago because your app has changed so very much from a year ago you could just",
    "start": "1744919",
    "end": "1750039"
  },
  {
    "text": "you could just create a Chron job that goes out and deletes all that stuff that's up to you um there are many ways",
    "start": "1750039",
    "end": "1755480"
  },
  {
    "text": "to keep your storage down and none of them are particularly technically interesting but performance is another",
    "start": "1755480",
    "end": "1763120"
  },
  {
    "text": "problem so I suspect for a lot of people in the audience the last time you saw a",
    "start": "1763120",
    "end": "1768399"
  },
  {
    "text": "cumulative distribution function was perhaps in graduate school and um this",
    "start": "1768399",
    "end": "1773840"
  },
  {
    "text": "one describes the profile count per aggregate file and that's a really long",
    "start": "1773840",
    "end": "1780840"
  },
  {
    "text": "tale I'll break it down for you in map ruce we assume we hope we pray that",
    "start": "1780840",
    "end": "1788760"
  },
  {
    "text": "every unit of work that we do every mapper every reducer is going to take an equal amount of time more or less but",
    "start": "1788760",
    "end": "1795840"
  },
  {
    "text": "for profiling because of this combinatoric hell we've got ourselves into that's just not true so 60% of the",
    "start": "1795840",
    "end": "1803159"
  },
  {
    "text": "files we generate contain 10 or fewer profiles and they generate almost instantly you're just Bound by the",
    "start": "1803159",
    "end": "1809240"
  },
  {
    "text": "network by the network gap between your elastic map reduce cluster and the S3",
    "start": "1809240",
    "end": "1814640"
  },
  {
    "text": "endpoint that you're accessing so 60% easy even 95% isn't so",
    "start": "1814640",
    "end": "1820640"
  },
  {
    "text": "bad 95% of them contain a thousand or fewer profiles not so bad but there are",
    "start": "1820640",
    "end": "1825720"
  },
  {
    "text": "eight files that we generate every day that contain over a 100,000",
    "start": "1825720",
    "end": "1831840"
  },
  {
    "text": "profiles you can probably imagine what you know some of those are like the one",
    "start": "1831840",
    "end": "1837240"
  },
  {
    "text": "that contains everything for example is a is the big",
    "start": "1837240",
    "end": "1842880"
  },
  {
    "text": "offender of course you could just decide well for these big sets I I don't even need",
    "start": "1843480",
    "end": "1850440"
  },
  {
    "text": "to generate them like why do I care I'll just skip doing those and sure that's fine except we found that our Engineers",
    "start": "1850440",
    "end": "1856919"
  },
  {
    "text": "are actually particularly interested in those big sets and every attempt to stop doing them has led to people saying",
    "start": "1856919",
    "end": "1863200"
  },
  {
    "text": "these are useful to me please find a way to keep them so we've kept them but you remember Darius you",
    "start": "1863200",
    "end": "1869679"
  },
  {
    "text": "remember how I was talking about this should be easy to use well it's his time to shine and we'll talk about the actual",
    "start": "1869679",
    "end": "1875000"
  },
  {
    "text": "little web app it's called profis and it looks like this um pretty straightforward interface",
    "start": "1875000",
    "end": "1882679"
  },
  {
    "text": "nothing too pretty functional but you can select a beginning date and an ending date",
    "start": "1882679",
    "end": "1888720"
  },
  {
    "text": "how many records you want to include uh if you'd like your job to run a little faster and you're asking for a million",
    "start": "1888720",
    "end": "1895120"
  },
  {
    "text": "profiles you can down sample to a thousand if you want um whether or not the job's long running whether or not",
    "start": "1895120",
    "end": "1901320"
  },
  {
    "text": "the user's logged in which data center which HTTP method you can select multiple of these if you want um which",
    "start": "1901320",
    "end": "1908600"
  },
  {
    "text": "of our internal sites whether dubdub duub or mobile or whatever and the",
    "start": "1908600",
    "end": "1913760"
  },
  {
    "text": "servlet and the action and if you specify your email address",
    "start": "1913760",
    "end": "1918960"
  },
  {
    "text": "then you can start an ad hoc job and get an email when it's completed over",
    "start": "1918960",
    "end": "1924000"
  },
  {
    "text": "multiple days of Records but normally people are interested in one day this is probably",
    "start": "1924000",
    "end": "1929960"
  },
  {
    "text": "80% of the use cases for profis people are interested in one day at a time and so that stuff's generated every night so",
    "start": "1929960",
    "end": "1938279"
  },
  {
    "text": "we just say hey this data has been created and cached for you and so in this case on October 1 uh we processed",
    "start": "1938279",
    "end": "1945200"
  },
  {
    "text": "28,000 profiles for the business details page and so you can just go and download",
    "start": "1945200",
    "end": "1951200"
  },
  {
    "text": "those combined files if you ask for something that let's say you asked for a",
    "start": "1951200",
    "end": "1956360"
  },
  {
    "text": "month of profiling data across the entire site you're probably going to be in trouble because that's going to be I",
    "start": "1956360",
    "end": "1963960"
  },
  {
    "text": "mean that job is going to take like a week two weeks to run with the normal cluster size so for this guy for",
    "start": "1963960",
    "end": "1970279"
  },
  {
    "text": "example automatically condensed it down to a thousand of the choicest juiciest",
    "start": "1970279",
    "end": "1976000"
  },
  {
    "text": "profiles and by that I mean a regular step wise sampling um but it's makes it a lot",
    "start": "1976000",
    "end": "1981960"
  },
  {
    "text": "simpler and it makes the user happy because instead of having to wait 6",
    "start": "1981960",
    "end": "1987440"
  },
  {
    "text": "hours or something for this relatively small by default EMR cluster to run their job this takes about 15 minutes if",
    "start": "1987440",
    "end": "1994639"
  },
  {
    "text": "we down sample to a th and most of that 15 minutes is bootstrapping anyway into setting up our setting up our pipeline",
    "start": "1994639",
    "end": "2001600"
  },
  {
    "text": "in elastic map reduce there's also the email that you get if you ask for one of these ad hoc",
    "start": "2001600",
    "end": "2007880"
  },
  {
    "text": "job so in this one we asked for a th and there's an off by one error so they got a th5 but I think they'll be okay with",
    "start": "2007880",
    "end": "2015480"
  },
  {
    "text": "that I know a lot of people have been interested in this talk because of its applications to",
    "start": "2015480",
    "end": "2022679"
  },
  {
    "text": "real-time data processing or its use of it and how Yelp uses storm so let's talk",
    "start": "2022679",
    "end": "2028600"
  },
  {
    "text": "about real time if you're not familiar Apache storm is a real-time distributed",
    "start": "2028600",
    "end": "2035080"
  },
  {
    "text": "computation platform and basically it's a directed graph of processing steps and",
    "start": "2035080",
    "end": "2041279"
  },
  {
    "text": "so it passes around tupes between individual parts of its topology since",
    "start": "2041279",
    "end": "2046440"
  },
  {
    "text": "it's a graph so that you have spouts which are sources of data uh so scribe",
    "start": "2046440",
    "end": "2051638"
  },
  {
    "text": "can has a spout for example you have bolts which are processors of data so",
    "start": "2051639",
    "end": "2057200"
  },
  {
    "text": "just like a mapper or a reducer in our Mr job code that we went over you can",
    "start": "2057200",
    "end": "2063200"
  },
  {
    "text": "see how the parallels might lie there and then you can set up grouping which",
    "start": "2063200",
    "end": "2068240"
  },
  {
    "text": "Define how tupal move between individual spouts and bolts but Apache storm doesn't support",
    "start": "2068240",
    "end": "2076158"
  },
  {
    "text": "python out of the box so we did that for you um we just recently released open-",
    "start": "2076159",
    "end": "2082280"
  },
  {
    "text": "Source something called pileus which is a python framework for storm topologies it's super super new this was like",
    "start": "2082280",
    "end": "2089040"
  },
  {
    "text": "literally a couple weeks ago and it allows you to build storm topologies in",
    "start": "2089040",
    "end": "2094280"
  },
  {
    "text": "pure python they seriously don't look hardly any different from the map reduce jobs that we showed earlier it also has",
    "start": "2094280",
    "end": "2102839"
  },
  {
    "text": "this cool feature where you describe its structure as a AML file and it'll even",
    "start": "2102839",
    "end": "2108079"
  },
  {
    "text": "respect the requirements. text so if you have prepackaged spouts and bolts you can just hook them together based on the",
    "start": "2108079",
    "end": "2114839"
  },
  {
    "text": "fact that you have the packages and just hit run and it just works so I'll show you a sample pile this topology uh this",
    "start": "2114839",
    "end": "2122160"
  },
  {
    "text": "is the beginning of the one for profis uh we have three workers set up",
    "start": "2122160",
    "end": "2127200"
  },
  {
    "text": "um this was a test cluster I believe at the time and we provide two spouts we",
    "start": "2127200",
    "end": "2132839"
  },
  {
    "text": "provide a West Coast spout that reads out of the West Coast Data Center and",
    "start": "2132839",
    "end": "2138079"
  },
  {
    "text": "reads out of the C profile stream coming out of scribe and we provide an East Coast one these are idealized obviously",
    "start": "2138079",
    "end": "2146160"
  },
  {
    "text": "um but so West Coast and East Coast Data Center scribe",
    "start": "2146160",
    "end": "2152240"
  },
  {
    "text": "spouts you also provide the bolts so the first one is basically equivalent to the",
    "start": "2152760",
    "end": "2160000"
  },
  {
    "text": "first mapper in the first map reduce job all it does is reads Out Of The Scribe",
    "start": "2160000",
    "end": "2165359"
  },
  {
    "text": "Channel and processes the profiling data and the logging data and sends them out to S3 and then passes onward all the",
    "start": "2165359",
    "end": "2173000"
  },
  {
    "text": "tags that match it so you see the shuffle grouping because what we're doing is we're merging data from the two",
    "start": "2173000",
    "end": "2178960"
  },
  {
    "text": "data centers together the second bolt similar it's",
    "start": "2178960",
    "end": "2185200"
  },
  {
    "text": "pretty much the equivalent of the first reducer but we also include an S3 cache and what I mean by S3 cache is when we",
    "start": "2185200",
    "end": "2192079"
  },
  {
    "text": "receive we're going to receive profiles in real time that match a certain set of",
    "start": "2192079",
    "end": "2197560"
  },
  {
    "text": "attributes West Coast Data Center business details user logged in for example and so this this one particular",
    "start": "2197560",
    "end": "2203720"
  },
  {
    "text": "bolt is going to process all of these but since they're coming in continuously we probably don't want to hit S3 given",
    "start": "2203720",
    "end": "2210280"
  },
  {
    "text": "that it's eventually consistent every time we get a new record because for some of these really heavily utilized",
    "start": "2210280",
    "end": "2216560"
  },
  {
    "text": "bolts that's going to create a lot of trouble so instead maybe every 5 minutes",
    "start": "2216560",
    "end": "2222400"
  },
  {
    "text": "you accumulate this stuff for 5 minutes and then after 5 minutes you write it out test three and reset your",
    "start": "2222400",
    "end": "2227800"
  },
  {
    "text": "accumulator and in this case you notice that we set what's called a Fields",
    "start": "2227800",
    "end": "2233000"
  },
  {
    "text": "grouping and the fields grouping is based on the tag so like I said the",
    "start": "2233000",
    "end": "2240040"
  },
  {
    "text": "however many attributes that we're going to combine upon we'll go on from here and I'll show",
    "start": "2240040",
    "end": "2246040"
  },
  {
    "text": "you kind of the basic pileus structure um my first bolt based based upon simple",
    "start": "2246040",
    "end": "2253359"
  },
  {
    "text": "bolt set up an initializer if you have a configuration file this runs you know on",
    "start": "2253359",
    "end": "2258560"
  },
  {
    "text": "Startup set up your S3 bucket if you want to do that and then you just process the incoming tupal you get a key",
    "start": "2258560",
    "end": "2265359"
  },
  {
    "text": "and you get a value and then you do stuff here and create your new tupal and",
    "start": "2265359",
    "end": "2271760"
  },
  {
    "text": "emit it and give it a give it a name equals Main and you're done that's a",
    "start": "2271760",
    "end": "2279000"
  },
  {
    "text": "pileus bolt it's pretty straightforward when you take all the logic out of",
    "start": "2279000",
    "end": "2284160"
  },
  {
    "text": "it so profis and pileus for our specific application the profiles used to be one",
    "start": "2284160",
    "end": "2291280"
  },
  {
    "text": "day delayed and what I mean by that is for profiles that were collected on a Monday based on Monday's web traffic",
    "start": "2291280",
    "end": "2298119"
  },
  {
    "text": "we'd make it to about 1:00 a.m. into Tuesday and then",
    "start": "2298119",
    "end": "2303440"
  },
  {
    "text": "we'd kick off our batch jobs so the batch jobs would take in the cluster size that we were providing them with uh",
    "start": "2303440",
    "end": "2310839"
  },
  {
    "text": "the first one was a little under an hour and then the second one was somewhere between two and four hours so by the",
    "start": "2310839",
    "end": "2317119"
  },
  {
    "text": "time our Engineers on the west coast came into work the profiles for the previous day were already there so",
    "start": "2317119",
    "end": "2322480"
  },
  {
    "text": "that's fine but in emergencies that's not fine if it's 2: p.m. and crap hit the fan at 10:00 a.m.",
    "start": "2322480",
    "end": "2331079"
  },
  {
    "text": "you wouldn't normally get those profiles until the next day so in that case usually somebody would come to me and",
    "start": "2331079",
    "end": "2336440"
  },
  {
    "text": "they'd say please start start the batch ad hoc we really need the help but because we have this running in pileus",
    "start": "2336440",
    "end": "2342400"
  },
  {
    "text": "and storm now at 10 minutes or so after bad performance you just get your profiles you just get them now they're",
    "start": "2342400",
    "end": "2348960"
  },
  {
    "text": "there for you you can investigate whatever's wrong with your application this has made a lot of",
    "start": "2348960",
    "end": "2354960"
  },
  {
    "text": "Engineers very happy and it's made me happy because people have stopped bothering me to get me to turn on the batch",
    "start": "2354960",
    "end": "2361040"
  },
  {
    "text": "jobs so talk a little bit about the future work and ideas and stuff um that",
    "start": "2361040",
    "end": "2368800"
  },
  {
    "text": "Yelp has in mind for profiling and for one thing I actually have an intern working on this right now um active",
    "start": "2368800",
    "end": "2375640"
  },
  {
    "text": "monitoring since we're already creating these big sets of profiles and we're already and we're already doing it in a",
    "start": "2375640",
    "end": "2381520"
  },
  {
    "text": "storm topology for every new aggregation created each day just pull the same",
    "start": "2381520",
    "end": "2386640"
  },
  {
    "text": "combination from a day a week a month ago whatever you want diff them and if",
    "start": "2386640",
    "end": "2391800"
  },
  {
    "text": "you see a bunch of really bad performance indications alert somebody send an email ticket ticket this in your",
    "start": "2391800",
    "end": "2397960"
  },
  {
    "text": "in your tracking system whatever because you already have this topology and you're doing a diff so",
    "start": "2397960",
    "end": "2404720"
  },
  {
    "text": "there's two things and half your data is already there half of it you're getting for free at the end of your last bolt",
    "start": "2404720",
    "end": "2411119"
  },
  {
    "text": "instead of just saving it out to S3 and being done with your life you admit it one more time and it goes on to the next",
    "start": "2411119",
    "end": "2416599"
  },
  {
    "text": "bolt and you do your alerting checks second",
    "start": "2416599",
    "end": "2422359"
  },
  {
    "text": "one visualization within the web app we already had a script that would",
    "start": "2422359",
    "end": "2428000"
  },
  {
    "text": "parse our profiling data and convert them via graphviz to PDF but in our most",
    "start": "2428000",
    "end": "2436240"
  },
  {
    "text": "recent yell packathon which was just a couple weeks ago somebody actually built this so my slides are a little out of",
    "start": "2436240",
    "end": "2443000"
  },
  {
    "text": "date I apologize but now you can just select a profile and in the web app just",
    "start": "2443000",
    "end": "2448079"
  },
  {
    "text": "say boom here's the call graph see everything see the percentages it's",
    "start": "2448079",
    "end": "2455359"
  },
  {
    "text": "great so hopefully I haven't thrown too much information at you um getting a little low on time but you might wonder",
    "start": "2455359",
    "end": "2461680"
  },
  {
    "text": "you know what are the takeaways of this talk I've talked a lot about a couple different things so I'll give you the",
    "start": "2461680",
    "end": "2467520"
  },
  {
    "text": "upshot step one wrap your web app in a context manager step two take data from",
    "start": "2467520",
    "end": "2474880"
  },
  {
    "text": "that context manager send it these profiles and logs into the cloud step",
    "start": "2474880",
    "end": "2480920"
  },
  {
    "text": "three tag these with the attributes that you care about whether that's the data",
    "start": "2480920",
    "end": "2486800"
  },
  {
    "text": "center whether that's a specific logged in user whatever works for your use case step",
    "start": "2486800",
    "end": "2492720"
  },
  {
    "text": "four take all these attributes and do an all pairs",
    "start": "2492720",
    "end": "2498839"
  },
  {
    "text": "combination make a single file for any possible use case of terribleness that",
    "start": "2498839",
    "end": "2506200"
  },
  {
    "text": "you could have this prevents an engineer from being faced with 500 5,000 50,000",
    "start": "2506200",
    "end": "2512040"
  },
  {
    "text": "files and not knowing what to do with them build a quick and dirty internal app to be able able to access this stuff",
    "start": "2512040",
    "end": "2518720"
  },
  {
    "text": "easily this should take you know a lot of people in the audience like half a day and then if you want it to be fast",
    "start": "2518720",
    "end": "2525480"
  },
  {
    "text": "and you want it to be in real time you can refactor it into storm and pileus and at the end make sure you give Darius a hug because a lot of people get upset",
    "start": "2525480",
    "end": "2533720"
  },
  {
    "text": "with him when he doesn't work and he could use the love he believes in",
    "start": "2533720",
    "end": "2539200"
  },
  {
    "text": "you um real quick uh yelp's data set challenge um if you've been interested",
    "start": "2539200",
    "end": "2544920"
  },
  {
    "text": "in some of the some of the data sets that Yelp collects this is an academic oriented data set um from five cities",
    "start": "2544920",
    "end": "2552559"
  },
  {
    "text": "and it contains over a million reviews over a quarter million users a social",
    "start": "2552559",
    "end": "2558119"
  },
  {
    "text": "graph uh a lot of interesting information um for academic use research",
    "start": "2558119",
    "end": "2564280"
  },
  {
    "text": "visualizations uh submissions by the end of the year there's more details online yelp.com set",
    "start": "2564280",
    "end": "2572680"
  },
  {
    "text": "Challenge and thank you all so much for coming out to the talk um I'll be outside after this um you can reach me",
    "start": "2572680",
    "end": "2579599"
  },
  {
    "text": "ztm my initials ztm yelp.com and you can find out more about the map reduce and",
    "start": "2579599",
    "end": "2586000"
  },
  {
    "text": "storm packages to do them in Python these are Mr job and pileus at Mr job.org and pile. org so thank you so",
    "start": "2586000",
    "end": "2596000"
  },
  {
    "text": "much and looks like that is about it [Applause]",
    "start": "2596000",
    "end": "2604639"
  }
]