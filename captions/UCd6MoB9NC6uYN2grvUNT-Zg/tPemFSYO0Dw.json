[
  {
    "text": "hey everyone so yeah this is a session on how coinbase builds out its blotching infrastructure just a little bit about",
    "start": "0",
    "end": "7710"
  },
  {
    "text": "me I've been in coinbase for two and a half years now I've done a lot of stuff worked on the infrastructure and",
    "start": "7710",
    "end": "14639"
  },
  {
    "text": "security engineering problems I was like a family an engineer under the moonbase",
    "start": "14639",
    "end": "20310"
  },
  {
    "text": "custody product that we launched about this time last year when we kicked off this time last year and so I've done a",
    "start": "20310",
    "end": "26430"
  },
  {
    "text": "lot of like crypto related crypto crypto storage stuff at my base so we're gonna",
    "start": "26430",
    "end": "33059"
  },
  {
    "text": "talk about I guess three high-level topics today first I'm going to talk about coinbase some particular",
    "start": "33059",
    "end": "39510"
  },
  {
    "text": "constraints of our business and and sort of how that impacts our infrastructure we're also gonna do a little bit of a",
    "start": "39510",
    "end": "45629"
  },
  {
    "text": "deep dive into our infrastructure some of the choices we made around that revolving around security and sort of",
    "start": "45629",
    "end": "51270"
  },
  {
    "text": "the ability to move move quickly and and without with yeah the ability to move",
    "start": "51270",
    "end": "59820"
  },
  {
    "text": "quickly next we're gonna talk about blockchain networks I assume a lot of",
    "start": "59820",
    "end": "64920"
  },
  {
    "text": "you have have know a little bit about block chains but I'm gonna give you like just a brief overview of them for the",
    "start": "64920",
    "end": "70320"
  },
  {
    "text": "zoo in the crowd who don't know much about block chains and then lastly we're going to talk about snap chain which is",
    "start": "70320",
    "end": "76710"
  },
  {
    "text": "a project I worked on over the past little while to seamlessly and easily",
    "start": "76710",
    "end": "82200"
  },
  {
    "text": "deploy block chain nodes within our infrastructure well so first talking about coinbase coinbase is a place to",
    "start": "82200",
    "end": "90900"
  },
  {
    "text": "buy and sell digital currency we like to call ourselves the easiest and most",
    "start": "90900",
    "end": "96750"
  },
  {
    "text": "trusted place to buy sell and manage your digital currency so for this",
    "start": "96750",
    "end": "102299"
  },
  {
    "text": "talking going to talk about I think the most trusted component of that is is really important most trusted means a",
    "start": "102299",
    "end": "110280"
  },
  {
    "text": "couple things from my perspective or the work I do at Queen mace means we need to be reliable we need our",
    "start": "110280",
    "end": "115640"
  },
  {
    "text": "services to be up when people want to be trading it also means that we need to have security at mind in everything we",
    "start": "115640",
    "end": "125300"
  },
  {
    "text": "do so we need to we need to treat people's triples funds incredibly carefully and we can never really let",
    "start": "125300",
    "end": "131300"
  },
  {
    "text": "any severe or major incident happen",
    "start": "131300",
    "end": "137350"
  },
  {
    "text": "Queen mace wasn't always a place where you could interact with a lot of different cryptocurrencies though",
    "start": "137350",
    "end": "143390"
  },
  {
    "text": "originally it was just a place to buy sell and hold Bitcoin since that time",
    "start": "143390",
    "end": "150410"
  },
  {
    "text": "since like the the early days we've added quite a few more currencies so now we have Bitcoin cash we have aetherium",
    "start": "150410",
    "end": "157460"
  },
  {
    "text": "we have etherium classic like coin 0x and a few more and we're adding these",
    "start": "157460",
    "end": "162890"
  },
  {
    "text": "all the time now so we're sort of increasing the rate of adding assets and",
    "start": "162890",
    "end": "168080"
  },
  {
    "text": "if I was if I was to give this talk every invent next year I think this this slide would be like chock-full of all",
    "start": "168080",
    "end": "173960"
  },
  {
    "text": "sorts of different assets so this is just this is like a very critical part about our blockchain infrastructure is",
    "start": "173960",
    "end": "181760"
  },
  {
    "text": "we we have to be thinking about scaling the number of assets in mind whenever we're thinking about you mean a major",
    "start": "181760",
    "end": "187340"
  },
  {
    "text": "infrastructure projects we can't be building super specific to lean to any one blockchain and rather we need to",
    "start": "187340",
    "end": "194060"
  },
  {
    "text": "take this approach that's generic across as many block chains as possible and so",
    "start": "194060",
    "end": "200830"
  },
  {
    "text": "what was once a place to buy sell and hold Bitcoin has now become a place to buy sell and hold crypto more broadly",
    "start": "200830",
    "end": "208150"
  },
  {
    "text": "but coin base is also expanded on the number of use cases and the number of different ways to interact with these",
    "start": "208150",
    "end": "214190"
  },
  {
    "text": "different cryptocurrency networks so we now have Queen base we have Queen Mays",
    "start": "214190",
    "end": "219980"
  },
  {
    "text": "Commerce which is like a merchant tool platform we have prime and pro which are high frequency trading products we have",
    "start": "219980",
    "end": "226610"
  },
  {
    "text": "Queen Mays custody which is an institutional storage product we also have point mace wallet which is a user",
    "start": "226610",
    "end": "232310"
  },
  {
    "text": "controlled wallet also earlier this year we acquired paradox which is a",
    "start": "232310",
    "end": "237740"
  },
  {
    "text": "peer-to-peer exchange and then we also have earn calm so that's just to say",
    "start": "237740",
    "end": "245210"
  },
  {
    "text": "that now we've become a place to buy sell and do a whole lot of other things with crypto the number of use cases has",
    "start": "245210",
    "end": "251900"
  },
  {
    "text": "expanded dramatically and with that the like type of infrastructure we need to submit as use cases has changed pretty",
    "start": "251900",
    "end": "258709"
  },
  {
    "text": "significantly additionally we've grown",
    "start": "258709",
    "end": "264320"
  },
  {
    "text": "substantially I think in the traditional way people think about a company growing so this is our request volume through",
    "start": "264320",
    "end": "271280"
  },
  {
    "text": "April 2017 and then crypto mania happened and things just went a little",
    "start": "271280",
    "end": "277700"
  },
  {
    "text": "bonkers so we're scaling kind of in in many",
    "start": "277700",
    "end": "283100"
  },
  {
    "text": "different ways we're scaling the amount of traffic so it's the traditional way you'd think about scaling a web",
    "start": "283100",
    "end": "288560"
  },
  {
    "text": "application that's requests to the API that's requests to your database that some things like that but we're also",
    "start": "288560",
    "end": "295430"
  },
  {
    "text": "scaling the number of business units and with each business unit might come different ways to integrate and interact",
    "start": "295430",
    "end": "301130"
  },
  {
    "text": "with the barching we're also scaling the total number of blockchain networks that we support and so from my perspective as",
    "start": "301130",
    "end": "309050"
  },
  {
    "text": "somebody who thinks about watching infrastructure at coinbase we've always wanted to build secure and",
    "start": "309050",
    "end": "315290"
  },
  {
    "text": "scalable infrastructure but now we've really added on this additional mandate of thinking about building blockchain",
    "start": "315290",
    "end": "321710"
  },
  {
    "text": "agnostic infrastructures so that's building infrastructure that can be as generic as possible across as many",
    "start": "321710",
    "end": "327080"
  },
  {
    "text": "different chains as we can and that just means that we can more easily spin up",
    "start": "327080",
    "end": "332120"
  },
  {
    "text": "new chains without having to do anything super custom per chain as much as possible now I'm gonna talk a bit about",
    "start": "332120",
    "end": "341320"
  },
  {
    "text": "infrastructure economies and some of the kind of like tenants that we've implemented within within our",
    "start": "341320",
    "end": "346730"
  },
  {
    "text": "infrastructure so the first one yeah that's a Mission Control Center the",
    "start": "346730",
    "end": "353600"
  },
  {
    "text": "first one is that our infrastructure is immutable and what I mean by immutable is that any configuration change",
    "start": "353600",
    "end": "361430"
  },
  {
    "text": "requires a redeploy this ensures that all configuration changes are tracked in source control",
    "start": "361430",
    "end": "367060"
  },
  {
    "text": "and also ensures that were always in a deployable state so we can never get to a point where somebody hops on a box MUX",
    "start": "367060",
    "end": "374620"
  },
  {
    "text": "around does something downloads a few dependencies and we don't know exactly what happens instead everything is",
    "start": "374620",
    "end": "381550"
  },
  {
    "text": "immutable and so anytime we change something we entirely tear down and rebuild the application kind of together",
    "start": "381550",
    "end": "388720"
  },
  {
    "text": "with this idea of immutability coin bases infrastructure is ephemeral so",
    "start": "388720",
    "end": "394570"
  },
  {
    "text": "every server in our infrastructure lives for less than 30 days in practice this",
    "start": "394570",
    "end": "399639"
  },
  {
    "text": "isn't always the case but it's it's something that we strive to do it's like one of the core KPIs of the",
    "start": "399639",
    "end": "404889"
  },
  {
    "text": "infrastructure team this is a huge security win this means that if any",
    "start": "404889",
    "end": "410729"
  },
  {
    "text": "vulnerabilities were to come out we're constantly redeploying these servers tearing down the old ones and pulling in",
    "start": "410729",
    "end": "416350"
  },
  {
    "text": "the updated packages that might have a vulnerability it also means that if anybody were to ever gain persistence I",
    "start": "416350",
    "end": "423639"
  },
  {
    "text": "can attack over to gain persistence in our network we'd constantly be pulling the rug out from under them so we'd be tearing down tearing down the box that",
    "start": "423639",
    "end": "430419"
  },
  {
    "text": "someone might have and it'd be incredibly difficult to maintain persistence in our cloud more on the",
    "start": "430419",
    "end": "439000"
  },
  {
    "text": "human element of the infrastructure team we've implemented this idea of consensus",
    "start": "439000",
    "end": "445120"
  },
  {
    "text": "so within coinbase consensus really means that no one person can perform",
    "start": "445120",
    "end": "450520"
  },
  {
    "text": "sensitive actions individually but any sufficiently large group of people can do anything and use of any scary option",
    "start": "450520",
    "end": "457720"
  },
  {
    "text": "together this is this is a critical idea and it's carried through like all",
    "start": "457720",
    "end": "463599"
  },
  {
    "text": "throughout like our tooling across flame is typically the number of people",
    "start": "463599",
    "end": "470710"
  },
  {
    "text": "required to perform an action as perform is like proportional to the sensitivity of that action",
    "start": "470710",
    "end": "477870"
  },
  {
    "text": "and lastly as much as possible we try and make our tooling and automation",
    "start": "478280",
    "end": "483700"
  },
  {
    "text": "self-service so both consensus tooling and self",
    "start": "483700",
    "end": "489050"
  },
  {
    "text": "service requires a heavy heavy dose of automation so we kind of combine consensus and self service together into",
    "start": "489050",
    "end": "495950"
  },
  {
    "text": "into one application where we can where we can enable engineers to not have to",
    "start": "495950",
    "end": "501170"
  },
  {
    "text": "work directly with the DevOps engineers to do at things they need instead we build a tooling that allows them to to",
    "start": "501170",
    "end": "506960"
  },
  {
    "text": "to do what they need to do so with",
    "start": "506960",
    "end": "512270"
  },
  {
    "text": "consensus and with self-service tooling we it means that all application",
    "start": "512270",
    "end": "519140"
  },
  {
    "text": "deployments are completely engineer managed and not really managed by the DevOps team or the infrastructure team instead it deploys and rollbacks are",
    "start": "519140",
    "end": "526850"
  },
  {
    "text": "handled by the people who know those applications the best the engineers have built them so instead of having a DevOps",
    "start": "526850",
    "end": "532610"
  },
  {
    "text": "engineer who spins up an application performs a deploy and doesn't really know what a particularly long line means",
    "start": "532610",
    "end": "538010"
  },
  {
    "text": "or doesn't know the expected number of 500s and applications supposed to throw we have the people who actually know and",
    "start": "538010",
    "end": "543620"
  },
  {
    "text": "actually wrote those applications the experts in this application Shepherd the deploys cool so that is that's just like",
    "start": "543620",
    "end": "554660"
  },
  {
    "text": "a little bit on point mace and our infrastructure now I want to talk a bit",
    "start": "554660",
    "end": "560180"
  },
  {
    "text": "about blockchain networks and I apologize this might be a little redundant if you all have have seen or",
    "start": "560180",
    "end": "566450"
  },
  {
    "text": "know a bit about boxing networks actually how many of you know much about bar chains like how many of you have",
    "start": "566450",
    "end": "572120"
  },
  {
    "text": "seen and talked like this before on watchings ok decent number",
    "start": "572120",
    "end": "577800"
  },
  {
    "text": "so a blockchain is just a linked list of blocks where each block contains",
    "start": "577800",
    "end": "586060"
  },
  {
    "text": "modifications to the global states now if your crypto nerd you might know that",
    "start": "586060",
    "end": "591760"
  },
  {
    "text": "different block chains are coming out now that actually don't implement linked lists a lot of the like fancy",
    "start": "591760",
    "end": "597160"
  },
  {
    "text": "cutting-edge projects are using DAGs or directed acyclic graphs instead of a linked list of blocks I think it's",
    "start": "597160",
    "end": "604029"
  },
  {
    "text": "easiest for us to to sort of illustrate just a linked list here so I'm gonna implement that also I want to call out",
    "start": "604029",
    "end": "611139"
  },
  {
    "text": "that I'm saying global state here I'm not saying account balances which might you might use if you're talking",
    "start": "611139",
    "end": "617170"
  },
  {
    "text": "about the Bitcoin network specifically I'm not saying smart contract state which you might you might use if you're",
    "start": "617170",
    "end": "624220"
  },
  {
    "text": "talking about the ethereum blockchain specifically instead I'm saying just global State this is any botching that",
    "start": "624220",
    "end": "630220"
  },
  {
    "text": "and then any blockchain might have different different types of Saveur might use might have very different use",
    "start": "630220",
    "end": "636880"
  },
  {
    "text": "cases so I'm trying to keep this as generic as possible and that will just be a theme throughout this presentation I'm going to talk about global State",
    "start": "636880",
    "end": "644670"
  },
  {
    "text": "okay so we have four blocks here and this is a chain of blocks each one of",
    "start": "644670",
    "end": "650529"
  },
  {
    "text": "these crazy-looking numbers is like the block the block header and each subsequent block references the previous",
    "start": "650529",
    "end": "658000"
  },
  {
    "text": "block and so as we a new block comes into the system and it contains a",
    "start": "658000",
    "end": "664750"
  },
  {
    "text": "reference to its previous block so in this way work we're just constantly amending this chain the chain is",
    "start": "664750",
    "end": "670569"
  },
  {
    "text": "constantly growing the amount of state involved is constantly growing",
    "start": "670569",
    "end": "675870"
  },
  {
    "text": "also watching networks are decentralized peer-to-peer systems so there's no",
    "start": "677200",
    "end": "683470"
  },
  {
    "text": "central authority that's propagating these state updates throughout the network rather the blockchain notes",
    "start": "683470",
    "end": "690149"
  },
  {
    "text": "validate detect and relay these state updates throughout the network so from",
    "start": "690149",
    "end": "695709"
  },
  {
    "text": "coin bases perspective these nodes are our eyes and ears into this network",
    "start": "695709",
    "end": "702240"
  },
  {
    "text": "whenever somebody wants to send funds into coin base they log into their app",
    "start": "702810",
    "end": "709540"
  },
  {
    "text": "we show them a deposit address they use you know a wallet they might control and send their funds and we can actually",
    "start": "709540",
    "end": "715720"
  },
  {
    "text": "detect that they did in fact send those funds to an address that we control by query in these notes so we're pinging",
    "start": "715720",
    "end": "722350"
  },
  {
    "text": "these nodes and saying did this transaction actually occur yes in the event that it did we can credit their account balance similarly on the other",
    "start": "722350",
    "end": "730810"
  },
  {
    "text": "side if somebody wants to send funds out of coin base we create a transaction",
    "start": "730810",
    "end": "736180"
  },
  {
    "text": "sign that transaction and broadcast it through one of these nodes and then we",
    "start": "736180",
    "end": "741310"
  },
  {
    "text": "query that query the note to see did the did the transaction actually propagate through the network did it confirm and",
    "start": "741310",
    "end": "748260"
  },
  {
    "text": "once it did once we're working Vince that it actually did can confirm we can",
    "start": "748260",
    "end": "753959"
  },
  {
    "text": "decrement their account balance and and in that way we can them we can have a smooth-running application so these",
    "start": "753959",
    "end": "760930"
  },
  {
    "text": "nodes are really critical to our core business operations we don't have nodes",
    "start": "760930",
    "end": "765970"
  },
  {
    "text": "running we can't really in an integrate or interact with the Bloch in networks in any way we need these nodes to be",
    "start": "765970",
    "end": "773440"
  },
  {
    "text": "reliable and also as I was mentioning earlier on we take security incredibly",
    "start": "773440",
    "end": "779620"
  },
  {
    "text": "incredibly seriously and so we want to be able to frequently and rapidly redeploy these nodes into the",
    "start": "779620",
    "end": "785410"
  },
  {
    "text": "infrastructure into this ephemeral and immutable infrastructure",
    "start": "785410",
    "end": "790740"
  },
  {
    "text": "so before digging into what snap chain is and how we've sort of improved upon",
    "start": "791600",
    "end": "799230"
  },
  {
    "text": "the traditional way of deploying a blockchain node on AWS specifically I want to take a second to just talk about",
    "start": "799230",
    "end": "805860"
  },
  {
    "text": "what a basic or a sort of simple deployment of a node would look like on AWS so we'll start off we have just a",
    "start": "805860",
    "end": "814529"
  },
  {
    "text": "basic ec2 instance and we'll assume that this instance has our node binary on it",
    "start": "814529",
    "end": "820140"
  },
  {
    "text": "has you know a copy of Bitcoin T or a copy of gath repair D if you're in a theory once this once this no binary",
    "start": "820140",
    "end": "828720"
  },
  {
    "text": "comes online it'll immediately pure out to the network they'll find other nodes online that that have copies of this",
    "start": "828720",
    "end": "836279"
  },
  {
    "text": "blockchain now each node actually retains a full copy of this botching and",
    "start": "836279",
    "end": "844350"
  },
  {
    "text": "so assuming that these other nodes are up-to-date our node will start requesting new blocks from these nodes",
    "start": "844350",
    "end": "851510"
  },
  {
    "text": "so we'll we'll pull one block down from the network then we'll pull another block down from the network and",
    "start": "851870",
    "end": "858200"
  },
  {
    "text": "eventually we'll get fully in sync we'll grab all the blocks from the network and be fully in sync and at that",
    "start": "858200",
    "end": "864839"
  },
  {
    "text": "point we can use this node successfully we can broadcast transactions through it we can query it for some account",
    "start": "864839",
    "end": "871920"
  },
  {
    "text": "balances and the like I just want to take a second to say that this is it",
    "start": "871920",
    "end": "877920"
  },
  {
    "text": "quite a lot of data so this is a an image of a disk usage of one of our",
    "start": "877920",
    "end": "884430"
  },
  {
    "text": "guest nodes that I took and it's actually a couple months old now at this time we had nine hundred fifty two gigs",
    "start": "884430",
    "end": "890790"
  },
  {
    "text": "on disk and now it's like quite a lot more than that so it is quite a lot of",
    "start": "890790",
    "end": "896250"
  },
  {
    "text": "data but if you guys are DBAs or you've worked with databases before nine",
    "start": "896250",
    "end": "901860"
  },
  {
    "text": "hundred fifty two gigs is it's a lot of data but it's not a crazy amount of data we definitely like hop database",
    "start": "901860",
    "end": "907320"
  },
  {
    "text": "technology that can handle the issue here is that we have concerns",
    "start": "907320",
    "end": "913730"
  },
  {
    "text": "with network reliability so when our new node comes up we have to pull down the entire blockchain from from the network",
    "start": "913730",
    "end": "920780"
  },
  {
    "text": "these networks aren't necessarily the most reliable pulling nine hundred fifty",
    "start": "920780",
    "end": "926090"
  },
  {
    "text": "two gigs over the Internet already would take a while but because this is from a distributed peer-to-peer",
    "start": "926090",
    "end": "931670"
  },
  {
    "text": "network it can actually be pretty pretty difficult and take a long time yeah and",
    "start": "931670",
    "end": "937730"
  },
  {
    "text": "the network reliability is really an issue because you know these are open source clients that are developed over a",
    "start": "937730",
    "end": "943340"
  },
  {
    "text": "period of a pretty short period of time there's um there's like odd things like",
    "start": "943340",
    "end": "950870"
  },
  {
    "text": "economic incentives sometimes like really directly monetizable economic incentives for people to disrupt the",
    "start": "950870",
    "end": "957350"
  },
  {
    "text": "network unlike traditional I think DDoS attacks krypter krypter networks are particularly susceptible to this and",
    "start": "957350",
    "end": "963770"
  },
  {
    "text": "we've also had to contend with hyper growth in the form of crypto kitties if",
    "start": "963770",
    "end": "969110"
  },
  {
    "text": "you're familiar with crypto kitties this is in many respects the the bane of my",
    "start": "969110",
    "end": "974450"
  },
  {
    "text": "existence as good crypto kitty says has introduced just a ton more state to the",
    "start": "974450",
    "end": "979850"
  },
  {
    "text": "etherium blockchain and then other than there otherwise would be so network",
    "start": "979850",
    "end": "985040"
  },
  {
    "text": "reliability is is a real concern",
    "start": "985040",
    "end": "989259"
  },
  {
    "text": "so all of this together just says that new management is actually a pretty hard problem we have all sorts of different",
    "start": "992450",
    "end": "999860"
  },
  {
    "text": "implementations in the case of etherium we have gas and parity coinbase wants to run more than one implementation if",
    "start": "999860",
    "end": "1006459"
  },
  {
    "text": "possible there are clients that are being developed by you know teams of",
    "start": "1006459",
    "end": "1012160"
  },
  {
    "text": "developers so they're constantly being improved upon new versions are coming",
    "start": "1012160",
    "end": "1017350"
  },
  {
    "text": "out all the time sometimes vulnerabilities come out and we want to be able to redeploy away from like a",
    "start": "1017350",
    "end": "1024459"
  },
  {
    "text": "known vulnerability as quickly as possible typically there's multiple chains to support so there's typically",
    "start": "1024459",
    "end": "1031209"
  },
  {
    "text": "like a maintenance net we want to support a test net so that we can like actively develop against it and improve",
    "start": "1031209",
    "end": "1036610"
  },
  {
    "text": "our our applications from coinbase is perspective we have a number of different business units that each",
    "start": "1036610",
    "end": "1042069"
  },
  {
    "text": "support and require different configurations of these nodes and this is a ton of state being propagated",
    "start": "1042069",
    "end": "1049000"
  },
  {
    "text": "through sometimes pretty unreliable networks okay so let's recap these",
    "start": "1049000",
    "end": "1055600"
  },
  {
    "text": "constraints quickly we want frequent and rapid deploys preemies is a very",
    "start": "1055600",
    "end": "1062230"
  },
  {
    "text": "security-conscious company we want to be able to respond to any incident quickly if a vulnerability comes out in a",
    "start": "1062230",
    "end": "1069160"
  },
  {
    "text": "network we want to be able to react to that quickly and redeploy these notes but these are stateful applications and",
    "start": "1069160",
    "end": "1077200"
  },
  {
    "text": "there's quite a lot of SATA play we're also contending with this immutable and ephemeral infrastructure",
    "start": "1077200",
    "end": "1084960"
  },
  {
    "text": "so this is where snap chain comes in",
    "start": "1084960",
    "end": "1089880"
  },
  {
    "text": "at a very high level snap Chan is a tool to blue/green deploy blockchain notes",
    "start": "1090059",
    "end": "1099349"
  },
  {
    "text": "there are a couple design constraints I want to talk about when we're thinking",
    "start": "1100340",
    "end": "1105450"
  },
  {
    "text": "about snap chain the first is that we wanted to minimize the blotching",
    "start": "1105450",
    "end": "1110820"
  },
  {
    "text": "specific code and infrastructure as much as possible we didn't want to build this we didn't want to build a new solution",
    "start": "1110820",
    "end": "1117359"
  },
  {
    "text": "per chain we had to add and I said we want to build a solution that would support as many chains out the box as",
    "start": "1117359",
    "end": "1122519"
  },
  {
    "text": "possible wanted to be flexible and apply to many different chains unfortunately",
    "start": "1122519",
    "end": "1129109"
  },
  {
    "text": "we can't there's a point where we can't be as super generic there's a point where we have to get such specific we've",
    "start": "1129109",
    "end": "1136710"
  },
  {
    "text": "carved out this area node health and said no to health is something that we're gonna have to implement we're",
    "start": "1136710",
    "end": "1142739"
  },
  {
    "text": "gonna have to consider on a chain by chain basis so if you're familiar with",
    "start": "1142739",
    "end": "1149369"
  },
  {
    "text": "automating deployments in AWS you frequently implement you know a health check function on your application to",
    "start": "1149369",
    "end": "1154979"
  },
  {
    "text": "ensure that if your application can no longer talk to your DB or your cash you",
    "start": "1154979",
    "end": "1161789"
  },
  {
    "text": "can you can tear it down replace it with another instance and everything's happy in the case of snap Chang we also",
    "start": "1161789",
    "end": "1168479"
  },
  {
    "text": "implement a node health check and typically this looks like we look at the",
    "start": "1168479",
    "end": "1173729"
  },
  {
    "text": "time of the last synced block and compare that with right now and if that",
    "start": "1173729",
    "end": "1178739"
  },
  {
    "text": "grows too too far we know that we're pretty pretty out of sync with a network and we know that we wanted to we want to",
    "start": "1178739",
    "end": "1184619"
  },
  {
    "text": "actually tear down one of these nodes in continuum but different block chains",
    "start": "1184619",
    "end": "1189989"
  },
  {
    "text": "produce blocks at very different rates so in the case of Bitcoin blocks are produced on average every 10 minutes",
    "start": "1189989",
    "end": "1196219"
  },
  {
    "text": "cerium blocks reproduce on average every 15 seconds so they're like pretty different rates of block production so",
    "start": "1196219",
    "end": "1203190"
  },
  {
    "text": "we have to we have to treat this pretty differently in the case of Bitcoin or in the case of theorem or any other",
    "start": "1203190",
    "end": "1209260"
  },
  {
    "text": "also these networks might require different peers so additionally ten",
    "start": "1209260",
    "end": "1217270"
  },
  {
    "text": "minutes in the case of Bitcoin or 15 seconds in the case of aetherium it's just an expectation blocks don't",
    "start": "1217270",
    "end": "1222460"
  },
  {
    "text": "actually occur on a predictable cadence it's it's a probabilistic thing and so",
    "start": "1222460",
    "end": "1230230"
  },
  {
    "text": "there can be moments where blocks don't get produced in Bitcoin for 20-30 minutes we don't want to have to in the",
    "start": "1230230",
    "end": "1238960"
  },
  {
    "text": "event that there's like a network disruption or blocks haven't been produced for 30 minutes I don't want all",
    "start": "1238960",
    "end": "1244270"
  },
  {
    "text": "my notes to fall out of rotation and may get paged in the middle of the night and this has happened a number of times so",
    "start": "1244270",
    "end": "1251799"
  },
  {
    "text": "we actually fall back we look at the last the time of the last synced block compare it with now if it gets too far",
    "start": "1251799",
    "end": "1257919"
  },
  {
    "text": "we know we're probably out of out of sync with the network you know it's probably time to redeploy this node tear",
    "start": "1257919",
    "end": "1263530"
  },
  {
    "text": "it down but maybe not maybe the networks just having difficulty so we're gonna actually reach out to other third party",
    "start": "1263530",
    "end": "1269380"
  },
  {
    "text": "bloc explores see what their state of the network is and if it's different from ours we will know actually yeah we",
    "start": "1269380",
    "end": "1276070"
  },
  {
    "text": "are unhealthy but if they also haven't seen a block for 30 minutes it's just likely that the network is experiencing",
    "start": "1276070",
    "end": "1281799"
  },
  {
    "text": "some some difficulty and hasn't produced a block in a period of time the next",
    "start": "1281799",
    "end": "1288100"
  },
  {
    "text": "design constraint of snap chain was that we wanted to minimize the time to sync from network so we wanted to minimize",
    "start": "1288100",
    "end": "1296980"
  },
  {
    "text": "the total amount of time in the total amount of state that we actually had to pull down from the network whenever a",
    "start": "1296980",
    "end": "1302620"
  },
  {
    "text": "new node came online",
    "start": "1302620",
    "end": "1305610"
  },
  {
    "text": "so with that goal in mind we realized we needed to separate the watching data",
    "start": "1310760",
    "end": "1316250"
  },
  {
    "text": "production from the data consumption we needed a one-way to produce bakhtin data",
    "start": "1316250",
    "end": "1321950"
  },
  {
    "text": "and then in a completely separate setting and be able to consume that data",
    "start": "1321950",
    "end": "1327820"
  },
  {
    "text": "from that we sort of arrived at two configurations for snatching what we",
    "start": "1328360",
    "end": "1333890"
  },
  {
    "text": "call the snapshot configurations those are nodes that we spin up we sync the",
    "start": "1333890",
    "end": "1340640"
  },
  {
    "text": "chain we take a snapshot and are constantly producing this blockchain",
    "start": "1340640",
    "end": "1345679"
  },
  {
    "text": "state and the other hand we have long lived configurations which consume the",
    "start": "1345679",
    "end": "1351830"
  },
  {
    "text": "state produced by snapshot nodes I'm going to step through these individually",
    "start": "1351830",
    "end": "1357290"
  },
  {
    "text": "but first I'm going to dig into the snapshot configurations",
    "start": "1357290",
    "end": "1362950"
  },
  {
    "text": "so again this we're gonna start with an ec2 instance in case of snap chain we'll",
    "start": "1364320",
    "end": "1370140"
  },
  {
    "text": "always have two containers on this box the note container itself and then an API or a control container we'll assume",
    "start": "1370140",
    "end": "1379710"
  },
  {
    "text": "that we're sinking from scratch in this case so we're gonna create an EBS volume",
    "start": "1379710",
    "end": "1385290"
  },
  {
    "text": "on-the-fly we're gonna attach it to this instance we're gonna create a file system on it we're gonna mount that and",
    "start": "1385290",
    "end": "1391680"
  },
  {
    "text": "then we're just gonna turn the node on so this is looking fairly similar to the",
    "start": "1391680",
    "end": "1396960"
  },
  {
    "text": "previous watching deployment we talked about we're gonna find peers in the network and we're gonna start sinking",
    "start": "1396960",
    "end": "1403860"
  },
  {
    "text": "blocks just as before so we'll sink one will sink two will get in sync with the",
    "start": "1403860",
    "end": "1409710"
  },
  {
    "text": "rest of the chain we'll wait to see if other health checks have passed that we've defined on a chain by chain basis",
    "start": "1409710",
    "end": "1416940"
  },
  {
    "text": "and once they actually have fully passed health checks we're just gonna turn this node off",
    "start": "1416940",
    "end": "1424490"
  },
  {
    "text": "we're gonna flush everything to disk and we're just gonna take a snapshot here's",
    "start": "1424550",
    "end": "1429690"
  },
  {
    "text": "a snapshot that occurred at 1:00 p.m. next we're just gonna turn the node back",
    "start": "1429690",
    "end": "1436830"
  },
  {
    "text": "on now keep in mind that even though our node was offline the network itself",
    "start": "1436830",
    "end": "1442350"
  },
  {
    "text": "continued to run so blocks were continuing continually produced so our",
    "start": "1442350",
    "end": "1449250"
  },
  {
    "text": "our node now is probably missing a block or two and it's gonna reach out to the peers that had before and sink down the",
    "start": "1449250",
    "end": "1455070"
  },
  {
    "text": "missing blocks again once it gets healthy we're gonna stop the node flush",
    "start": "1455070",
    "end": "1461070"
  },
  {
    "text": "everything to disk and take another snapshot and we literally just repeat this process forever we start we wait",
    "start": "1461070",
    "end": "1469530"
  },
  {
    "text": "for the note to get healthy we stop the node we take a snapshot over and over and over and over",
    "start": "1469530",
    "end": "1477140"
  },
  {
    "text": "and in this way we produce consistent trusted snapshots on a regular cadence I",
    "start": "1477760",
    "end": "1485490"
  },
  {
    "text": "want to take a second here to talk about AWS tags so we're producing these",
    "start": "1486450",
    "end": "1492070"
  },
  {
    "text": "snapshots super regularly and we're supporting all sorts of different",
    "start": "1492070",
    "end": "1497290"
  },
  {
    "text": "configurations for all sorts of different business units within gourmets",
    "start": "1497290",
    "end": "1502470"
  },
  {
    "text": "the way we manage these and know which snapshot refers to which protocol is",
    "start": "1502500",
    "end": "1509860"
  },
  {
    "text": "using just AWS tags so typically we tag each snapshot with four different tags",
    "start": "1509860",
    "end": "1516010"
  },
  {
    "text": "we'll have the implementation the network diversion and the specialization so in this case this is a parody node",
    "start": "1516010",
    "end": "1524050"
  },
  {
    "text": "parody again is an implementation of the etherion blockchain running on the ROPS",
    "start": "1524050",
    "end": "1529120"
  },
  {
    "text": "10 test network it's running version 2.0 dot six of this node and it's just a",
    "start": "1529120",
    "end": "1534820"
  },
  {
    "text": "default configuration there's nothing super fancy about how we've configured this snapshot but doing this allows us",
    "start": "1534820",
    "end": "1541090"
  },
  {
    "text": "to know exactly what what is held on each snapshot and tags are super powerful if you're not using tags all",
    "start": "1541090",
    "end": "1546970"
  },
  {
    "text": "throughout your infrastructure I highly recommend you look at them okay",
    "start": "1546970",
    "end": "1552250"
  },
  {
    "text": "so we've talked about how we produce snapshots regularly and how we're producing this consistent stream of",
    "start": "1552250",
    "end": "1558700"
  },
  {
    "text": "snapshots from these chains now I want to talk about consuming these so again",
    "start": "1558700",
    "end": "1565750"
  },
  {
    "text": "we're starting out with an ec2 instance we're gonna create two containers on this box the node in the control",
    "start": "1565750",
    "end": "1571210"
  },
  {
    "text": "container this time that we we actually don't have the data in place we're gonna",
    "start": "1571210",
    "end": "1577420"
  },
  {
    "text": "want to base this chain this node barn we want to start this node off of like a known predictable point in time we don't",
    "start": "1577420",
    "end": "1583540"
  },
  {
    "text": "have the data in place yet so we're gonna look out and we're gonna see what snapshots are actually available to us",
    "start": "1583540",
    "end": "1589030"
  },
  {
    "text": "so here we have a snapshot from 1:00 p.m. that's running against chain a we",
    "start": "1589030",
    "end": "1595150"
  },
  {
    "text": "have a snapshot that was taken at 2:00 p.m. against chain a and we have a snapshot from 2 p.m. on chain B",
    "start": "1595150",
    "end": "1601420"
  },
  {
    "text": "we'll assume this is chained a said the most recent snapshot here is the one in the middle that CPM from China a so",
    "start": "1601420",
    "end": "1610240"
  },
  {
    "text": "we'll take that snapshot we'll turn it into a volume on the fly we'll mount it",
    "start": "1610240",
    "end": "1616570"
  },
  {
    "text": "on our box and only at that point only when the data is actually in place then",
    "start": "1616570",
    "end": "1621970"
  },
  {
    "text": "we turn the note on again just as before we'll find Pierce but this time we have",
    "start": "1621970",
    "end": "1628840"
  },
  {
    "text": "a full copy of the blockchain so we don't really have to sync anything from the network it's pretty much fully fully",
    "start": "1628840",
    "end": "1635530"
  },
  {
    "text": "ready to go and we can immediately start serving requests this is huge for us in",
    "start": "1635530",
    "end": "1642040"
  },
  {
    "text": "terms of speed and safety the snapshots themselves can actually take a long time",
    "start": "1642040",
    "end": "1648850"
  },
  {
    "text": "if you've used EBS before you know uvs snapshots like the actual time from when the API call returns to when the the",
    "start": "1648850",
    "end": "1655690"
  },
  {
    "text": "snapshot is ready to be turned into another volume can take a long time however restoring snapshots is really",
    "start": "1655690",
    "end": "1661240"
  },
  {
    "text": "really quick it's a very quick operation so snapshot operations actually don't",
    "start": "1661240",
    "end": "1666850"
  },
  {
    "text": "affect our live nodes we have live nodes running over here and entirely isolated",
    "start": "1666850",
    "end": "1672040"
  },
  {
    "text": "we have snapshot nodes running that the requests aren't going through and the snapshot notes actually won't affect",
    "start": "1672040",
    "end": "1678220"
  },
  {
    "text": "user data at all I want to talk a little",
    "start": "1678220",
    "end": "1683470"
  },
  {
    "text": "bit about Network load balancers or NL bees if you're not familiar network load balancers are a new type of load",
    "start": "1683470",
    "end": "1690460"
  },
  {
    "text": "balancer in AWS it's not super new I guess but it's a new ish and network",
    "start": "1690460",
    "end": "1697120"
  },
  {
    "text": "load balancers along with application load balancers replace the traditional or classic elastic load balancers and",
    "start": "1697120",
    "end": "1703419"
  },
  {
    "text": "Obie's there are layer for load balancers so they're they're basically only like TCP load balancing as I",
    "start": "1703419",
    "end": "1710500"
  },
  {
    "text": "mentioned before we're running an ephemeral infrastructure and that means that we really don't have static IP use anywhere throughout our infrastructure",
    "start": "1710500",
    "end": "1716650"
  },
  {
    "text": "and Obi's offer static IPS and that's a really really nice thing",
    "start": "1716650",
    "end": "1722370"
  },
  {
    "text": "like other load balancers in AWS they scale to me to meet our demands which is a huge thing for us it also gives us an",
    "start": "1722370",
    "end": "1730080"
  },
  {
    "text": "opportunity or a target to do these Bluegreen to plays behind so let's",
    "start": "1730080",
    "end": "1737490"
  },
  {
    "text": "assume that we have a client application that's managed and maintained by one of our coinbase engineers talking through",
    "start": "1737490",
    "end": "1744510"
  },
  {
    "text": "an NLB to one of these long-lived snapchatting notes and nobody's actually",
    "start": "1744510",
    "end": "1751200"
  },
  {
    "text": "have a interesting property called cross down load balancing most of the time I",
    "start": "1751200",
    "end": "1756540"
  },
  {
    "text": "think you'd want to run cross in load balancing on blockchain notes however are a different application I think then",
    "start": "1756540",
    "end": "1763560"
  },
  {
    "text": "you typically put behind in an opening and so we actually run caught crossing load balancing off Macross own load",
    "start": "1763560",
    "end": "1771420"
  },
  {
    "text": "balancing does is it says if a request comes in from a z1 and there's a note",
    "start": "1771420",
    "end": "1777270"
  },
  {
    "text": "actually running behind the NLB from a z3 the request can go through a z1 and into a z3 if you disable crossover load",
    "start": "1777270",
    "end": "1785340"
  },
  {
    "text": "balancing you no longer get that you get an instance of each channel beam in each",
    "start": "1785340",
    "end": "1790680"
  },
  {
    "text": "a Z and in our case we just put a single node behind each instance of this NLB so",
    "start": "1790680",
    "end": "1797820"
  },
  {
    "text": "in this way we get one static IP per one node in one AZ but we can do a Bluegreen",
    "start": "1797820",
    "end": "1803550"
  },
  {
    "text": "deploy behind all of this it's very convenient",
    "start": "1803550",
    "end": "1808940"
  },
  {
    "text": "so I mentioned previously that that blockchain nodes are likely different",
    "start": "1808940",
    "end": "1814260"
  },
  {
    "text": "from an application you typically put behind in NLP these are stateful applications and so these applications",
    "start": "1814260",
    "end": "1822210"
  },
  {
    "text": "can actually diverge for short periods of time because they're they're pulling blocks down independently from one",
    "start": "1822210",
    "end": "1827250"
  },
  {
    "text": "another so we might have one node that has you know one chain tip and another node that for a brief period of time has",
    "start": "1827250",
    "end": "1833700"
  },
  {
    "text": "a slightly different chain tip if we had both of these notes behind the same instance of the NLB they might be",
    "start": "1833700",
    "end": "1839250"
  },
  {
    "text": "returning different data from one another so in this setup we actually we get around that problem and it's uh yeah",
    "start": "1839250",
    "end": "1847909"
  },
  {
    "text": "it's a very kind of a novel way to use that homies I think so",
    "start": "1847909",
    "end": "1853309"
  },
  {
    "text": "I know buddy's also offer us a target to do Bluegreen deploys behind it's not",
    "start": "1853309",
    "end": "1859940"
  },
  {
    "text": "that different from a standard Bluegreen deploy for familiar with it but I'm gonna walk through it here anyways for those of you who aren't familiar with it",
    "start": "1859940",
    "end": "1866150"
  },
  {
    "text": "so we'll assume we have version of a node running that's running version 1.0",
    "start": "1866150",
    "end": "1872720"
  },
  {
    "text": "and maybe a security vulnerability comes out with this node or the developers",
    "start": "1872720",
    "end": "1880070"
  },
  {
    "text": "have just pushed some new features and and a new version drops we want to",
    "start": "1880070",
    "end": "1885620"
  },
  {
    "text": "redeploy this node quickly so we spin it up and we have we took a snapshot",
    "start": "1885620",
    "end": "1892789"
  },
  {
    "text": "recently but not that reason maybe it was 20 minutes ago so we still have to sync a few blocks from the network so we",
    "start": "1892789",
    "end": "1899240"
  },
  {
    "text": "wait for that block for this node to get fully in sync sync down one block sync",
    "start": "1899240",
    "end": "1906200"
  },
  {
    "text": "down another block and as soon as we've passed the health checks that are likely specific to this node we're gonna do a",
    "start": "1906200",
    "end": "1912710"
  },
  {
    "text": "cut over and now the Nov is gonna be serving traffic only to this version 1.1",
    "start": "1912710",
    "end": "1918559"
  },
  {
    "text": "own node again we're running an ephemeral infrastructure here so this node on the bottom that just dies we",
    "start": "1918559",
    "end": "1926210"
  },
  {
    "text": "just take it away and that's not concerning to us because we have these predictable snapshots we can always roll",
    "start": "1926210",
    "end": "1933890"
  },
  {
    "text": "back to a point in time if we need to so version upgrades are super slick you",
    "start": "1933890",
    "end": "1940850"
  },
  {
    "text": "might think here if this is the first time you're running a new version in version 1.1 dot zero there's not really",
    "start": "1940850",
    "end": "1946070"
  },
  {
    "text": "a snapshot for that version yet so how do you handle that this is where we've built a snapshot selection engine to",
    "start": "1946070",
    "end": "1952399"
  },
  {
    "text": "just kind of intelligently select the right snapshot based on a particular notes version so it's gonna say oh this",
    "start": "1952399",
    "end": "1958669"
  },
  {
    "text": "I don't have a snapshot for this version yet but I do have one that's close enough I'm gonna select that one and and",
    "start": "1958669",
    "end": "1964640"
  },
  {
    "text": "roll on to it also as I mentioned roll backs are very painless we're not",
    "start": "1964640",
    "end": "1970580"
  },
  {
    "text": "concerned about rolling back because we have consistent and predictable snapshots to roll back",
    "start": "1970580",
    "end": "1976580"
  },
  {
    "text": "so we've talked a lot about the automation in coin bases infrastructure broadly we've talked a lot about the",
    "start": "1976580",
    "end": "1983520"
  },
  {
    "text": "specific blockchain automation that we've developed and together these two things has made the process of deploying",
    "start": "1983520",
    "end": "1988980"
  },
  {
    "text": "these blockchain nodes globally incredibly easy this is like a pretty",
    "start": "1988980",
    "end": "1994290"
  },
  {
    "text": "seamless process to take from just us used one all the way around the world",
    "start": "1994290",
    "end": "1999889"
  },
  {
    "text": "when I talk for a second about a cool lambda function we developed to clean",
    "start": "2000340",
    "end": "2005570"
  },
  {
    "text": "everything up so we're producing all sorts of different snapshots regularly",
    "start": "2005570",
    "end": "2010820"
  },
  {
    "text": "so we're actually producing a ton of different snapshots and we at various",
    "start": "2010820",
    "end": "2016820"
  },
  {
    "text": "points took down the entire staging environment of coinbase because we exhausted our AWS account limits for EBS",
    "start": "2016820",
    "end": "2023360"
  },
  {
    "text": "snapshots so at some point we realized we needed to we needed to have a way to tear down or remove snapshots that",
    "start": "2023360",
    "end": "2029810"
  },
  {
    "text": "weren't really necessary anymore so we implemented this with a lambda function and I like it it's just kind of an",
    "start": "2029810",
    "end": "2036980"
  },
  {
    "text": "elegant solution so we just say we'll keep every snapshot we produce for three days so we can roll back to a very",
    "start": "2036980",
    "end": "2043160"
  },
  {
    "text": "granular point in time for three days and then after that we're just gonna keep one date chain protocol tuple for",
    "start": "2043160",
    "end": "2051139"
  },
  {
    "text": "50 days so after three days we have like a less granular way but we can still",
    "start": "2051140",
    "end": "2056510"
  },
  {
    "text": "roll back for 50 days and then after that we just hard to leave everything",
    "start": "2056510",
    "end": "2062080"
  },
  {
    "text": "so we've done a lot with snap chain there's a lot more we can do with snap",
    "start": "2062929",
    "end": "2068569"
  },
  {
    "text": "chain so I briefly want to talk about what's in store for the future first I would love to open source it I'd",
    "start": "2068569",
    "end": "2075799"
  },
  {
    "text": "hope to open source it prior to reinvent this year but things things happen and we didn't we didn't get around to it I",
    "start": "2075799",
    "end": "2082128"
  },
  {
    "text": "would like to open source it so other people can just use this and spin up their own notes pretty easily along with",
    "start": "2082129",
    "end": "2088429"
  },
  {
    "text": "that or in tandem with open sourcing that I'd like to create a dedicated AWS account that coinbase can actually be",
    "start": "2088429",
    "end": "2093529"
  },
  {
    "text": "sharing EBS snapshots from you're not familiar PBS has it has a functionality",
    "start": "2093529",
    "end": "2099140"
  },
  {
    "text": "where you can share EPS snapshots across different able to AWS accounts view you can also share them publicly so you can",
    "start": "2099140",
    "end": "2105799"
  },
  {
    "text": "just make a snapshot publicly available and anyone can grab it so I'd like to create a dedicated EFS account where we",
    "start": "2105799",
    "end": "2112190"
  },
  {
    "text": "can share snapshots or check points of the blockchain so that anybody then can grab that check point know that it was",
    "start": "2112190",
    "end": "2117819"
  },
  {
    "text": "produced by coinbase and is likely a reliable source and stand up their own nodes pretty easily also we need to do a",
    "start": "2117819",
    "end": "2125660"
  },
  {
    "text": "lot of abstractions on top of this node management so it's becoming fairly",
    "start": "2125660",
    "end": "2130940"
  },
  {
    "text": "cumbersome the configuration for these nodes is like actually pretty similar and so we need a kind of a better user",
    "start": "2130940",
    "end": "2137569"
  },
  {
    "text": "interface to handle the assortment and and wide array of new notes that we're going to have in the coming months and",
    "start": "2137569",
    "end": "2143720"
  },
  {
    "text": "years so again coinbase is a super security",
    "start": "2143720",
    "end": "2148880"
  },
  {
    "text": "conscious company we want a way to spin up and tear down nodes easily we've",
    "start": "2148880",
    "end": "2155539"
  },
  {
    "text": "built snap chain to solve that problem specifically and it is it is a running",
    "start": "2155539",
    "end": "2162079"
  },
  {
    "text": "in production now is pretty cool so thank you all I'm Jack Carney you can",
    "start": "2162079",
    "end": "2167990"
  },
  {
    "text": "email me at jacket coinbase comm we're gonna do a Q&A session now and then I'll just be hanging out here after for a",
    "start": "2167990",
    "end": "2173809"
  },
  {
    "text": "while if you want to come talk to me about any of this",
    "start": "2173809",
    "end": "2177250"
  },
  {
    "text": "first question is you talked about your testing protocol and the deployment pipeline yeah sure",
    "start": "2181740",
    "end": "2188070"
  },
  {
    "text": "testing protocol so testing is really hard block chains are again they're",
    "start": "2188070",
    "end": "2193080"
  },
  {
    "text": "stapled stateful applications and even the test nets are pretty beefy test nets",
    "start": "2193080",
    "end": "2198570"
  },
  {
    "text": "so we rely heavily on unit tests where we can and frankly I think we haven't",
    "start": "2198570",
    "end": "2205110"
  },
  {
    "text": "really gotten like testing protocol down pat for snap chain it's taking a lot of",
    "start": "2205110",
    "end": "2210120"
  },
  {
    "text": "manual work to get it to where it is now you can you can sync stuff locally and develop and develop against it so that's",
    "start": "2210120",
    "end": "2216390"
  },
  {
    "text": "nice our deployment pipeline is it's a custom application that we wrote some",
    "start": "2216390",
    "end": "2221730"
  },
  {
    "text": "other equipment engineers are actually given presentations on it so I encourage you to like look look up those presentations it's called code flow and",
    "start": "2221730",
    "end": "2229080"
  },
  {
    "text": "it does Bluegreen deployments of auto-scaling groups really really well so we just use that for snap Channel so",
    "start": "2229080",
    "end": "2234870"
  },
  {
    "text": "so you have 14 questions to speed it up and show that you just pick them off the top and oh yeah okay cool I'm not sure",
    "start": "2234870",
    "end": "2244650"
  },
  {
    "text": "about this one I don't know what that is",
    "start": "2244650",
    "end": "2248779"
  },
  {
    "text": "yeah okay so the top question is great can you talk about what the hardest lessons learned have been with your",
    "start": "2252810",
    "end": "2258070"
  },
  {
    "text": "immutable infrastructure approach and what you've done in your tooling to adopt so this is really hard I think I",
    "start": "2258070",
    "end": "2265240"
  },
  {
    "text": "think first and foremost we've just put a lot of time and energy into the into the tween itself into code flow",
    "start": "2265240",
    "end": "2270790"
  },
  {
    "text": "specifically one of the hardest things about running immutable infrastructure like this is nobody basically like no",
    "start": "2270790",
    "end": "2277180"
  },
  {
    "text": "engineer in the entire company can SSH on to anything or pretty much no engineer has elevated permissions in AWS",
    "start": "2277180",
    "end": "2283180"
  },
  {
    "text": "and so we've like to just do basic development in coinbase we've had to",
    "start": "2283180",
    "end": "2288880"
  },
  {
    "text": "breeze tooling that works really really well without that swelling in place we just couldn't we couldn't ship code and",
    "start": "2288880",
    "end": "2295140"
  },
  {
    "text": "so yeah we have we have like several dedicated engineers who are working on",
    "start": "2295140",
    "end": "2300760"
  },
  {
    "text": "on this toy specifically as deployment I wanted to make it as easy as possible I could probably give a whole talk on like",
    "start": "2300760",
    "end": "2307330"
  },
  {
    "text": "I am permissions and how we handle that how we sort of section that off and give different teams different different",
    "start": "2307330",
    "end": "2314140"
  },
  {
    "text": "levels of permissions basically only based on their operational needs Oh",
    "start": "2314140",
    "end": "2320730"
  },
  {
    "text": "how does Queen base handle hard Forks there's been a lot of lessons learned and there's there's a lot to this",
    "start": "2320920",
    "end": "2328570"
  },
  {
    "text": "question also typically we pretty much like if we know that a hard Forks coming we turn off sent by cells and receive we",
    "start": "2328570",
    "end": "2336040"
  },
  {
    "text": "turn off our integrations with these notes prior to hard work occurring we",
    "start": "2336040",
    "end": "2341170"
  },
  {
    "text": "take snapshots of everything and then after the hard fork has occurred and we know that both chains have stabilized then we can come back online",
    "start": "2341170",
    "end": "2349170"
  },
  {
    "text": "why use time metric for block synchronization instead of using connect",
    "start": "2349170",
    "end": "2355030"
  },
  {
    "text": "canonical no client check right away so you can use the node check like you",
    "start": "2355030",
    "end": "2362590"
  },
  {
    "text": "can you can have a node each node might implement that differently and we basically layer this on top of the",
    "start": "2362590",
    "end": "2368800"
  },
  {
    "text": "any-any health check than the node itself might offer so we can sort of have a more granular understanding of",
    "start": "2368800",
    "end": "2374770"
  },
  {
    "text": "how our notice do you mean",
    "start": "2374770",
    "end": "2377790"
  },
  {
    "text": "if you want to use blockchain with roll back in time functionality why not",
    "start": "2381910",
    "end": "2387410"
  },
  {
    "text": "using a standard DB so these blockchain nodes actually just are they have their",
    "start": "2387410",
    "end": "2393020"
  },
  {
    "text": "own database so in bitcoins case it's I think level DB under the hood but it's running alongside the like button the",
    "start": "2393020",
    "end": "2400670"
  },
  {
    "text": "note is like running against the level DB instance that's actually on disk and so we can't necessarily use like an RDS",
    "start": "2400670",
    "end": "2407270"
  },
  {
    "text": "instance or a traditional database we're just sort of like using the node and allowing the node to do as much as",
    "start": "2407270",
    "end": "2412310"
  },
  {
    "text": "possible without having to like write a ton of custom code per per node so you",
    "start": "2412310",
    "end": "2418010"
  },
  {
    "text": "want to again utilize the nodes functionality and not have to do try and minimize the amount of custom work we",
    "start": "2418010",
    "end": "2424580"
  },
  {
    "text": "have to do per chain coinbase yes we have open sourced other tooling the",
    "start": "2424580",
    "end": "2430850"
  },
  {
    "text": "infrastructure team has shipped this product called geo engineer which is a ruby wrapper around terraform that we",
    "start": "2430850",
    "end": "2437180"
  },
  {
    "text": "use to codify our entire infrastructure there have been talks that my co-workers",
    "start": "2437180",
    "end": "2442190"
  },
  {
    "text": "have given onto you engineer specifically it's a great tool it lets us do a lot of interesting stuff that",
    "start": "2442190",
    "end": "2447860"
  },
  {
    "text": "that terraform out of the gate doesn't do and one really nice thing about",
    "start": "2447860",
    "end": "2453590"
  },
  {
    "text": "Geoengineer is that it's a it's ruby base and point base is mostly a ruby shop so pretty much all of our engineers",
    "start": "2453590",
    "end": "2459350"
  },
  {
    "text": "know ruby and can actually contribute to geo engineer and the applications that sit on top of geoengineering for your",
    "start": "2459350",
    "end": "2468620"
  },
  {
    "text": "ec2 you use custom a.m. eyes with pre-installed binaries and dependencies so we do use custom a.m. eyes we ship a",
    "start": "2468620",
    "end": "2475640"
  },
  {
    "text": "baseline custom AMI we call it minion and it's it's sort of",
    "start": "2475640",
    "end": "2481520"
  },
  {
    "text": "based off core OS but it's a little different everything is docker icing in",
    "start": "2481520",
    "end": "2487490"
  },
  {
    "text": "coinbase we're not actually baking the node binaries into the ami itself rather the node comes online the API so the ami",
    "start": "2487490",
    "end": "2495650"
  },
  {
    "text": "spins up an instance and then it pulls down whatever containers it needs before actually starting out sort of talking about this",
    "start": "2495650",
    "end": "2505440"
  },
  {
    "text": "one already transactions synchronization across from notes that's that's also a",
    "start": "2505440",
    "end": "2513290"
  },
  {
    "text": "difficult problem currently we have like custom applications kind of that handle and can handle reorg when they occur on",
    "start": "2513290",
    "end": "2520200"
  },
  {
    "text": "the nodes but this is a problem I think that is currently being being worked on",
    "start": "2520200",
    "end": "2526530"
  },
  {
    "text": "in a more blockchain agnostic fashion and so I hope next year reinvent or at",
    "start": "2526530",
    "end": "2531570"
  },
  {
    "text": "another conference will be able to present something specifically on this if you replace your infrastructure every",
    "start": "2531570",
    "end": "2538290"
  },
  {
    "text": "thirty days how do you ensure your new infrastructure is at the highest blocked on startup so that's where the the",
    "start": "2538290",
    "end": "2543810"
  },
  {
    "text": "snapshots actually come in is we can tear down the old nodes we have a snapshot that is recent the snapshot the",
    "start": "2543810",
    "end": "2551430"
  },
  {
    "text": "new node comes up and based off that snapshot we sink down any blocks that might be missing and as soon as we have",
    "start": "2551430",
    "end": "2557400"
  },
  {
    "text": "we start passing health checks then we put it into rotation behind the load balancer do you have something that does",
    "start": "2557400",
    "end": "2565020"
  },
  {
    "text": "wallet synchronization for Bitcoin d-- variants for tracking transaction and",
    "start": "2565020",
    "end": "2570240"
  },
  {
    "text": "unspent and listening that's unspent transaction outputs yes we do we have a",
    "start": "2570240",
    "end": "2576420"
  },
  {
    "text": "custom application right now that sort of like handles this and tracks you TXS across addresses that we care about in",
    "start": "2576420",
    "end": "2582570"
  },
  {
    "text": "the case of Bitcoin that is when blocks become out of sync because they receive",
    "start": "2582570",
    "end": "2588390"
  },
  {
    "text": "different information at once how do you get them back in sync eg block one has data AVC block two has",
    "start": "2588390",
    "end": "2594660"
  },
  {
    "text": "data abd so this is harder this is this is this event would be that two nodes",
    "start": "2594660",
    "end": "2601050"
  },
  {
    "text": "just have different data and and they might at some point we know that they're gonna correct themselves when they",
    "start": "2601050",
    "end": "2607980"
  },
  {
    "text": "correct themselves that's what we call real workers or form 1 nodes perspective a reorg",
    "start": "2607980",
    "end": "2613200"
  },
  {
    "text": "so new node says oh actually another block was introduced and now that is the longest chain that is the chain with the",
    "start": "2613200",
    "end": "2619140"
  },
  {
    "text": "most work I'm gonna I'm gonna consider that the longest chain so actually under the hood the nodes kind of just handled",
    "start": "2619140",
    "end": "2624780"
  },
  {
    "text": "out for us how do you keep server-side while it's secure very good question a lot of ways we we",
    "start": "2624780",
    "end": "2635310"
  },
  {
    "text": "should probably I think give like a full talk into into this topic specifically I'm not going to go into too much detail",
    "start": "2635310",
    "end": "2640590"
  },
  {
    "text": "on this now actually how do you handle version upgrade in your snapshot process",
    "start": "2640590",
    "end": "2647130"
  },
  {
    "text": "binary download directly PPA pre-configured containers yeah so we are",
    "start": "2647130",
    "end": "2653540"
  },
  {
    "text": "code deployment solution we can essentially click any single commit we",
    "start": "2653540",
    "end": "2658920"
  },
  {
    "text": "want to build the container required for that commit and then deploy that so when",
    "start": "2658920",
    "end": "2664170"
  },
  {
    "text": "we build that container that's pushed to a central container repository and then when we want to when when the new ASG",
    "start": "2664170",
    "end": "2670860"
  },
  {
    "text": "comes online it's gonna pull down the most recent container and start that up what is the lifetime of any given",
    "start": "2670860",
    "end": "2678360"
  },
  {
    "text": "snapshots so maximum length of time right now is 50 days a lot of snapshots",
    "start": "2678360",
    "end": "2685770"
  },
  {
    "text": "are actually torn down after about three days though how do you make sure",
    "start": "2685770",
    "end": "2691970"
  },
  {
    "text": "transactions that you care about are the same across all Bitcoin nodes mempool for UT exo's I'm not sure I understand",
    "start": "2691970",
    "end": "2701400"
  },
  {
    "text": "what that questions getting that we we can essentially just we if so there's",
    "start": "2701400",
    "end": "2709320"
  },
  {
    "text": "somebody sending funds in the coinbase we don't necessarily credit their balance right away typically what you do",
    "start": "2709320",
    "end": "2714750"
  },
  {
    "text": "is you wait for some number of confirmations so you wait for some number of blocks to come in on top of the block that the transaction somebody",
    "start": "2714750",
    "end": "2721080"
  },
  {
    "text": "sent in was included in and at that point we have pretty much probabilistic guarantee that the chain won't actually",
    "start": "2721080",
    "end": "2728820"
  },
  {
    "text": "reorg around and undo the transaction that sent into coinbase and so that way we have like a guarantee that we can",
    "start": "2728820",
    "end": "2735150"
  },
  {
    "text": "credit their account balance how does this snapshot selection engine",
    "start": "2735150",
    "end": "2741260"
  },
  {
    "text": "cope with hard fork do you manly indicate to the engine about those concerns yeah so we have like",
    "start": "2741260",
    "end": "2746840"
  },
  {
    "text": "functionality in the engine where we can manually configure it to target a specific snapshot if we know something",
    "start": "2746840",
    "end": "2751880"
  },
  {
    "text": "like a hard fork is happening it's like a fairly flexible interface that we can use alright thank you guys well",
    "start": "2751880",
    "end": "2760790"
  },
  {
    "text": "[Applause]",
    "start": "2760790",
    "end": "2763719"
  }
]