[
  {
    "text": "hello everybody before you'll dive in we wanted to learn a little bit more about you the people so who of you is running",
    "start": "0",
    "end": "7980"
  },
  {
    "text": "CCS in production it's not so bad",
    "start": "7980",
    "end": "13759"
  },
  {
    "text": "anybody running is yes not in production yet significantly less and since we have",
    "start": "13759",
    "end": "22380"
  },
  {
    "text": "so many I don't ask who's running his stuff in docker containers so instead let's dive in so my name is rod Mueller",
    "start": "22380",
    "end": "30449"
  },
  {
    "text": "I am on an architect on foreigner and I'm here with my co-presenter I'm Michele Jelena and I'm a dab of team",
    "start": "30449",
    "end": "37350"
  },
  {
    "text": "lead in the game online operations team at Ubisoft Montreal",
    "start": "37350",
    "end": "42410"
  },
  {
    "text": "special thanks to our theme to our team's mantra Ubisoft is the leading",
    "start": "42410",
    "end": "49050"
  },
  {
    "text": "entertainment and video game company and Montreal is the industry's largest video game studio home to brands like",
    "start": "49050",
    "end": "55800"
  },
  {
    "text": "Assassin's Creed Far Cry rainbow 6 and of course for honor runner was a big",
    "start": "55800",
    "end": "64170"
  },
  {
    "text": "milestone for Ubisoft the first closed alpha for us and the biggest open beta for Ubisoft with over six million",
    "start": "64170",
    "end": "69720"
  },
  {
    "text": "players joining it's a third percent combat game which lets you experience visceral the visceral thrill of melee",
    "start": "69720",
    "end": "78180"
  },
  {
    "text": "combat we're gonna watch a quick video to give you a feel of what this game is all about",
    "start": "78180",
    "end": "83570"
  },
  {
    "text": "[Music] tribute is a 4v4 multi-player objective",
    "start": "94380",
    "end": "99450"
  },
  {
    "text": "game-mode as a tribute match begins teams will race to grab the three",
    "start": "99450",
    "end": "104610"
  },
  {
    "text": "offerings that are dispersed across the battlefield players will need to do whatever it takes to make their way back",
    "start": "104610",
    "end": "110790"
  },
  {
    "text": "hastily to one of their teams three shrines with an offering in hand each shrine bestows a unique blessing on the",
    "start": "110790",
    "end": "117509"
  },
  {
    "text": "whole team that is activated once an offering has been successfully claimed offense",
    "start": "117509",
    "end": "124500"
  },
  {
    "text": "and awareness therefore players may strategically choose which blessing to activate by",
    "start": "124500",
    "end": "129770"
  },
  {
    "text": "placing an offering at the designated shrine as the battle Pizza players will fight opponents to",
    "start": "129770",
    "end": "137820"
  },
  {
    "text": "steal or keep the offering everything can change in an instant making vigilance and speed and",
    "start": "137820",
    "end": "143510"
  },
  {
    "text": "communication your greatest skills when your team successfully claims all",
    "start": "143510",
    "end": "149099"
  },
  {
    "text": "three offerings down we'll begin and he will fight to defend your eyes if you can outlast",
    "start": "149099",
    "end": "155470"
  },
  {
    "text": "victory is yours",
    "start": "155470",
    "end": "159160"
  },
  {
    "text": "well thankfully we have less framerate problems in the game than in that video so today's talk is all about the journey",
    "start": "162980",
    "end": "171930"
  },
  {
    "text": "or honor we will quickly touch on how we define trailblazing and what's really",
    "start": "171930",
    "end": "178860"
  },
  {
    "text": "blazing is and why we think you should try it out we will touch on the core beliefs of foreigner and how it had us",
    "start": "178860",
    "end": "185300"
  },
  {
    "text": "make that game happen we will talk about when it makes sense to beautify for",
    "start": "185300",
    "end": "190590"
  },
  {
    "text": "infrastructure and then it really doesn't and we will go a little bit more into the deep end when we talk about",
    "start": "190590",
    "end": "197850"
  },
  {
    "text": "bridges and tunnels all those moments where you have to do something a little bit more involved",
    "start": "197850",
    "end": "203720"
  },
  {
    "text": "so first the idea of trailblazing it is in the beginning you know where you",
    "start": "203720",
    "end": "209100"
  },
  {
    "text": "start and you have a rough idea of where you will end up it might change but you normally know and the idea is to get",
    "start": "209100",
    "end": "215760"
  },
  {
    "text": "there as fast as possible for us we had that mantra of fail fast",
    "start": "215760",
    "end": "221400"
  },
  {
    "text": "but succeed consistently so it means every time you do something it should get you closer to your goal once in a",
    "start": "221400",
    "end": "229410"
  },
  {
    "text": "while stepping forward is good once in a while you hit a roadblock in that moment you",
    "start": "229410",
    "end": "236640"
  },
  {
    "text": "have to fail fast reconsider step back try something else sometimes what you try is a little bit",
    "start": "236640",
    "end": "243780"
  },
  {
    "text": "more on the shaky side but it gets you forward so and in the end when you reach",
    "start": "243780",
    "end": "250530"
  },
  {
    "text": "your goal this is the moment where you look back and make like that trail into",
    "start": "250530",
    "end": "255720"
  },
  {
    "text": "a highway because you know that you can reach actually your goal so for us the",
    "start": "255720",
    "end": "263850"
  },
  {
    "text": "other core beliefs we had we already touched on real fast and succeed consistently our other main goal was the",
    "start": "263850",
    "end": "271200"
  },
  {
    "text": "ease of development that was the same for every other game team but we used it",
    "start": "271200",
    "end": "276419"
  },
  {
    "text": "for our online infrastructure as well because you're developers are your first",
    "start": "276419",
    "end": "281820"
  },
  {
    "text": "customers so if it is painful for your developers to develop missus tag it will",
    "start": "281820",
    "end": "287010"
  },
  {
    "text": "be hard to operate and in the end your customers will also not really enjoy it",
    "start": "287010",
    "end": "292130"
  },
  {
    "text": "another Gophers was automation that means you automate everything you do frequently",
    "start": "292130",
    "end": "299210"
  },
  {
    "text": "don't necessarily automate things you do once and for sure don't automate",
    "start": "299210",
    "end": "305490"
  },
  {
    "text": "experiments unless you have the tooling and tape in place for sure another main pillar of ours was the use",
    "start": "305490",
    "end": "312600"
  },
  {
    "text": "of managed infrastructure for us that means not only that we use manage",
    "start": "312600",
    "end": "317730"
  },
  {
    "text": "databases from AWS we use easiest it also means that everything we run",
    "start": "317730",
    "end": "324120"
  },
  {
    "text": "follows the idea of if it's not working correctly don't get an admin involved",
    "start": "324120",
    "end": "329630"
  },
  {
    "text": "terminate the instance we spin and bring it back up because that process is always faster",
    "start": "329630",
    "end": "336060"
  },
  {
    "text": "than any time you can use to ping somebody to take a look so for us when",
    "start": "336060",
    "end": "343950"
  },
  {
    "text": "we started that process our starting point of the beginning was that our team",
    "start": "343950",
    "end": "349650"
  },
  {
    "text": "had limited cloud experience but on the other hand we still wanted to try",
    "start": "349650",
    "end": "355440"
  },
  {
    "text": "something to go into the cloud and benefit from all those elasticity and",
    "start": "355440",
    "end": "360900"
  },
  {
    "text": "speed and all the other nice things to give you a little bit of an idea of a",
    "start": "360900",
    "end": "367050"
  },
  {
    "text": "timeline for us we were at that point in early 2014 to give him a bit more of a",
    "start": "367050",
    "end": "373830"
  },
  {
    "text": "timeline as ECS was announced in November of the same year humanities in July 2015 so we were a little bit ahead",
    "start": "373830",
    "end": "380430"
  },
  {
    "text": "of the curve and it was a prototype so also because we were at that time a",
    "start": "380430",
    "end": "386550"
  },
  {
    "text": "small proof-of-concept project in new IP we knew that we had only limited support",
    "start": "386550",
    "end": "392280"
  },
  {
    "text": "from other Ubisoft teams and we were somewhat in direct competition to already established in-house technology",
    "start": "392280",
    "end": "400380"
  },
  {
    "text": "on top of that we were a really small team at that time for online we were",
    "start": "400380",
    "end": "406710"
  },
  {
    "text": "kind of three people and we were planning to build a stack and services",
    "start": "406710",
    "end": "412880"
  },
  {
    "text": "so you can tell it was an ambitious goal so before we get a little bit deeper I",
    "start": "412880",
    "end": "419130"
  },
  {
    "text": "get hand over to Lou Michelle again to show where we ended up",
    "start": "419130",
    "end": "425330"
  },
  {
    "text": "so this is a block diagram of what our production infrastructure looks like I'm",
    "start": "426149",
    "end": "431199"
  },
  {
    "text": "going to walk you through a few of the interactions so first off it always starts in the game clients be it",
    "start": "431199",
    "end": "436509"
  },
  {
    "text": "consoles or or pcs and obviously they talk to sub services and be on premise",
    "start": "436509",
    "end": "442869"
  },
  {
    "text": "data center and also to some stuff in Amazon so it usually hits the application load balancer which will",
    "start": "442869",
    "end": "450159"
  },
  {
    "text": "forward a request to a front-end ECS cluster eventually to the back-end ECS cluster where it will most probably hit",
    "start": "450159",
    "end": "457749"
  },
  {
    "text": "the elastic cache database and provide the answer back we see also that the backend services of some direct",
    "start": "457749",
    "end": "465399"
  },
  {
    "text": "connections to the on premise data center they exchange a bits of data through there and there are a bunch of",
    "start": "465399",
    "end": "470889"
  },
  {
    "text": "other service supports things services I'm not going to go through all of them but I'm gonna mention two out front so",
    "start": "470889",
    "end": "477999"
  },
  {
    "text": "there's a some world state and we'll get back to that later that says served out",
    "start": "477999",
    "end": "484089"
  },
  {
    "text": "of s3 but we actually put cloud front in front for scaling reasons and also cos we can control the SSL certificate when",
    "start": "484089",
    "end": "491589"
  },
  {
    "text": "using out front in production everything goes through the public Internet and",
    "start": "491589",
    "end": "496749"
  },
  {
    "text": "we'll get back to that a bit later so this is what we ended up with but at",
    "start": "496749",
    "end": "502929"
  },
  {
    "text": "first we had to get in shape so as we said earlier fail fast so we had a",
    "start": "502929",
    "end": "510719"
  },
  {
    "text": "complete stack built we use the play framework at first which is a high level",
    "start": "510719",
    "end": "517059"
  },
  {
    "text": "web framework we use the elastic beanstalk which is a highly managed Amazon service and the Couchbase has a",
    "start": "517059",
    "end": "523689"
  },
  {
    "text": "data layer provisioning was hmm using a shell script now it's obvious",
    "start": "523689",
    "end": "529449"
  },
  {
    "text": "just looking at this that this will not do you don't need to there's no interesting code in there it's just a",
    "start": "529449",
    "end": "534699"
  },
  {
    "text": "big mess so once we add this we",
    "start": "534699",
    "end": "540790"
  },
  {
    "text": "revisited our pillars to see how we did so the play framework was not a good fit",
    "start": "540790",
    "end": "546129"
  },
  {
    "text": "to do services it's really geared towards web services and it didn't work well with what we needed",
    "start": "546129",
    "end": "551920"
  },
  {
    "text": "elastic bead start also did not work well with the needs of the framework we were using and Couchbase well there was",
    "start": "551920",
    "end": "559149"
  },
  {
    "text": "no manage offer for it in production and running it on the devs machine the dev machines",
    "start": "559149",
    "end": "564330"
  },
  {
    "text": "was not easy so that was not a good fit for us but we did fail fast and succeed",
    "start": "564330",
    "end": "569490"
  },
  {
    "text": "consistent consistently we were using manager infrastructure and we did have some automation and I'll hand it at back",
    "start": "569490",
    "end": "578610"
  },
  {
    "text": "to Roth so our prototype for us was",
    "start": "578610",
    "end": "583709"
  },
  {
    "text": "enough to get a key ago from the production team and the group to go",
    "start": "583709",
    "end": "588750"
  },
  {
    "text": "ahead at least and try to go into the cloud at that time it was one and a half",
    "start": "588750",
    "end": "594450"
  },
  {
    "text": "years before lunch about one year before we went into our open alpha closed alpha",
    "start": "594450",
    "end": "601700"
  },
  {
    "text": "so far as it was a little bit about risk management so we didn't want to move",
    "start": "601700",
    "end": "607649"
  },
  {
    "text": "every service on to that new stack we so we did choose at that time two non mission-critical ones there was",
    "start": "607649",
    "end": "614810"
  },
  {
    "text": "something we called player information enrichment or short PI which is a service which takes data coming from the",
    "start": "614810",
    "end": "621779"
  },
  {
    "text": "player augments it with other information we have about that player and sends it off for further processing",
    "start": "621779",
    "end": "626940"
  },
  {
    "text": "and the other feature was our faction war there is also the screenshot of how",
    "start": "626940",
    "end": "634170"
  },
  {
    "text": "it looks in game it is for honor is all about the clash between our three",
    "start": "634170",
    "end": "640260"
  },
  {
    "text": "factions of samurai Vikings and the Knights and they fight in a world and we",
    "start": "640260",
    "end": "645899"
  },
  {
    "text": "model the world so it is this each game a player plays at the end they get",
    "start": "645899",
    "end": "652290"
  },
  {
    "text": "warriors they can deploy those bearers on a territory and in regular intervals",
    "start": "652290",
    "end": "657660"
  },
  {
    "text": "we do a check which faction deployed most of those varies on a territory and",
    "start": "657660",
    "end": "663779"
  },
  {
    "text": "then this territory will be owned by that faction so it's basically risk for",
    "start": "663779",
    "end": "669839"
  },
  {
    "text": "those people to play board games our other goals was that we wanted to",
    "start": "669839",
    "end": "677190"
  },
  {
    "text": "minimize resources for development that meant for us also that we couldn't block",
    "start": "677190",
    "end": "683089"
  },
  {
    "text": "development to wait for us to have all the tech up so everything we do had to",
    "start": "683089",
    "end": "688620"
  },
  {
    "text": "be able to run locally the complete stack there's all interactions between them we spend some time to make it possible",
    "start": "688620",
    "end": "698009"
  },
  {
    "text": "to share resources so you have to think about name spacing your databases so you can cram hundred environments onto one",
    "start": "698009",
    "end": "705120"
  },
  {
    "text": "machine on the other of things for us which was important that our output for",
    "start": "705120",
    "end": "711420"
  },
  {
    "text": "our build pipelines where our docker images that means for us also the only difference you have between you ad and",
    "start": "711420",
    "end": "718050"
  },
  {
    "text": "prod is scale and configuration the code itself is always the same so to give us",
    "start": "718050",
    "end": "725819"
  },
  {
    "text": "a little bit and here so we had multiple user acceptance testing environments I think at our highest point we reached",
    "start": "725819",
    "end": "732630"
  },
  {
    "text": "something about like hundred and fifty of those so there you can see it is important that you can cram those things",
    "start": "732630",
    "end": "739050"
  },
  {
    "text": "together or else you will use a lot of infrastructure before you are already live so for us it was the start this is",
    "start": "739050",
    "end": "750300"
  },
  {
    "text": "very really started our trailblazing so the goal was to reach a stage which was",
    "start": "750300",
    "end": "755670"
  },
  {
    "text": "shippable as fast as possible so I don't know if other game companies",
    "start": "755670",
    "end": "760740"
  },
  {
    "text": "use the same term for those things a vertical slice but it is what year to",
    "start": "760740",
    "end": "766260"
  },
  {
    "text": "achieve was of end to end working service which represents our final",
    "start": "766260",
    "end": "772190"
  },
  {
    "text": "infrastructure so far as we started by provisioning what I call the macro",
    "start": "772190",
    "end": "777899"
  },
  {
    "text": "infrastructure so VP sees EC as clusters security groups our ElastiCache",
    "start": "777899",
    "end": "784380"
  },
  {
    "text": "instances elastic search for logging those were defined as cloud formation",
    "start": "784380",
    "end": "790560"
  },
  {
    "text": "templates we had in source control but they were applied manually so somebody",
    "start": "790560",
    "end": "795990"
  },
  {
    "text": "took that file from source control uploaded it on to visit web and then",
    "start": "795990",
    "end": "801949"
  },
  {
    "text": "infrastructure was created not super sexy but the fastest you can do in those",
    "start": "801949",
    "end": "807420"
  },
  {
    "text": "moments so we spend a little bit more time on those components which change",
    "start": "807420",
    "end": "813240"
  },
  {
    "text": "frequently so easiest tasks and services services even manage files using Python",
    "start": "813240",
    "end": "819240"
  },
  {
    "text": "scripts which at that point were emulating humans running AWS he like eye",
    "start": "819240",
    "end": "825360"
  },
  {
    "text": "commands but it was step of automation because nobody had to go and type those things so to see as a",
    "start": "825360",
    "end": "833040"
  },
  {
    "text": "first step you revisit our pillars are be better than in our prototype we were",
    "start": "833040",
    "end": "840270"
  },
  {
    "text": "going forward so fear fossils are good development was easy because everybody",
    "start": "840270",
    "end": "846000"
  },
  {
    "text": "could run everything they needed locally and we could also deploy it for people which didn't have to work on the service",
    "start": "846000",
    "end": "852870"
  },
  {
    "text": "so that they can test the game our infrastructure was completely managed we",
    "start": "852870",
    "end": "859650"
  },
  {
    "text": "didn't have any kind of server we had to manually keep alive databases where all",
    "start": "859650",
    "end": "865440"
  },
  {
    "text": "Amazon offerings ECS is also completely managed so the good there our problems at that moment",
    "start": "865440",
    "end": "873690"
  },
  {
    "text": "was that our micro infrastructure was manually set up which generates in",
    "start": "873690",
    "end": "880380"
  },
  {
    "text": "general like a certain amount of fear driven opposition to change anything because nobody can be sure that there",
    "start": "880380",
    "end": "887850"
  },
  {
    "text": "was no manual step involved so that what you had in source control diverged from what is really there and if somebody",
    "start": "887850",
    "end": "896280"
  },
  {
    "text": "method a manual change it was completely untracked so there are automation still",
    "start": "896280",
    "end": "901980"
  },
  {
    "text": "a little bit shaky we had our easiest Assam service",
    "start": "901980",
    "end": "907980"
  },
  {
    "text": "management and patent scripts worked pretty well as long as everything is good the problem you run into like the",
    "start": "907980",
    "end": "916320"
  },
  {
    "text": "moment you run into a problem you leave the golden path your role-playing steps",
    "start": "916320",
    "end": "922830"
  },
  {
    "text": "are less tested so you don't know if you can actually recover from a failure deployment so we know that we had to",
    "start": "922830",
    "end": "928500"
  },
  {
    "text": "also work on this one but there's",
    "start": "928500",
    "end": "934350"
  },
  {
    "text": "actually the place where we managed to ship this mostly so we spent a little",
    "start": "934350",
    "end": "940860"
  },
  {
    "text": "bit more time on formal tech which works to a stack which is operated because",
    "start": "940860",
    "end": "946710"
  },
  {
    "text": "there's a certain amount of difference so far as it means we spend a good six",
    "start": "946710",
    "end": "952350"
  },
  {
    "text": "months of time on getting monitoring and alerting in for us our stack was JVM",
    "start": "952350",
    "end": "959760"
  },
  {
    "text": "based so if you want to operate a JVM stack it's really important to have GMX",
    "start": "959760",
    "end": "967970"
  },
  {
    "text": "metrics per container so let you know what is my garbage collection doing am i",
    "start": "967970",
    "end": "974160"
  },
  {
    "text": "running out of memory so for this data dog was a perfect choice because of the",
    "start": "974160",
    "end": "979770"
  },
  {
    "text": "business model because we had a lot of title [ __ ] containers on Hardware also",
    "start": "979770",
    "end": "986930"
  },
  {
    "text": "graphing is very elegant in data dogs there's a little bit of a screen shot",
    "start": "986930",
    "end": "991950"
  },
  {
    "text": "you can't read it but nice graphs alerting also works very well for us you",
    "start": "991950",
    "end": "999330"
  },
  {
    "text": "are able to connect our normal monitoring and alerting from our use of",
    "start": "999330",
    "end": "1006740"
  },
  {
    "text": "group this data dog so that means that we didn't have to manage a second stack",
    "start": "1006740",
    "end": "1011930"
  },
  {
    "text": "of people-watching infrastructure it could be all be done by our service",
    "start": "1011930",
    "end": "1017870"
  },
  {
    "text": "center and naturally load tests to see",
    "start": "1017870",
    "end": "1024069"
  },
  {
    "text": "the services we are writing what kind of hardware do we need how does behave under load step which always takes",
    "start": "1024069",
    "end": "1031430"
  },
  {
    "text": "longer than anybody expects and last but not least defining key KPIs to see",
    "start": "1031430",
    "end": "1038569"
  },
  {
    "text": "what's going on in your infrastructure for us we relatively soon notice that there's kind of two kinds of PP is some",
    "start": "1038569",
    "end": "1046850"
  },
  {
    "text": "I always say like they are a little bit too late so for example a container death rate already means you have a",
    "start": "1046850",
    "end": "1054170"
  },
  {
    "text": "problem the same thing for error rates on a lbs but at least you know something is wrong and they are knowing easier to",
    "start": "1054170",
    "end": "1061100"
  },
  {
    "text": "get other things for us as an early warning system is application metrics",
    "start": "1061100",
    "end": "1066670"
  },
  {
    "text": "but it takes more time to write them and surprisingly actually lock rates the",
    "start": "1066670",
    "end": "1073910"
  },
  {
    "text": "moment your system starts to go a little bit out of whack it has a tendency to spew a lot more logs so you can use this",
    "start": "1073910",
    "end": "1080630"
  },
  {
    "text": "as an early warning and try to intervene before it all blows up so like I said",
    "start": "1080630",
    "end": "1087260"
  },
  {
    "text": "it's pretty much what we shippers so I will hand over to a little Michelle again so at this point we had our",
    "start": "1087260",
    "end": "1094710"
  },
  {
    "text": "trail now it was time to move on to make it a highway so we could make it happen",
    "start": "1094710",
    "end": "1099899"
  },
  {
    "text": "and we're gonna go through a few of the courts and we call them bridges and tunnels so a few of the quirks we did",
    "start": "1099899",
    "end": "1105929"
  },
  {
    "text": "this is a bit more technical part of the presentation so first off is CS boot 101",
    "start": "1105929",
    "end": "1113130"
  },
  {
    "text": "so any CS instance it lives in a V PC and you have auto-scaling groups that",
    "start": "1113130",
    "end": "1120330"
  },
  {
    "text": "define how many instances you want in there and in in your a auto-scaling",
    "start": "1120330",
    "end": "1125490"
  },
  {
    "text": "groups you have instances and within those you actually configure and run the",
    "start": "1125490",
    "end": "1130649"
  },
  {
    "text": "PCs agent and then they join the cluster and they can start doing some work now",
    "start": "1130649",
    "end": "1136279"
  },
  {
    "text": "if anything so when they boot they we",
    "start": "1136279",
    "end": "1142529"
  },
  {
    "text": "first we start off by we take vanilla ICS optimize the ami is from Amazon and",
    "start": "1142529",
    "end": "1148470"
  },
  {
    "text": "we install a few tools namely AWS CLI and JQ we get some instance details in",
    "start": "1148470",
    "end": "1154110"
  },
  {
    "text": "the metadata and register the instance in opsworks and configure and start the ECS agent now if any thing of the above",
    "start": "1154110",
    "end": "1161909"
  },
  {
    "text": "fails you end up with a bad instance so we have loops of retries and and",
    "start": "1161909",
    "end": "1168419"
  },
  {
    "text": "timeouts and after five minutes they ought to terminate the hope here is that the auto scaling group will notice",
    "start": "1168419",
    "end": "1174480"
  },
  {
    "text": "that the instance is gone and will spin up a new one that will work what would fail was the actual Rihanna install step",
    "start": "1174480",
    "end": "1181020"
  },
  {
    "text": "so it would kick in too early and the network wasn't ready this this didn't",
    "start": "1181020",
    "end": "1187080"
  },
  {
    "text": "doesn't happen much anymore but still it can happen from time to time so what we do is we actually scan clusters",
    "start": "1187080",
    "end": "1193230"
  },
  {
    "text": "periodically we look at the auto scaling group how many instances it wants to have and how many are in The Associated",
    "start": "1193230",
    "end": "1199860"
  },
  {
    "text": "DCs cluster if the count doesn't match it means one instance just didn't join a",
    "start": "1199860",
    "end": "1205590"
  },
  {
    "text": "cluster and you need to intervene because it the auto scaling group will not provision a new one",
    "start": "1205590",
    "end": "1211140"
  },
  {
    "text": "so if yeah you can run out of instances that way it doesn't happen much and this",
    "start": "1211140",
    "end": "1217260"
  },
  {
    "text": "is a manual intervention thing next up is we said earlier Ralph said we want",
    "start": "1217260",
    "end": "1223889"
  },
  {
    "text": "production to we want everything to be mostly like production unfortunately sometimes",
    "start": "1223889",
    "end": "1229020"
  },
  {
    "text": "doesn't make sense in uit we had hundreds of VCs services in hundreds of",
    "start": "1229020",
    "end": "1234750"
  },
  {
    "text": "have environments and so it's not the same as on prod",
    "start": "1234750",
    "end": "1241350"
  },
  {
    "text": "on a few static environments in production we use a lbs at the front end",
    "start": "1241350",
    "end": "1248520"
  },
  {
    "text": "but because we're in a V P and V PC and UAT we have a limited IP count and al B's",
    "start": "1248520",
    "end": "1256050"
  },
  {
    "text": "tend to be IP angry so we invented H a proxy route 53 little trick that we're",
    "start": "1256050",
    "end": "1262380"
  },
  {
    "text": "gonna look in more details in the next slide or two so these only support a single node serving requests and they do",
    "start": "1262380",
    "end": "1269550"
  },
  {
    "text": "and that they do it does involve a bit of deployment latency before everything converges so I think 600 al B's just",
    "start": "1269550",
    "end": "1280680"
  },
  {
    "text": "could not happen so the H a proxy container running on every instance and that's what UPS works does for us it",
    "start": "1280680",
    "end": "1287070"
  },
  {
    "text": "actually provisions the service containers stuff we want on every instance so it scans the instance for",
    "start": "1287070",
    "end": "1293100"
  },
  {
    "text": "running services and with anything new that appears it will update their route 53 entry to direct traffic to itself and",
    "start": "1293100",
    "end": "1300120"
  },
  {
    "text": "update the local H a proxy config so that the H a proxy will route the traffic to the proper container it looks",
    "start": "1300120",
    "end": "1307470"
  },
  {
    "text": "like this nothing really interesting here it does the SSL offloading and you",
    "start": "1307470",
    "end": "1313380"
  },
  {
    "text": "see there's one section per running container you can see it routes it to",
    "start": "1313380",
    "end": "1318750"
  },
  {
    "text": "the container IP using classical host header routing and Ralph is gonna",
    "start": "1318750",
    "end": "1327390"
  },
  {
    "text": "explain how we fetch our instances yeah false means the slides has security",
    "start": "1327390",
    "end": "1334230"
  },
  {
    "text": "updates but there's a multitude of reasons why you want to take one of your ec2 instances out of rotation and",
    "start": "1334230",
    "end": "1341070"
  },
  {
    "text": "replace it with something new for example you want to change the ami you want to use in the newer version of CICS",
    "start": "1341070",
    "end": "1348270"
  },
  {
    "text": "agent security patches different instance sizes so all that fun you want",
    "start": "1348270",
    "end": "1354090"
  },
  {
    "text": "to do and you want to do this without impacting your users at the same time so we started to look what",
    "start": "1354090",
    "end": "1362500"
  },
  {
    "text": "we do and this is a little bit the moment when you realize that ECS doesn't have all those parts out of",
    "start": "1362500",
    "end": "1369820"
  },
  {
    "text": "the box so for us we filled that hole there's a selection of lambdas so the",
    "start": "1369820",
    "end": "1376090"
  },
  {
    "text": "idea is when CloudFormation triggers an update on now the skinning cluster what",
    "start": "1376090",
    "end": "1382120"
  },
  {
    "text": "happens is a new instance spins up and all our instances have lifecycle hooks",
    "start": "1382120",
    "end": "1387940"
  },
  {
    "text": "on them and we also notify there's an S net as an S message that an instance is",
    "start": "1387940",
    "end": "1394150"
  },
  {
    "text": "now set to terminate so when an instance is set to termination it fires off this",
    "start": "1394150",
    "end": "1399400"
  },
  {
    "text": "message we have an we invoke a lambda function which after gathering some",
    "start": "1399400",
    "end": "1404710"
  },
  {
    "text": "information about the instance which is going to terminate sets ECS in the ECS",
    "start": "1404710",
    "end": "1411490"
  },
  {
    "text": "instance which is bound to that easy to machine to draining draining is a state",
    "start": "1411490",
    "end": "1419140"
  },
  {
    "text": "you see as has sadly there is no drained states or you can start the process of",
    "start": "1419140",
    "end": "1425140"
  },
  {
    "text": "training and training means there will not be any more containers scheduled on",
    "start": "1425140",
    "end": "1430480"
  },
  {
    "text": "that machine and existing containers are scheduled to move to other places if you",
    "start": "1430480",
    "end": "1436150"
  },
  {
    "text": "have the room which hopefully you do because there's a new instance here so I",
    "start": "1436150",
    "end": "1441370"
  },
  {
    "text": "mentioned there is no drain States so far as the only way we have to do is perros the pole that instance to see all",
    "start": "1441370",
    "end": "1449050"
  },
  {
    "text": "the containers gone so the land re invokes itself checks the instance",
    "start": "1449050",
    "end": "1454500"
  },
  {
    "text": "checks instance again and when all the containers are gone we complete the lifecycle hook which then lets that",
    "start": "1454500",
    "end": "1461380"
  },
  {
    "text": "instance die and the process starts with the next instance so pretty much that",
    "start": "1461380",
    "end": "1469270"
  },
  {
    "text": "repeats until you are done a few things we figured out it's really that in",
    "start": "1469270",
    "end": "1475780"
  },
  {
    "text": "general when there's a hole in like an",
    "start": "1475780",
    "end": "1480880"
  },
  {
    "text": "offering for AWS quite frequently you can fill it with a lambda it's also important that you tag your instance",
    "start": "1480880",
    "end": "1488170"
  },
  {
    "text": "with some meaningful tags because it can help you figure out what the instance is",
    "start": "1488170",
    "end": "1494260"
  },
  {
    "text": "which currently is draining another very important thing we found out was that it makes sense to slip your",
    "start": "1494260",
    "end": "1501250"
  },
  {
    "text": "lambda before we invoke in yourself you will pay for the time it's just sitting",
    "start": "1501250",
    "end": "1506620"
  },
  {
    "text": "around doing nothing but it's significantly better than going into a tight loop and getting strutted it",
    "start": "1506620",
    "end": "1514810"
  },
  {
    "text": "actually happened to us at one point and we had a great idea from at the same time change the mi move to a bigger",
    "start": "1514810",
    "end": "1522460"
  },
  {
    "text": "instance and remove half of our instances and CloudFormation went ahead and as a first step terminated half of",
    "start": "1522460",
    "end": "1529690"
  },
  {
    "text": "our instances and then couldn't reschedule all the containers so our normal draining process didn't last 20",
    "start": "1529690",
    "end": "1536710"
  },
  {
    "text": "minutes but was doing things for four hours because the API got throttled in between and everything worked once in a",
    "start": "1536710",
    "end": "1543580"
  },
  {
    "text": "while also that complete process for us it came from a blog post I posted the",
    "start": "1543580",
    "end": "1549970"
  },
  {
    "text": "link on there so if somebody wants to take a look on this one it's where our lambda came from I think this one",
    "start": "1549970",
    "end": "1556930"
  },
  {
    "text": "doesn't sleep so keep that in mind when you reprogram that and another thing we",
    "start": "1556930",
    "end": "1563560"
  },
  {
    "text": "found out is that it's quite frequently if you have to do a lot of calls to gather information in your lambda try",
    "start": "1563560",
    "end": "1571510"
  },
  {
    "text": "considering collecting them once put them into your Ethernet as an S message",
    "start": "1571510",
    "end": "1577390"
  },
  {
    "text": "for the next invocation so you save on making calls the next time so I will",
    "start": "1577390",
    "end": "1585460"
  },
  {
    "text": "give the clicker back so we mentioned CloudFormation stacks at the beginning",
    "start": "1585460",
    "end": "1592330"
  },
  {
    "text": "so that those were all manually uploaded and parameterised and that was scary",
    "start": "1592330",
    "end": "1599050"
  },
  {
    "text": "because we didn't really know what was going on at any given time so we improved on this part by using get let's",
    "start": "1599050",
    "end": "1605230"
  },
  {
    "text": "see I judge so we actually have these strips that detect the changes and we'll push them out - aw - CloudFormation so",
    "start": "1605230",
    "end": "1612880"
  },
  {
    "text": "we now can use familiar software development concepts like Tiff's and",
    "start": "1612880",
    "end": "1618100"
  },
  {
    "text": "mergers to make sure what the changes are and they're not templates they're actually complete CloudFormation stacks",
    "start": "1618100",
    "end": "1625560"
  },
  {
    "text": "so now what you what this means however is",
    "start": "1625560",
    "end": "1633409"
  },
  {
    "text": "that you need to state your changes because you never know what what CloudFormation will do to your infrastructure so you want to be able to",
    "start": "1633409",
    "end": "1640279"
  },
  {
    "text": "practice these changes in some non-critical environment as close as possible to your production one or two",
    "start": "1640279",
    "end": "1645799"
  },
  {
    "text": "target environment and so you know how it behaves and when you actually merge that zip in the production stack you're",
    "start": "1645799",
    "end": "1651860"
  },
  {
    "text": "pretty confident well completely confident it will do the right thing the",
    "start": "1651860",
    "end": "1659899"
  },
  {
    "text": "same the same principle also applies to the actual what was tighten code",
    "start": "1659899",
    "end": "1668470"
  },
  {
    "text": "manipulating ECS tasks and services so the same here however the Python code",
    "start": "1668470",
    "end": "1673789"
  },
  {
    "text": "actually generates the stack from configs held in another system and",
    "start": "1673789",
    "end": "1679120"
  },
  {
    "text": "generates the new desired State and push it pushes that to CloudFormation and you",
    "start": "1679120",
    "end": "1685399"
  },
  {
    "text": "get nice features like free roll backs and a bunch of other cool things that cloud formation will check for you so I",
    "start": "1685399",
    "end": "1696590"
  },
  {
    "text": "mentioned a bit earlier the the difference between you eighty and prod",
    "start": "1696590",
    "end": "1701980"
  },
  {
    "text": "on you eighty the unpromising points are not on the public Internet so you just",
    "start": "1701980",
    "end": "1707330"
  },
  {
    "text": "can't just get to them so we use the there are two ways to get around that with a one we used was the VPN so we're",
    "start": "1707330",
    "end": "1714919"
  },
  {
    "text": "actually an extension of the ubisoft IP range so we can reach our unfriend",
    "start": "1714919",
    "end": "1720350"
  },
  {
    "text": "endpoints some of the downsides is that the VPNs can flap and they need to be",
    "start": "1720350",
    "end": "1725899"
  },
  {
    "text": "monitored and also you don't want to push some high traffic through those because you never know what can happen",
    "start": "1725899",
    "end": "1732250"
  },
  {
    "text": "also we had to do a few special tricks to the host instances and containers to",
    "start": "1732250",
    "end": "1737779"
  },
  {
    "text": "make them look up DNS entries to the unpromising NS servers because these are",
    "start": "1737779",
    "end": "1743330"
  },
  {
    "text": "hosted in private domains but everything goes through the VPC and this works for us the alternative to this setup is to",
    "start": "1743330",
    "end": "1750649"
  },
  {
    "text": "use proxies so you just put a standard web proxy and redirect your containers",
    "start": "1750649",
    "end": "1756649"
  },
  {
    "text": "to those you do need to wait you do need to attach elastic ip's to those proxies and white",
    "start": "1756649",
    "end": "1763710"
  },
  {
    "text": "wisdom in the corporate firewall this is known to worked in work in other projects so that's a setup that can work",
    "start": "1763710",
    "end": "1770039"
  },
  {
    "text": "for production we don't have this problem because we're just using the",
    "start": "1770039",
    "end": "1775289"
  },
  {
    "text": "public endpoints on the intranet just to complete this this is the similar block",
    "start": "1775289",
    "end": "1781830"
  },
  {
    "text": "diagram as the one we saw it first you note this game clients this time are actually in the on-premise well they're",
    "start": "1781830",
    "end": "1787590"
  },
  {
    "text": "not in the data center but they're like inside and traffic goes through the VPN",
    "start": "1787590",
    "end": "1793409"
  },
  {
    "text": "tunnel to DHI proxy route 53 set up and the rest is mostly the same Wendy tell one interesting detail is we",
    "start": "1793409",
    "end": "1801059"
  },
  {
    "text": "run like 100 or 150 environments on one ElastiCache server in UAT",
    "start": "1801059",
    "end": "1806460"
  },
  {
    "text": "whereas in prod we have five or six so",
    "start": "1806460",
    "end": "1812359"
  },
  {
    "text": "once we did all these bridges and tunnels we look back and then we were",
    "start": "1812359",
    "end": "1817499"
  },
  {
    "text": "happy we felt fast we succeeded consistently we had our developers that were happy they could run the whole",
    "start": "1817499",
    "end": "1823590"
  },
  {
    "text": "stack and our testers could have each of every and every one of them could have their separate environment that's how we",
    "start": "1823590",
    "end": "1828989"
  },
  {
    "text": "ended up with a hundred fifty different UAT environments we use managed infrastructure for stuff we didn't want",
    "start": "1828989",
    "end": "1834840"
  },
  {
    "text": "to take care about like the last cash in elasticsearch and we pretty much nailed the automation part so now we have our",
    "start": "1834840",
    "end": "1841139"
  },
  {
    "text": "nice highway lessons learned everything",
    "start": "1841139",
    "end": "1848399"
  },
  {
    "text": "manual is a risk just know about that and there then again there's a",
    "start": "1848399",
    "end": "1854070"
  },
  {
    "text": "break-even point of automation and it changes over time as you saw we shipped with something somewhat fragile and",
    "start": "1854070",
    "end": "1861029"
  },
  {
    "text": "somewhat manual still that was the right choice at the time because we had to",
    "start": "1861029",
    "end": "1866580"
  },
  {
    "text": "ship you need to validate all the changes in non-critical but identical",
    "start": "1866580",
    "end": "1871769"
  },
  {
    "text": "setups CloudFormation can have a mind of its own you never know what it's gonna do it can be scary to do these things",
    "start": "1871769",
    "end": "1878009"
  },
  {
    "text": "but if you can practice and somewhat identical setup to your target",
    "start": "1878009",
    "end": "1883979"
  },
  {
    "text": "environment then you're good when we modify some UAT environment we actually spin up a new one and mess around and",
    "start": "1883979",
    "end": "1889649"
  },
  {
    "text": "try to change because we know all you wait these are pretty similar and we actually have a staging one for",
    "start": "1889649",
    "end": "1896070"
  },
  {
    "text": "production which has all the bells and whistles and al B's and whatnot serviced containers are hard to manage we used up",
    "start": "1896070",
    "end": "1902760"
  },
  {
    "text": "source for that I know there are solutions now in ECS but still it can be somewhat troublesome to make sure you",
    "start": "1902760",
    "end": "1909390"
  },
  {
    "text": "have exactly one of those H a peroxy containers running on each and every instance another good lesson learned is",
    "start": "1909390",
    "end": "1918410"
  },
  {
    "text": "sometimes they were surprising gaps in the AWS offering but lambdas can duct tape a lot of stuff together and it",
    "start": "1918410",
    "end": "1924990"
  },
  {
    "text": "generally really works well we didn't cover it very very much in detail but we",
    "start": "1924990",
    "end": "1930000"
  },
  {
    "text": "actually have a similar setup to what we had for cloud formations where we manage lambdas in ncie missy icd manor with",
    "start": "1930000",
    "end": "1939270"
  },
  {
    "text": "scripts because you otherwise you end up with a bunch of lambdas with the hooks and configs and you don't know which",
    "start": "1939270",
    "end": "1945150"
  },
  {
    "text": "ones pertain to what and it can get messy so again cloud formation is your friend",
    "start": "1945150",
    "end": "1951180"
  },
  {
    "text": "tooling CI CD principles will help you and of course use managed services you",
    "start": "1951180",
    "end": "1957480"
  },
  {
    "text": "don't want to deal with elasticsearch or elastic cache or all those other things so leverage what AWS has to give you",
    "start": "1957480",
    "end": "1966380"
  },
  {
    "text": "hopefully you guys have a few questions",
    "start": "1966560",
    "end": "1970790"
  }
]