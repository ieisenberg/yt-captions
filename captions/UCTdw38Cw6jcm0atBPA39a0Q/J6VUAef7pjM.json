[
  {
    "text": "all right looks like we can start uh hello everyone my name is Sophia today I'm going to talk to you about GitHub",
    "start": "11759",
    "end": "17720"
  },
  {
    "text": "actions a cloudy day for security uh now whether or not it's actually a cloudy day is Up For Debate I just wanted a",
    "start": "17720",
    "end": "24000"
  },
  {
    "text": "title mentioning GitHub actions and the cloud and a pun so here we are all right",
    "start": "24000",
    "end": "29519"
  },
  {
    "text": "uh if you want to follow along the slides can be downloaded at this link I'm not trying to hack you or isue I",
    "start": "29519",
    "end": "34600"
  },
  {
    "text": "mean do this at your own risk um I work at a company called binary security where I work as a",
    "start": "34600",
    "end": "40600"
  },
  {
    "text": "pentester which I've been doing for a couple of years um so what I'm going to talk to you about today this is a very",
    "start": "40600",
    "end": "46680"
  },
  {
    "text": "detailed outline um there's going to be two halves in the talk uh for the first",
    "start": "46680",
    "end": "51719"
  },
  {
    "text": "half I'll be focusing purely on GitHub cicd security so that's by that I mean GitHub",
    "start": "51719",
    "end": "56840"
  },
  {
    "text": "actions um and often in this type of talk one hears about what can you do when there's like a public repository",
    "start": "56840",
    "end": "64000"
  },
  {
    "text": "what can I do as a random person on the internet uh for this talk we'll actually mostly focus on the case where you have",
    "start": "64000",
    "end": "69840"
  },
  {
    "text": "let's say a private repository and I am someone with right permissions to that repository so collaborator that's called",
    "start": "69840",
    "end": "76000"
  },
  {
    "text": "in GitHub um so this is kind of emulating the case of you have a big or organization and one of your developer",
    "start": "76000",
    "end": "82600"
  },
  {
    "text": "accounts let's say is compromised what can we do then or you are a big organization and you automatically give",
    "start": "82600",
    "end": "87880"
  },
  {
    "text": "all your employees right access to all your GitHub repositories you compromise some random account what can we do then",
    "start": "87880",
    "end": "94159"
  },
  {
    "text": "for the second half we'll move it up into the cloud uh we'll talk about Federated identities for workload",
    "start": "94159",
    "end": "100479"
  },
  {
    "text": "identities or identity Federation or whatever it's called in the different Cloud providers uh and really that's",
    "start": "100479",
    "end": "105680"
  },
  {
    "text": "just oidc um if you don't know what that is we'll talk about later uh so I'll",
    "start": "105680",
    "end": "110799"
  },
  {
    "text": "mention the three like major Cloud providers and how stuff is done uh Azure gcp and AWS as a little disclaimer I",
    "start": "110799",
    "end": "117840"
  },
  {
    "text": "should say that like 95% % of our customers when I do pen tests use Azure so that's by far the one I know the best",
    "start": "117840",
    "end": "124840"
  },
  {
    "text": "we do a little bit of the others too uh I'll try to cover them but if I say something completely ridiculous that's",
    "start": "124840",
    "end": "130119"
  },
  {
    "text": "that's on me okay um as we go along I'll be giving examples of vulnerabilities we",
    "start": "130119",
    "end": "135959"
  },
  {
    "text": "find in customer assessments um and you'll notice pretty quickly that all of these vulnerabilities are from the same",
    "start": "135959",
    "end": "142840"
  },
  {
    "text": "class of vulnerabilities which is misconfigurations okay so perhaps",
    "start": "142840",
    "end": "147879"
  },
  {
    "text": "unsurprising you start with GitHub action a massively complicated system with a bunch of config you have some",
    "start": "147879",
    "end": "153760"
  },
  {
    "text": "cloud provider probably even more complicated with even more config you try to integrate the two of them there's",
    "start": "153760",
    "end": "158959"
  },
  {
    "text": "like 200 million things you can do wrong and we end up with misconfigurations which are security",
    "start": "158959",
    "end": "165159"
  },
  {
    "text": "vulnerabilities okay let's start with saying what GitHub actions are so this blob is taken from the",
    "start": "165159",
    "end": "170519"
  },
  {
    "text": "documentation uh really what GitHub actions is is like the automation bit in GitHub that's how I think of it so if",
    "start": "170519",
    "end": "176959"
  },
  {
    "text": "you want to automate like running tests deploying uh and building that type of stuff um",
    "start": "176959",
    "end": "184159"
  },
  {
    "text": "GitHub actions runs through something called a workload that's like the key entity going on in a GitHub action uh",
    "start": "184159",
    "end": "191239"
  },
  {
    "text": "and a workload is really just a yaml file which you check out to your repository uh so this is an example of",
    "start": "191239",
    "end": "197159"
  },
  {
    "text": "such a workload going to see how the text is I don't know if you guys can read I guess you can come closer if you",
    "start": "197159",
    "end": "202239"
  },
  {
    "text": "can't read um so this is an example of just doing some kind of python stuff in",
    "start": "202239",
    "end": "207480"
  },
  {
    "text": "my repository this is junk I've written it so it's probably not even right um You can see here on line number one we",
    "start": "207480",
    "end": "213840"
  },
  {
    "text": "have a name on lines number three and four we have this special on keyword uh",
    "start": "213840",
    "end": "218959"
  },
  {
    "text": "and that defines when is this workflow going to run so throughout the talk you'll see stuff like whenever someone",
    "start": "218959",
    "end": "225280"
  },
  {
    "text": "pushes to a specific Branch I want my workflow to trigger whenever someone opens a poll request to a specific",
    "start": "225280",
    "end": "230920"
  },
  {
    "text": "Branch I want my workflow to trigger or here we have this magic workflow dispatch keyword which means give just",
    "start": "230920",
    "end": "236799"
  },
  {
    "text": "give me a button so I can run the workflow on demand which is easy for testing uh and then starting from like",
    "start": "236799",
    "end": "242959"
  },
  {
    "text": "line eight onwards you have the actual steps what is this workflow going to do and this is in many ways just like code",
    "start": "242959",
    "end": "249120"
  },
  {
    "text": "execution this is a script just like doing stuff for you except we are a bit fancier than just writing all the code",
    "start": "249120",
    "end": "254439"
  },
  {
    "text": "ourself we can call out to like predefined actions uh stuff which other people have set up for me um yeah so for",
    "start": "254439",
    "end": "261759"
  },
  {
    "text": "example here I call out to someone else's action to set up like Python and check out the code repository etc etc uh",
    "start": "261759",
    "end": "268160"
  },
  {
    "text": "doesn't matter if you don't understand what any of of the actual python stuff is doing that's completely unrelevant uh",
    "start": "268160",
    "end": "273560"
  },
  {
    "text": "then you have like a view in your repository you can go to an actions tab you get a list of the actions which have been running uh you get a green or red",
    "start": "273560",
    "end": "281080"
  },
  {
    "text": "mark depending on if they succeeded uh you can see like what different workflows are defined you can click the",
    "start": "281080",
    "end": "287600"
  },
  {
    "text": "Run workflow button to run one which has this workflow dispatch thingy uh you can click into a workflow which has run and",
    "start": "287600",
    "end": "293840"
  },
  {
    "text": "see the logs here's the example of uh me running python uh type check on a",
    "start": "293840",
    "end": "300600"
  },
  {
    "text": "repository which has a hello world file in Python I did it no issues um so that's what GitHub actions",
    "start": "300600",
    "end": "306960"
  },
  {
    "text": "are you'll see more examples of these as we go so hopefully that will uh you'll get used to that we need to talk a",
    "start": "306960",
    "end": "313520"
  },
  {
    "text": "little bit about the GitHub security model because otherwise we can't do security um so at a kind of like uh",
    "start": "313520",
    "end": "321280"
  },
  {
    "text": "overarching level there's three permissions in a repository I'm going to care about this is not true there's a",
    "start": "321280",
    "end": "327039"
  },
  {
    "text": "bunch more roles you can assign and you can do more fine grain off as well but the kind of the ones one sees",
    "start": "327039",
    "end": "332199"
  },
  {
    "text": "realistically is someone with read permissions to repository someone with write permissions which is referred to",
    "start": "332199",
    "end": "337440"
  },
  {
    "text": "as a collaborator and someone who is either the owner of a repository or has been given administrator role on the",
    "start": "337440",
    "end": "343639"
  },
  {
    "text": "repository uh then there are some things you can and can't do as these different roles um this entirely chaotic slide is",
    "start": "343639",
    "end": "351199"
  },
  {
    "text": "attempting to have things you may do on one side and may not do on another side uh so as a reader there are some things",
    "start": "351199",
    "end": "357000"
  },
  {
    "text": "you can do you can read code it's kind of in the name you you're also allowed to do stuff like submit issues uh so",
    "start": "357000",
    "end": "362880"
  },
  {
    "text": "imagine a case where you have someone who's like in touch with customers and they report a bug you want to go in and",
    "start": "362880",
    "end": "368280"
  },
  {
    "text": "like report an issue for the bug into the repository even though I'm not going to write the code to fix it um as a",
    "start": "368280",
    "end": "374199"
  },
  {
    "text": "reader I'm not supposed to do anything which a right person can do so I shouldn't be allowed to commit code create branches a bunch of other stuff",
    "start": "374199",
    "end": "381960"
  },
  {
    "text": "uh if you are a collaborator so a person who can write you obviously have to be able to commit code that's kind of your",
    "start": "381960",
    "end": "387360"
  },
  {
    "text": "job at this point uh create branches and also and this is kind of key throughout the talk you have to be able",
    "start": "387360",
    "end": "393039"
  },
  {
    "text": "to modify these workflows uh so I said initially that the workflows are just yaml files checked out to the repository",
    "start": "393039",
    "end": "400080"
  },
  {
    "text": "in question uh so since I can modify the code in the repository I can also modify these files and that makes sense that",
    "start": "400080",
    "end": "406160"
  },
  {
    "text": "you have to be able to do as a developer in order to be able to do anything because like if I'm changing some test",
    "start": "406160",
    "end": "411440"
  },
  {
    "text": "setup or something I have to update the corresponding workflow to run the appropriate tests right however even",
    "start": "411440",
    "end": "418440"
  },
  {
    "text": "though I can write code and there are several things I'm not allowed to do as a collaborator um so one thing is that at",
    "start": "418440",
    "end": "425919"
  },
  {
    "text": "least I feel that if uh a single developer should not be able to deploy code directly to production without any",
    "start": "425919",
    "end": "432479"
  },
  {
    "text": "other approvals uh so that's protecting against the case again where you have a single compromised developer account",
    "start": "432479",
    "end": "438879"
  },
  {
    "text": "that should that should be some kind of like defense in depth here so you can't just go straight right push my malicious code to production run it let's go I've",
    "start": "438879",
    "end": "445360"
  },
  {
    "text": "taken over everything right uh in addition there's no reason why you're developers should be able to view",
    "start": "445360",
    "end": "450919"
  },
  {
    "text": "production level secrets uh so someone obviously will have to have set up your secrets but you don't want to share them",
    "start": "450919",
    "end": "456639"
  },
  {
    "text": "with everyone uh that's kind of part of this whole like modern cicd flow is that you don't want to have a bunch of",
    "start": "456639",
    "end": "462879"
  },
  {
    "text": "hard-coded secret you pass around and I copy paste your like password to SSH to some server and manually copy like we",
    "start": "462879",
    "end": "469280"
  },
  {
    "text": "aren't doing this it's supposed to be automated and as a regular developer I should never need to see the production secret stuff uh on a similar note let's",
    "start": "469280",
    "end": "477319"
  },
  {
    "text": "say we are integrating with a cloud environment um just because I have right permissions",
    "start": "477319",
    "end": "482520"
  },
  {
    "text": "on a repository I should obviously not suddenly get lots of permissions in your cloud provider like that's that's a",
    "start": "482520",
    "end": "487759"
  },
  {
    "text": "ridiculous thing to happen but that does in fact happen as we'll see uh then we have the admins they can do everything",
    "start": "487759",
    "end": "494360"
  },
  {
    "text": "uh if someone compromis an admin account you're screwed uh we won't talk more about them okay I did say I'd Focus",
    "start": "494360",
    "end": "501080"
  },
  {
    "text": "mainly on collaborators but I'll speak first about one vulnerability class which is also relevant for people with",
    "start": "501080",
    "end": "506280"
  },
  {
    "text": "read permissions uh and that is script injection uh so as a person with read permissions",
    "start": "506280",
    "end": "513279"
  },
  {
    "text": "I can't modify code and therefore I can't modify workflows uh so it's not like I can just go and change the code",
    "start": "513279",
    "end": "518599"
  },
  {
    "text": "which is running however sometimes user controllable values make their way into the workflow anyway and I can somehow",
    "start": "518599",
    "end": "525120"
  },
  {
    "text": "inject some malicious code uh so there's actually a warning about this on the GitHub documentation that's what this",
    "start": "525120",
    "end": "531000"
  },
  {
    "text": "blob is taken from and it's related to something called the GitHub workflow",
    "start": "531000",
    "end": "536560"
  },
  {
    "text": "contexts so these context thing is what they are is really just this funny uh dollar C bracket C bracket syntax which",
    "start": "536560",
    "end": "543600"
  },
  {
    "text": "you can see on this slide so that's like dollar thingy thingy and then inside that there some magic uh thing which",
    "start": "543600",
    "end": "550079"
  },
  {
    "text": "GitHub is going to go and replace with a real value when I execute the workflow so in this case we have GitHub do actor",
    "start": "550079",
    "end": "556680"
  },
  {
    "text": "that's just going to be the username of the person who initiated the Run of this workflow or triggered the workflow to",
    "start": "556680",
    "end": "562480"
  },
  {
    "text": "run so in this case it was me uh and then it you see it prints that that sopia IML is testing instead of dollar",
    "start": "562480",
    "end": "568440"
  },
  {
    "text": "thingy thingy is testing uh okay so that's fairly straightforwards let's do a little demo",
    "start": "568440",
    "end": "574640"
  },
  {
    "text": "to wake up uh let's see if I manage this exciting",
    "start": "574640",
    "end": "580480"
  },
  {
    "text": "times all right now we probably can't see the text very well so I'll Zoom a",
    "start": "580480",
    "end": "585720"
  },
  {
    "text": "bit uh let's see if I manage this we have a workflow defined here o uh which",
    "start": "585720",
    "end": "592240"
  },
  {
    "text": "is basically the same as I had on my first example slide uh but now we've made it so it triggers when you run a",
    "start": "592240",
    "end": "598000"
  },
  {
    "text": "poll request and then here at the top I've been a a clever developer and said",
    "start": "598000",
    "end": "604440"
  },
  {
    "text": "oh when you read these logs it would be really handy if you can like print the title of the pull request so I know what's going on here so I've added",
    "start": "604440",
    "end": "610120"
  },
  {
    "text": "online 10 here running python stuff on pull request with title and then I use one of these GitHub context thing is to",
    "start": "610120",
    "end": "616000"
  },
  {
    "text": "get the pull request title okay uh let's um watch me slowly mousing over",
    "start": "616000",
    "end": "622880"
  },
  {
    "text": "things we'll Zoom let's see uh so here's an example of a run you just see that has been replaced by some real value",
    "start": "622880",
    "end": "629519"
  },
  {
    "text": "um also I'm doing this as a person with read permissions so I was not allowed to edit the uh code directly but what I can",
    "start": "629519",
    "end": "636959"
  },
  {
    "text": "do is I can go and make a pull request which is What's Happening Here uh we'll pause there so I'm making a pull request",
    "start": "636959",
    "end": "644200"
  },
  {
    "text": "as a reader so this is perhaps surprising to some people even though I can't make any code or make any branches",
    "start": "644200",
    "end": "649760"
  },
  {
    "text": "if someone else has made some code and a branch for me I can make the pool request and I'm now in control of the title uh so here I've just inserted a",
    "start": "649760",
    "end": "656959"
  },
  {
    "text": "payload which is like reaching out to my server just it's not doing anything special it's just doing a CO command uh",
    "start": "656959",
    "end": "663279"
  },
  {
    "text": "so let's zoom out and let that keep playing uh I create the pool request this should now trigger the run of the",
    "start": "663279",
    "end": "669839"
  },
  {
    "text": "action so this takes a few moments there we go this is also what GitHub actions",
    "start": "669839",
    "end": "675079"
  },
  {
    "text": "look like in action um we have to wait a bit it starts doing stuff and we can see",
    "start": "675079",
    "end": "680839"
  },
  {
    "text": "something which looks like a CO command running uh up there at the top and the thing finishes we go to my",
    "start": "680839",
    "end": "688079"
  },
  {
    "text": "server uh we see we've got a request and let me pause that and see if I can show you",
    "start": "688079",
    "end": "694200"
  },
  {
    "text": "again so the request which I received on my server was exactly the one I defined in the GitHub uh P request",
    "start": "694200",
    "end": "702200"
  },
  {
    "text": "title okay uh I think that was the end of that one so back to the",
    "start": "702200",
    "end": "709200"
  },
  {
    "text": "slides uh what actually happened here uh so here's another example of script",
    "start": "709200",
    "end": "715399"
  },
  {
    "text": "injection in this workflow uh I've set it to trigger whenever some someone creates an issue um now let's say I want",
    "start": "715399",
    "end": "722920"
  },
  {
    "text": "to make a workflow which automates like whenever a new issue is submitted I want to tag it based on some keyword search",
    "start": "722920",
    "end": "728240"
  },
  {
    "text": "or something again I'm being a helpful developer so I'm going to print the title of the issue initially so that you guys know what's going on when you read",
    "start": "728240",
    "end": "733880"
  },
  {
    "text": "the logs uh I'm using the GitHub context again a reader can submit an issue they",
    "start": "733880",
    "end": "739839"
  },
  {
    "text": "can use dollar ID as the title let's say uh and what happens when this runs is",
    "start": "739839",
    "end": "744880"
  },
  {
    "text": "that again you uh instead of getting new issue dollar brackets ID printed you get",
    "start": "744880",
    "end": "750480"
  },
  {
    "text": "the output of the ID command in Linux the reason why this is happening is that GitHub performs the replacement of the",
    "start": "750480",
    "end": "757680"
  },
  {
    "text": "context thingy before you ever get to running any code so when we've gotten to bash the code you can see is actually",
    "start": "757680",
    "end": "763680"
  },
  {
    "text": "this extra line are written underneath uh and that's exactly what has executed uh so no amount of quoting and",
    "start": "763680",
    "end": "770199"
  },
  {
    "text": "things inside your bash script are going to protect you against this because the replacement is happening at the earlier",
    "start": "770199",
    "end": "776160"
  },
  {
    "text": "stage right so if you put lots of quotes and stuff I can just Escape them again uh within my injected",
    "start": "776160",
    "end": "781880"
  },
  {
    "text": "coat uh luckily for us that is a fix for this otherwise GitHub actions would be awfully vulnerable uh and that is to use",
    "start": "781880",
    "end": "788560"
  },
  {
    "text": "this EnV keyword in your step so you can see on lines N9 and 10 here I'm setting up the environment for the command which",
    "start": "788560",
    "end": "795279"
  },
  {
    "text": "is being run in this step here I'm defining a environment variable named title which has this value and then you",
    "start": "795279",
    "end": "802320"
  },
  {
    "text": "can see the bash code online 12 here in this case is safe right even if you have lots of uh funky stuff inside the dollar",
    "start": "802320",
    "end": "808959"
  },
  {
    "text": "typ title environment variable the way bash works this isn't going to give you any sort of injection you can still mess",
    "start": "808959",
    "end": "814120"
  },
  {
    "text": "up your bash of course but assuming you have proper bash this isn't going to be vulnerable we try the same attack again",
    "start": "814120",
    "end": "820199"
  },
  {
    "text": "and this time it prints what we expect okay so I made this uh wonderful graphic",
    "start": "820199",
    "end": "825440"
  },
  {
    "text": "I searched for warning and I put that symbol uh so this is telling you if you want to use GitHub contexts you should",
    "start": "825440",
    "end": "832759"
  },
  {
    "text": "be using the N key okay we can go on a lengthy debate here about like yeah but not all of these Contex thing is our",
    "start": "832759",
    "end": "838720"
  },
  {
    "text": "user controllable right like maybe you have the I don't know the hash of your commit that's not you can't inject into",
    "start": "838720",
    "end": "843759"
  },
  {
    "text": "that and it's like that's true but also it's just much easier to just always use en and then you're never vulnerable uh",
    "start": "843759",
    "end": "849600"
  },
  {
    "text": "so I recommend doing that all right from now on WE the hackers are going to be",
    "start": "849600",
    "end": "855600"
  },
  {
    "text": "collaborators so we have right access to everything from now on uh we are first going to ask ourself",
    "start": "855600",
    "end": "861519"
  },
  {
    "text": "a really dumb question here which is let's say our repository is set up in",
    "start": "861519",
    "end": "866560"
  },
  {
    "text": "such a way that we are going to deploy code from the main branch to production main is like the source of truth I'm a",
    "start": "866560",
    "end": "872360"
  },
  {
    "text": "collaborator I have right permissions can I not just push any code I want to the main branch and then I've own production like isn't this whole",
    "start": "872360",
    "end": "879320"
  },
  {
    "text": "exercise a bit pointless with WR permissions um if you've used GitHub at all you probably will have seen this",
    "start": "879320",
    "end": "884880"
  },
  {
    "text": "before which is you can set up Branch protections okay so not anyone should be able to push to your main branch",
    "start": "884880",
    "end": "891480"
  },
  {
    "text": "actually it's not called Branch protections anymore it's called Rule sets but you'll end up in the right place in the settings uh so what that is",
    "start": "891480",
    "end": "898880"
  },
  {
    "text": "that for one or more branches you can set up a bunch of protection so things which have to be satisfied when interacting with this branch and one of",
    "start": "898880",
    "end": "905959"
  },
  {
    "text": "the main things here which I recommend using is to require that in order to get code onto this Branch you have to go via",
    "start": "905959",
    "end": "912160"
  },
  {
    "text": "a pull request okay so I can't push push directly to main I have to open a pull request and then it comes in via the",
    "start": "912160",
    "end": "918040"
  },
  {
    "text": "pull request you can also add a bunch of extra requirements on this uh pull request so you can specify how many",
    "start": "918040",
    "end": "923959"
  },
  {
    "text": "approvals it needs uh so by default GitHub does not let you approve your own pull request that's good uh also as a",
    "start": "923959",
    "end": "931440"
  },
  {
    "text": "reader you are allowed to approve PO requests again readers can do all kinds of funny things but that does not count",
    "start": "931440",
    "end": "938040"
  },
  {
    "text": "towards this counter so that's not an attack it needs to be ex collaborators who approve uh typically you'll want one",
    "start": "938040",
    "end": "945519"
  },
  {
    "text": "approval but maybe you have a really special case where you need two different people to look at this you can configure that okay then there's a bunch",
    "start": "945519",
    "end": "952959"
  },
  {
    "text": "of stupid things I can do so let's say I make a pull request with legitimate code I fix a bug the the person who reviews",
    "start": "952959",
    "end": "959720"
  },
  {
    "text": "it is really happy and says yes go get in the bug fix after they've approved I push my malicious code and then I merge",
    "start": "959720",
    "end": "966040"
  },
  {
    "text": "cuz my poll request was approved that's a pretty obvious attack there's a protection against it which is to say you have to have approved the",
    "start": "966040",
    "end": "972720"
  },
  {
    "text": "most recent commit uh this is kind of annoying actually When developing because like you make a small change you",
    "start": "972720",
    "end": "978319"
  },
  {
    "text": "reset the approval status there's a reason for doing this though another thing I can do is I can see that like uh",
    "start": "978319",
    "end": "984959"
  },
  {
    "text": "some other guy has made a poll request I'm allowed to approve it cuz it's not my PO request but I'm also allowed to",
    "start": "984959",
    "end": "990519"
  },
  {
    "text": "push code to his Branch right so maybe I go in an existing po request I push code to that Branch I approve it now my code",
    "start": "990519",
    "end": "997240"
  },
  {
    "text": "is in there's a protection for that as well which is to say that the approval must be by someone else than whoever",
    "start": "997240",
    "end": "1002480"
  },
  {
    "text": "pushed the last code so by me pushing code to this Branch I've now kind of removed myself as a valid approver uh",
    "start": "1002480",
    "end": "1008800"
  },
  {
    "text": "for this pull request and finally you can if you want even more restrictions here on who's supposed to approve your",
    "start": "1008800",
    "end": "1014040"
  },
  {
    "text": "PLL requests you can require that the approval must come from someone in your code owners file uh so by default it",
    "start": "1014040",
    "end": "1020240"
  },
  {
    "text": "will be anyone with right permissions can make one of these approvals which counts if you want to restrict it further further this is one way to do",
    "start": "1020240",
    "end": "1028000"
  },
  {
    "text": "it okay we've learned we can protect our main branch let's assume we've done that and being good developers here I have",
    "start": "1028000",
    "end": "1035120"
  },
  {
    "text": "some really really sensitive workflow and I've set up here that the only time it runs is when you push code to the",
    "start": "1035120",
    "end": "1040678"
  },
  {
    "text": "main branch I've just configured it so the only way you get code to my main branch is via my like extensive pull",
    "start": "1040679",
    "end": "1046038"
  },
  {
    "text": "request system so you can't just sneak in the code this is good uh this is of course not good because collaborators",
    "start": "1046039",
    "end": "1053480"
  },
  {
    "text": "can change the workflow file right and if you think about it a bit the way this has to work is that the workflow which",
    "start": "1053480",
    "end": "1059919"
  },
  {
    "text": "runs is the workflow version on the branch you're currently running because anything else would just become I guess",
    "start": "1059919",
    "end": "1065960"
  },
  {
    "text": "less usable I don't know I you suppose you could do that but you don't do that anyway uh so what I can do as a hacker",
    "start": "1065960",
    "end": "1071600"
  },
  {
    "text": "is I can make a push to my secret hacker Branch where I modify this workflow to say actually trigger whenever I push to",
    "start": "1071600",
    "end": "1078159"
  },
  {
    "text": "secret hacker brch Branch as I make this push GitHub sees that on this Branch this workflow is supposed to trigger and",
    "start": "1078159",
    "end": "1084559"
  },
  {
    "text": "it runs in the context of my Branch okay so uh another big warning uh",
    "start": "1084559",
    "end": "1090240"
  },
  {
    "text": "collaborators are in control of the workflow file that runs a corollary of that is you cannot make security",
    "start": "1090240",
    "end": "1096840"
  },
  {
    "text": "protections against the collaborator within the workflow file itself they can just edit it out right you can put a bunch of checks I just take away all",
    "start": "1096840",
    "end": "1103919"
  },
  {
    "text": "that in my push uh sorry my commit next we'll talk a bit about",
    "start": "1103919",
    "end": "1110039"
  },
  {
    "text": "Secrets um so there are three different ways to store secrets in GitHub or at",
    "start": "1110039",
    "end": "1115400"
  },
  {
    "text": "least three you can store them at the organization level the repository level or at the environment level uh the",
    "start": "1115400",
    "end": "1121840"
  },
  {
    "text": "organization and repository level are kind of similar so I'll just pretend like the organization thing it doesn't exist and talk about repository level",
    "start": "1121840",
    "end": "1128440"
  },
  {
    "text": "first uh so the way this works is that an admin or someone with appropriate permissions goes in in the settings goes",
    "start": "1128440",
    "end": "1134960"
  },
  {
    "text": "to secrets and sets up some secrets so they have a name and then they have a secret value pretty",
    "start": "1134960",
    "end": "1140960"
  },
  {
    "text": "self-explanatory um the way to use them in a workflow is to use another one of these GitHub workflow context so there's",
    "start": "1140960",
    "end": "1147840"
  },
  {
    "text": "a special object called secrets and then you just access the secret by name um so here for example I mean this",
    "start": "1147840",
    "end": "1154919"
  },
  {
    "text": "is again complete nonsense code I written it it's not doing anything wise it's trying to SSH to some production",
    "start": "1154919",
    "end": "1160679"
  },
  {
    "text": "server and copy some files um okay but we've just leared that",
    "start": "1160679",
    "end": "1165960"
  },
  {
    "text": "the collaborators are in control of the workflow file so as a collaborator I can go and make a new workflow or modify an",
    "start": "1165960",
    "end": "1171880"
  },
  {
    "text": "existing one to do what is happening on the left here which is Echo all the secrets uh so a nice little trick here",
    "start": "1171880",
    "end": "1179240"
  },
  {
    "text": "at the bottom in the GitHub context you can use this tojson thingy to make the secrets object into something you can",
    "start": "1179240",
    "end": "1184440"
  },
  {
    "text": "read um and uh I'm also base 64 encoding the output here the reason for that is",
    "start": "1184440",
    "end": "1190159"
  },
  {
    "text": "that actually GitHub actions itself is trying to help you to not accidentally leak secrets so it will sens it whenever",
    "start": "1190159",
    "end": "1196880"
  },
  {
    "text": "you print the secrets in plain text which you can actually see uh in the like light blue text it has censored the",
    "start": "1196880",
    "end": "1203679"
  },
  {
    "text": "uh result of the echo command itself but then it has given me the B 64 encoded output um if it tries to censor the base",
    "start": "1203679",
    "end": "1210559"
  },
  {
    "text": "64 encoded output which it does sometimes you just base 64 encode once more just keep doing it at some point you'll get it uh or do something more",
    "start": "1210559",
    "end": "1216960"
  },
  {
    "text": "smart like exfiltrate this in a safe way to a server but this is demos at a talk okay uh so repository level secrets can",
    "start": "1216960",
    "end": "1224000"
  },
  {
    "text": "be read by collaborators so if something actually is supposed to be secret like restricted beyond your collaborators you",
    "start": "1224000",
    "end": "1231520"
  },
  {
    "text": "can't you can't use repository level secrets I mean you can but it's not",
    "start": "1231520",
    "end": "1236640"
  },
  {
    "text": "secure um next we need to talk about environments so in the context of GitHub",
    "start": "1236640",
    "end": "1242559"
  },
  {
    "text": "actions an environment is like things like production Dev test staging acceptance whatever the latest and",
    "start": "1242559",
    "end": "1250440"
  },
  {
    "text": "greatest names are um and the way this works with workflows is that the work a workflow may run in the context of a",
    "start": "1250440",
    "end": "1257159"
  },
  {
    "text": "specific environment so you specify this like on line 15 here where you have this",
    "start": "1257159",
    "end": "1262360"
  },
  {
    "text": "environment key which just give me the name of the environment I'm going to run in uh in this example workflow I've",
    "start": "1262360",
    "end": "1267919"
  },
  {
    "text": "taken the name of the environment as an input so you can like choose which environment you want to run in uh and",
    "start": "1267919",
    "end": "1273200"
  },
  {
    "text": "then what's so key nice about this is that you can you have the secrets which is spoke about they can also be",
    "start": "1273200",
    "end": "1278520"
  },
  {
    "text": "configured at the environment level so I can have one secret in the prod environment and one in the dev environment uh you can also Define",
    "start": "1278520",
    "end": "1285080"
  },
  {
    "text": "variables per environment so that's just things which vary right across environment and then you can have a",
    "start": "1285080",
    "end": "1290320"
  },
  {
    "text": "single deploy workflow and depending on if it's running in the production environment or the developer environment",
    "start": "1290320",
    "end": "1296200"
  },
  {
    "text": "it's going to end up like uh deploying the code to different places um so here that's just a workflow",
    "start": "1296200",
    "end": "1302240"
  },
  {
    "text": "which prints the name of the uh environment so that's not all that interesting um okay so here is the red",
    "start": "1302240",
    "end": "1310520"
  },
  {
    "text": "text is an example of again an attempt at having a safe prod environment um so",
    "start": "1310520",
    "end": "1316080"
  },
  {
    "text": "here I have a workflow where I'm doing a check uh if you're running on the main branch you can run in production if not run in",
    "start": "1316080",
    "end": "1323080"
  },
  {
    "text": "Dev we've seen this a bunch of times already you can modify this as the collaborator and I can just say that not",
    "start": "1323080",
    "end": "1328640"
  },
  {
    "text": "I'm running in production environment actually uh and then I steal all your secrets or something that um there are",
    "start": "1328640",
    "end": "1334880"
  },
  {
    "text": "no inherent Protections in environments okay so it feels kind of safe and cozy you you say you're running in production",
    "start": "1334880",
    "end": "1340919"
  },
  {
    "text": "that has some checks and balances it does not unless you set it up um luckily that's pretty simple what you do is you",
    "start": "1340919",
    "end": "1347039"
  },
  {
    "text": "configure your environment to own only run on certain branches uh so I say that the production environment may only run",
    "start": "1347039",
    "end": "1353320"
  },
  {
    "text": "if your code is on the main branch uh I also have Branch protections on the main branch otherwise this is",
    "start": "1353320",
    "end": "1358919"
  },
  {
    "text": "pointless so the combination of a protected main branch production environment which can only run on the main branch now this production",
    "start": "1358919",
    "end": "1365440"
  },
  {
    "text": "environment is actually fairly locked down you can also optionally if you have some really sensitive workflows uh you",
    "start": "1365440",
    "end": "1371200"
  },
  {
    "text": "can require sorry sensitive environments you can require uh explicit review for",
    "start": "1371200",
    "end": "1377799"
  },
  {
    "text": "the running of the workflow so then I'd like request please run deploy to production and then the people I've",
    "start": "1377799",
    "end": "1383559"
  },
  {
    "text": "selected as possible reviewers here will have to go in a manually and say yep that deploy is okay go for",
    "start": "1383559",
    "end": "1389360"
  },
  {
    "text": "it uh cool so if you've scoped your if you've set your secrets up in the",
    "start": "1389360",
    "end": "1394720"
  },
  {
    "text": "environment instead of the repository and I go in and do my trick from a few slides back where I'm just going to",
    "start": "1394720",
    "end": "1400480"
  },
  {
    "text": "print all the secrets uh then what will happen is the workflow run will fail if I'm not on the main branch and it will",
    "start": "1400480",
    "end": "1406440"
  },
  {
    "text": "say that the branch hacker branch is not allowed to deploy to production due to environment protection rules okay so",
    "start": "1406440",
    "end": "1413039"
  },
  {
    "text": "that actually works um so let's say we now are",
    "start": "1413039",
    "end": "1418159"
  },
  {
    "text": "following all the best practices so we have Branch protection set up on let's say a main branch we have an environment",
    "start": "1418159",
    "end": "1424559"
  },
  {
    "text": "set up which is scoped to a protected Branch so now the environment is protected and we have all our secrets",
    "start": "1424559",
    "end": "1430120"
  },
  {
    "text": "set up at the environment level so the secrets are protected um the problem here of course",
    "start": "1430120",
    "end": "1435960"
  },
  {
    "text": "is well it doesn't need to be a problem but I feel like the more modern philosophy is that like hard-coded long lived credentials are a bad idea because",
    "start": "1435960",
    "end": "1442760"
  },
  {
    "text": "eventually they will get leaked I have tried to illustrate this security Concept in paint long liveed static",
    "start": "1442760",
    "end": "1448880"
  },
  {
    "text": "credentials not good uh luckily for us that's something more modern uh modern",
    "start": "1448880",
    "end": "1454840"
  },
  {
    "text": "is maybe not the right word there's something else we can do we're going to the cloud I Googled",
    "start": "1454840",
    "end": "1461360"
  },
  {
    "text": "Cloud uh right we're going to talk about Federated identities and oidc um First Let Me Tell what oidc is",
    "start": "1461360",
    "end": "1469760"
  },
  {
    "text": "uh so there have been a bunch of talks already in this conference I think mentioning oidc so that's good then you",
    "start": "1469760",
    "end": "1475080"
  },
  {
    "text": "guys already kind of know what it's about uh and they have probably gone more in depth than I will now it's a",
    "start": "1475080",
    "end": "1480880"
  },
  {
    "text": "protocol open ID connect um they're like very dumb down version of this is that",
    "start": "1480880",
    "end": "1486000"
  },
  {
    "text": "it is a passwordless Authentication Protocol uh which is based on ool um and the like key part which we",
    "start": "1486000",
    "end": "1493520"
  },
  {
    "text": "need to care about here is that I'm trying to authenticate somewhere and instead of me giving a password we",
    "start": "1493520",
    "end": "1499360"
  },
  {
    "text": "instead go to a third party called an identity provider I authenticate to them and then we send an identity token back",
    "start": "1499360",
    "end": "1506679"
  },
  {
    "text": "uh so for example on this login screen I login as Google Google checks that I'm me and then Google sends a token back",
    "start": "1506679",
    "end": "1512480"
  },
  {
    "text": "and this website can be like yeah I trust Google don't care what that person is up to but Google has said they are this person I'm going to go with that uh",
    "start": "1512480",
    "end": "1519799"
  },
  {
    "text": "the way this looks in GitHub actions or workflows uh I have a workflow which now",
    "start": "1519799",
    "end": "1525200"
  },
  {
    "text": "wants to access a cloud resource because we are deploying for for example to the cloud uh GitHub is now going to be the",
    "start": "1525200",
    "end": "1531320"
  },
  {
    "text": "identity provider because GitHub or GitHub actions I should technically say uh knows everything about your workflow",
    "start": "1531320",
    "end": "1536840"
  },
  {
    "text": "and like who's running it what it's doing um Etc so GitHub sends an ID token",
    "start": "1536840",
    "end": "1543080"
  },
  {
    "text": "to your cloud provider I mean the workflow is doing this but yes it comes from GitHub the cloud provider trusts",
    "start": "1543080",
    "end": "1549000"
  },
  {
    "text": "GitHub and is like yep signed by GitHub I believe whatever says in this uh ID token they check what kind of like what",
    "start": "1549000",
    "end": "1555720"
  },
  {
    "text": "kind of workflow is this uh they go and check you've configured that this type of identity is allowed to do and then",
    "start": "1555720",
    "end": "1561200"
  },
  {
    "text": "based on that you get an access token back which you then can do stuff with uh in the workflow so like for example in",
    "start": "1561200",
    "end": "1566720"
  },
  {
    "text": "the case of azure you could run the Azure uh CLI type thing okay so that is like the super",
    "start": "1566720",
    "end": "1572799"
  },
  {
    "text": "dumb version of this we don't really need more details though to be able to continue here's a as a side note if you",
    "start": "1572799",
    "end": "1579039"
  },
  {
    "text": "ever want to print uh what your identity token is you can use something like the following um here is an example identity",
    "start": "1579039",
    "end": "1586799"
  },
  {
    "text": "token from GitHub um you may have noticed that it was bigger than the screen this was on purpose because it's",
    "start": "1586799",
    "end": "1593520"
  },
  {
    "text": "long and we don't actually need more than the second claim uh so the identity token is actually just adjacent web",
    "start": "1593520",
    "end": "1599279"
  },
  {
    "text": "token uh this is the the payload pot um and it has a bunch of claims and the",
    "start": "1599279",
    "end": "1604679"
  },
  {
    "text": "most interesting one for this talk is the sub claim and here's an example of a value so we're going to talk a bit more",
    "start": "1604679",
    "end": "1610679"
  },
  {
    "text": "about this sub claim and how this is set up by GitHub um we're going to do this by",
    "start": "1610679",
    "end": "1616320"
  },
  {
    "text": "example because the general case is so ugly to spell out uh so when I run a",
    "start": "1616320",
    "end": "1621799"
  },
  {
    "text": "workflow with default config in GitHub if my workflow is running in a specific",
    "start": "1621799",
    "end": "1627919"
  },
  {
    "text": "environment then the sub claim in my ID token from GitHub is going to look something like the first one there where",
    "start": "1627919",
    "end": "1634720"
  },
  {
    "text": "you have repo colon and then you have like the organization slame of repository and then you have another",
    "start": "1634720",
    "end": "1640039"
  },
  {
    "text": "colon and then environment colon and then name of environment um so fill in the right repo",
    "start": "1640039",
    "end": "1645200"
  },
  {
    "text": "and environment here but that's the like general form of the sub claim uh if you're not running in an",
    "start": "1645200",
    "end": "1650600"
  },
  {
    "text": "environment so that one takes precedence but your workflow was triggered by some pull request related event then instead",
    "start": "1650600",
    "end": "1657440"
  },
  {
    "text": "you'll get the second one here so you have the REO again at the start and then instead of the environment at the end you get just this pull request string",
    "start": "1657440",
    "end": "1665279"
  },
  {
    "text": "and then finally if you are not running in the context of an environment and you are also not triggered by a poll request",
    "start": "1665279",
    "end": "1670840"
  },
  {
    "text": "then it will look like the third one where instead of the environmental po request we get a ref uh so in this case",
    "start": "1670840",
    "end": "1676640"
  },
  {
    "text": "this is running from the main Brer this could also be a tag but I like to pretend that tags don't exist so let's",
    "start": "1676640",
    "end": "1682720"
  },
  {
    "text": "say Branch for now so you get like the repo and then the branch uh these are just strings there's no structure to",
    "start": "1682720",
    "end": "1688640"
  },
  {
    "text": "this I mean that is that is colons but it's it is just a string value we are looking at here okay what I'm going to do now is",
    "start": "1688640",
    "end": "1696200"
  },
  {
    "text": "I'm going to briefly talk about how to set up that your GitHub workflow can access your cloud provider for gcp aure",
    "start": "1696200",
    "end": "1703799"
  },
  {
    "text": "and AWS we'll start with gcp where this is called workload ident identity Federation because it's important that",
    "start": "1703799",
    "end": "1710279"
  },
  {
    "text": "each provider has a subtly different name for this which is like almost the same but not quite so then you sound stupid when you use the wrong one when",
    "start": "1710279",
    "end": "1716279"
  },
  {
    "text": "you're talking to someone who knows one other the providers well um gcp I found",
    "start": "1716279",
    "end": "1721519"
  },
  {
    "text": "is the most complicated one to configure your mileage may vary this might just be that I'm not that good at gcp uh what",
    "start": "1721519",
    "end": "1728720"
  },
  {
    "text": "you do is you start by setting up something called uh um a um sorry a",
    "start": "1728720",
    "end": "1733799"
  },
  {
    "text": "workload uh identity pool and in your pool you can come configure providers so",
    "start": "1733799",
    "end": "1739960"
  },
  {
    "text": "here's an example where I've started configuring a provider for GitHub uh so I have to fill in like uh various other",
    "start": "1739960",
    "end": "1747120"
  },
  {
    "text": "claims which are asserted on which I'll never talk about again uh then you are forced to do something set up an which",
    "start": "1747120",
    "end": "1752480"
  },
  {
    "text": "is called to set up an attribute mapping um you're probably wondering what the",
    "start": "1752480",
    "end": "1757600"
  },
  {
    "text": "hell is going on here if you haven't done this before we consult the documentation and it if you don't want",
    "start": "1757600",
    "end": "1762760"
  },
  {
    "text": "to understand everything you're doing it tells you just set this equal to assertion do sub and what you're configuring is actually just what's like",
    "start": "1762760",
    "end": "1769120"
  },
  {
    "text": "the main claim I'm going to be checking when I do checks on identities from GitHub so what I've configured here is",
    "start": "1769120",
    "end": "1775440"
  },
  {
    "text": "that it's the sub claim the one we were just looking at is the thing gcp is going to be checking and that's what the",
    "start": "1775440",
    "end": "1780919"
  },
  {
    "text": "documentation recommends so I assume that means that's what 99% of people do as well uh all right now I want to Grant",
    "start": "1780919",
    "end": "1788840"
  },
  {
    "text": "access to this identity from GitHub to some resource in gcp I've configured my",
    "start": "1788840",
    "end": "1794519"
  },
  {
    "text": "provider there's two ways to do this there's the recommended way uh which which is fairly new I think it was",
    "start": "1794519",
    "end": "1799919"
  },
  {
    "text": "introduced in like last year sometime uh which is direct resource access so I go",
    "start": "1799919",
    "end": "1805000"
  },
  {
    "text": "to my resource in gcp let's say a virtual machine I want to Grant permission to a specific workflow coming",
    "start": "1805000",
    "end": "1811919"
  },
  {
    "text": "from uh GitHub and the way I do is that um I grant it to uh an identity coming",
    "start": "1811919",
    "end": "1818559"
  },
  {
    "text": "from coming from a specific provider with a specific subject that's the sub claim so I say anyone coming from GitHub",
    "start": "1818559",
    "end": "1826960"
  },
  {
    "text": "which has a sub claim equal to this value so here it's a quality we check on is allowed to access this resource so",
    "start": "1826960",
    "end": "1833039"
  },
  {
    "text": "this is like match on a string literally and you write the string and then you do a match or the old way is that you",
    "start": "1833039",
    "end": "1839159"
  },
  {
    "text": "instead uh impersonate a service account so what you do then is that you say um",
    "start": "1839159",
    "end": "1845120"
  },
  {
    "text": "any identity with a specific sub claim so the same as before can impersonate this service account and then can do",
    "start": "1845120",
    "end": "1851080"
  },
  {
    "text": "everything this service account can do so you give the permissions to the service account instead uh this last one",
    "start": "1851080",
    "end": "1856360"
  },
  {
    "text": "here has a very big potential Pitfall which is in one of your pools where you made the provider you can have any",
    "start": "1856360",
    "end": "1862559"
  },
  {
    "text": "number of providers and the service account is not tied to a provider it's actually tied to the pool so all your",
    "start": "1862559",
    "end": "1868000"
  },
  {
    "text": "providers can use the same service account uh so that's one thing to be aware of okay um that was a mouthful",
    "start": "1868000",
    "end": "1875159"
  },
  {
    "text": "let's condense it down to the only bits I actually care about which is when gcp is doing checks on the identity token",
    "start": "1875159",
    "end": "1881720"
  },
  {
    "text": "from GitHub uh I can assert on any value of any claim in the ID token the docs",
    "start": "1881720",
    "end": "1887080"
  },
  {
    "text": "recommend me to assert on the sub value that's what I'm going to be doing there's lots of ways to screw this up but this is cloud agnostic so we don't",
    "start": "1887080",
    "end": "1893639"
  },
  {
    "text": "need to talk about it right now uh let's talk about Azure in Azure it's called Federated identity credentials again we",
    "start": "1893639",
    "end": "1900320"
  },
  {
    "text": "need a different name everywhere uh okay so in Azure a Federated credential is a credential",
    "start": "1900320",
    "end": "1906840"
  },
  {
    "text": "like access of some sort which is associated with an Azure app because we need more terms uh what you do is you",
    "start": "1906840",
    "end": "1913679"
  },
  {
    "text": "configure a subject identifier which is again going to be the subv value in the credential and then if a workflow",
    "start": "1913679",
    "end": "1920279"
  },
  {
    "text": "presents you with an ID token with a sub that matches the exact string you've set up then you may impersonate the app",
    "start": "1920279",
    "end": "1927200"
  },
  {
    "text": "which really is just as a speak for saying you get access to a service principle and then that is granted permissions again um in the UI this is",
    "start": "1927200",
    "end": "1935440"
  },
  {
    "text": "kind of dumbed down a lot for you compared to in gcp uh when you go to add a credential",
    "start": "1935440",
    "end": "1940880"
  },
  {
    "text": "you are presented with this view you have a drop down where there's like a bunch of like semi preconfigured thingies among others GitHub actions",
    "start": "1940880",
    "end": "1948919"
  },
  {
    "text": "um and what that does then is it prompts you for a couple of values so it asks for what's the organization you're coming from what's the repository you're",
    "start": "1948919",
    "end": "1954880"
  },
  {
    "text": "coming from and then it asks for this entity type which is going to be one of",
    "start": "1954880",
    "end": "1959919"
  },
  {
    "text": "environment Branch pull request or tag I'm fitting tag as Branch um so the way this looks when I",
    "start": "1959919",
    "end": "1967639"
  },
  {
    "text": "fill in these values then that grade out value at the bottom is going to be Auto filled in for me with this is what the",
    "start": "1967639",
    "end": "1974639"
  },
  {
    "text": "subject claim uh should look like for these values so here I've filled in the pull request claim and this has autoc",
    "start": "1974639",
    "end": "1980880"
  },
  {
    "text": "completed for me to repo NDC security demoo public colon pull request and what",
    "start": "1980880",
    "end": "1987600"
  },
  {
    "text": "this means now is if there comes an ID token from GitHub workflows with this exact sub then yes you get access to my",
    "start": "1987600",
    "end": "1994559"
  },
  {
    "text": "resource okay we need to do a demo now so you see how any of this actually works because it's awfully confusing um",
    "start": "1994559",
    "end": "2000639"
  },
  {
    "text": "let's see if we have it yes no yes oh right it's playing in the",
    "start": "2000639",
    "end": "2005960"
  },
  {
    "text": "background is it excellent right so this is the Azure UI I have browsed to an app",
    "start": "2005960",
    "end": "2013679"
  },
  {
    "text": "or an app registration in this case in the side barar I've gone to manage certificates and secrets Federated",
    "start": "2013679",
    "end": "2019880"
  },
  {
    "text": "credentials um and if I actually do something here let's see what's",
    "start": "2019880",
    "end": "2024960"
  },
  {
    "text": "happening what am I doing right we are navigating yep here we have a credential configured this is the values I just",
    "start": "2024960",
    "end": "2031840"
  },
  {
    "text": "showed in the slide I'm pretty sure uh moving on let's see what we can do with this uh right right right yes let's see",
    "start": "2031840",
    "end": "2040320"
  },
  {
    "text": "right so here I am now an attacker there's an existing workflow here which makes use of um this Federated",
    "start": "2040320",
    "end": "2049480"
  },
  {
    "text": "credential uh so you can see here this um can we see here you have this uh",
    "start": "2049480",
    "end": "2054760"
  },
  {
    "text": "action here named Azure login so that helps you to do this actual like token exchange business which is why I just",
    "start": "2054760",
    "end": "2061320"
  },
  {
    "text": "didn't speak about how that happens in oidc I just give this some like values for what resource in Azure I'm trying to",
    "start": "2061320",
    "end": "2068079"
  },
  {
    "text": "uh access not access sorry B impersonate um and then this will do the whole oidc",
    "start": "2068079",
    "end": "2073398"
  },
  {
    "text": "flow for me and then afterwards I'm now authenticated to Azure um and I can for example use the Azure CLI so that bottom",
    "start": "2073399",
    "end": "2080398"
  },
  {
    "text": "command AED account list is doing stuff in aure uh as an attack now let's see what",
    "start": "2080399",
    "end": "2089000"
  },
  {
    "text": "we plan on doing",
    "start": "2089000",
    "end": "2094079"
  },
  {
    "text": "um reting here we are right so so uh I've gone and modified this workflow in",
    "start": "2094520",
    "end": "2099680"
  },
  {
    "text": "a couple of places I have at the bottom uh I've added a command to exfiltrate",
    "start": "2099680",
    "end": "2105079"
  },
  {
    "text": "the Azure token uh so I can execute Azure commands directly here in my workflow I'm authenticated it's probably",
    "start": "2105079",
    "end": "2111280"
  },
  {
    "text": "stealthier to just take out the token and do them from somewhere else um I've also modified the condition on when this",
    "start": "2111280",
    "end": "2117359"
  },
  {
    "text": "triggers and said that trigger this when I make a pull request to the dummy Branch not to the main branch I want to stay off it and then what I'm going to",
    "start": "2117359",
    "end": "2125000"
  },
  {
    "text": "do is go and make a poll request with this code",
    "start": "2125000",
    "end": "2129640"
  },
  {
    "text": "um I'm going to make a PLL request from the secret hacker branch which is what I just committed to to the dummy",
    "start": "2130720",
    "end": "2137599"
  },
  {
    "text": "Branch um so a side note here is that I could also do this as a draft PLL",
    "start": "2137599",
    "end": "2142680"
  },
  {
    "text": "request in this case I haven't paid so I can't do it as a draft pull request but pretend like I did um we make a pull",
    "start": "2142680",
    "end": "2150000"
  },
  {
    "text": "request this is going to trigger the workflow to run and we can here see this loging",
    "start": "2150000",
    "end": "2158079"
  },
  {
    "text": "process via oidc so um this helpfully prints various stuff for us so it tells",
    "start": "2158079",
    "end": "2163200"
  },
  {
    "text": "you the subject claim which is going to be used this is what I'm sending to Azure so it's sending exactly this repo",
    "start": "2163200",
    "end": "2168720"
  },
  {
    "text": "NDC security demo hello world colon pull request um it says that this was",
    "start": "2168720",
    "end": "2174480"
  },
  {
    "text": "successful and then afterwards I'm exfiltrating my token here so we can see that run to the end",
    "start": "2174480",
    "end": "2180960"
  },
  {
    "text": "um I don't think I actually do anything with the token but it's always exciting so we got an access token that's that's",
    "start": "2180960",
    "end": "2187680"
  },
  {
    "text": "not what I'm trying to do uh access token which I can now go and use with various aure apis I I'll",
    "start": "2187680",
    "end": "2194599"
  },
  {
    "text": "have to exchange it for something else but it's kind of the high level here is I've stolen the Azure token um now it's probably not that",
    "start": "2194599",
    "end": "2201800"
  },
  {
    "text": "shocking that I could do that uh because again work uh collaborators can do what they want but what might be",
    "start": "2201800",
    "end": "2208560"
  },
  {
    "text": "surprising is that this pull request uh entity type as they call it in Azure just has no inherent protections right",
    "start": "2208560",
    "end": "2215119"
  },
  {
    "text": "it can be a pull request from anywhere to anywhere it can be draft pull request like there's absolutely no restrictions",
    "start": "2215119",
    "end": "2220440"
  },
  {
    "text": "um so let's bring out the warning again uh security wise I didn't know how to write this in a Snappy way if you use",
    "start": "2220440",
    "end": "2226359"
  },
  {
    "text": "this uh pre- suggested pull request thingy from a security point of view you might as well have just ignored the last",
    "start": "2226359",
    "end": "2232800"
  },
  {
    "text": "part and said just anything coming from this Reaper and organization is allowed to access this credential uh so this is a thing we see",
    "start": "2232800",
    "end": "2239640"
  },
  {
    "text": "a lot in tests like things scope to P request because a just suggested it so of course people will use it and then you kind of just don't think that much",
    "start": "2239640",
    "end": "2245680"
  },
  {
    "text": "more about it and it turns out from a security point of view this is really not secure at all okay um next Let's uh summarize the",
    "start": "2245680",
    "end": "2255079"
  },
  {
    "text": "a case so the pool request subject identifier gives no protections so if you use",
    "start": "2255079",
    "end": "2260359"
  },
  {
    "text": "that just know that that means you want anyone in the repo to be able to access this if you use the Riff or the",
    "start": "2260359",
    "end": "2266640"
  },
  {
    "text": "environment versions which was like assert on like you have the repo and then you have a matching environment or you have a matching ref uh you can make",
    "start": "2266640",
    "end": "2273880"
  },
  {
    "text": "this safe if you ensure that the matching resource in GitHub is safe if right so it doesn't help that I make a",
    "start": "2273880",
    "end": "2280599"
  },
  {
    "text": "Federated credential and I say this has to be in the prod environment if I have a prod environment set up in GitHub",
    "start": "2280599",
    "end": "2286079"
  },
  {
    "text": "without any protections because then I can do my same tricks again uh so this we've also SE cases of at customers uh",
    "start": "2286079",
    "end": "2292680"
  },
  {
    "text": "same with the branch case like doesn't help that I say this has to come from the main branch if anyone can commit",
    "start": "2292680",
    "end": "2297880"
  },
  {
    "text": "code to the main branch because then you just do that right uh there's also an option to specify the subject identifier",
    "start": "2297880",
    "end": "2303800"
  },
  {
    "text": "manually so the grade out box you can press a thing and you get a warning and then you can edit it directly this is",
    "start": "2303800",
    "end": "2309440"
  },
  {
    "text": "just back to the gcp case right why you do it manually lots of ways to screw up we get back to that later AWS identity",
    "start": "2309440",
    "end": "2316880"
  },
  {
    "text": "Federation not it's almost Federated identities but not quite uh keeping it interesting okay so",
    "start": "2316880",
    "end": "2323040"
  },
  {
    "text": "what you do is you set up something called an identity we've seen a lot like I'm not going to go into all these",
    "start": "2323040",
    "end": "2328200"
  },
  {
    "text": "details again and again uh the key part here is that in AWS you are prompted to set up a GitHub organization and then",
    "start": "2328200",
    "end": "2335359"
  },
  {
    "text": "you are told to optionally also specify reposit and a branch uh so it used to be that this asked for nothing I think it",
    "start": "2335359",
    "end": "2341200"
  },
  {
    "text": "was wildly insecure by default now you can get away with at least specifying an organization and what you'll see down",
    "start": "2341200",
    "end": "2347839"
  },
  {
    "text": "that at the bottom right is that this has filled in that you have a sub claim uh which is supposed to match the format",
    "start": "2347839",
    "end": "2353760"
  },
  {
    "text": "repo colon name of organization slash wildcard okay so any repo in the",
    "start": "2353760",
    "end": "2360119"
  },
  {
    "text": "organization can access this credential uh now wild cards are always fun as attackers you are allowed to do",
    "start": "2360119",
    "end": "2366680"
  },
  {
    "text": "whatever you want right like you could literally do repo colon star and say this identity can be accessed by anyone",
    "start": "2366680",
    "end": "2374240"
  },
  {
    "text": "from GitHub as long as you have a GitHub token it's going to be approved um for",
    "start": "2374240",
    "end": "2380079"
  },
  {
    "text": "this uh policy sort it's called in AWS I think um exit policy",
    "start": "2380079",
    "end": "2385720"
  },
  {
    "text": "maybe uh probably you aren't going to go in and do that without knowing what that means you have to manually go and set",
    "start": "2385720",
    "end": "2391839"
  },
  {
    "text": "that to be repo star don't do it I guess uh but something which could happen more",
    "start": "2391839",
    "end": "2397000"
  },
  {
    "text": "real ially is that I meant to say you know what this isn't that sensitive anyone in the organization can run it so",
    "start": "2397000",
    "end": "2402880"
  },
  {
    "text": "let's just do repo colon Endy security demo and then a wild card and then I forget the",
    "start": "2402880",
    "end": "2408160"
  },
  {
    "text": "slash um so now I can make a my own organization named NDC security demos",
    "start": "2408160",
    "end": "2414079"
  },
  {
    "text": "and that can go and access my credentials right so you can mess up really easily with wild card uh My",
    "start": "2414079",
    "end": "2419920"
  },
  {
    "text": "Philosophy here is that since you are allowed to assert on any claim you want in AWS you don't have to use the sub",
    "start": "2419920",
    "end": "2426119"
  },
  {
    "text": "claim so if you meant to just use the organization name just use that claim instead there's a claim which is called repository owner which gives you exactly",
    "start": "2426119",
    "end": "2432520"
  },
  {
    "text": "the organization name use that if that's what you meant to use kind of thing uh summarizing you can assert on",
    "start": "2432520",
    "end": "2439160"
  },
  {
    "text": "any value of any claim including Wild Card matches that's fun lots of ways to screw up more than that now because",
    "start": "2439160",
    "end": "2445280"
  },
  {
    "text": "we've covered the three major providers okay so what's a safe claim to assert on",
    "start": "2445280",
    "end": "2451599"
  },
  {
    "text": "um first of all if I'm asserting on sub which is what all documentation always",
    "start": "2451599",
    "end": "2456920"
  },
  {
    "text": "tells you to do in GitHub uh this is only going to be as safe as whatever GitHub setup you have so I did comment",
    "start": "2456920",
    "end": "2463640"
  },
  {
    "text": "on on this a bit earlier as well but if I'm going to if I'm going to assert on you are on the right Branch I better",
    "start": "2463640",
    "end": "2469359"
  },
  {
    "text": "make sure that the right branch is protected right similar for environments polar request isn't protected you can",
    "start": "2469359",
    "end": "2474760"
  },
  {
    "text": "put in all kinds of nonsense here which isn't protected um just be aware of",
    "start": "2474760",
    "end": "2480040"
  },
  {
    "text": "that what is this sub claim actually uh so it is this Weird thingy where you just con concatenated together a bunch",
    "start": "2480040",
    "end": "2486319"
  },
  {
    "text": "of other claims like the reow or the branch or the environment or uh there's a super many other options here and you",
    "start": "2486319",
    "end": "2492400"
  },
  {
    "text": "can actually go in GitHub and configure this to be whatever you want um so typically we don't see that people go in",
    "start": "2492400",
    "end": "2499200"
  },
  {
    "text": "and start modeling with this in GitHub I think this is more relevant for other uh like Source what other cicd systems I",
    "start": "2499200",
    "end": "2507680"
  },
  {
    "text": "don't know any off the top of my head which make you configure this completely um but if you go in and start meddling",
    "start": "2507680",
    "end": "2513599"
  },
  {
    "text": "with this then you can mess up really really badly uh so let's say I config F my GitHub uh sub claim to be one of the",
    "start": "2513599",
    "end": "2520599"
  },
  {
    "text": "following things so I mean these are examples these are like the value you get in a concrete case uh for the first",
    "start": "2520599",
    "end": "2526960"
  },
  {
    "text": "one I've configured it to only send the branch you own only the reference this",
    "start": "2526960",
    "end": "2532599"
  },
  {
    "text": "is of course a disaster because you have a main branch in any repository right so you aren't tied in any way here to a",
    "start": "2532599",
    "end": "2538319"
  },
  {
    "text": "repo an or in the second case line two I decided I'm going to now bring in the",
    "start": "2538319",
    "end": "2543480"
  },
  {
    "text": "workflow name which is this workflow colon uh first first of all the workflow name is in no way secure because that's",
    "start": "2543480",
    "end": "2549720"
  },
  {
    "text": "in control the person who controls the workflow file controls the name so don't use that to begin with also if you're",
    "start": "2549720",
    "end": "2555440"
  },
  {
    "text": "going to use it don't put the claims in this order because what I can do here is I can go in any old repository and make",
    "start": "2555440",
    "end": "2561520"
  },
  {
    "text": "a workflow with the following name so my workflow is named deploy AWS colon repo",
    "start": "2561520",
    "end": "2567480"
  },
  {
    "text": "NDC security demo blah blah and then in this malicious repo I just configure that uh sub token to only have this",
    "start": "2567480",
    "end": "2574319"
  },
  {
    "text": "claim and now it will match the one I configured in the another one because sub matching is only done like it's a",
    "start": "2574319",
    "end": "2580640"
  },
  {
    "text": "literal string comparison there's no structure to this for some reason uh the third one has a similar",
    "start": "2580640",
    "end": "2586240"
  },
  {
    "text": "problem so as a baseline doing uh repo plus environment should be safe if you",
    "start": "2586240",
    "end": "2591599"
  },
  {
    "text": "have your environment set up properly if you mess up the order so you've going to manually set I want my sub claim to",
    "start": "2591599",
    "end": "2597319"
  },
  {
    "text": "include environment and I want it to include repo uh if you mess up the ordering of that then we get exactly the",
    "start": "2597319",
    "end": "2602720"
  },
  {
    "text": "same problem again so I can go and make an environment named prod colon indc security blah blah blah uh and you have",
    "start": "2602720",
    "end": "2609720"
  },
  {
    "text": "a bunch of problems like this so whenever you start setting uh setting up this sub claim manually you have to be",
    "start": "2609720",
    "end": "2614880"
  },
  {
    "text": "very careful about what you are doing um you can do all of these attacks from any",
    "start": "2614880",
    "end": "2620480"
  },
  {
    "text": "reper or so I I have not seen anyone do this in real life this is just my examples by the way the other stuff we",
    "start": "2620480",
    "end": "2625720"
  },
  {
    "text": "actually see at customers there no one's stupid enough to do this in GitHub I hope okay uh there's one more topic I",
    "start": "2625720",
    "end": "2633200"
  },
  {
    "text": "want to talk about this is taken from the uh GI Hub like security hardening",
    "start": "2633200",
    "end": "2639040"
  },
  {
    "text": "docks so this is under like GitHub actions what can I do if I really want to be careful here and there's one thing they mention which is that you isolate",
    "start": "2639040",
    "end": "2645839"
  },
  {
    "text": "critical workflows we've seen time and time again that I can as the collaborator attacker I can keep",
    "start": "2645839",
    "end": "2651680"
  },
  {
    "text": "modifying the workflows right so you can never do any sort of Protections in the workflow files themselves however what",
    "start": "2651680",
    "end": "2658200"
  },
  {
    "text": "if I put my sensitive workflows in a separate repository and this repository has like really hardened access so",
    "start": "2658200",
    "end": "2663640"
  },
  {
    "text": "there's like two people in my organization who can write that um we have the workflow set up in such a way",
    "start": "2663640",
    "end": "2669559"
  },
  {
    "text": "that there's like enough input and config and stuff you send into it that we basically never need to change them they just are there and exist no one",
    "start": "2669559",
    "end": "2676200"
  },
  {
    "text": "ever goes and modifies them we are finally secure we can have a check in our workflow um so here's an example of",
    "start": "2676200",
    "end": "2683280"
  },
  {
    "text": "how you would call a workflow from a different repository you probably cannot read that uh it just says users and then",
    "start": "2683280",
    "end": "2690920"
  },
  {
    "text": "it's a long long long path which gives you organization repo path within the repo uh to a yaml file like the workflow",
    "start": "2690920",
    "end": "2699040"
  },
  {
    "text": "file and then it gives you like an at and then you can specify in some way which version of the file you want so",
    "start": "2699040",
    "end": "2704400"
  },
  {
    "text": "for example here I've used at Main to say take the version from the main branch in that repository what you",
    "start": "2704400",
    "end": "2709559"
  },
  {
    "text": "should do here is you should pin it to a commit hash so you should do at hash this was already too long and too small",
    "start": "2709559",
    "end": "2716200"
  },
  {
    "text": "so I didn't do that in this case but pretend like we did the secure thing and used the hash here or not I don't know",
    "start": "2716200",
    "end": "2721440"
  },
  {
    "text": "we're hacking it so maybe don't do the secure thing um okay uh",
    "start": "2721440",
    "end": "2727760"
  },
  {
    "text": "what is it I want to say right so we've configured this separate repository with workflows now with our existing setups",
    "start": "2727760",
    "end": "2735240"
  },
  {
    "text": "with the uh with these like Federated identity thingies we still haven't got any extra protections because I have no",
    "start": "2735240",
    "end": "2741400"
  },
  {
    "text": "idea if you're using my secure worklow or not you might still just be running your good old uh hacker controlled code",
    "start": "2741400",
    "end": "2748880"
  },
  {
    "text": "but what you can do now we get into customizing what GitHub sends you can set it up to include a claim which is",
    "start": "2748880",
    "end": "2754599"
  },
  {
    "text": "called job workflow ref uh which gives you the reference to which workflow am I",
    "start": "2754599",
    "end": "2759839"
  },
  {
    "text": "currently actually running in so when I from workflow number one in my repository I have collaborate access",
    "start": "2759839",
    "end": "2765119"
  },
  {
    "text": "call out to workflow number two which I only have read access to when I'm over",
    "start": "2765119",
    "end": "2770200"
  },
  {
    "text": "here then the value of the job workflow ref is going to be pointing to this workflow file not this one so if I send",
    "start": "2770200",
    "end": "2776200"
  },
  {
    "text": "that with then when you are specifically in the safe workflow you are now allowed to access this resource kind of thing uh",
    "start": "2776200",
    "end": "2782480"
  },
  {
    "text": "so here's an example claim you can see these things get really really nasty um you have to set up this string like",
    "start": "2782480",
    "end": "2788720"
  },
  {
    "text": "manually literally again spell out the string uh as a side note you can imagine a case here where I tried to set this up",
    "start": "2788720",
    "end": "2795200"
  },
  {
    "text": "and I put a typo in like the repo name or something and then suddenly someone else can go and claim that repo and I'm",
    "start": "2795200",
    "end": "2801640"
  },
  {
    "text": "hacked uh very strange that everything has just happened on like literal string matching no structure there is structure",
    "start": "2801640",
    "end": "2807760"
  },
  {
    "text": "here okay but yes uh right so the example claim we have the repo part that we've been seeing all along and then as",
    "start": "2807760",
    "end": "2814319"
  },
  {
    "text": "the second part we have this wonderful job workflow ref claim uh again you",
    "start": "2814319",
    "end": "2819680"
  },
  {
    "text": "probably can't read the whole thing but this gives you like the whole path to the workflow file I've referenced uh So",
    "start": "2819680",
    "end": "2825160"
  },
  {
    "text": "within a repository and then it gives you again an at and then a in this case a branch because that's the way I set it",
    "start": "2825160",
    "end": "2831319"
  },
  {
    "text": "up so if I attempt to bypass this so in the",
    "start": "2831319",
    "end": "2836599"
  },
  {
    "text": "top lines of this slide I'm using the like safe workflow um when I do that it's going to be able to authenticate to",
    "start": "2836599",
    "end": "2842720"
  },
  {
    "text": "Azure life is going to be good and I'm like right right right right I know how to do this now I'm going to log into Azure directly I'm going to steal the",
    "start": "2842720",
    "end": "2849319"
  },
  {
    "text": "secret I've done this 10 times already no problem uh but when I try to run this I get an error on the step by",
    "start": "2849319",
    "end": "2855839"
  },
  {
    "text": "authenticate to Azure because my claim is wrong so what's happened here is that this wonderful job workflow ref when I'm",
    "start": "2855839",
    "end": "2863319"
  },
  {
    "text": "in my workflow file has been set to that path not the one I'm calling out to it's only the code in the other one which is",
    "start": "2863319",
    "end": "2870559"
  },
  {
    "text": "has the right job work for ref so this really does work the way you want it to do from a security perspective um when",
    "start": "2870559",
    "end": "2876960"
  },
  {
    "text": "you read about this this might sound like feel warm and fuzzy I'm like okay that is a way where I can have a safe",
    "start": "2876960",
    "end": "2882119"
  },
  {
    "text": "workflow file finally that's great but is it safe okay the attacker we cannot modify",
    "start": "2882119",
    "end": "2888359"
  },
  {
    "text": "the reusable workflow but can I control what it's doing uh so now we are actually going to",
    "start": "2888359",
    "end": "2894640"
  },
  {
    "text": "loop back around to the first vulnerability we saw today which was script injection let's say the reusable",
    "start": "2894640",
    "end": "2900319"
  },
  {
    "text": "workflow has script injection now suddenly again I can control what it's doing and I can start exfiltrating secrets and stuff in the secure of the",
    "start": "2900319",
    "end": "2907160"
  },
  {
    "text": "workflow or what's more likely is that your workflow is doing something with my",
    "start": "2907160",
    "end": "2912319"
  },
  {
    "text": "code right otherwise why am I using it like it doesn't need to have anything to do with my repo unless it's actually",
    "start": "2912319",
    "end": "2917520"
  },
  {
    "text": "using something for my repo and maybe something I'm doing in my repo is going to be used in an unsafe way over there",
    "start": "2917520",
    "end": "2924079"
  },
  {
    "text": "and allow me to execute code or something uh so we have an example of that which we've seen uh at several",
    "start": "2924079",
    "end": "2930000"
  },
  {
    "text": "different customers uh which is let's see oh right I keep running in the",
    "start": "2930000",
    "end": "2937200"
  },
  {
    "text": "background stop let's try again okay so what we have here is",
    "start": "2937200",
    "end": "2944440"
  },
  {
    "text": "the um we have an existing workflow which calls one of these reusable",
    "start": "2944440",
    "end": "2949799"
  },
  {
    "text": "workflows you pass in all your like Azure ID thing is like telling this is",
    "start": "2949799",
    "end": "2954839"
  },
  {
    "text": "the uh Azure app we're going to impersonate and then that reusable",
    "start": "2954839",
    "end": "2960079"
  },
  {
    "text": "workflow which is now called reusable terraform so you can guess what it's going to do it's going to do some terraform commands for you uh I think we",
    "start": "2960079",
    "end": "2966720"
  },
  {
    "text": "we'll get to see it in a second let's see um yeah so now we are in the I'm",
    "start": "2966720",
    "end": "2973400"
  },
  {
    "text": "zoomed in too far but now we are in the reusable one and what happens here is that we run a bunch of uh we do an add a",
    "start": "2973400",
    "end": "2979920"
  },
  {
    "text": "login we do some terraform setup and then we run terraform plan and then here we have this check that if the branch is",
    "start": "2979920",
    "end": "2988000"
  },
  {
    "text": "the main branch then you're allowed to do terraform apply now this check I cannot just bypass because this is code",
    "start": "2988000",
    "end": "2993319"
  },
  {
    "text": "I don't control anymore the problem is I'm running terraform plan terraform plan can actually execute code so what I",
    "start": "2993319",
    "end": "3001960"
  },
  {
    "text": "can do is as an attacker I'm like a million speed that's why this is going so fast",
    "start": "3001960",
    "end": "3008440"
  },
  {
    "text": "let's go time back uh as an attacker I can just make some terraform code which will execute at plan time I like to call",
    "start": "3008440",
    "end": "3015640"
  },
  {
    "text": "it in this case I'm not actually executing code I'm just reading a file because that's even easier so I'm going to go and read this Azure token cache",
    "start": "3015640",
    "end": "3023040"
  },
  {
    "text": "cuz the aure login was done before the terraform apply because otherwise it can't see what's going to happen with a resources it's affecting I'm going to",
    "start": "3023040",
    "end": "3029960"
  },
  {
    "text": "just go and read this in the terraform plan stage and if we let this run to completion um I'm going to commit this",
    "start": "3029960",
    "end": "3037240"
  },
  {
    "text": "I'm going to make a pull request it's hopefully going to trigger my",
    "start": "3037240",
    "end": "3042640"
  },
  {
    "text": "workflow um this is going to run it's going to",
    "start": "3042640",
    "end": "3047720"
  },
  {
    "text": "succeed so we can again pause here and zoom in on the sub claim you can see these are really really nasty things",
    "start": "3047720",
    "end": "3052920"
  },
  {
    "text": "these days we are in the reusable workflow um because now it's doing terraform plan in the context of the",
    "start": "3052920",
    "end": "3059160"
  },
  {
    "text": "reusable one moving along we do terraform in it and terraform plan has now printed my",
    "start": "3059160",
    "end": "3066200"
  },
  {
    "text": "access token okay great so we bypassed this whole stupid reusable workflow stuff um",
    "start": "3066200",
    "end": "3073000"
  },
  {
    "text": "this is like a tale of caution because just because the workflow file is safe there's like a million different ways",
    "start": "3073000",
    "end": "3078440"
  },
  {
    "text": "you can mess this up and give people some kind of controler what's happening in the workflow so be very very sure that you have no code execution from the",
    "start": "3078440",
    "end": "3085720"
  },
  {
    "text": "person who uses your work so that could be terraform is a example like I said we've seen multiple places um you can",
    "start": "3085720",
    "end": "3091559"
  },
  {
    "text": "have like some kind of infrastructures code stuff often has some way to read aile or execute code uh and I'm sure",
    "start": "3091559",
    "end": "3097640"
  },
  {
    "text": "there's many other examples too all right we are aing lunch let's do a summary we have time for that don't we",
    "start": "3097640",
    "end": "3104799"
  },
  {
    "text": "yes all right so in terms of pure GitHub config uh first of all don't put your",
    "start": "3104799",
    "end": "3110200"
  },
  {
    "text": "security measures which are supposed to protect against collaborators within workflow files themselves if you do put them in a separate Reaper and be very",
    "start": "3110200",
    "end": "3116240"
  },
  {
    "text": "careful but yeah let's not talk about that use Branch protections so like your main branch or whatever should have all",
    "start": "3116240",
    "end": "3122240"
  },
  {
    "text": "these checks in place use environments and tie the environments to protected branches to make them protected always",
    "start": "3122240",
    "end": "3128880"
  },
  {
    "text": "put your secrets in the environment unless they aren't act that secret in which case do whatever you want I guess it's a secret at that point uh and avoid",
    "start": "3128880",
    "end": "3136799"
  },
  {
    "text": "script injections by always using this EnV thingy inside the steps in your workflows easy uh your oidc config in",
    "start": "3136799",
    "end": "3145240"
  },
  {
    "text": "the cloud I'm going to State don't use wild cards I'm sure there are legitimate use cases to use wild cards but you'll",
    "start": "3145240",
    "end": "3151319"
  },
  {
    "text": "know like you've looked at this closely enough to know you need a wild card you probably know what you're doing um is",
    "start": "3151319",
    "end": "3157599"
  },
  {
    "text": "that generally true I'm not sure uh okay uh ensure that the GitHub sub claim which you've configured to send out so",
    "start": "3157599",
    "end": "3163680"
  },
  {
    "text": "like the default one was the like Reaper and either environment Branch or pull request if you're going to modify this",
    "start": "3163680",
    "end": "3169319"
  },
  {
    "text": "you better make sure that it's using safe values in a safe order uh when you assert on the sub be",
    "start": "3169319",
    "end": "3175319"
  },
  {
    "text": "as specific as you can so again like if you can be more specific than just the organization be more specific than just",
    "start": "3175319",
    "end": "3180799"
  },
  {
    "text": "the organization and then if your uh Cloud identity thingy if you want some kind of",
    "start": "3180799",
    "end": "3187400"
  },
  {
    "text": "protections on that then you better make sure that your sub is tied to a protected thing so if you're going to",
    "start": "3187400",
    "end": "3193920"
  },
  {
    "text": "assert on the ref make sure it is referencing a protected Branch if you're going to do an environment it has to reference a protected environment uh if",
    "start": "3193920",
    "end": "3200960"
  },
  {
    "text": "it's going to do the like workflow in another repository thing make sure to mention both the repository are currently running in and the one you're",
    "start": "3200960",
    "end": "3207480"
  },
  {
    "text": "referencing and finally and this is to be honest I mean completely out of place on this slide follow the principle of",
    "start": "3207480",
    "end": "3213720"
  },
  {
    "text": "least privilege but that's actually the thing which uh customers mess up the most on our tests so we have all these",
    "start": "3213720",
    "end": "3218880"
  },
  {
    "text": "ways to get your Azure credentials or whatever this doesn't really need to be a huge problem right it might be that",
    "start": "3218880",
    "end": "3224640"
  },
  {
    "text": "they are scoped exactly right so they can only do exactly what the workflow was doing and I was supposed to be able to run the workflow and do that thing",
    "start": "3224640",
    "end": "3231680"
  },
  {
    "text": "what happens in real life is someone has just given a way too wide permission right so by taking over some service princip principle I can now do",
    "start": "3231680",
    "end": "3237200"
  },
  {
    "text": "everything in your Azure Cloud for example um so this is like the main one is even just because I've configured my",
    "start": "3237200",
    "end": "3243640"
  },
  {
    "text": "credential in some way to be tied to a workflow the workflow is doing three or four things the remaining permissions can",
    "start": "3243640",
    "end": "3250440"
  },
  {
    "text": "still be used right people can still go in and modify this and do whatever else um and that's it thank you very",
    "start": "3250440",
    "end": "3256960"
  },
  {
    "text": "much I took the liberty of modifying the binary security logo to match NDC so uh",
    "start": "3256960",
    "end": "3263720"
  },
  {
    "text": "that's me all right uh I guess we have a few minutes for questions if if anyone has any",
    "start": "3263720",
    "end": "3269640"
  },
  {
    "text": "yes question in your lasto",
    "start": "3269640",
    "end": "3275400"
  },
  {
    "text": "the uh right so that is let's see if we find it uh here somewhere uh so that is the",
    "start": "3277160",
    "end": "3286200"
  },
  {
    "text": "following so I'm in a terraform file and this is like a legitimate thing you can do in terraform is to use this uh file",
    "start": "3286200",
    "end": "3293040"
  },
  {
    "text": "thingy I've forgotten the proper names in terraform file in",
    "start": "3293040",
    "end": "3298839"
  },
  {
    "text": "your yeah this is in my repository right so the point of the reusable workflow is to do like a safe terraform apply really",
    "start": "3298839",
    "end": "3306599"
  },
  {
    "text": "so it's applying the code in your like in other repositories so every repository should use this one to do",
    "start": "3306599",
    "end": "3311680"
  },
  {
    "text": "terraform plan and then this workflow should ensure that you only do that from the main branch in all the other",
    "start": "3311680",
    "end": "3317040"
  },
  {
    "text": "repositories so it's still a code from the other repository you are applying to different places or planning or",
    "start": "3317040",
    "end": "3323079"
  },
  {
    "text": "yeah uh yes by there's a",
    "start": "3323079",
    "end": "3328319"
  },
  {
    "text": "heard what did you call it sorry it's I haven't heard of this",
    "start": "3332000",
    "end": "3338280"
  },
  {
    "text": "now yeah yes yeah yeah I've seen all the tools which point out this injection",
    "start": "3344799",
    "end": "3351039"
  },
  {
    "text": "thing as well that's beginning to be a very well-known thing somehow it still happens though uh yeah the ones that you",
    "start": "3351039",
    "end": "3357599"
  },
  {
    "text": "mention right exactly yeah and the question have you done something",
    "start": "3357599",
    "end": "3364760"
  },
  {
    "text": "to ah yes so I chose to I mean there's way too many things to cover right I haven't I've only scratched the surface",
    "start": "3364760",
    "end": "3370760"
  },
  {
    "text": "so the GitHub token I chose to completely ignore because that's a whole other uh thing I guess we could have a separate talk on what kind of",
    "start": "3370760",
    "end": "3376359"
  },
  {
    "text": "permissions you have there um in all of these if you are going to do the oidc thing you must have given it uh the like",
    "start": "3376359",
    "end": "3382920"
  },
  {
    "text": "token permission right uh of course if you don't have that you can't go in and start stealing Cloud credentials uh but",
    "start": "3382920",
    "end": "3388799"
  },
  {
    "text": "I've kind of chosen to gloss over that entirely right any other questions or",
    "start": "3388799",
    "end": "3393920"
  },
  {
    "text": "shall we go it one more question show the code for the slid again sure uh oh yeah there's",
    "start": "3393920",
    "end": "3399960"
  },
  {
    "text": "also some references at the end but you can take them from here a so you trust me",
    "start": "3399960",
    "end": "3405440"
  },
  {
    "text": "now but not at the start that's that's interesting excellent okay uh I guess",
    "start": "3405440",
    "end": "3411359"
  },
  {
    "text": "let's go eat thank you very much",
    "start": "3411359",
    "end": "3415279"
  }
]