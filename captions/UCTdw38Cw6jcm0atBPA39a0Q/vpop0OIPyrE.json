[
  {
    "text": "hey everyone uh thank you for joining welcome in this talk which is essentially one hour of myself talking",
    "start": "8960",
    "end": "16240"
  },
  {
    "text": "about a very very very deep nerd snipe into a rabbit hole actually",
    "start": "16240",
    "end": "21760"
  },
  {
    "text": "of streaming online audio to my sonos speakers that i have at home",
    "start": "21760",
    "end": "26800"
  },
  {
    "text": "before we start i want to quickly give you a disclaimer i will share some bits of source code where they matter",
    "start": "26800",
    "end": "32719"
  },
  {
    "text": "i will show you a couple of thoughts but i will not share the full application that i built because i think i broke some some",
    "start": "32719",
    "end": "40079"
  },
  {
    "text": "license agreements with this thing so let's make sure that this doesn't uh doesn't hit the internet",
    "start": "40079",
    "end": "45440"
  },
  {
    "text": "with that let's uh let's start so back in january this year um we",
    "start": "45440",
    "end": "51760"
  },
  {
    "text": "well essentially when we moved into our house we bought a couple of living room speakers to make sure that",
    "start": "51760",
    "end": "57280"
  },
  {
    "text": "we had audio for tv that we could stream radio and things like that but in january this year we were thinking about",
    "start": "57280",
    "end": "63680"
  },
  {
    "text": "replacing those old speakers that we bought when we bought the house here um the old speakers were actually old pc",
    "start": "63680",
    "end": "69840"
  },
  {
    "text": "speakers they gave a decent amount of audio and so on but it was not very",
    "start": "69840",
    "end": "75200"
  },
  {
    "text": "handy to put up some internet radio or something like that so we thought let's replace those with",
    "start": "75200",
    "end": "80240"
  },
  {
    "text": "something new and shiny and let's replace them with something smart as well because we stream a lot",
    "start": "80240",
    "end": "85759"
  },
  {
    "text": "from the internet from um from yeah a lot of different radio stations and so on so i wanted to have",
    "start": "85759",
    "end": "92079"
  },
  {
    "text": "something that was connected to the internet and could stream from there as well uh the requirements would be two of",
    "start": "92079",
    "end": "98079"
  },
  {
    "text": "those speakers for the living room but since we were renewing anyway um we thought of well maybe also adding",
    "start": "98079",
    "end": "104159"
  },
  {
    "text": "a couple to the home office because then uh well we spend more time there this year anyway and let's have this continuous group of",
    "start": "104159",
    "end": "111119"
  },
  {
    "text": "speakers where we can just roam around the house and have the same music and audio playing everywhere",
    "start": "111119",
    "end": "116560"
  },
  {
    "text": "so we fell on some sono speakers uh the sonos 5 actually and we looked at",
    "start": "116560",
    "end": "123280"
  },
  {
    "text": "the price and we were thinking okay maybe for just four speakers that may be bricks",
    "start": "123280",
    "end": "128640"
  },
  {
    "text": "in two years from now if sonos decide not to update their firmware or whatever that's kind of expensive to buy um wits",
    "start": "128640",
    "end": "136080"
  },
  {
    "text": "with that in mind there have been cases of lots of iot products and so on where support is discontinued so we",
    "start": "136080",
    "end": "143040"
  },
  {
    "text": "didn't want to spend this amount of money on speakers so now what until the day we",
    "start": "143040",
    "end": "148480"
  },
  {
    "text": "were walking around in an ikea in the neighborhoods and we found those symphonies speakers that they have i",
    "start": "148480",
    "end": "154239"
  },
  {
    "text": "don't know if they have them in australia but it was kind of nice because they they looked like sonos speakers and we",
    "start": "154239",
    "end": "159760"
  },
  {
    "text": "looked at them and they were actually solo speakers as well same hardware just in an ikea box",
    "start": "159760",
    "end": "165040"
  },
  {
    "text": "essentially uh same software the application to control them was the exact same application that you would have for the",
    "start": "165040",
    "end": "170800"
  },
  {
    "text": "other ones and they came at uh less than half the price so that was really interesting",
    "start": "170800",
    "end": "176000"
  },
  {
    "text": "they sounded well so we took them home in a cardboard box we read the manual we installed them and",
    "start": "176000",
    "end": "182319"
  },
  {
    "text": "we followed everything that was in the manual so we sat in the sofa and we started playing some audio we",
    "start": "182319",
    "end": "187920"
  },
  {
    "text": "installed the application and uh we found it on the android play store or on the google play store",
    "start": "187920",
    "end": "193200"
  },
  {
    "text": "installed it we started playing things we used spotify we used our typical tuning radio things like",
    "start": "193200",
    "end": "199760"
  },
  {
    "text": "that everything worked we were really in love with this entire setup so so so good except for this one thing",
    "start": "199760",
    "end": "207599"
  },
  {
    "text": "uh there's this online video site and i'll name it anyway on youtube where there's a lot of video",
    "start": "207599",
    "end": "214480"
  },
  {
    "text": "clips and usually what we did was play those video clips not for the video clips but for for the music that they contained",
    "start": "214480",
    "end": "221440"
  },
  {
    "text": "and i tried playing music from the video sites and that didn't really work so we were",
    "start": "221440",
    "end": "227440"
  },
  {
    "text": "thinking okay smart speakers and they can play something from the internet which is their main promise and",
    "start": "227440",
    "end": "234319"
  },
  {
    "text": "that kind of sucks it's not very very ideal so our honeymoon phase was kind of over",
    "start": "234319",
    "end": "240799"
  },
  {
    "text": "and we were grumpy cats so now what and i i made this slide intentionally",
    "start": "240799",
    "end": "246480"
  },
  {
    "text": "look bad because that was what we felt we were searching online for solutions to playing video from this website or",
    "start": "246480",
    "end": "252319"
  },
  {
    "text": "audio from this video websites and all we could find really was excuses from",
    "start": "252319",
    "end": "258000"
  },
  {
    "text": "google blaming sonos or sonos blaming google and legal and patents and really i didn't care i just paid a lot",
    "start": "258000",
    "end": "264400"
  },
  {
    "text": "of money for speakers i just wanted this to work so now what um search a little bit on the play store",
    "start": "264400",
    "end": "271759"
  },
  {
    "text": "again and found a couple of apps that were able to do this but first of all they were paying how dare",
    "start": "271759",
    "end": "278400"
  },
  {
    "text": "they ask for three dollars second of all i would expect that i",
    "start": "278400",
    "end": "283840"
  },
  {
    "text": "could use the the app that i'm used to and just press share there and play on those speakers and this was an entirely",
    "start": "283840",
    "end": "289680"
  },
  {
    "text": "separate app with different kinds of permissions with different ways of navigating around the website and so on",
    "start": "289680",
    "end": "295520"
  },
  {
    "text": "i wanted something simple and not something that would replace the app that we were actually already using",
    "start": "295520",
    "end": "300639"
  },
  {
    "text": "again also with the risk that some apis would break and this app would break over time so",
    "start": "300639",
    "end": "305759"
  },
  {
    "text": "i wanted something that actually worked so i started looking into the documentation on the sonos websites and found that",
    "start": "305759",
    "end": "313440"
  },
  {
    "text": "they supported a variety of audio formats including mp4 now my idea was that this video website",
    "start": "313440",
    "end": "320960"
  },
  {
    "text": "would play mp4s because those are videos and that's the typical video format that we use online",
    "start": "320960",
    "end": "327039"
  },
  {
    "text": "so yeah why can't i send mp4s to this sonos device and have them play so this is where the nerd snipe started",
    "start": "327039",
    "end": "336000"
  },
  {
    "text": "i'm not sure if everyone in the audience is familiar with the term of nerd sniping but it's essentially giving someone a",
    "start": "336000",
    "end": "342080"
  },
  {
    "text": "time-consuming problem that they will dive in completely and that they will try to",
    "start": "342080",
    "end": "347600"
  },
  {
    "text": "finish until the ends but that may take a while and that may be complex and so on and it's really",
    "start": "347600",
    "end": "353759"
  },
  {
    "text": "yeah putting someone on a different track and uh and hoping they finish",
    "start": "353759",
    "end": "359120"
  },
  {
    "text": "i do this often with colleagues colleagues do this often with me but this was essentially a self nerd snipe",
    "start": "359120",
    "end": "364160"
  },
  {
    "text": "where yeah i put myself in that situation of researching and essentially getting that mp4 file to",
    "start": "364160",
    "end": "370880"
  },
  {
    "text": "play on the speakers so i started doing some research and uh thinking about what i would need",
    "start": "370880",
    "end": "377600"
  },
  {
    "text": "so i would need to be able to connect to the speakers first of all have a way to interact with them and",
    "start": "377600",
    "end": "383120"
  },
  {
    "text": "send data to them a way to get the mp4 url of that online video",
    "start": "383120",
    "end": "389440"
  },
  {
    "text": "get away to send that url to those speakers and then essentially enjoy the music so i thought",
    "start": "389440",
    "end": "394880"
  },
  {
    "text": "three simple steps how hard can it be turns out that there's a lot of things on the internet",
    "start": "394880",
    "end": "401440"
  },
  {
    "text": "and if you google around there's a lot of things that you can find that will work out of the box and i found this soco",
    "start": "401440",
    "end": "407440"
  },
  {
    "text": "library the sonos controller library in python it allows you to discover speakers first",
    "start": "407440",
    "end": "414000"
  },
  {
    "text": "of all it allows you to change the volume of the speakers play music send urls to them and so on and this",
    "start": "414000",
    "end": "420400"
  },
  {
    "text": "really sounds great and i thought okay let's install a python runtime uh give their hello world a try and send",
    "start": "420400",
    "end": "426800"
  },
  {
    "text": "some mp3 file or something to those speakers so i did so downloaded it connected to one speaker",
    "start": "426800",
    "end": "432720"
  },
  {
    "text": "essentially in the main methods of the python script i start or create a new soco class connected to",
    "start": "432720",
    "end": "440560"
  },
  {
    "text": "the ip address of one of the speakers send it a link to an mp3 file that i had on my local web server",
    "start": "440560",
    "end": "446880"
  },
  {
    "text": "and it all worked very promising everything worked i could connect to this thing essentially in",
    "start": "446880",
    "end": "452960"
  },
  {
    "text": "five lines of codes and have it play some url of course an app would be nice later on but so far this works so",
    "start": "452960",
    "end": "460080"
  },
  {
    "text": "proof of concept wise the first step of connecting to those speakers was already finished and was working the next step",
    "start": "460080",
    "end": "468080"
  },
  {
    "text": "was getting the mp4 url of the online video so it turns out that if you play a video",
    "start": "468080",
    "end": "474319"
  },
  {
    "text": "on youtube that id that you have in url is something that you can also use for",
    "start": "474319",
    "end": "479759"
  },
  {
    "text": "another endpoint that they have the get video info endpoints if you pass that in what you will see",
    "start": "479759",
    "end": "485440"
  },
  {
    "text": "is a giant block of url encoded data that is being returned with some json sprinkled in that is also",
    "start": "485440",
    "end": "492000"
  },
  {
    "text": "url encoded and so on it's really a crazy format but somewhere in there you will be able",
    "start": "492000",
    "end": "497039"
  },
  {
    "text": "to find an element that is named streaming data and that streaming data you will find one or",
    "start": "497039",
    "end": "502720"
  },
  {
    "text": "multiple video formats and audio formats with a url to the actual mp4 file",
    "start": "502720",
    "end": "509680"
  },
  {
    "text": "and their mime type so you know what data type it is they have some audio only mp4s as well",
    "start": "509680",
    "end": "515839"
  },
  {
    "text": "and then there's lots of different formats in there but essentially this was the way to go about it uh call",
    "start": "515839",
    "end": "521200"
  },
  {
    "text": "that a specific endpoint on youtube with the idea of the video and then get back the url for that video and start",
    "start": "521200",
    "end": "527680"
  },
  {
    "text": "playing it yes um turns out after some more reading about getting that mp4 url",
    "start": "527680",
    "end": "534240"
  },
  {
    "text": "actually alexa wrote a really interesting blog post about how they do it turns out there's multiple video formats",
    "start": "534240",
    "end": "541200"
  },
  {
    "text": "so the one that i just showed you is the simple one for videos that you and i upload to youtube but not",
    "start": "541200",
    "end": "547600"
  },
  {
    "text": "not the big record labels and things like that because they have signed videos there's",
    "start": "547600",
    "end": "552880"
  },
  {
    "text": "actually a cipher that is being used to go to the url to the video and that",
    "start": "552880",
    "end": "558080"
  },
  {
    "text": "cipher is hidden somewhere in the actual javascript player and is different for every video that you watch on youtube so",
    "start": "558080",
    "end": "565680"
  },
  {
    "text": "if you would want to watch one of those videos or get the metadata for one of those videos you would need access to that cipher and",
    "start": "565680",
    "end": "572320"
  },
  {
    "text": "you could do that by either parsing the entire video player in javascript and then fetching the cipher",
    "start": "572320",
    "end": "578480"
  },
  {
    "text": "from nets i think alexa also talked about using a very complex regular expression to get",
    "start": "578480",
    "end": "584000"
  },
  {
    "text": "that cipher but in the end there's a couple of libraries out there that allow you to uh to get",
    "start": "584000",
    "end": "589120"
  },
  {
    "text": "the url for traditional videos as well as those signed videos in summary",
    "start": "589120",
    "end": "594959"
  },
  {
    "text": "there are libraries that we can use to get the mp4 url awesome so next thing i did was reuse",
    "start": "594959",
    "end": "601600"
  },
  {
    "text": "the script that i had connect to my speaker again and instead of sending it the mp3 url that i had on",
    "start": "601600",
    "end": "607440"
  },
  {
    "text": "my local server i sent it a url to one of those youtube videos that i got from the metadata",
    "start": "607440",
    "end": "614320"
  },
  {
    "text": "and um yeah i ran it and i was waiting the expected situation would be that the",
    "start": "614320",
    "end": "619519"
  },
  {
    "text": "speakers would start playing the actual situation was uh kind of disappointing",
    "start": "619519",
    "end": "625680"
  },
  {
    "text": "not a lot happens it was playing it was actually playing a pop it",
    "start": "625680",
    "end": "631360"
  },
  {
    "text": "essentially whenever i ran the script one second later it would say nothing more",
    "start": "631360",
    "end": "637200"
  },
  {
    "text": "uh so that was disappointing and i was thinking huh now what what do i do now um",
    "start": "637200",
    "end": "644480"
  },
  {
    "text": "what do you do when you're already this deep in the rabbit hole while you start searching and i found on some obscure",
    "start": "644480",
    "end": "650399"
  },
  {
    "text": "websites i found that all of those sono speakers have a hidden web server that is available",
    "start": "650399",
    "end": "656240"
  },
  {
    "text": "there is a status server there's a support slash review server there's a tools.htm",
    "start": "656240",
    "end": "661279"
  },
  {
    "text": "there's no logic in the api that this web server provides but it allows you to look at how it's connected to the wi-fi",
    "start": "661279",
    "end": "668160"
  },
  {
    "text": "look at the supported formats it allows you to even do a ping or a trace route to something else on your",
    "start": "668160",
    "end": "674560"
  },
  {
    "text": "on your network but i could not find any way to uh yeah to essentially figure out why it",
    "start": "674560",
    "end": "679920"
  },
  {
    "text": "was not playing that mp4 file that i sent it so time for troubleshooting",
    "start": "679920",
    "end": "686399"
  },
  {
    "text": "the irony by the way is that uh it was almost as hard to find a license-free",
    "start": "686399",
    "end": "692079"
  },
  {
    "text": "picture of a rabbit hole as this entire talk about diving into a rabbit hole was so that's a",
    "start": "692079",
    "end": "698959"
  },
  {
    "text": "little bit of a downside anyway troubleshooting so i started thinking",
    "start": "698959",
    "end": "704800"
  },
  {
    "text": "maybe it is that soco library that i was using maybe those 65 contributors who have",
    "start": "704800",
    "end": "710160"
  },
  {
    "text": "been building this thing for a couple of years now maybe they have it wrong of course putting it that way it",
    "start": "710160",
    "end": "716800"
  },
  {
    "text": "already sounds a little bit stupid but at this point i was thinking well why not we are checking anyway let's see",
    "start": "716800",
    "end": "723519"
  },
  {
    "text": "let's see what we can do the official application of sonos can send a stream to the speakers so maybe i",
    "start": "723519",
    "end": "730000"
  },
  {
    "text": "can listen on the network and see what the request what the payload of data that they send to those speakers looks",
    "start": "730000",
    "end": "736000"
  },
  {
    "text": "like and essentially replay that from from a custom application",
    "start": "736000",
    "end": "741680"
  },
  {
    "text": "so i wanted to sniff the network see which package we're going over the wire there is a tool called wireshark and",
    "start": "741680",
    "end": "749040"
  },
  {
    "text": "wireshark works on a lot of operating systems and it allows you to sniff the traffic that passes your computer's",
    "start": "749040",
    "end": "754959"
  },
  {
    "text": "network adapter so essentially you boot it it installs the virtual network cards",
    "start": "754959",
    "end": "760399"
  },
  {
    "text": "and it listens to everything that passes by your computer unfortunately my app my phone",
    "start": "760399",
    "end": "767680"
  },
  {
    "text": "was on wifi my computer was on wi-fi but i could still not see the traffic passing my computer",
    "start": "767680",
    "end": "774399"
  },
  {
    "text": "turns out that my access point is smart enough to know where to direct the network traffic and it's not sending all",
    "start": "774399",
    "end": "780000"
  },
  {
    "text": "that traffic everywhere so that's that's a bit annoying because i have no way of sniffing the network seeing what was",
    "start": "780000",
    "end": "786160"
  },
  {
    "text": "going over the wire there but then it hit me i have those unify access points and",
    "start": "786160",
    "end": "791680"
  },
  {
    "text": "they're all unix based or linux based or whatever so i could use this command called tcp",
    "start": "791680",
    "end": "796880"
  },
  {
    "text": "dump on there and sniff on the access point itself so i started doing that so from my windows",
    "start": "796880",
    "end": "803360"
  },
  {
    "text": "machine i ran ubuntu in the windows subsystem for linux ssh into my access point and there ran",
    "start": "803360",
    "end": "810560"
  },
  {
    "text": "tcp dump and piped all the data back to windows it sounds mind-blowing and kind of is but the command is fairly",
    "start": "810560",
    "end": "817760"
  },
  {
    "text": "simple it's essentially ssh into the access point ip address",
    "start": "817760",
    "end": "823040"
  },
  {
    "text": "running tcp dump and telling it that we want to capture the ethernet 0",
    "start": "823040",
    "end": "828800"
  },
  {
    "text": "network adapter and all the traffic that goes from or to my phone's ip address",
    "start": "828800",
    "end": "835120"
  },
  {
    "text": "so essentially using this command and then piping it into mount c users my username to my desktop i was",
    "start": "835120",
    "end": "841920"
  },
  {
    "text": "able to dump data from the access points directly onto my computer awesome nice side effect is that those",
    "start": "841920",
    "end": "848560"
  },
  {
    "text": "captures that you capture using tcp dump they can also be opened in wireshark so",
    "start": "848560",
    "end": "854000"
  },
  {
    "text": "in wireshark i was able to see all of the data between various devices",
    "start": "854000",
    "end": "859040"
  },
  {
    "text": "and my my speaker or my phone and what i could see is essentially all of the packets that",
    "start": "859040",
    "end": "864560"
  },
  {
    "text": "were sent when i in the application streamed one certain file or one certain radio station",
    "start": "864560",
    "end": "870399"
  },
  {
    "text": "to the speaker and i looked into the packets this ui is very very confusing and complex but i",
    "start": "870399",
    "end": "877680"
  },
  {
    "text": "found some menu entry that would show me the payloads of one packets traced across",
    "start": "877680",
    "end": "882959"
  },
  {
    "text": "tcp and i found this one where apparently my phone was sending a post",
    "start": "882959",
    "end": "888240"
  },
  {
    "text": "request to a web server somewhere to a media renderer av transport slash control url with a",
    "start": "888240",
    "end": "895839"
  },
  {
    "text": "payload that is essentially some xml and yes your fancy wi-fi speaker uses",
    "start": "895839",
    "end": "900880"
  },
  {
    "text": "soap to retrieve its data and its payloads and to do whatever it does now i decoded that put it on the next",
    "start": "900880",
    "end": "907839"
  },
  {
    "text": "slide and this is essentially the payload that my phone was sending to those speakers a bunch of soap",
    "start": "907839",
    "end": "914959"
  },
  {
    "text": "with a set av transport uri method that is being called it's passing",
    "start": "914959",
    "end": "921199"
  },
  {
    "text": "the current uri for the file that i want to play it's not http it's not https it's this",
    "start": "921199",
    "end": "926639"
  },
  {
    "text": "custom types that says x-ring con mp3 radio with",
    "start": "926639",
    "end": "931680"
  },
  {
    "text": "the file uh that is on some hosts i can also pass in the title i can pass in the jpeg url to get the arts in the actual",
    "start": "931680",
    "end": "939120"
  },
  {
    "text": "sonos application as well and i can even pass a description of the video so this is cool",
    "start": "939120",
    "end": "944720"
  },
  {
    "text": "and it gave me some ideas to try first of all i was searching the internet for that specific protocol the x-ring con",
    "start": "944720",
    "end": "951920"
  },
  {
    "text": "mp3 radio there i found some websites from long ago and apparently sonos supports a",
    "start": "951920",
    "end": "958160"
  },
  {
    "text": "couple of those formats but it kind of treats them all the same way so it was safe",
    "start": "958160",
    "end": "963199"
  },
  {
    "text": "according to that documentation essentially to use this payload so i started replaying that payloads i tried mp3 urls",
    "start": "963199",
    "end": "972320"
  },
  {
    "text": "and i tried mp4 urls and i found that mp3 every time it worked mp4 did not work it",
    "start": "972320",
    "end": "979199"
  },
  {
    "text": "did essentially the same thing that soco library did it popped the speaker it said something and then stopped",
    "start": "979199",
    "end": "985680"
  },
  {
    "text": "playing everything so i the soko library did not have any issues this was kind of research for nothing",
    "start": "985680",
    "end": "992079"
  },
  {
    "text": "which i could have guessed if i would have thought about the fact that there were 65 contributors of that library but",
    "start": "992079",
    "end": "998560"
  },
  {
    "text": "anyway i found out i proved i confirmed that mp4 was not working mp3 was working but mp4 was not",
    "start": "998560",
    "end": "1006880"
  },
  {
    "text": "i also searched around a little bit for that didl lights that you saw in the payloads and it",
    "start": "1006880",
    "end": "1013040"
  },
  {
    "text": "turns out that those speakers use good old upnp universal plug and play there's loads of",
    "start": "1013040",
    "end": "1018160"
  },
  {
    "text": "documentation that you can find about that there's even an xsd schema that you can use fiddled a little bit with some of the",
    "start": "1018160",
    "end": "1024720"
  },
  {
    "text": "things that are in there but i i really could not get the mp4 urls to play so i started thinking maybe it's the mp4",
    "start": "1024720",
    "end": "1032880"
  },
  {
    "text": "formats so i went back to that list of supported audio formats on those speakers",
    "start": "1032880",
    "end": "1038959"
  },
  {
    "text": "and found that mp4s did not have the internet radio stations check mark",
    "start": "1038959",
    "end": "1044558"
  },
  {
    "text": "so could this mean that it could play mp4 from my phone but not from somewhere on the internet",
    "start": "1044559",
    "end": "1052960"
  },
  {
    "text": "then i looked at some other line in there and i saw that aac formats does have support for internet radio",
    "start": "1052960",
    "end": "1059280"
  },
  {
    "text": "stations now aac format is essentially the audio codec that is being used in a lot of mp4",
    "start": "1059280",
    "end": "1065600"
  },
  {
    "text": "videos online so i thought okay maybe if i have that mp4 online",
    "start": "1065600",
    "end": "1070720"
  },
  {
    "text": "i could extract the aac audio stream from within that file and then maybe send that off to the speakers and start",
    "start": "1070720",
    "end": "1076880"
  },
  {
    "text": "playing it could this be an option actually there were a couple of options at this point",
    "start": "1076880",
    "end": "1083120"
  },
  {
    "text": "i could download the entire mp4 push it to the speaker as a local file because it didn't stream from the internet but",
    "start": "1083120",
    "end": "1089679"
  },
  {
    "text": "it did stream as a local file so i could do that i could proxy the mp4 transcode it to",
    "start": "1089679",
    "end": "1095600"
  },
  {
    "text": "mp3 and then send the mp3 url as internet radio to the sonos device but that kind of sounded like something",
    "start": "1095600",
    "end": "1102320"
  },
  {
    "text": "that would work for various short clips if there would be like a one or two minute video that i wanted the audio of",
    "start": "1102320",
    "end": "1108480"
  },
  {
    "text": "this would work reasonably well but imagine i would search for a dj sets that took one hour and a half",
    "start": "1108480",
    "end": "1114320"
  },
  {
    "text": "i would have to download probably 300 megabytes of mp4 transcode it on my phone somewhere and",
    "start": "1114320",
    "end": "1120400"
  },
  {
    "text": "then send it off to the speaker that would take a lot of time and by the time that mp3 would hit my",
    "start": "1120400",
    "end": "1125440"
  },
  {
    "text": "speaker i wouldn't even remember which video i wanted to play so that was not",
    "start": "1125440",
    "end": "1130480"
  },
  {
    "text": "something ideal so i decided okay investigate the mp4 extraction see if there's indeed",
    "start": "1130480",
    "end": "1136559"
  },
  {
    "text": "a scene there and send that url as internet radio from from that file let's talk about",
    "start": "1136559",
    "end": "1144080"
  },
  {
    "text": "containers and not docker containers let's talk about mp4 containers",
    "start": "1144080",
    "end": "1149440"
  },
  {
    "text": "the mp4 formats is something that you will find loads of documentation about but it's essentially container formats",
    "start": "1149440",
    "end": "1156240"
  },
  {
    "text": "that specifies uh how you can put different types of media inside of one file",
    "start": "1156240",
    "end": "1161840"
  },
  {
    "text": "so typically an mp4 file will have a header describing which parts are in there and then we'll",
    "start": "1161840",
    "end": "1167840"
  },
  {
    "text": "have one video may have some audio may have subtitles in there may have subtitles in different languages",
    "start": "1167840",
    "end": "1173600"
  },
  {
    "text": "essentially that is all in there i imagine if youtube would stream a",
    "start": "1173600",
    "end": "1179600"
  },
  {
    "text": "one-hour video stream with audio it would mean that we would have to download the entire mp4 file if you would have one",
    "start": "1179600",
    "end": "1186320"
  },
  {
    "text": "chunk of video and one big chunk of audio at the end so all of those streaming sites optimize",
    "start": "1186320",
    "end": "1191679"
  },
  {
    "text": "the mp4 file and they essentially recode it in a way that there is the header that",
    "start": "1191679",
    "end": "1196720"
  },
  {
    "text": "describes which parts are in there but then have shorter bits of video and audio streams in there",
    "start": "1196720",
    "end": "1201840"
  },
  {
    "text": "so that when you start downloading you can essentially immediately start playing because there's already one megabyte or",
    "start": "1201840",
    "end": "1207360"
  },
  {
    "text": "half a megabyte of video and audio in there so it's it's optimized so what i wanted",
    "start": "1207360",
    "end": "1213520"
  },
  {
    "text": "for this exercise was to get access to that mp4 file read the header see which audio streams were in there",
    "start": "1213520",
    "end": "1220320"
  },
  {
    "text": "and then essentially try and stream that to the to the sonos speaker awesome",
    "start": "1220320",
    "end": "1225919"
  },
  {
    "text": "can i extract this to a separate file turns out yes you can there is tooling called",
    "start": "1225919",
    "end": "1232000"
  },
  {
    "text": "fmpeg an ffmpeg is like a swiss army knife for",
    "start": "1232000",
    "end": "1237120"
  },
  {
    "text": "all audio video and and recording formats it can record it can convert it can stream audio and video",
    "start": "1237120",
    "end": "1244400"
  },
  {
    "text": "if you are using obs studio for example to stream something to youtube or whatever",
    "start": "1244400",
    "end": "1249520"
  },
  {
    "text": "uh there's a good chance that it is using ffmpeg under the hood because essentially everything you may want to",
    "start": "1249520",
    "end": "1255200"
  },
  {
    "text": "do is in there also extracting that aac formats so if you",
    "start": "1255200",
    "end": "1260240"
  },
  {
    "text": "call this ffmpeg with the input of the original mp4 then copy to outputs",
    "start": "1260240",
    "end": "1265600"
  },
  {
    "text": "and extract the audio then you will get the audio track from the mp4 container",
    "start": "1265600",
    "end": "1271200"
  },
  {
    "text": "and what i found is that if i executed this on a video that i downloaded from",
    "start": "1271200",
    "end": "1276720"
  },
  {
    "text": "youtube i could indeed extract the audio i could play it on my computer so",
    "start": "1276720",
    "end": "1281919"
  },
  {
    "text": "awesome i put it on my local web server and then used soco again to send that file to those speakers that i have",
    "start": "1281919",
    "end": "1288559"
  },
  {
    "text": "expected result was audio playing the actual result was no audio playing",
    "start": "1288559",
    "end": "1295280"
  },
  {
    "text": "not even that pop just nothing happened nothing would happen this was the time where i really really",
    "start": "1295280",
    "end": "1301039"
  },
  {
    "text": "really got frustrated um but it was also a time where i felt like i'm this deep in the rabbit hole now this",
    "start": "1301039",
    "end": "1307919"
  },
  {
    "text": "should work there are applications that work so let's google and start looking at at",
    "start": "1307919",
    "end": "1314080"
  },
  {
    "text": "results page 25 or 26 and so on and indeed somewhere along those lines",
    "start": "1314080",
    "end": "1319360"
  },
  {
    "text": "somewhere far down the long tail of search results i found some page that was interesting",
    "start": "1319360",
    "end": "1326000"
  },
  {
    "text": "i found a person who goes by the name deadfoot online and he wrote a blog post about how he",
    "start": "1326000",
    "end": "1332240"
  },
  {
    "text": "hacked sonos and youtube in the same day that sounded vaguely familiar to what i was trying to achieve",
    "start": "1332240",
    "end": "1338480"
  },
  {
    "text": "so i started reading and it turns out that he published it essentially as the idea with the",
    "start": "1338480",
    "end": "1343679"
  },
  {
    "text": "research he has done and turns out his uh his story his entire timeline in investigating",
    "start": "1343679",
    "end": "1350320"
  },
  {
    "text": "this was so far very similar to what i have been doing so i tried finding that person on twitter",
    "start": "1350320",
    "end": "1357520"
  },
  {
    "text": "sent him a dm and asked if we could work together on this",
    "start": "1357520",
    "end": "1362640"
  },
  {
    "text": "if he had information that i hadn't thought of or i had the information that he didn't thought of",
    "start": "1362640",
    "end": "1367679"
  },
  {
    "text": "and at some point in the discussion he mentions it's aac but it's not in a traditional",
    "start": "1367679",
    "end": "1373600"
  },
  {
    "text": "ac format it's in the adts formats each atom needs a header in every frame",
    "start": "1373600",
    "end": "1380960"
  },
  {
    "text": "each atom needs a header in every frame like what the hell is this person talking about",
    "start": "1380960",
    "end": "1386640"
  },
  {
    "text": "still i decided okay that's a good tip as good as anything let's google again and let's see if we can find something",
    "start": "1386640",
    "end": "1392400"
  },
  {
    "text": "about this and see if we can uh can actually work with it first of all turns out that ffmpeg allows you to extract the audio",
    "start": "1392400",
    "end": "1399520"
  },
  {
    "text": "track from an mp4 container with adts headers turns out adts",
    "start": "1399520",
    "end": "1404799"
  },
  {
    "text": "is essentially aac but with different headers so ffmpeg can add that",
    "start": "1404799",
    "end": "1410480"
  },
  {
    "text": "so i extracted it using ffmpeg then use that soco library again to send",
    "start": "1410480",
    "end": "1416000"
  },
  {
    "text": "that file to speakers will essentially send the url to my extracted adts audio to those speakers",
    "start": "1416000",
    "end": "1422240"
  },
  {
    "text": "expected result was i would see audio or hear audio and the actual result was i had audio",
    "start": "1422240",
    "end": "1428720"
  },
  {
    "text": "yes happy cats next thing that i would have to do was then think about",
    "start": "1428720",
    "end": "1434480"
  },
  {
    "text": "making an app because i of course did not want to run ffmpeg extract everything on my pc and",
    "start": "1434480",
    "end": "1441039"
  },
  {
    "text": "then send it off to my speakers using a python library that would never work so i wanted to",
    "start": "1441039",
    "end": "1446799"
  },
  {
    "text": "make it an application to start building an application i would have to be able to connect to speakers",
    "start": "1446799",
    "end": "1453200"
  },
  {
    "text": "get the mp4 url extract the adts audio formats that was a new step there",
    "start": "1453200",
    "end": "1458240"
  },
  {
    "text": "then send that url to speakers sounds like something that an app might be able to do right so i started",
    "start": "1458240",
    "end": "1464320"
  },
  {
    "text": "thinking about the architecture of the application what it should look like and what it should be doing",
    "start": "1464320",
    "end": "1470799"
  },
  {
    "text": "so um essentially what i wanted is that you could open up the youtube app on your phone",
    "start": "1470799",
    "end": "1477600"
  },
  {
    "text": "click the share button or tap the share button and then send off the url to my application to the main methods in an",
    "start": "1477600",
    "end": "1484240"
  },
  {
    "text": "application and get that there it would then discover all of the speakers that are available",
    "start": "1484240",
    "end": "1489760"
  },
  {
    "text": "i would select the speaker it would then call into youtube get the metadata so i could get back the",
    "start": "1489760",
    "end": "1496400"
  },
  {
    "text": "mp3 mp4 audio url i would then run something that would extract the adts",
    "start": "1496400",
    "end": "1503440"
  },
  {
    "text": "audio i wasn't yet sure what that would be but it seemed like a good idea because it's a header format that is",
    "start": "1503440",
    "end": "1509679"
  },
  {
    "text": "changing so i could stream the data through and essentially write a reverse proxy in the application",
    "start": "1509679",
    "end": "1514799"
  },
  {
    "text": "that i could send the url to the sonos speaker this would give me a good way of streaming everything",
    "start": "1514799",
    "end": "1522080"
  },
  {
    "text": "okay i had a rough architecture in mind so next up were technology choices",
    "start": "1522080",
    "end": "1528159"
  },
  {
    "text": "should i write this as a native application i heard there's this thing called xamarin there's this thing called",
    "start": "1528159",
    "end": "1533600"
  },
  {
    "text": "flutter some people are talking about jetpack compost i had no idea i'm a web developer at heart i have no",
    "start": "1533600",
    "end": "1539679"
  },
  {
    "text": "idea about mobile so i was kind of lost and i thought okay let's go with what i know",
    "start": "1539679",
    "end": "1546240"
  },
  {
    "text": "i have an android phone i know intellij and ryder and they're all the same id",
    "start": "1546240",
    "end": "1551440"
  },
  {
    "text": "essentially as android studio so i thought okay instead of having to learn a new ide let's just",
    "start": "1551440",
    "end": "1556799"
  },
  {
    "text": "install android studio so i don't have to learn that at least and start building a native app for my android device i installed it",
    "start": "1556799",
    "end": "1564799"
  },
  {
    "text": "i installed a ton of sdks and lots of other things really i have no idea how",
    "start": "1564799",
    "end": "1569840"
  },
  {
    "text": "mobile developers do it there's so many dependencies but after installing everything at some point i could run",
    "start": "1569840",
    "end": "1576799"
  },
  {
    "text": "android studio i could do a file new projects and i saw a template now this is",
    "start": "1576799",
    "end": "1583760"
  },
  {
    "text": "confusing where do you start if you have no idea about building mobile applications do you start with no activity a basic activity activity",
    "start": "1583760",
    "end": "1592480"
  },
  {
    "text": "definitely not a map because i would not need a map in there but what do i use to start with so i i think",
    "start": "1592480",
    "end": "1598159"
  },
  {
    "text": "i picked basic or something empty something very very simple because i thought okay maybe adding",
    "start": "1598159",
    "end": "1603840"
  },
  {
    "text": "things is going to be easier than removing things next page gave me a choice between",
    "start": "1603840",
    "end": "1610240"
  },
  {
    "text": "languages again i had no idea i did some java back in school i",
    "start": "1610240",
    "end": "1616240"
  },
  {
    "text": "yeah i can't say i'm not a big fan of java there's kotlin as well i know kotlin",
    "start": "1616240",
    "end": "1621440"
  },
  {
    "text": "because i work at jetbrains and we built that language it's very much or very similar like c-sharp and i",
    "start": "1621440",
    "end": "1627679"
  },
  {
    "text": "thought okay kotlin is maybe nicer to go with it's also fully compatible with java which means that i could write the",
    "start": "1627679",
    "end": "1634159"
  },
  {
    "text": "application in kotlin but still consume third-party dependencies that were written in java so i went with kotlin",
    "start": "1634159",
    "end": "1640080"
  },
  {
    "text": "went with some very basic application and after i finished this wizard i got this application",
    "start": "1640080",
    "end": "1646480"
  },
  {
    "text": "now what where do you start i again i had no idea about mobile applications so i decided let's procrastinate and",
    "start": "1646480",
    "end": "1654559"
  },
  {
    "text": "start with the most important thing namely the ui",
    "start": "1654559",
    "end": "1659600"
  },
  {
    "text": "which looked a little bit like winforms back in the days but still i'm not i'm not a ui designer",
    "start": "1659600",
    "end": "1665520"
  },
  {
    "text": "so i thought okay let's keep everything very simple and build this thing using just a label in the center",
    "start": "1665520",
    "end": "1671520"
  },
  {
    "text": "where i can post some status messages and then show everything in the application uh",
    "start": "1671520",
    "end": "1676559"
  },
  {
    "text": "yeah and then start using it so i did that's edit that label and this is essentially the final ui",
    "start": "1676559",
    "end": "1682159"
  },
  {
    "text": "design of my application next up was more research i started",
    "start": "1682159",
    "end": "1688320"
  },
  {
    "text": "researching android specific things like the activities what does that mean screen do",
    "start": "1688320",
    "end": "1693679"
  },
  {
    "text": "how could i receive that share url from my youtube application and start",
    "start": "1693679",
    "end": "1698799"
  },
  {
    "text": "working with that so i looked into activities which is essentially the screens and different activities that you can",
    "start": "1698799",
    "end": "1704640"
  },
  {
    "text": "have on your on your phone and intents which are for example the sharing intents to receive data from",
    "start": "1704640",
    "end": "1711039"
  },
  {
    "text": "other applications read the documentation on that it seemed doable so okay fine next thing i did was start",
    "start": "1711039",
    "end": "1718720"
  },
  {
    "text": "searching for libraries or codes that could do all of the major steps that i started thinking of i found something",
    "start": "1718720",
    "end": "1725600"
  },
  {
    "text": "that could extract youtube metadata including those science urls i found a",
    "start": "1725600",
    "end": "1730799"
  },
  {
    "text": "library that could communicate with those sonos speakers over the network and send the url to the speakers change",
    "start": "1730799",
    "end": "1737200"
  },
  {
    "text": "the volume things like that so goods i also found a library that could run a web server which i could then use as a",
    "start": "1737200",
    "end": "1743679"
  },
  {
    "text": "reverse proxy and then the only thing that i needed was something to do the mp42 ac",
    "start": "1743679",
    "end": "1750320"
  },
  {
    "text": "or adts conversion i found a couple of things that could work but it looked like this would need some",
    "start": "1750320",
    "end": "1756240"
  },
  {
    "text": "experimentation but still i started with the application itself because i knew this was going to work at some point so",
    "start": "1756240",
    "end": "1762960"
  },
  {
    "text": "i started building the application itself in androids every application starts with a",
    "start": "1762960",
    "end": "1768720"
  },
  {
    "text": "manifest where you have your main activity and other screens defined and in that main activity i had to add",
    "start": "1768720",
    "end": "1775760"
  },
  {
    "text": "an intent filter where i said okay when someone tries to send data to me check if the scheme of the",
    "start": "1775760",
    "end": "1782320"
  },
  {
    "text": "data is https if the host is something that youtube would do and if the mime type is texts doing that i was able to get",
    "start": "1782320",
    "end": "1790320"
  },
  {
    "text": "back the intents get back the url from the youtube app after i clicked on share and i found",
    "start": "1790320",
    "end": "1796960"
  },
  {
    "text": "that in my main activity i could essentially just use the intense property look at the extras get a string",
    "start": "1796960",
    "end": "1804240"
  },
  {
    "text": "and get the extra text of that to get the url from youtube awesome this worked and i was",
    "start": "1804240",
    "end": "1810240"
  },
  {
    "text": "essentially happy as can be after i i deployed an application onto my phone",
    "start": "1810240",
    "end": "1815919"
  },
  {
    "text": "that i could share from youtube onto the application that i just wrote and just show the url in that label in the",
    "start": "1815919",
    "end": "1822480"
  },
  {
    "text": "center this was awesome this was gonna work i felt it um there's maybe one more thing that i",
    "start": "1822480",
    "end": "1828000"
  },
  {
    "text": "want to highlight here that's this co-routine scope if you're a c-sharp developer you will know about async",
    "start": "1828000",
    "end": "1834240"
  },
  {
    "text": "awaits the fact that you can have tasks and wait for things to continue without blocking the main threat and things like",
    "start": "1834240",
    "end": "1839679"
  },
  {
    "text": "that in kotlin you have call routines which is somewhat similar",
    "start": "1839679",
    "end": "1844960"
  },
  {
    "text": "and if you want to use that mechanism you have to derive or implement the co-routine scope",
    "start": "1844960",
    "end": "1850320"
  },
  {
    "text": "so that's why that thing is there if you're an android developer and i've never seen this this is why the code in",
    "start": "1850320",
    "end": "1855440"
  },
  {
    "text": "scope is there right um i built the app and then started adding",
    "start": "1855440",
    "end": "1860880"
  },
  {
    "text": "packages there's a nice plugin for android studio that is essentially like nougat in",
    "start": "1860880",
    "end": "1865919"
  },
  {
    "text": "c-sharp where you can search for libraries so i installed something to extract um yeah the url",
    "start": "1865919",
    "end": "1872799"
  },
  {
    "text": "from youtube i installed ktor as a web server i found a library called mp4 parser in",
    "start": "1872799",
    "end": "1878399"
  },
  {
    "text": "star install testing as well to essentially be able to look into the format that youtube was sending me and",
    "start": "1878399",
    "end": "1884720"
  },
  {
    "text": "and work with that now next i started implementing the next step in the",
    "start": "1884720",
    "end": "1890080"
  },
  {
    "text": "application where i wanted to figure out which speakers were available on the network there was a library doing",
    "start": "1890080",
    "end": "1896720"
  },
  {
    "text": "it this but the library didn't really work i found out looking through the source",
    "start": "1896720",
    "end": "1903279"
  },
  {
    "text": "code of the library that it was using ssdp the simple device discovery protocol",
    "start": "1903279",
    "end": "1909279"
  },
  {
    "text": "the thing that windows and mac and everyone uses to discover printers routers speakers things like",
    "start": "1909279",
    "end": "1914960"
  },
  {
    "text": "that essentially what this protocol does is it sends a udp packets",
    "start": "1914960",
    "end": "1920640"
  },
  {
    "text": "as a multicast packet on the network to this host called",
    "start": "1920640",
    "end": "1925919"
  },
  {
    "text": "239.255.255.250 which is a broadcast address or a multicast address that devices can listen to you send a",
    "start": "1926840",
    "end": "1934720"
  },
  {
    "text": "discover command and we can say that we want to discover everything that is a zone player",
    "start": "1934720",
    "end": "1941200"
  },
  {
    "text": "what that is is again in that upnp documentation but sending this datagram on the network",
    "start": "1941200",
    "end": "1947039"
  },
  {
    "text": "should get back responses from the speakers turns out that the library it was a bit",
    "start": "1947039",
    "end": "1952399"
  },
  {
    "text": "of an older one was sending multicast packets sonos has done an upgrade where",
    "start": "1952399",
    "end": "1958320"
  },
  {
    "text": "they expect broadcast packets so essentially what i had to do was change the ip address in this",
    "start": "1958320",
    "end": "1963519"
  },
  {
    "text": "udp datagram and send it to the network broadcast two five five two five five two five five two five five",
    "start": "1963519",
    "end": "1970000"
  },
  {
    "text": "uh instead of this one and then i would get back the hdp response from from every speaker in the network i",
    "start": "1970000",
    "end": "1976720"
  },
  {
    "text": "would get back the services they uh they they offered i would get back their server url where i could send the",
    "start": "1976720",
    "end": "1982799"
  },
  {
    "text": "data so that was kind of nice um if you want to dive into the source code it's on",
    "start": "1982799",
    "end": "1987919"
  },
  {
    "text": "github but essentially this library that i wanted to use to discover speakers was working by making a very very small",
    "start": "1987919",
    "end": "1994720"
  },
  {
    "text": "change next thing i looked at was how can i run a web server on my android device",
    "start": "1994720",
    "end": "2001360"
  },
  {
    "text": "because if you start a web server from the main screen that you have on there what will happen is if you swipe it away",
    "start": "2001360",
    "end": "2007840"
  },
  {
    "text": "or your device goes to sleep or whatever the application will stop which means that the web server stops",
    "start": "2007840",
    "end": "2013279"
  },
  {
    "text": "which means that my stream will stop and my audio will stop working as well so i needed to figure out a way to run a",
    "start": "2013279",
    "end": "2019440"
  },
  {
    "text": "web server on the android device and i must say android has really good documentation on",
    "start": "2019440",
    "end": "2024720"
  },
  {
    "text": "how you can do some some things in there i found that i could run a front-end service which is essentially",
    "start": "2024720",
    "end": "2032240"
  },
  {
    "text": "a part of my application that could keep running until the user which would be me in the end uh closes",
    "start": "2032240",
    "end": "2038159"
  },
  {
    "text": "that service so what you will have to do is in that android manifest add this thing and say i have a service",
    "start": "2038159",
    "end": "2044880"
  },
  {
    "text": "which is called run embedded web server service in there i could write a class my class",
    "start": "2044880",
    "end": "2051040"
  },
  {
    "text": "could host that embedded server and start and stop based on the commands that i would",
    "start": "2051040",
    "end": "2056320"
  },
  {
    "text": "receive from the android operating system so apart from the implementation of that get methods that you see on the slide",
    "start": "2056320",
    "end": "2062720"
  },
  {
    "text": "here this seems very straightforward write that service start an actual web server there",
    "start": "2062720",
    "end": "2068960"
  },
  {
    "text": "and then register it in the android manifests one of the next steps that i had to look",
    "start": "2068960",
    "end": "2075040"
  },
  {
    "text": "into was create an mp4 or convert that mp4 to the adts",
    "start": "2075040",
    "end": "2080320"
  },
  {
    "text": "formats so i started looking into that and searching for different packages that are available",
    "start": "2080320",
    "end": "2086240"
  },
  {
    "text": "and i found that ffmpeg is actually wrapped like there there's tons of copies of fm",
    "start": "2086240",
    "end": "2092079"
  },
  {
    "text": "ffmpeg that are wrapped as java packages that you can use uh so essentially i could install one of those",
    "start": "2092079",
    "end": "2098720"
  },
  {
    "text": "into my application on my device do some transcoding essentially run that",
    "start": "2098720",
    "end": "2104000"
  },
  {
    "text": "command that i ran on my pc previously and then convert that entire stream into",
    "start": "2104000",
    "end": "2109040"
  },
  {
    "text": "adts the downside of doing this using ffmpeg is that i have to download the entire",
    "start": "2109040",
    "end": "2115839"
  },
  {
    "text": "mp4 to my device to temporary storage run ffmpeg to convert everything and",
    "start": "2115839",
    "end": "2121040"
  },
  {
    "text": "then keep the converted file on the device until my stream has finished streaming first of all for short videos that is",
    "start": "2121040",
    "end": "2128160"
  },
  {
    "text": "definitely gonna work but for longer videos that i wanted the audio from that's not going to work because it",
    "start": "2128160",
    "end": "2134320"
  },
  {
    "text": "would have to first download a lot of data which may be slow it would then have to do a conversion",
    "start": "2134320",
    "end": "2139440"
  },
  {
    "text": "which would be slow and then send everything to the speaker which would be slow it all would also mess up the storage on",
    "start": "2139440",
    "end": "2146079"
  },
  {
    "text": "my device because it would download the mp4 stored maybe 250 megabytes of mp4 data",
    "start": "2146079",
    "end": "2152720"
  },
  {
    "text": "on there plus the adts stream on there which would not be ideal so i thought okay can",
    "start": "2152720",
    "end": "2158960"
  },
  {
    "text": "i come up with something where i have zero to virtually zero delay",
    "start": "2158960",
    "end": "2164240"
  },
  {
    "text": "between sharing the link from my app and having everything play on the stream and ffmpeg",
    "start": "2164240",
    "end": "2169440"
  },
  {
    "text": "felt like it was not going to achieve that at least on the phone it could on command line but on the phone",
    "start": "2169440",
    "end": "2175920"
  },
  {
    "text": "in one of those libraries it would not work so i started researching mp4 and the adts format some more",
    "start": "2175920",
    "end": "2183680"
  },
  {
    "text": "and where mp4 is a container format that has headers and it has different types of data in there adts",
    "start": "2183680",
    "end": "2191680"
  },
  {
    "text": "itself is a very similar format in mp4 and adts essentially what you will find is",
    "start": "2191680",
    "end": "2197359"
  },
  {
    "text": "atoms which are parts of data the things that you see in the tree on the left here and those",
    "start": "2197359",
    "end": "2203599"
  },
  {
    "text": "atoms would then be stored in boxes and would contain metadata about which data is available",
    "start": "2203599",
    "end": "2210079"
  },
  {
    "text": "and so on um my good friends that food by then has a very interesting blog post about how",
    "start": "2210079",
    "end": "2216720"
  },
  {
    "text": "this works but i think it would lead us too far so i made a simplification of this and essentially",
    "start": "2216720",
    "end": "2222800"
  },
  {
    "text": "if you have an mp4 with the aac formats what you will get is a move box",
    "start": "2222800",
    "end": "2228800"
  },
  {
    "text": "here's some data and that would be the header that says okay there are going to be",
    "start": "2228800",
    "end": "2234079"
  },
  {
    "text": "25 audio samples coming your way 128 kilobits per seconds and 2 channel audio",
    "start": "2234079",
    "end": "2240480"
  },
  {
    "text": "and then there would be a data block that has the raw binary data for those 25 samples",
    "start": "2240480",
    "end": "2246640"
  },
  {
    "text": "next packets or next item industry would again be one of those headers that says hey there are more samples coming",
    "start": "2246640",
    "end": "2252720"
  },
  {
    "text": "this is going to be the format and then again the raw data in adts the header and the data is kind",
    "start": "2252720",
    "end": "2259359"
  },
  {
    "text": "of combined so instead of sending a header for 25 samples and then the data for 25 samples",
    "start": "2259359",
    "end": "2265680"
  },
  {
    "text": "what adts would do is have a header saying there's 40 bytes coming in this is one",
    "start": "2265680",
    "end": "2271040"
  },
  {
    "text": "sample two channel audio and then just stream those 40 bytes of data for that one sample",
    "start": "2271040",
    "end": "2276720"
  },
  {
    "text": "then another header which uh again a specification of the sample that would be coming",
    "start": "2276720",
    "end": "2282079"
  },
  {
    "text": "the type of audio that i could extract from it and used to decode everything and then get",
    "start": "2282079",
    "end": "2287760"
  },
  {
    "text": "that going so it's essentially repackaging everything all the data is in the mp4 with aac but",
    "start": "2287760",
    "end": "2293359"
  },
  {
    "text": "for adts i would essentially have to combine that's header block and a data",
    "start": "2293359",
    "end": "2298480"
  },
  {
    "text": "block extract the samples and then stream all of them one by one so i started looking into that there's a",
    "start": "2298480",
    "end": "2304880"
  },
  {
    "text": "library called mp4 parser that allows you to for reach over all of",
    "start": "2304880",
    "end": "2310000"
  },
  {
    "text": "the data that is in your mp4 so i did that and i found that there was a block that contained samples so everything",
    "start": "2310000",
    "end": "2317119"
  },
  {
    "text": "that i had to do was convert every sample header into an adts header there's a couple of websites online that",
    "start": "2317119",
    "end": "2323599"
  },
  {
    "text": "describe the adts header format and after doing some byte shifting lots",
    "start": "2323599",
    "end": "2328640"
  },
  {
    "text": "of trial and error i was able to write some codes that would convert",
    "start": "2328640",
    "end": "2333680"
  },
  {
    "text": "yeah essentially write out a correct adts header there",
    "start": "2333680",
    "end": "2338960"
  },
  {
    "text": "it's not super rocket science but i must say it's quite the rabbit hole to dive into it and figure out how it all works",
    "start": "2338960",
    "end": "2346079"
  },
  {
    "text": "um with that let's maybe explore a little bit of the code so you can actually see what is in there",
    "start": "2346079",
    "end": "2352839"
  },
  {
    "text": "so i mentioned that everything starts with the android manifest and me not being an android developer",
    "start": "2352839",
    "end": "2359359"
  },
  {
    "text": "found out that i could add my main activity in there and i could have that intent",
    "start": "2359359",
    "end": "2365200"
  },
  {
    "text": "action where i would subscribe to youtube data that is being passed into my application but i did not know about permissions",
    "start": "2365200",
    "end": "2371920"
  },
  {
    "text": "that would be required so the permissions they're all documented but i did not",
    "start": "2371920",
    "end": "2377200"
  },
  {
    "text": "know whether i would have to access the wi-fi state or have a wake lock or whatever permission",
    "start": "2377200",
    "end": "2382800"
  },
  {
    "text": "so essentially this section has been discovered by trial and error just launching the application",
    "start": "2382800",
    "end": "2388400"
  },
  {
    "text": "trying it out and then seeing if if something would work or not work because i did not",
    "start": "2388400",
    "end": "2393680"
  },
  {
    "text": "have the permission so a bunch of permissions required essentially having internet access so i",
    "start": "2393680",
    "end": "2399520"
  },
  {
    "text": "could get my mp4 url access to the wi-fi so i could stream to my speaker on my local wi-fi",
    "start": "2399520",
    "end": "2406079"
  },
  {
    "text": "right to storage and read from starch i don't think i actually need it but i kept it in any way and the ability to be able to run a",
    "start": "2406079",
    "end": "2413040"
  },
  {
    "text": "foreground service let's look at the main activity the main activity",
    "start": "2413040",
    "end": "2419200"
  },
  {
    "text": "what it has is that co-routine scope and it has an oncreate oncreate is",
    "start": "2419200",
    "end": "2426720"
  },
  {
    "text": "essentially what gets called when my uh my application starts and in the",
    "start": "2426720",
    "end": "2432079"
  },
  {
    "text": "oncreate what i would do is set my activity status to open the youtube app and share a video to youtube",
    "start": "2432079",
    "end": "2437920"
  },
  {
    "text": "to sonos this is my application name and this was essentially update the label in the",
    "start": "2437920",
    "end": "2443839"
  },
  {
    "text": "center of my my ui i would then also check for an intent whether i should start or stop",
    "start": "2443839",
    "end": "2449920"
  },
  {
    "text": "the web server more on that in a little bit and if i get an intent that has a youtube",
    "start": "2449920",
    "end": "2456880"
  },
  {
    "text": "video url i should start sharing it to my sonos device so what i did is check if my video was",
    "start": "2456880",
    "end": "2464319"
  },
  {
    "text": "youtube if yes i would launch a co-routine essentially await some codes",
    "start": "2464319",
    "end": "2470000"
  },
  {
    "text": "where i say first of all discover sonos devices the device discovery is going to be my",
    "start": "2470000",
    "end": "2475680"
  },
  {
    "text": "ssdp client simple service or simple device protocol something like that",
    "start": "2475680",
    "end": "2481599"
  },
  {
    "text": "and discover everything on the network i decided to keep the methods that did a multicast packets to get all of the",
    "start": "2481599",
    "end": "2489200"
  },
  {
    "text": "players on my device but then i also did a discover with broadcasts there's a timeout of two thousand two",
    "start": "2489200",
    "end": "2495760"
  },
  {
    "text": "thousand milliseconds so when i demo the application you will see that discovering the speakers takes",
    "start": "2495760",
    "end": "2501200"
  },
  {
    "text": "four to five seconds that is because i'm really waiting for two seconds for data to arrive in this case discover with",
    "start": "2501200",
    "end": "2508560"
  },
  {
    "text": "broadcast what it does is again it sends data to the broadcast address",
    "start": "2508560",
    "end": "2513839"
  },
  {
    "text": "since a packet like i dis described in slides the code really doesn't matter it will wait for",
    "start": "2513839",
    "end": "2520000"
  },
  {
    "text": "responses for two seconds and then essentially parse every speaker that is available on the network",
    "start": "2520000",
    "end": "2526800"
  },
  {
    "text": "once i have those let's go back once i have those i will start my web server because i",
    "start": "2527200",
    "end": "2533440"
  },
  {
    "text": "have a device so probably i'm going to share this data to a speaker so start a web server build",
    "start": "2533440",
    "end": "2540000"
  },
  {
    "text": "zone names from my devices because all of the devices give back metadata they tell you which room they are in what",
    "start": "2540000",
    "end": "2545920"
  },
  {
    "text": "their ip address is and so on so i kind of make it nice so that i have something to play",
    "start": "2545920",
    "end": "2551359"
  },
  {
    "text": "and then i will show an alert in my application asking the user which device i want to share my data to",
    "start": "2551359",
    "end": "2558160"
  },
  {
    "text": "we select the device and when we select one we will finish",
    "start": "2558160",
    "end": "2565838"
  },
  {
    "text": "finish is essentially telling androids that the application is done we have everything we need now what will happen",
    "start": "2566000",
    "end": "2572480"
  },
  {
    "text": "is if i click one device i will try and set up streaming for the youtube video url",
    "start": "2572480",
    "end": "2579200"
  },
  {
    "text": "that i have and my selected device what this is going to do is launch another co-routine",
    "start": "2579200",
    "end": "2585520"
  },
  {
    "text": "that gets the actual youtube metadata so that i have the metadata whereas the mp4 url and things like that",
    "start": "2585520",
    "end": "2591760"
  },
  {
    "text": "but what i also do is use that data to construct the media title and the media",
    "start": "2591760",
    "end": "2597920"
  },
  {
    "text": "art url because i want to have now that i'm in the rabbit hole i want to play the audio but i also want to see",
    "start": "2597920",
    "end": "2603599"
  },
  {
    "text": "what i'm playing and i want some media art in my application as well we're down the rabbit hole anyway so",
    "start": "2603599",
    "end": "2609040"
  },
  {
    "text": "let's uh let's get that from youtube as well next thing i do is play",
    "start": "2609040",
    "end": "2614880"
  },
  {
    "text": "on my device and i send it the metadata you will see part of that soap message in there i",
    "start": "2614880",
    "end": "2620480"
  },
  {
    "text": "send it to metadata that is essentially telling the player to display a title",
    "start": "2620480",
    "end": "2626000"
  },
  {
    "text": "in the application that is using it and broadcast audio",
    "start": "2626000",
    "end": "2631040"
  },
  {
    "text": "with a given url everything is in there a soap packets that sends everything to",
    "start": "2631040",
    "end": "2636079"
  },
  {
    "text": "the device next thing that will happen is that because i started my web server",
    "start": "2636079",
    "end": "2641599"
  },
  {
    "text": "and my device gets display url message where i give it the ip address of my",
    "start": "2641599",
    "end": "2646960"
  },
  {
    "text": "current device my speaker will connect to the application's web server",
    "start": "2646960",
    "end": "2653440"
  },
  {
    "text": "the actual web server is in this run embedded web server service and it can start and stop so let's",
    "start": "2653440",
    "end": "2660720"
  },
  {
    "text": "scroll there first um it will essentially start when needed",
    "start": "2660720",
    "end": "2666000"
  },
  {
    "text": "and stop when no longer needed it will also show a notification on screen so that when the web server is running",
    "start": "2666000",
    "end": "2672000"
  },
  {
    "text": "the user can actually see that the application is doing something there it will do all that start the web server",
    "start": "2672000",
    "end": "2677920"
  },
  {
    "text": "and then essentially wait for a request to come in from my speaker that request is going to be a get",
    "start": "2677920",
    "end": "2683520"
  },
  {
    "text": "request for the video id dot mp4 i decided to use the video id",
    "start": "2683520",
    "end": "2689119"
  },
  {
    "text": "there and not something like file.mp4 or whatever because the time between me sending the url to the device and the",
    "start": "2689119",
    "end": "2696480"
  },
  {
    "text": "device connecting to my server maybe a couple of seconds and if by that time i'm playing one of those signed",
    "start": "2696480",
    "end": "2702800"
  },
  {
    "text": "urls from from youtube i would have to re-figure out what the cipher is there",
    "start": "2702800",
    "end": "2708319"
  },
  {
    "text": "so i decided to parse the video id again extracted metadata again in this web",
    "start": "2708319",
    "end": "2714000"
  },
  {
    "text": "server so i would have the actual url to a url that would work look at my metadata figure out streams",
    "start": "2714000",
    "end": "2720880"
  },
  {
    "text": "that are an audio stream and if i have one of those i will respond to my audio stream in the",
    "start": "2720880",
    "end": "2727920"
  },
  {
    "text": "ac formats run an mp4 to adts ac converter",
    "start": "2727920",
    "end": "2734000"
  },
  {
    "text": "and just stream everything to the end user so the server itself looks quite uh simple as well",
    "start": "2734000",
    "end": "2739760"
  },
  {
    "text": "essentially parsing some metadata sending everything off to the device again",
    "start": "2739760",
    "end": "2745040"
  },
  {
    "text": "this thing is where the magic happens my mp4 converter what it takes is the input",
    "start": "2745040",
    "end": "2750800"
  },
  {
    "text": "stream from youtube then uses that mp4 parser library to",
    "start": "2750800",
    "end": "2756319"
  },
  {
    "text": "parse all of the boxes in that mp4 formats",
    "start": "2756319",
    "end": "2761520"
  },
  {
    "text": "figure out where the first move block is in there because that's after this the the header start and the",
    "start": "2761520",
    "end": "2767200"
  },
  {
    "text": "actual data starts and once we have that we will start for reaching over every single track",
    "start": "2767200",
    "end": "2772960"
  },
  {
    "text": "that is in the mp4 formats and then writes everything to the outputs so lots of",
    "start": "2772960",
    "end": "2779520"
  },
  {
    "text": "boilerplate codes or lots of figuring out on how to get that this by the way i didn't really write this",
    "start": "2779520",
    "end": "2785200"
  },
  {
    "text": "myself i found bits and pieces on the internet and like we all do we copy from stack overflow and random websites",
    "start": "2785200",
    "end": "2791680"
  },
  {
    "text": "so maybe this is even rooting my device i have no idea i didn't really look at a lot of the other things one thing that",
    "start": "2791680",
    "end": "2798800"
  },
  {
    "text": "i did have to write though was that adts header writer to transcode or to replace the header",
    "start": "2798800",
    "end": "2804960"
  },
  {
    "text": "that i had in there so i looked at a page on github that had the entire format described of what that",
    "start": "2804960",
    "end": "2811760"
  },
  {
    "text": "adts header should look like and essentially what i'm doing is for every frame that i write to the output",
    "start": "2811760",
    "end": "2817599"
  },
  {
    "text": "for every sample that i write i um read the data of that sample",
    "start": "2817599",
    "end": "2825119"
  },
  {
    "text": "and then write the adts frame header and what that's going to do is do some bite shifting with my original sample get the sample rate get",
    "start": "2825119",
    "end": "2832640"
  },
  {
    "text": "the number of channels that should be streamed things like that and then essentially write that out as",
    "start": "2832640",
    "end": "2838000"
  },
  {
    "text": "an adts header so it looks a little bit like rocket science it kind of is but",
    "start": "2838000",
    "end": "2843599"
  },
  {
    "text": "a lot of this is just bits and pieces that that i found in combined from the internet",
    "start": "2843599",
    "end": "2849119"
  },
  {
    "text": "so uh with that there's a couple of other things in there as well but this is essentially the flow of the",
    "start": "2849119",
    "end": "2854480"
  },
  {
    "text": "application and how it should be working so now comes the moment everyone has",
    "start": "2854480",
    "end": "2860880"
  },
  {
    "text": "been waiting for does the application actually work i recorded a video with some",
    "start": "2860880",
    "end": "2866800"
  },
  {
    "text": "copyright free music so this video doesn't get deleted from youtube once the ndc folks put it up",
    "start": "2866800",
    "end": "2872720"
  },
  {
    "text": "there and let's have a look at it so i have the device you can see my player",
    "start": "2872720",
    "end": "2879119"
  },
  {
    "text": "there and what i will start doing is just use the app share in youtube i will",
    "start": "2879119",
    "end": "2886319"
  },
  {
    "text": "share to my youtube to sonos application which will start you see my nice ui in there",
    "start": "2886319",
    "end": "2892400"
  },
  {
    "text": "it will take a couple of seconds to discover the devices on the network it will show me my home office and the living room starts",
    "start": "2892400",
    "end": "2899520"
  },
  {
    "text": "stream and if all goes well there is now audio on that speaker",
    "start": "2899520",
    "end": "2905760"
  },
  {
    "text": "in the sonos app because we sent that artwork and title as well you can now also see what you are",
    "start": "2905760",
    "end": "2911520"
  },
  {
    "text": "playing from youtube so yes everything works awesome",
    "start": "2911520",
    "end": "2917200"
  },
  {
    "text": "in summary this this was quite a nerd snap i must say but i am now able to enjoy music with my",
    "start": "2917200",
    "end": "2924160"
  },
  {
    "text": "application i can connect to speakers get the mp4 url extract the mp4 audio",
    "start": "2924160",
    "end": "2929200"
  },
  {
    "text": "track send it off to my speaker and start playing whatever is in there and everything works awesome",
    "start": "2929200",
    "end": "2935440"
  },
  {
    "text": "another question that you may have is do you actually use the application very often",
    "start": "2935440",
    "end": "2940559"
  },
  {
    "text": "i must say i used it back when i was building it i used it to record the demo that you just saw but uh ever",
    "start": "2940559",
    "end": "2947280"
  },
  {
    "text": "since i haven't really been using it because i have other sources that are uh in the legal sphere and and just work",
    "start": "2947280",
    "end": "2954000"
  },
  {
    "text": "as well so i actually don't need youtube but still i wanted to share this story",
    "start": "2954000",
    "end": "2959040"
  },
  {
    "text": "because in summary there's a lot of random things that you can learn along the way from just",
    "start": "2959040",
    "end": "2964160"
  },
  {
    "text": "playing with technology figuring out things as you go there is a lot of knowledge out there on",
    "start": "2964160",
    "end": "2970240"
  },
  {
    "text": "existing websites on page 26 of the search results on google and there's a lot of people who are",
    "start": "2970240",
    "end": "2976319"
  },
  {
    "text": "maybe doing the same thing that you are doing so maybe in your journey of learning random things you'll also discover that there's",
    "start": "2976319",
    "end": "2982960"
  },
  {
    "text": "people with similar passions are working on the same thing that you can talk with so do that and you as a developer you can really",
    "start": "2982960",
    "end": "2989359"
  },
  {
    "text": "build every any everything and anything even it's if it seems impossible at first and i think this is one of those",
    "start": "2989359",
    "end": "2995839"
  },
  {
    "text": "things where i thought this is never going to work had a couple of moments where i thought it would work in a couple of moments where i thought",
    "start": "2995839",
    "end": "3001920"
  },
  {
    "text": "it would never work but again you can build anything everything is out there the knowledge is out there just",
    "start": "3001920",
    "end": "3007839"
  },
  {
    "text": "yeah go find it with that thank you if there's any questions i would love to hear and if not enjoy the rest of nbc",
    "start": "3007839",
    "end": "3027760"
  },
  {
    "text": "you",
    "start": "3027760",
    "end": "3029839"
  }
]