[
  {
    "text": "we have sound we're on time nice to see you nice to be here um",
    "start": "4319",
    "end": "11679"
  },
  {
    "text": "so today we're going to talk about cookies and why we are returning authentication cookies or the formal",
    "start": "11679",
    "end": "18400"
  },
  {
    "text": "title is probably better use introducing bff back in for front and pattern",
    "start": "18400",
    "end": "23760"
  },
  {
    "text": "uh but i prefer return of the authentication cookie so i'm anders i've been working with the",
    "start": "23760",
    "end": "30640"
  },
  {
    "text": "login buttons if you want to say that for [Music] about a decade",
    "start": "30640",
    "end": "37520"
  },
  {
    "text": "i've been focusing on that nowadays i work with run the software and identity server doing training speaking",
    "start": "37520",
    "end": "43120"
  },
  {
    "text": "consulting et cetera i also have a background doing saml 2 which is",
    "start": "43120",
    "end": "49600"
  },
  {
    "text": "the short version 7.2 is a protocol you shouldn't use that's my notion of having spent 10",
    "start": "49600",
    "end": "55920"
  },
  {
    "text": "years learning it deeply",
    "start": "55920",
    "end": "59840"
  },
  {
    "text": "so but today the focus is on singular page applications and authentication cookies",
    "start": "61280",
    "end": "66880"
  },
  {
    "text": "and session management if we start from the beginning",
    "start": "66880",
    "end": "73040"
  },
  {
    "text": "where the web uh the early days of the web the really early days we had this pop-up coming up",
    "start": "73040",
    "end": "78960"
  },
  {
    "text": "asking for username and password and we were doing basic authentication but then fairly quickly we moved along",
    "start": "78960",
    "end": "85280"
  },
  {
    "text": "to the username and password being entered on the web page and we had a button login where we",
    "start": "85280",
    "end": "90880"
  },
  {
    "text": "posted the username and password to the server the server had some",
    "start": "90880",
    "end": "96400"
  },
  {
    "text": "action some stuff where it processed this and validated the username and password according to all security best",
    "start": "96400",
    "end": "103200"
  },
  {
    "text": "practices and it's done and then http is a stateless protocol",
    "start": "103200",
    "end": "109600"
  },
  {
    "text": "so what happens when our browser makes the next request if we just validated that on the server",
    "start": "109600",
    "end": "116159"
  },
  {
    "text": "side the next request that comes in the web server is like who are you who did you find me",
    "start": "116159",
    "end": "122799"
  },
  {
    "text": "so what did we do i have a special prize for anyone who can tell me what we give the the web server to make it happy",
    "start": "122799",
    "end": "130640"
  },
  {
    "text": "cookies okay who was the first one i think here cookies here you go some cookies",
    "start": "131360",
    "end": "137599"
  },
  {
    "text": "for you exactly and then the web server is happy",
    "start": "137599",
    "end": "143440"
  },
  {
    "text": "uh are you equally happy looking like that uh great uh",
    "start": "143440",
    "end": "149280"
  },
  {
    "text": "so uh back then you know we already had this cookie consent screens built into the",
    "start": "149280",
    "end": "156080"
  },
  {
    "text": "browser and then everybody deactivated them because there were so many cookies",
    "start": "156080",
    "end": "162720"
  },
  {
    "text": "and things were fine we had our server side rendered html pages every server-side processing all",
    "start": "164959",
    "end": "172879"
  },
  {
    "text": "worked well and nice and then one day maybe 2004 five six",
    "start": "172879",
    "end": "179360"
  },
  {
    "text": "i don't remember exactly i went to swedish map service",
    "start": "179360",
    "end": "184720"
  },
  {
    "text": "and was astonished it was possible to pan and zoom on the page without reloading the page",
    "start": "184720",
    "end": "192720"
  },
  {
    "text": "it was smooth it was client-side what was the secret well the secret was",
    "start": "193040",
    "end": "198400"
  },
  {
    "text": "xml http request or ajax of course it wasn't xml",
    "start": "198400",
    "end": "205280"
  },
  {
    "text": "do you know why it's named xml http request",
    "start": "205280",
    "end": "209760"
  },
  {
    "text": "thing is that if you create some modern piece of technology",
    "start": "213040",
    "end": "218080"
  },
  {
    "text": "now and want management buy-in or investors or anything you need to put in ai machine learning and",
    "start": "218080",
    "end": "226080"
  },
  {
    "text": "blockchain technology if you don't have those three there will not be no management approval",
    "start": "226080",
    "end": "232239"
  },
  {
    "text": "for the technology this was back in the xml age they had to tack on xml just to get xml",
    "start": "232239",
    "end": "239200"
  },
  {
    "text": "approval and also the actual code was done by the mx ms xml team from the",
    "start": "239200",
    "end": "244640"
  },
  {
    "text": "start so it's just a marketing thing and we were happy we were doing",
    "start": "244640",
    "end": "251920"
  },
  {
    "text": "um we were doing a lot of nicely looking applications with the new",
    "start": "251920",
    "end": "257120"
  },
  {
    "text": "powers of the client side libraries being able to do full",
    "start": "257120",
    "end": "262639"
  },
  {
    "text": "requests and we were creating really recreating client server with the web",
    "start": "262639",
    "end": "268320"
  },
  {
    "text": "browser as being the client and everything was nice so one day in these nice times",
    "start": "268320",
    "end": "274400"
  },
  {
    "text": "i was sitting late at night at home reading some web forum and found a security researcher on that firm asking",
    "start": "274400",
    "end": "282080"
  },
  {
    "text": "do i know anyone who has one of these modems this was a fairly mode common ads",
    "start": "282080",
    "end": "288240"
  },
  {
    "text": "modem in sweden there were like 200 or 300 000 out there",
    "start": "288240",
    "end": "293520"
  },
  {
    "text": "and i said yes i have and then i got a private message from that security researcher say hey nice",
    "start": "293520",
    "end": "299600"
  },
  {
    "text": "i've got i've created a web page here can you please try to visit this webpage",
    "start": "299600",
    "end": "305040"
  },
  {
    "text": "and i was like uh sorry first of all i shouldn't mention that we on on this uh modem we had a setting",
    "start": "305040",
    "end": "312400"
  },
  {
    "text": "with uh dns settings where we could set up primary secondary and it just saved some",
    "start": "312400",
    "end": "317440"
  },
  {
    "text": "action when we wanted to change it so i said that yes i have this modem and he send",
    "start": "317440",
    "end": "323039"
  },
  {
    "text": "along the address to his web page he said do you want to visit this one",
    "start": "323039",
    "end": "328320"
  },
  {
    "text": "and i said like okay what do you think i did",
    "start": "328320",
    "end": "333919"
  },
  {
    "text": "of course i checked the website who wouldn't and i came to page with kittens",
    "start": "333919",
    "end": "339759"
  },
  {
    "text": "literally he had made a page with a picture of kittens not exactly these kittens but there were kittens",
    "start": "339759",
    "end": "347840"
  },
  {
    "text": "and that was ah okay it's safe and then i started to think about it okay wait wait wait a little he made a",
    "start": "347840",
    "end": "354240"
  },
  {
    "text": "post on a security forum asking for people having specific kind of modem he",
    "start": "354240",
    "end": "360720"
  },
  {
    "text": "sent me private message he also said that please do not tell anyone",
    "start": "360720",
    "end": "366800"
  },
  {
    "text": "before i've published this and then he wanted me to check a url so i checked",
    "start": "366800",
    "end": "372080"
  },
  {
    "text": "the page source thing is these are not nice kittens these are evil kittens because they come",
    "start": "372080",
    "end": "378639"
  },
  {
    "text": "with a hidden iframe that",
    "start": "378639",
    "end": "383199"
  },
  {
    "text": "submitted a form automatically to my modem changing the dns servers on my home",
    "start": "384000",
    "end": "389600"
  },
  {
    "text": "network and it did this because of course the cookie was sent along because the authentication cookie",
    "start": "389600",
    "end": "398240"
  },
  {
    "text": "was at these times sent based on the target only",
    "start": "398639",
    "end": "404319"
  },
  {
    "text": "so it didn't matter who the origin was and the flawed security model here was i",
    "start": "404319",
    "end": "409600"
  },
  {
    "text": "mean i was thinking i was secure i was sitting on my home network these",
    "start": "409600",
    "end": "414639"
  },
  {
    "text": "pages were only uh available from the internal my home internal network i mean",
    "start": "414639",
    "end": "420000"
  },
  {
    "text": "how could the evil kittens out on the internet attack my modem it shouldn't be possible but well it is with the",
    "start": "420000",
    "end": "426400"
  },
  {
    "text": "cross-site request forgery attack because the evil kittens make my browser render that page my computer makes the",
    "start": "426400",
    "end": "433919"
  },
  {
    "text": "request to the modem and with",
    "start": "433919",
    "end": "439440"
  },
  {
    "text": "this were these were also the days before https was used everywhere so",
    "start": "439440",
    "end": "446240"
  },
  {
    "text": "with the security researcher controlling my dns on my entire home network i started",
    "start": "446240",
    "end": "452639"
  },
  {
    "text": "these funny things on when visiting newspaper sites because he had hijacked them and filtered them etc",
    "start": "452639",
    "end": "459280"
  },
  {
    "text": "uh eventually he ended up getting this published on the real paper print of the may one",
    "start": "459280",
    "end": "464639"
  },
  {
    "text": "of the major swedish newspapers so it was a great really great research job",
    "start": "464639",
    "end": "471198"
  },
  {
    "text": "um it was not so great for the most bloggers who had to close down 200 000",
    "start": "472080",
    "end": "478560"
  },
  {
    "text": "customers configuration options",
    "start": "478560",
    "end": "483759"
  },
  {
    "text": "so what do we do to so what we've learned now",
    "start": "484400",
    "end": "490000"
  },
  {
    "text": "is that cookies on the one hand are convenient because they are simple or sorry they are",
    "start": "490000",
    "end": "495599"
  },
  {
    "text": "delicious they are sorry i'm bad for your health if you eat too many",
    "start": "495599",
    "end": "500960"
  },
  {
    "text": "they are simple because they are all transmitted with every request they're transmitted but they're also bad because they're",
    "start": "500960",
    "end": "506720"
  },
  {
    "text": "order transmitted so due to cross-search quest forgery we had to do something else",
    "start": "506720",
    "end": "512560"
  },
  {
    "text": "what did we go for instead of not cookies",
    "start": "512560",
    "end": "518000"
  },
  {
    "text": "what did we pick up instead let's switch to for authentication yes",
    "start": "518000",
    "end": "524800"
  },
  {
    "text": "generating a seat sort of token or even switching to tokens altogether so is this tokens",
    "start": "526000",
    "end": "531040"
  },
  {
    "text": "we can say so um",
    "start": "531040",
    "end": "537279"
  },
  {
    "text": "so uh yeah the liberator deliberately transmitted tokens and when we had to",
    "start": "537440",
    "end": "542880"
  },
  {
    "text": "create a token why not use that for authentication all the way and then the oauth 2 implicit flow was",
    "start": "542880",
    "end": "548800"
  },
  {
    "text": "born those earth 2 implicit flow is a way for the single page application to get hold",
    "start": "548800",
    "end": "555760"
  },
  {
    "text": "of a token that it can then send off with every api request so what it did",
    "start": "555760",
    "end": "562800"
  },
  {
    "text": "is that the single page application requested token the token is attached on the query",
    "start": "562800",
    "end": "569839"
  },
  {
    "text": "string on a callback on the redirect back and",
    "start": "569839",
    "end": "575040"
  },
  {
    "text": "the client stores and manages them secure as securely as it can in a browser and then attaches to any",
    "start": "575040",
    "end": "581200"
  },
  {
    "text": "outbound calls this approach has a number of drawbacks",
    "start": "581200",
    "end": "587120"
  },
  {
    "text": "one is that a url is usually logged or ends up in browser history etc we do",
    "start": "587120",
    "end": "593760"
  },
  {
    "text": "not want our sensitive tokens being stored anywhere",
    "start": "593760",
    "end": "598720"
  },
  {
    "text": "referrer headers this also has no protection against",
    "start": "599600",
    "end": "604640"
  },
  {
    "text": "token injection attacks where we want to really uh force someone to log in as",
    "start": "604640",
    "end": "610880"
  },
  {
    "text": "someone else this is a clause of attack where that is reasonable uh i mean if you haven't say what can",
    "start": "610880",
    "end": "618720"
  },
  {
    "text": "say sensitive data online therapy site if you're doing online therapy you have an online therapy site where you enter",
    "start": "618720",
    "end": "624959"
  },
  {
    "text": "your inner thoughts and save them what if i can make you save them to my",
    "start": "624959",
    "end": "630160"
  },
  {
    "text": "account so i can go read your data because you save them to save your date important data to my",
    "start": "630160",
    "end": "636480"
  },
  {
    "text": "account so we need to consider both the case that i do i do not want someone else to log into my account but i also",
    "start": "636480",
    "end": "643839"
  },
  {
    "text": "want to be sure i am logged into my account and not someone else's account when i do save sensitive data",
    "start": "643839",
    "end": "650560"
  },
  {
    "text": "this flow has no protection against that",
    "start": "650560",
    "end": "656320"
  },
  {
    "text": "so we went further with the authorization code flow with proof key code exchange which is better",
    "start": "657040",
    "end": "664800"
  },
  {
    "text": "uh we are now making the front channel call the redirect back forth we get",
    "start": "664800",
    "end": "670480"
  },
  {
    "text": "something called an authorization code back representing the authorization",
    "start": "670480",
    "end": "675920"
  },
  {
    "text": "event and then we exchange that over back channel for uh the actual tokens we store and manage",
    "start": "675920",
    "end": "682560"
  },
  {
    "text": "the tokens so this sold the pixie flow or authorization code",
    "start": "682560",
    "end": "688480"
  },
  {
    "text": "flow with pixel is really great it solves the security issues it is what we are still using on server side",
    "start": "688480",
    "end": "694240"
  },
  {
    "text": "so it handles the token exchange and handshake but what it doesn't handle is token storage i mean",
    "start": "694240",
    "end": "702320"
  },
  {
    "text": "the browser is it a secured computing environment we have cross-site scripting we have bo",
    "start": "702320",
    "end": "710079"
  },
  {
    "text": "rogue plugins etc i had great plugin to chrome it was a",
    "start": "710079",
    "end": "715600"
  },
  {
    "text": "plugin that allowed you to screen dump and create a screen up of the entire page not just the visible area do anyone",
    "start": "715600",
    "end": "721839"
  },
  {
    "text": "remember this and then a rogue person bought that tool and",
    "start": "721839",
    "end": "728720"
  },
  {
    "text": "injected spyware in a widely deployed plugin that had had privileges to read",
    "start": "728720",
    "end": "734240"
  },
  {
    "text": "page contents on every single page uh so that's why we do not trust the",
    "start": "734240",
    "end": "739360"
  },
  {
    "text": "browser so let's have a look what do we do on the server-side application that we can trust a bit more a server",
    "start": "739360",
    "end": "745600"
  },
  {
    "text": "well it request tokens uh sorry i should say here so what we do",
    "start": "745600",
    "end": "752720"
  },
  {
    "text": "here to handle that the remedy is really on the client side that we are making the tokens extremely",
    "start": "752720",
    "end": "759519"
  },
  {
    "text": "short-lived like five minutes and every five minutes we need to renew them by a silent renew mechanism",
    "start": "759519",
    "end": "767040"
  },
  {
    "text": "which means that if someone manages to steal the token it is just valid for a few minutes after",
    "start": "767040",
    "end": "773680"
  },
  {
    "text": "that it's expired and we're fine um",
    "start": "773680",
    "end": "779440"
  },
  {
    "text": "and then we need to renew that so what do we do on the server side on the server side we do the same dance we request tokens we get back two tokens",
    "start": "779440",
    "end": "787519"
  },
  {
    "text": "the yellow access token and the blue refresh token we store them on the server side",
    "start": "787519",
    "end": "793519"
  },
  {
    "text": "we use the access token to call apis the access token is still short-lived",
    "start": "793519",
    "end": "799600"
  },
  {
    "text": "because we are sending it on the wire to in every api we are accessing so with something being widespread",
    "start": "799600",
    "end": "807360"
  },
  {
    "text": "and it is also self-contained token meaning that anyone that get hold of this",
    "start": "807360",
    "end": "812480"
  },
  {
    "text": "can just use it there is no way to revoke an access token once it's in the wild",
    "start": "812480",
    "end": "817920"
  },
  {
    "text": "there should still be short-lived and then we want a way for the server",
    "start": "817920",
    "end": "822959"
  },
  {
    "text": "when this is expired to get a new token and that's where the refresh token is used the refresh token",
    "start": "822959",
    "end": "830160"
  },
  {
    "text": "the server calls the authorization service with the refresh token",
    "start": "830160",
    "end": "835920"
  },
  {
    "text": "and asks for a new access token that it can then use in subsequent calls",
    "start": "835920",
    "end": "841199"
  },
  {
    "text": "and this way the user do not have to re-log in every five minutes that would be kind of awkward wouldn't it",
    "start": "841199",
    "end": "848240"
  },
  {
    "text": "so this is great but what about client-side applications can we use the",
    "start": "849199",
    "end": "855120"
  },
  {
    "text": "same approach for a single page application in a good way",
    "start": "855120",
    "end": "860880"
  },
  {
    "text": "well we could there are people doing it but we still have the issue of storing and managed tokens",
    "start": "860880",
    "end": "866880"
  },
  {
    "text": "the server side application is running on the server in our data center under our control is a secure environment to",
    "start": "866880",
    "end": "873360"
  },
  {
    "text": "store the tokens while in the browser not so much",
    "start": "873360",
    "end": "878720"
  },
  {
    "text": "so what did we do for browsers well um the idea was",
    "start": "878720",
    "end": "886320"
  },
  {
    "text": "was simple if we have a single page application would render a small hidden iframe",
    "start": "886320",
    "end": "892959"
  },
  {
    "text": "this small hidden iframe renders a page from the authorization",
    "start": "892959",
    "end": "899839"
  },
  {
    "text": "server where it sets uh request tokens with prompt equal none setting meaning that this should just",
    "start": "899839",
    "end": "907120"
  },
  {
    "text": "reuse the existing session don't show any ui i mean a ui in the hidden iframe wouldn't be visible",
    "start": "907120",
    "end": "913519"
  },
  {
    "text": "but as long as we have an ongoing asylum session it works how is that session represented how does the authorization",
    "start": "913519",
    "end": "920000"
  },
  {
    "text": "server that know that there is actually a session going on",
    "start": "920000",
    "end": "925040"
  },
  {
    "text": "what is center line cookie who was uh i heard it from you remember the",
    "start": "925040",
    "end": "931600"
  },
  {
    "text": "first one so sorry i i need to check now we are in modern times do you consent to the",
    "start": "931600",
    "end": "936800"
  },
  {
    "text": "cookies okay here you are",
    "start": "936800",
    "end": "941839"
  },
  {
    "text": "uh so while this was happening",
    "start": "941839",
    "end": "947040"
  },
  {
    "text": "we also had another thing happening on the same time and that was",
    "start": "947040",
    "end": "952240"
  },
  {
    "text": "you remember the kittens um",
    "start": "952240",
    "end": "958320"
  },
  {
    "text": "why don't we do a demo first before we show the kittens uh let's do a demo on",
    "start": "961600",
    "end": "966639"
  },
  {
    "text": "how this works with a hidden iframe so i have whipped up an excellent",
    "start": "966639",
    "end": "972399"
  },
  {
    "text": "web application to show off my html design skills",
    "start": "972399",
    "end": "978480"
  },
  {
    "text": "you have high expectations now don't you",
    "start": "978959",
    "end": "983480"
  },
  {
    "text": "okay i have a demo here i don't need the mouse to be able to scroll um",
    "start": "985440",
    "end": "991440"
  },
  {
    "text": "so if i click here login i'm redirected to the identity server",
    "start": "991839",
    "end": "998240"
  },
  {
    "text": "where i can now log in as alice alice and i'm back i can call apis",
    "start": "998240",
    "end": "1006079"
  },
  {
    "text": "and i can log out i can even call some of the apis are callable publicly but",
    "start": "1008320",
    "end": "1013440"
  },
  {
    "text": "tomorrow's forecaster is only for logged in users",
    "start": "1013440",
    "end": "1019199"
  },
  {
    "text": "um if i log in again now sorry",
    "start": "1019199",
    "end": "1024579"
  },
  {
    "text": "[Music] on this",
    "start": "1024579",
    "end": "1030640"
  },
  {
    "text": "particular host i have you remember we said we should have short lived tokens so five minutes",
    "start": "1030640",
    "end": "1037199"
  },
  {
    "text": "is a reasonable relapse scenario my identity server is ten seconds",
    "start": "1037199",
    "end": "1042480"
  },
  {
    "text": "uh so when i try to call the api again it doesn't work but i can renew the token silently and then",
    "start": "1042480",
    "end": "1048480"
  },
  {
    "text": "it works usually this renew token happens in the background but then i wouldn't be able to demo that it didn't",
    "start": "1048480",
    "end": "1054559"
  },
  {
    "text": "work so let's look at what we have here in the browser dev tools",
    "start": "1054559",
    "end": "1061679"
  },
  {
    "text": "elements when i press renew token renew token do you see here it flashes",
    "start": "1061679",
    "end": "1067600"
  },
  {
    "text": "by that hidden small iframe is quickly appearing and",
    "start": "1067600",
    "end": "1072640"
  },
  {
    "text": "removed there's also another neat thing done with this and that is log out",
    "start": "1072640",
    "end": "1079440"
  },
  {
    "text": "there is a hidden iframe all the time that checks that the session is still",
    "start": "1079440",
    "end": "1084720"
  },
  {
    "text": "available on the server so this is like magic",
    "start": "1084720",
    "end": "1089520"
  },
  {
    "text": "if i click here and click log out yes i want to logout",
    "start": "1091039",
    "end": "1096799"
  },
  {
    "text": "i didn't click on the left side it automatically detects i'm logged out",
    "start": "1097200",
    "end": "1102559"
  },
  {
    "text": "within a few seconds and this is great this is about the best user experience that can happen",
    "start": "1102559",
    "end": "1109760"
  },
  {
    "text": "that we can have until",
    "start": "1109760",
    "end": "1115679"
  },
  {
    "text": "do you know about safari i don't have safari so i have to run with chrome but i'm using this block",
    "start": "1115679",
    "end": "1122160"
  },
  {
    "text": "third-party cookies safari has it by default and",
    "start": "1122160",
    "end": "1128080"
  },
  {
    "text": "chrome is they've said they want to block it next year but the thing is that",
    "start": "1128080",
    "end": "1134559"
  },
  {
    "text": "third-party cookies are really used for two things one is uh authentication distributed authentication and one is",
    "start": "1134559",
    "end": "1140320"
  },
  {
    "text": "tracking people for all uh for advertisement and ad networks",
    "start": "1140320",
    "end": "1145360"
  },
  {
    "text": "so apple they care about privacy they make their money off selling stuff",
    "start": "1145360",
    "end": "1151600"
  },
  {
    "text": "selling hardware google cares kind of about privacy and they make their money off internet ads",
    "start": "1151600",
    "end": "1159360"
  },
  {
    "text": "so they need to find a way to block cookies for privacy without",
    "start": "1159360",
    "end": "1164480"
  },
  {
    "text": "breaking the revenue stream but let's see if we go to the same do the same",
    "start": "1164480",
    "end": "1169600"
  },
  {
    "text": "run the same application here i click login i'll login as alice i'm logging in as",
    "start": "1169600",
    "end": "1175520"
  },
  {
    "text": "alice i'm happy and i'm signed out i signed in didn't i",
    "start": "1175520",
    "end": "1182160"
  },
  {
    "text": "let's try again silent sign in just focus by what happened",
    "start": "1182160",
    "end": "1187760"
  },
  {
    "text": "okay browser devtools to the rescue network",
    "start": "1187760",
    "end": "1194240"
  },
  {
    "text": "login and we can see a number of things happening what i want to",
    "start": "1194240",
    "end": "1200960"
  },
  {
    "text": "show you is this one check session so let's go to this one",
    "start": "1200960",
    "end": "1207120"
  },
  {
    "text": "which is the non in privacy mode this is the one where cross domain cookies are allowed",
    "start": "1207120",
    "end": "1214320"
  },
  {
    "text": "if i go to the call to check session i can see that the identity service",
    "start": "1214320",
    "end": "1219520"
  },
  {
    "text": "session cookie is sent along in the hidden iframe and that is how the hidden iframe",
    "start": "1219520",
    "end": "1225280"
  },
  {
    "text": "detects that we have a session as long as that cookie is there it detects we have a session when the cookie is gone",
    "start": "1225280",
    "end": "1231039"
  },
  {
    "text": "it means we signed out and it indicates back to the hosting application that we are now on that",
    "start": "1231039",
    "end": "1236720"
  },
  {
    "text": "signed out let's see here check session do you see the cookie it's small but i don't see",
    "start": "1236720",
    "end": "1243200"
  },
  {
    "text": "the cookie thing is that cookie was blocked because it's a third-party request",
    "start": "1243200",
    "end": "1250640"
  },
  {
    "text": "so this elegant user experience we had that is so nice is simply broken for",
    "start": "1251280",
    "end": "1257520"
  },
  {
    "text": "good by the browser vendors and this isn't a question about a bug or",
    "start": "1257520",
    "end": "1263440"
  },
  {
    "text": "something we can fix in the library the entire mechanisms that the open id",
    "start": "1263440",
    "end": "1268480"
  },
  {
    "text": "connect session management spec is built around those mechanisms are gone or broken we need to do something",
    "start": "1268480",
    "end": "1276159"
  },
  {
    "text": "else so in the meantime while this happened",
    "start": "1276159",
    "end": "1283919"
  },
  {
    "text": "things were also changed other things were also changing in the browser",
    "start": "1283919",
    "end": "1289520"
  },
  {
    "text": "uh and now let's see if i can get back to extend",
    "start": "1289520",
    "end": "1294799"
  },
  {
    "text": "mode and let's slide show that sorry two",
    "start": "1295039",
    "end": "1304320"
  },
  {
    "text": "got this yeah so remember the evil kittens",
    "start": "1304320",
    "end": "1310320"
  },
  {
    "text": "during the crossout record cross site request forgery attack on my",
    "start": "1310320",
    "end": "1315760"
  },
  {
    "text": "modem that was happening because of the cookie",
    "start": "1315760",
    "end": "1320880"
  },
  {
    "text": "but before the browsers implemented these cookie limitations they also implemented",
    "start": "1320880",
    "end": "1326080"
  },
  {
    "text": "something else same site mode cookies so previously the kittens rely on the fact",
    "start": "1326080",
    "end": "1331679"
  },
  {
    "text": "that the cookie is submitted solely on based on the destination uh addresses uh the the browser doesn't",
    "start": "1331679",
    "end": "1339120"
  },
  {
    "text": "validate that the is the kitten sending the cookie and not me having loaded the",
    "start": "1339120",
    "end": "1344400"
  },
  {
    "text": "real settings form of the modem with same size strict that has changed the cook is now long no longer sent",
    "start": "1344400",
    "end": "1352559"
  },
  {
    "text": "and looking at browser support we can see that it since it looks okay",
    "start": "1352559",
    "end": "1358960"
  },
  {
    "text": "the colors are not that good but the darkest thing is is green these are really the",
    "start": "1358960",
    "end": "1365280"
  },
  {
    "text": "roses that are important all the browsers that are the major ones",
    "start": "1365280",
    "end": "1371679"
  },
  {
    "text": "support same size mode cookies for current and previous",
    "start": "1371679",
    "end": "1376720"
  },
  {
    "text": "and the recent versions based on this the oauth 2 consortium",
    "start": "1376720",
    "end": "1382159"
  },
  {
    "text": "came out with new recommendations on how to do i was 2 in the browser",
    "start": "1382159",
    "end": "1389440"
  },
  {
    "text": "for simple architectures something start from the same domain use a cookie",
    "start": "1389440",
    "end": "1396559"
  },
  {
    "text": "instead so the oauth 2 best practice for browser-based",
    "start": "1396720",
    "end": "1402720"
  },
  {
    "text": "apps is to don't do oils 2 use a cookie instead and they even have some ascii art in the",
    "start": "1402720",
    "end": "1409760"
  },
  {
    "text": "spec on how to set this up this is from the rfc isn't it brilliant",
    "start": "1409760",
    "end": "1417080"
  },
  {
    "text": "where it says that the browser should interact with the application server and then there is a",
    "start": "1417760",
    "end": "1423520"
  },
  {
    "text": "redirect to the authorization endpoint of course because the browser should display the login prompt on the",
    "start": "1423520",
    "end": "1429440"
  },
  {
    "text": "login server but after that all interaction takes place through the application server",
    "start": "1429440",
    "end": "1436640"
  },
  {
    "text": "and this is described as the backend for end or bff pattern where we keep the tokens outside of the",
    "start": "1440640",
    "end": "1447840"
  },
  {
    "text": "javascript out of reach for javascript to implement this we need the bff host a",
    "start": "1447840",
    "end": "1454320"
  },
  {
    "text": "bff host needs a bunch of components it needs an open id connect client library",
    "start": "1454320",
    "end": "1460960"
  },
  {
    "text": "i know where we have one in asp.net core we have add open id connect the built-in library",
    "start": "1460960",
    "end": "1466720"
  },
  {
    "text": "we need a session management tool well i know where we have one we have the",
    "start": "1466720",
    "end": "1472320"
  },
  {
    "text": "cookie the cookie handling for session management in",
    "start": "1472320",
    "end": "1478400"
  },
  {
    "text": "asp.net core we do need",
    "start": "1478400",
    "end": "1483679"
  },
  {
    "text": "token management we need to have renewable tokens storage of tokens attaching tokens to outbound",
    "start": "1483840",
    "end": "1490080"
  },
  {
    "text": "calls etc the open source identity model package can do that",
    "start": "1490080",
    "end": "1496400"
  },
  {
    "text": "we need local and remote api endpoints i mean that's a normal web api isn't it",
    "start": "1496400",
    "end": "1502480"
  },
  {
    "text": "and for remote endpoints we can use the yarp proxy to send off calls to remote host",
    "start": "1502480",
    "end": "1510559"
  },
  {
    "text": "and we need some ui assets i mean that can just be served out with static files",
    "start": "1510559",
    "end": "1516000"
  },
  {
    "text": "we need those so these are the components that that",
    "start": "1516000",
    "end": "1521520"
  },
  {
    "text": "can be used and that you can use to build a back-end for front-end patent using",
    "start": "1521520",
    "end": "1527279"
  },
  {
    "text": "asp.net core tooling at dwende we already did this and it's part of our",
    "start": "1527279",
    "end": "1534640"
  },
  {
    "text": "identity server licensing packages so",
    "start": "1534640",
    "end": "1539679"
  },
  {
    "text": "i want to show you a bit how this is how we use this and also a demo and i want to convert my",
    "start": "1539679",
    "end": "1547120"
  },
  {
    "text": "application to be using bff",
    "start": "1547120",
    "end": "1551120"
  },
  {
    "text": "so i'll go quickly through just the part of what we will need to do on our back end our back and we'll need to",
    "start": "1552640",
    "end": "1559760"
  },
  {
    "text": "add open a d connect setup we will get two new end points login the",
    "start": "1559760",
    "end": "1565279"
  },
  {
    "text": "logout where we simply can redirect the user when we want to link in and logout we will need",
    "start": "1565279",
    "end": "1570960"
  },
  {
    "text": "some session handling with same site strict we can now set",
    "start": "1570960",
    "end": "1576159"
  },
  {
    "text": "we'll get a new endpoint on the get bff user where we can get the currently",
    "start": "1576159",
    "end": "1581520"
  },
  {
    "text": "logged in user information about that and we can",
    "start": "1581520",
    "end": "1587760"
  },
  {
    "text": "the problem here is when we set up the session to use sliding expiration it means that",
    "start": "1587760",
    "end": "1593440"
  },
  {
    "text": "the slightly expiration notion of that is that if i leave the computer",
    "start": "1593440",
    "end": "1599360"
  },
  {
    "text": "and i'm not active my site should be logged out right",
    "start": "1599360",
    "end": "1604799"
  },
  {
    "text": "um and that is done by the cookie being valid for like 30 minutes or one hour",
    "start": "1605360",
    "end": "1610480"
  },
  {
    "text": "and after half that time if i make a request a new cookie is issued so i get another",
    "start": "1610480",
    "end": "1615600"
  },
  {
    "text": "hour and that works nice",
    "start": "1615600",
    "end": "1620320"
  },
  {
    "text": "but if i want to check from the client side if the user is signed out",
    "start": "1620799",
    "end": "1627440"
  },
  {
    "text": "i need to make requests and i do not want my automatic request to check if i am",
    "start": "1627440",
    "end": "1635200"
  },
  {
    "text": "signed in to actually slide the session that would be quite awkward so we added a",
    "start": "1635200",
    "end": "1642640"
  },
  {
    "text": "parameter slide equals false that you can add to this endpoint to indicate that this request should not slide the",
    "start": "1642640",
    "end": "1648799"
  },
  {
    "text": "session this request is actually something we want to use to check if the session is expired",
    "start": "1648799",
    "end": "1655840"
  },
  {
    "text": "we also have support for back channel logout notifications",
    "start": "1656720",
    "end": "1662320"
  },
  {
    "text": "and this really is the future even for server-side applications the",
    "start": "1662320",
    "end": "1669440"
  },
  {
    "text": "front-channel log-out mechanism relies on hidden iframes so",
    "start": "1669440",
    "end": "1675360"
  },
  {
    "text": "if we can make a log-in work on server-side applications with cookies",
    "start": "1675360",
    "end": "1681200"
  },
  {
    "text": "despite the cookie limitations but we cannot make look out work smoothly because that also relies on hidden",
    "start": "1681200",
    "end": "1688159"
  },
  {
    "text": "iframes um",
    "start": "1688159",
    "end": "1696039"
  },
  {
    "text": "so what we have is a lo is the bff component offers a local api",
    "start": "1696080",
    "end": "1702159"
  },
  {
    "text": "endpoint that's also important if you are are developing a single page application we have this idea that we",
    "start": "1702159",
    "end": "1709600"
  },
  {
    "text": "have generic single page applications calling generic apis and we have a bunch of apis over here and our simple guild",
    "start": "1709600",
    "end": "1717120"
  },
  {
    "text": "page applications call all of those apis equally and the apis are totally",
    "start": "1717120",
    "end": "1722159"
  },
  {
    "text": "independent of and provide generic functionality uh",
    "start": "1722159",
    "end": "1727840"
  },
  {
    "text": "that our applications can call is it that way in the real world no",
    "start": "1727840",
    "end": "1733600"
  },
  {
    "text": "half of those apis at least half are application specific",
    "start": "1733600",
    "end": "1739679"
  },
  {
    "text": "because we need we are just using that functionality for on one specific application right",
    "start": "1739679",
    "end": "1745200"
  },
  {
    "text": "so why do not simply implement those apis on the local bff",
    "start": "1745200",
    "end": "1751760"
  },
  {
    "text": "and not defer it further so um",
    "start": "1751760",
    "end": "1756960"
  },
  {
    "text": "i think i have another how do they be the this call being authenticated",
    "start": "1756960",
    "end": "1763679"
  },
  {
    "text": "cookies who want more cookies of course do you consent to the cookies",
    "start": "1764000",
    "end": "1770720"
  },
  {
    "text": "okay good uh yeah cookies",
    "start": "1770720",
    "end": "1775679"
  },
  {
    "text": "um are you protecting your cookies from the evil kittens",
    "start": "1775919",
    "end": "1782880"
  },
  {
    "text": "did you verify that your cookies are same site",
    "start": "1782880",
    "end": "1787278"
  },
  {
    "text": "you sent it to them yes of course but if they are not same-sized strict cookies the kittens can steal them",
    "start": "1788480",
    "end": "1795840"
  },
  {
    "text": "the problem here is that this gentleman may not have read the swedish list of",
    "start": "1796559",
    "end": "1802000"
  },
  {
    "text": "um of ingredients yet to verify that it's same size strict and people may not have",
    "start": "1802000",
    "end": "1810799"
  },
  {
    "text": "up-to-date browsers there are people running old browsers without same-sized support",
    "start": "1810799",
    "end": "1817760"
  },
  {
    "text": "that could still be vulnerable so in the twende component we added",
    "start": "1817760",
    "end": "1823200"
  },
  {
    "text": "a simple cross site request for header x csrf colon one",
    "start": "1823200",
    "end": "1829360"
  },
  {
    "text": "okay is that secure it actually is",
    "start": "1829360",
    "end": "1835440"
  },
  {
    "text": "because the evil kittens they are prohibited by course policy to make direct api requests to the bff the",
    "start": "1835440",
    "end": "1843039"
  },
  {
    "text": "bff do not have a course policy allowing third-party domains to make javascript api requests the only thing the evil",
    "start": "1843039",
    "end": "1850159"
  },
  {
    "text": "kittens can do is to render a hidden iframe that posts",
    "start": "1850159",
    "end": "1855919"
  },
  {
    "text": "something to our bff and when we have a normal form post we",
    "start": "1855919",
    "end": "1861279"
  },
  {
    "text": "cannot attach headers to it we cannot add headers",
    "start": "1861279",
    "end": "1867200"
  },
  {
    "text": "so if the header is present we can know that this came from a javascript and thanks to course we can know that then it must",
    "start": "1867200",
    "end": "1874399"
  },
  {
    "text": "be a same domain request so that's enough",
    "start": "1874399",
    "end": "1880480"
  },
  {
    "text": "and then we of course have the remote apis remember where i said roughly half of the apis are application specific the",
    "start": "1881360",
    "end": "1887679"
  },
  {
    "text": "other half they get proxied through to the actual api producer",
    "start": "1887679",
    "end": "1893520"
  },
  {
    "text": "and during that proxy processing of the request",
    "start": "1893520",
    "end": "1898960"
  },
  {
    "text": "the the relevant access token is attached",
    "start": "1898960",
    "end": "1904480"
  },
  {
    "text": "for us we do not have to do that ourselves so let's see if we can we have",
    "start": "1904480",
    "end": "1910799"
  },
  {
    "text": "a bit more than 20 we have like 27 minutes right let's see if we can make this conversion",
    "start": "1910799",
    "end": "1917519"
  },
  {
    "text": "um so i need to just tell you a bit more about the config we also set up use endpoints this is how",
    "start": "1917519",
    "end": "1924320"
  },
  {
    "text": "we configure this in the setup we have map map controllers we map our local apis we",
    "start": "1924320",
    "end": "1931600"
  },
  {
    "text": "map up login logout user the management vff internal endpoints and",
    "start": "1931600",
    "end": "1937360"
  },
  {
    "text": "we map the remote api endpoints",
    "start": "1937360",
    "end": "1941200"
  },
  {
    "text": "so back to some code and i have my running example here",
    "start": "1942720",
    "end": "1951600"
  },
  {
    "text": "and that is still not displaying there we duplicate it",
    "start": "1951679",
    "end": "1958480"
  },
  {
    "text": "so now i'm happy i could of course have served my uh i mean i could have",
    "start": "1958640",
    "end": "1964960"
  },
  {
    "text": "must here um close all about this close i could have served my spa from",
    "start": "1964960",
    "end": "1973440"
  },
  {
    "text": "cdn the content delivery network but i'm lucky i created a very very",
    "start": "1973760",
    "end": "1980399"
  },
  {
    "text": "small asp.net core web application that serves my spa single-player application",
    "start": "1980399",
    "end": "1985919"
  },
  {
    "text": "so i already have an asp.net core environment that where i can add the stuff needed for the bff",
    "start": "1985919",
    "end": "1994080"
  },
  {
    "text": "the first thing we want to do is we need to set up so that we have authentication",
    "start": "1995519",
    "end": "2002159"
  },
  {
    "text": "server side authentication builder dot services dot add authentication",
    "start": "2002159",
    "end": "2008320"
  },
  {
    "text": "we need to add the cookie let's call the scheme cookie and we want",
    "start": "2008320",
    "end": "2015919"
  },
  {
    "text": "cookie dot same site equal same side mode strict",
    "start": "2015919",
    "end": "2021919"
  },
  {
    "text": "that's good then let's add add open",
    "start": "2021919",
    "end": "2028240"
  },
  {
    "text": "okay i need some new get packages and i cheated a bit so they are commented out in my project file",
    "start": "2028240",
    "end": "2036880"
  },
  {
    "text": "i'm adding the defender bff to under bff europe and microsoft asp.net core authentication open id connect packages",
    "start": "2036880",
    "end": "2044559"
  },
  {
    "text": "dot add open id connect let's call it odc the scheme",
    "start": "2044559",
    "end": "2051679"
  },
  {
    "text": "uh authority now we want to move",
    "start": "2051679",
    "end": "2056800"
  },
  {
    "text": "these settings that we already have in the single page application we want to move those over to the",
    "start": "2056800",
    "end": "2063669"
  },
  {
    "text": "[Music] uh to the server side application so the authority is there opt dot authority no",
    "start": "2063670",
    "end": "2072079"
  },
  {
    "text": "dot authority equals http other host 5010",
    "start": "2072079",
    "end": "2080158"
  },
  {
    "text": "client id we can still use the same spa um",
    "start": "2080159",
    "end": "2085760"
  },
  {
    "text": "we can no off.client id uh and the semicolons in here um we need",
    "start": "2085839",
    "end": "2093679"
  },
  {
    "text": "now when we do this and move to server side we can have a server-side secret",
    "start": "2093679",
    "end": "2100880"
  },
  {
    "text": "i make this somewhat smaller can you still see at the back okay um",
    "start": "2100880",
    "end": "2107520"
  },
  {
    "text": "opt dot response type we want the code flow op dot",
    "start": "2107520",
    "end": "2113359"
  },
  {
    "text": "response mode we want restring response mode",
    "start": "2113359",
    "end": "2118960"
  },
  {
    "text": "we want to say that we should be able to call an api we want to say that we",
    "start": "2118960",
    "end": "2125839"
  },
  {
    "text": "get a refresh token uh and for historical acts reasons",
    "start": "2125839",
    "end": "2132240"
  },
  {
    "text": "that's called offline access",
    "start": "2132240",
    "end": "2135760"
  },
  {
    "text": "and we want to have get claims from using for endpoint true we want to save the incoming tokens",
    "start": "2138240",
    "end": "2145200"
  },
  {
    "text": "that's a good idea we want to map inbound claims through this means mapping bank claims this is my favorite",
    "start": "2145200",
    "end": "2151599"
  },
  {
    "text": "settings you know that i was ranting about the xmlh",
    "start": "2151599",
    "end": "2157359"
  },
  {
    "text": "so the identity at microsoft is is anyone from the microsoft identity in the team in the room",
    "start": "2157359",
    "end": "2164640"
  },
  {
    "text": "no good okay the identity with microsoft are stuck in xmlh they think that we want our claims to be",
    "start": "2164880",
    "end": "2172000"
  },
  {
    "text": "this long http column xml schema so for",
    "start": "2172000",
    "end": "2177200"
  },
  {
    "text": "i want a simple name in openid connect in the incoming tokens the names are short nice and simple",
    "start": "2177200",
    "end": "2184960"
  },
  {
    "text": "so if we set map invite claims to false we say keep our short simple nice names",
    "start": "2184960",
    "end": "2191599"
  },
  {
    "text": "don't mess them up when we do that we also unfortunately",
    "start": "2191599",
    "end": "2197599"
  },
  {
    "text": "need to set up some token validation parameters because the token validation parameters",
    "start": "2197599",
    "end": "2202640"
  },
  {
    "text": "still by default look at the awkward xml names so now we need to tell the token",
    "start": "2202640",
    "end": "2209280"
  },
  {
    "text": "validation parameters that the name claim type is name and the role claim type is role and",
    "start": "2209280",
    "end": "2215359"
  },
  {
    "text": "nothing else thank you finally we need to tell this that if we",
    "start": "2215359",
    "end": "2220800"
  },
  {
    "text": "are signing out the sign out scheme that we should call",
    "start": "2220800",
    "end": "2227040"
  },
  {
    "text": "if there is an incoming sign out request is cookie speaking of that we need to set up the",
    "start": "2227040",
    "end": "2232720"
  },
  {
    "text": "wire up schemes authentication schemes correctly or two we have opt default authenticate",
    "start": "2232720",
    "end": "2241359"
  },
  {
    "text": "default scheme the default scheme is what we are using to keep to the main session of the",
    "start": "2241359",
    "end": "2248240"
  },
  {
    "text": "application when we want to log in that is in",
    "start": "2248240",
    "end": "2253359"
  },
  {
    "text": "authentication service lingo called challenge so this scheme when we want to sign in",
    "start": "2253359",
    "end": "2259040"
  },
  {
    "text": "we want to do that using the using the oidc scheme",
    "start": "2259040",
    "end": "2266160"
  },
  {
    "text": "and we need to set we can set the default sinus scheme to",
    "start": "2266160",
    "end": "2272640"
  },
  {
    "text": "uh should be odc as well",
    "start": "2272640",
    "end": "2277760"
  },
  {
    "text": "to work so we've set up that we need more services we need builder",
    "start": "2278240",
    "end": "2283920"
  },
  {
    "text": "services dot add authorization we",
    "start": "2283920",
    "end": "2289440"
  },
  {
    "text": "need builder services dot add bff",
    "start": "2289440",
    "end": "2295520"
  },
  {
    "text": "and we want to add the remote apis",
    "start": "2295520",
    "end": "2299839"
  },
  {
    "text": "as well and that one is in another namespace ah done",
    "start": "2301520",
    "end": "2308079"
  },
  {
    "text": "that's all the services now let's set up the pipeline um",
    "start": "2308079",
    "end": "2313839"
  },
  {
    "text": "you know we are always serving static files first because we do not want to fiddle around with authentication and",
    "start": "2314160",
    "end": "2319680"
  },
  {
    "text": "that overhead when we just want to return a javascript asset so let's leave this first and then",
    "start": "2319680",
    "end": "2326000"
  },
  {
    "text": "app.use routing we want to app.use authentication then",
    "start": "2326000",
    "end": "2332400"
  },
  {
    "text": "the bff should go in between here before app.use authorization",
    "start": "2332400",
    "end": "2340280"
  },
  {
    "text": "and finally we are defining our endpoints use endpoints",
    "start": "2340640",
    "end": "2346480"
  },
  {
    "text": "and points we want to map the",
    "start": "2347359",
    "end": "2352480"
  },
  {
    "text": "bff management endpoints to get slash bfs login bff logout",
    "start": "2352480",
    "end": "2359119"
  },
  {
    "text": "we want to map uh map remote bff api endpoint so whenever",
    "start": "2359119",
    "end": "2364880"
  },
  {
    "text": "we make a request to anything under slash api on on the bff host",
    "start": "2364880",
    "end": "2371760"
  },
  {
    "text": "those calls should just be forwarded right away to localhost 5002",
    "start": "2371760",
    "end": "2377680"
  },
  {
    "text": "where i am running my api please note i had two apis the goals and",
    "start": "2377680",
    "end": "2384480"
  },
  {
    "text": "the weather api that i could call those two strings came from two different apis",
    "start": "2384480",
    "end": "2391119"
  },
  {
    "text": "and i do not have to specify them here i specify the root path so the b when we",
    "start": "2391119",
    "end": "2398400"
  },
  {
    "text": "alter our api we can do that on the api host and we can alter our javascript to call the new",
    "start": "2398400",
    "end": "2404480"
  },
  {
    "text": "apis but we do not have to change an update and maintain an api list on our",
    "start": "2404480",
    "end": "2409680"
  },
  {
    "text": "bff but this is a lightweight component from an antenna's point of view",
    "start": "2409680",
    "end": "2416810"
  },
  {
    "text": "[Music] so that's it",
    "start": "2416810",
    "end": "2421040"
  },
  {
    "text": "that's all we have to do on the uh",
    "start": "2422640",
    "end": "2428560"
  },
  {
    "text": "on the host let's go to this spa and this is the funny part",
    "start": "2428560",
    "end": "2433839"
  },
  {
    "text": "let's go here first we have a callback html that was used as its target when",
    "start": "2433839",
    "end": "2439280"
  },
  {
    "text": "reader coming back from the identity in the redirect do we need that anymore no",
    "start": "2439280",
    "end": "2445599"
  },
  {
    "text": "uh do i have to create a similar one in the bff no because the authentication middleware",
    "start": "2445599",
    "end": "2453200"
  },
  {
    "text": "and authentication handlers have those endpoints built in so using oedc on the server side is much",
    "start": "2453200",
    "end": "2461040"
  },
  {
    "text": "less ceremony and doing it on the client side um do i need the odc client anymore no",
    "start": "2461040",
    "end": "2467440"
  },
  {
    "text": "do i need the silent renew page no do i need the sites dot js yes please",
    "start": "2467440",
    "end": "2473680"
  },
  {
    "text": "my index i now we're moving the token handling to the server side",
    "start": "2473680",
    "end": "2479359"
  },
  {
    "text": "remove the renew token and remove that one or what you see site.js what do we have inside.js",
    "start": "2479359",
    "end": "2488400"
  },
  {
    "text": "well the token renew button can go all the open id connect settings can go",
    "start": "2489760",
    "end": "2495040"
  },
  {
    "text": "that's nice i just found out remember i have one thing i need to do",
    "start": "2495040",
    "end": "2500400"
  },
  {
    "text": "too the settings on the identity server somewhat",
    "start": "2500400",
    "end": "2505920"
  },
  {
    "text": "different i need to update the identity server",
    "start": "2505920",
    "end": "2511040"
  },
  {
    "text": "with the new urls we now have a client secret we want to allow refresh tokens",
    "start": "2511040",
    "end": "2516800"
  },
  {
    "text": "i'm just updating that enter the same settings so back to this poll i have no user",
    "start": "2516800",
    "end": "2521839"
  },
  {
    "text": "manager i have this check if we are signed in so",
    "start": "2521839",
    "end": "2527040"
  },
  {
    "text": "let's go and have a look would define a global variable is this a good idea with a global variable",
    "start": "2527040",
    "end": "2533440"
  },
  {
    "text": "nope is this a demo where i can just be lazy yes uh",
    "start": "2533440",
    "end": "2539119"
  },
  {
    "text": "i want to call an api called bff slash user on on page load",
    "start": "2539119",
    "end": "2544720"
  },
  {
    "text": "where i can check the result and if the result equals a 1",
    "start": "2544720",
    "end": "2550160"
  },
  {
    "text": "it means we are not signed in if the result equals",
    "start": "2550160",
    "end": "2556079"
  },
  {
    "text": "something else we are signed in so then i can get this one so when we're not signed in what happens is that the login",
    "start": "2556079",
    "end": "2563119"
  },
  {
    "text": "button is displayed when we are signed in in the similar way",
    "start": "2563119",
    "end": "2569200"
  },
  {
    "text": "a similar way the log out button is displayed the renew button is no longer there and then we",
    "start": "2569200",
    "end": "2575040"
  },
  {
    "text": "have this welcome text that is a bit more complex",
    "start": "2575040",
    "end": "2579838"
  },
  {
    "text": "because we do not get a user object right way i need to actually parse it",
    "start": "2580240",
    "end": "2585280"
  },
  {
    "text": "from result so json.parse the result we parse it",
    "start": "2585280",
    "end": "2590960"
  },
  {
    "text": "and then use a profile name this is a what we get back here is an array",
    "start": "2590960",
    "end": "2596319"
  },
  {
    "text": "so i can go to the array and check user dot find",
    "start": "2596319",
    "end": "2602640"
  },
  {
    "text": "find and we have an element if e dot type equals name",
    "start": "2602640",
    "end": "2609200"
  },
  {
    "text": "remember that i said don't use xml names i would have been more saving me a lot of keystrokes here right",
    "start": "2609200",
    "end": "2617520"
  },
  {
    "text": "um so we can clear the old login detection",
    "start": "2617520",
    "end": "2624720"
  },
  {
    "text": "login previously called the odc client user manager to sign in",
    "start": "2624720",
    "end": "2630000"
  },
  {
    "text": "now it's very simple window.location equal bff slash login right",
    "start": "2630000",
    "end": "2637520"
  },
  {
    "text": "log out is a bit more complex because the log out endpoint requires a session id to be sent and that is another c surf",
    "start": "2637520",
    "end": "2645200"
  },
  {
    "text": "protection so i need to actually go and find it uh",
    "start": "2645200",
    "end": "2651119"
  },
  {
    "text": "window location is in user find e sorry element e dot type equals bff column",
    "start": "2651119",
    "end": "2659599"
  },
  {
    "text": "log out url dot value",
    "start": "2659599",
    "end": "2665920"
  },
  {
    "text": "the call apis is also simplified i mean the previous version of the call apis had to",
    "start": "2666960",
    "end": "2672960"
  },
  {
    "text": "called get user and then um sorry it's called aps this is",
    "start": "2672960",
    "end": "2680560"
  },
  {
    "text": "this call api the call to call an api preview they had to get user and then set the request header with the",
    "start": "2680800",
    "end": "2687920"
  },
  {
    "text": "current access token i can do that much easier now i do not",
    "start": "2687920",
    "end": "2693599"
  },
  {
    "text": "have to call get user because the user handling is done server side right",
    "start": "2693599",
    "end": "2700000"
  },
  {
    "text": "so i get this and i actually just altered it a bit here it shouldn't",
    "start": "2701040",
    "end": "2707040"
  },
  {
    "text": "return text and i need to unconditionally set request header x",
    "start": "2707040",
    "end": "2713760"
  },
  {
    "text": "do you remember the evil kitten protection x c serve and i need to set it to one",
    "start": "2713760",
    "end": "2722160"
  },
  {
    "text": "and then send and then when i call the apis i had two",
    "start": "2724240",
    "end": "2731200"
  },
  {
    "text": "apis the goal api is only accessible when you are signed in the weather api is accessible both in",
    "start": "2731200",
    "end": "2738640"
  },
  {
    "text": "a public version and a non-public version so the public version returns today's",
    "start": "2738640",
    "end": "2743760"
  },
  {
    "text": "forecast but not tomorrow's and when we are logged in we get both",
    "start": "2743760",
    "end": "2749920"
  },
  {
    "text": "so here i simply can check if if user not equal null if i have a user",
    "start": "2750000",
    "end": "2756720"
  },
  {
    "text": "then i can go ahead and call the api the api is of course now on the lo",
    "start": "2757760",
    "end": "2765470"
  },
  {
    "text": "[Music] remember i mapped this slash api slash gold",
    "start": "2765470",
    "end": "2771200"
  },
  {
    "text": "and i can call similar way the weather api",
    "start": "2771680",
    "end": "2776880"
  },
  {
    "text": "should be called always regardless if the user is signed on or not and is also in the slash api slash",
    "start": "2777119",
    "end": "2783440"
  },
  {
    "text": "weather renew is gone you know this excellent user interface",
    "start": "2783440",
    "end": "2789760"
  },
  {
    "text": "with sign out where i signed out of the identity server and it magically found out i was signed out and signed",
    "start": "2789760",
    "end": "2796000"
  },
  {
    "text": "out to the application right away that is doable with the bff pattern as",
    "start": "2796000",
    "end": "2802560"
  },
  {
    "text": "well if we have server-side sessions if we have a database storing the",
    "start": "2802560",
    "end": "2808000"
  },
  {
    "text": "sessions and if anyone has an idea how i can squeeze in a database in the 13 minutes",
    "start": "2808000",
    "end": "2813599"
  },
  {
    "text": "i have remaining of this talk please please feel free i don't have an idea of that so i'm sorry about i'm just",
    "start": "2813599",
    "end": "2820079"
  },
  {
    "text": "dropping that part of of the functionality for this demo",
    "start": "2820079",
    "end": "2825520"
  },
  {
    "text": "so that's it um that was a lot of code to write which",
    "start": "2828400",
    "end": "2833440"
  },
  {
    "text": "means how any any guess on how many bugs i have before this actually runs and works",
    "start": "2833440",
    "end": "2840960"
  },
  {
    "text": "i guess there's at least two login button i was logged in already obviously okay",
    "start": "2841760",
    "end": "2848400"
  },
  {
    "text": "login button alice alice welcome alice smith",
    "start": "2848400",
    "end": "2853520"
  },
  {
    "text": "all apis goal for today is a 401",
    "start": "2853520",
    "end": "2858720"
  },
  {
    "text": "okay i did something i've missed something uh you see the weather forecast sunny and",
    "start": "2858720",
    "end": "2865280"
  },
  {
    "text": "nice tomorrow's forecast is only available for logged in users so i can call the apis on the remote api",
    "start": "2865280",
    "end": "2872160"
  },
  {
    "text": "host they are proxied correctly but apparently i forgot something to tell the bff to include access tokens",
    "start": "2872160",
    "end": "2880560"
  },
  {
    "text": "so let's go back and have a look what i forgot [Music] it's in this spa",
    "start": "2880560",
    "end": "2888319"
  },
  {
    "text": "when i mapped the remote endpoints i should um",
    "start": "2888319",
    "end": "2895680"
  },
  {
    "text": "tell it that it needs and i have a cheat sheet with the uh require access token require access",
    "start": "2895680",
    "end": "2903040"
  },
  {
    "text": "token i uh need to supply an access token and in this case",
    "start": "2903040",
    "end": "2908640"
  },
  {
    "text": "i have a smart fold by thing i want to use here which is user or client what",
    "start": "2908640",
    "end": "2914240"
  },
  {
    "text": "this means is that whenever the bff routes an api call to the back",
    "start": "2914240",
    "end": "2923599"
  },
  {
    "text": "api host behind it will always include an access token",
    "start": "2923599",
    "end": "2929760"
  },
  {
    "text": "if there is a logged in user there will be an access token so the api is called on behalf of the logged in user",
    "start": "2929760",
    "end": "2936480"
  },
  {
    "text": "if there is no user signed in there will be a client credentials token authorizing the bff to the api",
    "start": "2936480",
    "end": "2944400"
  },
  {
    "text": "the good thing about that is that in the next step we can actually look down our api so it's the api is no longer",
    "start": "2944400",
    "end": "2950160"
  },
  {
    "text": "callable directly from the internet",
    "start": "2950160",
    "end": "2954680"
  },
  {
    "text": "see if this works better this time you can call the apis",
    "start": "2956079",
    "end": "2963200"
  },
  {
    "text": "okay um let's see we go here we call the apis first weather forecast 401",
    "start": "2963200",
    "end": "2970720"
  },
  {
    "text": "no no no the api is not happy with us how come the api is not happy with us",
    "start": "2970720",
    "end": "2979200"
  },
  {
    "text": "we have the right authority and we have the",
    "start": "2979200",
    "end": "2986720"
  },
  {
    "text": "let's log in and see if we can get through i have an idea what i might have done",
    "start": "2986720",
    "end": "2993119"
  },
  {
    "text": "yeah we got when we are signed in we got it working when we're signed out",
    "start": "2993119",
    "end": "2998559"
  },
  {
    "text": "there is i guess the fault is in the config",
    "start": "2998559",
    "end": "3004400"
  },
  {
    "text": "that the grant types i set the grant type to be pure code",
    "start": "3004400",
    "end": "3011640"
  },
  {
    "text": "and it should of course be code and client credentials we want our",
    "start": "3012160",
    "end": "3018079"
  },
  {
    "text": "uh we need to me let's just close this we need to make sure that our client is",
    "start": "3018079",
    "end": "3023920"
  },
  {
    "text": "able to request an access token on behalf of itself when there is no user signed on",
    "start": "3023920",
    "end": "3029920"
  },
  {
    "text": "so let's say if i log out all apis yes it works",
    "start": "3029920",
    "end": "3036720"
  },
  {
    "text": "so now the bff goes off fetch is an access token and an anonymous access token but still proving that the call",
    "start": "3036720",
    "end": "3043680"
  },
  {
    "text": "came from the bff and can call the api",
    "start": "3043680",
    "end": "3048800"
  },
  {
    "text": "so it works committed by three two bugs i guess two",
    "start": "3048800",
    "end": "3056160"
  },
  {
    "text": "do i get cookies now i've handed out all my cookies i don't have any more cookies to hand out",
    "start": "3056160",
    "end": "3062400"
  },
  {
    "text": "um but we're not still we're not completely done yet i want to go to and have a look",
    "start": "3062400",
    "end": "3068800"
  },
  {
    "text": "at the api because when we look at the api host this is the",
    "start": "3068800",
    "end": "3075280"
  },
  {
    "text": "setup that we accept inbound tokens then we have the authorization policy to",
    "start": "3075280",
    "end": "3083040"
  },
  {
    "text": "detect whether we have a login user or not that is used by the weather forecast api then we have course crossover gen",
    "start": "3083040",
    "end": "3090559"
  },
  {
    "text": "resource sharing do we need that anymore no we can drop that because course is a",
    "start": "3090559",
    "end": "3096800"
  },
  {
    "text": "concept for course is a concept to allow cross-domain javascript calls and now",
    "start": "3096800",
    "end": "3103359"
  },
  {
    "text": "we're not doing that anymore we are calling directly from the bff into the api",
    "start": "3103359",
    "end": "3111040"
  },
  {
    "text": "and we can do one thing more we can add a require authorization on",
    "start": "3111040",
    "end": "3116880"
  },
  {
    "text": "the weather the forecast and saying that even though it's allowed to be",
    "start": "3116880",
    "end": "3122000"
  },
  {
    "text": "accessible both if you have signed in user and not we don't have to",
    "start": "3122000",
    "end": "3129040"
  },
  {
    "text": "we don't have to [Music] allow anonymous access to the api the",
    "start": "3129440",
    "end": "3136960"
  },
  {
    "text": "api should only be callable by the bff so we're closing down direct data api access from the internet",
    "start": "3136960",
    "end": "3143839"
  },
  {
    "text": "and one more thing my weather forecast api is a generic api that a lot of services in my corporation",
    "start": "3143839",
    "end": "3150880"
  },
  {
    "text": "uses but the gold service is something that just my html show of",
    "start": "3150880",
    "end": "3156240"
  },
  {
    "text": "application uses so i'm moving that simply",
    "start": "3156240",
    "end": "3162720"
  },
  {
    "text": "to my bar and as bff api endpoint i add that",
    "start": "3162720",
    "end": "3171760"
  },
  {
    "text": "to say that i want this to be sorry i want this to have the xc serve",
    "start": "3172160",
    "end": "3180640"
  },
  {
    "text": "requirement last thing i need to do is site.js",
    "start": "3180640",
    "end": "3187520"
  },
  {
    "text": "now the google api is available locally directly right",
    "start": "3187520",
    "end": "3193040"
  },
  {
    "text": "so i cleaned it up i simplified my architecture i've secured my api from direct calls it's only callable through",
    "start": "3193040",
    "end": "3199599"
  },
  {
    "text": "my bff i have a much clearer view now who will call it",
    "start": "3199599",
    "end": "3205200"
  },
  {
    "text": "it still works yeah it's a sound check for the um",
    "start": "3205200",
    "end": "3210880"
  },
  {
    "text": "for the the [Music] first of the festival or the concert tonight and",
    "start": "3210880",
    "end": "3218000"
  },
  {
    "text": "the ndc crew said that if this sound check started and was disturbing i",
    "start": "3218000",
    "end": "3223119"
  },
  {
    "text": "should just dance a bit and wait i'm happy that it's not louder than i",
    "start": "3223119",
    "end": "3228960"
  },
  {
    "text": "can still talk uh if i log in alice alice",
    "start": "3228960",
    "end": "3235599"
  },
  {
    "text": "i can call the apis and get everything so we've taken",
    "start": "3235599",
    "end": "3241680"
  },
  {
    "text": "our application let's see if i have the presentation still running somewhere here",
    "start": "3241680",
    "end": "3248200"
  },
  {
    "text": "so we've taken our application our single page application we have found out that in the new modern",
    "start": "3251440",
    "end": "3258800"
  },
  {
    "text": "world where browsers are look looking down locking down cookies we need this architecture yes",
    "start": "3258800",
    "end": "3267280"
  },
  {
    "text": "over here",
    "start": "3271760",
    "end": "3275000"
  },
  {
    "text": "no no i removed it from the from the api over here so previously before this transition",
    "start": "3282319",
    "end": "3288800"
  },
  {
    "text": "the client-side application called the api directly and then i would need cores to",
    "start": "3288800",
    "end": "3293839"
  },
  {
    "text": "allow cross-domain call but now",
    "start": "3293839",
    "end": "3299359"
  },
  {
    "text": "the our api is only called by another server so i can remove the course",
    "start": "3299440",
    "end": "3306200"
  },
  {
    "text": "yes and the and the access token is kept on the bff the javascript side never gets the",
    "start": "3312800",
    "end": "3319599"
  },
  {
    "text": "access token the javascript uses a cookie that is http only to communicate with the bff so",
    "start": "3319599",
    "end": "3326880"
  },
  {
    "text": "by keeping the valuable tokens out of the javascript application",
    "start": "3326880",
    "end": "3333318"
  },
  {
    "text": "if a request needs to be signed by the by tls signing",
    "start": "3335760",
    "end": "3344359"
  },
  {
    "text": "so if you need to sign sign so that would essentially be this you would still have the bff to avoid cross-domain",
    "start": "3364880",
    "end": "3371680"
  },
  {
    "text": "your javascript should not call any azure api directly your javascript should only call your bff running on the",
    "start": "3371680",
    "end": "3378400"
  },
  {
    "text": "same host and then you would need to uh",
    "start": "3378400",
    "end": "3383920"
  },
  {
    "text": "i don't know if you can use the proxy feature or i would be of the durand bff",
    "start": "3383920",
    "end": "3389680"
  },
  {
    "text": "and add request signing i think it might be possible or you would have to create a separate api here",
    "start": "3389680",
    "end": "3396880"
  },
  {
    "text": "that then calls there the next api",
    "start": "3396880",
    "end": "3401359"
  },
  {
    "text": "yes",
    "start": "3402079",
    "end": "3405079"
  },
  {
    "text": "whose job is it to keep track of refreshing tokens so let's see if we can bring up you remember how long token",
    "start": "3416000",
    "end": "3421839"
  },
  {
    "text": "lifetime do you remember what i said i used in this demo",
    "start": "3421839",
    "end": "3427200"
  },
  {
    "text": "so the api the token here let's where are",
    "start": "3427760",
    "end": "3433119"
  },
  {
    "text": "my mouse the tokens should definitely be expired by now",
    "start": "3433119",
    "end": "3438160"
  },
  {
    "text": "but it still works this is built into the bff component the bff components use is the identity modal",
    "start": "3438160",
    "end": "3446000"
  },
  {
    "text": "library for token management and the identity mobile library contains automatic token refreshing",
    "start": "3446000",
    "end": "3453839"
  },
  {
    "text": "so when using server side components we can use the identity mode library that will",
    "start": "3453839",
    "end": "3459280"
  },
  {
    "text": "keep trying when an access token is retrieved you get a lifetime back from the authorization server the identity",
    "start": "3459280",
    "end": "3466079"
  },
  {
    "text": "model keeps track of that and if the expiry time has passed it will automatically use the refresh token to",
    "start": "3466079",
    "end": "3472559"
  },
  {
    "text": "get a new access token for you so you never see that part of the handshakes",
    "start": "3472559",
    "end": "3479119"
  },
  {
    "text": "the refresh token is something that is gotten on the original sign in from the",
    "start": "3480960",
    "end": "3486000"
  },
  {
    "text": "authorization server i do get the refresh token yes at the back",
    "start": "3486000",
    "end": "3492480"
  },
  {
    "text": "uh so the the access token refresh token where are they actually stored",
    "start": "3499200",
    "end": "3505200"
  },
  {
    "text": "that is a good question and i'm feeling like it jumped you know i did a two-day workshop of these concepts and i feel",
    "start": "3505440",
    "end": "3511839"
  },
  {
    "text": "like i kind of jumped over one day 1.8 of the day",
    "start": "3511839",
    "end": "3517599"
  },
  {
    "text": "and just kept this part uh so the short answer is that they are in the cookie and the cook is encrypted with",
    "start": "3517599",
    "end": "3525680"
  },
  {
    "text": "data protection and is a key that is only available to the bff so even if",
    "start": "3525680",
    "end": "3531119"
  },
  {
    "text": "it's in the cookie there is no way for the browser to read it and use it and besides the",
    "start": "3531119",
    "end": "3537280"
  },
  {
    "text": "cookie is also http only so any evil javascript will not be able to read the cookie",
    "start": "3537280",
    "end": "3545838"
  },
  {
    "text": "if it is a good good the question if i got it it's a bit hard",
    "start": "3559599",
    "end": "3565839"
  },
  {
    "text": "to hear it but if i got it right it was is would it be a good idea to store the tokens in a database or regis cache",
    "start": "3565839",
    "end": "3573599"
  },
  {
    "text": "yes you should do that because then you get server-side sessions and then you can do server-side",
    "start": "3573599",
    "end": "3581920"
  },
  {
    "text": "you can evaluate the fresh check you can you should revoke the token sign out there are more things to this especially",
    "start": "3582000",
    "end": "3588480"
  },
  {
    "text": "on the logout side that i simply don't have time to show you right now so one final question here",
    "start": "3588480",
    "end": "3597960"
  },
  {
    "text": "nearly uh so i'll repeat the question uh",
    "start": "3627440",
    "end": "3633119"
  },
  {
    "text": "so this is the handshake that happens the server redirects the user to the",
    "start": "3633119",
    "end": "3639359"
  },
  {
    "text": "uh authorization server sorry i should maybe have this slide instead it's the pixie flow so the so",
    "start": "3639359",
    "end": "3646160"
  },
  {
    "text": "there is a front channel redirect back and forth happening first what is actually passing over the",
    "start": "3646160",
    "end": "3652000"
  },
  {
    "text": "browser is only the authorization code it's an identifier representing the authentication happening",
    "start": "3652000",
    "end": "3659520"
  },
  {
    "text": "and then there is a back channel called directly from the server side to the sds",
    "start": "3659520",
    "end": "3665200"
  },
  {
    "text": "to retrieve the tokens the tokens are never exposed in the",
    "start": "3665200",
    "end": "3670559"
  },
  {
    "text": "browser yes so if we look at this the the tokens are all the token handshakes are happening",
    "start": "3670559",
    "end": "3677040"
  },
  {
    "text": "entirely on a back channel you just get this authorization code",
    "start": "3677040",
    "end": "3682880"
  },
  {
    "text": "it's a one-time thing and also proof key code exchange contains a code verifier that means that",
    "start": "3682880",
    "end": "3689920"
  },
  {
    "text": "the server has a one-time secret that is needed to be able to retrieve the token",
    "start": "3689920",
    "end": "3695040"
  },
  {
    "text": "on the first time so even if you steal the code if or i steal the code i cannot exchange it in any way",
    "start": "3695040",
    "end": "3702960"
  },
  {
    "text": "because i need the code verifier that only the initiating server has",
    "start": "3702960",
    "end": "3708400"
  },
  {
    "text": "so i'm sorry but i think we are running out of time aren't we",
    "start": "3708400",
    "end": "3714000"
  },
  {
    "text": "and i guess i have another speaker that will be upset so i'll be available if i continue i will be available outside for",
    "start": "3714000",
    "end": "3720400"
  },
  {
    "text": "any more questions but thank you so much for having me and enjoy your cookies",
    "start": "3720400",
    "end": "3727078"
  }
]