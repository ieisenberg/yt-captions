[
  {
    "start": "0",
    "end": "146000"
  },
  {
    "text": "okay let's get started um hello everyone welcome it's last day",
    "start": "2159",
    "end": "7359"
  },
  {
    "text": "last session so very uh excited um a little bit of",
    "start": "7359",
    "end": "13679"
  },
  {
    "text": "logistics in the beginning so if you if you want to ask any questions uh by voice",
    "start": "13679",
    "end": "18720"
  },
  {
    "text": "you can uh we can do it at the end of the session otherwise i have slug channel here so if",
    "start": "18720",
    "end": "25519"
  },
  {
    "text": "you have any question you can just write them on slug uh",
    "start": "25519",
    "end": "32000"
  },
  {
    "text": "so that's all about logistics let's get started um welcome everyone",
    "start": "32000",
    "end": "39120"
  },
  {
    "text": "my name is evgeny barzenian i'm a cloud solution architect and consultant",
    "start": "39120",
    "end": "44640"
  },
  {
    "text": "company called enso and today i'm going to talk about immutable infrastructure on azure and on",
    "start": "44640",
    "end": "51440"
  },
  {
    "text": "vips just to set some expectations for this",
    "start": "51440",
    "end": "56480"
  },
  {
    "text": "talk this talk is mainly an experience report of our journey towards immutable infrastructure in vips for the",
    "start": "56480",
    "end": "63359"
  },
  {
    "text": "past two years and i actually had the privilege to be part of team platform and be part of",
    "start": "63359",
    "end": "68880"
  },
  {
    "text": "this journey so this is my first talk uh on such a big conference so i'm both",
    "start": "68880",
    "end": "74640"
  },
  {
    "text": "really excited and extremely uh stressful so but first let's start with",
    "start": "74640",
    "end": "83119"
  },
  {
    "text": "vips so for those of you who live in norway i don't need to introduce weeps you know what whips",
    "start": "83119",
    "end": "88640"
  },
  {
    "text": "is for those of you who don't live in norway beeps is um a number one mobile payment solution",
    "start": "88640",
    "end": "95360"
  },
  {
    "text": "in norway so and it becomes so popular that lips now become a verb so in norway we",
    "start": "95360",
    "end": "103439"
  },
  {
    "text": "don't send money we whips money seventy percent popular population use",
    "start": "103439",
    "end": "109200"
  },
  {
    "text": "weeps every day and that gives us a 3.6 million active user",
    "start": "109200",
    "end": "115200"
  },
  {
    "text": "and more than 100 thousands of companies using dips so vips is expanding the business and",
    "start": "115200",
    "end": "121600"
  },
  {
    "text": "now you not only can transfer money to your friends but also can pay with whips for your tickets on the",
    "start": "121600",
    "end": "129759"
  },
  {
    "text": "bus or from a web shop and vips operates it's very competitive",
    "start": "129759",
    "end": "137200"
  },
  {
    "text": "market and it's really important that we have a very stable and real reliable",
    "start": "137200",
    "end": "143680"
  },
  {
    "text": "infrastructure so veeps constantly release new features",
    "start": "143680",
    "end": "149520"
  },
  {
    "start": "146000",
    "end": "146000"
  },
  {
    "text": "it improves existing functionality so basically it's changing and evolving and so does the infrastructure so it all",
    "start": "149520",
    "end": "157599"
  },
  {
    "text": "starts with um uh on-prem version on the embed because denver was the bank that",
    "start": "157599",
    "end": "162959"
  },
  {
    "text": "initially started peeps as a product so and on the embed it was a bunch of",
    "start": "162959",
    "end": "169360"
  },
  {
    "text": "java applications running on [Music] virtual machines so and then",
    "start": "169360",
    "end": "176879"
  },
  {
    "text": "it was lift and shift to azure and that's when vip started the journey towards azure so and lift and shift means that",
    "start": "176879",
    "end": "184400"
  },
  {
    "text": "it was the same virtual machines and same uh java applications but now they were",
    "start": "184400",
    "end": "189440"
  },
  {
    "text": "running on azure then vip started to decompose the",
    "start": "189440",
    "end": "195920"
  },
  {
    "text": "monolithic application and introduce microservices and then start containerize those services",
    "start": "195920",
    "end": "201360"
  },
  {
    "text": "and at that time aks was not mature enough product and therefore vips uses a dtos",
    "start": "201360",
    "end": "208319"
  },
  {
    "text": "kubernetes platform and from infrastructure perspective this dc os was",
    "start": "208319",
    "end": "213840"
  },
  {
    "text": "a bunch of virtual machines maintained by bips where all containers were running so and",
    "start": "213840",
    "end": "220319"
  },
  {
    "text": "therefore it was a very very logical step to then migrate from dc os to aks",
    "start": "220319",
    "end": "227519"
  },
  {
    "text": "because aks it's a managed kubernetes service on azure",
    "start": "227519",
    "end": "232959"
  },
  {
    "text": "so and that was next step and the last thing and that's where we are now we call it embrace the cloud and",
    "start": "232959",
    "end": "238959"
  },
  {
    "text": "basically we're trying to adapt our system and restructure re-implement things and we try to",
    "start": "238959",
    "end": "245920"
  },
  {
    "text": "utilize azure as effectively as possible and now if we climb up and uh look at",
    "start": "245920",
    "end": "253840"
  },
  {
    "text": "the vip's infrastructure from bird's perspective so what we see is that first of all it's",
    "start": "253840",
    "end": "260880"
  },
  {
    "text": "100 on cloud and it's hundred percent on azure so and that's infrastructure how it looks",
    "start": "260880",
    "end": "267120"
  },
  {
    "text": "now as i said before it was a lot of evolutions but still now it's a good mix of",
    "start": "267120",
    "end": "273680"
  },
  {
    "text": "infrastructure as a service see here so where we have some support systems or some legacy",
    "start": "273680",
    "end": "279520"
  },
  {
    "text": "stuff running then it's a platform as a service with a variety of",
    "start": "279520",
    "end": "286000"
  },
  {
    "text": "the products we use sql server cosmos db storage account for data storage we use a key vote for",
    "start": "286000",
    "end": "293840"
  },
  {
    "text": "sensitive data for example event hub service bus for messaging and pops up and many many",
    "start": "293840",
    "end": "302000"
  },
  {
    "text": "more other products ninety percent of uh workload in bibs run on ats kubernetes",
    "start": "302000",
    "end": "310479"
  },
  {
    "text": "service and 100 percent of api is exposed with",
    "start": "310479",
    "end": "316080"
  },
  {
    "text": "api management and 90 means that some of the workload is",
    "start": "316080",
    "end": "322000"
  },
  {
    "text": "not running on aks and that's why some of the teams who are autonomous they decided that",
    "start": "322000",
    "end": "328080"
  },
  {
    "text": "the application that they developed they doesn't fit well in aks and they for example use azure functions",
    "start": "328080",
    "end": "334160"
  },
  {
    "text": "or azure services for for their workload so that that's why it's only 90 yeah and then for",
    "start": "334160",
    "end": "343039"
  },
  {
    "text": "cicd pipelines we use azure devops but today we're going to talk about this",
    "start": "343039",
    "end": "349039"
  },
  {
    "text": "guy in the middle so something we called vce and let's uh talk about it in more details so vc",
    "start": "349039",
    "end": "357199"
  },
  {
    "start": "355000",
    "end": "355000"
  },
  {
    "text": "stands for vip score engine and vip score engine is basically a set of infrastructure",
    "start": "357199",
    "end": "363120"
  },
  {
    "text": "components uh treated as a one unit so it consists of a private virtual",
    "start": "363120",
    "end": "369840"
  },
  {
    "text": "network with a predefined set of uh subnets",
    "start": "369840",
    "end": "375120"
  },
  {
    "text": "and network security group associated to the subnets some pairings with another private v-net",
    "start": "375120",
    "end": "382319"
  },
  {
    "text": "for integration or for different support systems",
    "start": "382319",
    "end": "389039"
  },
  {
    "text": "it's a aks with today we have more than 100 deployment units or services and as i",
    "start": "389120",
    "end": "396240"
  },
  {
    "text": "said it's 90 percent of workload running on aks aks deployment model",
    "start": "396240",
    "end": "401360"
  },
  {
    "text": "is deployed into private v-net that means that it's not publicly",
    "start": "401360",
    "end": "406840"
  },
  {
    "text": "accessible and to expose a functionality of the applications running on aks",
    "start": "406840",
    "end": "412160"
  },
  {
    "text": "we use api management and today we have more than 100 apis deployed to apim",
    "start": "412160",
    "end": "419520"
  },
  {
    "text": "again a pm deployment model is that it deployed into private vinnette so it's not",
    "start": "419520",
    "end": "424880"
  },
  {
    "text": "publicly available and to secure securely expose publicly phased apis",
    "start": "424880",
    "end": "432479"
  },
  {
    "text": "we use application gateway and as i said we have much much more",
    "start": "432479",
    "end": "437680"
  },
  {
    "text": "stuff we have application inside for application insight and log analytics for logs and performance metrics uh we use",
    "start": "437680",
    "end": "445520"
  },
  {
    "text": "uh keyboard for sensitive data and manage the identities and a bunch of other stuff so",
    "start": "445520",
    "end": "453520"
  },
  {
    "text": "and this version that i'm showing now here is very strict view of kind of the real components but",
    "start": "453520",
    "end": "460240"
  },
  {
    "text": "uh at the same time it gives us some sense of uh complexity that we operate with",
    "start": "460240",
    "end": "467759"
  },
  {
    "text": "so now let's uh see with the such setup what kind of operational tasks we",
    "start": "467759",
    "end": "473759"
  },
  {
    "text": "may expect and what kind of challenges will give us",
    "start": "473759",
    "end": "480240"
  },
  {
    "text": "so basically vce started when we did the migration from dc os to aks",
    "start": "480720",
    "end": "488479"
  },
  {
    "start": "481000",
    "end": "481000"
  },
  {
    "text": "so and that's basically we we provision a new cluster we migrated all services from dcos to aps",
    "start": "488479",
    "end": "495280"
  },
  {
    "text": "and then yeah somewhere in middle of 2019 this first version of vce was uh was",
    "start": "495280",
    "end": "502800"
  },
  {
    "text": "out and since this is aks uh one thing you need to know about aks",
    "start": "502800",
    "end": "508879"
  },
  {
    "text": "is that um the support model in aks works the way that uh every time when aks product team",
    "start": "508879",
    "end": "514880"
  },
  {
    "text": "releases a new version a major version so they terminate support for",
    "start": "514880",
    "end": "520000"
  },
  {
    "text": "previous versions so for example this week they release this 1.17 and that means that 1.14 version is",
    "start": "520000",
    "end": "529600"
  },
  {
    "text": "out of support soon so we are not an exception so we when we had this in",
    "start": "529600",
    "end": "536240"
  },
  {
    "text": "production so at some point we needed to to upgrade our cluster so and we were in",
    "start": "536240",
    "end": "542320"
  },
  {
    "text": "production so all traffic is actively going through so now we need to upgrade so what do we",
    "start": "542320",
    "end": "548240"
  },
  {
    "text": "do so basically it's very simple you go to either portal or you run the script or",
    "start": "548240",
    "end": "553519"
  },
  {
    "text": "you run the arm template or you run a terraform or whatever that depends how you maintain your",
    "start": "553519",
    "end": "558640"
  },
  {
    "text": "infrastructure somehow you trigger the upgrade and then in our case three hours later",
    "start": "558640",
    "end": "565440"
  },
  {
    "text": "we are running on the next version so one thing to point here is that we",
    "start": "565440",
    "end": "571920"
  },
  {
    "text": "did it with active traffic going through the system so we did it on the same resource group",
    "start": "571920",
    "end": "579440"
  },
  {
    "text": "we did it on the same v-net so basically we just updated existing uh",
    "start": "579440",
    "end": "584640"
  },
  {
    "text": "kubernetes instance so when we sometimes it works fine sometimes we had",
    "start": "584640",
    "end": "591040"
  },
  {
    "text": "some issues but in general it was okay so and then uh sometimes after we",
    "start": "591040",
    "end": "597600"
  },
  {
    "start": "595000",
    "end": "595000"
  },
  {
    "text": "run things in production we realize that we actually over provision our cluster",
    "start": "597600",
    "end": "604480"
  },
  {
    "text": "so the choice that we made on the size of the vm instance was wrong so",
    "start": "604480",
    "end": "611680"
  },
  {
    "text": "basically we over provisional cluster and aks is the product that",
    "start": "611680",
    "end": "617279"
  },
  {
    "text": "some of the things you can update but some of the things you can't and you if you need to for example",
    "start": "617279",
    "end": "623600"
  },
  {
    "text": "change your vm size you need to reprovision your cluster",
    "start": "623600",
    "end": "629360"
  },
  {
    "text": "so and so we we we needed to do it and how do we do it so we need a new subnet",
    "start": "629360",
    "end": "635920"
  },
  {
    "text": "then we need to deploy a new instance of a case cluster so then we need to",
    "start": "635920",
    "end": "643040"
  },
  {
    "text": "deploy all our applications and services so then we need to test services",
    "start": "643040",
    "end": "649279"
  },
  {
    "text": "so actually here we like the active traffic is going that way now we have another instance of",
    "start": "649279",
    "end": "657200"
  },
  {
    "text": "kubernetes running in isolation and we have some possibility to test actually so we",
    "start": "657200",
    "end": "662800"
  },
  {
    "text": "not able to do end-to-end testing because like otherwise we need two more components of things here",
    "start": "662800",
    "end": "669200"
  },
  {
    "text": "but we do possibility to have some testing of how our applications are running on new cluster",
    "start": "669200",
    "end": "676079"
  },
  {
    "text": "so and when we are confident with our services we we do switch so we're switching from",
    "start": "676079",
    "end": "681200"
  },
  {
    "text": "on apm and pointing all traffic to new backend or a new aks cluster",
    "start": "681200",
    "end": "688480"
  },
  {
    "text": "so for example if something goes wrong we can always switch back so but if we are happy with how things",
    "start": "688480",
    "end": "694720"
  },
  {
    "text": "work we can just decommission the old one and yeah we are running production",
    "start": "694720",
    "end": "703839"
  },
  {
    "text": "then shortly after we release we see one application gateway version two was released and",
    "start": "703920",
    "end": "710240"
  },
  {
    "start": "704000",
    "end": "704000"
  },
  {
    "text": "version two was much much better than version one so first of all they improved the operational",
    "start": "710240",
    "end": "716000"
  },
  {
    "text": "performance so things that took 20 minutes on version one now takes",
    "start": "716000",
    "end": "721200"
  },
  {
    "text": "six minutes still a lot but much better and also they uh the upgateway team they introduce",
    "start": "721200",
    "end": "730240"
  },
  {
    "text": "a few very practical features like auto scaling zone redundancy and ability to",
    "start": "730240",
    "end": "738800"
  },
  {
    "text": "configure your update way that ssl certificate is from keyboard and then",
    "start": "738959",
    "end": "746240"
  },
  {
    "text": "when you need to renew your certificate you do it on the keyboard and then you don't need to do anything on the application gateway so basically",
    "start": "746240",
    "end": "752880"
  },
  {
    "text": "we decided yes we want to upgrade and how do we do it so version 1 of gateway and version 2",
    "start": "752880",
    "end": "759040"
  },
  {
    "text": "they cannot be deployed to the same subnet then we need another subnet then we",
    "start": "759040",
    "end": "764320"
  },
  {
    "text": "deploy application gateway so traffic is still going through",
    "start": "764320",
    "end": "769680"
  },
  {
    "text": "the old one and now actually we have this ability to do some end-to-end testing because now we can uh",
    "start": "769680",
    "end": "776240"
  },
  {
    "text": "have a mobile application that for example calls uh and we can test new update way or",
    "start": "776240",
    "end": "783440"
  },
  {
    "text": "we can test how system works within your gateway without affecting the existing customers and",
    "start": "783440",
    "end": "789279"
  },
  {
    "text": "existing setup so we do some testing if we are happy we switch the traffic to",
    "start": "789279",
    "end": "796240"
  },
  {
    "text": "the new instance we can keep the old one for a while because if something goes wrong we can switch back",
    "start": "796240",
    "end": "802320"
  },
  {
    "text": "and then we do clean up and we remove the old instance",
    "start": "802320",
    "end": "809519"
  },
  {
    "start": "810000",
    "end": "810000"
  },
  {
    "text": "so basically we were running things in production we did some several retrospectives and what we had",
    "start": "810000",
    "end": "817120"
  },
  {
    "text": "to identify is that so the upgrade operation",
    "start": "817120",
    "end": "822959"
  },
  {
    "text": "was a very very high risk operation because you upgrade instance",
    "start": "822959",
    "end": "829600"
  },
  {
    "text": "which is running uh in production with active traffic and for example if upgrade fails",
    "start": "829600",
    "end": "836320"
  },
  {
    "text": "then vips is down and that's definitely something we don't want beeps to be so and because of that",
    "start": "836320",
    "end": "843120"
  },
  {
    "text": "because of this active traffic and high risk uh the aks upgrade needs to be",
    "start": "843120",
    "end": "848320"
  },
  {
    "text": "coordinated with the command center and we need to find maintenance window when we allow to do it",
    "start": "848320",
    "end": "854800"
  },
  {
    "text": "we need to identify what is the point in time when we have the minimum amount of",
    "start": "854800",
    "end": "860800"
  },
  {
    "text": "traffic through the system and that's normally weekend at night",
    "start": "860800",
    "end": "867199"
  },
  {
    "text": "it also very high stress operation because the person who is doing this upgrade so imagine",
    "start": "867199",
    "end": "874000"
  },
  {
    "text": "that you are this person and it's night and you click this upgrade button",
    "start": "874000",
    "end": "879360"
  },
  {
    "text": "and then for the next three hours you have no idea how things will be so it may be okay but it might be some",
    "start": "879360",
    "end": "885519"
  },
  {
    "text": "issues so and that like high stress high risk operation gives us kind of the feeling of fear to upgrade",
    "start": "885519",
    "end": "892959"
  },
  {
    "text": "so we want to postpone this small moment as long as possible so and also",
    "start": "892959",
    "end": "898160"
  },
  {
    "text": "with aks upgrade we we we can't do end-to-end testing and that's",
    "start": "898160",
    "end": "906240"
  },
  {
    "text": "about upgrade and then uh at the same time aks reprovisioning was a completely different story so even",
    "start": "906240",
    "end": "912320"
  },
  {
    "text": "though it sounds like oh a reprovisioning so that's very complicated thing but in reality it was very good thing because",
    "start": "912320",
    "end": "919040"
  },
  {
    "text": "it was very low risk operation because like we have uh the current traffic",
    "start": "919040",
    "end": "925040"
  },
  {
    "text": "going to the old one we can provision new uh aks in isolation we can test things before we switch the",
    "start": "925040",
    "end": "931120"
  },
  {
    "text": "traffic and yeah so you can do it actually on daytime so you don't need to find this",
    "start": "931120",
    "end": "937279"
  },
  {
    "text": "maintenance window so it was very good experience at the same time so still was not possible to",
    "start": "937279",
    "end": "942720"
  },
  {
    "text": "do end-to-end testing uh because the cluster is sitting uh in isolation in private v-net",
    "start": "942720",
    "end": "949759"
  },
  {
    "text": "but in in in general it was very positive experience uh same with application gateway version",
    "start": "949759",
    "end": "956320"
  },
  {
    "text": "two so it was a very low risk operation you introduce new instance in isolation you can test",
    "start": "956320",
    "end": "961920"
  },
  {
    "text": "it before you open it up for the active users and in this time it was even possible to do",
    "start": "961920",
    "end": "968079"
  },
  {
    "text": "end-to-end testing and in neither of those three scenarios canary testing was not possible",
    "start": "968079",
    "end": "975440"
  },
  {
    "text": "so and at that time we start to plan uh what how do we want our vc",
    "start": "975440",
    "end": "982320"
  },
  {
    "text": "the next version to look like and that was the time when we started to",
    "start": "982320",
    "end": "988959"
  },
  {
    "text": "look into mutable versus immutable so what is mutable what is immutable",
    "start": "988959",
    "end": "994800"
  },
  {
    "text": "and just to kind of properly introduce this term uh let's look at what is mutable",
    "start": "994800",
    "end": "1001440"
  },
  {
    "start": "1000000",
    "end": "1000000"
  },
  {
    "text": "infrastructure so mutable infrastructure means that infrastructure that liable to change",
    "start": "1001440",
    "end": "1007120"
  },
  {
    "text": "so it's a infrastructure that is capable of being modified and updated in place on a",
    "start": "1007120",
    "end": "1013440"
  },
  {
    "text": "regular basis so and if you if you look back to our vc1",
    "start": "1013440",
    "end": "1019440"
  },
  {
    "text": "version 1 version so that that was definitely mutable infrastructure because when we",
    "start": "1019440",
    "end": "1026480"
  },
  {
    "text": "upgraded our aks cluster that was a same cluster that we upgraded",
    "start": "1026480",
    "end": "1031520"
  },
  {
    "text": "at the same v-net at the same resource group and same goes with um",
    "start": "1031520",
    "end": "1039520"
  },
  {
    "text": "when we introduce a new cluster or a new application gateway so when we added",
    "start": "1039520",
    "end": "1045438"
  },
  {
    "text": "subnets that also was a fact of mutability because we we changed existing v-net configuration",
    "start": "1045439",
    "end": "1054160"
  },
  {
    "text": "so and just to repeat uh the things that associated with uh mutable infrastructure that's high risk",
    "start": "1054160",
    "end": "1061200"
  },
  {
    "text": "operation because you changing thing that already serving traffic it's high stress",
    "start": "1061200",
    "end": "1070320"
  },
  {
    "text": "and you feel to upgrade you need to find maintenance window and in our case we can do end-to-end",
    "start": "1070320",
    "end": "1077120"
  },
  {
    "text": "testing at the same time immutable infrastructure is kind of opposite so",
    "start": "1077120",
    "end": "1082640"
  },
  {
    "text": "it's antonin to mutable so immutable means that unchanging or unable to change or this",
    "start": "1082640",
    "end": "1088799"
  },
  {
    "text": "is infrastructure that once being provisioned cannot be modified so you never change",
    "start": "1088799",
    "end": "1094000"
  },
  {
    "text": "it so you if you need to change you provision new infrastructure",
    "start": "1094000",
    "end": "1099039"
  },
  {
    "text": "so if we look at the vce1 this is also a little bit of immutable as well",
    "start": "1099440",
    "end": "1104799"
  },
  {
    "text": "because when we introduce when we reprovision our cluster a case cluster and when we added new instance",
    "start": "1104799",
    "end": "1110480"
  },
  {
    "text": "of application gateway that was an act of immutability because we didn't upgrade the existing instances we",
    "start": "1110480",
    "end": "1116559"
  },
  {
    "text": "introduced new instances so and with those two terms in place we",
    "start": "1116559",
    "end": "1122240"
  },
  {
    "text": "started to plan our v next iteration of our infrastructure components and we said",
    "start": "1122240",
    "end": "1128960"
  },
  {
    "start": "1123000",
    "end": "1123000"
  },
  {
    "text": "that we want vc to be immutable so that means that",
    "start": "1128960",
    "end": "1134640"
  },
  {
    "text": "when it comes to aks so either this is upgrade or reprovisioning for us that's we",
    "start": "1134640",
    "end": "1141440"
  },
  {
    "text": "treated us the same operation so we also said that we want",
    "start": "1141440",
    "end": "1147039"
  },
  {
    "text": "to be able to very easily introduce or replace components in our infrastructure so we",
    "start": "1147039",
    "end": "1154080"
  },
  {
    "text": "also want to have possibility to do end-to-end testing before we open the",
    "start": "1154080",
    "end": "1160080"
  },
  {
    "text": "system for the users and we want to be able to send a small percentage of",
    "start": "1160080",
    "end": "1166320"
  },
  {
    "text": "the traffic to the new infrastructure and see how system uh react and work under under the new",
    "start": "1166320",
    "end": "1172720"
  },
  {
    "text": "infrastructure so then we designed defined some conventions",
    "start": "1172720",
    "end": "1180160"
  },
  {
    "start": "1176000",
    "end": "1176000"
  },
  {
    "text": "so we introduce a concept of slot so that means that each environment will",
    "start": "1180320",
    "end": "1186000"
  },
  {
    "text": "have two slots blue and green and also one resource group will be base",
    "start": "1186000",
    "end": "1191919"
  },
  {
    "text": "where all shared components and resources will be deployed an example of these shared components",
    "start": "1191919",
    "end": "1197200"
  },
  {
    "text": "will be log analytics application site keyboard and other",
    "start": "1197200",
    "end": "1202559"
  },
  {
    "text": "things but slots that's basically um",
    "start": "1202559",
    "end": "1208400"
  },
  {
    "text": "it contains same amount of infrastructure components and uh at some time they can be actually",
    "start": "1208400",
    "end": "1214960"
  },
  {
    "text": "running in parallel when we do switch and now with this convention and",
    "start": "1214960",
    "end": "1220960"
  },
  {
    "start": "1220000",
    "end": "1220000"
  },
  {
    "text": "definition and requirements let's see how how upgrade lifecycle will",
    "start": "1220960",
    "end": "1226480"
  },
  {
    "text": "look like in this new infrastructure so let's say we are running blue as active production",
    "start": "1226480",
    "end": "1233840"
  },
  {
    "text": "environment now and we are running on version for example 115.10",
    "start": "1233840",
    "end": "1240000"
  },
  {
    "text": "i guess and we want to upgrade so what we do we actually provision a",
    "start": "1240000",
    "end": "1246000"
  },
  {
    "text": "completely isolated set of infrastructure components exactly the same uh",
    "start": "1246000",
    "end": "1252159"
  },
  {
    "text": "same resource group but of course with different name same set of v-net with subnets",
    "start": "1252159",
    "end": "1257760"
  },
  {
    "text": "application gateway api aks so then we deploy services so in our case we uh export from",
    "start": "1257760",
    "end": "1265679"
  },
  {
    "text": "aks and import to a new one with apim what we did we backup and",
    "start": "1265679",
    "end": "1271760"
  },
  {
    "text": "restore so then you do end-to-end testing so we can",
    "start": "1271760",
    "end": "1277200"
  },
  {
    "text": "test it from here and the active traffic still going that direction and then we",
    "start": "1277200",
    "end": "1283280"
  },
  {
    "text": "can actually can do a canary testing so we can say okay i want 10 of the traffic go to green and ninety",
    "start": "1283280",
    "end": "1290000"
  },
  {
    "text": "percent of the traffic uh still go to uh to blue",
    "start": "1290000",
    "end": "1295280"
  },
  {
    "text": "so and then for example we run it for a while if you see that things works great we can send hundred percent",
    "start": "1295280",
    "end": "1302320"
  },
  {
    "text": "traffic to the green we can still keep blue for a while because if you see that green doesn't work we can always get",
    "start": "1302320",
    "end": "1309280"
  },
  {
    "text": "back to the blue and eventually we can decommission the the blue infrastructure so and and now the green one is the",
    "start": "1309280",
    "end": "1317280"
  },
  {
    "text": "active environment so now let's say we we want to introduce",
    "start": "1317280",
    "end": "1323120"
  },
  {
    "text": "new component we want to have another instance of application gateway that will",
    "start": "1323120",
    "end": "1328720"
  },
  {
    "text": "communicate with aks directly by passing the api so how do we do it we provision new",
    "start": "1328720",
    "end": "1335039"
  },
  {
    "text": "infrastructure so now we see we have two instances and this one talks directly to aks",
    "start": "1335039",
    "end": "1343520"
  },
  {
    "text": "we deploy our services now we export from green import to blue backup from green restore to blue",
    "start": "1343520",
    "end": "1352320"
  },
  {
    "text": "we do end-to-end testing we do canary testing and if things go as we plan a hundred",
    "start": "1352320",
    "end": "1360400"
  },
  {
    "text": "percent switch and decommission the old environment so now we are on blue and then next",
    "start": "1360400",
    "end": "1367360"
  },
  {
    "text": "infrastructure change we do on green and then blue green blue green and then it's basically",
    "start": "1367360",
    "end": "1374240"
  },
  {
    "text": "never endless loop and it was very positive experience so",
    "start": "1374240",
    "end": "1379360"
  },
  {
    "start": "1377000",
    "end": "1377000"
  },
  {
    "text": "basically now all our operations are low risk operation we can do things",
    "start": "1379360",
    "end": "1385520"
  },
  {
    "text": "anytime we want so we can we can plan it and we can apply that date time so it's like zero",
    "start": "1385520",
    "end": "1392000"
  },
  {
    "text": "stress operations we can test things both without affecting the",
    "start": "1392000",
    "end": "1397360"
  },
  {
    "text": "existing users and actually sending the users to the new infrastructure like small percentage of traffic",
    "start": "1397360",
    "end": "1405679"
  },
  {
    "text": "it gives us flexibility because now we can do things when we want how we want and",
    "start": "1405679",
    "end": "1412799"
  },
  {
    "text": "for the system as a whole it gives us a stability because system is much more stable so we we we",
    "start": "1412799",
    "end": "1418400"
  },
  {
    "text": "can upgrade things without almost close to zero downtime",
    "start": "1418400",
    "end": "1424480"
  },
  {
    "text": "and for us as a team platform it gives us a confidence that we yes we can do these things yes we can",
    "start": "1424480",
    "end": "1430400"
  },
  {
    "text": "upgrade our infrastructure yes we can replace component without being afraid that",
    "start": "1430400",
    "end": "1435760"
  },
  {
    "text": "we can affecting our customers",
    "start": "1435760",
    "end": "1440720"
  },
  {
    "text": "and of course nothing comes for free and the cost here is complexity",
    "start": "1441039",
    "end": "1446559"
  },
  {
    "text": "complexity means that we have multiple environments so we have for example test then q a",
    "start": "1446559",
    "end": "1454720"
  },
  {
    "text": "stage production and for each environment now we have we may have a two set of infrastructure",
    "start": "1454720",
    "end": "1461919"
  },
  {
    "text": "components running uh simultaneously when we do the switch or if we enable canary uh traffic",
    "start": "1461919",
    "end": "1468790"
  },
  {
    "text": "[Music] so it also requires really really heavy investment into automation",
    "start": "1468790",
    "end": "1475279"
  },
  {
    "text": "including provisioning post provisioning configuration and deployment",
    "start": "1475279",
    "end": "1481278"
  },
  {
    "text": "it also requires quite good coverage of end-to-end automation testing because if",
    "start": "1482400",
    "end": "1488720"
  },
  {
    "text": "you don't have end-to-end testing then you need to coordinate with product teams",
    "start": "1488720",
    "end": "1495679"
  },
  {
    "text": "and then you need to have a representative from each product team",
    "start": "1495679",
    "end": "1500720"
  },
  {
    "text": "during this switch because when we switch our infrastructure we need to be able to test our",
    "start": "1500720",
    "end": "1506320"
  },
  {
    "text": "functionality and we as a team platform we have no idea how things work that's responsibility of product",
    "start": "1506320",
    "end": "1511679"
  },
  {
    "text": "teams if we can avoid this that's better because if you have dependency to other",
    "start": "1511679",
    "end": "1517360"
  },
  {
    "text": "teams then coordinating between teams that's always a hassle and of course your application",
    "start": "1517360",
    "end": "1524720"
  },
  {
    "text": "should be immutable ready so you but normally if you are in aks then most",
    "start": "1524720",
    "end": "1531039"
  },
  {
    "text": "likely you already your applications already for be immutable because they will be running",
    "start": "1531039",
    "end": "1536480"
  },
  {
    "text": "on not now in multiple ports but can be multiple ports on multiple clusters",
    "start": "1536480",
    "end": "1543039"
  },
  {
    "text": "but still we actually hit some cases when um it was some batches that were running",
    "start": "1543039",
    "end": "1550080"
  },
  {
    "text": "very frequently sorry very rarely so for example every night and then",
    "start": "1550080",
    "end": "1555279"
  },
  {
    "text": "suddenly when we had the two clusters like the same batch run on both uh clusters and then",
    "start": "1555279",
    "end": "1561919"
  },
  {
    "text": "uh the batch itself was not uh ready to be run on multiple places and then it was some issues so just be aware",
    "start": "1561919",
    "end": "1569120"
  },
  {
    "text": "of this and of course uh state so stateless components make your life much more easy",
    "start": "1569120",
    "end": "1574559"
  },
  {
    "text": "because yeah you should try to avoid any sort of state in your infrastructure",
    "start": "1574559",
    "end": "1580159"
  },
  {
    "text": "and in our case we were very lucky because all services that we run on aks they are stateless so that means that",
    "start": "1580159",
    "end": "1586400"
  },
  {
    "text": "we can just move them to a new cluster without any issues",
    "start": "1586400",
    "end": "1591520"
  },
  {
    "text": "right and in fact the production environment we did this",
    "start": "1592880",
    "end": "1599279"
  },
  {
    "text": "switch on monday this week basically all other environments we",
    "start": "1599279",
    "end": "1604400"
  },
  {
    "text": "we did um several iterations because we first we deployed to blue then we",
    "start": "1604400",
    "end": "1610400"
  },
  {
    "text": "switched to green so basically we did uh two switches per environment and production we introduced it uh",
    "start": "1610400",
    "end": "1616559"
  },
  {
    "text": "monday this week which was very successful switch and now we currently start",
    "start": "1616559",
    "end": "1624159"
  },
  {
    "start": "1621000",
    "end": "1621000"
  },
  {
    "text": "planning the next iteration for these vce components and one of the things that we",
    "start": "1624159",
    "end": "1631440"
  },
  {
    "text": "i don't like in current setup is that this guy in the middle apim actually has a state so",
    "start": "1631440",
    "end": "1638320"
  },
  {
    "text": "apm has a database where uh subscriptions and user data is stored and during the switch that may",
    "start": "1638320",
    "end": "1645760"
  },
  {
    "text": "especially if you have a canary traffic that may cause us a problem because if",
    "start": "1645760",
    "end": "1651440"
  },
  {
    "text": "if you if we are testing some processes that involve creation of the resources",
    "start": "1651440",
    "end": "1656480"
  },
  {
    "text": "on the apim then we may have a kind of out of sync instances on blue",
    "start": "1656480",
    "end": "1662399"
  },
  {
    "text": "and green today we handle it by announcing uh on organization that we do switch and",
    "start": "1662399",
    "end": "1670399"
  },
  {
    "text": "please don't run those processes but in future we want it to be automatically solved by itself",
    "start": "1670399",
    "end": "1678720"
  },
  {
    "text": "and therefore we are planning to actually move apim from this blue green into this base",
    "start": "1678720",
    "end": "1686720"
  },
  {
    "text": "resource group but that that of course gives us some complexity because now traffic will",
    "start": "1686720",
    "end": "1692480"
  },
  {
    "text": "travel like from traffic manager to blue then out from blue back to base and then",
    "start": "1692480",
    "end": "1700720"
  },
  {
    "text": "back to blue and when we are in canary mode so then we actually need to implement",
    "start": "1700720",
    "end": "1707039"
  },
  {
    "text": "a policy on apim that will orchestrate the traffic between two",
    "start": "1707039",
    "end": "1712240"
  },
  {
    "text": "clusters that means that we need to be able to specify the percentage of the traffic",
    "start": "1712240",
    "end": "1717760"
  },
  {
    "text": "that we want on both places now on a front door or traffic manager and on",
    "start": "1717760",
    "end": "1723840"
  },
  {
    "text": "apim and another thing we want to replace is",
    "start": "1723840",
    "end": "1731120"
  },
  {
    "text": "we want to try front door instead of traffic manager but other than that so we were really",
    "start": "1731120",
    "end": "1737440"
  },
  {
    "text": "happy with our setup it gives us what we plan to implement and it works really really really great",
    "start": "1737440",
    "end": "1745200"
  },
  {
    "start": "1746000",
    "end": "1746000"
  },
  {
    "text": "now let's switch our gear towards infrastructures code because as i",
    "start": "1746960",
    "end": "1753520"
  },
  {
    "text": "mentioned uh before automation is really really important and it doesn't really matter whether you",
    "start": "1753520",
    "end": "1759760"
  },
  {
    "text": "have mutable or mutable infrastructure you should automate your infrastructure",
    "start": "1759760",
    "end": "1764799"
  },
  {
    "text": "and um and that's like infrastructure as called very popular term now and",
    "start": "1764799",
    "end": "1769919"
  },
  {
    "text": "uh what it means is basically you treat your infrastructure as code",
    "start": "1769919",
    "end": "1775600"
  },
  {
    "text": "it should be stored in source control and changes that you do on your",
    "start": "1775600",
    "end": "1780960"
  },
  {
    "text": "infrastructure should be done through pull request and then some of",
    "start": "1780960",
    "end": "1786320"
  },
  {
    "text": "your team members can do a review and",
    "start": "1786320",
    "end": "1792080"
  },
  {
    "text": "yes and when when the merge is done then your infrastructure should be deployed with",
    "start": "1792480",
    "end": "1798000"
  },
  {
    "text": "automated scripts or deployment pipelines and there are a bunch of",
    "start": "1798000",
    "end": "1803279"
  },
  {
    "text": "products in the market so arm templates therefore hdcli different sdk for different languages",
    "start": "1803279",
    "end": "1810080"
  },
  {
    "text": "powershell polyme and in fact in vips i think we use most of them because different teams",
    "start": "1810080",
    "end": "1817440"
  },
  {
    "text": "provision some of the teams they provision infrastructure themselves and then they they use terraform or they use for",
    "start": "1817440",
    "end": "1824159"
  },
  {
    "text": "example python script that generates arm template based on different uh",
    "start": "1824159",
    "end": "1829600"
  },
  {
    "text": "logic so but for vce we decided that we we're going to use",
    "start": "1829600",
    "end": "1835360"
  },
  {
    "text": "arm template as a deployment unit but since",
    "start": "1835360",
    "end": "1840559"
  },
  {
    "text": "nobody likes to work with arm templates we decided that we will implement a tool that will",
    "start": "1840559",
    "end": "1848960"
  },
  {
    "text": "uh generate arm templates for us based on on configuration that we define",
    "start": "1848960",
    "end": "1857360"
  },
  {
    "text": "and for we this tool we call it deployer and that's basically infrastructures",
    "start": "1857760",
    "end": "1862960"
  },
  {
    "start": "1859000",
    "end": "1859000"
  },
  {
    "text": "code for for our vc components and",
    "start": "1862960",
    "end": "1868640"
  },
  {
    "text": "here is some uh requirements that we got gathered for our deployer so first",
    "start": "1868640",
    "end": "1875840"
  },
  {
    "text": "convention over configuration so the only parameters that you need to provide to deployer is",
    "start": "1875840",
    "end": "1883279"
  },
  {
    "text": "environment and slot and then and also you can specify what kind of resource you want to",
    "start": "1883279",
    "end": "1889600"
  },
  {
    "text": "regenerate or redeploy so and the rest of the things deployer",
    "start": "1889600",
    "end": "1896799"
  },
  {
    "text": "can do based on the conventions [Music] and conventions can be something like",
    "start": "1896799",
    "end": "1903200"
  },
  {
    "text": "we can say that in our v-net we have five subnets one for ats one for apim one for update",
    "start": "1903200",
    "end": "1910799"
  },
  {
    "text": "way one for bastion and one for gateway integration so five and then for each",
    "start": "1910799",
    "end": "1918399"
  },
  {
    "text": "subnet we have a convention what is this uh size of this subnet and then the only",
    "start": "1918399",
    "end": "1924960"
  },
  {
    "text": "thing that we have in configuration is the base ip address",
    "start": "1924960",
    "end": "1931039"
  },
  {
    "text": "or the vnet and the rest of the things deployer will automatically calculate what will be the",
    "start": "1931039",
    "end": "1937519"
  },
  {
    "text": "ip range for each subnet and it will generate the arm template",
    "start": "1937519",
    "end": "1942880"
  },
  {
    "text": "and you don't need to actually work with arm templates uh implementation wise deployer is a cli",
    "start": "1942880",
    "end": "1950640"
  },
  {
    "text": "tool so that means that i can run it from my computer or i can run it on a azure",
    "start": "1950640",
    "end": "1958240"
  },
  {
    "text": "devops pipeline and if azure develops for some reason down so it's fine i have i can run it",
    "start": "1958240",
    "end": "1964559"
  },
  {
    "text": "from my computer basically we use the same script to deploy from computer or from",
    "start": "1964559",
    "end": "1970480"
  },
  {
    "text": "uh from the pipelines uh deployer is a self-contained tool",
    "start": "1970480",
    "end": "1978799"
  },
  {
    "text": "that means that if i have deployer on my computer i can i can generate templates",
    "start": "1978799",
    "end": "1985440"
  },
  {
    "text": "artifacts i can upload them to storage account i can download them from storage account",
    "start": "1985440",
    "end": "1991279"
  },
  {
    "text": "i can validate arm templates and i can deploy our templates with deployer so",
    "start": "1991279",
    "end": "1996320"
  },
  {
    "text": "the player does everything for us yes and traceability of course it's very",
    "start": "1996320",
    "end": "2002480"
  },
  {
    "text": "important therefore we we spend quite a lot of time implementing this",
    "start": "2002480",
    "end": "2007679"
  },
  {
    "text": "tagging strategy how do we tag our resources because it's really important to be able to",
    "start": "2007679",
    "end": "2012960"
  },
  {
    "text": "identify where did they deploy this infrastructure who deployed it like",
    "start": "2012960",
    "end": "2018240"
  },
  {
    "text": "where is the this uh version of a git hash tag that uh indicating",
    "start": "2018240",
    "end": "2024880"
  },
  {
    "text": "the changes that i deployed and that's all implemented with a deployer",
    "start": "2024880",
    "end": "2031200"
  },
  {
    "text": "and like structurally deployer has the concept of configuration",
    "start": "2031200",
    "end": "2036399"
  },
  {
    "text": "where we specify our environments then it has a folder",
    "start": "2036399",
    "end": "2042640"
  },
  {
    "text": "with predefined arm templates and that's actually the only place where you need to work with arm templates but the",
    "start": "2042640",
    "end": "2049599"
  },
  {
    "text": "way how we do it normally is that you can manually create what you need in portal or with accli",
    "start": "2049599",
    "end": "2057599"
  },
  {
    "text": "and then you just export the arm template put it to the templates and teach deployer how to replace some",
    "start": "2057599",
    "end": "2065440"
  },
  {
    "text": "stuff in the in the arm template but some of the templates we generate from scratch for example application gateway arm template it's",
    "start": "2065440",
    "end": "2072720"
  },
  {
    "text": "totally automated because we have uh quite in in some of the environments we have some differences",
    "start": "2072720",
    "end": "2078480"
  },
  {
    "text": "between how we configure up gateway and then it's totally not possible to do with",
    "start": "2078480",
    "end": "2083520"
  },
  {
    "text": "just with arm templates but it's very easy to implement with a c sharp that generates",
    "start": "2083520",
    "end": "2089838"
  },
  {
    "text": "our template for us so and then when you have configuration and template in place",
    "start": "2090240",
    "end": "2095760"
  },
  {
    "text": "you run deployer with a deployer generate minus r and then you can specify what",
    "start": "2095760",
    "end": "2101680"
  },
  {
    "text": "type of resource you want to generate if you say all it will generate everything",
    "start": "2101680",
    "end": "2107040"
  },
  {
    "text": "you can say uh up gateway it will only generate up gateways or vnet and so on and so forth and then",
    "start": "2107040",
    "end": "2113359"
  },
  {
    "text": "you specify what environment you want to generate things for and what is the slot where you're going to deploy things to",
    "start": "2113359",
    "end": "2120320"
  },
  {
    "text": "and then what deployer does it gets a configuration templates and yeah",
    "start": "2120320",
    "end": "2127920"
  },
  {
    "text": "transform things and generate a set of artifacts and artifacts contains of armor",
    "start": "2127920",
    "end": "2134480"
  },
  {
    "text": "templates then a set of brush and powershell scripts",
    "start": "2134480",
    "end": "2139520"
  },
  {
    "text": "and kubernetes manifests and metadata and metadata contains information about",
    "start": "2139520",
    "end": "2146320"
  },
  {
    "text": "a subscription resource group that we're going to deploy things to so and then artifacts are deployed to",
    "start": "2146320",
    "end": "2153440"
  },
  {
    "text": "upload it to storage account and then deployer can download from storage account",
    "start": "2153440",
    "end": "2158800"
  },
  {
    "text": "and can validate and deploy things so and uh when deployment is done so",
    "start": "2158800",
    "end": "2165760"
  },
  {
    "text": "then uh we run pause deployment configuration and that means that for example we need to configure our cluster with uh",
    "start": "2165760",
    "end": "2172960"
  },
  {
    "text": "namespaces and some so basically a lot of post provisioning",
    "start": "2172960",
    "end": "2179280"
  },
  {
    "text": "configuration steps and normally we have a master script that we just run like uh deploy devblue and then it does",
    "start": "2179280",
    "end": "2188240"
  },
  {
    "text": "the rest of the job and just to give you some sense of how",
    "start": "2188240",
    "end": "2193839"
  },
  {
    "text": "the configuration files look like so again conventional over configuration a lot of things we",
    "start": "2193839",
    "end": "2202799"
  },
  {
    "text": "specify in base folder so and if things sitting in base folder that means that it's applicable to all environments so that's",
    "start": "2202960",
    "end": "2210880"
  },
  {
    "text": "an example of v-net specification so we have uh aks update to av1 v2 aprm",
    "start": "2210880",
    "end": "2218800"
  },
  {
    "text": "bastion test vm and subnet gateway so 6 subnets and the only thing i specify in",
    "start": "2218800",
    "end": "2225119"
  },
  {
    "text": "base is the range means slash 20 was slash 25",
    "start": "2225119",
    "end": "2230640"
  },
  {
    "text": "so and this example of uh for a lab environment vignette configuration",
    "start": "2230640",
    "end": "2236560"
  },
  {
    "text": "the only thing i need to specify is ip range for blue and green",
    "start": "2236560",
    "end": "2241760"
  },
  {
    "text": "environment so based on these two sorry those two configuration element",
    "start": "2241760",
    "end": "2249119"
  },
  {
    "text": "a deployer will generate arm template that will deploy v-net to the environment",
    "start": "2249119",
    "end": "2257119"
  },
  {
    "text": "and here is an example of how our templates are structured so we have for example aks apm inside",
    "start": "2257119",
    "end": "2264480"
  },
  {
    "text": "bust on and different things so in each folder either contains uh arm template",
    "start": "2264480",
    "end": "2274320"
  },
  {
    "text": "or parameter files or both so depending on on how we run it",
    "start": "2274560",
    "end": "2285280"
  },
  {
    "text": "so that's a deployer so now let's uh switch to azure load balancing options",
    "start": "2285280",
    "end": "2293200"
  },
  {
    "start": "2291000",
    "end": "2291000"
  },
  {
    "text": "because when we when we talk about immutable infrastructure then we always need to have something",
    "start": "2293200",
    "end": "2300400"
  },
  {
    "text": "on top of our infrastructure that will orchestrate the traffic",
    "start": "2300400",
    "end": "2306240"
  },
  {
    "text": "so and on azure there are four products in load balancing category that's a azure front door",
    "start": "2306240",
    "end": "2313839"
  },
  {
    "text": "uh traffic manager application gateway and azure load balancer and here it's marked as a global",
    "start": "2313839",
    "end": "2320560"
  },
  {
    "text": "original so global means that those products operates on global levels so they orchestrate",
    "start": "2320560",
    "end": "2327680"
  },
  {
    "text": "traffic between the regions and regional means that application gateway and azure load balancer",
    "start": "2327680",
    "end": "2333440"
  },
  {
    "text": "so they normally orchestrate traffic within either within a resource group or within",
    "start": "2333440",
    "end": "2340000"
  },
  {
    "text": "a region and another differentiation is that",
    "start": "2340000",
    "end": "2346079"
  },
  {
    "text": "for example traffic manager and load balancer they operate they can operate with",
    "start": "2346079",
    "end": "2354000"
  },
  {
    "text": "non-http traffic and when while azure front door and application gateway",
    "start": "2354000",
    "end": "2359680"
  },
  {
    "text": "they only operate on http or https traffic",
    "start": "2359680",
    "end": "2365200"
  },
  {
    "text": "and we're gonna talk only about azure front door and traffic manager",
    "start": "2365200",
    "end": "2370799"
  },
  {
    "text": "traffic manager is a dns based traffic load balancer and",
    "start": "2370880",
    "end": "2379200"
  },
  {
    "text": "when you use traffic managers it works the way that a client if you have some applications",
    "start": "2379599",
    "end": "2387599"
  },
  {
    "text": "if you have website and you have traffic manager in front so then when the client calls your website traffic manager",
    "start": "2387599",
    "end": "2395200"
  },
  {
    "text": "identify what is the fastest backhand available for your client or",
    "start": "2395200",
    "end": "2401839"
  },
  {
    "text": "for example if you configure some priority and then it will give client the ip address or dns name",
    "start": "2401839",
    "end": "2408240"
  },
  {
    "text": "and then client actually will go we'll call this endpoint directly so the traffic itself doesn't go through",
    "start": "2408240",
    "end": "2413680"
  },
  {
    "text": "traffic manager and just some characteristic of traffic manager so it",
    "start": "2413680",
    "end": "2418720"
  },
  {
    "text": "increases application availability uh and that's typical disaster recovery",
    "start": "2418720",
    "end": "2424000"
  },
  {
    "text": "scenario that you you may have two applications running on",
    "start": "2424000",
    "end": "2429200"
  },
  {
    "text": "different regions for example west europe and north europe and then traffic manager in front and",
    "start": "2429200",
    "end": "2435680"
  },
  {
    "text": "then traffic manager can be configured that if west europe goes down the traffic will be automatically",
    "start": "2435680",
    "end": "2440880"
  },
  {
    "text": "redirected to available region so it also can improve your",
    "start": "2440880",
    "end": "2447040"
  },
  {
    "text": "application performance and that means that let's say if you if you deploy your application in different",
    "start": "2447040",
    "end": "2452880"
  },
  {
    "text": "uh regions and then when client calls your application traffic manager will",
    "start": "2452880",
    "end": "2458480"
  },
  {
    "text": "identify what is the closest to your client in terms of latency endpoint and will",
    "start": "2458480",
    "end": "2464640"
  },
  {
    "text": "root the traffic jam so traffic manager has a concept of routing profiles and there are four",
    "start": "2464640",
    "end": "2471920"
  },
  {
    "text": "available priority weighted performance and geographic and we're gonna cover first to priority and",
    "start": "2471920",
    "end": "2478240"
  },
  {
    "text": "weighted because they are useful when you work with immutable infrastructure",
    "start": "2478240",
    "end": "2484160"
  },
  {
    "start": "2484000",
    "end": "2484000"
  },
  {
    "text": "so priority when when you use when you configure a traffic manager with a",
    "start": "2484160",
    "end": "2489200"
  },
  {
    "text": "profile as a priority profile then traffic manager contains a",
    "start": "2489200",
    "end": "2495440"
  },
  {
    "text": "prioritized list of service endpoints so one two three four five six seven and so on and basically uh the lower",
    "start": "2495440",
    "end": "2503119"
  },
  {
    "text": "priority the higher priority so a typical example can be that we have two environments reproduction",
    "start": "2503119",
    "end": "2510480"
  },
  {
    "text": "and disaster recovery so production work runs on west europe and disaster recovery on north europe and",
    "start": "2510480",
    "end": "2517440"
  },
  {
    "text": "then you configure that your disaster recovery traffic manager has two endpoints",
    "start": "2517440",
    "end": "2522800"
  },
  {
    "text": "uh production and disaster recovery with priority one and two and that means that when traffic reach",
    "start": "2522800",
    "end": "2530079"
  },
  {
    "text": "uh traffic manager traffic manager checks okay production priority one are you alive",
    "start": "2530079",
    "end": "2535359"
  },
  {
    "text": "yes traffic goes there so for example if west europe goes down then traffic manager will",
    "start": "2535359",
    "end": "2541200"
  },
  {
    "text": "ask okay production are you alive no go there so that's the way how it orchestrates",
    "start": "2541200",
    "end": "2547040"
  },
  {
    "text": "and then for example in production we may have a vce with a blue green so and then we can",
    "start": "2547040",
    "end": "2553440"
  },
  {
    "text": "configure our traffic manager also with two endpoints and that",
    "start": "2553440",
    "end": "2558480"
  },
  {
    "text": "like priority only uh applicable if you don't use canary so if you use canary",
    "start": "2558480",
    "end": "2563599"
  },
  {
    "text": "then you can't use a priority because priority is basically on off",
    "start": "2563599",
    "end": "2568960"
  },
  {
    "text": "right so and then in production for example we configured that blue is currently active so and that's indicate here so one and",
    "start": "2569040",
    "end": "2576000"
  },
  {
    "text": "online and then it's multiple ways you can implement the switch so the switch can be",
    "start": "2576000",
    "end": "2581520"
  },
  {
    "text": "you change the status of the endpoint so for example if i want to switch to green so then i update traffic manager and say",
    "start": "2581520",
    "end": "2589520"
  },
  {
    "text": "okay green is online and blue is offline and then it will orchestrate the traffic",
    "start": "2589520",
    "end": "2595599"
  },
  {
    "text": "so the next profile type is a weighted and that's uh it works the way that you",
    "start": "2595599",
    "end": "2603119"
  },
  {
    "start": "2598000",
    "end": "2598000"
  },
  {
    "text": "assigned a weight to your end point so weight is basically a number from one two thousand",
    "start": "2603119",
    "end": "2610480"
  },
  {
    "text": "and then when traffic reaches the traffic manager traffic manager randomly",
    "start": "2610480",
    "end": "2616160"
  },
  {
    "text": "picks the endpoint and",
    "start": "2616160",
    "end": "2621920"
  },
  {
    "text": "the probability of traffic going to one endpoint or another",
    "start": "2621920",
    "end": "2627599"
  },
  {
    "text": "is based on this weight number but in my head it's much more easy to think about it as a percentage",
    "start": "2627599",
    "end": "2632960"
  },
  {
    "text": "so you can say if i want to send 10 percent of traffic to blue then i specify weight as 10 and 90.",
    "start": "2632960",
    "end": "2640960"
  },
  {
    "text": "so that's a weighted and lesson learned for us in vce with",
    "start": "2640960",
    "end": "2648880"
  },
  {
    "start": "2645000",
    "end": "2645000"
  },
  {
    "text": "the traffic manager is that we because a traffic manager operates with dns caching and that comes with",
    "start": "2648880",
    "end": "2656640"
  },
  {
    "text": "this ttl and every time when we do switch it will take some time before the",
    "start": "2656640",
    "end": "2663200"
  },
  {
    "text": "traffic starts uh like going to to the new endpoint because uh yeah if",
    "start": "2663200",
    "end": "2671200"
  },
  {
    "text": "tutorial is configured for for example half an hour then you will you will wait a half an hour before traffic will be switched",
    "start": "2671200",
    "end": "2677440"
  },
  {
    "text": "and we also experience that sometimes even though we some hours after the switch we still",
    "start": "2677440",
    "end": "2683280"
  },
  {
    "text": "have uh like very very little amount of traffic but still uh coming to the to the old endpoint",
    "start": "2683280",
    "end": "2691760"
  },
  {
    "text": "and another thing that would just uh it's not initially just more like comment is that uh the way how you configure its",
    "start": "2691760",
    "end": "2697760"
  },
  {
    "text": "feed manager is that if you have it operates per domain so let's say if you have full gibbs dot",
    "start": "2697760",
    "end": "2704400"
  },
  {
    "text": "no and bar bibs dot no then you will have two traffic managers when if you for example have",
    "start": "2704400",
    "end": "2709760"
  },
  {
    "text": "multiple things running on your infrastructure assigned to different domains then you",
    "start": "2709760",
    "end": "2715280"
  },
  {
    "text": "will have a lot of traffic managers so the front door that's another product",
    "start": "2715280",
    "end": "2721119"
  },
  {
    "text": "also a global level load balancer it operates on http",
    "start": "2721119",
    "end": "2727359"
  },
  {
    "text": "and one thing about traffic manager it operates not only http https it can also serve tcp traffic for example",
    "start": "2727359",
    "end": "2735200"
  },
  {
    "text": "but front door it's only http https level 7 load balancer",
    "start": "2735200",
    "end": "2741520"
  },
  {
    "text": "and it works the way that azure has a this is a global network",
    "start": "2741839",
    "end": "2750720"
  },
  {
    "text": "it's a lot of networking between continents and those orange dots",
    "start": "2750720",
    "end": "2757440"
  },
  {
    "text": "this is something called the point of presence and if you deploy front door in front of",
    "start": "2757440",
    "end": "2764880"
  },
  {
    "text": "your web application so then traffic will travel the following way so it",
    "start": "2764880",
    "end": "2771040"
  },
  {
    "text": "find the closest pop from your client and then",
    "start": "2771040",
    "end": "2777839"
  },
  {
    "text": "once the backend packet enters the azure global one so then the request will be sent",
    "start": "2777839",
    "end": "2785839"
  },
  {
    "text": "over extremely low latency connection between two endpoints so",
    "start": "2785839",
    "end": "2791359"
  },
  {
    "text": "basically the second packet comes here it just travels really quickly to another point",
    "start": "2791359",
    "end": "2798960"
  },
  {
    "text": "of presence and then to end point",
    "start": "2798960",
    "end": "2804240"
  },
  {
    "text": "and and another thing that uh we find very attractive is that it supports multiple",
    "start": "2804480",
    "end": "2809680"
  },
  {
    "text": "site hosting so that means that even if i have multiple domains i'm i still can have",
    "start": "2809680",
    "end": "2815920"
  },
  {
    "text": "only one instance of uh front door that will um that i need to configure the traffic",
    "start": "2815920",
    "end": "2822880"
  },
  {
    "text": "between them and routing methods is pretty much the same it's latency and priority and weight",
    "start": "2822880",
    "end": "2828319"
  },
  {
    "text": "so that means that if you if you're planning to use uh front door as your kind of immutable infrastructure",
    "start": "2828319",
    "end": "2835040"
  },
  {
    "text": "orchestrator then most likely you will going to use a priority and weighted",
    "start": "2835040",
    "end": "2840240"
  },
  {
    "text": "profiles so and and another test that we want to do with the traffic man with front door is actually we want to",
    "start": "2840240",
    "end": "2846720"
  },
  {
    "text": "test what would be the performance improvements because like this fact that",
    "start": "2846720",
    "end": "2853599"
  },
  {
    "text": "the microsoft global network will be used i think",
    "start": "2853599",
    "end": "2858720"
  },
  {
    "text": "it looks very promising and we expect to have some performance improvements as well",
    "start": "2858720",
    "end": "2865119"
  },
  {
    "start": "2866000",
    "end": "2866000"
  },
  {
    "text": "as i said we don't have production experience working with front door but the proof of",
    "start": "2867040",
    "end": "2873680"
  },
  {
    "text": "concept concept that we run shows us quite a good result",
    "start": "2873680",
    "end": "2879040"
  },
  {
    "text": "so and first thing that faster switch time so when we do the switch it takes",
    "start": "2879040",
    "end": "2884720"
  },
  {
    "text": "approximately two minutes before this change actually deployed to all these uh pops and uh",
    "start": "2884720",
    "end": "2890640"
  },
  {
    "text": "after two minutes it switched and then the traffic guarantee it's 100",
    "start": "2890640",
    "end": "2895920"
  },
  {
    "text": "uh will be redirected to the proper end point and as i said multiple multiple site",
    "start": "2895920",
    "end": "2902640"
  },
  {
    "text": "hosting this is also things that will simplify uh the number of infrastructure",
    "start": "2902640",
    "end": "2908559"
  },
  {
    "text": "components in our infrastructure so to wrap things up so this mutable",
    "start": "2908559",
    "end": "2917040"
  },
  {
    "start": "2913000",
    "end": "2913000"
  },
  {
    "text": "immutable that's i i think we should treat it as a as a sort of tools",
    "start": "2917040",
    "end": "2922720"
  },
  {
    "text": "in our architectural tool belt so there are some cases where",
    "start": "2922720",
    "end": "2929760"
  },
  {
    "text": "immutable infrastructure works fine and some cases where mutable infrastructure works also fine",
    "start": "2929760",
    "end": "2936640"
  },
  {
    "text": "and i also think that hybrid solution when you have infrastructure",
    "start": "2936640",
    "end": "2942400"
  },
  {
    "text": "and some of the components are mutable and some of them are immutable that this is also valid",
    "start": "2942400",
    "end": "2947920"
  },
  {
    "text": "because we should be pragmatic and practical so do not pick the lowest",
    "start": "2947920",
    "end": "2954000"
  },
  {
    "text": "common denominator that means that like when you look at your infrastructure you don't need to apply okay everything",
    "start": "2954000",
    "end": "2961040"
  },
  {
    "text": "should be immutable or everything should be mutable so you should look at your infrastructure understand your infrastructure",
    "start": "2961040",
    "end": "2967119"
  },
  {
    "text": "understand what is the impact of different components of your infrastructure on your",
    "start": "2967119",
    "end": "2972960"
  },
  {
    "text": "business you should understand what is a sla that you're operating with and then design your system and",
    "start": "2972960",
    "end": "2980559"
  },
  {
    "text": "make your decisions based on all this information also you should learn azure products",
    "start": "2980559",
    "end": "2988000"
  },
  {
    "text": "because microsoft product teams they constantly improving",
    "start": "2988000",
    "end": "2993200"
  },
  {
    "text": "their products and just to give you an example aks two years ago or even one year ago",
    "start": "2993200",
    "end": "3000000"
  },
  {
    "text": "it was not possible to um to update your vm size",
    "start": "3000000",
    "end": "3006640"
  },
  {
    "text": "this week they actually put it to the private preview that now you can and another thing is that aks today",
    "start": "3006640",
    "end": "3014400"
  },
  {
    "text": "supports multiple pools so that means that technically you can",
    "start": "3014400",
    "end": "3020160"
  },
  {
    "text": "implement immutable infrastructure in one instance and then for example blue green",
    "start": "3020160",
    "end": "3028640"
  },
  {
    "text": "vm pools but uh in our case we evaluated this option but we decided that for us",
    "start": "3028640",
    "end": "3034960"
  },
  {
    "text": "it much more easy just to spin up a new infrastructure and deploy things and be done with this instead of putting",
    "start": "3034960",
    "end": "3041200"
  },
  {
    "text": "this complexity into implementing these multiple pools",
    "start": "3041200",
    "end": "3047280"
  },
  {
    "text": "in kubernetes by the same time it's possible and you should definitely consider it if you",
    "start": "3047839",
    "end": "3054000"
  },
  {
    "text": "want to and automation automation automation so everything should be automated so i think you should invest a",
    "start": "3054000",
    "end": "3060640"
  },
  {
    "text": "lot of time and energy in automation and then your life will be much more easy and testing of course",
    "start": "3060640",
    "end": "3068640"
  },
  {
    "text": "so testing any any any sort of testing and especially end to end because if you able to test things",
    "start": "3068640",
    "end": "3076319"
  },
  {
    "text": "yourself then you don't need to involve other teams and then it will give you much more",
    "start": "3076319",
    "end": "3082000"
  },
  {
    "text": "flexibility and possibility to upgrade your infrastructure",
    "start": "3082000",
    "end": "3089519"
  },
  {
    "text": "so and that's uh that was it so what i wanted to present to you so if you have any question you can ask",
    "start": "3089680",
    "end": "3096880"
  },
  {
    "text": "them by voice or you can send them to the slack and i will answer",
    "start": "3096880",
    "end": "3103359"
  },
  {
    "text": "them hi thank you so much i'm just um i",
    "start": "3108839",
    "end": "3115119"
  },
  {
    "text": "i'm just looking at chat here in case anyone has a question there",
    "start": "3115119",
    "end": "3125838"
  },
  {
    "text": "so i think you are all set although i would check like i said slack",
    "start": "3127760",
    "end": "3135280"
  },
  {
    "text": "because there's often a lot of chatter there so i'm gonna go ahead and stop the",
    "start": "3135280",
    "end": "3142559"
  },
  {
    "text": "recording thanks okay thank you so much thank you for supporting",
    "start": "3142559",
    "end": "3152720"
  }
]