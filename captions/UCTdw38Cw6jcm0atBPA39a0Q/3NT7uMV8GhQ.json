[
  {
    "start": "0",
    "end": "24000"
  },
  {
    "text": "okay welcome everybody this is the optional title for my talk",
    "start": "8679",
    "end": "16000"
  },
  {
    "text": "personalization TV on ok and radio with Rowlands and action modeling",
    "start": "16000",
    "end": "22960"
  },
  {
    "text": "my name is halal Georgia Dixon I worked for illumise",
    "start": "22960",
    "end": "28939"
  },
  {
    "start": "24000",
    "end": "60000"
  },
  {
    "text": "small consultancy and I'm currently with NRK on the radio team and I'm working on",
    "start": "28939",
    "end": "35780"
  },
  {
    "text": "personalization personalization is something that cuts between both radio",
    "start": "35780",
    "end": "40820"
  },
  {
    "text": "and TV so there's team from both products now this is not a one-man thing",
    "start": "40820",
    "end": "48830"
  },
  {
    "text": "we've created there's product owners leaders there's UX UI testers application developers etc",
    "start": "48830",
    "end": "57879"
  },
  {
    "text": "so this is just not me there's more people on this the agenda is sort of why",
    "start": "57879",
    "end": "64128"
  },
  {
    "start": "60000",
    "end": "89000"
  },
  {
    "text": "why we went with an archer system for this and then we have the some details",
    "start": "64129",
    "end": "71000"
  },
  {
    "text": "on the implementation just to give a look into that we will look at operations of how how are we running",
    "start": "71000",
    "end": "77350"
  },
  {
    "text": "something like an actor system on kubernetes and then there's some lessons",
    "start": "77350",
    "end": "83810"
  },
  {
    "text": "learned during the last year or so so TV and arcaded I know is the",
    "start": "83810",
    "end": "93260"
  },
  {
    "text": "equivalent of BBC and the iPlayer and so",
    "start": "93260",
    "end": "100010"
  },
  {
    "text": "when you open up the front page what you get just under the big hero image is my",
    "start": "100010",
    "end": "107060"
  },
  {
    "text": "content your content thanks to you how much things you have marked as a favorite things you think that are yours",
    "start": "107060",
    "end": "114110"
  },
  {
    "text": "we are not putting anything else in there which you have not you have not acted on",
    "start": "114110",
    "end": "119720"
  },
  {
    "text": "so this is all your content this is screenshot from the old one so",
    "start": "119720",
    "end": "125270"
  },
  {
    "text": "that was so enormous from the front page using the new version and this is the my",
    "start": "125270",
    "end": "131150"
  },
  {
    "text": "page so with the old system where we have the continued watching at the top and then there were your shows below",
    "start": "131150",
    "end": "139639"
  },
  {
    "text": "that and then the history underneath another view of these data this is a",
    "start": "139639",
    "end": "147310"
  },
  {
    "text": "documentary nature serious you can see that I watched two first episodes or rather my kids have and then they have",
    "start": "147310",
    "end": "154599"
  },
  {
    "text": "our somewhere in the beginning of the third episode and well the problem with",
    "start": "154599",
    "end": "164209"
  },
  {
    "text": "this the old solution was that people can really find their content they all",
    "start": "164209",
    "end": "169519"
  },
  {
    "text": "know they had these favorites and and resumed watching having two different",
    "start": "169519",
    "end": "174890"
  },
  {
    "text": "things that were yours were troubling as a public broadcaster we have on some",
    "start": "174890",
    "end": "181760"
  },
  {
    "text": "shows fairly short rights because we don't do the RM so you can often see",
    "start": "181760",
    "end": "190569"
  },
  {
    "text": "that you are watched episode one and it's probably lost rights before we publish episode 7 so you sort of need to",
    "start": "190569",
    "end": "198379"
  },
  {
    "text": "keep track with us and then there's this one and that's a problem and most do",
    "start": "198379",
    "end": "210319"
  },
  {
    "start": "202000",
    "end": "266000"
  },
  {
    "text": "that wrong and we want to do this right we want to take you to the right place so what happens if you are on episode 4",
    "start": "210319",
    "end": "216560"
  },
  {
    "text": "and we get rice for episode 5 should we notice you should be put that content further up this green on the cellphone",
    "start": "216560",
    "end": "223669"
  },
  {
    "text": "or on the smart TV it's not room for that many items so you want to make sure",
    "start": "223669",
    "end": "229280"
  },
  {
    "text": "that the items we show you when your content is relevant depending on where you are as an individual not not that",
    "start": "229280",
    "end": "235970"
  },
  {
    "text": "okay we got you season perhaps interesting for a lot of people but it's",
    "start": "235970",
    "end": "241040"
  },
  {
    "text": "really what we want to try to hit is is if relevant where you are and and so",
    "start": "241040",
    "end": "246319"
  },
  {
    "text": "that is one thing for sequential content but then we have other types of serious",
    "start": "246319",
    "end": "251419"
  },
  {
    "text": "we have news shows if you're on I watched Saturday's so seven days ago",
    "start": "251419",
    "end": "257049"
  },
  {
    "text": "the next episode I want to watch is that six days ago or is it today's episode",
    "start": "257049",
    "end": "262270"
  },
  {
    "text": "that is also something we need to solve and then to do this when you have a",
    "start": "262270",
    "end": "269150"
  },
  {
    "start": "266000",
    "end": "330000"
  },
  {
    "text": "small you port we wanted to be dynamic to change the content it's still yours",
    "start": "269150",
    "end": "275930"
  },
  {
    "text": "and we wanted to sort of be active if we get rights we want to perhaps put it up",
    "start": "275930",
    "end": "281300"
  },
  {
    "text": "if you're losing rights in six states and you're halfway into an episode we want to put that one up to make sure",
    "start": "281300",
    "end": "286729"
  },
  {
    "text": "that you get the chance to watch it before we take it away so now it's one reason what needed or wanted to build a",
    "start": "286729",
    "end": "293600"
  },
  {
    "text": "new system or do something about it and then we had the old architecture where",
    "start": "293600",
    "end": "301070"
  },
  {
    "text": "we had a Web API we had a redis document storage we loaded once you logged in we",
    "start": "301070",
    "end": "306320"
  },
  {
    "text": "loaded your data into Redis and well that works fine if you have enough Redis instances and we run in a sure we're",
    "start": "306320",
    "end": "314060"
  },
  {
    "text": "ready is not the cheapest product they have and and we're doing Lua script on",
    "start": "314060",
    "end": "320650"
  },
  {
    "text": "Redis so means that Redis is single threaded so if we have an expensive Lua script everything is slow unless we had",
    "start": "320650",
    "end": "327440"
  },
  {
    "text": "enough Redis instances and when we made this back in 2014 15 things look like",
    "start": "327440",
    "end": "334970"
  },
  {
    "start": "330000",
    "end": "363000"
  },
  {
    "text": "this this is also called a big ball of mud the red ones are circular",
    "start": "334970",
    "end": "340400"
  },
  {
    "text": "dependencies between namespace yay that sounds like fun and then we were",
    "start": "340400",
    "end": "346940"
  },
  {
    "text": "slightly moving into micro service bounded context trying to split our",
    "start": "346940",
    "end": "353030"
  },
  {
    "text": "domain based on functionality and that so made it easier for us to start reason",
    "start": "353030",
    "end": "359539"
  },
  {
    "text": "about how they should work and we sort",
    "start": "359539",
    "end": "364550"
  },
  {
    "start": "363000",
    "end": "393000"
  },
  {
    "text": "of decided okay we want to do something about personalization and then we have a rule if you're doing something big",
    "start": "364550",
    "end": "371030"
  },
  {
    "text": "something that needs a decision you present at least three options and it",
    "start": "371030",
    "end": "379669"
  },
  {
    "text": "should be presented as by the team or I by one person it's not that I present",
    "start": "379669",
    "end": "384949"
  },
  {
    "text": "for a new present when we go and then you get why this is might my system your solution kind of battle they want to",
    "start": "384949",
    "end": "390440"
  },
  {
    "text": "sort of present three equal options in this case we ended up with sort of",
    "start": "390440",
    "end": "395539"
  },
  {
    "text": "looking at five okay we go to old way we'd read it and see if that could work and we were fairly certain that we",
    "start": "395539",
    "end": "401659"
  },
  {
    "text": "didn't want it we was one of the most expensive components we had in Russia stack sequel yeah",
    "start": "401659",
    "end": "408920"
  },
  {
    "text": "probably but that would be as a view model that we need something else to drive our domain because the domain",
    "start": "408920",
    "end": "415350"
  },
  {
    "text": "logic when you start looking at asking for sorting for a lot of programs for a",
    "start": "415350",
    "end": "421230"
  },
  {
    "text": "lot of users and you want to sort of hit you with six seven eight business rules and you have to evaluate the content",
    "start": "421230",
    "end": "426570"
  },
  {
    "text": "evaluate where they are evaluate if the next episode is available is and so forth writing that query was not very",
    "start": "426570",
    "end": "433320"
  },
  {
    "text": "fun even though we tried and then we looked at cosmos DB in graphic yeah for",
    "start": "433320",
    "end": "439620"
  },
  {
    "text": "some of this graphic bag could be very nice to see okay people have watched this I've also watched this and and you can sort of navigate that one and then",
    "start": "439620",
    "end": "447810"
  },
  {
    "text": "actually modeling was something we looked at it felt that perhaps if if",
    "start": "447810",
    "end": "453060"
  },
  {
    "text": "each user is an actor we get to sort of sort and deal with content for that user",
    "start": "453060",
    "end": "459540"
  },
  {
    "text": "individually that could perhaps fit we also get actual functions better and are",
    "start": "459540",
    "end": "464700"
  },
  {
    "text": "we making an accurate system in functions there was no durable functions at that time and it's sort of clicked",
    "start": "464700",
    "end": "472139"
  },
  {
    "text": "when we came to the utilization that a favorite might be able to sort itself if",
    "start": "472139",
    "end": "478970"
  },
  {
    "text": "it gets enough input it can do it fairly easy and then we can have six to seven",
    "start": "478970",
    "end": "486000"
  },
  {
    "text": "method calls each M implementing a single business rule so we evaluate one",
    "start": "486000",
    "end": "491910"
  },
  {
    "text": "business rule at the time based on some event instead of trying to evaluate all business rules when they're sorting it",
    "start": "491910",
    "end": "499460"
  },
  {
    "start": "504000",
    "end": "584000"
  },
  {
    "text": "yeah and that left us with these three these are probably the most the famous",
    "start": "504430",
    "end": "512650"
  },
  {
    "text": "actor systems on net you have a cadet net we have people in using a chi in n",
    "start": "512650",
    "end": "521620"
  },
  {
    "text": "RK and then we have proto actor we discarded that fairly quick the",
    "start": "521620",
    "end": "527350"
  },
  {
    "text": "documentation was not there at the time we felt that the updates in gita were not quite as frequent as we would like",
    "start": "527350",
    "end": "534220"
  },
  {
    "text": "it especially lack of documentation in c-sharp was not encouraging and then",
    "start": "534220",
    "end": "540610"
  },
  {
    "text": "orleans we could most likely implement to this in a card on that as well but we",
    "start": "540610",
    "end": "546850"
  },
  {
    "text": "like the orleans virtual actor paradigm where you don't control the life cycle",
    "start": "546850",
    "end": "554350"
  },
  {
    "text": "you don't sort of i don't have to explicitly go and create and have a three and hierarchy of actors I sort of",
    "start": "554350",
    "end": "559810"
  },
  {
    "text": "just asked from an actor and that is because we have a catalogue of about one",
    "start": "559810",
    "end": "565060"
  },
  {
    "text": "and a half two million programs when you look at TV and radio and if I could just",
    "start": "565060",
    "end": "571210"
  },
  {
    "text": "ask for it without knowing if it existed or not and just get it if it was there fine so we felt that the the model was",
    "start": "571210",
    "end": "579790"
  },
  {
    "text": "was in Orleans suited us so Orleans",
    "start": "579790",
    "end": "585900"
  },
  {
    "start": "584000",
    "end": "657000"
  },
  {
    "text": "consists of to think there's a runtime and a programming paradigm sort of a",
    "start": "585900",
    "end": "592060"
  },
  {
    "text": "model you work with and and runtime are called zeros and then you have Grange",
    "start": "592060",
    "end": "597550"
  },
  {
    "text": "which is what your program around which is the sort of the fundamental building block there's a talk by Reuben bond",
    "start": "597550",
    "end": "604870"
  },
  {
    "text": "works with Orleans where this is from which is a nice introduction to Orleans",
    "start": "604870",
    "end": "612240"
  },
  {
    "text": "so grain is a virtual actor they always exist or they just exist up here when",
    "start": "612240",
    "end": "618460"
  },
  {
    "text": "you need them and you don't really deactivate them the life cycle is controlled by aliens and and sort of and",
    "start": "618460",
    "end": "624160"
  },
  {
    "text": "you don't use it anymore you don't use it it's a effective distributed object",
    "start": "624160",
    "end": "629350"
  },
  {
    "text": "you just have an instance is running on some side of some server somewhere and it's a sort of a unit of computation",
    "start": "629350",
    "end": "637770"
  },
  {
    "text": "implementation of the the interface and state and they communicate by sending",
    "start": "637770",
    "end": "643540"
  },
  {
    "text": "and receiving messages just like other actors and then they react incoming messages and unless you do something",
    "start": "643540",
    "end": "649890"
  },
  {
    "text": "special and you wanted to do something special they do one thing at a time it's",
    "start": "649890",
    "end": "655030"
  },
  {
    "text": "just very comfortable very easy to reason about they often represent objects in a domain",
    "start": "655030",
    "end": "662020"
  },
  {
    "text": "as I said when we just first started thinking about it we thought perhaps they'd use it would be an actor and that",
    "start": "662020",
    "end": "667750"
  },
  {
    "text": "would be it and it would have the user would have favourites and whatever history but then we sort of realized",
    "start": "667750",
    "end": "677410"
  },
  {
    "text": "pretty soon that that would be too big of an actor so so a sort of big thing when you start working and having fun",
    "start": "677410",
    "end": "683740"
  },
  {
    "text": "with this is to select the right granularity get the right size of them",
    "start": "683740",
    "end": "688990"
  },
  {
    "text": "so now if you are watch the show that position in that show would for you",
    "start": "688990",
    "end": "694720"
  },
  {
    "text": "would be one actor if you have a favorite that would be one actor as well",
    "start": "694720",
    "end": "700110"
  },
  {
    "text": "yeah so a green it has an identity that's how you sort of interact with it",
    "start": "701040",
    "end": "706930"
  },
  {
    "text": "you need to have the key to the actor to interact with you cannot say give me all of Harold's favorites unless you have",
    "start": "706930",
    "end": "712960"
  },
  {
    "text": "some way of doing that so you have to sort of build that yourself and then",
    "start": "712960",
    "end": "719140"
  },
  {
    "text": "there's behavior which is sort of the implementation of the class and then there's a optional state that may be",
    "start": "719140",
    "end": "725290"
  },
  {
    "text": "just existing in memory for the time you have the actor alive or it may be",
    "start": "725290",
    "end": "730530"
  },
  {
    "text": "persisted in some storage",
    "start": "730530",
    "end": "734130"
  },
  {
    "start": "738000",
    "end": "756000"
  },
  {
    "text": "and you sort of define one here I say I have a user it's has a string key you",
    "start": "738570",
    "end": "746970"
  },
  {
    "text": "can send the message from a sender with a body and you can list all the messages are that actor has so a little rapping",
    "start": "746970",
    "end": "760199"
  },
  {
    "start": "756000",
    "end": "788000"
  },
  {
    "text": "problem but there's the implementation this state is injected by the system so",
    "start": "760199",
    "end": "767970"
  },
  {
    "text": "you have a grain state from the store messages which is a list of messages and",
    "start": "767970",
    "end": "774600"
  },
  {
    "text": "then you can send a message there's a regular async/await",
    "start": "774600",
    "end": "780149"
  },
  {
    "text": "pattern nothing special easy to reason about this as well I think and you use",
    "start": "780149",
    "end": "788790"
  },
  {
    "start": "788000",
    "end": "825000"
  },
  {
    "text": "it by calling get grain and what you actually get is a proxy more or less an",
    "start": "788790",
    "end": "795930"
  },
  {
    "text": "implementation of that interface you can call it from the client and then you can",
    "start": "795930",
    "end": "801170"
  },
  {
    "text": "list the contents so so this looks like",
    "start": "801170",
    "end": "806490"
  },
  {
    "text": "normal code what happens is that this my run-on I took completely different server so you have to be little bit",
    "start": "806490",
    "end": "815550"
  },
  {
    "text": "aware that when you interact with these grains there is a possible network",
    "start": "815550",
    "end": "821670"
  },
  {
    "text": "latency and so on and then so what we",
    "start": "821670",
    "end": "828029"
  },
  {
    "start": "825000",
    "end": "842000"
  },
  {
    "text": "really think of it is this sort of you have a bunch of instances running",
    "start": "828029",
    "end": "833209"
  },
  {
    "text": "somewhere in your owner cluster and you work with them",
    "start": "833209",
    "end": "840649"
  },
  {
    "text": "so how do you model for this when we started modeling we we looked at the",
    "start": "842670",
    "end": "851440"
  },
  {
    "text": "access pattern for our API how well we our API use this and that's again you",
    "start": "851440",
    "end": "858160"
  },
  {
    "text": "cannot query except by the ID of a grain so that so it makes it important to",
    "start": "858160",
    "end": "863860"
  },
  {
    "text": "match it with your with your API surface",
    "start": "863860",
    "end": "870720"
  },
  {
    "text": "so we looked at our documentation sort of which user event which system events",
    "start": "871410",
    "end": "877240"
  },
  {
    "text": "or domain events do we have and the ones we will look at our Markus favorite",
    "start": "877240",
    "end": "883450"
  },
  {
    "text": "delete favorite you can list all the favorites and then there's a case where",
    "start": "883450",
    "end": "888520"
  },
  {
    "text": "we wanna enrich another view where we don't really have a list to work from",
    "start": "888520",
    "end": "893980"
  },
  {
    "text": "but we get a lot of show IDs and we need to sort of look up is this a favorite or not positions as well we set a position",
    "start": "893980",
    "end": "902020"
  },
  {
    "text": "you can delete a position and or resume watching you can list them as well and a",
    "start": "902020",
    "end": "908220"
  },
  {
    "text": "if you have watched enough of a show we might want to turn it into a favorite",
    "start": "908220",
    "end": "913870"
  },
  {
    "text": "for you that leaves us with one decision",
    "start": "913870",
    "end": "921510"
  },
  {
    "start": "917000",
    "end": "965000"
  },
  {
    "text": "based on the limitations in indexing of actors do we want to read from the actor",
    "start": "921510",
    "end": "928420"
  },
  {
    "text": "model or and use it dashing well as an active cache aleene's color patterns",
    "start": "928420",
    "end": "934180"
  },
  {
    "text": "mouth cache which is the action model is your domain model and persistence is just something that happens",
    "start": "934180",
    "end": "940090"
  },
  {
    "text": "or should we sort of use our actors as a domain model but then create a view",
    "start": "940090",
    "end": "945940"
  },
  {
    "text": "model based on all the state changes like Morsi Korres pattern so we could",
    "start": "945940",
    "end": "952240"
  },
  {
    "text": "have those queries where we want to select some say get all favorites for",
    "start": "952240",
    "end": "959140"
  },
  {
    "text": "Harold Skipton continue well we we",
    "start": "959140",
    "end": "966370"
  },
  {
    "text": "wanted the caching so we decided okay let's go with trying to use the action model that's nice nicely modeling and",
    "start": "966370",
    "end": "974530"
  },
  {
    "text": "not have a separate read model and we sort of split it okay we have catalog",
    "start": "974530",
    "end": "980830"
  },
  {
    "text": "and this is this is outside data this is a cache of data from our other systems",
    "start": "980830",
    "end": "990370"
  },
  {
    "text": "and we want to have that close to our own data and we wanted to make sure that",
    "start": "990370",
    "end": "997420"
  },
  {
    "text": "we are up even if the other system is down so this is Sam Newman talks about",
    "start": "997420",
    "end": "1003930"
  },
  {
    "text": "this Microsoft's book and also the inside-outside data paper by Pat Helen",
    "start": "1003930",
    "end": "1009420"
  },
  {
    "text": "touches on this and then you have sort of the favourites to you that okay we",
    "start": "1009420",
    "end": "1015570"
  },
  {
    "text": "have favorite thing in position as well let's look at details so the catalog we",
    "start": "1015570",
    "end": "1026189"
  },
  {
    "start": "1023000",
    "end": "1147000"
  },
  {
    "text": "have multiple sources for content you have podcast we have TV series we have",
    "start": "1026190",
    "end": "1031530"
  },
  {
    "text": "live radio etc and some of them use various ID schemes and we did not want",
    "start": "1031530",
    "end": "1038430"
  },
  {
    "text": "to deal with that so we sort of decided fairly quickly on let's just map everything into our own IDs we take an",
    "start": "1038430",
    "end": "1045030"
  },
  {
    "text": "external idea map it into a good so we deal with only dudes down at Catholic item and then there's the catalog item",
    "start": "1045030",
    "end": "1052290"
  },
  {
    "text": "which can be a podcast or a serious episode or movie like a single program",
    "start": "1052290",
    "end": "1062360"
  },
  {
    "text": "now these are things that are used by across all users across all Serene's",
    "start": "1062360",
    "end": "1070520"
  },
  {
    "text": "instances and then there's a concept",
    "start": "1070520",
    "end": "1077370"
  },
  {
    "text": "called stateless which means that there's a grain normally a grain can only be activated on one server at a",
    "start": "1077370",
    "end": "1083370"
  },
  {
    "text": "time so it's running on one one silo and",
    "start": "1083370",
    "end": "1088710"
  },
  {
    "text": "the silos know where it's on so they have a grain reference and they look it",
    "start": "1088710",
    "end": "1093750"
  },
  {
    "text": "up and say ok this one is running on this server so if you want this one go over there but then you have these",
    "start": "1093750",
    "end": "1099390"
  },
  {
    "text": "stateless ones which can run on multiple servers in the cluster and you can also",
    "start": "1099390",
    "end": "1106260"
  },
  {
    "text": "allow them to run have multiple instances on a server if it's something with high throughput but",
    "start": "1106260",
    "end": "1113040"
  },
  {
    "text": "these are we have one of these stateless grades run on each of our silos and they",
    "start": "1113040",
    "end": "1120720"
  },
  {
    "text": "are backed so they when they load up they load this state from the state phone once we have and this gives us the",
    "start": "1120720",
    "end": "1128190"
  },
  {
    "text": "throughput we need when a lot of users are working with looking at the same show sort of you have some popular shows",
    "start": "1128190",
    "end": "1135660"
  },
  {
    "text": "and you know that okay so they're coming there's a big thing everyone you know it watches so that's that's an important",
    "start": "1135660",
    "end": "1142920"
  },
  {
    "text": "concept to have and then we have favorites so we we sort of list",
    "start": "1142920",
    "end": "1152970"
  },
  {
    "start": "1147000",
    "end": "1230000"
  },
  {
    "text": "favorites from the API that means that we we needed a to have an order on them",
    "start": "1152970",
    "end": "1159660"
  },
  {
    "text": "and a list of them and to not load everything",
    "start": "1159660",
    "end": "1165180"
  },
  {
    "text": "when a user hits us we'd thought okay the API is page the clients date doesn't",
    "start": "1165180",
    "end": "1173100"
  },
  {
    "text": "really make sense to display a hundred items or thousand items in the cell phone so they want they they are paging",
    "start": "1173100",
    "end": "1179640"
  },
  {
    "text": "anyway the clients so let's just follow that and page it ourselves as well so a",
    "start": "1179640",
    "end": "1186720"
  },
  {
    "text": "page has a from and to rank the user favorites has list of pages and they're",
    "start": "1186720",
    "end": "1191970"
  },
  {
    "text": "ranked starting in and rank and then when you user hits us it will normally",
    "start": "1191970",
    "end": "1199920"
  },
  {
    "text": "load just the first page we don't have to load all the data for user and then",
    "start": "1199920",
    "end": "1205260"
  },
  {
    "text": "it ended up in a favorite so well call",
    "start": "1205260",
    "end": "1211110"
  },
  {
    "text": "to list favorites maybe an instance of the use of Harry's crane an instance of",
    "start": "1211110",
    "end": "1217440"
  },
  {
    "text": "the favorite page crane and then one instance for each of user fairies will loaded and it's so really nicely and",
    "start": "1217440",
    "end": "1226470"
  },
  {
    "text": "fast and then we have position more of the",
    "start": "1226470",
    "end": "1234080"
  },
  {
    "start": "1230000",
    "end": "1324000"
  },
  {
    "text": "same except that we also group position",
    "start": "1234080",
    "end": "1239510"
  },
  {
    "text": "by series we need to look up all the positions within a season so we so we",
    "start": "1239510",
    "end": "1245870"
  },
  {
    "text": "need to keep track of that as well and then we make a grain for it to keep track of that we can have seasons with",
    "start": "1245870",
    "end": "1253040"
  },
  {
    "text": "800 episodes in them used in hourly news and radio so so we paging is absolutely necessary",
    "start": "1253040",
    "end": "1260690"
  },
  {
    "text": "and once we change something here it will sort itself and update the pages",
    "start": "1260690",
    "end": "1267800"
  },
  {
    "text": "and keep track of that another thing is nice is that we don't",
    "start": "1267800",
    "end": "1273310"
  },
  {
    "text": "you have the persisted state but we also have state which is not persisted which",
    "start": "1273310",
    "end": "1278660"
  },
  {
    "text": "is just in memory when we load it up so for instance when you're watching something the clients report to us every",
    "start": "1278660",
    "end": "1286160"
  },
  {
    "text": "30 second which means that the last",
    "start": "1286160",
    "end": "1291460"
  },
  {
    "text": "program episode you've watched will be the same from when once you start watching something and that means that",
    "start": "1291460",
    "end": "1298310"
  },
  {
    "text": "we don't have to restart it if the use of positions no your last what you",
    "start": "1298310",
    "end": "1303920"
  },
  {
    "text": "watched last the time so some things we can just keep in memory while other thing are persisted in state and then",
    "start": "1303920",
    "end": "1313790"
  },
  {
    "text": "also this one doesn't really know about rules for favorites but the nice thing",
    "start": "1313790",
    "end": "1320300"
  },
  {
    "text": "here is that the program episode position can message our favorite and",
    "start": "1320300",
    "end": "1326300"
  },
  {
    "start": "1324000",
    "end": "1400000"
  },
  {
    "text": "the favorit will then decide ok are we and within the business rules for creating a favorite of it if you have",
    "start": "1326300",
    "end": "1333380"
  },
  {
    "text": "sort of if you skipping in a program or and you've not really watched anything",
    "start": "1333380",
    "end": "1338780"
  },
  {
    "text": "of it should we make it a favorite probably not you're not interested if you just watch two minutes yeah so",
    "start": "1338780",
    "end": "1346400"
  },
  {
    "text": "there's gives us very nice details on how to implement the the business rules",
    "start": "1346400",
    "end": "1352130"
  },
  {
    "text": "for it and we feel that working with",
    "start": "1352130",
    "end": "1358390"
  },
  {
    "text": "actors and the main modeling and matching it we the language our model is originally in",
    "start": "1358390",
    "end": "1364850"
  },
  {
    "text": "Norwegian our businesspeople Thaksin region our UX people Thaksin region so having a action model",
    "start": "1364850",
    "end": "1372200"
  },
  {
    "text": "innovation enables us to talk to them about the model they can actually",
    "start": "1372200",
    "end": "1377320"
  },
  {
    "text": "understand it when I say I use a favorite or a page or something they can relate to it which I if I mention a",
    "start": "1377320",
    "end": "1385900"
  },
  {
    "text": "index on shows and Redis they would like index what he's talking about",
    "start": "1385900",
    "end": "1392090"
  },
  {
    "text": "what's the heart set but this is something they can relate to and then we",
    "start": "1392090",
    "end": "1400760"
  },
  {
    "start": "1400000",
    "end": "1477000"
  },
  {
    "text": "have the problem of enriching all the views as I said Orleans is a virtual",
    "start": "1400760",
    "end": "1406370"
  },
  {
    "text": "actor model so if you if you ask for a grain for an ID it will be created but",
    "start": "1406370",
    "end": "1415520"
  },
  {
    "text": "when we are to enrich a search result let's say you search for something and we want to mark everything on that",
    "start": "1415520",
    "end": "1421550"
  },
  {
    "text": "searches with a star we have to actually go and check because we don't know if the grain exists or not I mean we check",
    "start": "1421550",
    "end": "1427580"
  },
  {
    "text": "the grain gets initialized and gets the state so to avoid that we we ended up",
    "start": "1427580",
    "end": "1434780"
  },
  {
    "text": "using something called a bloom filter it's a probabilistic data structure where you can sort of verify if",
    "start": "1434780",
    "end": "1441920"
  },
  {
    "text": "something is in a set or not so what happens is that you hash something with",
    "start": "1441920",
    "end": "1447380"
  },
  {
    "text": "let's say you hush it twice with different seeds so you get two values you have a bit array so if I hash this",
    "start": "1447380",
    "end": "1453530"
  },
  {
    "text": "boot and I get 26 and 46 I mark bit 26 and 46 and that array so when I want to",
    "start": "1453530",
    "end": "1459230"
  },
  {
    "text": "look it up okay I hash it all these two bits mark if not I'm not going to love the grain if it is a loaded grain and",
    "start": "1459230",
    "end": "1467210"
  },
  {
    "text": "that makes it quite cheap to check large sets for my content",
    "start": "1467210",
    "end": "1475390"
  },
  {
    "text": "so state state in Orleans can be",
    "start": "1476809",
    "end": "1482820"
  },
  {
    "start": "1477000",
    "end": "1539000"
  },
  {
    "text": "provided by a number of sources comes",
    "start": "1482820",
    "end": "1488519"
  },
  {
    "text": "built in with table storage is probably the most common one you can do in memory",
    "start": "1488519",
    "end": "1493739"
  },
  {
    "text": "of course noise for testing but it supports Cassandra dynamodb I know some",
    "start": "1493739",
    "end": "1500879"
  },
  {
    "text": "guys who implemented bigquery to power it now we are mostly using table storage",
    "start": "1500879",
    "end": "1507239"
  },
  {
    "text": "we used cosmos but find that table storage is sufficient fast enough if we do some spreading of data and very cheap",
    "start": "1507239",
    "end": "1518268"
  },
  {
    "text": "[Music] since we are some working with the system are you living system various",
    "start": "1518600",
    "end": "1525709"
  },
  {
    "text": "when you deploy you can have various versions running at the same time you need to think about worsening of states",
    "start": "1525709",
    "end": "1531899"
  },
  {
    "text": "and here's a part where I think that having our model and our code in F sharp",
    "start": "1531899",
    "end": "1537899"
  },
  {
    "text": "is really good because it makes it extremely easy with discriminated unions",
    "start": "1537899",
    "end": "1545570"
  },
  {
    "start": "1539000",
    "end": "1600000"
  },
  {
    "text": "so this is our ID mapper green it has a",
    "start": "1545570",
    "end": "1550759"
  },
  {
    "text": "state detail which is just a bank for",
    "start": "1550759",
    "end": "1555929"
  },
  {
    "text": "what we call a version state and the version state is in the middle there so",
    "start": "1555929",
    "end": "1563039"
  },
  {
    "text": "it's either a version one of good or it's the worsen two of macrostate detail",
    "start": "1563039",
    "end": "1568409"
  },
  {
    "text": "version two and there worsen to as these",
    "start": "1568409",
    "end": "1573719"
  },
  {
    "text": "properties and then there's a default for it so we can extend this without",
    "start": "1573719",
    "end": "1579389"
  },
  {
    "text": "breaking anything we can add the worst of three everything will run and that's what you have to do when we if you want",
    "start": "1579389",
    "end": "1585719"
  },
  {
    "text": "to deploy a new version we add verse and three and we convert that to version two so all clients understand version 3 and",
    "start": "1585719",
    "end": "1593279"
  },
  {
    "text": "knows that there's one knows what to do with it and then we're ready we implement the conversion for it and",
    "start": "1593279",
    "end": "1599359"
  },
  {
    "text": "starts running worse than 3 so this is what we do with when we get a detail in",
    "start": "1599359",
    "end": "1605989"
  },
  {
    "start": "1600000",
    "end": "1649000"
  },
  {
    "text": "we sort of use a pattern matching see ok we're one if it doesn't have a good well I",
    "start": "1605989",
    "end": "1612539"
  },
  {
    "text": "made my luck like this and then if it does have a good we know it's mapped",
    "start": "1612539",
    "end": "1618480"
  },
  {
    "text": "beforehand we call it true and sort of okay if it's a version - it's a person - so don't do anything so having having a",
    "start": "1618480",
    "end": "1628590"
  },
  {
    "text": "good type system really helped us there and think if you are going to work with",
    "start": "1628590",
    "end": "1633720"
  },
  {
    "text": "actors and persisting state this is something to think about how will your",
    "start": "1633720",
    "end": "1638789"
  },
  {
    "text": "worsen it if you need to upgrade your grains how will you do that yeah another",
    "start": "1638789",
    "end": "1648299"
  },
  {
    "text": "thing while we're on the model is that since we are using our actors as an sort",
    "start": "1648299",
    "end": "1656519"
  },
  {
    "start": "1649000",
    "end": "1695000"
  },
  {
    "text": "of active model we're reading and writing through it that makes etag and",
    "start": "1656519",
    "end": "1662549"
  },
  {
    "text": "caching extremely simple when you load the grain from the database they already",
    "start": "1662549",
    "end": "1667679"
  },
  {
    "text": "have at any time it's a little bit hard to reach but you can always add our own",
    "start": "1667679",
    "end": "1672779"
  },
  {
    "text": "view it in memory because we know every time we write a grain you do it in a",
    "start": "1672779",
    "end": "1677909"
  },
  {
    "text": "controlled manner and you can then update it so this is a really nice side",
    "start": "1677909",
    "end": "1683730"
  },
  {
    "text": "effect and a really good way to offload quite a few of the queries from the clients if you want to another thing is",
    "start": "1683730",
    "end": "1697370"
  },
  {
    "start": "1695000",
    "end": "1779000"
  },
  {
    "text": "reporting since we are doing these grains where you don't query them just",
    "start": "1697370",
    "end": "1705529"
  },
  {
    "text": "access them by ID doing some counters etc means that you have to think about",
    "start": "1705529",
    "end": "1712230"
  },
  {
    "text": "it beforehand unless you have a storage where you can do analytics on it or",
    "start": "1712230",
    "end": "1718320"
  },
  {
    "text": "something so what you say a common pattern is to sort of have grains that aggregate data",
    "start": "1718320",
    "end": "1723389"
  },
  {
    "text": "for you and so what we do is that we count users become favorites you count",
    "start": "1723389",
    "end": "1730230"
  },
  {
    "text": "the positions how much people have watched and then we a great the that in",
    "start": "1730230",
    "end": "1736649"
  },
  {
    "text": "stateless grains we just keep the state in memory and on each silo",
    "start": "1736649",
    "end": "1743280"
  },
  {
    "text": "in our cluster we sort of do a subtotal and and we have one stateful grain which",
    "start": "1743280",
    "end": "1749760"
  },
  {
    "text": "is responsible for storing it in the database as well as emitting the data",
    "start": "1749760",
    "end": "1757130"
  },
  {
    "text": "we're pushing it to metrics as in application insights",
    "start": "1757130",
    "end": "1763100"
  },
  {
    "text": "I've seen people pushing it with single R and getting real-time insights into",
    "start": "1763100",
    "end": "1768360"
  },
  {
    "text": "the system and also as we see later on the dashboard for Orleans is powered by",
    "start": "1768360",
    "end": "1773820"
  },
  {
    "text": "grains as well doing this kind of thing",
    "start": "1773820",
    "end": "1778159"
  },
  {
    "start": "1779000",
    "end": "1801000"
  },
  {
    "text": "so operations so we have this system",
    "start": "1779810",
    "end": "1787970"
  },
  {
    "text": "running and you want to have silos running all the time controlled and that",
    "start": "1787970",
    "end": "1794160"
  },
  {
    "text": "fits fairly well with kubernetes so we",
    "start": "1794160",
    "end": "1800250"
  },
  {
    "text": "build docker images in teamcity we push",
    "start": "1800250",
    "end": "1805710"
  },
  {
    "start": "1801000",
    "end": "1842000"
  },
  {
    "text": "it up with octopus deploy and in our system you have ended up with for the",
    "start": "1805710",
    "end": "1812600"
  },
  {
    "text": "images one for the client API that is going away or has gone away already we",
    "start": "1812600",
    "end": "1820020"
  },
  {
    "text": "merged it getting back that later there's a user changed so all the rights",
    "start": "1820020",
    "end": "1825090"
  },
  {
    "text": "goes through service person we have a separate work of peeking of things from working person and writing to the system and then we have all the internal",
    "start": "1825090",
    "end": "1832170"
  },
  {
    "text": "changes to the catalog which we also listen to and update our own cache",
    "start": "1832170",
    "end": "1838070"
  },
  {
    "text": "this is deployed to kubernetes",
    "start": "1838260",
    "end": "1843620"
  },
  {
    "start": "1842000",
    "end": "1880000"
  },
  {
    "text": "or we have an external varnish nginx",
    "start": "1843620",
    "end": "1849630"
  },
  {
    "text": "setup allowing us to use to strangle the pattern when we break up our monolith it hits our Web API ingress and then we",
    "start": "1849630",
    "end": "1856410"
  },
  {
    "text": "have a deployment for the Web API Department we used to change the silo",
    "start": "1856410",
    "end": "1861780"
  },
  {
    "text": "host and then in each deployment you sort of have the pods running doing the actual work so we can have there just a",
    "start": "1861780",
    "end": "1869880"
  },
  {
    "text": "few above the eyes and then we have a few silo hosts and scale those separately",
    "start": "1869880",
    "end": "1876110"
  },
  {
    "text": "and deploying this is a little bit of a",
    "start": "1876110",
    "end": "1881370"
  },
  {
    "start": "1880000",
    "end": "2000000"
  },
  {
    "text": "history we have let's say we have worse than 23 running all good and fine this",
    "start": "1881370",
    "end": "1890460"
  },
  {
    "text": "is comfortable and we want to have version 24 so once we activate that",
    "start": "1890460",
    "end": "1898970"
  },
  {
    "text": "deployment in the clusters we activate up in the same namespace in Cuban itis and they connect to the other silos they",
    "start": "1898970",
    "end": "1910080"
  },
  {
    "text": "start getting production trunk traffic that means that you might have worsen",
    "start": "1910080",
    "end": "1915810"
  },
  {
    "text": "one of something here and worse than to overstate here so what elites loss is",
    "start": "1915810",
    "end": "1921600"
  },
  {
    "text": "that you if you change your interfaces so need to sort of make sure that it",
    "start": "1921600",
    "end": "1928050"
  },
  {
    "text": "doesn't mix all the new data you worsen the interfaces with an attribute and",
    "start": "1928050",
    "end": "1933540"
  },
  {
    "text": "then if a grain is activated here on silo 3 and a request comes in from a",
    "start": "1933540",
    "end": "1941760"
  },
  {
    "text": "client which needs a new version or leans will take it down it has a message",
    "start": "1941760",
    "end": "1948240"
  },
  {
    "text": "inbox which all these will keep activate that grain and a new silo and complete",
    "start": "1948240",
    "end": "1954000"
  },
  {
    "text": "your request and that means that you can do deployments without anyone noticing",
    "start": "1954000",
    "end": "1961040"
  },
  {
    "text": "so there will be you shouldn't really notice what you can notice is that there",
    "start": "1961040",
    "end": "1967620"
  },
  {
    "text": "might be a bit more access on your data layer on a database once it starts",
    "start": "1967620",
    "end": "1975300"
  },
  {
    "text": "unloading and loading grains again another thing is that test you really",
    "start": "1975300",
    "end": "1982740"
  },
  {
    "text": "when you start putting things into production you really want to be sure that you don't want to roll back so we",
    "start": "1982740",
    "end": "1990320"
  },
  {
    "text": "have a problem now that we perhaps do a bit more too much testing so we fail",
    "start": "1990320",
    "end": "1996450"
  },
  {
    "text": "something or we decide ok let's not roll forward and we will roll backward and then we will all the production traffic",
    "start": "1996450",
    "end": "2003620"
  },
  {
    "text": "we had on these silos will then how do we move down to the old ones and it's a",
    "start": "2003620",
    "end": "2009490"
  },
  {
    "text": "not where doesn't feel right so we I think we need to do more testing in a",
    "start": "2009490",
    "end": "2014659"
  },
  {
    "text": "pre-production environment and we need to test it when both are running and we",
    "start": "2014659",
    "end": "2021740"
  },
  {
    "text": "need also to test it fairly well with only the new one running so we need to sort of in our pre-production or I mean",
    "start": "2021740",
    "end": "2027679"
  },
  {
    "start": "2024000",
    "end": "2038000"
  },
  {
    "text": "probably shut it down and take it up so it only gets fresh state to see what",
    "start": "2027679",
    "end": "2033350"
  },
  {
    "text": "happens because you're not really sure if when",
    "start": "2033350",
    "end": "2040429"
  },
  {
    "start": "2038000",
    "end": "2073000"
  },
  {
    "text": "you're talking to this one yeah I know my data my user data will be on this one but if it's using reference data or some",
    "start": "2040429",
    "end": "2046549"
  },
  {
    "text": "other data I have on that server you can't really control unless you sort of",
    "start": "2046549",
    "end": "2052730"
  },
  {
    "text": "writing a plugin for it so deploying",
    "start": "2052730",
    "end": "2058820"
  },
  {
    "text": "this is is working well but it is not",
    "start": "2058820",
    "end": "2064190"
  },
  {
    "text": "something to be taken lightly",
    "start": "2064190",
    "end": "2067419"
  },
  {
    "text": "okay so another part of this is how is",
    "start": "2072490",
    "end": "2078440"
  },
  {
    "start": "2073000",
    "end": "2159000"
  },
  {
    "text": "this running when you start with all ends there's a plug in for a dashboard",
    "start": "2078440",
    "end": "2084520"
  },
  {
    "text": "which I recommend this is not for our operations people this is for the",
    "start": "2084520",
    "end": "2090679"
  },
  {
    "text": "developer we use it quite a lot it gives you a good feeling of how the system is",
    "start": "2090679",
    "end": "2095810"
  },
  {
    "text": "running if doesn't take a long time until you sort of get a feeling of how these numbers should look it tells you",
    "start": "2095810",
    "end": "2103460"
  },
  {
    "text": "how many active actually grains you have it tells you how many silos you have the",
    "start": "2103460",
    "end": "2110020"
  },
  {
    "text": "error rate if we go go beyond 0.01 or so",
    "start": "2110020",
    "end": "2116660"
  },
  {
    "text": "we there's a problem we have done there's not a system basically it's if",
    "start": "2116660",
    "end": "2122349"
  },
  {
    "text": "we not done anything stupid in our code that should be zero point zero zero and",
    "start": "2122349",
    "end": "2128990"
  },
  {
    "text": "then you have the response time and requests per second and these are",
    "start": "2128990",
    "end": "2134560"
  },
  {
    "text": "internal requests between all the grains so there will be a lot higher now right behind you see that in in peak hours we",
    "start": "2134560",
    "end": "2142040"
  },
  {
    "text": "do about internally two thousand three thousand requests per second while the",
    "start": "2142040",
    "end": "2147560"
  },
  {
    "text": "API is is doing significantly less than that and you see it also the most cold",
    "start": "2147560",
    "end": "2153830"
  },
  {
    "text": "grain it would be our cashed our stateless grains which are used by everyone you can drill down into the",
    "start": "2153830",
    "end": "2162500"
  },
  {
    "start": "2159000",
    "end": "2171000"
  },
  {
    "text": "grains you can see a list of all the grains so many activations you have the throughput and latency for for them and",
    "start": "2162500",
    "end": "2169660"
  },
  {
    "text": "then you can also drill down into a single grain and you get all the sort of",
    "start": "2169660",
    "end": "2176480"
  },
  {
    "start": "2171000",
    "end": "2192000"
  },
  {
    "text": "interface methods and how many calls they have and the latency for each of them it's very nice to have when you're",
    "start": "2176480",
    "end": "2183740"
  },
  {
    "text": "developing and get a get to know your system we then also feed this data into",
    "start": "2183740",
    "end": "2196599"
  },
  {
    "start": "2192000",
    "end": "2306000"
  },
  {
    "text": "application insights so this is from",
    "start": "2196599",
    "end": "2202410"
  },
  {
    "text": "evening last week we do about a PSI inside three million requests translate",
    "start": "2202410",
    "end": "2210790"
  },
  {
    "text": "to four requests per second so not much about what we are extremely happy about is the exceptions this is with",
    "start": "2210790",
    "end": "2216970"
  },
  {
    "text": "deployments and there's yeah not much to",
    "start": "2216970",
    "end": "2224500"
  },
  {
    "text": "say that we are extremely happy with having that low number on the public API",
    "start": "2224500",
    "end": "2229650"
  },
  {
    "text": "and the response time is 29 milliseconds also something we're happy about and",
    "start": "2229650",
    "end": "2235860"
  },
  {
    "text": "application in size is just a plug in we have filtered it a bit to get not to get",
    "start": "2235860",
    "end": "2241960"
  },
  {
    "text": "too much data but something just add to Orleans it has a lot of hooks for for",
    "start": "2241960",
    "end": "2249060"
  },
  {
    "text": "yeah storage for streams and queues for",
    "start": "2249060",
    "end": "2254100"
  },
  {
    "text": "analytics etc and this is other feature",
    "start": "2254100",
    "end": "2260410"
  },
  {
    "text": "we've implemented I don't know if we were to the observer built and",
    "start": "2260410",
    "end": "2266500"
  },
  {
    "text": "distributed systems but it's basically the same so we take the operation ID",
    "start": "2266500",
    "end": "2271590"
  },
  {
    "text": "application inside set on the.net coil Web API request we add that",
    "start": "2271590",
    "end": "2278080"
  },
  {
    "text": "operationally into Orleans and then we can enable logging so we get a full insights in if I call this an external",
    "start": "2278080",
    "end": "2286750"
  },
  {
    "text": "endpoint I get the full list of operations we're doing inside with all the grains to see what's happening and",
    "start": "2286750",
    "end": "2293040"
  },
  {
    "text": "we've had to use that one or two times to see we're doing something stupid",
    "start": "2293040",
    "end": "2301980"
  },
  {
    "start": "2306000",
    "end": "2355000"
  },
  {
    "text": "so lessons learned it's been very",
    "start": "2306770",
    "end": "2312600"
  },
  {
    "text": "different when you're not used actor and start working with it very fun I think",
    "start": "2312600",
    "end": "2321500"
  },
  {
    "text": "we've benefited a bit from having or a lot from having f sharp as a model it's",
    "start": "2321500",
    "end": "2327470"
  },
  {
    "text": "been very testable we do property based testing and model-based testing so our",
    "start": "2327470",
    "end": "2335430"
  },
  {
    "text": "unit test coverage is a lot smaller than what I'm used to",
    "start": "2335430",
    "end": "2341190"
  },
  {
    "text": "and also as I mentioned the fact that we can talk about the model and reason about without product owners and and a",
    "start": "2341190",
    "end": "2348180"
  },
  {
    "text": "new experience pent quite a high",
    "start": "2348180",
    "end": "2356400"
  },
  {
    "text": "performance and there's a lot of buttons once you start doing these distributed",
    "start": "2356400",
    "end": "2362220"
  },
  {
    "text": "systems we had a problem with storage the storage needs to be able to keep up",
    "start": "2362220",
    "end": "2369120"
  },
  {
    "text": "to speed with whatever you're doing you can do that by shorting you can place",
    "start": "2369120",
    "end": "2375300"
  },
  {
    "text": "different kind of data and different kind of storage and then we have life cycle we shouldn't get back to and then",
    "start": "2375300",
    "end": "2383340"
  },
  {
    "text": "there's placement now when we have a",
    "start": "2383340",
    "end": "2388680"
  },
  {
    "text": "user and we want to we know that okay for request I use it normally we load",
    "start": "2388680",
    "end": "2394110"
  },
  {
    "text": "quite a few grains if you can keep that user on one separate server on one silo",
    "start": "2394110",
    "end": "2401330"
  },
  {
    "text": "it will save a lot of network and I all latency so in Orleans you can either",
    "start": "2401330",
    "end": "2408180"
  },
  {
    "text": "write what's called a placement director so you sort of write some code we could perhaps use the user ID to say okay have",
    "start": "2408180",
    "end": "2414990"
  },
  {
    "text": "a static hash and put I use from the on silo or you can use something which is build in and say that okay I prefer that",
    "start": "2414990",
    "end": "2420840"
  },
  {
    "text": "all activations from this grain will be activated on the same silo so that means",
    "start": "2420840",
    "end": "2426480"
  },
  {
    "text": "that we can we know that when a user hits us we are normally just doing",
    "start": "2426480",
    "end": "2433560"
  },
  {
    "text": "memory operations there's no sterilization there's no network etc then you have",
    "start": "2433560",
    "end": "2439980"
  },
  {
    "text": "these cache cranes very useful makes it really fast and nice so if you if you",
    "start": "2439980",
    "end": "2450470"
  },
  {
    "text": "have some shared data use it the model",
    "start": "2450470",
    "end": "2456390"
  },
  {
    "text": "not everything needs to be persisted you can probably do something just in memory",
    "start": "2456390",
    "end": "2461730"
  },
  {
    "text": "while the grain is active and some in state persisted storage like I said just",
    "start": "2461730",
    "end": "2467910"
  },
  {
    "text": "keeping track of the last thing you watch will can save us a lot of operations because you know we're not",
    "start": "2467910",
    "end": "2474390"
  },
  {
    "text": "going to have to change any sorts because you still watching the same thing so it will still be at the top of your my content and then kubernetes yes",
    "start": "2474390",
    "end": "2485970"
  },
  {
    "text": "it is nice and shiny but nobody or not",
    "start": "2485970",
    "end": "2492540"
  },
  {
    "text": "that many are that good at running it already or operating it there are some but you don't necessarily find them and",
    "start": "2492540",
    "end": "2499410"
  },
  {
    "text": "then there's the number of silos so how many how many service do we need to do",
    "start": "2499410",
    "end": "2505140"
  },
  {
    "text": "our traffic and basically there's just a lot of things to turn on and it seemed",
    "start": "2505140",
    "end": "2511500"
  },
  {
    "text": "that if you okay we find one bottleneck and let me get some more speed and then you find a new one and so something you",
    "start": "2511500",
    "end": "2518130"
  },
  {
    "text": "have to work with an in keep track of idempotency we all our write operations",
    "start": "2518130",
    "end": "2525930"
  },
  {
    "start": "2521000",
    "end": "2567000"
  },
  {
    "text": "are idempotent that has saved us when we migrated four years of state from the",
    "start": "2525930",
    "end": "2533490"
  },
  {
    "text": "old solution for an arcade TV there's about 40 50 gigabytes of data we needed to import we had a bug luckily we had",
    "start": "2533490",
    "end": "2542099"
  },
  {
    "text": "our importances we can just run everything and do the whole import fixed",
    "start": "2542099",
    "end": "2547319"
  },
  {
    "text": "for those 82 or 20,000 users which had a problem just reinforce everything while",
    "start": "2547319",
    "end": "2554579"
  },
  {
    "text": "the other system was running and nobody noticed except that okay they got their missing favorites so very nice thing",
    "start": "2554579",
    "end": "2561770"
  },
  {
    "text": "happy that we did that didn't see coming that clearly and deadlock yes the grains are single",
    "start": "2561770",
    "end": "2572230"
  },
  {
    "start": "2567000",
    "end": "2645000"
  },
  {
    "text": "threaded but that means also if you drink calls back and forth you will and probably die",
    "start": "2572230",
    "end": "2578740"
  },
  {
    "text": "lurking yourself we have done that it was not as easy as that one but sort of",
    "start": "2578740",
    "end": "2586000"
  },
  {
    "text": "a grain is doing one thing it communicates with other why I'm messaging and if you're doing one thing",
    "start": "2586000",
    "end": "2592240"
  },
  {
    "text": "from one grain it's busy and sort of end up in that look possible yeah and then",
    "start": "2592240",
    "end": "2601600"
  },
  {
    "text": "we have this",
    "start": "2601600",
    "end": "2604020"
  },
  {
    "text": "we have learn about lot about how to run kubernetes now not to run kubernetes we",
    "start": "2611110",
    "end": "2617280"
  },
  {
    "text": "were close to take out down the main website because we needed to test our",
    "start": "2617280",
    "end": "2622780"
  },
  {
    "text": "migration we used all the memory on the server there was no memory left to the",
    "start": "2622780",
    "end": "2628360"
  },
  {
    "text": "other applications cubana started killing things they did not kill us first so yeah it's a I think it's right for us",
    "start": "2628360",
    "end": "2638710"
  },
  {
    "text": "to run communities but it's still something one need to think about then",
    "start": "2638710",
    "end": "2647620"
  },
  {
    "start": "2645000",
    "end": "2734000"
  },
  {
    "text": "yeah and this this was where we actually kill things so we have these position grains which",
    "start": "2647620",
    "end": "2655780"
  },
  {
    "text": "we know get a ping from the user every 30 seconds as long you are watching something if it gets at the lab for more",
    "start": "2655780",
    "end": "2663850"
  },
  {
    "text": "than let's say a minute we know the user is not watching anymore why should we keep it in memory just from that",
    "start": "2663850",
    "end": "2671760"
  },
  {
    "text": "so with all liens taking care of the life cycle you have to think of how long",
    "start": "2671760",
    "end": "2678640"
  },
  {
    "text": "should a grain be allowed to live in memory I think we had about eight million grains in memory and we're doing",
    "start": "2678640",
    "end": "2685720"
  },
  {
    "text": "the import and then things went bad and then is ok let's let's add just a",
    "start": "2685720",
    "end": "2693310"
  },
  {
    "text": "lifetime some things you might wonder how longer let's say debate user favorite entry points can live for a day",
    "start": "2693310",
    "end": "2700510"
  },
  {
    "text": "no problem perhaps a page for a username for a day but not the positions and the",
    "start": "2700510",
    "end": "2706360"
  },
  {
    "text": "favorites so after we adjusted the life time for those down to a few minutes we",
    "start": "2706360",
    "end": "2713380"
  },
  {
    "text": "could rerun the whole import we never activated more than 1.7 million grains",
    "start": "2713380",
    "end": "2719350"
  },
  {
    "text": "and we did not destroy everything else",
    "start": "2719350",
    "end": "2725400"
  },
  {
    "text": "so adjusting life's like we can really help on the memory and the speed of the system",
    "start": "2725400",
    "end": "2732599"
  },
  {
    "start": "2734000",
    "end": "2800000"
  },
  {
    "text": "logging is a passion that can kill you when you do these dependency tracing and",
    "start": "2735650",
    "end": "2742560"
  },
  {
    "text": "you do not sample you will have a lot of data and we added sort of double the",
    "start": "2742560",
    "end": "2749550"
  },
  {
    "text": "daily volume we report to application insights in just a few hours and then we",
    "start": "2749550",
    "end": "2756720"
  },
  {
    "text": "have some limits on application inside so we started softening us and everything went bad",
    "start": "2756720",
    "end": "2762330"
  },
  {
    "text": "first of all our system went slow because we were just sending too much data to application inside saturate in",
    "start": "2762330",
    "end": "2769050"
  },
  {
    "text": "the network and then yeah everything was",
    "start": "2769050",
    "end": "2775620"
  },
  {
    "text": "horrible it's so we needed to turn down what we log we need to turn on sampling",
    "start": "2775620",
    "end": "2782810"
  },
  {
    "text": "and so what is worse was that we actually walked by accident did",
    "start": "2782810",
    "end": "2789450"
  },
  {
    "text": "dependency tracing for all calls so all the grain chains where log to",
    "start": "2789450",
    "end": "2794520"
  },
  {
    "text": "application insights so that killed us pretty good and then there's this",
    "start": "2794520",
    "end": "2802410"
  },
  {
    "start": "2800000",
    "end": "2864000"
  },
  {
    "text": "concept of direct clients so I said we're moving away from having the Web API as a separate deployment in Cuban it",
    "start": "2802410",
    "end": "2809190"
  },
  {
    "text": "is we are moving it into the same process as the Orleans silo host and",
    "start": "2809190",
    "end": "2814460"
  },
  {
    "text": "reason that is that the client does not know where grain resides that is kept in",
    "start": "2814460",
    "end": "2820620"
  },
  {
    "text": "a grain reference static hash set with buckets on each silo",
    "start": "2820620",
    "end": "2825890"
  },
  {
    "text": "so the normal where a grain lives which server you need to talk to you need to",
    "start": "2825890",
    "end": "2831060"
  },
  {
    "text": "talk to server first and then you saw get okay I want to talk to something which is inside of three you call silo -",
    "start": "2831060",
    "end": "2838070"
  },
  {
    "text": "and then salad who doesn't have it the points are like three and go and get it and takes time so we I think it was last",
    "start": "2838070",
    "end": "2848370"
  },
  {
    "text": "week deploy to production where we host our Web API together with the early in",
    "start": "2848370",
    "end": "2856350"
  },
  {
    "text": "silo and that normally reduces at least",
    "start": "2856350",
    "end": "2861570"
  },
  {
    "text": "one at work up the changes perhaps not that clear on the graph but when you",
    "start": "2861570",
    "end": "2866640"
  },
  {
    "start": "2864000",
    "end": "2878000"
  },
  {
    "text": "look at the average response times this was a very",
    "start": "2866640",
    "end": "2872140"
  },
  {
    "text": "nice thing for us and then finally we",
    "start": "2872140",
    "end": "2880510"
  },
  {
    "start": "2878000",
    "end": "2993000"
  },
  {
    "text": "have storage we started out with with",
    "start": "2880510",
    "end": "2887050"
  },
  {
    "text": "cosmos DB and that is very fine you can scale cosmos to be you drag a slider you",
    "start": "2887050",
    "end": "2893500"
  },
  {
    "text": "pay a bit more you pay after a while quite a bit more and and you get the",
    "start": "2893500",
    "end": "2900130"
  },
  {
    "text": "sort of this throughput you need what happens is that cosmos V starts putting",
    "start": "2900130",
    "end": "2906849"
  },
  {
    "text": "up physical partitions and then all your",
    "start": "2906849",
    "end": "2912400"
  },
  {
    "text": "request units are short or just I think that divided so equally amongst all",
    "start": "2912400",
    "end": "2918579"
  },
  {
    "text": "those partitions and that's fine for our import it it made sense we could just",
    "start": "2918579",
    "end": "2924430"
  },
  {
    "text": "read through four years of data in a few hours but when we wanted to scale down",
    "start": "2924430",
    "end": "2931030"
  },
  {
    "text": "again you have all these partitions you're not getting rid of them because you cannot control how cosmos DB scales",
    "start": "2931030",
    "end": "2937599"
  },
  {
    "text": "up and down the physical partitions and now we certainly have a lot of physical partitions because you need that you get",
    "start": "2937599",
    "end": "2942849"
  },
  {
    "text": "the throughput so when you reduce the throughput you don't have enough for",
    "start": "2942849",
    "end": "2948579"
  },
  {
    "text": "partition so and then it is slightly",
    "start": "2948579",
    "end": "2953859"
  },
  {
    "text": "expensive so we went over to table storage and what we do is that we have a",
    "start": "2953859",
    "end": "2961960"
  },
  {
    "text": "separate storage account for different grain types so position which is what",
    "start": "2961960",
    "end": "2967359"
  },
  {
    "text": "we're absolutely recording the most of will have a separate storage account so we know the throughput we get for that",
    "start": "2967359",
    "end": "2973119"
  },
  {
    "text": "and then we have some other grains in all the partitions and I think that",
    "start": "2973119",
    "end": "2978369"
  },
  {
    "text": "saves us one hundred thousand a year at least so that is something to be aware",
    "start": "2978369",
    "end": "2985300"
  },
  {
    "text": "of to keep the storage up to speed and now I feel I dumped a whole lot of",
    "start": "2985300",
    "end": "2992580"
  },
  {
    "text": "things on you questions yes",
    "start": "2992580",
    "end": "3002080"
  },
  {
    "text": "the question is if we do also feed data to personalization from all the data",
    "start": "3006369",
    "end": "3012319"
  },
  {
    "text": "sources no this one is just for keeping track of your content for",
    "start": "3012319",
    "end": "3017589"
  },
  {
    "text": "recommendations and machine learning etc we use we use other setups for that yes",
    "start": "3017589",
    "end": "3028809"
  },
  {
    "text": "yeah so the question is okay we have these grains that aggregate everything",
    "start": "3051590",
    "end": "3057000"
  },
  {
    "text": "and what happens if you get a request for some new data which you do not already have as yeah well then we have",
    "start": "3057000",
    "end": "3068610"
  },
  {
    "text": "service bus so we take a copy of the messages and feed them off to to a",
    "start": "3068610",
    "end": "3076800"
  },
  {
    "text": "separate table so we can scan we also when you have customers DB we can query it but if not that is a problem in sort",
    "start": "3076800",
    "end": "3086400"
  },
  {
    "text": "of having and that's why I think you see in when peoples are discussing actor",
    "start": "3086400",
    "end": "3091410"
  },
  {
    "text": "system that event sourcing is not that uncommon that they build this around the",
    "start": "3091410",
    "end": "3097530"
  },
  {
    "text": "rent sourcing just to keep all the events because then you can just replay the events if not you need to be able to",
    "start": "3097530",
    "end": "3102570"
  },
  {
    "text": "query for it and will table storage will have to scan it and the data in table",
    "start": "3102570",
    "end": "3108510"
  },
  {
    "text": "storage except for the partition key and Roky will be binary encoded of course we",
    "start": "3108510",
    "end": "3116040"
  },
  {
    "text": "can binary decode it the open source we know how that works but it's still a bit",
    "start": "3116040",
    "end": "3121800"
  },
  {
    "text": "of work so that is something to be to spend some time on thinking about which",
    "start": "3121800",
    "end": "3127320"
  },
  {
    "text": "business requirements what do I need to answer to do to the business",
    "start": "3127320",
    "end": "3133550"
  },
  {
    "text": "well yeah",
    "start": "3136420",
    "end": "3139619"
  },
  {
    "text": "yeah I think the question is how do we feel about having the the business rules",
    "start": "3152800",
    "end": "3160900"
  },
  {
    "text": "spread all over or how do they actually work I think first of all you have",
    "start": "3160900",
    "end": "3170060"
  },
  {
    "text": "someone business rule it is normally sort of you will find one method responsible for doing that so it's very",
    "start": "3170060",
    "end": "3176690"
  },
  {
    "text": "testable I think and we are also I think",
    "start": "3176690",
    "end": "3184850"
  },
  {
    "text": "it's fairly easy to change and reason about what is different or what you need",
    "start": "3184850",
    "end": "3190070"
  },
  {
    "text": "to think of is that we cannot change things back in time unless of course you",
    "start": "3190070",
    "end": "3195530"
  },
  {
    "text": "have an event log you can replay it but so if you if you want to change the rule from from when we move from ok you have",
    "start": "3195530",
    "end": "3202130"
  },
  {
    "text": "watched 50% of a show let's make the favorite to you have watched 60% that",
    "start": "3202130",
    "end": "3208220"
  },
  {
    "text": "can only be done for new things so that is but that's for our case that is",
    "start": "3208220",
    "end": "3213380"
  },
  {
    "text": "actually what we want we don't want to change your sorting retrospectively so",
    "start": "3213380",
    "end": "3220340"
  },
  {
    "text": "but I think yeah it's a fairly I don't",
    "start": "3220340",
    "end": "3227870"
  },
  {
    "text": "feel it's a problem",
    "start": "3227870",
    "end": "3230620"
  },
  {
    "text": "well was that's all thank you [Applause]",
    "start": "3234420",
    "end": "3246409"
  }
]