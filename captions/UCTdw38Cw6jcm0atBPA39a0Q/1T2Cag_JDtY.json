[
  {
    "text": "okay so how many of you were at the keynote right before",
    "start": "6359",
    "end": "11840"
  },
  {
    "text": "this okay I feel the pressure because Dylan is fantastic he's a fantastic speakers is witty he invented his own",
    "start": "11840",
    "end": "19600"
  },
  {
    "text": "freaking uh programming language which you can sing I can neither thing nor",
    "start": "19600",
    "end": "25519"
  },
  {
    "text": "have I invented a programming language now um and but he had some",
    "start": "25519",
    "end": "30880"
  },
  {
    "text": "excellent tips for example to get a conversation going ask someone what they are working with what they are working",
    "start": "30880",
    "end": "36280"
  },
  {
    "text": "with so my teenage son actually tried that on me he said dad what are you actually doing when you're sitting at",
    "start": "36280",
    "end": "42280"
  },
  {
    "text": "the computer all the time and I said well I I do build login systems I build login bit buttons and you know that is",
    "start": "42280",
    "end": "48480"
  },
  {
    "text": "where the point where the one asking should encourage the person to continue speaking my son was like that can't be",
    "start": "48480",
    "end": "55480"
  },
  {
    "text": "hard and then that conversation was dead end but I'm from Sweden and Sweden",
    "start": "55480",
    "end": "62280"
  },
  {
    "text": "swedes we are not exactly known to be the most encouraging people maybe so I'm",
    "start": "62280",
    "end": "67680"
  },
  {
    "text": "very happy to be here in Denmark every time I get just get over the bridge it's like another world opens it's clean it's",
    "start": "67680",
    "end": "74200"
  },
  {
    "text": "nice it's warm there are people riding bikes walking everywhere instead of just the car Centric Swedish culture so well",
    "start": "74200",
    "end": "81360"
  },
  {
    "text": "I love being here in Copenhagen thank you for having me and thank you for letting me",
    "start": "81360",
    "end": "87159"
  },
  {
    "text": "in um this person here actually didn't get in he had a problem at the border",
    "start": "87159",
    "end": "96720"
  },
  {
    "text": "check because I want to start with so so I when I created this talk I figur out I",
    "start": "96720",
    "end": "102520"
  },
  {
    "text": "could just call it ASP on core or to be disambiguous between authentication and",
    "start": "102520",
    "end": "109360"
  },
  {
    "text": "authorization but I made up my mind I said that no I I should probably be",
    "start": "109360",
    "end": "114600"
  },
  {
    "text": "specific so let's see this guy has a problem but there are two different",
    "start": "114600",
    "end": "119920"
  },
  {
    "text": "scenarios in the first scenario he presents a passport where the photo doesn't look like you and you're not 155",
    "start": "119920",
    "end": "126280"
  },
  {
    "text": "CM nice try but no we won't let you in and the second scenario is that well it",
    "start": "126280",
    "end": "132680"
  },
  {
    "text": "is a valid passport from fistan the picture matches and everything it's obviously him but it's honest but no we",
    "start": "132680",
    "end": "139840"
  },
  {
    "text": "won't let you in because there's an embargo for for offistar",
    "start": "139840",
    "end": "145040"
  },
  {
    "text": "Citizens one of these is is authentication the other is iation the",
    "start": "145040",
    "end": "150599"
  },
  {
    "text": "first one which is it authentication yes failure to",
    "start": "150599",
    "end": "156840"
  },
  {
    "text": "establish who the PE so first is about establishing who the person is the second is about once we know who they",
    "start": "156840",
    "end": "164879"
  },
  {
    "text": "are what are they allowed to do in the system in asp.net",
    "start": "164879",
    "end": "171599"
  },
  {
    "text": "core this is a three stage process first we have the authentication step",
    "start": "171599",
    "end": "177920"
  },
  {
    "text": "happening and regardless how authentication is done it ends with setting HTTP context of user so in the",
    "start": "177920",
    "end": "185640"
  },
  {
    "text": "rest of the system the rest of the request pipeline we can just check hdp contexted user know that it is the",
    "start": "185640",
    "end": "192720"
  },
  {
    "text": "information about the current user and we can use the authoriz uh we can write",
    "start": "192720",
    "end": "198519"
  },
  {
    "text": "authorization rules based on that let's start with",
    "start": "198519",
    "end": "204120"
  },
  {
    "text": "authentication interacting with the authentication system in aset core there's an ey authentication Service you",
    "start": "204120",
    "end": "209439"
  },
  {
    "text": "can call call and inject but there are also convenience extension methods on HTTP context but there is is a core set",
    "start": "209439",
    "end": "216560"
  },
  {
    "text": "of abstract API methods that can be used for all different ways of",
    "start": "216560",
    "end": "223799"
  },
  {
    "text": "authentication so I want to start with this and um this is really the reason I want to start with",
    "start": "223799",
    "end": "230519"
  },
  {
    "text": "this really comes from my experience as a consultant at dend so D software we",
    "start": "230519",
    "end": "235560"
  },
  {
    "text": "build identity server I work with authentication solutions for a lot of",
    "start": "235560",
    "end": "241040"
  },
  {
    "text": "organizations and I can see that about half of our support issues and half of our",
    "start": "241040",
    "end": "248319"
  },
  {
    "text": "Consulting calls are really about a few very fundamental things that if you get",
    "start": "248319",
    "end": "253599"
  },
  {
    "text": "those wrong things just break so I'll try to condense those basic things into",
    "start": "253599",
    "end": "258880"
  },
  {
    "text": "this talk to see that if you have attended this talk you sh should be ahead of 50% of our support uh",
    "start": "258880",
    "end": "267560"
  },
  {
    "text": "requests so first one is about about what are the what is the actual API to use with the authentication",
    "start": "267560",
    "end": "274479"
  },
  {
    "text": "system the first method well if we build an authentication system we might have a",
    "start": "274479",
    "end": "280800"
  },
  {
    "text": "method called authenticate asnc but what does it really do and you know naming is",
    "start": "280800",
    "end": "287120"
  },
  {
    "text": "hard when I first saw this I thought that well this is probably about logging",
    "start": "287120",
    "end": "293440"
  },
  {
    "text": "in or establishing a session or something is not this is about querying",
    "start": "293440",
    "end": "298800"
  },
  {
    "text": "the request about is there any information is there a session cookie is there a beer token something on it do we",
    "start": "298800",
    "end": "305639"
  },
  {
    "text": "know who you are if we don't we can challenge",
    "start": "305639",
    "end": "311680"
  },
  {
    "text": "challenge is a signal to the authentication system that hey we have an a user here we don't know who they",
    "start": "311680",
    "end": "317360"
  },
  {
    "text": "are can you please sort that out for us so the typical flow is that we first",
    "start": "317360",
    "end": "322840"
  },
  {
    "text": "call authenticate asnc we don't get a result back that we uh then um we call",
    "start": "322840",
    "end": "331240"
  },
  {
    "text": "challenge a async to initiate signin eventually there will be a called",
    "start": "331240",
    "end": "337400"
  },
  {
    "text": "signning aing that establishes a session somehow and this obviously a sign out",
    "start": "337400",
    "end": "344800"
  },
  {
    "text": "which is the other way around the final API is for bid a sync which is the access denied page or saying that we",
    "start": "344800",
    "end": "352240"
  },
  {
    "text": "know who you are authorization failed we know who you are but you're not allowed to do this and these are abstract methods that",
    "start": "352240",
    "end": "359919"
  },
  {
    "text": "work across different kinds of authentication methods that uh remote",
    "start": "359919",
    "end": "365080"
  },
  {
    "text": "authentication cookie based Vero token apis all of them can just use the same",
    "start": "365080",
    "end": "370520"
  },
  {
    "text": "API surface let's start by looking at",
    "start": "370520",
    "end": "376199"
  },
  {
    "text": "cookies so authenticate async what would it do with in if we have a normal service side web application with a",
    "start": "376240",
    "end": "384520"
  },
  {
    "text": "cookie based session while authenticate Asing just validates the cookie on the incoming requ",
    "start": "384520",
    "end": "390919"
  },
  {
    "text": "challenge I think if you challenge a cookie to something um so the cookie cannot",
    "start": "390919",
    "end": "397319"
  },
  {
    "text": "conjure itself up from thin air can it no so this not really good thing for the",
    "start": "397319",
    "end": "402880"
  },
  {
    "text": "cookie Handler to do so what they decided to do in the Des design is that it redirects to preconfig login path so",
    "start": "402880",
    "end": "409759"
  },
  {
    "text": "this is one thing that sometimes gets tricky is that um suddenly your system",
    "start": "409759",
    "end": "415840"
  },
  {
    "text": "might redirect to SL account SL Lin even though you don't have a sl/ Lin in your application you never entered that path",
    "start": "415840",
    "end": "422840"
  },
  {
    "text": "anywhere where is/ account Lin coming from why is someone redirecting there",
    "start": "422840",
    "end": "428240"
  },
  {
    "text": "the answer is that it's the default login path of the cookie Handler so there was something CH challenging the",
    "start": "428240",
    "end": "434280"
  },
  {
    "text": "cookie Handler and it redirected to the default path and if you didn't put a page on SL account SL login well it",
    "start": "434280",
    "end": "441360"
  },
  {
    "text": "won't work calling sign in async on the cookie",
    "start": "441360",
    "end": "446960"
  },
  {
    "text": "handle will create the session cookie sound out well remove and forbid finally",
    "start": "446960",
    "end": "452039"
  },
  {
    "text": "just redirect to the access in ey page but this is a great API because",
    "start": "452039",
    "end": "458960"
  },
  {
    "text": "it's an abstraction there's nothing in here that actually says it has to be a cookie it could be something else as",
    "start": "458960",
    "end": "465520"
  },
  {
    "text": "well so for example it can be a be token for an API authenticate aing on an API",
    "start": "465520",
    "end": "471720"
  },
  {
    "text": "so for a cookie authenticate Asing was all about checking the",
    "start": "471720",
    "end": "477879"
  },
  {
    "text": "incoming request and decoding the cookie we do the same thing for a beer",
    "start": "477879",
    "end": "484000"
  },
  {
    "text": "token we validate the incoming token challenge is another thing so the",
    "start": "484000",
    "end": "492280"
  },
  {
    "text": "cookie authentication scheme is used in service side web application where the the one the client is a browser with an",
    "start": "492280",
    "end": "499000"
  },
  {
    "text": "actual human being there so we need to be nice to human",
    "start": "499000",
    "end": "503639"
  },
  {
    "text": "beings an API on the other hand is called by code a machine some why so how",
    "start": "504240",
    "end": "511000"
  },
  {
    "text": "do we tell in short form for uh to code",
    "start": "511000",
    "end": "516120"
  },
  {
    "text": "that hey you need to get your act together and attach something that we can make you validate your ident make us",
    "start": "516120",
    "end": "523000"
  },
  {
    "text": "validate your identity well return natur top status code anyone want to guess which status",
    "start": "523000",
    "end": "529760"
  },
  {
    "text": "code could be challenged 41 exactly just a for",
    "start": "529760",
    "end": "536000"
  },
  {
    "text": "one the API is the same across all these but signing asnc does it make even make",
    "start": "536000",
    "end": "543560"
  },
  {
    "text": "sense no an API is stateless there is no such thing as a session you just attach",
    "start": "543560",
    "end": "549240"
  },
  {
    "text": "a buau token for every API call so sign in is not defined sign out not defined",
    "start": "549240",
    "end": "555920"
  },
  {
    "text": "forbid that's another HTTP status code so if the first one is 401 what is this",
    "start": "555920",
    "end": "561680"
  },
  {
    "text": "one 403 exactly uh you are not",
    "start": "561680",
    "end": "568040"
  },
  {
    "text": "authorized then there's a bit of an interesting backstory here because what is the name in the HTTP spec for the",
    "start": "568040",
    "end": "576680"
  },
  {
    "text": "401 unauthorized back in the days when they wrote thep spec they were not exactly",
    "start": "576680",
    "end": "585040"
  },
  {
    "text": "clear about the difference between authentication and authorization so to attach a beer token to an HTP request to",
    "start": "585040",
    "end": "594480"
  },
  {
    "text": "authenticate the call you put it in the authorization header",
    "start": "594480",
    "end": "600399"
  },
  {
    "text": "um this is from the same age where they spelled refer a wrong you know every HTTP implementation has to spell refer a",
    "start": "600399",
    "end": "607760"
  },
  {
    "text": "wrong in the header because that is how it's written in the spec if you spell it right it it's not spec",
    "start": "607760",
    "end": "614959"
  },
  {
    "text": "compliant but regardless of how we if",
    "start": "615120",
    "end": "620519"
  },
  {
    "text": "it's a cookie that comes in or if it's a beer token that comes in with a request",
    "start": "620519",
    "end": "625760"
  },
  {
    "text": "once we have decoded it validated all of that thing that the handers does for us",
    "start": "625760",
    "end": "632000"
  },
  {
    "text": "we need to set dat to be contexted user and for a long time me I started doing",
    "start": "632000",
    "end": "637040"
  },
  {
    "text": "web development um I'm getting old it was",
    "start": "637040",
    "end": "642760"
  },
  {
    "text": "the last Millennium that I first wrote web things and back then it was fairly",
    "start": "642760",
    "end": "648880"
  },
  {
    "text": "simple because you just had to click integrated Windows authentication in that check box and then you had authentication working and there was the",
    "start": "648880",
    "end": "656720"
  },
  {
    "text": "HP context the user property was popular ulated uh and the same with net U net",
    "start": "656720",
    "end": "663880"
  },
  {
    "text": "came around a few years later we had the dot user property was populated and to",
    "start": "663880",
    "end": "669399"
  },
  {
    "text": "me it was just pure magic how it happened but it was populated then in aset core someone",
    "start": "669399",
    "end": "676399"
  },
  {
    "text": "showed me the authentication middleware the actual code that is responsible for this and I was kind of disappointed I",
    "start": "676399",
    "end": "684440"
  },
  {
    "text": "expected some mag magic and it looked like this it calls authenticate Asing",
    "start": "684440",
    "end": "689959"
  },
  {
    "text": "to create the S the incoming request about the authentication and then if there is a result it just assigns",
    "start": "689959",
    "end": "696440"
  },
  {
    "text": "context as user no",
    "start": "696440",
    "end": "702440"
  },
  {
    "text": "magic now I went ahead um I looked the at the system I was building I had a",
    "start": "702440",
    "end": "708920"
  },
  {
    "text": "login uh method username password and then I started thinking if I get to a",
    "start": "708920",
    "end": "715200"
  },
  {
    "text": "new system that prompts me with this I'm actually like like not another",
    "start": "715200",
    "end": "721040"
  },
  {
    "text": "one okay of course I have a password manager of course I have hundreds or thousands of passwords in my password",
    "start": "721040",
    "end": "726839"
  },
  {
    "text": "manager but I need to go and create another entry no I prefer sites that",
    "start": "726839",
    "end": "732959"
  },
  {
    "text": "offer me this I can just use one existing account my favorite login provider I can pick one to sell my soul",
    "start": "732959",
    "end": "743360"
  },
  {
    "text": "to um and that adds to aset something",
    "start": "743760",
    "end": "749639"
  },
  {
    "text": "called remote authentication handlers a remote authentication Handler knows how to do the handshape between our web",
    "start": "749639",
    "end": "755279"
  },
  {
    "text": "application and the Upstream provider once it has done that thing we",
    "start": "755279",
    "end": "761480"
  },
  {
    "text": "need to establish a session because if we look in with Google in an application we're not redirected to Google for every",
    "start": "761480",
    "end": "767560"
  },
  {
    "text": "request are we no uh we are redirected once and then there's a cookie",
    "start": "767560",
    "end": "773800"
  },
  {
    "text": "set to set that cookie well the Google Handler could know about cookies and how",
    "start": "773800",
    "end": "778959"
  },
  {
    "text": "to set them but that would be repeating the same functionality over again so what it does is that it actually lies on",
    "start": "778959",
    "end": "785800"
  },
  {
    "text": "the cookie Handler to the existing cookie Handler to do that so it just calls sign in on the cookie scheme there",
    "start": "785800",
    "end": "793720"
  },
  {
    "text": "cookie Handler so that why if we want to add another Upstream provider well there's still just one application",
    "start": "793720",
    "end": "799160"
  },
  {
    "text": "cookie that looks the same regardless uh so let's look a bit about",
    "start": "799160",
    "end": "805959"
  },
  {
    "text": "how a remote authentication Handler is the still implements the API it's still the same API authenticate async query",
    "start": "805959",
    "end": "814560"
  },
  {
    "text": "the remote Handler about the authentication State no doesn't make sense it doesn't carry any",
    "start": "814560",
    "end": "821320"
  },
  {
    "text": "state if you want to know the current state we need to carry the the cookie Handler challenge is think on the other",
    "start": "821320",
    "end": "827959"
  },
  {
    "text": "hand that is to initiate the sign in that makes sense it redirects to the",
    "start": "827959",
    "end": "833240"
  },
  {
    "text": "provider sign in no it doesn't make sense sign out doesn't make so sign out",
    "start": "833240",
    "end": "838399"
  },
  {
    "text": "doesn't make sense because um we do not establish a session sign out however makes",
    "start": "838399",
    "end": "845600"
  },
  {
    "text": "sense so some 15 years ago I was working on one of my first projects where we",
    "start": "845600",
    "end": "851040"
  },
  {
    "text": "actually did single sign on it it was a Swedish Healthcare project and we had to use an upstream provider that used smart",
    "start": "851040",
    "end": "857880"
  },
  {
    "text": "card logins etc for security for healthcare records and we implemented single sign",
    "start": "857880",
    "end": "864279"
  },
  {
    "text": "on through an upstream provider using S the S 2 protocol and everything was working",
    "start": "864279",
    "end": "870199"
  },
  {
    "text": "we implemented log out so if you click log out we just removed our session cookie in our",
    "start": "870199",
    "end": "875440"
  },
  {
    "text": "application and we thought that was fine and then we got a bug report from user the user said that hey I signed into the",
    "start": "875440",
    "end": "881800"
  },
  {
    "text": "application I was working in the application then after some I logged out and to V verify that the log out",
    "start": "881800",
    "end": "888839"
  },
  {
    "text": "actually worked I went back and tried to click a protected link and I was logged",
    "start": "888839",
    "end": "894839"
  },
  {
    "text": "in still your log out is broken",
    "start": "894839",
    "end": "899880"
  },
  {
    "text": "while our logout was not per se broken but what happened was that uh our logout",
    "start": "899920",
    "end": "906320"
  },
  {
    "text": "worked in our application but when the user clicked that protected link they were",
    "start": "906320",
    "end": "912040"
  },
  {
    "text": "immediately redirected to the Upstream provider where there still was a session and there was single signed on",
    "start": "912040",
    "end": "918199"
  },
  {
    "text": "back so sign out async actually makes sense for a remote provider because if",
    "start": "918199",
    "end": "924000"
  },
  {
    "text": "to implement log out properly when we use an upstream provider we need need to",
    "start": "924000",
    "end": "929279"
  },
  {
    "text": "be able to initiate sign out with the Upstream provider too finally for bid I think well no that",
    "start": "929279",
    "end": "937959"
  },
  {
    "text": "doesn't make sense so that's the theoretical abstruct",
    "start": "937959",
    "end": "944079"
  },
  {
    "text": "part let's look at some code and how we set this up the first call is to add a cookie at",
    "start": "944079",
    "end": "951399"
  },
  {
    "text": "cookie what that actually does is that it creates uh an instance of the cookie",
    "start": "951399",
    "end": "957560"
  },
  {
    "text": "options object and it registers a cookie Handler with the di system then we might",
    "start": "957560",
    "end": "963839"
  },
  {
    "text": "call add open ID connect to work with an upstream provider it creates once more open ID connect options and the open ID",
    "start": "963839",
    "end": "971319"
  },
  {
    "text": "connect Handler but then we need two Upstream handers we have this is a multi-tenanted",
    "start": "971319",
    "end": "977120"
  },
  {
    "text": "software service thing where we need to allow two different customers they both have their Upstream open ID connect",
    "start": "977120",
    "end": "982759"
  },
  {
    "text": "Handler so we need to call add open ID connect again okay what happens now we already have an open o options and NOC",
    "start": "982759",
    "end": "991959"
  },
  {
    "text": "Handler well it registers another instance of the oidc options and it",
    "start": "993079",
    "end": "999920"
  },
  {
    "text": "reuses the same oidc Handler that we already have and to keep track of these there's",
    "start": "999920",
    "end": "1007480"
  },
  {
    "text": "a concept called an authentication scheme and the scheme is defined as a",
    "start": "1007480",
    "end": "1012600"
  },
  {
    "text": "named instance of the options object and the corresponding hand handle type which",
    "start": "1012600",
    "end": "1018160"
  },
  {
    "text": "is available to di so we can have a cookie scheme an",
    "start": "1018160",
    "end": "1023560"
  },
  {
    "text": "identity service scheme and an Entre ID scheme in the same application so now it starts to get a",
    "start": "1023560",
    "end": "1030918"
  },
  {
    "text": "bit more complicated so when we call these methods we actually need to decide",
    "start": "1030919",
    "end": "1036918"
  },
  {
    "text": "which one to call so we need to specify a scheme so let let's take this if we have an application that uses an",
    "start": "1036919",
    "end": "1043438"
  },
  {
    "text": "upstream provider it still has cookies to persist the session locally if we",
    "start": "1043439",
    "end": "1049360"
  },
  {
    "text": "call authenticate async which one of the schemes should we pick how many think it's",
    "start": "1049360",
    "end": "1055880"
  },
  {
    "text": "cookies how many things we should Au call authenticate I think on the open ID connect",
    "start": "1055880",
    "end": "1062240"
  },
  {
    "text": "scheme and the rest of you you just waiting for someone else to answer okay that's fine we're still in Scandinavia",
    "start": "1062520",
    "end": "1069720"
  },
  {
    "text": "even though you are better than swedes uh but we're still in Scandinavia so",
    "start": "1069720",
    "end": "1075919"
  },
  {
    "text": "authenticator think when we want to query this session we need to call that on the cookie scheme to",
    "start": "1075919",
    "end": "1083120"
  },
  {
    "text": "challenge well we typically challenge the opened connect scheme because the openet connect schem is responsible for",
    "start": "1083360",
    "end": "1090159"
  },
  {
    "text": "performing the sign in for us once that is done we need to a session that's the",
    "start": "1090159",
    "end": "1096520"
  },
  {
    "text": "cookie scheme sign out is the only one where we need to do it on both schemes because we both need to tear down our",
    "start": "1096520",
    "end": "1102960"
  },
  {
    "text": "own local session and we need to instruct the Upstream provider to sign out and finally forbid is best handled",
    "start": "1102960",
    "end": "1109440"
  },
  {
    "text": "by the cookie Handler however it's a bit awkward if we need",
    "start": "1109440",
    "end": "1114480"
  },
  {
    "text": "to use scheme name explicitly every time so there is a system with a default",
    "start": "1114480",
    "end": "1120120"
  },
  {
    "text": "scheme in the configuration uh and this is one more place where I think often see that",
    "start": "1120120",
    "end": "1127039"
  },
  {
    "text": "people have the config has been is not correct and this causes all",
    "start": "1127039",
    "end": "1133960"
  },
  {
    "text": "kind of weird behaviors so there is a default scheme that is used for all over br if you don't specify something but",
    "start": "1133960",
    "end": "1140760"
  },
  {
    "text": "it's actually a default configurable for every single of these",
    "start": "1140760",
    "end": "1146360"
  },
  {
    "text": "operations and there's a fallback system so if you don't specify default challenge scheme it will use the default",
    "start": "1146960",
    "end": "1152880"
  },
  {
    "text": "scheme the overall main default scheme and the same is true for everything except default sign out which default to",
    "start": "1152880",
    "end": "1159679"
  },
  {
    "text": "falls back to default sign in then then falls back to default",
    "start": "1159679",
    "end": "1164799"
  },
  {
    "text": "scheme so we'll see this in demo shortly where we can actually set different default schemes for",
    "start": "1164799",
    "end": "1171200"
  },
  {
    "text": "different operations uh but first I want to revisit the",
    "start": "1171200",
    "end": "1179200"
  },
  {
    "text": "authentication middleware because I showed you the authentication middleware source code that was a simplified",
    "start": "1179200",
    "end": "1185039"
  },
  {
    "text": "version this is what it actually looks like it first checks what is the default authenticate scheme gets the scheme name",
    "start": "1185039",
    "end": "1192520"
  },
  {
    "text": "so it knows that it's the default scheme of the application that it should call authenticate on and set use to set the",
    "start": "1192520",
    "end": "1201679"
  },
  {
    "text": "context of user um why not skip out of slides a bit and",
    "start": "1201679",
    "end": "1208600"
  },
  {
    "text": "do some coding so I have a small application here that I",
    "start": "1208600",
    "end": "1215520"
  },
  {
    "text": "built that is running somewhere here in the",
    "start": "1215520",
    "end": "1222159"
  },
  {
    "text": "background so this is just a um very simple application where I can register",
    "start": "1222159",
    "end": "1229600"
  },
  {
    "text": "multiple authentication schemes and we can add login so it's time in this Sprint it's time for us to add uh",
    "start": "1229600",
    "end": "1236440"
  },
  {
    "text": "authentication and authorization to this application um I actually someone in the",
    "start": "1236440",
    "end": "1242480"
  },
  {
    "text": "previous Sprint someone created the no um am I not running",
    "start": "1242480",
    "end": "1247559"
  },
  {
    "text": "this so in the previous Sprint someone created a login page so there is actually a login page here",
    "start": "1247559",
    "end": "1256039"
  },
  {
    "text": "already uh let's see if it gets started yes the",
    "start": "1256039",
    "end": "1262200"
  },
  {
    "text": "login page there is a login page and there's password inv valid us name",
    "start": "1262200",
    "end": "1268559"
  },
  {
    "text": "password okay Anders Anders yeah this is a strong",
    "start": "1268559",
    "end": "1273600"
  },
  {
    "text": "password I got redirected back to the start page but it still says no authenticated user session please log it",
    "start": "1273600",
    "end": "1279240"
  },
  {
    "text": "in so something must be missing so let's see what do we have",
    "start": "1279240",
    "end": "1285679"
  },
  {
    "text": "here we have in our program we don't even have authentication wi up so let's add that",
    "start": "1285679",
    "end": "1292320"
  },
  {
    "text": "first builder. Services services. add authentication",
    "start": "1292320",
    "end": "1298120"
  },
  {
    "text": "add cookie make sure we have app.use",
    "start": "1298120",
    "end": "1305039"
  },
  {
    "text": "authentication uh and then let's go to see what the login page looks like the login oh is uh let me see",
    "start": "1305840",
    "end": "1313679"
  },
  {
    "text": "action log in so someone has already done very",
    "start": "1313679",
    "end": "1319240"
  },
  {
    "text": "secure can you see at the back is it large enough so someone has already made a very secure username password",
    "start": "1319240",
    "end": "1326760"
  },
  {
    "text": "thing and they have constructed a list of claims about the user so that we have",
    "start": "1326760",
    "end": "1334400"
  },
  {
    "text": "uh information about the user but they never got around to do the actual login",
    "start": "1334400",
    "end": "1339480"
  },
  {
    "text": "so let's do that um we know that we want to call await HTP context. signin async",
    "start": "1339480",
    "end": "1346600"
  },
  {
    "text": "right sign in async requires a principle to create a principle claims principle",
    "start": "1346600",
    "end": "1354080"
  },
  {
    "text": "principle we need to um when we create a principle a",
    "start": "1354080",
    "end": "1360400"
  },
  {
    "text": "principle is created around an identity so we need an identity let's create a claims identity",
    "start": "1360400",
    "end": "1368120"
  },
  {
    "text": "identity equals new oh this new magic thing where it right",
    "start": "1368120",
    "end": "1373919"
  },
  {
    "text": "codes for you and this new magic thing where it gets it wrong",
    "start": "1373919",
    "end": "1380440"
  },
  {
    "text": "because this will not work we can try and see if what happens",
    "start": "1380520",
    "end": "1386080"
  },
  {
    "text": "if we just trust try to trust AI because this is yet one more of the",
    "start": "1386080",
    "end": "1391360"
  },
  {
    "text": "weird things with how the system as nor core works I have no good explanation for",
    "start": "1391360",
    "end": "1399080"
  },
  {
    "text": "this Behavior at all let's try Ling in Enders",
    "start": "1399080",
    "end": "1405320"
  },
  {
    "text": "Enders we get an exception sign in a saying when principle is identity is",
    "start": "1405320",
    "end": "1410440"
  },
  {
    "text": "authenticated is fault is not allowed I I didn't set is authenticated",
    "start": "1410440",
    "end": "1417559"
  },
  {
    "text": "by just expect that if I create an identity it should be authenticated right so let's look up that thing um",
    "start": "1417559",
    "end": "1425520"
  },
  {
    "text": "that method or property identity dot is authenticated how is that one",
    "start": "1425520",
    "end": "1431799"
  },
  {
    "text": "defined it's defined as return not string is null or empty",
    "start": "1431799",
    "end": "1437400"
  },
  {
    "text": "authentication type and I mean this is really to me just weird but whenever we create an identity",
    "start": "1437400",
    "end": "1444159"
  },
  {
    "text": "we need to set an authentication",
    "start": "1444159",
    "end": "1449760"
  },
  {
    "text": "type and that's done here claims uh suggested password as the authenication",
    "start": "1452799",
    "end": "1458600"
  },
  {
    "text": "type there are a few more things that are good to set one is the name",
    "start": "1458600",
    "end": "1464320"
  },
  {
    "text": "type so for historical reason there is a property on ENT on claims identity",
    "start": "1464320",
    "end": "1469919"
  },
  {
    "text": "called do name which should return the name of the user now that we have claims based identities we want it to know what",
    "start": "1469919",
    "end": "1478399"
  },
  {
    "text": "claim should actually be presented as the name claim when we call the name property similar with",
    "start": "1478399",
    "end": "1484880"
  },
  {
    "text": "RS so always use the four perm version of the uh claims identity Constructor",
    "start": "1484880",
    "end": "1495759"
  },
  {
    "text": "so let's try to run it",
    "start": "1498559",
    "end": "1501679"
  },
  {
    "text": "again no authentication session please log in hey it says wel commanders so",
    "start": "1505679",
    "end": "1513120"
  },
  {
    "text": "obviously the name property works I'm logged in",
    "start": "1513120",
    "end": "1518520"
  },
  {
    "text": "uh if I log out again we we can now actually try these methods and see what",
    "start": "1518520",
    "end": "1523679"
  },
  {
    "text": "the API does to the cookie Handler uh if we challenge what what will",
    "start": "1523679",
    "end": "1530320"
  },
  {
    "text": "happen you think the login page yes if we call ah I need to maybe I",
    "start": "1530320",
    "end": "1538399"
  },
  {
    "text": "should complete this sign in Anders Anders no I can't type my own",
    "start": "1538399",
    "end": "1545399"
  },
  {
    "text": "name uh someone signed in sign out what will happen signing",
    "start": "1545399",
    "end": "1550960"
  },
  {
    "text": "out we can see the state now it's sign out forbid redirect to the access den9",
    "start": "1550960",
    "end": "1556919"
  },
  {
    "text": "page and authenticate well I'm currently not",
    "start": "1556919",
    "end": "1562039"
  },
  {
    "text": "authenticated but if I",
    "start": "1562039",
    "end": "1565559"
  },
  {
    "text": "am I will get information we can all now see that also that authenticate async if",
    "start": "1571480",
    "end": "1577760"
  },
  {
    "text": "we call directly we get both the claims and we get the property bag that is",
    "start": "1577760",
    "end": "1583120"
  },
  {
    "text": "metadata about the property uh so there is both the claim that describe the user",
    "start": "1583120",
    "end": "1589200"
  },
  {
    "text": "but also another generic property bag uh we can see here that the cookie Handler uses it internally for keeping track of",
    "start": "1589200",
    "end": "1596039"
  },
  {
    "text": "the lifetime of the session when was it C issued and when does it",
    "start": "1596039",
    "end": "1602639"
  },
  {
    "text": "expire um so let's see where I'm",
    "start": "1603919",
    "end": "1611640"
  },
  {
    "text": "running so that is what we have for auth cookie authentication um I think it's",
    "start": "1613399",
    "end": "1618600"
  },
  {
    "text": "time to add another authentication method I want to be able to use open ID connect authentication as well so I'll",
    "start": "1618600",
    "end": "1624480"
  },
  {
    "text": "just do add open ID connect and then I need to set a few options um I could talk for another hour",
    "start": "1624480",
    "end": "1632480"
  },
  {
    "text": "about what options to set on open ID connect but that is not the Focus right",
    "start": "1632480",
    "end": "1637679"
  },
  {
    "text": "now so I just have an extension method prepared configure ENT server so I'll connect configure the open connect",
    "start": "1637679",
    "end": "1645120"
  },
  {
    "text": "protocol to work with an demo instance of ident server that is",
    "start": "1645120",
    "end": "1650919"
  },
  {
    "text": "available but now I have two schemes when I just had one scheme that",
    "start": "1652640",
    "end": "1658240"
  },
  {
    "text": "automatically is the default scheme now I need to tell my system what it should do for different things so I can just",
    "start": "1658240",
    "end": "1665919"
  },
  {
    "text": "set the default scheme here is Cookie authentication defaults do authentication scheme",
    "start": "1665919",
    "end": "1673159"
  },
  {
    "text": "running my application again it allows me to do um this is interesting the contrast is",
    "start": "1680519",
    "end": "1687840"
  },
  {
    "text": "weird there are actually panels of shadowing here that on my monitor but not on that that one um I try to do nice",
    "start": "1687840",
    "end": "1695679"
  },
  {
    "text": "web design and then the projector doesn't just ignores it thank you so if I",
    "start": "1695679",
    "end": "1702880"
  },
  {
    "text": "challenge the open connect scheme that will send me over to the",
    "start": "1702880",
    "end": "1708840"
  },
  {
    "text": "open and DEC connect provider to sign in and I can now go and check",
    "start": "1708840",
    "end": "1715279"
  },
  {
    "text": "authenticating quer what is the resulting session sorry um that is actually I should of course authenticate",
    "start": "1715279",
    "end": "1721679"
  },
  {
    "text": "the cookies uh so I can see that I got a cookie created I can also see that the",
    "start": "1721679",
    "end": "1727320"
  },
  {
    "text": "property bag contains a lot more interesting things like an access token that we will later use to call an",
    "start": "1727320",
    "end": "1735200"
  },
  {
    "text": "API okay let's go back to that slip I did I clicked authenticate on the open",
    "start": "1736640",
    "end": "1742440"
  },
  {
    "text": "ID connect scheme does that make sense no but it's such a common thing that",
    "start": "1742440",
    "end": "1750559"
  },
  {
    "text": "people would do so the opened connate Handler just actually if you call authenticate on the openid connect",
    "start": "1750559",
    "end": "1757320"
  },
  {
    "text": "scheme it just forwards it to the signing scheme the default scheme so we actually you can still you",
    "start": "1757320",
    "end": "1764559"
  },
  {
    "text": "cannot actually authenticate on the opened connect scheme but it will help",
    "start": "1764559",
    "end": "1769880"
  },
  {
    "text": "you out I think that is I I don't agree with them because I think that this is",
    "start": "1769880",
    "end": "1775600"
  },
  {
    "text": "source of confusion um I think it would be better if this method failed on authentic on the open tic connect scheme",
    "start": "1775600",
    "end": "1782440"
  },
  {
    "text": "because that would make it more clear what's happening they made the the",
    "start": "1782440",
    "end": "1787880"
  },
  {
    "text": "decision um so let's talk about sign out if I so",
    "start": "1787880",
    "end": "1794000"
  },
  {
    "text": "if I do sign out on the cookies it will be just like the application I had back",
    "start": "1794000",
    "end": "1799440"
  },
  {
    "text": "in the days if I click challenge now here I'm automatically signed in because",
    "start": "1799440",
    "end": "1805080"
  },
  {
    "text": "I didn't terminate the session on the Upstream provider so if I click sign out on the open ID connect provider well I'm",
    "start": "1805080",
    "end": "1811240"
  },
  {
    "text": "redirected to Identity server and I can redirect back but I'm still signed in on",
    "start": "1811240",
    "end": "1817039"
  },
  {
    "text": "my application so I need to sign out to",
    "start": "1817039",
    "end": "1822240"
  },
  {
    "text": "both now I'm actually signed in signed out",
    "start": "1822240",
    "end": "1829399"
  },
  {
    "text": "so I have a log out button here that does that for us we can check the source",
    "start": "1829399",
    "end": "1834960"
  },
  {
    "text": "code of the logout button uh it is in controller CPI",
    "start": "1834960",
    "end": "1841720"
  },
  {
    "text": "controller logout so log out actually call starts",
    "start": "1841720",
    "end": "1847120"
  },
  {
    "text": "by calling authenticate async to get some more details about the current session it goes and check the",
    "start": "1847120",
    "end": "1852320"
  },
  {
    "text": "authentication properties for an or scheme let's see here do we have that oh",
    "start": "1852320",
    "end": "1859760"
  },
  {
    "text": "I'm not signed down",
    "start": "1859760",
    "end": "1863200"
  },
  {
    "text": "challenge so we have the orth scheme here open I connect so my code will go",
    "start": "1867240",
    "end": "1873240"
  },
  {
    "text": "and check okay how did we sign in was this an external sign in or just a local sign in if it was an external sign in we",
    "start": "1873240",
    "end": "1882080"
  },
  {
    "text": "sign out of both if not while we just sign out of the default so that that is how you need",
    "start": "1882080",
    "end": "1888639"
  },
  {
    "text": "build a proper proper sign out need to do",
    "start": "1888639",
    "end": "1893720"
  },
  {
    "text": "both so those are the apis for a service side web application uh let's continue with the next block of",
    "start": "1894080",
    "end": "1903120"
  },
  {
    "text": "features that I wanted to present I will have some time I will have time for questions at the",
    "start": "1903559",
    "end": "1909960"
  },
  {
    "text": "end so once we have set dat to be Contex of user then it's time to do",
    "start": "1909960",
    "end": "1915679"
  },
  {
    "text": "authorization and in asp.net authorization is done through policies",
    "start": "1915679",
    "end": "1920840"
  },
  {
    "text": "so in the actual code we just refer to policy name for example manage customer and then we have a separate piece of",
    "start": "1920840",
    "end": "1927120"
  },
  {
    "text": "code somewhere where we add authorization and Define the policy the interesting part is this where we set up",
    "start": "1927120",
    "end": "1935200"
  },
  {
    "text": "uh create a set of rules require authenticated user require claim to that",
    "start": "1935200",
    "end": "1940360"
  },
  {
    "text": "the department rule is um claim is sales and require role manager this is by the",
    "start": "1940360",
    "end": "1946880"
  },
  {
    "text": "way why why we ALS need the role name type uh name role claim type properly",
    "start": "1946880",
    "end": "1953039"
  },
  {
    "text": "set on the identity if we don't do that then uh require role will not work and",
    "start": "1953039",
    "end": "1959639"
  },
  {
    "text": "this is a very simple policy where we just use built-in requirements it is also possible to Define your own",
    "start": "1959639",
    "end": "1966399"
  },
  {
    "text": "requirements and there is a three- tiered architecture here where we can have a policy which is string over 18",
    "start": "1966399",
    "end": "1972720"
  },
  {
    "text": "you need to be over 18 to buy beer at least or buy beer at the pub at least in Sweden",
    "start": "1972720",
    "end": "1978440"
  },
  {
    "text": "do you have better rules in Denmark okay so I can safely say send my teenagers",
    "start": "1978440",
    "end": "1983559"
  },
  {
    "text": "here they will not be able to have beer that's good to know oh swedes need to be over 18 okay",
    "start": "1983559",
    "end": "1992240"
  },
  {
    "text": "my kids are swedes so but actually the oldest one is over 18 so then I'm okay",
    "start": "1992240",
    "end": "1997360"
  },
  {
    "text": " um we can express that as a requirement",
    "start": "1997360",
    "end": "2002799"
  },
  {
    "text": "and the requirement um is just data carrying object described ing the requirement",
    "start": "2002799",
    "end": "2008960"
  },
  {
    "text": "then we have handlers that actually evaluate the",
    "start": "2008960",
    "end": "2014039"
  },
  {
    "text": "requirements and this might not make sense in this simple scenario but let's look at another one um reading medical",
    "start": "2014480",
    "end": "2021000"
  },
  {
    "text": "record or patient journals um Swedish legislation says that it has to be smart",
    "start": "2021000",
    "end": "2027760"
  },
  {
    "text": "card login that is one requirement so we can have a Handler that checks if the current login method was smart",
    "start": "2027760",
    "end": "2034279"
  },
  {
    "text": "card and Swedish legislation also says that just because you've logged in and you're a healthc care professional you",
    "start": "2034279",
    "end": "2040320"
  },
  {
    "text": "cannot just go read anyone's P medical records you have to have a reason you have to have can some kind of relation",
    "start": "2040320",
    "end": "2047480"
  },
  {
    "text": "booked time or you're participating in the treatment of this patient how can we find out that well",
    "start": "2047480",
    "end": "2054358"
  },
  {
    "text": "one Handler could be to check the calendar is there appoint an appointment we could have a window saying that if",
    "start": "2054359",
    "end": "2060079"
  },
  {
    "text": "this healthc care professional had an appointment with a patient the last week or will have an appointment within the",
    "start": "2060079",
    "end": "2065800"
  },
  {
    "text": "next week then is fine otherwise not",
    "start": "2065800",
    "end": "2069720"
  },
  {
    "text": "um then we have these things where well not all uh visits to the hospital are",
    "start": "2070879",
    "end": "2079079"
  },
  {
    "text": "planned if someone arrives by ambulance you don't really put things in a calendar for that",
    "start": "2079079",
    "end": "2084960"
  },
  {
    "text": "right so we might have another Handler that checks if is this an emergency and",
    "start": "2084960",
    "end": "2090638"
  },
  {
    "text": "this is actually a correct thing that you can have multiple handles that evaluate the same requirement and",
    "start": "2090639",
    "end": "2097079"
  },
  {
    "text": "there's a vote vote if one of the Handler votes no it's a no if one of the Handler votes yes it is a yes so in this",
    "start": "2097079",
    "end": "2104520"
  },
  {
    "text": "case with the ambulance and the emergency room probably the appointment Handler would just say no idea it",
    "start": "2104520",
    "end": "2111760"
  },
  {
    "text": "wouldn't cost a vote at all and it would continue to the next Handler which would say that this is the ER it's",
    "start": "2111760",
    "end": "2118320"
  },
  {
    "text": "fine this is a powerful architecture especially if your handlers",
    "start": "2118320",
    "end": "2124880"
  },
  {
    "text": "need to invoke other services that are available in the DI system because the handles are full are services in the DI",
    "start": "2124880",
    "end": "2133359"
  },
  {
    "text": "it's powerful you can do whatever you need but for most cases it's just overly",
    "start": "2133359",
    "end": "2138480"
  },
  {
    "text": "complicated so I want to show you my escape hatch how to get out of the",
    "start": "2138480",
    "end": "2144480"
  },
  {
    "text": "complexity there's a there's actually another built-in method which is called require",
    "start": "2144480",
    "end": "2150560"
  },
  {
    "text": "assertion that just lets you write some code so require search you have access",
    "start": "2150560",
    "end": "2157319"
  },
  {
    "text": "to a context about uh the call and you can when doing this you can decide if",
    "start": "2157319",
    "end": "2163920"
  },
  {
    "text": "you want to return true or false so actually we could bug fix there was a bug in our previous implementation",
    "start": "2163920",
    "end": "2170920"
  },
  {
    "text": "because the previous implementation required the user to be a manager and",
    "start": "2170920",
    "end": "2176960"
  },
  {
    "text": "has have uh the user to have a department of sales",
    "start": "2176960",
    "end": "2183000"
  },
  {
    "text": "but the actual business requirement was that the sales department should all be able to everyone of the sales department",
    "start": "2183000",
    "end": "2189599"
  },
  {
    "text": "should be able to handle customers and managers from all departments so here we can express an or",
    "start": "2189599",
    "end": "2196160"
  },
  {
    "text": "expression using this let's go back to our demo and see",
    "start": "2196160",
    "end": "2201720"
  },
  {
    "text": "if we have any",
    "start": "2201720",
    "end": "2204440"
  },
  {
    "text": "authorization yeah uh Alice is logged in more details are found on our secure",
    "start": "2207440",
    "end": "2213640"
  },
  {
    "text": "page here it says invalid operation excep of the authorization policy named top secret was not found so obviously",
    "start": "2213640",
    "end": "2219800"
  },
  {
    "text": "I've in the previous Sprint someone set up authorization and uh said that",
    "start": "2219800",
    "end": "2226760"
  },
  {
    "text": "there's a top secret policy but they never got around to in that spring to implement uh",
    "start": "2226760",
    "end": "2233800"
  },
  {
    "text": "authorization so it's time to add it op the builder. services do add",
    "start": "2233800",
    "end": "2239160"
  },
  {
    "text": "authorization Services dot add add",
    "start": "2239160",
    "end": "2246520"
  },
  {
    "text": "authorization opt op. add policy top",
    "start": "2246520",
    "end": "2254520"
  },
  {
    "text": "secret p and p do require require authenticated",
    "start": "2254520",
    "end": "2261200"
  },
  {
    "text": "user why not do a weird thing require",
    "start": "2261200",
    "end": "2266960"
  },
  {
    "text": "require require assertion CTX in CTX we can just do uh CTX do user",
    "start": "2266960",
    "end": "2278000"
  },
  {
    "text": "do find find first uh or we can just identity do",
    "start": "2278000",
    "end": "2285079"
  },
  {
    "text": "name um dot starts with",
    "start": "2285079",
    "end": "2290520"
  },
  {
    "text": "a so any user start where the name starts with a will be able to L in we",
    "start": "2290520",
    "end": "2296560"
  },
  {
    "text": "also just need to handle the case if there is no you ID don't no name um if",
    "start": "2296560",
    "end": "2303079"
  },
  {
    "text": "the name is null",
    "start": "2303079",
    "end": "2306520"
  },
  {
    "text": "let's run it again if I now click log in uh I can just log in with",
    "start": "2322480",
    "end": "2330560"
  },
  {
    "text": "Bob secure page access denied Bob Bob's got the wrong name to",
    "start": "2330560",
    "end": "2336800"
  },
  {
    "text": "access this select Anders is me and",
    "start": "2336800",
    "end": "2343920"
  },
  {
    "text": "Alice top secret welcome Anders so it worked I've created my own custom policy",
    "start": "2343920",
    "end": "2350520"
  },
  {
    "text": "that works uh this is good but if I'm not lged in at all what will happen when I",
    "start": "2350520",
    "end": "2356960"
  },
  {
    "text": "try to access this page well the authorization system will automatically",
    "start": "2356960",
    "end": "2363160"
  },
  {
    "text": "Challenge and it will challenge the default challenge scheme but I don't want to use just I don't",
    "start": "2363160",
    "end": "2370160"
  },
  {
    "text": "want uh to have the uh the challenge to the default to be the local L I want the",
    "start": "2370160",
    "end": "2378560"
  },
  {
    "text": "default to use my open ID connect provider so let's fix that if I go in here to on the uh authentication setting",
    "start": "2378560",
    "end": "2386280"
  },
  {
    "text": "I can set the default default challenge scheme set it to open ID",
    "start": "2386280",
    "end": "2392359"
  },
  {
    "text": "connect defaults do authentication scheme so now I was said that whenever",
    "start": "2392359",
    "end": "2397599"
  },
  {
    "text": "the authorization system just challenges without anything it will challenge the open and connect",
    "start": "2397599",
    "end": "2404520"
  },
  {
    "text": "flow so let's run it",
    "start": "2405640",
    "end": "2409440"
  },
  {
    "text": "again uh I click secure authorization system finds out I",
    "start": "2415040",
    "end": "2420319"
  },
  {
    "text": "do not fulfill the required authenticated user requirement it says",
    "start": "2420319",
    "end": "2425760"
  },
  {
    "text": "okay what do we do then not authenticated let's challenge go here if",
    "start": "2425760",
    "end": "2431200"
  },
  {
    "text": "I log in with Bob I think it's lower case Bob here I will redirect it back it",
    "start": "2431200",
    "end": "2436480"
  },
  {
    "text": "tries the top secret page again the secure page again now it finds out I am",
    "start": "2436480",
    "end": "2442079"
  },
  {
    "text": "authenticated by Bob doesn't start with an A so it calls for bid on the default scheme and",
    "start": "2442079",
    "end": "2449520"
  },
  {
    "text": "I'm end up on the ss9 page if I look out and click again and try Alice",
    "start": "2449520",
    "end": "2456160"
  },
  {
    "text": "instead I'm",
    "start": "2456160",
    "end": "2460920"
  },
  {
    "text": "welcome so that is the block on authentication authorization I will continue a bit and talk about as at",
    "start": "2465200",
    "end": "2471520"
  },
  {
    "text": "identity but before I do that does anyone have any questions so far on authentication",
    "start": "2471520",
    "end": "2477838"
  },
  {
    "text": "authorization I will have time for more questions at the end um sorry",
    "start": "2479319",
    "end": "2487430"
  },
  {
    "text": "[Music] um so ASN net identity if you create an",
    "start": "2487430",
    "end": "2494680"
  },
  {
    "text": "application and which studio and select use individual user account you will get",
    "start": "2494680",
    "end": "2500720"
  },
  {
    "text": "the espet identity system bundled in your application together with a bunch of pages it looks like",
    "start": "2500720",
    "end": "2507160"
  },
  {
    "text": "this use a local account Lin or it has Support also for Upstream",
    "start": "2507160",
    "end": "2513240"
  },
  {
    "text": "providers I want to talk a bit about the architecture of iset because I find out that people often just add it and see it",
    "start": "2513240",
    "end": "2519640"
  },
  {
    "text": "as a black box but it's actually quite flexible architecture with that is modular first of all you get a bunch of",
    "start": "2519640",
    "end": "2526520"
  },
  {
    "text": "UI Pages um many years ago the UI Pages were",
    "start": "2526520",
    "end": "2533119"
  },
  {
    "text": "actually dumped as code in the template so if you created an web application using espat identity you get hundreds of",
    "start": "2533119",
    "end": "2539960"
  },
  {
    "text": "lines of code um and people were upset about that because they got tons of code that just",
    "start": "2539960",
    "end": "2547599"
  },
  {
    "text": "was there for them um so Microsoft invented these razor page libraries just",
    "start": "2547599",
    "end": "2554200"
  },
  {
    "text": "because of aset identity where you could pay put pages into the actual into a library a new get",
    "start": "2554200",
    "end": "2561599"
  },
  {
    "text": "package and then people were upet about that because they were stuck with Microsoft",
    "start": "2561599",
    "end": "2566800"
  },
  {
    "text": "layout so it's actually possible if you add this it's possible to still go in in",
    "start": "2566800",
    "end": "2573160"
  },
  {
    "text": "visual studio and select to scaffold and get the code into your appc so you can",
    "start": "2573160",
    "end": "2578680"
  },
  {
    "text": "fix the layout to look the way you want the main uh service in ASN at end",
    "start": "2578680",
    "end": "2585559"
  },
  {
    "text": "is the user manager which which lets you interact with the user Store the store",
    "start": "2585559",
    "end": "2591000"
  },
  {
    "text": "is actually an abstraction uh why so you can plug in",
    "start": "2591000",
    "end": "2597400"
  },
  {
    "text": "any storage method you have with aset identity if you have an existing",
    "start": "2597400",
    "end": "2602440"
  },
  {
    "text": "database an existing CRM system you can plug it in if you really want to I've we' never seen anyone do that everyone",
    "start": "2602440",
    "end": "2608599"
  },
  {
    "text": "just uses the end framework abstraction that sores it in a database",
    "start": "2608599",
    "end": "2614040"
  },
  {
    "text": "there's also another service called the signin manager the signin",
    "start": "2614040",
    "end": "2619599"
  },
  {
    "text": "manager and in both interacts with the user storage but also call sign in for",
    "start": "2619599",
    "end": "2627000"
  },
  {
    "text": "us and espet identity also mess up our authentication schemes it comes with",
    "start": "2627000",
    "end": "2633520"
  },
  {
    "text": "identity. application so the default cookie scheme is now called identity application and actually it has to be",
    "start": "2633520",
    "end": "2640960"
  },
  {
    "text": "called that if you because it's hardcoded inside the signin manager you so if you use aset identity you must use",
    "start": "2640960",
    "end": "2647920"
  },
  {
    "text": "the identity application name for the default cookie scheme or things will not",
    "start": "2647920",
    "end": "2653240"
  },
  {
    "text": "work so that's one scheme it actually also adds another scheme identity.",
    "start": "2653240",
    "end": "2659240"
  },
  {
    "text": "external so what is that well this is a clever pattern called the external L callback that is",
    "start": "2659240",
    "end": "2665800"
  },
  {
    "text": "used for external authentication so if we have an external",
    "start": "2665800",
    "end": "2670839"
  },
  {
    "text": "authentication method an upstream provider that is outside of our organization it sends its results to the",
    "start": "2670839",
    "end": "2678559"
  },
  {
    "text": "open ID connect Handler and this is kind of an integration we are integrating identity",
    "start": "2678559",
    "end": "2685200"
  },
  {
    "text": "and in any in code whereare we are doing integration with external Partners we do not allow data from external Partners to",
    "start": "2685200",
    "end": "2693000"
  },
  {
    "text": "go directly into our application right you should always check it clean it fix it translate",
    "start": "2693000",
    "end": "2700920"
  },
  {
    "text": "things before we allow it to go right in so we don't want to allow the",
    "start": "2700920",
    "end": "2707160"
  },
  {
    "text": "external identity from the external partner to go direct into our",
    "start": "2707160",
    "end": "2712680"
  },
  {
    "text": "application cookie so instead we instruct the ODC Handler to call sign in on identity. external can we quarantine",
    "start": "2712680",
    "end": "2720839"
  },
  {
    "text": "area it's a cookie it's there but it's not still uh it will not populate HTP",
    "start": "2720839",
    "end": "2728400"
  },
  {
    "text": "contacted user then we redirect to external call back which is a page that",
    "start": "2728400",
    "end": "2734680"
  },
  {
    "text": "can show UI it could for example see that hey you are a new user you never signed up with us before can you please",
    "start": "2734680",
    "end": "2740520"
  },
  {
    "text": "consent to our terms fill in our registration form you can drive UI you",
    "start": "2740520",
    "end": "2746119"
  },
  {
    "text": "can create the user automatically in the database if if if it's a businesses to business scenario you might want to see",
    "start": "2746119",
    "end": "2752359"
  },
  {
    "text": "that yeah it's a new user we should accept them let's create a user record",
    "start": "2752359",
    "end": "2757839"
  },
  {
    "text": "uh the external call by can call authenticate on identity external cookie scheme to get all the information from",
    "start": "2757839",
    "end": "2763480"
  },
  {
    "text": "the up provider it uses this user manager signin manager to eventually call sign in on the default signin ke to",
    "start": "2763480",
    "end": "2771440"
  },
  {
    "text": "create the main application session call sign up to get rid of the first set of",
    "start": "2771440",
    "end": "2776839"
  },
  {
    "text": "cookie the first cookie and finally reader it to the Target page and the now",
    "start": "2776839",
    "end": "2783400"
  },
  {
    "text": "as we have the identity application cookie set HTTP cont user is",
    "start": "2783400",
    "end": "2789558"
  },
  {
    "text": "populated um and the reason I want to bring this up is because I often see",
    "start": "2790280",
    "end": "2795400"
  },
  {
    "text": "that when you configure external providers together with aspet identity",
    "start": "2795400",
    "end": "2800520"
  },
  {
    "text": "you need to get these schemes right with it external and versus internal",
    "start": "2800520",
    "end": "2806240"
  },
  {
    "text": "application scheme another thing that ESP idty gives us is",
    "start": "2806240",
    "end": "2811800"
  },
  {
    "text": "the uh idea that we have a user that might have one or more login",
    "start": "2811800",
    "end": "2817599"
  },
  {
    "text": "methods this is stored in the aset users table and the aset user login",
    "start": "2817599",
    "end": "2822960"
  },
  {
    "text": "table and I think this is a good thing because it means that you can my separate your definition of the user",
    "start": "2822960",
    "end": "2830520"
  },
  {
    "text": "from the Upstream providers user ID and this allows for easy migration",
    "start": "2830520",
    "end": "2838280"
  },
  {
    "text": "between providers it also allows I mean I never remember if I used Facebook or",
    "start": "2838280",
    "end": "2843319"
  },
  {
    "text": "Google to sign up to site but if they used aspet identity I can connect both",
    "start": "2843319",
    "end": "2848359"
  },
  {
    "text": "so the next time I get to the site I could use both Google and Facebook and it will get me to the same actual user",
    "start": "2848359",
    "end": "2856400"
  },
  {
    "text": "account in the application so I will not show ad been",
    "start": "2856400",
    "end": "2862760"
  },
  {
    "text": "at identity to the application I just want to talk about it uh one final thing I want to cover is a mechanism called",
    "start": "2862760",
    "end": "2869640"
  },
  {
    "text": "Data protection data protection is a fairly lowlevel mechanism in aset core",
    "start": "2869640",
    "end": "2875960"
  },
  {
    "text": "but it's used a lot by the authentication system and it turns out that it's easy to overlook that you need",
    "start": "2875960",
    "end": "2882359"
  },
  {
    "text": "to that you should configure data protection because if you're not using it directly",
    "start": "2882359",
    "end": "2889559"
  },
  {
    "text": "when uh you shouldn't need to configure it right but actually you need so what",
    "start": "2889559",
    "end": "2895119"
  },
  {
    "text": "is data protection if you have a piece of data for example a set of claims and you want to store it somewhere untrusted",
    "start": "2895119",
    "end": "2901440"
  },
  {
    "text": "you can protect it for example you can have a set of claims you protect them",
    "start": "2901440",
    "end": "2906839"
  },
  {
    "text": "and then you have the cookie payload of session cookie and you can unprotect them and get the payload",
    "start": "2906839",
    "end": "2913640"
  },
  {
    "text": "back this is a dead simple encryption API has how many here has Tred to use",
    "start": "2913640",
    "end": "2921000"
  },
  {
    "text": "the AES class directly. net initialization",
    "start": "2921000",
    "end": "2926559"
  },
  {
    "text": "vectors uh you need to create them you need to keep track of them and not reuse them or if you happen to reuse them you",
    "start": "2926559",
    "end": "2932960"
  },
  {
    "text": "break the encryption uh Key Management you need to create Keys key rotation key should have",
    "start": "2932960",
    "end": "2939079"
  },
  {
    "text": "a finite lifetime there's a ton of things to think about when using AES",
    "start": "2939079",
    "end": "2945040"
  },
  {
    "text": "correctly data protection is doing all of that for us for example it creates",
    "start": "2945040",
    "end": "2950079"
  },
  {
    "text": "keys and uses them which means that somewhere there are encryption Keys",
    "start": "2950079",
    "end": "2957480"
  },
  {
    "text": "stored and that somewhere is while ASP core does the best it can guess for you",
    "start": "2957480",
    "end": "2964160"
  },
  {
    "text": "it stores it in the user profile on Windows if the user profile is loaded so what if we run everything under my",
    "start": "2964160",
    "end": "2971400"
  },
  {
    "text": "account and then we decide to change what account we run everything on in on the server well if the encryption key",
    "start": "2971400",
    "end": "2978400"
  },
  {
    "text": "was was in my account then data is lost um if there is no user profile it",
    "start": "2978400",
    "end": "2984119"
  },
  {
    "text": "uses local disk so what if we deploy to two server load balance servers well they will create a set of keys each on",
    "start": "2984119",
    "end": "2992599"
  },
  {
    "text": "disk so in any core application I recommend to always set up data",
    "start": "2992599",
    "end": "2998480"
  },
  {
    "text": "protection explicitly call add data protection set an application name this",
    "start": "2998480",
    "end": "3004640"
  },
  {
    "text": "is to prevent incorrect key re reuse the default way to the default application",
    "start": "3004640",
    "end": "3011440"
  },
  {
    "text": "name it deres is the path of where the application is deployed so if you just",
    "start": "3011440",
    "end": "3016880"
  },
  {
    "text": "change the file structure keys are lost it's better to send an explicit name we",
    "start": "3016880",
    "end": "3022280"
  },
  {
    "text": "should be explicit to where we save it for samp file system database um blob",
    "start": "3022280",
    "end": "3029839"
  },
  {
    "text": "Azure blob storage there are plenty of methods even a uh Amazon provides a set",
    "start": "3029839",
    "end": "3035359"
  },
  {
    "text": "of data protection libraries for as at core where you can store the data protection Keys using the Amazon",
    "start": "3035359",
    "end": "3042760"
  },
  {
    "text": "infrastructure I I'll just use a file system here an example but storing encryption keys in clear Tex is not a",
    "start": "3043079",
    "end": "3049480"
  },
  {
    "text": "good idea so let's encrypt the the encryption keys that we store on disk we can encrypt them with another secret",
    "start": "3049480",
    "end": "3056119"
  },
  {
    "text": "that we store in a key VA or certificate store on the machine or something like",
    "start": "3056119",
    "end": "3061359"
  },
  {
    "text": "that so any as core application in my opinion should have add data protection",
    "start": "3061359",
    "end": "3066480"
  },
  {
    "text": "and these three lines set application name persist keys to file system and protect keys with with something or",
    "start": "3066480",
    "end": "3073680"
  },
  {
    "text": "persist keys to somewhere protect keys with something",
    "start": "3073680",
    "end": "3078720"
  },
  {
    "text": "there are multiple options pick one that's suitable for your environment let's go do that to our application here",
    "start": "3078720",
    "end": "3085839"
  },
  {
    "text": "build it services. add data protection uh do set application",
    "start": "3085839",
    "end": "3092599"
  },
  {
    "text": "name Copenhagen do persist keys to false system we'll just use is a directory",
    "start": "3092599",
    "end": "3100280"
  },
  {
    "text": "info actually uh the current directory dot or we can take uh I think it was C",
    "start": "3100280",
    "end": "3107680"
  },
  {
    "text": "temp DP Keys probably have a bunch of keys in there already protect keys with",
    "start": "3107680",
    "end": "3113040"
  },
  {
    "text": "certificate and I have uh this thumb print is is a thumb print of",
    "start": "3113040",
    "end": "3118960"
  },
  {
    "text": "a certificate that is available on my machine right now so if we run it once",
    "start": "3118960",
    "end": "3125920"
  },
  {
    "text": "more and then if we go and check C colum back SLT DP",
    "start": "3133920",
    "end": "3140280"
  },
  {
    "text": "Keys we can see that we have it um in XML format we have the key here and it's",
    "start": "3140280",
    "end": "3146119"
  },
  {
    "text": "a of value so the actual key is encrypted using the certificate this is the public key part of the certificate",
    "start": "3146119",
    "end": "3153240"
  },
  {
    "text": "presented here um the reason I'm mentioning data",
    "start": "3153240",
    "end": "3158440"
  },
  {
    "text": "protection is it's not because you would necessarily use it yourself directly but",
    "start": "3158440",
    "end": "3164760"
  },
  {
    "text": "there are so many things in a single in the authentication system that makes use of it so if it isn't correctly",
    "start": "3164760",
    "end": "3172079"
  },
  {
    "text": "configured then it breaks I I would say that the dend the support about 30% of",
    "start": "3172079",
    "end": "3178040"
  },
  {
    "text": "our support requests boil down to incorrect data protection",
    "start": "3178040",
    "end": "3183400"
  },
  {
    "text": "configuration um okay so we have a final block I want to show you on",
    "start": "3187559",
    "end": "3194000"
  },
  {
    "text": "the uh demo app and that is uh I also have an API so I can call an",
    "start": "3194000",
    "end": "3201040"
  },
  {
    "text": "API and I can just see what happens if the if the API returns challenge",
    "start": "3201040",
    "end": "3208119"
  },
  {
    "text": "we have 401 as we said forbid what will it return 403 yeah and we can call authent",
    "start": "3208119",
    "end": "3216440"
  },
  {
    "text": "so we can uh call authenticate this means that we ask the uh so the the API",
    "start": "3216440",
    "end": "3224799"
  },
  {
    "text": "will call authenticate on the be token that it received and it will return the",
    "start": "3224799",
    "end": "3230319"
  },
  {
    "text": "contents authenticate failed um I'm not lged in and to get an access token I need to",
    "start": "3230319",
    "end": "3236880"
  },
  {
    "text": "work with Iden server authenticate fail so we can now",
    "start": "3236880",
    "end": "3243319"
  },
  {
    "text": "see that this is the contents of the access token that was sent to the",
    "start": "3243319",
    "end": "3248839"
  },
  {
    "text": "API we have the issuer demo dend software.com and a bunch of other stuff",
    "start": "3248839",
    "end": "3254920"
  },
  {
    "text": "that is available in the in the access token so we can have the same API uh",
    "start": "3254920",
    "end": "3262480"
  },
  {
    "text": "even in both we let's we can actually check the API what def find that you can",
    "start": "3262480",
    "end": "3268520"
  },
  {
    "text": "see here that we just have it's the same add authentication and then add jw2",
    "start": "3268520",
    "end": "3274480"
  },
  {
    "text": "beare it's just one scheme we don't have to specify default scheme it's this one that is the",
    "start": "3274480",
    "end": "3281558"
  },
  {
    "text": "scheme okay that is uh let's continue here",
    "start": "3282960",
    "end": "3289880"
  },
  {
    "text": "um so to summarize we have an application we set up Cookie based",
    "start": "3289880",
    "end": "3295240"
  },
  {
    "text": "sessions in our application we integrated with an upstream provider we did some top secret authorization rules",
    "start": "3295240",
    "end": "3302839"
  },
  {
    "text": "through our policy and we called an API using a bu token and saw that the API",
    "start": "3302839",
    "end": "3309280"
  },
  {
    "text": "uses just the same authentication system that is what I had so any",
    "start": "3309280",
    "end": "3317880"
  },
  {
    "text": "questions everything is crystal clear right and I feel still feel that I",
    "start": "3318559",
    "end": "3327160"
  },
  {
    "text": "I mean Dylan ended his talk by singing a song he had written which was actually working",
    "start": "3327160",
    "end": "3333599"
  },
  {
    "text": "code I'm sorry I'm not anywhere near his level at this but I hope it was",
    "start": "3333599",
    "end": "3340400"
  },
  {
    "text": "informative and if there's anything you want to ask I'll be around uh today and tomorrow so just grab me so thank you",
    "start": "3340400",
    "end": "3348599"
  },
  {
    "text": "for having me [Applause]",
    "start": "3348599",
    "end": "3357529"
  },
  {
    "text": "yeah so so the NDC evaluation system is that grab a gred green red or",
    "start": "3370920",
    "end": "3377480"
  },
  {
    "text": "yellow um slip of paper drop in the box so if you were happy green",
    "start": "3377480",
    "end": "3386480"
  },
  {
    "text": "oh I forgot to say also that the example code I used it's available on my GitHub account so the repository is there",
    "start": "3395720",
    "end": "3405680"
  }
]