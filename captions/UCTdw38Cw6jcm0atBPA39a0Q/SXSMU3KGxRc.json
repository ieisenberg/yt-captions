[
  {
    "text": "so welcome uh hope you had a good lunch",
    "start": "3879",
    "end": "9240"
  },
  {
    "text": "break and I got this wonderful slot right after lunch where everyone had wonderful food and they",
    "start": "9240",
    "end": "14960"
  },
  {
    "text": "sleepy um okay so I'm Andel I work for",
    "start": "14960",
    "end": "20880"
  },
  {
    "text": "dender software we do login buttons to put it simply or",
    "start": "20880",
    "end": "27359"
  },
  {
    "text": "identity and access management solution involving dend ident server but also a lot of other",
    "start": "27359",
    "end": "32920"
  },
  {
    "text": "components and what we see in our support forums Consulting work etc is",
    "start": "32920",
    "end": "39000"
  },
  {
    "text": "that there are a few basic concepts that obviously are not that easy to Gras",
    "start": "39000",
    "end": "46239"
  },
  {
    "text": "because we often see that problems are based on these basic factors so this talk is mostly about trying to",
    "start": "46239",
    "end": "53960"
  },
  {
    "text": "take um three topics that kind of make up at least half of our suppor issues or",
    "start": "53960",
    "end": "61680"
  },
  {
    "text": "turns out to be the root cause of half of our support issues and turn them into talk so that you won't have to make",
    "start": "61680",
    "end": "67000"
  },
  {
    "text": "these mistakes because you will know the these topics and uh how the setup Works",
    "start": "67000",
    "end": "73680"
  },
  {
    "text": "afterwards so first of all uh I started drafting this talk and said the title",
    "start": "73680",
    "end": "80920"
  },
  {
    "text": "let's do as. net core or because that's simple because or could mean both authentication and authorization so if",
    "start": "80920",
    "end": "87400"
  },
  {
    "text": "you say or nobody knows which one of of the them your meaning but was the difference so you're all here so either",
    "start": "87400",
    "end": "94920"
  },
  {
    "text": "you're local or you were let in to Norway um to be let into Norway this",
    "start": "94920",
    "end": "102320"
  },
  {
    "text": "poor guy here he is not being let in um but and there are two versions of",
    "start": "102320",
    "end": "109040"
  },
  {
    "text": "this story why he is not let in one is that the photo and characteristics",
    "start": "109040",
    "end": "115159"
  },
  {
    "text": "doesn't match so no nice try but this is not your password the other one is yeah it's a valid passport from for off is",
    "start": "115159",
    "end": "122439"
  },
  {
    "text": "honest but no I mean the Norwegian restrictions and embargos against for off are heavy so those citizens are not",
    "start": "122439",
    "end": "128920"
  },
  {
    "text": "let in one of these is that is failing authentication the other one is",
    "start": "128920",
    "end": "134400"
  },
  {
    "text": "authorization so let's make a poll so how many think the first one is",
    "start": "134400",
    "end": "139560"
  },
  {
    "text": "authentication does it fail authentication uh about half the hands",
    "start": "139560",
    "end": "144959"
  },
  {
    "text": "so how many think that the second one is that he fails Authentication no hands and those that didn't vote okay",
    "start": "144959",
    "end": "152640"
  },
  {
    "text": "you don't have a say that's correct the first one is authentication who are you can we establish your identity improve",
    "start": "152640",
    "end": "159599"
  },
  {
    "text": "it the second one is authorization once we know who you are we know that this",
    "start": "159599",
    "end": "165280"
  },
  {
    "text": "guy is perfectly well from from for office on and that means that we will not let him",
    "start": "165280",
    "end": "171519"
  },
  {
    "text": "in in aspet core those two things are separate",
    "start": "171519",
    "end": "177440"
  },
  {
    "text": "concerns and the glue between them is HTTP contexted user so we start with",
    "start": "177440",
    "end": "183760"
  },
  {
    "text": "authenticating the request establishing the identity that ends up on HTTP contacted user if you're writing a razor",
    "start": "183760",
    "end": "189560"
  },
  {
    "text": "page and web API controller anything you can usually just type user and the",
    "start": "189560",
    "end": "195319"
  },
  {
    "text": "identity of the caller will magically be there it's thanks to the authentication having run",
    "start": "195319",
    "end": "202360"
  },
  {
    "text": "already then we have the authorization rules that work based on that established identity so let's start with",
    "start": "202360",
    "end": "208959"
  },
  {
    "text": "Authentication the authentication API",
    "start": "208959",
    "end": "214720"
  },
  {
    "text": "in uh aset core has a few methods those are these are available as as extension",
    "start": "214720",
    "end": "220680"
  },
  {
    "text": "methods on HTTP context you can do HTTP context dot for example authenticate",
    "start": "220680",
    "end": "226519"
  },
  {
    "text": "async and I start with a tricky one because I think the naming of this is to",
    "start": "226519",
    "end": "231680"
  },
  {
    "text": "me this is a very confusing naming this actually means can we get information",
    "start": "231680",
    "end": "236879"
  },
  {
    "text": "about the information Who You Are um do we have anything on the request a",
    "start": "236879",
    "end": "242879"
  },
  {
    "text": "cookie beer token something that tells us who you are if we don't have that we can call",
    "start": "242879",
    "end": "249519"
  },
  {
    "text": "challenge asnc which is return some kind of response back to the caller that you",
    "start": "249519",
    "end": "255480"
  },
  {
    "text": "should get authenticated and then we have the one that I confuse with authenticated in s",
    "start": "255480",
    "end": "262280"
  },
  {
    "text": "in async which is when we have validated username and password or in some way",
    "start": "262280",
    "end": "268160"
  },
  {
    "text": "validated done the initial validation of the identity we call Sig in Asing to establish a session remember me for the",
    "start": "268160",
    "end": "275919"
  },
  {
    "text": "duration of the session then I I think I can guess what sign out async is",
    "start": "275919",
    "end": "282080"
  },
  {
    "text": "about forget me for now at least the final one is for bid",
    "start": "282080",
    "end": "288680"
  },
  {
    "text": "async which is we know who you are this is authorization it is denied we know who you are but you are not authorized",
    "start": "288680",
    "end": "296400"
  },
  {
    "text": "to access this resource it doesn't make sense to ch in that case because challenge was all about please log in or",
    "start": "296400",
    "end": "304360"
  },
  {
    "text": "establish your identity uh but if authorization failed",
    "start": "304360",
    "end": "309759"
  },
  {
    "text": "uh wrong button if authorization failed then uh we know who you are it doesn't",
    "start": "309759",
    "end": "316600"
  },
  {
    "text": "matter if you log in again you will still still not have",
    "start": "316600",
    "end": "321080"
  },
  {
    "text": "access so five basic apis that are usable and I find that",
    "start": "321720",
    "end": "328440"
  },
  {
    "text": "people um we are so used to having HTP contexted user that we kind of forget",
    "start": "328440",
    "end": "334479"
  },
  {
    "text": "that these apis are available that we can control this ourselves so let's take an example of",
    "start": "334479",
    "end": "341960"
  },
  {
    "text": "one authentication mechanism that is available in as at core the cookie Handler that is used to establish a",
    "start": "341960",
    "end": "349759"
  },
  {
    "text": "session in a normal service application so what would authenticate aing",
    "start": "349759",
    "end": "354840"
  },
  {
    "text": "translate to well it translates to validate the cookie",
    "start": "354840",
    "end": "360360"
  },
  {
    "text": "uh we have an incoming request authenticate async checks the incoming request sees that there is an",
    "start": "360360",
    "end": "365759"
  },
  {
    "text": "authentication cookie decodes it validate signatures or whatever we have to ensure that is real cookie and then",
    "start": "365759",
    "end": "374639"
  },
  {
    "text": "Returns the result the next one is more tricky challengeing I mean a cookie scheme what",
    "start": "374639",
    "end": "382720"
  },
  {
    "text": "can it do if if this was a Google login Handler Google login uh means that if we challenge",
    "start": "382720",
    "end": "391199"
  },
  {
    "text": "Google it means redirect to Google to sign in and do the stuff over Google and then come back what can a cookie handler do when",
    "start": "391199",
    "end": "398800"
  },
  {
    "text": "we challenge it well the only thing it can do is to redirect a login page and it doesn't even Supply the login page",
    "start": "398800",
    "end": "404840"
  },
  {
    "text": "you had to write it yourself so it redir to predefined or configured path and then you are expected to provide a login",
    "start": "404840",
    "end": "413000"
  },
  {
    "text": "page at that URL on that login page you are expected",
    "start": "413000",
    "end": "418720"
  },
  {
    "text": "to call sign in async which will cause the cookie Handler to create a",
    "start": "418720",
    "end": "424639"
  },
  {
    "text": "cookie and write a cookie by the session if you want to build a logout",
    "start": "424639",
    "end": "429800"
  },
  {
    "text": "button you call sign out async and finally for bid async it's the same as",
    "start": "429800",
    "end": "435919"
  },
  {
    "text": "re uh the challenge there's really not much the cookie Handler can do itself it",
    "start": "435919",
    "end": "441400"
  },
  {
    "text": "can just redirect to an access night path and you have to create that path yourself",
    "start": "441400",
    "end": "448960"
  },
  {
    "text": "but the good thing with this API is that it's agnostic of the mechanisms so while",
    "start": "451599",
    "end": "457160"
  },
  {
    "text": "it might feel a bit awkward sometimes to work with if we think of this as working in cookies the strength is that it works",
    "start": "457160",
    "end": "465479"
  },
  {
    "text": "also with for example a beer token in an API authenticate async in a beer",
    "start": "465479",
    "end": "472639"
  },
  {
    "text": "token well it checks the income in request for but now it doesn't check for a cookie it checks for a beer token",
    "start": "472639",
    "end": "478800"
  },
  {
    "text": "validat Tok challing what is the API way to say we",
    "start": "478800",
    "end": "486639"
  },
  {
    "text": "don't know who you are Do We R to a page for an API",
    "start": "486639",
    "end": "494919"
  },
  {
    "text": "no three digits 401 401 challenge async",
    "start": "494919",
    "end": "501120"
  },
  {
    "text": "so if we return challenge if we call challenge ASN uh on the J beer Handler",
    "start": "501120",
    "end": "506199"
  },
  {
    "text": "it will cause a 411 to be returned sign asnc well uh something why we use a be",
    "start": "506199",
    "end": "515320"
  },
  {
    "text": "token where the token needs to be attached to every single call there isn't even a thing a notion of a session",
    "start": "515320",
    "end": "522039"
  },
  {
    "text": "so it doesn't make sense it's a no op sign out async same",
    "start": "522039",
    "end": "527440"
  },
  {
    "text": "of course so for bid async what would that be if challenge is 401 what is for",
    "start": "527440",
    "end": "536000"
  },
  {
    "text": "bid 403 yes",
    "start": "536080",
    "end": "541000"
  },
  {
    "text": "so we return them and as you see the API is the same it's an abstract API and it",
    "start": "541120",
    "end": "548240"
  },
  {
    "text": "can behave differently depending if it's a machine to machine scenario or if it is uh for uh user using a",
    "start": "548240",
    "end": "558839"
  },
  {
    "text": "browser once we have authenticated so we we have done the first part of this three stage Pipeline on WE authenticated",
    "start": "559079",
    "end": "567040"
  },
  {
    "text": "that's I said that somehow ends up in HP contacted user and this used to be magic",
    "start": "567040",
    "end": "572360"
  },
  {
    "text": "for me I mean we just use h2p contacted user right but then I one day got aligned to",
    "start": "572360",
    "end": "580880"
  },
  {
    "text": "actually read the authentication middle wi source code I was curious how how do",
    "start": "580880",
    "end": "586560"
  },
  {
    "text": "HB contact user come along it's not that hard the authentication middle white calls authenticate async to get the",
    "start": "586560",
    "end": "594519"
  },
  {
    "text": "current user and then it just sets context with user to the principle if got from the uh hand cookie",
    "start": "594519",
    "end": "603160"
  },
  {
    "text": "Handler so surprisingly",
    "start": "603480",
    "end": "608199"
  },
  {
    "text": "simple and this works well if we have a normal web application with username",
    "start": "609120",
    "end": "614640"
  },
  {
    "text": "passwords uh the cookies will handle everything but are you really happy if",
    "start": "614640",
    "end": "620800"
  },
  {
    "text": "you get to if you go to new web page web application and you end up with the",
    "start": "620800",
    "end": "626440"
  },
  {
    "text": "prompt please create a password so either you use an existing password that you",
    "start": "626440",
    "end": "632519"
  },
  {
    "text": "remember or you have to create a new one and possibly add it to password manager",
    "start": "632519",
    "end": "638959"
  },
  {
    "text": "it's so much more easy if they actually Supply one of these buttons then I can just use my Google",
    "start": "638959",
    "end": "644639"
  },
  {
    "text": "account to sign in or sign in with apple or Facebook or which one whatever one I",
    "start": "644639",
    "end": "650800"
  },
  {
    "text": "choose but that lets me not have to create yet another",
    "start": "650800",
    "end": "656920"
  },
  {
    "text": "password um and what that this means is that we need some kind of authentication",
    "start": "656920",
    "end": "662600"
  },
  {
    "text": "Handler that can handle the interaction with an upstream provider Google Handler handles an",
    "start": "662600",
    "end": "669200"
  },
  {
    "text": "interaction with Upstream provider and that works perfectly well on the first request we make a request",
    "start": "669200",
    "end": "675440"
  },
  {
    "text": "we challenge we get reiterated to Google we get back you navigate to the next page do we navigate to Google",
    "start": "675440",
    "end": "684000"
  },
  {
    "text": "again to check for every page navigation do we navigate back to Google to check no of course not",
    "start": "684000",
    "end": "689839"
  },
  {
    "text": "we need to establish a session in our application and well I guess they could",
    "start": "689839",
    "end": "696880"
  },
  {
    "text": "have made the Google Handler know how to do that but we already have the cookie Handler so let's use the cookie Handler",
    "start": "696880",
    "end": "703959"
  },
  {
    "text": "and make them a separational concern so the cookie Handler knows how to maintain the application session and then we have",
    "start": "703959",
    "end": "710560"
  },
  {
    "text": "remote authentication handlers that know how to interact with an upstream",
    "start": "710560",
    "end": "716160"
  },
  {
    "text": "provider if we have two Upstream providers that choose between we still have one cookie",
    "start": "716160",
    "end": "722920"
  },
  {
    "text": "Handler and this brings us to what well",
    "start": "722920",
    "end": "728240"
  },
  {
    "text": "the same API applies for the Google Handler authenticate",
    "start": "728240",
    "end": "733480"
  },
  {
    "text": "async well that now it's that one that doesn't carry meaning you can't query",
    "start": "733480",
    "end": "739160"
  },
  {
    "text": "the Google Handler who is the currently established user because that's the business of the cookie Handler to",
    "start": "739160",
    "end": "744480"
  },
  {
    "text": "establish the session and keep track of the session challenge however that's something that Google The Google Handler",
    "start": "744480",
    "end": "750800"
  },
  {
    "text": "definitely didn't knows how to do it knows that if you challenge it it should",
    "start": "750800",
    "end": "756120"
  },
  {
    "text": "initiate the redirect to Google do all the security stuff that needs to be done before re before",
    "start": "756120",
    "end": "763480"
  },
  {
    "text": "redirecting and then once the response comes back from Google it should do the post Pro processing processed response",
    "start": "763480",
    "end": "770720"
  },
  {
    "text": "validate it and once done the Google Handler needs to establish a session it",
    "start": "770720",
    "end": "777680"
  },
  {
    "text": "doesn't Implement that itself it doesn't make sense it call sign in a sync on the",
    "start": "777680",
    "end": "782959"
  },
  {
    "text": "cookie Handler sign out a sync however has a meaning if we do single sign on we",
    "start": "782959",
    "end": "789279"
  },
  {
    "text": "might want single L out and finally for bday sync a remote",
    "start": "789279",
    "end": "795760"
  },
  {
    "text": "authentication hand lab doesn't car meaning",
    "start": "795760",
    "end": "802279"
  },
  {
    "text": "um so this is fine uh we have a situation where the",
    "start": "802279",
    "end": "807360"
  },
  {
    "text": "Google Handler or the remote Handler and the cookie Handler they take turn and Implement some of these each but what if",
    "start": "807360",
    "end": "814639"
  },
  {
    "text": "we start to add even more authentication handlers so we add",
    "start": "814639",
    "end": "820480"
  },
  {
    "text": "cookie first under the hood that will configure options to supply and eye",
    "start": "820480",
    "end": "827800"
  },
  {
    "text": "options of cookie options and it will register the cookie handle in the DI",
    "start": "827800",
    "end": "832880"
  },
  {
    "text": "system to make the cookie Handler available then we call add open and",
    "start": "832880",
    "end": "838399"
  },
  {
    "text": "connect for example we want to interact with Microsoft Entre ID we have the options and we have the",
    "start": "838399",
    "end": "844240"
  },
  {
    "text": "Handler then we call but our application does not only offer sign in with",
    "start": "844240",
    "end": "849880"
  },
  {
    "text": "Microsoft it also offers sign in with identity server which is the third third party openconnect",
    "start": "849880",
    "end": "856320"
  },
  {
    "text": "provider then we add a new set of options but it's the same Handler so",
    "start": "856320",
    "end": "861680"
  },
  {
    "text": "these options and we we have now two instances of the opened connect options",
    "start": "861680",
    "end": "867199"
  },
  {
    "text": "so the way we handle this is through the concept of a scheme so a scheme is a name for a",
    "start": "867199",
    "end": "876680"
  },
  {
    "text": "specific Handler and a specific configuration for that Handler so when we add cookie we register the cookie",
    "start": "876680",
    "end": "883920"
  },
  {
    "text": "scheme and that is implemented by a cookie options and the cookie Handler",
    "start": "883920",
    "end": "890120"
  },
  {
    "text": "when we we call at open iConnect the first time we name the scheme identity",
    "start": "890120",
    "end": "896199"
  },
  {
    "text": "server and that is one name options set of open ID connect options that are",
    "start": "896199",
    "end": "901800"
  },
  {
    "text": "specific for identi server and then when we call it the next time we have we name",
    "start": "901800",
    "end": "908000"
  },
  {
    "text": "the scheme Entre ID so we have another copy of the open ID connect options for each",
    "start": "908000",
    "end": "914759"
  },
  {
    "text": "scheme and that gives us the possibility to when we call these methods the apis",
    "start": "916160",
    "end": "922720"
  },
  {
    "text": "we can choose we can POS in a scheme name to select which one we want to call so in an application where we have",
    "start": "922720",
    "end": "929920"
  },
  {
    "text": "remote authentication which of these schemes so do we want to call",
    "start": "929920",
    "end": "936639"
  },
  {
    "text": "to do uh authenticate sync the cookie scheme is responsible",
    "start": "936639",
    "end": "943199"
  },
  {
    "text": "for that when we want to initiate the sign in which one do we take ohc",
    "start": "943199",
    "end": "951399"
  },
  {
    "text": "scheme sign in well it's the cookie scheme that's responsible for establishing the session",
    "start": "951399",
    "end": "959000"
  },
  {
    "text": "signing in sign out which",
    "start": "959000",
    "end": "965560"
  },
  {
    "text": "one anyone get want to guess is it the",
    "start": "966079",
    "end": "971759"
  },
  {
    "text": "uh cookie scheme or the ODC scheme sorry both yeah that's right I",
    "start": "971759",
    "end": "979120"
  },
  {
    "text": "thought this would be a nice question because any answer would be right but the answer is both because we need both",
    "start": "979120",
    "end": "985480"
  },
  {
    "text": "to clear out our local session that we have with a cookie and we might want to do a single log",
    "start": "985480",
    "end": "991800"
  },
  {
    "text": "out and finally for bid that's the business of the cookie okay so once we have multiple",
    "start": "991800",
    "end": "998839"
  },
  {
    "text": "schemes we probably we need a way to tell the application which one to use there is one property on the",
    "start": "998839",
    "end": "1005440"
  },
  {
    "text": "authentication options called the default scheme which is the unless we specify a scheme name that is used but",
    "start": "1005440",
    "end": "1011519"
  },
  {
    "text": "it's also possible to set a default scheme for each of the API actions and",
    "start": "1011519",
    "end": "1017120"
  },
  {
    "text": "there's a fallback hierarch key which means that most of them will fall back",
    "start": "1017120",
    "end": "1022759"
  },
  {
    "text": "so un if you haven't defined in a default challenge scheme default authenticate scheme default forbid scheme or default signin scheme they",
    "start": "1022759",
    "end": "1029000"
  },
  {
    "text": "will all fall back to using the default scheme but the default sign out scheme",
    "start": "1029000",
    "end": "1035798"
  },
  {
    "text": "is different it falls back to the default signin scheme which falls back to the default",
    "start": "1035799",
    "end": "1041360"
  },
  {
    "text": "scheme and this is also sort of confusion so now that we have that I",
    "start": "1041360",
    "end": "1047678"
  },
  {
    "text": "actually want to go back to the authentication middleware source code because I",
    "start": "1047679",
    "end": "1053400"
  },
  {
    "text": "cheated I made it a bit more simple than it actually was so this is the actual code it calls first scheme the scheme",
    "start": "1053400",
    "end": "1061039"
  },
  {
    "text": "provider to get the default authenticate scheme and then it use the default authenticate SCH it",
    "start": "1061039",
    "end": "1068200"
  },
  {
    "text": "authenticates the default authenticate scheme and it is that result so if we have multiple schemes the default one is",
    "start": "1068200",
    "end": "1075799"
  },
  {
    "text": "the one that ends up on HTP contacted user",
    "start": "1075799",
    "end": "1080720"
  },
  {
    "text": "um okay let's move on so the idea here I'm moving through a set of slides and then I have a demo app where we can play",
    "start": "1084120",
    "end": "1090720"
  },
  {
    "text": "around with this and it's one of those apps like how many of you have been in a project where we've started cranking out",
    "start": "1090720",
    "end": "1097360"
  },
  {
    "text": "functionality and then let's add security for the law loss we'll add that at that at the end I've been there so",
    "start": "1097360",
    "end": "1104880"
  },
  {
    "text": "that's is exactly what I did I made an app and then I forgot about security so we can add in the security part",
    "start": "1104880",
    "end": "1112039"
  },
  {
    "text": "together um so HP context of user once we have that we can do",
    "start": "1112039",
    "end": "1119039"
  },
  {
    "text": "authorization and in asp.net core we use something called policies so we just set",
    "start": "1119039",
    "end": "1124640"
  },
  {
    "text": "up a rule say that well to access this we need to fulfill the manage customer",
    "start": "1124640",
    "end": "1130799"
  },
  {
    "text": "policy and then in a separate place in the code we Define the policies the important lines are these",
    "start": "1130799",
    "end": "1138880"
  },
  {
    "text": "we can say that this policy requires authenticated user it requires a claim of that the department claim has the",
    "start": "1138880",
    "end": "1146039"
  },
  {
    "text": "value sales and the role manager so this is the simple way uh and",
    "start": "1146039",
    "end": "1154480"
  },
  {
    "text": "these are an the you need to uh fulfill all the requirements so you need to be",
    "start": "1154480",
    "end": "1160360"
  },
  {
    "text": "authenticated and be in the sales department and be a manager to fulfill",
    "start": "1160360",
    "end": "1166440"
  },
  {
    "text": "this there is also a way in the authorization structure from",
    "start": "1166440",
    "end": "1171880"
  },
  {
    "text": "Microsoft where you can do more things write your own",
    "start": "1171880",
    "end": "1176919"
  },
  {
    "text": "code we have a policy for example you need to be over 18 to buy alcoholic beverages is it the same in nor way 18",
    "start": "1176919",
    "end": "1185240"
  },
  {
    "text": "at the pub yeah um we can translate that into a",
    "start": "1185240",
    "end": "1193039"
  },
  {
    "text": "requirement which is a class that just carries 18 as a parameter instead and",
    "start": "1193039",
    "end": "1198200"
  },
  {
    "text": "then we have a generic Handler that could check any mean AG requirement this example doesn't really",
    "start": "1198200",
    "end": "1205039"
  },
  {
    "text": "make sense because it's a simple one so let's take another example let's take the case to read medical",
    "start": "1205039",
    "end": "1211400"
  },
  {
    "text": "records uh at least under Swedish legislation reading medical records require that you are logged in with",
    "start": "1211400",
    "end": "1218559"
  },
  {
    "text": "strong authentication with a smart card so that's the requirement and we have a handle that checks that there's also",
    "start": "1218559",
    "end": "1224559"
  },
  {
    "text": "another requirement that you have a relationship to the patient in the meaning that you are you have an",
    "start": "1224559",
    "end": "1231200"
  },
  {
    "text": "appointment or you're currently handling doing treatment on the patient",
    "start": "1231200",
    "end": "1237080"
  },
  {
    "text": "patient that can be checked by an appointment Handler that checks the calendar to see that before we return",
    "start": "1237080",
    "end": "1244520"
  },
  {
    "text": "the medical records of the patient we check the calendar if there is a recent booking or an upcoming booking with that",
    "start": "1244520",
    "end": "1254120"
  },
  {
    "text": "doctor but there's one case more that we need to handle",
    "start": "1254120",
    "end": "1259640"
  },
  {
    "text": "and that's the other way to enter the hospital that's through uh arriving by",
    "start": "1259640",
    "end": "1266520"
  },
  {
    "text": "ambulance nobody sets up an appointment for arri arriving at the hospital by",
    "start": "1266520",
    "end": "1271640"
  },
  {
    "text": "hospital by ambulance so we need to make an ex another Rule and say that well",
    "start": "1271640",
    "end": "1276679"
  },
  {
    "text": "patient relationship don't question that in case of emergency and this is a voting system so",
    "start": "1276679",
    "end": "1283080"
  },
  {
    "text": "if any of the Handler votes votes yes then the uh requirement is fulfilled and",
    "start": "1283080",
    "end": "1291400"
  },
  {
    "text": "if all the requirements are fulfilled the policy is",
    "start": "1291400",
    "end": "1295520"
  },
  {
    "text": "approved and this structure is definitely",
    "start": "1297200",
    "end": "1302880"
  },
  {
    "text": "powerful um and if you need your Handler to be test comp contain complex logic",
    "start": "1302880",
    "end": "1309159"
  },
  {
    "text": "that you need to test the Handler might reach out to the DI system read a database go call an API or whatever then",
    "start": "1309159",
    "end": "1316159"
  },
  {
    "text": "this is a great architecture because the handers of services in the DI where you can test them they can inject",
    "start": "1316159",
    "end": "1323279"
  },
  {
    "text": "dependencies such a data data context or database context things like",
    "start": "1323279",
    "end": "1328919"
  },
  {
    "text": "that but it's also quite a heavy thing to set up for",
    "start": "1328919",
    "end": "1335279"
  },
  {
    "text": "more simple scenarios so I often prefer to use uh the required search and",
    "start": "1335279",
    "end": "1341720"
  },
  {
    "text": "requirement which just let us write code it's a Boolean expression require search",
    "start": "1341720",
    "end": "1347440"
  },
  {
    "text": "and and and then return true or false and this actually allows us to fix a bug in the previous so um our stakeholders",
    "start": "1347440",
    "end": "1355520"
  },
  {
    "text": "came back and said that no no no you got it wrong the idea was not that you had to be a manager at the sales department",
    "start": "1355520",
    "end": "1363279"
  },
  {
    "text": "to manage customers the idea was that you either had to work in the sales department or be a",
    "start": "1363279",
    "end": "1370200"
  },
  {
    "text": "manager and we can express that as an assertion because then we can check either one of them",
    "start": "1370200",
    "end": "1378039"
  },
  {
    "text": "so that's the basic building blocks authentication authorization I also want to bring up a",
    "start": "1380039",
    "end": "1387640"
  },
  {
    "text": "library that is very often used if you create a new web application",
    "start": "1387640",
    "end": "1393159"
  },
  {
    "text": "and select individual user accounts in Visual Studio you will get asp.net identity bundle in your application",
    "start": "1393159",
    "end": "1399720"
  },
  {
    "text": "there will be a login page where you can have there will be forgot password registers user things",
    "start": "1399720",
    "end": "1407000"
  },
  {
    "text": "like that will be available in the",
    "start": "1407000",
    "end": "1411720"
  },
  {
    "text": "template and the asp.net identity system is actually quite pluggable and",
    "start": "1412640",
    "end": "1417840"
  },
  {
    "text": "extensible so I want to show you that first of all is that what we get is actually a set of UI Pages they used to be UI pages that they",
    "start": "1417840",
    "end": "1426880"
  },
  {
    "text": "actually generated hundreds of lines of code in like 30 different pages in your",
    "start": "1426880",
    "end": "1432320"
  },
  {
    "text": "application when you selected this option so you had an account controller an account area in razor pages with a",
    "start": "1432320",
    "end": "1438159"
  },
  {
    "text": "lot lot of page and lot of code and then they found out that people were upset to have all that code in their application",
    "start": "1438159",
    "end": "1444240"
  },
  {
    "text": "so they in invented razor page libraries as a way to handle that where you can",
    "start": "1444240",
    "end": "1451799"
  },
  {
    "text": "put the actual web pages in a component and new get component and that's brilliant because",
    "start": "1451799",
    "end": "1457559"
  },
  {
    "text": "now we don't have all that code in our application anymore and it also brilliant because we all get are stuck",
    "start": "1457559",
    "end": "1463640"
  },
  {
    "text": "with this layout and everyone wants exactly this layout on their login page right so what happens is that you have",
    "start": "1463640",
    "end": "1469840"
  },
  {
    "text": "to go to the scaffolding tool and say that please add the code to my project so we can adapt it and we are back where",
    "start": "1469840",
    "end": "1476279"
  },
  {
    "text": "we started but there are pages and they are driving it the important thing I want to push on here is that it's UI",
    "start": "1476279",
    "end": "1484360"
  },
  {
    "text": "page is where you can actually get a source code that is the entry point to your application and then the asp.net",
    "start": "1484360",
    "end": "1490480"
  },
  {
    "text": "identity Library supplies a user manager which is what you use to interact with the system the user manager works",
    "start": "1490480",
    "end": "1498480"
  },
  {
    "text": "against a store abstraction most templates end up and the default template ends up using",
    "start": "1498480",
    "end": "1505120"
  },
  {
    "text": "Microsoft as identi Ed framework package which implements the store abstraction",
    "start": "1505120",
    "end": "1511640"
  },
  {
    "text": "using enti framework but if you have an existing database or if you're not happy with the",
    "start": "1511640",
    "end": "1517799"
  },
  {
    "text": "database structure that Microsoft supplies you can plug in your own store",
    "start": "1517799",
    "end": "1523000"
  },
  {
    "text": "to aspnet Identity and still benefit from the user manager uh that API and",
    "start": "1523000",
    "end": "1529640"
  },
  {
    "text": "and what they how they handle users and maybe more importantly signning manager which is the one that handles all",
    "start": "1529640",
    "end": "1536360"
  },
  {
    "text": "password hashing lockout things like that so when the signin manager actually",
    "start": "1536360",
    "end": "1545399"
  },
  {
    "text": "has validated user who they are Etc the signin manager wants to sign in and establish a session of course it used an",
    "start": "1545399",
    "end": "1553320"
  },
  {
    "text": "existing component the cookie Handler but here's uh thing that trips",
    "start": "1553320",
    "end": "1559480"
  },
  {
    "text": "us up often asent it registers their own names for the cookie",
    "start": "1559480",
    "end": "1564799"
  },
  {
    "text": "schemes so ass soon as you add espet identity to your application your cookie",
    "start": "1564799",
    "end": "1569919"
  },
  {
    "text": "scheme is now named not cookies as the default name is it's now named identity",
    "start": "1569919",
    "end": "1576640"
  },
  {
    "text": "do application and you get another one uh so that's once again you get another one",
    "start": "1576640",
    "end": "1582399"
  },
  {
    "text": "called identity. external you actually get three more as well but these are the two important so what is identity.",
    "start": "1582399",
    "end": "1589600"
  },
  {
    "text": "external why do we need two cookie schemes I mean is it to log in two people on the same time no it's one",
    "start": "1589600",
    "end": "1597039"
  },
  {
    "text": "person at a time no this is actually a clever thing of",
    "start": "1597039",
    "end": "1602279"
  },
  {
    "text": "isolation from an upstream providers the the data model of uper provider so our",
    "start": "1602279",
    "end": "1609600"
  },
  {
    "text": "Upstream provider will redirect to our oidc Handler which will validate things",
    "start": "1609600",
    "end": "1616360"
  },
  {
    "text": "and here the oidc Handler will know the identity as described by",
    "start": "1616360",
    "end": "1622760"
  },
  {
    "text": "Google but when we are using espet identity we have our own database don't",
    "start": "1622760",
    "end": "1628080"
  },
  {
    "text": "we and we don't want Google identity to end up in our application because we want our own identities we want a user",
    "start": "1628080",
    "end": "1635080"
  },
  {
    "text": "ID that we can find in our database not a user ID that was the Google user ID so what uh the way this is configured",
    "start": "1635080",
    "end": "1643279"
  },
  {
    "text": "is that the ODC Handler is set up to sign in using identity. external which is not the default scheme then we",
    "start": "1643279",
    "end": "1650279"
  },
  {
    "text": "redirect to a separate page the external Ling callback page which picks up CA",
    "start": "1650279",
    "end": "1656840"
  },
  {
    "text": "authenticate on identity external to find the external identity that one can",
    "start": "1656840",
    "end": "1663000"
  },
  {
    "text": "use the user manager API and look okay we got an identity from Google here do",
    "start": "1663000",
    "end": "1668720"
  },
  {
    "text": "we have a matching record in our database do we maybe want to create a user on the fly in our database so it is",
    "start": "1668720",
    "end": "1675240"
  },
  {
    "text": "a way to have like an quarantine area for people coming from an external provider where we can do some uh",
    "start": "1675240",
    "end": "1684000"
  },
  {
    "text": "validation and pre-processing before we are happy and",
    "start": "1684000",
    "end": "1689600"
  },
  {
    "text": "okay let's say now we have our own representation of this user in our",
    "start": "1689600",
    "end": "1694720"
  },
  {
    "text": "database let's sign in that with identity application and call sign out on the external to get rid of the cookie",
    "start": "1694720",
    "end": "1700799"
  },
  {
    "text": "then we redirect to Target page and now identity of the application is our default scheme so that ends up on HB",
    "start": "1700799",
    "end": "1708799"
  },
  {
    "text": "contacted user so our Target page in the end can just use HB contacted user as",
    "start": "1708799",
    "end": "1716080"
  },
  {
    "text": "normal but when we set up handlers uh using aset identity it's important to",
    "start": "1717679",
    "end": "1723120"
  },
  {
    "text": "follow this pattern because to understand that the open ID connect Handler will actually sign in on",
    "start": "1723120",
    "end": "1729960"
  },
  {
    "text": "identity external the default signing scheme will be set to identity. external",
    "start": "1729960",
    "end": "1735919"
  },
  {
    "text": "because any external provider should call the I want to show you one more thing about",
    "start": "1735919",
    "end": "1741720"
  },
  {
    "text": "asmin entity and that is an important structure of the user database it is",
    "start": "1741720",
    "end": "1747240"
  },
  {
    "text": "that we have user and the user is a separate thing from a login and a login",
    "start": "1747240",
    "end": "1752880"
  },
  {
    "text": "could be for example user number 17 from Facebook you and I have user number 42",
    "start": "1752880",
    "end": "1760120"
  },
  {
    "text": "at Google um the identifiers need to be",
    "start": "1760120",
    "end": "1765279"
  },
  {
    "text": "used in Paris because use 17 from Google might not be the same person as user 17 from",
    "start": "1765279",
    "end": "1771399"
  },
  {
    "text": "Facebook so the user identifier from the Upstream provider is guaranteed to be unique from that specific provider but",
    "start": "1771399",
    "end": "1778559"
  },
  {
    "text": "if we want to make it uni in our application we must always use them in",
    "start": "1778559",
    "end": "1784159"
  },
  {
    "text": "pairs uh this is stor in asinet users table and in asinet user login",
    "start": "1784159",
    "end": "1790919"
  },
  {
    "text": "table so well these are actually kind of the only tables that are really",
    "start": "1791360",
    "end": "1796840"
  },
  {
    "text": "important in aset Identity or actually these are the",
    "start": "1796840",
    "end": "1803559"
  },
  {
    "text": "tables that are mostly used I have one final mechanism I want",
    "start": "1803559",
    "end": "1808720"
  },
  {
    "text": "to show you before we go ahead to the demo and that is data protection which",
    "start": "1808720",
    "end": "1814200"
  },
  {
    "text": "is a very much an internal mechanism um so data",
    "start": "1814200",
    "end": "1820320"
  },
  {
    "text": "protection uh is an encryption Al system has how many here have tried to use the",
    "start": "1820320",
    "end": "1826559"
  },
  {
    "text": "AES clause or as Library directly creating your own internalization Vector",
    "start": "1826559",
    "end": "1832279"
  },
  {
    "text": "remember to create a unique initialization Vector remember to save it did you rotate Keys",
    "start": "1832279",
    "end": "1839519"
  },
  {
    "text": "properly I didn't so there's a lot of AES is a good encryption standard but",
    "start": "1839519",
    "end": "1846679"
  },
  {
    "text": "there's a lot of work to do to actually use it right and data protection is a way to have a simplified API so if we",
    "start": "1846679",
    "end": "1853720"
  },
  {
    "text": "have something in clear text we want to get it encrypted well we protect protect",
    "start": "1853720",
    "end": "1858760"
  },
  {
    "text": "it the API actually is called protect and that ends up giving us a",
    "start": "1858760",
    "end": "1866240"
  },
  {
    "text": "encrypted and signed piece of data that we can then unprotect to get back the clear text this is for example used for",
    "start": "1866240",
    "end": "1874120"
  },
  {
    "text": "the session cookies so uh when we have established the identity of user we know",
    "start": "1874120",
    "end": "1880440"
  },
  {
    "text": "all the claims how to describe them what if they are an admin or not Etc uh what as onore does is that it's",
    "start": "1880440",
    "end": "1887919"
  },
  {
    "text": "serializes that runs it through data protection and puts it as a cookie in the browser because now it's encrypted",
    "start": "1887919",
    "end": "1894200"
  },
  {
    "text": "and sign so the user cannot alter that we can trust the data when it comes",
    "start": "1894200",
    "end": "1899399"
  },
  {
    "text": "back so this a really good API and they also make a really good educated guess",
    "start": "1899399",
    "end": "1905880"
  },
  {
    "text": "on where to store Keys how to uh how to separate Kate keys from different",
    "start": "1905880",
    "end": "1911000"
  },
  {
    "text": "applications and that cannot be used if someone tries to uh do a cipher text",
    "start": "1911000",
    "end": "1916960"
  },
  {
    "text": "swap attack it's not possible uh the problem is that this educated guas it works well on",
    "start": "1916960",
    "end": "1922919"
  },
  {
    "text": "development machine it might work on uh",
    "start": "1922919",
    "end": "1927960"
  },
  {
    "text": "test in your staging environment where you have one single server deployed it will most likely fail in Production Way",
    "start": "1927960",
    "end": "1934519"
  },
  {
    "text": "of multiple servers or containers so this is a very common thing that this",
    "start": "1934519",
    "end": "1940120"
  },
  {
    "text": "nice automatic API blows up on us in production so me all as core",
    "start": "1940120",
    "end": "1946240"
  },
  {
    "text": "applications we should configure this manually call add data protection set an",
    "start": "1946240",
    "end": "1951480"
  },
  {
    "text": "application name because the default is to use the path of the uh deployment so",
    "start": "1951480",
    "end": "1958720"
  },
  {
    "text": "if you just move your application to another path then you lose access to all your encrypted",
    "start": "1958720",
    "end": "1965039"
  },
  {
    "text": "data setting a name is a good thing it's also a good thing to decide where to",
    "start": "1965039",
    "end": "1970080"
  },
  {
    "text": "persist the keys maybe not temp uh but um especially if you have containers",
    "start": "1970080",
    "end": "1978960"
  },
  {
    "text": "if you have a deployment system where you overwrite the file system every time you make a new deployment deploy new",
    "start": "1978960",
    "end": "1985320"
  },
  {
    "text": "version you want this in a dedicated place that is persisted and you want to encrypt them",
    "start": "1985320",
    "end": "1991639"
  },
  {
    "text": "at rest with something that you know you will have access to like a certificate uh as your keyb um asure",
    "start": "1991639",
    "end": "2001399"
  },
  {
    "text": "actually works fairly well out of the box but it's still a good idea to do",
    "start": "2001399",
    "end": "2006720"
  },
  {
    "text": "this to make an explicit configuration if you run on AWS a Amazon even supplies",
    "start": "2006720",
    "end": "2013639"
  },
  {
    "text": "packages for data protection for ASB net core where that you can store this the",
    "start": "2013639",
    "end": "2019279"
  },
  {
    "text": "keys and protect them with the AWS",
    "start": "2019279",
    "end": "2023760"
  },
  {
    "text": "services so that's the presentation let's go to",
    "start": "2025279",
    "end": "2030440"
  },
  {
    "text": "some interesting thing code",
    "start": "2030440",
    "end": "2035080"
  },
  {
    "text": "I created a small API or a small page where I just about forgot to add",
    "start": "2037880",
    "end": "2043200"
  },
  {
    "text": "anything regarding authentication so I did actually create a login page but I don't think it does",
    "start": "2043200",
    "end": "2050638"
  },
  {
    "text": "anything yet um so well we can try let's see if",
    "start": "2050639",
    "end": "2057878"
  },
  {
    "text": "login is ERS uh no authenticated user so no there",
    "start": "2057879",
    "end": "2065480"
  },
  {
    "text": "there's a lot of things missing here so what is the oh sorry",
    "start": "2065480",
    "end": "2070520"
  },
  {
    "text": "I'll I should have this in light mode now",
    "start": "2070520",
    "end": "2075358"
  },
  {
    "text": "right dark mode we don't want dark mode because then you can't",
    "start": "2076399",
    "end": "2083760"
  },
  {
    "text": "dark ah sorry I should have think thought of this before use blue extra",
    "start": "2084839",
    "end": "2090878"
  },
  {
    "text": "contrast is usually good when presenting that is",
    "start": "2090879",
    "end": "2096440"
  },
  {
    "text": "better and let's do uh someone at the back end is that",
    "start": "2096440",
    "end": "2102400"
  },
  {
    "text": "enough yeah okay so let's go to our",
    "start": "2102400",
    "end": "2108480"
  },
  {
    "text": "program so here we have Services what was the first thing I should always make an explicit configuration",
    "start": "2108480",
    "end": "2115838"
  },
  {
    "text": "for data protection always make That explicit build uh Builder do services.",
    "start": "2118079",
    "end": "2125160"
  },
  {
    "text": "add data protection dot uh set application",
    "start": "2125160",
    "end": "2131320"
  },
  {
    "text": "name NDC uh persist keys to file",
    "start": "2131320",
    "end": "2138640"
  },
  {
    "text": "system and protect keys with now I have DP API which is a data protection API",
    "start": "2140079",
    "end": "2148200"
  },
  {
    "text": "from Windows so Microsoft has had different evolutions of data protection over time so the asp.net core data",
    "start": "2148200",
    "end": "2154680"
  },
  {
    "text": "protection API can actually use the windows layer d AP API to protect keys that is simple because it works",
    "start": "2154680",
    "end": "2161920"
  },
  {
    "text": "kind of out of the box but it uses my user account to encrypt the keys so if",
    "start": "2161920",
    "end": "2168480"
  },
  {
    "text": "we ever deploy this to a service running on another user account it will fail",
    "start": "2168480",
    "end": "2173920"
  },
  {
    "text": "it's I I'll use a certificate instead and since I don't like typing",
    "start": "2173920",
    "end": "2179960"
  },
  {
    "text": "thumbprints I'll just use a helper I had okay um oh it needs to be directory info",
    "start": "2179960",
    "end": "2189560"
  },
  {
    "text": "okay so that's how it's keeping out of the way now let's add authentication builder. services. add",
    "start": "2191760",
    "end": "2199839"
  },
  {
    "text": "authentication and let's start with adding cookies that's enough I think let's try",
    "start": "2199839",
    "end": "2206640"
  },
  {
    "text": "and run this and see if it works",
    "start": "2206640",
    "end": "2210799"
  },
  {
    "text": "so once more someone that back can you read or is it is okay good so if I click",
    "start": "2218920",
    "end": "2225640"
  },
  {
    "text": "log in Anders Anders",
    "start": "2225640",
    "end": "2231110"
  },
  {
    "text": "[Music] no it didn't work probably because we",
    "start": "2231110",
    "end": "2238200"
  },
  {
    "text": "configur it but what about the login page I designed a login page do that's",
    "start": "2238200",
    "end": "2244280"
  },
  {
    "text": "good oh sorry login control account control login method I designed it but did I no here it is to",
    "start": "2244280",
    "end": "2251760"
  },
  {
    "text": "do actually log in we forgot that part so I've gone as far as that well I have",
    "start": "2251760",
    "end": "2258440"
  },
  {
    "text": "a very secure user model validation we've gone as far as that we can describe the user as a set",
    "start": "2258440",
    "end": "2265160"
  },
  {
    "text": "of claim but we need to call sign in async uh so let's do that wait HTP",
    "start": "2265160",
    "end": "2271920"
  },
  {
    "text": "contact HTTP or yeah HTTP con text the property",
    "start": "2271920",
    "end": "2278560"
  },
  {
    "text": "do sign in async and it accepts expected principle",
    "start": "2278560",
    "end": "2284920"
  },
  {
    "text": "okay let's create one um R principle equals new claims",
    "start": "2284920",
    "end": "2292280"
  },
  {
    "text": "principle claims principle there are a few different flavors but it expects an identity identity thank",
    "start": "2292280",
    "end": "2301560"
  },
  {
    "text": "you okay so we need to claims identity uh identity equals new claims",
    "start": "2303400",
    "end": "2310200"
  },
  {
    "text": "identity and here's the tricky thing we can use claims let's try",
    "start": "2310200",
    "end": "2316640"
  },
  {
    "text": "this and see if it works because this is a really one of",
    "start": "2316640",
    "end": "2321800"
  },
  {
    "text": "those odd things in how the API Works let's log",
    "start": "2321800",
    "end": "2327839"
  },
  {
    "text": "in Enders Enders oh so it",
    "start": "2327839",
    "end": "2335400"
  },
  {
    "text": "says uh sign in a sync when principle do identity is authenticated is false is",
    "start": "2335400",
    "end": "2341200"
  },
  {
    "text": "not allowed oh they there a guard for that that's good uh but I mean I created",
    "start": "2341200",
    "end": "2348119"
  },
  {
    "text": "an identity here why would it say the identity isn't authenticated was this this is one of the quirks with this",
    "start": "2348119",
    "end": "2355119"
  },
  {
    "text": "API there is a property called authentication type and there is a flag",
    "start": "2355119",
    "end": "2362400"
  },
  {
    "text": "is authenticated and we use that often in our code like you if you is",
    "start": "2362400",
    "end": "2367720"
  },
  {
    "text": "authenticated show stuff or whatever if you if not user is authenticated show",
    "start": "2367720",
    "end": "2372800"
  },
  {
    "text": "the please login message how is the is authenticated method implemented well",
    "start": "2372800",
    "end": "2378880"
  },
  {
    "text": "it's implemented by string is null or empty authentication",
    "start": "2378880",
    "end": "2384520"
  },
  {
    "text": "type that's obvious isn't it no so we always need to supply an",
    "start": "2384520",
    "end": "2389800"
  },
  {
    "text": "authentication type we should always use also Supply name and role types where to",
    "start": "2389800",
    "end": "2395680"
  },
  {
    "text": "be explicit with a claim name uh so let's put it like this uh use the",
    "start": "2395680",
    "end": "2402359"
  },
  {
    "text": "four par version of this Constructor let's run it",
    "start": "2402359",
    "end": "2409880"
  },
  {
    "text": "again login Anders",
    "start": "2414680",
    "end": "2420160"
  },
  {
    "text": "Anders hey welcome Anders woohoo it worked",
    "start": "2420160",
    "end": "2426599"
  },
  {
    "text": "so well I added a sample here where we can actually try the different things on this so challenge if I challenge the",
    "start": "2427599",
    "end": "2435400"
  },
  {
    "text": "cookie scheme what will happen anyone there to help",
    "start": "2435400",
    "end": "2444839"
  },
  {
    "text": "me I'll click it it takes me to the Lin",
    "start": "2446200",
    "end": "2452040"
  },
  {
    "text": "page uh I'm going to skip that for now and use forbid so forbid takes me to the",
    "start": "2454040",
    "end": "2461119"
  },
  {
    "text": "access Deni page and authenticate if we call",
    "start": "2461119",
    "end": "2466640"
  },
  {
    "text": "authenticate we get is here it says authentication succeeded and we get a",
    "start": "2466640",
    "end": "2472680"
  },
  {
    "text": "list of claims we also get properties so an authentication cookie",
    "start": "2472680",
    "end": "2478680"
  },
  {
    "text": "or actually an authentication ticket in aset core contains both a set of claims",
    "start": "2478680",
    "end": "2484280"
  },
  {
    "text": "but there's also a property bag where where we can keep other things around that we need for example bookkeeping of",
    "start": "2484280",
    "end": "2490960"
  },
  {
    "text": "the issuance and expiry time of the session so let's click sign",
    "start": "2490960",
    "end": "2497760"
  },
  {
    "text": "out well um it says we're not authenticated anymore so let's try authenticate now it says no",
    "start": "2497760",
    "end": "2504359"
  },
  {
    "text": "authentication result returned",
    "start": "2504359",
    "end": "2509560"
  },
  {
    "text": "good what about um adding some more authentication ways because just use no",
    "start": "2509560",
    "end": "2516400"
  },
  {
    "text": "password is boring so I want to add open ID connect as",
    "start": "2516400",
    "end": "2523400"
  },
  {
    "text": "well and here I'm cheating opt do uh configure identity server",
    "start": "2523400",
    "end": "2531520"
  },
  {
    "text": "so obviously there are lot there are a bunch of options on this options object",
    "start": "2531520",
    "end": "2536640"
  },
  {
    "text": "that need to be set to work with the demo instance of wend identi server I don't have time to go into details on",
    "start": "2536640",
    "end": "2542440"
  },
  {
    "text": "that and the idea here is really just to show what it looks like when I have the",
    "start": "2542440",
    "end": "2548880"
  },
  {
    "text": "scheme um so let's run",
    "start": "2548880",
    "end": "2553720"
  },
  {
    "text": "it let's click log in",
    "start": "2555559",
    "end": "2562800"
  },
  {
    "text": "um oh exception handled while processing the request now it says that no",
    "start": "2562800",
    "end": "2568280"
  },
  {
    "text": "authentication scheme was defined there was no default signing scheme found",
    "start": "2568280",
    "end": "2574040"
  },
  {
    "text": "either so now now we we've added both cookies and open and connect to our",
    "start": "2574040",
    "end": "2579359"
  },
  {
    "text": "application we need to start telling the system which one to use when so we can",
    "start": "2579359",
    "end": "2585480"
  },
  {
    "text": "have op. default scheme uh that's data protection that's",
    "start": "2585480",
    "end": "2593119"
  },
  {
    "text": "wrong wrong opt",
    "start": "2593119",
    "end": "2599760"
  },
  {
    "text": "um opt op. default scheme equals cookie or",
    "start": "2599760",
    "end": "2605359"
  },
  {
    "text": "authentication defaults Authentication ation scheme and why not do set the default Channel seams to open ID connect",
    "start": "2605359",
    "end": "2613280"
  },
  {
    "text": "defaults do authentication scheme so whenever we just call challenge without a specific scheme we",
    "start": "2613280",
    "end": "2620599"
  },
  {
    "text": "will use opened",
    "start": "2620599",
    "end": "2623559"
  },
  {
    "text": "connect we click log in and it",
    "start": "2629559",
    "end": "2635559"
  },
  {
    "text": "works What if I challenge the open a theconnect scheme let's",
    "start": "2635559",
    "end": "2643200"
  },
  {
    "text": "try it sent us off to Identity server to the Upstream",
    "start": "2644839",
    "end": "2650760"
  },
  {
    "text": "provider where I can log in as Alice I can't because I can",
    "start": "2650960",
    "end": "2659640"
  },
  {
    "text": "type now if I want to check the claims that I received I'm not using the the external call back pattern here so if I",
    "start": "2660160",
    "end": "2667119"
  },
  {
    "text": "I want to check the claims would it be the cookies uh cookies or open Ed cookies or open Ed",
    "start": "2667119",
    "end": "2674079"
  },
  {
    "text": "connected I query which one is keeping track of the session cookies I heard that that you're",
    "start": "2674079",
    "end": "2682079"
  },
  {
    "text": "right the cookies so authenticate with the cookies and I get all the claims that I received from my Upstream",
    "start": "2682079",
    "end": "2689839"
  },
  {
    "text": "provider hey the properties are extended quite a lot as well we got an access",
    "start": "2689839",
    "end": "2695839"
  },
  {
    "text": "token that means we got something that we can use to call an",
    "start": "2695839",
    "end": "2700920"
  },
  {
    "text": "API so let's do that let's call I have an API that I created that where the API",
    "start": "2702040",
    "end": "2710400"
  },
  {
    "text": "calls authenticate on the incoming token and then returns",
    "start": "2710400",
    "end": "2715920"
  },
  {
    "text": "it and we can see that well",
    "start": "2715920",
    "end": "2722520"
  },
  {
    "text": "um the access token was validated by the API and this is the claims and not very",
    "start": "2722520",
    "end": "2730760"
  },
  {
    "text": "nice presentation that the um the API found in the received access",
    "start": "2730760",
    "end": "2738480"
  },
  {
    "text": "token what do you think if I if I call an endpoint where the AP the API would",
    "start": "2738520",
    "end": "2745400"
  },
  {
    "text": "uh call challenge what would be the return of",
    "start": "2745400",
    "end": "2750800"
  },
  {
    "text": "that someone mentioned it it's a number 401",
    "start": "2751040",
    "end": "2758319"
  },
  {
    "text": "so if the API CH makes a challenge it's a 401 return if the API makes a forbid is a",
    "start": "2758319",
    "end": "2766359"
  },
  {
    "text": "403 return to our application",
    "start": "2766359",
    "end": "2772440"
  },
  {
    "text": "um so that's it with um what we have with this but I",
    "start": "2772440",
    "end": "2778440"
  },
  {
    "text": "have one more thing no sorry I have one more thing on authentication I need to show show you so now I am logged in as",
    "start": "2778440",
    "end": "2786559"
  },
  {
    "text": "Alice Smith my session on this application is",
    "start": "2786559",
    "end": "2793640"
  },
  {
    "text": "maintained by cookies in this application the cookie scheme is responsible for maintaining the session",
    "start": "2793640",
    "end": "2799520"
  },
  {
    "text": "so let's sign out on my application I'm signed out now if I click",
    "start": "2799520",
    "end": "2809160"
  },
  {
    "text": "challenge to relo in again I'm just automatically single signed on what",
    "start": "2809160",
    "end": "2814400"
  },
  {
    "text": "happened well I signed out of my application but I never signed out of the Upstream provider so once I re try",
    "start": "2814400",
    "end": "2821960"
  },
  {
    "text": "to sign in again I'm single signed on I'm Just Bounce Bounce right",
    "start": "2821960",
    "end": "2827760"
  },
  {
    "text": "back okay let's try signing out to the Upstream provider instead yeah I'm s out",
    "start": "2827880",
    "end": "2833200"
  },
  {
    "text": "let's get back but no I'm still signed in I need to sign out here now if I",
    "start": "2833200",
    "end": "2840400"
  },
  {
    "text": "challenge I'll get to the login page so if we have single sign on with",
    "start": "2840400",
    "end": "2846079"
  },
  {
    "text": "an upstream proom we typically need single log out but we because without single log out if we just do local log",
    "start": "2846079",
    "end": "2853800"
  },
  {
    "text": "out we will be signed in right back again so this logout button the real",
    "start": "2853800",
    "end": "2860000"
  },
  {
    "text": "logout button actually does both okay sign",
    "start": "2860000",
    "end": "2866880"
  },
  {
    "text": "out uh that's authentication we have about 10 minutes left to do some",
    "start": "2866880",
    "end": "2872920"
  },
  {
    "text": "authorization as well um sorry I should run this I have a secure page a top secure page",
    "start": "2872920",
    "end": "2879559"
  },
  {
    "text": "on my system here where I decorated it with an authorization policy called top",
    "start": "2879559",
    "end": "2885720"
  },
  {
    "text": "secret but I never defined the top secret authorization policy we can",
    "start": "2885720",
    "end": "2892280"
  },
  {
    "text": "actually check that one in the it's in the home",
    "start": "2892280",
    "end": "2897920"
  },
  {
    "text": "controller it's not very Advance just authoriz top secret but we need to add the top secret",
    "start": "2899079",
    "end": "2906920"
  },
  {
    "text": "policy Builder builder. services. add",
    "start": "2906920",
    "end": "2912079"
  },
  {
    "text": "authoriz add authorization",
    "start": "2912079",
    "end": "2917960"
  },
  {
    "text": "opt let's zoom in a step more uh opt",
    "start": "2918800",
    "end": "2928280"
  },
  {
    "text": "and opt dople add policy and now we get policy Builder that we can use to",
    "start": "2931280",
    "end": "2939160"
  },
  {
    "text": "call um builder. require sorry we need to name it of",
    "start": "2939160",
    "end": "2945400"
  },
  {
    "text": "course first top secret uh Builder dot require Ro admin",
    "start": "2945400",
    "end": "2953559"
  },
  {
    "text": "why not let's start with that that's a classical",
    "start": "2953559",
    "end": "2958040"
  },
  {
    "text": "thing so now I start it I try to go to the secure page",
    "start": "2961480",
    "end": "2968240"
  },
  {
    "text": "page I get CH uh when I try to go to the secure page I actually end up on ident",
    "start": "2968240",
    "end": "2974880"
  },
  {
    "text": "server because authorization failed the authorization middleware called Challenge and the default challenge",
    "start": "2974880",
    "end": "2981480"
  },
  {
    "text": "scheme is open and de connect so I end it up here I can sign in and Alice is",
    "start": "2981480",
    "end": "2987480"
  },
  {
    "text": "not an admin access to slome secc is denied log out",
    "start": "2987480",
    "end": "2992640"
  },
  {
    "text": "Alis go through the normal login page login as ADD",
    "start": "2992640",
    "end": "2998240"
  },
  {
    "text": "admin uh we can check the claims and see that",
    "start": "2998240",
    "end": "3003839"
  },
  {
    "text": "no is it case sensitive I added a special hack for the name admin I thought I did",
    "start": "3003839",
    "end": "3010960"
  },
  {
    "text": "that oh username must be admin with an appic case log out login admin",
    "start": "3010960",
    "end": "3020520"
  },
  {
    "text": "admin uh authenticate now we have Ro admin and secure should",
    "start": "3020520",
    "end": "3028640"
  },
  {
    "text": "work but well I think just giving admin that uh using admin to let people in",
    "start": "3029440",
    "end": "3036280"
  },
  {
    "text": "that is a bit too simple I want something more complex Builder do",
    "start": "3036280",
    "end": "3044200"
  },
  {
    "text": "require assertion I want to write code here so I'll do",
    "start": "3044200",
    "end": "3050838"
  },
  {
    "text": "context and then CTX do user do I uh",
    "start": "3050920",
    "end": "3057000"
  },
  {
    "text": "find first value let's get the name of the user and check if it starts with a",
    "start": "3057000",
    "end": "3064200"
  },
  {
    "text": "good um letter so this is now between me and Alice Bob is not",
    "start": "3064200",
    "end": "3071240"
  },
  {
    "text": "allowed I can run require run",
    "start": "3071720",
    "end": "3076359"
  },
  {
    "text": "this if I click the secure page uh it says it failed",
    "start": "3077680",
    "end": "3087920"
  },
  {
    "text": "because I should have Builder require authenticated user first I mean I can't",
    "start": "3087920",
    "end": "3093680"
  },
  {
    "text": "go and check the user name unless I'm authenticator so let's just add a dual requirement authenticator user first so",
    "start": "3093680",
    "end": "3100160"
  },
  {
    "text": "that will block the case where take care of the case where nobody is logged in I",
    "start": "3100160",
    "end": "3106680"
  },
  {
    "text": "thought uh it's valuating all of them um",
    "start": "3106680",
    "end": "3113280"
  },
  {
    "text": "[Music] fals let's do that",
    "start": "3113370",
    "end": "3121359"
  },
  {
    "text": "instead I thought it was a brilliant idea to start with a obviously it was",
    "start": "3121359",
    "end": "3129280"
  },
  {
    "text": "not yeah I end up here if I sign in as Bob actually is",
    "start": "3129720",
    "end": "3136920"
  },
  {
    "text": "dened if I try again as Alice",
    "start": "3137480",
    "end": "3143400"
  },
  {
    "text": "works if I sign in in my normal application with",
    "start": "3143400",
    "end": "3150400"
  },
  {
    "text": "Anders I can go there so we have a way to express more complex expressions for",
    "start": "3150400",
    "end": "3157200"
  },
  {
    "text": "the authorization us rules using required setion",
    "start": "3157200",
    "end": "3163440"
  },
  {
    "text": "um so I'll jump back to the summary slide just to summarize it then that we do have time for questions and we do",
    "start": "3163440",
    "end": "3169559"
  },
  {
    "text": "have time for uh also we do have time if you want to challenge me and have something else",
    "start": "3169559",
    "end": "3175920"
  },
  {
    "text": "you want me to we can try we have a few five minutes live coding on request why",
    "start": "3175920",
    "end": "3181720"
  },
  {
    "text": "not uh but we had our web application we added cookies to it to do",
    "start": "3181720",
    "end": "3190319"
  },
  {
    "text": "authentication and session and management we hooked up it up with an",
    "start": "3190319",
    "end": "3195480"
  },
  {
    "text": "upstream open ID connect provider to establish and sign in the user and get access tokens if you want to call apis",
    "start": "3195480",
    "end": "3202839"
  },
  {
    "text": "we added an authorization policy that only people with a name started on a are allowed to access our top secret page",
    "start": "3202839",
    "end": "3210400"
  },
  {
    "text": "and we called an API and saw that the API can accept and",
    "start": "3210400",
    "end": "3216880"
  },
  {
    "text": "validate an access token using the same",
    "start": "3216880",
    "end": "3221400"
  },
  {
    "text": "mechanism so even though we started our application here with the without any",
    "start": "3222200",
    "end": "3228240"
  },
  {
    "text": "security we could add it and save the day so questions or impromptu code",
    "start": "3228240",
    "end": "3235480"
  },
  {
    "text": "challenges yeah take this one set",
    "start": "3235480",
    "end": "3241440"
  },
  {
    "text": "here is it's on I don't want you to make my Cod I was just wondering if instead",
    "start": "3241440",
    "end": "3247040"
  },
  {
    "text": "of just faking the authentication you were authenticating using another API",
    "start": "3247040",
    "end": "3252880"
  },
  {
    "text": "yeah with a refresh token if we want to authenticate the user with another API which has a refresh token say a refresh",
    "start": "3252880",
    "end": "3260040"
  },
  {
    "text": "token yes so when you challenge or whatever when when your access token expires y you only have the cookie you",
    "start": "3260040",
    "end": "3266000"
  },
  {
    "text": "don't have the identity server scheme yeah how do you refresh that talk okay",
    "start": "3266000",
    "end": "3272119"
  },
  {
    "text": "so this is uh let put it like this uh this talk also comes as a two-day",
    "start": "3272119",
    "end": "3280920"
  },
  {
    "text": "workshop where where or uh this is the first this is uh",
    "start": "3280920",
    "end": "3287240"
  },
  {
    "text": "most what we've done today is like uh the morning and part of the afternoon in",
    "start": "3287240",
    "end": "3293079"
  },
  {
    "text": "the first day in that Workshop so I had to leave out quite a few things um but you are right the access",
    "start": "3293079",
    "end": "3301160"
  },
  {
    "text": "token should be shortlived I'm lucky here because the default access token lifetime here is 1 hour and the talk is just one hour so my",
    "start": "3301160",
    "end": "3308520"
  },
  {
    "text": "access token will never expire during the talk and also I'm logging out and logging back in all the time the right",
    "start": "3308520",
    "end": "3314720"
  },
  {
    "text": "way to solve it is that when we uh log in with open add connect we would",
    "start": "3314720",
    "end": "3321200"
  },
  {
    "text": "request a refresh token so that uh whenever our access token expires we we",
    "start": "3321200",
    "end": "3326400"
  },
  {
    "text": "can reach out to Identity server with our refresh token and say please give us a new access token uh and then uh whenever we call an",
    "start": "3326400",
    "end": "3335200"
  },
  {
    "text": "API we need uh to check if the access token we have is within its lifetime",
    "start": "3335200",
    "end": "3341839"
  },
  {
    "text": "currently uh dend software we Supply forn net an open source and Free Library",
    "start": "3341839",
    "end": "3347240"
  },
  {
    "text": "called dend access token management which handles that for you so um let's",
    "start": "3347240",
    "end": "3352920"
  },
  {
    "text": "see the API call here so there's so much care that I never got around to show so this is what I do here I call get token",
    "start": "3352920",
    "end": "3361039"
  },
  {
    "text": "async to get the access token before I call the API",
    "start": "3361039",
    "end": "3367079"
  },
  {
    "text": "uh um I'm not sharing the right screen of course here it is so call get token",
    "start": "3367079",
    "end": "3373039"
  },
  {
    "text": "async to get the access token out of the session uh this will get just get the",
    "start": "3373039",
    "end": "3381160"
  },
  {
    "text": "access token as it is if it expired I will still get the expired access token if you add the dend access token",
    "start": "3381160",
    "end": "3387599"
  },
  {
    "text": "management Library you can called get user access token and that will keep track of Lifetime and refresh for",
    "start": "3387599",
    "end": "3395680"
  },
  {
    "text": "you so yes it's definitely a point that at some point in time your our exit",
    "start": "3395680",
    "end": "3400760"
  },
  {
    "text": "token is expired and I tried to get away with it I didn't thank you thank you",
    "start": "3400760",
    "end": "3406200"
  },
  {
    "text": "thank you anyone",
    "start": "3406200",
    "end": "3410640"
  },
  {
    "text": "else yes can we hand the microphone up there quickly",
    "start": "3411559",
    "end": "3417640"
  },
  {
    "text": "thank",
    "start": "3417640",
    "end": "3419838"
  },
  {
    "text": "you yes um how do you log out of multiple schemes how I do log out of",
    "start": "3423440",
    "end": "3428520"
  },
  {
    "text": "multiple schemes there are two ways to do it either you call sign out async multi multiple times which is the simple",
    "start": "3428520",
    "end": "3436559"
  },
  {
    "text": "way but that's also one of the things sorry I need to switch monitors here to be able to point what I'm doing so let's",
    "start": "3436559",
    "end": "3444280"
  },
  {
    "text": "see that actual Rel logout button that I implemented how it works uh because it",
    "start": "3444280",
    "end": "3450480"
  },
  {
    "text": "is a bit more complex um",
    "start": "3450480",
    "end": "3455839"
  },
  {
    "text": "I actually check if it is the cookie scheme only that I sign out to I just call sign out async because that will",
    "start": "3455839",
    "end": "3462480"
  },
  {
    "text": "just that call will just cause a cookie set cookie header to be set and then I",
    "start": "3462480",
    "end": "3468520"
  },
  {
    "text": "can return a redirect which is executed right away if I want to sign out a multiple",
    "start": "3468520",
    "end": "3474960"
  },
  {
    "text": "schemes uh um sorry that if I want to sign out this is the meod that I want to",
    "start": "3474960",
    "end": "3480400"
  },
  {
    "text": "check so uh in the the log out button that did this automatically I actually",
    "start": "3480400",
    "end": "3486559"
  },
  {
    "text": "first check the off scheme property to see if I had a remote authentication",
    "start": "3486559",
    "end": "3491880"
  },
  {
    "text": "scheme that was used if it was I do",
    "start": "3491880",
    "end": "3497119"
  },
  {
    "text": "return sign out which will uh sign out on of both the cookie",
    "start": "3497119",
    "end": "3504200"
  },
  {
    "text": "scheme and perform the read redirect and I do also send in an authentication",
    "start": "3504200",
    "end": "3509280"
  },
  {
    "text": "properties with the return URL that once we've been up to the other providing and click back where do I want to go so",
    "start": "3509280",
    "end": "3515920"
  },
  {
    "text": "there are a few steps on this this entire sample application is available on on my GitHub",
    "start": "3515920",
    "end": "3521680"
  },
  {
    "text": "account uh in the ready to use version so if you want to dig into the details",
    "start": "3521680",
    "end": "3527799"
  },
  {
    "text": "the sample project is on my GitHub account so pleas feel free and I think that's it we",
    "start": "3527799",
    "end": "3534760"
  },
  {
    "text": "have yeah I think we'll have to wrap it up there so thank you very much for having me here and enjoy the conference",
    "start": "3534760",
    "end": "3542270"
  },
  {
    "text": "[Applause]",
    "start": "3542270",
    "end": "3549650"
  }
]