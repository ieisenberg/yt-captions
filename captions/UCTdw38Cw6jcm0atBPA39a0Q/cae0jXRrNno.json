[
  {
    "start": "0",
    "end": "108000"
  },
  {
    "text": "well thank you guys all for coming um it sounded like it was way more exciting out on the floor uh",
    "start": "1199",
    "end": "7680"
  },
  {
    "text": "so uh this is let's get scary and continuously deploy database changes",
    "start": "7680",
    "end": "13380"
  },
  {
    "text": "um yeah my name is Dan Malott I am the head of platform and infrastructure for uh",
    "start": "13380",
    "end": "19920"
  },
  {
    "text": "economic uh economic is accounting software uh for small and medium-sized",
    "start": "19920",
    "end": "25800"
  },
  {
    "text": "businesses in Denmark uh we have approximately 182 000 customers and the teams that I manage",
    "start": "25800",
    "end": "33120"
  },
  {
    "text": "are responsible for the foundation of the software so we we build the",
    "start": "33120",
    "end": "38640"
  },
  {
    "text": "foundation we take care of the infrastructure that our amazing product devs uh build features on",
    "start": "38640",
    "end": "46820"
  },
  {
    "text": "um we are a company that is a member of the visma group as well um if you're interested in a job visma",
    "start": "47100",
    "end": "53219"
  },
  {
    "text": "is hiring now I've said the bit that they give me time to come to the conference for",
    "start": "53219",
    "end": "60198"
  },
  {
    "text": "um so I still consider myself a software developer um even though I've been mainly developing",
    "start": "60300",
    "end": "66720"
  },
  {
    "text": "PowerPoints recently uh I've also been a DBA on occasion I had a",
    "start": "66720",
    "end": "73080"
  },
  {
    "text": "lot more hair then and uh most of my experiences with Microsoft Technology",
    "start": "73080",
    "end": "80340"
  },
  {
    "text": "done a bit of work with some other database products uh some other programming languages notably",
    "start": "80340",
    "end": "87000"
  },
  {
    "text": "the four letter one um and I referee and play Ice Hockey",
    "start": "87000",
    "end": "92820"
  },
  {
    "text": "um so when my wife and I decided to relocate from the United States coming somewhere",
    "start": "92820",
    "end": "98220"
  },
  {
    "text": "ice hockey has played was really important so we chose Denmark because we wanted bad ice hockey",
    "start": "98220",
    "end": "105979"
  },
  {
    "start": "108000",
    "end": "173000"
  },
  {
    "text": "what are we going to talk about here um so I can't see you very well but how",
    "start": "109920",
    "end": "115439"
  },
  {
    "text": "many people out there are developers primarily in your in your day-to-day job",
    "start": "115439",
    "end": "120600"
  },
  {
    "text": "looks like almost everybody um so the the CI CD thing is is going to be",
    "start": "120600",
    "end": "126240"
  },
  {
    "text": "just uh covering the bases Refresher um we'll talk about why data is a problem",
    "start": "126240",
    "end": "133640"
  },
  {
    "text": "in particular when we when we think about continuous integration continuous deployment data can be a huge problem",
    "start": "133640",
    "end": "142319"
  },
  {
    "text": "um we'll talk about how you modify the data model safely and maybe not so safely",
    "start": "142319",
    "end": "150300"
  },
  {
    "text": "um I'll do a bit of touching on automated testing we'll close out with some demos about how you do this state-based versus",
    "start": "150300",
    "end": "156599"
  },
  {
    "text": "migration based and I've chosen a couple of off-the-shelf tools for that",
    "start": "156599",
    "end": "161959"
  },
  {
    "text": "at my company we've actually built our own tooling to do uh to do a migration-based deployment and I'll talk",
    "start": "161959",
    "end": "169200"
  },
  {
    "text": "about why that was chosen as well yeah so",
    "start": "169200",
    "end": "175800"
  },
  {
    "start": "173000",
    "end": "262000"
  },
  {
    "text": "so you want to automate some stuff right we're developers we're lazy so automation's great",
    "start": "175800",
    "end": "182239"
  },
  {
    "text": "continuous integration we're all familiar with this right you merge your code in or you push your code up make a",
    "start": "182239",
    "end": "187860"
  },
  {
    "text": "pull request and an automated build happens you get immediate feedback about whether or not your changes will compile",
    "start": "187860",
    "end": "196500"
  },
  {
    "text": "not work compile and then continuous deployment is we",
    "start": "196500",
    "end": "201840"
  },
  {
    "text": "take that artifact that we just created with the continuous integration build and we deploy it",
    "start": "201840",
    "end": "207800"
  },
  {
    "text": "um so every change can be pushed automatically assuming all your tests",
    "start": "207840",
    "end": "215400"
  },
  {
    "text": "have passed right how many people have a test environment",
    "start": "215400",
    "end": "220819"
  },
  {
    "text": "how many people have a dedicated production environment that's pretty good",
    "start": "220860",
    "end": "228379"
  },
  {
    "text": "my teams manage 15 acceptance environments to allow our developers to",
    "start": "229799",
    "end": "236159"
  },
  {
    "text": "test a lot of features in parallel so it's cool right so cicd right and we're",
    "start": "236159",
    "end": "243000"
  },
  {
    "text": "really used to doing this with our application code right whether you're writing it in c-sharp in Java in Python",
    "start": "243000",
    "end": "248580"
  },
  {
    "text": "and Ruby God help you um",
    "start": "248580",
    "end": "255379"
  },
  {
    "text": "but databases are a lot harder right and and there's a reason for that",
    "start": "256620",
    "end": "263100"
  },
  {
    "start": "262000",
    "end": "447000"
  },
  {
    "text": "the data is a problem right data is not application code",
    "start": "263100",
    "end": "269960"
  },
  {
    "text": "data is records the state of your application right so when you change the state of",
    "start": "270060",
    "end": "276180"
  },
  {
    "text": "your application you have to be careful that you don't lose something important right",
    "start": "276180",
    "end": "282000"
  },
  {
    "text": "if we think about it from a programming perspective our data is stored as a resource",
    "start": "282000",
    "end": "287460"
  },
  {
    "text": "right yeah anybody work with the old.net resx files",
    "start": "287460",
    "end": "293639"
  },
  {
    "text": "yeah I back when I had hair",
    "start": "293639",
    "end": "298680"
  },
  {
    "text": "um right that that's data right so whether we're starting in a",
    "start": "298680",
    "end": "304020"
  },
  {
    "text": "resx file in Json in a relational database in table storage in the cloud",
    "start": "304020",
    "end": "309840"
  },
  {
    "text": "whatever right data is a resource right and it should be permanent",
    "start": "309840",
    "end": "314880"
  },
  {
    "text": "um although not too permanent because we all have regulatory regimes one in",
    "start": "314880",
    "end": "321300"
  },
  {
    "text": "particular that say we need to be able to delete data if somebody asks us to",
    "start": "321300",
    "end": "326820"
  },
  {
    "text": "it's a good thing all those systems that we built were designed after that regulation came into effect",
    "start": "326820",
    "end": "333139"
  },
  {
    "text": "um and so when we think about changing the data model right so data model is code",
    "start": "333479",
    "end": "339720"
  },
  {
    "text": "right when we build a data model we do it declaratively this is what our data should look like tables or objects or",
    "start": "339720",
    "end": "347580"
  },
  {
    "text": "whatever you have right but if you change the data model you might lose data",
    "start": "347580",
    "end": "353699"
  },
  {
    "text": "um and losing data without meaning to is bad right",
    "start": "353699",
    "end": "359720"
  },
  {
    "text": "um and to compound this our code and our data model are intertwined",
    "start": "360240",
    "end": "367199"
  },
  {
    "text": "right no no one has built the orm that does things magically",
    "start": "367199",
    "end": "374400"
  },
  {
    "text": "although people are trying right so your code has to know what the data model looks like",
    "start": "374400",
    "end": "380940"
  },
  {
    "text": "right in some cases your data model has to know what the code looks like in particular if you think about indexing right",
    "start": "380940",
    "end": "387539"
  },
  {
    "text": "an index is an opinion about the code",
    "start": "387539",
    "end": "392240"
  },
  {
    "text": "yeah so losing data is bad which means that we need to have a strategy when we",
    "start": "393120",
    "end": "399240"
  },
  {
    "text": "go to change the data model so that we don't lose data or know that we're losing data",
    "start": "399240",
    "end": "406340"
  },
  {
    "text": "and we all have backups right right",
    "start": "406979",
    "end": "413360"
  },
  {
    "text": "I've got some laughter up there that's not good um",
    "start": "413360",
    "end": "420000"
  },
  {
    "text": "and everybody's tested them yeah",
    "start": "420000",
    "end": "425400"
  },
  {
    "text": "you know this is a place where the cloud has really changed things as an aside like you know if you're running Azure SQL database",
    "start": "425400",
    "end": "431819"
  },
  {
    "text": "which is what I which is what I have for the demos it's great I've I've got a backup there I didn't have to do",
    "start": "431819",
    "end": "437340"
  },
  {
    "text": "anything now I always keep seven days of backups because I'm cheap but it's there and if",
    "start": "437340",
    "end": "443340"
  },
  {
    "text": "I had an Enterprise budget I could keep a little bit more yeah so how many people out there have a",
    "start": "443340",
    "end": "451500"
  },
  {
    "start": "447000",
    "end": "474000"
  },
  {
    "text": "data store that is the authoritative source for that data this is the day this is the store",
    "start": "451500",
    "end": "459120"
  },
  {
    "text": "for the data in the organization and it's the one that is authoritative all",
    "start": "459120",
    "end": "464220"
  },
  {
    "text": "the other any place else that's copied is just a copy like this is the original yeah I got a couple",
    "start": "464220",
    "end": "471259"
  },
  {
    "start": "474000",
    "end": "521000"
  },
  {
    "text": "how many of you don't know I got a couple okay thank you for your",
    "start": "475139",
    "end": "481979"
  },
  {
    "text": "honesty um yeah so this is interesting right most of my work has been on",
    "start": "481979",
    "end": "487500"
  },
  {
    "text": "transactional databases and transactional databases that are the",
    "start": "487500",
    "end": "493440"
  },
  {
    "text": "source of Truth for the data so that when it gets copied into a reporting environment or into a CSV format those",
    "start": "493440",
    "end": "500520"
  },
  {
    "text": "things are just snapshots of a point in time based on what's in the transactional database not everybody has",
    "start": "500520",
    "end": "507660"
  },
  {
    "text": "that right some sometimes we're we're dealing with an external data source sometimes we're",
    "start": "507660",
    "end": "514020"
  },
  {
    "text": "you know grabbing a copy from somewhere else in our organization and just working with",
    "start": "514020",
    "end": "519360"
  },
  {
    "text": "it that's okay so but if you do right if this is the",
    "start": "519360",
    "end": "525959"
  },
  {
    "text": "authoritative data um then you might want to think about taking some more care when we change the",
    "start": "525959",
    "end": "532260"
  },
  {
    "text": "data model which I'll start talking about here in a second how we do that um mainly because",
    "start": "532260",
    "end": "538860"
  },
  {
    "text": "if so one of the databases that one of my teams manages is our user store",
    "start": "538860",
    "end": "546000"
  },
  {
    "text": "right and it's this is you know the users uh what SKU they've bought",
    "start": "546000",
    "end": "552480"
  },
  {
    "text": "what their permissions are their email address things of that nature right",
    "start": "552480",
    "end": "559339"
  },
  {
    "text": "and we feed this data other places so RBI folks use this data",
    "start": "559560",
    "end": "566580"
  },
  {
    "text": "to generate use of statistics and our sales people use this data from bi to to",
    "start": "566580",
    "end": "572519"
  },
  {
    "text": "do upselling right like hey you're using this feature a bunch maybe you should use this one or buy this one",
    "start": "572519",
    "end": "580800"
  },
  {
    "text": "right so when we make changes to our data model we need to tell people",
    "start": "580800",
    "end": "588080"
  },
  {
    "text": "and that means you have to talk to people across your organization um",
    "start": "588899",
    "end": "594120"
  },
  {
    "text": "and uh talking talking to people is scary",
    "start": "594120",
    "end": "599220"
  },
  {
    "text": "uh-huh and they're all I'd also need to be more gates right so",
    "start": "599220",
    "end": "606540"
  },
  {
    "text": "everyone has an automated test Suite that perfectly covers all of the use cases of their application",
    "start": "606540",
    "end": "613339"
  },
  {
    "text": "fair right yeah no none of us do their gaps right",
    "start": "613680",
    "end": "618720"
  },
  {
    "text": "but it means that when you're making a change that changes your data structure or potentially changes the data",
    "start": "618720",
    "end": "625380"
  },
  {
    "text": "you really need to make sure that you're either covered with the automated tests you do have because we've all got some",
    "start": "625380",
    "end": "631260"
  },
  {
    "text": "or you have a test plan um",
    "start": "631260",
    "end": "636959"
  },
  {
    "text": "because fun story so uh and I'll come back to this a couple of times",
    "start": "636959",
    "end": "643140"
  },
  {
    "text": "one of the projects that we're doing right now is we have some tables that are actually running out of integers",
    "start": "643140",
    "end": "648959"
  },
  {
    "text": "on their identity columns um so the the Danish government and their Infinite Wisdom",
    "start": "648959",
    "end": "655320"
  },
  {
    "text": "passed a law last year that says every every business that has a CVR right a",
    "start": "655320",
    "end": "663360"
  },
  {
    "text": "vat number has to use an electronic accounting",
    "start": "663360",
    "end": "668399"
  },
  {
    "text": "software and part of the electronic accounting software that we have that we offer is",
    "start": "668399",
    "end": "676200"
  },
  {
    "text": "we manage a lot of files right invoices you know proceeds",
    "start": "676200",
    "end": "682440"
  },
  {
    "text": "other other files right well it turns out that",
    "start": "682440",
    "end": "689220"
  },
  {
    "text": "2 billion was plenty when the system was designed in 1997.",
    "start": "689220",
    "end": "695339"
  },
  {
    "text": "but it's not in 2023 so we're actually running out of integers",
    "start": "695339",
    "end": "701700"
  },
  {
    "text": "um and it has taken us a while to make this",
    "start": "701700",
    "end": "708120"
  },
  {
    "text": "change because changing from in to Big end right not a",
    "start": "708120",
    "end": "713279"
  },
  {
    "text": "big deal but it's taking us a while to make this change because testing this is really complex and our documentation is",
    "start": "713279",
    "end": "721260"
  },
  {
    "text": "not the best um not a not a negative just uh yeah",
    "start": "721260",
    "end": "728820"
  },
  {
    "text": "it's 25 year old software",
    "start": "728820",
    "end": "732920"
  },
  {
    "text": "right so how do we change the data model safely",
    "start": "738000",
    "end": "743899"
  },
  {
    "start": "739000",
    "end": "857000"
  },
  {
    "text": "and how do we maybe not change it safely too okay",
    "start": "744660",
    "end": "749940"
  },
  {
    "text": "so generally if you're adding things to your database to your data model this is fine",
    "start": "749940",
    "end": "756720"
  },
  {
    "text": "right um now there are some cases where like if you're adding a table or an index or",
    "start": "756720",
    "end": "765000"
  },
  {
    "text": "um something like that like make sure there's enough space",
    "start": "765000",
    "end": "771480"
  },
  {
    "text": "um so the example I was just talking about were actually instead of just upsizing the column on the table because that",
    "start": "771480",
    "end": "777959"
  },
  {
    "text": "would take well we tried it and it took 18 hours and then we killed it",
    "start": "777959",
    "end": "784019"
  },
  {
    "text": "um so we're actually copying the data into another table well that's that space",
    "start": "784019",
    "end": "790680"
  },
  {
    "text": "and uh our DBA was like um so we're running out of space on the drive",
    "start": "790680",
    "end": "796980"
  },
  {
    "text": "oh yeah right so check with the DBA team if there's storage",
    "start": "796980",
    "end": "802560"
  },
  {
    "text": "um add the table to whatever MDM you have right that's that's sort of a good",
    "start": "802560",
    "end": "808740"
  },
  {
    "text": "you know good rule of thumb anyway right same with a view add to MDM check",
    "start": "808740",
    "end": "814980"
  },
  {
    "text": "your indexing if you're adding a view check indexing because make sure there's an index that supports",
    "start": "814980",
    "end": "821220"
  },
  {
    "text": "the query the view is executing um other things yeah it's generally fine right",
    "start": "821220",
    "end": "827040"
  },
  {
    "text": "um now if you're adding a trigger tell the dbas and buy them beer or drink of their",
    "start": "827040",
    "end": "833579"
  },
  {
    "text": "choice maybe don't buy it in Norway uh",
    "start": "833579",
    "end": "838620"
  },
  {
    "text": "come down to Denmark and buy your beer come back um",
    "start": "838620",
    "end": "843899"
  },
  {
    "text": "and then you know if you're if you're adding a column right no one ever ever does select star in production code",
    "start": "843899",
    "end": "851160"
  },
  {
    "text": "so that's definitely safe right but yeah this is fine for the most part",
    "start": "851160",
    "end": "858680"
  },
  {
    "start": "857000",
    "end": "994000"
  },
  {
    "text": "um but you do have a backup right because we're going to talk about removing things next",
    "start": "859920",
    "end": "867139"
  },
  {
    "text": "um yeah so if we drop things after a backup what",
    "start": "867959",
    "end": "875100"
  },
  {
    "text": "do we have to do um yeah",
    "start": "875100",
    "end": "880560"
  },
  {
    "text": "generally again this is pretty much fine as long as we've made sure to preserve the data",
    "start": "880560",
    "end": "885899"
  },
  {
    "text": "um now I'm I'm very clearly American right um so we have a few more regulatory regimes",
    "start": "885899",
    "end": "891839"
  },
  {
    "text": "than just the gdpr um but they're all pretty consistent on this one like don't lose data unless you",
    "start": "891839",
    "end": "900480"
  },
  {
    "text": "absolutely mean to right so if you're dropping a table right",
    "start": "900480",
    "end": "906320"
  },
  {
    "text": "update MDM make sure you've got a copy of the data somewhere somewhere",
    "start": "906320",
    "end": "913860"
  },
  {
    "text": "if you're updating you know if you're dropping a view right again we want to update MDM maybe we want to drop some indexes too",
    "start": "913860",
    "end": "921180"
  },
  {
    "text": "story procedures constraints fine one thing on constraints is",
    "start": "921180",
    "end": "926519"
  },
  {
    "text": "business logic is important and we generally enforce it via constraints because it isn't being enforced at the",
    "start": "926519",
    "end": "933779"
  },
  {
    "text": "application Level or because we don't trust the developers who are working on that to enforce it at the application Level",
    "start": "933779",
    "end": "941760"
  },
  {
    "text": "um and I don't want to get into a conversation about check at every level because that",
    "start": "941760",
    "end": "948779"
  },
  {
    "text": "that's just off topic um but yeah",
    "start": "948779",
    "end": "954120"
  },
  {
    "text": "if you're dropping a constraint make sure it's not needed like are you sure are you sure we want",
    "start": "954120",
    "end": "959579"
  },
  {
    "text": "this column to be nullable and maybe explain to the product owner why that might be a bad thing",
    "start": "959579",
    "end": "967699"
  },
  {
    "text": "um again you know if you drive if you're dropping a trigger now you're gonna get that beer",
    "start": "967920",
    "end": "973920"
  },
  {
    "text": "money back in the form of beer and uh yeah column just make sure you've",
    "start": "973920",
    "end": "980100"
  },
  {
    "text": "got the data again these these are not not really really awkward operations",
    "start": "980100",
    "end": "986880"
  },
  {
    "text": "what are the off guard operations where when we talk about uh altering the data model",
    "start": "986880",
    "end": "994760"
  },
  {
    "start": "994000",
    "end": "1037000"
  },
  {
    "text": "so I'm not going to work in the the joke about naming things and off by one errors and all that but",
    "start": "998399",
    "end": "1004220"
  },
  {
    "text": "naming things is hard and renaming things is even harder right",
    "start": "1004220",
    "end": "1009680"
  },
  {
    "text": "um it's it's the same as like if you go into your code okay like maybe we have writer or IntelliJ if you're in that",
    "start": "1009680",
    "end": "1016759"
  },
  {
    "text": "world or whatever and we have got really great refactoring tools right",
    "start": "1016759",
    "end": "1021980"
  },
  {
    "text": "but how many people have gone into code and gone I need to rename this thing but it's like in some strings in some places",
    "start": "1021980",
    "end": "1028160"
  },
  {
    "text": "and so I'm just gonna do like a find all and replace and then all of a sudden the code doesn't compile",
    "start": "1028160",
    "end": "1034400"
  },
  {
    "text": "I got crap what did I do yeah so",
    "start": "1034400",
    "end": "1041199"
  },
  {
    "start": "1037000",
    "end": "1139000"
  },
  {
    "text": "let's talk about renaming a column right now when you rename a column",
    "start": "1041299",
    "end": "1047780"
  },
  {
    "text": "you're going to break every query that depends on that column name",
    "start": "1047780",
    "end": "1054280"
  },
  {
    "text": "it will no longer run it will give you an error and it will if you're working with SQL Server B",
    "start": "1054440",
    "end": "1061160"
  },
  {
    "text": "reasonably comprehensible for SQL Server right",
    "start": "1061160",
    "end": "1066740"
  },
  {
    "text": "but you know this is pretty easy right we can for if we're doing this sort of",
    "start": "1066740",
    "end": "1072919"
  },
  {
    "text": "generically we can add a column set it set some names or set some data right",
    "start": "1072919",
    "end": "1079700"
  },
  {
    "text": "copy the data into a drop of the column um forward SQL Server world we have a nice",
    "start": "1079700",
    "end": "1085160"
  },
  {
    "text": "convenient stored procedure for this um but like I said this is a huge breaking change so",
    "start": "1085160",
    "end": "1093279"
  },
  {
    "text": "you might want to add an alias to the table and Alias to that column on the table a computed column right",
    "start": "1093620",
    "end": "1099620"
  },
  {
    "text": "and you might want to run it this way for a while just until you make sure that you've",
    "start": "1099620",
    "end": "1105440"
  },
  {
    "text": "gotten all the consuming code this is a place where observability can really help right",
    "start": "1105440",
    "end": "1111580"
  },
  {
    "text": "so we've made a we've been making a bunch of changes where we we change the way things are",
    "start": "1111580",
    "end": "1117440"
  },
  {
    "text": "called and we set a monitor in datadog to say hey this is still being called",
    "start": "1117440",
    "end": "1123380"
  },
  {
    "text": "this way and you can do it the same way with your with your computed column name right",
    "start": "1123380",
    "end": "1128780"
  },
  {
    "text": "set a monitor like hey this thing's still being some some query somewhere is still using this old column name so you",
    "start": "1128780",
    "end": "1135020"
  },
  {
    "text": "can track it down renaming a table",
    "start": "1135020",
    "end": "1141200"
  },
  {
    "start": "1139000",
    "end": "1296000"
  },
  {
    "text": "um syntax is really easy but again you're going to break everything",
    "start": "1141200",
    "end": "1146840"
  },
  {
    "text": "that depends on that table including the downstream things to consume it right bi",
    "start": "1146840",
    "end": "1155299"
  },
  {
    "text": "other maybe you know that that Excel app that nobody knows is running",
    "start": "1155299",
    "end": "1160940"
  },
  {
    "text": "uh maybe the Excel app everybody does know is running you're breaking it on purpose that's okay",
    "start": "1160940",
    "end": "1168460"
  },
  {
    "text": "um and but the thing is just like with the column it's going to change it's going",
    "start": "1168740",
    "end": "1174080"
  },
  {
    "text": "to break things into internally to the database as well right if you have a stored procedure who",
    "start": "1174080",
    "end": "1179660"
  },
  {
    "text": "actually likes writing stored procedures yeah okay",
    "start": "1179660",
    "end": "1186279"
  },
  {
    "text": "that that's expected who has to write stored procedures because their DBA told team told them",
    "start": "1186380",
    "end": "1192260"
  },
  {
    "text": "they had to we're getting places in the world",
    "start": "1192260",
    "end": "1198980"
  },
  {
    "text": "um yeah it doesn't have to be all stored products anyway",
    "start": "1198980",
    "end": "1204500"
  },
  {
    "text": "right but if you change the name of the table you're going to break something and unlike with the column where like",
    "start": "1204500",
    "end": "1211039"
  },
  {
    "text": "the engine might tell you if there's a stored product that uses",
    "start": "1211039",
    "end": "1216919"
  },
  {
    "text": "the table that you just renamed it's not going to tell you until you execute it and it goes",
    "start": "1216919",
    "end": "1223120"
  },
  {
    "text": "it's a version of the this talk where I had uh the Tony Stark with the explosion in the background",
    "start": "1224120",
    "end": "1229700"
  },
  {
    "text": "but I thought it was a little too much right so we can either engage in some scream Ops",
    "start": "1229700",
    "end": "1236059"
  },
  {
    "text": "in this case um we can",
    "start": "1236059",
    "end": "1241280"
  },
  {
    "text": "use our observability tools right which is a different form of screen Ops",
    "start": "1241280",
    "end": "1246679"
  },
  {
    "text": "as all of the monitors turn red or you can whoops",
    "start": "1246679",
    "end": "1254059"
  },
  {
    "text": "you can define a view right so just like our computed column the",
    "start": "1254059",
    "end": "1259460"
  },
  {
    "text": "view is just going to say hey give me all the columns out of my rename table and I'm creating it with the name of my old table",
    "start": "1259460",
    "end": "1266140"
  },
  {
    "text": "and then we can we can kind of give ourselves some backwards compatibility and some some Grace as we",
    "start": "1266720",
    "end": "1272960"
  },
  {
    "text": "move backwards in time um because otherwise we will inevitably",
    "start": "1272960",
    "end": "1278900"
  },
  {
    "text": "break something for somebody",
    "start": "1278900",
    "end": "1282640"
  },
  {
    "start": "1296000",
    "end": "1359000"
  },
  {
    "text": "okay but really kind of my point here is we need to protect against broken",
    "start": "1296480",
    "end": "1301520"
  },
  {
    "text": "business logic um now there are a lot of different ways to",
    "start": "1301520",
    "end": "1307280"
  },
  {
    "text": "do this on on the code side of things um I've seen good ones uh I've seen bad",
    "start": "1307280",
    "end": "1313460"
  },
  {
    "text": "ones um I've seen ones that work but you know you kind of go like well that's a 40",
    "start": "1313460",
    "end": "1318919"
  },
  {
    "text": "minute build time with all those tests is that really worth it um right on the code side we can we can",
    "start": "1318919",
    "end": "1325100"
  },
  {
    "text": "protect ourselves against it with with a combination of unit and integration testing whatever that looks like in your environment",
    "start": "1325100",
    "end": "1332360"
  },
  {
    "text": "but on the database side right how do we do that we don't we don't",
    "start": "1332360",
    "end": "1338059"
  },
  {
    "text": "really think about testing on the database side um who has business logic in their",
    "start": "1338059",
    "end": "1343460"
  },
  {
    "text": "database does anybody have a foreign key in their",
    "start": "1343460",
    "end": "1349400"
  },
  {
    "text": "database you have business logic",
    "start": "1349400",
    "end": "1354679"
  },
  {
    "text": "you might not think about it as such but it is business logic right",
    "start": "1354679",
    "end": "1360080"
  },
  {
    "start": "1359000",
    "end": "1487000"
  },
  {
    "text": "yeah so and I should have put this slide up before I asked for the hand so I could",
    "start": "1360080",
    "end": "1365360"
  },
  {
    "text": "actually see you guys um yeah unit testing is your friend right",
    "start": "1365360",
    "end": "1370760"
  },
  {
    "text": "unit testing is your friend on the application side right we we've all we've all known that for",
    "start": "1370760",
    "end": "1376940"
  },
  {
    "text": "like 15 years now right how long ago was it that the art of unit testing came out that Manning book with the samurai on",
    "start": "1376940",
    "end": "1383840"
  },
  {
    "text": "the front like it's been a while right this is part of our development process it's",
    "start": "1383840",
    "end": "1389360"
  },
  {
    "text": "ingrained to us now um but we also should be thinking about",
    "start": "1389360",
    "end": "1395299"
  },
  {
    "text": "applying that to business logic in the database now again",
    "start": "1395299",
    "end": "1402340"
  },
  {
    "text": "how many of you have a have a have a unit test Suite that does a variant of testing the framework",
    "start": "1402620",
    "end": "1410559"
  },
  {
    "text": "yeah come on everybody knows that developer that's like oh I'm going to get 100 unit test",
    "start": "1410659",
    "end": "1417260"
  },
  {
    "text": "coverage and like they're writing unit tests on properties come on no no",
    "start": "1417260",
    "end": "1422659"
  },
  {
    "text": "right so when we think about unit testing our database of business engineer database",
    "start": "1422659",
    "end": "1428600"
  },
  {
    "text": "like do we need a unit test foreign keys probably not like",
    "start": "1428600",
    "end": "1434539"
  },
  {
    "text": "if our database provider messed up the implementation of a foreign key",
    "start": "1434539",
    "end": "1439700"
  },
  {
    "text": "we should be shopping for a new database provider not like testing that it works",
    "start": "1439700",
    "end": "1444919"
  },
  {
    "text": "but like if we have a stored procedure or a function or you know maybe some sort of like",
    "start": "1444919",
    "end": "1451100"
  },
  {
    "text": "weird weirdly complicated view like those things are candidates to be tested right and they probably should be",
    "start": "1451100",
    "end": "1459260"
  },
  {
    "text": "um now there are a couple of ways that you can you can test in the database",
    "start": "1459260",
    "end": "1467200"
  },
  {
    "text": "you can write your own harness which is what a lot of people do because this is a kind of awkward thing to do in the SQL",
    "start": "1468620",
    "end": "1475760"
  },
  {
    "text": "Server World you've got T SQL t and then there are a bunch of others in",
    "start": "1475760",
    "end": "1481400"
  },
  {
    "text": "in other parts of the world and apparently my slide with them all has gone missing because it should have been next",
    "start": "1481400",
    "end": "1487940"
  },
  {
    "start": "1487000",
    "end": "1598000"
  },
  {
    "text": "um but essentially like the example here is so I've got a stored",
    "start": "1487940",
    "end": "1493159"
  },
  {
    "text": "procedure here on the left um and this is the",
    "start": "1493159",
    "end": "1499880"
  },
  {
    "text": "in the pretend world of running against the stack Overflow database so we've got uh",
    "start": "1499880",
    "end": "1505460"
  },
  {
    "text": "does this work it does so we're just incrementing someone's",
    "start": "1505460",
    "end": "1510679"
  },
  {
    "text": "reputation right let's let's say they've either gotten an upvote or gotten a down vote",
    "start": "1510679",
    "end": "1515960"
  },
  {
    "text": "um and we have some decision points in here right so like you know if the user didn't get passed in we want to throw an",
    "start": "1515960",
    "end": "1522919"
  },
  {
    "text": "error if the reputation adjustment amount didn't get passed in we want to throw an error",
    "start": "1522919",
    "end": "1528679"
  },
  {
    "text": "um you know if we gave an invalid user ID right so this is some sort of basic sanity checking logic",
    "start": "1528679",
    "end": "1535760"
  },
  {
    "text": "um we should be testing this right",
    "start": "1535760",
    "end": "1541820"
  },
  {
    "text": "um because not only are we testing that our logic works but also regarding against changes",
    "start": "1541820",
    "end": "1548360"
  },
  {
    "text": "so all of a sudden if our users tables name change gets",
    "start": "1548360",
    "end": "1554120"
  },
  {
    "text": "changed our unit test Suite will tell us because it'll fail right so we want to we want to do",
    "start": "1554120",
    "end": "1561799"
  },
  {
    "text": "something like that and in the t-sql T World which is is what I've come to prefer although it's not what we",
    "start": "1561799",
    "end": "1568400"
  },
  {
    "text": "use why work um it's really easy to write these sort of",
    "start": "1568400",
    "end": "1574340"
  },
  {
    "text": "uh write these sort of unit tests um because it's just like hey",
    "start": "1574340",
    "end": "1582080"
  },
  {
    "text": "it looks looks really similar to what you would write in C sharp like I'm expecting this exception with this message and this error number",
    "start": "1582080",
    "end": "1588140"
  },
  {
    "text": "and then I run the stored proc and this can be integrated into your CI",
    "start": "1588140",
    "end": "1594020"
  },
  {
    "text": "CD pipeline as well",
    "start": "1594020",
    "end": "1597100"
  },
  {
    "start": "1598000",
    "end": "1644000"
  },
  {
    "text": "time check",
    "start": "1602059",
    "end": "1604840"
  },
  {
    "text": "now when we think about deployments of our",
    "start": "1608000",
    "end": "1614360"
  },
  {
    "text": "application code um most of the time we're doing something where it's",
    "start": "1614360",
    "end": "1620900"
  },
  {
    "text": "either a blue-green deployment or we have a previous version of the code",
    "start": "1620900",
    "end": "1626059"
  },
  {
    "text": "that we can roll back to um this is this is not so easy in database",
    "start": "1626059",
    "end": "1632779"
  },
  {
    "text": "world right so in the database world",
    "start": "1632779",
    "end": "1638600"
  },
  {
    "text": "we should always be trying to roll forward um",
    "start": "1638600",
    "end": "1644380"
  },
  {
    "start": "1644000",
    "end": "1818000"
  },
  {
    "text": "and uh there's a there's a reason for that so before I get there",
    "start": "1644380",
    "end": "1650600"
  },
  {
    "text": "um right so when we talk about managing managing database",
    "start": "1650600",
    "end": "1656720"
  },
  {
    "text": "source code right and that's what I mean by that is the data definition language so what are what our tables look like",
    "start": "1656720",
    "end": "1663320"
  },
  {
    "text": "our views our stored procedures those types of things um there are two versions state-based",
    "start": "1663320",
    "end": "1669679"
  },
  {
    "text": "tools which represents a bunch of SQL files that represent this is what the database should look like when I deploy",
    "start": "1669679",
    "end": "1676100"
  },
  {
    "text": "it generates a script that you know looks at whatever is there in the database",
    "start": "1676100",
    "end": "1681320"
  },
  {
    "text": "whatever is in the model generates a script to fix the differences",
    "start": "1681320",
    "end": "1687039"
  },
  {
    "text": "um two most notable examples SQL Server database tools and Redgate SQL Source",
    "start": "1687080",
    "end": "1693679"
  },
  {
    "text": "control um and then the other side there are migration based tools who here uses",
    "start": "1693679",
    "end": "1700159"
  },
  {
    "text": "Entity Framework with code first yeah oh God I love that love seeing that too",
    "start": "1700159",
    "end": "1707679"
  },
  {
    "text": "but yeah code first is is a version of migration based Source migration based",
    "start": "1707679",
    "end": "1713659"
  },
  {
    "text": "Source console for your data model right so you manage the",
    "start": "1713659",
    "end": "1719240"
  },
  {
    "text": "creation of migration skip scripts that move the database from one version to the next",
    "start": "1719240",
    "end": "1724820"
  },
  {
    "text": "and sometimes you can roll back as well depends on the tool and usually you maintain a baseline",
    "start": "1724820",
    "end": "1731299"
  },
  {
    "text": "version so for example I mentioned earlier that we wrote Our Own migration based",
    "start": "1731299",
    "end": "1738200"
  },
  {
    "text": "tool and the reason we did that is because nothing existed when it was written that",
    "start": "1738200",
    "end": "1744679"
  },
  {
    "text": "did what we needed it to do which is essentially",
    "start": "1744679",
    "end": "1750140"
  },
  {
    "text": "allow us to deploy database changes in any order so that we weren't tied to",
    "start": "1750140",
    "end": "1757820"
  },
  {
    "text": "a specific order of pull requests being deployed",
    "start": "1757820",
    "end": "1763179"
  },
  {
    "text": "we deploy between six and eight times a day so having that sort of flexibility is really important",
    "start": "1763179",
    "end": "1770080"
  },
  {
    "text": "um some other some commercial versions Flyway liquibase Ruby on Rails migrations probably the",
    "start": "1770840",
    "end": "1777679"
  },
  {
    "text": "the most famous and well-known one other orm migration tools right Entity framework code first that type of thing",
    "start": "1777679",
    "end": "1785360"
  },
  {
    "text": "right so this is how you're going to store your database shape now you'll notice something about",
    "start": "1785360",
    "end": "1791000"
  },
  {
    "text": "the state-based tools is that they always generate a script to do the change and the migration based tool",
    "start": "1791000",
    "end": "1797840"
  },
  {
    "text": "you're always changing moving the database from one version to",
    "start": "1797840",
    "end": "1803120"
  },
  {
    "text": "the next um although if you pay Redgate for Flyway",
    "start": "1803120",
    "end": "1808159"
  },
  {
    "text": "Enterprise you can actually roll back I've had talks with some people from redgrate and they say yeah you really",
    "start": "1808159",
    "end": "1814100"
  },
  {
    "text": "shouldn't do that we support it but don't do it",
    "start": "1814100",
    "end": "1819380"
  },
  {
    "start": "1818000",
    "end": "1969000"
  },
  {
    "text": "right but so why are we always rolling forward um and really the answer becomes if we",
    "start": "1819380",
    "end": "1826220"
  },
  {
    "text": "always are making changes based on what's there and not trying to go backwards",
    "start": "1826220",
    "end": "1831980"
  },
  {
    "text": "um the state of our database and ensuring that state becomes much easier",
    "start": "1831980",
    "end": "1837500"
  },
  {
    "text": "right there's not a like have we deployed this change or not situation",
    "start": "1837500",
    "end": "1844159"
  },
  {
    "text": "um the other thing that we'll avoid is",
    "start": "1844159",
    "end": "1849620"
  },
  {
    "text": "if you are making a change that's destructive to data and you have to roll it back",
    "start": "1849620",
    "end": "1856240"
  },
  {
    "text": "so say you've or take a different example say you've",
    "start": "1857179",
    "end": "1862340"
  },
  {
    "text": "you've changed the column width like so I had a",
    "start": "1862340",
    "end": "1867500"
  },
  {
    "text": "had an email column that was a hundred characters that's just clearly wrong so we're going",
    "start": "1867500",
    "end": "1873200"
  },
  {
    "text": "to increase it to to 253. well so I can go forwards with that",
    "start": "1873200",
    "end": "1879500"
  },
  {
    "text": "going backwards that most database engines aren't going to aren't going to let you do that",
    "start": "1879500",
    "end": "1886460"
  },
  {
    "text": "right but if you roll forward then you can write the code in such a way that like",
    "start": "1886460",
    "end": "1893000"
  },
  {
    "text": "okay well we need to undo this so I can write a state change that undoes it",
    "start": "1893000",
    "end": "1900460"
  },
  {
    "text": "um unfortunately this isn't a Magic Bullet um you might have to do a restore sometime",
    "start": "1900559",
    "end": "1906020"
  },
  {
    "text": "right the the goal of rolling forward is to avoid having to do a database restore",
    "start": "1906020",
    "end": "1911240"
  },
  {
    "text": "um our main database is seven terabytes now thanks to the magic of Google and",
    "start": "1911240",
    "end": "1917600"
  },
  {
    "text": "the cloud that restores in like 10 minutes",
    "start": "1917600",
    "end": "1922700"
  },
  {
    "text": "but that's still 10 minutes that our application's offline",
    "start": "1922700",
    "end": "1926860"
  },
  {
    "text": "um yeah but the other piece is with rolling",
    "start": "1928460",
    "end": "1934640"
  },
  {
    "text": "forward is we want to make sure that our changes are backwards compatible um this is something that",
    "start": "1934640",
    "end": "1941600"
  },
  {
    "text": "that we do fairly easily with API design right like versioning apis and making",
    "start": "1941600",
    "end": "1947000"
  },
  {
    "text": "sure that we're not going to break something but we want to do it with our database changes as well",
    "start": "1947000",
    "end": "1952299"
  },
  {
    "text": "now I get to look at our Cloud Bill Storage is not cheap",
    "start": "1952299",
    "end": "1957799"
  },
  {
    "text": "storage is not cheap uh but it's cheaper than having the than",
    "start": "1957799",
    "end": "1964279"
  },
  {
    "text": "having the uh software be offline so",
    "start": "1964279",
    "end": "1970940"
  },
  {
    "start": "1969000",
    "end": "2028000"
  },
  {
    "text": "and this of course brings up a different issue",
    "start": "1970940",
    "end": "1977080"
  },
  {
    "text": "so this is particularly important when we're thinking about state-based changes",
    "start": "1979820",
    "end": "1985520"
  },
  {
    "text": "but it's good to keep in mind for migration as well um item potency is really important",
    "start": "1985520",
    "end": "1993320"
  },
  {
    "text": "right so we want to be able to run the same operation multiple times and not get",
    "start": "1993320",
    "end": "1999620"
  },
  {
    "text": "into an error state so that means when you're doing database",
    "start": "1999620",
    "end": "2005019"
  },
  {
    "text": "deployments you check to see if the change has already been made before you actually executing the change I have",
    "start": "2005019",
    "end": "2010299"
  },
  {
    "text": "some examples of of that and yes it gets complicated but",
    "start": "2010299",
    "end": "2016779"
  },
  {
    "text": "this is why we get paid well who wants to see some demos",
    "start": "2016779",
    "end": "2023320"
  },
  {
    "text": "yeah all right",
    "start": "2023320",
    "end": "2029019"
  },
  {
    "start": "2028000",
    "end": "2412000"
  },
  {
    "text": "so is that big enough",
    "start": "2029019",
    "end": "2035260"
  },
  {
    "text": "maybe one more all right so as I mentioned I chose a couple of",
    "start": "2035260",
    "end": "2041740"
  },
  {
    "text": "off-the-shelf one migration based one state based and we'll take a look at the state-based one first because it's um",
    "start": "2041740",
    "end": "2049419"
  },
  {
    "text": "maybe more interesting so SQL Server data tools is was for a long",
    "start": "2049419",
    "end": "2055358"
  },
  {
    "text": "time Microsoft's like this is how you should do database Source control um and nobody used it",
    "start": "2055359",
    "end": "2062440"
  },
  {
    "text": "for various reasons but essentially what we have is and I've",
    "start": "2062440",
    "end": "2067839"
  },
  {
    "text": "organized this by schema so I've got my dbo tables I've got my data load which",
    "start": "2067839",
    "end": "2074260"
  },
  {
    "text": "is stored procedures and I use a defined type it's a fun story for another time about",
    "start": "2074260",
    "end": "2082000"
  },
  {
    "text": "why that came came into being um and this is as as you might maybe",
    "start": "2082000",
    "end": "2088118"
  },
  {
    "text": "guess a database to store data on Lego so rebreakable produces a data set with",
    "start": "2088119",
    "end": "2096580"
  },
  {
    "text": "all of the Lego sets Parts Minifigures Etc from the last",
    "start": "2096580",
    "end": "2101680"
  },
  {
    "text": "however long it's been around right and so",
    "start": "2101680",
    "end": "2108000"
  },
  {
    "text": "these SQL files and we can take a look at one describe the shape of the database",
    "start": "2109119",
    "end": "2115599"
  },
  {
    "text": "it's really really straightforward right it's just to create table statement um I've got my primary key there a",
    "start": "2115599",
    "end": "2122920"
  },
  {
    "text": "clustered index I've had other indexes I could put it in here I could put them in different files and when this thing gets compiled",
    "start": "2122920",
    "end": "2130060"
  },
  {
    "text": "together it creates uh what's what Microsoft refers to as a DAC pack",
    "start": "2130060",
    "end": "2135160"
  },
  {
    "text": "dacpac um that then it's just a bunch of XML",
    "start": "2135160",
    "end": "2141040"
  },
  {
    "text": "because it's an Enterprise problem so let's solve it with XML",
    "start": "2141040",
    "end": "2146260"
  },
  {
    "text": "um and then that thing can be deployed against wherever you generally configure a Target",
    "start": "2146260",
    "end": "2151839"
  },
  {
    "text": "in my case the targets uh SQL Server",
    "start": "2151839",
    "end": "2157960"
  },
  {
    "text": "and uh it's got what should look fairly",
    "start": "2157960",
    "end": "2164320"
  },
  {
    "text": "familiar to anybody who's done a lot of c-sharp except instead of a CS project it's a sequel prize",
    "start": "2164320",
    "end": "2171400"
  },
  {
    "text": "um and uh unfortunately I can't demo this work building locally",
    "start": "2171400",
    "end": "2177280"
  },
  {
    "text": "because haha the SQL Server data tools don't work on a Mac",
    "start": "2177280",
    "end": "2182380"
  },
  {
    "text": "they don't work on an arm-based processor either so I can't even boot up parallels so",
    "start": "2182380",
    "end": "2188020"
  },
  {
    "text": "hopefully they'll fix that at some point and then",
    "start": "2188020",
    "end": "2193660"
  },
  {
    "text": "essentially you can just build them build this by",
    "start": "2193660",
    "end": "2199619"
  },
  {
    "text": "doing something like this and it's just a visual studio build",
    "start": "2200619",
    "end": "2208180"
  },
  {
    "text": "um and you this works in whatever build system you use I'm using Azure devops",
    "start": "2208180",
    "end": "2214240"
  },
  {
    "text": "here you could use team City you could use uh Jenkins you could use whatever",
    "start": "2214240",
    "end": "2220599"
  },
  {
    "text": "GitHub actions I think although note for SQL Server data tools because",
    "start": "2220599",
    "end": "2227020"
  },
  {
    "text": "it only runs on Windows you're going to be paying for Windows agents in GitHub so yeah",
    "start": "2227020",
    "end": "2232540"
  },
  {
    "text": "that's that's an additional bill right and uh yeah so let's",
    "start": "2232540",
    "end": "2239200"
  },
  {
    "text": "let's add a table right and I've done some some demo already some demo scripts",
    "start": "2239200",
    "end": "2244300"
  },
  {
    "text": "already so I don't have to do a bunch of typing here but we're just going to add a parts ssdt demo table to this database",
    "start": "2244300",
    "end": "2250300"
  },
  {
    "text": "I guess I should prove that this doesn't already exist there and maybe wake my database up",
    "start": "2250300",
    "end": "2257760"
  },
  {
    "text": "right so got my continuous database to play server here and it did go to sleep",
    "start": "2258099",
    "end": "2266700"
  },
  {
    "text": "SQL Azure the serverless SQL Azure is great for saving money but just be",
    "start": "2268300",
    "end": "2273460"
  },
  {
    "text": "careful how you can figure it's going to sleep so yeah you can see like my table list",
    "start": "2273460",
    "end": "2279040"
  },
  {
    "text": "here I don't have that table yet so let's get it there oh and there's there is data in this",
    "start": "2279040",
    "end": "2285400"
  },
  {
    "text": "database as well just to prove those data in this database",
    "start": "2285400",
    "end": "2291960"
  },
  {
    "text": "Maybe there we go",
    "start": "2294339",
    "end": "2298559"
  },
  {
    "text": "yeah there's data in the database right so about no uh no ignoring the man",
    "start": "2307000",
    "end": "2313780"
  },
  {
    "text": "behind the curtain here so uh let's let's add this table and so",
    "start": "2313780",
    "end": "2319240"
  },
  {
    "text": "to do this in in the state base way um literally all I have to do is I'm",
    "start": "2319240",
    "end": "2325300"
  },
  {
    "text": "going to drag it in here yep I do want to move you thank you",
    "start": "2325300",
    "end": "2330400"
  },
  {
    "text": "um now we want to fill it with data as well the way you do that in the state-based world and in SQL Server data",
    "start": "2330400",
    "end": "2336700"
  },
  {
    "text": "tools is through what are called pre and post deployment Scripts um",
    "start": "2336700",
    "end": "2342820"
  },
  {
    "text": "so those uh post deployment scripts in this case we're gonna",
    "start": "2342820",
    "end": "2347940"
  },
  {
    "text": "and this is uh this is what I'm talking about about item potency right so in this case if this table is here",
    "start": "2349119",
    "end": "2356980"
  },
  {
    "text": "fill it with data from the parts table um and it's a small enough table that it's not going to take forever when we",
    "start": "2356980",
    "end": "2363160"
  },
  {
    "text": "run it so we'll come in here",
    "start": "2363160",
    "end": "2369119"
  },
  {
    "text": "set this guy to run and the last thing I have to do is make",
    "start": "2369160",
    "end": "2375460"
  },
  {
    "text": "sure that that table gets included in the build we'll go ahead and get",
    "start": "2375460",
    "end": "2383640"
  },
  {
    "text": "push that up the internet's cooperating all right we can come over here",
    "start": "2392680",
    "end": "2399400"
  },
  {
    "text": "come back out to our Pipelines",
    "start": "2399400",
    "end": "2402960"
  },
  {
    "text": "go ahead and run this",
    "start": "2405640",
    "end": "2408539"
  },
  {
    "text": "and what this will do is it will go ahead and",
    "start": "2412960",
    "end": "2418119"
  },
  {
    "text": "pull our changes build that DAC pack as I was mentioning",
    "start": "2418119",
    "end": "2424320"
  },
  {
    "text": "uh failed to communicate with the agent cloud",
    "start": "2424440",
    "end": "2429180"
  },
  {
    "text": "demo is a four-letter word",
    "start": "2430839",
    "end": "2434160"
  },
  {
    "text": "no So eventually we'll get an agent otherwise this will be okay there we go otherwise this would be real unfortunate",
    "start": "2439540",
    "end": "2446140"
  },
  {
    "text": "so it's going to pull our changes it's going to build that DAC pack and then in",
    "start": "2446140",
    "end": "2453040"
  },
  {
    "text": "our case I've chosen to just go ahead and deploy that DAC pack straight to the server",
    "start": "2453040",
    "end": "2458460"
  },
  {
    "text": "now note this is a demo you probably don't want to do that um",
    "start": "2458460",
    "end": "2463839"
  },
  {
    "text": "like you probably want to have a separate deploy step uh particularly with something like this",
    "start": "2463839",
    "end": "2470040"
  },
  {
    "text": "I also note that I'm running no tests of any sort um because again it's a demo",
    "start": "2470040",
    "end": "2476920"
  },
  {
    "text": "what you can see is we're actually we're building and you get some similar output to what you get from",
    "start": "2476920",
    "end": "2482920"
  },
  {
    "text": "normal C sharp writes the model",
    "start": "2482920",
    "end": "2488260"
  },
  {
    "text": "you'll notice it's XML because of course it is",
    "start": "2488260",
    "end": "2493920"
  },
  {
    "text": "this is also not incredibly fast uh when I ran it earlier it was not this",
    "start": "2494920",
    "end": "2501220"
  },
  {
    "text": "slow I wonder if I'm",
    "start": "2501220",
    "end": "2507119"
  },
  {
    "text": "wonder if I'm running into uh I guess the working days started in the U.S I wonder if I'm still work running",
    "start": "2510099",
    "end": "2516400"
  },
  {
    "text": "on U.S agents there we go right so build finished and then we'll deploy",
    "start": "2516400",
    "end": "2522160"
  },
  {
    "text": "and uh you can't see my password so that's good",
    "start": "2522160",
    "end": "2528300"
  },
  {
    "text": "um not that you can access this database anyway because firewalls are good",
    "start": "2528400",
    "end": "2534579"
  },
  {
    "text": "you see it says okay here's the dacpac file and",
    "start": "2534579",
    "end": "2540880"
  },
  {
    "text": "do some initializing of deployments so by running these things automated is",
    "start": "2540880",
    "end": "2546099"
  },
  {
    "text": "good because then you don't have to like you know you can get up go up and get a coffee and come back and you get the answer",
    "start": "2546099",
    "end": "2552838"
  },
  {
    "text": "I I want to win something too I never win anything at conferences",
    "start": "2557380",
    "end": "2562839"
  },
  {
    "text": "like never right okay so now we're updating the database it says we're creating the table says we're creating",
    "start": "2562839",
    "end": "2568900"
  },
  {
    "text": "the foreign key and it finished so fast that it flipped away before I could talk about it",
    "start": "2568900",
    "end": "2575099"
  },
  {
    "text": "um yeah and so that's it right so that this says it ran successfully Let's",
    "start": "2575140",
    "end": "2581859"
  },
  {
    "text": "uh let's go prove it so we'll refresh the table list hey",
    "start": "2581859",
    "end": "2587680"
  },
  {
    "text": "there it is Parts Associated underscore demo okay",
    "start": "2587680",
    "end": "2593200"
  },
  {
    "text": "now let's proved that the data ended up in there",
    "start": "2593200",
    "end": "2597300"
  },
  {
    "text": "Azure data Studio has it in for me today",
    "start": "2599440",
    "end": "2603359"
  },
  {
    "text": "I also did not choose a very powerful database okay yeah so you can see the parts all in there right great",
    "start": "2605500",
    "end": "2613660"
  },
  {
    "text": "um what if we wanted to do the same thing with a migration based tool um plot twist it's going to be much easier",
    "start": "2613660",
    "end": "2620859"
  },
  {
    "text": "so let's take a look at Flyway so flyways convention and many other",
    "start": "2620859",
    "end": "2628300"
  },
  {
    "text": "migration-based conventions is you have a version identifier in my case I'm just going",
    "start": "2628300",
    "end": "2633339"
  },
  {
    "text": "one two three four five and then you name that version whatever you want it to and it processes them in",
    "start": "2633339",
    "end": "2640599"
  },
  {
    "text": "order um and literally all it does is process",
    "start": "2640599",
    "end": "2646720"
  },
  {
    "text": "them in order we can take a look at the con configuration file you can see",
    "start": "2646720",
    "end": "2653560"
  },
  {
    "text": "um yep configuration file is pretty useless because it's just for local",
    "start": "2653560",
    "end": "2659859"
  },
  {
    "text": "but if we want to do a parts Flyway demo right so now this",
    "start": "2659859",
    "end": "2666040"
  },
  {
    "text": "is the same thing I just did in the state base but with migrations and this looks a lot simpler doesn't it",
    "start": "2666040",
    "end": "2673180"
  },
  {
    "text": "this is a lot nicer looking at least from a developer standpoint like I had to do a lot of stuff in the",
    "start": "2673180",
    "end": "2678940"
  },
  {
    "text": "other one all I have to do on this one is well let's move it",
    "start": "2678940",
    "end": "2685740"
  },
  {
    "text": "[Music]",
    "start": "2690870",
    "end": "2693949"
  },
  {
    "text": "push it up it's up there",
    "start": "2696220",
    "end": "2700200"
  },
  {
    "text": "and they're having a lot of fun down there I wouldn't blame you guys if you left",
    "start": "2704319",
    "end": "2710400"
  },
  {
    "text": "um and so we'll take a look at this pipeline because this is this is a lot simpler um there are a lot of different ways to run Flyway I'm just installing the tools",
    "start": "2710920",
    "end": "2717880"
  },
  {
    "text": "on the build machine and running a migration but essentially all this does is run",
    "start": "2717880",
    "end": "2724359"
  },
  {
    "text": "Flyway migrate with a bunch of parameters including the uh user the",
    "start": "2724359",
    "end": "2730720"
  },
  {
    "text": "name jdbc URL um and that's it that's that's pretty much",
    "start": "2730720",
    "end": "2737500"
  },
  {
    "text": "what it does so we'll take a look at this",
    "start": "2737500",
    "end": "2741539"
  },
  {
    "text": "you'll notice this is also a lot faster even with having to install the tools on the build machine",
    "start": "2745660",
    "end": "2752260"
  },
  {
    "text": "fail to communicate with the agent Cloud again my lucky day",
    "start": "2752260",
    "end": "2758220"
  },
  {
    "text": "yeah okay so check out normal they use flyways I'm just going to",
    "start": "2760359",
    "end": "2766000"
  },
  {
    "text": "install that particular version which is quite nice I have uh on occasion updated",
    "start": "2766000",
    "end": "2774640"
  },
  {
    "text": "my local Flyway and broken everything which is why I do this in the cloud now",
    "start": "2774640",
    "end": "2781800"
  },
  {
    "text": "right so we run the migration and you'll be able to see the",
    "start": "2784240",
    "end": "2789520"
  },
  {
    "text": "yes",
    "start": "2789520",
    "end": "2791940"
  },
  {
    "text": "yes so it says fly away right gives me my database",
    "start": "2795880",
    "end": "2801940"
  },
  {
    "text": "successfully validated 14 migrations my schema was on 13 right that table wasn't there the migration hadn't been",
    "start": "2801940",
    "end": "2808540"
  },
  {
    "text": "performed it says okay migrate it applied one migration so we're now at version 14.",
    "start": "2808540",
    "end": "2816220"
  },
  {
    "text": "and uh that was quick right so let's go prove it",
    "start": "2816220",
    "end": "2822099"
  },
  {
    "text": "close this guy hey our Flyway demo table is there now",
    "start": "2822099",
    "end": "2828160"
  },
  {
    "text": "too and I bet it has data in it",
    "start": "2828160",
    "end": "2833220"
  },
  {
    "text": "note to self next time just have these queries ready to go",
    "start": "2837640",
    "end": "2843780"
  },
  {
    "text": "yeah so we got data right and it happens to be the same data which is fine",
    "start": "2845980",
    "end": "2851980"
  },
  {
    "text": "okay but like I said in the in in the slides",
    "start": "2851980",
    "end": "2857380"
  },
  {
    "start": "2854000",
    "end": "2951000"
  },
  {
    "text": "adding things is really easy let's go rename things",
    "start": "2857380",
    "end": "2864280"
  },
  {
    "text": "and we'll start with renaming in",
    "start": "2864280",
    "end": "2869380"
  },
  {
    "text": "ssdt right so",
    "start": "2869380",
    "end": "2874839"
  },
  {
    "text": "now for this all I have to do in our state based",
    "start": "2874839",
    "end": "2881578"
  },
  {
    "text": "do you guys still hear me even though over the stuff there yeah okay good then I'm just gonna keep talking so in my state base right because State",
    "start": "2883420",
    "end": "2890980"
  },
  {
    "text": "the state-based database project says this is how my database should look",
    "start": "2890980",
    "end": "2896800"
  },
  {
    "text": "so all I have to do is swap my ssdt demo",
    "start": "2896800",
    "end": "2902079"
  },
  {
    "text": "with underscores with the one that doesn't have underscores right because we all use underscores and SQL Server",
    "start": "2902079",
    "end": "2907300"
  },
  {
    "text": "it's weird so I'll move that in there",
    "start": "2907300",
    "end": "2912460"
  },
  {
    "text": "move this back out there",
    "start": "2912460",
    "end": "2915960"
  },
  {
    "text": "okay swap around what we're actually uh including in the build",
    "start": "2918160",
    "end": "2924900"
  },
  {
    "text": "and",
    "start": "2925119",
    "end": "2928119"
  },
  {
    "text": "we'll have two deployment scripts why do we need two",
    "start": "2934480",
    "end": "2942099"
  },
  {
    "text": "that's weird we're just renaming the table well",
    "start": "2942099",
    "end": "2948040"
  },
  {
    "text": "let's take a look at what we're doing in those",
    "start": "2948040",
    "end": "2951420"
  },
  {
    "start": "2951000",
    "end": "3077000"
  },
  {
    "text": "so because we can't be sure",
    "start": "2953500",
    "end": "2960280"
  },
  {
    "text": "how this changed the state change is going to be executed right now logically it says if I execute a rename in SQL",
    "start": "2960280",
    "end": "2969640"
  },
  {
    "text": "Server I'm just going to use rename right or if I'm in postgres alter table rename right",
    "start": "2969640",
    "end": "2976240"
  },
  {
    "text": "but we can't guarantee that's how our our state-based tool is going to actually do it so",
    "start": "2976240",
    "end": "2982300"
  },
  {
    "text": "right we're going to need to preserve that data somehow because what if it issues drop table create table",
    "start": "2982300",
    "end": "2988859"
  },
  {
    "text": "anybody played around with uh with Atlantis for terraform management",
    "start": "2989859",
    "end": "2995740"
  },
  {
    "text": "yeah if you change if you change the name of something it drops it and recreates it nah not what you want necessarily right",
    "start": "2995740",
    "end": "3003480"
  },
  {
    "text": "so if we have our old table name we're going to create a temp table and",
    "start": "3003480",
    "end": "3009300"
  },
  {
    "text": "copy our data into it on the front side so that then",
    "start": "3009300",
    "end": "3015119"
  },
  {
    "text": "you know we don't have to deal with it",
    "start": "3015119",
    "end": "3020119"
  },
  {
    "text": "and then on the back side",
    "start": "3021000",
    "end": "3024079"
  },
  {
    "text": "sorry this one right insert into the newly renamed table",
    "start": "3026640",
    "end": "3032280"
  },
  {
    "text": "and drop the temp table this is kind of a pain but this is what we're working with we're",
    "start": "3032280",
    "end": "3038460"
  },
  {
    "text": "working with state right we have to think about how we're moving the database from one state to the other",
    "start": "3038460",
    "end": "3044040"
  },
  {
    "text": "so we'll go ahead save these things",
    "start": "3044040",
    "end": "3048560"
  },
  {
    "text": "and as a as an aside",
    "start": "3049079",
    "end": "3054318"
  },
  {
    "text": "we're going to get some much more interesting output",
    "start": "3054720",
    "end": "3059660"
  },
  {
    "text": "when we go run the build",
    "start": "3062640",
    "end": "3065720"
  },
  {
    "text": "when you finish you finished run a pipeline",
    "start": "3068700",
    "end": "3074000"
  },
  {
    "text": "right and and three for three",
    "start": "3077700",
    "end": "3082740"
  },
  {
    "text": "when I do the migration based demo of this we'll see if I get four from four",
    "start": "3082740",
    "end": "3088160"
  },
  {
    "text": "um right and so",
    "start": "3088200",
    "end": "3093140"
  },
  {
    "text": "the reason that nobody has really used ssdt or not no one but the reason the",
    "start": "3094079",
    "end": "3099359"
  },
  {
    "text": "the adoption level is fairly low is because that sort of like",
    "start": "3099359",
    "end": "3104760"
  },
  {
    "text": "let me awkwardly work around how state is managed is really can be really prone",
    "start": "3104760",
    "end": "3111180"
  },
  {
    "text": "to error um and if you don't know what's happening",
    "start": "3111180",
    "end": "3116640"
  },
  {
    "text": "um now there are some some guard rails like if I had just run that with the data in the table it would have said",
    "start": "3116640",
    "end": "3123420"
  },
  {
    "text": "I can't make this change because there's data in the table and the the change might be destructive which is nice but",
    "start": "3123420",
    "end": "3129540"
  },
  {
    "text": "it's also not what you want in your continuous process um",
    "start": "3129540",
    "end": "3135200"
  },
  {
    "text": "building the database building a database come on and get to the interesting part",
    "start": "3135420",
    "end": "3142760"
  },
  {
    "text": "all right",
    "start": "3146700",
    "end": "3149180"
  },
  {
    "text": "there we go",
    "start": "3158700",
    "end": "3161480"
  },
  {
    "text": "as an aside uh if you uh if you've enjoyed NDC Oslo",
    "start": "3174119",
    "end": "3179760"
  },
  {
    "text": "um definitely think about coming down to Copenhagen for the Copenhagen developer Festival",
    "start": "3179760",
    "end": "3184980"
  },
  {
    "text": "um it's held in a really interesting part of the city there's a really awesome uh barbecue and",
    "start": "3184980",
    "end": "3192720"
  },
  {
    "text": "beer place nearby um and it should be a really good time",
    "start": "3192720",
    "end": "3198920"
  },
  {
    "text": "I've apparently used up all of my Azure devops Karma for today",
    "start": "3201420",
    "end": "3207119"
  },
  {
    "text": "well while we're waiting for this I'll go ahead and come back over here and and make the make the change for the",
    "start": "3207119",
    "end": "3212220"
  },
  {
    "text": "migration one um and so that's all I have to do for the",
    "start": "3212220",
    "end": "3219000"
  },
  {
    "start": "3214000",
    "end": "3399000"
  },
  {
    "text": "migration one none of that like let's swap some tables",
    "start": "3219000",
    "end": "3224220"
  },
  {
    "text": "around and let's run a couple of files it's just let's rename the table",
    "start": "3224220",
    "end": "3230099"
  },
  {
    "text": "and uh so go ahead and push this in here",
    "start": "3230099",
    "end": "3235578"
  },
  {
    "text": "we'll go ahead and",
    "start": "3235800",
    "end": "3238880"
  },
  {
    "text": "ah",
    "start": "3246000",
    "end": "3249000"
  },
  {
    "text": "third time's the charm oh hey uh why are you stuck",
    "start": "3251819",
    "end": "3259579"
  },
  {
    "text": "all right",
    "start": "3268819",
    "end": "3272059"
  },
  {
    "text": "well",
    "start": "3278400",
    "end": "3281058"
  },
  {
    "text": "it was worth a try have you tried turning it off and back on again",
    "start": "3286980",
    "end": "3292339"
  },
  {
    "text": "am I still on over here",
    "start": "3297359",
    "end": "3300740"
  },
  {
    "text": "yep I'm still on over here maybe",
    "start": "3309420",
    "end": "3313280"
  },
  {
    "text": "hmm did we",
    "start": "3317760",
    "end": "3324859"
  },
  {
    "text": "well you would have seen a really cool looking demo uh but",
    "start": "3326940",
    "end": "3333540"
  },
  {
    "text": "ah here we go I have confidence in you",
    "start": "3333540",
    "end": "3341839"
  },
  {
    "text": "wow okay sometimes you win the build agent Lottery and sometimes you don't uh",
    "start": "3353640",
    "end": "3360480"
  },
  {
    "text": "so we'll just puts what we'll call that one um yeah okay cool now we're publishing",
    "start": "3360480",
    "end": "3368880"
  },
  {
    "text": "um and what you'll see is we'll start the deployment and it will run",
    "start": "3368880",
    "end": "3376579"
  },
  {
    "text": "our pre-deployment",
    "start": "3377339",
    "end": "3381059"
  },
  {
    "text": "yeah all right well I give up",
    "start": "3384780",
    "end": "3391160"
  },
  {
    "text": "but it's before four o'clock yeah",
    "start": "3393059",
    "end": "3399319"
  },
  {
    "text": "so it it's funny because okay there we go it's it's funny you say that it's a gentleman says it's Friday I just never",
    "start": "3399780",
    "end": "3406319"
  },
  {
    "text": "deployed a database on Friday um it's uh it's interesting because as I",
    "start": "3406319",
    "end": "3413520"
  },
  {
    "text": "mentioned we deploy six to eight times a day and that does include Friday um",
    "start": "3413520",
    "end": "3418740"
  },
  {
    "text": "and uh yeah we shouldn't be afraid of deploying",
    "start": "3418740",
    "end": "3423780"
  },
  {
    "text": "on Friday um but if we are we should look at why that is so anyway that's a side note",
    "start": "3423780",
    "end": "3430859"
  },
  {
    "text": "right so uh you see we did some stuff and if we come back over here we will",
    "start": "3430859",
    "end": "3438059"
  },
  {
    "text": "now see that it has been renamed but our old table has not been dropped",
    "start": "3438059",
    "end": "3444119"
  },
  {
    "text": "which is interesting so something went wrong",
    "start": "3444119",
    "end": "3450619"
  },
  {
    "text": "which I will have to look at at a different time in any case we're nearly at time for this talk uh I have time for a couple of",
    "start": "3450960",
    "end": "3458280"
  },
  {
    "text": "questions yep",
    "start": "3458280",
    "end": "3465319"
  },
  {
    "text": "yeah so the question was can the migration tool be run on a remote location like say on a customer location",
    "start": "3477599",
    "end": "3483059"
  },
  {
    "text": "or does it need to be run locally or on the build machine and the answer at least for Flyway is um",
    "start": "3483059",
    "end": "3490500"
  },
  {
    "text": "you can run it wherever you want it's a command line tool you can install it you can run it in a Docker container",
    "start": "3490500",
    "end": "3497000"
  },
  {
    "text": "it has no no Reliance on running on a build machine so that can be a very",
    "start": "3497000",
    "end": "3503819"
  },
  {
    "text": "useful thing and particularly if you have remote databases that you need to update",
    "start": "3503819",
    "end": "3510020"
  },
  {
    "text": "anybody else [Music]",
    "start": "3510300",
    "end": "3517539"
  },
  {
    "text": "do Flyway or other tools check for manual changes so um",
    "start": "3521700",
    "end": "3527640"
  },
  {
    "text": "you might have noticed that my my state base deploy did not destroy my Flyway tables and the reason for that is",
    "start": "3527640",
    "end": "3534000"
  },
  {
    "text": "because I set it not to Flyway doesn't Flyway only executes Flyway and other migration based tools",
    "start": "3534000",
    "end": "3540780"
  },
  {
    "text": "generally only execute um your your what you've written as scripts",
    "start": "3540780",
    "end": "3546780"
  },
  {
    "text": "and it ignores any other changes that have been made in the database and if there's a conflict then the script just fails",
    "start": "3546780",
    "end": "3552900"
  },
  {
    "text": "right state-based tools generally say this is the state I expect in the",
    "start": "3552900",
    "end": "3559319"
  },
  {
    "text": "database this is the state you've given me so I'm going to wipe away everything that I",
    "start": "3559319",
    "end": "3564420"
  },
  {
    "text": "don't know about now as you can see you can set it to",
    "start": "3564420",
    "end": "3569940"
  },
  {
    "text": "ignore other changes but then it ignores all the other changes um so that there's a there's a trade-off",
    "start": "3569940",
    "end": "3575940"
  },
  {
    "text": "there I mentioned we were on our own migration-based tool one of the reasons we did it was so that we could get",
    "start": "3575940",
    "end": "3582420"
  },
  {
    "text": "um a bit of State checking as part of our deployment",
    "start": "3582420",
    "end": "3588720"
  },
  {
    "text": "all right it is four o'clock so thank you guys all for coming I",
    "start": "3588720",
    "end": "3594420"
  },
  {
    "text": "appreciate it I hope you had a great conference um and enjoy the the ending Keynote",
    "start": "3594420",
    "end": "3600500"
  }
]