[
  {
    "text": "excellent hi everyone thank you for choosing to spend the next hour with me",
    "start": "20",
    "end": "6000"
  },
  {
    "text": "my name's Adam I work for a company called particular software we're the makers of a product called end service bus has anyone heard of any service bus",
    "start": "6000",
    "end": "12599"
  },
  {
    "text": "at all that's about half of you I am going to show you a little bit a few things to do with that in this talk but",
    "start": "12599",
    "end": "19440"
  },
  {
    "text": "that's not the point here um I'm going to talk about a certain class of problems which not",
    "start": "19440",
    "end": "26400"
  },
  {
    "text": "many people actually talk about that often it's to do with the runtime behavior of your code you might say well",
    "start": "26400",
    "end": "33300"
  },
  {
    "text": "I do think about the runtime behavior of my code when I write it and that's true but there are a certain class of",
    "start": "33300",
    "end": "38760"
  },
  {
    "text": "problems which only really manifest themselves at runtime they may be quite difficult to predict beforehand and in",
    "start": "38760",
    "end": "45420"
  },
  {
    "text": "particular I'm going to talk about the hour of time so the error of time is a term coined by a guide called Sir Arthur",
    "start": "45420",
    "end": "52739"
  },
  {
    "text": "Stanley Eddington and he said the time when it moves in One Direction you can't predict the future and of course you can't I'm not going to try and predict",
    "start": "52739",
    "end": "58800"
  },
  {
    "text": "the future but we can kind of fold things that need to happen in the future into our current",
    "start": "58800",
    "end": "64860"
  },
  {
    "text": "code now I'm going to sort of take a few ideas you may have seen and kind of invert them and turn them upside down",
    "start": "64860",
    "end": "69900"
  },
  {
    "text": "and tear them apart I expect that to raise questions so I don't know if I will have time for Q a during this",
    "start": "69900",
    "end": "77580"
  },
  {
    "text": "session and actually it's lunch right after this right so I'll try and let you out a few minutes early to get ahead of",
    "start": "77580",
    "end": "83280"
  },
  {
    "text": "the queue uh but I will be at the particular software booth just outside in the hall uh throughout the whole of",
    "start": "83280",
    "end": "89640"
  },
  {
    "text": "lunch and most of the rest of the conference so please do not hesitate to come and grab me and ask me about this stuff I love talking about it",
    "start": "89640",
    "end": "96600"
  },
  {
    "text": "so I'm going to take a fairly effeminate familiar example I I guess you've all probably seen Amazon at one point or",
    "start": "96600",
    "end": "104220"
  },
  {
    "text": "something similar to it so it doesn't need much much explanation it's an e-commerce site but the thing is if you",
    "start": "104220",
    "end": "110640"
  },
  {
    "text": "are in this kind of area of business and you are running some kind of e-commerce site first of all you are up against",
    "start": "110640",
    "end": "116579"
  },
  {
    "text": "Amazon and you're up against a whole load of other people and you need to try and differentiate so I'm going to take a",
    "start": "116579",
    "end": "122460"
  },
  {
    "text": "very simple case the business might come to you and say you know what we're going to try and uh",
    "start": "122460",
    "end": "130020"
  },
  {
    "text": "give customers discounts so something like just to keep it simple if a customer orders more than 100 pounds",
    "start": "130020",
    "end": "136080"
  },
  {
    "text": "worth of goods within a week we're going to give them a 10 discount okay fairly simple so you think all right great I am",
    "start": "136080",
    "end": "143580"
  },
  {
    "text": "going to use domain driven design and we're going to use object orientation I'm going to use event driven architecture and all the rest of it I'm",
    "start": "143580",
    "end": "149160"
  },
  {
    "text": "going to make this nicely encapsulated use all the techniques I've heard about uh just like I've tried to use all the",
    "start": "149160",
    "end": "155640"
  },
  {
    "text": "animation techniques in this slide and you come up with some nice tested code",
    "start": "155640",
    "end": "161099"
  },
  {
    "text": "and some nice object trying to code and it's all nice we're not doing anything particularly fantastically complicated",
    "start": "161099",
    "end": "166920"
  },
  {
    "text": "here we're taking the so when we submit this order right we're going to take all",
    "start": "166920",
    "end": "172860"
  },
  {
    "text": "the orders where the customer ID equals this orders customer ID okay so all the",
    "start": "172860",
    "end": "178620"
  },
  {
    "text": "orders for the current customer we're going to look at all the orders which are which have a time set greater",
    "start": "178620",
    "end": "185640"
  },
  {
    "text": "or equal than now minus seven days okay so in the last week we're going to Total",
    "start": "185640",
    "end": "191220"
  },
  {
    "text": "those up and if the week total is greater or equal to 100 pounds we're going to give a 10 discount otherwise",
    "start": "191220",
    "end": "196980"
  },
  {
    "text": "zero great right and then we do other stuff to actually process the order",
    "start": "196980",
    "end": "202620"
  },
  {
    "text": "looks fine right so that goes into production and it seems to work what's the problem",
    "start": "202620",
    "end": "208560"
  },
  {
    "text": "now I did say um okay you you might say well you know this is a big query on possibly like a",
    "start": "208560",
    "end": "215340"
  },
  {
    "text": "massive database table or something so you might kind of slow the database down and stuff like that but you can optimize",
    "start": "215340",
    "end": "220379"
  },
  {
    "text": "that work with your dbas get indexes create and all the rest of it um there's another problem though",
    "start": "220379",
    "end": "226739"
  },
  {
    "text": "remember I said customer so that can be an account for a company",
    "start": "226739",
    "end": "233000"
  },
  {
    "text": "user is not necessarily customer or account there can be two users within that company there could be a hundred",
    "start": "233000",
    "end": "239040"
  },
  {
    "text": "users within that company two people may click the button at the same time",
    "start": "239040",
    "end": "244140"
  },
  {
    "text": "let's say that they've been ordering things for 10 pounds each and I've made nine orders right they're going to see",
    "start": "244140",
    "end": "249360"
  },
  {
    "text": "some a sum of that word wrapping is unfortunate but the sum is 90 right they're going to say",
    "start": "249360",
    "end": "255840"
  },
  {
    "text": "the sum of the current orders is 90. what discount level are they going to",
    "start": "255840",
    "end": "261720"
  },
  {
    "text": "give it's less than 100 we're going to get a discount level of zero",
    "start": "261720",
    "end": "267300"
  },
  {
    "text": "so both of these orders get discounted at zero the bill comes at the end of the",
    "start": "267300",
    "end": "272580"
  },
  {
    "text": "month and the person paying the bill has a look and says hang on a minute hang on a minute we've made 11 orders in this",
    "start": "272580",
    "end": "278639"
  },
  {
    "text": "week at the beginning of the month why didn't that 11th order get discounted and if kind of scratching your head and",
    "start": "278639",
    "end": "284699"
  },
  {
    "text": "they say well we did um we did release that code we did release that feature into the system you",
    "start": "284699",
    "end": "291000"
  },
  {
    "text": "should have got the discount so you go to your logs and you're kind of trawling through and you're working out and then you realize oh hang on hang on a minute",
    "start": "291000",
    "end": "296520"
  },
  {
    "text": "they just happened at the same time you clicked at the same time can you can you just wait a few minutes before clicking",
    "start": "296520",
    "end": "302280"
  },
  {
    "text": "that second order a customer looks at you and says what how am I supposed to do that I've got",
    "start": "302280",
    "end": "307380"
  },
  {
    "text": "100 people in this office and they're all ordering I don't know when they're ordering they say well I don't know hold up a sign to say that I'm ordering when",
    "start": "307380",
    "end": "312960"
  },
  {
    "text": "you're ordering it the customer says you know that's ridiculous um I think I might just go to Amazon instead has",
    "start": "312960",
    "end": "319020"
  },
  {
    "text": "anyone heard of the term death by Amazon right if you don't run your business efficiently and well enough that's what",
    "start": "319020",
    "end": "324360"
  },
  {
    "text": "tends to happen and Amazon tends to eat you and then you think okay well I know I",
    "start": "324360",
    "end": "330300"
  },
  {
    "text": "can do this right the answer is obvious transactions right we're going to wrap this in a transaction",
    "start": "330300",
    "end": "336000"
  },
  {
    "text": "so we're going to put these things into transactions and make sure the read can't read something which hasn't been",
    "start": "336000",
    "end": "341460"
  },
  {
    "text": "updated by the other transaction etc etc the problem is that the fault the default transactional level in say SQL",
    "start": "341460",
    "end": "348840"
  },
  {
    "text": "Server is recommitted so they are still going to see the 90s so you're saying okay I need to make that serializable",
    "start": "348840",
    "end": "354900"
  },
  {
    "text": "um don't forget we're doing big queries across a big table here and you roll that into production and all of a sudden",
    "start": "354900",
    "end": "360660"
  },
  {
    "text": "your error logs start to fill up and it's like oh my god what have we done like quickly roll that back",
    "start": "360660",
    "end": "366539"
  },
  {
    "text": "because you're getting dead locks and that kind of stuff and what you need to realize though is",
    "start": "366539",
    "end": "372180"
  },
  {
    "text": "that those error logs are telling you something they're telling you that you've got a highly concurrent system here you've got lots of users ordering",
    "start": "372180",
    "end": "378300"
  },
  {
    "text": "at the same time that's great right good business well done marketing but you've got concurrency problems you need to",
    "start": "378300",
    "end": "384479"
  },
  {
    "text": "figure out a way to solve it so you think okay another thing I've done in the past is I've used a batch",
    "start": "384479",
    "end": "390960"
  },
  {
    "text": "job so you might write some code like this to say",
    "start": "390960",
    "end": "397979"
  },
  {
    "text": "we're going to look through the customers for each customer we're going to do a very similar thing to what we saw before",
    "start": "397979",
    "end": "403259"
  },
  {
    "text": "we're going to say grab all the orders where the customer ID equals this Customs ID where the orders in the last",
    "start": "403259",
    "end": "410160"
  },
  {
    "text": "week sum them up if the value if the sum is greater or equals 100 pounds discount",
    "start": "410160",
    "end": "415620"
  },
  {
    "text": "10 otherwise discount zero right great and you update the customer table with that saying this customer's discount is",
    "start": "415620",
    "end": "421080"
  },
  {
    "text": "zero that tends to work quite well",
    "start": "421080",
    "end": "426780"
  },
  {
    "text": "um although there is one glaring problem with it but before I go into that I will",
    "start": "426780",
    "end": "431819"
  },
  {
    "text": "say that if you're lucky you get to write this in C sharp but I'll give you a tip don't ever let",
    "start": "431819",
    "end": "438539"
  },
  {
    "text": "your DBA see it because when I made that mistake they rewrote it for me right I've got this",
    "start": "438539",
    "end": "444900"
  },
  {
    "text": "nice stuff with my nice c-sharp classes encapsulating the database they replaced it with a SQL statement",
    "start": "444900",
    "end": "452340"
  },
  {
    "text": "and they gave me a stored proc and said nope you're running this instead and this is actually quite quite hard to",
    "start": "452340",
    "end": "458280"
  },
  {
    "text": "argue with because this is almost certainly with all the tuning they can do and all the query hints and all the indexes they can do this is almost",
    "start": "458280",
    "end": "464340"
  },
  {
    "text": "certainly going to run better than your c-sharp and they'll very often give you the",
    "start": "464340",
    "end": "469800"
  },
  {
    "text": "first version of stored proc and say that's yours now go and look after it now What's Happening Here is that the",
    "start": "469800",
    "end": "476520"
  },
  {
    "text": "business like this because it works it's very efficient and then all of a sudden another one appears and this is just random SQL I copied",
    "start": "476520",
    "end": "483720"
  },
  {
    "text": "from the internet just I don't even know what it does and then another one appears and another one appears and what's Happening Here is",
    "start": "483720",
    "end": "491039"
  },
  {
    "text": "anyone heard of the Strangler pattern I think that might be in the gang of four that's about half of you",
    "start": "491039",
    "end": "496800"
  },
  {
    "text": "um Stang the pattern very briefly is where you take a really nasty piece of code and you kind of carve out bits of",
    "start": "496800",
    "end": "502020"
  },
  {
    "text": "it one by one replace it with a nice code until that bit in the mill is kind of strangled out of existence this is almost like a kind of reverse Strangler",
    "start": "502020",
    "end": "508919"
  },
  {
    "text": "pattern because what happens is all that nice DDD and tdd code that you wrote in",
    "start": "508919",
    "end": "514860"
  },
  {
    "text": "here is kind of shrinking in importance the interesting stuff the new requirements the differentiators that",
    "start": "514860",
    "end": "521459"
  },
  {
    "text": "the business have come to you with are all out here right this is becoming the",
    "start": "521459",
    "end": "526560"
  },
  {
    "text": "system and a talk from personal experience because I've laying awake at night",
    "start": "526560",
    "end": "532560"
  },
  {
    "text": "wondering how I'm going to debug that stored proc tomorrow you know it's very very difficult to",
    "start": "532560",
    "end": "538560"
  },
  {
    "text": "test these in the same way that you can test this kind of stuff in the middle here and sooner or later I realized that",
    "start": "538560",
    "end": "544800"
  },
  {
    "text": "I had a big ball of mud right I just had this little thing in the Middle with all these stored procs bolted on the outside",
    "start": "544800",
    "end": "551100"
  },
  {
    "text": "doing all the interesting business work and it was very hard to kind of think about",
    "start": "551100",
    "end": "556560"
  },
  {
    "text": "so what we need is but the thing is even even if you manage to avoid that problem",
    "start": "556560",
    "end": "562560"
  },
  {
    "text": "and you manage to keep it in C sharp you've got one very obvious problem here this runs overnight for example it might",
    "start": "562560",
    "end": "570899"
  },
  {
    "text": "run a bit more often but it runs some certain set period doesn't continuously run",
    "start": "570899",
    "end": "576420"
  },
  {
    "text": "if it runs overnight what you're doing is you're no longer penalizing users for clicking on at the same time you're",
    "start": "576420",
    "end": "582540"
  },
  {
    "text": "penalizing for cleaning on the same day so you've taken a race condition",
    "start": "582540",
    "end": "587959"
  },
  {
    "text": "effectively expanded it to an entire day so you kind of say to the user well you know do 10 orders wait till tomorrow for",
    "start": "587959",
    "end": "594660"
  },
  {
    "text": "the 11th okay okay I'm off to Amazon it doesn't really work too well",
    "start": "594660",
    "end": "599940"
  },
  {
    "text": "so you could do things like retroactively apply discounts you know you could say okay well what orders did",
    "start": "599940",
    "end": "605940"
  },
  {
    "text": "you do in the meantime and kind of retroactively give the money back so you see your child your car getting charged",
    "start": "605940",
    "end": "611760"
  },
  {
    "text": "and then reading and then credit it again it's just weird it's just not as good as the way Amazon does it so we",
    "start": "611760",
    "end": "617220"
  },
  {
    "text": "need to think about something else um we need to think about this hour of time",
    "start": "617220",
    "end": "623279"
  },
  {
    "text": "again and what it actually means so let's have a look at it this is the hour of time",
    "start": "623279",
    "end": "628920"
  },
  {
    "text": "as orders come in obviously we process them and we store them in the database now",
    "start": "628920",
    "end": "635339"
  },
  {
    "text": "the business has said to you when an order comes in I want you to look at all the orders for",
    "start": "635339",
    "end": "642480"
  },
  {
    "text": "the last week add them up if the total is greater than or equal to",
    "start": "642480",
    "end": "647519"
  },
  {
    "text": "100 give a discount of 10 otherwise zero the thing is that that is not a",
    "start": "647519",
    "end": "654779"
  },
  {
    "text": "requirement that is a work around the user has just given you a workaround",
    "start": "654779",
    "end": "661560"
  },
  {
    "text": "within the constraints of their knowledge of the current system",
    "start": "661560",
    "end": "666720"
  },
  {
    "text": "a requirement is when an order comes in if the customer has spent more than 100",
    "start": "666720",
    "end": "672959"
  },
  {
    "text": "pounds in that week give them a discount of 10. that might seem like a subtle change in",
    "start": "672959",
    "end": "679380"
  },
  {
    "text": "wording but we've gotten rid of that you must look back in time you must sum up",
    "start": "679380",
    "end": "684540"
  },
  {
    "text": "the orders blah blah blah blah they're not talking in terms of the system anymore they're talking in terms of the",
    "start": "684540",
    "end": "689700"
  },
  {
    "text": "pure business requirement Now by getting rid of that look through the previous orders we've freed ourselves up to do",
    "start": "689700",
    "end": "695459"
  },
  {
    "text": "something else let's have another look the hour of time again when the first order comes in what's the",
    "start": "695459",
    "end": "703079"
  },
  {
    "text": "current week total zero exactly the current week total is",
    "start": "703079",
    "end": "709320"
  },
  {
    "text": "zero so we process that order we look at the week total it's zero we process that order at the discount level of zero then",
    "start": "709320",
    "end": "716760"
  },
  {
    "text": "we add the current orders total to the current week total and we store it in the",
    "start": "716760",
    "end": "723660"
  },
  {
    "text": "database we then send ourselves a message one week into the future to say in one week",
    "start": "723660",
    "end": "731660"
  },
  {
    "text": "take away this orders total from the week total so you can see for the duration of that",
    "start": "731660",
    "end": "738300"
  },
  {
    "text": "week that orders total is going to be in there right that that that week total is going to be correct for that one week",
    "start": "738300",
    "end": "745380"
  },
  {
    "text": "when the second order comes in we do the same thing we add the second orders total to the week total and a week from",
    "start": "745380",
    "end": "752100"
  },
  {
    "text": "then we take away the second orders total from the week total right we send",
    "start": "752100",
    "end": "757260"
  },
  {
    "text": "ourselves a message to do that and then we take away the the total and",
    "start": "757260",
    "end": "762480"
  },
  {
    "text": "then the same with uh third message which is exactly the same thing again and you can see what we've got now is",
    "start": "762480",
    "end": "767519"
  },
  {
    "text": "this sliding window right at any point in time we've got the sliding window of what is the orders what is the total for",
    "start": "767519",
    "end": "773820"
  },
  {
    "text": "that customer for the past week in that one number right the week total",
    "start": "773820",
    "end": "778860"
  },
  {
    "text": "when an order comes in and so are so forth and so forth and so forth when a given order comes in what do we do",
    "start": "778860",
    "end": "784860"
  },
  {
    "text": "we look back at the history do we look back through the table and scan it and try and find out what what does we need",
    "start": "784860",
    "end": "790560"
  },
  {
    "text": "to take into account no we do not we retrieve a single Row from the database a weak total",
    "start": "790560",
    "end": "797279"
  },
  {
    "text": "that's great and equal to 100 with a discount of 10 otherwise zero so what we're doing is so anyone here",
    "start": "797279",
    "end": "804959"
  },
  {
    "text": "into DDD does anyone like DDD that's quite a few of you so if you that in that case this",
    "start": "804959",
    "end": "810959"
  },
  {
    "text": "is right up your street right you know the whole thing about ubiquitous language you've just sent this has just entered your ubiquitous language right a",
    "start": "810959",
    "end": "817440"
  },
  {
    "text": "week total and you can see it in your code right you're writing code in terms of that ubiquitous language right you're",
    "start": "817440",
    "end": "823440"
  },
  {
    "text": "getting deeper insights so we're folding the history into our current state in a currently highly",
    "start": "823440",
    "end": "829320"
  },
  {
    "text": "consistent way you can almost think of this as kind of like an inverted backwards kind of inside out batch job it's highly consistent",
    "start": "829320",
    "end": "836940"
  },
  {
    "text": "the thing is how are we going to actually program this right um we need a good way to program time",
    "start": "836940",
    "end": "843899"
  },
  {
    "text": "that thing about doing the thing in the future uh as far as I know HTTP doesn't",
    "start": "843899",
    "end": "849839"
  },
  {
    "text": "do this right I do not know a way of sending an HTTP request now and having arrive in the week's time",
    "start": "849839",
    "end": "857399"
  },
  {
    "text": "um system.timer system.threading.timer yes that would work until your process",
    "start": "857399",
    "end": "863339"
  },
  {
    "text": "crashes right and then you've lost your system.training.timer so you've seen something a bit more persistent so I'm",
    "start": "863339",
    "end": "869399"
  },
  {
    "text": "going to introduce now this notion of a saga um I'm not going to go into too much detail about what the Saga is if you do",
    "start": "869399",
    "end": "875579"
  },
  {
    "text": "want to know more about that um have a look at this URL uh take a photo with your phone or whatever that goes into it",
    "start": "875579",
    "end": "882360"
  },
  {
    "text": "in great detail what I'll quickly say is that Saga there's Saga in this context was coined",
    "start": "882360",
    "end": "888120"
  },
  {
    "text": "in the 80s it was a way of breaking up big transactions into smaller ones and",
    "start": "888120",
    "end": "893459"
  },
  {
    "text": "having a long-running process with some states um it was initially kind of more about rolling things back so it's almost like",
    "start": "893459",
    "end": "900180"
  },
  {
    "text": "you do one part of a process you do the next part you do the next part if something fails you kind of like roll each part back consistently",
    "start": "900180",
    "end": "907560"
  },
  {
    "text": "the real world doesn't tend to work like that um normally your business people will",
    "start": "907560",
    "end": "912959"
  },
  {
    "text": "say well don't just roll back the whole thing and give the person that money back do something else we'll find another way or send an alternate product",
    "start": "912959",
    "end": "918660"
  },
  {
    "text": "we'll send them a voucher we'll do something else so it's more about when you find a problem you find another path",
    "start": "918660",
    "end": "924240"
  },
  {
    "text": "to get to do what you're trying to do and ultimately which is to get the customers money",
    "start": "924240",
    "end": "930000"
  },
  {
    "text": "so putting it very simply a saga is a thing that receives lots of messages it receives the first message",
    "start": "930000",
    "end": "936959"
  },
  {
    "text": "store some kind of state receives a second message and what it does with the second message depends on what happened",
    "start": "936959",
    "end": "942839"
  },
  {
    "text": "in the first message right that's really a song in a nutshell and obviously that state that it stores in between is",
    "start": "942839",
    "end": "948360"
  },
  {
    "text": "whatever it needs from the first message so if you want to see that in more detail do follow that",
    "start": "948360",
    "end": "954360"
  },
  {
    "text": "now how can we actually do that how does that apply to this well if you look at this that's actually what we're doing right we're getting one message",
    "start": "954360",
    "end": "961620"
  },
  {
    "text": "we're storing the total and then when we get the second message it depends on what was in the first message right the",
    "start": "961620",
    "end": "967320"
  },
  {
    "text": "first message may be in an order for 110 pounds in that case when we saw when we handle",
    "start": "967320",
    "end": "972360"
  },
  {
    "text": "the second message to submit an order we're going to Discount that order by 10 right so it's a very very obvious use",
    "start": "972360",
    "end": "977459"
  },
  {
    "text": "case for a saga and what we do a week later also then",
    "start": "977459",
    "end": "984720"
  },
  {
    "text": "obviously depends on what happened in the first message right because we are we are taking that week total that we've",
    "start": "984720",
    "end": "990060"
  },
  {
    "text": "stored and we are mutating it to take away that order in a week's time so how do we code this right so let's",
    "start": "990060",
    "end": "996420"
  },
  {
    "text": "have a look at some code because it's a bit abstract I know that people like to see code it helps them understand these",
    "start": "996420",
    "end": "1002060"
  },
  {
    "text": "Concepts so this is a saga right and a saga",
    "start": "1002060",
    "end": "1009079"
  },
  {
    "text": "as implemented in the service bus is just a class right it's just nothing other than a c-sharp class",
    "start": "1009079",
    "end": "1015079"
  },
  {
    "text": "I'm calling it discounting because that's kind of the purpose here and the first thing we need to do is to",
    "start": "1015079",
    "end": "1020540"
  },
  {
    "text": "think about that state so what I've done here is defined a nested class called",
    "start": "1020540",
    "end": "1027860"
  },
  {
    "text": "discounting data which is going to hold our state I know some people don't really like nested classes I'm kind of I",
    "start": "1027860",
    "end": "1034280"
  },
  {
    "text": "find I'm a bit icky myself but for this case I actually quite like it I think it's a nice way of expressing that this",
    "start": "1034280",
    "end": "1041480"
  },
  {
    "text": "is very very private state to this Saga encapsulates this and it's only for the use of this Saga so I think for this use",
    "start": "1041480",
    "end": "1047839"
  },
  {
    "text": "case the nested class kind of kind of works fairly well but it doesn't have to be nested you can just Define it anywhere",
    "start": "1047839",
    "end": "1054559"
  },
  {
    "text": "what we do here is we inherit from this Base Class this contains I think I",
    "start": "1054559",
    "end": "1059900"
  },
  {
    "text": "should say contains or is it contain it is indeed contained this is just a",
    "start": "1059900",
    "end": "1065840"
  },
  {
    "text": "base class which gives us some things like the ID of The Saga",
    "start": "1065840",
    "end": "1071240"
  },
  {
    "text": "um who sent the original message the original message ID it's not interesting to us right now just to show you what",
    "start": "1071240",
    "end": "1077179"
  },
  {
    "text": "that is it's just an infrastructure thing it's very useful for some things but uh not so interesting for us right now",
    "start": "1077179",
    "end": "1083360"
  },
  {
    "text": "and other than that it's just a c-shock classes and properties we're defining a customer ID because we want to do",
    "start": "1083360",
    "end": "1091039"
  },
  {
    "text": "discounting per customer so obviously we need to know which customer we're doing the discounting for and then we've got",
    "start": "1091039",
    "end": "1096679"
  },
  {
    "text": "our magical week total right which is the thing we're really interested in I'm using a double just to keep the demo",
    "start": "1096679",
    "end": "1103820"
  },
  {
    "text": "simple you probably wouldn't do that in production you probably use a money type or something like that",
    "start": "1103820",
    "end": "1109340"
  },
  {
    "text": "then once we've got that class for the uh for the state we can then Define we",
    "start": "1109340",
    "end": "1115280"
  },
  {
    "text": "can then say that this is a saga by by inheriting from this Saga Base Class and",
    "start": "1115280",
    "end": "1121700"
  },
  {
    "text": "we say that the the this type parameter here is the state that it holds so Saga",
    "start": "1121700",
    "end": "1126799"
  },
  {
    "text": "of type discounting data then we need to handle obviously our",
    "start": "1126799",
    "end": "1132799"
  },
  {
    "text": "submit order message and we want to be started by a submit order message and incidentally this doesn't just mean",
    "start": "1132799",
    "end": "1139640"
  },
  {
    "text": "started by it means I'm started by a submit order message and I handle all the ones that come after that as well",
    "start": "1139640",
    "end": "1145700"
  },
  {
    "text": "and that gives us a method to implement called handle if you've seen an end",
    "start": "1145700",
    "end": "1152480"
  },
  {
    "text": "service bus Handler before this is exactly the same um all we're doing here is handling that",
    "start": "1152480",
    "end": "1159559"
  },
  {
    "text": "submit order message and submit what a message just looks like that it's got an ID for what it's",
    "start": "1159559",
    "end": "1165799"
  },
  {
    "text": "worth it's got customer ID it's got a total of the order it'll have other stuff on it as well right I'm just",
    "start": "1165799",
    "end": "1171500"
  },
  {
    "text": "leaving it out for whatever two um then we get this context object",
    "start": "1171500",
    "end": "1176539"
  },
  {
    "text": "that's just an infrastructure thing that you can use to send messages out and do other things I'll show you that in a",
    "start": "1176539",
    "end": "1183440"
  },
  {
    "text": "second now to look at to work out a discount as I said in the previous in one of the previous slides it's very very easy",
    "start": "1183440",
    "end": "1189559"
  },
  {
    "text": "right we just look at this one thing this week total right so when when this method gets called the state has already",
    "start": "1189559",
    "end": "1196220"
  },
  {
    "text": "been loaded and it's on this data property of the base class and then we've got our week total right so",
    "start": "1196220",
    "end": "1202039"
  },
  {
    "text": "working at discount level very very very easy indeed",
    "start": "1202039",
    "end": "1207380"
  },
  {
    "text": "once we've got that discount level we then send out another message to process the order and we've got the order ID on",
    "start": "1207380",
    "end": "1214640"
  },
  {
    "text": "there we've got the discount level we'll have other stuff as well right I'm just leaving it out for brevity",
    "start": "1214640",
    "end": "1219980"
  },
  {
    "text": "then we add this week's uh this met this orders total to our week total right so",
    "start": "1219980",
    "end": "1227000"
  },
  {
    "text": "we call it for next time next time we get an order and then comes the magic part",
    "start": "1227000",
    "end": "1232280"
  },
  {
    "text": "we request a timeout we pass through this is a method on the base Saga class we pass through this",
    "start": "1232280",
    "end": "1238640"
  },
  {
    "text": "context subject I mentioned before because that's just required we say",
    "start": "1238640",
    "end": "1244340"
  },
  {
    "text": "seven days from now right in a week's time and we just pass along the original message we could pass along anything",
    "start": "1244340",
    "end": "1250640"
  },
  {
    "text": "here but I may as well just pass along the same message again because it's got that total on there that we need because",
    "start": "1250640",
    "end": "1255980"
  },
  {
    "text": "that's what we need to take away in a week's time then we need to say that we handle",
    "start": "1255980",
    "end": "1262400"
  },
  {
    "text": "timeouts of types of mid order right as well as handling the original submit order we",
    "start": "1262400",
    "end": "1268460"
  },
  {
    "text": "handle timeouts of that type as well that gives us timeout method to",
    "start": "1268460",
    "end": "1273559"
  },
  {
    "text": "implement for one reason or another that's called State I don't know if that's an accident of history but that's the that's the",
    "start": "1273559",
    "end": "1281900"
  },
  {
    "text": "name of the thing we get in and we've as you've seen we're sending that same message through so it is a submit order",
    "start": "1281900",
    "end": "1287419"
  },
  {
    "text": "message we get the context object if we need it we don't need it this time and then we do something dead simple exactly",
    "start": "1287419",
    "end": "1293900"
  },
  {
    "text": "what I said before we take away that order's total from the week total",
    "start": "1293900",
    "end": "1299000"
  },
  {
    "text": "all right and we're done uh and then we've got our async tax here I don't know if anyone loves async or",
    "start": "1299000",
    "end": "1304880"
  },
  {
    "text": "not it's uh it's a little bit kind of above sometimes and yeah then we're done",
    "start": "1304880",
    "end": "1310100"
  },
  {
    "text": "I hope that makes sense more or less um it's fairly simple code as you can see",
    "start": "1310100",
    "end": "1315200"
  },
  {
    "text": "right it's not rocket science fairly easy to look at and understand um what's interesting now I think is to",
    "start": "1315200",
    "end": "1321320"
  },
  {
    "text": "show you what happens actually in the back end so what happens in the at the kind of infrastructure level so let's switch back to our",
    "start": "1321320",
    "end": "1328299"
  },
  {
    "text": "slides where are we here yeah I'm showing you the code right",
    "start": "1328299",
    "end": "1334400"
  },
  {
    "text": "so let's see what actually happens when we do this what I've got here is a bus abstraction",
    "start": "1334400",
    "end": "1340340"
  },
  {
    "text": "which you can kind of think about as the thing that kind of like looks at the queue and we've got",
    "start": "1340340",
    "end": "1347059"
  },
  {
    "text": "um a persistor and a persistor is really kind of an abstraction over a database right and these are components that n-service bus provides",
    "start": "1347059",
    "end": "1354919"
  },
  {
    "text": "when the message is delivered the bus realizes that a saga handles this",
    "start": "1354919",
    "end": "1360320"
  },
  {
    "text": "message and it loads that Saga from the database right loads of states in the database and dispatches that message",
    "start": "1360320",
    "end": "1366380"
  },
  {
    "text": "into the Saga by calling the handle method then we do what we just saw in the",
    "start": "1366380",
    "end": "1371600"
  },
  {
    "text": "previous slide in the in the code The Saga does that work and it requests this timeout",
    "start": "1371600",
    "end": "1378020"
  },
  {
    "text": "the bus now does one of two things it either and this is the preferred method it either tells the queuing system which",
    "start": "1378020",
    "end": "1386059"
  },
  {
    "text": "uh how long to delay that message for so it just says to the cooling system deliver me this message in one week the",
    "start": "1386059",
    "end": "1391880"
  },
  {
    "text": "only queuing system that we support other than we've seen which supports this fully is azure service bus so Azure",
    "start": "1391880",
    "end": "1399559"
  },
  {
    "text": "service bus we can just say give me back this message in a week as a service bus instantly is just a queuing system right",
    "start": "1399559",
    "end": "1405200"
  },
  {
    "text": "just part of its name it's very low level so it really is just a queuing system rather than what we we refer to as a bus",
    "start": "1405200",
    "end": "1411679"
  },
  {
    "text": "uh Amazon sqs kind of does it I'll come on to that in a second rabbitmq you can",
    "start": "1411679",
    "end": "1417140"
  },
  {
    "text": "kind of make it do it a bit more than that in a second as well if the queuing system doesn't support delays at all",
    "start": "1417140",
    "end": "1423380"
  },
  {
    "text": "like Azure storage queues doesn't um msmq doesn't although we don't really encourage msmq anymore because it's",
    "start": "1423380",
    "end": "1428900"
  },
  {
    "text": "actually going to have support now um we use SQL Server as a queuing system that's got a natural mechanism for doing",
    "start": "1428900",
    "end": "1435020"
  },
  {
    "text": "this either so in that case we put the timeout into the database right we have",
    "start": "1435020",
    "end": "1440360"
  },
  {
    "text": "to record the fact that this timeout is due in the database and we persist The Saga data at the same",
    "start": "1440360",
    "end": "1446960"
  },
  {
    "text": "time regardless of which delay method we use and that will go to the database and then we pull if if the timeouts in the",
    "start": "1446960",
    "end": "1454280"
  },
  {
    "text": "database we pull the database to find out when the timeout's due that's not nice right we don't like polling the",
    "start": "1454280",
    "end": "1459740"
  },
  {
    "text": "database so we always prefer using the native queuing system instead and letting that do the work for us so I did",
    "start": "1459740",
    "end": "1466460"
  },
  {
    "text": "say that Amazon sqs kind of does it Amazon sqs lets you delay a message for up to 15 minutes right so 900 seconds if",
    "start": "1466460",
    "end": "1474200"
  },
  {
    "text": "you want to delay a message for 600 seconds you're fine right you just put it in time as an sqs to say give me about this in 600 seconds and it will do",
    "start": "1474200",
    "end": "1481460"
  },
  {
    "text": "so if you want the 2800 second delay a little bit more difficult you can put it",
    "start": "1481460",
    "end": "1486980"
  },
  {
    "text": "in the queue for 900 seconds at a maximum what we've figured out is well we can just put a header on that message",
    "start": "1486980",
    "end": "1493100"
  },
  {
    "text": "to say when we get that back we still need to put it in the queue for another 1000 hours of seconds right so we get it",
    "start": "1493100",
    "end": "1498740"
  },
  {
    "text": "back put it in the queue for 900 right ahead for a 1900 right ahead of 100 put",
    "start": "1498740",
    "end": "1504020"
  },
  {
    "text": "it through 100 it's done it for us right it's put the message through the key unfortunately we have to hop off the",
    "start": "1504020",
    "end": "1509900"
  },
  {
    "text": "queue and back on again one two three times extra but it's doing the work for",
    "start": "1509900",
    "end": "1515240"
  },
  {
    "text": "us so we prefer that rabbit and queue is a bit more interesting um",
    "start": "1515240",
    "end": "1522260"
  },
  {
    "text": "rabbit and Q has this notion of time to live what that means is for a given Q",
    "start": "1522260",
    "end": "1529340"
  },
  {
    "text": "and rabbit mq you can say messages in this queue live for 60 Seconds",
    "start": "1529340",
    "end": "1536240"
  },
  {
    "text": "after 60 seconds transfer them to this other queue and what we can do is not subscribe to",
    "start": "1536240",
    "end": "1542960"
  },
  {
    "text": "the original queue subscribe to the other queue and by putting it into the first queue we have a delay of 60",
    "start": "1542960",
    "end": "1548120"
  },
  {
    "text": "Seconds see how that works and that works pretty well so you can put it in a queue with a",
    "start": "1548120",
    "end": "1553940"
  },
  {
    "text": "600 second delay you can put it in a queue with 900 second delay you can put another q which is a 1500 and so forth",
    "start": "1553940",
    "end": "1561320"
  },
  {
    "text": "and so forth but you might be spotting the problem here you have to create a separate queue for each delay level",
    "start": "1561320",
    "end": "1568279"
  },
  {
    "text": "and sometimes one might be enough sometimes four might be enough sometimes you might have a lot more and the thing is that",
    "start": "1568279",
    "end": "1573919"
  },
  {
    "text": "the API is very very flexible I can basically write whatever I like into here right I can have thousands of",
    "start": "1573919",
    "end": "1579860"
  },
  {
    "text": "different delay levels if I want to I can be really evil right and write random.next",
    "start": "1579860",
    "end": "1585140"
  },
  {
    "text": "and multiply it by something you know whatever um and the last thing we want is people saying to us why isn't server but",
    "start": "1585140",
    "end": "1591559"
  },
  {
    "text": "service bus creating 10 000 cues in my broker and so well because you've got too many different delay levels use less",
    "start": "1591559",
    "end": "1598480"
  },
  {
    "text": "okay I think it might look for another solution um so we do need a better solution to this right because the API says you can",
    "start": "1598480",
    "end": "1605419"
  },
  {
    "text": "delay for any time of length length of time you want so let's take a simple example 42 seconds we love the number",
    "start": "1605419",
    "end": "1611779"
  },
  {
    "text": "42. uh but we know that the number 42 is",
    "start": "1611779",
    "end": "1617179"
  },
  {
    "text": "only written in that way with the digits four and two in a certain counting system right a certain number system",
    "start": "1617179",
    "end": "1623360"
  },
  {
    "text": "called decimal right or base 10 right that's how we write 42 seconds but we are computer programmers so we",
    "start": "1623360",
    "end": "1630679"
  },
  {
    "text": "know there are other ways of writing numbers we know about this binary system we can write this number as one hundred",
    "start": "1630679",
    "end": "1636559"
  },
  {
    "text": "and one thousand ten seconds in binary so what we can perhaps do is create a",
    "start": "1636559",
    "end": "1643039"
  },
  {
    "text": "queue for 32 seconds a key for 16 a q for eight a key for four two and one and",
    "start": "1643039",
    "end": "1649580"
  },
  {
    "text": "we can take our number 42 in decimal we can write that in binaries 1010",
    "start": "1649580",
    "end": "1654860"
  },
  {
    "text": "alongside those queues and then if we put it through the 32 second queue",
    "start": "1654860",
    "end": "1662299"
  },
  {
    "text": "skip the 16 put it through the eight skip the four pull it through the two",
    "start": "1662299",
    "end": "1668539"
  },
  {
    "text": "skip the one we've just simulated a 42 second delay",
    "start": "1668539",
    "end": "1674960"
  },
  {
    "text": "right 32 plus 8 plus 2. so we think that's we we like this solution we've",
    "start": "1674960",
    "end": "1681740"
  },
  {
    "text": "not seen anyone else do this right we kind of came up with this and thought this this might actually work",
    "start": "1681740",
    "end": "1686900"
  },
  {
    "text": "um it's a nice kind of fusion of basic computer science you know binary and a natural real world applications it works",
    "start": "1686900",
    "end": "1693200"
  },
  {
    "text": "pretty well um we actually use headers again to do this so you can put a header with the binary number into rabbit mq and you can",
    "start": "1693200",
    "end": "1701120"
  },
  {
    "text": "tell rabbit and Q I think we do it via regex we actually cite the rabbit and queue look at the binary number and if it's if that one's one put it in that",
    "start": "1701120",
    "end": "1707600"
  },
  {
    "text": "queue if that one's one put it in that queue et cetera Etc so it works pretty well uh we can't delays messages for that",
    "start": "1707600",
    "end": "1715880"
  },
  {
    "text": "long with these cues I mean if you've got these what is it six cues the maximum delays uh what is it 63 seconds",
    "start": "1715880",
    "end": "1723200"
  },
  {
    "text": "um not that useful so we actually have 28 cues that gives us a maximum possible layer",
    "start": "1723200",
    "end": "1729020"
  },
  {
    "text": "of 2 to 28 seconds or that many seconds or about eight and a half years which I think is enough for anyone",
    "start": "1729020",
    "end": "1735679"
  },
  {
    "text": "um why did we go with 28 well we first thought 25 because that will",
    "start": "1735679",
    "end": "1740779"
  },
  {
    "text": "give us just over a year and no one really thinks much in terms of more than a year in business",
    "start": "1740779",
    "end": "1745940"
  },
  {
    "text": "um 25 is odd so it's 26 is even so let's go for that and we thought well we think",
    "start": "1745940",
    "end": "1752000"
  },
  {
    "text": "that's enough let's just go one order of magnitude higher it's only one extra Q let's go to 27 and we thought no that's",
    "start": "1752000",
    "end": "1757820"
  },
  {
    "text": "odd let's make it 28 because that's even so we ended up on we ended up on 28.",
    "start": "1757820",
    "end": "1763340"
  },
  {
    "text": "um we were really tempted to go for 32 right we lost 32 but that would give us a maximum possible delay of 136 years uh",
    "start": "1763340",
    "end": "1771860"
  },
  {
    "text": "it I mean it'd be nice if someone's using a service bus in 136 years but it's a bit of a stretch of the",
    "start": "1771860",
    "end": "1777080"
  },
  {
    "text": "imagination but if anyone wants more than eight and a half years We'll add a 29th and probably add a 30th to make it even",
    "start": "1777080",
    "end": "1783020"
  },
  {
    "text": "you know whatever but it's more than enough for now um but you might be thinking well that's",
    "start": "1783020",
    "end": "1789559"
  },
  {
    "text": "all fine right we've figured out how we can do this and this nice consistent way but don't we just have the same problem all over again right isn't someone just",
    "start": "1789559",
    "end": "1796460"
  },
  {
    "text": "going to press the button at the same time right and they're both going to see the sum of 90 for the week total of 90. well",
    "start": "1796460",
    "end": "1803360"
  },
  {
    "text": "yes I mean I haven't stopped people from clicking the button at the same time by introducing sagas in the background",
    "start": "1803360",
    "end": "1809059"
  },
  {
    "text": "right it's gonna happen but remember that we are now looking at a single Row",
    "start": "1809059",
    "end": "1814640"
  },
  {
    "text": "in the database right a single row with customer ID week total",
    "start": "1814640",
    "end": "1821179"
  },
  {
    "text": "databases are exceedingly good at guaranteeing transactionality around a single row",
    "start": "1821179",
    "end": "1827360"
  },
  {
    "text": "but even with that what you have to make sure of is that if we look at this code what we're doing here is we are",
    "start": "1827360",
    "end": "1833960"
  },
  {
    "text": "retrieving that single row here and we are writing back that single row there right you only all you're doing is",
    "start": "1833960",
    "end": "1840799"
  },
  {
    "text": "adding things to property here but in the background when you persist that gets written into the database as that",
    "start": "1840799",
    "end": "1846860"
  },
  {
    "text": "single row we do not want that to happen and succeed without that bit there",
    "start": "1846860",
    "end": "1853340"
  },
  {
    "text": "succeeding right we do not want to send out the message to discount if we fail",
    "start": "1853340",
    "end": "1858500"
  },
  {
    "text": "to write the week total back because of concurrency because that means another order's done that at the same time we're",
    "start": "1858500",
    "end": "1863840"
  },
  {
    "text": "using them on discount level potentially right so all these three things have to either fail or they all have to succeed",
    "start": "1863840",
    "end": "1871640"
  },
  {
    "text": "right we want transactionality around the state of the Saga and sending",
    "start": "1871640",
    "end": "1877520"
  },
  {
    "text": "messages out of the Saga to do work right because those messages are only valid if that state is valid",
    "start": "1877520",
    "end": "1883399"
  },
  {
    "text": "so we need to wrap that in some kind of transaction now how we do this what actually happens",
    "start": "1883399",
    "end": "1889580"
  },
  {
    "text": "at runtime is we have these two sagas we have these two users clicking at the",
    "start": "1889580",
    "end": "1895340"
  },
  {
    "text": "same time so what happens is those messages may get handled at the same time right we do we do default to",
    "start": "1895340",
    "end": "1901700"
  },
  {
    "text": "multi-threading right so two messages can be handled at the same time by two instances in memory of the same Saga",
    "start": "1901700",
    "end": "1908659"
  },
  {
    "text": "they both have their handle methods called all that stuff happens that we've seen in the code and then they try and",
    "start": "1908659",
    "end": "1916159"
  },
  {
    "text": "write The Saga data down into the database right and the database as we said is very good at guaranteeing",
    "start": "1916159",
    "end": "1921860"
  },
  {
    "text": "transactionary transactionality around the single row it will allow one of them to go in",
    "start": "1921860",
    "end": "1927440"
  },
  {
    "text": "the messages will be sent from that one and that one will succeed here things will fail and the messages",
    "start": "1927440",
    "end": "1933559"
  },
  {
    "text": "will not be sent then what happens is that message will go back to the queue essentially that's",
    "start": "1933559",
    "end": "1940100"
  },
  {
    "text": "a failed message handling scenario it'll go back to the queue it will get retried",
    "start": "1940100",
    "end": "1945380"
  },
  {
    "text": "which and service bus does for you but otherwise you have to write that yourself it will get dispatched into",
    "start": "1945380",
    "end": "1950659"
  },
  {
    "text": "another instance of The Saga and memory and this time it will read the state",
    "start": "1950659",
    "end": "1955940"
  },
  {
    "text": "that was written by the other message and it will try and write back the news week total and the messages will be sent",
    "start": "1955940",
    "end": "1961340"
  },
  {
    "text": "and it will succeed how do we actually do that how do we actually guarantee that transactionality",
    "start": "1961340",
    "end": "1967340"
  },
  {
    "text": "well for some queuing systems and some databases you can just wrap the whole",
    "start": "1967340",
    "end": "1973279"
  },
  {
    "text": "thing in the distributed transaction right so if you're using something like msmq and SQL Server you can wrap those",
    "start": "1973279",
    "end": "1979520"
  },
  {
    "text": "things into simple transaction and Microsoft's infrastructure takes care of that for you like I said we don't really",
    "start": "1979520",
    "end": "1985159"
  },
  {
    "text": "encourage msmq anymore because Microsoft don't really support it anymore um so really that's a kind of",
    "start": "1985159",
    "end": "1990799"
  },
  {
    "text": "Disappearing scenario we need something else this is how we do it in and service bus",
    "start": "1990799",
    "end": "1996919"
  },
  {
    "text": "using the outbox pattern this is another entire talk in itself",
    "start": "1996919",
    "end": "2002260"
  },
  {
    "text": "if you want to know about that do follow this URL have a look at the outbox it describes an excruciating detail it",
    "start": "2002260",
    "end": "2010120"
  },
  {
    "text": "involves writing something to the database and then trying to figure out if messages has been dispatched it's",
    "start": "2010120",
    "end": "2016539"
  },
  {
    "text": "every time I re I actually actually wrote a lot of this article but I still have to go back and kind of remind",
    "start": "2016539",
    "end": "2021700"
  },
  {
    "text": "myself how does it work again but it's been in production for ages and ages and ages and a lot of systems and it does",
    "start": "2021700",
    "end": "2027940"
  },
  {
    "text": "work so we use this outbox to guarantee that transactionality between queuing",
    "start": "2027940",
    "end": "2033279"
  },
  {
    "text": "systems databases which don't naturally have it right it's very very important that that's consistent",
    "start": "2033279",
    "end": "2040080"
  },
  {
    "text": "and the great thing is that these sagas live in that code they live in your nice",
    "start": "2041559",
    "end": "2048040"
  },
  {
    "text": "DDD tdd you know whatever your methodology you're using it sits alongside the rest of your code it's not",
    "start": "2048040",
    "end": "2054398"
  },
  {
    "text": "some batch job that's plugged in on the other side it is actually something that lives in your code and it's highly",
    "start": "2054399",
    "end": "2060280"
  },
  {
    "text": "testable we actually provide a we actually provide a testable",
    "start": "2060280",
    "end": "2066158"
  },
  {
    "text": "message Handler context in another package so when you're unit testing you can pass that in you can you can pass in",
    "start": "2066159",
    "end": "2072878"
  },
  {
    "text": "a whole load of messages and then you can look at that context and see what messages were sent out",
    "start": "2072879",
    "end": "2077980"
  },
  {
    "text": "right so they're very very highly testable so we're on the way to killing the batch",
    "start": "2077980",
    "end": "2083919"
  },
  {
    "text": "job if you want to see more about that do go to this blog post best of the batch job we are on a particular",
    "start": "2083919",
    "end": "2090580"
  },
  {
    "text": "software kind of on a on a little bit of a mission to try and kill the batch job because we've seen it use so",
    "start": "2090580",
    "end": "2096158"
  },
  {
    "text": "inappropriately in so many circumstances where other methods are much more useful",
    "start": "2096159",
    "end": "2102700"
  },
  {
    "text": "but you may have you maybe you may be thinking that that the scenario I've",
    "start": "2102700",
    "end": "2108280"
  },
  {
    "text": "just escrow I've just described okay yes we can remove the batch job in favor of something else in that scenario but you",
    "start": "2108280",
    "end": "2114460"
  },
  {
    "text": "might be thinking well I have this other scenario in my system where a batch job is just totally the right answer this",
    "start": "2114460",
    "end": "2120760"
  },
  {
    "text": "totally makes sense to be a batch job and one of the areas I've seen this in",
    "start": "2120760",
    "end": "2125920"
  },
  {
    "text": "my career is in is in reports right has anyone work here with a system which produces any kind of report anything",
    "start": "2125920",
    "end": "2131200"
  },
  {
    "text": "yeah that's that's actually probably about 80 of you so I've worked in systems which have produced overnight",
    "start": "2131200",
    "end": "2137440"
  },
  {
    "text": "reports and they've they've sometimes I mean this is",
    "start": "2137440",
    "end": "2142599"
  },
  {
    "text": "a good indicator right if you're doing really well business is booming you're getting loads of orders these reports",
    "start": "2142599",
    "end": "2148359"
  },
  {
    "text": "are getting more and more expensive to produce that's good in a way but I've been in situations where it runs",
    "start": "2148359",
    "end": "2154540"
  },
  {
    "text": "overnight and starts to finish around lunchtime the next day and it's kind of pretty I see a few",
    "start": "2154540",
    "end": "2159579"
  },
  {
    "text": "nodding head see I see other people have seen this and and it starts to creep right and I remember we we kind of like",
    "start": "2159579",
    "end": "2165700"
  },
  {
    "text": "had a side bet on how long it's going to be before it takes until the end of the next day for the batch job to run and",
    "start": "2165700",
    "end": "2172180"
  },
  {
    "text": "you know it was uh it was a bit it was it was pretty scary because the business were finding them it's a very difficult",
    "start": "2172180",
    "end": "2177700"
  },
  {
    "text": "to actually do their jobs getting the reports that late um another course you open an office in Singapore and you open an office in New",
    "start": "2177700",
    "end": "2183820"
  },
  {
    "text": "York and San Francisco and you don't have any night anymore so it's kind of a bit of a problem but the thing is reports are interesting",
    "start": "2183820",
    "end": "2189760"
  },
  {
    "text": "because they tend to be required at a certain time during the day so let's take a let's take a banking scenario for",
    "start": "2189760",
    "end": "2196900"
  },
  {
    "text": "example the user might say well okay here's my requirement I need a report at 9 30",
    "start": "2196900",
    "end": "2202839"
  },
  {
    "text": "every day of all the transactions in the last week of a certain size I want to see the",
    "start": "2202839",
    "end": "2209980"
  },
  {
    "text": "customers against those transactions group them by custom for me that would be useful and I want to see in which",
    "start": "2209980",
    "end": "2215500"
  },
  {
    "text": "location they are I want to see in which country they are and and you say okay that's interesting",
    "start": "2215500",
    "end": "2220660"
  },
  {
    "text": "what are you going to do with that information by the way uh is that well I'm going to look through them and if I see three large transactions in a",
    "start": "2220660",
    "end": "2226960"
  },
  {
    "text": "high-risk country for a given customer I'm going to tell my manager and start a fraud investigation because we think that's like a little bit dodgy",
    "start": "2226960",
    "end": "2234839"
  },
  {
    "text": "that is not a requirement that is a workaround",
    "start": "2234839",
    "end": "2241599"
  },
  {
    "text": "they know that we store the transactions in the database right the account transactions and I know that if they",
    "start": "2241599",
    "end": "2248079"
  },
  {
    "text": "look at them they can figure out using the data in there if there's possible fraud",
    "start": "2248079",
    "end": "2253119"
  },
  {
    "text": "but the actual requirement is if there are three large transactions in",
    "start": "2253119",
    "end": "2259359"
  },
  {
    "text": "a high-risk country for a given customer in the last week I want to know about it",
    "start": "2259359",
    "end": "2265420"
  },
  {
    "text": "that's the requirement right forget about how the system currently works in your knowledge of it give me the",
    "start": "2265420",
    "end": "2270460"
  },
  {
    "text": "requirement that allows us to do other things we can go in and say well I'm going to do some",
    "start": "2270460",
    "end": "2276400"
  },
  {
    "text": "kind of automated pattern matching right I'm going to when I'm going to create a saga and when that Saga",
    "start": "2276400",
    "end": "2283839"
  },
  {
    "text": "receives a transaction occurred event or something or some kind of message",
    "start": "2283839",
    "end": "2288940"
  },
  {
    "text": "I'm going to look at that and I'm going to say first of all is this a large transaction right",
    "start": "2288940",
    "end": "2294640"
  },
  {
    "text": "remember that thing I said about ubiquitous language starting to get enriched again you've just learned there's such a thing as a",
    "start": "2294640",
    "end": "2300460"
  },
  {
    "text": "large transaction right like more than ten thousand pounds or something I'm going to look at high risk countries",
    "start": "2300460",
    "end": "2306579"
  },
  {
    "text": "right again you've learned there's this thing called high-risk country you can actually now see highest country as a",
    "start": "2306579",
    "end": "2313359"
  },
  {
    "text": "variable name in your code right you're you're getting deeper insight into the business problem here",
    "start": "2313359",
    "end": "2318579"
  },
  {
    "text": "I want to know if there's been three of them in the last week so similar to what we did before",
    "start": "2318579",
    "end": "2324940"
  },
  {
    "text": "we can receive a transaction occurred message we can say is it high risk and",
    "start": "2324940",
    "end": "2331420"
  },
  {
    "text": "then is it large and in the highest country yes add it to my current",
    "start": "2331420",
    "end": "2337240"
  },
  {
    "text": "possible fraudulent transactions collection right on my Saga state",
    "start": "2337240",
    "end": "2342760"
  },
  {
    "text": "send myself a message in a week's time to remove that transaction from my current",
    "start": "2342760",
    "end": "2349720"
  },
  {
    "text": "possible fraudid in transactions and in exactly the same way as a week total we've created the sliding window",
    "start": "2349720",
    "end": "2355720"
  },
  {
    "text": "of for the current week what is the collection of current possible",
    "start": "2355720",
    "end": "2361780"
  },
  {
    "text": "fraudulent transactions right anytime I receive one of those messages if I've already got two of them",
    "start": "2361780",
    "end": "2368859"
  },
  {
    "text": "and this one is also a large transaction in the highest country I've got three right alarm Bell email the user",
    "start": "2368859",
    "end": "2375880"
  },
  {
    "text": "if you tell the user and they get a notification they go to their manager and imagine this is like and this is",
    "start": "2375880",
    "end": "2382359"
  },
  {
    "text": "kind of mind-blowing right because it's real time business information right you say to the manager",
    "start": "2382359",
    "end": "2388660"
  },
  {
    "text": "yeah I've got high risk I've got a high risk situation here I think we need to investigate some fraud here and the",
    "start": "2388660",
    "end": "2395560"
  },
  {
    "text": "managers assessed to you but hang on a minute hang on it's six it's 4 30 in the afternoon you get that report at 9 30.",
    "start": "2395560",
    "end": "2402280"
  },
  {
    "text": "why the hell is it taking you seven hours to tell me about this this is ridiculous like step up your game here",
    "start": "2402280",
    "end": "2408160"
  },
  {
    "text": "and say no no no this transaction occurred in the last two minutes and say what",
    "start": "2408160",
    "end": "2413380"
  },
  {
    "text": "but hang on a minute how do we know and said oh yeah assistant told me it's like yeah you know that you know that Saga",
    "start": "2413380",
    "end": "2419260"
  },
  {
    "text": "thing the developers were talking about a few weeks ago yeah they implemented that they they released a new version of the system and that just tells us and",
    "start": "2419260",
    "end": "2425440"
  },
  {
    "text": "this is mind-blowing the manager is like oh my God so we've got real-time business information here right and so well how do I okay I want more of these",
    "start": "2425440",
    "end": "2432099"
  },
  {
    "text": "sagas how do I get them right where do I sign up and what you have What's Happening Here is this is actually translating into",
    "start": "2432099",
    "end": "2438099"
  },
  {
    "text": "real this actually does translate into real business value right this is money we're talking about here we are now",
    "start": "2438099",
    "end": "2443800"
  },
  {
    "text": "reacting real time right we've prevented a possible 24 hours of possible for for different transactions right you're",
    "start": "2443800",
    "end": "2450940"
  },
  {
    "text": "turning them to a profit center right your system is turning into a profit Center by adding this real-time",
    "start": "2450940",
    "end": "2456099"
  },
  {
    "text": "information so I'm coming towards the end now and",
    "start": "2456099",
    "end": "2462220"
  },
  {
    "text": "I've actually raced through that but I'm sure you're going to be happy to get to lunch a little bit early um if you want to know more about",
    "start": "2462220",
    "end": "2468540"
  },
  {
    "text": "long-running processes uh sagas uh stateful message handling that kind of",
    "start": "2468540",
    "end": "2474220"
  },
  {
    "text": "thing I've actually prepared a set of videos for you here so if you follow this URL uh ndc-london batch",
    "start": "2474220",
    "end": "2483359"
  },
  {
    "text": "go.poticular.net do take a photo of that um that's a set of videos by our company",
    "start": "2483359",
    "end": "2490300"
  },
  {
    "text": "CEO a guy called Udi Dahan who you may have heard of it's actually a five-day course that he runs and I just prepared",
    "start": "2490300",
    "end": "2497380"
  },
  {
    "text": "a extract from that so that's completely free go and register go and have a look there and grab your free videos",
    "start": "2497380",
    "end": "2505540"
  },
  {
    "text": "uh I hope you've enjoyed this um what I've tried to do here is show you a program model which Embraces time a",
    "start": "2505540",
    "end": "2512680"
  },
  {
    "text": "program model which allows you to enrich your it encourages you to enrich your ubiquitous language if you're into DDD I",
    "start": "2512680",
    "end": "2520359"
  },
  {
    "text": "said that so sagas are actually uh if you're interested you've heard of aggregate roots so a saga is actually a",
    "start": "2520359",
    "end": "2527980"
  },
  {
    "text": "very good aggregate route right in fact it's actually just a very good object if you've ever read anything by Alan Kaye",
    "start": "2527980",
    "end": "2534460"
  },
  {
    "text": "who talks about object-oriented programming in the early days he never talked about polymorphism and",
    "start": "2534460",
    "end": "2539859"
  },
  {
    "text": "inheritance and that kind of stuff what he actually talked about was an object being something that receives a message",
    "start": "2539859",
    "end": "2546780"
  },
  {
    "text": "encapsulates State and business logic and send a message out right that's the",
    "start": "2546780",
    "end": "2552579"
  },
  {
    "text": "essence of what he described as an object so sagas are actually very very good objects",
    "start": "2552579",
    "end": "2558119"
  },
  {
    "text": "anyone here into tdd and all that tdd that's probably slightly less than half of you tdd tends",
    "start": "2558119",
    "end": "2564820"
  },
  {
    "text": "to be one of those kind of love hate things I bet the people who didn't put their hands up hate it",
    "start": "2564820",
    "end": "2570000"
  },
  {
    "text": "I've kind of like swung between between the two kind of opinions a little bit",
    "start": "2570000",
    "end": "2575020"
  },
  {
    "text": "myself during my career I think one of the problems with tdd is that we don't often have very good units",
    "start": "2575020",
    "end": "2580900"
  },
  {
    "text": "to test but a saga is actually a very very very good unit to test right I can just show",
    "start": "2580900",
    "end": "2586599"
  },
  {
    "text": "you I've got some time left so I can actually show you um that test uh framework that I told you about",
    "start": "2586599",
    "end": "2595060"
  },
  {
    "text": "um I've got a test here right so what I'm doing here is I'm just I've written a test called 10",
    "start": "2595060",
    "end": "2601240"
  },
  {
    "text": "discount uh I'm creating let's just get rid of this oops",
    "start": "2601240",
    "end": "2608020"
  },
  {
    "text": "let's get rid of that so I'm basically simulating a new saga so",
    "start": "2608020",
    "end": "2613240"
  },
  {
    "text": "I'm saying I'm going to create a new saga class because remember it's just a just a class right I can just create one",
    "start": "2613240",
    "end": "2619619"
  },
  {
    "text": "I do need to pass the the current state into it which is just a new discounting",
    "start": "2619619",
    "end": "2625480"
  },
  {
    "text": "data right with nothing in it so everything's going to be initialized to zero I then grab I then take four submit",
    "start": "2625480",
    "end": "2632859"
  },
  {
    "text": "order messages and of course I'm emitting properties and things like that which was which",
    "start": "2632859",
    "end": "2638260"
  },
  {
    "text": "would normally exist one for 60 one for 60 another one with 10 other for 20. then I create this",
    "start": "2638260",
    "end": "2644020"
  },
  {
    "text": "testable message Handler context and this is the thing we apply we Supply as a special testing",
    "start": "2644020",
    "end": "2650940"
  },
  {
    "text": "harness for sagas I can call my handle method with a first",
    "start": "2650940",
    "end": "2656319"
  },
  {
    "text": "order passing that context in and then I can look at sent messages",
    "start": "2656319",
    "end": "2662619"
  },
  {
    "text": "right so I can see within that handle method that the context was passed into what messages were sent from within that",
    "start": "2662619",
    "end": "2670359"
  },
  {
    "text": "handle method and obviously I want a discount level of zero",
    "start": "2670359",
    "end": "2675819"
  },
  {
    "text": "for that first message for that first order because the current discount that current week total is zero",
    "start": "2675819",
    "end": "2682720"
  },
  {
    "text": "now the week total should be 60 right because the total of that first order was 60.",
    "start": "2682720",
    "end": "2688180"
  },
  {
    "text": "when I receive the second message which is again a 60 I should still have a discount of zero right so the discount",
    "start": "2688180",
    "end": "2695020"
  },
  {
    "text": "should have been uh zero for that second order the week total is now 120.",
    "start": "2695020",
    "end": "2701680"
  },
  {
    "text": "when I receive the third order I want to have a discount of 10",
    "start": "2701680",
    "end": "2707319"
  },
  {
    "text": "because the current week total is greater than 100 right it's 120. the wheat total is now 130 but we're",
    "start": "2707319",
    "end": "2714880"
  },
  {
    "text": "going to pretend that a week has passed since order one so we're going to handle a timeout of",
    "start": "2714880",
    "end": "2721300"
  },
  {
    "text": "order one and now we we should see the week total",
    "start": "2721300",
    "end": "2726520"
  },
  {
    "text": "drop by 60 down to 70. we handle the fourth order and we should have a we should have a discount of zero",
    "start": "2726520",
    "end": "2733480"
  },
  {
    "text": "right and we can look at the we can look at the data and things like that to make sure other things happening but this is",
    "start": "2733480",
    "end": "2738940"
  },
  {
    "text": "just this is showing you how to test that one aspect of this counting level being correct and you and this is a very",
    "start": "2738940",
    "end": "2744339"
  },
  {
    "text": "simple example you can have sagas which handle many different types of messages and the",
    "start": "2744339",
    "end": "2749680"
  },
  {
    "text": "the logic inside this handle methods is much more complex but you can kind of test you can actually write good unit tests against all of this and I do",
    "start": "2749680",
    "end": "2756819"
  },
  {
    "text": "recommend this right I do recommend testing sagas especially with the aspect of time because you don't want to be",
    "start": "2756819",
    "end": "2763540"
  },
  {
    "text": "kind of writing a test which lasts a week right you want a nice way to simulate that and you don't really want to have to like sit",
    "start": "2763540",
    "end": "2769660"
  },
  {
    "text": "um Advance the system clock and stuff like that it's much nicer if you can just pretend in your code a week's past",
    "start": "2769660",
    "end": "2775000"
  },
  {
    "text": "I would just say timeouts there so let's switch back to the slides",
    "start": "2775000",
    "end": "2784440"
  },
  {
    "text": "yes so uh as we've seen a lot of these problems",
    "start": "2785140",
    "end": "2791560"
  },
  {
    "text": "do root from being given workarounds instead of requirements so do try and",
    "start": "2791560",
    "end": "2797079"
  },
  {
    "text": "push past those workarounds and look to the actual requirements if you see if you if you hear someone telling you how",
    "start": "2797079",
    "end": "2804280"
  },
  {
    "text": "a requirement in terms of how the system works that's an alarm Bell right you want to be able to talk to The Domain",
    "start": "2804280",
    "end": "2810220"
  },
  {
    "text": "experts who can kind of like release themselves from that business analysts are sometimes a bit of a problem with",
    "start": "2810220",
    "end": "2816760"
  },
  {
    "text": "that because they're kind of like um some people call them proxy domain experts or things like that they kind of",
    "start": "2816760",
    "end": "2821859"
  },
  {
    "text": "tend to have one leg in the system on one leg in the business and they can't help themselves but think about how the",
    "start": "2821859",
    "end": "2827500"
  },
  {
    "text": "business works when they're trying to interpret a business requirement so just watch out for that right try and get",
    "start": "2827500",
    "end": "2832960"
  },
  {
    "text": "past those workarounds talk to the business try and get requirements in pure business terms forgetting about how",
    "start": "2832960",
    "end": "2840040"
  },
  {
    "text": "the system works right because that's your job you're the best people you're the people that best place to figure out",
    "start": "2840040",
    "end": "2845200"
  },
  {
    "text": "how a system can make that business requirement happen um it kind of does stem from some",
    "start": "2845200",
    "end": "2850599"
  },
  {
    "text": "organizational problems you know a lot of organ a lot of problems we do have as developers are organizational and",
    "start": "2850599",
    "end": "2855640"
  },
  {
    "text": "they're not actually that often often that technical so it's just something to watch out for but that's another talk in",
    "start": "2855640",
    "end": "2862000"
  },
  {
    "text": "itself uh we've gone through that very quickly so does anyone have any questions here",
    "start": "2862000",
    "end": "2867400"
  },
  {
    "text": "because we've got 10 minutes left so we're going to maybe a couple of minutes if anyone's got any questions yeah",
    "start": "2867400",
    "end": "2873359"
  },
  {
    "text": "what if you go for a weekly discount you have to actually rerun your build a",
    "start": "2885720",
    "end": "2892300"
  },
  {
    "text": "battery which will run and we compute all the cycles and in that there's some trade-offs comparing to initial approach",
    "start": "2892300",
    "end": "2898900"
  },
  {
    "text": "where you do compute place of course you still have this concurrency problem but as you said",
    "start": "2898900",
    "end": "2905560"
  },
  {
    "text": "yourself you have database which are extremely good in solving control problem so so what do you think about",
    "start": "2905560",
    "end": "2911980"
  },
  {
    "text": "like if that becomes a trade-off that rules uh really sort of organization",
    "start": "2911980",
    "end": "2917740"
  },
  {
    "text": "wants to have rules changeable in that sense right okay so I'll try and I'll try and sort of paraphrase your question",
    "start": "2917740",
    "end": "2922960"
  },
  {
    "text": "into saying that we've looked at an example where we have this discounting",
    "start": "2922960",
    "end": "2928180"
  },
  {
    "text": "thing in a week total which is very easy to think about but this this the the the thing that you're seeing is possibly",
    "start": "2928180",
    "end": "2933280"
  },
  {
    "text": "problematic is this fixed weak window and the business might come along and say and it's a very good question actually the business might come along",
    "start": "2933280",
    "end": "2939640"
  },
  {
    "text": "and say yeah that thing we're doing for a week we want to extend that to two weeks now in that case you you do have to take",
    "start": "2939640",
    "end": "2948339"
  },
  {
    "text": "some action some initial action to change two two weeks the thing is that your timeouts are still going to be in",
    "start": "2948339",
    "end": "2954940"
  },
  {
    "text": "there right they're still going to be being delivered in a week's time but what you can do is this comes down to",
    "start": "2954940",
    "end": "2960160"
  },
  {
    "text": "versioning you can erase a new version of your Saga which just ignores the week timeouts right it just ignores those",
    "start": "2960160",
    "end": "2966099"
  },
  {
    "text": "original messages because ultimately they're just messages that are going to sit there and we don't need them anymore",
    "start": "2966099",
    "end": "2971440"
  },
  {
    "text": "right but you will have to do some kind of initial migration to say well we're",
    "start": "2971440",
    "end": "2977020"
  },
  {
    "text": "now going to set up we're going to look at the orders but the thing is it's it's a it's a release time thing it's not a",
    "start": "2977020",
    "end": "2983800"
  },
  {
    "text": "it's not a runtime thing so as part of the deployment of that new version yes",
    "start": "2983800",
    "end": "2989319"
  },
  {
    "text": "it will involve a migration right so I'm not saying this is a way of getting rid of data migrations it isn't and that's",
    "start": "2989319",
    "end": "2994900"
  },
  {
    "text": "going to be required in some cases if you turns out that things are going to be a lot more flexible and kind of",
    "start": "2994900",
    "end": "3000780"
  },
  {
    "text": "levels of discounts are changing for a customer depending on other factors as they go through a lifetime you're going",
    "start": "3000780",
    "end": "3007319"
  },
  {
    "text": "to have to do something more complicated um this isn't a golden Hammer right it's",
    "start": "3007319",
    "end": "3013859"
  },
  {
    "text": "not a silver bullet so for those complicated situations you may have to look to something else but it's a good",
    "start": "3013859",
    "end": "3019260"
  },
  {
    "text": "point I think it depends on the level of variability and sometimes and actually",
    "start": "3019260",
    "end": "3024420"
  },
  {
    "text": "this is a good thing to to talk about if anyone's here if anyone who is involved in a sometimes startup or",
    "start": "3024420",
    "end": "3031020"
  },
  {
    "text": "anything like that you don't really know what your business rules are yet right so doing things like this is can be",
    "start": "3031020",
    "end": "3037800"
  },
  {
    "text": "quite expensive right because you have to you have to do in the invest in modeling and looking at things correctly if you're in a kind of startup situation",
    "start": "3037800",
    "end": "3044819"
  },
  {
    "text": "and you're starting to find out what the best way to do things is and what the best way to retain customers is just",
    "start": "3044819",
    "end": "3050640"
  },
  {
    "text": "write any old code because you come when you discover what your business is you're probably going to rewrite it",
    "start": "3050640",
    "end": "3056040"
  },
  {
    "text": "anyway right so don't invest too much of that and then in the early Discovery parts of your business this is very good for much",
    "start": "3056040",
    "end": "3062760"
  },
  {
    "text": "more stable business rules which have evolved through a stable mature business that knows how things are going to work",
    "start": "3062760",
    "end": "3068579"
  },
  {
    "text": "but you know even still you can have varying degrees of level of change I hope that kind of answers the question the sort of thing we could talk about",
    "start": "3068579",
    "end": "3075000"
  },
  {
    "text": "for for hours potentially anyone else yes",
    "start": "3075000",
    "end": "3080780"
  },
  {
    "text": "infrastructure and standard information",
    "start": "3085619",
    "end": "3093380"
  },
  {
    "text": "okay so monthly Finance reporting possibly",
    "start": "3094500",
    "end": "3102240"
  },
  {
    "text": "like monthly invoice sending and things like that well the interesting thing is about that is um",
    "start": "3102240",
    "end": "3109440"
  },
  {
    "text": "the monthly invoice sending in particular is very interesting because I I wonder why the business is sending",
    "start": "3109440",
    "end": "3116460"
  },
  {
    "text": "monthly invoices at a certain set period why isn't it sending an invoice at the time the order is made dynamically as",
    "start": "3116460",
    "end": "3122520"
  },
  {
    "text": "the orders come in it sounds like something that's been designed within the constraints of the current system",
    "start": "3122520",
    "end": "3128220"
  },
  {
    "text": "so it's almost like a backdrop is almost self-serving in that scenario I mean obviously there's more context I'm probably missing",
    "start": "3128220",
    "end": "3134579"
  },
  {
    "text": "but mm-hmm oh so our other accounting parties might",
    "start": "3134579",
    "end": "3139619"
  },
  {
    "text": "might expect something at a certain time of the month um that's interesting you could",
    "start": "3139619",
    "end": "3145140"
  },
  {
    "text": "potentially when an order comes in send a message to send this invoice on a",
    "start": "3145140",
    "end": "3150180"
  },
  {
    "text": "specific day obviously you're going to get like a like a kind of like crunch of messages coming at the same time on that",
    "start": "3150180",
    "end": "3155220"
  },
  {
    "text": "date to say send you know a whole load of different invoices um so that might that might be",
    "start": "3155220",
    "end": "3162000"
  },
  {
    "text": "problematic obviously if your if your system is at such a stage where you've got so many of these customers which is",
    "start": "3162000",
    "end": "3168480"
  },
  {
    "text": "good right you've got loads of business that you you're finding it incredibly difficult to make your system send out all those invoices on that one day",
    "start": "3168480",
    "end": "3175680"
  },
  {
    "text": "um this is a trap that's very easy to fall into don't necessarily try and solve",
    "start": "3175680",
    "end": "3180960"
  },
  {
    "text": "that technically speak to the business so you know we've got our business has grown ten thousand percent in the last",
    "start": "3180960",
    "end": "3187380"
  },
  {
    "text": "couple of years we've got so many invoices sent out in a month can you not talk to the customers and say can you be",
    "start": "3187380",
    "end": "3193140"
  },
  {
    "text": "a bit flexible about this put half of them in the middle of the month and I'll say yeah sure we can work that out don't assume that that's a fixed thing talk to",
    "start": "3193140",
    "end": "3200579"
  },
  {
    "text": "the business right because so much can be can be sold by talking to the business and working out something different",
    "start": "3200579",
    "end": "3206220"
  },
  {
    "text": "this is also a very good General thing to always bear in mind but if you want to talk about that more",
    "start": "3206220",
    "end": "3211319"
  },
  {
    "text": "please come and grab me after so how are we doing for time uh yeah we're a few minutes before lunch so I'll",
    "start": "3211319",
    "end": "3218099"
  },
  {
    "text": "let you go now so you can get to the head of that queue I hope you've enjoyed that do come and grab me if you've seen me ask me about the stuff",
    "start": "3218099",
    "end": "3224040"
  },
  {
    "text": "thank you very much [Applause]",
    "start": "3224040",
    "end": "3232659"
  }
]