[
  {
    "text": "so I'm here today to talk about kind of a little journey that I've been on for the last four years or so now and I'm",
    "start": "4900",
    "end": "13240"
  },
  {
    "text": "gonna start right back at the beginning so around four years ago I I was doing some research and I wanted to keep myself up to speed on kind of latest",
    "start": "13240",
    "end": "20320"
  },
  {
    "text": "security standards new browser features and I came across this idea this concept where instead of the browser just being",
    "start": "20320",
    "end": "26439"
  },
  {
    "text": "something that you render a website into and the user look today the browser could actually call back home to you and",
    "start": "26439",
    "end": "32349"
  },
  {
    "text": "tell you when things went wrong on the page if the user saw error messages if things weren't working properly I",
    "start": "32349",
    "end": "37660"
  },
  {
    "text": "thought wow this is amazing like instead of just sending the page off to the browser and saying you know that's it",
    "start": "37660",
    "end": "43329"
  },
  {
    "text": "remember the page show it to the user we actually start to get this kind of active feedback loop from the browser I was like this is great I really want to",
    "start": "43329",
    "end": "50230"
  },
  {
    "text": "enable this on my blog I want to put this on my website so I spent a good five minutes looking on Google for a service that did this and none existed",
    "start": "50230",
    "end": "56800"
  },
  {
    "text": "and if you spend five minutes looking for something on Google and don't find it it definitely doesn't exist so I was like I'm gonna build this tool so I",
    "start": "56800",
    "end": "63579"
  },
  {
    "text": "don't software engineering at university but I'd always used it as kind of a hobbyist thing so I started up another little side projects I'm sure many of",
    "start": "63579",
    "end": "69880"
  },
  {
    "text": "you have a hundred little side projects at home like I do and I started a little side project called report URI and it",
    "start": "69880",
    "end": "76690"
  },
  {
    "text": "was a service that was designed to hook into these reporting features on the browser to start giving me this feedback",
    "start": "76690",
    "end": "82300"
  },
  {
    "text": "so four years ago I started building it it was about three years ago when I launched the first version and nowadays",
    "start": "82300",
    "end": "89200"
  },
  {
    "text": "we're processing in the region of close to about 10 billion reports a month so it's gone from quite literally a small",
    "start": "89200",
    "end": "95950"
  },
  {
    "text": "side project where we literally in our first month in just over 10,000 reports to now we have months when we regularly",
    "start": "95950",
    "end": "102490"
  },
  {
    "text": "hit that per second and this was just a side project there was no plan you know that I didn't have like grand visions so",
    "start": "102490",
    "end": "108700"
  },
  {
    "text": "I've had to learn a lot of lessons along the way to scale that I want to kind of go through those today and hope that I",
    "start": "108700",
    "end": "114310"
  },
  {
    "text": "can share some of the value from now so these reports themselves they actually come from all mainstream browsers pretty",
    "start": "114310",
    "end": "120760"
  },
  {
    "text": "much any modern browser that you have on your device is capable of giving you this feedback and we'll talk about some",
    "start": "120760",
    "end": "126190"
  },
  {
    "text": "of the feedback it can give you and how as well but the number one thing that we kind of accept reports for is something",
    "start": "126190",
    "end": "133329"
  },
  {
    "text": "called content security policy so you may have seen me talk about this I have plenty of blogs and information",
    "start": "133329",
    "end": "138950"
  },
  {
    "text": "and material online but when you enable one of these features on your website you deliver the policy as a HTTP",
    "start": "138950",
    "end": "146090"
  },
  {
    "text": "response header so you have your webpage you have the other headers here that you may be familiar with date server status",
    "start": "146090",
    "end": "151430"
  },
  {
    "text": "things like that you set the content security policy header on your website and in the value of the header that you",
    "start": "151430",
    "end": "156860"
  },
  {
    "text": "send out you put the policy you want to enforcing and a policy might look something kind of like this",
    "start": "156860",
    "end": "162530"
  },
  {
    "text": "so with CSP what you do is you tell the browser what things it's allowed to load in the page what things it's allowed to",
    "start": "162530",
    "end": "168410"
  },
  {
    "text": "do so here for example we have the script source I'm telling the browser it's only allow to load scripts from",
    "start": "168410",
    "end": "174200"
  },
  {
    "text": "self which means my own domain and from this other domain my CDN I'm also telling you can only load styles from",
    "start": "174200",
    "end": "180860"
  },
  {
    "text": "that location images can only be loaded from my own site an imager and the browser now knows this page is only",
    "start": "180860",
    "end": "187549"
  },
  {
    "text": "supposed to use resources from these locations and even the farm actual ones really cool if you've not seen that you",
    "start": "187549",
    "end": "193730"
  },
  {
    "text": "can control where the browser's allowed to send forms to so it's not just about fetching resources it's also about actions that the browser can take now",
    "start": "193730",
    "end": "201920"
  },
  {
    "text": "you deliver this policy and the browser will enforce it it will make sure that your page doesn't do anything unexpected",
    "start": "201920",
    "end": "207019"
  },
  {
    "text": "anything bad and if something does happen like that the browser will actually step in and take action to",
    "start": "207019",
    "end": "212870"
  },
  {
    "text": "prevent it so it will block images from loading if the domain isn't whitelisted if a forum is trying to post data to an",
    "start": "212870",
    "end": "218450"
  },
  {
    "text": "end point that's not whitelist that the browser will prevent that but we need the feedback so you specify the last line",
    "start": "218450",
    "end": "224750"
  },
  {
    "text": "here which is the report URI directive and if you specify this directive you",
    "start": "224750",
    "end": "229940"
  },
  {
    "text": "give the browser an end point where it should report back to and every time a violation occurs every time the browser",
    "start": "229940",
    "end": "235220"
  },
  {
    "text": "takes action to protect someone or prevent something from happening it will send you HTTP POST request with a JSON",
    "start": "235220",
    "end": "242540"
  },
  {
    "text": "payload that looks a little bit like this so you can set up an endpoint to receive this payload in and this is what",
    "start": "242540",
    "end": "248870"
  },
  {
    "text": "we do we accept these payloads from visitors browsers and it contains all the information that you need to",
    "start": "248870",
    "end": "254450"
  },
  {
    "text": "identify what the problem is and to go fix it so we can see here the document URI I know this happened this violation",
    "start": "254450",
    "end": "260989"
  },
  {
    "text": "occurred on the home page for my website the violated directive tells me it was a",
    "start": "260989",
    "end": "266000"
  },
  {
    "text": "script source and it provides the snippet of the policy that was violated the original policy you always",
    "start": "266000",
    "end": "271370"
  },
  {
    "text": "that's you can see what was the brows are actually taking action on so you have a reference point and then the",
    "start": "271370",
    "end": "276860"
  },
  {
    "text": "really important one is well the blocked URI so this is telling me you had this thing on your page and in this case it",
    "start": "276860",
    "end": "282949"
  },
  {
    "text": "was a script file called key logger Jes loading from evil calm but evil.com wasn't in the script source directive",
    "start": "282949",
    "end": "289790"
  },
  {
    "text": "you can see a few lines up so I've told the browser script should only be loaded from these locations on my sunny",
    "start": "289790",
    "end": "297430"
  },
  {
    "text": "microphone the browser has identified one that has been loaded from a different domain and his block style",
    "start": "297430",
    "end": "303889"
  },
  {
    "text": "which is good because this would protect the user in this case but then I wouldn't know is the host so the",
    "start": "303889",
    "end": "309560"
  },
  {
    "text": "browser's actually sent me this report back we can ingest it we can look at the information and now go fix the underlying problem as well and it's not",
    "start": "309560",
    "end": "317570"
  },
  {
    "text": "just content security policy and things like this the browser can report on there's a whole bunch of additional",
    "start": "317570",
    "end": "322789"
  },
  {
    "text": "features inside the browser where you can actually ask it to send you reports when things go wrong just plain things",
    "start": "322789",
    "end": "327949"
  },
  {
    "text": "like the user sees an error message and can't load the site most of the time you probably find out on Twitter or maybe",
    "start": "327949",
    "end": "333139"
  },
  {
    "text": "via an email or a support ticket but what if the user hits an error and can't do something and then the browser just",
    "start": "333139",
    "end": "338570"
  },
  {
    "text": "calls home and tells you so you don't have to wait for the support ticket or the email office horn to tweet a",
    "start": "338570",
    "end": "343639"
  },
  {
    "text": "screenshot of your broken website it can actually get back in touch about a whole bunch of different things so CSP is",
    "start": "343639",
    "end": "349789"
  },
  {
    "text": "really good one of the big uses that we're seeing right now and I know under the speakers gonna touch on this on Friday as well is if you're migrating",
    "start": "349789",
    "end": "356479"
  },
  {
    "text": "your site from HTTP to HTTPS many of you've probably been through this or going through this you have this problem",
    "start": "356479",
    "end": "363440"
  },
  {
    "text": "called makes content CSP can help you fix issues with your site is not just about security HP KP the second one here",
    "start": "363440",
    "end": "371330"
  },
  {
    "text": "in orange this is a bit of a risky proposition I have an article about this in fact it's so risky the chromium is",
    "start": "371330",
    "end": "377270"
  },
  {
    "text": "intended to deprecated this feature so it might not be around for very long but a really good one in the top right",
    "start": "377270",
    "end": "383570"
  },
  {
    "text": "in gray certificate transparency if you haven't heard of this you should google it and have a look but there's essentially kind of mini search engines",
    "start": "383570",
    "end": "389900"
  },
  {
    "text": "online where you can go search for your domain and it will show you all of the certificates that have been issued for your size so you can find ones that",
    "start": "389900",
    "end": "395990"
  },
  {
    "text": "maybe didn't exist but you're required to be compliant with what we call the CT",
    "start": "395990",
    "end": "401210"
  },
  {
    "text": "policy for Chrome so you get a certificate from your CA for your website most people generally don't know about",
    "start": "401210",
    "end": "406849"
  },
  {
    "text": "this or come across a but if that certificate is issued and you deliver it to Chrome browser and it doesn't comply",
    "start": "406849",
    "end": "412550"
  },
  {
    "text": "with their policy the browser will refuse to accept it and the user will just get an error message on the screen and again you wouldn't normally know",
    "start": "412550",
    "end": "419089"
  },
  {
    "text": "about that but you can actually say to the browser hey if you go to my website and there's something broken and you're gonna stop the user please call back and",
    "start": "419089",
    "end": "426830"
  },
  {
    "text": "tell me I want to know about that before they have time to go and take screenshots on Twitter or send me emails",
    "start": "426830",
    "end": "433449"
  },
  {
    "text": "the xs/s auditor is another fantastic one so if you're not familiar with cross-site scripting it's a super common",
    "start": "433449",
    "end": "439909"
  },
  {
    "text": "attack it's been in the autop ten sins forever and it involves an attack of",
    "start": "439909",
    "end": "445069"
  },
  {
    "text": "trying to get JavaScript into your page that shouldn't be there now the browser's have built-in defenses against",
    "start": "445069",
    "end": "450199"
  },
  {
    "text": "this pretty much all mainstream browsers do if they see an attack or if the browser sees what it thinks is an attack",
    "start": "450199",
    "end": "456319"
  },
  {
    "text": "against the visitor to your site the browser will actually step in and try and mitigate that and automatically",
    "start": "456319",
    "end": "462169"
  },
  {
    "text": "protect your visitor and again that's really good we want the browser to do that but wouldn't it be a lot better if",
    "start": "462169",
    "end": "468139"
  },
  {
    "text": "we could find out if your browser of your visitor is having to take action to",
    "start": "468139",
    "end": "473479"
  },
  {
    "text": "protect them on your site we should really know about that because we probably have an underlying problem",
    "start": "473479",
    "end": "479269"
  },
  {
    "text": "that we need to go fix again and then last one Oh CSP is a performance and",
    "start": "479269",
    "end": "484459"
  },
  {
    "text": "privacy feature that a lot of sites enable and again if you're enabling this and it's not working probably then your",
    "start": "484459",
    "end": "491089"
  },
  {
    "text": "users may see errors on your site so all of these things are things that the",
    "start": "491089",
    "end": "497419"
  },
  {
    "text": "browser can report on we don't simply send the page to the browser anymore it's becoming an active participant in",
    "start": "497419",
    "end": "503059"
  },
  {
    "text": "the whole experience in securing it but not just security functionality as well so I wanted all those years ago to be",
    "start": "503059",
    "end": "511309"
  },
  {
    "text": "able to accept these reports and I couldn't find that service so I built one I spent about nine ten months",
    "start": "511309",
    "end": "516529"
  },
  {
    "text": "building it and I launched it a little over three years ago and going all the way back then we had I had if I should",
    "start": "516529",
    "end": "524389"
  },
  {
    "text": "say was just me at the time a rather simplistic view of the service and how it was going to operate and I had no",
    "start": "524389",
    "end": "530180"
  },
  {
    "text": "wild aspirations for it so it was a fairly simple kind of little set up now",
    "start": "530180",
    "end": "536089"
  },
  {
    "text": "for probably sins committed previous life I'm a PHP developer so our",
    "start": "536089",
    "end": "541819"
  },
  {
    "text": "whole application runs on a very basic Linux stack we've got a bomb to running 1604 which is LTS PHP 7.2 on top of",
    "start": "541819",
    "end": "550100"
  },
  {
    "text": "nginx our web server and we run all of that inside digitalocean so digitalocean is just a VPS provider",
    "start": "550100",
    "end": "555649"
  },
  {
    "text": "they call them droplets and we have a very kind of plain application stack there but we were going to have a lot of",
    "start": "555649",
    "end": "562730"
  },
  {
    "text": "storage requirements we were going to be ingesting thousands of these reports we needed to store them in a database we",
    "start": "562730",
    "end": "568459"
  },
  {
    "text": "need to be able to query over them and I'm not a database person I have no database skills and acknowledging this",
    "start": "568459",
    "end": "574069"
  },
  {
    "text": "very early on I also didn't want to go and learn how to be a good database person so I have kind of this hybrid set",
    "start": "574069",
    "end": "580550"
  },
  {
    "text": "up the many people kind of think is a little bit odd we actually use your table storage as the backend for our",
    "start": "580550",
    "end": "587269"
  },
  {
    "text": "database if you're not familiar with table storage is simply just a key value store you place an item in with a key",
    "start": "587269",
    "end": "593540"
  },
  {
    "text": "and then you can query it back out so the reason we went without I looked at a",
    "start": "593540",
    "end": "598670"
  },
  {
    "text": "few other cloud providers and I did consider Amazon's I think it's dynamodb they call it and I look at the pricing",
    "start": "598670",
    "end": "604970"
  },
  {
    "text": "structure and why we went with Azure because it made a big impact for us but this is all we run on we have the",
    "start": "604970",
    "end": "610249"
  },
  {
    "text": "application hosted in digital digital ocean and it's backed up by is your table storage for the database now in",
    "start": "610249",
    "end": "617480"
  },
  {
    "text": "our first month we did 10,000 reports and things started progressing very small steps month after month and of",
    "start": "617480",
    "end": "623420"
  },
  {
    "text": "course we're in the cloud the reason we go to the cloud is that you can just dial things up to 11 right it's like we've got double the number of reports",
    "start": "623420",
    "end": "629929"
  },
  {
    "text": "this month we'll just throw some more cloud onto the pile and then we can process all of these actual reports the",
    "start": "629929",
    "end": "636980"
  },
  {
    "text": "only problem with that is it also scales the cost pretty much linearly as well like if we need double the resources",
    "start": "636980",
    "end": "643100"
  },
  {
    "text": "we're looking at essentially double the cost and from our very first month of operation to our last month of operation",
    "start": "643100",
    "end": "650350"
  },
  {
    "text": "we're processing just close to 2 million times more traffic so if we just",
    "start": "650350",
    "end": "656629"
  },
  {
    "text": "literally scaled the cloud all the way up we would have been looking at roughly 2 million times in our resources so we",
    "start": "656629",
    "end": "662480"
  },
  {
    "text": "had to get smart about this and we've had to do several kind of really major iterations from a very simplistic first",
    "start": "662480",
    "end": "669470"
  },
  {
    "text": "infrastructure so this is how it first looked we have the browsers so these browsers are going to websites our customers they hit some",
    "start": "669470",
    "end": "677050"
  },
  {
    "text": "kind of error message and they post the JSON payload to us they hit our servers our servers would then actually have to",
    "start": "677050",
    "end": "683649"
  },
  {
    "text": "call into table storage to fetch the user entity or the users row as we call it we call them entities in table",
    "start": "683649",
    "end": "688750"
  },
  {
    "text": "storage so that would a confirm that a user exists with this account and B it",
    "start": "688750",
    "end": "694149"
  },
  {
    "text": "would also pull back their filter settings now the application servers at this point didn't maintain any state so",
    "start": "694149",
    "end": "699639"
  },
  {
    "text": "when the report came in they fetched the user entity we could then look at the report do any custom filtering and",
    "start": "699639",
    "end": "704769"
  },
  {
    "text": "processing and then the application server would place it into table storage now given how our table storage works if",
    "start": "704769",
    "end": "711100"
  },
  {
    "text": "you've used it you'll be familiar with the concept we D normalize data on the way in so we actually store each report",
    "start": "711100",
    "end": "716259"
  },
  {
    "text": "in four different time slices so that we can query it back out faster later in Azure in table storage it's cheaper to",
    "start": "716259",
    "end": "723160"
  },
  {
    "text": "have multiple copies of the data faster query than a single copy and slower query so the service had to call in to",
    "start": "723160",
    "end": "730540"
  },
  {
    "text": "see if the report existed in the time slice they would then pull that back if it failed then we knew it didn't exist",
    "start": "730540",
    "end": "737379"
  },
  {
    "text": "and it would just insert it with a count of 1 if it returned the entity it would increment the count and put it back so",
    "start": "737379",
    "end": "742569"
  },
  {
    "text": "for every single report that came in at this point in time we were doing nine",
    "start": "742569",
    "end": "747579"
  },
  {
    "text": "transactions against his your in table storage now this wasn't pretty it wasn't really problematic at all for quite a",
    "start": "747579",
    "end": "754059"
  },
  {
    "text": "while because table storage is super cheap and this is the reason that I chose table storage they bill you on a",
    "start": "754059",
    "end": "761860"
  },
  {
    "text": "flat fee per transaction against the database compared to other providers where you have to provision a three pot",
    "start": "761860",
    "end": "767259"
  },
  {
    "text": "of like a thousand a second and pay for that whether or not you used it tables so it is different you can use one a",
    "start": "767259",
    "end": "772750"
  },
  {
    "text": "second or a million a second and you just pay the per transaction fee so we had predictable pricing with no wastage",
    "start": "772750",
    "end": "778779"
  },
  {
    "text": "and you can see here is a fraction of a fraction of a cent for every 10,000",
    "start": "778779",
    "end": "783910"
  },
  {
    "text": "transactions we did so early on I'm like ah 9 you know nine transactions per",
    "start": "783910",
    "end": "788980"
  },
  {
    "text": "report this is no problem it's like super super cheap we don't need to worry about this but things like scaling of my",
    "start": "788980",
    "end": "795009"
  },
  {
    "text": "kind of really naive approach at the beginning didn't didn't stand the test of time so we've",
    "start": "795009",
    "end": "800770"
  },
  {
    "text": "had to go through these kind of major iterations and the first one was to give the application service some kind of",
    "start": "800770",
    "end": "806770"
  },
  {
    "text": "state so every time that report came in we weren't constantly reaching back to Azure to pull back the user and see",
    "start": "806770",
    "end": "813040"
  },
  {
    "text": "because that was one of the first things that was really obviously wrong with this model so we managed our whole fleet",
    "start": "813040",
    "end": "818620"
  },
  {
    "text": "of servers with ansible so it's super easy to do this a couple of lines of config run the script and we installed",
    "start": "818620",
    "end": "823840"
  },
  {
    "text": "memcached onto all of the application servers that we're doing report ingestion and what this meant now was that we could start",
    "start": "823840",
    "end": "829720"
  },
  {
    "text": "to keep things locally and memcached without having to go back to Azure into table storage for them every time",
    "start": "829720",
    "end": "836460"
  },
  {
    "text": "now the first thing most obvious thing for us to do was the user entity if the user exists and their filter settings",
    "start": "836460",
    "end": "842470"
  },
  {
    "text": "exists rather than querying them out of the database we'll just keep them in memcached on here every time so that was",
    "start": "842470",
    "end": "850000"
  },
  {
    "text": "the first very basic step that we took was to kind of make the application servers a bit smarter give them",
    "start": "850000",
    "end": "855520"
  },
  {
    "text": "memcached and we managed to cut down the report to transaction ratio we're down to eight transactions per report now",
    "start": "855520",
    "end": "862440"
  },
  {
    "text": "then about two years ago we had just what we refer to as the incident when we",
    "start": "862440",
    "end": "869710"
  },
  {
    "text": "got hit by what wasn't actually a malicious attack at the time so if you're familiar with the term DDoS",
    "start": "869710",
    "end": "875140"
  },
  {
    "text": "they're generally fairly malicious attacks it's a distributed denial of service often somebody will go online to",
    "start": "875140",
    "end": "881770"
  },
  {
    "text": "one of these services they pay about twenty thirty dollars and they essentially got like a whole botnet of computers point them at your website and",
    "start": "881770",
    "end": "887500"
  },
  {
    "text": "just flood you with the requests the idea is to exhaust resources maybe it's bandwidth memory CPU or whatever but",
    "start": "887500",
    "end": "894280"
  },
  {
    "text": "they are designed to make you it available by flooding you with too much traffic and we got hit by something that",
    "start": "894280",
    "end": "900490"
  },
  {
    "text": "we thought was the DDoS at the time but was actually an accident somebody had",
    "start": "900490",
    "end": "905680"
  },
  {
    "text": "deployed a policy onto that website and I wrote this up in the company to their credit allowed me to name them as well",
    "start": "905680",
    "end": "911290"
  },
  {
    "text": "because this was an accident we were hit by an accidental DDoS attack they deployed a policy on their site that",
    "start": "911290",
    "end": "917320"
  },
  {
    "text": "accidentally blocked all of the resources on their pages so for every single page load they had they were",
    "start": "917320",
    "end": "922900"
  },
  {
    "text": "sending those 20 to 30 reports for each one of the assets that were blocked and then once you take that and put it onto",
    "start": "922900",
    "end": "929470"
  },
  {
    "text": "a website they gets millions of visitors a day we have several million visitors making 2030 HTTP POST requests",
    "start": "929470",
    "end": "936340"
  },
  {
    "text": "with a big JSON payload on the bottom and we just weren't ready for this back then this was this was a very",
    "start": "936340",
    "end": "942730"
  },
  {
    "text": "significant issue for us in many different ways so the first one was that we just couldn't scale fast enough to",
    "start": "942730",
    "end": "948430"
  },
  {
    "text": "code at the time we only had to load balancers fronting up the whole service and you can see here they were pushing",
    "start": "948430",
    "end": "953590"
  },
  {
    "text": "up towards 8 & 9 thousand requests a second the service start is scaling the third load balancer had been added at",
    "start": "953590",
    "end": "959380"
  },
  {
    "text": "this point it hadn't propagated in DNS yet because it wasn't getting any traffic but by the time it had",
    "start": "959380",
    "end": "964660"
  },
  {
    "text": "propagated in DNS it literally got flawed because the scale was still",
    "start": "964660",
    "end": "970120"
  },
  {
    "text": "growing so at this point we're up to almost 10,000 requests per second on each load balancer so the service trips",
    "start": "970120",
    "end": "976180"
  },
  {
    "text": "over the next criteria starts to scale again deployed into the load balancer and as soon as that one was propagating",
    "start": "976180",
    "end": "981940"
  },
  {
    "text": "in DNS we were up to like 40,000 requests per second and this just kept",
    "start": "981940",
    "end": "986950"
  },
  {
    "text": "going and going and going and I'm like wow we like the service literally can't",
    "start": "986950",
    "end": "992050"
  },
  {
    "text": "scale fast enough on the time triggers to actually keep up with this and we were starting to self a really degraded",
    "start": "992050",
    "end": "997060"
  },
  {
    "text": "service and he actually got to the point where we literally just couldn't scale",
    "start": "997060",
    "end": "1002130"
  },
  {
    "text": "fast enough so I gave up and I was like with there's no point scaling because the traffic is outstripping that our ability to scale and also we're up to",
    "start": "1002130",
    "end": "1009450"
  },
  {
    "text": "like 50,000 requests a second on average per load balancer here and this was just",
    "start": "1009450",
    "end": "1014460"
  },
  {
    "text": "phenomenal the the metrics kept coming in and out because even New Relic if you recognize the monitoring here New Relic didn't",
    "start": "1014460",
    "end": "1021390"
  },
  {
    "text": "have the resources on the service to report back but we were seeing over 700 megabits of inbound traffic per low",
    "start": "1021390",
    "end": "1027000"
  },
  {
    "text": "balance of just JSON data that we had to try and deal with so we're coming up to 3 Giga bits a second and I'm desperately",
    "start": "1027000",
    "end": "1034230"
  },
  {
    "text": "trying to figure out how to deal with this how do you take that much traffic you know do we just go like hey here's 10 load balancers and quadruple the size",
    "start": "1034230",
    "end": "1040530"
  },
  {
    "text": "of app servers but I didn't have time because well so this was happening an email came through and the email came",
    "start": "1040530",
    "end": "1047640"
  },
  {
    "text": "through from digitalocean here are my hosting provider for the application servers and they'd taken some steps",
    "start": "1047640",
    "end": "1052950"
  },
  {
    "text": "along the way to try and mitigate the traffic the breakers off onto separate infrastructure because we were causing",
    "start": "1052950",
    "end": "1058560"
  },
  {
    "text": "degradation of service and then they actually just emailed us and said we're just gonna turn you off now you're",
    "start": "1058560",
    "end": "1065220"
  },
  {
    "text": "getting too much traffic this inbound flood is causing a degradation on our service and that's",
    "start": "1065220",
    "end": "1070280"
  },
  {
    "text": "now having a knock-on effect so they actually sent me this email and I was like oh man I'm in so much trouble",
    "start": "1070280",
    "end": "1075980"
  },
  {
    "text": "okay when your hosting provider gets in touch with you to say that they're dropping you it's probably not gonna be",
    "start": "1075980",
    "end": "1081260"
  },
  {
    "text": "a great day now one of the biggest problems that our we had was that we couldn't stop the traffic like how do",
    "start": "1081260",
    "end": "1087770"
  },
  {
    "text": "you of course I can try and get in touch with the company because fortunately this wasn't hostile it was accidental so",
    "start": "1087770",
    "end": "1094790"
  },
  {
    "text": "eventually they will turn this off and fix it but in the interim time we're still down our service was horribly degraded and",
    "start": "1094790",
    "end": "1100730"
  },
  {
    "text": "eventually our hosting provider turned as off and said they won't turn us back on until the traffic flood had stopped",
    "start": "1100730",
    "end": "1106900"
  },
  {
    "text": "one of the biggest problems that we had was was how we did the reporting so up",
    "start": "1106900",
    "end": "1112100"
  },
  {
    "text": "here are various different addresses we've got our standard web application the tool section logging but the very",
    "start": "1112100",
    "end": "1117140"
  },
  {
    "text": "top line here is the address that I would send reports to for my website so every time somebody signed up they got",
    "start": "1117140",
    "end": "1123110"
  },
  {
    "text": "to choose like a vanity URL forward slash report forward slash something of your choosing and then you would send",
    "start": "1123110",
    "end": "1128930"
  },
  {
    "text": "your reports there that is how we then filter them into your account because we look at what we call the report token so",
    "start": "1128930",
    "end": "1134990"
  },
  {
    "text": "the report token links this address into your account but the problem is all of",
    "start": "1134990",
    "end": "1140030"
  },
  {
    "text": "this was hitting the same infrastructure because it all resolve to the same hostname so when you resolve this IP",
    "start": "1140030",
    "end": "1145580"
  },
  {
    "text": "whether you're trying to go to the website and load a page or post a report you're resolving to the same servers so",
    "start": "1145580",
    "end": "1151880"
  },
  {
    "text": "because we're being flooded with these reports and they were slamming our infrastructure they were also killing our website because we couldn't isolate",
    "start": "1151880",
    "end": "1158180"
  },
  {
    "text": "them we can't filter on the path until it hits the application server and by the time it hit the application server",
    "start": "1158180",
    "end": "1164480"
  },
  {
    "text": "it was literally already on fire so we couldn't do anything about that and this was like the first real lightbulb moment",
    "start": "1164480",
    "end": "1170330"
  },
  {
    "text": "for me that the service hadn't been architected in perhaps the best way anyone hello it only required a really",
    "start": "1170330",
    "end": "1179420"
  },
  {
    "text": "simple change for us to fix this and it was to take the report token from being in the path which we can't do anything",
    "start": "1179420",
    "end": "1185870"
  },
  {
    "text": "with until we hit the application layer and drop it down to DNS so we literally just took the report token from the path",
    "start": "1185870",
    "end": "1191720"
  },
  {
    "text": "and moved in to a subdomain under the domain so now all of our web traffic",
    "start": "1191720",
    "end": "1196910"
  },
  {
    "text": "will here the domains at the top but the poor traffic will go to their own unique individual subdomains and this gave us",
    "start": "1196910",
    "end": "1204330"
  },
  {
    "text": "so much control because this is a really powerful mechanism now because it allows",
    "start": "1204330",
    "end": "1209760"
  },
  {
    "text": "us to redirect and reroute traffic at DNS before it's even sent to us before it leaves the client we can alter the",
    "start": "1209760",
    "end": "1216120"
  },
  {
    "text": "flow of the traffic so if we take a look here our web application is now actually",
    "start": "1216120",
    "end": "1221220"
  },
  {
    "text": "hosted on separate infrastructure there is also its own IP addresses and that will now stop the same thing from ever",
    "start": "1221220",
    "end": "1227250"
  },
  {
    "text": "happening again we then have a wild-card subdomain which will catch the rest of",
    "start": "1227250",
    "end": "1232320"
  },
  {
    "text": "any random subdomain that so on compare so you can register and pick anything you want it doesn't matter it will be",
    "start": "1232320",
    "end": "1237450"
  },
  {
    "text": "caught by this single wild-card subdomain and then the really powerful thing on top of that is the ability to",
    "start": "1237450",
    "end": "1244350"
  },
  {
    "text": "then actually stop traffic because if someone does this or miss configures or someone starts being hostile and",
    "start": "1244350",
    "end": "1249810"
  },
  {
    "text": "flooding reports to a particular sub domain we can now just kill a subdomain so we can say this users gone over quota",
    "start": "1249810",
    "end": "1256980"
  },
  {
    "text": "they've misconfigured their deed are singers essentially will just no root that traffic will resolve the subdomains",
    "start": "1256980",
    "end": "1264300"
  },
  {
    "text": "are bad people - one two seven zero zero one and stop their reports hitting us so",
    "start": "1264300",
    "end": "1269460"
  },
  {
    "text": "we did this and this was it was quite a big react act for us internally and we also had to request all of our customers",
    "start": "1269460",
    "end": "1275670"
  },
  {
    "text": "to change their reporting addresses from being in the path to being in the subdomain but this gave us the control",
    "start": "1275670",
    "end": "1281370"
  },
  {
    "text": "and the flexibility that we needed we had to be able to protect ourselves so we could now stop traffic a DNS which",
    "start": "1281370",
    "end": "1287670"
  },
  {
    "text": "meant we could stop it before it touched our infrastructure now at the same time one of the other things that we looked",
    "start": "1287670",
    "end": "1293550"
  },
  {
    "text": "at was those four time slices as well we allowed our users in the UI to query on the day the hour of the week at the",
    "start": "1293550",
    "end": "1299670"
  },
  {
    "text": "month and that meant that we had two requests in - as your per report for each one of those so we also dropped a",
    "start": "1299670",
    "end": "1306570"
  },
  {
    "text": "time slice so we were still running on the infrastructure exactly like this except now we were using DNS and",
    "start": "1306570",
    "end": "1312090"
  },
  {
    "text": "subdomains to route traffic instead of a path and by dropping the time slice as well we were able to get down to six",
    "start": "1312090",
    "end": "1319740"
  },
  {
    "text": "transactions per report so this made us a lot more resilient this reduce our costs quite a lot but this still wasn't",
    "start": "1319740",
    "end": "1325410"
  },
  {
    "text": "enough because whilst all of this was happening over time our traffic is just constantly ramping up its constantly",
    "start": "1325410",
    "end": "1331620"
  },
  {
    "text": "growing which and that the costs are constantly growing and this is a free service I was running this is a side project so we",
    "start": "1331620",
    "end": "1338860"
  },
  {
    "text": "still needed to get smarter we still needed to reduce our costs the next",
    "start": "1338860",
    "end": "1344769"
  },
  {
    "text": "thing that we did was then look at Redis running memcached on each server manned that we could avoid several calls into",
    "start": "1344769",
    "end": "1350649"
  },
  {
    "text": "Azure but one of the things that I noticed over time with these reports is that many of them are the same so if you",
    "start": "1350649",
    "end": "1356230"
  },
  {
    "text": "have an error on your website and a hundred different people go to the page and report the error those 100 people",
    "start": "1356230",
    "end": "1362230"
  },
  {
    "text": "are reporting on the same error so the JSON payload is the same we went to this page this image is here that shouldn't",
    "start": "1362230",
    "end": "1368470"
  },
  {
    "text": "be these are the details and all we were doing was constantly doing transactions in now of as you're increasing the count",
    "start": "1368470",
    "end": "1375429"
  },
  {
    "text": "on how many times this error had occurred now we need to know the count because the count is useful because you",
    "start": "1375429",
    "end": "1380649"
  },
  {
    "text": "want to know what's a big problem and what's a small problem but constantly doing these increments was costing money",
    "start": "1380649",
    "end": "1385809"
  },
  {
    "text": "in transactions into Azure so we had to change that we couldn't constantly have",
    "start": "1385809",
    "end": "1392710"
  },
  {
    "text": "this one inbound rapport equals one set of transactions against the database again it's a table storage we had to to",
    "start": "1392710",
    "end": "1398499"
  },
  {
    "text": "break that and to do that we switch from using memcached on each application instance to a centralized ready server",
    "start": "1398499",
    "end": "1404740"
  },
  {
    "text": "which we still run now to this day so we've now got this ready server internally the reports come in from the",
    "start": "1404740",
    "end": "1411279"
  },
  {
    "text": "browser and they hit our application servers the application servers can store the user entity in Redis they can",
    "start": "1411279",
    "end": "1416440"
  },
  {
    "text": "store the filter settings in Redis so they will process the JSON they hold it against the strict schemas set out in",
    "start": "1416440",
    "end": "1421929"
  },
  {
    "text": "the specification they do any filtering and then they insert it into Redis and we use Redis as a ten-second buffer so",
    "start": "1421929",
    "end": "1429220"
  },
  {
    "text": "all the reports that come in in a 10 second period will buffer up in Redis the consumer then sits behind Redis and",
    "start": "1429220",
    "end": "1435039"
  },
  {
    "text": "every 10 seconds we'll grab the contents of the Redis cash pull them on board and then start processing the transactions",
    "start": "1435039",
    "end": "1441490"
  },
  {
    "text": "into Azure and what this meant was in that 10 second period if we received 4,000 copies of the same rapport because",
    "start": "1441490",
    "end": "1449379"
  },
  {
    "text": "you're a really high traffic website that report would be present once with a count of 4,000 and then the consumer",
    "start": "1449379",
    "end": "1456369"
  },
  {
    "text": "could take that one rapport and just increment the count by 4,000 in table storage with a single transaction and",
    "start": "1456369",
    "end": "1462759"
  },
  {
    "text": "this was massive for us the Redis cache is quite power a machine that uses a lot of resources it means them it has to be fast and",
    "start": "1462759",
    "end": "1469149"
  },
  {
    "text": "highly available but it allowed us to significantly change our report to transaction ratio for every single",
    "start": "1469149",
    "end": "1475360"
  },
  {
    "text": "inbound report now we were only doing an average of point zero one transactions in two table storage this was a",
    "start": "1475360",
    "end": "1481059"
  },
  {
    "text": "significant shift to go from six to one to one to 0.01 so this is really good",
    "start": "1481059",
    "end": "1487809"
  },
  {
    "text": "for us the Redis cache held up for a long time but I was still really concerned about that kind of DDoS scenario yes the Redis cache is good our",
    "start": "1487809",
    "end": "1495100"
  },
  {
    "text": "application servers are now processing smaller and smaller loads but what if that flood comes again wife something",
    "start": "1495100",
    "end": "1500799"
  },
  {
    "text": "like that happens it could be accidental it could be malicious this is something that I guess every online service faces",
    "start": "1500799",
    "end": "1507190"
  },
  {
    "text": "and we needed to push this out to the",
    "start": "1507190",
    "end": "1512259"
  },
  {
    "text": "edge we had no protection on our outbound side like we were the frontline our servers were on the frontline and we",
    "start": "1512259",
    "end": "1519580"
  },
  {
    "text": "needed to change that and we did because we we brought onboard a CDN provider and",
    "start": "1519580",
    "end": "1525580"
  },
  {
    "text": "the CDN provided that we chose was CloudFlare now most people understand",
    "start": "1525580",
    "end": "1531970"
  },
  {
    "text": "the concept of a CDN provider they sit in front of your website they front your service they will shield you from obviously",
    "start": "1531970",
    "end": "1538000"
  },
  {
    "text": "hostile traffic filter out DDoS attack Oh cloud fly do all of those things for",
    "start": "1538000",
    "end": "1544870"
  },
  {
    "text": "us but there's also a few more things that they can do there's one thing that we've really started to leverage",
    "start": "1544870",
    "end": "1550059"
  },
  {
    "text": "recently CloudFlare and it's the concepts of running code at the edge so climb fly have a feature called workers",
    "start": "1550059",
    "end": "1555940"
  },
  {
    "text": "if you're an AWS is very similar to Lambo edge and kind of like as your functions we're on an inbound request",
    "start": "1555940",
    "end": "1563080"
  },
  {
    "text": "rather than the CDN just kind of proxying that and then allowing it to pass through we can now actually deploy",
    "start": "1563080",
    "end": "1568269"
  },
  {
    "text": "code of the CDN xej and that code will be executed against each inbound request",
    "start": "1568269",
    "end": "1573960"
  },
  {
    "text": "and this is really good for us because a lot of what we were doing was very simple it was holding JSON to a schema",
    "start": "1573960",
    "end": "1581080"
  },
  {
    "text": "it was filtering bad reports based on reg axes it was stuff that we were doing",
    "start": "1581080",
    "end": "1586659"
  },
  {
    "text": "a scale that we could move upstream that we could move away from our application servers and the C DNS data centers are",
    "start": "1586659",
    "end": "1593490"
  },
  {
    "text": "geographically distributed we only have application servers in our one data center in San Francisco",
    "start": "1593490",
    "end": "1599440"
  },
  {
    "text": "all the reports are sent all the way across the world and then they may even be discarded because we didn't want them they may be filtered so now instead by",
    "start": "1599440",
    "end": "1606820"
  },
  {
    "text": "using cloud flies workers we've deployed our filtering code into there like last",
    "start": "1606820",
    "end": "1611830"
  },
  {
    "text": "week it was 150 something data centers it grows every week but they have them in all the countries around the world which means the browser sends it to the",
    "start": "1611830",
    "end": "1618580"
  },
  {
    "text": "local CDN and then that CDN will run our code on that request and the vast",
    "start": "1618580",
    "end": "1624460"
  },
  {
    "text": "majority of the time that results in the report being discarded for one of a number of reasons so this is really",
    "start": "1624460",
    "end": "1630309"
  },
  {
    "text": "efficient for the browser because it's only speaking to a local server which means it can have the communication and",
    "start": "1630309",
    "end": "1636190"
  },
  {
    "text": "close the connection everything's done a lot more quickly and this is fantastic for us because by sitting them in the",
    "start": "1636190",
    "end": "1641799"
  },
  {
    "text": "middle we can prevent reports from hitting our origin servers as well now the number one thing for us that that",
    "start": "1641799",
    "end": "1648220"
  },
  {
    "text": "cloud fallar actually do is throwing away reports for people who have gone over quota we have people sign up",
    "start": "1648220",
    "end": "1655029"
  },
  {
    "text": "especially on the free tier and you get let's say 10,000 reports a month for free are you pay for a large amount but",
    "start": "1655029",
    "end": "1661059"
  },
  {
    "text": "once you've consumed your quota we then don't process any new reports until the next billing month comes but the problem",
    "start": "1661059",
    "end": "1667659"
  },
  {
    "text": "is if you run a service and you're on a model like that if people keep sending you the reports even if you're just discarding them you've still got the",
    "start": "1667659",
    "end": "1674740"
  },
  {
    "text": "bandwidth in the processing and everything else involved without so they're still actually a cost there and",
    "start": "1674740",
    "end": "1680139"
  },
  {
    "text": "this is becoming really kind of problematic for us because we're being flooded with all of these reports they hit our application servers we check the",
    "start": "1680139",
    "end": "1686860"
  },
  {
    "text": "user account and it's like oh they're over quota just discard it and that was a big cost at the time especially for a",
    "start": "1686860",
    "end": "1693669"
  },
  {
    "text": "service that has only just recently become commercialized because it was becoming so large so cloud fly wrote",
    "start": "1693669",
    "end": "1700779"
  },
  {
    "text": "this filtering code for us and actually what I'm hoping to do we may actually be able to get rid of this band of",
    "start": "1700779",
    "end": "1705850"
  },
  {
    "text": "application servers in the end we may actually be able to go from running code at cloud flys edge straight into our",
    "start": "1705850",
    "end": "1711100"
  },
  {
    "text": "reddish cash and just chop out the application servers in the middle by moving all of our code upstream and",
    "start": "1711100",
    "end": "1716139"
  },
  {
    "text": "running it closer to the users browser now this is a big change for us this was",
    "start": "1716139",
    "end": "1722340"
  },
  {
    "text": "this is really good because it's significantly reduced our costs even further because now for every single",
    "start": "1722340",
    "end": "1728619"
  },
  {
    "text": "report that came into our infrastructure we were only doing a fraction of a fraction of a transaction again",
    "start": "1728619",
    "end": "1733920"
  },
  {
    "text": "stable storage so we gone from doing nine transactions into table storage per rapport down to 0.006 on average which",
    "start": "1733920",
    "end": "1743160"
  },
  {
    "text": "is a phenomenal saving because we've gone from processing 10,000 reports in a month to an average of about nine and a",
    "start": "1743160",
    "end": "1750210"
  },
  {
    "text": "half thousand a second right now and even as cheap as as your table storage transactions are that's still a lot of",
    "start": "1750210",
    "end": "1756450"
  },
  {
    "text": "cost to build up over the period of a month so as it stands right now today",
    "start": "1756450",
    "end": "1762260"
  },
  {
    "text": "this is what our infrastructure looks like our customers sign up they deploy",
    "start": "1762260",
    "end": "1767310"
  },
  {
    "text": "any security policies they want to onto their website and the browser will come across them in dispatch a report all of",
    "start": "1767310",
    "end": "1773070"
  },
  {
    "text": "those reports anytime you go to a website will go to a data center local to you where they will have our code at",
    "start": "1773070",
    "end": "1778680"
  },
  {
    "text": "the edge run against them will filter them will hold them against the schema we have some kind of internal filtering",
    "start": "1778680",
    "end": "1784530"
  },
  {
    "text": "for spam reports things that people don't want but already before it's even really traveled that far this is where",
    "start": "1784530",
    "end": "1790860"
  },
  {
    "text": "the vast majority of our traffic stops because we can apply good logic and filtering to them location closest to",
    "start": "1790860",
    "end": "1797490"
  },
  {
    "text": "wherever the browser is if they make it through cloud fly to our application servers there's a final set of",
    "start": "1797490",
    "end": "1803220"
  },
  {
    "text": "processing that we do right now and what we're trying to do is find a way to shift that upstream and like I say actually cut this band out but we do our",
    "start": "1803220",
    "end": "1810060"
  },
  {
    "text": "final processing they go into Redis and here is where we stack them for ten seconds now the one drawback of doing",
    "start": "1810060",
    "end": "1815970"
  },
  {
    "text": "that of course was that 10 second window this was something I was a bit hesitant about at the time because previously",
    "start": "1815970",
    "end": "1821700"
  },
  {
    "text": "when a report came in it essentially got processed straight through into table storage which meant it would show up in your dashboard really quickly but now",
    "start": "1821700",
    "end": "1828390"
  },
  {
    "text": "because of this 10 second buffer in Redis they added 10 seconds to the amount of time it could show up but",
    "start": "1828390",
    "end": "1834240"
  },
  {
    "text": "looking at this and thinking about this for the benefits of that bra I don't think that 10 second time period was too",
    "start": "1834240",
    "end": "1839940"
  },
  {
    "text": "bad because we allowed us to stack and D duplicate reports in an order of magnitude so it did introduce a small",
    "start": "1839940",
    "end": "1846750"
  },
  {
    "text": "time delay but we can still get things through into the consumer and then into table storage which means they will show",
    "start": "1846750",
    "end": "1852030"
  },
  {
    "text": "up in your UI super super quickly I mean",
    "start": "1852030",
    "end": "1857760"
  },
  {
    "text": "for me so that's our infrastructure today that's the kind of journey that I've",
    "start": "1857760",
    "end": "1862919"
  },
  {
    "text": "been on none of this was planned for me this was literally just a small project that I started you know I had the idea",
    "start": "1862919",
    "end": "1869100"
  },
  {
    "text": "like four years ago I built it three years ago we only commercialized last year because it literally grew to the point where despite the fact that we",
    "start": "1869100",
    "end": "1875970"
  },
  {
    "text": "went through all these major iterations to try and make the service more efficient it got to the point where when a side project is costing enough money",
    "start": "1875970",
    "end": "1883320"
  },
  {
    "text": "that your wife gets mad at you then you need to start thinking about whether I can keep I think this is a side project anymore",
    "start": "1883320",
    "end": "1888480"
  },
  {
    "text": "so we took the choice to commercialize and we did but these are the you know this is the journey that I went through",
    "start": "1888480",
    "end": "1894470"
  },
  {
    "text": "and I only kind of switch track a little bit now that's how we got to where we are today and of course our core purpose",
    "start": "1894470",
    "end": "1900330"
  },
  {
    "text": "is to provide that service to people to ingest those reports and present them in",
    "start": "1900330",
    "end": "1905340"
  },
  {
    "text": "a useful format but a couple of interesting things happening like the last year and what we realized was in",
    "start": "1905340",
    "end": "1911850"
  },
  {
    "text": "isolation the websites reports are fairly useful to that and them alone I have a problem on my site I get sent a",
    "start": "1911850",
    "end": "1918809"
  },
  {
    "text": "report and then I is the host can respond to that but what we realized was that we had a slightly different view of",
    "start": "1918809",
    "end": "1925259"
  },
  {
    "text": "the ecosystem as the host of this service so we're currently processing an",
    "start": "1925259",
    "end": "1930840"
  },
  {
    "text": "ice age like eighty eight point something billion reports per month and we have tens of thousands of web sites that report through us so at the higher",
    "start": "1930840",
    "end": "1937919"
  },
  {
    "text": "level we actually see a much broader view of the ecosystem now when you're in a service like this one of the things I",
    "start": "1937919",
    "end": "1943799"
  },
  {
    "text": "will point out if you do want to do this when you run a reporting service like this you're opening an endpoint to the internet and saying hey you can just",
    "start": "1943799",
    "end": "1950820"
  },
  {
    "text": "post JSON data at me and I will take and put it in a database all right what's the first thing people are gonna do with",
    "start": "1950820",
    "end": "1956190"
  },
  {
    "text": "that you're gonna get all kinds of spam thrown at it so it was about a year ago",
    "start": "1956190",
    "end": "1961889"
  },
  {
    "text": "when it was like okay look we need some kind of spam filtering we're gonna have to start working on this because we do literally just stand up an endpoint open",
    "start": "1961889",
    "end": "1968100"
  },
  {
    "text": "to the Internet and allow people to post data as that we ingest so that's like a rife spam target so I spent a little bit",
    "start": "1968100",
    "end": "1974879"
  },
  {
    "text": "of time developing some basic spam filtering looking at inbound reports trying to discard them if they were obvious attempt to send poor data",
    "start": "1974879",
    "end": "1982019"
  },
  {
    "text": "through and one day a set of reports triggered our spam system and if they were flagged up we continue processing",
    "start": "1982019",
    "end": "1988559"
  },
  {
    "text": "them until we decide what to do with them and it's like okay these reports look like spam because what happened is",
    "start": "1988559",
    "end": "1993840"
  },
  {
    "text": "thousand websites had all started sending the same report to us and I was",
    "start": "1993840",
    "end": "1998970"
  },
  {
    "text": "like well you know what are they kind of the chances of that happening all of these websites are all suddenly blocking",
    "start": "1998970",
    "end": "2004370"
  },
  {
    "text": "the same thing so I took a look at the reports and the reports were commenting",
    "start": "2004370",
    "end": "2009980"
  },
  {
    "text": "from literally locations all around the world we were seeing this commenting we see an average of about 78 17 million",
    "start": "2009980",
    "end": "2015950"
  },
  {
    "text": "unique browsers every month and thousands of them from all around the world were going to different websites but blocking the exact same thing I'm",
    "start": "2015950",
    "end": "2023570"
  },
  {
    "text": "like right okay before we decide this is famine ash they start throwing these away we need to be absolutely sure about this",
    "start": "2023570",
    "end": "2030250"
  },
  {
    "text": "so I take a look at the report and they're blocking a JavaScript payload",
    "start": "2030250",
    "end": "2035480"
  },
  {
    "text": "and I was like right okay so there's a script tag according to these reports there's a script tag on these hundreds",
    "start": "2035480",
    "end": "2041510"
  },
  {
    "text": "of websites being visited by these thousands of people and as like so how could all of these websites suddenly",
    "start": "2041510",
    "end": "2047750"
  },
  {
    "text": "have a script tag in them that wasn't there five minutes ago because we've seen the sudden influx of reports I was like this is starting to look a little",
    "start": "2047750",
    "end": "2053450"
  },
  {
    "text": "bit spammy I'm not sure about this but I did some investigation into the script tag I grabbed a copy of it I pulled it",
    "start": "2053450",
    "end": "2058849"
  },
  {
    "text": "down and had a look at what it was trying to do and it turns out that it wasn't actually a problem on the web",
    "start": "2058849",
    "end": "2065330"
  },
  {
    "text": "site and the reports weren't spam the reports were genuine and what we'd",
    "start": "2065330",
    "end": "2070700"
  },
  {
    "text": "realized was by looking at the script payload we found a reference to a Chrome extension inside the JavaScript payload",
    "start": "2070700",
    "end": "2078320"
  },
  {
    "text": "that was being loaded on these sites and that's kind of when he dawned on me like",
    "start": "2078320",
    "end": "2083570"
  },
  {
    "text": "so far we've been looking at this like the web site has something bad on the",
    "start": "2083570",
    "end": "2088638"
  },
  {
    "text": "page which is sent to the browser but that's not the only way that something bad can get into the page well if",
    "start": "2088639",
    "end": "2095148"
  },
  {
    "text": "there's a proxy along the route there does something or what if there's a browser extension because browser",
    "start": "2095149",
    "end": "2100190"
  },
  {
    "text": "extensions can manipulate the page and it transpired that this browser extension had started to manipulate the",
    "start": "2100190",
    "end": "2106220"
  },
  {
    "text": "pages of the browsers that it was installed on so the browser would go to a legitimate genuine web site except the",
    "start": "2106220",
    "end": "2113780"
  },
  {
    "text": "browser extension had bad intentions and it was injecting this JavaScript tag into the page but these web sites had",
    "start": "2113780",
    "end": "2121609"
  },
  {
    "text": "CSP deployed so the browser sees that script tag and says well this script tag isn't permitted it would be blocked and then he would",
    "start": "2121609",
    "end": "2128099"
  },
  {
    "text": "dispatch the reports it was now if this user has his browser extension installed and then they go to ten different web",
    "start": "2128099",
    "end": "2134849"
  },
  {
    "text": "sites they will trigger the same report on the ten different web sites blocking the same thing and this is what had kind",
    "start": "2134849",
    "end": "2141359"
  },
  {
    "text": "of triggered our spam and it wasn't actually spam it was genuine he just looked like spam and we realized that",
    "start": "2141359",
    "end": "2148109"
  },
  {
    "text": "this was this was actually really valuable information so we're in a position now where we can see that this",
    "start": "2148109",
    "end": "2154710"
  },
  {
    "text": "is happening and we know this is happening but there's no kind of reporting mechanism for this like for rows what do we do with this information",
    "start": "2154710",
    "end": "2159859"
  },
  {
    "text": "so fortunately I have some contacts at Chrome and I reached out to them and said we'll look you know this is kind of",
    "start": "2159859",
    "end": "2165150"
  },
  {
    "text": "a first this thing triggered our spam and it's not actually spam we think it's a browser extension that's gone rogue",
    "start": "2165150",
    "end": "2171660"
  },
  {
    "text": "so I sent all the information over I didn't have anything for a few days and then someone pointed out to me that the extension had been taken down from the",
    "start": "2171660",
    "end": "2177720"
  },
  {
    "text": "store and it was actually a browser extension that had gone rogue it turned hostile was injecting scripts into the",
    "start": "2177720",
    "end": "2183269"
  },
  {
    "text": "page and we'd actually managed to detect that by accident I won't claim I won't claim credit for that but we'd accidentally detected this and then I",
    "start": "2183269",
    "end": "2191579"
  },
  {
    "text": "thought well great this is like a new feed of threat intelligence now this is information that can't be hard or found",
    "start": "2191579",
    "end": "2196979"
  },
  {
    "text": "any other way and as time went by we had a couple of other little scenarios like",
    "start": "2196979",
    "end": "2203430"
  },
  {
    "text": "this as well the first of which was in a very large organization and we actually",
    "start": "2203430",
    "end": "2208529"
  },
  {
    "text": "managed to detect again kind of inadvertently that they had malware on one of their internal endpoints so a",
    "start": "2208529",
    "end": "2214319"
  },
  {
    "text": "very big customer they're using the reporting service and they come to me one day and say look you know we get these reports we triage them well you",
    "start": "2214319",
    "end": "2220859"
  },
  {
    "text": "raise our internal tickets and we fix the things but we've got this one report that we just can't understand and you keep sending it to us and telling us",
    "start": "2220859",
    "end": "2226079"
  },
  {
    "text": "that we have it and it was this one so the site you can see in the document URI of course I've altered the URL but it",
    "start": "2226079",
    "end": "2232410"
  },
  {
    "text": "was an internal internet site and they said any people that go to this are either on our internal network or a VPN",
    "start": "2232410",
    "end": "2237599"
  },
  {
    "text": "into the office this is literally an internal only website so if people are triggering this we know this is coming",
    "start": "2237599",
    "end": "2243479"
  },
  {
    "text": "from employees computers ok it's violating the script directive if they had their policy and then looking at the",
    "start": "2243479",
    "end": "2250019"
  },
  {
    "text": "block URI it was literally just like a random jumble of letters on a Russian domain and then the file was just called",
    "start": "2250019",
    "end": "2255749"
  },
  {
    "text": "ajs so you receive this report the first thing that you do is go to this on the internet site it's like right",
    "start": "2255749",
    "end": "2262020"
  },
  {
    "text": "let's go find the script tag the report says there's a script tag on this page loading from crazy Russian domain and",
    "start": "2262020",
    "end": "2268080"
  },
  {
    "text": "they're like but we've had a look on the server we've looked on the page we've checked our logs we've looked at everything and there is absolutely",
    "start": "2268080",
    "end": "2273840"
  },
  {
    "text": "nothing on the server that we can find but says there is a script tag on this page so they spent all of this time kind",
    "start": "2273840",
    "end": "2281340"
  },
  {
    "text": "of again looking at the server and this was a traditional view right like something in the page has come from the server into the browser except it hadn't",
    "start": "2281340",
    "end": "2290390"
  },
  {
    "text": "by looking at the the path and the pages that these reports were on they managed to kind of garner a little bit of",
    "start": "2290390",
    "end": "2296490"
  },
  {
    "text": "information about which department the person might be in because they had different sections on their internet site and what they realized was the",
    "start": "2296490",
    "end": "2303030"
  },
  {
    "text": "problem wasn't on the server the problem was on the client and in one of these departments there were a couple of",
    "start": "2303030",
    "end": "2308880"
  },
  {
    "text": "people who run legacy applications and for those legacy applications they needed Adam initiative privilege of the",
    "start": "2308880",
    "end": "2314100"
  },
  {
    "text": "privileges locally so they had local admin on this device and with local admin may have installed some things",
    "start": "2314100",
    "end": "2319680"
  },
  {
    "text": "that they shouldn't have installed and one of them came along with some malware so they had some malware on the machine",
    "start": "2319680",
    "end": "2325140"
  },
  {
    "text": "that was injecting the JavaScript into pages that they visited and that was again triggering the CSP and sending the",
    "start": "2325140",
    "end": "2331800"
  },
  {
    "text": "reports so now we're aware of this end point how do you find this though",
    "start": "2331800",
    "end": "2338430"
  },
  {
    "text": "because we don't have that kind of information available now we did actually look at a few ways to do this",
    "start": "2338430",
    "end": "2344790"
  },
  {
    "text": "by injecting random tokens into the path but unfortunately the company with knowledge of which department they were",
    "start": "2344790",
    "end": "2350310"
  },
  {
    "text": "in managed to actually track down the user and sort out the end point before we got to deploy that but we theorized",
    "start": "2350310",
    "end": "2356610"
  },
  {
    "text": "the way that we could actually identify unique end points within a company using the CSP reports so those are kind of two",
    "start": "2356610",
    "end": "2365340"
  },
  {
    "text": "stories of how how we've come to find ourselves in this position where we have information that we think that we can do",
    "start": "2365340",
    "end": "2372120"
  },
  {
    "text": "more good with of course we provide the service that's the whole point in the service but how can we how can we use our position to help more people things",
    "start": "2372120",
    "end": "2379140"
  },
  {
    "text": "like dropping browser extensions maybe you can identify malware on endpoints within your organization it's they're",
    "start": "2379140",
    "end": "2386940"
  },
  {
    "text": "not intended use cases of the technology but they're really cool side effects and there's a lot more stuff here like this",
    "start": "2386940",
    "end": "2392010"
  },
  {
    "text": "you can do so I wanted to wrap it up there and leave a good 10 or so minutes or some",
    "start": "2392010",
    "end": "2397260"
  },
  {
    "text": "questions because hopefully hopefully this might trigger some thoughts and people hopefully the lessons here may be",
    "start": "2397260",
    "end": "2402420"
  },
  {
    "text": "useful for you and how you can scale and protect your infrastructure but other than that was everything from me thank",
    "start": "2402420",
    "end": "2407910"
  },
  {
    "text": "you so questions yes Wow okay start",
    "start": "2407910",
    "end": "2418020"
  },
  {
    "text": "there yes that's correct so the question",
    "start": "2418020",
    "end": "2430230"
  },
  {
    "text": "was we move some code from our origin into CloudFlare to save on costs but obviously there will be a cost involved",
    "start": "2430230",
    "end": "2436140"
  },
  {
    "text": "in running code there there is the cloud fly workers you start a flat fee everything is $5 a month and that covers",
    "start": "2436140",
    "end": "2442650"
  },
  {
    "text": "you for like 10 million requests or 10 million executions of the code sorry and then you pay 50 cents per million after",
    "start": "2442650",
    "end": "2449790"
  },
  {
    "text": "that and by the time we'd factored in not only the CPU resources but the",
    "start": "2449790",
    "end": "2455010"
  },
  {
    "text": "bandwidth costs as well around our infrastructure that is actually slightly more efficient and it's also a lot more",
    "start": "2455010",
    "end": "2460680"
  },
  {
    "text": "friendly to the browser resources because we can terminate communications with the browser a lot sooner if we're",
    "start": "2460680",
    "end": "2466260"
  },
  {
    "text": "closer to them so yes it does cost but at least for us overall it does work out cheaper now there's another one to that",
    "start": "2466260",
    "end": "2475700"
  },
  {
    "text": "yep",
    "start": "2483060",
    "end": "2485630"
  },
  {
    "text": "are so that's a great question yes so the question there was I said that when a user goes over quota we can now",
    "start": "2489260",
    "end": "2495690"
  },
  {
    "text": "terminate the request that cloud flies age but how does cloud fly know that the user is over quota is that accurate",
    "start": "2495690",
    "end": "2501270"
  },
  {
    "text": "so the awesome awesome thing with workers is that it's not just a single",
    "start": "2501270",
    "end": "2506370"
  },
  {
    "text": "piece of code that will execute on a request and then die the workers can actually maintain state they can",
    "start": "2506370",
    "end": "2511620"
  },
  {
    "text": "actually maintain local variables over a series of executions and if the worker is executed frequently enough then it's",
    "start": "2511620",
    "end": "2518190"
  },
  {
    "text": "never vacated from memory which means that when the worker spins up and it gets an inbound rapport it has a secure",
    "start": "2518190",
    "end": "2524700"
  },
  {
    "text": "path to our origin to query the user settings and then he stores them in a local array so then on subsequent",
    "start": "2524700",
    "end": "2530520"
  },
  {
    "text": "inbound requests the client fly worker already knows I've pulled back this user settings in that over quota and all we",
    "start": "2530520",
    "end": "2537540"
  },
  {
    "text": "do is flush that array or midnight when the billing month rolls so the workers can actually maintain state across",
    "start": "2537540",
    "end": "2543650"
  },
  {
    "text": "executions as well which means the next thing that we're looking at this is slightly into the future for us is we're",
    "start": "2543650",
    "end": "2550230"
  },
  {
    "text": "currently buffering those reports in the readies cache I'll show it you actually in context so we're currently buffering",
    "start": "2550230",
    "end": "2556020"
  },
  {
    "text": "those reports in the readies cache my current experiments I'm testing with right now is how many can we buffer in",
    "start": "2556020",
    "end": "2561030"
  },
  {
    "text": "the worker because if the worker can maintain state and hold things in the local variable maybe the worker could just buffer those",
    "start": "2561030",
    "end": "2566580"
  },
  {
    "text": "up and dispatch them to our origin in batches as well now we've got I've started playing around with this we're",
    "start": "2566580",
    "end": "2572310"
  },
  {
    "text": "not actually doing this yet but I think that's a really cool kind of concept the ability to buffer at requests at the",
    "start": "2572310",
    "end": "2577590"
  },
  {
    "text": "edge and then have them come in nice little batches onto our origin another",
    "start": "2577590",
    "end": "2583650"
  },
  {
    "text": "question yes",
    "start": "2583650",
    "end": "2586640"
  },
  {
    "text": "so the question there was sometimes people optimize too early and do I wish",
    "start": "2598660",
    "end": "2604029"
  },
  {
    "text": "that we'd done this earlier is that kind of fair so all of our optimizations here really came out of necessity largely",
    "start": "2604029",
    "end": "2609910"
  },
  {
    "text": "because when I built the project it was literally just a free spare time project I thought this thing was cool and rather",
    "start": "2609910",
    "end": "2616240"
  },
  {
    "text": "than just build it for me I'll open it up and anyone can use it and then it was like oh wow people are using it you know",
    "start": "2616240",
    "end": "2622420"
  },
  {
    "text": "we need to change this we need to scale so literally at all of these iterations came for us at least out of necessity",
    "start": "2622420",
    "end": "2628420"
  },
  {
    "text": "and ever since then we've really been chasing to catch up but it would actually be nice to get out ahead of",
    "start": "2628420",
    "end": "2634210"
  },
  {
    "text": "that and start like planning and deploying infrastructure changes in front of the requirement but you know",
    "start": "2634210",
    "end": "2639849"
  },
  {
    "text": "we're really small like I say there's only three of us now so yeah it would be nice to start maybe with the power of",
    "start": "2639849",
    "end": "2647079"
  },
  {
    "text": "foresight just planning a little bit further ahead would have been good know",
    "start": "2647079",
    "end": "2653529"
  },
  {
    "text": "so we've never lost anything the only real reason that we're making these advances is to save money because they",
    "start": "2653529",
    "end": "2659140"
  },
  {
    "text": "make the service more efficient they drive down the cost which means that it didn't cost me as much to run so",
    "start": "2659140",
    "end": "2664509"
  },
  {
    "text": "essentially we've never actually thrown away reports we've never lost reports we've just paid more than I wanted to",
    "start": "2664509",
    "end": "2671259"
  },
  {
    "text": "for the infrastructure so it's a case of winding back that cost by making it more efficient like this there's another one",
    "start": "2671259",
    "end": "2678130"
  },
  {
    "text": "yes",
    "start": "2678130",
    "end": "2680518"
  },
  {
    "text": "okay so the question is can we see that or so the question now is essentially",
    "start": "2688390",
    "end": "2694819"
  },
  {
    "text": "can we then see which browsers go to which site so is that right and and yes the answer is yes we are a security",
    "start": "2694819",
    "end": "2701539"
  },
  {
    "text": "focused services so people deploy us onto their website when their users go",
    "start": "2701539",
    "end": "2706819"
  },
  {
    "text": "to their website their user send reports to us as a natural kind of part of that we can see the client IP in the user",
    "start": "2706819",
    "end": "2712579"
  },
  {
    "text": "agent because it makes a HTTP post and then also the document URI in the reports we looked at is the page they",
    "start": "2712579",
    "end": "2718130"
  },
  {
    "text": "run now our customers can take varying levels of control over that of course",
    "start": "2718130",
    "end": "2723140"
  },
  {
    "text": "we've got really strict privacy and security policies in place anyway and just kind of like any service provider you bring on board there's always a",
    "start": "2723140",
    "end": "2729559"
  },
  {
    "text": "discussion around are we comfortable in this environment but there's actually ways that you can control that so with",
    "start": "2729559",
    "end": "2735410"
  },
  {
    "text": "cloud fly workers we actually have customers that essentially proxy reports to us to shield the client IP anyway",
    "start": "2735410",
    "end": "2740599"
  },
  {
    "text": "from us and if you don't to use the browsers native reporting mechanisms we have a JavaScript library that you can",
    "start": "2740599",
    "end": "2746449"
  },
  {
    "text": "drop in and that actually builds the report payload for you which then allows you to filter information on the client",
    "start": "2746449",
    "end": "2752539"
  },
  {
    "text": "before it gets dispatched to us so these are things as we grew these are things that we came across problems that we",
    "start": "2752539",
    "end": "2757910"
  },
  {
    "text": "came across and we built the solutions to them as we've gone try this side",
    "start": "2757910",
    "end": "2764630"
  },
  {
    "text": "questions no they decided not any more",
    "start": "2764630",
    "end": "2770089"
  },
  {
    "text": "on this side I can't really see so if you've got your handle just yell no all right will that be oh this one yeah say",
    "start": "2770089",
    "end": "2776809"
  },
  {
    "text": "well sorry I did see one",
    "start": "2776809",
    "end": "2779739"
  },
  {
    "text": "mm-hmm so so yeah I guess it's like yeah",
    "start": "2786160",
    "end": "2793339"
  },
  {
    "text": "so the guess is like multiple overlapping definitions of the word user so we have our users who would be the",
    "start": "2793339",
    "end": "2800900"
  },
  {
    "text": "website operator and then they would deploy the reports or the the content security policy onto their website",
    "start": "2800900",
    "end": "2807140"
  },
  {
    "text": "and then their users would trigger it and send the report to us so yes I you depends on which user you're talking",
    "start": "2807140",
    "end": "2813740"
  },
  {
    "text": "about what yeah there are multiple definitions of the term were there any more yes there it was shout louder sorry",
    "start": "2813740",
    "end": "2824529"
  },
  {
    "text": "so if you were visiting one of our customers websites how would you not",
    "start": "2830980",
    "end": "2837140"
  },
  {
    "text": "send information to us and I guess",
    "start": "2837140",
    "end": "2843500"
  },
  {
    "text": "that's kind of a tough one because in visiting so the question sorry just to clarify for everyone was if the gentleman went to one of our customers",
    "start": "2843500",
    "end": "2849829"
  },
  {
    "text": "web sites and ended up sending a report to us could you opt out of that or prevent that in some way I guess by",
    "start": "2849829",
    "end": "2856309"
  },
  {
    "text": "going to their website you're participating in their delivery of the service of their website so they may",
    "start": "2856309",
    "end": "2861470"
  },
  {
    "text": "have a CDN provider a database provider like AWS they will have the people and the companies that they've chosen to",
    "start": "2861470",
    "end": "2867260"
  },
  {
    "text": "bring in to that and your browser will send that automatically in the background so if the the site you're",
    "start": "2867260",
    "end": "2875089"
  },
  {
    "text": "visiting is chosen to do that and I guess this is the key point here this is part of the service delivery that they have chosen to build so right now I",
    "start": "2875089",
    "end": "2883490"
  },
  {
    "text": "don't know if there's a way to turn this off in browsers it's an automatic reporting mechanism that runs in the background yes oh sorry yes this one",
    "start": "2883490",
    "end": "2895930"
  },
  {
    "text": "yes",
    "start": "2899250",
    "end": "2902250"
  },
  {
    "text": "hmm yes that's really good question content security policy is very powerful",
    "start": "2906640",
    "end": "2912140"
  },
  {
    "text": "so if you deploy it wrong and you block all of your style sheets you have no style sheets as you point out so there",
    "start": "2912140",
    "end": "2917900"
  },
  {
    "text": "is a test only mode for CSP where you can deploy what you believe is your correct policy ask the browser to send",
    "start": "2917900",
    "end": "2924020"
  },
  {
    "text": "the reports but don't actually block anything so if the policy is wrong it won't harm or damage your website but",
    "start": "2924020",
    "end": "2930530"
  },
  {
    "text": "you will still get the reports back to say ah you know this thing we've missed out we'll go add it to our policy and",
    "start": "2930530",
    "end": "2936170"
  },
  {
    "text": "now the policy is correct and then you can enforce it so you can deploy these things safely and securely without any",
    "start": "2936170",
    "end": "2942050"
  },
  {
    "text": "risk to actually damaging the user experience on your site no so the",
    "start": "2942050",
    "end": "2954260"
  },
  {
    "text": "project itself is an open source we do have various bits of code and tools and things like our cloud fly worker we",
    "start": "2954260",
    "end": "2961070"
  },
  {
    "text": "release the code for that I've started publishing our runcible configurations but the actual kind of core product",
    "start": "2961070",
    "end": "2966920"
  },
  {
    "text": "itself is an open source no any more questions all right now I think we're",
    "start": "2966920",
    "end": "2974870"
  },
  {
    "text": "good thanks very much [Applause]",
    "start": "2974870",
    "end": "2981750"
  }
]