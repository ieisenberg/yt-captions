[
  {
    "text": "all right so we all set yes all right thanks for coming everyone uh my name is",
    "start": "1560",
    "end": "6720"
  },
  {
    "text": "Jimmy Bogard you can find me on Twitter at J Bogard um this presentation uh as well as the",
    "start": "6720",
    "end": "12480"
  },
  {
    "text": "code examples are on my GitHub I'll be uh shooting out the links to the specific repositories and stuff on my",
    "start": "12480",
    "end": "18300"
  },
  {
    "text": "Twitter um and I've blogged about this topic and a lot of other things on my blog at jimmyboguard.com my day job is",
    "start": "18300",
    "end": "25260"
  },
  {
    "text": "Consulting so I typically are building applications and systems for clients that uh for some reason want to pay me",
    "start": "25260",
    "end": "31439"
  },
  {
    "text": "to do that sort of thing um and I did a lot of Open Source stuff uh Auto map or mediator to my big projects so either I'm sorry or you're",
    "start": "31439",
    "end": "39059"
  },
  {
    "text": "welcome one of those two things and this talk in particular came from uh one of our clients that was going from a",
    "start": "39059",
    "end": "47100"
  },
  {
    "text": "monolithic application that was all deployed on-prem moving towards a microservice oriented architecture",
    "start": "47100",
    "end": "53160"
  },
  {
    "text": "deployed with kubernetes and in Azure so like throwing every single technology at",
    "start": "53160",
    "end": "58620"
  },
  {
    "text": "the wall and seeing which one sticks that sort of thing and my team in particular was charged",
    "start": "58620",
    "end": "63840"
  },
  {
    "text": "with not only building some of these microservices but at some point we had to figure out how to secure them so this",
    "start": "63840",
    "end": "69119"
  },
  {
    "text": "talk is the story of how we design the security of those different Services talking to each other and how we were uh",
    "start": "69119",
    "end": "76140"
  },
  {
    "text": "how we then use Azure uh Azure security features to be able to do so",
    "start": "76140",
    "end": "81240"
  },
  {
    "text": "but their existing system uh was built in a much simpler time",
    "start": "81240",
    "end": "87060"
  },
  {
    "text": "um and there was just a it was a single monolithic application that was just a client server application so they had a",
    "start": "87060",
    "end": "92400"
  },
  {
    "text": "big asp.net web forms thing that sat on servers on their uh on their Data Center",
    "start": "92400",
    "end": "98820"
  },
  {
    "text": "and then the clients were just browsers and some mobile apps uh talking to these servers",
    "start": "98820",
    "end": "104280"
  },
  {
    "text": "um and so for them it was pretty simple like we just have you know the Internet of Things We don't trust and then we",
    "start": "104280",
    "end": "109439"
  },
  {
    "text": "have our server of the things that we do trust and they would just use cookie based authentication and authorization",
    "start": "109439",
    "end": "115040"
  },
  {
    "text": "to secure those servers so you would log in and in that cookie you had some",
    "start": "115040",
    "end": "120180"
  },
  {
    "text": "information about you um I think they they should probably shoved way too much stuff in that cookie because like the cookie was too big but",
    "start": "120180",
    "end": "126180"
  },
  {
    "text": "in any case uh it was very kind of straightforward set of security um with this the cookie based",
    "start": "126180",
    "end": "131580"
  },
  {
    "text": "authentication and authorization now as they move towards microservices where they simplified things right",
    "start": "131580",
    "end": "139260"
  },
  {
    "text": "um it becoming it became a lot more complex and to understand how we should secure each of these different connections between each of these",
    "start": "139260",
    "end": "145920"
  },
  {
    "text": "different systems and services um so the new application they were building was no longer going to be a server-side",
    "start": "145920",
    "end": "153060"
  },
  {
    "text": "rendered web application you know like MVC or anything like that is of course going to be a spa and Spas by themselves",
    "start": "153060",
    "end": "160260"
  },
  {
    "text": "already are going to have more complicated security requirements that may not be completely obvious to really",
    "start": "160260",
    "end": "165900"
  },
  {
    "text": "anybody I think that uh that is looking at for the first time so um their architecture looks something",
    "start": "165900",
    "end": "172200"
  },
  {
    "text": "like this in the Azure space we had the clients which is still going to be a browser this is an angular application",
    "start": "172200",
    "end": "178920"
  },
  {
    "text": "that was talking to a single API endpoint and this is using the bff or",
    "start": "178920",
    "end": "184260"
  },
  {
    "text": "back and for front-end uh pattern and so that API was purpose built for those",
    "start": "184260",
    "end": "190440"
  },
  {
    "text": "individual clients now those BFF apis did not have any state by themselves their job in life",
    "start": "190440",
    "end": "196860"
  },
  {
    "text": "was to aggregate back-end data into coherent responses for the front ends there's different there's different ways",
    "start": "196860",
    "end": "202500"
  },
  {
    "text": "you can do those apis like BFS BFFs are are ones that are very specific to the application calling them but you could",
    "start": "202500",
    "end": "208920"
  },
  {
    "text": "also have API gateways which are more generic so you have different applications calling it in this one API",
    "start": "208920",
    "end": "214319"
  },
  {
    "text": "or you can use Technologies like graphql that can be that that API that is for",
    "start": "214319",
    "end": "219720"
  },
  {
    "text": "your for your browser um so the complicated thing here is uh we could we could figure out the the",
    "start": "219720",
    "end": "226319"
  },
  {
    "text": "authentication and authorization between the client and that BFF and even could be very similar to our server-side web",
    "start": "226319",
    "end": "231720"
  },
  {
    "text": "applications uh what wasn't so clear was what do we do about all these uh all these other things behind the scenes",
    "start": "231720",
    "end": "240080"
  },
  {
    "text": "um so the first thing they had to figure out was how do we authenticate and authorize external users so the people",
    "start": "240900",
    "end": "246299"
  },
  {
    "text": "uh using the browser how can we authenticate how do we know who you are and what kind of things you can do",
    "start": "246299",
    "end": "253439"
  },
  {
    "text": "um their existing application use that cookie based authentication but it was all completely baked into that system",
    "start": "253439",
    "end": "259199"
  },
  {
    "text": "and we could make it portable to something else and so they wound up going um with auth0 and external identity",
    "start": "259199",
    "end": "266699"
  },
  {
    "text": "provider for those those the authentication of those users",
    "start": "266699",
    "end": "271740"
  },
  {
    "text": "okay but this talk is not about all zero it's about Azure and so we still had to figure out uh what do we do behind the",
    "start": "271740",
    "end": "278880"
  },
  {
    "text": "scenes here so someone uh I don't know I think an Osteo service sales rep like uh",
    "start": "278880",
    "end": "284639"
  },
  {
    "text": "you know went on a golf course and convinced them to buy out zero because it's it's quite expensive to use",
    "start": "284639",
    "end": "290460"
  },
  {
    "text": "um but it can help solve a lot of those like you know single sign-on sort of problems so he said okay that's great uh off zero",
    "start": "290460",
    "end": "297840"
  },
  {
    "text": "it'll take a few years for that to roll out so we can't necessarily even count on it for a back-end service communication",
    "start": "297840",
    "end": "303000"
  },
  {
    "text": "um so we need to figure out how do we secure all the things behind the scenes here how to be secure once I get past",
    "start": "303000",
    "end": "308639"
  },
  {
    "text": "that first initial API call how do I then circuit the communication of all these different microservices behind the",
    "start": "308639",
    "end": "314759"
  },
  {
    "text": "scenes and then we also have the added complication of on-prem servers also needing to call into our microservices",
    "start": "314759",
    "end": "321000"
  },
  {
    "text": "for those kind of Legacy systems the Legacy applications that were still out there so there are two big questions we had to",
    "start": "321000",
    "end": "327780"
  },
  {
    "text": "answer was one how should we approach securing internal Azure communication so I want to have once something deployed",
    "start": "327780",
    "end": "334560"
  },
  {
    "text": "in Azure calling something else deployed in Azure how do we secure that communication and the answer is probably",
    "start": "334560",
    "end": "340020"
  },
  {
    "text": "not nothing like probably probably do some kind of authentication and authorization probably don't just leave",
    "start": "340020",
    "end": "345479"
  },
  {
    "text": "it open to anyone to be able to call and the second thing we're looking at was how do we how do we secure on-prem",
    "start": "345479",
    "end": "351919"
  },
  {
    "text": "applications calling into our microservices now I'm not a networking person uh so",
    "start": "351919",
    "end": "359039"
  },
  {
    "text": "I'm not going to talk about that at all because I will screw it all up we did we also had very smart networking people that knew how to do the network key",
    "start": "359039",
    "end": "366360"
  },
  {
    "text": "stuff uh I don't know subnets and v-nets and vpns all that sort of junk I don't know any of that stuff so like just",
    "start": "366360",
    "end": "372479"
  },
  {
    "text": "assume that that was all like there and figured out but not by me what we needed to do was okay let's say we can we can",
    "start": "372479",
    "end": "378780"
  },
  {
    "text": "still have these two systems you know secured behind the scenes and not open to the public well I still don't want to",
    "start": "378780",
    "end": "385199"
  },
  {
    "text": "necessarily just open up those apis to be called by anybody this client in particular uh was dealing",
    "start": "385199",
    "end": "391139"
  },
  {
    "text": "with personal information and Health Data and so we had to be very very careful about who we were going to be",
    "start": "391139",
    "end": "397620"
  },
  {
    "text": "giving out that data to especially in the states I'm sure it's the same as here here as well there's a lot of privacy laws and data protection laws",
    "start": "397620",
    "end": "404580"
  },
  {
    "text": "that we had to adhere to and it wasn't good enough for us to say well we got it secured to the front over there like the",
    "start": "404580",
    "end": "411120"
  },
  {
    "text": "the back and forth front end does the security and then behind the scenes is just you know Wild West anyone can go anything we wanted to make sure that we",
    "start": "411120",
    "end": "418259"
  },
  {
    "text": "could still properly lock down those apis so not anyone that was just on the",
    "start": "418259",
    "end": "423419"
  },
  {
    "text": "network could call these apis and get access to that personal health information so one of the ideas uh",
    "start": "423419",
    "end": "431039"
  },
  {
    "text": "um that's uh our security team uh really like latched on to and wanted to",
    "start": "431039",
    "end": "436680"
  },
  {
    "text": "implement as part of this was known as the zero trust model um which is this idea of of uh not just",
    "start": "436680",
    "end": "444539"
  },
  {
    "text": "assuming because you you made it past this certain points that that's good enough I don't have to do any further authentication or authorization",
    "start": "444539",
    "end": "451500"
  },
  {
    "text": "um instead with this idea of zero trust models that I don't ever I don't just trust any call that's made into me that",
    "start": "451500",
    "end": "457020"
  },
  {
    "text": "I always want to verify those individual calls now this is something like again if",
    "start": "457020",
    "end": "463440"
  },
  {
    "text": "you're a security consultant you're probably making Bank off of this kind of concept because it's very like vague and nebulous and it's hard to say what does",
    "start": "463440",
    "end": "469979"
  },
  {
    "text": "it actually mean in practice to do this kind of thing um so we said okay we'll we'll do that",
    "start": "469979",
    "end": "475440"
  },
  {
    "text": "okay we'll do the zero trust thing but then what does that actually mean in practice to always verify each individual step along the way",
    "start": "475440",
    "end": "483419"
  },
  {
    "text": "one possible way of doing this would be to say well we've already got this token for the front-end user they've already",
    "start": "483419",
    "end": "490020"
  },
  {
    "text": "authenticated and have this this token that can expire and can't be spoofed to",
    "start": "490020",
    "end": "496740"
  },
  {
    "text": "things like that so why don't we just quote um just flow that user token down into",
    "start": "496740",
    "end": "503400"
  },
  {
    "text": "the backend microservices so that's I don't have to come up with some other new authentication method behind the",
    "start": "503400",
    "end": "509099"
  },
  {
    "text": "scenes instead I could just use what they've already got like just use this token and then pass it along to the next one down the line",
    "start": "509099",
    "end": "515700"
  },
  {
    "text": "uh the problem with that well there's two two main problems uh one um because I'm using the same token in",
    "start": "515700",
    "end": "522899"
  },
  {
    "text": "my microservice that is being used by the front end that could mean that a front-end collar or an angular client",
    "start": "522899",
    "end": "529500"
  },
  {
    "text": "could call directly into my back and microservices and that's not something we wanted to allow like even though the",
    "start": "529500",
    "end": "535740"
  },
  {
    "text": "you know like maybe we've made sure the networking pieces that it wouldn't be possible um but we didn't want to just say you",
    "start": "535740",
    "end": "542160"
  },
  {
    "text": "know if you have a token you can call our apis uh because we didn't want we didn't want to allow the external",
    "start": "542160",
    "end": "548580"
  },
  {
    "text": "clients to in any way shape or form be able to call into our backend microservices",
    "start": "548580",
    "end": "554160"
  },
  {
    "text": "the other problem we're running into were these on-prem systems uh didn't have a token like their existing uh",
    "start": "554160",
    "end": "561360"
  },
  {
    "text": "existing monolith that was using cookie based authentication and authorization they didn't have a token so we would",
    "start": "561360",
    "end": "567779"
  },
  {
    "text": "have to somehow like okay let's let's make a token based on this cookie and now I get a token to be able to call",
    "start": "567779",
    "end": "573540"
  },
  {
    "text": "into you and everything's good um so that was like that was gonna be way too complicated as well to try to deal with like all these different",
    "start": "573540",
    "end": "579420"
  },
  {
    "text": "possible callers uh these different possible scenarios um because even though I just got like",
    "start": "579420",
    "end": "584700"
  },
  {
    "text": "three on-prem things there were actually like I know five or six different distinct authentication and identity",
    "start": "584700",
    "end": "591899"
  },
  {
    "text": "providers because of Acquisitions over the years so given all that like the uh the",
    "start": "591899",
    "end": "598560"
  },
  {
    "text": "security team said okay yes um to help simplify things uh because we know that you're deployed inside of azure",
    "start": "598560",
    "end": "606600"
  },
  {
    "text": "um we can use Azure security model to see to authenticate and authorize those inter-service communication calls",
    "start": "606600",
    "end": "613860"
  },
  {
    "text": "and so the various on-prem systems and",
    "start": "613860",
    "end": "618959"
  },
  {
    "text": "external clients would still use their own identity providers to be able to",
    "start": "618959",
    "end": "624060"
  },
  {
    "text": "authenticate the users but then once we were inside the Walled Garden of azure and we were you know basically just",
    "start": "624060",
    "end": "629820"
  },
  {
    "text": "completely cut off we've cut off the communication from external users in that case we can use Azure security",
    "start": "629820",
    "end": "636899"
  },
  {
    "text": "model and for a number of reasons which which we'll see shortly",
    "start": "636899",
    "end": "642380"
  },
  {
    "text": "so uh yes um we said great let's do Azure ID",
    "start": "642779",
    "end": "649380"
  },
  {
    "text": "um zero trust Azure D great and that was given this design was given to my team and I said okay then uh security team",
    "start": "649380",
    "end": "655500"
  },
  {
    "text": "how do we implement this and then I heard like the rapid scurring of feet as they ran out the door because they just",
    "start": "655500",
    "end": "660959"
  },
  {
    "text": "drew a picture of us it's like yeah just use this model and it came time to my team like okay how do we use this model",
    "start": "660959",
    "end": "667200"
  },
  {
    "text": "um this was a more conceptual idea from them and our team had to actually implement it",
    "start": "667200",
    "end": "672860"
  },
  {
    "text": "so um the first thing we had to figure out was well if I have service a wanting to",
    "start": "672860",
    "end": "679380"
  },
  {
    "text": "call service B and service B needs to have a I want to have some kind of token that says this",
    "start": "679380",
    "end": "686820"
  },
  {
    "text": "is calling this is calling from service a and I know it's this identity of service a uh we need to figure out how",
    "start": "686820",
    "end": "693420"
  },
  {
    "text": "to First authenticate that service a to begin with now Azure ID supports a variety of",
    "start": "693420",
    "end": "701279"
  },
  {
    "text": "authentication flows and the ones that we were looking at a particular were oauth 2.0 flows",
    "start": "701279",
    "end": "707459"
  },
  {
    "text": "and I am not an oauth experts they're they're a lot of people much smarter than me about this but me my team we had",
    "start": "707459",
    "end": "713279"
  },
  {
    "text": "to implement this so we had to look at this and try to figure out okay well uh what what is the right way for us to",
    "start": "713279",
    "end": "718620"
  },
  {
    "text": "even acquire a token like of 1.0 has some pretty simple ways of doing so oauth 2.0 its authentication flow has",
    "start": "718620",
    "end": "725160"
  },
  {
    "text": "become a bit more complicated now one thing that's a little bit different with Azure ad with some other",
    "start": "725160",
    "end": "730800"
  },
  {
    "text": "identity providers and this client also was using identity server now duende those can support like really any kind",
    "start": "730800",
    "end": "738779"
  },
  {
    "text": "of authentication flow you want what Azure ID tries to do though is try to guide you down the correct paths for",
    "start": "738779",
    "end": "744779"
  },
  {
    "text": "these different kinds of authentication flows so for some of these authentication flows they won't allow certain ways of calling into it to say",
    "start": "744779",
    "end": "751140"
  },
  {
    "text": "well you shouldn't be using this flow in this kind of scenario so we're just going to not allow it at all",
    "start": "751140",
    "end": "757560"
  },
  {
    "text": "so um their docs uh describe here the different kinds of flows you can have or the base are these different scenarios",
    "start": "757560",
    "end": "763680"
  },
  {
    "text": "and here's the oauth flow you should use and then uh who are the kinds of audiences that can acquire these kinds",
    "start": "763680",
    "end": "770040"
  },
  {
    "text": "of tokens so he looked at this picture like okay there's nothing that's like BFF microservice scenario but we did see at",
    "start": "770040",
    "end": "778139"
  },
  {
    "text": "the bottom here well here's some two here's two things that looks pretty similar to what we're trying to do which is I have a web API that calls other web",
    "start": "778139",
    "end": "785100"
  },
  {
    "text": "apis that's our backend for front and API it is a thing that the angular app",
    "start": "785100",
    "end": "790260"
  },
  {
    "text": "is calling angular app calls the BFF API and then that API is then calling our microservice API so that looks like it's",
    "start": "790260",
    "end": "797040"
  },
  {
    "text": "the right one uh we also have situations where we don't have any user context",
    "start": "797040",
    "end": "805380"
  },
  {
    "text": "and uh or at least the user context that we can use to acquire a token and so for that it was a demon app that calls web",
    "start": "805380",
    "end": "812100"
  },
  {
    "text": "apis and so you can kind of think of this like well what if you've got a background service a messaging endpoint",
    "start": "812100",
    "end": "818040"
  },
  {
    "text": "or something like that where there's no direct user interaction so there's not a user logging in to do anything and so",
    "start": "818040",
    "end": "824940"
  },
  {
    "text": "for that one I don't have like a username password I can use instead we can use the client credentials flow to",
    "start": "824940",
    "end": "830519"
  },
  {
    "text": "do so um now looking at the web API they calls",
    "start": "830519",
    "end": "836519"
  },
  {
    "text": "web apis uh we can we could use what's known as the on behalf of flow and the",
    "start": "836519",
    "end": "841920"
  },
  {
    "text": "idea here is that when I call a first API that API is going to call out to my",
    "start": "841920",
    "end": "847800"
  },
  {
    "text": "oauth provider my oauth server to acquire a machine token on behalf of this user token",
    "start": "847800",
    "end": "854100"
  },
  {
    "text": "so that way when I get to my backend apis they're not they're not passing through the user token because I don't",
    "start": "854100",
    "end": "861060"
  },
  {
    "text": "want to expose my backend apis directly to the outside world instead they're passing through this machine token that",
    "start": "861060",
    "end": "866579"
  },
  {
    "text": "was acquired on behalf of the original token that was provided now this works great if I'm in this",
    "start": "866579",
    "end": "874500"
  },
  {
    "text": "audience of work or school accounts that fun thing from Microsoft identity that's like you're like when you use live.com",
    "start": "874500",
    "end": "881459"
  },
  {
    "text": "versus microsoft.com authentication I don't know why those are still different but those are the work or school",
    "start": "881459",
    "end": "886500"
  },
  {
    "text": "accounts or if you're in live.com that's your personal account uh and that that's who the original audience of the token",
    "start": "886500",
    "end": "893040"
  },
  {
    "text": "can be but that's not us we're not in Azure ID world and user",
    "start": "893040",
    "end": "899339"
  },
  {
    "text": "land and user land we were like homegrown authentic authentication provider that was probably like you know",
    "start": "899339",
    "end": "905339"
  },
  {
    "text": "Microsoft identity from asp.webforms Days uh and so that just had a cookie so I didn't have uh I don't have a token to",
    "start": "905339",
    "end": "912779"
  },
  {
    "text": "begin with um and in the front inside this this new angular application uh was using",
    "start": "912779",
    "end": "918779"
  },
  {
    "text": "initially identity server and was moving moving to uh off zero so those are two",
    "start": "918779",
    "end": "924600"
  },
  {
    "text": "completely different identity providers neither of which are Microsoft so he said great although we're like supposed",
    "start": "924600",
    "end": "931019"
  },
  {
    "text": "to use the on behalf of flow that's out because we can't acquire a token on",
    "start": "931019",
    "end": "936300"
  },
  {
    "text": "behalf of like a token that's not Microsoft so that left us at the very end with just the client credentials",
    "start": "936300",
    "end": "943019"
  },
  {
    "text": "flow and last time I gave this talk someone came up to the ends like so the moral of the stories just use client credentials I'm like well well yeah um",
    "start": "943019",
    "end": "950880"
  },
  {
    "text": "but um again that's easier said than done because uh these oauth credential flows",
    "start": "950880",
    "end": "958199"
  },
  {
    "text": "really only talk about Authentication that does not describe authorization",
    "start": "958199",
    "end": "963959"
  },
  {
    "text": "that is who and in these different flows how do I make sure that I don't let",
    "start": "963959",
    "end": "969300"
  },
  {
    "text": "anyone with a token even if it's a valid uh uh valid Microsoft based Azure ID",
    "start": "969300",
    "end": "975000"
  },
  {
    "text": "token I don't want any application to be able to just call into my my apis because we are dealing with this",
    "start": "975000",
    "end": "982500"
  },
  {
    "text": "um this this legally protected information Health Data personal data that sort of thing",
    "start": "982500",
    "end": "988519"
  },
  {
    "text": "so um our next uh thing we need to figure out was how do we then authorize these different",
    "start": "988980",
    "end": "994800"
  },
  {
    "text": "applications to be able to call our apis so how do we make sure that only the right apps are the ones that can do so",
    "start": "994800",
    "end": "1002480"
  },
  {
    "text": "and this is one that uh oauth 2.0 doesn't have any recommendation for like",
    "start": "1002480",
    "end": "1007699"
  },
  {
    "text": "it's completely up to your application how you decide to authorize individual",
    "start": "1007699",
    "end": "1013220"
  },
  {
    "text": "apps calling other apps and so all the different identity providers really have like their own like made up way of doing",
    "start": "1013220",
    "end": "1019759"
  },
  {
    "text": "so so if you go look at auth zero it supports client credentials flow if you want to do authorization to say like",
    "start": "1019759",
    "end": "1026058"
  },
  {
    "text": "only this API can call that API and not just anyone with a token from this issuer they have their own like made up",
    "start": "1026059",
    "end": "1032178"
  },
  {
    "text": "way of doing so a lot of people use claims so like I uh I say I want to call",
    "start": "1032179",
    "end": "1037938"
  },
  {
    "text": "this other API and then I'm issued a set of claims but again that's something that you just have to completely make up",
    "start": "1037939",
    "end": "1043699"
  },
  {
    "text": "yourself you have to design that for uh what for what you want to do or",
    "start": "1043699",
    "end": "1049760"
  },
  {
    "text": "um for Microsoft talks they they have like they have two main ways you can do this uh the first one they had was an access",
    "start": "1049760",
    "end": "1056179"
  },
  {
    "text": "control list and I was like oh that's kind of cool you have a you have these ACLS that you define like who who are",
    "start": "1056179",
    "end": "1062900"
  },
  {
    "text": "the who are the appropriate apps that can call into me um but they don't have any necessarily they don't have any support of actually",
    "start": "1062900",
    "end": "1069440"
  },
  {
    "text": "configuring this inside of azure it's like no no when you do ACL it is not 100 your client code and API code that has",
    "start": "1069440",
    "end": "1077299"
  },
  {
    "text": "to say who or who is calling me and are they the right person so for simple systems this can work if I",
    "start": "1077299",
    "end": "1084260"
  },
  {
    "text": "say like I know that these are my three callers that are allowed to call me I can just look at the token and say well",
    "start": "1084260",
    "end": "1089360"
  },
  {
    "text": "you're one of these three people and then somewhere in my application um in my configuration I have the list of these are the three people that can",
    "start": "1089360",
    "end": "1095240"
  },
  {
    "text": "call me and no one else but it's just like 100 custom logic about what you actually do there",
    "start": "1095240",
    "end": "1101780"
  },
  {
    "text": "something that um Microsoft supports though is this idea of application permissions",
    "start": "1101780",
    "end": "1108500"
  },
  {
    "text": "and uh when we go the application permission routes then we are actually configuring uh the secured resources",
    "start": "1108500",
    "end": "1117260"
  },
  {
    "text": "inside of azure to be able to do so so if I'm on the left it's 100 custom code in my application and in the right it is",
    "start": "1117260",
    "end": "1124960"
  },
  {
    "text": "configuration inside of azure ID to build this out so",
    "start": "1124960",
    "end": "1131120"
  },
  {
    "text": "um these application permissions we can Define custom they're called roles whatever but they're they're permissions",
    "start": "1131120",
    "end": "1137240"
  },
  {
    "text": "and then we assign those roles to specific principles",
    "start": "1137240",
    "end": "1142280"
  },
  {
    "text": "um and then when I acquire a token for for service a calling service B service a will ask uh Azure ID to say hello I am",
    "start": "1142280",
    "end": "1151039"
  },
  {
    "text": "service a I want to call service B Azure ID looks up and says who uh well",
    "start": "1151039",
    "end": "1156440"
  },
  {
    "text": "based on service a which roles or permissions have you do you have",
    "start": "1156440",
    "end": "1161720"
  },
  {
    "text": "assigned to service B and then the token that comes back will then contain the roles assigned to service a for service",
    "start": "1161720",
    "end": "1168799"
  },
  {
    "text": "B and in this way instead of having like these kind of generic um claims that don't necessarily do like",
    "start": "1168799",
    "end": "1176179"
  },
  {
    "text": "are tied to individual callers instead what we can have is very specific uh",
    "start": "1176179",
    "end": "1181780"
  },
  {
    "text": "role assignments to say um the service a you can call these",
    "start": "1181780",
    "end": "1187340"
  },
  {
    "text": "different kinds of things but service C you're not allowed to have that much access to data because you're going to",
    "start": "1187340",
    "end": "1192740"
  },
  {
    "text": "be using this purpose so you only have these specific role permissions assigned to you and then on the server side when it",
    "start": "1192740",
    "end": "1199220"
  },
  {
    "text": "receives that request the server will then actually do the code to authorize the individual roles",
    "start": "1199220",
    "end": "1206740"
  },
  {
    "text": "now in terms of like which one of these kinds of ways of doing things is better it is really specific to uh you know",
    "start": "1206740",
    "end": "1212720"
  },
  {
    "text": "your domain and your application um that's like one is necessarily better than the other there's going to be trade-offs to each of these approaches",
    "start": "1212720",
    "end": "1218419"
  },
  {
    "text": "for us though we knew that uh because we are had protected Health Data",
    "start": "1218419",
    "end": "1224600"
  },
  {
    "text": "um that we knew that some apis that we built would have more I guess more",
    "start": "1224600",
    "end": "1230360"
  },
  {
    "text": "protected data than others so if you were calling an API that doesn't have that protected data we let more people in to be able to call that but if you",
    "start": "1230360",
    "end": "1236840"
  },
  {
    "text": "were wanting to get that protected health information and personal information they said well we don't want",
    "start": "1236840",
    "end": "1242299"
  },
  {
    "text": "to let anyone be able to call this we're going to authorize these specific applications to be able to call us because we knew that those applications",
    "start": "1242299",
    "end": "1248720"
  },
  {
    "text": "could then do the extra kind of business logic to hide specific data based on lots of crazy business rules",
    "start": "1248720",
    "end": "1255559"
  },
  {
    "text": "so for us that's what we we thought okay let's do these permissions because then that lets us have much more granular",
    "start": "1255559",
    "end": "1261260"
  },
  {
    "text": "control about who which specific applications are authorized to call my apis",
    "start": "1261260",
    "end": "1268000"
  },
  {
    "text": "So based on that picture we built out a greatly simplified application and we could we could get it",
    "start": "1268100",
    "end": "1274039"
  },
  {
    "text": "down to basically just this kind of these these kinds of clients and these kinds of servers so in this much",
    "start": "1274039",
    "end": "1280280"
  },
  {
    "text": "simplified scenario we we got rid of all like the kubernetes stuff because I don't want to deal with that stuff anyway and we had this this greatly",
    "start": "1280280",
    "end": "1286820"
  },
  {
    "text": "simplified picture where we have the two different kinds of clients one is a client deployed inside of azure and then",
    "start": "1286820",
    "end": "1293600"
  },
  {
    "text": "we have another client deployed outside of azure and for me outside of azure is just going to be",
    "start": "1293600",
    "end": "1299000"
  },
  {
    "text": "this laptop here and then our server will also be deployed inside of azure as",
    "start": "1299000",
    "end": "1304700"
  },
  {
    "text": "well the server and the Azure client are just going to be Azure app services to",
    "start": "1304700",
    "end": "1310039"
  },
  {
    "text": "make my life a bit simpler and then the external client is just going to be a console app on my laptop",
    "start": "1310039",
    "end": "1317200"
  },
  {
    "text": "all right um so we said great let's do this uh roll based off with these permissions",
    "start": "1317600",
    "end": "1323600"
  },
  {
    "text": "and so the next thing we needed to do was to Define what those permissions should be and this is a design decision",
    "start": "1323600",
    "end": "1330080"
  },
  {
    "text": "that we had to make as the people defining the system how granular or coarse grain should these roles be and",
    "start": "1330080",
    "end": "1337880"
  },
  {
    "text": "again even though they're called roles inside of azure in practice we Define",
    "start": "1337880",
    "end": "1343700"
  },
  {
    "text": "them words like permissions to perform a specific kind of activity and the built-in roles inside Azure ad as well",
    "start": "1343700",
    "end": "1350179"
  },
  {
    "text": "mapped to that as well so this API uh that we're going to have",
    "start": "1350179",
    "end": "1357860"
  },
  {
    "text": "for our demo um is just a to-do API so I can get all",
    "start": "1357860",
    "end": "1363080"
  },
  {
    "text": "the two items I can get a single to do item I can update a to-do item I can create a to-do item or I can delete a",
    "start": "1363080",
    "end": "1369919"
  },
  {
    "text": "to-do item and I chose this example because I could find the code for it on the internet and I can use it and not",
    "start": "1369919",
    "end": "1375620"
  },
  {
    "text": "have to come up with something myself I'm just that lazy okay so based on this",
    "start": "1375620",
    "end": "1381559"
  },
  {
    "text": "um we need to figure out well what what kind of permissions should we Define for",
    "start": "1381559",
    "end": "1387020"
  },
  {
    "text": "each of these different API endpoints we could Define a distinct permission per",
    "start": "1387020",
    "end": "1392480"
  },
  {
    "text": "individual thing you're trying to do so I can have like a read like a crud right read update create delete",
    "start": "1392480",
    "end": "1400760"
  },
  {
    "text": "and if I have other kinds of operations as part of these things so if you needed to like I don't know approve a to-do",
    "start": "1400760",
    "end": "1405919"
  },
  {
    "text": "item I could have like to do that approve because that's a specific permission um so I did we did have to go back and",
    "start": "1405919",
    "end": "1412520"
  },
  {
    "text": "understand well what are the different kinds of callers I'm going to have in my applications uh and what is the kind of",
    "start": "1412520",
    "end": "1417919"
  },
  {
    "text": "the shape or surface area of those different kinds of things they should be called the more permissions I create",
    "start": "1417919",
    "end": "1425120"
  },
  {
    "text": "like the more control I have but then the more over I had I will have to maintain these to say like well if I",
    "start": "1425120",
    "end": "1431240"
  },
  {
    "text": "want to do these six things I got to go Grant you permission for those six things so uh the other way to do is be a little",
    "start": "1431240",
    "end": "1437299"
  },
  {
    "text": "bit more coarse grained um and so we can do something like just read and write to say I have Sunset",
    "start": "1437299",
    "end": "1443900"
  },
  {
    "text": "some sets of applications that can read and write data and they have other sets of applications that are only allowed to",
    "start": "1443900",
    "end": "1450679"
  },
  {
    "text": "read data we don't want to allow them to write that data um and so for our actual real system this is more the path we went through is",
    "start": "1450679",
    "end": "1457400"
  },
  {
    "text": "just looking at okay there's uh there's like read there's write and there's also like read protected like read protected",
    "start": "1457400",
    "end": "1464120"
  },
  {
    "text": "data or read Health Data um and so we we basically shaped and defined those permissions based on the",
    "start": "1464120",
    "end": "1470840"
  },
  {
    "text": "business use cases that we were uh that we saw in our system uh we can change these as well we don't",
    "start": "1470840",
    "end": "1477380"
  },
  {
    "text": "we can add new permissions we need to we need to uh like go to a different role or make it more grainler that's all",
    "start": "1477380",
    "end": "1483559"
  },
  {
    "text": "possible as well all right enough talk let's go look at a demo",
    "start": "1483559",
    "end": "1490760"
  },
  {
    "text": "all right now I am doing the scary thing of doing an",
    "start": "1490760",
    "end": "1495919"
  },
  {
    "text": "Azure cloud-based talk on conference Wi-Fi so let's all cross our fingers to see how well this is going to work",
    "start": "1495919",
    "end": "1502400"
  },
  {
    "text": "but it was working just a few minutes ago so hopefully it'll all be okay",
    "start": "1502400",
    "end": "1507280"
  },
  {
    "text": "all right",
    "start": "1507860",
    "end": "1510400"
  },
  {
    "text": "all right is this big enough for the folks in the back all right I can't see anything so I",
    "start": "1513799",
    "end": "1519980"
  },
  {
    "text": "guess it's okay all right so this is my simplified application system here I've got my Azure clients that is an asp.net",
    "start": "1519980",
    "end": "1528140"
  },
  {
    "text": "6 app that is deployed out into azure",
    "start": "1528140",
    "end": "1533360"
  },
  {
    "text": "I have my Azure server which is also an asp.net6 app web app deployed into Azure",
    "start": "1533360",
    "end": "1538460"
  },
  {
    "text": "and then I have my external client which is just a console application which is only going to be running on my laptop",
    "start": "1538460",
    "end": "1543620"
  },
  {
    "text": "here and the final thing I have here is in my this infrastructure project",
    "start": "1543620",
    "end": "1549440"
  },
  {
    "text": "um it's can be very complicated to understand how things relate to each other inside of azure so I I when I",
    "start": "1549440",
    "end": "1557360"
  },
  {
    "text": "first did this I set up all these different things using the Azure portal um but once you're done setting",
    "start": "1557360",
    "end": "1563299"
  },
  {
    "text": "everything up you kind of forget like what are all the things I clicked to make this work I forget um and so for us like my real team was",
    "start": "1563299",
    "end": "1569659"
  },
  {
    "text": "using terraform I I don't like that weird language so I'm using uh pollumi because hey C sharp one of the nice",
    "start": "1569659",
    "end": "1576140"
  },
  {
    "text": "things we can do with this is uh as we're building out these resources instead of me clicking around the portal which can fail I'll be showing here the",
    "start": "1576140",
    "end": "1582260"
  },
  {
    "text": "resources in c-sharp code which are just mapping the notes to uh Azure resources this is not a talk about pollumi it's",
    "start": "1582260",
    "end": "1589400"
  },
  {
    "text": "just way easier to conceptualize things when looking at code versus click click click click inside the Azure portal",
    "start": "1589400",
    "end": "1597260"
  },
  {
    "text": "all right so right now this API is not secured whatsoever so if I go over to program CS",
    "start": "1597260",
    "end": "1605240"
  },
  {
    "text": "we can see that it does not have any kind of like authentication or authentication authorization but it's",
    "start": "1605240",
    "end": "1611539"
  },
  {
    "text": "not defined any kind of means of doing so um so I've not yet told it how it should",
    "start": "1611539",
    "end": "1618020"
  },
  {
    "text": "authenticate uh to be able to do anything and just to prove that these are",
    "start": "1618020",
    "end": "1623840"
  },
  {
    "text": "actually in Azure I've got this is my clients on the free tier so please don't go hit this it's it's very slow there we",
    "start": "1623840",
    "end": "1630980"
  },
  {
    "text": "go so I've got this actually deployed on Azure but for a lot of this we just running on my local laptop here",
    "start": "1630980",
    "end": "1637039"
  },
  {
    "text": "okay so uh we'll go back over to our palumi infrastructure",
    "start": "1637039",
    "end": "1642500"
  },
  {
    "text": "and um the way plume works is uh you can you can do this from the command line where you say like you install the",
    "start": "1642500",
    "end": "1648740"
  },
  {
    "text": "client tools and you say pull me up it will compile this application and then based on the things I've defined on here",
    "start": "1648740",
    "end": "1654380"
  },
  {
    "text": "it will then create those resources out in Azure I've already created all those resources so I won't actually be",
    "start": "1654380",
    "end": "1660799"
  },
  {
    "text": "updating as we go we'll look at more of the final product at the end because I don't trust the speed of creating these resources sometimes it can take just a",
    "start": "1660799",
    "end": "1667039"
  },
  {
    "text": "little bit of time all right so in my stack this palumi stack we created I created",
    "start": "1667039",
    "end": "1674059"
  },
  {
    "text": "just a a few things from the from the get go to make my life a little bit easier so the first thing I've created",
    "start": "1674059",
    "end": "1679520"
  },
  {
    "text": "is a resource Group that everything is going to be under",
    "start": "1679520",
    "end": "1685340"
  },
  {
    "text": "um and then I'm also going to be creating some app Services Under this app service plan all right so the first thing we're going",
    "start": "1685340",
    "end": "1691520"
  },
  {
    "text": "to do is in our server we're going to define the Azure resources uh necessary",
    "start": "1691520",
    "end": "1698900"
  },
  {
    "text": "for both deploying the application and also securing it so let me go ahead and pull this over",
    "start": "1698900",
    "end": "1704900"
  },
  {
    "text": "first [Music]",
    "start": "1704900",
    "end": "1710059"
  },
  {
    "text": "I was going to use a mouse but this is slope like this and so the mouse just kept falling down",
    "start": "1710059",
    "end": "1716480"
  },
  {
    "text": "all right so uh first up I've got my Azure web app so this is an Azure app",
    "start": "1716480",
    "end": "1723080"
  },
  {
    "text": "service I'm going to be deploying um and so this is the the actual deployed application inside of azure the",
    "start": "1723080",
    "end": "1729500"
  },
  {
    "text": "only kind of interesting thing we have here is like we're turning in HTTPS I'm telling it what Resource Group uh where",
    "start": "1729500",
    "end": "1735200"
  },
  {
    "text": "the location should be which I think right now is still like Central us whatever and uh that when it runs it",
    "start": "1735200",
    "end": "1740299"
  },
  {
    "text": "should run.net azure server.dll all right so that's just the running",
    "start": "1740299",
    "end": "1746600"
  },
  {
    "text": "application the next thing I'm going to need is going to be the Azure ID components so for this",
    "start": "1746600",
    "end": "1754400"
  },
  {
    "text": "here all right",
    "start": "1754400",
    "end": "1759799"
  },
  {
    "text": "so every like identity provider that supports client credentials has",
    "start": "1759799",
    "end": "1765679"
  },
  {
    "text": "different ways of defining these applications that I'm going to secure so auth0 has its own like definition of",
    "start": "1765679",
    "end": "1772279"
  },
  {
    "text": "have like what are the different applications and servers that could be secured and Azure ID has its own way of",
    "start": "1772279",
    "end": "1778220"
  },
  {
    "text": "defining these things as well because again auth0 defines a protocol it doesn't Define like how you should actually manage this behind the scenes",
    "start": "1778220",
    "end": "1785179"
  },
  {
    "text": "like how do I actually manage what are the different applications what can call each other that is completely up to you and so or completely up to the identity",
    "start": "1785179",
    "end": "1791299"
  },
  {
    "text": "provider so in this case we are creating what's known as a Azure ad application",
    "start": "1791299",
    "end": "1797960"
  },
  {
    "text": "called server application and not a whole lot of information here",
    "start": "1797960",
    "end": "1804140"
  },
  {
    "text": "I'm just giving it a display name and then some identifier Uris which when we come when it comes time to actually",
    "start": "1804140",
    "end": "1809840"
  },
  {
    "text": "calling uh and trying to acquire a token that's where the identifier URL will become important",
    "start": "1809840",
    "end": "1816080"
  },
  {
    "text": "all right so we said we needed to uh Define some roles for this uh this application and",
    "start": "1816080",
    "end": "1824779"
  },
  {
    "text": "so I need to create that as part of this as well so the next I'm going to do is pull over some definitions of some role",
    "start": "1824779",
    "end": "1832159"
  },
  {
    "text": "IDs and so what these are each role will have a have a unique identifier and I",
    "start": "1832159",
    "end": "1838580"
  },
  {
    "text": "need to refer that to identifier in other places so I'm using plumy's random uuid to be able to define those IDs so",
    "start": "1838580",
    "end": "1846380"
  },
  {
    "text": "they can more easily refer them to other places and then the final thing is to modify my",
    "start": "1846380",
    "end": "1854299"
  },
  {
    "text": "application definition to give it some app roles so let me go and pull this over here",
    "start": "1854299",
    "end": "1861580"
  },
  {
    "text": "okay so I'm still modifying the server application and in Azure ID This Server",
    "start": "1861740",
    "end": "1868580"
  },
  {
    "text": "application this this Azure ID to application object is just a way for me to kind of group together and Define",
    "start": "1868580",
    "end": "1874760"
  },
  {
    "text": "like this is some kind of secured resource that you want to apply some logic to it is not actually something is",
    "start": "1874760",
    "end": "1881240"
  },
  {
    "text": "that something that's running somewhere it's just a bunch of data about something that you want to secure",
    "start": "1881240",
    "end": "1887620"
  },
  {
    "text": "all right so I've said I want to Define two app roles one is to do that read and",
    "start": "1887659",
    "end": "1894080"
  },
  {
    "text": "the other is to do dot write and so my to do dot read I tell it these are the kinds of assignments you you are",
    "start": "1894080",
    "end": "1902059"
  },
  {
    "text": "allowed to have and so I have said that you can assign this role to users and you can assign this roles to",
    "start": "1902059",
    "end": "1908299"
  },
  {
    "text": "Applications now I don't technically need that first one users because these are applications",
    "start": "1908299",
    "end": "1914000"
  },
  {
    "text": "calling other applications however when I'm testing this locally on my laptop well I am a user and so I still want to",
    "start": "1914000",
    "end": "1920720"
  },
  {
    "text": "be able to call this API and have it still go through all the authorization so we'll also allow those roles to be",
    "start": "1920720",
    "end": "1927020"
  },
  {
    "text": "assigned to users as well it's enabled here's the display stuff",
    "start": "1927020",
    "end": "1932299"
  },
  {
    "text": "and then finally the ID of the role I'm giving it the value here if I don't give it an ID here it'll just make something",
    "start": "1932299",
    "end": "1938419"
  },
  {
    "text": "up and they'll have to copy and paste that made up ID all over the place so here I'm defining the ID so that I can I",
    "start": "1938419",
    "end": "1945860"
  },
  {
    "text": "it's determine this thing I know exactly what that ID is uh for that do the same thing for rights to do that rights",
    "start": "1945860",
    "end": "1952640"
  },
  {
    "text": "at this point when I uh when I configure this application or configure this uh",
    "start": "1952640",
    "end": "1958039"
  },
  {
    "text": "this resource I will have this Azure ad example server application defined",
    "start": "1958039",
    "end": "1964340"
  },
  {
    "text": "inside of azure ad and now I need to then in my server",
    "start": "1964340",
    "end": "1971360"
  },
  {
    "text": "actually authorize against this information here",
    "start": "1971360",
    "end": "1976659"
  },
  {
    "text": "so let's now go over to our actual server application so over here",
    "start": "1976820",
    "end": "1982820"
  },
  {
    "text": "I've got that web API that we created and right now it's not authenticating or",
    "start": "1982820",
    "end": "1988159"
  },
  {
    "text": "authorizing against Azure ad and in order to authorize against Azure ID I could do things manually right I",
    "start": "1988159",
    "end": "1995120"
  },
  {
    "text": "could go look at the jots coming in and then I can look at the audience I can look at the issuer and be like okay",
    "start": "1995120",
    "end": "2001840"
  },
  {
    "text": "these all kind of line up but to help simplify things Microsoft has a library so if I'm an API",
    "start": "2001840",
    "end": "2009640"
  },
  {
    "text": "they want to be secured with Azure ID I can pull in this microsoft.identity.web package to make",
    "start": "2009640",
    "end": "2016779"
  },
  {
    "text": "it much easier for my server API to authenticate and authorize against Azure ID",
    "start": "2016779",
    "end": "2023519"
  },
  {
    "text": "not required but makes my life quite a bit easier because as we'll see let's go back over here",
    "start": "2024640",
    "end": "2030760"
  },
  {
    "text": "I'll go and pull this over now to stick this up top needs to be down",
    "start": "2030760",
    "end": "2037419"
  },
  {
    "text": "here we are going to say",
    "start": "2037419",
    "end": "2044039"
  },
  {
    "text": "builder.services.add Microsoft identity web web APA authentication passing it in",
    "start": "2044399",
    "end": "2050080"
  },
  {
    "text": "our configuration and so what that will do is for incoming requests it will do the uh it'll it'll",
    "start": "2050080",
    "end": "2057878"
  },
  {
    "text": "it'll look at the token make sure that it's against the correct issuer against the correct audience and against the the",
    "start": "2057879",
    "end": "2064780"
  },
  {
    "text": "right subject all for me behind the scenes and then all I have to do in my configuration",
    "start": "2064780",
    "end": "2070960"
  },
  {
    "text": "is tell it what I should authenticate here we go",
    "start": "2070960",
    "end": "2077820"
  },
  {
    "text": "all right so in this I will tell it's the Azure ad instance and so I don't",
    "start": "2078099",
    "end": "2083740"
  },
  {
    "text": "have like my own custom Azure ID login so it's just going to be the login.microsoftonline.com",
    "start": "2083740",
    "end": "2089679"
  },
  {
    "text": "and then these next things tenant ID and client ID this is what's defined then in Azure ID",
    "start": "2089679",
    "end": "2097599"
  },
  {
    "text": "so the tenant ID is going to be the tenants of your Azure ad directory and then which is basically a bucket of",
    "start": "2097599",
    "end": "2104320"
  },
  {
    "text": "things you can secure and then the client ID this is what's going to be the first confusing thing of azure ID and",
    "start": "2104320",
    "end": "2109900"
  },
  {
    "text": "definitely won't be the last this is the unique identifier of",
    "start": "2109900",
    "end": "2116578"
  },
  {
    "text": "This Server application thing here so this right here is uh out Pops from",
    "start": "2116619",
    "end": "2125859"
  },
  {
    "text": "this we'll uh get a a unique identifier and if I go over to my Azure portal",
    "start": "2125859",
    "end": "2132720"
  },
  {
    "text": "all right so so over here under Azure active directory there's an app registrations and this is the list of",
    "start": "2133660",
    "end": "2141280"
  },
  {
    "text": "applications they're also called out called app registrations because Microsoft likes to rename things every",
    "start": "2141280",
    "end": "2146980"
  },
  {
    "text": "three years or so uh so this these app registrations are those applications that have defined uh in Azure ID so I've",
    "start": "2146980",
    "end": "2154420"
  },
  {
    "text": "got my server here and uh right here we can see this",
    "start": "2154420",
    "end": "2160900"
  },
  {
    "text": "application parentheses client ID and this is the unique identifier of this",
    "start": "2160900",
    "end": "2166960"
  },
  {
    "text": "securable resource now this is not tied to my app service right now like my app",
    "start": "2166960",
    "end": "2172060"
  },
  {
    "text": "service when it runs will raise its hand and say hello I am this client application ID and so whenever it",
    "start": "2172060",
    "end": "2178540"
  },
  {
    "text": "authenticates and authorizes those tokens is going to be doing so Under the",
    "start": "2178540",
    "end": "2183700"
  },
  {
    "text": "Umbrella being this application okay so over here in my app settings",
    "start": "2183700",
    "end": "2189460"
  },
  {
    "text": "Json we can see that the client ID is F12 something and right here the application client ID is F12 something",
    "start": "2189460",
    "end": "2197320"
  },
  {
    "text": "so those line up all right",
    "start": "2197320",
    "end": "2202780"
  },
  {
    "text": "um so this will authenticate calls being made in but we wanted to add on top of",
    "start": "2202780",
    "end": "2208900"
  },
  {
    "text": "this some role-based authorization so we're going to do that in our",
    "start": "2208900",
    "end": "2213940"
  },
  {
    "text": "controllers if I go to my to do items controller controller we can see that it's already doing the authorize so it",
    "start": "2213940",
    "end": "2220480"
  },
  {
    "text": "will you know do the do the thing to make sure the token looks good but we want to on each of our different controller actions authorize the",
    "start": "2220480",
    "end": "2228640"
  },
  {
    "text": "appropriate role that we defined earlier role being the permission",
    "start": "2228640",
    "end": "2234220"
  },
  {
    "text": "so over here this is a get so the get is going to be the 2d.read yep this is",
    "start": "2234220",
    "end": "2240400"
  },
  {
    "text": "another git so that's a to-do.read this is put so it's going to be to do",
    "start": "2240400",
    "end": "2246400"
  },
  {
    "text": "dot right this is post to do.writes",
    "start": "2246400",
    "end": "2252579"
  },
  {
    "text": "and then delete oh wrong place",
    "start": "2252579",
    "end": "2259240"
  },
  {
    "text": "it's way easier with the mouse to do that right all right",
    "start": "2259240",
    "end": "2265079"
  },
  {
    "text": "so there's a few things that are going to happen behind the scenes for us so like my first encounter with role-based",
    "start": "2265240",
    "end": "2272079"
  },
  {
    "text": "authorization was that I was doing cookie based authorization and it would look at like the the roles assigned to",
    "start": "2272079",
    "end": "2277599"
  },
  {
    "text": "that identity and look at that sort of thing so this is still doing that for us underneath the coverage it is doing the",
    "start": "2277599",
    "end": "2283000"
  },
  {
    "text": "you know look at my identity look at the roles on that identity however those roles and your identity when you're",
    "start": "2283000",
    "end": "2289300"
  },
  {
    "text": "running get populated from the token being passed in so this part here",
    "start": "2289300",
    "end": "2296619"
  },
  {
    "text": "program CS um",
    "start": "2296619",
    "end": "2301660"
  },
  {
    "text": "this is just some funky thing to by default it will map some weird claims",
    "start": "2301660",
    "end": "2307900"
  },
  {
    "text": "out to uh to my my my token or my my identity",
    "start": "2307900",
    "end": "2313300"
  },
  {
    "text": "um so the little extra piece configuration here I say the role claim type is roles there's going to be a",
    "start": "2313300",
    "end": "2320200"
  },
  {
    "text": "Rolls claim we'll see here in a minute in our token um just an array of values and it will",
    "start": "2320200",
    "end": "2326440"
  },
  {
    "text": "take those values and then put them in the the role in my identity when it actually runs so in my controller you",
    "start": "2326440",
    "end": "2332859"
  },
  {
    "text": "notice I'm not like I'm not poking around tokens at all I'm simply saying authorize that you're in the uh that you",
    "start": "2332859",
    "end": "2338859"
  },
  {
    "text": "have this specific role to do that right all right",
    "start": "2338859",
    "end": "2346320"
  },
  {
    "text": "so um I have these uh have these roles defined",
    "start": "2347020",
    "end": "2352240"
  },
  {
    "text": "but if I run the application",
    "start": "2352240",
    "end": "2356280"
  },
  {
    "text": "let me put it push the turbo button so it runs faster",
    "start": "2360460",
    "end": "2364859"
  },
  {
    "text": "I just got Swagger UI running to help my local testing of this API and so if I call one of these apis try",
    "start": "2366700",
    "end": "2373660"
  },
  {
    "text": "it out what's going to happen oh",
    "start": "2373660",
    "end": "2379240"
  },
  {
    "text": "unauthorized because I have not authorized authenticated as me being running in",
    "start": "2379240",
    "end": "2386079"
  },
  {
    "text": "this browser so the next thing we needed to figure out was okay well when I'm deployed to Azure or I know I can like have these",
    "start": "2386079",
    "end": "2392200"
  },
  {
    "text": "applications authorized permissions but for me running locally I still want to be able to call these",
    "start": "2392200",
    "end": "2397660"
  },
  {
    "text": "apis I don't want to turn security off locally because then you know I'm able to exercise those code pass so what we",
    "start": "2397660",
    "end": "2405820"
  },
  {
    "text": "wound up doing was was uh we created additional Azure",
    "start": "2405820",
    "end": "2414400"
  },
  {
    "text": "ad resources uh with groups and then we assigned like my user to that group and",
    "start": "2414400",
    "end": "2422200"
  },
  {
    "text": "then assign permissions to that group so that when I as me Jimmy uh calling and wanting a token for that API it will",
    "start": "2422200",
    "end": "2429520"
  },
  {
    "text": "return back the roles based on my group that's been assigned application permissions can be assigned to users",
    "start": "2429520",
    "end": "2435280"
  },
  {
    "text": "groups of users or other applications and I'm the group of users",
    "start": "2435280",
    "end": "2441460"
  },
  {
    "text": "all right so let's get that set up all right so back over in my server",
    "start": "2441460",
    "end": "2446740"
  },
  {
    "text": "definition over here I'm going to be adding a couple other things here the first I'm going to be",
    "start": "2446740",
    "end": "2453040"
  },
  {
    "text": "adding is a scope definition so this uh oauth scope",
    "start": "2453040",
    "end": "2460660"
  },
  {
    "text": "definition is just there because when I'm using this specific flow of calling from a browser Azure ID only supports",
    "start": "2460660",
    "end": "2467800"
  },
  {
    "text": "Scopes to be able to say I want this but we will get that scope but we'll also",
    "start": "2467800",
    "end": "2472900"
  },
  {
    "text": "get back our roles as well but it can't just deal with only roles for reasons so",
    "start": "2472900",
    "end": "2478660"
  },
  {
    "text": "I have to create some made up scope that I'm using just to be able to call this API",
    "start": "2478660",
    "end": "2485140"
  },
  {
    "text": "the next piece is a bit big so I'll I'll just bring it over and talk through it yeah",
    "start": "2485140",
    "end": "2490780"
  },
  {
    "text": "all right um again this is now this is still on the in the vein of like every single uh",
    "start": "2490780",
    "end": "2496839"
  },
  {
    "text": "kind of identity provider we'll do this slightly differently um and so for this I am a uh I am the",
    "start": "2496839",
    "end": "2505060"
  },
  {
    "text": "Swagger browser app wanting to get a token on behalf of me Jimmy",
    "start": "2505060",
    "end": "2510940"
  },
  {
    "text": "um for this API and so uh I have to uh",
    "start": "2510940",
    "end": "2516520"
  },
  {
    "text": "this is not something that's open by default I have to configure this application resource to allow this kind",
    "start": "2516520",
    "end": "2522820"
  },
  {
    "text": "of flow so I'm telling it okay you're going to have an API um because that's what Microsoft assumes",
    "start": "2522820",
    "end": "2528940"
  },
  {
    "text": "in their Azure ad application definition is that if you are wanting to support this kind of flow then you must be an",
    "start": "2528940",
    "end": "2535540"
  },
  {
    "text": "API whatever but what this is really doing though is uh enabling a specific",
    "start": "2535540",
    "end": "2541540"
  },
  {
    "text": "kind of oauth flow um the auth code flow and so I'm going to say okay you have",
    "start": "2541540",
    "end": "2548380"
  },
  {
    "text": "this set of permission Scopes the name of this the uh this scope is called",
    "start": "2548380",
    "end": "2554320"
  },
  {
    "text": "local Dev for whatever reason and then here's the ID of that that local Dev",
    "start": "2554320",
    "end": "2561820"
  },
  {
    "text": "the idea of the local Dev scope ID yes there we go",
    "start": "2561820",
    "end": "2569500"
  },
  {
    "text": "all right um the last piece I need to do is in order for you to assign",
    "start": "2569500",
    "end": "2577300"
  },
  {
    "text": "permissions to this application we have to graduate our application into",
    "start": "2577300",
    "end": "2582700"
  },
  {
    "text": "something that is now securable inside of azure ID in the portal these are known as",
    "start": "2582700",
    "end": "2589119"
  },
  {
    "text": "Enterprise applications uh I don't know why that's just the name of them some",
    "start": "2589119",
    "end": "2594640"
  },
  {
    "text": "Legacy reason I'm sure and so we have to graduate our API to something that can",
    "start": "2594640",
    "end": "2599680"
  },
  {
    "text": "be now something they can have permissions assigned to it so a few",
    "start": "2599680",
    "end": "2604839"
  },
  {
    "text": "things I pulled in here first of all is the defining a service",
    "start": "2604839",
    "end": "2610060"
  },
  {
    "text": "principle and the service principle you can kind of think is like that root table that my roles have to join to to",
    "start": "2610060",
    "end": "2615880"
  },
  {
    "text": "have them assigned and so this service principle I'm saying uh give me whatever",
    "start": "2615880",
    "end": "2622000"
  },
  {
    "text": "name and saying the application ID that this service principle is tied to is the",
    "start": "2622000",
    "end": "2627099"
  },
  {
    "text": "server application and so when I run this in palumi that makes this little link show up where it",
    "start": "2627099",
    "end": "2633880"
  },
  {
    "text": "says managed application in local directory if I did not Define this managed app or this uh this managed",
    "start": "2633880",
    "end": "2640900"
  },
  {
    "text": "application it would not have that link and then it couldn't assign uh I couldn't assign roles to This Server",
    "start": "2640900",
    "end": "2648660"
  },
  {
    "text": "okay the next thing uh is a really wonky thing um which is when I",
    "start": "2648940",
    "end": "2655180"
  },
  {
    "text": "uh when I as the browser wants to acquire a token um it wants to uh Define a specific",
    "start": "2655180",
    "end": "2662980"
  },
  {
    "text": "audience about who is calling that API and so there's a there's a well-known client ID for visual studio there's a",
    "start": "2662980",
    "end": "2670720"
  },
  {
    "text": "well-known client ID for visual studio code I went on client ID for the Azure CLI so when I'm trying to acquire a",
    "start": "2670720",
    "end": "2677440"
  },
  {
    "text": "token for something else it will use that well-known quote ID to be able to",
    "start": "2677440",
    "end": "2682780"
  },
  {
    "text": "do so all right so I'm saying I'm",
    "start": "2682780",
    "end": "2687880"
  },
  {
    "text": "pre-authorizing this application with this quote well-known ID that is just",
    "start": "2687880",
    "end": "2693700"
  },
  {
    "text": "baked into Visual Studio since like 2005 or something and then I'm telling it to the",
    "start": "2693700",
    "end": "2698920"
  },
  {
    "text": "application object ID that it's going to be authorizing so this is the server application and then finally uh what are",
    "start": "2698920",
    "end": "2704980"
  },
  {
    "text": "the permission IDs that I want to authorize you for and so that permission ID is going to be my local Dev scope",
    "start": "2704980",
    "end": "2710619"
  },
  {
    "text": "that right there all right so that would allow me to run",
    "start": "2710619",
    "end": "2715960"
  },
  {
    "text": "when I F5 visual studio and make a call out to again a token this will make sure",
    "start": "2715960",
    "end": "2721780"
  },
  {
    "text": "that I can I have this those things connected however me as the user still don't have the appropriate permissions",
    "start": "2721780",
    "end": "2728200"
  },
  {
    "text": "to do so so while I may get a token I might not have the right roles that come back in that token",
    "start": "2728200",
    "end": "2734980"
  },
  {
    "text": "so for that I'm going to create some methods here",
    "start": "2734980",
    "end": "2739859"
  },
  {
    "text": "all right so I uh I made a couple methods inside",
    "start": "2743500",
    "end": "2748900"
  },
  {
    "text": "my palumi configuration here and what these methods are doing is just making it kind of easy for me to assign",
    "start": "2748900",
    "end": "2754839"
  },
  {
    "text": "specific kinds of permissions and so here I've got two methods one to assign",
    "start": "2754839",
    "end": "2760300"
  },
  {
    "text": "read and one to assign rights and in order to assign a permission to a thing",
    "start": "2760300",
    "end": "2765880"
  },
  {
    "text": "I need to know a few things one is what do you want to call the thing so I've got like this prefix and the name of who",
    "start": "2765880",
    "end": "2772420"
  },
  {
    "text": "I'm getting assigned to because the the kind of distinct names inside of my configuration",
    "start": "2772420",
    "end": "2778420"
  },
  {
    "text": "um and then I need to know who am I assigning this permission to who was that principal that will receive",
    "start": "2778420",
    "end": "2785440"
  },
  {
    "text": "this and again who can I assign permissions to or roles users groups of users or other applications so I need to",
    "start": "2785440",
    "end": "2792220"
  },
  {
    "text": "know what is the principal ID of that thing I'm trying to assign the role to so that's it can basically create this",
    "start": "2792220",
    "end": "2799000"
  },
  {
    "text": "this uh this record here or this resource here which is an app role assignment that is I want to assign this",
    "start": "2799000",
    "end": "2805900"
  },
  {
    "text": "role that it belongs to this principle to this other thing",
    "start": "2805900",
    "end": "2812020"
  },
  {
    "text": "and when I've designed role-based uh permissions and applications there's",
    "start": "2812020",
    "end": "2817839"
  },
  {
    "text": "some table somewhere right that is here's the uh here's the here's a list of principles here's the list of roles",
    "start": "2817839",
    "end": "2825040"
  },
  {
    "text": "and there's a join there and then somewhere is going to be an assignment table of which permissions are assigned",
    "start": "2825040",
    "end": "2830079"
  },
  {
    "text": "to which thing and that's that's basically what this is it's creating a row and a table somewhere that says uh this role for this resource is assigned",
    "start": "2830079",
    "end": "2838359"
  },
  {
    "text": "to this other principle that's what that is so I got I have two methods one for the",
    "start": "2838359",
    "end": "2844839"
  },
  {
    "text": "to do dot read and then another one for the 2D outrights and then I will Define",
    "start": "2844839",
    "end": "2850119"
  },
  {
    "text": "another method here which is assigning the role for the Azure ID resources and the Azure",
    "start": "2850119",
    "end": "2857980"
  },
  {
    "text": "ID resources is just my user and the",
    "start": "2857980",
    "end": "2863500"
  },
  {
    "text": "local Dev group that I've created earlier now this is not something that's specific to my application so some",
    "start": "2863500",
    "end": "2869500"
  },
  {
    "text": "probably like an admin or somewhere gets a support ticket that says I need to create an Azure ID group okay great and",
    "start": "2869500",
    "end": "2874780"
  },
  {
    "text": "then you need to assign these people to that group okay great um and so that's what this is this set of resources are is just I want to",
    "start": "2874780",
    "end": "2881560"
  },
  {
    "text": "create a group that makes it easier to manage you know who can get these local Dev permissions and then I'm going to",
    "start": "2881560",
    "end": "2886900"
  },
  {
    "text": "assign me to that group this is probably not done via polumi in",
    "start": "2886900",
    "end": "2893260"
  },
  {
    "text": "your organizations or IAC it's probably going to be like a service ticket someone has to go in and actually do this",
    "start": "2893260",
    "end": "2899079"
  },
  {
    "text": "in any case um I want to assign the read and write role to the local Dev group",
    "start": "2899079",
    "end": "2907480"
  },
  {
    "text": "service principle finally over here on my stack I need to",
    "start": "2907480",
    "end": "2913960"
  },
  {
    "text": "actually call that method that I've created so after I've created the server client and the external client resources I'm going to assign the roles",
    "start": "2913960",
    "end": "2922540"
  },
  {
    "text": "for the Azure ID resources all right",
    "start": "2922540",
    "end": "2928140"
  },
  {
    "text": "the last thing so once I've run this it will assign the local Dev group to those resource those permissions and over here",
    "start": "2928960",
    "end": "2935560"
  },
  {
    "text": "I can actually see that if I go click the application registration the Enterprise application there's a",
    "start": "2935560",
    "end": "2941560"
  },
  {
    "text": "users and groups anybody can see that my local Dev group",
    "start": "2941560",
    "end": "2946660"
  },
  {
    "text": "has been assigned the write and read role which is really permission",
    "start": "2946660",
    "end": "2952619"
  },
  {
    "text": "all right so um that will ensure that those groups are assigned but I still have to tell",
    "start": "2952900",
    "end": "2959020"
  },
  {
    "text": "Swagger how to authorize so back in my application here",
    "start": "2959020",
    "end": "2965940"
  },
  {
    "text": "I'm going to modify the Swagger options to",
    "start": "2966400",
    "end": "2972119"
  },
  {
    "text": "authorize appropriately with Azure ad and oauth 2",
    "start": "2973900",
    "end": "2979000"
  },
  {
    "text": "auth code flow and so that's this configuration here I have to tell it's the URL what to",
    "start": "2979000",
    "end": "2984400"
  },
  {
    "text": "authorize the token URL and what this will do is when I run this it'll now introduce that little padlock in the Swagger UI so that I can authenticate",
    "start": "2984400",
    "end": "2990880"
  },
  {
    "text": "inside my browser against Azure ID and the final thing down here is the",
    "start": "2990880",
    "end": "2996760"
  },
  {
    "text": "modifying the UI to do its thing as well and so I tell it's you know you there's your client ID the scope separator space",
    "start": "2996760",
    "end": "3003599"
  },
  {
    "text": "because reasons and then also to use the pkce way of doing auth code flow again",
    "start": "3003599",
    "end": "3009000"
  },
  {
    "text": "this is just for local development usually I would turn those off when I go to production because like Swagger's",
    "start": "3009000",
    "end": "3014460"
  },
  {
    "text": "turned off altogether but this is just for my local development so now when I run",
    "start": "3014460",
    "end": "3021259"
  },
  {
    "text": "I get a nice little padlock eventually",
    "start": "3022079",
    "end": "3026900"
  },
  {
    "text": "ah authorize I go click that and down here it's a little difficult to",
    "start": "3028920",
    "end": "3035579"
  },
  {
    "text": "see but it says let me bump it up the scope that I'm going to Define is",
    "start": "3035579",
    "end": "3041819"
  },
  {
    "text": "local Dev because it'd have to make something up for this code to be for this flow to get all my claims back so",
    "start": "3041819",
    "end": "3048119"
  },
  {
    "text": "that's just kind of a made-up scope my client ID of course is",
    "start": "3048119",
    "end": "3053220"
  },
  {
    "text": "F12 I think that's the visual Studio One and then I click no no I'm sorry that's the server I click authorize",
    "start": "3053220",
    "end": "3061740"
  },
  {
    "text": "if I was not logged in to microsoft.com or live.com whatever you would get that like login screen pick the account that",
    "start": "3061740",
    "end": "3068520"
  },
  {
    "text": "you want to use so you're this person and then it comes back and then I hit close so now when I hit",
    "start": "3068520",
    "end": "3073619"
  },
  {
    "text": "get I try this out executes",
    "start": "3073619",
    "end": "3079578"
  },
  {
    "text": "let's oh it actually succeeded this time 200 so here's my two items and let's grab this token doot",
    "start": "3080579",
    "end": "3088380"
  },
  {
    "text": "and go to jot MS token and ta-da there are my roles",
    "start": "3088380",
    "end": "3098160"
  },
  {
    "text": "those show up because my user is a member of that local Dev group and I've",
    "start": "3098160",
    "end": "3105619"
  },
  {
    "text": "assigned those two roles those permissions to that local Dev groups when I ask for a token it's going to",
    "start": "3105619",
    "end": "3112079"
  },
  {
    "text": "give me back all the claims that I have for that resource and me as Jimmy uh Jimmy Bogard I have this made up scope",
    "start": "3112079",
    "end": "3119819"
  },
  {
    "text": "of local Dev which I don't care about but I also get back my roles so when I call that API I've got those roles and",
    "start": "3119819",
    "end": "3127140"
  },
  {
    "text": "it will authorize those roles against those different API endpoints and I can actually do local Dev huzzah",
    "start": "3127140",
    "end": "3134119"
  },
  {
    "text": "all right so at that point my server is secured like it's good to go I can deploy that",
    "start": "3134819",
    "end": "3141660"
  },
  {
    "text": "out and I now can uh you know if I can now do role-based authorization against any kind of client the next thing I want",
    "start": "3141660",
    "end": "3148140"
  },
  {
    "text": "to do is then uh Define the authorization components for those two clients the the external clients as well",
    "start": "3148140",
    "end": "3154319"
  },
  {
    "text": "as the Azure client now the external clients again is just a",
    "start": "3154319",
    "end": "3160260"
  },
  {
    "text": "console application here um because I'm going to use client",
    "start": "3160260",
    "end": "3165420"
  },
  {
    "text": "credentials flow there are a few different options for my clients to obtain those credentials one is with a",
    "start": "3165420",
    "end": "3172559"
  },
  {
    "text": "client ID and secrets that can be rotated so I can say like it's got some secrets and then you know if I want to",
    "start": "3172559",
    "end": "3179579"
  },
  {
    "text": "expire that secret I can create a new one and then expire the old one or you can use certificates in my actual systems we were using certificates but",
    "start": "3179579",
    "end": "3185940"
  },
  {
    "text": "that's such a pain to create and set up that I didn't want to do that so instead I'm just using client ID and client",
    "start": "3185940",
    "end": "3192000"
  },
  {
    "text": "secrets all right so in our client application our external client",
    "start": "3192000",
    "end": "3198720"
  },
  {
    "text": "we're going to first bring over the application definition",
    "start": "3198720",
    "end": "3204599"
  },
  {
    "text": "this is now the application definition of the client now it's kind of funny because like I'm defining these Azure ID",
    "start": "3204599",
    "end": "3210720"
  },
  {
    "text": "resources but this client is not running in Azure but it's just using Azure ad as",
    "start": "3210720",
    "end": "3216240"
  },
  {
    "text": "that token provider and the identity provider someone wants to acquire token like I am resource a one to acquire a",
    "start": "3216240",
    "end": "3222420"
  },
  {
    "text": "token for resource B it's just calling out to Azure to do so so these are the the Azure ID components to get put all",
    "start": "3222420",
    "end": "3228540"
  },
  {
    "text": "that together so I first need to create an application but this time this is the external",
    "start": "3228540",
    "end": "3234059"
  },
  {
    "text": "client application I also Define an application secrets",
    "start": "3234059",
    "end": "3239579"
  },
  {
    "text": "so I've got an application password for the secrets then I'm going to",
    "start": "3239579",
    "end": "3244680"
  },
  {
    "text": "not show you but I put into user secrets in visual studio and when I'm running in Azure then I've probably got some configuration up there to store the",
    "start": "3244680",
    "end": "3251579"
  },
  {
    "text": "secrets no I'm not running an Azure you would store it in some secure way in order to assign different roles to",
    "start": "3251579",
    "end": "3259559"
  },
  {
    "text": "different things I need to have a principal associated with this if I don't want to assign roles to",
    "start": "3259559",
    "end": "3266339"
  },
  {
    "text": "things I don't need a principal but I do want to assign roles for this client application so I need that",
    "start": "3266339",
    "end": "3272579"
  },
  {
    "text": "and then for the external clients I need to configure some things as well",
    "start": "3272579",
    "end": "3278960"
  },
  {
    "text": "there we go so I'm going to pull in some configuration for the external clients",
    "start": "3279559",
    "end": "3286020"
  },
  {
    "text": "and this external client",
    "start": "3286020",
    "end": "3289339"
  },
  {
    "text": "s lots of stuff here it's going to be",
    "start": "3292260",
    "end": "3297420"
  },
  {
    "text": "making API calls out to this the Azure server but when it does so I want to",
    "start": "3297420",
    "end": "3302460"
  },
  {
    "text": "make sure that it is able to acquire a token appropriately and so I'm bringing in let's see what is this Library it is",
    "start": "3302460",
    "end": "3309300"
  },
  {
    "text": "the Microsoft identity client so if I am a client want to acquire token of from",
    "start": "3309300",
    "end": "3316319"
  },
  {
    "text": "Azure ID I can use that library to do so",
    "start": "3316319",
    "end": "3320780"
  },
  {
    "text": "um I'm using typed HTTP clients with some middleware and that middleware is",
    "start": "3322500",
    "end": "3328440"
  },
  {
    "text": "going to include an ability to acquire tokens so this middleware this client authentic application auth Handler will",
    "start": "3328440",
    "end": "3336420"
  },
  {
    "text": "before it makes a call out will call acquire token from clients this is",
    "start": "3336420",
    "end": "3342780"
  },
  {
    "text": "from the Microsoft identity client Library it'll acquire a token based on the application ID that I want to call",
    "start": "3342780",
    "end": "3348839"
  },
  {
    "text": "and it will get basically all of the all of the different uh claims for that",
    "start": "3348839",
    "end": "3355740"
  },
  {
    "text": "application ID then it will get the result of that put",
    "start": "3355740",
    "end": "3360839"
  },
  {
    "text": "it in a bearer token so then when you actually call the API it's it's putting that bear token on the authorization",
    "start": "3360839",
    "end": "3366839"
  },
  {
    "text": "headers as it goes out the door so now my client application my external",
    "start": "3366839",
    "end": "3372119"
  },
  {
    "text": "clients will be able to call Azure ID to get a token to then call out to my",
    "start": "3372119",
    "end": "3377460"
  },
  {
    "text": "server however uh we're still like quite there yet we still need to assign those roles",
    "start": "3377460",
    "end": "3384660"
  },
  {
    "text": "for that client to the server so back over in my server",
    "start": "3384660",
    "end": "3390599"
  },
  {
    "text": "I'm going to add another overload for sign roles which is this and for this",
    "start": "3390599",
    "end": "3396900"
  },
  {
    "text": "external client I trust it less and so I'm only going to be assigning the read permission not the read and write",
    "start": "3396900",
    "end": "3404900"
  },
  {
    "text": "finally in my stack I will go ahead and assign those specific roles there",
    "start": "3405240",
    "end": "3411240"
  },
  {
    "text": "all right so now let's run the server",
    "start": "3411240",
    "end": "3415339"
  },
  {
    "text": "and run the client the external client that is",
    "start": "3418800",
    "end": "3424818"
  },
  {
    "text": "and return run the external clients a bug huh",
    "start": "3427559",
    "end": "3434240"
  },
  {
    "text": "and to make my life a little easier I'm just going to log the token out don't do",
    "start": "3435839",
    "end": "3441300"
  },
  {
    "text": "this in production don't don't shove your token in the log probably bad idea that'll make my life a bit easier",
    "start": "3441300",
    "end": "3446640"
  },
  {
    "text": "because now I can take that go back over to my browser go to jot",
    "start": "3446640",
    "end": "3452819"
  },
  {
    "text": "MS and now we see the token that my external",
    "start": "3452819",
    "end": "3459359"
  },
  {
    "text": "client got only includes the to-do.read and it used client ID client secrets to acquire that",
    "start": "3459359",
    "end": "3467099"
  },
  {
    "text": "token and so the the server um the client the external client said I",
    "start": "3467099",
    "end": "3472200"
  },
  {
    "text": "am this external client I want to get tokens for that server over there and it's only going to return back the roles",
    "start": "3472200",
    "end": "3477540"
  },
  {
    "text": "that have been assigned to it all right the last piece of the puzzle",
    "start": "3477540",
    "end": "3482700"
  },
  {
    "text": "is our Azure client now something that's different in Azure Land versus running externally is this",
    "start": "3482700",
    "end": "3490500"
  },
  {
    "text": "Azure has this concept of managed identities and one of the things I can do is have my application run as a",
    "start": "3490500",
    "end": "3496020"
  },
  {
    "text": "managed identity so they don't have to use client ID Secrets or certificates I can set assign roles to that managed",
    "start": "3496020",
    "end": "3502079"
  },
  {
    "text": "identity and that manage identity will then be the thing that my application runs like as",
    "start": "3502079",
    "end": "3508319"
  },
  {
    "text": "all right so let's do that I'm going to go back over to my",
    "start": "3508319",
    "end": "3514100"
  },
  {
    "text": "[Music] clients this is now the Azure clients",
    "start": "3514100",
    "end": "3519180"
  },
  {
    "text": "and I'm going to pull these pieces over here I'm going to have",
    "start": "3519180",
    "end": "3524240"
  },
  {
    "text": "there it is again this is running inside of azure so I'm going to be defining an Azure app",
    "start": "3524339",
    "end": "3531420"
  },
  {
    "text": "service web app that's this piece here and then it'll also be giving it a user",
    "start": "3531420",
    "end": "3538260"
  },
  {
    "text": "assigned identity so this is oops this is a custom thing it always runs",
    "start": "3538260",
    "end": "3545700"
  },
  {
    "text": "under some identity but I'm going to give it a user assigned identity and I need to modify my app service",
    "start": "3545700",
    "end": "3552780"
  },
  {
    "text": "definition to say you need to run with this identity so I'm saying you're going",
    "start": "3552780",
    "end": "3558180"
  },
  {
    "text": "to be running under a managed service identity that is this user assigned identity that I have right here",
    "start": "3558180",
    "end": "3565280"
  },
  {
    "text": "finally let's go ahead and output these outs so I'm just capturing those variables so",
    "start": "3565740",
    "end": "3570780"
  },
  {
    "text": "I can refer to them in other places I need to go now to my server and assign",
    "start": "3570780",
    "end": "3575940"
  },
  {
    "text": "those roles so I'm going to create another overload of assigned roles which is",
    "start": "3575940",
    "end": "3581940"
  },
  {
    "text": "to assign that client that internal Azure client will get both the read and write roles",
    "start": "3581940",
    "end": "3588359"
  },
  {
    "text": "and then finally over in my palumi stack I will say server design roles",
    "start": "3588359",
    "end": "3595319"
  },
  {
    "text": "prefix and then decline as well so my local Dev group gets read write the",
    "start": "3595319",
    "end": "3601020"
  },
  {
    "text": "external client only gets read and the internal Azure client that runs in Azure will only get uh will only gets the",
    "start": "3601020",
    "end": "3607680"
  },
  {
    "text": "we'll get read and write now uh my Azure clients I have to do",
    "start": "3607680",
    "end": "3614040"
  },
  {
    "text": "something else to make it be able to authenticate and authorize so the first I'm going to do is get some",
    "start": "3614040",
    "end": "3619680"
  },
  {
    "text": "configuration in here this is the last piece we're doing",
    "start": "3619680",
    "end": "3625440"
  },
  {
    "text": "okay so this client ID is now the client ID of the application actually no it's",
    "start": "3625440",
    "end": "3632040"
  },
  {
    "text": "the ID of the managed identity because that's who this client will be running as in azure",
    "start": "3632040",
    "end": "3637980"
  },
  {
    "text": "and then over in my startup where I've got this configure Services",
    "start": "3637980",
    "end": "3643559"
  },
  {
    "text": "stuff we've got um that to pull in",
    "start": "3643559",
    "end": "3650579"
  },
  {
    "text": "so I uh in my Azure client if I'm an Azure client's inside of azure talking",
    "start": "3650579",
    "end": "3656579"
  },
  {
    "text": "to other Azure Services we can actually now use the azure.identity package you may have seen this if using manage",
    "start": "3656579",
    "end": "3662520"
  },
  {
    "text": "identities to talk to key evolved or Azure SQL things like that we can also use the Azure identity Library if I'm an",
    "start": "3662520",
    "end": "3668880"
  },
  {
    "text": "Azure application to calling other Azure applications I can use this as well",
    "start": "3668880",
    "end": "3675500"
  },
  {
    "text": "so hold back in my startup oops startup I've got",
    "start": "3676020",
    "end": "3681780"
  },
  {
    "text": "huh wrong place",
    "start": "3681780",
    "end": "3686480"
  },
  {
    "text": "I'm doing some similar configurations so what my this Azure client is doing it's a dumb API it is an API that just calls",
    "start": "3687420",
    "end": "3694260"
  },
  {
    "text": "the other API through a type HP client this one is not secured so it's just internally using the manage identity to",
    "start": "3694260",
    "end": "3700740"
  },
  {
    "text": "acquire the token to call the other API so it's just completely open to the internet here",
    "start": "3700740",
    "end": "3705780"
  },
  {
    "text": "okay so now uh when I run this inside of azure I've got this up and going",
    "start": "3705780",
    "end": "3711359"
  },
  {
    "text": "this is my Azure client that's running under a managed identity and now when I make the call",
    "start": "3711359",
    "end": "3719760"
  },
  {
    "text": "to the server it was successful so it successfully",
    "start": "3719760",
    "end": "3725160"
  },
  {
    "text": "acquired that token and now I'm going to go over and grab and my app services",
    "start": "3725160",
    "end": "3731160"
  },
  {
    "text": "the client we'll go look at the logs and I can pull the jot out of there",
    "start": "3731160",
    "end": "3737339"
  },
  {
    "text": "log stream where's my log stream sound there we go",
    "start": "3737339",
    "end": "3745099"
  },
  {
    "text": "all right we'll make that request again ah",
    "start": "3751140",
    "end": "3756660"
  },
  {
    "text": "where's that where's my token there we go let me grab this token",
    "start": "3756660",
    "end": "3763400"
  },
  {
    "text": "pop it in my jots decoder and sure enough I see that for this",
    "start": "3763980",
    "end": "3769140"
  },
  {
    "text": "application running under this managed identity is be able to assign get these",
    "start": "3769140",
    "end": "3774540"
  },
  {
    "text": "different roles assigned to it when acquired that token and then my code itself was completely transparent so if",
    "start": "3774540",
    "end": "3780359"
  },
  {
    "text": "I look at my application code in my controller I just have this typed HTTP client but underneath the covers it is",
    "start": "3780359",
    "end": "3786720"
  },
  {
    "text": "going to be using Azure identity to acquire that token so down here it says uh",
    "start": "3786720",
    "end": "3792180"
  },
  {
    "text": "uh credential dot get token async it gets the token for me and then all is",
    "start": "3792180",
    "end": "3797760"
  },
  {
    "text": "well and good in the world so that was",
    "start": "3797760",
    "end": "3803760"
  },
  {
    "text": "securing microservices uh using Azure ad um I know like the basically the moral",
    "start": "3803760",
    "end": "3810000"
  },
  {
    "text": "of the story was just use client credentials um what was interesting about Azure though is that because Azure has this",
    "start": "3810000",
    "end": "3815520"
  },
  {
    "text": "concept of managed identities then all of my Azure clients I don't have to manage certificates or Secrets it is",
    "start": "3815520",
    "end": "3821819"
  },
  {
    "text": "completely transparent to me and I don't have to worry about doing the assignments for external clients though because they're not running in like",
    "start": "3821819",
    "end": "3827460"
  },
  {
    "text": "Azure land then it will revert back to either certificates or client secrets to be able to acquire those tokens",
    "start": "3827460",
    "end": "3834839"
  },
  {
    "text": "so thank you very much if you want to see the running example of this and pull it down locally you can pull down this",
    "start": "3834839",
    "end": "3840240"
  },
  {
    "text": "uh this repository at the bottom the Azure ID example you can run that against your Azure uh",
    "start": "3840240",
    "end": "3849200"
  },
  {
    "text": "credits and stuff instead of mine to be able to get it uh all running locally so",
    "start": "3849200",
    "end": "3854700"
  },
  {
    "text": "thank you very much I hope you all have a great rest of the conference I'll be sticking around for a little bit for questions otherwise uh thanks",
    "start": "3854700",
    "end": "3861980"
  },
  {
    "text": "and please do uh don't forget to drop the cards in there I do throw out all",
    "start": "3864559",
    "end": "3870180"
  },
  {
    "text": "the Reds if you drop anything there so just",
    "start": "3870180",
    "end": "3873859"
  }
]