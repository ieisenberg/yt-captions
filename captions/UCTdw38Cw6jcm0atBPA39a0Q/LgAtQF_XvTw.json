[
  {
    "text": "all right mm welcome everyone thank you",
    "start": "2710",
    "end": "7850"
  },
  {
    "text": "for coming how many of you are from London all right well thank you and",
    "start": "7850",
    "end": "13700"
  },
  {
    "text": "thank your city for the hospitality and the beautiful weather I was a little worried like 7 degrees Celsius is the",
    "start": "13700",
    "end": "19820"
  },
  {
    "text": "lowest we get all year in Israel where I live so this is a this was a concern for",
    "start": "19820",
    "end": "25460"
  },
  {
    "text": "me but it's lovely outside and thank you and I'm very happy to be here for NDC again so my name is Sasha",
    "start": "25460",
    "end": "31310"
  },
  {
    "text": "I work for an Israeli training and consulting company called Sela and for the last 10 11 years or so I've been",
    "start": "31310",
    "end": "38000"
  },
  {
    "text": "doing mostly performance and debugging work across a variety of application",
    "start": "38000",
    "end": "43340"
  },
  {
    "text": "types but dotnet has always been my main focus and Windows and Linux are the two",
    "start": "43340",
    "end": "50420"
  },
  {
    "text": "places where I've been doing dotnet performance work and in this talk which is slightly less technical than I'm used",
    "start": "50420",
    "end": "55850"
  },
  {
    "text": "to that I'm used to giving will talk about the whole performance investigation process I want to share",
    "start": "55850",
    "end": "61640"
  },
  {
    "text": "with you some of the things I've been doing a couple of examples of what I call performance investigations and",
    "start": "61640",
    "end": "67640"
  },
  {
    "text": "hopefully you'll be able to come out of the start with some ideas for how to actually do performance work in your own",
    "start": "67640",
    "end": "74090"
  },
  {
    "text": "organization and maybe some tools as well that could be useful but this is all a bit higher level and so if you're",
    "start": "74090",
    "end": "81650"
  },
  {
    "text": "interested in more specific references and examples I'd love to chat with you during the event so again the general",
    "start": "81650",
    "end": "88310"
  },
  {
    "text": "plan is the strategy and tactics for performance investigations mostly in the",
    "start": "88310",
    "end": "93409"
  },
  {
    "text": "field by which I mean as a consultant I get called to different customers and",
    "start": "93409",
    "end": "98570"
  },
  {
    "text": "magically expected to find or sometimes fix performance problems as well so it's",
    "start": "98570",
    "end": "103610"
  },
  {
    "text": "a it's interesting and very challenging work and there's really I think a few highlights that I can share from the",
    "start": "103610",
    "end": "110479"
  },
  {
    "text": "whole process so I want to talk about the performance investigation process in general methods and anti methods a",
    "start": "110479",
    "end": "117170"
  },
  {
    "text": "little bit of tools and how to avoid getting lied to by some of the tools that you might be using so let's start",
    "start": "117170",
    "end": "124490"
  },
  {
    "text": "with the structure of a performance investigation by the way everything I'm talking about is kind of you know like",
    "start": "124490",
    "end": "129920"
  },
  {
    "text": "written in blood but it's just my experience and the experience of other people on my team so diff",
    "start": "129920",
    "end": "135590"
  },
  {
    "text": "practices might work for different people and I'll be again delighted to if you could share your own experiences",
    "start": "135590",
    "end": "141290"
  },
  {
    "text": "afterwards as well so here's the structure of a performance investigation how I usually prefer to conduct them so",
    "start": "141290",
    "end": "148400"
  },
  {
    "text": "first obtain the problem description and that sounds a lot easier than it is if",
    "start": "148400",
    "end": "153950"
  },
  {
    "text": "you have been doing performance work in your own organization if you've been talking to customers and users at all",
    "start": "153950",
    "end": "160040"
  },
  {
    "text": "not just for performance issues but in general you know it's all it's not always easy to extract the real problem",
    "start": "160040",
    "end": "166459"
  },
  {
    "text": "description out of humans or systems also so we'll talk a little about",
    "start": "166459",
    "end": "171590"
  },
  {
    "text": "examples of what a good problem description looks like and what a totally non actionable problem",
    "start": "171590",
    "end": "176840"
  },
  {
    "text": "description looks like then what I like to do especially when coming as an as an external consultant is try and build a",
    "start": "176840",
    "end": "184220"
  },
  {
    "text": "system diagram try and understand all the different interacting pieces now if you're working in a single team or a",
    "start": "184220",
    "end": "190519"
  },
  {
    "text": "single product you might think it's a waste of time to build a system diagram when you start a performance investigation because I mean you already",
    "start": "190519",
    "end": "197360"
  },
  {
    "text": "have one you have the design documents you have the architecture blueprints for whatever system you have a lot of times",
    "start": "197360",
    "end": "203720"
  },
  {
    "text": "though especially when you're doing a new investigation you discover that you know the system implementation has",
    "start": "203720",
    "end": "210260"
  },
  {
    "text": "slightly drifted away from the original design or from whatever you have documented on your internal wiki and",
    "start": "210260",
    "end": "217280"
  },
  {
    "text": "this is where building a diagram of the actual system as it is currently in production and that's the thing you're",
    "start": "217280",
    "end": "222890"
  },
  {
    "text": "currently investigating is quite useful then I like to run a quick performance checklist and what exactly to put on",
    "start": "222890",
    "end": "230030"
  },
  {
    "text": "that checklist we'll talk about this little during the talk but this just gives you a high-level overview of",
    "start": "230030",
    "end": "236060"
  },
  {
    "text": "resource utilization across the system how the different components are behaving sort of lets you know which",
    "start": "236060",
    "end": "241940"
  },
  {
    "text": "parts are ok and probably don't warrant additional attention and which parts do",
    "start": "241940",
    "end": "247489"
  },
  {
    "text": "really need a closer look and might be causing the problem you're looking at and so this is where you hopefully are",
    "start": "247489",
    "end": "252769"
  },
  {
    "text": "able to focus a little more closely on the specific area of the system that's worth further investigating and then you",
    "start": "252769",
    "end": "259970"
  },
  {
    "text": "investigate thoroughly and this is like the vaguest step of the whole process you investigate and you hopefully find",
    "start": "259970",
    "end": "266990"
  },
  {
    "text": "the performance problem you find the root cause and I'll just spend a couple of seconds on that by",
    "start": "266990",
    "end": "273240"
  },
  {
    "text": "root cause I mean the thing that actually fixes the problem in a way that will never have the same problem",
    "start": "273240",
    "end": "279419"
  },
  {
    "text": "manifest again so not just you know fixing the symptom by maybe scaling up the system or adding a little more",
    "start": "279419",
    "end": "285659"
  },
  {
    "text": "memory but actually finding the root cause that we can now eliminate and fix that problem for good now some things",
    "start": "285659",
    "end": "291869"
  },
  {
    "text": "are just naturally fixed by scaling up or adding memory but often we tend to",
    "start": "291869",
    "end": "296909"
  },
  {
    "text": "fix the symptom and not the actual problem and then the problem really doesn't go away and we end up spending",
    "start": "296909",
    "end": "302759"
  },
  {
    "text": "more time on it in a week and that's just a waste of for everybody's time then we fix the issue we resolve the",
    "start": "302759",
    "end": "309029"
  },
  {
    "text": "problem and we verify that we have actually resolved it it's now gone and",
    "start": "309029",
    "end": "314129"
  },
  {
    "text": "that's also something that people often forget you know we're all excited about just having found the problem and sort",
    "start": "314129",
    "end": "319649"
  },
  {
    "text": "of found the three lines of configuration that have to be changed to fix it and then we forget to make sure",
    "start": "319649",
    "end": "325110"
  },
  {
    "text": "it's really helped and we go away and then we have to come back in an hour and just go through the whole thing again and finally and this is super critical",
    "start": "325110",
    "end": "332219"
  },
  {
    "text": "and important and again often forgotten is to do a post-mortem document what you did document the whole process and I'll",
    "start": "332219",
    "end": "338759"
  },
  {
    "text": "talk briefly about the post-mortem at the end of the talk and what should be on it so this is the general structure and",
    "start": "338759",
    "end": "344969"
  },
  {
    "text": "let's start with problem descriptions and an example of a performance investigation that went quite terribly",
    "start": "344969",
    "end": "352139"
  },
  {
    "text": "wrong and what was the cause of that so a couple of examples of what I think are not so good problem descriptions in this",
    "start": "352139",
    "end": "359819"
  },
  {
    "text": "one the customer complains that the application feels slow users can't",
    "start": "359819",
    "end": "364830"
  },
  {
    "text": "really put their finger on it but it's bad my taking a look again in in your organization if you are sort of the",
    "start": "364830",
    "end": "370919"
  },
  {
    "text": "performance expert or the go-to person for performance issues you might get this sort of thing often as a consultant",
    "start": "370919",
    "end": "377129"
  },
  {
    "text": "I get this sort of thing often as well it's highly unacceptable I don't know",
    "start": "377129",
    "end": "383490"
  },
  {
    "text": "anything about your application or your system what do you really expect me to do with this another example which is",
    "start": "383490",
    "end": "389580"
  },
  {
    "text": "also quite common I think again in organisations as well as with external consultants is we have a budget for",
    "start": "389580",
    "end": "395999"
  },
  {
    "text": "fixing performance issues so let's now use that budget because the year is coming to an we have that extra budget even if we",
    "start": "395999",
    "end": "402729"
  },
  {
    "text": "don't use the budget for this year we're not going to get the same budget for next year so we just got to use the two",
    "start": "402729",
    "end": "407949"
  },
  {
    "text": "days we have for finding and fixing performance problems this is better than not investing at all in your performance",
    "start": "407949",
    "end": "415449"
  },
  {
    "text": "problems but it's not ideal this is not the way it should work right you should factor in the performance work into the",
    "start": "415449",
    "end": "421509"
  },
  {
    "text": "whole project lifecycle and not just you know when you have two days of budget left at the end of everything just sort",
    "start": "421509",
    "end": "427509"
  },
  {
    "text": "of try and see what you can do with these two days but that also happens a lot and of course again there is no",
    "start": "427509",
    "end": "433660"
  },
  {
    "text": "guarantee that we will actually find and fix anything if we only have that little budget at the end a couple of slightly",
    "start": "433660",
    "end": "440440"
  },
  {
    "text": "better examples I think so this could be an email from like an automatic system a",
    "start": "440440",
    "end": "446830"
  },
  {
    "text": "template and this says so since for 25 a.m. the 95th percentile latency to the",
    "start": "446830",
    "end": "453490"
  },
  {
    "text": "front end asp.net application increased to 1,400 milliseconds the previous value",
    "start": "453490",
    "end": "460090"
  },
  {
    "text": "was 60 milliseconds and this is consistent across geographies auto-scaling has kicked in and didn't",
    "start": "460090",
    "end": "465520"
  },
  {
    "text": "help now if you have an automatic it automated system that can generate this sort of email that's like really awesome",
    "start": "465520",
    "end": "471639"
  },
  {
    "text": "or it could have really been a human operator but anyway this tells you what's wrong or at least it tells you",
    "start": "471639",
    "end": "478449"
  },
  {
    "text": "the symptoms it tells you what person on the other side is expecting you to do so",
    "start": "478449",
    "end": "483820"
  },
  {
    "text": "let's say if we bring the latency back down to 60 milliseconds you know they're going to be happy at least with this",
    "start": "483820",
    "end": "489419"
  },
  {
    "text": "particular alert and we know what mitigation steps were already attempted so that also saves us a bit of time like",
    "start": "489419",
    "end": "496509"
  },
  {
    "text": "yeah we tried scaling and it didn't help so maybe the problem is somewhere else another example which is less detailed",
    "start": "496509",
    "end": "503770"
  },
  {
    "text": "but I think is also quite good and that's just a real example just slightly rewarded in the latest version of the",
    "start": "503770",
    "end": "510460"
  },
  {
    "text": "software clicking from the patient details screen in some kind of medical software to the CT screen takes 11",
    "start": "510460",
    "end": "517599"
  },
  {
    "text": "seconds in certain hospitals and this is unacceptable it has to be under two seconds because our technicians they",
    "start": "517599",
    "end": "523539"
  },
  {
    "text": "don't have that sort of time to waste so they can't wait 11 seconds for the CT screen to open so this is something",
    "start": "523539",
    "end": "529930"
  },
  {
    "text": "you've gotta fix right now so again we know what the person on the other side of this email is expecting they want this whole thing",
    "start": "529930",
    "end": "536680"
  },
  {
    "text": "to take two seconds it's now taking 11 seconds could be for a variety of reasons but at least we know what the",
    "start": "536680",
    "end": "542440"
  },
  {
    "text": "problem is so having said all that about problem descriptions let's take a look at an",
    "start": "542440",
    "end": "548080"
  },
  {
    "text": "actual derivation of these values of these problem descriptions of of the",
    "start": "548080",
    "end": "554740"
  },
  {
    "text": "metrics that are getting violated in in all of these cases so this is like imagine this conversation with a",
    "start": "554740",
    "end": "560290"
  },
  {
    "text": "customer it's rephrased from a really great blog post called how to not measure latency which i've linked at the",
    "start": "560290",
    "end": "565660"
  },
  {
    "text": "end of the slides so let's say we have this conversation with a customer or some other person on your team trying to",
    "start": "565660",
    "end": "572170"
  },
  {
    "text": "figure out what the performance metric violations would look like for for a system so I asked what are your latency",
    "start": "572170",
    "end": "579970"
  },
  {
    "text": "requirements do your customer the customer says we need an average response time of 20 milliseconds now",
    "start": "579970",
    "end": "585130"
  },
  {
    "text": "let's assume for a moment this is like a web service web application let's say a web application that serves actual web",
    "start": "585130",
    "end": "591640"
  },
  {
    "text": "pages to the clients so they're saying like 20 milliseconds response time it sounds a little fast to me but maybe",
    "start": "591640",
    "end": "599080"
  },
  {
    "text": "like there was a reason for that so I asked what's the worst-case requirement and and where it's what is like what is",
    "start": "599080",
    "end": "605830"
  },
  {
    "text": "the reason that's your worst case requirement the customer says we don't have a worst case requirement we just",
    "start": "605830",
    "end": "611260"
  },
  {
    "text": "want it to be 20 milliseconds okay so I'll go like so some requests can be more than five minutes you can still",
    "start": "611260",
    "end": "617200"
  },
  {
    "text": "have an average of 20 milliseconds but you can have some requests take more than five minutes well of course not like the worst case",
    "start": "617200",
    "end": "623950"
  },
  {
    "text": "is really 100 milliseconds that's something we can't in no conditions go or go over even if it's just two",
    "start": "623950",
    "end": "631600"
  },
  {
    "text": "requests per day right so this is like bargaining for it all right fine nothing",
    "start": "631600",
    "end": "637870"
  },
  {
    "text": "worse than two seconds two seconds is really the the farthest we can go how",
    "start": "637870",
    "end": "643270"
  },
  {
    "text": "often is a 500 millisecond request response time acceptable so for example",
    "start": "643270",
    "end": "648370"
  },
  {
    "text": "if you have 96 percent of your responses take one millisecond and four percent take 500 milliseconds that works out",
    "start": "648370",
    "end": "654880"
  },
  {
    "text": "trust me 221 milliseconds average so it sort of works out and nothing is greater than",
    "start": "654880",
    "end": "661330"
  },
  {
    "text": "two seconds so is that an acceptable distribution of respond times and and I mean you can see where",
    "start": "661330",
    "end": "668210"
  },
  {
    "text": "I'm going right I'm asking not just for a number that you you just sort of pull out of the of thin air I'm asking for a",
    "start": "668210",
    "end": "674480"
  },
  {
    "text": "distribution which is actually based on what the customers are going to experience with the system but it",
    "start": "674480",
    "end": "680300"
  },
  {
    "text": "doesn't always end well especially if you're not prepared to to go through this whole routine but what I'm saying",
    "start": "680300",
    "end": "686990"
  },
  {
    "text": "is what we need for monitoring for alerting for generating these problem",
    "start": "686990",
    "end": "692630"
  },
  {
    "text": "descriptions is really more than just one made-up number like twenty milliseconds latency or twenty",
    "start": "692630",
    "end": "699620"
  },
  {
    "text": "milliseconds average or twenty percent CPU usage across the the system so",
    "start": "699620",
    "end": "705740"
  },
  {
    "text": "here's an example like for a full text for a full text query engine we could",
    "start": "705740",
    "end": "711320"
  },
  {
    "text": "say 90% of the queries should complete under 200 milliseconds 99% under 600",
    "start": "711320",
    "end": "717260"
  },
  {
    "text": "milliseconds and all the queries should complete under two seconds and anything higher than two seconds that that's a",
    "start": "717260",
    "end": "722840"
  },
  {
    "text": "timeout it's an error and I don't want to see that ever so this is already better and hopefully these numbers that",
    "start": "722840",
    "end": "729380"
  },
  {
    "text": "that this distribution is describing are not just made up in a vacuum but they're",
    "start": "729380",
    "end": "736010"
  },
  {
    "text": "based on actual users and business business cases so for some systems it",
    "start": "736010",
    "end": "742370"
  },
  {
    "text": "might be really hard to actually extract this information out of your users maybe you're gonna need usability tests maybe",
    "start": "742370",
    "end": "748490"
  },
  {
    "text": "you're gonna need to talk to business people what I'm saying is we as developers just can't make up these",
    "start": "748490",
    "end": "753920"
  },
  {
    "text": "numbers and operations people they also can't make up these numbers we have to get our alerting we get we have to get",
    "start": "753920",
    "end": "761000"
  },
  {
    "text": "our problem descriptions we have to get the definition of what is a problem in general from an authoritative source",
    "start": "761000",
    "end": "767150"
  },
  {
    "text": "which is hopefully again tied to our business requirements and once you have",
    "start": "767150",
    "end": "773030"
  },
  {
    "text": "those metrics described as some kind of distribution which we'll talk about a little later then you want to monitor",
    "start": "773030",
    "end": "779660"
  },
  {
    "text": "these things with some kind of dashboard APM solution cron job that runs in the",
    "start": "779660",
    "end": "786710"
  },
  {
    "text": "background and gives you alerts we'll talk about that little in the rest of the talk but again for",
    "start": "786710",
    "end": "793140"
  },
  {
    "text": "these problem descriptions to be actionable for the numbers to make sense for us to know what to fix and how often",
    "start": "793140",
    "end": "798570"
  },
  {
    "text": "it's happening we need to have thought about these metrics ahead of time so",
    "start": "798570",
    "end": "804420"
  },
  {
    "text": "let's take a look at a specific example of a performance investigation gone wrong and to do that I want to just stop",
    "start": "804420",
    "end": "811230"
  },
  {
    "text": "briefly about five different anti-patterns for doing performance investigations for things people do",
    "start": "811230",
    "end": "817110"
  },
  {
    "text": "along the way for common mistakes and you'll see some of them illustrated in my example so the number one thing that",
    "start": "817110",
    "end": "823260"
  },
  {
    "text": "usually goes wrong and a lot of in a lot of my work is making assumptions we are all very vulnerable to making",
    "start": "823260",
    "end": "829560"
  },
  {
    "text": "assumptions about software about the world in general and so often we already know where the performance problem is",
    "start": "829560",
    "end": "835800"
  },
  {
    "text": "before we even look at the before we even look at the system because it looks like the problem from last week because",
    "start": "835800",
    "end": "842040"
  },
  {
    "text": "it's John reporting the problem and it's always the same thing when John is reporting the problem we have some sort",
    "start": "842040",
    "end": "847860"
  },
  {
    "text": "of guesses and these assumptions can lead to a colossal waste of time and",
    "start": "847860",
    "end": "852930"
  },
  {
    "text": "again I'll talk about a specific example coming up trusting instincts and irrational beliefs is sometimes even",
    "start": "852930",
    "end": "859680"
  },
  {
    "text": "worse than making assumptions assumptions at least you can sort of contradict but irrational beliefs they",
    "start": "859680",
    "end": "865680"
  },
  {
    "text": "are really hard to fight and by rational beliefs I mean things like the storage system is never at fault it's never the",
    "start": "865680",
    "end": "872940"
  },
  {
    "text": "problem with the storage system or it's just that the cellular connection is so",
    "start": "872940",
    "end": "878250"
  },
  {
    "text": "slow in India that you know we should all just ignore performance issues coming from from cell users in India so",
    "start": "878250",
    "end": "886440"
  },
  {
    "text": "these sort of rational beliefs or instincts that we might have about software are again considered extremely",
    "start": "886440",
    "end": "893430"
  },
  {
    "text": "harmful and a couple of additional examples looking under the streetlight is something I'll illustrate as well and",
    "start": "893430",
    "end": "899730"
  },
  {
    "text": "what I mean by that is looking where it's convenient for you to look so where you have observability into the system",
    "start": "899730",
    "end": "905370"
  },
  {
    "text": "if you only have observability into a specific area it's completely natural to jump to that area first and start",
    "start": "905370",
    "end": "912240"
  },
  {
    "text": "investigating that because you simply don't have the tools or the knowledge right now to investigate other things so",
    "start": "912240",
    "end": "918510"
  },
  {
    "text": "that's also a natural thing to do but it could be again it could lead to a huge waste of time and there's some additional examples",
    "start": "918510",
    "end": "924660"
  },
  {
    "text": "which will illustrate later so let's see a specific a specific case how I failed",
    "start": "924660",
    "end": "929820"
  },
  {
    "text": "to diagnose a performance issue I'm not super proud of this but it is a good",
    "start": "929820",
    "end": "935010"
  },
  {
    "text": "case study I think of things that can go wrong on a performance investigation so here I am sharing it sharing this",
    "start": "935010",
    "end": "941010"
  },
  {
    "text": "personal failure with you so what we had is a document management system with",
    "start": "941010",
    "end": "947760"
  },
  {
    "text": "several thousand internal users inside a specific organization and it was",
    "start": "947760",
    "end": "953370"
  },
  {
    "text": "basically a document management system right so you could load documents from some sort of network storage you could",
    "start": "953370",
    "end": "959459"
  },
  {
    "text": "modify them save them conflict management all all the sorts of things that come with document storage and the",
    "start": "959459",
    "end": "966060"
  },
  {
    "text": "network storage itself was a net up system accessed through SMB through file",
    "start": "966060",
    "end": "971670"
  },
  {
    "text": "shares and this is like the general very very simplified architecture of the",
    "start": "971670",
    "end": "977010"
  },
  {
    "text": "system so you have clients connecting through WCF to an application server and the application server is talking",
    "start": "977010",
    "end": "983610"
  },
  {
    "text": "directly through a file share to a net up storage appliance which is hosted on",
    "start": "983610",
    "end": "988860"
  },
  {
    "text": "the same network so it's all a fairly tight and closed internal network not",
    "start": "988860",
    "end": "994020"
  },
  {
    "text": "over the internet or anything now some parts of this system I could investigate fairly easily and I had the",
    "start": "994020",
    "end": "1000200"
  },
  {
    "text": "knowledge and the tools to do so but some parts like specifically the net up storage appliance I simply couldn't",
    "start": "1000200",
    "end": "1006410"
  },
  {
    "text": "physically access at all and that's a pretty common theme I think with storage",
    "start": "1006410",
    "end": "1011630"
  },
  {
    "text": "appliances they tend to be those black boxes that you're not really allowed to access and investigate directly and sort",
    "start": "1011630",
    "end": "1018680"
  },
  {
    "text": "of it leather investigation a certain way at least in the beginning suspecting the application server suspecting the",
    "start": "1018680",
    "end": "1025160"
  },
  {
    "text": "clients were causing the performance problem now what was the performance problem anyway it was actually a little",
    "start": "1025160",
    "end": "1031188"
  },
  {
    "text": "hard to describe but we managed to narrow it down to certain operations on certain documents leading to timeouts so",
    "start": "1031189",
    "end": "1038630"
  },
  {
    "text": "it wasn't immediately visible with like an error message or anything but we could figure out that the subsequent",
    "start": "1038630",
    "end": "1044959"
  },
  {
    "text": "problems were caused by a timeout in in some load and save operations all right",
    "start": "1044959",
    "end": "1051160"
  },
  {
    "text": "so here's how it starts we processed a lot of network traces trying to figure",
    "start": "1051160",
    "end": "1057230"
  },
  {
    "text": "where the timeouts might be coming from and I was able to see that the mean",
    "start": "1057230",
    "end": "1063549"
  },
  {
    "text": "latency to storage from the application server going back to the previous slide from the application server to the net",
    "start": "1063549",
    "end": "1070429"
  },
  {
    "text": "up storage appliance the mean latency the average latency was 11 milliseconds but we observed peak values of up to",
    "start": "1070429",
    "end": "1077740"
  },
  {
    "text": "1,200 milliseconds so over a second and that could potentially lead to the",
    "start": "1077740",
    "end": "1083030"
  },
  {
    "text": "timeouts people were describing so we had to look at some information from the",
    "start": "1083030",
    "end": "1088070"
  },
  {
    "text": "storage appliance itself in the storage latency counters so we did have to look at that black box on the right all right",
    "start": "1088070",
    "end": "1096679"
  },
  {
    "text": "so a couple of days later we got some information from network engineers looking at that net up storage appliance",
    "start": "1096679",
    "end": "1102620"
  },
  {
    "text": "and the network engineer says his name was network Mac network so he says if",
    "start": "1102620",
    "end": "1108140"
  },
  {
    "text": "I'm not mistaken the network latency maximum was 10 milliseconds with an app",
    "start": "1108140",
    "end": "1113809"
  },
  {
    "text": "with an average of less than one millisecond now this was computed by looking at the network ingress point on",
    "start": "1113809",
    "end": "1121490"
  },
  {
    "text": "the storage appliance itself but discounting the actual storage disk accesses so now we have the full latency",
    "start": "1121490",
    "end": "1130970"
  },
  {
    "text": "of 1200 milliseconds to storage and we have the specific part of that which is",
    "start": "1130970",
    "end": "1136190"
  },
  {
    "text": "network related and that seems to be 10 milliseconds only so that leaves eleven hundred and ninety milliseconds",
    "start": "1136190",
    "end": "1142669"
  },
  {
    "text": "unaccounted for and we suspect they are in that storage subsystem all right so",
    "start": "1142669",
    "end": "1148040"
  },
  {
    "text": "the net up consultant who is the only person in the world equipped to monitor and diagnose issues with net up storage",
    "start": "1148040",
    "end": "1154669"
  },
  {
    "text": "appliances he will be in next week but the system administrator we have who is in charge of that storage appliance says",
    "start": "1154669",
    "end": "1161450"
  },
  {
    "text": "there's no way the net up latency is greater than five microseconds now five",
    "start": "1161450",
    "end": "1167120"
  },
  {
    "text": "microseconds for all disk accesses sounds really optimistic to me but I don't know much about net appliances so",
    "start": "1167120",
    "end": "1173840"
  },
  {
    "text": "I just had to trust them until the net up consultant came in then he came in",
    "start": "1173840",
    "end": "1179240"
  },
  {
    "text": "and he said it's actually five milliseconds and not five microseconds but that's almost the same thing and in",
    "start": "1179240",
    "end": "1186080"
  },
  {
    "text": "any case it's not the storage system in any way because it's it's it's nowhere near the latency that you're",
    "start": "1186080",
    "end": "1193460"
  },
  {
    "text": "describing that might have caused the timeouts we're talking about five milliseconds only and then I asked is",
    "start": "1193460",
    "end": "1200840"
  },
  {
    "text": "that the average or the peak value the five milliseconds because I already know",
    "start": "1200840",
    "end": "1206270"
  },
  {
    "text": "that the average time for loading and storing documents is pretty fast anyway",
    "start": "1206270",
    "end": "1211580"
  },
  {
    "text": "it's like 1011 milliseconds across the board but we do have those rare outliers which are over a second so when you tell",
    "start": "1211580",
    "end": "1218960"
  },
  {
    "text": "me that the storage appliance is five microseconds five milliseconds whatever is that the average latency for saving",
    "start": "1218960",
    "end": "1225200"
  },
  {
    "text": "or storing documents or is that the worst case and then we got the following",
    "start": "1225200",
    "end": "1230750"
  },
  {
    "text": "reply it's the maximum average value over sixty second intervals I love this",
    "start": "1230750",
    "end": "1237080"
  },
  {
    "text": "I I gave this presentation couple times and I still don't understand what this",
    "start": "1237080",
    "end": "1243770"
  },
  {
    "text": "means and to this day we don't know what exactly it means because we got a lot of",
    "start": "1243770",
    "end": "1248840"
  },
  {
    "text": "conflicting answers when we try to press it so that's what we got again maximum",
    "start": "1248840",
    "end": "1255560"
  },
  {
    "text": "average value over 60 seconds intervals now what could it be right so maybe we take the average value over 60 seconds",
    "start": "1255560",
    "end": "1263360"
  },
  {
    "text": "so we aggregate for 60 seconds all the latencies of storage accesses we get the",
    "start": "1263360",
    "end": "1269330"
  },
  {
    "text": "average value of that and then we take lots of these 60 seconds intervals and we gather the maximum of all these",
    "start": "1269330",
    "end": "1275240"
  },
  {
    "text": "averages that's one option maybe we get the maximum over each",
    "start": "1275240",
    "end": "1281170"
  },
  {
    "text": "60-second interval and then we do an average of the maximum values that's another option maybe it's something else",
    "start": "1281170",
    "end": "1287450"
  },
  {
    "text": "entirely we just don't really know and it's not because it was all done over email we actually had a few phone",
    "start": "1287450",
    "end": "1293480"
  },
  {
    "text": "conversations about this as well and we still don't know exactly what was meant here by the maximum average value of vs.",
    "start": "1293480",
    "end": "1300080"
  },
  {
    "text": "yeah it is probably a communication failure of course it is thank you but yeah that's where we were and then I",
    "start": "1300080",
    "end": "1308110"
  },
  {
    "text": "again not being a NetApp expert really I try to look up online if there is a way",
    "start": "1308110",
    "end": "1313550"
  },
  {
    "text": "to maybe monitor the storage system a bit more closely and I found that net up actually unsurprisingly has performance",
    "start": "1313550",
    "end": "1320270"
  },
  {
    "text": "counters that you can enable over SSH and just read them whenever you",
    "start": "1320270",
    "end": "1325300"
  },
  {
    "text": "want right and these include the average read and write latency and that's in",
    "start": "1325300",
    "end": "1330730"
  },
  {
    "text": "milliseconds and that's gathered every second so you can get every second the",
    "start": "1330730",
    "end": "1336250"
  },
  {
    "text": "average read and write latency for net appliance it's not exactly what I wanted but at least it was updated every second",
    "start": "1336250",
    "end": "1343950"
  },
  {
    "text": "unfortunately we ran out of budget for the net up consultant at this point it",
    "start": "1343950",
    "end": "1349090"
  },
  {
    "text": "turns out they're really really expensive he had a bag that said net up or all over it it's a it's a very",
    "start": "1349090",
    "end": "1354580"
  },
  {
    "text": "expensive bag as well so at this point the investigation just ended and a few",
    "start": "1354580",
    "end": "1360310"
  },
  {
    "text": "months later I actually heard back from that customer and they were able to work",
    "start": "1360310",
    "end": "1365530"
  },
  {
    "text": "around the problem not by replacing the storage appliance or by figuring out why",
    "start": "1365530",
    "end": "1370810"
  },
  {
    "text": "the storage maybe was slower than expected but by retrying automatically",
    "start": "1370810",
    "end": "1376480"
  },
  {
    "text": "in the client like under the standard covers by hooking some api's and just injecting retries until it worked",
    "start": "1376480",
    "end": "1383620"
  },
  {
    "text": "and it meant it meant deploying additional code to every single workstation and doing that work on the",
    "start": "1383620",
    "end": "1389800"
  },
  {
    "text": "client but hey it did solve the issue they never ran out they never ran into these timeouts ever again so I consider",
    "start": "1389800",
    "end": "1397630"
  },
  {
    "text": "this a serious failure from a lot of aspects right so there were assumptions made a lot of irrational beliefs along",
    "start": "1397630",
    "end": "1405430"
  },
  {
    "text": "the way communication failures during this entire investigation the whole budget problem was a problem so these",
    "start": "1405430",
    "end": "1412720"
  },
  {
    "text": "are some of the things that could go wrong and I think hearing this story sort of gives you an idea of what to",
    "start": "1412720",
    "end": "1418210"
  },
  {
    "text": "expect I have another story coming up which is a little more optimistic but that that sort of thing definitely",
    "start": "1418210",
    "end": "1424210"
  },
  {
    "text": "happens and will happen to me again and after all that we talked to the net up guy again and he said again you know I",
    "start": "1424210",
    "end": "1431260"
  },
  {
    "text": "understand that you did this workaround and it's all working fine now but I mean I'm telling you there is no way it could",
    "start": "1431260",
    "end": "1437230"
  },
  {
    "text": "have been more than five milliseconds because that's how net up works there is no way for net up to actually work",
    "start": "1437230",
    "end": "1442420"
  },
  {
    "text": "slower than five milliseconds this is the sad ending of this story all right",
    "start": "1442420",
    "end": "1447760"
  },
  {
    "text": "so we talked a bit about some of the things that can go wrong in a performance investigation I want to",
    "start": "1447760",
    "end": "1454420"
  },
  {
    "text": "touch really on the other three things look under the streetlight random tools and blame the tools so here's an example of looking",
    "start": "1454420",
    "end": "1461710"
  },
  {
    "text": "under the streetlight if you have a bunch of expensive tools that give you observability into into a certain part",
    "start": "1461710",
    "end": "1467950"
  },
  {
    "text": "of your system you might be just using these tools automatically for every problem you now have and a classic",
    "start": "1467950",
    "end": "1474100"
  },
  {
    "text": "example of that is CPU profilers CPU profilers are really abundant and",
    "start": "1474100",
    "end": "1479230"
  },
  {
    "text": "they're not really hard to use and this is an example of output from the visual",
    "start": "1479230",
    "end": "1485680"
  },
  {
    "text": "studio CPU profiler it's really easy to run and get results from an application",
    "start": "1485680",
    "end": "1491380"
  },
  {
    "text": "and in this case we run it on a web crawler which is like downloading pages",
    "start": "1491380",
    "end": "1497470"
  },
  {
    "text": "of the web as fast as it can and profile the results point to a particular",
    "start": "1497470",
    "end": "1503410"
  },
  {
    "text": "function called console dot write line which is taking 66 percent of the",
    "start": "1503410",
    "end": "1508630"
  },
  {
    "text": "applications CPU time well does that mean we have to fix console.writeline",
    "start": "1508630",
    "end": "1514600"
  },
  {
    "text": "or maybe replace our usage of console.writeline with some other more",
    "start": "1514600",
    "end": "1519610"
  },
  {
    "text": "efficient method not necessarily because maybe our application is not really",
    "start": "1519610",
    "end": "1525790"
  },
  {
    "text": "taking lots of CPU anyway and if we run a CPU profiler we're looking into only",
    "start": "1525790",
    "end": "1531400"
  },
  {
    "text": "that particular component only that particular resource which is the CPU and we are ignoring time spent doing i/o",
    "start": "1531400",
    "end": "1538270"
  },
  {
    "text": "network requests and all other kind of activity so this again is an example of",
    "start": "1538270",
    "end": "1543790"
  },
  {
    "text": "using a tool that gives you observability into a specific area of the system because that's easy or",
    "start": "1543790",
    "end": "1548920"
  },
  {
    "text": "because you've paid a lot of money for license for that specific tool and it gives you some results but they're not",
    "start": "1548920",
    "end": "1555700"
  },
  {
    "text": "necessarily the results that can help resolve the issue you have another example of this is sort of not trusting",
    "start": "1555700",
    "end": "1563830"
  },
  {
    "text": "your tools or maybe misunderstanding your tools this is a really simple",
    "start": "1563830",
    "end": "1569170"
  },
  {
    "text": "example of a console application I wrote which runs for two seconds and then throws an out of memory exception but",
    "start": "1569170",
    "end": "1576520"
  },
  {
    "text": "then you look in task manager and in task manager you look at the memory column and it says the application is",
    "start": "1576520",
    "end": "1582370"
  },
  {
    "text": "only using like ten megabytes of memory so could it be that the dotnet runtime",
    "start": "1582370",
    "end": "1587410"
  },
  {
    "text": "is so bad that you can't allocate more than ten megabytes of memory before it runs",
    "start": "1587410",
    "end": "1592450"
  },
  {
    "text": "out of memory and frozen out of memory exception or maybe task manager is just",
    "start": "1592450",
    "end": "1597760"
  },
  {
    "text": "lying to you and like misrepresenting the memory usage of that application there's a lot of theories that you could",
    "start": "1597760",
    "end": "1603940"
  },
  {
    "text": "have at this point in unless you know already what's going on and what's going",
    "start": "1603940",
    "end": "1609130"
  },
  {
    "text": "on is that the memory column and task manager only represents part of your applications memory usage specifically",
    "start": "1609130",
    "end": "1616720"
  },
  {
    "text": "by default task manager shows the private working set which is memory not",
    "start": "1616720",
    "end": "1621940"
  },
  {
    "text": "shared with other processes and memory which is resident in physical memory which is sitting in RAM and not possibly",
    "start": "1621940",
    "end": "1629290"
  },
  {
    "text": "paged out so this is just part of the applications memory usage and that could be why we're still run into an out of",
    "start": "1629290",
    "end": "1635320"
  },
  {
    "text": "memory exception even though the private working set is so tiny so it's just about misunderstanding what the tool is",
    "start": "1635320",
    "end": "1642250"
  },
  {
    "text": "saying or maybe not exactly aligning what the tool is saying with our model",
    "start": "1642250",
    "end": "1648730"
  },
  {
    "text": "of how the application or the system works and another example of a pretty common problem is just sort of throwing",
    "start": "1648730",
    "end": "1655690"
  },
  {
    "text": "away the tool completely and here's a classic example of that so I ran notepad and then I attached a",
    "start": "1655690",
    "end": "1662650"
  },
  {
    "text": "really popular sysinternals tool called VM map VM map if you haven't used it",
    "start": "1662650",
    "end": "1668320"
  },
  {
    "text": "it's really it's really super cool you attach it to a process and it tells you exactly a breakdown of that processes",
    "start": "1668320",
    "end": "1674050"
  },
  {
    "text": "memory usage so how much managed memory is there how much memory is used by the heap by the stack by loaded dll's it",
    "start": "1674050",
    "end": "1681790"
  },
  {
    "text": "just breaks down the whole thing into components and then like vm map says",
    "start": "1681790",
    "end": "1687580"
  },
  {
    "text": "about notepad that notepads total memory usage is two point something terabytes",
    "start": "1687580",
    "end": "1696150"
  },
  {
    "text": "and I mean it's it's notepad and I haven't even opened the file it's just",
    "start": "1696150",
    "end": "1701170"
  },
  {
    "text": "plain blank notepad so that couldn't possibly be right it means VM map is lying to us maybe it",
    "start": "1701170",
    "end": "1707830"
  },
  {
    "text": "wasn't updated for the latest version of Windows maybe there's a bug in notepad maybe there's a hacker attacking your system",
    "start": "1707830",
    "end": "1715170"
  },
  {
    "text": "so in that sort of case you might just discard the tool completely throw it away and never use it again",
    "start": "1715170",
    "end": "1721720"
  },
  {
    "text": "but actually VM app is telling the truth on newer versions of Windows there is a",
    "start": "1721720",
    "end": "1728170"
  },
  {
    "text": "security feature called control flow guard which leads to two terabytes of memory being reserved in each process",
    "start": "1728170",
    "end": "1735490"
  },
  {
    "text": "even if it opts into that security feature and this has just reserved virtual memory it's not actual memory",
    "start": "1735490",
    "end": "1742600"
  },
  {
    "text": "that you're paying for it's not disk space it's not physical memory it's basically nothing it's just a reserved memory space which is used by that",
    "start": "1742600",
    "end": "1749680"
  },
  {
    "text": "particular security feature so every process will have two terabytes of memory if you look at reserved memory as",
    "start": "1749680",
    "end": "1757510"
  },
  {
    "text": "part of your memory so it's not lying to you via map it's reporting the truth but you have to understand what it's saying",
    "start": "1757510",
    "end": "1763450"
  },
  {
    "text": "and maybe just maybe you have to trust the tool first and try to understand what the tool is reported but I will",
    "start": "1763450",
    "end": "1770410"
  },
  {
    "text": "have in just a couple of slides an example where you shouldn't trust the tools so it really goes both ways",
    "start": "1770410",
    "end": "1776280"
  },
  {
    "text": "sometimes so these are again some of the common mistakes people make when conducting a performance investigation I",
    "start": "1776280",
    "end": "1782710"
  },
  {
    "text": "say people but I do that as well I mean these are all very natural things to do trusting instincts irrational beliefs",
    "start": "1782710",
    "end": "1789130"
  },
  {
    "text": "making assumptions using tools because you've used these tools before or because they're handy and give you",
    "start": "1789130",
    "end": "1794770"
  },
  {
    "text": "observability into a certain part of the system so let's talk about the method which is slightly more rigorous it's not",
    "start": "1794770",
    "end": "1803380"
  },
  {
    "text": "a lot harder but it works well in a lot of cases I haven't invented it it was",
    "start": "1803380",
    "end": "1808630"
  },
  {
    "text": "popularized by Brendan Gregg who's a performance architect working at Netflix today and it's called the u.s.a method",
    "start": "1808630",
    "end": "1814750"
  },
  {
    "text": "and US a-- stands for utilization saturation and errors I'll talk about each of these in a moment and then I'll",
    "start": "1814750",
    "end": "1821350"
  },
  {
    "text": "tell you what the method is so utilization I guess is the easiest metric to define it's a metric of load",
    "start": "1821350",
    "end": "1828070"
  },
  {
    "text": "which proportion of time a particular resource in your system is working as opposed to the time it is idle and not",
    "start": "1828070",
    "end": "1835810"
  },
  {
    "text": "doing anything for different resources you could define the utilization slightly differently but that's the",
    "start": "1835810",
    "end": "1841990"
  },
  {
    "text": "obvious metric of load or usage utilization so for a CPU it's the",
    "start": "1841990",
    "end": "1847060"
  },
  {
    "text": "proportion of time the CPU is busy executing instructions for a web application could be the proportion of",
    "start": "1847060",
    "end": "1852700"
  },
  {
    "text": "time the application is servicing requests and not just waiting for additional requests and so on",
    "start": "1852700",
    "end": "1858660"
  },
  {
    "text": "saturation is a metric of overload how overloaded or queued up that resource is",
    "start": "1858660",
    "end": "1865180"
  },
  {
    "text": "so if you have work waiting for that resource to become available then you have saturation for example for a web",
    "start": "1865180",
    "end": "1872740"
  },
  {
    "text": "application if you have web requests HTTP requests sitting in a queue and not",
    "start": "1872740",
    "end": "1877750"
  },
  {
    "text": "getting processed immediately then you have saturation in your web server if for a disk drive for a disk drive if you",
    "start": "1877750",
    "end": "1887200"
  },
  {
    "text": "have requests writer reads waiting for the disk to start servicing them because",
    "start": "1887200",
    "end": "1893140"
  },
  {
    "text": "the disk is busy doing other things then you have saturation for your disk and so on and finally errors are just that",
    "start": "1893140",
    "end": "1900610"
  },
  {
    "text": "errors exceptions failures faults whatever you call them so for each of the resources in your system how it will",
    "start": "1900610",
    "end": "1907270"
  },
  {
    "text": "resources as well as software resources you want to look at utilization saturation and errors model these things",
    "start": "1907270",
    "end": "1914020"
  },
  {
    "text": "measure them look at them for each of the resources in your system to understand what's going on and this is",
    "start": "1914020",
    "end": "1920410"
  },
  {
    "text": "the initial checklist stage of your investigation you haven't done any thermal analysis yet you're just getting",
    "start": "1920410",
    "end": "1926650"
  },
  {
    "text": "a reading of how the system is behaving and this is it's it might sound completely trivial and you're already",
    "start": "1926650",
    "end": "1933490"
  },
  {
    "text": "doing it and you have wonderful tools and dashboards that give you all this information but if not then you",
    "start": "1933490",
    "end": "1939520"
  },
  {
    "text": "absolutely have to start there if you don't have that visibility into each of the things you have in your system then",
    "start": "1939520",
    "end": "1946390"
  },
  {
    "text": "you have a problem whenever you perform a performance investigation you will not know what to look at you will not know",
    "start": "1946390",
    "end": "1952510"
  },
  {
    "text": "which potential black box could be causing problems for the rest of the system so just a couple of examples for",
    "start": "1952510",
    "end": "1959230"
  },
  {
    "text": "how to restore TSA's this is like a typical workstation you have a CPU you",
    "start": "1959230",
    "end": "1965590"
  },
  {
    "text": "have a disk drive you have a network card you have physical memory you have a graphics card attached as well for each",
    "start": "1965590",
    "end": "1972700"
  },
  {
    "text": "of these things and for the buses for the interconnects between these things",
    "start": "1972700",
    "end": "1978190"
  },
  {
    "text": "you can look at utilization saturation and errors I've given a couple of examples but for Hardware they should be",
    "start": "1978190",
    "end": "1984910"
  },
  {
    "text": "relatively easy to derive and they should be also relatively easy to monitor because I mean most hardware",
    "start": "1984910",
    "end": "1991960"
  },
  {
    "text": "is is just generally the same so CPUs are CPUs and we have pretty standard",
    "start": "1991960",
    "end": "1997240"
  },
  {
    "text": "tools for monitoring CPU utilization or CPU saturation but software you know",
    "start": "1997240",
    "end": "2003450"
  },
  {
    "text": "software is a whole zoo of different frameworks and components but we can do it for software as well we can identify",
    "start": "2003450",
    "end": "2010140"
  },
  {
    "text": "the software resources in our system web servers load balancers backends",
    "start": "2010140",
    "end": "2016280"
  },
  {
    "text": "databases caches and so on and for each of these things we can look at",
    "start": "2016280",
    "end": "2021360"
  },
  {
    "text": "utilization saturation and errors as well and for software if it's well designed software and monitoring is part",
    "start": "2021360",
    "end": "2028799"
  },
  {
    "text": "of the whole thing the whole framework you're buying then you'd be able to easily monitor these metrics for that",
    "start": "2028799",
    "end": "2035580"
  },
  {
    "text": "particular software if it's not that well designed it might be really hard to extract us information out of a",
    "start": "2035580",
    "end": "2043440"
  },
  {
    "text": "component so this is again something that obviously depends on the specific pieces that you're using to build your",
    "start": "2043440",
    "end": "2050280"
  },
  {
    "text": "system but you should have that sort of visibility into them as well now I've given here in the slides just for",
    "start": "2050280",
    "end": "2056128"
  },
  {
    "text": "reference aus a checklist for some of the hardware resources on Windows systems is just an example and you can",
    "start": "2056129",
    "end": "2063330"
  },
  {
    "text": "find this sort of thing on the web these are just various performance counters",
    "start": "2063330",
    "end": "2068368"
  },
  {
    "text": "that give you for network cards for disks for CPU for memory the u.s. a",
    "start": "2068369",
    "end": "2074398"
  },
  {
    "text": "matrix which you can easily monitor I'll give you the hood the whole set of slides so you don't have to take photos",
    "start": "2074399",
    "end": "2080790"
  },
  {
    "text": "of the checklist now and you can automate the process of collecting this",
    "start": "2080790",
    "end": "2085950"
  },
  {
    "text": "checklist and getting alerts based on that checklist just a couple of very",
    "start": "2085950",
    "end": "2091138"
  },
  {
    "text": "basic rudimentary tools if you don't have anything super fancy to monitor your system type perf is a command line",
    "start": "2091139",
    "end": "2098520"
  },
  {
    "text": "tool built into Windows which can generate CSVs of these different metrics",
    "start": "2098520",
    "end": "2103619"
  },
  {
    "text": "on the console and perfmon is the windows performance monitor which can collect performance information for you",
    "start": "2103619",
    "end": "2110670"
  },
  {
    "text": "in the background and it can even issue alerts it can for example run some sort",
    "start": "2110670",
    "end": "2115950"
  },
  {
    "text": "of application when one of the Metro is breached and of course there's plenty of third-party agents that will collect",
    "start": "2115950",
    "end": "2122610"
  },
  {
    "text": "this information for you and many of them are already tuned to collect the USC metrics already so once we have that",
    "start": "2122610",
    "end": "2131900"
  },
  {
    "text": "kind of high-level set of things about our system we can perform a performance",
    "start": "2131900",
    "end": "2138660"
  },
  {
    "text": "investigation more easily and I want to show you one example where we really didn't need a lot of information to",
    "start": "2138660",
    "end": "2145470"
  },
  {
    "text": "diagnose the problem but we did have access to metrics we did have access to the system and that helped solve the",
    "start": "2145470",
    "end": "2151170"
  },
  {
    "text": "problem at the end so this is a story of how I found a bug in the CLR 2.0 garbage",
    "start": "2151170",
    "end": "2156300"
  },
  {
    "text": "collector and that sounds like really",
    "start": "2156300",
    "end": "2161610"
  },
  {
    "text": "unlikely a bug in the garbage collector when they do happen once in a while before we blame the garbage collector we",
    "start": "2161610",
    "end": "2168780"
  },
  {
    "text": "do have to you know make sure exonerate every other piece of the system but in this case it really was the garbage",
    "start": "2168780",
    "end": "2174780"
  },
  {
    "text": "collector this is from nine years ago eight and a half so it's not a super brand new story and eight and a half",
    "start": "2174780",
    "end": "2181830"
  },
  {
    "text": "years ago we didn't have access to the CLR source code so that was a little harder to diagnose than it might have",
    "start": "2181830",
    "end": "2187650"
  },
  {
    "text": "been today anyway the symptom was we had",
    "start": "2187650",
    "end": "2193440"
  },
  {
    "text": "a packet processing system getting requests off the wire and doing some",
    "start": "2193440",
    "end": "2198780"
  },
  {
    "text": "kind of processing before just throwing the packet away or recording it to a file and sometimes when processing a",
    "start": "2198780",
    "end": "2206520"
  },
  {
    "text": "very specific kind of packets we had hiccups in the application so it would",
    "start": "2206520",
    "end": "2211560"
  },
  {
    "text": "drop thousands of packets before proceeding to operate normally sometimes for hours at the end so it would just",
    "start": "2211560",
    "end": "2218280"
  },
  {
    "text": "work for a few hours and then it would have a hiccup of a couple of seconds and just keep working normally for more for",
    "start": "2218280",
    "end": "2224610"
  },
  {
    "text": "a few more hours in the logs it looked like this so it would just work normally",
    "start": "2224610",
    "end": "2230130"
  },
  {
    "text": "and then boom we have a 500 millisecond pause where nothing is happening even",
    "start": "2230130",
    "end": "2235620"
  },
  {
    "text": "with the highest with with all the logs turned on nothing would be printed just 500 milliseconds of doing nothing now if",
    "start": "2235620",
    "end": "2243240"
  },
  {
    "text": "you're if you've been doing some investigations that involve the garbage collector you might immediately suspect",
    "start": "2243240",
    "end": "2250119"
  },
  {
    "text": "has to do with GC pauses so the GC is stopping your application in order to clean up memory and this is why you're",
    "start": "2250119",
    "end": "2256960"
  },
  {
    "text": "having these pauses it's not a bug in the garbage collector Sasha you're just not understanding how the garbage",
    "start": "2256960",
    "end": "2262210"
  },
  {
    "text": "collector works so that could be the case but let's keep talking so this is",
    "start": "2262210",
    "end": "2268539"
  },
  {
    "text": "what it looked like when we collected a bit of performance information you can see two metrics here the blue one is the",
    "start": "2268539",
    "end": "2274869"
  },
  {
    "text": "number of packets processed per millisecond so we were processing tens of thousands of packets per second or",
    "start": "2274869",
    "end": "2281710"
  },
  {
    "text": "tens of packets per millisecond and the red line is CPU utilization across the",
    "start": "2281710",
    "end": "2287710"
  },
  {
    "text": "system and then you can see it's time-stamped 3,000 something weird happens we have a CPU usage drop but not",
    "start": "2287710",
    "end": "2296410"
  },
  {
    "text": "completely drop to about 20% and we have packet rates drop again not completely",
    "start": "2296410",
    "end": "2302980"
  },
  {
    "text": "to zero but very close to that and then after a little time we have CPU spike up",
    "start": "2302980",
    "end": "2310390"
  },
  {
    "text": "to 100% and packet rates drop to zero so",
    "start": "2310390",
    "end": "2315400"
  },
  {
    "text": "this is complete zero no packets are being processed over here and then it all go back goes back to normal",
    "start": "2315400",
    "end": "2321220"
  },
  {
    "text": "slightly more jittery because you know there's some packets to make up for but generally it goes back to normal and it",
    "start": "2321220",
    "end": "2327670"
  },
  {
    "text": "could go for hours on end like this okay so again to make a long story short",
    "start": "2327670",
    "end": "2333749"
  },
  {
    "text": "another funny thing that we were able to observe after a while is that these delays during which no packets are being",
    "start": "2333749",
    "end": "2341559"
  },
  {
    "text": "processed were always multiples of 250 milliseconds so it was like 252",
    "start": "2341559",
    "end": "2347710"
  },
  {
    "text": "milliseconds 503 milliseconds 751 milliseconds it's almost as if someone",
    "start": "2347710",
    "end": "2353739"
  },
  {
    "text": "had some kind of timer or a sleep statement for 200 milliseconds which was",
    "start": "2353739",
    "end": "2358809"
  },
  {
    "text": "getting hit somewhere inside the system so we kept investigating and eventually",
    "start": "2358809",
    "end": "2365380"
  },
  {
    "text": "and again it's 9 years ago it was a bit harder back then eventually we were able to get a thread dump of what the system",
    "start": "2365380",
    "end": "2372460"
  },
  {
    "text": "was actually doing during one of these hiccups during one of these delays and then what",
    "start": "2372460",
    "end": "2378549"
  },
  {
    "text": "we discovered is we had four garbage collector threads and they were just sitting there",
    "start": "2378549",
    "end": "2383770"
  },
  {
    "text": "waiting they were not doing a garbage collection yet they were sitting there waiting for a garbage collection to",
    "start": "2383770",
    "end": "2388870"
  },
  {
    "text": "start and then we had to application threads one thread was parsing packets",
    "start": "2388870",
    "end": "2394300"
  },
  {
    "text": "just as fast as it could and another thread that was starting a garbage",
    "start": "2394300",
    "end": "2399340"
  },
  {
    "text": "collection so another thread was trying to allocate memory and it couldn't and it hit a GC and it tries what it's",
    "start": "2399340",
    "end": "2406360"
  },
  {
    "text": "trying to do right now it's trying to suspend this other thread it hasn't",
    "start": "2406360",
    "end": "2411730"
  },
  {
    "text": "succeeded yet it didn't suspend the thread because the GC threads are not working yet is just trying to stop this",
    "start": "2411730",
    "end": "2418480"
  },
  {
    "text": "other thread on the left and it's trying really hard and it's trying really hard for 500 milliseconds and 750",
    "start": "2418480",
    "end": "2425800"
  },
  {
    "text": "milliseconds and so on sometimes all the way up to one and a half seconds just trying to suspend that other thread and",
    "start": "2425800",
    "end": "2432400"
  },
  {
    "text": "that looked really suspicious to us so we started reverse engineering that suspend function and relevant code",
    "start": "2432400",
    "end": "2438880"
  },
  {
    "text": "around it today we would just look up on github at the CLR sources but back then we reversed it a bit and found the",
    "start": "2438880",
    "end": "2445900"
  },
  {
    "text": "following loop in there and again cutting a long story short there was actually a 250 millisecond timeout in",
    "start": "2445900",
    "end": "2453820"
  },
  {
    "text": "there so basically it goes something like as long as we haven't successfully suspended the thread and we haven't",
    "start": "2453820",
    "end": "2460660"
  },
  {
    "text": "given up yet wait for 250 milliseconds to see if that thread was successfully",
    "start": "2460660",
    "end": "2466390"
  },
  {
    "text": "suspended and if not then sometimes it would retry and sometimes it would jump out of the loop and just do a an",
    "start": "2466390",
    "end": "2472840"
  },
  {
    "text": "aggressive suspension which doesn't require cooperation from that other thread so this whole thing eventually",
    "start": "2472840",
    "end": "2479980"
  },
  {
    "text": "looks like a bug because we're not supposed to be stuck in this whole suspension process for so long but I",
    "start": "2479980",
    "end": "2485230"
  },
  {
    "text": "didn't know it back then I couldn't you know create a pull request so I think I submitted an item on connect and I wrote",
    "start": "2485230",
    "end": "2492640"
  },
  {
    "text": "a blog post about it to see if you know someone else has ever run into this sort of thing and then a couple of weeks",
    "start": "2492640",
    "end": "2498610"
  },
  {
    "text": "later I got a comment on my blog post from my oneís Maroney Stevens who's the lead developer on the garbage collector",
    "start": "2498610",
    "end": "2505030"
  },
  {
    "text": "at this at Microsoft she's still at that role today and she wrote I ran a retro",
    "start": "2505030",
    "end": "2511000"
  },
  {
    "text": "and I do see the suspension problem we'll look at that and see what happens and they found a bug in",
    "start": "2511000",
    "end": "2517730"
  },
  {
    "text": "garbage collector which was responsible for that suspension problem and they fixed it eventually and so if you're",
    "start": "2517730",
    "end": "2523430"
  },
  {
    "text": "interested in the whole story you can read it on my blog but this is an example of where you know we didn't make",
    "start": "2523430",
    "end": "2529609"
  },
  {
    "text": "anything we didn't use any super fancy tools or techniques we just sort of methodically narrowed it down a little",
    "start": "2529609",
    "end": "2536540"
  },
  {
    "text": "more and a little more a little more until we were able to figure out it's not really our fault at the end we did",
    "start": "2536540",
    "end": "2543349"
  },
  {
    "text": "manage to find a workaround as well it's all on my blog if you're interested so this is an example that I'm a little",
    "start": "2543349",
    "end": "2550040"
  },
  {
    "text": "more proud of than the previous story with the network appliance so now that",
    "start": "2550040",
    "end": "2555650"
  },
  {
    "text": "we talked about the performance investigation process itself I don't want to leave you with some practical",
    "start": "2555650",
    "end": "2560840"
  },
  {
    "text": "things as well so I want to touch briefly on good performance tools what good performance tools look like and",
    "start": "2560840",
    "end": "2566599"
  },
  {
    "text": "again it's not a very hardcore session so I'm not going to be showing you demos of performance tools but I do want to",
    "start": "2566599",
    "end": "2572210"
  },
  {
    "text": "sort of touch on what kind of tools are out there and which tools work well so I",
    "start": "2572210",
    "end": "2578330"
  },
  {
    "text": "think there are three kinds of performance tools all in all the first",
    "start": "2578330",
    "end": "2584660"
  },
  {
    "text": "is counting tools which only tell you how often something is happening and these are the cheapest tools usually in",
    "start": "2584660",
    "end": "2591170"
  },
  {
    "text": "terms of overhead they don't have a lot of overhead they're just counting something so they're telling you the number of requests your application is",
    "start": "2591170",
    "end": "2597950"
  },
  {
    "text": "able to process or the number of packets sent over a particular network interface that sort of thing then we have latency",
    "start": "2597950",
    "end": "2605630"
  },
  {
    "text": "tools which tell you how long something is taking and that's usually a bit more expensive to collect because you have to",
    "start": "2605630",
    "end": "2611780"
  },
  {
    "text": "you know record a timestamp at the start and the end of a certain operation and have to aggregate this information the",
    "start": "2611780",
    "end": "2618320"
  },
  {
    "text": "output of this sort of tool of a latency tool could be not just the average value",
    "start": "2618320",
    "end": "2623390"
  },
  {
    "text": "which is not really great but could be something a little better like a distribution a histogram a range of",
    "start": "2623390",
    "end": "2629420"
  },
  {
    "text": "values or a range of latencies that you can then investigate and finally the",
    "start": "2629420",
    "end": "2634880"
  },
  {
    "text": "deepest tools will tell you what is causing something to happen across your system I call those the stack collection",
    "start": "2634880",
    "end": "2641990"
  },
  {
    "text": "tools they will give you call stacks of interesting events like disk accesses garbage collections memory allocations",
    "start": "2641990",
    "end": "2648530"
  },
  {
    "text": "and it would be able to look at these look at these stacked races and aggregate them and this is usually the",
    "start": "2648530",
    "end": "2654410"
  },
  {
    "text": "most expensive things because because collecting stacked race is aggregating them and so on that's a rather expensive",
    "start": "2654410",
    "end": "2659840"
  },
  {
    "text": "operation all right so these are the types of tools and I'll mention a couple of examples but here are some of the",
    "start": "2659840",
    "end": "2666860"
  },
  {
    "text": "qualities I want these tools to have and again they it might sound a little trivial but not all tools are really",
    "start": "2666860",
    "end": "2673100"
  },
  {
    "text": "great at these things so first low-overhead I'll touch on that in a moment but if you're running a",
    "start": "2673100",
    "end": "2679430"
  },
  {
    "text": "performance tool especially on a production system you don't want it to slow things down too badly you want the",
    "start": "2679430",
    "end": "2686210"
  },
  {
    "text": "tool to be accurate again it sounds kind of obvious but not all performance tools really are that accurate or they could",
    "start": "2686210",
    "end": "2692240"
  },
  {
    "text": "be skewed by what your system is doing or what your application is doing you want your tools to have a quick",
    "start": "2692240",
    "end": "2698180"
  },
  {
    "text": "turnaround so you don't have to wait for eight hours to get results out of a performance tool when you're under",
    "start": "2698180",
    "end": "2703460"
  },
  {
    "text": "pressure to do a performance investigation you want the tools to be production ready by which I mean you can",
    "start": "2703460",
    "end": "2709340"
  },
  {
    "text": "actually put them on a production system and run them over there without any additional extra preparation or any",
    "start": "2709340",
    "end": "2714710"
  },
  {
    "text": "invasive steps like restarting the system and finally I want the output from the tool to be easily focusable so",
    "start": "2714710",
    "end": "2721580"
  },
  {
    "text": "that I can find interesting things and the output right away without having to read through say 50 pages of reports to",
    "start": "2721580",
    "end": "2728780"
  },
  {
    "text": "find what's causing my problem so let's talk about some of these aspects for a bit let's talk about accuracy first a lot of",
    "start": "2728780",
    "end": "2736700"
  },
  {
    "text": "the Java profilers and I know it's a surprising twist but I've ever said it's going to be a talk only about dotnet",
    "start": "2736700",
    "end": "2741830"
  },
  {
    "text": "performance tools so a lot of Java profilers actually produce blatantly",
    "start": "2741830",
    "end": "2747560"
  },
  {
    "text": "irrelevant results completely irrelevant or false results when you use them for",
    "start": "2747560",
    "end": "2753620"
  },
  {
    "text": "CPU profiling and it's a result of using a documented API which collects stack",
    "start": "2753620",
    "end": "2759890"
  },
  {
    "text": "traces of threads when you want to see what your threads are doing which sounds like a totally legit things to do you",
    "start": "2759890",
    "end": "2766610"
  },
  {
    "text": "want to stop threads look what thread is doing collect the stack trace let the tread keep running it's useful to do a",
    "start": "2766610",
    "end": "2772790"
  },
  {
    "text": "performance investigation or to profile the trip unfortunately the way that API",
    "start": "2772790",
    "end": "2778550"
  },
  {
    "text": "works the way it captures the stack trace of a thread is completely biased",
    "start": "2778550",
    "end": "2783859"
  },
  {
    "text": "because it doesn't capture the stacktrace right away it waits for the thread to reach a safe point and I'm not",
    "start": "2783859",
    "end": "2790069"
  },
  {
    "text": "going to explain exactly what a safe point is but the tread could be running for a while until it reaches the next",
    "start": "2790069",
    "end": "2795259"
  },
  {
    "text": "safe point so if you ask what is this thread doing you're not getting a right the right response right away you you",
    "start": "2795259",
    "end": "2802099"
  },
  {
    "text": "will know what the thread will be doing when it hits the same the safe point that's the result you're going to eventually get and sometimes it's it",
    "start": "2802099",
    "end": "2809569"
  },
  {
    "text": "completely skews the results and there's actually a research paper on it called",
    "start": "2809569",
    "end": "2815690"
  },
  {
    "text": "evaluating the accuracy of Java profilers I recommend it it's really funny and one thing it shows on the left",
    "start": "2815690",
    "end": "2822619"
  },
  {
    "text": "here is that they ran for different profilers on the same workload exactly",
    "start": "2822619",
    "end": "2828259"
  },
  {
    "text": "and each profiler thought some other method was running longest and they also",
    "start": "2828259",
    "end": "2834380"
  },
  {
    "text": "disagreed on what longest means so some profilers thought the slowest method was taking 5% of the time other tools",
    "start": "2834380",
    "end": "2841369"
  },
  {
    "text": "thought it was up to 20% of the time so they not only disagreed about which method was the most expensive one they",
    "start": "2841369",
    "end": "2847759"
  },
  {
    "text": "also disagreed what most expensive is for this workload again it's exactly the same application just for different",
    "start": "2847759",
    "end": "2853670"
  },
  {
    "text": "tools and that means like someone is lying maybe all of them are lying maybe just one of them is is is giving the",
    "start": "2853670",
    "end": "2859819"
  },
  {
    "text": "right results but this is highly suspicious so what I'm saying is that unfortunately in some cases yes the",
    "start": "2859819",
    "end": "2865970"
  },
  {
    "text": "tools do lie and if you're using a new performance tool and you don't understand how the performance tool",
    "start": "2865970",
    "end": "2871369"
  },
  {
    "text": "works then you sort of have to sanity test your profiler you have to see if it",
    "start": "2871369",
    "end": "2876710"
  },
  {
    "text": "makes sense the results you're getting if they make sense on a known workload where you know what results should be",
    "start": "2876710",
    "end": "2882279"
  },
  {
    "text": "should be generated and see if the profiler actually generates that result",
    "start": "2882279",
    "end": "2887859"
  },
  {
    "text": "now when Windows for dotnet applications and for other kinds of applications on Windows we have a really great system",
    "start": "2887859",
    "end": "2895099"
  },
  {
    "text": "for doing profiling and performance collection which is called etw event tracing for Windows and we could do a",
    "start": "2895099",
    "end": "2901640"
  },
  {
    "text": "whole different talk just focusing on atw itself and it's really it's a really great facility because you can enable it",
    "start": "2901640",
    "end": "2907940"
  },
  {
    "text": "without touching the target process you can collect a lot of information it's",
    "start": "2907940",
    "end": "2912950"
  },
  {
    "text": "all really wonderful and useful so again a completely different talk on the matter it's uh VZW but I just want to focus on",
    "start": "2912950",
    "end": "2919810"
  },
  {
    "text": "one aspect of it when talking about tools and that's quick turnaround getting quick results out of the tool so",
    "start": "2919810",
    "end": "2927520"
  },
  {
    "text": "this is an example of a performance session where I collected information from etw",
    "start": "2927520",
    "end": "2933460"
  },
  {
    "text": "using a performance tool called perf view and this is what the log looks like so first it says collecting information",
    "start": "2933460",
    "end": "2940720"
  },
  {
    "text": "for 10 seconds and that generates 15 megabytes of data so that's already a",
    "start": "2940720",
    "end": "2946119"
  },
  {
    "text": "bit suspicious it means if I collect for hours or days on end I'm gonna get really huge log files but ok let's leave",
    "start": "2946119",
    "end": "2952300"
  },
  {
    "text": "that for a moment so collect it for 10 seconds and then I stopped collecting",
    "start": "2952300",
    "end": "2957490"
  },
  {
    "text": "information and it took 12 point 7 seconds to do something called the seal",
    "start": "2957490",
    "end": "2962619"
  },
  {
    "text": "or run down I don't know what it is well I do know but you don't have to know you don't care what it is and that",
    "start": "2962619",
    "end": "2968560"
  },
  {
    "text": "took twelve point seven seconds to complete like this is not part of what I was measuring it's just extra time spent",
    "start": "2968560",
    "end": "2975550"
  },
  {
    "text": "at the end of the profiling session and then it took four seconds to do some kind of conversion again I don't care",
    "start": "2975550",
    "end": "2981430"
  },
  {
    "text": "what sort of conversion it was it took another four seconds of my life and then another four seconds opening some file",
    "start": "2981430",
    "end": "2988180"
  },
  {
    "text": "and another 0.2 seconds opening the same file interesting so all in all it took",
    "start": "2988180",
    "end": "2994329"
  },
  {
    "text": "like 20 20 seconds to open the file from a 10 second performance investigation",
    "start": "2994329",
    "end": "3001800"
  },
  {
    "text": "this is what I mean by quick turnaround this is not quick turnaround if I have",
    "start": "3001800",
    "end": "3006990"
  },
  {
    "text": "to spend twice as much waiting for the results as collecting the data in the first place that's not quick turnaround",
    "start": "3006990",
    "end": "3012980"
  },
  {
    "text": "so I'm not saying I have the perfect solution but I don't want to tell you",
    "start": "3012980",
    "end": "3018300"
  },
  {
    "text": "about a couple of tools I built which have sort of which are helping me anyway",
    "start": "3018300",
    "end": "3023609"
  },
  {
    "text": "address this problem at least a little bit and these are eat race which is a command-line tool for monitoring etw",
    "start": "3023609",
    "end": "3031079"
  },
  {
    "text": "events which works in real time so you can run it and get real-time printouts",
    "start": "3031079",
    "end": "3036089"
  },
  {
    "text": "when etw events occur and it looks something like this so you can run it",
    "start": "3036089",
    "end": "3041640"
  },
  {
    "text": "and then you get in real time you get printouts on your terminal with the",
    "start": "3041640",
    "end": "3046950"
  },
  {
    "text": "event you care about for example on the top i'm collect garbage collection events so whenever a",
    "start": "3046950",
    "end": "3052239"
  },
  {
    "text": "GC occurs I want to know about it on the bottom I'm collecting allocation events so when a certain threshold is breached",
    "start": "3052239",
    "end": "3059140"
  },
  {
    "text": "I want to know that the process is allocating lots of memory again just examples but by having that printed in",
    "start": "3059140",
    "end": "3065410"
  },
  {
    "text": "real time I can do a long term performance collection and not wait for",
    "start": "3065410",
    "end": "3071019"
  },
  {
    "text": "the whole thing to complete before I can view the results and that's really valuable when you're not just measuring",
    "start": "3071019",
    "end": "3076420"
  },
  {
    "text": "a 10 a 10 second workload another tool is called live stacks and this is again",
    "start": "3076420",
    "end": "3083349"
  },
  {
    "text": "a real-time tool which collects stack traces of interesting events and prints them out to the terminal as well so you",
    "start": "3083349",
    "end": "3090039"
  },
  {
    "text": "can use this to the real-time profiling so you can profile what the process is doing and just get a dump every 5",
    "start": "3090039",
    "end": "3095829"
  },
  {
    "text": "seconds with the hottest methods what the process is doing right now you can use it to profile disk accesses garbage",
    "start": "3095829",
    "end": "3102730"
  },
  {
    "text": "collections lots of other events it's all based on a DW again and the results are kind of ugly it's just a bunch of",
    "start": "3102730",
    "end": "3109420"
  },
  {
    "text": "stock traces printed to the terminal but they can be visualized you can take the output from live stacks here's another",
    "start": "3109420",
    "end": "3115749"
  },
  {
    "text": "example you can take this text output and you can visualize it for example using flame graphs which",
    "start": "3115749",
    "end": "3121839"
  },
  {
    "text": "again we could spend the whole session talking just about the benefits of flame graphs but this is one way of",
    "start": "3121839",
    "end": "3126970"
  },
  {
    "text": "visualizing stack traces visualizing lots and lots of stack traces in a format that allows easy drill down and",
    "start": "3126970",
    "end": "3134259"
  },
  {
    "text": "focusing on whatever you care about so if you haven't seen flame graphs before it's perfectly fine but you might want",
    "start": "3134259",
    "end": "3140739"
  },
  {
    "text": "to consider looking into them so just wanted to talk to you briefly about again some benefits of tools with a",
    "start": "3140739",
    "end": "3147789"
  },
  {
    "text": "quick turnaround with a low overhead with of course accuracy hopefully is a",
    "start": "3147789",
    "end": "3153549"
  },
  {
    "text": "is a feature that these tools have as well and one final thing I have 7 minutes and",
    "start": "3153549",
    "end": "3159549"
  },
  {
    "text": "22 seconds for is is a quick rant on statistics and I have nothing against",
    "start": "3159549",
    "end": "3166930"
  },
  {
    "text": "that this statistics is a beautiful thing and a beautiful field but the way we sometimes use statistics the way we",
    "start": "3166930",
    "end": "3172690"
  },
  {
    "text": "use output from performant performance tools is often again leading us up",
    "start": "3172690",
    "end": "3178210"
  },
  {
    "text": "completely wrong Valley and that's what I want to talk about briefly so averages like we already saw",
    "start": "3178210",
    "end": "3185040"
  },
  {
    "text": "are often quite meaningless for understanding what's really happening in your application for understanding if",
    "start": "3185040",
    "end": "3191190"
  },
  {
    "text": "your system is really experiencing a performance problem so some people use medians instead they're not a lot better",
    "start": "3191190",
    "end": "3197880"
  },
  {
    "text": "for understanding the whole range of values because you can't really reliably take lots of values and accurately",
    "start": "3197880",
    "end": "3205349"
  },
  {
    "text": "represent them with just one number it's it's impossible and so any attempt to do",
    "start": "3205349",
    "end": "3210480"
  },
  {
    "text": "that sort of thing without really looking at the whole range is it sort of doomed to fail percentiles or one common",
    "start": "3210480",
    "end": "3217320"
  },
  {
    "text": "way is one common way of addressing this problem trying to visualize a range of numbers a distribution of numbers and",
    "start": "3217320",
    "end": "3223950"
  },
  {
    "text": "we'll talk about them in a moment and finally visualizations for all this stuff are really important for trying to",
    "start": "3223950",
    "end": "3230609"
  },
  {
    "text": "understand the actual values so let's see a couple of examples the average",
    "start": "3230609",
    "end": "3236820"
  },
  {
    "text": "response time of my application is 29 milliseconds is it good is it bad does",
    "start": "3236820",
    "end": "3241980"
  },
  {
    "text": "it mean anything suppose we do have the context and we understand what kind of application it is and what we're talking",
    "start": "3241980",
    "end": "3247829"
  },
  {
    "text": "about is it good is it bad so here's a distribution of values which has an",
    "start": "3247829",
    "end": "3252869"
  },
  {
    "text": "average of 29 milliseconds I know you can't see all the tiny labels but this",
    "start": "3252869",
    "end": "3257940"
  },
  {
    "text": "distribution looks like it's really close to the average the average is this blue line over here so most of the",
    "start": "3257940",
    "end": "3264900"
  },
  {
    "text": "values are clustered around the average and it's perfectly nice and pretty this distribution also has an average of 29",
    "start": "3264900",
    "end": "3272010"
  },
  {
    "text": "milliseconds and then the average is over here this is 29 milliseconds we",
    "start": "3272010",
    "end": "3277200"
  },
  {
    "text": "have a lot of values clustered close to that average but they're really smaller than the average but we have this",
    "start": "3277200",
    "end": "3283200"
  },
  {
    "text": "additional cluster of values which are almost 10 times bigger than the average and they can't be discarded because this",
    "start": "3283200",
    "end": "3289950"
  },
  {
    "text": "could be the set of users having a problem this could be the set of problematic requests this could be the",
    "start": "3289950",
    "end": "3295920"
  },
  {
    "text": "timeouts in my document storage system we can't just say the average is 29 milliseconds so these things do not",
    "start": "3295920",
    "end": "3302099"
  },
  {
    "text": "exist and it's very common in performance monitoring that you would have this sort of second mode of values",
    "start": "3302099",
    "end": "3310230"
  },
  {
    "text": "for latencies and for other metrics as well it's pretty common that you would have the normal values and you would have some",
    "start": "3310230",
    "end": "3317410"
  },
  {
    "text": "kind of cluster of problems over there this is a really cool paper from",
    "start": "3317410",
    "end": "3323740"
  },
  {
    "text": "autodesk written last year which focuses on visualization and all these different",
    "start": "3323740",
    "end": "3329800"
  },
  {
    "text": "dots you see on the screen they have the same average across the x-axis the same",
    "start": "3329800",
    "end": "3335410"
  },
  {
    "text": "average across the y-axis and the same standard deviation as well on the x-axis",
    "start": "3335410",
    "end": "3340840"
  },
  {
    "text": "and the y-axis and even the same correlation between the X's and Y's even the dinosaur which showed up at some",
    "start": "3340840",
    "end": "3348250"
  },
  {
    "text": "point even the dinosaur has the same the same average across the XS and the Y's",
    "start": "3348250",
    "end": "3353470"
  },
  {
    "text": "as all the other sets of dots so what I'm saying is and what these researchers are saying as well is that without",
    "start": "3353470",
    "end": "3359950"
  },
  {
    "text": "seeing the actual shape you can't say a lot about the values just by looking at the average or by looking at the",
    "start": "3359950",
    "end": "3366580"
  },
  {
    "text": "standard deviation show so visualizations are really important in general and for us humans specifically",
    "start": "3366580",
    "end": "3372490"
  },
  {
    "text": "for understanding information at a glance here's another example of what I",
    "start": "3372490",
    "end": "3378040"
  },
  {
    "text": "think is not a great way to present performance information this is output from benchmark dotnet hopefully some of",
    "start": "3378040",
    "end": "3385330"
  },
  {
    "text": "you have seen it or used it it's an amazing benchmarking library for.net an open source project and benchmark dotnet",
    "start": "3385330",
    "end": "3393130"
  },
  {
    "text": "reports results at the end somewhat like this it prints out the average and the",
    "start": "3393130",
    "end": "3398860"
  },
  {
    "text": "standard deviation as well as a bunch of really interesting statistical information like skewness and also",
    "start": "3398860",
    "end": "3406810"
  },
  {
    "text": "kurtosis yep I don't know what it is but it does report this and also confidence",
    "start": "3406810",
    "end": "3413080"
  },
  {
    "text": "intervals and a lot of other beautiful things but one thing that's missing in my opinion is just the visualization of",
    "start": "3413080",
    "end": "3419110"
  },
  {
    "text": "what the numbers look like what the numbers for that benchmark actually looked like and there is a way of",
    "start": "3419110",
    "end": "3424270"
  },
  {
    "text": "getting this information out of benchmark net but it's not on by default so if you run this thing by default you",
    "start": "3424270",
    "end": "3429700"
  },
  {
    "text": "only get the numbers you don't see the results you don't see the distribution and what's even slightly worse is that",
    "start": "3429700",
    "end": "3437560"
  },
  {
    "text": "benchmark dotnet because it's a benchmarking library so it's maybe a bit more acceptable it actually throws away",
    "start": "3437560",
    "end": "3443640"
  },
  {
    "text": "the outliers it throws away the unlike results so in this example I know it's a",
    "start": "3443640",
    "end": "3449830"
  },
  {
    "text": "little hard to see here because of the light bleeding into the projector but we had 52 results from the benchmark and 11",
    "start": "3449830",
    "end": "3457150"
  },
  {
    "text": "of them were removed because they were considered outliers so you know not even",
    "start": "3457150",
    "end": "3462790"
  },
  {
    "text": "just one or two but 11 out of 52 results were removed from the statistics because they would screw up the values so we",
    "start": "3462790",
    "end": "3470170"
  },
  {
    "text": "just removed them we got rid of them it's not a great thing to do if you're looking at actual performance numbers",
    "start": "3470170",
    "end": "3475990"
  },
  {
    "text": "from a production system because the outliers the hiccups those weird lines",
    "start": "3475990",
    "end": "3481450"
  },
  {
    "text": "breaking out of all the charts these are you know these are the problems these are the things you are investigating",
    "start": "3481450",
    "end": "3487300"
  },
  {
    "text": "these are the things possibly causing problems for your users now just one",
    "start": "3487300",
    "end": "3492370"
  },
  {
    "text": "final thought if you look at this sort of diagram so this sort of visualization",
    "start": "3492370",
    "end": "3497890"
  },
  {
    "text": "you can obviously see the outliers you can also see the 99th percentile which",
    "start": "3497890",
    "end": "3503350"
  },
  {
    "text": "is over here and the 99.9 percent tile which is over here and you might ask",
    "start": "3503350",
    "end": "3509200"
  },
  {
    "text": "should I really even care about these super super outliers",
    "start": "3509200",
    "end": "3514300"
  },
  {
    "text": "about these super hiccups which are completely off the charts like is it even likely that a user would ever hit",
    "start": "3514300",
    "end": "3520780"
  },
  {
    "text": "this sort of behavior in their whole lifetime so yeah that's how you can",
    "start": "3520780",
    "end": "3528040"
  },
  {
    "text": "visualize this stuff but I'll just jump straight up so who cares about the 99th percentile so I did a little experiment",
    "start": "3528040",
    "end": "3535000"
  },
  {
    "text": "and I opened up my browser developer tools and I went to amazon.com and I saw",
    "start": "3535000",
    "end": "3541030"
  },
  {
    "text": "that the amazon.com webpage made 328 requests and so let's assume for a",
    "start": "3541030",
    "end": "3548170"
  },
  {
    "text": "moment these are all completely independent and they all have the same latency behavior what is the likelihood",
    "start": "3548170",
    "end": "3554470"
  },
  {
    "text": "that you would see the 99th percentile it is actually 96 percent so if you make",
    "start": "3554470",
    "end": "3559780"
  },
  {
    "text": "a lot of requests you will hit the 99th percentile pretty often and so if you",
    "start": "3559780",
    "end": "3564790"
  },
  {
    "text": "have operations in your system that the users are performing again and again if you have certain behaviors that cause",
    "start": "3564790",
    "end": "3570190"
  },
  {
    "text": "lots of requests then you should care about the 99th and 99.9% I'll because",
    "start": "3570190",
    "end": "3575260"
  },
  {
    "text": "they're not as unlikely as we think just looking at the dashboards behind things so there's just a parting thought",
    "start": "3575260",
    "end": "3581619"
  },
  {
    "text": "about statistic so wrapping up this is the final thing I want you to think",
    "start": "3581619",
    "end": "3587470"
  },
  {
    "text": "about at the end of a performance investigation conducting a post-mortem is something I've mentioned at the very",
    "start": "3587470",
    "end": "3594309"
  },
  {
    "text": "beginning is quite important a few things I like to put on the post mortem is what we did what the steps we took",
    "start": "3594309",
    "end": "3601059"
  },
  {
    "text": "were what was effective and what was not which tools would be useful for diagnosing this problem in the future",
    "start": "3601059",
    "end": "3607510"
  },
  {
    "text": "which tools that we didn't have would be useful and how we can maybe build them and one thing to think about finally can",
    "start": "3607510",
    "end": "3615609"
  },
  {
    "text": "we somehow manage to maybe in the future just diagnose this sort of problem automatically can we remove the humans",
    "start": "3615609",
    "end": "3622089"
  },
  {
    "text": "from the equation can we diagnose problems and just resolve them without any human intervention so automating",
    "start": "3622089",
    "end": "3628299"
  },
  {
    "text": "ourselves out of a job so we've talked about what a performance investigation looks like some methods and",
    "start": "3628299",
    "end": "3634180"
  },
  {
    "text": "anti-patterns on 30 seconds behind so I'll just leave you with link to the slides if you have any questions I'll",
    "start": "3634180",
    "end": "3640960"
  },
  {
    "text": "step off the stage real quick and I would love to chat with you I'm here today I'm here tomorrow as well thank",
    "start": "3640960",
    "end": "3646030"
  },
  {
    "text": "you very much for coming thanks [Applause]",
    "start": "3646030",
    "end": "3651590"
  }
]