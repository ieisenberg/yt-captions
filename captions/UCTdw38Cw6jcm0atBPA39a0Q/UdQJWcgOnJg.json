[
  {
    "text": "well good morning everyone thanks for coming my name is Jimmy",
    "start": "4880",
    "end": "10019"
  },
  {
    "text": "Bogard you can find me on Twitter at J Bogard all the code you see today as well the slides you can find on my",
    "start": "10019",
    "end": "15839"
  },
  {
    "text": "GitHub at github.com and I blog about this topic and a lot of",
    "start": "15839",
    "end": "21420"
  },
  {
    "text": "the things on my blog at jimmyboguard.com this is actually a topic I wish I didn't have to talk about I wish I didn't have",
    "start": "21420",
    "end": "28019"
  },
  {
    "text": "to worry about security and things were just like easy to connect up on the web and people can try to hack it and things like that but that's not the case",
    "start": "28019",
    "end": "35460"
  },
  {
    "text": "um I do have to worry about security and so this uh this talk is about a project I recently worked on in which I had to",
    "start": "35460",
    "end": "40980"
  },
  {
    "text": "take basically a crash course and all things security and understanding how to deploy secure microservices into azure",
    "start": "40980",
    "end": "48539"
  },
  {
    "text": "so things used to be quite a bit simpler we used to just have like a very basic",
    "start": "48539",
    "end": "53700"
  },
  {
    "text": "client server application so we would build server-side web applications I remember those things like the HTML was",
    "start": "53700",
    "end": "59879"
  },
  {
    "text": "built on the server as opposed to the clients excuse me and then there was a talk to a database and we would secure",
    "start": "59879",
    "end": "66299"
  },
  {
    "text": "the communication from the server to the database so nothing you could talk straight to the database directly of course we would have it behind a",
    "start": "66299",
    "end": "72479"
  },
  {
    "text": "firewall something and then we just had a client and things were simple in order to secure these things we would use a",
    "start": "72479",
    "end": "78479"
  },
  {
    "text": "cookie to be able to secure this we'd have a like asp.net core or asp.net secure cookie that was encrypted and",
    "start": "78479",
    "end": "85439"
  },
  {
    "text": "only the server could read it it was stored securely in the client as well and no one else could communicate to our",
    "start": "85439",
    "end": "90479"
  },
  {
    "text": "server unless they had that cookie and they were authenticated um so that was pretty simple right like",
    "start": "90479",
    "end": "96180"
  },
  {
    "text": "that's that's that's the days I wish I could go back to but unfortunately things are not simpler anymore um we added microservice to the",
    "start": "96180",
    "end": "101939"
  },
  {
    "text": "microservices to the mixed um which means a much a lot more servers a lot more things talking to each other and so the the store becomes quite a bit",
    "start": "101939",
    "end": "109500"
  },
  {
    "text": "more complex when we're talking about adding a lot of other different distributed components to the mix",
    "start": "109500",
    "end": "115079"
  },
  {
    "text": "so this is my situation that I was presented with which was I had a client that was of course a spa because you",
    "start": "115079",
    "end": "121740"
  },
  {
    "text": "have to these days right so it's an angular Spa that was talking to a single API that was the back end for front end",
    "start": "121740",
    "end": "127200"
  },
  {
    "text": "so the back end for front end represented how to pull all the different Services behind the scenes uh",
    "start": "127200",
    "end": "132900"
  },
  {
    "text": "formulate responses uh for whatever the spa needed and then the spa would just talk that one single API",
    "start": "132900",
    "end": "138840"
  },
  {
    "text": "and then behind the scenes the BFF would then talk to all the different back and microservices that had their own",
    "start": "138840",
    "end": "144780"
  },
  {
    "text": "databases their own applications they're all running on like kubernetes or some junk and be able to pull that data back",
    "start": "144780",
    "end": "150060"
  },
  {
    "text": "together for that response I was showing on the screen we also had a lot of on-prem servers as",
    "start": "150060",
    "end": "157140"
  },
  {
    "text": "well so we had like still existing Legacy applications Legacy systems they were on premise also talking to these",
    "start": "157140",
    "end": "163680"
  },
  {
    "text": "apis and also need to pull back data to be able to be shown on their different screens so this is the question we Repose is",
    "start": "163680",
    "end": "170160"
  },
  {
    "text": "okay um the previous picture where we just had like a single client server we understood that picture very well like",
    "start": "170160",
    "end": "176519"
  },
  {
    "text": "how to secure that like you log in you get a cookie everything's good but how do you secure this picture by the way",
    "start": "176519",
    "end": "182459"
  },
  {
    "text": "I'm not talking about network security I have no idea about any of that stuff so if you're looking about network security like this is not the talk for you",
    "start": "182459",
    "end": "188340"
  },
  {
    "text": "because I'm not the person to be talking to about that we remain looking at the the like apis themselves how do you",
    "start": "188340",
    "end": "195239"
  },
  {
    "text": "secure these different apis together so that uh the the data that was being shown in each of these different systems",
    "start": "195239",
    "end": "201659"
  },
  {
    "text": "uh was the data shown to the right person um it was also Health Data and personal",
    "start": "201659",
    "end": "207239"
  },
  {
    "text": "information so we want to make sure that you know the wrong person couldn't sing the wrong person's data",
    "start": "207239",
    "end": "212280"
  },
  {
    "text": "and so how that was our big question was how do we authenticate and authorize these different external users to our",
    "start": "212280",
    "end": "219480"
  },
  {
    "text": "system now for the external users the people they were like you know the actual users",
    "start": "219480",
    "end": "226080"
  },
  {
    "text": "of the system they never talked directly to any of our individual microservices in fact no no no external user",
    "start": "226080",
    "end": "233340"
  },
  {
    "text": "whatsoever internal like internal users or external users talk directly to these Services they're always going through",
    "start": "233340",
    "end": "238860"
  },
  {
    "text": "something else some other API or some other system that then talk to our back backend microservices",
    "start": "238860",
    "end": "244860"
  },
  {
    "text": "so the front end we saw that okay uh the front end users who have a regular kind of login that was actually somewhat",
    "start": "244860",
    "end": "251159"
  },
  {
    "text": "straightforward because we were using auth0 at the time to authenticate those initial users so",
    "start": "251159",
    "end": "256799"
  },
  {
    "text": "um they would go to some kind of single sign-in page that entered the credentials and then when they they would get logged in and get a secure",
    "start": "256799",
    "end": "263220"
  },
  {
    "text": "cookie do the back and for front end as well as the token however all the other background systems and",
    "start": "263220",
    "end": "269880"
  },
  {
    "text": "services didn't understand r0 and complicating the matters was all these things in the right",
    "start": "269880",
    "end": "276060"
  },
  {
    "text": "over there all those on-prem systems also don't use r0 they were just still using like forms authentication login",
    "start": "276060",
    "end": "282600"
  },
  {
    "text": "cookies things like that so we couldn't just say let's just take that token that",
    "start": "282600",
    "end": "287639"
  },
  {
    "text": "we got from osiro and flow it through all their services because those things on the right don't have any concept of",
    "start": "287639",
    "end": "293160"
  },
  {
    "text": "osiro and didn't have any sort of token so we're leaving this world that was very very mixed excuse me authentication",
    "start": "293160",
    "end": "300240"
  },
  {
    "text": "environment where we had like modern sort of logins over here and then like old uh kind of crusty logins over here",
    "start": "300240",
    "end": "307620"
  },
  {
    "text": "on the right and the things in the middle I had to be able to speak both languages",
    "start": "307620",
    "end": "312660"
  },
  {
    "text": "so our unanswered questions was we can understand how to like to secure the things that were on the outside of the",
    "start": "312660",
    "end": "318960"
  },
  {
    "text": "of that diagram we understood how to secure the BFF I could just use cookies we understand that we could share the",
    "start": "318960",
    "end": "324479"
  },
  {
    "text": "existing applications they could just keep doing what they're what they're already doing but all those things in the middle all",
    "start": "324479",
    "end": "329520"
  },
  {
    "text": "those micro services that were that how the uh how that critical business data the critical user information",
    "start": "329520",
    "end": "335820"
  },
  {
    "text": "how could we secure those different pieces from both directions in a way that was consistent and still",
    "start": "335820",
    "end": "341460"
  },
  {
    "text": "maintainable um so years ago someone else I knew not myself",
    "start": "341460",
    "end": "347220"
  },
  {
    "text": "definitely not um we'll just say well you know what we're already inside the network right",
    "start": "347220",
    "end": "352440"
  },
  {
    "text": "we're already past the firewall why do we need security at all why do we even",
    "start": "352440",
    "end": "357720"
  },
  {
    "text": "need like https Transport Security just build these internal apis and assume that if they were able to get into the",
    "start": "357720",
    "end": "364500"
  },
  {
    "text": "first server then they should be okay with everything beyond that so just don't do any security at all it wasn't me someone else I I don't know",
    "start": "364500",
    "end": "371280"
  },
  {
    "text": "I'm sure um and so we also had to worry about all the on-prem people as well that we had",
    "start": "371280",
    "end": "376620"
  },
  {
    "text": "to worry about okay the the internal Azure communication as well as the on-prem communication",
    "start": "376620",
    "end": "382919"
  },
  {
    "text": "so uh people the smarter than myself looked at this picture and said right this could be a security disaster if we",
    "start": "382919",
    "end": "388440"
  },
  {
    "text": "just do nothing here if we just let anyone communicate to these apis it has this protected health information that",
    "start": "388440",
    "end": "393960"
  },
  {
    "text": "has uh personal identical information uh we can't just allow anyone if they just",
    "start": "393960",
    "end": "399479"
  },
  {
    "text": "happen to be on the network to be able to call these apis and get whatever information they want so instead we were trying to shoot for",
    "start": "399479",
    "end": "405919"
  },
  {
    "text": "what I learned later What's called the zero trust model and the idea here is",
    "start": "405919",
    "end": "412020"
  },
  {
    "text": "that we never trust any bit of communication and we always verify so",
    "start": "412020",
    "end": "417060"
  },
  {
    "text": "you always verify any sort of communication between one system and the other and never just say like well if you made it this far I'm sure you're",
    "start": "417060",
    "end": "423479"
  },
  {
    "text": "good so our first thought was well why don't we just flow that user token so take",
    "start": "423479",
    "end": "430500"
  },
  {
    "text": "that same at that same authoro actually at the time we were using identity server transitioning to auth0 and say",
    "start": "430500",
    "end": "437759"
  },
  {
    "text": "let's just take that jot and just flow it through all the communications Downstream say well just we'll just keep passing that that connection along",
    "start": "437759",
    "end": "444780"
  },
  {
    "text": "that would work great except two problems one none of the things on the right hide any concept of a user",
    "start": "444780",
    "end": "450660"
  },
  {
    "text": "token to begin with they had a cookie and the other thing we were running into was that not every single kind of call",
    "start": "450660",
    "end": "455940"
  },
  {
    "text": "in our system was made by a user sometimes we had things like batch jobs or messaging that would not have a user",
    "start": "455940",
    "end": "462419"
  },
  {
    "text": "whatsoever or they were making calls to our API so we don't have any concept or context to say who that specific user",
    "start": "462419",
    "end": "468360"
  },
  {
    "text": "was to kicked this thing off they didn't exist so this looked great in concept but",
    "start": "468360",
    "end": "474000"
  },
  {
    "text": "broke down pretty quickly we looked at the different kind of scenarios so our solution solution was right we",
    "start": "474000",
    "end": "480960"
  },
  {
    "text": "can't use the identity provider on the right as just a thing we're going to use everywhere and the things over here have",
    "start": "480960",
    "end": "487560"
  },
  {
    "text": "no concept of this thing on the right the austerial components then we need to find some homogeneous solution for all",
    "start": "487560",
    "end": "494759"
  },
  {
    "text": "these different Connections In The Middle and because we were hosted on azure we said right why don't we use Azure ad",
    "start": "494759",
    "end": "502160"
  },
  {
    "text": "to secure all the communications inside of this picture so every single Arrow here once I got",
    "start": "502160",
    "end": "509460"
  },
  {
    "text": "inside of azure as well as the on-prem network all those would use Azure ad Azure active directory I think it's",
    "start": "509460",
    "end": "515339"
  },
  {
    "text": "called Microsoft identity they've rebranded yet again in any case we would use that as the thing that would be able",
    "start": "515339",
    "end": "521099"
  },
  {
    "text": "to secure a token and secure like who you are and what you're looking for inside of all these different",
    "start": "521099",
    "end": "526740"
  },
  {
    "text": "Communications picture that we were given to by the",
    "start": "526740",
    "end": "531899"
  },
  {
    "text": "security folks like yes do this I say great how do we do that I said that's not our problem I said oh",
    "start": "531899",
    "end": "538040"
  },
  {
    "text": "now I have to figure this out so we had to figure out okay um for each of these different arrows",
    "start": "538040",
    "end": "543959"
  },
  {
    "text": "here how should those different systems authenticate with Azure active directory",
    "start": "543959",
    "end": "549420"
  },
  {
    "text": "so Azure active directory supports a number of different by basically all the",
    "start": "549420",
    "end": "554700"
  },
  {
    "text": "different oauth 2.0 flows and again with this one of the things I wish I didn't have to worry about I wish we could just use cookies and everything's wonderful",
    "start": "554700",
    "end": "560580"
  },
  {
    "text": "but no this is more complicated with microservices all these different systems so we had to figure out okay how",
    "start": "560580",
    "end": "567000"
  },
  {
    "text": "should each of these systems when I want to call from system a to system B how should those systems authenticate and",
    "start": "567000",
    "end": "573660"
  },
  {
    "text": "acquire that token and there are a lot of different options available to us in oil 2.0",
    "start": "573660",
    "end": "579720"
  },
  {
    "text": "um we uh this is from the Microsoft documentation about here's all the different kinds of apps that you could",
    "start": "579720",
    "end": "585779"
  },
  {
    "text": "build and they're different these are the different ways you can or you should acquire token for each of those different situations",
    "start": "585779",
    "end": "591720"
  },
  {
    "text": "so if you have a spa you should use auth code with pkce for whatever pkce means",
    "start": "591720",
    "end": "597360"
  },
  {
    "text": "and then the kinds of things you can authenticate against like who who can actually authenticate are the fun things",
    "start": "597360",
    "end": "602519"
  },
  {
    "text": "of azure ID which are work or school accounts personal accounts or Azure b2c which no one should ever use",
    "start": "602519",
    "end": "608580"
  },
  {
    "text": "and so looking at all these like okay we started going on the list okay that that doesn't look like us that doesn't look like us that doesn't look like us then",
    "start": "608580",
    "end": "614640"
  },
  {
    "text": "wait a second we have a web API because it calls other web apis that's our backend for front end it's an API that",
    "start": "614640",
    "end": "621240"
  },
  {
    "text": "calls other apis we also have Daemon apps or you know these background services that also call",
    "start": "621240",
    "end": "627240"
  },
  {
    "text": "apis and so they told us that you can uh now you're down to these two options for",
    "start": "627240",
    "end": "632760"
  },
  {
    "text": "uh oauth 2.0 one is the on behalf of flow which is basically",
    "start": "632760",
    "end": "638160"
  },
  {
    "text": "I get a token and then my service needs to call another thing so it acquires a token on behalf of that token so I don't",
    "start": "638160",
    "end": "644220"
  },
  {
    "text": "flow the same token down instead I acquire a new token on behalf of that",
    "start": "644220",
    "end": "649380"
  },
  {
    "text": "calling user and that new token will then also include the information or the claims from the initial user that seems",
    "start": "649380",
    "end": "656220"
  },
  {
    "text": "pretty good except the kinds of accounts I can use here are only work or school accounts whatever that means or personal",
    "start": "656220",
    "end": "662820"
  },
  {
    "text": "account so that means that I can only use tokens that originate from Azure ID to use that flow that's the limitation",
    "start": "662820",
    "end": "669480"
  },
  {
    "text": "of azure ID so we saw that like that would have been nice it would have been nice to say okay you're this specific",
    "start": "669480",
    "end": "674880"
  },
  {
    "text": "user um so only show the date or hide the data based on that so we said okay we can't do the on behalf of flow",
    "start": "674880",
    "end": "682079"
  },
  {
    "text": "because you're not an Azure ID user to begin with we have on-prem systems that",
    "start": "682079",
    "end": "687180"
  },
  {
    "text": "have no tokens and the client systems that are just using um Osteo and identity server so that one's",
    "start": "687180",
    "end": "693420"
  },
  {
    "text": "out so they basically just reduced us down to this one which is demon apps the call Web apis so everything that was",
    "start": "693420",
    "end": "700440"
  },
  {
    "text": "going to call our different Services would need to use client credentials which is every single client gets a",
    "start": "700440",
    "end": "706740"
  },
  {
    "text": "client ID and a client Secrets which you have to keep secure and then using that client ID and client Secrets they call",
    "start": "706740",
    "end": "712920"
  },
  {
    "text": "Azure ID to get a token and after they get a token they can then call our API passing in that token through the",
    "start": "712920",
    "end": "718800"
  },
  {
    "text": "authorization header and then everything should work okay long Journeys to just like choose that",
    "start": "718800",
    "end": "726240"
  },
  {
    "text": "one different option there now that's just how to authenticate which is to establish the identity of",
    "start": "726240",
    "end": "731880"
  },
  {
    "text": "the caller the second part then is how to authorize those callers",
    "start": "731880",
    "end": "736920"
  },
  {
    "text": "so in Azure ID once I go the route of client credentials that is machine to",
    "start": "736920",
    "end": "742740"
  },
  {
    "text": "machine communication you have two options to authorize individual callers",
    "start": "742740",
    "end": "748380"
  },
  {
    "text": "the first option is known as Access Control lists or ACLS which is just a",
    "start": "748380",
    "end": "753600"
  },
  {
    "text": "fancy name for just do whatever you want inside of your application it's all custom logic you just like take the",
    "start": "753600",
    "end": "759360"
  },
  {
    "text": "token look who's calling you and say right are you authorized to be able to call this API endpoints or are you not",
    "start": "759360",
    "end": "765360"
  },
  {
    "text": "authorized to call this API endpoint but it's all just custom logic inside of your application there's nothing fancy or special I'll look at who the client",
    "start": "765360",
    "end": "772139"
  },
  {
    "text": "ID is that's calling me and do I trust them or not and if I don't trust them for the specific call they say",
    "start": "772139",
    "end": "777839"
  },
  {
    "text": "you can call me but that requires us to have each application maintain its own Access",
    "start": "777839",
    "end": "785040"
  },
  {
    "text": "Control list it has to have that list of who are the authorized callers for this API or I could just say you know don't",
    "start": "785040",
    "end": "792060"
  },
  {
    "text": "do that just say as long as you have a valid token you can call us which again we were trying to avoid because we're",
    "start": "792060",
    "end": "797700"
  },
  {
    "text": "trying to go to the zero trust model on the other option though is known as application permissions and the idea",
    "start": "797700",
    "end": "804480"
  },
  {
    "text": "here is that I Define custom roles that are modeled as permissions inside of azure ad",
    "start": "804480",
    "end": "810660"
  },
  {
    "text": "and then I can assign those different custom roles or permissions to individual server principles",
    "start": "810660",
    "end": "816480"
  },
  {
    "text": "and then when I acquire a token as client a calling to server B I ask Azure",
    "start": "816480",
    "end": "822360"
  },
  {
    "text": "ID I want a token for that resource and then Azure ID looks up do you have any",
    "start": "822360",
    "end": "827700"
  },
  {
    "text": "roles or permissions assigned for that resource resource and then the token that you get back will contain all those",
    "start": "827700",
    "end": "834000"
  },
  {
    "text": "roles or permissions for that one specific resource and then the server once it receives",
    "start": "834000",
    "end": "839279"
  },
  {
    "text": "that token well then say for this API call are you authorized for this individual role of permission so I don't",
    "start": "839279",
    "end": "845399"
  },
  {
    "text": "care who you are I just care do you have this specific role of permission so we like that one because our",
    "start": "845399",
    "end": "852959"
  },
  {
    "text": "individual applications then don't have to maintain that custom list of who is calling me and what do they have instead",
    "start": "852959",
    "end": "859500"
  },
  {
    "text": "of just say do you have this permission and that's it and that assignment of the permission is then done outside of our",
    "start": "859500",
    "end": "865200"
  },
  {
    "text": "application outside of our system so from this we we boil it down said",
    "start": "865200",
    "end": "871860"
  },
  {
    "text": "based on this complex scenario of microservices on-prem all that sort of stuff we're able to build a very",
    "start": "871860",
    "end": "877320"
  },
  {
    "text": "simplified application or simplified system that represented the kind of two main use cases in application we have",
    "start": "877320",
    "end": "884160"
  },
  {
    "text": "internal Azure communication so that's like something deployed to Azure calling out something else deployed inside of",
    "start": "884160",
    "end": "890519"
  },
  {
    "text": "azure and then we also have these external clients that are calling into our system as well these external",
    "start": "890519",
    "end": "896339"
  },
  {
    "text": "clients are not deployed to Azure and are demo it'll just be deployed to my old laptop here but the idea is that",
    "start": "896339",
    "end": "902399"
  },
  {
    "text": "it's not inside of the Azure ecosystem so our choices become a little bit more limited into how we secure that",
    "start": "902399",
    "end": "908579"
  },
  {
    "text": "individual communication at no point though do we have any kind of external client talking or external",
    "start": "908579",
    "end": "915720"
  },
  {
    "text": "user application talking directly to our apis so the browser does not talk directly to our application it has to go",
    "start": "915720",
    "end": "922740"
  },
  {
    "text": "through this other API that then calls our API so I don't have to worry about all those different other user flows and we can",
    "start": "922740",
    "end": "928980"
  },
  {
    "text": "make sure that these back-end servers that are not actually you know exposed to the public internet all those sort of things",
    "start": "928980",
    "end": "934440"
  },
  {
    "text": "all right excuse me so I've got these basic scenarios laid",
    "start": "934440",
    "end": "940019"
  },
  {
    "text": "out I have internal Azure communication I have external Azure communication to our system the next piece we need to unders decide",
    "start": "940019",
    "end": "946380"
  },
  {
    "text": "is okay we want to use this like role-based authorization what are the roles",
    "start": "946380",
    "end": "952680"
  },
  {
    "text": "so we had to figure out you know what is the what kind of makes sense for all of our apis to Define these individual",
    "start": "952680",
    "end": "958980"
  },
  {
    "text": "roles for our different apis so in this application I'll be showing",
    "start": "958980",
    "end": "964019"
  },
  {
    "text": "you it's trying to have something a little more complex so it's not just a street like read-only API it's a to-do",
    "start": "964019",
    "end": "970139"
  },
  {
    "text": "API that has all sorts of different API endpoints to be able to modify add new",
    "start": "970139",
    "end": "975300"
  },
  {
    "text": "to do items and delete them as well so we've got our normal kind of crud oriented API here we have git put post",
    "start": "975300",
    "end": "981959"
  },
  {
    "text": "and delete so looking at this we need to Define individual roles for each of these",
    "start": "981959",
    "end": "988380"
  },
  {
    "text": "different kind of API endpoints so we had to go back and look at what are the kind of use cases we're looking",
    "start": "988380",
    "end": "994199"
  },
  {
    "text": "at to be able to uh you know kind of decide what sort of granularity we could put on these different roles",
    "start": "994199",
    "end": "1001579"
  },
  {
    "text": "so I could be extremely again granular like so every API endpoint has its own",
    "start": "1001579",
    "end": "1006680"
  },
  {
    "text": "distinct individual application permission so like to do dot read to do",
    "start": "1006680",
    "end": "1011720"
  },
  {
    "text": "update to do.create to dot delete but then we looked at our applications we saw that well there's not really that",
    "start": "1011720",
    "end": "1018259"
  },
  {
    "text": "sort of breakdown like this application can create something but that application can only update something",
    "start": "1018259",
    "end": "1023300"
  },
  {
    "text": "there was never that sort of breakdown and so what we had was there are certain systems that could read the data and",
    "start": "1023300",
    "end": "1030020"
  },
  {
    "text": "there are certain systems they can read and write the data so we wind up mapping those roles and permissions out see",
    "start": "1030020",
    "end": "1036558"
  },
  {
    "text": "something a bit more simplified that was uh just read and write now again you don't have to go this",
    "start": "1036559",
    "end": "1043819"
  },
  {
    "text": "route of creating application permissions you could just use the access control list and say you know if you've got a",
    "start": "1043819",
    "end": "1050299"
  },
  {
    "text": "token and you're my list of uh you know qualified people they can call me then you're good to go um well we found this though because we",
    "start": "1050299",
    "end": "1057020"
  },
  {
    "text": "were dealing with protected health information and protected user data governed by you know laws and regulations and such we only wanted",
    "start": "1057020",
    "end": "1064400"
  },
  {
    "text": "specific applications to call us that we knew that they can then apply those appropriates like data protection",
    "start": "1064400",
    "end": "1070520"
  },
  {
    "text": "privacy uh attributes to that data before it actually went out the door to the end user so we wound up going the",
    "start": "1070520",
    "end": "1077299"
  },
  {
    "text": "application permission route to ensure that only the specific applications that can read this protected data because not",
    "start": "1077299",
    "end": "1083240"
  },
  {
    "text": "all of it was protected that were then those applications they could call us but other applications that could didn't",
    "start": "1083240",
    "end": "1090559"
  },
  {
    "text": "have that sort of capabilities to be able to protect that data said well you can only get access to the apis that don't have that information inside of it",
    "start": "1090559",
    "end": "1097220"
  },
  {
    "text": "so we went up the application permission route and tried to just focus the granularity of these permissions based",
    "start": "1097220",
    "end": "1103940"
  },
  {
    "text": "on the overall business use cases there are not like there's not like a lot of documentation or guidance from Microsoft",
    "start": "1103940",
    "end": "1110240"
  },
  {
    "text": "or any of their identity writer out there really about what these application permissions coders should be so we kind of had a you know figure it",
    "start": "1110240",
    "end": "1117440"
  },
  {
    "text": "out based on our individual use case so with that let's go to our demo and",
    "start": "1117440",
    "end": "1123320"
  },
  {
    "text": "our demo is going to be exactly this in which we have a server deployed into Azure we have an Azure client which is",
    "start": "1123320",
    "end": "1130340"
  },
  {
    "text": "another API deployed into Azure and then we have an external client which is just represented as a worker application calling our API from my laptop",
    "start": "1130340",
    "end": "1139240"
  },
  {
    "text": "all right so I've got uh Visual Studio here I've",
    "start": "1144520",
    "end": "1151400"
  },
  {
    "text": "got in our application here in our solution I've got my Azure server so this is an",
    "start": "1151400",
    "end": "1157940"
  },
  {
    "text": "API that will be then deployed out to Azure as an app service I have an Azure",
    "start": "1157940",
    "end": "1163640"
  },
  {
    "text": "client which is another web API that calls our API uh also deployed out into",
    "start": "1163640",
    "end": "1169220"
  },
  {
    "text": "Azure and then finally have the external client and that piece is the um the",
    "start": "1169220",
    "end": "1174760"
  },
  {
    "text": "application they'll be just running on my laptop so first things first we need to build",
    "start": "1174760",
    "end": "1180980"
  },
  {
    "text": "out the Azure ad resources in order to secure our server so we'll go to the server first then we'll look at the",
    "start": "1180980",
    "end": "1187220"
  },
  {
    "text": "external client and then we'll look at the Azure clients now to build these resources out I could",
    "start": "1187220",
    "end": "1193039"
  },
  {
    "text": "go to the Azure portal and kind of Click around there to create all these different resources but that's no fun I",
    "start": "1193039",
    "end": "1198980"
  },
  {
    "text": "also wanted to use uh infrastructure as code because that makes it a little bit easier for us to understand the actual",
    "start": "1198980",
    "end": "1204320"
  },
  {
    "text": "resources being created for us behind the scenes so I'm using palumi this is not a plumy",
    "start": "1204320",
    "end": "1209840"
  },
  {
    "text": "talk I'm just using palumi because c-sharp and so we'll be using palumi to",
    "start": "1209840",
    "end": "1214880"
  },
  {
    "text": "create all the different Azure resources for our servers and our clients",
    "start": "1214880",
    "end": "1221240"
  },
  {
    "text": "all right so let's first go to our server resource it's empty now but we'll soon have stuff",
    "start": "1221240",
    "end": "1227240"
  },
  {
    "text": "inside of it so the first thing we need inside of this uh to create our server is going to be the actual app service",
    "start": "1227240",
    "end": "1233720"
  },
  {
    "text": "so I'll go ahead and create that first so this uh this app service is an Azure",
    "start": "1233720",
    "end": "1241280"
  },
  {
    "text": "uh app service and so it's just a web application that calls our Azure server",
    "start": "1241280",
    "end": "1246919"
  },
  {
    "text": "application such as.net Azure server and so this is going to be the actual deployed application inside of azure",
    "start": "1246919",
    "end": "1254960"
  },
  {
    "text": "but it has no security associated with it by itself if we want to add security to it we have to add additional",
    "start": "1254960",
    "end": "1260419"
  },
  {
    "text": "resources to it so the next thing we're going to add is our server application",
    "start": "1260419",
    "end": "1266740"
  },
  {
    "text": "okay So This Server application is a secured resource inside of azure so",
    "start": "1269179",
    "end": "1275900"
  },
  {
    "text": "when you want to secure any kind of API or yeah I guess mainly apis then you",
    "start": "1275900",
    "end": "1281059"
  },
  {
    "text": "have to have some kind of container for all those different security rules and that's going to be this application here",
    "start": "1281059",
    "end": "1286220"
  },
  {
    "text": "I will go over to the Azure portal just to show what this",
    "start": "1286220",
    "end": "1291980"
  },
  {
    "text": "looks like so let me go to it's called app registrations",
    "start": "1291980",
    "end": "1298059"
  },
  {
    "text": "and this is our Azure ad example server so when I run this palumi uh up command",
    "start": "1299480",
    "end": "1305120"
  },
  {
    "text": "it will create this uh this application here now every single kind of identity",
    "start": "1305120",
    "end": "1310940"
  },
  {
    "text": "provider oauth 2.0 like a token provider has different concepts for how you",
    "start": "1310940",
    "end": "1316280"
  },
  {
    "text": "secure these kind of Standalone applications so austero has its model of how to secure applications",
    "start": "1316280",
    "end": "1322480"
  },
  {
    "text": "OCTA has its model Azure ID has its model identity server has its model but the general idea is that if I don't have",
    "start": "1322480",
    "end": "1328460"
  },
  {
    "text": "a user that's calling different apis that have another application calling it other apis then it's going to need to",
    "start": "1328460",
    "end": "1333980"
  },
  {
    "text": "use the client credentials flow to acquire token and they need some way to identify who the clients are and who the",
    "start": "1333980",
    "end": "1340280"
  },
  {
    "text": "servers are so an application or app registration inside of azure represents that identity",
    "start": "1340280",
    "end": "1346100"
  },
  {
    "text": "of some application that's calling another application so represents both the client and the server",
    "start": "1346100",
    "end": "1352760"
  },
  {
    "text": "all right so this is our server application not a lot going on here to say here's my uh here's the here's the",
    "start": "1352760",
    "end": "1359120"
  },
  {
    "text": "name of the application so that Azure ID example server is what I see right here and then I have a specific URI to",
    "start": "1359120",
    "end": "1366440"
  },
  {
    "text": "identify it so instead of going based off like a good when I wanted to get a token for something I will use this URI",
    "start": "1366440",
    "end": "1372320"
  },
  {
    "text": "itself and that shows up right here API slash example server",
    "start": "1372320",
    "end": "1377840"
  },
  {
    "text": "ah there we go okay so that by itself uh is just a",
    "start": "1377840",
    "end": "1385820"
  },
  {
    "text": "container for what is going to be our security rules the next thing I need to Define though is our roles or permissions for this API",
    "start": "1385820",
    "end": "1394340"
  },
  {
    "text": "so the roles are going to live inside of azure ad and then my application is they're going to authorize those rules",
    "start": "1394340",
    "end": "1400400"
  },
  {
    "text": "but Azure does need to understand what are the different permissions and roles from application so that when I acquire",
    "start": "1400400",
    "end": "1406340"
  },
  {
    "text": "a token for a resource it can say do you have this permission so",
    "start": "1406340",
    "end": "1412220"
  },
  {
    "text": "I will now create our roles",
    "start": "1412220",
    "end": "1418779"
  },
  {
    "text": "there we are all right so I'm defining two application roles here one is to do dot",
    "start": "1422539",
    "end": "1429679"
  },
  {
    "text": "read and one is to do dot rights and over here these two components here",
    "start": "1429679",
    "end": "1435980"
  },
  {
    "text": "are just IDs of these roles because when I want to assign a role to another resource I need to know which role I'm",
    "start": "1435980",
    "end": "1443059"
  },
  {
    "text": "assigning and so those IDs are the things I'll be using to say assign this role with this ID to this client for",
    "start": "1443059",
    "end": "1448760"
  },
  {
    "text": "this server all right so at this point",
    "start": "1448760",
    "end": "1454640"
  },
  {
    "text": "my server has its roles defined as part of it and I go to the portal if I go to",
    "start": "1454640",
    "end": "1459980"
  },
  {
    "text": "app roles I will see now to do.write and to do that read by the way I'm not actually",
    "start": "1459980",
    "end": "1465440"
  },
  {
    "text": "running plume up all the time because I don't trust the like Azure to be able to do the things in real time while we're",
    "start": "1465440",
    "end": "1471620"
  },
  {
    "text": "doing this demo um so I've already run all these different polymer commands I'm just gonna be adding them one by one and explaining as we go",
    "start": "1471620",
    "end": "1477620"
  },
  {
    "text": "a little bit of a cheats but that's okay all right so I've defined these two different application roles uh to do",
    "start": "1477620",
    "end": "1483380"
  },
  {
    "text": "right and to do.read how do I sign up roles yes let's look at that next but first we've we've created",
    "start": "1483380",
    "end": "1490159"
  },
  {
    "text": "these roles we need to have our server actually enforce this authentication authorization uh these authentication",
    "start": "1490159",
    "end": "1497299"
  },
  {
    "text": "rules so now um I will go back to my server application",
    "start": "1497299",
    "end": "1503299"
  },
  {
    "text": "and add the code necessary for it to authenticate via Azure ID",
    "start": "1503299",
    "end": "1509179"
  },
  {
    "text": "and authorize against those specific app roles",
    "start": "1509179",
    "end": "1513580"
  },
  {
    "text": "okay so this is just a normal kind of vanilla web API I've got uh you know API",
    "start": "1514780",
    "end": "1521480"
  },
  {
    "text": "controllers here that has the to do items uh this one you know does all the get put post delete and then I also have",
    "start": "1521480",
    "end": "1527360"
  },
  {
    "text": "another API just to show like what it would look like to not secure an API so I have an API uh that doesn't um this endpoint is just",
    "start": "1527360",
    "end": "1534860"
  },
  {
    "text": "I guess weather so it's not that interesting um so this one will not have security associated with it the to do one will",
    "start": "1534860",
    "end": "1541659"
  },
  {
    "text": "okay so first we'll pull this over",
    "start": "1541659",
    "end": "1549640"
  },
  {
    "text": "and we need to tell our server to authenticate using Azure ad and to do so",
    "start": "1550820",
    "end": "1557419"
  },
  {
    "text": "we'll be using the Microsoft identity web package so",
    "start": "1557419",
    "end": "1562460"
  },
  {
    "text": "this package integrates directly with asp.net core to give you all that middleware authentication authorization",
    "start": "1562460",
    "end": "1567860"
  },
  {
    "text": "against Azure ID underneath the covers it's not doing anything I guess it is doing something interesting",
    "start": "1567860",
    "end": "1574159"
  },
  {
    "text": "it is going to look at the incoming requests look at the authorization header grab that Bearer token that jots",
    "start": "1574159",
    "end": "1580520"
  },
  {
    "text": "look at the issuer and say are you a valid jot for this you know for Azure ID",
    "start": "1580520",
    "end": "1586059"
  },
  {
    "text": "and are you calling my API that I am identified with this specific ID",
    "start": "1586059",
    "end": "1593260"
  },
  {
    "text": "and so to get all that we just say add Microsoft identity web authentication",
    "start": "1593539",
    "end": "1599720"
  },
  {
    "text": "let me bump this font up just a little bit oh that was a lot",
    "start": "1599720",
    "end": "1606100"
  },
  {
    "text": "all right um so we say add Microsoft identity web API authentication and then we'll pass",
    "start": "1607580",
    "end": "1613880"
  },
  {
    "text": "in our configuration to say these are the different configuration values for who are you what's what is your you know",
    "start": "1613880",
    "end": "1620059"
  },
  {
    "text": "what issuers should you validate against that sort of thing so to determine like what",
    "start": "1620059",
    "end": "1627440"
  },
  {
    "text": "I should be authening authenticating against yes we'll go to this one we need our",
    "start": "1627440",
    "end": "1634159"
  },
  {
    "text": "configuration so what is this configuration that we need I'll just pulled over first",
    "start": "1634159",
    "end": "1640059"
  },
  {
    "text": "we need to understand what is our authentication server",
    "start": "1640059",
    "end": "1645620"
  },
  {
    "text": "so what is the instance of azure ID that we're authenticating authenticating against this is just like the normal",
    "start": "1645620",
    "end": "1652159"
  },
  {
    "text": "Azure ad login but if I had a custom URL or custom kind of Landing point for Azure ID that would be that different",
    "start": "1652159",
    "end": "1658580"
  },
  {
    "text": "URL there I need to know the Azure ad tenant so this is the same for all of my Azure ad",
    "start": "1658580",
    "end": "1666799"
  },
  {
    "text": "um resources so all the users all the groups everything is going to be umbrella into that single tenant and",
    "start": "1666799",
    "end": "1672919"
  },
  {
    "text": "then the next thing I need to know is who are you like who is this server and so I have to give it the client ID this",
    "start": "1672919",
    "end": "1678559"
  },
  {
    "text": "is a little confusing because I have clients and I have servers and they both are called applications and they all",
    "start": "1678559",
    "end": "1684440"
  },
  {
    "text": "both have client IDs so this client ID represents the client ID of the server",
    "start": "1684440",
    "end": "1689659"
  },
  {
    "text": "even though it's called client ID where do I get this I get it",
    "start": "1689659",
    "end": "1696380"
  },
  {
    "text": "from here I have a application client ID I have the directory and tenant ID and",
    "start": "1696380",
    "end": "1704960"
  },
  {
    "text": "those two pieces I'll drop in right here actually I can get it from palumi so I'm using plume to spit out",
    "start": "1704960",
    "end": "1711559"
  },
  {
    "text": "the different configuration values so my server application client ID is this as",
    "start": "1711559",
    "end": "1717740"
  },
  {
    "text": "well as the host name and other things we'll be creating here in a little bit all right so I've got all my",
    "start": "1717740",
    "end": "1724820"
  },
  {
    "text": "configuration here this configuration then feeds directly into",
    "start": "1724820",
    "end": "1730760"
  },
  {
    "text": "this call here and so the server will then look at the token and say was it issued by this Authority this issuer so",
    "start": "1730760",
    "end": "1738080"
  },
  {
    "text": "log in microsoft.com and is the audience uh this specific ID and is the uh other",
    "start": "1738080",
    "end": "1745580"
  },
  {
    "text": "thing the server I'm wanting to talk to is that also in that token as well so it looks at all the configuring and you know matches it up and says right do all",
    "start": "1745580",
    "end": "1751820"
  },
  {
    "text": "these match these different values exist in that token then you're good to go",
    "start": "1751820",
    "end": "1757100"
  },
  {
    "text": "all right now in my API I have to authorize those",
    "start": "1757100",
    "end": "1762440"
  },
  {
    "text": "individual roles so I will say over here this is the get action so that will be",
    "start": "1762440",
    "end": "1768860"
  },
  {
    "text": "to do dot read this is another get action so that will also be to do.read",
    "start": "1768860",
    "end": "1775520"
  },
  {
    "text": "this is a put action so that would be to do.write",
    "start": "1775520",
    "end": "1781960"
  },
  {
    "text": "and then this action will also be a post so that's going to be to do it right and then delete",
    "start": "1783320",
    "end": "1788960"
  },
  {
    "text": "to do that right as well",
    "start": "1788960",
    "end": "1792398"
  },
  {
    "text": "so this is kind of funny I have authorized I'm authorizing specific roles with this role that is our",
    "start": "1794899",
    "end": "1801520"
  },
  {
    "text": "excuse me there's our permission so we have a permission called to dot right and to dot read and behind the scenes",
    "start": "1801520",
    "end": "1809600"
  },
  {
    "text": "this authorized attribute will look at our identity the principle and say do",
    "start": "1809600",
    "end": "1815360"
  },
  {
    "text": "you have this role but where those roles come from how did asp.net core know how to take that token and then populate",
    "start": "1815360",
    "end": "1822080"
  },
  {
    "text": "those roles and my identity and my principal inside of this so right",
    "start": "1822080",
    "end": "1827240"
  },
  {
    "text": "here this is just a normal authorized attribute I'm not telling it to use Azure ID anything like that so something",
    "start": "1827240",
    "end": "1832399"
  },
  {
    "text": "is translating from the roles coming in on the token to the roles being assigned to my individual identity and principle",
    "start": "1832399",
    "end": "1840080"
  },
  {
    "text": "so that's the last piece of this configuration here I tell it that the roll claim type",
    "start": "1840080",
    "end": "1845600"
  },
  {
    "text": "is called roles so on my token we will have a claim called roles that include",
    "start": "1845600",
    "end": "1850640"
  },
  {
    "text": "that is the list of all the different permissions that have been assigned to this resource and then Azure the",
    "start": "1850640",
    "end": "1856159"
  },
  {
    "text": "Microsoft identity web middleware will take that incoming claim take those roles and then apply those roles to our",
    "start": "1856159",
    "end": "1862880"
  },
  {
    "text": "identity underneath the covers so then in our controller all we got to do is then authorize this specific role",
    "start": "1862880",
    "end": "1870398"
  },
  {
    "text": "now if I were to run this application actually just let's just run it",
    "start": "1870620",
    "end": "1876158"
  },
  {
    "text": "when I want to test this locally I'm going to have a problem because",
    "start": "1881860",
    "end": "1888080"
  },
  {
    "text": "if I try to call any of these apis let's yeah let's try it out when I execute this API locally",
    "start": "1888080",
    "end": "1894620"
  },
  {
    "text": "oh unauthorized because we're not supplying a token to this server and so",
    "start": "1894620",
    "end": "1901399"
  },
  {
    "text": "locally it's like well I'm you know I still need a token for you to call me and you don't have one",
    "start": "1901399",
    "end": "1906679"
  },
  {
    "text": "so our next problem was how do we achieve local development with this API that's only supposed to be",
    "start": "1906679",
    "end": "1912860"
  },
  {
    "text": "called by other apis I still need to be able to get a token as me a developer calling this API locally",
    "start": "1912860",
    "end": "1919760"
  },
  {
    "text": "I could turn off security locally but that's no fun right we still want to test out these different flows and these",
    "start": "1919760",
    "end": "1925340"
  },
  {
    "text": "different middleware so I still want to be able to call this API and get a token so how do I as a user acquire a token",
    "start": "1925340",
    "end": "1935179"
  },
  {
    "text": "for this API well we had to go back to that list of different oauth2 protocols and say what",
    "start": "1935179",
    "end": "1940940"
  },
  {
    "text": "makes sense as a user calling this web application to call this API naive me said let's just use the same",
    "start": "1940940",
    "end": "1948020"
  },
  {
    "text": "protocols we were trying to use for everything else let's use client credentials so I have a client ID and a",
    "start": "1948020",
    "end": "1953240"
  },
  {
    "text": "client secrets and I'll Supply that client ID and Secret inside that Swagger UI and then I'll acquire token to get",
    "start": "1953240",
    "end": "1959539"
  },
  {
    "text": "that information that get that to get that token not so fast Azure says I will not issue",
    "start": "1959539",
    "end": "1966440"
  },
  {
    "text": "you a token if you originate from a browser using client credentials why not",
    "start": "1966440",
    "end": "1971539"
  },
  {
    "text": "because you should never use client credentials inside a browser or desktop or you know client application because",
    "start": "1971539",
    "end": "1977600"
  },
  {
    "text": "we should we don't have the ability to store that client secret securely so Azure ID says no thank you you can't do",
    "start": "1977600",
    "end": "1984559"
  },
  {
    "text": "that um and so if we tried to use client ID and client secret the client credentials flow via Swagger Azure ID would reject",
    "start": "1984559",
    "end": "1991580"
  },
  {
    "text": "that and say I don't support that flow from this specific resource which is a browser",
    "start": "1991580",
    "end": "1997519"
  },
  {
    "text": "okay um so what can we do instead well um we'll just use one of those other",
    "start": "1997519",
    "end": "2002559"
  },
  {
    "text": "application flows and so when we looked at you know a browser server calling an application it told us to use the",
    "start": "2002559",
    "end": "2008320"
  },
  {
    "text": "authorization code flow and so I do have a user and Azure ID like me my my actual",
    "start": "2008320",
    "end": "2013419"
  },
  {
    "text": "account so what if my user gets access to the API and then me as the user",
    "start": "2013419",
    "end": "2019120"
  },
  {
    "text": "developing locally I acquire token on behalf of myself using off code and then",
    "start": "2019120",
    "end": "2024580"
  },
  {
    "text": "I get that token from Azure ID that represents me calling the API versus some other server",
    "start": "2024580",
    "end": "2030580"
  },
  {
    "text": "um but to do so we need to authorize my user to have those specific application",
    "start": "2030580",
    "end": "2035919"
  },
  {
    "text": "permissions I can acquire token via Azure ID but if I want to acquire token for that specific resource for This",
    "start": "2035919",
    "end": "2042100"
  },
  {
    "text": "Server then I need to be assigned this permission so that I get those roles in my jots",
    "start": "2042100",
    "end": "2047799"
  },
  {
    "text": "so let's do that to do so I'm going to need some more",
    "start": "2047799",
    "end": "2052898"
  },
  {
    "text": "Azure ad resources let's go back over here to Azure ID",
    "start": "2052899",
    "end": "2057940"
  },
  {
    "text": "and then over in our server actually this is going to be in yep",
    "start": "2057940",
    "end": "2066158"
  },
  {
    "text": "that's right um in order to acquire token as me the",
    "start": "2066159",
    "end": "2071440"
  },
  {
    "text": "individual user uh I need to apply a couple other things on top of azure ID so the first thing I need to do is",
    "start": "2071440",
    "end": "2078280"
  },
  {
    "text": "Define a scope for which my user will ask for permissions this is just a made-up scope so it's just a limitation",
    "start": "2078280",
    "end": "2085240"
  },
  {
    "text": "of azure ID unfortunately that says if you're an end user asking for a token via auth code flow then you do you need",
    "start": "2085240",
    "end": "2092320"
  },
  {
    "text": "to authorize against a scope and so I don't care what scope it is just make something up and so I said right this",
    "start": "2092320",
    "end": "2098260"
  },
  {
    "text": "scope which is called local Dev and then when I ask for the local Dev scope I'll also get my other claims which are going",
    "start": "2098260",
    "end": "2104859"
  },
  {
    "text": "to be the roles the next thing I need to do is modify my application definition in Azure to",
    "start": "2104859",
    "end": "2111460"
  },
  {
    "text": "accept this new kind of authorization code flow let me go ahead and add that next",
    "start": "2111460",
    "end": "2118260"
  },
  {
    "text": "so I say I'm going to expose an API that has this oauth 2 permission scope called",
    "start": "2119440",
    "end": "2125619"
  },
  {
    "text": "local Dev so there's the local Dev scope uh with this with this ID",
    "start": "2125619",
    "end": "2131079"
  },
  {
    "text": "and then I'll also include a redirect URI that I will I say this is okay for",
    "start": "2131079",
    "end": "2136119"
  },
  {
    "text": "us to do this specific flow so this redirect URI is going to be my Swagger redirect so when I try to acquire token",
    "start": "2136119",
    "end": "2143440"
  },
  {
    "text": "from my local browser running on my desktop then it will say oh yes this is",
    "start": "2143440",
    "end": "2148900"
  },
  {
    "text": "an okay redirect to be able to get your your token",
    "start": "2148900",
    "end": "2155338"
  },
  {
    "text": "all right now the next thing we're going to need is going to be our",
    "start": "2155520",
    "end": "2162359"
  },
  {
    "text": "assignments of those roles to my user so I'm going to go ahead and pull it",
    "start": "2162359",
    "end": "2168339"
  },
  {
    "text": "over here",
    "start": "2168339",
    "end": "2171599"
  },
  {
    "text": "so we have a few resources here one is going to be the Principal that's going to be the target of",
    "start": "2173500",
    "end": "2179500"
  },
  {
    "text": "assignment of our roles so that's This Server service principle the application itself I can't secure directly so the",
    "start": "2179500",
    "end": "2186160"
  },
  {
    "text": "way Azure ID works is everything is done via principles and then this application will then now have a principle attached",
    "start": "2186160",
    "end": "2192400"
  },
  {
    "text": "to it so the roles I'm assigning are not to the application but instead of this other securable resource there's like a",
    "start": "2192400",
    "end": "2198220"
  },
  {
    "text": "database diagram calling out somewhere that's like there's a principal table and I've got like application table that",
    "start": "2198220",
    "end": "2203380"
  },
  {
    "text": "links to that principal table and I got users that are also principals and groups that are also principles and those are the things I assign roles to",
    "start": "2203380",
    "end": "2209560"
  },
  {
    "text": "not these like applications themselves uh the next thing I need to do is uh say",
    "start": "2209560",
    "end": "2216040"
  },
  {
    "text": "that it's okay for visual studio that's running locally to be able to make authorization requests so this one is",
    "start": "2216040",
    "end": "2222579"
  },
  {
    "text": "saying um I will say it's okay for visual studio to ask for a token from API and",
    "start": "2222579",
    "end": "2229420"
  },
  {
    "text": "this is a quote quote well-known client ID that you have to Google for and",
    "start": "2229420",
    "end": "2235119"
  },
  {
    "text": "what's one of the things that you Google for it and there's like a bazillion results on on stack Overflow like what",
    "start": "2235119",
    "end": "2240579"
  },
  {
    "text": "is this ridiculous good that I have to stick in here to be able to call my API well this is it when Visual Studio makes",
    "start": "2240579",
    "end": "2245920"
  },
  {
    "text": "a call out to get our API the application ID it uses is this one it",
    "start": "2245920",
    "end": "2251380"
  },
  {
    "text": "hasn't changed in like 12 years so it's okay to hard code it if they change that so many things break",
    "start": "2251380",
    "end": "2257800"
  },
  {
    "text": "so that's just what it is um there are other sources I can use to be able to call that so if I'm using the",
    "start": "2257800",
    "end": "2263320"
  },
  {
    "text": "Azure CLI or Visual Studio code those also have their own client ID so just Google you know Visual Studio code",
    "start": "2263320",
    "end": "2269619"
  },
  {
    "text": "client ID and you'll find that other you know quote quote well-known good",
    "start": "2269619",
    "end": "2275460"
  },
  {
    "text": "all right lastly I need to assign my user those individual roles",
    "start": "2276220",
    "end": "2284980"
  },
  {
    "text": "and so I'll do that right here I will have two methods here one is to",
    "start": "2284980",
    "end": "2291400"
  },
  {
    "text": "assign the read and one is to assign the right and so to assign the read",
    "start": "2291400",
    "end": "2297280"
  },
  {
    "text": "permission I have to say you know who is the principal that I'm assigning to what is the role I'm assigning and what is",
    "start": "2297280",
    "end": "2303940"
  },
  {
    "text": "the then client ID of the principal that I'm assigning that role for so I need to know like the client the server and the",
    "start": "2303940",
    "end": "2310420"
  },
  {
    "text": "role and so that's all here I have an app role assignment that includes the app role ID the ID of the role of My",
    "start": "2310420",
    "end": "2316839"
  },
  {
    "text": "Signing I have the principal and which I'm assigning for and then I finally have the resource in which is going to",
    "start": "2316839",
    "end": "2323140"
  },
  {
    "text": "receive the or yes the principle I'm assigning for the client and the resource of the server which is the",
    "start": "2323140",
    "end": "2329740"
  },
  {
    "text": "server service principle object ID again this is basically a database table somewhere that is a role ID client ID",
    "start": "2329740",
    "end": "2337599"
  },
  {
    "text": "server ID and that's what this command represents is creating that record that assigns this role for this client to",
    "start": "2337599",
    "end": "2343960"
  },
  {
    "text": "that server so I have one for read and one for write and finally I'm going to assign the",
    "start": "2343960",
    "end": "2350260"
  },
  {
    "text": "roles for my user",
    "start": "2350260",
    "end": "2354599"
  },
  {
    "text": "so this will assign read and assign rights for my not user what it decided",
    "start": "2355900",
    "end": "2363940"
  },
  {
    "text": "to do for our Dev team was instead of assigning each individual user all these",
    "start": "2363940",
    "end": "2369040"
  },
  {
    "text": "different permissions I can also just assign all those users to a group an",
    "start": "2369040",
    "end": "2374260"
  },
  {
    "text": "Azure ad group and then assign the group those permissions so instead of me having to like revoke individual users I",
    "start": "2374260",
    "end": "2379780"
  },
  {
    "text": "just say if you're doing local development get added to this group and you're good to go",
    "start": "2379780",
    "end": "2386020"
  },
  {
    "text": "so over here I need to actually assign those roles so",
    "start": "2386020",
    "end": "2393040"
  },
  {
    "text": "right here enter main set of infrastructure as code bits",
    "start": "2393040",
    "end": "2399280"
  },
  {
    "text": "that are creating the server or clients and our external clients I will go ahead and then assign those roles",
    "start": "2399280",
    "end": "2405520"
  },
  {
    "text": "so I say server dot assign roles it's going to assign those those roles based on my Azure ID resources and this is",
    "start": "2405520",
    "end": "2412119"
  },
  {
    "text": "then just my user and the local Dev group that I've created earlier",
    "start": "2412119",
    "end": "2417400"
  },
  {
    "text": "okay so now with all this",
    "start": "2417400",
    "end": "2421859"
  },
  {
    "text": "I need to enable security through Swagger in my server so",
    "start": "2422560",
    "end": "2428260"
  },
  {
    "text": "I have to teach Swagger how to authenticate with Azure ID so that's the",
    "start": "2428260",
    "end": "2433540"
  },
  {
    "text": "next bit we're going to add here so",
    "start": "2433540",
    "end": "2439900"
  },
  {
    "text": "down here we have our add you know app.use Swagger and over here we have ADD Swagger so in our Swagger",
    "start": "2439900",
    "end": "2446859"
  },
  {
    "text": "configuration we'll need to say go ahead and authenticate via Azure ID with a",
    "start": "2446859",
    "end": "2452619"
  },
  {
    "text": "specific flow so I have to tell it you're going to use the authorization code flow which is the",
    "start": "2452619",
    "end": "2458320"
  },
  {
    "text": "normal flow for a browser and these are all the URLs you need to go to for the authorization URL for the token URL and",
    "start": "2458320",
    "end": "2464859"
  },
  {
    "text": "the scope is going to be that local Dev scope that we asked for earlier",
    "start": "2464859",
    "end": "2471359"
  },
  {
    "text": "finally down in the UI we have to do a similar kind of operation",
    "start": "2472180",
    "end": "2477839"
  },
  {
    "text": "then we say the client ID that I'm going to be passing in through the UI is this and other junk use pkc PC kit whatever",
    "start": "2480760",
    "end": "2489940"
  },
  {
    "text": "all right so now when we run this we'll get this little padlock in our",
    "start": "2489940",
    "end": "2494980"
  },
  {
    "text": "Swagger UI when I make that call aha authorize",
    "start": "2494980",
    "end": "2500500"
  },
  {
    "text": "authorize against this scope what is this client ID well",
    "start": "2500500",
    "end": "2506380"
  },
  {
    "text": "that is the client ID of Visual Studio the well-known client ID the F12 if you Google that like you'll get like lots of",
    "start": "2506380",
    "end": "2512500"
  },
  {
    "text": "results back I click authorize whoa just like really quick so I was",
    "start": "2512500",
    "end": "2518800"
  },
  {
    "text": "already logged in to Microsoft online Azure ID and so it said right oh you got",
    "start": "2518800",
    "end": "2524320"
  },
  {
    "text": "it's you're already authenticated let's go and grab a token and so now at this point it has a token it can use for any",
    "start": "2524320",
    "end": "2530320"
  },
  {
    "text": "of these calls so now when I test these apis out executes",
    "start": "2530320",
    "end": "2537960"
  },
  {
    "text": "and I grab I'll get we got 200 so we got a good response and we got you know actual",
    "start": "2539200",
    "end": "2545200"
  },
  {
    "text": "responses back and if I grab this bear token right here",
    "start": "2545200",
    "end": "2550980"
  },
  {
    "text": "and I go to jot.ms let's look and see what this token looks",
    "start": "2552760",
    "end": "2557859"
  },
  {
    "text": "like and so down here",
    "start": "2557859",
    "end": "2563380"
  },
  {
    "text": "I've got me James Bogard I've got my scope of local",
    "start": "2563380",
    "end": "2570099"
  },
  {
    "text": "development and hey look there are those roles that I assigned to my group and the group I'm a part of that group",
    "start": "2570099",
    "end": "2577000"
  },
  {
    "text": "that group has been assigned those permissions and so now those roles get populated in the jots when I call the server it takes those roles puts them in",
    "start": "2577000",
    "end": "2583960"
  },
  {
    "text": "the the roles in my principal and then in the authorized attribute it just looks at those roles to say do you have",
    "start": "2583960",
    "end": "2589540"
  },
  {
    "text": "to do that right and to do that read so now I can develop locally huzzah",
    "start": "2589540",
    "end": "2595140"
  },
  {
    "text": "all right we're not done yet though that's just the server we still have to worry about the external clients and the",
    "start": "2596079",
    "end": "2601839"
  },
  {
    "text": "Azure client so let's do the external Client First okay so the external clients",
    "start": "2601839",
    "end": "2610799"
  },
  {
    "text": "so what does the external client need this is something that's not deployed into Azure but still has to identify as",
    "start": "2616240",
    "end": "2621579"
  },
  {
    "text": "an Azure ad resource so that I can get permissions assigned to it and it can acquire a token",
    "start": "2621579",
    "end": "2628060"
  },
  {
    "text": "so",
    "start": "2628060",
    "end": "2630720"
  },
  {
    "text": "we first create our application this is kind of funny because it's not something that actually gets deployed in Azure but",
    "start": "2634180",
    "end": "2640060"
  },
  {
    "text": "in order for us to assign permissions to something I need to have some kind of securable resource so I'm able to just",
    "start": "2640060",
    "end": "2645760"
  },
  {
    "text": "create an application that never actually gets deployed but is something that just exists inside of azure ID",
    "start": "2645760",
    "end": "2651099"
  },
  {
    "text": "and again all identity providers have some sort of concept of this thing Osteo",
    "start": "2651099",
    "end": "2656380"
  },
  {
    "text": "has applications as well and you know role-based Access Control it's a very similar concept across these different",
    "start": "2656380",
    "end": "2661540"
  },
  {
    "text": "identity providers uh the next thing I need is a secret now",
    "start": "2661540",
    "end": "2667180"
  },
  {
    "text": "there's a few different ways for us to acquire a token via Azure ID as a demon",
    "start": "2667180",
    "end": "2672280"
  },
  {
    "text": "application you have the uh the client ID client secret option so that works great if you can secure that secrets you",
    "start": "2672280",
    "end": "2679420"
  },
  {
    "text": "can also use a certificate that's my preferred option is to use a certificate because those certificates I can then",
    "start": "2679420",
    "end": "2685599"
  },
  {
    "text": "store securely inside of key Vault and have permissions associated with those or you can use a Federated token the",
    "start": "2685599",
    "end": "2691480"
  },
  {
    "text": "Federated token is I'm acquiring another token on behalf of another token I already have we don't have that so we",
    "start": "2691480",
    "end": "2698140"
  },
  {
    "text": "just wind up going with the client ID client Seeker out because it also is easier to build locally here",
    "start": "2698140",
    "end": "2704760"
  },
  {
    "text": "okay so I've got my application Secrets I've got a service principle and so that",
    "start": "2704859",
    "end": "2710980"
  },
  {
    "text": "service principle for the external client is going to be the thing in which we assign these different roles to",
    "start": "2710980",
    "end": "2716859"
  },
  {
    "text": "my external clients then needs to acquire tokens on behalf of this Azure",
    "start": "2716859",
    "end": "2723400"
  },
  {
    "text": "ID resource so we're going to need some configuration there first",
    "start": "2723400",
    "end": "2728220"
  },
  {
    "text": "over here we're going to pull over yeah right",
    "start": "2728619",
    "end": "2733900"
  },
  {
    "text": "here a couple things one is the client ID of",
    "start": "2733900",
    "end": "2742119"
  },
  {
    "text": "this external client I need the server application ID so I'm this client calling that server and of",
    "start": "2742119",
    "end": "2748000"
  },
  {
    "text": "course we're just always going to need this 10 ID so we have the tenant ID here as well",
    "start": "2748000",
    "end": "2753180"
  },
  {
    "text": "now in order for my application to acquire tokens I'm going to need to pull in some additional libraries or Library",
    "start": "2753280",
    "end": "2759099"
  },
  {
    "text": "I should say in this case I'm going to be using the microsoft.identity.client library so we",
    "start": "2759099",
    "end": "2764560"
  },
  {
    "text": "had identity.web that was for the API as a clients I can use microsoft.identity.client so I'm",
    "start": "2764560",
    "end": "2770440"
  },
  {
    "text": "acquiring a token as a client to call something else now if you've ever used Azure ID to",
    "start": "2770440",
    "end": "2776500"
  },
  {
    "text": "secure like your database or other things inside of azure it's using these libraries underneath the covers as well",
    "start": "2776500",
    "end": "2782560"
  },
  {
    "text": "so we're we're using these libraries now directly to acquire tokens as opposed to being kind of transparent underneath the",
    "start": "2782560",
    "end": "2788380"
  },
  {
    "text": "covers from calling these other Azure resources all right so we've got our client ID",
    "start": "2788380",
    "end": "2795220"
  },
  {
    "text": "there next thing we need to do is modify our configuration",
    "start": "2795220",
    "end": "2801579"
  },
  {
    "text": "and this is going to be a ton of stuff here that",
    "start": "2801579",
    "end": "2806680"
  },
  {
    "text": "so uh a few things here one is we need to um",
    "start": "2806680",
    "end": "2812319"
  },
  {
    "text": "configure the Microsoft identity client to be able to call Azure ID to acquire",
    "start": "2812319",
    "end": "2817540"
  },
  {
    "text": "our tokens so that's what we see here we're using this confidence confidential client application Builder and what it",
    "start": "2817540",
    "end": "2824079"
  },
  {
    "text": "gives us is this object called a i client confidential client application that is the thing",
    "start": "2824079",
    "end": "2831339"
  },
  {
    "text": "that we'll be using to acquire a tokens so it's a an API that wraps up all the oauth 2 business behind the scenes to",
    "start": "2831339",
    "end": "2837460"
  },
  {
    "text": "eventually just get a token out from the other side all right",
    "start": "2837460",
    "end": "2844420"
  },
  {
    "text": "the next thing we'll have is for each individual client we're going to be calling I need to know like what",
    "start": "2844420",
    "end": "2851800"
  },
  {
    "text": "is the application or server ID of whatever that is and I'm going to be using the uh the typed HTTP client way",
    "start": "2851800",
    "end": "2858339"
  },
  {
    "text": "of calling these apis so each of my apis has this interface feels like we're back to WCF again but",
    "start": "2858339",
    "end": "2865300"
  },
  {
    "text": "has this interface to Define all the different API endpoints to make it easy to call our apis and then our client is",
    "start": "2865300",
    "end": "2871540"
  },
  {
    "text": "then just like call you know git from Json async slash to do items uh get put",
    "start": "2871540",
    "end": "2877540"
  },
  {
    "text": "post and delete so my application will call this object",
    "start": "2877540",
    "end": "2884500"
  },
  {
    "text": "to make the HTTP class behind the scenes and then the last thing we need",
    "start": "2884500",
    "end": "2890380"
  },
  {
    "text": "is middleware in that API client so that every time I make a call to the API it's",
    "start": "2890380",
    "end": "2896800"
  },
  {
    "text": "going to acquire a token from me transparently behind the scenes so I don't want all my application code like oh I need to get this Tok I need to get",
    "start": "2896800",
    "end": "2902920"
  },
  {
    "text": "this token so in this case we'll be using handlers for HP clients to transparently get that's uh",
    "start": "2902920",
    "end": "2911619"
  },
  {
    "text": "transparently get that token for us underneath the covers so This Confidential client application off",
    "start": "2911619",
    "end": "2918220"
  },
  {
    "text": "Handler takes our client our confidential client application so the thing we registered",
    "start": "2918220",
    "end": "2924339"
  },
  {
    "text": "earlier and then down here it's going to say I'm going to acquire a",
    "start": "2924339",
    "end": "2931240"
  },
  {
    "text": "token for a client and the Scopes it's going to acquire for are just the default Scopes it just means I don't want any specific one just give me all",
    "start": "2931240",
    "end": "2938079"
  },
  {
    "text": "the ones that I've uh I've assigned to me and so it gets all those gets an access token and then applies",
    "start": "2938079",
    "end": "2944859"
  },
  {
    "text": "that access token as a bearer token as an authorization header so my client code",
    "start": "2944859",
    "end": "2952060"
  },
  {
    "text": "over here and these workers",
    "start": "2952060",
    "end": "2956160"
  },
  {
    "text": "is just getting the to do items clients which is the type HP clients and just makes a call to say git",
    "start": "2958060",
    "end": "2964780"
  },
  {
    "text": "but in this code here you don't see any authorization header or business that was all done for us via that middleware",
    "start": "2964780",
    "end": "2972839"
  },
  {
    "text": "all right so the next piece I need to do is I've got all the client code here I need to then assign the roles for this",
    "start": "2973540",
    "end": "2981579"
  },
  {
    "text": "new external client to my server application so back in our infrastructure code",
    "start": "2981579",
    "end": "2988800"
  },
  {
    "text": "let's go over to our server we'll create some methods here we have",
    "start": "2988839",
    "end": "2994240"
  },
  {
    "text": "one method already to the Azure ID resources we'll also do one for the external clients",
    "start": "2994240",
    "end": "2999339"
  },
  {
    "text": "now this external client what I'll be testing here is this this client does not have access to all the roles and",
    "start": "2999339",
    "end": "3006119"
  },
  {
    "text": "only has permissions to do reads and so I'm putting that that kind of a responsibility of you know who should",
    "start": "3006119",
    "end": "3012900"
  },
  {
    "text": "have access to what roles I'm really saying that's the server's job to determine all that so that's why it's in This Server class in my infrastructure",
    "start": "3012900",
    "end": "3019980"
  },
  {
    "text": "code then we'll need to call this assign roles over here",
    "start": "3019980",
    "end": "3025859"
  },
  {
    "text": "so we've already assigned the group all right",
    "start": "3025859",
    "end": "3031880"
  },
  {
    "text": "so let's go ahead and run the server and run our clients",
    "start": "3032220",
    "end": "3037440"
  },
  {
    "text": "and see what happens there's my server I can authorize",
    "start": "3037440",
    "end": "3043140"
  },
  {
    "text": "against that let's go and run the external clients",
    "start": "3043140",
    "end": "3047420"
  },
  {
    "text": "and this again is just a Daemon application that has background workers making API calls all right it's already",
    "start": "3049500",
    "end": "3054960"
  },
  {
    "text": "making API calls it's making two API calls though one is just to the get and one is to the put",
    "start": "3054960",
    "end": "3061319"
  },
  {
    "text": "it does not have authorization for the put so that's why",
    "start": "3061319",
    "end": "3066359"
  },
  {
    "text": "you see this 403 Forbidden I don't have that role assigned to my principal to be",
    "start": "3066359",
    "end": "3072660"
  },
  {
    "text": "able to make that call so the server is going to say you don't have you don't have authorization for the resource",
    "start": "3072660",
    "end": "3078359"
  },
  {
    "text": "because you don't have that token let me go ahead and grab that token here",
    "start": "3078359",
    "end": "3084020"
  },
  {
    "text": "and go to jot Ms again and sure enough",
    "start": "3085140",
    "end": "3091140"
  },
  {
    "text": "we've only been assigned the read role not the right role the other thing that you could see in on",
    "start": "3091140",
    "end": "3096900"
  },
  {
    "text": "site here like this is the the audience which is still Visual Studio this is the tenant ID over here and then over here I",
    "start": "3096900",
    "end": "3104940"
  },
  {
    "text": "think one of these IDs is the clients and then one of these IDs is going to be the server itself",
    "start": "3104940",
    "end": "3110280"
  },
  {
    "text": "so it's doing all that Force transparently underneath the covers when I call the API it's checking all those values and then finally the",
    "start": "3110280",
    "end": "3115680"
  },
  {
    "text": "authorization for that attribute is in checking that role",
    "start": "3115680",
    "end": "3120740"
  },
  {
    "text": "all right so that's our external clients using client credentials with a client",
    "start": "3121920",
    "end": "3127319"
  },
  {
    "text": "secrets the next thing we need to do is the Azure client so something deployed inside of azure now we could go this",
    "start": "3127319",
    "end": "3134760"
  },
  {
    "text": "exact same route which is to say let's go ahead and create our own client ID and clients",
    "start": "3134760",
    "end": "3140880"
  },
  {
    "text": "you're going to put inside of there but there are some Azure ID resources that make our lives much easier to be able to",
    "start": "3140880",
    "end": "3147359"
  },
  {
    "text": "have these kind of principles for things inside of azure so that that thing is known as a managed",
    "start": "3147359",
    "end": "3153359"
  },
  {
    "text": "identity a managed identity is a Azure defined principle that we can assign to",
    "start": "3153359",
    "end": "3159480"
  },
  {
    "text": "specific applications to Virtual machines all sorts of things and then when my application runs it's running under that identity of the managed",
    "start": "3159480",
    "end": "3166020"
  },
  {
    "text": "identity versus something I just made up over here like this external application whatever",
    "start": "3166020",
    "end": "3171240"
  },
  {
    "text": "so our Azure clients",
    "start": "3171240",
    "end": "3177740"
  },
  {
    "text": "there we go let's go ahead and create this thing so first what we'll need is",
    "start": "3178020",
    "end": "3184339"
  },
  {
    "text": "uh there it is we need to create our web application",
    "start": "3184339",
    "end": "3190500"
  },
  {
    "text": "that's going to be running inside of azure so that's this web app here so it's still saying I am going to be",
    "start": "3190500",
    "end": "3196020"
  },
  {
    "text": "running you know net Azure clients I also included some configuration to say Well when I'm running inside of azure I",
    "start": "3196020",
    "end": "3202260"
  },
  {
    "text": "need to know where the server is and so I just have some app settings defined as there foreign",
    "start": "3202260",
    "end": "3209280"
  },
  {
    "text": "the next thing we need is an identity for this web application",
    "start": "3209280",
    "end": "3215040"
  },
  {
    "text": "so this is going to be a managed identity a user assigned identity now",
    "start": "3215040",
    "end": "3220619"
  },
  {
    "text": "everything does run as a managed identity behind the scenes for you and like app services and things like that",
    "start": "3220619",
    "end": "3225660"
  },
  {
    "text": "but I want to be able to manage that identity myself and so I'll be creating my own user assign identity which then I",
    "start": "3225660",
    "end": "3232740"
  },
  {
    "text": "will then assign to this web application so here I'll modify my web application",
    "start": "3232740",
    "end": "3239880"
  },
  {
    "text": "definition to say this is your identity this is really ugly Kobe that's just because the this arm template garbage is",
    "start": "3239880",
    "end": "3248760"
  },
  {
    "text": "sometimes really ugly so anyway I am telling the web application that you are going to run as this managed service",
    "start": "3248760",
    "end": "3255480"
  },
  {
    "text": "identity and then finally I'll go ahead and output all these things down here so",
    "start": "3255480",
    "end": "3261119"
  },
  {
    "text": "here's my user assigned client ID uh the principal ID and the host name that I can then spit out when I run my palumi",
    "start": "3261119",
    "end": "3266819"
  },
  {
    "text": "up code next I need to assign the roles for this",
    "start": "3266819",
    "end": "3273059"
  },
  {
    "text": "client to that server but I'm not going to be assigning the application I'm going to be signing the managed",
    "start": "3273059",
    "end": "3279720"
  },
  {
    "text": "identity so over my server",
    "start": "3279720",
    "end": "3284880"
  },
  {
    "text": "one more method to assign roles I take in the clients and it's going to",
    "start": "3284880",
    "end": "3290339"
  },
  {
    "text": "be assigning the reason the right permission for the user assigned identity principal ID",
    "start": "3290339",
    "end": "3297180"
  },
  {
    "text": "so the managed identity is now going to be assigned those permissions",
    "start": "3297180",
    "end": "3303200"
  },
  {
    "text": "finally over here when I I'm assigning my roles I'll go ahead and call that assign roles method so here I have",
    "start": "3303240",
    "end": "3309540"
  },
  {
    "text": "assigning the roles to my local Dev group the external clients and the Azure client",
    "start": "3309540",
    "end": "3315920"
  },
  {
    "text": "now this API this Azure clients is kind of a cheat so what this API is",
    "start": "3317040",
    "end": "3323280"
  },
  {
    "text": "is a mirror image of the Azure or the of the server API it's got the same exact",
    "start": "3323280",
    "end": "3329579"
  },
  {
    "text": "controllers the same exact methods except instead of like doing the real calls",
    "start": "3329579",
    "end": "3335280"
  },
  {
    "text": "it's calling into our clients so it's making API calls so it's an API calling API this is meant to represent our BFF",
    "start": "3335280",
    "end": "3342599"
  },
  {
    "text": "it's an API that calls other apis but it's going to be using the manage identity to identify itself and",
    "start": "3342599",
    "end": "3348720"
  },
  {
    "text": "authenticate against Azure ID so I need to tell this API now how to",
    "start": "3348720",
    "end": "3356280"
  },
  {
    "text": "make those calls and how to uh how to authenticate so for this we're going to be using",
    "start": "3356280",
    "end": "3361559"
  },
  {
    "text": "another Library that's azure.identity",
    "start": "3361559",
    "end": "3367079"
  },
  {
    "text": "so Azure that identity is a library that you use whenever you want you want to use managed identities to make other API",
    "start": "3367079",
    "end": "3373200"
  },
  {
    "text": "calls so if you're if you're deploying an app inside of azure that calls into Azure SQL it's going to be using this",
    "start": "3373200",
    "end": "3380760"
  },
  {
    "text": "Library underneath the covers to use the managed identity to authenticate to get a token to call out to SQL",
    "start": "3380760",
    "end": "3388040"
  },
  {
    "text": "the next thing we need to do is configure this so let's go into our startup oh",
    "start": "3390839",
    "end": "3396839"
  },
  {
    "text": "configuration first so go ahead and again I need to pull in the client oops",
    "start": "3396839",
    "end": "3403800"
  },
  {
    "text": "the client ID and the server ID the client ID is the ID of my managed",
    "start": "3403800",
    "end": "3410040"
  },
  {
    "text": "identity so when I ran my polymy code out popped the client managed identity client ID",
    "start": "3410040",
    "end": "3417180"
  },
  {
    "text": "and so I grab that value and that's what I'm going to be putting inside of here",
    "start": "3417180",
    "end": "3423078"
  },
  {
    "text": "next I need to configure my application to be able to call those different apis",
    "start": "3423720",
    "end": "3430339"
  },
  {
    "text": "and it's going to be uh yes right here",
    "start": "3430500",
    "end": "3438380"
  },
  {
    "text": "so for the azure.identity library",
    "start": "3445740",
    "end": "3450900"
  },
  {
    "text": "we have a little bit different way of acquiring our tokens and it's using this concept of a token credential this token",
    "start": "3450900",
    "end": "3456599"
  },
  {
    "text": "credential is basically wraps up many different ways of being able to acquire",
    "start": "3456599",
    "end": "3462119"
  },
  {
    "text": "token one way is using visual studio another way is using the managed identity it could also use environment",
    "start": "3462119",
    "end": "3468180"
  },
  {
    "text": "variables so this token credential using the default Azure credential wraps all those different combinations together so",
    "start": "3468180",
    "end": "3474240"
  },
  {
    "text": "they don't have to configurable visual Studios this way manage identity is this way and maybe I'm using environment variables this way if I'm inside",
    "start": "3474240",
    "end": "3479880"
  },
  {
    "text": "kubernetes or something or in a container that's all part of that",
    "start": "3479880",
    "end": "3484940"
  },
  {
    "text": "finally we will add more configuration that is the API",
    "start": "3485640",
    "end": "3493800"
  },
  {
    "text": "client configuration so this is like this is very similar to what we saw earlier of I need adding middleware to",
    "start": "3493800",
    "end": "3500400"
  },
  {
    "text": "be able to automatically acquire a token I'm adding these type HTTP clients with a specific configuration with its",
    "start": "3500400",
    "end": "3506339"
  },
  {
    "text": "different base addresses and then adding the middleware for each of those clients so that when it makes those calls out to",
    "start": "3506339",
    "end": "3511920"
  },
  {
    "text": "the Azure server it's transparently acquiring the token now this middleware is slightly different than the previous",
    "start": "3511920",
    "end": "3517740"
  },
  {
    "text": "one because it's using the token credential now this thing to acquire a token",
    "start": "3517740",
    "end": "3524760"
  },
  {
    "text": "it says the scope I'm looking for is again my application ID me oh no I'm",
    "start": "3524760",
    "end": "3530099"
  },
  {
    "text": "sorry the server application ID and the default uh roles for that so the dot scopes it's going to call git token async and",
    "start": "3530099",
    "end": "3537359"
  },
  {
    "text": "then out the other side is going to be our jots so let's go ahead and run this",
    "start": "3537359",
    "end": "3543599"
  },
  {
    "text": "I'll run the server and we'll run our clients",
    "start": "3543599",
    "end": "3551720"
  },
  {
    "text": "our Azure clients now I'm running locally",
    "start": "3556380",
    "end": "3563040"
  },
  {
    "text": "so I don't have a managed identity so what that default Azure credential gives us is why if you're not in Azure you",
    "start": "3563040",
    "end": "3569579"
  },
  {
    "text": "don't have a managed identity we'll just go ahead and fall back to your visual studio uh user",
    "start": "3569579",
    "end": "3575280"
  },
  {
    "text": "so when I make these calls try it out execute",
    "start": "3575280",
    "end": "3582260"
  },
  {
    "text": "this is now using the visual studio context to say oh right let's go ahead and use whoever you're logged in as",
    "start": "3583920",
    "end": "3590400"
  },
  {
    "text": "inside of Visual Studio so like up here this user up here I'm",
    "start": "3590400",
    "end": "3596520"
  },
  {
    "text": "signed in is going to acquire a token a pop on behalf of that user",
    "start": "3596520",
    "end": "3602359"
  },
  {
    "text": "oh",
    "start": "3603359",
    "end": "3605779"
  },
  {
    "text": "well I missed something that's okay we'll go ahead and run now um oh internet problem of course",
    "start": "3608460",
    "end": "3617059"
  },
  {
    "text": "always always running on the cloud so why don't we go ahead and look at the actual running Azure instance of this",
    "start": "3617579",
    "end": "3624780"
  },
  {
    "text": "so over here",
    "start": "3624780",
    "end": "3627920"
  },
  {
    "text": "oh internets if my internet was actually working",
    "start": "3629940",
    "end": "3635280"
  },
  {
    "text": "right now then my clients running as that managed identity would",
    "start": "3635280",
    "end": "3641280"
  },
  {
    "text": "be acquiring tokens on behalf of that managed identity to make the calls out then to my my actual Azure server",
    "start": "3641280",
    "end": "3648240"
  },
  {
    "text": "um because I'm using managed identities there I'm going to be using that same managed identity to secure all my other",
    "start": "3648240",
    "end": "3653819"
  },
  {
    "text": "agile resources so accessing key Vault or Azure SQL anything else it's using that same exact identity",
    "start": "3653819",
    "end": "3661578"
  },
  {
    "text": "all right so just to wrap things up we had our azure",
    "start": "3665760",
    "end": "3673619"
  },
  {
    "text": "we had our Azure server oh no that's fine I don't have one of those connections",
    "start": "3673619",
    "end": "3679440"
  },
  {
    "text": "anyway um we had our Azure server running completely inside of azure that was",
    "start": "3679440",
    "end": "3685980"
  },
  {
    "text": "using Azure ID to identify itself as a resource using application registration we had an external client using client",
    "start": "3685980",
    "end": "3694200"
  },
  {
    "text": "credentials flow with a client ID and client secrets we authorized that client",
    "start": "3694200",
    "end": "3699240"
  },
  {
    "text": "using the application permissions and finally the 100 internal to Azure client",
    "start": "3699240",
    "end": "3704520"
  },
  {
    "text": "here could use a managed identity to identify itself and make our lives much easier to",
    "start": "3704520",
    "end": "3710040"
  },
  {
    "text": "be able to secure against our server as well as any other Azure resources so",
    "start": "3710040",
    "end": "3716099"
  },
  {
    "text": "that was building secure microservices in Azure again I skipped all the networking stuff there's a whole bunch of that too I don't understand any of it",
    "start": "3716099",
    "end": "3722099"
  },
  {
    "text": "but this was the application aspect of it of using oauth 2 and Azure ID to",
    "start": "3722099",
    "end": "3727559"
  },
  {
    "text": "secure different calls inside of azure if you want to see this example running I have a GitHub this link down here",
    "start": "3727559",
    "end": "3734160"
  },
  {
    "text": "github.com Azure ID example that is that full running application you can use that palumi to the plume script to run",
    "start": "3734160",
    "end": "3742140"
  },
  {
    "text": "that against your own Azure subscription and create those own resources for yourself otherwise you can find this",
    "start": "3742140",
    "end": "3747420"
  },
  {
    "text": "slide and the code on my github.com presentations thank you all very much I",
    "start": "3747420",
    "end": "3752819"
  },
  {
    "text": "hope you all have a great rest of the conference [Applause]",
    "start": "3752819",
    "end": "3757859"
  }
]