[
  {
    "text": "all good aha excellent welcome everybody to the final session uh I'm going to kick off now because we have got a ton",
    "start": "1760",
    "end": "8800"
  },
  {
    "text": "of information to cover today okay just an absolute ton so the sort of speed of",
    "start": "8800",
    "end": "14799"
  },
  {
    "text": "today's talk is we're going to start off basic and then we're going to ramp up okay so get ready for a wave of",
    "start": "14799",
    "end": "20800"
  },
  {
    "text": "information to come over you because this is going to be uh pretty intense and especially for the final session of",
    "start": "20800",
    "end": "26560"
  },
  {
    "text": "the conference um but don't fret because of course these videos are all recorded",
    "start": "26560",
    "end": "32000"
  },
  {
    "text": "and this presentation is designed to be just kind of viewed later on as well okay so don't feel like you need to you",
    "start": "32000",
    "end": "38879"
  },
  {
    "text": "know uh get writers cramp but I trying to keep up um so identity server for",
    "start": "38879",
    "end": "45640"
  },
  {
    "text": "angular 2 and asp.net core these are the three things I'm going to be covering today the main part of the uh the main",
    "start": "45640",
    "end": "52399"
  },
  {
    "text": "focus of the talk is identity server 4 okay angular I'm going to show you how I've set up my angular 2 application or",
    "start": "52399",
    "end": "59280"
  },
  {
    "text": "what have version of angular they're up to these days um and the reason I include ASP net core is because all of",
    "start": "59280",
    "end": "65360"
  },
  {
    "text": "what I'm doing today runs on ASP net core okay including angular so keep that in mind um but yes the focus is",
    "start": "65360",
    "end": "72799"
  },
  {
    "text": "definitely on identity server 4 um and I'm super excited and I'm a",
    "start": "72799",
    "end": "77840"
  },
  {
    "text": "little bit scared a little bit nervous and that is because the code we're looking at today is my real world",
    "start": "77840",
    "end": "84040"
  },
  {
    "text": "application okay this is running in production there's commented code around the place there's probably rubbish bits",
    "start": "84040",
    "end": "90000"
  },
  {
    "text": "and pieces here and there um and I'm just literally loading up my solution uh",
    "start": "90000",
    "end": "95280"
  },
  {
    "text": "and so if you see a key you didn't see a key if you see a password you didn't uh",
    "start": "95280",
    "end": "101040"
  },
  {
    "text": "I have to rotate them every time I do this talk uh which is good practice for me anyway it forces me to do",
    "start": "101040",
    "end": "106439"
  },
  {
    "text": "it um so as a bit of context for why I'm here today uh about a year ago I decided",
    "start": "106439",
    "end": "113479"
  },
  {
    "text": "to begin a startup uh in the payments industry I used to work for a payments company um it was rubbish their systems",
    "start": "113479",
    "end": "121159"
  },
  {
    "text": "were awful it was mainly VB6 all of the logic was in store procedures um and I",
    "start": "121159",
    "end": "127119"
  },
  {
    "text": "thought oh I could do such a better job than these guys now it turns out I learned a lesson a little later on it",
    "start": "127119",
    "end": "134640"
  },
  {
    "text": "doesn't matter how good your code is if people are willing to pay for your product and the other way around",
    "start": "134640",
    "end": "141160"
  },
  {
    "text": "basically it's your sales team that makes a product and I only wanted you know a little application I didn't want a unicorn I'm happy with just a tiny",
    "start": "141160",
    "end": "147680"
  },
  {
    "text": "little business that works and earns a little bit of money um I'm happy with the Doge of",
    "start": "147680",
    "end": "153440"
  },
  {
    "text": "applications um so I started out as you would with you know any good startup",
    "start": "153440",
    "end": "159280"
  },
  {
    "text": "should is you find the MVP right you find the simplest thing that will work that you can hand to someone and they can go oh that's cool here's some money",
    "start": "159280",
    "end": "166840"
  },
  {
    "text": "and so I started off with an architecture that looks like this now being a payments company I rely",
    "start": "166840",
    "end": "173200"
  },
  {
    "text": "on the banks to do all of my transfers under the hood and if anyone has ever worked with a bank you might understand",
    "start": "173200",
    "end": "181480"
  },
  {
    "text": "what's happening here it took me nine months to get access to the systems I needed nine",
    "start": "181480",
    "end": "188400"
  },
  {
    "text": "months it was ridiculously slow uh and so as with any kind of developer who's",
    "start": "188400",
    "end": "195080"
  },
  {
    "text": "got some time on his hands you know I ended up with an architecture that",
    "start": "195080",
    "end": "200720"
  },
  {
    "text": "looked like this so rather than actually you know working on uh finding customers",
    "start": "200720",
    "end": "207319"
  },
  {
    "text": "talking to you know business people and that kind of thing I thought oh you know what I'll just add one more little thing I'll just",
    "start": "207319",
    "end": "212959"
  },
  {
    "text": "investigate one more technology CU I want my product to be you know super solid and really really great for",
    "start": "212959",
    "end": "219280"
  },
  {
    "text": "developers uh because the whole point of my product is to let developers access",
    "start": "219280",
    "end": "224680"
  },
  {
    "text": "Payment Systems easily okay and this is where identity server uh really",
    "start": "224680",
    "end": "230040"
  },
  {
    "text": "shines but perhaps I shouldn't have gone so far so I now have quite a complex uh system",
    "start": "230040",
    "end": "235840"
  },
  {
    "text": "architecture but uh at least I know the intricacies of all these systems now cuz I've spent a long time gold plating them",
    "start": "235840",
    "end": "243120"
  },
  {
    "text": "so anyway we want to build something like this right we want to build an API that we can give out to developers and",
    "start": "243120",
    "end": "248400"
  },
  {
    "text": "we want solid systems that are protected uh using identity server so where do we",
    "start": "248400",
    "end": "253760"
  },
  {
    "text": "start with beer that's right if you don't know me I'm Ben who likes beer um",
    "start": "253760",
    "end": "259600"
  },
  {
    "text": "I was working on the beer that was at the party last night with ulir uh and so",
    "start": "259600",
    "end": "264680"
  },
  {
    "text": "I really enjoyed that if you saw the videos on Facebook you can see just how excited I was to go ahead and visit this Brewery um but if you want to follow me",
    "start": "264680",
    "end": "270919"
  },
  {
    "text": "on Twitter you can follow me there um it's probably the easiest place to find blog posts or something like that about",
    "start": "270919",
    "end": "276479"
  },
  {
    "text": "this kind of stuff um just really quickly I was a solution architect at ssw that was a",
    "start": "276479",
    "end": "281880"
  },
  {
    "text": "year ago I still do a little bit of work for them uh I like payments I like beer there's untapped if you haven't seen that yet you should install it follow me",
    "start": "281880",
    "end": "288800"
  },
  {
    "text": "I'm Ben um and I'm working on the startup which is of course pinch um",
    "start": "288800",
    "end": "294120"
  },
  {
    "text": "pinch payments and so this is the code we're going to be looking at today okay now just before we dive into code I want",
    "start": "294120",
    "end": "300560"
  },
  {
    "text": "to cover just a little bit about asp.net core and why I chose that as my platform",
    "start": "300560",
    "end": "306240"
  },
  {
    "text": "and why you might want to do that yourself as well um I guess the first reason is the latest version of identity",
    "start": "306240",
    "end": "312160"
  },
  {
    "text": "server runs on asp.net core so if you're using that then you're going to need to use ASP net core so who's using aspet",
    "start": "312160",
    "end": "318120"
  },
  {
    "text": "core here already okay cool that's about 34 of the audience um for those of you who aren't",
    "start": "318120",
    "end": "325800"
  },
  {
    "text": "convinced yet things are fast okay things are pretty damn quick and you don't have to do anything to you know",
    "start": "325800",
    "end": "331039"
  },
  {
    "text": "reap these performance benefits uh everything that they're doing now they're focusing on",
    "start": "331039",
    "end": "336199"
  },
  {
    "text": "performance um it's highly composable and this is kind of comes back to Identity server as well right it's just",
    "start": "336199",
    "end": "342759"
  },
  {
    "text": "a package that gets put into an NVC website um it's really easy to write these extension points and write these",
    "start": "342759",
    "end": "349120"
  },
  {
    "text": "products to just slide into other applications so using aspn net core makes things a lot easier to compose um",
    "start": "349120",
    "end": "356400"
  },
  {
    "text": "it's got all the attention right now okay you've got Daman and David working on on this stuff and all these teams working on this stuff all the time uh",
    "start": "356400",
    "end": "363240"
  },
  {
    "text": "now this is a double-edged sword it changes every week which if you're not developing every week is a pain in the",
    "start": "363240",
    "end": "369840"
  },
  {
    "text": "ass so uh it's good because it has a tension and it's getting updates and they're making things better and better",
    "start": "369840",
    "end": "375319"
  },
  {
    "text": "but then they're changing it all the time too and so that is a little bit annoying if you're not ready for pain",
    "start": "375319",
    "end": "380680"
  },
  {
    "text": "and breakage um and probably my main point especially",
    "start": "380680",
    "end": "386199"
  },
  {
    "text": "for people newer to asp.net um it's easier to do the right thing so it kind of funnels you towards success with the",
    "start": "386199",
    "end": "393319"
  },
  {
    "text": "built-in dependency injection uh it kind of makes you architect Your solution in",
    "start": "393319",
    "end": "398360"
  },
  {
    "text": "a way that sets you up for Success okay it it makes it uh a good or guides you towards good architecture and and just a",
    "start": "398360",
    "end": "405759"
  },
  {
    "text": "quick point on on performance here's a quick slide from this week um all of",
    "start": "405759",
    "end": "410800"
  },
  {
    "text": "this stuff's in Azure uh and you you can look at this you can see okay things are coming back under 200 milliseconds the",
    "start": "410800",
    "end": "416240"
  },
  {
    "text": "page it's an angular page so it takes a little bit to load here and there um there's fairly steady requests someone",
    "start": "416240",
    "end": "421800"
  },
  {
    "text": "at Azure tripped over the power cord in the middle there and they plugged it back in hence the failed requests um and",
    "start": "421800",
    "end": "427639"
  },
  {
    "text": "you might think okay yeah that's not bad I mean but you got to remember that this is on Australian servers okay this is on",
    "start": "427639",
    "end": "433520"
  },
  {
    "text": "Australian internet which is rubbish and so these speeds are actually pretty decent um they say that in Australia we",
    "start": "433520",
    "end": "439960"
  },
  {
    "text": "have 100 megabyte 100 megabits down and up the problem is the whole country has to",
    "start": "439960",
    "end": "445440"
  },
  {
    "text": "share so asp.net core is a good idea okay it's it's nice it's fun to use and",
    "start": "446440",
    "end": "453879"
  },
  {
    "text": "it's it's performant and the first thing you do when you begin a project usually",
    "start": "453879",
    "end": "459720"
  },
  {
    "text": "one of the earlier things you do is you need to think about security and authentication mainly okay pretty much",
    "start": "459720",
    "end": "465400"
  },
  {
    "text": "every system has a user that needs to log into that system um and this is where we're going to start talking about",
    "start": "465400",
    "end": "471560"
  },
  {
    "text": "identity server specifically now over the last year it's been kind of scary there's been a lot of data breaches",
    "start": "471560",
    "end": "477840"
  },
  {
    "text": "there been you know a lot of security through and even myself if you haven't seen have I been pwned by Troy hunt it's",
    "start": "477840",
    "end": "483560"
  },
  {
    "text": "a fantastic tool it tells you when you You' had a data breach against your email account you can see I've been",
    "start": "483560",
    "end": "489000"
  },
  {
    "text": "breached five times things like LinkedIn GitHub Ashley Madison hopefully",
    "start": "489000",
    "end": "495479"
  },
  {
    "text": "not and so I asked TR I was a bit scared I said I need some advice what can I do",
    "start": "495479",
    "end": "500919"
  },
  {
    "text": "to make my application secure cuz I'm not a security expert I I just want to make good applications and he gave me",
    "start": "500919",
    "end": "507159"
  },
  {
    "text": "some great advice but I think what he meant to say is",
    "start": "507159",
    "end": "512640"
  },
  {
    "text": "don't roll your own security okay there are tools in the box that can do this for you and there is safety in numbers",
    "start": "512640",
    "end": "520000"
  },
  {
    "text": "when you uh all rely on Microsoft and these kind of smart people to take care",
    "start": "520000",
    "end": "525080"
  },
  {
    "text": "of this kind of stuff for you um and so when I talk about Security in an asp.net core World we're talking about two",
    "start": "525080",
    "end": "531680"
  },
  {
    "text": "things uh asp.net identity which takes care of storing usernames and passwords",
    "start": "531680",
    "end": "536959"
  },
  {
    "text": "an identity server that takes care of Bearer authentic and giving out tokens now a quick quick",
    "start": "536959",
    "end": "544120"
  },
  {
    "text": "quiz here uh sorry quick poll here who's used asp.net identity in net core so far",
    "start": "544120",
    "end": "549480"
  },
  {
    "text": "yep and who's used identity server before as well okay so about half the room ASP",
    "start": "549480",
    "end": "556760"
  },
  {
    "text": "identity and about a third I think have used identity server which is good because we're going to start off with the basics and how to get up and running",
    "start": "556760",
    "end": "563079"
  },
  {
    "text": "and then I'm going to shove you into the things that aren't in the documentation okay the things that you won't be able",
    "start": "563079",
    "end": "568760"
  },
  {
    "text": "to find or do easily cuz it's so flexible um so as I said we'll look at asp.net identity",
    "start": "568760",
    "end": "576360"
  },
  {
    "text": "first and its job is just to save usern names and passwords in the database essentially it'll log you into an NBC",
    "start": "576360",
    "end": "581720"
  },
  {
    "text": "website you can use Cy authentication but the goal is basically yes that's what asp.net identity takes care of and",
    "start": "581720",
    "end": "588240"
  },
  {
    "text": "we'll we'll look into that in a minute the problem happens when you add in an API okay what happens when you want to",
    "start": "588240",
    "end": "595760"
  },
  {
    "text": "expose your data to third parties using an API and all of a sudden your you know",
    "start": "595760",
    "end": "601760"
  },
  {
    "text": "cookie based authentication is not going to cut it and so this is where we rely",
    "start": "601760",
    "end": "607320"
  },
  {
    "text": "on the second piece of technology now identity server because what it does is it wraps your asp.net identity website",
    "start": "607320",
    "end": "618079"
  },
  {
    "text": "okay the place where you log in it wraps that up and IT issues tokens uh to your",
    "start": "618079",
    "end": "623880"
  },
  {
    "text": "clients your third parties uh to protect your API in this case um but then you",
    "start": "623880",
    "end": "628959"
  },
  {
    "text": "can also Al add other things so just a couple of quick points before we dive into some code um here",
    "start": "628959",
    "end": "636120"
  },
  {
    "text": "are some scenarios where identity server is a good idea for you okay um the first thing is that it's compatible with any",
    "start": "636120",
    "end": "642600"
  },
  {
    "text": "authentication system okay so if you're coming from a legacy application and you want to start implementing this stuff",
    "start": "642600",
    "end": "648680"
  },
  {
    "text": "you don't have to wrap ASP identity you could wrap an on- premises ad or an",
    "start": "648680",
    "end": "653800"
  },
  {
    "text": "Azure adid or a custom implementation if you have one uh especially if it's Legacy which I hope you then update to",
    "start": "653800",
    "end": "660360"
  },
  {
    "text": "something else uh it includes all of the things like Google and Facebook logins and the",
    "start": "660360",
    "end": "666519"
  },
  {
    "text": "external um open ID connect stuff uh it's not quite microservices",
    "start": "666519",
    "end": "672279"
  },
  {
    "text": "but we are lifting a responsibility and putting it in its own place uh so it's kind of one step towards segmenting your",
    "start": "672279",
    "end": "679480"
  },
  {
    "text": "application a little bit more um which I like I wouldn't call it micros services but it's on its way um you can give out",
    "start": "679480",
    "end": "686920"
  },
  {
    "text": "different claims to different clients so this is just about permissions okay so if you want one group of people to",
    "start": "686920",
    "end": "693000"
  },
  {
    "text": "access a certain part of your API and a different group of people to have limited access or something like that it's very easy to do that with identity",
    "start": "693000",
    "end": "699320"
  },
  {
    "text": "server and some claims um if you're building a an API",
    "start": "699320",
    "end": "704880"
  },
  {
    "text": "that's designed to be given to third party developers this product is perfect okay it is an excellent tool for",
    "start": "704880",
    "end": "710920"
  },
  {
    "text": "building exactly what you need highly flexible and powerful and on the flip side of that if you've got lots of your",
    "start": "710920",
    "end": "717279"
  },
  {
    "text": "own applications okay you're an organization with many internal apps and you just want to you know use one ad uh",
    "start": "717279",
    "end": "725160"
  },
  {
    "text": "authentication for all of them uh this is also a perfect tool for single sign on within an organ",
    "start": "725160",
    "end": "732839"
  },
  {
    "text": "organization so the point of today is that we are going to look at the code that is",
    "start": "732839",
    "end": "738279"
  },
  {
    "text": "this we're going to spin up an asp.net identity server um and identity server",
    "start": "738279",
    "end": "744839"
  },
  {
    "text": "sorry and we're going to take a look at the code that protects our API and how our angular 2 application is set up",
    "start": "744839",
    "end": "750079"
  },
  {
    "text": "within MVC to make use of this identity server as well um so just to give you an",
    "start": "750079",
    "end": "756880"
  },
  {
    "text": "idea and I apologize as well I couldn't get duplicate to work so I have to work from extend mode which is a little",
    "start": "756880",
    "end": "766320"
  },
  {
    "text": "tough I realize the solution Explorer is going to be a bit small and we have to restart this as well what I'm going to",
    "start": "770760",
    "end": "776839"
  },
  {
    "text": "do is I'm going to fire up each of the applications and I'm going to guide you through I'm just going to give you a quick demo of what it looks like to log",
    "start": "776839",
    "end": "783040"
  },
  {
    "text": "in um so I have an API uh project that I've just spun up I have an",
    "start": "783040",
    "end": "789000"
  },
  {
    "text": "authentication project which is just an NVC site with identity server inside of",
    "start": "789000",
    "end": "794440"
  },
  {
    "text": "it spin that up as well we can also spin up our",
    "start": "794440",
    "end": "800880"
  },
  {
    "text": "website and this will load so one thing you'll notice when it loads if we",
    "start": "802360",
    "end": "808120"
  },
  {
    "text": "get internet on this side as well one thing you'll notice when it",
    "start": "808120",
    "end": "813440"
  },
  {
    "text": "loads is uh we won't be logged in or we shouldn't be logged",
    "start": "813440",
    "end": "817959"
  },
  {
    "text": "in and um I'm using a pretty heavy build process so it does take a few minutes a",
    "start": "819000",
    "end": "824720"
  },
  {
    "text": "couple seconds to load now we uh probably shouldn't be logged in maybe we will be but what will happen is we'll",
    "start": "824720",
    "end": "830959"
  },
  {
    "text": "load up our main application our angular 2 website and immediately we'll be redirected to the authentication website",
    "start": "830959",
    "end": "837160"
  },
  {
    "text": "where It'll ask us to log in",
    "start": "837160",
    "end": "841040"
  },
  {
    "text": "as you can see lightning fast um and the point of this is uh",
    "start": "858079",
    "end": "865440"
  },
  {
    "text": "we'll log in we'll go across maybe we'll skip this step and wait for it to load up in the back ground oh no there we go",
    "start": "865440",
    "end": "870800"
  },
  {
    "text": "okay cool um I also have my database migrations and my seating of the",
    "start": "870800",
    "end": "876320"
  },
  {
    "text": "database on Startup as well so normally this would be spun up beforehand um but essentially what what has happened is",
    "start": "876320",
    "end": "882320"
  },
  {
    "text": "we've been um flicked over to our authentication server I'm going to log in using the",
    "start": "882320",
    "end": "889040"
  },
  {
    "text": "asp.net identity provider essentially uh and when I do so I'm redirected back to",
    "start": "889040",
    "end": "895279"
  },
  {
    "text": "my angular 2 application it loads up and it will uh start being able to use the",
    "start": "895279",
    "end": "902680"
  },
  {
    "text": "API so I can come over here to something like payers uh and it will load a list of",
    "start": "902680",
    "end": "907920"
  },
  {
    "text": "payers and there they are and we can come in here and see something work like that cool so we have our three",
    "start": "907920",
    "end": "914920"
  },
  {
    "text": "pieces we",
    "start": "914920",
    "end": "918199"
  },
  {
    "text": "have our three pieces here API identity server and angular 2",
    "start": "920199",
    "end": "925320"
  },
  {
    "text": "server um on Startup probably something won't realize it's happened is the API",
    "start": "925320",
    "end": "931480"
  },
  {
    "text": "project has gone and it's hit the identity server has downloaded the public key okay so every access token is",
    "start": "931480",
    "end": "938040"
  },
  {
    "text": "signed using a certificate and the public key is given to the API so that it can verify the tokens that it's",
    "start": "938040",
    "end": "944480"
  },
  {
    "text": "receiving from the angular 2 app so when a normal request comes in uh we tried to",
    "start": "944480",
    "end": "950040"
  },
  {
    "text": "go to the angular 2 website we weren't logged in so we get redirected over to Identity server token comes back once",
    "start": "950040",
    "end": "956920"
  },
  {
    "text": "we've successfully logged in we send that token up to the API with all of our requests and if we have access and",
    "start": "956920",
    "end": "964040"
  },
  {
    "text": "permission we will get the data back okay this is the general workflow of this uh particular bit and so now what",
    "start": "964040",
    "end": "971759"
  },
  {
    "text": "we're going to do is build these things so let's take a look",
    "start": "971759",
    "end": "981240"
  },
  {
    "text": "sorry okay cool so what we're going to do is we're going to start and we're just going to quickly add aspnet identity to our",
    "start": "981240",
    "end": "987920"
  },
  {
    "text": "project",
    "start": "987920",
    "end": "990920"
  },
  {
    "text": "okay so the thing you need to um uh know about this solution is that",
    "start": "993160",
    "end": "999319"
  },
  {
    "text": "the pinch. or and I know it's a little bit hard to see but we're in one MVC project here uh and this one is where",
    "start": "999319",
    "end": "1005839"
  },
  {
    "text": "we're going to add uh asp.net identity and also identity server so the first thing you want to do",
    "start": "1005839",
    "end": "1012720"
  },
  {
    "text": "is add your",
    "start": "1012720",
    "end": "1015480"
  },
  {
    "text": "packages",
    "start": "1017839",
    "end": "1020839"
  },
  {
    "text": "all right is that large enough for everyone to see at the back as well yep sweet um okay so the first thing we're",
    "start": "1024760",
    "end": "1029959"
  },
  {
    "text": "going to do is add our uh asp.net identity packages okay and that's these two guys here identity and Entity",
    "start": "1029959",
    "end": "1037000"
  },
  {
    "text": "framework core because we're going to be using Entity framework to connect everything together um so you add those two uh packages to your just a file new",
    "start": "1037000",
    "end": "1045360"
  },
  {
    "text": "project MVC application and then in startup you come down",
    "start": "1045360",
    "end": "1051360"
  },
  {
    "text": "here and you'll have to bear with me and look at this in stages um all we're doing is we're adding identity you've",
    "start": "1053880",
    "end": "1060640"
  },
  {
    "text": "got a few options that you can configure here I've toned down the password requirements for easier development Time",
    "start": "1060640",
    "end": "1065799"
  },
  {
    "text": "stuff um and the key bit is that we're adding The Entity framework stores and pointing it at pinch",
    "start": "1065799",
    "end": "1072080"
  },
  {
    "text": "context um so pinch context is just a regular database context that inherits",
    "start": "1072080",
    "end": "1077880"
  },
  {
    "text": "from uh identity DB context okay this can be empty uh the only thing you need",
    "start": "1077880",
    "end": "1083840"
  },
  {
    "text": "is the Constructor here um I've got a bunch of other tables in there but for now you don't need to worry about that",
    "start": "1083840",
    "end": "1090120"
  },
  {
    "text": "the identity DB context spins up all of the user tables and the RO tables and all those bits that are built in and the",
    "start": "1090120",
    "end": "1096960"
  },
  {
    "text": "only thing you do need to do is provide a user and if we look at our user class this is just a regular entity that",
    "start": "1096960",
    "end": "1104000"
  },
  {
    "text": "happens to inherit from Identity user that gives us the password and all those",
    "start": "1104000",
    "end": "1109360"
  },
  {
    "text": "columns but the user is just a basic class uh so we have our context and that",
    "start": "1109360",
    "end": "1116360"
  },
  {
    "text": "is pretty much all you need to do to add identity you can come down here to the uh configure",
    "start": "1116360",
    "end": "1122039"
  },
  {
    "text": "section and you just need to add use identity into your pipeline okay and it",
    "start": "1122039",
    "end": "1127240"
  },
  {
    "text": "has to be above MVC for those of you who don't know because this pipeline is executed in order MVC has to be at the",
    "start": "1127240",
    "end": "1135280"
  },
  {
    "text": "bottom um Okay so the other thing you'll need from that um is the controllers and",
    "start": "1135280",
    "end": "1144360"
  },
  {
    "text": "the views for things like login register and all that kind of thing now if you go file new project MVC project and you",
    "start": "1144360",
    "end": "1150840"
  },
  {
    "text": "pick uh individual accounts for authentication you'll get given these things uh we're going to change them in",
    "start": "1150840",
    "end": "1156760"
  },
  {
    "text": "a minute anyway so really all you need to do is those couple of bits um from a blank project and you and you'll be",
    "start": "1156760",
    "end": "1162520"
  },
  {
    "text": "ready to go because what we'll do next is the next slide We'll add identity",
    "start": "1162520",
    "end": "1168240"
  },
  {
    "text": "server to this blank empty MVC",
    "start": "1168240",
    "end": "1173440"
  },
  {
    "text": "project so starting in the same vein we need to add a few more packages",
    "start": "1174480",
    "end": "1180760"
  },
  {
    "text": "again we're still in the same MVC project here uh we're going to need to add identity server",
    "start": "1180760",
    "end": "1187120"
  },
  {
    "text": "4 as a package the base package and then if you look at the top here we've also",
    "start": "1187120",
    "end": "1192320"
  },
  {
    "text": "adding identity server 4. Entity framework and identity server 4. ASP",
    "start": "1192320",
    "end": "1197640"
  },
  {
    "text": "identity and this just makes it really easy to use Entity framework and connect it to our asp.net identity provider okay",
    "start": "1197640",
    "end": "1203840"
  },
  {
    "text": "it handles pretty much most of it four of us back into our startup uh class and",
    "start": "1203840",
    "end": "1210000"
  },
  {
    "text": "we'll just go back up to where we were here um you can see that I'm adding the",
    "start": "1210000",
    "end": "1215720"
  },
  {
    "text": "database context um in the typical built-in asp.net core way you might",
    "start": "1215720",
    "end": "1221120"
  },
  {
    "text": "notice that I've got my migrations assembly reference there as well and we we'll talk about migrations in just a",
    "start": "1221120",
    "end": "1227640"
  },
  {
    "text": "second um what we need to do is Skip ad identity we've got MVC in there that's",
    "start": "1227640",
    "end": "1234520"
  },
  {
    "text": "all built in um what we need to do is this uh services. add identity server",
    "start": "1234520",
    "end": "1240400"
  },
  {
    "text": "here uh and it's very similar to add identity okay just move that up um we've got some",
    "start": "1240400",
    "end": "1248320"
  },
  {
    "text": "options that we can change I've changed the login and logout URL uh importantly we adding a signing certificate we're",
    "start": "1248320",
    "end": "1254720"
  },
  {
    "text": "adding two configuration store uh two database context essentially and we're",
    "start": "1254720",
    "end": "1260440"
  },
  {
    "text": "telling it to use the user table so three really important points here",
    "start": "1260440",
    "end": "1265919"
  },
  {
    "text": "starting with the certificate now as I mentioned before",
    "start": "1265919",
    "end": "1271120"
  },
  {
    "text": "whenever identity server generates a token it's signing that token using a certificate and you have the option",
    "start": "1271120",
    "end": "1277600"
  },
  {
    "text": "during development time if you'd like uh to come in here and go add a developer",
    "start": "1277600",
    "end": "1283200"
  },
  {
    "text": "credential add develop a signing credential and that just generates a little key pair um and it's tempting to",
    "start": "1283200",
    "end": "1288600"
  },
  {
    "text": "use this from the beginning just to get up and running um but what I'm here to tell you is that it's probably not a",
    "start": "1288600",
    "end": "1293720"
  },
  {
    "text": "good idea because you can't deploy it anywhere it's not going to work on Azure or anything like that um and it's pretty",
    "start": "1293720",
    "end": "1299000"
  },
  {
    "text": "easy just to make aert and you know do it properly um so you may as well do that and so to do that we've got this",
    "start": "1299000",
    "end": "1306440"
  },
  {
    "text": "bit of code above us uh and what we're doing here is we're loading a certificate from the registry",
    "start": "1306440",
    "end": "1313600"
  },
  {
    "text": "it happens to be the store name I and the store location current user and the reason for this is that this is where",
    "start": "1313600",
    "end": "1319080"
  },
  {
    "text": "Azure places its certificates so all of my stuff's in Azure and I like it to work that way so to load certificates um",
    "start": "1319080",
    "end": "1327120"
  },
  {
    "text": "I'll give you a link to this code in fact what I will",
    "start": "1327120",
    "end": "1332278"
  },
  {
    "text": "do if you just search Ben car blog or even just creating an entity or",
    "start": "1335320",
    "end": "1340679"
  },
  {
    "text": "something like that um my latest post is how to do this okay how to create a",
    "start": "1340679",
    "end": "1346000"
  },
  {
    "text": "certificate how to uh register it without Azure and here's that exact same code we just saw",
    "start": "1346000",
    "end": "1352039"
  },
  {
    "text": "before um and how to use it with Azure app Services because there is something you",
    "start": "1352039",
    "end": "1357400"
  },
  {
    "text": "need to do um so the easiest thing to do there is just Google benal Blog um",
    "start": "1357400",
    "end": "1363480"
  },
  {
    "text": "or ben.com there's there's a bunch of ways to find this you could also just Google creating a science",
    "start": "1363480",
    "end": "1369799"
  },
  {
    "text": "certificate um but the the end the end part of that goal is we load the certificate and we pass it into identity",
    "start": "1369919",
    "end": "1377000"
  },
  {
    "text": "server um the next thing I want to show you the next thing I want to point out cuz again this is kind of not really in",
    "start": "1377000",
    "end": "1383320"
  },
  {
    "text": "the documentation either is how to do EF migrations with multiple DB contexts um",
    "start": "1383320",
    "end": "1388880"
  },
  {
    "text": "because that was a little bit tricky to set up um has anyone here done if oh who uses Entity framework to start okay it's",
    "start": "1388880",
    "end": "1396240"
  },
  {
    "text": "the bulk of the room who uses energy framework migrations with ef core I guess you have to these days and uh who",
    "start": "1396240",
    "end": "1402320"
  },
  {
    "text": "is used multiple contexts with ef migrations before perfect that was no one that's",
    "start": "1402320",
    "end": "1408520"
  },
  {
    "text": "what I like to see so you'll have to with this um and it's not too bad you'll notice I'm pointing all of my databases",
    "start": "1408520",
    "end": "1415480"
  },
  {
    "text": "to the same sorry all of my connection strings the same database um because I just prefer to have it all in one spot",
    "start": "1415480",
    "end": "1420760"
  },
  {
    "text": "especially in Azure it's cheaper um and it uh brings it together easier so if",
    "start": "1420760",
    "end": "1426240"
  },
  {
    "text": "you look at my data project um I've also got a blog post on",
    "start": "1426240",
    "end": "1431360"
  },
  {
    "text": "how to do this as well so I'll leave that for the blog post but essentially what happens is you have a stand standard um",
    "start": "1431360",
    "end": "1440000"
  },
  {
    "text": "sorry a net standard class Library okay this is what my data project is and",
    "start": "1440000",
    "end": "1445799"
  },
  {
    "text": "inside that you reference Entity framework and such and what you need to do is add",
    "start": "1445799",
    "end": "1453159"
  },
  {
    "text": "something called a temporary DB context Factory okay so the tooling isn't quite",
    "start": "1453159",
    "end": "1458320"
  },
  {
    "text": "there yet to understand how your application spins up so it knows what the database status is so it knows how",
    "start": "1458320",
    "end": "1464279"
  },
  {
    "text": "to connect into all that kind of stuff so what you do is you add this particular uh DB context Factory just",
    "start": "1464279",
    "end": "1470120"
  },
  {
    "text": "pointing to my development copy of my database and that way when I run netf",
    "start": "1470120",
    "end": "1475600"
  },
  {
    "text": "migrations uh it knows where to find the database and I've done that not only for",
    "start": "1475600",
    "end": "1481440"
  },
  {
    "text": "my applications context but also for the two contexts that identity server",
    "start": "1481440",
    "end": "1488799"
  },
  {
    "text": "requires okay they all just it's all just the same code and again if you go back it's just the",
    "start": "1488799",
    "end": "1496039"
  },
  {
    "text": "second one here Entity framework core migrations Visual Studio 2017 uh and that will show you how to set up",
    "start": "1496039",
    "end": "1501360"
  },
  {
    "text": "multiple contexts but essentially all you do is once you've got that uh temporary database context Factory um",
    "start": "1501360",
    "end": "1508720"
  },
  {
    "text": "you just call and I'll just show you very",
    "start": "1508720",
    "end": "1514600"
  },
  {
    "text": "briefly um on your data project you go net EF migrations add you know my",
    "start": "1527320",
    "end": "1533799"
  },
  {
    "text": "migration uh you give it the context name pinch context okay uh and that is",
    "start": "1533799",
    "end": "1540760"
  },
  {
    "text": "going to add the migration for your own application and you do that first and then second you come along and you just",
    "start": "1540760",
    "end": "1547559"
  },
  {
    "text": "put in the uh configuration DB context or whatever the context name is that you",
    "start": "1547559",
    "end": "1553279"
  },
  {
    "text": "have in your database here what is it called persisted Grant DB context and",
    "start": "1553279",
    "end": "1560240"
  },
  {
    "text": "configuration DB context and what that does is it spins up the migration for",
    "start": "1560240",
    "end": "1565520"
  },
  {
    "text": "the tables that identity server users you can kind of see I apologize for the size you can kind of see at the top",
    "start": "1565520",
    "end": "1570600"
  },
  {
    "text": "right there that it's made two folders for these things and they just have one migration in them at the moment because",
    "start": "1570600",
    "end": "1575760"
  },
  {
    "text": "identity server hasn't changed its data database structure yet okay as of",
    "start": "1575760",
    "end": "1581919"
  },
  {
    "text": "1.0 um but that's an important tip is getting all your migrations set",
    "start": "1582159",
    "end": "1587240"
  },
  {
    "text": "up and probably what I'll also show you just as a bit of a",
    "start": "1587240",
    "end": "1594799"
  },
  {
    "text": "bonus um for starters we needed to add",
    "start": "1594799",
    "end": "1600880"
  },
  {
    "text": "identity server and to the bottom of our authentication project startup class it",
    "start": "1600880",
    "end": "1606120"
  },
  {
    "text": "needs to go below identity because it relies on some stuff in identity and it needs to go above MVC because it",
    "start": "1606120",
    "end": "1611399"
  },
  {
    "text": "protects MVC um and the the bonus tip here is just this migration and seeding of the",
    "start": "1611399",
    "end": "1618799"
  },
  {
    "text": "database so there's a bunch of different ways to do this my preferred way to uh",
    "start": "1618799",
    "end": "1623919"
  },
  {
    "text": "migrate and SE a database is to place the migration and seaing code in the configure in the pipeline um part of the",
    "start": "1623919",
    "end": "1632039"
  },
  {
    "text": "startup class because this will one run sorry this will run once per startup uh",
    "start": "1632039",
    "end": "1637520"
  },
  {
    "text": "and the caveat is that if you've got asynchronous code uh it needs to run synchronously okay if you try to it will",
    "start": "1637520",
    "end": "1644919"
  },
  {
    "text": "function if you run it asynchronously if you use a we but it will actually break things so uh use the the get a waiter um",
    "start": "1644919",
    "end": "1652840"
  },
  {
    "text": "on the end of your seating stuff beautiful Okay cool so that's",
    "start": "1652840",
    "end": "1660640"
  },
  {
    "text": "technically all we need to do to get identity server slipped into our application okay the next thing we need",
    "start": "1660640",
    "end": "1666880"
  },
  {
    "text": "to do is understand our architecture and we need to start configuring you know",
    "start": "1666880",
    "end": "1672000"
  },
  {
    "text": "our identity server to understand our environment and our",
    "start": "1672000",
    "end": "1677120"
  },
  {
    "text": "architecture so the key things",
    "start": "1677120",
    "end": "1683080"
  },
  {
    "text": "there are",
    "start": "1683080",
    "end": "1686679"
  },
  {
    "text": "our um we'll start with resources okay",
    "start": "1690480",
    "end": "1695600"
  },
  {
    "text": "um for those of you who haven't used identity server there are two types of resources that it protects information",
    "start": "1695600",
    "end": "1702080"
  },
  {
    "text": "and an API resource okay so information or identity resources is just",
    "start": "1702080",
    "end": "1707240"
  },
  {
    "text": "information about a user so in this case I've got things like their username basic profile information and email",
    "start": "1707240",
    "end": "1713760"
  },
  {
    "text": "address uh importantly I've got a custom identity resource uh in my",
    "start": "1713760",
    "end": "1721000"
  },
  {
    "text": "application uh everyone who signs up to the website is",
    "start": "1721000",
    "end": "1726679"
  },
  {
    "text": "a um everyone who signs up to the website is is a merchant okay uh and",
    "start": "1729480",
    "end": "1734880"
  },
  {
    "text": "this is the information about that Merchant that I want to protect or I want to give out for example uh and you",
    "start": "1734880",
    "end": "1740600"
  },
  {
    "text": "can see in the user claim section here this is the stuff I want to give out just some IDs and some names so they",
    "start": "1740600",
    "end": "1746679"
  },
  {
    "text": "don't have to keep looking it up out of the database every time it's just embedded in the token um so that's the identity",
    "start": "1746679",
    "end": "1753159"
  },
  {
    "text": "resources the API resources uh our API",
    "start": "1753159",
    "end": "1758200"
  },
  {
    "text": "1 uh this is in our earlier diagram this is the API I want to protect the other",
    "start": "1758200",
    "end": "1764000"
  },
  {
    "text": "project it's just the configuration of it so I've called it API 1 uh it's it's got a secret forget the",
    "start": "1764000",
    "end": "1770399"
  },
  {
    "text": "secret it's got some user claims uh these are just things that I want embedded in the access token when you",
    "start": "1770399",
    "end": "1776679"
  },
  {
    "text": "ask for this API and it's got some Scopes now Scopes is more of an O uh",
    "start": "1776679",
    "end": "1783200"
  },
  {
    "text": "idea and the thing you need to know here is that you've got a create a scope with the same name as your API don't worry",
    "start": "1783200",
    "end": "1789159"
  },
  {
    "text": "that's in the documentation so that's okay uh and something special I've also added is a secondary scope okay so this",
    "start": "1789159",
    "end": "1797279"
  },
  {
    "text": "holds uh or this gives you access to a Slither of my API that I only want certain people to have so uh all third",
    "start": "1797279",
    "end": "1805679"
  },
  {
    "text": "party developers can have everything else but only my angular 2 portal has access to the API keys because I don't",
    "start": "1805679",
    "end": "1812080"
  },
  {
    "text": "want my third party developers just taking the keys from the customers they have access to and so oh I've also got a second API",
    "start": "1812080",
    "end": "1820159"
  },
  {
    "text": "but we we won't look at that that's okay um so now that we have our resources okay we've mapped out uh",
    "start": "1820159",
    "end": "1826880"
  },
  {
    "text": "logically what we want to protect the next thing we need to do is add the configuration uh for our clients okay so",
    "start": "1826880",
    "end": "1834399"
  },
  {
    "text": "these are things that want to connect to our API so in my case the the main",
    "start": "1834399",
    "end": "1841279"
  },
  {
    "text": "client is my angular 2 application and we'll take a look at",
    "start": "1841279",
    "end": "1849000"
  },
  {
    "text": "its configuration",
    "start": "1849000",
    "end": "1854159"
  },
  {
    "text": "here okay so when you've got a client um",
    "start": "1854240",
    "end": "1859399"
  },
  {
    "text": "my main one is the angular 2 application so any client though that tries to connect to your API and it tries to go",
    "start": "1859399",
    "end": "1865360"
  },
  {
    "text": "through identity server uh we'll go through this client store and this is kind of this is the stuff that's not",
    "start": "1865360",
    "end": "1870559"
  },
  {
    "text": "quite in the documentation or not widely available anyway um and this is my preferred way of implementing the client",
    "start": "1870559",
    "end": "1878000"
  },
  {
    "text": "store okay rather than using the database for everything I kind of have a hybrid bit here um so a client will",
    "start": "1878000",
    "end": "1883399"
  },
  {
    "text": "Connect using their client ID in my case it's pinch web uh for the angular 2",
    "start": "1883399",
    "end": "1888600"
  },
  {
    "text": "portal it's pinch web anyway and if we go and we take a look at the configuration of that",
    "start": "1888600",
    "end": "1895279"
  },
  {
    "text": "client okay let's have a look here you can see I've got a bunch of different properties the important ones here uh",
    "start": "1895279",
    "end": "1901919"
  },
  {
    "text": "that I set the URI so I know information has to come from that website um require",
    "start": "1901919",
    "end": "1908159"
  },
  {
    "text": "consent is false okay I don't need to ask users whether or not my portal can access my data okay it's got implied",
    "start": "1908159",
    "end": "1915240"
  },
  {
    "text": "consent um it's got allow offline access which lets you ask for a refresh token",
    "start": "1915240",
    "end": "1921080"
  },
  {
    "text": "and then refresh your access tokens over and over and over um it has a secret to prove who I",
    "start": "1921080",
    "end": "1928080"
  },
  {
    "text": "am so this is the the string you would need to pass in to say yep you definitely are my",
    "start": "1928080",
    "end": "1934039"
  },
  {
    "text": "application um and importantly here we have allowed Scopes now allowed",
    "start": "1934039",
    "end": "1940960"
  },
  {
    "text": "Scopes you can see here I'm asking for the identity information I was protecting earlier and I'm also asking",
    "start": "1940960",
    "end": "1947559"
  },
  {
    "text": "for API 1 Merchant which is some identity information and Merchant API Keys okay so uh sorry I'm not asking for",
    "start": "1947559",
    "end": "1955480"
  },
  {
    "text": "it I'm allowing that client access to that scope okay so this is how you",
    "start": "1955480",
    "end": "1960760"
  },
  {
    "text": "protect certain parts of your API uh is through this allowed Scopes this client",
    "start": "1960760",
    "end": "1966039"
  },
  {
    "text": "can uh can access that one and we'll contrast that now to what a third party developer client looks",
    "start": "1966039",
    "end": "1973440"
  },
  {
    "text": "like now just as a quick",
    "start": "1973440",
    "end": "1979799"
  },
  {
    "text": "um just as a quick sort of context um",
    "start": "1979799",
    "end": "1984919"
  },
  {
    "text": "thing whenever you sign up for an account I generate uh a merchant ID and",
    "start": "1984919",
    "end": "1990240"
  },
  {
    "text": "a few keys right and this is just strings I've made up I'm just saving in my Merchant table okay there's nothing",
    "start": "1990240",
    "end": "1995360"
  },
  {
    "text": "special about any of this um but that merchant ID and that secret key are what",
    "start": "1995360",
    "end": "2000799"
  },
  {
    "text": "are provided to Identity server to identify this client so if I'm a third party developer building a system and I",
    "start": "2000799",
    "end": "2007240"
  },
  {
    "text": "want to use my API um this is the configuration that they will get so we'll come back up to",
    "start": "2007240",
    "end": "2013919"
  },
  {
    "text": "our client store the client ID that comes in will be that Merchant uh merchant ID that I've saved in my",
    "start": "2013919",
    "end": "2020760"
  },
  {
    "text": "database so it's not going to be any of the ones I know like I hard code know about it's something from the database",
    "start": "2020760",
    "end": "2027279"
  },
  {
    "text": "so I look up the merchants table and I go okay do are there any Merchants with a merchant ID of this one and if there",
    "start": "2027279",
    "end": "2034480"
  },
  {
    "text": "are I get the configuration like so given the merchant from the database by",
    "start": "2034480",
    "end": "2039679"
  },
  {
    "text": "the way uh and what I can do is set up a client I can give it its name from the database whether or not it's enabled so",
    "start": "2039679",
    "end": "2046360"
  },
  {
    "text": "you can trigger that uh at this point if you'd like to uh important things here are the client Secrets is just the",
    "start": "2046360",
    "end": "2052599"
  },
  {
    "text": "secret key from the database again so that's how they prove who they are using that secret key um you can see here in",
    "start": "2052599",
    "end": "2060200"
  },
  {
    "text": "the allowed Scopes they're allowed everything except the merchant information and the API Keys scope as",
    "start": "2060200",
    "end": "2066520"
  },
  {
    "text": "well so if they try to request reest it they'll be denied and they don't have access to that",
    "start": "2066520",
    "end": "2072440"
  },
  {
    "text": "area okay and I'm also embeding a few claims in here as well and this is uh just a convenience thing I'll talk about",
    "start": "2074280",
    "end": "2079960"
  },
  {
    "text": "quickly um I've got some data I don't want to look up every time and I want to embed it in the token you got to be",
    "start": "2079960",
    "end": "2085878"
  },
  {
    "text": "careful not to do this too much otherwise it'll you know be too large of a token um but this is just stuff like",
    "start": "2085879",
    "end": "2091679"
  },
  {
    "text": "their merchant ID a couple of internal IDs and um whether or not they have permission to use the live system it's",
    "start": "2091679",
    "end": "2097480"
  },
  {
    "text": "just information that the client might like to know about the user using",
    "start": "2097480",
    "end": "2103240"
  },
  {
    "text": "it cool so what we'll do",
    "start": "2104240",
    "end": "2109320"
  },
  {
    "text": "now is we will jump over to looking at how to",
    "start": "2109320",
    "end": "2116160"
  },
  {
    "text": "protect our API I think first we'll do",
    "start": "2116160",
    "end": "2121480"
  },
  {
    "text": "that okay so by this time um what have we done we've set up identity server",
    "start": "2121480",
    "end": "2127119"
  },
  {
    "text": "it's just a regular MVC website we put our identity server in there we've configured it into the pipeline we've",
    "start": "2127119",
    "end": "2132359"
  },
  {
    "text": "added the uh the resources that we wanted to protect and we've gone ahead",
    "start": "2132359",
    "end": "2138280"
  },
  {
    "text": "and set up our client configuration so that we uh can get third party developers in there as well so what we",
    "start": "2138280",
    "end": "2144280"
  },
  {
    "text": "need to look at now is how to protect the API itself and this is relatively straightforward to be honest so um we",
    "start": "2144280",
    "end": "2150680"
  },
  {
    "text": "can go in and add the package for Access token validation identity",
    "start": "2150680",
    "end": "2157920"
  },
  {
    "text": "server 4 might be a bit low access token validation uh and this is what we're going to put into our pipeline to read",
    "start": "2157920",
    "end": "2164640"
  },
  {
    "text": "the tokens that we get given so if we look at startup in our",
    "start": "2164640",
    "end": "2170520"
  },
  {
    "text": "API and we'll come down to we'll go past the MVC",
    "start": "2170520",
    "end": "2177079"
  },
  {
    "text": "bits and we'll come down to our pipeline so you can see here again I use the API to migrate my data so this is the",
    "start": "2177079",
    "end": "2183760"
  },
  {
    "text": "project I've chosen to kick off the migrations um I've got cores in there so everyone can use it um even JavaScript",
    "start": "2183760",
    "end": "2191319"
  },
  {
    "text": "uh libraries uh and the thing we need to look at is identity server authentication so uh in the authority",
    "start": "2191319",
    "end": "2199319"
  },
  {
    "text": "that's just pointing to our identity server URL so it knows where to go uh we've got require htps yep enable cing I",
    "start": "2199319",
    "end": "2206560"
  },
  {
    "text": "don't have a cing provider so I haven't done that and importantly I'm identifying myself as API 1 and here's",
    "start": "2206560",
    "end": "2211839"
  },
  {
    "text": "my secret uh and once you've done that if we look at just like a control",
    "start": "2211839",
    "end": "2218520"
  },
  {
    "text": "let's just pick this one for example all you need is authorize okay and all the",
    "start": "2218520",
    "end": "2223800"
  },
  {
    "text": "internal mechanisms kick in at this point uh and they'll make sure that everything is correct okay so if you're",
    "start": "2223800",
    "end": "2229520"
  },
  {
    "text": "uh in an API setting and you're using a token uh and you don't have permission to use this uh particular class it'll",
    "start": "2229520",
    "end": "2236800"
  },
  {
    "text": "kick back a 403 um if you don't have a token at all it'll kick back a 401 uh and essentially the cool thing",
    "start": "2236800",
    "end": "2245160"
  },
  {
    "text": "about this as well is is here's that API Keys method right it's just in the same",
    "start": "2245160",
    "end": "2251319"
  },
  {
    "text": "class I've the only thing I've added differently here is the uh policy Merchant API keys and this is what",
    "start": "2251319",
    "end": "2256960"
  },
  {
    "text": "protects this particular method if we look back at our startup for the",
    "start": "2256960",
    "end": "2262640"
  },
  {
    "text": "API just back up here in the authorization section we have a thing called add",
    "start": "2262640",
    "end": "2268760"
  },
  {
    "text": "authorization and we add a policy Merchant API Keys all you have to have",
    "start": "2268760",
    "end": "2274240"
  },
  {
    "text": "is a claim of scope Merchant API Keys which will'll only be given if you have",
    "start": "2274240",
    "end": "2280560"
  },
  {
    "text": "permission so therefore only my client the angular 2 application can access",
    "start": "2280560",
    "end": "2285599"
  },
  {
    "text": "that endpoint uh and regular third party developers",
    "start": "2285599",
    "end": "2290920"
  },
  {
    "text": "can't beautiful okay now we can dig into some of the angular 2 stuff and how that's set up uh this is a little bit",
    "start": "2293440",
    "end": "2300440"
  },
  {
    "text": "more complex and a little bit more controversial to be honest as well so as",
    "start": "2300440",
    "end": "2305480"
  },
  {
    "text": "I mentioned before all of my application are running in net core and including my",
    "start": "2305480",
    "end": "2311079"
  },
  {
    "text": "angular 2 application so if we take a look at the",
    "start": "2311079",
    "end": "2316680"
  },
  {
    "text": "startup class again I just went final new project MVC uh and added my angular to",
    "start": "2316680",
    "end": "2323560"
  },
  {
    "text": "application to this uh project if we come down to the pipeline of this",
    "start": "2323560",
    "end": "2329200"
  },
  {
    "text": "guy um you'll see what we need to do to protect um our angular 2 app okay and",
    "start": "2329200",
    "end": "2335920"
  },
  {
    "text": "I'll also show you how the angular stuff is hooked up as well um so the first thing we need to do is we're using uh a",
    "start": "2335920",
    "end": "2343440"
  },
  {
    "text": "slightly different uh authentication mechanism this time we're not using the uh identity server authorization one",
    "start": "2343440",
    "end": "2350280"
  },
  {
    "text": "that we had on our API instead we're using oidc connect uh to identify ourselves from our angular 2",
    "start": "2350280",
    "end": "2357640"
  },
  {
    "text": "application um you have to put that line in but don't worry about it it's in the doco uh things to look at here and",
    "start": "2357640",
    "end": "2364160"
  },
  {
    "text": "things that are interesting uh I've got a rebound on the pipeline",
    "start": "2364160",
    "end": "2370560"
  },
  {
    "text": "here uh who's who's using angular 2 actually I wonder how much I need to explain yep okay cool uh that's about",
    "start": "2370560",
    "end": "2377359"
  },
  {
    "text": "quarter of the room the thing with angular 2 is when you um it's a single",
    "start": "2377359",
    "end": "2383440"
  },
  {
    "text": "page application okay so the only endpoint I have in this MVC website is home Index right all traffic goes to",
    "start": "2383440",
    "end": "2390880"
  },
  {
    "text": "there and that home index boots up my angular 2 application now what happens",
    "start": "2390880",
    "end": "2396400"
  },
  {
    "text": "when I go into it I'll show you this actually it'll be easier to",
    "start": "2396400",
    "end": "2401599"
  },
  {
    "text": "visualize what happens when you actually go in and navigate around um we're just",
    "start": "2402200",
    "end": "2408400"
  },
  {
    "text": "you know it's just all onepage application we're loaded we're not doing any post backs um but our URL and again",
    "start": "2408400",
    "end": "2413440"
  },
  {
    "text": "it's a bit hard to see is changing as we go around okay so what happens when I",
    "start": "2413440",
    "end": "2419000"
  },
  {
    "text": "just go and request that URL you'll see that we are put back in",
    "start": "2419000",
    "end": "2426000"
  },
  {
    "text": "the right place okay okay now the way that works is with this rebound stuff because the request comes in and it's to",
    "start": "2426000",
    "end": "2433119"
  },
  {
    "text": "payers slum identifier okay and this piece of",
    "start": "2433119",
    "end": "2438400"
  },
  {
    "text": "middleware here on the way in for the request it skips it says okay I don't need to do anything on the way in so",
    "start": "2438400",
    "end": "2444040"
  },
  {
    "text": "that's that await next next what it does is it goes all the way down the pipeline all the way through our file servers and",
    "start": "2444040",
    "end": "2450400"
  },
  {
    "text": "through down to MVC and then back up okay and if if it hasn't been found by the file servers so there's no static",
    "start": "2450400",
    "end": "2456880"
  },
  {
    "text": "files conserve and in our case payers ID is not a file it's just a URL so then it",
    "start": "2456880",
    "end": "2462960"
  },
  {
    "text": "makes its way down to MVC and MVC goes oh I don't have a I don't have a payers controller that doesn't exist um 404 I",
    "start": "2462960",
    "end": "2470079"
  },
  {
    "text": "can't find that so it comes all the way back up the pipeline and this thing here goes okay if we get a 404 from both the",
    "start": "2470079",
    "end": "2475839"
  },
  {
    "text": "file servers and the MVC side and the path doesn't have an extension so it's",
    "start": "2475839",
    "end": "2481119"
  },
  {
    "text": "probably not a missing file then what I want you to do is change the request path back to",
    "start": "2481119",
    "end": "2486240"
  },
  {
    "text": "root set the status code to 200 and push it back down the pipeline again so we've got a second a wait next there and that",
    "start": "2486240",
    "end": "2493760"
  },
  {
    "text": "pushes it back down file servers go no root I don't have a file called you know just slash um MVC goes ah home index",
    "start": "2493760",
    "end": "2501240"
  },
  {
    "text": "that's linked to root here's home index and so home index is rendered which",
    "start": "2501240",
    "end": "2506560"
  },
  {
    "text": "boots up my angular 2 application uh and then the URL though in the browser stays the same CU it doesn't know that all",
    "start": "2506560",
    "end": "2513200"
  },
  {
    "text": "this happened it just went I want this and it said here it is and so angular 2 who picks up that URL and says Ah I have",
    "start": "2513200",
    "end": "2519560"
  },
  {
    "text": "a route for this payers SL something I'm going to load that page up and that's why we are given the right response",
    "start": "2519560",
    "end": "2526319"
  },
  {
    "text": "essentially and just to show you the rest of the pipeline here you can see",
    "start": "2526319",
    "end": "2531400"
  },
  {
    "text": "I'm using uh the Ed file server so that just creates ww root and serves every file in there I've got a second use file",
    "start": "2531400",
    "end": "2538960"
  },
  {
    "text": "server for my node modules okay so there are a few node modules that I need to uh expose as well uh and because they're in",
    "start": "2538960",
    "end": "2546079"
  },
  {
    "text": "the path SL node modules but physically on the project the one folder up so you",
    "start": "2546079",
    "end": "2551640"
  },
  {
    "text": "need to add a second one of these to expose it properly um so that covers all the static files and most of the angular",
    "start": "2551640",
    "end": "2557960"
  },
  {
    "text": "2 application um we use cookie or because you have to the oidc stuff um",
    "start": "2557960",
    "end": "2566119"
  },
  {
    "text": "all the tokens that we receive from Identity server and that are stored in the cookie in this particular",
    "start": "2566119",
    "end": "2572160"
  },
  {
    "text": "application um uh so we do need to we do need to add cookie Authentication and",
    "start": "2572160",
    "end": "2577400"
  },
  {
    "text": "you'll see here right below it we reference that cookie so we're telling it where to store the tokens when we receive them uh we're using",
    "start": "2577400",
    "end": "2585480"
  },
  {
    "text": "oidc and the important things here are again you'll see this everywhere Authority is our identity server so we",
    "start": "2585480",
    "end": "2591839"
  },
  {
    "text": "pass it that URL um we say which client we are and we",
    "start": "2591839",
    "end": "2597640"
  },
  {
    "text": "prove it using our secret in our case we're using code and token um so we're using a hybrid flow I",
    "start": "2597640",
    "end": "2606040"
  },
  {
    "text": "don't have time to get into that one um but essentially we're just requesting tokens uh we're saving those tokens into",
    "start": "2606040",
    "end": "2611280"
  },
  {
    "text": "the cookie and that's really it basically just pointed to that kind of stuff and just below here so all this",
    "start": "2611280",
    "end": "2618440"
  },
  {
    "text": "was doing was setting up a a variable and just below it here's where we request what we want okay so we're in",
    "start": "2618440",
    "end": "2626000"
  },
  {
    "text": "our angular 2 portal right now we're saying please give me these Scopes and you'll see Merchant API keys there and",
    "start": "2626000",
    "end": "2632359"
  },
  {
    "text": "offline access as well which is important so we can get our refresh token um and we will be allowed because",
    "start": "2632359",
    "end": "2638160"
  },
  {
    "text": "we've proven that we are pinch web that special client and we've given it our key so that we definitely know who we",
    "start": "2638160",
    "end": "2647440"
  },
  {
    "text": "are all right so I will also just show you",
    "start": "2647680",
    "end": "2652800"
  },
  {
    "text": "briefly the home controller the way we protect our MVC application is exactly",
    "start": "2652880",
    "end": "2659920"
  },
  {
    "text": "the same authorise just at the top that's it and that's going to handle the uh request coming in going oh you're not",
    "start": "2659920",
    "end": "2667119"
  },
  {
    "text": "authenticated kicking you over to the identity server to log in uh logging you in kicking you back taking the token",
    "start": "2667119",
    "end": "2673559"
  },
  {
    "text": "from the response and then passing it down to your application which is the next place I",
    "start": "2673559",
    "end": "2680280"
  },
  {
    "text": "want to show you um so all the steps I've just shown you",
    "start": "2680280",
    "end": "2686160"
  },
  {
    "text": "here are just how to secure an MVC website okay there's nothing special to angular yet um you could do that just",
    "start": "2686160",
    "end": "2692040"
  },
  {
    "text": "for regular NVC sites and you'd be done actually by now which is great um but when you want to embed angular to in NVC",
    "start": "2692040",
    "end": "2697760"
  },
  {
    "text": "website you got to do one more or a few more things and what we'll do is go through that um gu the best way is to start with",
    "start": "2697760",
    "end": "2705880"
  },
  {
    "text": "home index so home index is the only endpoint basically and you can see a couple others but they're not used um",
    "start": "2705880",
    "end": "2713040"
  },
  {
    "text": "inside home index is the familiar what you'd normally put into an index HTML okay",
    "start": "2713040",
    "end": "2718640"
  },
  {
    "text": "it's just the root of our application um nothing really special there I won't dive too deep into how angular works but",
    "start": "2718640",
    "end": "2726119"
  },
  {
    "text": "what we will look at is the layout file for home",
    "start": "2726119",
    "end": "2732440"
  },
  {
    "text": "index uh so the important part is and I'll just give you a brief look at the whole file just so you've got some",
    "start": "2732440",
    "end": "2738119"
  },
  {
    "text": "context there uh all we're really doing is loading a bunch of CSS uh loading a few node modules bits",
    "start": "2738119",
    "end": "2744839"
  },
  {
    "text": "that I needed rendering the body there and then loading all of the scripts that I need as well as bootstrapping the",
    "start": "2744839",
    "end": "2753440"
  },
  {
    "text": "application now this is this is the bootstrapping here um I guess one of the upsides and maybe",
    "start": "2753440",
    "end": "2761119"
  },
  {
    "text": "downsides as well uh is I'm using systemjs to boot my angular 2",
    "start": "2761119",
    "end": "2766280"
  },
  {
    "text": "application okay and it's a bit of last year's technology these days everyone's using webpack and the angular CLI to",
    "start": "2766280",
    "end": "2772680"
  },
  {
    "text": "build their applications but I'm not really a fan of how you then are taken out of uh visual studio and you need to",
    "start": "2772680",
    "end": "2780000"
  },
  {
    "text": "use the node web server uh and let webpack do its magic I like a little bit more explicit uh control over these",
    "start": "2780000",
    "end": "2787280"
  },
  {
    "text": "things um and so I'm sticking to systemjs because I can control everything through gulp uh including",
    "start": "2787280",
    "end": "2792760"
  },
  {
    "text": "bundling and minification and all that kind of stuff you explicitly write it and whether that's a bonus for you or a",
    "start": "2792760",
    "end": "2797839"
  },
  {
    "text": "detriment that's up to you um but one thing I can do and I'm quite happy about I'm just control F5 in my MVC project",
    "start": "2797839",
    "end": "2804599"
  },
  {
    "text": "and it all just works uh and given the power of a backend if I need to do something like uh for Facebook sharing",
    "start": "2804599",
    "end": "2811880"
  },
  {
    "text": "you need to render straight HTML you can't give out JavaScript it won't accept it uh and so I can catch things",
    "start": "2811880",
    "end": "2818000"
  },
  {
    "text": "like that and I've got a powerful back end that can then deliver something else other than the app if I need to um",
    "start": "2818000",
    "end": "2823960"
  },
  {
    "text": "there's a bit of an aside basically what we're doing here is booting the angular 2 application so at development time I'm",
    "start": "2823960",
    "end": "2831079"
  },
  {
    "text": "using a non-bundled version of the app and at production time I'm using a bundled version of the app so it's much",
    "start": "2831079",
    "end": "2837160"
  },
  {
    "text": "smaller and much quicker uh but for debugging it's not very nice to have a bundled application the key kind of trick here I",
    "start": "2837160",
    "end": "2844920"
  },
  {
    "text": "guess is this line I'm using a view component to uh render my settings down",
    "start": "2844920",
    "end": "2850160"
  },
  {
    "text": "to my angular 2 application okay so if we take a quick look at",
    "start": "2850160",
    "end": "2855800"
  },
  {
    "text": "that you'll see some of the magic coming out so this Vu component uh every time",
    "start": "2857160",
    "end": "2862760"
  },
  {
    "text": "the page runs which typically is just once at the beginning for a single page app um what I'm doing is I'm using the",
    "start": "2862760",
    "end": "2869520"
  },
  {
    "text": "authentication context pulling out the access to my current access token the",
    "start": "2869520",
    "end": "2875960"
  },
  {
    "text": "current ID token token which contains the identity resources I'm also pulling out the refresh token so my MVC app can",
    "start": "2875960",
    "end": "2883359"
  },
  {
    "text": "go and fetch as many access tokens as I want and this is probably another big benefit if you're more into security is",
    "start": "2883359",
    "end": "2888680"
  },
  {
    "text": "that my refresh tokens are never exposed to the client okay the MVC back end is the only thing that sees a refresh token",
    "start": "2888680",
    "end": "2894800"
  },
  {
    "text": "so you could make your access token expiry really small if you wanted to kind of mitigate people stealing keys or",
    "start": "2894800",
    "end": "2901839"
  },
  {
    "text": "sniffing keys or something like that uh it will only ever last as long as you set your access token expired to uh and",
    "start": "2901839",
    "end": "2908280"
  },
  {
    "text": "then it's pretty simple I'm just building a model and I'm putting some data in it so I'm I've got some base URLs that I want to give to the client",
    "start": "2908280",
    "end": "2914880"
  },
  {
    "text": "so it knows where to where the API is and where the authentication server is um I keep the tokens just in the back",
    "start": "2914880",
    "end": "2921520"
  },
  {
    "text": "end and then I add a bit bunch of other information that I don't want to call um from the database every you know every",
    "start": "2921520",
    "end": "2927559"
  },
  {
    "text": "time instead I'm just using the current uh the context version of",
    "start": "2927559",
    "end": "2932680"
  },
  {
    "text": "these uh and if we take a look at the view I'm just hardcoding a bit of a",
    "start": "2932680",
    "end": "2938760"
  },
  {
    "text": "settings file um and just rendering that information in so that's just a global variable basically in JavaScript uh and",
    "start": "2938760",
    "end": "2945599"
  },
  {
    "text": "because I did it just before the um that gets rendered here so a global variable",
    "start": "2945599",
    "end": "2951240"
  },
  {
    "text": "gets rendered here just before my angular 2 app loads so that in my angular 2 application if we go",
    "start": "2951240",
    "end": "2959559"
  },
  {
    "text": "to um I just have a service uh stock standard service here angular 2 service",
    "start": "2963200",
    "end": "2968799"
  },
  {
    "text": "that reads the magic variable so load settings here this is called once um yeah it Maps the magic",
    "start": "2968799",
    "end": "2976240"
  },
  {
    "text": "Global variable stuff to a typed variable uh that I can then expose to the rest of my application uh which is",
    "start": "2976240",
    "end": "2982559"
  },
  {
    "text": "quite powerful and I've got I've got 10 minutes to show you something pretty",
    "start": "2982559",
    "end": "2988079"
  },
  {
    "text": "cool as well now just before I show you the cool thing and probably while it's",
    "start": "2988079",
    "end": "2993799"
  },
  {
    "text": "loading um does anyone have any questions about things I know that's a",
    "start": "2993799",
    "end": "2999280"
  },
  {
    "text": "lot of information to absorb does anyone have any questions about anything uh they didn't quite catch",
    "start": "2999280",
    "end": "3004839"
  },
  {
    "text": "or anything like that no cool blown away oh we've got one",
    "start": "3004839",
    "end": "3010160"
  },
  {
    "text": "there protect",
    "start": "3010160",
    "end": "3014480"
  },
  {
    "text": "us",
    "start": "3016400",
    "end": "3019400"
  },
  {
    "text": "y they only have access to their own data so the question was if a user gains access to their access token they",
    "start": "3022480",
    "end": "3029640"
  },
  {
    "text": "could use that to try and get other people's data from the system good question good question um so",
    "start": "3029640",
    "end": "3038160"
  },
  {
    "text": "the way that's handled in my",
    "start": "3038160",
    "end": "3045079"
  },
  {
    "text": "application uh okay cool the the way I'm handling this um and I guess the best",
    "start": "3047319",
    "end": "3053839"
  },
  {
    "text": "place to start is to show you",
    "start": "3053839",
    "end": "3058640"
  },
  {
    "text": "the no",
    "start": "3060000",
    "end": "3063240"
  },
  {
    "text": "authentication um when I configured my identity server up here okay uh you might have",
    "start": "3068240",
    "end": "3074680"
  },
  {
    "text": "noticed these three lines down here and this is a couple of service implementations I've overridden uh from",
    "start": "3074680",
    "end": "3081440"
  },
  {
    "text": "the default ones and the client store is one of them so when I was showing you all that client information stuff that's",
    "start": "3081440",
    "end": "3087000"
  },
  {
    "text": "a special one the other one is a profile service uh and the job of a profile",
    "start": "3087000",
    "end": "3092960"
  },
  {
    "text": "service is to uh take the currently logged in user because remember identity server knows who's logged in um it's to",
    "start": "3092960",
    "end": "3101040"
  },
  {
    "text": "take that user and it's to create claims from that data uh and here I've got an",
    "start": "3101040",
    "end": "3106839"
  },
  {
    "text": "aspnet identity profile service I had to write one because they did there wasn't one before I wrote this but there's a",
    "start": "3106839",
    "end": "3113400"
  },
  {
    "text": "built-in one now so by default you'll get things like um their their user ID as a",
    "start": "3113400",
    "end": "3121119"
  },
  {
    "text": "claim um and the username and email all these built in ASP net ones right they they all get given to you for free so",
    "start": "3121119",
    "end": "3128000"
  },
  {
    "text": "they'll be in the token if you asked for them uh and more importantly I kind of override that as well uh and I hit the",
    "start": "3128000",
    "end": "3135440"
  },
  {
    "text": "database to pull out any claims I need as well so I guess if you come down here",
    "start": "3135440",
    "end": "3140760"
  },
  {
    "text": "not this one pinch profile service so I also so um when a user is",
    "start": "3140760",
    "end": "3148839"
  },
  {
    "text": "authenticated at the time they they log in uh these claims are also embedded in",
    "start": "3148839",
    "end": "3154319"
  },
  {
    "text": "the token uh so you can see how I've got uh test submersion ID and live submersion",
    "start": "3154319",
    "end": "3162480"
  },
  {
    "text": "ID",
    "start": "3165599",
    "end": "3168599"
  },
  {
    "text": "uh okay uh in my API",
    "start": "3172119",
    "end": "3177799"
  },
  {
    "text": "as a",
    "start": "3177799",
    "end": "3180119"
  },
  {
    "text": "convention uh no not that",
    "start": "3183280",
    "end": "3187000"
  },
  {
    "text": "one okay uh this is a base controller all my controlls inherit from this one",
    "start": "3190119",
    "end": "3195839"
  },
  {
    "text": "and what I do is I look in the the current HTTP context and I'm looking for",
    "start": "3195839",
    "end": "3201319"
  },
  {
    "text": "a a merchant context if I haven't already put one in but essentially What's Happening Here is when you ask for the sub an idea of the current User",
    "start": "3201319",
    "end": "3208040"
  },
  {
    "text": "it's going to go ahead and look",
    "start": "3208040",
    "end": "3212000"
  },
  {
    "text": "[Music] for yeah it's going to go ahead and pull this out of the current",
    "start": "3213170",
    "end": "3220079"
  },
  {
    "text": "context and it's going to pick either the live submer merchant ID or the test sub merchant ID from the claims uh so",
    "start": "3220079",
    "end": "3225839"
  },
  {
    "text": "there since they're set at authentication time basically all of my code has a oops all of my services code",
    "start": "3225839",
    "end": "3233040"
  },
  {
    "text": "just has a where sub merchant ID equals this and uh yeah that forces it basically yeah",
    "start": "3233040",
    "end": "3239200"
  },
  {
    "text": "that makes sense cool uh any other questions before I just move",
    "start": "3239200",
    "end": "3245480"
  },
  {
    "text": "on yes",
    "start": "3245480",
    "end": "3252680"
  },
  {
    "text": "correct great question okay the question was uh the refresh token is not given to the client therefore how am I refreshing",
    "start": "3256040",
    "end": "3262480"
  },
  {
    "text": "my tokens excellent point uh there's",
    "start": "3262480",
    "end": "3269400"
  },
  {
    "text": "actually again in the web project this time so the angular 2 MVC application",
    "start": "3269400",
    "end": "3276400"
  },
  {
    "text": "there is a little endpoint in my account controller here called refresh",
    "start": "3276400",
    "end": "3283200"
  },
  {
    "text": "tokens uh and that does what you might think so uh we basically take the current tokens out of the authentication",
    "start": "3283200",
    "end": "3291359"
  },
  {
    "text": "context uh that line 51 um is the",
    "start": "3291359",
    "end": "3296799"
  },
  {
    "text": "identity server code itself okay so this is code they've written where all you need to do is pass in the refresh",
    "start": "3296799",
    "end": "3304400"
  },
  {
    "text": "token um given some settings that's a bit hard to read with that oops so we create a token client",
    "start": "3304400",
    "end": "3312720"
  },
  {
    "text": "this token client is an identity server class we give it some settings such as the identity server the client ID and",
    "start": "3312720",
    "end": "3319920"
  },
  {
    "text": "the client secret and then we call request refresh token we'll get back a token uh and you",
    "start": "3319920",
    "end": "3326799"
  },
  {
    "text": "can see here basically I take the old token uh and the new one and the refresh",
    "start": "3326799",
    "end": "3332240"
  },
  {
    "text": "token and I jam it all into a new uh cont uh what is it yeah this is it here",
    "start": "3332240",
    "end": "3338559"
  },
  {
    "text": "uh claims principle sorry basically this guy updates MVC so it knows aha this is the current",
    "start": "3338559",
    "end": "3344799"
  },
  {
    "text": "authentication context and then I just return Jason with a new access token and that's it so that goes back down to the",
    "start": "3344799",
    "end": "3351359"
  },
  {
    "text": "angular application and probably one last thing to look at",
    "start": "3351359",
    "end": "3358240"
  },
  {
    "text": "is the authenticated HTTP service I've got here uh this is an angular 2 service and",
    "start": "3361200",
    "end": "3368880"
  },
  {
    "text": "what this does is it wraps every HTTP call in a retry um given that and it",
    "start": "3368880",
    "end": "3374880"
  },
  {
    "text": "knows how to basically refresh the token so I'll come down here and pretty",
    "start": "3374880",
    "end": "3382920"
  },
  {
    "text": "much where's the best one to look at I guess for example get so you can call",
    "start": "3382920",
    "end": "3389039"
  },
  {
    "text": "get with any URL uh and then it turns that request into like a Lambda function",
    "start": "3389039",
    "end": "3395480"
  },
  {
    "text": "basically uh and it executes it and it will refresh the tokens if it didn't",
    "start": "3395480",
    "end": "3400720"
  },
  {
    "text": "work um so stepping through that I add an authentication Bearer header to each",
    "start": "3400720",
    "end": "3407039"
  },
  {
    "text": "request that's how the API knows who I am that's how you pass the token to it",
    "start": "3407039",
    "end": "3412440"
  },
  {
    "text": "uh and that refresh method here",
    "start": "3412440",
    "end": "3418200"
  },
  {
    "text": "uh little bit tricky this is some observ observable fun but basically we take the",
    "start": "3418200",
    "end": "3423880"
  },
  {
    "text": "request we wanted to do we execute it we catch the error if it happens to give us a 401 then what we do is we call refresh",
    "start": "3423880",
    "end": "3431720"
  },
  {
    "text": "tokens so it makes a separate call off to that MVC endpoint gets the new token back and then adds it to the original",
    "start": "3431720",
    "end": "3439319"
  },
  {
    "text": "request and and fires it off a second time basically um which works uh pretty much",
    "start": "3439319",
    "end": "3446760"
  },
  {
    "text": "all the time uh the reason I say pretty much all the time is because when you load my",
    "start": "3446760",
    "end": "3453720"
  },
  {
    "text": "application for example if you happen to land here there's several calls that go",
    "start": "3453720",
    "end": "3459039"
  },
  {
    "text": "off to load the data for this page and if your token is expired it does it all at once so it'll",
    "start": "3459039",
    "end": "3465440"
  },
  {
    "text": "hit refresh tokens three times all at once and yeah I'll get the 401 three",
    "start": "3465440",
    "end": "3470920"
  },
  {
    "text": "three of them all at once I'll refresh the tokens all at once and that can cause identity server to into a bit of a",
    "start": "3470920",
    "end": "3476960"
  },
  {
    "text": "fuss if you don't set the refresh token this is going to be a bit of a",
    "start": "3476960",
    "end": "3483599"
  },
  {
    "text": "jump around uh up in my sorry client",
    "start": "3483599",
    "end": "3492440"
  },
  {
    "text": "store for Pinch web so this is the client",
    "start": "3492440",
    "end": "3498520"
  },
  {
    "text": "configuration and you'll see refresh token to do consider better approach",
    "start": "3498520",
    "end": "3506960"
  },
  {
    "text": "um refresh token is set to reuse which means when you use the refresh token to get a new access token it doesn't also",
    "start": "3506960",
    "end": "3512799"
  },
  {
    "text": "give you a new refresh token because when I call it three times at once all of a sudden I'm in this big mess whereas",
    "start": "3512799",
    "end": "3518319"
  },
  {
    "text": "if I get the same refresh token back each time it makes three successful calls and just changes access tokens",
    "start": "3518319",
    "end": "3523640"
  },
  {
    "text": "really quickly but they all work um and the great thing is you can set this up",
    "start": "3523640",
    "end": "3528760"
  },
  {
    "text": "per client so maybe I want my internal app to work that way but if I want third party developers to have a better way of",
    "start": "3528760",
    "end": "3533960"
  },
  {
    "text": "doing it I could set that to a different config cool um I'll take questions at the end",
    "start": "3533960",
    "end": "3541640"
  },
  {
    "text": "as well I know it's been a long day um the last thing I want to show you is just something a little bit",
    "start": "3541640",
    "end": "3547200"
  },
  {
    "text": "fun is the SDK okay I wrote an SDK basically",
    "start": "3547200",
    "end": "3556160"
  },
  {
    "text": "to make things easier for um developers to use my system right now what was fun",
    "start": "3556160",
    "end": "3561839"
  },
  {
    "text": "about this and what's cool about uh identity server is there's something there's the concept of connect built in",
    "start": "3561839",
    "end": "3568720"
  },
  {
    "text": "as well so up until now third party developers have built their own system",
    "start": "3568720",
    "end": "3573920"
  },
  {
    "text": "they have their own keys and they access their own data but if you ever Ed something like stripe or PayPal or some",
    "start": "3573920",
    "end": "3580960"
  },
  {
    "text": "a very large API where you want to build a system that uses other people's",
    "start": "3580960",
    "end": "3586119"
  },
  {
    "text": "accounts right and you want to connect to their account and get keys for their account rather than your own um and this",
    "start": "3586119",
    "end": "3593520"
  },
  {
    "text": "is actually built in this is what my system does as well so if you look at the uh know the keys page you'll see",
    "start": "3593520",
    "end": "3601039"
  },
  {
    "text": "this concept of an application ID on the right hand side and what this lets you do is like if you've ever seen uh",
    "start": "3601039",
    "end": "3607319"
  },
  {
    "text": "something like Twitter if you made a Twitter or a Facebook application you create a bit of information and then",
    "start": "3607319",
    "end": "3612839"
  },
  {
    "text": "when a third party application wants to use your Twitter account it'll say hey so and so application wants to use your",
    "start": "3612839",
    "end": "3618400"
  },
  {
    "text": "Twitter do you cons you know do give consent and it'll say let me tweet let",
    "start": "3618400",
    "end": "3623440"
  },
  {
    "text": "me read tweets or give me my email so that consent sort of workflow is",
    "start": "3623440",
    "end": "3628559"
  },
  {
    "text": "actually built into identity server as well and to demonstrate this let's just connect a",
    "start": "3628559",
    "end": "3634319"
  },
  {
    "text": "pinch so it was a very very prototype based screen here this is given to you",
    "start": "3634319",
    "end": "3640640"
  },
  {
    "text": "I've kind of half styled it a little um but this is built for you and you can see here um you can configure all this",
    "start": "3640640",
    "end": "3648240"
  },
  {
    "text": "stuff as well so I'm asking for their identifier I can choose whether or not to give them Merchant info all right",
    "start": "3648240",
    "end": "3654200"
  },
  {
    "text": "whether I want to con concede to uh I want API 1 access and I want offline access and I can remember that",
    "start": "3654200",
    "end": "3660799"
  },
  {
    "text": "decision as well and if I go yes allow uh all of a sudden what's happened",
    "start": "3660799",
    "end": "3666000"
  },
  {
    "text": "here is my third party application this is a technically what some developer",
    "start": "3666000",
    "end": "3671200"
  },
  {
    "text": "could go build now has access to the my claims okay it's logged in as",
    "start": "3671200",
    "end": "3677240"
  },
  {
    "text": "me um whoops yeah it's probably the best way",
    "start": "3677240",
    "end": "3683760"
  },
  {
    "text": "to describe it basically so the user has logged in before that consent screen I was already logged in but I could have",
    "start": "3683760",
    "end": "3689119"
  },
  {
    "text": "logged in as any other user and what would happen is I would get the details of that user in my third party application here and it's it's all the",
    "start": "3689119",
    "end": "3696000"
  },
  {
    "text": "same there's no difference to using the API you still send an access token you've still got a a refresh token and",
    "start": "3696000",
    "end": "3702599"
  },
  {
    "text": "you've just got some claims that you can read uh and that's something I think is really cool and it's built in but wary",
    "start": "3702599",
    "end": "3710520"
  },
  {
    "text": "of time basically what we've looked at today is",
    "start": "3710520",
    "end": "3716520"
  },
  {
    "text": "some basic how to setup identity server stuff uh we Tak a look at authentication and we've kind of really ramped up to a",
    "start": "3716520",
    "end": "3724119"
  },
  {
    "text": "scenario that's very specific to me but you got to see a couple of the cool things you can do and some of the",
    "start": "3724119",
    "end": "3729880"
  },
  {
    "text": "challenges you'll face when you uh go to do this yourself uh the best place to see information about identity server",
    "start": "3729880",
    "end": "3737000"
  },
  {
    "text": "and my blog post and stuff like that is just to Google Ben Cole's blog you'll find information there and thank you",
    "start": "3737000",
    "end": "3742920"
  },
  {
    "text": "very much for coming to NDC it's been a pleasure",
    "start": "3742920",
    "end": "3747838"
  },
  {
    "text": "if you have questions feel free to come up and have a chat",
    "start": "3753079",
    "end": "3757680"
  }
]