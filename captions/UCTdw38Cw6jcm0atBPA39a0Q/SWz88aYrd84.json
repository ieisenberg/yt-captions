[
  {
    "text": "so welcome and good morning time for some stories from the",
    "start": "10519",
    "end": "17439"
  },
  {
    "text": "wild and uh looking at underneath the hood why things sometimes doesn't work",
    "start": "17439",
    "end": "25279"
  },
  {
    "text": "so I'm Andel uh Swedish consultant I'm work a lot with dend",
    "start": "25279",
    "end": "31000"
  },
  {
    "text": "identity server and do Consulting and training for dend but I also do other",
    "start": "31000",
    "end": "36480"
  },
  {
    "text": "things and see other providers and see some",
    "start": "36480",
    "end": "42600"
  },
  {
    "text": "comparisons and uh different providers have different strengths and weaknesses so we'll look",
    "start": "42600",
    "end": "50520"
  },
  {
    "text": "at that first of all I want to look a bit at specification because this is a space that is extremely spec",
    "start": "50520",
    "end": "58640"
  },
  {
    "text": "driven and the original spec is RFC 6749 oo",
    "start": "58640",
    "end": "65600"
  },
  {
    "text": "2 um if you want to upset someone working with o 2 and open ID connect go",
    "start": "65600",
    "end": "71759"
  },
  {
    "text": "and ask them what about login using using o 2 for",
    "start": "71759",
    "end": "77320"
  },
  {
    "text": "login because the thing is that O2 is all about getting an access token to",
    "start": "77320",
    "end": "82439"
  },
  {
    "text": "call apis on behalf of the user a 2 has",
    "start": "82439",
    "end": "87720"
  },
  {
    "text": "no idea about a session session and logging in means establishing a session",
    "start": "87720",
    "end": "93119"
  },
  {
    "text": "and eventually as we will talk about later we probably also will single L out to tear down that session where we are",
    "start": "93119",
    "end": "99280"
  },
  {
    "text": "done with it that's not part of o 2 so opened connect was added as a layer on",
    "start": "99280",
    "end": "105240"
  },
  {
    "text": "top of oo 2 and open connect provides secure",
    "start": "105240",
    "end": "110920"
  },
  {
    "text": "session establishment and session management and session T down in the logout",
    "start": "110920",
    "end": "117439"
  },
  {
    "text": "phase going to the open Ed connect page it turns out that well open and",
    "start": "117439",
    "end": "124280"
  },
  {
    "text": "connect is not just one spec but a bunch of specs to keep track of and some of them",
    "start": "124280",
    "end": "131000"
  },
  {
    "text": "are published by separate working groups for reasons I",
    "start": "131000",
    "end": "137760"
  },
  {
    "text": "guess so looking here it looks simple I mean RFC 6749 it's just one spec isn't",
    "start": "138200",
    "end": "144319"
  },
  {
    "text": "it well through is like hey hold it for me",
    "start": "144319",
    "end": "150879"
  },
  {
    "text": "I have some companions I think this is the current",
    "start": "150879",
    "end": "157440"
  },
  {
    "text": "list of a two specs most of these",
    "start": "157440",
    "end": "163720"
  },
  {
    "text": "are extensions with new functionality adding higher security profiles or",
    "start": "163720",
    "end": "170800"
  },
  {
    "text": "adapting for different kind of applications things like that but a couple of them are actually crucial",
    "start": "170800",
    "end": "176040"
  },
  {
    "text": "security fixes to the um the original flow that and these are",
    "start": "176040",
    "end": "183120"
  },
  {
    "text": "things that everyone actually implements or should Implement at",
    "start": "183120",
    "end": "188680"
  },
  {
    "text": "least is the RFC 66 uh 7636 proof code",
    "start": "188680",
    "end": "194040"
  },
  {
    "text": "exchange that fixes risk for code substitution attacks especially in",
    "start": "194040",
    "end": "199200"
  },
  {
    "text": "mobile devices and RFC 9207 authorization",
    "start": "199200",
    "end": "204519"
  },
  {
    "text": "survey issue identification that also fixes a kind of",
    "start": "204519",
    "end": "209959"
  },
  {
    "text": "uh substitution attack but this means it's not that",
    "start": "209959",
    "end": "216000"
  },
  {
    "text": "simple for an implementer to keep up so let's look at one one thing that",
    "start": "216000",
    "end": "222720"
  },
  {
    "text": "matters token size so I've done Fair bit of conference talks uh this was NC Oso last year",
    "start": "222720",
    "end": "230360"
  },
  {
    "text": "Dominic Meer saw this picture and said hey that's looks like a fishing story are you talking the token was this big",
    "start": "230360",
    "end": "237000"
  },
  {
    "text": "and I hope not because tokens should probably not be big so I found this",
    "start": "237000",
    "end": "242720"
  },
  {
    "text": "picture of someone else he has a better grip of the token size obviously so why",
    "start": "242720",
    "end": "248959"
  },
  {
    "text": "do we own small tokens if we look at a typical example of a web application that wants to",
    "start": "248959",
    "end": "257040"
  },
  {
    "text": "authenticate with an upstream provider we want to log in when we do that we get",
    "start": "257040",
    "end": "262120"
  },
  {
    "text": "an access token and an ID token back in open ID connect then we typically set some",
    "start": "262120",
    "end": "268880"
  },
  {
    "text": "cookies on the client application to establish a session then we might want",
    "start": "268880",
    "end": "274880"
  },
  {
    "text": "to call an API and to be able to call an API we need to send the access token",
    "start": "274880",
    "end": "280960"
  },
  {
    "text": "along so we need to keep the access token on the client",
    "start": "280960",
    "end": "286440"
  },
  {
    "text": "application and it turns out we also need to keep the ID token because to prevent um cross-site",
    "start": "286440",
    "end": "295120"
  },
  {
    "text": "request forger attacks on log out there used to be something called logout spam",
    "start": "295120",
    "end": "300320"
  },
  {
    "text": "where you went to page watching a picture of kittens or something and in Hidden ey frame they just rendered log",
    "start": "300320",
    "end": "306759"
  },
  {
    "text": "out endpoints for a bunch of providers of popular sites on the internet so after you had been there you were",
    "start": "306759",
    "end": "313039"
  },
  {
    "text": "suddenly looked out everywhere it could be seen as a prank but it actually actually is also",
    "start": "313039",
    "end": "321639"
  },
  {
    "text": "can be part of an attack so for example if you have an attacker that they have",
    "start": "321639",
    "end": "327120"
  },
  {
    "text": "found an attack to a way to attack back you in the login",
    "start": "327120",
    "end": "332360"
  },
  {
    "text": "phase then being able to log users Out means they have to log in and then they can execute our",
    "start": "332360",
    "end": "339600"
  },
  {
    "text": "attack so since we need to keep the tokens around for the duration of the session to be able to look out and call",
    "start": "339600",
    "end": "346560"
  },
  {
    "text": "apis we want them small this is a token coming from",
    "start": "346560",
    "end": "353560"
  },
  {
    "text": "Microsoft entro ID um it's an a bridged somewhat a bridged version but it's an uh real in",
    "start": "353560",
    "end": "360560"
  },
  {
    "text": "real token what we can see here is the groups in this case I have four groups",
    "start": "360560",
    "end": "366199"
  },
  {
    "text": "that's not many but one of the features with ENT ID is that you can Nest groups in each",
    "start": "366199",
    "end": "372080"
  },
  {
    "text": "other so you can groups that are memb that are members of other groups that are member of more groups there is no",
    "start": "372080",
    "end": "378759"
  },
  {
    "text": "way to express that with nested groups here so Microsoft ENT just expands the",
    "start": "378759",
    "end": "384599"
  },
  {
    "text": "list before it dumps it in the ID token in a large corporation it's Not Unusual",
    "start": "384599",
    "end": "390599"
  },
  {
    "text": "to have people where the expanded list of groups is in the hundreds and having hundreds of those",
    "start": "390599",
    "end": "398360"
  },
  {
    "text": "yeah that turned out to be a problem and on actually realized that to ensure that",
    "start": "398360",
    "end": "405080"
  },
  {
    "text": "the token Size Doesn't exceed the ATP header size limits the number of object ideas that",
    "start": "405080",
    "end": "411720"
  },
  {
    "text": "can it includes in the group's claim is limited good they put a limit to it 200",
    "start": "411720",
    "end": "419120"
  },
  {
    "text": "for some web token I think that 200 objects at this then the token is probably",
    "start": "419120",
    "end": "425759"
  },
  {
    "text": "already a bit on the large side so what to do about that well there is a",
    "start": "425759",
    "end": "431080"
  },
  {
    "text": "mechanism in open ID connect called the user info endpoint the idea is that you send in",
    "start": "431080",
    "end": "437080"
  },
  {
    "text": "the access token and you get actual payload information about the user",
    "start": "437080",
    "end": "442560"
  },
  {
    "text": "back the good thing with this is that we can now reduce the ID token to be just",
    "start": "442560",
    "end": "450440"
  },
  {
    "text": "Pro uh the protocol details that uh and security measures that's need to Pro is needed to prove the identity of the user",
    "start": "450440",
    "end": "458960"
  },
  {
    "text": "and in the end we just have the subject ID in there and all the given name family name name display name group",
    "start": "458960",
    "end": "464199"
  },
  {
    "text": "membership all of that goes it has to be fetched over the user INF for",
    "start": "464199",
    "end": "469360"
  },
  {
    "text": "endpoint another good thing with the user info endpoint is that you can actually query it whenever you need so",
    "start": "469360",
    "end": "478720"
  },
  {
    "text": "the ID to is something you just receive on session initialization for a long running session if things are updated",
    "start": "478720",
    "end": "485440"
  },
  {
    "text": "you cannot update unless you log in again while if you use user info endpoint you can update whenever you",
    "start": "485440",
    "end": "491919"
  },
  {
    "text": "want so the user info endpoint is a critical mechanic thing in or critical",
    "start": "491919",
    "end": "500520"
  },
  {
    "text": "feature in open ID connect to make token sizes manageable and avoid all sorts of issues so let's look at the Microsoft ID",
    "start": "500520",
    "end": "508280"
  },
  {
    "text": "just R for response this is an example they have from the docs and then it says the claims shown",
    "start": "508280",
    "end": "516320"
  },
  {
    "text": "in response are all those that the US from info endpoint can return these values are the same values included in",
    "start": "516320",
    "end": "521839"
  },
  {
    "text": "an ID token okay hold on so they have the user info endpoint but they still put",
    "start": "521839",
    "end": "527880"
  },
  {
    "text": "everything in the ID token okay but we could at least update",
    "start": "527880",
    "end": "535440"
  },
  {
    "text": "things from it well no in caveats on the user in you can't add to or customize",
    "start": "535440",
    "end": "541279"
  },
  {
    "text": "the information returned by the user info endpoint to customize the information returned by the identity",
    "start": "541279",
    "end": "546959"
  },
  {
    "text": "platform use claims mapping and optional claims to modify security token",
    "start": "546959",
    "end": "552839"
  },
  {
    "text": "configuration I feel that the user in endpoint implementation by Microsoft ENT",
    "start": "553120",
    "end": "558720"
  },
  {
    "text": "ID is one of those that we had to do it according to the spec and they did the",
    "start": "558720",
    "end": "563880"
  },
  {
    "text": "minimum thing",
    "start": "563880",
    "end": "567320"
  },
  {
    "text": "what upsets me a bit more is that um the saw the text that it limits",
    "start": "570040",
    "end": "575519"
  },
  {
    "text": "the number of tokens but it indicates to the application to query the microsof graph API to retrieve the users group",
    "start": "575519",
    "end": "580959"
  },
  {
    "text": "membership so obviously service side they have all the data they even",
    "start": "580959",
    "end": "586320"
  },
  {
    "text": "provide an end point or a feature to query that through the Microsoft graph",
    "start": "586320",
    "end": "591839"
  },
  {
    "text": "but why didn't they just hook up the user info input to that no",
    "start": "591839",
    "end": "598320"
  },
  {
    "text": "idea guesses are",
    "start": "598320",
    "end": "601920"
  },
  {
    "text": "welcome so let's look closer at the token SCI at log out if we have a web application with",
    "start": "605000",
    "end": "611959"
  },
  {
    "text": "the logout button and then redirect the user to the",
    "start": "611959",
    "end": "617160"
  },
  {
    "text": "end session endpoint of the provider identity server will do ident server will respond this would you like",
    "start": "617160",
    "end": "623360"
  },
  {
    "text": "to look out of ident server yes and then the reason for this is of",
    "start": "623360",
    "end": "629880"
  },
  {
    "text": "because a cross cross site uh request forer risk the logout bpoint is a get",
    "start": "629880",
    "end": "636519"
  },
  {
    "text": "request and we need to somehow anyone could redirect the use of",
    "start": "636519",
    "end": "641720"
  },
  {
    "text": "that so we need this this is a form post that prevents that contains proper anti",
    "start": "641720",
    "end": "648760"
  },
  {
    "text": "forgery tokens to pre prevent cross site request forgery and",
    "start": "648760",
    "end": "656839"
  },
  {
    "text": "um to get but it's awward user interface I mean I hit I press log out that button",
    "start": "657079",
    "end": "662279"
  },
  {
    "text": "should also have proper cross site request for your protection so somehow if we could authenticate the user and",
    "start": "662279",
    "end": "669079"
  },
  {
    "text": "that's why the ID token comes in if the ID token is sent along with the log out",
    "start": "669079",
    "end": "675279"
  },
  {
    "text": "request or Lookout redirect then identi will no longer show this and it also",
    "start": "675279",
    "end": "680639"
  },
  {
    "text": "enables identi to know what client implication initia log out because the",
    "start": "680639",
    "end": "686040"
  },
  {
    "text": "client ID is in the ID token in the audience parameter so that allows identi so to",
    "start": "686040",
    "end": "693040"
  },
  {
    "text": "reiterate back and now we get a decent user experience hitting L Out means",
    "start": "693040",
    "end": "699519"
  },
  {
    "text": "redirects and some screen flickering maybe but in the end you can up in the application where you click loged",
    "start": "699519",
    "end": "706800"
  },
  {
    "text": "out this is how it should be done Android",
    "start": "706800",
    "end": "713320"
  },
  {
    "text": "well they always show this pick an account which account do you want to log out of even if you supply an ID token H",
    "start": "713320",
    "end": "720200"
  },
  {
    "text": "to look out they still show this one and I mean the client application sends in",
    "start": "720200",
    "end": "726079"
  },
  {
    "text": "an ID token which contains the identifier of the user and what client application was requesting L out the",
    "start": "726079",
    "end": "733360"
  },
  {
    "text": "identifier of the user is there and ENT ID says hey which I don't understand which one do you look out want to look",
    "start": "733360",
    "end": "739600"
  },
  {
    "text": "out from and actually it doesn't matter it's",
    "start": "739600",
    "end": "747680"
  },
  {
    "text": "the same experience regardless if is sending the ID token uh hint or not so you went out and tested what about",
    "start": "747680",
    "end": "754040"
  },
  {
    "text": "redirection back to the client app what if we have two applications in the",
    "start": "754040",
    "end": "760480"
  },
  {
    "text": "session turns out that there's no connection between the application where initiated log out and what accepted it",
    "start": "760480",
    "end": "768920"
  },
  {
    "text": "where it accepts redirect so one application can easily redirect to another one on L",
    "start": "768920",
    "end": "774560"
  },
  {
    "text": "out and the protocol spec prevents this the protocol well if you follow the protocols back",
    "start": "774560",
    "end": "781920"
  },
  {
    "text": "closely the post Lookout redirect your should be pre-registered per client",
    "start": "781920",
    "end": "789920"
  },
  {
    "text": "application um so let's talk about another thing about",
    "start": "792760",
    "end": "798680"
  },
  {
    "text": "issuer so this is just an example uh from Identity server uh the spec",
    "start": "798680",
    "end": "806079"
  },
  {
    "text": "contains um a mandatory requirement that open ID provider supporting Discovery must make adjacent document available at",
    "start": "806079",
    "end": "812839"
  },
  {
    "text": "the path formed by concatenating the string sl. wellknown slop ID configuration to the issuer and this is",
    "start": "812839",
    "end": "819959"
  },
  {
    "text": "a brilliant thing in open ID connect because it means if we take a token we have the issuer in there then we could",
    "start": "819959",
    "end": "826839"
  },
  {
    "text": "go get the discovery document get and from the discovery document get the",
    "start": "826839",
    "end": "832120"
  },
  {
    "text": "public Keys used to verify the token so just having a token if everything is",
    "start": "832120",
    "end": "838279"
  },
  {
    "text": "compliant we can use that to get the information we need to be able to validate it",
    "start": "838279",
    "end": "844839"
  },
  {
    "text": "properly uh if we for example take demanders software.com add/ wellknown open configuration we get this",
    "start": "844839",
    "end": "851880"
  },
  {
    "text": "link and if I click that one we will get a discovery document",
    "start": "851880",
    "end": "860160"
  },
  {
    "text": "with for example the JX U where will have the public part of the",
    "start": "860160",
    "end": "865279"
  },
  {
    "text": "signing key",
    "start": "865279",
    "end": "868680"
  },
  {
    "text": "and we can see the issuer in there because uh there's also a requirement that the issue identify",
    "start": "871560",
    "end": "878000"
  },
  {
    "text": "for the open ID provider which is typically of 10 unit Discovery must exactly match the value of the ISS claim",
    "start": "878000",
    "end": "886199"
  },
  {
    "text": "this is one validating token so there's a very strict requirement that these things should all",
    "start": "886199",
    "end": "893800"
  },
  {
    "text": "um all be consistent with each other",
    "start": "893800",
    "end": "899839"
  },
  {
    "text": "doesn't look too hard to get right does it do you think anyone could ever get",
    "start": "900399",
    "end": "905839"
  },
  {
    "text": "this wrong welcome to ENT",
    "start": "905839",
    "end": "911519"
  },
  {
    "text": "ID so if we have this login Microsoft online.com with a tenant specifies so",
    "start": "911519",
    "end": "918680"
  },
  {
    "text": "this is my test tenant ID I add the well and open ID configuration I get this one let's go there and see so what we would",
    "start": "918680",
    "end": "926480"
  },
  {
    "text": "expect now is the issue should be log Microsoft online.com SL1",
    "start": "926480",
    "end": "931880"
  },
  {
    "text": "c23 Etc and if we go here they don't put the",
    "start": "931880",
    "end": "938319"
  },
  {
    "text": "issue on top I think they kind of want to hide it somewhere it's here STS",
    "start": "938319",
    "end": "944000"
  },
  {
    "text": "windows.net this is actually okay according to the spec",
    "start": "944000",
    "end": "952360"
  },
  {
    "text": "because the initial URL here login moft online.com is just an authority URL that",
    "start": "952360",
    "end": "957839"
  },
  {
    "text": "they Supply they say that there's nothing that says that you cannot serve the discovered",
    "start": "957839",
    "end": "964360"
  },
  {
    "text": "document on more locations but the interesting question here is obviously that we found this",
    "start": "964360",
    "end": "971839"
  },
  {
    "text": "issue where if we append well-known open ID configuration to be spec compliant we",
    "start": "971839",
    "end": "976880"
  },
  {
    "text": "should have the discovery document on this URL because this is the one that we would go",
    "start": "976880",
    "end": "982480"
  },
  {
    "text": "read yeah we have Discovery document and",
    "start": "982480",
    "end": "987680"
  },
  {
    "text": "actually the issue this time matches but I was a bit surprised to",
    "start": "987680",
    "end": "992959"
  },
  {
    "text": "find this even in the single tendency",
    "start": "992959",
    "end": "997040"
  },
  {
    "text": "mode um but then we have a bit more complex things",
    "start": "1002199",
    "end": "1007800"
  },
  {
    "text": "so when using Microsoft ENT ID a supply an application typically not or often",
    "start": "1007800",
    "end": "1014519"
  },
  {
    "text": "not only authenticates to one instance of ENT ID but to many this is if you're a software as a service provider you",
    "start": "1014519",
    "end": "1021839"
  },
  {
    "text": "would have your own entro tenant but you also want to be able to Federate with your customers",
    "start": "1021839",
    "end": "1028798"
  },
  {
    "text": "provider and of course you can have your client application be registered as an",
    "start": "1028799",
    "end": "1034520"
  },
  {
    "text": "app registration in every single ENT ID of all your customers then you need to talk to them",
    "start": "1034520",
    "end": "1041438"
  },
  {
    "text": "get the redirect your eyes right get a client secret right update the client secret on occasional intervals things",
    "start": "1041439",
    "end": "1047798"
  },
  {
    "text": "like that and Microsoft they're all about simple",
    "start": "1047799",
    "end": "1053080"
  },
  {
    "text": "onboarding I mean entro ID is sometimes used by small organizations they don't have the resources they just need a",
    "start": "1053080",
    "end": "1059440"
  },
  {
    "text": "simple way to get on boarded and they have this concept where you can publish an application in your tenant and make",
    "start": "1059440",
    "end": "1067280"
  },
  {
    "text": "it available to others and then uh all the configuration data remains in your",
    "start": "1067280",
    "end": "1072640"
  },
  {
    "text": "you if you want to change the redir your you can just do it in your settings and it will they will not have to update on",
    "start": "1072640",
    "end": "1080000"
  },
  {
    "text": "that side because they are essentially using your app so instead of having your",
    "start": "1080000",
    "end": "1087000"
  },
  {
    "text": "application communicating with all of these logical Upstream s provider why",
    "start": "1087000",
    "end": "1093240"
  },
  {
    "text": "not uh add a new one and that is exactly what Microsoft did they added uh new kind of",
    "start": "1093240",
    "end": "1103280"
  },
  {
    "text": "virtual uh instance that can authenticate to all of the all of the",
    "start": "1103280",
    "end": "1109240"
  },
  {
    "text": "others how do they do that they have a separate Authority login Microsoft online.com commmon if",
    "start": "1109240",
    "end": "1116760"
  },
  {
    "text": "you use this Authority it means that hey I want to be able to access any or this",
    "start": "1116760",
    "end": "1123480"
  },
  {
    "text": "uh application is allowed to be accessed by anyone in any ID tenant we'll do the",
    "start": "1123480",
    "end": "1129840"
  },
  {
    "text": "same welln open ID configuration let's see what we have",
    "start": "1129840",
    "end": "1134960"
  },
  {
    "text": "here the issue is Al definitely The Hidden",
    "start": "1134960",
    "end": "1140280"
  },
  {
    "text": "bit further down so what's this looks like a template",
    "start": "1140280",
    "end": "1146440"
  },
  {
    "text": "string there's no such thing as templating in the spec the spec says it must be an exact match",
    "start": "1146440",
    "end": "1155240"
  },
  {
    "text": "right um okay yeah and we have the same thing with STS tenant ID so so let's try",
    "start": "1155400",
    "end": "1161840"
  },
  {
    "text": "this then you should be able to take the issue and do sl. wellknown",
    "start": "1161840",
    "end": "1167400"
  },
  {
    "text": "right inval tenant tenant tenant ID was not",
    "start": "1167400",
    "end": "1173279"
  },
  {
    "text": "found um obviously no it doesn't work that way and it's",
    "start": "1174000",
    "end": "1180840"
  },
  {
    "text": "more and more obvious that tenant ID in the sly braces is a template so let's go back and try let's",
    "start": "1180840",
    "end": "1188000"
  },
  {
    "text": "just put in common here and not a tenant IDE see what",
    "start": "1188000",
    "end": "1192840"
  },
  {
    "text": "happens we got something and now again we have the issue being the template",
    "start": "1193200",
    "end": "1200640"
  },
  {
    "text": "so yeah well well I went ahead and created a multi an application using multi-tenanted I logged on and this is",
    "start": "1203480",
    "end": "1211000"
  },
  {
    "text": "the resulting ID token I get back and as you can no I don't read encoded ID",
    "start": "1211000",
    "end": "1216799"
  },
  {
    "text": "tokens either this is the decoded ID token uh we had a typ just the normal",
    "start": "1216799",
    "end": "1222799"
  },
  {
    "text": "header and then we have the payload and what we can see here is that",
    "start": "1222799",
    "end": "1229240"
  },
  {
    "text": "even though the authority I started with what this common end point or where it's",
    "start": "1229240",
    "end": "1235320"
  },
  {
    "text": "said the tenant ID the issu of the token is the actual tenant ID of my",
    "start": "1235320",
    "end": "1244000"
  },
  {
    "text": "account they also Supply the tenant IDE as a claim I have no idea",
    "start": "1245039",
    "end": "1252880"
  },
  {
    "text": "why because we have it both in the is year and tenant so to summarize a",
    "start": "1252880",
    "end": "1259880"
  },
  {
    "text": "bit we go and fetch the discovery doc we find the issuer with this template",
    "start": "1259880",
    "end": "1267200"
  },
  {
    "text": "string the spec say that issue identify for the opened provider which is typically obtained during discovery that",
    "start": "1267200",
    "end": "1274039"
  },
  {
    "text": "is readed from the discovery doc must exactly match the value of the ISS claim we get this ISS claim",
    "start": "1274039",
    "end": "1282278"
  },
  {
    "text": "back so we can't be spe compliant if we want to work with mantroid multi",
    "start": "1283840",
    "end": "1289039"
  },
  {
    "text": "we have to remove this and then we get the 109d as a separate claim so I went",
    "start": "1289039",
    "end": "1294080"
  },
  {
    "text": "to an actual production application I have access to and check that I know use multi- on TR and checked how do they do",
    "start": "1294080",
    "end": "1302039"
  },
  {
    "text": "this well this is actual production code validate issue or",
    "start": "1302039",
    "end": "1307559"
  },
  {
    "text": "false which is per seed probably not unsecure because is it relies on the",
    "start": "1307559",
    "end": "1313799"
  },
  {
    "text": "fact that the signing keys are only are owned by mic Microsoft on and they have",
    "start": "1313799",
    "end": "1321039"
  },
  {
    "text": "the same signing keys for everyone so essentially we just fetch the signing keys from one tenant and",
    "start": "1321039",
    "end": "1327279"
  },
  {
    "text": "then we can use that those to validate tokens regardless of what tenant they",
    "start": "1327279",
    "end": "1332559"
  },
  {
    "text": "are issued by still not what I would prefer so let's see what would I have done because I've G when some thought to",
    "start": "1332559",
    "end": "1340159"
  },
  {
    "text": "this see so if we look back at our graphical representation the problem is that we are initiating this sign into",
    "start": "1340159",
    "end": "1349080"
  },
  {
    "text": "this virtual common in uh open ID provider but then the response is coming",
    "start": "1349080",
    "end": "1355520"
  },
  {
    "text": "directly from the actual providers this is would be a much better",
    "start": "1355520",
    "end": "1361120"
  },
  {
    "text": "thing we could have a virtual provider where our client application would",
    "start": "1361120",
    "end": "1367880"
  },
  {
    "text": "interact with the same one and the issue would be this one and then we could just have the tenant ID as a claim and or why",
    "start": "1367880",
    "end": "1375200"
  },
  {
    "text": "even have this virtual one I mean one of these is our home tenant this is where the app registration is created why not",
    "start": "1375200",
    "end": "1383000"
  },
  {
    "text": "let this one just connect to the rest of the I logical",
    "start": "1383000",
    "end": "1390679"
  },
  {
    "text": "instances and if we rearrange it and add a couple of more client applications",
    "start": "1391640",
    "end": "1397120"
  },
  {
    "text": "this is the Federation Gateway pattern that is an architectural pattern that I often recommend for uh when working with",
    "start": "1397120",
    "end": "1405559"
  },
  {
    "text": "the open ID connect this would also solve another problem uh probably where uh it's not",
    "start": "1405559",
    "end": "1413840"
  },
  {
    "text": "possible to use ID guest account in the setup I think it would be possible",
    "start": "1413840",
    "end": "1421440"
  },
  {
    "text": "here okay so let's take another example of",
    "start": "1424480",
    "end": "1431039"
  },
  {
    "text": "issues because unfortunately this is not the only time Microsoft has done",
    "start": "1431039",
    "end": "1436880"
  },
  {
    "text": "interesting things to issue us this is adfs I once had a project where",
    "start": "1436880",
    "end": "1442480"
  },
  {
    "text": "for reasons they wanted to use Microsoft adfs together with aure API management I",
    "start": "1442480",
    "end": "1450240"
  },
  {
    "text": "mean two Microsoft products right it's just that one is for the from the on Prem is Legacy",
    "start": "1450240",
    "end": "1456919"
  },
  {
    "text": "era and one is a modern Cloud product and obviously as your API management is",
    "start": "1456919",
    "end": "1463039"
  },
  {
    "text": "designed to work with H or Android um I actually met one of",
    "start": "1463039",
    "end": "1469440"
  },
  {
    "text": "the API management developers on a conference and he and told him about",
    "start": "1469440",
    "end": "1475000"
  },
  {
    "text": "this story and he was like why would anyone do that why would anyone use adfs with API management but yeah for",
    "start": "1475000",
    "end": "1483039"
  },
  {
    "text": "reasons we have the issuer here ADF example adfs example.org",
    "start": "1483039",
    "end": "1489600"
  },
  {
    "text": "adfs I think they created this URL as the issuer to allow the discovery",
    "start": "1489600",
    "end": "1495559"
  },
  {
    "text": "document to follow the pattern of other paths in adfs but then we have another one access",
    "start": "1495559",
    "end": "1502720"
  },
  {
    "text": "token issuer so it's actually using different issues for the access token",
    "start": "1502720",
    "end": "1507799"
  },
  {
    "text": "and for the ID token and if you have a normal client a",
    "start": "1507799",
    "end": "1513080"
  },
  {
    "text": "library and API uh in an API that downloads the discovery document it will",
    "start": "1513080",
    "end": "1518679"
  },
  {
    "text": "go and check the issuer so you would have to to do that",
    "start": "1518679",
    "end": "1524960"
  },
  {
    "text": "there is a way to fix this though because I have no idea where this comes from but this is the Federation service",
    "start": "1524960",
    "end": "1530960"
  },
  {
    "text": "identifier and the Federation service identifier is possible to configure so you can change the Federation service",
    "start": "1530960",
    "end": "1536799"
  },
  {
    "text": "identify to be the same as the top one just one drawback that is kind of",
    "start": "1536799",
    "end": "1542320"
  },
  {
    "text": "the global identifier of the adfs instance so typically if you want to if",
    "start": "1542320",
    "end": "1548240"
  },
  {
    "text": "you have adfs and want to add open a connect to it it's typical because you have had a ton of Legacy applications",
    "start": "1548240",
    "end": "1554640"
  },
  {
    "text": "already using adfs where the W Federation or some too and now open ID connect requires you",
    "start": "1554640",
    "end": "1561520"
  },
  {
    "text": "to change the federal service identifier which will break all of the existing client applications if you set up a new",
    "start": "1561520",
    "end": "1567480"
  },
  {
    "text": "one yeah it's an easy thing to just make sure this match but still not exactly what I would",
    "start": "1567480",
    "end": "1576360"
  },
  {
    "text": "prefer one thing that ID can handle though as we seen is log out we could do",
    "start": "1578440",
    "end": "1584039"
  },
  {
    "text": "log out let's talk about log out a bit more so if we have a session in an",
    "start": "1584039",
    "end": "1589200"
  },
  {
    "text": "application that we've created here we have uh session represented by cookies",
    "start": "1589200",
    "end": "1594480"
  },
  {
    "text": "we typically have cookies on both sides so we have one session in the client",
    "start": "1594480",
    "end": "1599600"
  },
  {
    "text": "application we have one session in the identity provider if we hit log out and simply",
    "start": "1599600",
    "end": "1606600"
  },
  {
    "text": "remove the local cookies and the user then tries to access a protected resource typically a",
    "start": "1606600",
    "end": "1615000"
  },
  {
    "text": "single on offlow will be initiated or like on onto end server and it will just",
    "start": "1615000",
    "end": "1621679"
  },
  {
    "text": "get the cookies back I mean I would love this to be in the cookie jar at home because my kids eat the cookies so what",
    "start": "1621679",
    "end": "1629840"
  },
  {
    "text": "if the cookies could just reappear wouldn't that be good no um this is when I started",
    "start": "1629840",
    "end": "1635960"
  },
  {
    "text": "working with uh single sign on this was an actual bug report we had in the production system Healthcare in Sweden",
    "start": "1635960",
    "end": "1643000"
  },
  {
    "text": "where the ID IDP login was there was a session and there was also a smart card",
    "start": "1643000",
    "end": "1648240"
  },
  {
    "text": "involved that which meant that as long as the user had the smart card in the terminal single onon would",
    "start": "1648240",
    "end": "1654679"
  },
  {
    "text": "work um and if they removed it the S the session cookie could remain in some",
    "start": "1654679",
    "end": "1661559"
  },
  {
    "text": "cases we had implemented single log out in our application but single log out",
    "start": "1661559",
    "end": "1668000"
  },
  {
    "text": "was not implemented which meant that we just cleared our our own",
    "start": "1668000",
    "end": "1673559"
  },
  {
    "text": "cookie and then we had one use a healthc care professional do you know",
    "start": "1673559",
    "end": "1679000"
  },
  {
    "text": "uh they are people that really take this seriously and make sure that if when",
    "start": "1679000",
    "end": "1684279"
  },
  {
    "text": "they are logged out she went and click the link just to see can I still acation record and this",
    "start": "1684279",
    "end": "1691600"
  },
  {
    "text": "happened so if we have single sign on we need single sign out",
    "start": "1691600",
    "end": "1697679"
  },
  {
    "text": "always without single log out there is no relog out because you can just be",
    "start": "1697679",
    "end": "1704480"
  },
  {
    "text": "relogged in if we look at uh Discovery dock from",
    "start": "1704480",
    "end": "1710880"
  },
  {
    "text": "Identity server we will see that there is an end session endpoint that is where we redirect the user there is another platform that is",
    "start": "1710880",
    "end": "1718279"
  },
  {
    "text": "fairly popular anyone heard about",
    "start": "1718279",
    "end": "1723399"
  },
  {
    "text": "Google they have Discovery document which is actually fairly short if I just collapse this I think we would might",
    "start": "1723399",
    "end": "1732320"
  },
  {
    "text": "even get to the end yeah it's short anyone see the end session",
    "start": "1732320",
    "end": "1737360"
  },
  {
    "text": "endpoint let's search no no end session",
    "start": "1737360",
    "end": "1745200"
  },
  {
    "text": "endpoint well you can log out to your Google account but you have to go to",
    "start": "1745200",
    "end": "1751399"
  },
  {
    "text": "accounts google.com and initiate it manually Google obviously do not want to",
    "start": "1751399",
    "end": "1756519"
  },
  {
    "text": "use a to L out and I think this makes sense on my",
    "start": "1756519",
    "end": "1761760"
  },
  {
    "text": "personal phone my personal device I just stay logged into my Google account",
    "start": "1761760",
    "end": "1766919"
  },
  {
    "text": "that's fine but if what if I borrowed your device to do some urgent work and hand it back I",
    "start": "1766919",
    "end": "1774200"
  },
  {
    "text": "think that I I pressed logged out before I hand the computer back I mean everyone in this room we",
    "start": "1774200",
    "end": "1780960"
  },
  {
    "text": "know that if we borrow a computer from someone and log in I would do it in an",
    "start": "1780960",
    "end": "1786840"
  },
  {
    "text": "incognito window to ensure that I can close it and be sure that everything is really gone afterwards but a normal user",
    "start": "1786840",
    "end": "1793919"
  },
  {
    "text": "wouldn't do that a normal user would probably just log in hit log out and",
    "start": "1793919",
    "end": "1799640"
  },
  {
    "text": "think it's secure so to me this is a a security",
    "start": "1799640",
    "end": "1805200"
  },
  {
    "text": "issue there is the same",
    "start": "1809200",
    "end": "1814799"
  },
  {
    "text": "um okay let's talk a bit more about Laing features and this now we are moving from",
    "start": "1815120",
    "end": "1821000"
  },
  {
    "text": "protocol level and spec level things more to architectural Concepts that we might",
    "start": "1821000",
    "end": "1827519"
  },
  {
    "text": "need this is the architecture from a company",
    "start": "1827519",
    "end": "1835840"
  },
  {
    "text": "it was a startup I think the it was 15 years ago so it's a long time ago uh or nearly 15 years ago they",
    "start": "1835840",
    "end": "1842679"
  },
  {
    "text": "started and they get some this there is a program from Microsoft where startups",
    "start": "1842679",
    "end": "1848640"
  },
  {
    "text": "can get cool infrastructure and even some Consulting help from Microsoft uh Microsoft",
    "start": "1848640",
    "end": "1855639"
  },
  {
    "text": "consultant to get the architecture right Asher ADB Toc was new at the time",
    "start": "1855639",
    "end": "1863279"
  },
  {
    "text": "so they decided that they wanted to use Asher ADB to see because from a trust",
    "start": "1863279",
    "end": "1868399"
  },
  {
    "text": "perspective it's a good idea to say that no we don't have credentials of any us as we we use",
    "start": "1868399",
    "end": "1874360"
  },
  {
    "text": "Microsoft they are an established company and they had law passwords we don't do that ourselves they also had to",
    "start": "1874360",
    "end": "1881480"
  },
  {
    "text": "support other providers so this is a combination of uh consumer accounts and uh businesso",
    "start": "1881480",
    "end": "1891039"
  },
  {
    "text": "business Federation accounts in this application so the Microsoft consultant",
    "start": "1891039",
    "end": "1897080"
  },
  {
    "text": "that was obviously paid to plug Microsoft products said that we should",
    "start": "1897080",
    "end": "1902519"
  },
  {
    "text": "use H BC it's new and it's good but then we have the client application we",
    "start": "1902519",
    "end": "1909639"
  },
  {
    "text": "need to issue access tokens and use access tokens to call apis and ASR b2c",
    "start": "1909639",
    "end": "1915200"
  },
  {
    "text": "can't really do that so let's use identi server in between my question here is why as",
    "start": "1915200",
    "end": "1922360"
  },
  {
    "text": "b2c at all ASB Toc also has a few more quirks",
    "start": "1922360",
    "end": "1928919"
  },
  {
    "text": "with they have something called a policy where you can have a sign in policy or sign up flow policy and they are defined",
    "start": "1928919",
    "end": "1936320"
  },
  {
    "text": "by starting at different end points and that is actually reflected in the token produced so depending if the user signed",
    "start": "1936320",
    "end": "1943480"
  },
  {
    "text": "up recover the password or just signed in you will get different",
    "start": "1943480",
    "end": "1948720"
  },
  {
    "text": "issues from the token when it comes back",
    "start": "1948720",
    "end": "1956559"
  },
  {
    "text": "um and we saw what the spec says about token issues another one that is",
    "start": "1956799",
    "end": "1964440"
  },
  {
    "text": "interesting this is something I've seen a lot in this customer case it was OCTA but I've seen it with other providers",
    "start": "1964440",
    "end": "1970919"
  },
  {
    "text": "I've SE it ID I've seen it with o zero the non OCTA of zero as well and uh AWS",
    "start": "1970919",
    "end": "1978559"
  },
  {
    "text": "Cognito in the same where we have something that on the",
    "start": "1978559",
    "end": "1984720"
  },
  {
    "text": "surface looks like a good architecture where we have two client applications",
    "start": "1984720",
    "end": "1990919"
  },
  {
    "text": "using a Shar API they use octav a single signon OCTA fedro with multiple Upstream",
    "start": "1990919",
    "end": "1998039"
  },
  {
    "text": "providers but then on the architectural drawing that this customer supplied",
    "start": "1998039",
    "end": "2003600"
  },
  {
    "text": "there was something more there was the ID translation layer which was an internal service they used",
    "start": "2003600",
    "end": "2011240"
  },
  {
    "text": "to translate whatever came from OCTA to their internal identities and in typical",
    "start": "2011240",
    "end": "2018559"
  },
  {
    "text": "architecture if we look at the FED Federation Gateway architecture had to briefly here let's",
    "start": "2018559",
    "end": "2025720"
  },
  {
    "text": "get back to it if we look at the Federation Gateway architecture the role of the Federation Gateway is to Shield",
    "start": "2025720",
    "end": "2032039"
  },
  {
    "text": "the client applications from all of that so the client applications should get a unified internal definition of the",
    "start": "2032039",
    "end": "2039720"
  },
  {
    "text": "identity from the Federation Gateway and then it's up to the Federation gateway to interact with the Upstream providers",
    "start": "2039720",
    "end": "2045919"
  },
  {
    "text": "and translate it turns out that OCTA in this",
    "start": "2045919",
    "end": "2051200"
  },
  {
    "text": "case couldn't really accommodate to all the requirements they had so they had to",
    "start": "2051200",
    "end": "2057599"
  },
  {
    "text": "insert another one and this is something I've seen every now and then with various Cloud Prov is that they cannot",
    "start": "2057599",
    "end": "2064118"
  },
  {
    "text": "accommodate and be flexible enough onid definitely too",
    "start": "2064119",
    "end": "2069720"
  },
  {
    "text": "but I have an even worse story about uh something like this this was a cent customer using AWS",
    "start": "2072560",
    "end": "2079720"
  },
  {
    "text": "Cognito for the web app and they or actually my customer was this web app",
    "start": "2079720",
    "end": "2086320"
  },
  {
    "text": "then the customer's customer had this set up so I was",
    "start": "2086320",
    "end": "2091919"
  },
  {
    "text": "working on that web app and the end end customer came and said that hey we want",
    "start": "2091919",
    "end": "2098119"
  },
  {
    "text": "to migrate AWS Cognito so we need to be able to use that and we we connect our",
    "start": "2098119",
    "end": "2103400"
  },
  {
    "text": "AWS Cognito instance to our CRM system with the idea that users would be able",
    "start": "2103400",
    "end": "2109240"
  },
  {
    "text": "to use Google and Facebook to sign on but there was also a connection to the CRM system saying that only users that",
    "start": "2109240",
    "end": "2115200"
  },
  {
    "text": "actually existed in CRM system and were ex had an existing relationship with",
    "start": "2115200",
    "end": "2120520"
  },
  {
    "text": "this organization would be allowed to uh to log in",
    "start": "2120520",
    "end": "2128280"
  },
  {
    "text": "they essentially wanted this that if you try to log in and you're not in the CRM",
    "start": "2128280",
    "end": "2134000"
  },
  {
    "text": "system you would be redirected and stuck on the CN system on the registration page where you could request",
    "start": "2134000",
    "end": "2140280"
  },
  {
    "text": "registration and then be let in um it turns out that A's Cognito they",
    "start": "2140280",
    "end": "2148480"
  },
  {
    "text": "could get it to pick up the identifier from the CRM system and query the CRM",
    "start": "2148480",
    "end": "2154440"
  },
  {
    "text": "system for it but they couldn't make it to alter the flow so in the end we ended up with this",
    "start": "2154440",
    "end": "2161720"
  },
  {
    "text": "where we had to implement code on our side in the client application all the way down where we checked do we have a",
    "start": "2161720",
    "end": "2168079"
  },
  {
    "text": "CRM ID claim on the user coming in and if not we had to block them and redirect",
    "start": "2168079",
    "end": "2174440"
  },
  {
    "text": "them back to the CRM but they already had an established system so once more the cloud",
    "start": "2174440",
    "end": "2183400"
  },
  {
    "text": "providers they are excellent at what they do but if you want anything more",
    "start": "2183400",
    "end": "2189560"
  },
  {
    "text": "than exactly what they do it often results in quite awkward",
    "start": "2189560",
    "end": "2196079"
  },
  {
    "text": "hacks and I used to say that for ID for example if you want if you need a square",
    "start": "2196079",
    "end": "2201160"
  },
  {
    "text": "box ID is a perfectly well polished square box same goes for author zero for",
    "start": "2201160",
    "end": "2206920"
  },
  {
    "text": "example it's a Well polished square box but if you want to Chas anything I mean",
    "start": "2206920",
    "end": "2213079"
  },
  {
    "text": "entro is like the T for it comes in Black period or the zero yeah can probably change color of it but if you",
    "start": "2213079",
    "end": "2221280"
  },
  {
    "text": "want to really adjust it it's not possible you need another",
    "start": "2221280",
    "end": "2226279"
  },
  {
    "text": "solution so I've been bashing so far",
    "start": "2226960",
    "end": "2232000"
  },
  {
    "text": "product and telling some about some incompatibilities that I've met but as a",
    "start": "2232000",
    "end": "2238200"
  },
  {
    "text": "final thing I have actually something from the spec so even though I like the specs the",
    "start": "2238200",
    "end": "2244400"
  },
  {
    "text": "specs are not perfect over two basic o let's start with",
    "start": "2244400",
    "end": "2251800"
  },
  {
    "text": "RFC 7617 which is just a clarification RFC",
    "start": "2251800",
    "end": "2256960"
  },
  {
    "text": "2617 basic authentication for HTTP it say that get the user ID and",
    "start": "2256960",
    "end": "2262920"
  },
  {
    "text": "password from the user construct the user pass by concatenating the user ID a single colon",
    "start": "2262920",
    "end": "2269280"
  },
  {
    "text": "character and the password know the colons are not allowed in the username",
    "start": "2269280",
    "end": "2275520"
  },
  {
    "text": "thanks to the scheme they can be in the password then encodes the user pass into",
    "start": "2275520",
    "end": "2280680"
  },
  {
    "text": "an octed sequence and typically utf8 obtain the basic credential by",
    "start": "2280680",
    "end": "2286440"
  },
  {
    "text": "coding this OCT sequence using Bas 64 so it's just utf8 Bas 64",
    "start": "2286440",
    "end": "2294560"
  },
  {
    "text": "done in flow where a client needs to authenticate on the back channel to for",
    "start": "2295319",
    "end": "2300920"
  },
  {
    "text": "example the token end point on uh on to authorization",
    "start": "2300920",
    "end": "2309200"
  },
  {
    "text": "server they the client can use basic",
    "start": "2309200",
    "end": "2314800"
  },
  {
    "text": "authentication and it's even described a bit in the RFC 6749 with two basic",
    "start": "2315680",
    "end": "2323160"
  },
  {
    "text": "off with this the client identify is encoded using the application xw form",
    "start": "2323160",
    "end": "2329480"
  },
  {
    "text": "URL encoded encoding algorithm the client password is accounted using the same algorithm and",
    "start": "2329480",
    "end": "2336079"
  },
  {
    "text": "used as the password we recently had this as a bug someone",
    "start": "2336079",
    "end": "2343040"
  },
  {
    "text": "saying that hey why don't Paul client secrets that",
    "start": "2343040",
    "end": "2348200"
  },
  {
    "text": "contains a plus character do not work with identity server the reason was that this customer",
    "start": "2348200",
    "end": "2357800"
  },
  {
    "text": "used basic authentication as it was is standard defining the standard uh",
    "start": "2357800",
    "end": "2364359"
  },
  {
    "text": "identity service supports the full one and plus has a special meaning and is",
    "start": "2364359",
    "end": "2369480"
  },
  {
    "text": "actually en in X form URL encoded plus is actually encoding for the space can",
    "start": "2369480",
    "end": "2377640"
  },
  {
    "text": "character so it doesn't work and I'm like but",
    "start": "2377920",
    "end": "2383720"
  },
  {
    "text": "why why does open add do two have their own definition it they don't really make",
    "start": "2383720",
    "end": "2390319"
  },
  {
    "text": "it easy for us right so that's actually all the stories",
    "start": "2390319",
    "end": "2397760"
  },
  {
    "text": "I had prepared uh and uh we have some time if you have",
    "start": "2397760",
    "end": "2404760"
  },
  {
    "text": "questions or if anyone has more horror stories to share I would be happy to hear",
    "start": "2404760",
    "end": "2411839"
  },
  {
    "text": "them everyone you just use be compliant providers do you they just work well thank you so",
    "start": "2418839",
    "end": "2426960"
  },
  {
    "text": "much for being here and hope you have a great day at the conference [Applause]",
    "start": "2426960",
    "end": "2435860"
  }
]