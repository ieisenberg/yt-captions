[
  {
    "start": "0",
    "end": "151000"
  },
  {
    "text": "hey okay there are some people out there cool so welcome thanks for coming to my session here on securing web apps and",
    "start": "30",
    "end": "7140"
  },
  {
    "text": "api's for asp net core to 2 and 3.0 my name is Brock Allen I call myself an",
    "start": "7140",
    "end": "14040"
  },
  {
    "text": "application security architect I guess I do consulting for company called Alliance and I basically help my",
    "start": "14040",
    "end": "20550"
  },
  {
    "text": "customers with their Identity and Access Control so basically that means you know",
    "start": "20550",
    "end": "26430"
  },
  {
    "text": "figuring out how to get users authenticated managing passwords doing multi-factor authentication very often",
    "start": "26430",
    "end": "31920"
  },
  {
    "text": "single sign-on you know apps calling API securely and authorization and a lot of",
    "start": "31920",
    "end": "38160"
  },
  {
    "text": "that revolves around a protocol called Open ID Connect and off to and so as",
    "start": "38160",
    "end": "43950"
  },
  {
    "text": "part of that I actually work on an open source project called identity server I do some other open source projects as",
    "start": "43950",
    "end": "49410"
  },
  {
    "text": "well but identity servers probably the best-known I've been doing you know",
    "start": "49410",
    "end": "56129"
  },
  {
    "text": "security for a long time and you know asp.net and dotnet for for even longer",
    "start": "56129",
    "end": "61730"
  },
  {
    "text": "and so you know kind of speaking of the good old days right how many of you have",
    "start": "61730",
    "end": "67049"
  },
  {
    "text": "been around long enough to remember what this is anyone okay the folks with gray",
    "start": "67049",
    "end": "72180"
  },
  {
    "text": "hair or no hair yeah absolutely okay so curious question how many of",
    "start": "72180",
    "end": "77670"
  },
  {
    "text": "these settings actually work I'll give you a hint none works okay well forms",
    "start": "77670",
    "end": "87750"
  },
  {
    "text": "authentication that worked right a lot of people who build asp.net apps and use this cookie based approach with forms-based authentication that would",
    "start": "87750",
    "end": "93810"
  },
  {
    "text": "work Windows authentication worked that was basically saying you know do whatever I is does not mainly was",
    "start": "93810",
    "end": "99600"
  },
  {
    "text": "because you were looking to do Windows authentication you know for your users because they were an Active Directory but when dotnet 1.0 was being released",
    "start": "99600",
    "end": "106890"
  },
  {
    "text": "they were trying to ship a product called passport which is actually different than whatever the new product",
    "start": "106890",
    "end": "112649"
  },
  {
    "text": "in the last year or so called passport is I've been around long enough when they start recycling product names to",
    "start": "112649",
    "end": "117750"
  },
  {
    "text": "something totally different it's makes me so old I guess anyway password was something that everybody flipped out",
    "start": "117750",
    "end": "123509"
  },
  {
    "text": "they didn't want and it was a product that was cut but Microsoft didn't update the enum so it just hung around and it",
    "start": "123509",
    "end": "130170"
  },
  {
    "text": "would just never did anything okay they actually tried to do this again when I think it was 4.5 was",
    "start": "130170",
    "end": "135630"
  },
  {
    "text": "shipped of asp.net and they tried to do a new federated authentication model and so that product also didn't ship but",
    "start": "135630",
    "end": "142590"
  },
  {
    "text": "they forgot to update the enum okay so anyway don't choose federated or Passport they're they're not gonna work",
    "start": "142590",
    "end": "147770"
  },
  {
    "text": "so the point of this talk is to basically talk about modern applications right the kind of apps we're building",
    "start": "147770",
    "end": "153959"
  },
  {
    "start": "151000",
    "end": "151000"
  },
  {
    "text": "are very different than they were back in the asp.net days and what we're looking to do is figure out how to well",
    "start": "153959",
    "end": "161400"
  },
  {
    "text": "really this talk is for people who are potentially new to asp.net core or maybe",
    "start": "161400",
    "end": "166920"
  },
  {
    "text": "you've been a Espina using ASP net core but you haven't like really looked into the security features and it's meant to give you an overview of the features in",
    "start": "166920",
    "end": "173670"
  },
  {
    "text": "this framework to basically be able to architect these modern style applications so the modern types of apps",
    "start": "173670",
    "end": "180269"
  },
  {
    "text": "that we're building we're building a lot of back-end web api's right the assumption that those are basically HTTP",
    "start": "180269",
    "end": "185760"
  },
  {
    "text": "based api's and then we're building a lot of front ends that are then calling the backends the types of front ends",
    "start": "185760",
    "end": "192090"
  },
  {
    "text": "were building though are actually quite a few right we're building your traditional server-side web app or I",
    "start": "192090",
    "end": "197459"
  },
  {
    "text": "think of MVC right that might be calling an API but of course you have a user using it and you want to do",
    "start": "197459",
    "end": "202560"
  },
  {
    "text": "authentication and and things like that so there's that type of app we also have JavaScript browser-based applications",
    "start": "202560",
    "end": "208860"
  },
  {
    "text": "you know spas using angular react or whatever and those of course also want to call API securely we're building",
    "start": "208860",
    "end": "215820"
  },
  {
    "text": "mobile and native apps to write either your iOS or Android app or even the desktop app that you might install onto",
    "start": "215820",
    "end": "222480"
  },
  {
    "text": "Windows or Mac and those also want to you know authenticate a user call it Web API and then also have like",
    "start": "222480",
    "end": "228530"
  },
  {
    "text": "server-to-server types of scenarios where you want to call API securely but there's no user using the app so that's",
    "start": "228530",
    "end": "235980"
  },
  {
    "text": "kind of the point of this session is to show you what is available in asp net core to secure this type of architecture",
    "start": "235980",
    "end": "241829"
  },
  {
    "text": "okay and so here's the the list of things we're gonna look at and of course to get started it makes sense to start",
    "start": "241829",
    "end": "248190"
  },
  {
    "text": "at the starting point which is the hosting layer so asp.net core when it",
    "start": "248190",
    "end": "253290"
  },
  {
    "start": "251000",
    "end": "251000"
  },
  {
    "text": "was first ship came with a web server called kestrel and the whole architecture was that an asp net core",
    "start": "253290",
    "end": "259829"
  },
  {
    "text": "application when it loaded was just a console app but it had embedded inside of it this web server called",
    "start": "259829",
    "end": "265660"
  },
  {
    "text": "Estoril and so when 1.0 of asp net court was was released they basically said",
    "start": "265660",
    "end": "271930"
  },
  {
    "text": "kestrel is not approved to run publicly on the internet okay what that meant is in your architecture you had this think",
    "start": "271930",
    "end": "277810"
  },
  {
    "text": "of reverse proxy in front of it so you had to stick iis or apache or nginx in",
    "start": "277810",
    "end": "283030"
  },
  {
    "text": "front of your asp.net app and the intent there was because apache and all those other web servers were basically",
    "start": "283030",
    "end": "289690"
  },
  {
    "text": "battle-hardened right they were basically you know well tested and very mature in dealing with you know",
    "start": "289690",
    "end": "296560"
  },
  {
    "text": "the vicious Internet as it were okay and then you basically would reverse proxy",
    "start": "296560",
    "end": "302560"
  },
  {
    "text": "back to your actual console apps on the top right there when 2.0 of asp net core",
    "start": "302560",
    "end": "308800"
  },
  {
    "text": "came out they certified kestrel to run publicly on the internet so they actually did a whole bunch of",
    "start": "308800",
    "end": "314290"
  },
  {
    "text": "penetration testing they found bugs and they fix them and they basically you know figured out that okay great we",
    "start": "314290",
    "end": "319570"
  },
  {
    "text": "think we've run this through enough tests and we we know how it all works well enough that we will support this if",
    "start": "319570",
    "end": "324880"
  },
  {
    "text": "you want to stick this on your edge okay personally I'm not sure I would do that",
    "start": "324880",
    "end": "330670"
  },
  {
    "text": "yet okay it's still kind of a new web server so at least for me being a little",
    "start": "330670",
    "end": "337780"
  },
  {
    "text": "bit more comfortable you know wanting to have a lot of layers of security in there I probably still would advise the",
    "start": "337780",
    "end": "342850"
  },
  {
    "text": "reverse proxy approach even though it's officially supported okay but in terms of what the modern features are in",
    "start": "342850",
    "end": "349060"
  },
  {
    "start": "347000",
    "end": "347000"
  },
  {
    "text": "kestrel to be an edge server you absolutely have to support HTTPS so that's absolutely supported in Kestrel",
    "start": "349060",
    "end": "355450"
  },
  {
    "text": "you can do you know sort of the the static based certificate mapping you know host mapping to certificate or it",
    "start": "355450",
    "end": "361660"
  },
  {
    "text": "even supports the more dynamic server name indication which is where you can set up like a wild-card cert and you're",
    "start": "361660",
    "end": "367090"
  },
  {
    "text": "you're you know HTTP host could listen for multiple domains it's nice the other",
    "start": "367090",
    "end": "372220"
  },
  {
    "text": "nice thing about Kestrel is that during development you can actually use HTTP during development they have some nice",
    "start": "372220",
    "end": "377230"
  },
  {
    "text": "tooling around that to do you know like localhost but HTTP so it's good to get in the habit of you know testing with",
    "start": "377230",
    "end": "383650"
  },
  {
    "text": "HTTP because there are things you miss during development that you kind of only find out about once you push to well",
    "start": "383650",
    "end": "390040"
  },
  {
    "text": "hopefully not production but at least you know QA and testing if you do want to run kestrel on the edge",
    "start": "390040",
    "end": "396830"
  },
  {
    "text": "and there are a bunch of default settings with how it deals with incoming you know network traffic from a security",
    "start": "396830",
    "end": "402980"
  },
  {
    "text": "standpoint but you need to be aware that these things are configurable and you",
    "start": "402980",
    "end": "408470"
  },
  {
    "text": "may have to depending on what your app is doing you know get familiar with some of the low-level configuration settings like you know the number of inbound",
    "start": "408470",
    "end": "415280"
  },
  {
    "text": "requests that can be accepted what the request queue is going to be what the timeout is going to be like when bytes",
    "start": "415280",
    "end": "420920"
  },
  {
    "text": "are being sent in you know if the bytes are being sent in too slow that might be an attack and so",
    "start": "420920",
    "end": "426140"
  },
  {
    "text": "you need to know what your cutoff limit is going to be and when bytes are being sent out or they not being read fast enough and all these like little",
    "start": "426140",
    "end": "432220"
  },
  {
    "text": "low-level kind of kind of like what a network admin might you know be thinking",
    "start": "432220",
    "end": "437300"
  },
  {
    "text": "about so anyway that's the thing is if you are taking on this responsibility of running on the edge be prepared to get",
    "start": "437300",
    "end": "443390"
  },
  {
    "text": "really really familiar with the stuff okay okay moving along in the stack then is",
    "start": "443390",
    "end": "449930"
  },
  {
    "start": "447000",
    "end": "447000"
  },
  {
    "text": "once you have your console app up and running in asp net core you're gonna be running in you know loading in asp.net",
    "start": "449930",
    "end": "455000"
  },
  {
    "text": "core and running in castro which it opens up here you know in-memory web server listening on some socket the hope",
    "start": "455000",
    "end": "462020"
  },
  {
    "text": "architecture that nav asp net core is it when requests come in it invokes this middleware pipeline in the middleware",
    "start": "462020",
    "end": "468380"
  },
  {
    "text": "pipeline is basically the component model of processing requests in asp.net core middlewares like the the reusable",
    "start": "468380",
    "end": "476570"
  },
  {
    "text": "component that might do logging or exception handling or you know serving",
    "start": "476570",
    "end": "482480"
  },
  {
    "text": "up static files or security remind you okay also MVC or application frameworks",
    "start": "482480",
    "end": "490010"
  },
  {
    "text": "like MVC are typically packaged up into middleware and so the order of this pipeline is very important because",
    "start": "490010",
    "end": "495710"
  },
  {
    "text": "that's the order that your code will run and processing the requests so since MVC very often is going to be rendering the",
    "start": "495710",
    "end": "501140"
  },
  {
    "text": "response you kind of put that at the end of the pipeline so that when requests come in your middleware upfront get to",
    "start": "501140",
    "end": "507050"
  },
  {
    "text": "do their you know whatever job that they're doing to you know build up whatever your web server is doing the",
    "start": "507050",
    "end": "514190"
  },
  {
    "text": "other big thing about asp net core is the whole service architecture with dependency injection so any services",
    "start": "514190",
    "end": "519770"
  },
  {
    "text": "that are needed during the request processing are you know configured in the DI container okay so you build this",
    "start": "519770",
    "end": "525560"
  },
  {
    "text": "middle where you put the middleware in that you need you put the services in di that you need and you know you're up and running when",
    "start": "525560",
    "end": "532250"
  },
  {
    "text": "it comes to security then most of the features of security from asp net core are in the di container there has",
    "start": "532250",
    "end": "539720"
  },
  {
    "text": "services that are available as your you know request is being processed there",
    "start": "539720",
    "end": "545120"
  },
  {
    "text": "are a couple of middlewares one middleware is for authentication and there's another middleware for cores but",
    "start": "545120",
    "end": "551660"
  },
  {
    "text": "in terms of most of the functionality it's mainly provided out of services so",
    "start": "551660",
    "end": "557570"
  },
  {
    "text": "in terms of the services the first one that actually I think most people probably put it this way it's not a very",
    "start": "557570",
    "end": "565160"
  },
  {
    "text": "visible feature in asp.net core so it's something though it's one of those things that you maybe find out about",
    "start": "565160",
    "end": "570920"
  },
  {
    "text": "when you do go to production because it didn't like show up during a local testing and that's something called data protection okay so in terms of sort of",
    "start": "570920",
    "end": "578450"
  },
  {
    "text": "going back in the Wayback Machine again do you guys remember this from asp.net the old machine key element what was it",
    "start": "578450",
    "end": "586130"
  },
  {
    "text": "for say again to encrypt my web config no",
    "start": "586130",
    "end": "592520"
  },
  {
    "text": "but it is to encrypt something yeah and crypt cookies okay so data",
    "start": "592520",
    "end": "598430"
  },
  {
    "text": "protection was a feature of the old asp.net or classic asp.net I guess as we call it now and so basically your web",
    "start": "598430",
    "end": "604430"
  },
  {
    "text": "application will be generating values that are gonna leave your web server okay and then later on that value it's",
    "start": "604430",
    "end": "611510"
  },
  {
    "text": "going to be sent back into your web server and when it comes back in you want to make sure that nobody's changed it or modified it or tampered with it so",
    "start": "611510",
    "end": "618410"
  },
  {
    "text": "data protection was a general feature the basically allowed you to pass a value in and you got back and encrypted",
    "start": "618410",
    "end": "623630"
  },
  {
    "text": "and a digitally signed blob a version of that value and then you could send it",
    "start": "623630",
    "end": "629030"
  },
  {
    "text": "out and that's a perfect thing for a cookie right because when you send a cookie to the browser right if it says",
    "start": "629030",
    "end": "634190"
  },
  {
    "text": "roll admin you don't want the user changing that string in the cookie okay so wanted to send back in data",
    "start": "634190",
    "end": "639890"
  },
  {
    "text": "protection could you know validate the value and decrypt I mean you get back to the original value okay so of course",
    "start": "639890",
    "end": "646640"
  },
  {
    "text": "that involves cryptography and cryptography requires key material and that's what that key material is so this",
    "start": "646640",
    "end": "653240"
  },
  {
    "text": "is now gone in asp.net core because we were all doing this wrong okay basically people will go to Google to figure out",
    "start": "653240",
    "end": "660080"
  },
  {
    "text": "what keys they should put in here that's not a good idea right you talking Mikey material should be private very often",
    "start": "660080",
    "end": "667759"
  },
  {
    "text": "well actually where's this file located this is the web.config file right that's",
    "start": "667759",
    "end": "673910"
  },
  {
    "text": "in the root of your application directory so when requests come in like def file is just sitting there along",
    "start": "673910",
    "end": "679639"
  },
  {
    "text": "with the rest of the application code so if you have bugs in your app maybe somehow a vulnerability that would read your config file this would spit it out",
    "start": "679639",
    "end": "686360"
  },
  {
    "text": "to the end-user right there's a nice little Google search down here right so",
    "start": "686360",
    "end": "691430"
  },
  {
    "text": "you might you know somehow leak this key also people accidentally check this into their source code repository right and",
    "start": "691430",
    "end": "697819"
  },
  {
    "text": "you know shows up on github okay so this is just generally a bad idea so data",
    "start": "697819",
    "end": "703579"
  },
  {
    "text": "protection does exist in asp.net core but it's completely reaaargh attacted to solve some of these problems that we've",
    "start": "703579",
    "end": "709100"
  },
  {
    "text": "had so the first one i think is more important which is the second bullet is that the keys are automatically",
    "start": "709100",
    "end": "714589"
  },
  {
    "start": "710000",
    "end": "710000"
  },
  {
    "text": "generated for you you don't have to know anything about the crypto algorithm or how to generate the key it's just",
    "start": "714589",
    "end": "720800"
  },
  {
    "text": "dynamically generated for you and then that key is used to do the you know protecting of cookies and other things",
    "start": "720800",
    "end": "726529"
  },
  {
    "text": "okay now the other thing is that the keys should be stored outside the application directory so you have a few",
    "start": "726529",
    "end": "733670"
  },
  {
    "text": "options about where you store this but this is the thing that most people don't or aren't aware of is that you actually",
    "start": "733670",
    "end": "738680"
  },
  {
    "text": "have to participate in this you have to be you know think about this realize that you are responsible for thinking",
    "start": "738680",
    "end": "743990"
  },
  {
    "text": "about where to put these all right the reason that that's important is because in a you know load-balanced web form",
    "start": "743990",
    "end": "749209"
  },
  {
    "text": "environment the two different servers have to have access to the same keys so that they can read and decrypt each",
    "start": "749209",
    "end": "755449"
  },
  {
    "text": "other's cookies okay now if you're running an azure magic happens right it just works",
    "start": "755449",
    "end": "760670"
  },
  {
    "text": "okay but if you're not running an azure you're doing your own hosting then you need to explicitly configure this to",
    "start": "760670",
    "end": "766399"
  },
  {
    "text": "some shared location that both or all of your web servers has that have access to so you know there's some implementations",
    "start": "766399",
    "end": "772430"
  },
  {
    "text": "for like Redis and the database and other things like that but basically this is something a lot of people don't",
    "start": "772430",
    "end": "778670"
  },
  {
    "text": "see in development then you push to production load balance servers your cookies don't work okay or at least they",
    "start": "778670",
    "end": "784339"
  },
  {
    "text": "work half the time when you go to the right machine but not the other machine so I have a demo here",
    "start": "784339",
    "end": "792250"
  },
  {
    "text": "so what I have is just a pretty simple asp net core application here's my startup code and here is the",
    "start": "793880",
    "end": "801470"
  },
  {
    "text": "configuration for data protection and it's just showing you how you can add in data protection when you're setting up",
    "start": "801470",
    "end": "807230"
  },
  {
    "text": "data protection you can give your application a name what this does is the data protection key is like a master key",
    "start": "807230",
    "end": "812269"
  },
  {
    "text": "and then they derive a key that is private to your app and that name affects that that's sort of private key",
    "start": "812269",
    "end": "818500"
  },
  {
    "text": "and then what we're basically doing is saying okay I want to persist these keys to the file system and don't do this",
    "start": "818500",
    "end": "825470"
  },
  {
    "text": "because I'm putting it in my application directory but this is where kind of you would say Oh put it in this folder you",
    "start": "825470",
    "end": "831860"
  },
  {
    "text": "know so on the server somewhere Microsoft basically is expecting you to put in a UNC path if you're doing your",
    "start": "831860",
    "end": "838850"
  },
  {
    "text": "own you know multiple server deployment kind of thing so you would put it in the network share for example now if you",
    "start": "838850",
    "end": "845810"
  },
  {
    "text": "don't want to set up a network share then you can implement this interface called I XML repository that is the",
    "start": "845810",
    "end": "850850"
  },
  {
    "text": "actual interface that reads and writes from the store and then you can go stick the thing into a database or you know",
    "start": "850850",
    "end": "856730"
  },
  {
    "text": "Redis cache or whatever else you want to do okay the one got you about this is though when you do write these out to",
    "start": "856730",
    "end": "863000"
  },
  {
    "text": "the filesystem or to the Redis cash or to the database then the keys will be in plain text so anybody else who have",
    "start": "863000",
    "end": "870380"
  },
  {
    "text": "access to that network share or whatever can you know read those keys so there's",
    "start": "870380",
    "end": "875779"
  },
  {
    "text": "one last thing you typically have to do which is you have to think about how to encrypt the keys that are at rest and so",
    "start": "875779",
    "end": "882079"
  },
  {
    "text": "Microsoft has a few features for this one is this was actually not going to work in a load-balanced environment but",
    "start": "882079",
    "end": "887089"
  },
  {
    "text": "DP API is a window specific way to do protection of the of the of the keys but",
    "start": "887089",
    "end": "892819"
  },
  {
    "text": "it's you know windows specific for the current user so this is not really gonna work in your load-balanced environment the other thing they have you do is",
    "start": "892819",
    "end": "898970"
  },
  {
    "text": "protect keys with certificate and what",
    "start": "898970",
    "end": "906050"
  },
  {
    "text": "you do is you'd pop in an x.509 certificate here and then that's what you end up doing is you take a certificate that has the private key",
    "start": "906050",
    "end": "912740"
  },
  {
    "text": "that's gonna protect all your other keys and that's what you you distribute to all those servers in your web form so",
    "start": "912740",
    "end": "918500"
  },
  {
    "text": "now this certificate kind of becomes a replacement for this thing that you used to have or",
    "start": "918500",
    "end": "924199"
  },
  {
    "text": "synchronize across all the machines in your web form okay okay so I'll leave that back here",
    "start": "924199",
    "end": "929720"
  },
  {
    "text": "so what I'm gonna do is I'm gonna run this and again I'm storing this in the current directory and I know you can't",
    "start": "929720",
    "end": "936320"
  },
  {
    "text": "see it it's not here there's there's no text file with this key material so what I'm gonna do is run this and what we",
    "start": "936320",
    "end": "942410"
  },
  {
    "text": "should see is when this app starts up there we go this key got created so if",
    "start": "942410",
    "end": "947480"
  },
  {
    "text": "we pop this open we'll see that this is a the actual key it's stored inside of this XML file this XML file has",
    "start": "947480",
    "end": "953660"
  },
  {
    "text": "information about when the key was created right when it should be activated when it should be expired okay",
    "start": "953660",
    "end": "959300"
  },
  {
    "text": "that's actually an interesting feature of this is that the key that it creates actually has an expiration so after 90",
    "start": "959300",
    "end": "965330"
  },
  {
    "text": "days by default a new key gets created that's kinda like good key hygiene you do key rolling okay so it's kind of nice",
    "start": "965330",
    "end": "971960"
  },
  {
    "text": "you'll see then multiple keys over you know months and months and months start to accumulate here and then here's the",
    "start": "971960",
    "end": "978230"
  },
  {
    "text": "actual key material and because it's on plaintext we don't want to visible to everybody so we've actually then done",
    "start": "978230",
    "end": "983240"
  },
  {
    "text": "further encryption of it in this case with DEP API again that won't work across servers you'd use a certificate",
    "start": "983240",
    "end": "988610"
  },
  {
    "text": "approach so I'm gonna run this application no actually I'm already running and the job of this application",
    "start": "988610",
    "end": "994640"
  },
  {
    "text": "is actually to use the data protection API so what I'm gonna do is type in you know",
    "start": "994640",
    "end": "999770"
  },
  {
    "text": "hello NDC okay and I've now encrypted that value so if you had your",
    "start": "999770",
    "end": "1005350"
  },
  {
    "text": "application you had some value you wanted to send as a query string to another page in your app or you had a",
    "start": "1005350",
    "end": "1010950"
  },
  {
    "text": "you're building a wizard where you're building upstate and doing like post backs cross multiple steps of a wizard",
    "start": "1010950",
    "end": "1017350"
  },
  {
    "text": "type of thing and you wanted some data to persist across those but you made it wanted to make sure nobody messed with",
    "start": "1017350",
    "end": "1022390"
  },
  {
    "text": "it this is exactly what you'd use okay now what I'm gonna do just to show you",
    "start": "1022390",
    "end": "1027610"
  },
  {
    "text": "that this key material is important I shut down my server I'm gonna go delete the key file okay",
    "start": "1027610",
    "end": "1037329"
  },
  {
    "text": "which I should here we go close that I'm gonna rerun my server okay a new key got",
    "start": "1037329",
    "end": "1044650"
  },
  {
    "text": "created so there's a new key there and now if I try to unprotect the same value it fails right because the key that was",
    "start": "1044650",
    "end": "1052540"
  },
  {
    "text": "used to protect is not now the same key to deep unprotect therefore crypto fails right and you get an exception",
    "start": "1052540",
    "end": "1059180"
  },
  {
    "text": "that the unprotected layer fails okay just to show you that there in fact is you know ciphertext and you know other",
    "start": "1059180",
    "end": "1065180"
  },
  {
    "text": "looking keyring looking crypto things alright so anyway that's the point of that okay questions about that right so",
    "start": "1065180",
    "end": "1082250"
  },
  {
    "text": "the question is about the decree okie rollin and then what if I what if I create a cookie that's protected with",
    "start": "1082250",
    "end": "1088970"
  },
  {
    "text": "the first key and then at that moment a second key gets created will that cookies still unprotect and so the key",
    "start": "1088970",
    "end": "1095210"
  },
  {
    "text": "rolling is for new protections but all the prior keys are still are possible in",
    "start": "1095210",
    "end": "1101780"
  },
  {
    "text": "the keyring four unpretentious so they keep around the old ones so that's actually a good point is that if you are",
    "start": "1101780",
    "end": "1106820"
  },
  {
    "text": "gonna build your own database or leave this on the filesystem keep the old ones right don't throw those away or rather",
    "start": "1106820",
    "end": "1112130"
  },
  {
    "text": "the ones that you can throw away or the ones that you are guaranteed that you don't have any still outstanding unprotected data right keys from two",
    "start": "1112130",
    "end": "1119480"
  },
  {
    "text": "years ago probably good to throw away okay cool that's what the key file looks",
    "start": "1119480",
    "end": "1126350"
  },
  {
    "text": "like this key data protection feature is used a couple actually several different areas in asp.net core it's used in the",
    "start": "1126350",
    "end": "1133610"
  },
  {
    "start": "1127000",
    "end": "1127000"
  },
  {
    "text": "cookie stuff that we just talked about so when you are using an authentication cookie right that's very important",
    "start": "1133610",
    "end": "1140059"
  },
  {
    "text": "cookie that needs to be data protected if you're using the anti forgery feature in asp net core which pretty much anybody with a postback is that is using",
    "start": "1140059",
    "end": "1148490"
  },
  {
    "text": "the data protection to derive that if you're using Open ID Connect or Google logins or anything else you're making",
    "start": "1148490",
    "end": "1155660"
  },
  {
    "text": "round trips out of your app over to Google and then back and there's data that's roundtrip this part of that that",
    "start": "1155660",
    "end": "1161030"
  },
  {
    "text": "needs to be protected as well if you're using the temp data feature in MVC where you can put like a little message in a",
    "start": "1161030",
    "end": "1166580"
  },
  {
    "text": "temp data and then a redirect to the next page and read out the temp data that is get that gets put into a cookie",
    "start": "1166580",
    "end": "1172190"
  },
  {
    "text": "and it also needs to be protected you know basically for integrity checks and as I mention here in my little demo I",
    "start": "1172190",
    "end": "1177950"
  },
  {
    "text": "actually didn't show you the code it probably should have but there you can use this yourself directly so you inject",
    "start": "1177950",
    "end": "1184070"
  },
  {
    "text": "into your controller constructor arguments the data protection provider you create a protector and then you can",
    "start": "1184070",
    "end": "1190100"
  },
  {
    "text": "use the protected that's okay pretty easy to use yes",
    "start": "1190100",
    "end": "1195220"
  },
  {
    "start": "1194000",
    "end": "1194000"
  },
  {
    "text": "question you're passing the what page to page an ID okay so well I mean so",
    "start": "1195220",
    "end": "1210550"
  },
  {
    "text": "whatever the data is let's not focus on an ID but whatever the data might be you actually protect the data and it gives",
    "start": "1210550",
    "end": "1217150"
  },
  {
    "text": "you back that gobbledygook I showed you in the demo and the gobbledygook is what you send over to the next page",
    "start": "1217150",
    "end": "1222240"
  },
  {
    "text": "so the gobbledygook has the original value and the checksum all lumped into one makes sense okay now you saw it was",
    "start": "1222240",
    "end": "1231550"
  },
  {
    "text": "big right that's the cost of doing the you know the encryption and the digital signature okay but you have integrity so",
    "start": "1231550",
    "end": "1238240"
  },
  {
    "text": "that's pretty darn important okay the next service that we need to talk",
    "start": "1238240",
    "end": "1243340"
  },
  {
    "text": "about in ASP that of course the authentication service this is basically the infrastructure that allows a user to",
    "start": "1243340",
    "end": "1248350"
  },
  {
    "text": "log into your system and so there are actually lots of different options here lots of features that Microsoft provides",
    "start": "1248350",
    "end": "1254710"
  },
  {
    "text": "one is obviously local authentication so we user can just walk up to your app enter a username and password and get",
    "start": "1254710",
    "end": "1260110"
  },
  {
    "text": "logged in they also have support for social logins so Facebook and Twitter",
    "start": "1260110",
    "end": "1265150"
  },
  {
    "text": "and that kind of thing Microsoft only provides four out of the box social logins but there is a contributor that",
    "start": "1265150",
    "end": "1271660"
  },
  {
    "text": "has about fifty more so Yahoo github battlenet right if you want to log in",
    "start": "1271660",
    "end": "1277810"
  },
  {
    "text": "with your Warcraft account untappd if you do the beer-drinking app right and you need to use that to log in all that",
    "start": "1277810",
    "end": "1284140"
  },
  {
    "text": "all the important ones are there okay so basically use social logins to get into",
    "start": "1284140",
    "end": "1289420"
  },
  {
    "text": "your app Microsoft also provides more enterprise grade authentication support",
    "start": "1289420",
    "end": "1295240"
  },
  {
    "text": "using the standards like Open ID Connect and WS Federation so that's actually really important with enterprises or",
    "start": "1295240",
    "end": "1301990"
  },
  {
    "text": "even your own you know act to Azure Active Directory logins where you want to be able to you know send the user up",
    "start": "1301990",
    "end": "1307870"
  },
  {
    "text": "there to login and then they come back to your app with their identity from that identity provider sam'l 2 P is",
    "start": "1307870",
    "end": "1314380"
  },
  {
    "text": "another very popular not so much in the Microsoft bit space but in more in the Java space protocol it is not supported",
    "start": "1314380",
    "end": "1321640"
  },
  {
    "text": "by Microsoft but there is another open-source project out there by a guy named Anders able from",
    "start": "1321640",
    "end": "1326859"
  },
  {
    "text": "sustained stress sustained sis he builds this sam'l provider that fits right into",
    "start": "1326859",
    "end": "1332440"
  },
  {
    "text": "a SPI net core so that's actually you know great easy to use and it works well",
    "start": "1332440",
    "end": "1337679"
  },
  {
    "text": "there's also support for JSON web tokens that's basically if you're gonna be doing API security with a token so",
    "start": "1337679",
    "end": "1344769"
  },
  {
    "text": "there's support that Microsoft has for that as well okay and then no matter how you're gonna log in at least with one of",
    "start": "1344769",
    "end": "1350799"
  },
  {
    "text": "the interactive options with a user you need to manage the authentication session for that user",
    "start": "1350799",
    "end": "1356200"
  },
  {
    "text": "which is basically backed by a cookie so there is a cookie you know component",
    "start": "1356200",
    "end": "1361599"
  },
  {
    "text": "that will help you manage that okay the way the authentication system works in asp net core is that there are is a",
    "start": "1361599",
    "end": "1368469"
  },
  {
    "text": "service in the DI container and then what you do is you register handlers",
    "start": "1368469",
    "end": "1373570"
  },
  {
    "text": "which are like there's like a micro framework so there are these handlers that will do the specific ones that you",
    "start": "1373570",
    "end": "1380320"
  },
  {
    "text": "want so there's a handler for google there's a handler for facebook there's a handler for cookies and so on and so",
    "start": "1380320",
    "end": "1386379"
  },
  {
    "text": "forth so what an example of setting up an application would look like is that in your di configuration when configure",
    "start": "1386379",
    "end": "1392889"
  },
  {
    "start": "1390000",
    "end": "1390000"
  },
  {
    "text": "services you would call a doll indication that adds the general authentication services you then add",
    "start": "1392889",
    "end": "1398169"
  },
  {
    "text": "cookies Google and open ID connect because those are the particular handlers that this application wants to",
    "start": "1398169",
    "end": "1404019"
  },
  {
    "text": "use so you want to do session management with cookies and you want to allow the user to go to Google login and you want",
    "start": "1404019",
    "end": "1409269"
  },
  {
    "text": "to allow the user to go to some open ID connect provider to login okay whenever",
    "start": "1409269",
    "end": "1414459"
  },
  {
    "text": "you register these handlers you give them a name and that's that scheme that's associated with each one that's",
    "start": "1414459",
    "end": "1420759"
  },
  {
    "text": "so that in your application when you want to talk to one of these guys you talk to them via than the scheme name",
    "start": "1420759",
    "end": "1426849"
  },
  {
    "text": "okay it turns out you actually don't talk to them directly you're required to go through this service called the",
    "start": "1426849",
    "end": "1432729"
  },
  {
    "text": "authentication service so this is like an Orchestrator or an abstraction over",
    "start": "1432729",
    "end": "1438190"
  },
  {
    "text": "those handlers and it provides you a sort of a consistent API for the types",
    "start": "1438190",
    "end": "1443440"
  },
  {
    "text": "of things you would want to communicate to the handlers okay so the first method is something called",
    "start": "1443440",
    "end": "1448959"
  },
  {
    "text": "authenticate async this basically says I want to read the incoming request and know who the user is",
    "start": "1448959",
    "end": "1456179"
  },
  {
    "text": "okay now when you call this this basically says I want to read the request so that's perfect for a cookie",
    "start": "1456179",
    "end": "1461580"
  },
  {
    "text": "right imagine every single request coming in you're gonna read the cookie now you don't want to write that code and every single one of your action",
    "start": "1461580",
    "end": "1467879"
  },
  {
    "text": "methods or whatever so a very typical pattern is you would put a piece of middleware in the pipeline to sit in",
    "start": "1467879",
    "end": "1474210"
  },
  {
    "text": "front of the rest your app to do that and that's exactly what the authentication middleware does it's its sole purpose in life well for the most",
    "start": "1474210",
    "end": "1480779"
  },
  {
    "text": "part but it's its primary purpose is to crawl this authenticate method up here",
    "start": "1480779",
    "end": "1486059"
  },
  {
    "text": "and what it does is it calls authenticate now there's a parameter",
    "start": "1486059",
    "end": "1491190"
  },
  {
    "text": "called scheme and it basically says hey I want to read the request because I want one of these handlers to trigger",
    "start": "1491190",
    "end": "1497720"
  },
  {
    "text": "now we know that it's really the cookie that we want to read on every request so I didn't use a any kind of configuration",
    "start": "1497720",
    "end": "1505529"
  },
  {
    "text": "down here in the user authentication so which of the three handlers runs right well you can pass null for the scheme",
    "start": "1505529",
    "end": "1512429"
  },
  {
    "text": "and if you do what you're saying is you would like whichever one you've marked as the default to run so basically now on every",
    "start": "1512429",
    "end": "1520830"
  },
  {
    "text": "single request use authentication calls the authenticate method passing a null scheme the null scheme means oh use",
    "start": "1520830",
    "end": "1527610"
  },
  {
    "text": "cookies we go to the cookie handler we let hit to his job it reads the cookie if the cookie produces a valid user then",
    "start": "1527610",
    "end": "1536369"
  },
  {
    "text": "the authentication middleware sets the user on the HTTP context so now the rest",
    "start": "1536369",
    "end": "1542399"
  },
  {
    "text": "of the requests in the pipeline has a user object okay if there was a cookie and it validated because of data",
    "start": "1542399",
    "end": "1548730"
  },
  {
    "text": "protection all right the other methods use all here sign-in and sign-out are",
    "start": "1548730",
    "end": "1554279"
  },
  {
    "text": "the two methods for doing off nth occation session management sign-in basically says create a cookie sign out",
    "start": "1554279",
    "end": "1560639"
  },
  {
    "text": "says delete the cookie very simple right so if you're building a login page well after you've validated a password you'll",
    "start": "1560639",
    "end": "1566999"
  },
  {
    "text": "call sign-in if the user clicks sign out you'll call sign out challenge is the method that says hey",
    "start": "1566999",
    "end": "1573509"
  },
  {
    "text": "you know what the users anonymous I need to redirect them to go login okay so the",
    "start": "1573509",
    "end": "1580529"
  },
  {
    "text": "scheme is a very important parameter here because what it does is it identifies oh do I want to send them to",
    "start": "1580529",
    "end": "1586080"
  },
  {
    "text": "Google or Facebook or open ID Connect or what so that challenge method basically kind",
    "start": "1586080",
    "end": "1591539"
  },
  {
    "text": "of lets you you know indicate which one to trigger if you happen to trigger cookies well cookies is your session management",
    "start": "1591539",
    "end": "1598950"
  },
  {
    "text": "but it also kind of has the notion of saying oh I need to go get the user logged in but the assumption is that's a",
    "start": "1598950",
    "end": "1604320"
  },
  {
    "text": "local login so you would need to configure what you know local you are or what path in your app is gonna have your",
    "start": "1604320",
    "end": "1610890"
  },
  {
    "text": "your login page okay and forbid is the last method and that basically says hey you know I know",
    "start": "1610890",
    "end": "1616559"
  },
  {
    "text": "who the user is they're just not allowed to be here okay and so forbid generally triggers like an error page or an access denied page",
    "start": "1616559",
    "end": "1624649"
  },
  {
    "text": "there are a bunch of extension methods on the HTTP context to wrap that up to make it more convenient so I'll just",
    "start": "1624649",
    "end": "1631080"
  },
  {
    "start": "1631000",
    "end": "1631000"
  },
  {
    "text": "leave those there and here's an example of an application that is just doing cookies for example so the idea is that",
    "start": "1631080",
    "end": "1636990"
  },
  {
    "text": "maybe I'm just doing local logins so I've configured authentication the scheme is the default scheme is cookies",
    "start": "1636990",
    "end": "1642720"
  },
  {
    "text": "I only have a cookie authentication Handler and notice I'm configuring like the login path so when we call challenge",
    "start": "1642720",
    "end": "1649529"
  },
  {
    "text": "on cookies that will redirect the user to the local login then you can",
    "start": "1649529",
    "end": "1655529"
  },
  {
    "text": "configure the aspects of the cookie like the name of the cookie how long you want it to be does it slide does it have the same site flag and then how do you talk",
    "start": "1655529",
    "end": "1664980"
  },
  {
    "text": "to the cookie handler to actually issue the cookie or you know get rid of the cookie well this is what something like",
    "start": "1664980",
    "end": "1670409"
  },
  {
    "text": "your your login page might have so once the user has entered a username and password what we will do is look them up",
    "start": "1670409",
    "end": "1676320"
  },
  {
    "text": "in the database validate the password okay how we do that well again that's up to you I'm going to talk about asp.net",
    "start": "1676320",
    "end": "1683190"
  },
  {
    "text": "identity in a minute which is the Microsoft library for doing that but actually this is a very important",
    "start": "1683190",
    "end": "1688710"
  },
  {
    "text": "distinction that library identity is how they call it or asp.net identity that's",
    "start": "1688710",
    "end": "1694669"
  },
  {
    "text": "unrelated actually what I'm showing you here right I mean you probably used them together but strictly speaking you don't",
    "start": "1694669",
    "end": "1700770"
  },
  {
    "text": "have to use that this is the code it takes to just get a user logged in regardless of where you keep their",
    "start": "1700770",
    "end": "1705990"
  },
  {
    "text": "password so what we do is we create a list of claims this is modeling the information about the user that we care",
    "start": "1705990",
    "end": "1712049"
  },
  {
    "text": "about so sub is usually the users unique ID subject identifier and then we also",
    "start": "1712049",
    "end": "1717419"
  },
  {
    "text": "say oh I know you know it's Bob so I'll set the name claim and we create a claims identity class",
    "start": "1717419",
    "end": "1722800"
  },
  {
    "text": "and then down here at the sign-in call we pass that in and those claims",
    "start": "1722800",
    "end": "1728310"
  },
  {
    "text": "basically become the information that's written out to the cookie so now our",
    "start": "1728310",
    "end": "1733480"
  },
  {
    "text": "cookie contains the users unique ID one two three and their display name Bob so",
    "start": "1733480",
    "end": "1739240"
  },
  {
    "text": "you can you know show it later so your login page has to decide what claims you want to basically serialize into the",
    "start": "1739240",
    "end": "1745540"
  },
  {
    "text": "cookie now when you issue a cookie with asp.net core the authentication cookie",
    "start": "1745540",
    "end": "1751380"
  },
  {
    "text": "the cookie has the claims which is the information about the user but it also has this other section which is like a",
    "start": "1751380",
    "end": "1757720"
  },
  {
    "text": "dictionary and you could just put arbitrary other you know metadata if you want in there and so that's what this",
    "start": "1757720",
    "end": "1764320"
  },
  {
    "text": "authentication properties is is basically you can stick whatever you want to in this items collection that will also get written to the cookie okay",
    "start": "1764320",
    "end": "1771130"
  },
  {
    "text": "and then you can read that out later for whatever whatever you might need that's",
    "start": "1771130",
    "end": "1776410"
  },
  {
    "text": "actually how internally they keep track of like the expiration right you're supposed to expire you know the cookie",
    "start": "1776410",
    "end": "1781720"
  },
  {
    "text": "supposed to expire in 20 minutes they actually internally use the same dictionary the sign out method at the",
    "start": "1781720",
    "end": "1789700"
  },
  {
    "text": "bottom here is actually then what we call to delete the cookie okay all right",
    "start": "1789700",
    "end": "1794770"
  },
  {
    "text": "good there are a few other features on the cookie handler actually all the",
    "start": "1794770",
    "end": "1801610"
  },
  {
    "start": "1797000",
    "end": "1797000"
  },
  {
    "text": "handlers have this eventing model where when sort of interesting internal",
    "start": "1801610",
    "end": "1807750"
  },
  {
    "text": "processing is occuring they'll raise an event and so for the cookie when a couple of interesting events are so the",
    "start": "1807750",
    "end": "1815620"
  },
  {
    "text": "the cookie comes into your application the authenticate gets called because we have the middle where the cookie will",
    "start": "1815620",
    "end": "1821140"
  },
  {
    "text": "read the the cookie handler will read the cookie validate it with data protection everything looks good and",
    "start": "1821140",
    "end": "1826840"
  },
  {
    "text": "then it will raise an event which is called validate user right basically gives you a hook after the cookies been",
    "start": "1826840",
    "end": "1833830"
  },
  {
    "text": "checked out to see if you actually want to accept the cookie or accept that",
    "start": "1833830",
    "end": "1838840"
  },
  {
    "text": "request from that user gives you a chance to maybe like look up in the database right but cookie says it's Bob",
    "start": "1838840",
    "end": "1844330"
  },
  {
    "text": "well you look up in the database but maybe see if Bob's really been deactivated and you can reject this so that the cookie is not actually trusted",
    "start": "1844330",
    "end": "1851350"
  },
  {
    "text": "there are also events around redirecting for sign redirecting for sign-out and so on and",
    "start": "1851350",
    "end": "1856399"
  },
  {
    "text": "so forth now one of the other things about the cookie handler that's good to be aware of is remember I said that we",
    "start": "1856399",
    "end": "1862610"
  },
  {
    "text": "could put claims into the cookie we can put this arbitrary you know dictionary with arbitrary data well that's gonna",
    "start": "1862610",
    "end": "1868789"
  },
  {
    "text": "make your cookie bigger and bigger and bigger the more stuff you put in there okay how big can your cookie be well it",
    "start": "1868789",
    "end": "1878690"
  },
  {
    "text": "depends that's the consult answer of course do you have to sit the real the",
    "start": "1878690",
    "end": "1884330"
  },
  {
    "text": "real question is this do you have to support Safari on iOS if the answer is no then you have a lot of space in that",
    "start": "1884330",
    "end": "1891710"
  },
  {
    "text": "cookie like 16k of data okay if you have to support Safari on iOS then you have",
    "start": "1891710",
    "end": "1897919"
  },
  {
    "text": "very very little space your entire domain has to have less than 4 K of cookies and it doesn't take long to get",
    "start": "1897919",
    "end": "1905090"
  },
  {
    "text": "up there ok so that's not just one cookie that's all the cookies so Safari on iOS we'll just start throwing away",
    "start": "1905090",
    "end": "1910970"
  },
  {
    "text": "cookies randomly and the user all sudden will be you know like logged out okay so how do you mitigate against that well",
    "start": "1910970",
    "end": "1917750"
  },
  {
    "text": "you can instead of serializing all those claims and that dictionary into the cookie proper you can actually implement",
    "start": "1917750",
    "end": "1923779"
  },
  {
    "text": "a storage mechanism that stays server-side ok but that means you now have to have a database that puts the",
    "start": "1923779",
    "end": "1929240"
  },
  {
    "text": "blob of data and then what gets written to the cookie is just a you know an identifier ok so at least it'll make the",
    "start": "1929240",
    "end": "1934850"
  },
  {
    "text": "cookie a lot smaller that's kind of cool though actually I like that feature because it allows server-side revocation",
    "start": "1934850",
    "end": "1940940"
  },
  {
    "text": "right let's say your admin decides hey that user right I'm gonna kick him out of the website well how do you go to",
    "start": "1940940",
    "end": "1946880"
  },
  {
    "text": "that users browser and delete their cookie yeah it's not gonna happen so what you can delete the record in the",
    "start": "1946880",
    "end": "1952130"
  },
  {
    "text": "database and now the cookie won't match right and they will be considered anonymous ok cool another feature then",
    "start": "1952130",
    "end": "1961159"
  },
  {
    "start": "1959000",
    "end": "1959000"
  },
  {
    "text": "of the authentication system is this concept of external authentication right being able to do a hey you know password in your app is great but it's better if",
    "start": "1961159",
    "end": "1969440"
  },
  {
    "text": "you don't have to deal with passwords ok so the architecture that we tend to move towards is getting credentials out of",
    "start": "1969440",
    "end": "1975740"
  },
  {
    "text": "your app your app instead trust something else to log the user in usually some sort of single sign-on",
    "start": "1975740",
    "end": "1982279"
  },
  {
    "text": "server ok so you could trust something like Google or you could trust Azure Active Directory",
    "start": "1982279",
    "end": "1987980"
  },
  {
    "text": "you could build your own very very common pattern okay and the basic workflow is this when the user indicates",
    "start": "1987980",
    "end": "1994549"
  },
  {
    "text": "that they want to go login with the external provider that's where you call the challenge method and challenge",
    "start": "1994549",
    "end": "2000520"
  },
  {
    "text": "basically triggers whichever handler Google Facebook Open ID Connect and it redirects the user away from your",
    "start": "2000520",
    "end": "2006220"
  },
  {
    "text": "application okay they're gone from your app so that's an interesting workflow",
    "start": "2006220",
    "end": "2011500"
  },
  {
    "text": "right you're used to having the user redirect all within your app they're now gone and you don't know when they're coming back hopefully it'll be soon",
    "start": "2011500",
    "end": "2018520"
  },
  {
    "text": "right but you don't know so the workflow then is that they're gone from your app they go to Google they log in and",
    "start": "2018520",
    "end": "2024520"
  },
  {
    "text": "eventually Google redirects the user back into your app to what's called a redirect URI or there's a callback path",
    "start": "2024520",
    "end": "2030070"
  },
  {
    "text": "in your app and it's sort of the dedicated landing place for the user after Google okay or after Facebook or",
    "start": "2030070",
    "end": "2037059"
  },
  {
    "text": "whatever and your app has to continue processing from there as if the user you know is still in their middle of their",
    "start": "2037059",
    "end": "2042640"
  },
  {
    "text": "their login workflow usually that's all handled by the authentication handler so that's good but yeah okay",
    "start": "2042640",
    "end": "2050350"
  },
  {
    "start": "2049000",
    "end": "2049000"
  },
  {
    "text": "so here's an example of what that would look like to use Open ID Connect so open ID Connect is a protocol for",
    "start": "2050350",
    "end": "2056530"
  },
  {
    "text": "authentication it allows a user to go to a different identity provider to login and then your app can get the result of",
    "start": "2056530",
    "end": "2061690"
  },
  {
    "text": "that and your app doesn't have to collect the credential one thing when they come back from the external provider though they do need to have an",
    "start": "2061690",
    "end": "2068470"
  },
  {
    "text": "authentication session in your app so notice we still have to use cookies because the result of the external",
    "start": "2068470",
    "end": "2075368"
  },
  {
    "text": "authentication that's just like a one-time handshake and as that's complete you want to keep",
    "start": "2075369",
    "end": "2081158"
  },
  {
    "text": "track of the user so the external authentication will result in a cookie within your application so we have to",
    "start": "2081159",
    "end": "2087490"
  },
  {
    "text": "have cookies and that we add open ID Connect there's a bunch of coordinates you have to configure to make that protocol work okay and now what will",
    "start": "2087490",
    "end": "2094540"
  },
  {
    "text": "happen is you want the cookie to be read on every request so notice we've marked",
    "start": "2094540",
    "end": "2100869"
  },
  {
    "text": "that as the default scheme okay but when you call challenge like if you have the",
    "start": "2100869",
    "end": "2106000"
  },
  {
    "text": "authorized attribute hmm authorize is going to trigger the default scheme we",
    "start": "2106000",
    "end": "2112480"
  },
  {
    "text": "don't want to do cookies because the whole point of this is not to have a local login so when you configure these",
    "start": "2112480",
    "end": "2117700"
  },
  {
    "text": "defaults you can actually have a default that's different for one of those five different methods",
    "start": "2117700",
    "end": "2122950"
  },
  {
    "text": "so when the internal system calls challenge which is what the authorized attribute does it'll instead trigger the",
    "start": "2122950",
    "end": "2128680"
  },
  {
    "text": "OID C one and that sends the user out token ID Connect but when it comes back and issues the sign-in method and the",
    "start": "2128680",
    "end": "2135160"
  },
  {
    "text": "sign out and the and the the reading of every request it'll use cookies instead so it's a nice little way to kind of mix",
    "start": "2135160",
    "end": "2141760"
  },
  {
    "text": "both together all right I have a demo for all this I'm leading up to it I have",
    "start": "2141760",
    "end": "2147190"
  },
  {
    "start": "2143000",
    "end": "2143000"
  },
  {
    "text": "to show you all the parts and then I'll show you the demo the last thing that you might be want to be aware of is for",
    "start": "2147190",
    "end": "2153850"
  },
  {
    "text": "api's the typical approach for securing web api is is using a token based architecture so we typically use",
    "start": "2153850",
    "end": "2159610"
  },
  {
    "text": "something called a JWT or jot as the pronunciation goes and basically your web api i actually highly encourage you",
    "start": "2159610",
    "end": "2167260"
  },
  {
    "text": "to set up your web api in a separate project just keeps it cleaner okay now the web api project you only",
    "start": "2167260",
    "end": "2173260"
  },
  {
    "text": "have jots in your pipeline terms of authentication and micro Microsoft provides a you know handler for JSON web",
    "start": "2173260",
    "end": "2181240"
  },
  {
    "text": "tokens using called the job bearer authentication handler okay so that's",
    "start": "2181240",
    "end": "2186430"
  },
  {
    "text": "how you might protect your api's so I have a demo of this so this demo has",
    "start": "2186430",
    "end": "2193930"
  },
  {
    "text": "actually many many moving parts of a whole bunch of things I just talked about this so the first thing is the startup code the startup code basically",
    "start": "2193930",
    "end": "2200260"
  },
  {
    "text": "is where we say yes I want to do cookies right so I'm going to do local session",
    "start": "2200260",
    "end": "2206620"
  },
  {
    "text": "tracking but I want to log my users in externally using Open ID Connect okay so",
    "start": "2206620",
    "end": "2211840"
  },
  {
    "text": "I have those configured and I show you the default schemas cookies but the challenge default challenge scheme is",
    "start": "2211840",
    "end": "2217000"
  },
  {
    "text": "open ID Connect like I just talked about I have a home controller right when you come in here yeah you can be anonymous",
    "start": "2217000",
    "end": "2223480"
  },
  {
    "text": "to come here but when I click the secure link authorize says I need a logged in",
    "start": "2223480",
    "end": "2228940"
  },
  {
    "text": "user so authorize internally it calls the authentication system and it calls the",
    "start": "2228940",
    "end": "2235420"
  },
  {
    "text": "challenge method if the users not authenticated and that's where we get back to this where it says oh I'm calling challenge who do i trigger",
    "start": "2235420",
    "end": "2241570"
  },
  {
    "text": "challenge on oh that guy open ID connect ok run this and that says go elsewhere",
    "start": "2241570",
    "end": "2247600"
  },
  {
    "text": "to go login ok when this thing comes back it issues a cookie using the sign-in method sign-in gets called",
    "start": "2247600",
    "end": "2255190"
  },
  {
    "text": "and it triggers the default cookie and then we'll have a cookie in our app and then when we go to the secure page what",
    "start": "2255190",
    "end": "2261310"
  },
  {
    "text": "I'm showing you here once we finally make it all the way back I'm showing you",
    "start": "2261310",
    "end": "2266319"
  },
  {
    "text": "the claims that are in the cookie and I'm showing you that dictionary remember I said the the cookie has the claims and",
    "start": "2266319",
    "end": "2272470"
  },
  {
    "text": "that dictionary of key value pairs so let's just run this and see if this bit",
    "start": "2272470",
    "end": "2278050"
  },
  {
    "text": "works okay I hit my secure link okay I'm",
    "start": "2278050",
    "end": "2288069"
  },
  {
    "text": "in localhost 3 308 now I'm out right I'm off in some other website which is my identity provider that's where my users",
    "start": "2288069",
    "end": "2295150"
  },
  {
    "text": "have their credentials right so I'm gonna log in with Alice and Alice right",
    "start": "2295150",
    "end": "2302309"
  },
  {
    "text": "the web is working today hmm that seems",
    "start": "2303480",
    "end": "2313930"
  },
  {
    "text": "slow very very bizarre hmm Google okay",
    "start": "2313930",
    "end": "2329790"
  },
  {
    "text": "okay we're it's hosted in Azure so okay allow",
    "start": "2331290",
    "end": "2336550"
  },
  {
    "text": "then we come back alright so basically we completed the workflow what ended up",
    "start": "2336550",
    "end": "2341650"
  },
  {
    "text": "happening is as a result of all of that notice now I have a cookie called cookies which happens to line up with",
    "start": "2341650",
    "end": "2348310"
  },
  {
    "text": "the name of my authentication scheme that I was calling it here right if you could set up name you would see the name",
    "start": "2348310",
    "end": "2353410"
  },
  {
    "text": "here and notice what's in the cookie then is we have a bunch of claims these are the claims that came back from the",
    "start": "2353410",
    "end": "2359589"
  },
  {
    "text": "external identity provider we have a bunch of properties with a bunch of junk in here as well and the thing I want to",
    "start": "2359589",
    "end": "2364780"
  },
  {
    "text": "show you is look how quickly we got above 4k right just with that little bit of data right so that's actually pretty",
    "start": "2364780",
    "end": "2372250"
  },
  {
    "text": "easy to get up there with you know just a few more claims okay the other thing I",
    "start": "2372250",
    "end": "2378280"
  },
  {
    "text": "want to show you then is that this app wants to call an API right hmm I need a token for that right that's the the",
    "start": "2378280",
    "end": "2384579"
  },
  {
    "text": "architectural pattern these days so it turns out that when I was request a login from my login provider I was",
    "start": "2384579",
    "end": "2391240"
  },
  {
    "text": "also asking for access to this API and so what handed up getting back was in",
    "start": "2391240",
    "end": "2396400"
  },
  {
    "text": "addition to all of the identity information about the user like their name and their email and so on and so",
    "start": "2396400",
    "end": "2401890"
  },
  {
    "text": "forth I now have this thing called an access token and the access token if we pop open a website called JMS pop that",
    "start": "2401890",
    "end": "2409869"
  },
  {
    "text": "access token in there notice we have this JSON data structure that's where",
    "start": "2409869",
    "end": "2415000"
  },
  {
    "text": "the j and jot comes from it's a JSON object that is digitally signed by the",
    "start": "2415000",
    "end": "2420190"
  },
  {
    "text": "token server and it contains claims about my user so my subject identifier",
    "start": "2420190",
    "end": "2425799"
  },
  {
    "text": "which is the most important thing about the user that's the users unique ID if I go back to my login app if I go up here",
    "start": "2425799",
    "end": "2432130"
  },
  {
    "text": "yeah sub1 that is Alice's unique ID okay so I can use that now to call an API so",
    "start": "2432130",
    "end": "2440950"
  },
  {
    "text": "what API do on a call will have another project here called API let me run this guy so it's another project in Visual",
    "start": "2440950",
    "end": "2447670"
  },
  {
    "text": "Studio I go to my startup for this guy and notice I'm then using authentication but",
    "start": "2447670",
    "end": "2453339"
  },
  {
    "text": "in this case I'm only accepting tokens I'm accepting jot bearer tokens and it should come from that same login",
    "start": "2453339",
    "end": "2459460"
  },
  {
    "text": "provider that my app just used to login the user okay so now when I go back to",
    "start": "2459460",
    "end": "2465430"
  },
  {
    "text": "my app wherever it was and I call my API I want to this is a request into my web",
    "start": "2465430",
    "end": "2473349"
  },
  {
    "text": "server the web server then has to make another network hop to the API so it's a server to server call from the",
    "start": "2473349",
    "end": "2479740"
  },
  {
    "text": "server-side MVC to the web api server but an I want it to be on behalf of the user and that's why we're using that",
    "start": "2479740",
    "end": "2485859"
  },
  {
    "text": "token so if I go into the home controller when I call the API I can reach in to the cookie that has the",
    "start": "2485859",
    "end": "2493569"
  },
  {
    "text": "dictionary I can ask for that access token I create an HTTP client and I'm",
    "start": "2493569",
    "end": "2499210"
  },
  {
    "text": "setting the bearer token I'm setting this as the authorization header when we call to the Web API and that",
    "start": "2499210",
    "end": "2506470"
  },
  {
    "text": "authorization header is going to contain basically wherever it went this jot",
    "start": "2506470",
    "end": "2512140"
  },
  {
    "text": "information when it shows up the web api the web api will decode that validate it",
    "start": "2512140",
    "end": "2517210"
  },
  {
    "text": "and know who my user is so if I hit the button here",
    "start": "2517210",
    "end": "2523049"
  },
  {
    "text": "here we go so that basically called the web api successfully I got the results back and",
    "start": "2523350",
    "end": "2529420"
  },
  {
    "text": "we're just echoing back what was in the access token so the Web API saw that the users unique ID was one okay questions about that yep",
    "start": "2529420",
    "end": "2541150"
  },
  {
    "text": "question yep yep yeah so that there's a",
    "start": "2541150",
    "end": "2558250"
  },
  {
    "text": "little bit of history there and maybe a little bit beyond the time we have to talk about here to answer the question the question is why do I have this",
    "start": "2558250",
    "end": "2563560"
  },
  {
    "text": "audience thing and this scope thing they're actually pretty much the same thing as long as you're validating one",
    "start": "2563560",
    "end": "2570220"
  },
  {
    "text": "of them you're good okay come and grab me afterwards and I gave you the history behind why we have to",
    "start": "2570220",
    "end": "2575550"
  },
  {
    "text": "it's basically because they're two different specs and one specs is you have to do one one spec says you have to",
    "start": "2575550",
    "end": "2580660"
  },
  {
    "text": "do the other and I'm actually using both specs at the same time so I have to satisfy both okay okay cool",
    "start": "2580660",
    "end": "2589350"
  },
  {
    "text": "questions other questions one other issue with access tokens is that access",
    "start": "2589350",
    "end": "2595330"
  },
  {
    "text": "tokens expire right if you scroll down here a little bit it's gonna say hey your access tokens going to expire in",
    "start": "2595330",
    "end": "2600640"
  },
  {
    "text": "some amount of time usually it's about an hour so the problem here is that now you're calling on your MVC app over to",
    "start": "2600640",
    "end": "2606640"
  },
  {
    "text": "the Web API you're calling the API you're calling the API it works it works it works and then all of a sudden you get a 401 and 401 means hey your access",
    "start": "2606640",
    "end": "2613570"
  },
  {
    "text": "tokens no good anymore you have to go get a new access token and I think we lost our projector here so what do you",
    "start": "2613570",
    "end": "2621310"
  },
  {
    "text": "do well we need to go and somehow get a new access token now what I don't want to do is redirect my user and the main",
    "start": "2621310",
    "end": "2627430"
  },
  {
    "text": "browser all the way and come back so the protocol has something called refresh tokens and a refresh token this way you",
    "start": "2627430",
    "end": "2633490"
  },
  {
    "text": "can programmatically go back to the token server from your MVC app and get a new access token okay great well you",
    "start": "2633490",
    "end": "2639760"
  },
  {
    "text": "have to write that code unfortunately Microsoft doesn't provide anything so what we've done here is a kind of a",
    "start": "2639760",
    "end": "2645970"
  },
  {
    "text": "nifty little sample is we have this little addition called add automatic",
    "start": "2645970",
    "end": "2651160"
  },
  {
    "text": "token management what's happening is this is just a some extensibility points are taking",
    "start": "2651160",
    "end": "2656230"
  },
  {
    "text": "advantage of the extensibility points of a cookie and what it's registering is member has said the cookie raises events",
    "start": "2656230",
    "end": "2662890"
  },
  {
    "text": "the cookie handler we're tapping into those events and remember the validate method that's where the user has been",
    "start": "2662890",
    "end": "2669130"
  },
  {
    "text": "validated from the cookie right you get to look at the claims okay before the rest of the request goes so we're not",
    "start": "2669130",
    "end": "2675370"
  },
  {
    "text": "doing it necessarily to reject the user but what we're doing this using this force a hook every time the cookie comes",
    "start": "2675370",
    "end": "2680950"
  },
  {
    "text": "in I'm actually extracting the tokens from that cookie I'm looking for my",
    "start": "2680950",
    "end": "2686470"
  },
  {
    "text": "refresh token I'm checking for the expiration and if my expiration is you know within near you know some soon time",
    "start": "2686470",
    "end": "2694900"
  },
  {
    "text": "right which I think we default to one minute right yeah nope wrong one if the",
    "start": "2694900",
    "end": "2702600"
  },
  {
    "text": "there we go yeah we're basically saying hey if we're within one minute of expiration then",
    "start": "2702600",
    "end": "2709450"
  },
  {
    "text": "let's go you know renew the token so we basically go off and go back to the token server",
    "start": "2709450",
    "end": "2714640"
  },
  {
    "text": "get the results and then what we do is we actually get the updated access token and we update your cookie with the",
    "start": "2714640",
    "end": "2721630"
  },
  {
    "text": "results because we have to restore them okay so I've been talking for over a minute this access token actually",
    "start": "2721630",
    "end": "2727360"
  },
  {
    "text": "expires in one minute so I'm gonna hit refresh here and notice the access token should change and the Refresh token",
    "start": "2727360",
    "end": "2733930"
  },
  {
    "text": "probably should change so yeah I hit refresh they changed that showed that",
    "start": "2733930",
    "end": "2739060"
  },
  {
    "text": "this requests coming in right triggered that and said oh I need to go get new one so if I hit refresh right now yeah",
    "start": "2739060",
    "end": "2745360"
  },
  {
    "text": "they're not changing but if wait long enough again I forget what the expiration it's I think it's two minutes",
    "start": "2745360",
    "end": "2751420"
  },
  {
    "text": "we should see it happen again yeah there we go okay so the point is this is illustrating the usage of the",
    "start": "2751420",
    "end": "2758080"
  },
  {
    "text": "events off of the cookie we also do this at sign out time we're handling the sign",
    "start": "2758080",
    "end": "2763600"
  },
  {
    "text": "out time of the cookie to go and revoke the token as well from the token server so nice little demo kind of showing all",
    "start": "2763600",
    "end": "2770410"
  },
  {
    "text": "these little pieces all working together in one application okay I have 15",
    "start": "2770410",
    "end": "2777550"
  },
  {
    "text": "minutes left so I got a hurry the next feature is the authorization feature from asp.net core so the authorization",
    "start": "2777550",
    "end": "2784840"
  },
  {
    "text": "feature is completely rewritten in asp.net core mainly to move away the role centric model of the prior asp.net",
    "start": "2784840",
    "end": "2792770"
  },
  {
    "text": "so you're familiar with the role based approach where you put authorize and you put a comma-separated list of roles",
    "start": "2792770",
    "end": "2798110"
  },
  {
    "text": "right that's very very coarse-grained doesn't give you a lot of fine-grained control the comma-separated list is now",
    "start": "2798110",
    "end": "2806060"
  },
  {
    "text": "your logic right if you ever that logic in more than one place you've got to copy that all over the place I had a",
    "start": "2806060",
    "end": "2811160"
  },
  {
    "text": "customer who had that authorized attribute everywhere that whenever they have a change to the logic they actually",
    "start": "2811160",
    "end": "2817400"
  },
  {
    "text": "couldn't go find it all so they actually wrote a tool to read their entire code base find the authorized attribute find",
    "start": "2817400",
    "end": "2823460"
  },
  {
    "text": "the role they were talking about and then rewrite all their code out with the new value if you're doing that",
    "start": "2823460",
    "end": "2828470"
  },
  {
    "text": "something's wrong right so this authorization framework that's new in asp net core is called policy",
    "start": "2828470",
    "end": "2833780"
  },
  {
    "text": "based off authorization and it's actually quite nice because it helps point us in the direction of of a better",
    "start": "2833780",
    "end": "2841550"
  },
  {
    "text": "pattern okay the better pattern is basically just giving us a level of indirection okay so",
    "start": "2841550",
    "end": "2847490"
  },
  {
    "start": "2844000",
    "end": "2844000"
  },
  {
    "text": "this isn't quite rocket science right it's it's it's what we use in computer science to solve any problem except for",
    "start": "2847490",
    "end": "2853040"
  },
  {
    "text": "performance of course is we put a level of dreaming direction in so notice at the bottom here I have the authorized",
    "start": "2853040",
    "end": "2858170"
  },
  {
    "text": "attribute it does not have a list of roles it has kind of like a permission name called manage customers that is",
    "start": "2858170",
    "end": "2865190"
  },
  {
    "text": "using the new policy system it basically says the user has to satisfy this policy",
    "start": "2865190",
    "end": "2870920"
  },
  {
    "text": "called manage customers to get into the method okay well where's the policy it's not here well that's what the code on",
    "start": "2870920",
    "end": "2876920"
  },
  {
    "text": "the top left is the code on the top left is basically creating a policy so we're adding the authorization services to di",
    "start": "2876920",
    "end": "2883910"
  },
  {
    "text": "we are creating a policy called manage customers and a policy is a list of",
    "start": "2883910",
    "end": "2889040"
  },
  {
    "text": "requirements the requirements are things that the user has to satisfy to satisfy",
    "start": "2889040",
    "end": "2895910"
  },
  {
    "text": "the entire policy so there are three requirements and the user has to satisfy all three the first one is of course the",
    "start": "2895910",
    "end": "2902300"
  },
  {
    "text": "user has to be authenticated okay you have to be authenticated to get in sure you also have to have a claim called",
    "start": "2902300",
    "end": "2908120"
  },
  {
    "text": "department sales and you also have to have a status of senior and if one of those doesn't match or doesn't pass you",
    "start": "2908120",
    "end": "2914750"
  },
  {
    "text": "failed the policy and you get rejected from method okay the beauty here now is my",
    "start": "2914750",
    "end": "2921760"
  },
  {
    "text": "logic is in one place if I choose to change the rules change about you know",
    "start": "2921760",
    "end": "2927250"
  },
  {
    "text": "who can manage customers I have one place to do it all right I don't have to go and search through my entire code base for everywhere I use that role for",
    "start": "2927250",
    "end": "2934180"
  },
  {
    "text": "example also we can call this programmatically the authorization",
    "start": "2934180",
    "end": "2940150"
  },
  {
    "start": "2936000",
    "end": "2936000"
  },
  {
    "text": "service is actually a service in DI so instead of just using the attribute you can do this programmatically so you can",
    "start": "2940150",
    "end": "2946329"
  },
  {
    "text": "do this within your code right this actually makes your action method unit testable if you wanted to do it this way",
    "start": "2946329",
    "end": "2952770"
  },
  {
    "text": "this also allows you to call the logic from multiple places and imagine in your",
    "start": "2952770",
    "end": "2959289"
  },
  {
    "text": "UI you want to hide the button if you can't manage customers but you also have to enforce it on the post back alright",
    "start": "2959289",
    "end": "2965740"
  },
  {
    "text": "so those are two different places that need the one chunk of logic so this gives you the ability to do that also",
    "start": "2965740",
    "end": "2971950"
  },
  {
    "text": "policies themselves are you know unit testable so you can actually just test the policy and make sure that it does",
    "start": "2971950",
    "end": "2978670"
  },
  {
    "text": "what you want independent of the rest of the application especially then if you choose to change it in the future you",
    "start": "2978670",
    "end": "2984309"
  },
  {
    "text": "run all your unit tests against your policy if anything breaks well you've broken the logic the policy based system",
    "start": "2984309",
    "end": "2993220"
  },
  {
    "text": "then can get even more advanced or sophisticated so the way this demo works",
    "start": "2993220",
    "end": "2998380"
  },
  {
    "text": "here or the way the sample works on the slide it kind of leads you to think that policies only work against claims that",
    "start": "2998380",
    "end": "3005970"
  },
  {
    "text": "the user has in the cookie for example okay and that's not true claims are meant to model the users",
    "start": "3005970",
    "end": "3013339"
  },
  {
    "text": "identity information not their permissions okay so the identity information is an input",
    "start": "3013339",
    "end": "3018990"
  },
  {
    "text": "into your policy sure and if your policy can satisfy its logic by just looking at",
    "start": "3018990",
    "end": "3024660"
  },
  {
    "text": "that identity information you're good to go but very often your authorization logic might need other sources of data",
    "start": "3024660",
    "end": "3032339"
  },
  {
    "text": "all right the user is an input the who that user is I need to go look up in the database more information to find out if they're",
    "start": "3032339",
    "end": "3038609"
  },
  {
    "text": "allowed to do something okay like I said you don't want to put a million permissions into your claims because",
    "start": "3038609",
    "end": "3044579"
  },
  {
    "text": "your cookie will get too big so how's that work well the policy based system",
    "start": "3044579",
    "end": "3050309"
  },
  {
    "start": "3049000",
    "end": "3049000"
  },
  {
    "text": "has to create what's called a custom handler basically what this is is you can create your own requirement and a requirement",
    "start": "3050309",
    "end": "3057930"
  },
  {
    "text": "is just a concept it can have some data with it if you want or not anything at all it doesn't really matter but the",
    "start": "3057930",
    "end": "3063900"
  },
  {
    "text": "whole point is you create this concept of a requirement so I've created this job level requirement you then create",
    "start": "3063900",
    "end": "3070320"
  },
  {
    "text": "the logic or the class the handler that knows how to check that requirement and",
    "start": "3070320",
    "end": "3075330"
  },
  {
    "text": "this goes in the DI system now that this is in the DI system at runtime when this",
    "start": "3075330",
    "end": "3080760"
  },
  {
    "text": "requirement is being executed this is resolved from di which means this class can resolve other things from di like",
    "start": "3080760",
    "end": "3088260"
  },
  {
    "text": "your organizational service or a DB context or an HTTP context to call a web",
    "start": "3088260",
    "end": "3093510"
  },
  {
    "text": "api and now in this handle method where you implement your logic you're handed",
    "start": "3093510",
    "end": "3098550"
  },
  {
    "text": "in this context that has the user so that's the user with all their claims from the cookie typically and you get the requirement",
    "start": "3098550",
    "end": "3105540"
  },
  {
    "text": "object that may have some additional data for you to you know do your logic and then you can call out to your",
    "start": "3105540",
    "end": "3111150"
  },
  {
    "text": "database call out to your services to help get the results that you need to say you like the user or you don't and",
    "start": "3111150",
    "end": "3117780"
  },
  {
    "text": "if you do you call the succeeded method and that means that this handler or this requirement has been satisfied ok that's",
    "start": "3117780",
    "end": "3126300"
  },
  {
    "text": "the idea with this so we're putting levels of indirection for more testability composability things like",
    "start": "3126300",
    "end": "3132420"
  },
  {
    "text": "that ok so yeah I think that the takeaway here if you weren't aware of",
    "start": "3132420",
    "end": "3139080"
  },
  {
    "text": "this is that claims are typically not for permissions ok they're for identity information and that's an input to your",
    "start": "3139080",
    "end": "3145470"
  },
  {
    "text": "authorization which maybe then goes and looks out elsewhere for permissions ok",
    "start": "3145470",
    "end": "3150770"
  },
  {
    "text": "there's one last style and again I'll go quickly because I'm running out of time is that there's the next sort of level",
    "start": "3150770",
    "end": "3157410"
  },
  {
    "start": "3151000",
    "end": "3151000"
  },
  {
    "text": "of sophistication of this policy based authorization is a resource based authorization so so far cut up to this point you're",
    "start": "3157410",
    "end": "3164280"
  },
  {
    "text": "only looking at the user to see if they're allowed to do something well what if it the logic is it depends on",
    "start": "3164280",
    "end": "3170520"
  },
  {
    "text": "the user what they're trying to do and what object they're trying to do that too ok so the typical example is Brok is",
    "start": "3170520",
    "end": "3178230"
  },
  {
    "text": "trying to delete a document ok does Brock have the rights to delete that document maybe maybe not",
    "start": "3178230",
    "end": "3184829"
  },
  {
    "text": "probably have to go look at the document to find out so that's the concept of resource based authorization same idea",
    "start": "3184829",
    "end": "3191249"
  },
  {
    "start": "3191000",
    "end": "3191000"
  },
  {
    "text": "you basically build a handler just like the Priya prior one except this handler takes in addition to the users an input",
    "start": "3191249",
    "end": "3197940"
  },
  {
    "text": "you take the the operation right what the user is trying to do and you then",
    "start": "3197940",
    "end": "3203039"
  },
  {
    "text": "take the resource that the users trying to operate against in this case like a document and then you go sort it out",
    "start": "3203039",
    "end": "3209249"
  },
  {
    "text": "with whatever your logic is you say succeed and the user can can get in and do it okay so this is what it would look",
    "start": "3209249",
    "end": "3217739"
  },
  {
    "start": "3216000",
    "end": "3216000"
  },
  {
    "text": "like to invoke that against the same authorization service that I mentioned it's in the DI system you authorize past",
    "start": "3217739",
    "end": "3223109"
  },
  {
    "text": "the user of the document and the operation and it says yay or nay okay oh",
    "start": "3223109",
    "end": "3232459"
  },
  {
    "start": "3230000",
    "end": "3230000"
  },
  {
    "text": "so another probably a topic that could totally be a whole day on its own is",
    "start": "3232459",
    "end": "3238109"
  },
  {
    "text": "asp.net identity this is a whole other set of services provided by Microsoft which it has to do with managing the",
    "start": "3238109",
    "end": "3244619"
  },
  {
    "text": "database that holds your user information and more importantly the credentials for your user so all the",
    "start": "3244619",
    "end": "3251670"
  },
  {
    "text": "stuff about session management and cookies and all that that's an important piece that's the authentication piece",
    "start": "3251670",
    "end": "3257099"
  },
  {
    "text": "but if you are collecting credentials and want to validate a username and password you need a database for that so",
    "start": "3257099",
    "end": "3263009"
  },
  {
    "text": "that's strictly speaking with asp.net identity is for it's really just a fancy wrapper around the database and some",
    "start": "3263009",
    "end": "3269249"
  },
  {
    "text": "password hashing and and it does things the right way this is something you don't want to build on your own from scratch so this will manage the record",
    "start": "3269249",
    "end": "3276180"
  },
  {
    "text": "and the database for your user their password you know email for doing password resets they have a whole",
    "start": "3276180",
    "end": "3281910"
  },
  {
    "text": "workflow for validating the email to make sure it's really the right email they support multi-factor authentication",
    "start": "3281910",
    "end": "3287309"
  },
  {
    "text": "so they have things for onboarding multi-factor devices and validating those and dealing with lost multi-factor",
    "start": "3287309",
    "end": "3293609"
  },
  {
    "text": "devices for the login workflow and helps with brute force protection I actually",
    "start": "3293609",
    "end": "3298979"
  },
  {
    "text": "had a customer this Monday during the workshops who is being brute force attacked and they were like calling me up like what's going on what do we do",
    "start": "3298979",
    "end": "3305969"
  },
  {
    "text": "and I said well you're okay because you know none of their users got compromised because the brute force protection was",
    "start": "3305969",
    "end": "3311549"
  },
  {
    "text": "kicking in and locking out this attempts okay it also deals with creating a",
    "start": "3311549",
    "end": "3317920"
  },
  {
    "text": "record for your user that maps from an external login so if you do have Google logins or open ID connect logins when",
    "start": "3317920",
    "end": "3324490"
  },
  {
    "text": "the user shows up in your app you still need a record for that user even though you don't have a password so it helps with that as well okay so again this is",
    "start": "3324490",
    "end": "3332800"
  },
  {
    "text": "the the library that you should probably use to be managing that record further your user in the database okay if you",
    "start": "3332800",
    "end": "3339970"
  },
  {
    "text": "are using this then there is a bridge to then issuing your cookie right so if you do have the login page you call this to",
    "start": "3339970",
    "end": "3346210"
  },
  {
    "text": "validate the password but then you of course needs a cookie to be created using the authentication system and then",
    "start": "3346210",
    "end": "3351730"
  },
  {
    "text": "that's the last piece there which is something called the you know the the sign-in manager for issuing cookies and",
    "start": "3351730",
    "end": "3359170"
  },
  {
    "text": "deleting cookies okay so the last piece here in my last four",
    "start": "3359170",
    "end": "3365619"
  },
  {
    "start": "3363000",
    "end": "3363000"
  },
  {
    "text": "minutes is those are a lot of really good features provided by asp.net core to build that architecture that I had",
    "start": "3365619",
    "end": "3372160"
  },
  {
    "text": "mentioned at the beginning okay there's actually a missing piece though right there's lots of really good components",
    "start": "3372160",
    "end": "3377800"
  },
  {
    "text": "in there for doing like you know doing external authentication right getting a",
    "start": "3377800",
    "end": "3383770"
  },
  {
    "text": "token back validating the token - like with Open ID Connect and using the token to call the API and validating a token",
    "start": "3383770",
    "end": "3390640"
  },
  {
    "text": "at the API so those components consume tokens the thing Microsoft is missing is",
    "start": "3390640",
    "end": "3395740"
  },
  {
    "text": "something that produces tokens in other words a token server or something that is your single sign-on server now",
    "start": "3395740",
    "end": "3403240"
  },
  {
    "text": "Microsoft has lots of products that doesn't do this right as your Active Directory b2c and things like that but",
    "start": "3403240",
    "end": "3408340"
  },
  {
    "text": "there's nothing in the box that lets you do your own okay well until asp net core 3.0 i mentioned at the beginning of the",
    "start": "3408340",
    "end": "3415690"
  },
  {
    "text": "session i work on an open source project called identity server and it basically allows you to build your own you know",
    "start": "3415690",
    "end": "3423490"
  },
  {
    "text": "your own single sign-on server people use this typically in your application architecture to set up your",
    "start": "3423490",
    "end": "3430090"
  },
  {
    "text": "own token server your own single sign-on server to abstract all of your apps from the details of logging in and that",
    "start": "3430090",
    "end": "3436840"
  },
  {
    "text": "includes passwords but it includes maybe federating with a directory directory or a business partner okay so Microsoft's",
    "start": "3436840",
    "end": "3444070"
  },
  {
    "text": "actually now going to be shipping this in the templates in Visual Studio so basically it's a I have a VM here",
    "start": "3444070",
    "end": "3453099"
  },
  {
    "text": "somewhere there we go and this VM is it has the Visual Studio",
    "start": "3453099",
    "end": "3460959"
  },
  {
    "text": "20 19.1 or whatever preview so it's the preview for asp net core 3.0 okay and",
    "start": "3460959",
    "end": "3467619"
  },
  {
    "text": "what I have done is I've done a file new project and I did the spa template and",
    "start": "3467619",
    "end": "3472839"
  },
  {
    "text": "the spa template I went to the checkbox or says I want authentication for my api's that's basically been missing from",
    "start": "3472839",
    "end": "3481359"
  },
  {
    "text": "their template story all the way since asp net core was shipped or you know released so we've been working with",
    "start": "3481359",
    "end": "3489339"
  },
  {
    "text": "Microsoft to figure out how to have them use our new get package and they are",
    "start": "3489339",
    "end": "3494650"
  },
  {
    "text": "building their own little abstraction over our configuration system to kind of give you a zero config where you can",
    "start": "3494650",
    "end": "3502059"
  },
  {
    "text": "have identity server in your project protecting your api's issuing tokens but",
    "start": "3502059",
    "end": "3507160"
  },
  {
    "text": "with you not having to really think too much about it okay so the way this works is we gonna start up here's asp net",
    "start": "3507160",
    "end": "3515380"
  },
  {
    "text": "sorry that's the DB contacts for asp net identity here's the code for asp.net identity that's the database",
    "start": "3515380",
    "end": "3521619"
  },
  {
    "text": "you know password management stuff aha and here is where they're adding identity server this is just our",
    "start": "3521619",
    "end": "3527439"
  },
  {
    "text": "extension method directly from our new get package they then are wrapping up with this fluent API their one-liner of",
    "start": "3527439",
    "end": "3537189"
  },
  {
    "text": "configuration if you will their configuration I believe is driven by",
    "start": "3537189",
    "end": "3542949"
  },
  {
    "text": "what's in Jason so you can let go and set up more client apps and you know things like that here maybe you want a",
    "start": "3542949",
    "end": "3548919"
  },
  {
    "text": "mobile app and a spa and a desktop app or whatever so you can set those up in here and then this project also is",
    "start": "3548919",
    "end": "3556539"
  },
  {
    "text": "hosting an API so the API that's co-hosted with your login page that's co-hosted with identity server wants to",
    "start": "3556539",
    "end": "3563739"
  },
  {
    "text": "you know validate tokens from that same identity server so that's what those two lines do there so if we run this",
    "start": "3563739",
    "end": "3573749"
  },
  {
    "text": "so this is their new bootstrap for template I will go here to login and I",
    "start": "3576960",
    "end": "3587170"
  },
  {
    "text": "know it's kind of hard to see but if you look up here you'll see this return URL",
    "start": "3587170",
    "end": "3593170"
  },
  {
    "text": "is connect authorize client ID redirect URI there's some scopes in there if you",
    "start": "3593170",
    "end": "3600250"
  },
  {
    "text": "know the open ID connect to know off protocols those terms will be familiar so the point is under the covers there",
    "start": "3600250",
    "end": "3606640"
  },
  {
    "text": "hiding identity server and I guess you'll just have to take my word for it it's there okay so then when I login with Brock one two",
    "start": "3606640",
    "end": "3614650"
  },
  {
    "text": "three come back here and I go to my",
    "start": "3614650",
    "end": "3622330"
  },
  {
    "text": "let's open up my network tab here and go to my fetch data page notice what",
    "start": "3622330",
    "end": "3628690"
  },
  {
    "text": "happens is actually I can show you this is that sorry wrong place this fetch",
    "start": "3628690",
    "end": "3634480"
  },
  {
    "text": "data call what it ended up doing is an ajax call back to the web api and in the",
    "start": "3634480",
    "end": "3641380"
  },
  {
    "text": "word there is hey look at this the authorization header there's a bearer",
    "start": "3641380",
    "end": "3646510"
  },
  {
    "text": "token and that is a JSON web token that is coming from the identity server that you guys almost didn't even see there",
    "start": "3646510",
    "end": "3652600"
  },
  {
    "text": "right so it looks like the old you know asp net identity templates but under the",
    "start": "3652600",
    "end": "3658000"
  },
  {
    "text": "covers they're actually making the spa communicate formally with the token server that's co-hosted you get tokens",
    "start": "3658000",
    "end": "3664300"
  },
  {
    "text": "back and those tokens are being used to call the api tokens are a great way to call those api's because it helps you",
    "start": "3664300",
    "end": "3671140"
  },
  {
    "text": "with the cross-site request forgery problem right you don't have to do that your ante forgery stuff this encapsulates both authentication and",
    "start": "3671140",
    "end": "3677500"
  },
  {
    "text": "ante forgery in one you know credential format just other color other quick",
    "start": "3677500",
    "end": "3683830"
  },
  {
    "text": "thing here is if i remember where they put the javascript code the other thing they're doing is they're they're providing this is actually the angular",
    "start": "3683830",
    "end": "3690070"
  },
  {
    "text": "template they do the same from the react template is that they're pulling in this",
    "start": "3690070",
    "end": "3695260"
  },
  {
    "text": "javascript library which is the open-source JavaScript library for spa's to do open ID connect okay so they're",
    "start": "3695260",
    "end": "3702490"
  },
  {
    "text": "wrapping that up and that's you know the all the protocol work is really happening in that library this template is just kind of wrapping",
    "start": "3702490",
    "end": "3708310"
  },
  {
    "text": "it up into a angular service that makes a little easier to use okay and then",
    "start": "3708310",
    "end": "3714820"
  },
  {
    "text": "they have an interceptor for their outbound HTTP calls and what the",
    "start": "3714820",
    "end": "3720430"
  },
  {
    "text": "Interceptor is doing is pulling in that authorization service and in the authorization service they're getting",
    "start": "3720430",
    "end": "3726580"
  },
  {
    "text": "the access token and then what they're doing is they're popping in the access token here into the authorization header",
    "start": "3726580",
    "end": "3733960"
  },
  {
    "text": "using the bearer scheme okay so what am i it's in there it's kind of cool kind",
    "start": "3733960",
    "end": "3740350"
  },
  {
    "text": "of cool they've been this is a working on this for a long time so it's kind of cool to see identity server now they're",
    "start": "3740350",
    "end": "3747700"
  },
  {
    "text": "in okay so that should be are coming out in 3.0 in addition they have other",
    "start": "3747700",
    "end": "3754240"
  },
  {
    "text": "workflows that they're going to be supporting like server to server API scenarios as well and in the future",
    "start": "3754240",
    "end": "3759580"
  },
  {
    "text": "they'll be expanding that more so this is just the first step towards that okay",
    "start": "3759580",
    "end": "3765310"
  },
  {
    "text": "other that that hopefully gives you an idea of a lot of the features in asp net core to allow you to build secure modern",
    "start": "3765310",
    "end": "3772270"
  },
  {
    "text": "asp.net core applications thanks for having me and by the way I have identity server stickers up here I have a whole",
    "start": "3772270",
    "end": "3777880"
  },
  {
    "text": "bag of them for all four of you so if you want to come grab a sticker you can",
    "start": "3777880",
    "end": "3783400"
  },
  {
    "text": "other than that thanks and enjoy the party tonight",
    "start": "3783400",
    "end": "3787680"
  }
]