[
  {
    "text": "so what we want you to do is Imagine just to imagine that it's actually",
    "start": "3879",
    "end": "9960"
  },
  {
    "text": "Friday afternoon and I know because you're at the conference you're probably not so happy that it's progressing to Friday so soon but it's Friday afternoon",
    "start": "9960",
    "end": "17560"
  },
  {
    "text": "but you're not at a conference you're in the office so you're working so you can be a",
    "start": "17560",
    "end": "23400"
  },
  {
    "text": "little bit more miserable that's okay now you're you're in the office you're working away Friday afternoon you",
    "start": "23400",
    "end": "30000"
  },
  {
    "text": "you're kind of you know just getting through a few a few bits and pieces and",
    "start": "30000",
    "end": "36840"
  },
  {
    "text": "uh like all of a sudden on not",
    "start": "36840",
    "end": "44440"
  },
  {
    "text": "again all right let's uh take that hey oh hi",
    "start": "44440",
    "end": "53760"
  },
  {
    "text": "Melissa uh-huh yeah of course they did how much",
    "start": "53760",
    "end": "60760"
  },
  {
    "text": "all right yeah today oh it's important right all right yeah I'll I'll tell him",
    "start": "60760",
    "end": "68159"
  },
  {
    "text": "bye sure so yeah so Melissa yeah um she has a new",
    "start": "68159",
    "end": "75680"
  },
  {
    "text": "feature request we need to change the payment application on a Friday afternoon yeah well again cuz Finance",
    "start": "75680",
    "end": "81759"
  },
  {
    "text": "actually found out that if we change the name field from 255 characters to 25",
    "start": "81759",
    "end": "88439"
  },
  {
    "text": "will save 60 bucks Friday afternoon people yeah and uh",
    "start": "88439",
    "end": "93479"
  },
  {
    "text": "because it's qbr on Monday it needs to be done now so so our monthly spend with",
    "start": "93479",
    "end": "99240"
  },
  {
    "text": "the cloud is is probably what like 100,000 bucks or something yeah probably well with the way we waste things yeah",
    "start": "99240",
    "end": "105119"
  },
  {
    "text": "and we're going to make a last minute change on a Friday to save",
    "start": "105119",
    "end": "110438"
  },
  {
    "text": "$60 well why not you know yeah uh Nick you remember what happened last time",
    "start": "110600",
    "end": "115680"
  },
  {
    "text": "like when you had to change the color of the payments button I thought we weren't going to talk about that yeah that didn't go very well did it let let's not",
    "start": "115680",
    "end": "121399"
  },
  {
    "text": "do that again all right so what we want to have to do is we need to make a",
    "start": "121399",
    "end": "126439"
  },
  {
    "text": "change now our application let's kind quickly kind of cover what's going on with the application so the application",
    "start": "126439",
    "end": "133640"
  },
  {
    "text": "that we're kind of going to be playing around with today is just an mvc6 app it's literally scaffolded from the web",
    "start": "133640",
    "end": "139560"
  },
  {
    "text": "template and it's using a post gray SQL database so it's it's you know it's a very simple application but know that",
    "start": "139560",
    "end": "146239"
  },
  {
    "text": "that not being the purpose we want to kind of look at some deployment strategy",
    "start": "146239",
    "end": "151280"
  },
  {
    "text": "forward now I've been asked to change the database field length I'm a do I'm",
    "start": "151280",
    "end": "157519"
  },
  {
    "text": "not doet programmer I'm a go programmer I've got no idea what I'm doing so I look at the code here and I see something and I'm like well you know",
    "start": "157519",
    "end": "163920"
  },
  {
    "text": "somebody's put this comment in here so if I just change the the string",
    "start": "163920",
    "end": "169959"
  },
  {
    "text": "validation surely that's going to be fine okay yeah",
    "start": "169959",
    "end": "175680"
  },
  {
    "text": "I'm sure this changes something in the something okay like like the programmers",
    "start": "175680",
    "end": "181239"
  },
  {
    "text": "shouldn't have left the office early on Friday so we I'm going to make that change and I'm going to go through the",
    "start": "181239",
    "end": "187000"
  },
  {
    "text": "standard sort of process so get status luckily we have Automation in place right we do indeed well we let we might",
    "start": "187000",
    "end": "194360"
  },
  {
    "text": "do adding those changes are you going to make a sensible",
    "start": "194360",
    "end": "200640"
  },
  {
    "text": "uh commit message no it's Friday yeah that's fine fair enough",
    "start": "200640",
    "end": "206920"
  },
  {
    "text": "oh well there's a thing I managed to type that first time and I'm pushing",
    "start": "211640",
    "end": "216920"
  },
  {
    "text": "it so whilst whilst we're kind of looking at that let let's kind of dig in a little",
    "start": "217360",
    "end": "223120"
  },
  {
    "text": "bit about this because well I mean we you came here to talk and learn about",
    "start": "223120",
    "end": "229159"
  },
  {
    "text": "Progressive delivery I think we've just proven within the first five minutes you don't actually need it so that went a",
    "start": "229159",
    "end": "235480"
  },
  {
    "text": "lot quicker than I thought so we can all just go for a beer uh but before we do we should proba probably just introduce ourselves because if not how else is",
    "start": "235480",
    "end": "242480"
  },
  {
    "text": "anybody going to know who we are to and buy a beer for exactly good point let's",
    "start": "242480",
    "end": "247519"
  },
  {
    "text": "just go through those slides and then we're done pretty much we should be out of here in five all right don't drop the clicker",
    "start": "247519",
    "end": "254599"
  },
  {
    "text": "okay so I'm Nick Jackson uh I'm I work as a developer Advocate currently for Hashi Corp my background is that I've",
    "start": "255120",
    "end": "261359"
  },
  {
    "text": "been working as software architecture software development I've written a book on microservices with with a another",
    "start": "261359",
    "end": "268040"
  },
  {
    "text": "non-microsoft programming language go but like you know don't don't judge me and I'm currently writing a book which",
    "start": "268040",
    "end": "274440"
  },
  {
    "text": "is looking at how you can apply architectural patterns to the modern world of service Mees and as the title says I am mostly",
    "start": "274440",
    "end": "283479"
  },
  {
    "text": "incompetent but with me I have my my good buddy Eric W who is probably the",
    "start": "283479",
    "end": "289039"
  },
  {
    "text": "Western world's foremost expert in pbac and for those who don't know what pepac",
    "start": "289039",
    "end": "295000"
  },
  {
    "text": "is it's a problem that exists between the keyboard and the chair yeah I think that's pretty fair to",
    "start": "295000",
    "end": "300479"
  },
  {
    "text": "say hi folks uh so I'm guessing then that uh",
    "start": "300479",
    "end": "305960"
  },
  {
    "text": "we're done yeah should we uh out maybe like first play a game of Quake or",
    "start": "305960",
    "end": "311320"
  },
  {
    "text": "something like that and then uh yeah we could have a a quick uh quick come on that's not Melissa",
    "start": "311320",
    "end": "317720"
  },
  {
    "text": "again is it yeah oh hi there yeah the website's",
    "start": "317720",
    "end": "325919"
  },
  {
    "text": "down no it's not are you sure well could you could you just do me a",
    "start": "325919",
    "end": "332240"
  },
  {
    "text": "favor just refresh your browser clearer cash that didn't help can you just go in",
    "start": "332240",
    "end": "339280"
  },
  {
    "text": "and go in and clear your cash that didn't help it's DNS ask it",
    "start": "339280",
    "end": "345840"
  },
  {
    "text": "it'll be okay so do me a favor can you ask it if they're having any problems with the network because we're not seeing anything here are we where",
    "start": "345840",
    "end": "352199"
  },
  {
    "text": "everything looks hang on one second can you check the uh the monitoring sure",
    "start": "352199",
    "end": "357280"
  },
  {
    "text": "everything looks fine okay I'll put you on hold while you you call them all right thank you it's not",
    "start": "357280",
    "end": "364080"
  },
  {
    "text": "fine um I think everything's broken so",
    "start": "364080",
    "end": "369960"
  },
  {
    "text": "uh you go through that kind of that process do we maybe have to talk about",
    "start": "369960",
    "end": "375080"
  },
  {
    "text": "Progressive delivery anyway well it looks like we do have to talk about Progressive delivery oh all right",
    "start": "375080",
    "end": "383440"
  },
  {
    "text": "but all right fine let's do that like shall we talk about Progressive like didn't we do other things to for",
    "start": "383440",
    "end": "391240"
  },
  {
    "text": "issues so the problem is that we we literally just push code into production and we write tests we write loads of",
    "start": "391240",
    "end": "397479"
  },
  {
    "text": "tests yeah but as we all know tests are not enough right like tests basically",
    "start": "397479",
    "end": "402720"
  },
  {
    "text": "test are known known right we write the paths that we actually want to go through in our applications we Define",
    "start": "402720",
    "end": "410080"
  },
  {
    "text": "the input variables maybe we have some randomization in there but it's it's still basically all predefined now what",
    "start": "410080",
    "end": "417000"
  },
  {
    "text": "we don't test is users doing really weird things and we all know they do",
    "start": "417000",
    "end": "423919"
  },
  {
    "text": "infrastructure changes another big thing right configuration changes yep and sometimes things just happen only in",
    "start": "423919",
    "end": "430639"
  },
  {
    "text": "production at crazy times at night where you just can't predict them right like",
    "start": "430639",
    "end": "435840"
  },
  {
    "text": "there's always weird occurrences changes that manifest due to load what what we're kind of driving at is that you as",
    "start": "435840",
    "end": "442160"
  },
  {
    "text": "an application programmer or an infrastructure operator may not be solely to blame no not to blame at all",
    "start": "442160",
    "end": "449080"
  },
  {
    "text": "right it's always somebody else very often it's us but not always right now",
    "start": "449080",
    "end": "456319"
  },
  {
    "text": "where kind of you can kind of solve these problems is looking at that Dev deployment process yeah so if we look at",
    "start": "456319",
    "end": "463919"
  },
  {
    "text": "these steps right there's basically five steps in Progressive delivery right um",
    "start": "463919",
    "end": "469199"
  },
  {
    "text": "so the first three are code deploy and run and you might all be familiar with that from normal gitf flow and cicd",
    "start": "469199",
    "end": "476319"
  },
  {
    "text": "patterns right but where Progressive delivery expands on that is monitoring",
    "start": "476319",
    "end": "481599"
  },
  {
    "text": "and routing right what we're basically going to do is we're going to have multiple versions of our application",
    "start": "481599",
    "end": "487159"
  },
  {
    "text": "running at the same time and then we're going to slowly ramp up the traffic to our new version then we're going to",
    "start": "487159",
    "end": "493879"
  },
  {
    "text": "observe it to make sure that it's healthy and if it is then we're going to keep increasing that traffic until we've",
    "start": "493879",
    "end": "500319"
  },
  {
    "text": "entirely moved over so we're using just like the kubernetes liveliness or the kubernetes health checks so actually",
    "start": "500319",
    "end": "507759"
  },
  {
    "text": "those are um health checks right like there's a difference between those like",
    "start": "507759",
    "end": "513039"
  },
  {
    "text": "this is basically you prodding the application asking are you healthy are you healthy are you healthy right that",
    "start": "513039",
    "end": "519320"
  },
  {
    "text": "might not necessarily be true for the end user so what we want to do is we",
    "start": "519320",
    "end": "524800"
  },
  {
    "text": "want to run passive health checks where we observe the system and we're basically looking from an external",
    "start": "524800",
    "end": "531640"
  },
  {
    "text": "Source how the system is behaving so think of monitoring right we can see what is actually happening in the",
    "start": "531640",
    "end": "537519"
  },
  {
    "text": "environment independent of what the application says so to make it clear to you Nick and maybe explain it a bit",
    "start": "537519",
    "end": "543640"
  },
  {
    "text": "easier like an active health check is basically you asking your dog if he's a",
    "start": "543640",
    "end": "548680"
  },
  {
    "text": "good boy give me a sausage yeah exactly the answer is always going to be yes give me a sausage but that's kind of",
    "start": "548680",
    "end": "554079"
  },
  {
    "text": "like you writing those slv1 Health Z endpoints that only return",
    "start": "554079",
    "end": "559519"
  },
  {
    "text": "HTTP 200 right but and I think you know we joke about this but the the key thing about the health check is that even if",
    "start": "559519",
    "end": "566800"
  },
  {
    "text": "you write more information into your application health checks you're looking at the connection status you're looking at sort of things like the the sort of",
    "start": "566800",
    "end": "575560"
  },
  {
    "text": "the number of errors that are manifesting internally dependencies there's a number of external factors",
    "start": "575560",
    "end": "581120"
  },
  {
    "text": "which may also have a bearing and I guess yeah so a passive health",
    "start": "581120",
    "end": "587959"
  },
  {
    "text": "check is more you observing that your couch pillows are all torn over the",
    "start": "587959",
    "end": "594000"
  },
  {
    "text": "floor your carpet is shredded it paints a kind of a different picture of what your dog just told you right right so",
    "start": "594000",
    "end": "602560"
  },
  {
    "text": "how are we going to solve the problem what do we do so the main part of it is the canary deployment pattern so what",
    "start": "602560",
    "end": "610079"
  },
  {
    "text": "we're basically going to do is as I said before do um the the load shifting so",
    "start": "610079",
    "end": "615760"
  },
  {
    "text": "basically we're just going to do weighted load balancing if you want to keep it really simple so we have those",
    "start": "615760",
    "end": "621680"
  },
  {
    "text": "two applications we're going to send 10% traffic to the new version that we're",
    "start": "621680",
    "end": "626760"
  },
  {
    "text": "going to observe it and actually see are we getting any errors throughout the entire system and if that doesn't happen",
    "start": "626760",
    "end": "634519"
  },
  {
    "text": "we're going to increase but if we do see errors we can actually roll back and then revert to the old version of the",
    "start": "634519",
    "end": "642959"
  },
  {
    "text": "application and I guess that sort of fits into a kind of a workflow and you're going to demo this to us I",
    "start": "642959",
    "end": "649120"
  },
  {
    "text": "suppose yeah well let's just do that right I mean we didn't make any errors on stage yet so well not yet no but",
    "start": "649120",
    "end": "658000"
  },
  {
    "text": "um the did I actually commit the code and push it I mean there's a question for you oh did you actually not break",
    "start": "658000",
    "end": "664440"
  },
  {
    "text": "production yet well that's uh I did see",
    "start": "664440",
    "end": "669519"
  },
  {
    "text": "push no that looks fine okay",
    "start": "670880",
    "end": "677160"
  },
  {
    "text": "then where you go yeah all right so let's first take a look at what nickel",
    "start": "678519",
    "end": "684040"
  },
  {
    "text": "already has running in the environment right so we're talking about the payment service",
    "start": "684040",
    "end": "690040"
  },
  {
    "text": "and if we look at the service that we've registered in console to do our service Discovery and and routing of the traffic",
    "start": "690040",
    "end": "697200"
  },
  {
    "text": "we can see that we have just one instance of the application running MH",
    "start": "697200",
    "end": "702639"
  },
  {
    "text": "so I think that's uh where things went wrong",
    "start": "702639",
    "end": "708120"
  },
  {
    "text": "Nick I didn't think it kicked off a uh new build well that's at least a new",
    "start": "709079",
    "end": "717079"
  },
  {
    "text": "failure because C of the demo environment so what should have happened is when we committed the code or cicd",
    "start": "717959",
    "end": "724760"
  },
  {
    "text": "which we're currently using Waypoint could be anything getup actions whatever you use it's just a continuous integration flow kicks in and a a build",
    "start": "724760",
    "end": "734519"
  },
  {
    "text": "will will start and then that build then gets pushed as we are now seeing into the the",
    "start": "734519",
    "end": "742120"
  },
  {
    "text": "production cluster so we're going to have those two environments running side by side we've got V5 and V6 and what",
    "start": "742120",
    "end": "748560"
  },
  {
    "text": "Eric is is going to hopefully show you is how we can slowly kind of migrate",
    "start": "748560",
    "end": "754160"
  },
  {
    "text": "traffic between V5 and V6 and then we'll look at a little bit better way of doing",
    "start": "754160",
    "end": "759480"
  },
  {
    "text": "it hopefully you want to know the good news though that customer that just called us we we actually send them the",
    "start": "759480",
    "end": "765079"
  },
  {
    "text": "right way it was a DNS problem it was a DNS it's always a DNS problem so yeah so",
    "start": "765079",
    "end": "770120"
  },
  {
    "text": "as we can see we now have two versions of the application running and both are",
    "start": "770120",
    "end": "775279"
  },
  {
    "text": "registered in console and what we've actually done is we' added metadata to",
    "start": "775279",
    "end": "781600"
  },
  {
    "text": "our application oh come on let me scroll further down oh you're zoomed in yeah",
    "start": "781600",
    "end": "789800"
  },
  {
    "text": "there we go so all the way at the bottom you can see that we have version V1 because Nick makes pepcs and he didn't",
    "start": "789800",
    "end": "797320"
  },
  {
    "text": "think that when you release version six you might want to change the metadata to version six as well but that's not going",
    "start": "797320",
    "end": "804120"
  },
  {
    "text": "to stop us so what we can do is we actually have the multiple vers versions",
    "start": "804120",
    "end": "809480"
  },
  {
    "text": "running and we can select the services based on that metadata so what we want",
    "start": "809480",
    "end": "815720"
  },
  {
    "text": "to do is when we say I want to talk to payments we're going to then internally",
    "start": "815720",
    "end": "820880"
  },
  {
    "text": "of that create two subsets of that one that will route to that V5 and one",
    "start": "820880",
    "end": "826600"
  },
  {
    "text": "that'll route to that V6 and then depending on incoming factors which",
    "start": "826600",
    "end": "831759"
  },
  {
    "text": "we'll change later we want to either go left or right to either the old or the new version so the service catalog is is",
    "start": "831759",
    "end": "839360"
  },
  {
    "text": "something that's present in most systems whether you're using um console whether you're using kubernetes you've always",
    "start": "839360",
    "end": "845199"
  },
  {
    "text": "got a way of attributing metadata generally to a service or a an instance",
    "start": "845199",
    "end": "851560"
  },
  {
    "text": "of a service and this is incredibly important when it comes to doing something like being able to traffic",
    "start": "851560",
    "end": "857600"
  },
  {
    "text": "splitting because you can't always rely on having say two completely separate deployments you're certainly not going",
    "start": "857600",
    "end": "862639"
  },
  {
    "text": "to have two service names you'll basically just kind of want something to be a subset selection yeah and it",
    "start": "862639",
    "end": "868680"
  },
  {
    "text": "actually adds a lot of benefit it being a subset because from the outside world and to the application itself we're not",
    "start": "868680",
    "end": "875800"
  },
  {
    "text": "changing any configuration so anything that wants to reach the payment service still just addresses payments it doesn't",
    "start": "875800",
    "end": "882720"
  },
  {
    "text": "have to then be like oh and now need to Route the payments V1 or V2 and things like that which makes it a lot more",
    "start": "882720",
    "end": "888079"
  },
  {
    "text": "flexible so since we're using kubernetes we're going to be configuring the service mesh using crds so first what we",
    "start": "888079",
    "end": "896120"
  },
  {
    "text": "want to do is we want to create this service resolver which will resolve the service payments for us and we're going",
    "start": "896120",
    "end": "903360"
  },
  {
    "text": "to Define two subsets so as you can see here we say that we want to have subsets",
    "start": "903360",
    "end": "909680"
  },
  {
    "text": "and we've just called them V1 V2 cuz just old and new um and then we're going to be basically filtering on that",
    "start": "909680",
    "end": "917639"
  },
  {
    "text": "metadata version now we're filtering on the metadata but you can actually filter",
    "start": "917639",
    "end": "923199"
  },
  {
    "text": "on loads of different things if you do name them differently you could filter on that or use tags or anything like",
    "start": "923199",
    "end": "929319"
  },
  {
    "text": "that in essence this is kind of like a virtual service yes it is so let's close that let's just cctl",
    "start": "929319",
    "end": "938680"
  },
  {
    "text": "p-f and then we're going to do the service resolver okay so now that we have those",
    "start": "938680",
    "end": "946120"
  },
  {
    "text": "two separate virtual Services we now need to find a way to shape that traffic",
    "start": "946120",
    "end": "951800"
  },
  {
    "text": "between them right so we can do that weighted load balancing so what we need for that is a",
    "start": "951800",
    "end": "958079"
  },
  {
    "text": "service splitter and it basically does what it says on the tin which is nice so",
    "start": "958079",
    "end": "964120"
  },
  {
    "text": "we're going to again create a crd for the service splitter for the payment service and we're going to split between",
    "start": "964120",
    "end": "971160"
  },
  {
    "text": "this subset V1 that we created and the subset V2 and then with these weights we",
    "start": "971160",
    "end": "977759"
  },
  {
    "text": "can actually shift that traffic right so currently we're sending all of the",
    "start": "977759",
    "end": "983360"
  },
  {
    "text": "traffic to the new version um but since that new version has that bug that you",
    "start": "983360",
    "end": "989040"
  },
  {
    "text": "just introduced that's not what we want but just to give you the benefit of of the D Nick let's maybe think that it's",
    "start": "989040",
    "end": "996319"
  },
  {
    "text": "uh to do with load or something okay right so let's just slowly shift back",
    "start": "996319",
    "end": "1001360"
  },
  {
    "text": "because normally when you release your new version and you're actually doing like we're basically doing this in Reverse now undoing your pepac normally",
    "start": "1001360",
    "end": "1009120"
  },
  {
    "text": "you want to release your new version have no traffic going to it then send 10% traffic 20 30 like what whatever you",
    "start": "1009120",
    "end": "1016079"
  },
  {
    "text": "have in your strategy so the key thing is though that you have to keep doing this you have to manually keep incrementing the the traffic that's",
    "start": "1016079",
    "end": "1023040"
  },
  {
    "text": "going between the split and monitoring it well if you put it like that it doesn't sound as well it doesn't sound",
    "start": "1023040",
    "end": "1029678"
  },
  {
    "text": "appealing for you we're all going down to the uh for a drink you'll be sitting here until midnight well no it'll be",
    "start": "1029679",
    "end": "1035480"
  },
  {
    "text": "fine Nick don't don't worry so let me just uh change this right so I want to",
    "start": "1035480",
    "end": "1040600"
  },
  {
    "text": "First send uh maybe 10% back to this one and then 90 to that one there this is",
    "start": "1040600",
    "end": "1047120"
  },
  {
    "text": "exactly as if you were configuring like a wa load balancer if you use you could use something like engine X to actually do a canary",
    "start": "1047120",
    "end": "1053360"
  },
  {
    "text": "deployment how much sort of efficacy you would get out of it because there's a kind of a number of differing factors",
    "start": "1053360",
    "end": "1060160"
  },
  {
    "text": "but you know technically it's possible what what I think which we'll explain a little bit later on is that the modern",
    "start": "1060160",
    "end": "1066840"
  },
  {
    "text": "sort of Technology like service mesh actually kind of makes the lift and shift of being able to leverage these",
    "start": "1066840",
    "end": "1072080"
  },
  {
    "text": "techniques pretty much transparent for the application and actually a lot easier to configure yeah now as we can",
    "start": "1072080",
    "end": "1077840"
  },
  {
    "text": "see like just an overview of the routing that we just configured we have a splitter and then on the right you can",
    "start": "1077840",
    "end": "1083159"
  },
  {
    "text": "see the resolver with those two subsets and if we hover over these little things we can see that 10% of the traffic is",
    "start": "1083159",
    "end": "1090159"
  },
  {
    "text": "going to back to V1 right now it still is actually throwing",
    "start": "1090159",
    "end": "1097559"
  },
  {
    "text": "errors uh which we'll see here so I did the uh",
    "start": "1097559",
    "end": "1104520"
  },
  {
    "text": "traffic shaping and routing now I need to do the observing bit right like we need to externally inspect what we've",
    "start": "1104520",
    "end": "1111320"
  },
  {
    "text": "done so I have a a simple query here for Prometheus where we're basically going",
    "start": "1111320",
    "end": "1116679"
  },
  {
    "text": "to look at the request per second and the uh response codes that we get back",
    "start": "1116679",
    "end": "1123360"
  },
  {
    "text": "and we're going to check if anything is not 200 that's basically an error and",
    "start": "1123360",
    "end": "1128919"
  },
  {
    "text": "then we're basically going to display that as a percentage of success so if we",
    "start": "1128919",
    "end": "1134720"
  },
  {
    "text": "uh keep running these and then scroll down like I'm actually",
    "start": "1134720",
    "end": "1140919"
  },
  {
    "text": "getting 100% success Nick so I think your change uh just deployed the same one but let's assume that it actually",
    "start": "1140919",
    "end": "1149320"
  },
  {
    "text": "was throwing errors here what I want to do is then increase the traffic back to the old one more and more and more so",
    "start": "1149320",
    "end": "1155480"
  },
  {
    "text": "I'd go back into my terminal and or I can just show you how to automate all of this oh can we yeah oh okay well then",
    "start": "1155480",
    "end": "1163440"
  },
  {
    "text": "let's do that I don't want to be doing this every Friday we want to kind of show you the manual process involved in something like a can deployment because",
    "start": "1163440",
    "end": "1169440"
  },
  {
    "text": "it is quite arduous and the key thing about an automated Canary deployment is that it should be unattended it should",
    "start": "1169440",
    "end": "1175400"
  },
  {
    "text": "be 100% automatable you literally should be able to push your code and walk away",
    "start": "1175400",
    "end": "1181200"
  },
  {
    "text": "and you should be able to do that with 100% confidence that in the instance in the narrrow occurs or that there is a",
    "start": "1181200",
    "end": "1187720"
  },
  {
    "text": "problem with the deployment it will be automatically reverted and the end user will be completely unaffected by the",
    "start": "1187720",
    "end": "1194320"
  },
  {
    "text": "change you've made so when we start talking about and you've got that unwritten law of oh nobody deploys on a",
    "start": "1194320",
    "end": "1199720"
  },
  {
    "text": "Friday because of risk risk to your weekend you don't have to worry that",
    "start": "1199720",
    "end": "1204919"
  },
  {
    "text": "anymore because it's not you that has to attend to the problem the automation will deal with it for you yeah so let's",
    "start": "1204919",
    "end": "1213080"
  },
  {
    "text": "let's kind of take a a kind of a quick um a quick look at the whole the whole workflow there so which bits can we",
    "start": "1213080",
    "end": "1219880"
  },
  {
    "text": "actually automate Nick well we can automate pretty much everything so let's um let me just flip my slide here let me",
    "start": "1219880",
    "end": "1228480"
  },
  {
    "text": "just join you in the conference so this is a a continuous uh or a progressive delivery workflow now if you look at the",
    "start": "1228480",
    "end": "1235360"
  },
  {
    "text": "the top three boxes there we've got the the kind of the the code of the deploy and the Run sections now they you should",
    "start": "1235360",
    "end": "1240679"
  },
  {
    "text": "be very familiar with this because this is your day-to-day activity so this is kind of standard continuous integration",
    "start": "1240679",
    "end": "1246760"
  },
  {
    "text": "you're going to write some code you commit the code you PR it the automation for the continuous integration is going",
    "start": "1246760",
    "end": "1252200"
  },
  {
    "text": "to kick in it's going to execute your builds it's going to run your tests maybe run some functional tests",
    "start": "1252200",
    "end": "1259159"
  },
  {
    "text": "and then ultimately that will result in a deployment so again 100% unattended",
    "start": "1259159",
    "end": "1264840"
  },
  {
    "text": "now if you're not doing something like a canary deployment what you're generally going to be looking at is something like a blue green when you're just doing that",
    "start": "1264840",
    "end": "1271240"
  },
  {
    "text": "straight swap between old and new which is fine if old and new both work but in",
    "start": "1271240",
    "end": "1277520"
  },
  {
    "text": "our instance well they they don't often they hardly ever hardly ever so when you",
    "start": "1277520",
    "end": "1283279"
  },
  {
    "text": "start to look at the automation around the canary you basically start to look at building",
    "start": "1283279",
    "end": "1289120"
  },
  {
    "text": "an automated release controller and that's what we're going to be using so we have a a kubernetes controller which",
    "start": "1289120",
    "end": "1295000"
  },
  {
    "text": "basically is Eric 2.0 which that uh yeah thanks it basically takes on that role",
    "start": "1295000",
    "end": "1302760"
  },
  {
    "text": "so it's going to be doing the work of monitoring the deployment it's doing the work of monitoring the application's",
    "start": "1302760",
    "end": "1310120"
  },
  {
    "text": "passive health and it's doing the work of controlling the traffic splitting should the passive health so that's",
    "start": "1310120",
    "end": "1316400"
  },
  {
    "text": "basically everything I was just doing like I guess this is how horses felt when they invented cars right all right",
    "start": "1316400",
    "end": "1323720"
  },
  {
    "text": "which is also probably when you walked into that bar the other day somebody asked you if you had a long",
    "start": "1323720",
    "end": "1329720"
  },
  {
    "text": "face I don't even explain that we weren't sure that one no that's",
    "start": "1329720",
    "end": "1335640"
  },
  {
    "text": "good but I think the key thing is that automation is Central so let's look at the automated approach and let's look at",
    "start": "1335640",
    "end": "1342000"
  },
  {
    "text": "um actually just kind of like how how easy easy things are so the nice thing",
    "start": "1342000",
    "end": "1348000"
  },
  {
    "text": "is as well is that all of these top pits bits we actually have already automated",
    "start": "1348000",
    "end": "1353880"
  },
  {
    "text": "like the whole git flow you have to go through yourself but after that until like things land in production we",
    "start": "1353880",
    "end": "1360960"
  },
  {
    "text": "already have that automated cuz CI will automatically build and and push your packages and things like that and then",
    "start": "1360960",
    "end": "1366720"
  },
  {
    "text": "your scheduler will actually run your application and keep it running it's those last bits we need to fix so we're",
    "start": "1366720",
    "end": "1372679"
  },
  {
    "text": "going to look at the configuration uh of Eric 2.0 here and this is um this is a",
    "start": "1372679",
    "end": "1379840"
  },
  {
    "text": "configuration for for consol's release controller so what we have here is",
    "start": "1379840",
    "end": "1384960"
  },
  {
    "text": "something that defines a a release so in the beginning we we have the the kind of",
    "start": "1384960",
    "end": "1390200"
  },
  {
    "text": "the the name of the the console service because a console service or or any kind",
    "start": "1390200",
    "end": "1397520"
  },
  {
    "text": "of um service mesh service can differ from the the sort of the actual deployment name and then we have the the",
    "start": "1397520",
    "end": "1404000"
  },
  {
    "text": "deployment name and we're going to use a a wild card so because of the way that we're we're pushing we're not directly",
    "start": "1404000",
    "end": "1410559"
  },
  {
    "text": "replacing our kubernetes deployment we increment and we deprecate just the strategy that we take and then the more",
    "start": "1410559",
    "end": "1416880"
  },
  {
    "text": "interesting stuff is when we start to look at the the strategy itself so we're going to define the plug-in to use is",
    "start": "1416880",
    "end": "1424159"
  },
  {
    "text": "going to be a canary we are going to have an initial delay before we start rolling the traffic out again our",
    "start": "1424159",
    "end": "1431520"
  },
  {
    "text": "kubernetes liveliness and our health checks our active checks are going to assure that the the application's up and",
    "start": "1431520",
    "end": "1436840"
  },
  {
    "text": "running and ready to accept traffic but then we're going to start pushing a little bit of traffic to it we're going",
    "start": "1436840",
    "end": "1442080"
  },
  {
    "text": "to start at 10% and then every 30 second we're going to monitor we are going to then increase",
    "start": "1442080",
    "end": "1449640"
  },
  {
    "text": "the traffic by 20% and if we have any errors we'll we'll roll it back now in terms of the",
    "start": "1449640",
    "end": "1456760"
  },
  {
    "text": "the sort of the the queries that um that need to be applied",
    "start": "1456760",
    "end": "1462919"
  },
  {
    "text": "well we're kind of automating that too so we're just basically saying hey um we want request success we want request",
    "start": "1462919",
    "end": "1469919"
  },
  {
    "text": "duration now I can define those really abstractly like this because of the",
    "start": "1469919",
    "end": "1475440"
  },
  {
    "text": "benefits of service mesh gives me because service mesh gives me a completely kind of generic approach to",
    "start": "1475440",
    "end": "1481760"
  },
  {
    "text": "kind of standardized Health metrics request metrics that that come out of my",
    "start": "1481760",
    "end": "1487440"
  },
  {
    "text": "system it's not something that's emitted from my application literally my app is just an mv6 scaffold and there's no",
    "start": "1487440",
    "end": "1494360"
  },
  {
    "text": "tracing there's no metric there's no nothing in it but Nick could I do this",
    "start": "1494360",
    "end": "1499520"
  },
  {
    "text": "without a service mesh like let's say a fat client or something like that yeah I mean you know you could and plenty of",
    "start": "1499520",
    "end": "1507760"
  },
  {
    "text": "people did but but then you've got a sort of complexity that you've got to think about if you're doing weighted load balancing you've either got to use",
    "start": "1507760",
    "end": "1513679"
  },
  {
    "text": "something like a centralized load balancer so you've got to kind of like push things through like say a central",
    "start": "1513679",
    "end": "1519039"
  },
  {
    "text": "engine X instance and that was the way that we used to do things when we first started sort of building microservices",
    "start": "1519039",
    "end": "1525600"
  },
  {
    "text": "but then you're introducing things like latency you've got sort of complexity around centralized dependency there's",
    "start": "1525600",
    "end": "1532120"
  },
  {
    "text": "there's kind of a number of reasons why that is maybe not the best solution today you can do things with client side",
    "start": "1532120",
    "end": "1538159"
  },
  {
    "text": "lows balancing so I can deal with this inside of the client I could write a library which does my Upstream load",
    "start": "1538159",
    "end": "1544799"
  },
  {
    "text": "balancing for me but then I have to maintain that I have to assume that I have consistency of version and",
    "start": "1544799",
    "end": "1551640"
  },
  {
    "text": "consistency of language across all of my applications in my estate and the reality is that that's not always",
    "start": "1551640",
    "end": "1557880"
  },
  {
    "text": "possible so by externalizing all of that it actually just saves you quite a bit of",
    "start": "1557880",
    "end": "1563080"
  },
  {
    "text": "um quite a bit of headache it also makes your applications much simpler because they don't have to deal with all those",
    "start": "1563080",
    "end": "1569919"
  },
  {
    "text": "external things right you can just focus on writing your core business logic and",
    "start": "1569919",
    "end": "1575320"
  },
  {
    "text": "just have your application only do that like I think that payments application is a great example of that it it",
    "start": "1575320",
    "end": "1582480"
  },
  {
    "text": "basically does nothing with security does nothing with retries it does nothing with basically anything it just",
    "start": "1582480",
    "end": "1590120"
  },
  {
    "text": "concerns itself with well putting payments in a database oh gosh you know",
    "start": "1590120",
    "end": "1599320"
  },
  {
    "text": "what so I'm just backing out Eric's uh configuration here because that cause me",
    "start": "1600880",
    "end": "1609520"
  },
  {
    "text": "cause me issues and I'm just going to return the the system to its its previous",
    "start": "1609520",
    "end": "1615440"
  },
  {
    "text": "state uh",
    "start": "1615440",
    "end": "1619440"
  },
  {
    "text": "let me just make sure I I would do a list first maybe oh it'll be fine that's always the thing you want to",
    "start": "1623279",
    "end": "1630159"
  },
  {
    "text": "hear on Friday afternoon just before going for beers right it'll be fine I think that's what got us into this thing",
    "start": "1630159",
    "end": "1637960"
  },
  {
    "text": "let me just double check that um way point deployment destroy oh I",
    "start": "1637960",
    "end": "1646039"
  },
  {
    "text": "just gosh pluralization nobody can agree on that can they so I'm just reverting things back to to their to an original",
    "start": "1646039",
    "end": "1653760"
  },
  {
    "text": "state so we're going back just to that single deployment this is our vanilla cluster luckily both of them were",
    "start": "1653760",
    "end": "1661080"
  },
  {
    "text": "working so now what I'm going to do is I'm actually going to go apply my my",
    "start": "1661080",
    "end": "1666480"
  },
  {
    "text": "release configuration so that file that we've just looked at I am just going to apply that to the",
    "start": "1666480",
    "end": "1675720"
  },
  {
    "text": "cluster so you're using kubernetes now Nick could this also work for anything",
    "start": "1675720",
    "end": "1681320"
  },
  {
    "text": "outside of that yeah so so I mean I think that's one of the that is one of the benefits of working with a platform",
    "start": "1681320",
    "end": "1686559"
  },
  {
    "text": "like console that it's heterogeneous so we can work with kubernetes with Nomad with",
    "start": "1686559",
    "end": "1692360"
  },
  {
    "text": "ECS um with kind of BMS a number of different sort of methodologies but like",
    "start": "1692360",
    "end": "1698480"
  },
  {
    "text": "this kubernetes is predominantly the direction that everybody's going in so it's it's obvious have first class",
    "start": "1698480",
    "end": "1703640"
  },
  {
    "text": "support there right so I'm applying that",
    "start": "1703640",
    "end": "1709039"
  },
  {
    "text": "release now what is going to go on so the first thing that's going to happen",
    "start": "1709039",
    "end": "1714080"
  },
  {
    "text": "is that the release controller has detected that we've just configured a new release now what it's going to do is",
    "start": "1714080",
    "end": "1721159"
  },
  {
    "text": "it needs to take ownership of the current deployment because you don't own that anymore it's now under release so",
    "start": "1721159",
    "end": "1726640"
  },
  {
    "text": "you can see there that it's cloned the deployment and it's created a new one",
    "start": "1726640",
    "end": "1732240"
  },
  {
    "text": "called primary because now when we're looking at a canary what we're going to be dealing with is the primary and the",
    "start": "1732240",
    "end": "1737799"
  },
  {
    "text": "can AR the primary is the last good known State the canary is the",
    "start": "1737799",
    "end": "1743080"
  },
  {
    "text": "application under test so the release controller has created that clone it's just waiting for",
    "start": "1743080",
    "end": "1749320"
  },
  {
    "text": "it to go healthy it then creates all the necessary configuration that Eric did",
    "start": "1749320",
    "end": "1754960"
  },
  {
    "text": "manually in order to make sure that all of the traffic is going through to the primary and then it it cleans up and it",
    "start": "1754960",
    "end": "1760919"
  },
  {
    "text": "removes the old primary so then if we look over into our application dashboard",
    "start": "1760919",
    "end": "1767200"
  },
  {
    "text": "and there's going to be a little bit lag um in here so this is basically you've",
    "start": "1767200",
    "end": "1773679"
  },
  {
    "text": "applied that and it just puts it in a base state where it's now waiting for new deployments yeah that's correct so",
    "start": "1773679",
    "end": "1780600"
  },
  {
    "text": "we will you know we'll see that in just a second here",
    "start": "1780600",
    "end": "1787399"
  },
  {
    "text": "that when this finally gets around refreshing that we're going to see that",
    "start": "1787399",
    "end": "1793480"
  },
  {
    "text": "we've got all of our traffic and it's going to be coming through to the primary well assuming that my dashboard",
    "start": "1793480",
    "end": "1800480"
  },
  {
    "text": "is actually reloading which doesn't seem to be oh there we go",
    "start": "1800480",
    "end": "1805600"
  },
  {
    "text": "thank you dashboard again conference Wi-Fi disadvantage that's like the worst thing",
    "start": "1805600",
    "end": "1810919"
  },
  {
    "text": "about if you had to do this all manually is like you'd be staring at grafana for hours and hours and we all know how",
    "start": "1810919",
    "end": "1817120"
  },
  {
    "text": "painful it is to just wait for it to update so the the next step is we need",
    "start": "1817120",
    "end": "1822480"
  },
  {
    "text": "to to kind of kick off another deployment so if I go back back over",
    "start": "1822480",
    "end": "1828960"
  },
  {
    "text": "here and I go back to",
    "start": "1828960",
    "end": "1834360"
  },
  {
    "text": "my my terminal I'm going to add an",
    "start": "1834440",
    "end": "1840320"
  },
  {
    "text": "update git commit YOLO V2 because always keep a",
    "start": "1840320",
    "end": "1847200"
  },
  {
    "text": "unique commit message and I'm going to push",
    "start": "1847200",
    "end": "1852240"
  },
  {
    "text": "that and I'm actually going to check that it does get picked up by my cicd if not I'm going to KCK it",
    "start": "1852240",
    "end": "1860039"
  },
  {
    "text": "manually but what we will what we will kind of hopefully see in a second is that the the kind of the the CI build",
    "start": "1860039",
    "end": "1866440"
  },
  {
    "text": "process is going to kick off and V6 of our application is going to to start to",
    "start": "1866440",
    "end": "1872399"
  },
  {
    "text": "roll out I think it'll be V7 oh it'll be V7 of course it",
    "start": "1872399",
    "end": "1877559"
  },
  {
    "text": "will but so that kind of covers those",
    "start": "1877559",
    "end": "1882639"
  },
  {
    "text": "those steps now okay great the bill is going this is thank you demog gods",
    "start": "1882639",
    "end": "1888480"
  },
  {
    "text": "right now we're not going to wait for this what I'm going to do is I'm going to explain to you a couple of caveats",
    "start": "1888480",
    "end": "1894519"
  },
  {
    "text": "and considerations because what's really important when you're kind of thinking about sort of canary deployments is that",
    "start": "1894519",
    "end": "1901200"
  },
  {
    "text": "it's not all kind of unicorns and rainbows there are are we going to the server room we're going to go to the the",
    "start": "1901200",
    "end": "1907360"
  },
  {
    "text": "server room so I asked Eric I said hey can you like just build us a Minecraft thing and maybe make it a little you",
    "start": "1907360",
    "end": "1913000"
  },
  {
    "text": "just do it like a Hollywood set that's what I did you took that to the absolute literal what it I made Britain didn't",
    "start": "1913000",
    "end": "1921480"
  },
  {
    "text": "like there's a kebab shop oh the so this is a new Kebab shop which is uh just opened and",
    "start": "1921480",
    "end": "1927039"
  },
  {
    "text": "um like allegedly the meat is really",
    "start": "1927039",
    "end": "1932720"
  },
  {
    "text": "fresh good so let's take a look at this caveats and",
    "start": "1932720",
    "end": "1938279"
  },
  {
    "text": "considerations now the kind of the first one that you need to think about when you're running a canary deployment is the sample size and this is probably one",
    "start": "1938279",
    "end": "1944799"
  },
  {
    "text": "of the most the most important things because if you're running an automated test",
    "start": "1944799",
    "end": "1950360"
  },
  {
    "text": "you've got to be ensuring that you're comparing like for like and that you actually have enough",
    "start": "1950360",
    "end": "1956480"
  },
  {
    "text": "traffic to to sort of do an accurate analysis and it's kind of exactly the same as if you were doing any form of",
    "start": "1956480",
    "end": "1961960"
  },
  {
    "text": "scientific research now the kind of the problem with the sample size is like how do you",
    "start": "1961960",
    "end": "1969440"
  },
  {
    "text": "sort of get to that so let's let's look at a hypothetical situation so a hypothetical situation is that in a",
    "start": "1969440",
    "end": "1975559"
  },
  {
    "text": "24-hour period we have 10,000 ,000 requests and of those 10,000 requests",
    "start": "1975559",
    "end": "1983159"
  },
  {
    "text": "there's a bug in the system which results in 10% of the requests failing so we have a 10% error",
    "start": "1983159",
    "end": "1988840"
  },
  {
    "text": "rate now if we want to be 100% certain that when we do our Canary",
    "start": "1988840",
    "end": "1995799"
  },
  {
    "text": "deployment that we are making an improvement we really need to kind of",
    "start": "1995799",
    "end": "2001679"
  },
  {
    "text": "push the same sort of traffic at the canary to be able to evaluate the",
    "start": "2001679",
    "end": "2006760"
  },
  {
    "text": "results but you can't do that well does that mean we need to wait 24 hours before we can increase traffic well",
    "start": "2006760",
    "end": "2013159"
  },
  {
    "text": "technically we'd have to wait longer than 24 hours because we are only running the the traffic as a percentile",
    "start": "2013159",
    "end": "2018799"
  },
  {
    "text": "increase so we're not really just pushing 100% And 100% so we we're never going to have that that validation",
    "start": "2018799",
    "end": "2025799"
  },
  {
    "text": "situation but it's fine because actually you know sort of Statistics has got our",
    "start": "2025799",
    "end": "2031519"
  },
  {
    "text": "back here and as I said it's it's like a common problem that you find in medical research that you find find in sort of",
    "start": "2031519",
    "end": "2038919"
  },
  {
    "text": "any form of Market Research in that the sample size should just be",
    "start": "2038919",
    "end": "2044279"
  },
  {
    "text": "representative so the reality in kind of statistical research is like do I need to be 100% confident not necessarily I'm",
    "start": "2044279",
    "end": "2052040"
  },
  {
    "text": "probably happy with 95% confident so if I'm happy with 95%",
    "start": "2052040",
    "end": "2058440"
  },
  {
    "text": "confidence then like what is my sample size can you maybe uh",
    "start": "2058440",
    "end": "2064760"
  },
  {
    "text": "math explain that a bit Nick I can I can try and math explain it but I'm I'm not particularly the most brilliant person",
    "start": "2064760",
    "end": "2071118"
  },
  {
    "text": "in mathematics but the in in statistics there is a Formula which is yam's sort of formula and this is a kind of a",
    "start": "2071119",
    "end": "2077800"
  },
  {
    "text": "simple way of calculating a sample size so you take the population which is the 10,000",
    "start": "2077800",
    "end": "2085320"
  },
  {
    "text": "requests and you divide that over kind of one plus the population multiplied by the the kind of",
    "start": "2085320",
    "end": "2091960"
  },
  {
    "text": "the error rate that you want squared so 25 sorry 95 all right so if if I look at",
    "start": "2091960",
    "end": "2099359"
  },
  {
    "text": "that here then actually if we put the numbers in what we actually get is to get a 95% confidence that we're covering",
    "start": "2099359",
    "end": "2106960"
  },
  {
    "text": "the same number of Errors we actually only need 400 requests not not 10,000 so",
    "start": "2106960",
    "end": "2112240"
  },
  {
    "text": "that's a that's a kind of a standard statistical thing does that mean you kind of need to",
    "start": "2112240",
    "end": "2117280"
  },
  {
    "text": "sort of run these calculations like everything's down to risk and and I think that is is kind of the sort of the",
    "start": "2117280",
    "end": "2124800"
  },
  {
    "text": "the key the key thing in this and and it it really depends on on whichever",
    "start": "2124800",
    "end": "2129960"
  },
  {
    "text": "service what you're doing if you're building just a a sort of a simplistic front end service that that has a very",
    "start": "2129960",
    "end": "2136599"
  },
  {
    "text": "low risk then maybe you'll take a a different approach as if you had a high risk in this instance payment service so",
    "start": "2136599",
    "end": "2144359"
  },
  {
    "text": "our our release has actually been running here and what you can actually see if you look at the Yellow Line This",
    "start": "2144359",
    "end": "2149800"
  },
  {
    "text": "is the canary the green line is actually our our primary or our last known good",
    "start": "2149800",
    "end": "2154839"
  },
  {
    "text": "state so the the release controller is Auto automatically checking the health",
    "start": "2154839",
    "end": "2160040"
  },
  {
    "text": "of our Canary it's detecting that there are no errors with it so it is changing the service splitter automatically by",
    "start": "2160040",
    "end": "2167520"
  },
  {
    "text": "those 20% increments and reducing the primary traffic so we're slowly kind of",
    "start": "2167520",
    "end": "2173880"
  },
  {
    "text": "switching the traffic over there what we're going to see in in just a second",
    "start": "2173880",
    "end": "2179280"
  },
  {
    "text": "when it completes is that it's going to completely replace the the primary with",
    "start": "2179280",
    "end": "2185560"
  },
  {
    "text": "the new candidate which I'm actually pretty pleased that",
    "start": "2185560",
    "end": "2190720"
  },
  {
    "text": "worked well it's going a lot better than it started so I mean I I have to sort of",
    "start": "2190720",
    "end": "2196319"
  },
  {
    "text": "put some qualification on this that under normal circumstances you're going to be running sort of your your",
    "start": "2196319",
    "end": "2202480"
  },
  {
    "text": "kubernetes clusters and all of your applications soft on on proper Hardware well first we were like well",
    "start": "2202480",
    "end": "2209079"
  },
  {
    "text": "I'm just going to run out on my laptop you literally would not be able to hear me speak because of the noise of that",
    "start": "2209079",
    "end": "2214280"
  },
  {
    "text": "fan when I was running everything on my laptop so we're we're actually running it on a a scale wave",
    "start": "2214280",
    "end": "2220920"
  },
  {
    "text": "VM uh in in in the cloud which has only",
    "start": "2220920",
    "end": "2226359"
  },
  {
    "text": "got like half a dozen CPUs I think it only has two actually and 8 gig of RAM",
    "start": "2226359",
    "end": "2231880"
  },
  {
    "text": "so it's a very limited resource machine which is why I kind of say I'm pleased that it worked because it kind of does",
    "start": "2231880",
    "end": "2237640"
  },
  {
    "text": "prove to The Testament that you can kind of run a complex system on on very limited Hardware as well so that's",
    "start": "2237640",
    "end": "2243040"
  },
  {
    "text": "that's that's um completely converged now we're going to look over here",
    "start": "2243040",
    "end": "2250160"
  },
  {
    "text": "into console and what you're going to",
    "start": "2250160",
    "end": "2255160"
  },
  {
    "text": "see in a second is you're going to see that that V7 is going to get replaced by",
    "start": "2255280",
    "end": "2261599"
  },
  {
    "text": "by the primary just let's dig before we kind of move on let's just quickly dig",
    "start": "2261599",
    "end": "2266680"
  },
  {
    "text": "into some of the kind of the log so you can actually see what is going on inside of the",
    "start": "2266680",
    "end": "2274839"
  },
  {
    "text": "release controller and if I kind of scroll scroll down here",
    "start": "2274839",
    "end": "2283240"
  },
  {
    "text": "through some logs and I find something that's interesting here we go that one yep so this is the release controller",
    "start": "2283240",
    "end": "2288520"
  },
  {
    "text": "when it's evaluating the passive health of the application it's literally just executing those queries now it is kind",
    "start": "2288520",
    "end": "2295359"
  },
  {
    "text": "of a predefined query but it's then just sort of looking at the value it's",
    "start": "2295359",
    "end": "2300880"
  },
  {
    "text": "getting the value back the value here being 100% so it's it's completely",
    "start": "2300880",
    "end": "2306599"
  },
  {
    "text": "successful and it progresses now what I'm actually doing is I'm I'm executing two queries I'm executing one which is",
    "start": "2306599",
    "end": "2313200"
  },
  {
    "text": "the the health on the number of requests so the number of requests which result in an HTTP 200 but I'm also valuating a",
    "start": "2313200",
    "end": "2321480"
  },
  {
    "text": "request sorry a uh a sort of a query which is looking at the duration of the service because I",
    "start": "2321480",
    "end": "2330560"
  },
  {
    "text": "may or I may not at some point in my career have pushed devnull to production",
    "start": "2330560",
    "end": "2337520"
  },
  {
    "text": "and I sat back and I'm like look at all of those beautiful HTTP 200s and what I'd actually done was completely unwired",
    "start": "2337520",
    "end": "2344520"
  },
  {
    "text": "the HTTP rout and we weren't actually processing a single thing so as a as a",
    "start": "2344520",
    "end": "2349720"
  },
  {
    "text": "kind of an additional check it's actually useful to also look at the duration of the request because actually",
    "start": "2349720",
    "end": "2355440"
  },
  {
    "text": "if it's too low that's a signal that something is wrong if it's too high of course that's a signal that something is",
    "start": "2355440",
    "end": "2361119"
  },
  {
    "text": "wrong so in this case we're like looking at metrics for our service mesh right",
    "start": "2361119",
    "end": "2367560"
  },
  {
    "text": "and those are basically internal to the system could we also maybe scale on",
    "start": "2367560",
    "end": "2373800"
  },
  {
    "text": "other things like external things like revenue or yeah and so this is an interesting point like and and I think",
    "start": "2373800",
    "end": "2379319"
  },
  {
    "text": "when we said that like you're looking at the passive data for a canary that it doesn't just have to be the the metrics",
    "start": "2379319",
    "end": "2384920"
  },
  {
    "text": "of your application it can actually be sort of external data so one of the things that we used to do in our",
    "start": "2384920",
    "end": "2390920"
  },
  {
    "text": "production system was we had a pretty a pretty good model of the revenue that the the business would make on a daily",
    "start": "2390920",
    "end": "2398440"
  },
  {
    "text": "basis and we used to use that model as a kind of an indicator of system health",
    "start": "2398440",
    "end": "2403839"
  },
  {
    "text": "because if we were way beneath the target it was actually an indication that something was not particularly",
    "start": "2403839",
    "end": "2410640"
  },
  {
    "text": "right with the service and and I think you can actually pull those kinds of metrics into a system like this as well",
    "start": "2410640",
    "end": "2416920"
  },
  {
    "text": "and use that as a sort of indicative of system systemic health and I think what's also interesting is you can it",
    "start": "2416920",
    "end": "2422560"
  },
  {
    "text": "can be system Health but it can also be like we release a new feature and and is",
    "start": "2422560",
    "end": "2427760"
  },
  {
    "text": "that feature actually more successful than the previous version if Revenue doesn't increase that could also be a",
    "start": "2427760",
    "end": "2434240"
  },
  {
    "text": "sign like okay maybe we need to roll back and rethink the the feature exactly it doesn't have to be a failure right no",
    "start": "2434240",
    "end": "2439800"
  },
  {
    "text": "no no no not in the uh not in the slightest not again right I mean we",
    "start": "2439800",
    "end": "2447599"
  },
  {
    "text": "already did two of them Friday seriously go on I'm not I don't want to",
    "start": "2447599",
    "end": "2454240"
  },
  {
    "text": "speak to no come on you did last time fine I'll take it hey Melissa yeah no no we were not",
    "start": "2454240",
    "end": "2462920"
  },
  {
    "text": "outside doing anything no uh-huh really $6 saved by changing the",
    "start": "2462920",
    "end": "2471040"
  },
  {
    "text": "CCV code from Five Characters to three fine we'll do it",
    "start": "2471040",
    "end": "2479720"
  },
  {
    "text": "bye all right so I guess you already heard we need to change the CCV codes",
    "start": "2479720",
    "end": "2485599"
  },
  {
    "text": "from five to three seems simple enough we now have Automation in place I mean if it breaks",
    "start": "2485599",
    "end": "2491480"
  },
  {
    "text": "we can still go for beers and doesn't matter so we're going to change the CVV code from Five Characters down to three",
    "start": "2491480",
    "end": "2500800"
  },
  {
    "text": "characters to save $10 six oh okay that's all right yeah now the the kind",
    "start": "2500800",
    "end": "2508400"
  },
  {
    "text": "of the like this is going to break I mean American Express uses a full character",
    "start": "2508400",
    "end": "2514240"
  },
  {
    "text": "code so but who uses American Express well I I mean I think we do oh that",
    "start": "2514240",
    "end": "2520200"
  },
  {
    "text": "would mean we couldn't buy beer all right let's hope it fails and rolls back",
    "start": "2520200",
    "end": "2525560"
  },
  {
    "text": "well look I'm just going to make this change anyway because I really just want to get out our",
    "start": "2525560",
    "end": "2531838"
  },
  {
    "text": "bills let's hope this change is better than the last one you made well I'm I'm not confident so you let's have a look",
    "start": "2535680",
    "end": "2543480"
  },
  {
    "text": "get commit DM um YOLO V3 I think this is going to",
    "start": "2543480",
    "end": "2552480"
  },
  {
    "text": "break not my",
    "start": "2552480",
    "end": "2558079"
  },
  {
    "text": "B and I'm going to push that so this whole process is is going",
    "start": "2559000",
    "end": "2564280"
  },
  {
    "text": "to kick off again now you kind of when when you kind of think about this on the size of it you",
    "start": "2564280",
    "end": "2570480"
  },
  {
    "text": "think well you got to be absolutely Bonkers you're pushing a change of code which you know is going to be broken and",
    "start": "2570480",
    "end": "2575839"
  },
  {
    "text": "and and I think that you know that that's that's a very valid sort of um accusation but the sort of the key thing",
    "start": "2575839",
    "end": "2581800"
  },
  {
    "text": "is that sometimes you're pushing code that you just don't know like you you you're unsure about that there there",
    "start": "2581800",
    "end": "2588960"
  },
  {
    "text": "could be something that you're not entirely certain about and it's not something that you",
    "start": "2588960",
    "end": "2594400"
  },
  {
    "text": "can test because as we kind of said earlier you are always going to have these issues",
    "start": "2594400",
    "end": "2599880"
  },
  {
    "text": "where there are things beyond your control it could be external inputs it could be load it could be configuration",
    "start": "2599880",
    "end": "2605079"
  },
  {
    "text": "it could be sort of any of those things now what we should start to see here is",
    "start": "2605079",
    "end": "2611760"
  },
  {
    "text": "that automated release process but it should automatically back out",
    "start": "2611760",
    "end": "2617319"
  },
  {
    "text": "now there is a little caveat around this should we maybe head outside and",
    "start": "2617319",
    "end": "2625319"
  },
  {
    "text": "talk about bre frying we can oh we it's going to be more interesting than setting standing at Graff and",
    "start": "2625319",
    "end": "2631880"
  },
  {
    "text": "chart no so again with with all of these things you you got to think about the",
    "start": "2631880",
    "end": "2638160"
  },
  {
    "text": "sort of the the caveats and and considerations now one of the one of the kind of the things that",
    "start": "2638160",
    "end": "2645599"
  },
  {
    "text": "that you kind of need to think about is things like how do you change data stores so how do you do a canary",
    "start": "2645599",
    "end": "2652599"
  },
  {
    "text": "release with the data store because if you're making a dependent change on the data store well what's going to happen",
    "start": "2652599",
    "end": "2659400"
  },
  {
    "text": "so that's that's actually a sort of a very valid sort of thing and what you need to ensure if you do have a",
    "start": "2659400",
    "end": "2664920"
  },
  {
    "text": "dependency like an upstream or another data store is that it works with both versions the",
    "start": "2664920",
    "end": "2671480"
  },
  {
    "text": "old and the new so sometimes you have to do like a three-step process in order to",
    "start": "2671480",
    "end": "2677520"
  },
  {
    "text": "get from one sort of data store or or Upstream change to another otherwise you've got no way of",
    "start": "2677520",
    "end": "2683760"
  },
  {
    "text": "rolling back if I change the database and I mutate the data fields which are dependent on V2 well I can't roll back",
    "start": "2683760",
    "end": "2691520"
  },
  {
    "text": "to V1 without again changing the database that's certainly not something I can really do automatically without",
    "start": "2691520",
    "end": "2696760"
  },
  {
    "text": "down time but it's not such a major kind of deal I mean even if you wanted to do",
    "start": "2696760",
    "end": "2702280"
  },
  {
    "text": "something like moving a database field from an integer uh from from a string to an integer or something like that you",
    "start": "2702280",
    "end": "2708079"
  },
  {
    "text": "can do it as a two-step process you know you can add a new field the V2 can write to the new field the V1 can write to the",
    "start": "2708079",
    "end": "2715160"
  },
  {
    "text": "old field at the point that you're happy that V2 is behaving you deprecate V1 all",
    "start": "2715160",
    "end": "2720800"
  },
  {
    "text": "of the new data is being written to the new field you migrate it over at which point you can then deprecate the field",
    "start": "2720800",
    "end": "2727160"
  },
  {
    "text": "or or move things on inside of the database so it's you know it's it's possible to do this but it's something",
    "start": "2727160",
    "end": "2732800"
  },
  {
    "text": "you've got to you've got to think about the other thing I think that you need to think about and we're going to see this",
    "start": "2732800",
    "end": "2738079"
  },
  {
    "text": "in a moment is that even though we're doing a canary release we're limiting",
    "start": "2738079",
    "end": "2745480"
  },
  {
    "text": "exposure of um of of the kind of the the errors we're not completely removing the",
    "start": "2746280",
    "end": "2753720"
  },
  {
    "text": "errors itself and hopefully we're going to see some errors",
    "start": "2753720",
    "end": "2759680"
  },
  {
    "text": "once we get we we do have a bad version",
    "start": "2759680",
    "end": "2765880"
  },
  {
    "text": "deployed and and that's because I'm seeing errors that's good yeah we're starting to see some errors here so you",
    "start": "2765880",
    "end": "2771240"
  },
  {
    "text": "know the the the errors are still getting manifested back to the end user so how do you cover that well you know",
    "start": "2771240",
    "end": "2777559"
  },
  {
    "text": "the very simple pattern is that you you kind of do a retry on this because we're only pushing a fraction of the traffic",
    "start": "2777559",
    "end": "2784079"
  },
  {
    "text": "through it should be safe enough to do a number of retries in order that your",
    "start": "2784079",
    "end": "2789559"
  },
  {
    "text": "your Downstream service actually hits one of the last good known States and and you can see there that",
    "start": "2789559",
    "end": "2796319"
  },
  {
    "text": "the arrows are coming through and we're going to kind of leave this to tick away because this is eventually going to kind",
    "start": "2796319",
    "end": "2801440"
  },
  {
    "text": "of roll back and because we're like we're out of here I mean we're like we're halfway to the to to the pub but",
    "start": "2801440",
    "end": "2807280"
  },
  {
    "text": "like just looking at retries you got to think about this so first things first a retry is not",
    "start": "2807280",
    "end": "2814160"
  },
  {
    "text": "something you should use that masks an underlying problem retry is a temporary fix you don't don't put retries on your",
    "start": "2814160",
    "end": "2821400"
  },
  {
    "text": "system and you and expect your like your user errors to go away and the job is done no it's it's something which which",
    "start": "2821400",
    "end": "2827720"
  },
  {
    "text": "is a temporary fix because the key thing about a retry is you got to think about how it Bears on load because a retry",
    "start": "2827720",
    "end": "2834760"
  },
  {
    "text": "adds additional load to your system it adds additional latency to your system latency adds additional load to your",
    "start": "2834760",
    "end": "2840040"
  },
  {
    "text": "system so a misconfigured or a badly configured retry can actually be damaging to the system so it's you know",
    "start": "2840040",
    "end": "2846079"
  },
  {
    "text": "something that you've got to to kind of think about and and I think when you're looking at retries as well you know you",
    "start": "2846079",
    "end": "2851920"
  },
  {
    "text": "have to think about path awareness because it's not always safe to just",
    "start": "2851920",
    "end": "2858240"
  },
  {
    "text": "retry something now if you could doing something like a sort of a get request an item potent request retry okay pretty",
    "start": "2858240",
    "end": "2864880"
  },
  {
    "text": "safe but if I'm posting to create a new payment or I'm sending an email you know obviously obviously not and well if I",
    "start": "2864880",
    "end": "2874119"
  },
  {
    "text": "can kind of find the right button here and the right Clicker here we go we we're kind of not going to talk",
    "start": "2874119",
    "end": "2880359"
  },
  {
    "text": "too much about item pocy because it's literally a conference talk in it well it's at least one conference talk in",
    "start": "2880359",
    "end": "2885720"
  },
  {
    "text": "itself but it's something that you have to be aware of whenever you're doing a canary release if you're applying",
    "start": "2885720",
    "end": "2891200"
  },
  {
    "text": "something like a retry are you actually hitting item potent end points and if",
    "start": "2891200",
    "end": "2897599"
  },
  {
    "text": "not can you make that application or that service item potent to be able to do so so item potent being that one",
    "start": "2897599",
    "end": "2904520"
  },
  {
    "text": "request results in the same and result so again something like a get pretty much safe like if you're going to do an",
    "start": "2904520",
    "end": "2910720"
  },
  {
    "text": "update if you update a database table with the same data twice and result is the same now a payment generally unsafe",
    "start": "2910720",
    "end": "2918599"
  },
  {
    "text": "because I'm going to potentially take double payments and um you know like",
    "start": "2918599",
    "end": "2925599"
  },
  {
    "text": "let's let's just apply some retries and see see what happens because",
    "start": "2925599",
    "end": "2933960"
  },
  {
    "text": "um now item potency is not actually something you can fix by using any of",
    "start": "2934119",
    "end": "2939599"
  },
  {
    "text": "these tools that's something you'll actually have to go into your application because it's very situation specific like what are you actually",
    "start": "2939599",
    "end": "2946720"
  },
  {
    "text": "doing that it will cause issues like so Nick said payments right like because",
    "start": "2946720",
    "end": "2952079"
  },
  {
    "text": "every create will just create a new entry like you might have to solve that either in the application layer where",
    "start": "2952079",
    "end": "2958839"
  },
  {
    "text": "with constraints or first checking if something already exists or you might maybe want to add constraints to your",
    "start": "2958839",
    "end": "2964599"
  },
  {
    "text": "database where if you try to do an insert with things that are already filled it'll just fail and then your",
    "start": "2964599",
    "end": "2971160"
  },
  {
    "text": "application would have to deal with with that an item Point strategy does range it it ranges from as simple as just",
    "start": "2971160",
    "end": "2977000"
  },
  {
    "text": "hashing a request and checking if you've already processed her or something in action to to the very complex which is",
    "start": "2977000",
    "end": "2983000"
  },
  {
    "text": "kind of using the queing so again I'm using service mesh to be able to kind of",
    "start": "2983000",
    "end": "2988599"
  },
  {
    "text": "control the aspects of that that sort of network rooting I've just pushed some configuration there I'm going to do five",
    "start": "2988599",
    "end": "2994920"
  },
  {
    "text": "retries on those status Cod Cod so 500 501 and etc etc now bad request is in",
    "start": "2994920",
    "end": "3001760"
  },
  {
    "text": "there ordinarily that's not something to to retry on but um when I built this demo in my that depends on where you get",
    "start": "3001760",
    "end": "3008960"
  },
  {
    "text": "the bad request though like in our case the requests are coming from the API service to the payment service yeah like",
    "start": "3008960",
    "end": "3015760"
  },
  {
    "text": "the API service shouldn't be making any bad requests but if a user does it you",
    "start": "3015760",
    "end": "3021240"
  },
  {
    "text": "don't know what you're going to get so like we we're we're pretty much done here what what you can see there actually is is that um the release",
    "start": "3021240",
    "end": "3028079"
  },
  {
    "text": "controller has recognized my my bad code and it's it's rolled it back so the that",
    "start": "3028079",
    "end": "3034680"
  },
  {
    "text": "in combination with the retry um well is is pretty much going to to kind of uh",
    "start": "3034680",
    "end": "3041960"
  },
  {
    "text": "cover us from from all of the things and uh well we can uh we can go to to",
    "start": "3041960",
    "end": "3048319"
  },
  {
    "text": "the is that item potency not going to cause any problems for us like those double payments well the double payments",
    "start": "3048319",
    "end": "3055160"
  },
  {
    "text": "I mean we've got the qbr on Monday so so I mean we're going to get a promotion we've just raised Revenue oh good point",
    "start": "3055160",
    "end": "3060480"
  },
  {
    "text": "all right but you know very real concern is it's easy to be kind of flippant about these things but with the right",
    "start": "3060480",
    "end": "3067680"
  },
  {
    "text": "knowledge with the right approach you can sort of very very easily kind of",
    "start": "3067680",
    "end": "3073599"
  },
  {
    "text": "manage these issues now just as a as a very very quick kind of tldr we haven't",
    "start": "3073599",
    "end": "3079400"
  },
  {
    "text": "talked about the the kind of the architecture of of the kind of the system that they're running today because we kind of more wanted to talk",
    "start": "3079400",
    "end": "3085319"
  },
  {
    "text": "about the process and more about the the kind of issues which are surrounding the process but we are kind of running over",
    "start": "3085319",
    "end": "3092480"
  },
  {
    "text": "all of our applications on service mesh so what does what does that mean it means that all of the network traffic is",
    "start": "3092480",
    "end": "3097960"
  },
  {
    "text": "basically intercepted before it hits your application service so it's hitting the the concept of the the sort of the",
    "start": "3097960",
    "end": "3103799"
  },
  {
    "text": "data plane and the control plane the control plane being um in this console",
    "start": "3103799",
    "end": "3108920"
  },
  {
    "text": "or or link all that really does is controls",
    "start": "3108920",
    "end": "3114160"
  },
  {
    "text": "the the kind of the configuration of these little sidecar proxies which sit in front of the traffic of your",
    "start": "3114160",
    "end": "3120200"
  },
  {
    "text": "application so they're doing a number of different things terminating TLS being one of them giving you kind of secure",
    "start": "3120200",
    "end": "3126480"
  },
  {
    "text": "transport but ultimately what it also gives you is load balancing which is happening at a local level so each of",
    "start": "3126480",
    "end": "3134319"
  },
  {
    "text": "these individual proxies is actually dealing with Upstream load balancing it is aware of this kind of like weighted",
    "start": "3134319",
    "end": "3141040"
  },
  {
    "text": "approach and it's aware of the ability to sort of reconfigure the retries important ly what they're also doing is",
    "start": "3141040",
    "end": "3147960"
  },
  {
    "text": "they're emitting consistent metrics into our system which",
    "start": "3147960",
    "end": "3153440"
  },
  {
    "text": "is where we're using promethus so the application doesn't even need to be augmented with any s of metrics to be",
    "start": "3153440",
    "end": "3158920"
  },
  {
    "text": "able to do this kind of passive monitoring the the sort of the service mesh does that for you as K we we talked",
    "start": "3158920",
    "end": "3165359"
  },
  {
    "text": "about earlier can you do that without service mesh yes like in my humble",
    "start": "3165359",
    "end": "3170799"
  },
  {
    "text": "opinion and like you know take take the name of the badge of my shirt away my my",
    "start": "3170799",
    "end": "3176000"
  },
  {
    "text": "humble and sort of professional opinion is that this type of capability this software defined Network layer is is",
    "start": "3176000",
    "end": "3182720"
  },
  {
    "text": "just something that makes it so much easier to build these kinds of reliable",
    "start": "3182720",
    "end": "3187920"
  },
  {
    "text": "systems yes and it also has the added benefit that you can change this configuration on the Fly because all the",
    "start": "3187920",
    "end": "3194599"
  },
  {
    "text": "configuration that we've been writing all it's been doing is just dynamically change the configuration of those",
    "start": "3194599",
    "end": "3199799"
  },
  {
    "text": "proxies without the applications being aware so if you don't have an issue with item potency potentially you can use",
    "start": "3199799",
    "end": "3205960"
  },
  {
    "text": "these techniqu with your services tomorrow without having to change you know a single sort of thing I think we",
    "start": "3205960",
    "end": "3212240"
  },
  {
    "text": "can open the the kind of the floor a little bit up to some questions we do have a few minutes um I hope it's been",
    "start": "3212240",
    "end": "3218760"
  },
  {
    "text": "useful for everybody I I hope it hasn't been kind of like too much to takeen it's kind of like one of those things",
    "start": "3218760",
    "end": "3223920"
  },
  {
    "text": "which is better to kind of play with around on your on your own but like in",
    "start": "3223920",
    "end": "3229160"
  },
  {
    "text": "all of the things that we've kind of looked at and we've we've read there's I I think sort of the depth around some of",
    "start": "3229160",
    "end": "3235240"
  },
  {
    "text": "the problems is not necessarily apparent and it's not the sort of thing you want to really learn on the job well",
    "start": "3235240",
    "end": "3240880"
  },
  {
    "text": "we remember Paris yeah no we we cannot do that again we really need to keep this",
    "start": "3240880",
    "end": "3246640"
  },
  {
    "text": "job and uh yeah so thank you thank you so much",
    "start": "3246640",
    "end": "3257160"
  }
]