[
  {
    "start": "0",
    "end": "79000"
  },
  {
    "text": "okay let's get this kicked off thanks for coming everyone and today we're gonna look at lessons learned from",
    "start": "6390",
    "end": "12610"
  },
  {
    "text": "billions of security reports my name's Scott hello my Twitter handles up there I'm actually really close to 20,000",
    "start": "12610",
    "end": "18400"
  },
  {
    "text": "followers if you could help me out is how I judge myself as a person by how many Twitter followers I have and I'm",
    "start": "18400",
    "end": "24550"
  },
  {
    "text": "here today to talk about a little project that I started a long time ago actually some of you if you've seen me on Twitter read my blogs you will have",
    "start": "24550",
    "end": "30430"
  },
  {
    "text": "heard of report URI now it's not a sales pitch and hopefully as we go through",
    "start": "30430",
    "end": "35559"
  },
  {
    "text": "you'll see I've made every effort to make this nice sales pitch what I want to do is kind of tell you the story of how this project came to be so it's a",
    "start": "35559",
    "end": "42430"
  },
  {
    "text": "tiny little project that I started years and years and years ago and now it's a fairly big company that processes quite",
    "start": "42430",
    "end": "48340"
  },
  {
    "text": "literally billions of security reports every month so there's a couple of like personal stories in there the technical story of how we actually scaled from a",
    "start": "48340",
    "end": "55300"
  },
  {
    "text": "hobby project to 16 17 thousand reports a second we get our busy Peaks now so",
    "start": "55300",
    "end": "62020"
  },
  {
    "text": "this is us if you want to check us out report your Icom we are a security reporting service I'm going to talk a little bit about the kind of reports",
    "start": "62020",
    "end": "68229"
  },
  {
    "text": "that we get and how and also how we handle them at scale because that's really the big thing here this has grown",
    "start": "68229",
    "end": "74590"
  },
  {
    "text": "to be kind of so much bigger than I ever expected it to be so the kind of reports that we get we support native reporting",
    "start": "74590",
    "end": "82659"
  },
  {
    "start": "79000",
    "end": "118000"
  },
  {
    "text": "mechanisms in the browser so pretty much every mainstream browser now has one or more of these reporting facilities built",
    "start": "82659",
    "end": "89140"
  },
  {
    "text": "in we typically think of the browser is like hey we'll just like render a page send it to the browser it will show it",
    "start": "89140",
    "end": "94150"
  },
  {
    "text": "to the user and it's just like a portal by the other side that we throw stuff at with the browser now you can actually ask it to become an active participant",
    "start": "94150",
    "end": "100750"
  },
  {
    "text": "in the delivery of the browsing experience so all mainstream browsers support this and what you can do is you",
    "start": "100750",
    "end": "107049"
  },
  {
    "text": "send your page to the browser and say here is my page please show it to the user but if something goes wrong please would",
    "start": "107049",
    "end": "112960"
  },
  {
    "text": "you tell me and we have like these automatic reporting functions built-in so I'll give you a specific example of",
    "start": "112960",
    "end": "119890"
  },
  {
    "start": "118000",
    "end": "245000"
  },
  {
    "text": "one of them the first one is called content security policy so what we do with content security policies you can",
    "start": "119890",
    "end": "124899"
  },
  {
    "text": "guess from the name it is a security focused policy like I said these are largely security mechanisms for now is",
    "start": "124899",
    "end": "130390"
  },
  {
    "text": "you deliver something called a content security policy with your page so we can see HTTP response headers here that you",
    "start": "130390",
    "end": "136480"
  },
  {
    "text": "would see on any normal web page and we've added an extra one called content security policy now the idea of this is",
    "start": "136480",
    "end": "142540"
  },
  {
    "text": "that you give the browser a policy to enforce on the page in that policy if we expand it out might look something like",
    "start": "142540",
    "end": "149260"
  },
  {
    "text": "this so we've given the browser this CSP and what we do with CSP is we control where content on our website is allowed",
    "start": "149260",
    "end": "156610"
  },
  {
    "text": "to be loaded from so we're saying OK by default here the default source is self which means by default I can load things",
    "start": "156610",
    "end": "162760"
  },
  {
    "text": "from my own domain but then we get more specific script source I'm saying here on my website I log script from myself",
    "start": "162760",
    "end": "170140"
  },
  {
    "text": "and I load script from this CDN and what this means is if the browser is going through my page and rendering it and",
    "start": "170140",
    "end": "175840"
  },
  {
    "text": "sees a script tag from evil comm the browser will look at that and say write script tag source attribute evil com",
    "start": "175840",
    "end": "182530"
  },
  {
    "text": "it's not in the whitelist it's not allowed I'll throw the script away so you've now been able to control exactly",
    "start": "182530",
    "end": "188019"
  },
  {
    "text": "what script loads on your website and this is a super powerful feature in CSP same again everything else is fairly",
    "start": "188019",
    "end": "195099"
  },
  {
    "text": "self explanatory style source image source where can we load those types of content from form action is a really",
    "start": "195099",
    "end": "200170"
  },
  {
    "text": "good one where if forms allowed to post to so it's not just where can I load stuff from it's also where can I send",
    "start": "200170",
    "end": "205900"
  },
  {
    "text": "stuff to and we also have things like the Kinect sauce where you can control xhr so with CSP you can really start to take",
    "start": "205900",
    "end": "212380"
  },
  {
    "text": "a lot of control over your page and then the kind of last line here the really",
    "start": "212380",
    "end": "217420"
  },
  {
    "text": "important one is the report URI directive and what we doing here is you specify an end point where you say to",
    "start": "217420",
    "end": "222700"
  },
  {
    "text": "the browser if something happens that is not in accordance with this policy would you",
    "start": "222700",
    "end": "227950"
  },
  {
    "text": "please tell me about it would you send me a report so let's say it found that script tag with the source attribute of",
    "start": "227950",
    "end": "232989"
  },
  {
    "text": "evil com great the browser's blocked it but you don't know and this is where the",
    "start": "232989",
    "end": "238180"
  },
  {
    "text": "reporting comes in you say please block the bad thing but also could you tell me that a bad thing has happened so this is",
    "start": "238180",
    "end": "245950"
  },
  {
    "start": "245000",
    "end": "342000"
  },
  {
    "text": "what the script tag would look like I'm pretty sure that we can all agree okay raise your hands who wants this script tag to load in their page",
    "start": "245950",
    "end": "251200"
  },
  {
    "text": "hey okay nobody wants this to load and the browser will now block it which is fantastic but the reporting is like the",
    "start": "251200",
    "end": "257979"
  },
  {
    "text": "final piece in the puzzle because if the browser blocks it and doesn't tell you when are you going to fix this right like it's just gonna stay there forever",
    "start": "257979",
    "end": "265050"
  },
  {
    "text": "so with the reporting enabled the browser will dispatch a HTTP POST request with a JSON payload",
    "start": "265050",
    "end": "272139"
  },
  {
    "text": "the JSON payload contains all of the information that you need to know about what went wrong so first line document",
    "start": "272139",
    "end": "277990"
  },
  {
    "text": "URI what page was the user visiting on your website when this happened next one",
    "start": "277990",
    "end": "282999"
  },
  {
    "text": "violated directive well it was a script tag so it violated the script source it",
    "start": "282999",
    "end": "288849"
  },
  {
    "text": "gives you the original policy so you can see what the browser was working with in case you have different policies on different parts of your website maybe",
    "start": "288849",
    "end": "294729"
  },
  {
    "text": "different countries wherever and then the thing that it blocked so I could receive this piece of JSON and go right",
    "start": "294729",
    "end": "300520"
  },
  {
    "text": "so someone comes to my home page and there is literally a file on there trying to load key luggage is from evil",
    "start": "300520",
    "end": "306219"
  },
  {
    "text": "comm and the browser's blocked it and told me about it now I can go look how that got there remove it fix it maybe we've got some",
    "start": "306219",
    "end": "312789"
  },
  {
    "text": "kind of security issue whatever happened it doesn't matter the point is that you get the report so that you can know that",
    "start": "312789",
    "end": "318279"
  },
  {
    "text": "the thing has happened so that's a really quick overview of CSP you can use",
    "start": "318279",
    "end": "323620"
  },
  {
    "text": "this to do so many more things as well it's not kind of a talk about CSP what I wanted to show was how the browser",
    "start": "323620",
    "end": "329409"
  },
  {
    "text": "actually sends these reports because these are the kinds of reports that we collect you ask the browser to send",
    "start": "329409",
    "end": "334539"
  },
  {
    "text": "these JSON payloads to us and it's not just for CSP either there are several of",
    "start": "334539",
    "end": "339789"
  },
  {
    "text": "these mechanisms built into all mainstream browsers we have quite a few different ones at our disposal so take a",
    "start": "339789",
    "end": "347289"
  },
  {
    "text": "look through them we've got CSP up in the top left here so one that I just talked about HP KP this is this is",
    "start": "347289",
    "end": "353169"
  },
  {
    "text": "slightly controversial right now because it's such a powerful mechanism and if you deploy it and get it wrong you can",
    "start": "353169",
    "end": "358240"
  },
  {
    "text": "literally brick your whole website like actually break your website and turn it off and so chromium is currently talking",
    "start": "358240",
    "end": "364210"
  },
  {
    "text": "about deprecating this it might not be around for much longer certificate transparency is another really good one if you've not heard of",
    "start": "364210",
    "end": "370899"
  },
  {
    "text": "CT just google it and have a look it's a really cool mechanism where you can search through all certificates in",
    "start": "370899",
    "end": "376000"
  },
  {
    "text": "existence and the idea is that you've looked for certificates issued to your website the XSS auditor who knows that",
    "start": "376000",
    "end": "382719"
  },
  {
    "text": "most mainstream browsers have an XSS order to built-in so no no anyone seen those so the attack that I talked about",
    "start": "382719",
    "end": "389259"
  },
  {
    "text": "a minute ago with the evil.com script in there is what we might refer to as a cross-site scripting attack some bad",
    "start": "389259",
    "end": "394330"
  },
  {
    "text": "JavaScript gets into your page via whatever mechanism and generally it's going to give you a user a really bad",
    "start": "394330",
    "end": "399849"
  },
  {
    "text": "day most browsers now have an orbiter already built in that's trying to detect attack just like that and if it sees one",
    "start": "399849",
    "end": "406090"
  },
  {
    "text": "especially in chrome crumbs really kind of strict with this they will stop the script from running yeah well I don't if",
    "start": "406090",
    "end": "411700"
  },
  {
    "text": "I can say this script looks hostile I think I'm just going to take that out and stop it from running now chrome",
    "start": "411700",
    "end": "417940"
  },
  {
    "text": "already does this and it does this by default so this could already be happening on your website with the reporting mechanism what you can do is",
    "start": "417940",
    "end": "423760"
  },
  {
    "text": "ask the auditor if you step in to save my user from what you think is an attack please would you call home and tell me",
    "start": "423760",
    "end": "430210"
  },
  {
    "text": "now it's already stepping in and saving your users from attacks you just don't know it and this is kind of the thing",
    "start": "430210",
    "end": "435730"
  },
  {
    "text": "that blew my mind a little bit is like there's already stuff happening on my website that I don't know about we really should be gathering this feedback",
    "start": "435730",
    "end": "442180"
  },
  {
    "text": "from the browser and then the last one OCSP expects April this is a really kind",
    "start": "442180",
    "end": "448420"
  },
  {
    "text": "of in depth mechanism about certificate revocation I've actually done a talk online in collaboration with an NDC",
    "start": "448420",
    "end": "454720"
  },
  {
    "text": "events you should check that one out but they're all security mechanisms they're all based around the client side where",
    "start": "454720",
    "end": "460060"
  },
  {
    "text": "the browser can become an active participant in in kind of the security of your site really so these are all the",
    "start": "460060",
    "end": "467590"
  },
  {
    "text": "different types of reports where you collect the browser will come to your website let's say a good example because",
    "start": "467590",
    "end": "472930"
  },
  {
    "text": "we're just talking about PayPal earlier let's say PayPal was one of our customers you go to pebbles website there's some kind of error the browser",
    "start": "472930",
    "end": "479320"
  },
  {
    "text": "would dispatch that report to our service we process it we generate dashboards graphs things like that so we",
    "start": "479320",
    "end": "485680"
  },
  {
    "text": "need the infrastructure on our site to be able to take these reports if you're a high traffic customer and you get lots",
    "start": "485680",
    "end": "491800"
  },
  {
    "text": "of errors on your website all of your visitors if you've got millions of millions of visitors we'll send us millions of millions of errors now that",
    "start": "491800",
    "end": "498790"
  },
  {
    "start": "498000",
    "end": "678000"
  },
  {
    "text": "wasn't the case when we first started out when the first month that I built the service there was literally just me using it because it was a side project",
    "start": "498790",
    "end": "505720"
  },
  {
    "text": "I'd seen that the browser was capable of sending these reports and I thought this is awesome I can get all this feedback",
    "start": "505720",
    "end": "512500"
  },
  {
    "text": "I googled around for like five or ten minutes to find a service that I could subscribe to and that wasn't one so",
    "start": "512500",
    "end": "517719"
  },
  {
    "text": "that's why I built it so what infrastructure when I first built it was really simple because it was literally just me and I didn't anticipate that",
    "start": "517720",
    "end": "523810"
  },
  {
    "text": "anyone would actually use this so for sins in a prior life I'm a PHP developer",
    "start": "523810",
    "end": "530620"
  },
  {
    "text": "and most of our application is hosted in digitalocean and we're just on like plain old Ubuntu servers running PHP 72",
    "start": "530620",
    "end": "538040"
  },
  {
    "text": "and the current version of mainline nginx now that's really good the processing code is kind of simple we're",
    "start": "538040",
    "end": "544220"
  },
  {
    "text": "just taking JSON payloads processing them and then we need to put them in some kind of database and I'm not a",
    "start": "544220",
    "end": "550040"
  },
  {
    "text": "database person there any database people here you like a special breed of people I just I've never been able to do",
    "start": "550040",
    "end": "557180"
  },
  {
    "text": "databases and I was like look I need some kind of managed service for this because I'm not a DBA and I can't become",
    "start": "557180",
    "end": "562940"
  },
  {
    "text": "one on top of everything else so I actually turned to Azure and in Azure I use specifically one of their services",
    "start": "562940",
    "end": "569540"
  },
  {
    "text": "called table storage and table storage is just a super simple key value JSON",
    "start": "569540",
    "end": "574639"
  },
  {
    "text": "store so you put something in with a key and then you can retrieve it later on with that key and sometimes people say",
    "start": "574639",
    "end": "581600"
  },
  {
    "text": "this is a bit odd because we've got like our application running in digitalocean and the database in is your but they just worked so well together for us and",
    "start": "581600",
    "end": "587899"
  },
  {
    "text": "from the cost standpoint the other thing people ask me is if I've looked at I think it's dynamodb in AWS we did some",
    "start": "587899",
    "end": "594560"
  },
  {
    "text": "extensive testing with that but it was way too expensive for our particular use case because of how they bill so we",
    "start": "594560",
    "end": "601790"
  },
  {
    "text": "settled on digital ocean and Azure and the interesting thing is this is still our infrastructure today we are still",
    "start": "601790",
    "end": "607130"
  },
  {
    "text": "hosting using exactly this setup so it has worked it did work and it's scaled",
    "start": "607130",
    "end": "613399"
  },
  {
    "text": "really well so first month we process just over ten thousand reports and that was literally just from my own personal",
    "start": "613399",
    "end": "619069"
  },
  {
    "text": "website that came in and then things started to grow a couple of friends used their a couple of people heard about it",
    "start": "619069",
    "end": "624829"
  },
  {
    "text": "on Twitter's it started to grow and grow and grow and you think great right will you built this thing in the cloud if",
    "start": "624829",
    "end": "629990"
  },
  {
    "text": "you're hosting an application in the cloud and you need more resources you just add more cloud and just dial up the",
    "start": "629990",
    "end": "636019"
  },
  {
    "text": "numbers and this is kind of the point in cloud infrastructure right so you just take the dial and just you can twist it",
    "start": "636019",
    "end": "641329"
  },
  {
    "text": "all the way up to 11 and for the first many many months this is what I did every time more people started using it",
    "start": "641329",
    "end": "647360"
  },
  {
    "text": "getting more reports and it actually just Auto scaled upwards the only problem is that on the other side of",
    "start": "647360",
    "end": "652910"
  },
  {
    "text": "this dial is also the cost dial and they're fixed together so as you start just cranking up the dial for the amount",
    "start": "652910",
    "end": "659149"
  },
  {
    "text": "of cloud you also crank up the cost double the amount of compute resources double the cost which was great when it",
    "start": "659149",
    "end": "664639"
  },
  {
    "text": "was literally costing I don't know like my first month was single-digit dollars I didn't even care but if you keep dialing that up and up",
    "start": "664639",
    "end": "671070"
  },
  {
    "text": "and up it becomes unmanageable and from when we launched until where we were about three months ago when I first",
    "start": "671070",
    "end": "677220"
  },
  {
    "text": "started working on this talk we've actually done times two million on our monthly load so even if I was always",
    "start": "677220",
    "end": "683430"
  },
  {
    "text": "spending $1 a month and very first month we would now be spending two million dollars a month and this was just not",
    "start": "683430",
    "end": "690089"
  },
  {
    "text": "scalable and it became unmaintainable a very long time ago we had to get smarter about how we were using those resources",
    "start": "690089",
    "end": "695880"
  },
  {
    "text": "and how we process things so the following is kind of like the basic story on how we've adapted our service",
    "start": "695880",
    "end": "701910"
  },
  {
    "text": "to go from 10,000 reports a month to well over actually about 16,000 a second our peak now so basic infrastructure",
    "start": "701910",
    "end": "709529"
  },
  {
    "text": "diagram again on the right-hand side those are the browsers maybe they've just navigated to PayPal's website had some kind of error and they would",
    "start": "709529",
    "end": "715860"
  },
  {
    "text": "dispatch a report over to our ingestion servers these servers reside in digital ocean we do things like schema",
    "start": "715860",
    "end": "722880"
  },
  {
    "text": "validation on the JSON so we want to make sure that they're not junk reports we do some basic filtering and spam detection on them but ultimately if we",
    "start": "722880",
    "end": "730290"
  },
  {
    "text": "decide that yes this is a valid report for this user we need to insert it into as you're into that users table now",
    "start": "730290",
    "end": "737810"
  },
  {
    "text": "because of the way our application servers are completely ephemeral they have no state and also because of the",
    "start": "737810",
    "end": "744480"
  },
  {
    "text": "way that as your works the first thing that we have to do in the report hits us is even see if this user exists so the",
    "start": "744480",
    "end": "749820"
  },
  {
    "text": "report comes in and the application servers like I don't know so it'll reach into the database and pull back the users entity now this",
    "start": "749820",
    "end": "757380"
  },
  {
    "text": "would contain things like their custom filter settings as well because each user can tweak what kind of reports they",
    "start": "757380",
    "end": "762600"
  },
  {
    "text": "accept and reject it would look through those do all of its filtering and then if we needed to put it in the database",
    "start": "762600",
    "end": "767670"
  },
  {
    "text": "we actually saw four copies of it which sounds kind of weird at first so actually Dean organized data on the",
    "start": "767670",
    "end": "773220"
  },
  {
    "text": "way in like this but we store the reports in four different time slices and they are the hour the day the week",
    "start": "773220",
    "end": "778529"
  },
  {
    "text": "and the month so we'd have to put four copies of the report and I'll explain why because this really improves our",
    "start": "778529",
    "end": "784920"
  },
  {
    "text": "query performance later so we put these four copies of the report but table stories is a really basic key value",
    "start": "784920",
    "end": "791250"
  },
  {
    "text": "store there is no like increment operator so we can't just increment the count on an entity you actually have to query the entity out increment the count",
    "start": "791250",
    "end": "798180"
  },
  {
    "text": "and then put it back so we've got the one query to get the user entity for queries to pull the four rows out",
    "start": "798180",
    "end": "805589"
  },
  {
    "text": "increment them all and then put the four back so we actually had for every inbound report we were doing nine what they call transactions again stable",
    "start": "805589",
    "end": "812339"
  },
  {
    "text": "storage which was fine at the beginning when we're doing ten thousand reports a month it's like okay you know multiply",
    "start": "812339",
    "end": "818040"
  },
  {
    "text": "by nine 90,000 we can tolerate this and the reason that we could tolerate this for a very long time was that pricing",
    "start": "818040",
    "end": "824160"
  },
  {
    "text": "model in Azure and we had this fantastic thing where 10000 transactions again stable storage was like three like 110",
    "start": "824160",
    "end": "832800"
  },
  {
    "text": "thousand three one thousand server dot it's really really cheap so even if we get into like the millions of millions",
    "start": "832800",
    "end": "837990"
  },
  {
    "text": "of transactions again stable storage it really didn't matter that much and that",
    "start": "837990",
    "end": "843120"
  },
  {
    "text": "kind of drove the design in a way because it's like okay well this is quite transaction heavy well the",
    "start": "843120",
    "end": "848130"
  },
  {
    "text": "transactions don't cost a lot so we don't really care so this was how we first started out but the problem was as",
    "start": "848130",
    "end": "854190"
  },
  {
    "text": "the service grew even though that number is really really small when you start getting into the millions tens of",
    "start": "854190",
    "end": "859350"
  },
  {
    "text": "millions and hundreds of millions it starts becoming not small and we're also paying for things like the bandwidth",
    "start": "859350",
    "end": "864510"
  },
  {
    "text": "ingress and egress from Azure as well so we had to start getting a bit more kind",
    "start": "864510",
    "end": "871350"
  },
  {
    "text": "of sensible with this we had to start becoming a bit more frugal with our use of the cloud and one of the first things",
    "start": "871350",
    "end": "877260"
  },
  {
    "start": "876000",
    "end": "933000"
  },
  {
    "text": "that we did was trying to give our application service some kind of state at the edge because as I said in a diagram a moment ago they have no state",
    "start": "877260",
    "end": "883740"
  },
  {
    "text": "they would literally just operating against the database directly so we manage our entire fleet with ansible",
    "start": "883740",
    "end": "890100"
  },
  {
    "text": "which made this really easy change the configure menu instance onto every one of our edge nodes the sole purpose here",
    "start": "890100",
    "end": "897990"
  },
  {
    "text": "was to cache that user entity on the edge node so in the first inbound report comes in and the application server had",
    "start": "897990",
    "end": "904380"
  },
  {
    "text": "to reach back and grab the user entity to see if they existed number one what their filter settings were things like",
    "start": "904380",
    "end": "909990"
  },
  {
    "text": "that now it could cache that user entity on the edge node for memory this is a long time ago we I think we cash out for",
    "start": "909990",
    "end": "916050"
  },
  {
    "text": "about 10 minutes in memcached so if you did change your filter settings it would only take a maximum of 10 minutes to update across our entire infrastructure",
    "start": "916050",
    "end": "923310"
  },
  {
    "text": "and this was really good because it was a super simple change drop memcached on there and then use that as a buffer",
    "start": "923310",
    "end": "928800"
  },
  {
    "text": "between the application server and table storage so it allowed us to chop down one of those transactions against table",
    "start": "928800",
    "end": "935730"
  },
  {
    "start": "933000",
    "end": "961000"
  },
  {
    "text": "storage for inbound report because now there's only the four time slices out increment put",
    "start": "935730",
    "end": "940889"
  },
  {
    "text": "the four back now around about this time we were we were starting to get some",
    "start": "940889",
    "end": "947550"
  },
  {
    "text": "really significant load we were definitely going into like the tens of millions per month and unfortunately",
    "start": "947550",
    "end": "954810"
  },
  {
    "text": "something happened that really expedited our interesting being able to handle",
    "start": "954810",
    "end": "959850"
  },
  {
    "text": "this kind of load we don't really talk about it much because it's not like some one of my most favorite memories but we",
    "start": "959850",
    "end": "965790"
  },
  {
    "start": "961000",
    "end": "1064000"
  },
  {
    "text": "got hit with a massive massive traffic flood now we call it the DDoS most people are probably familiar with the",
    "start": "965790",
    "end": "971790"
  },
  {
    "text": "distributed denial of service attack normally it's just when horrible people on the internet for do you with just",
    "start": "971790",
    "end": "977010"
  },
  {
    "text": "like waves of traffic that you simply cannot tolerate as a service they're normally hostile and they're normally",
    "start": "977010",
    "end": "982980"
  },
  {
    "text": "designed to knock you off line the only difference with ours is that someone did this by accident but they did still",
    "start": "982980",
    "end": "988019"
  },
  {
    "text": "markers are fine so I wrote a blog post about what happened here and the company",
    "start": "988019",
    "end": "993209"
  },
  {
    "text": "was actually really good about this they let us use their name and really give the full story of exactly what happened",
    "start": "993209",
    "end": "998430"
  },
  {
    "text": "but someone configured one of these policies on their website and there are really really big website one of the at",
    "start": "998430",
    "end": "1004339"
  },
  {
    "text": "the time they were one of the top hundred websites in the world but they misconfigured their policy on their website very very slightly and what it",
    "start": "1004339",
    "end": "1011120"
  },
  {
    "text": "meant was that every visitor to their website sent us about 64 reports so 64",
    "start": "1011120",
    "end": "1016970"
  },
  {
    "text": "individual JSON post requests like one beyond the other when they landed on this customer's website it was in Varro",
    "start": "1016970",
    "end": "1023839"
  },
  {
    "text": "was the company they've run websites like ThemeForest audiojungle some of you may have heard of them so one visitor",
    "start": "1023839",
    "end": "1030798"
  },
  {
    "text": "lands on their webpage and then that visitor would literally fire like 64 sequential post requests again stores",
    "start": "1030799",
    "end": "1036918"
  },
  {
    "text": "with a huge JSON payload and then they go to the next page and fire another 64 the next to the next and when they get",
    "start": "1036919",
    "end": "1042650"
  },
  {
    "text": "millions of customers we were literally getting hundreds of millions of these JSON payloads coming in so the problem",
    "start": "1042650",
    "end": "1049940"
  },
  {
    "text": "with that is one second they're fine nothing is wrong they deploy the Mis",
    "start": "1049940",
    "end": "1054980"
  },
  {
    "text": "configuration then the next second it's like firehose we went from literally nothing to",
    "start": "1054980",
    "end": "1060370"
  },
  {
    "text": "unmanageable amount of data in literally a couple of seconds now",
    "start": "1060370",
    "end": "1067610"
  },
  {
    "start": "1064000",
    "end": "1138000"
  },
  {
    "text": "back then I was using New Relic you may recognize the dashboard we've since changed but the numbers are what we're",
    "start": "1067610",
    "end": "1072920"
  },
  {
    "text": "interested in here we had our two low bounces at the front and they spiked when well off the top end of their capabilities so the application started",
    "start": "1072920",
    "end": "1079880"
  },
  {
    "text": "to scale deployed the third load balancer this one's up and online hasn't propagated in DNS yet but we're already",
    "start": "1079880",
    "end": "1085100"
  },
  {
    "text": "at like eight and nine thousand requests the second problem was by the time that one is propagating in DNS and so I'm",
    "start": "1085100",
    "end": "1091160"
  },
  {
    "text": "receiving requests we were already well off the top end of their capabilities again same thing happened added the",
    "start": "1091160",
    "end": "1097190"
  },
  {
    "text": "fourth load balancer this one's kind of just started to propagate in DNS we're into light literally multiple tens of",
    "start": "1097190",
    "end": "1103070"
  },
  {
    "text": "thousands of requests a second and again these aren't just like get requests these are actual post requests with a",
    "start": "1103070",
    "end": "1108590"
  },
  {
    "text": "JSON payload that we have to do a lot of stuff with as well so it becomes really hard to deal with this I was getting",
    "start": "1108590",
    "end": "1115490"
  },
  {
    "text": "hundreds of emails a second from basically our entire fleet was on fire and I was getting all of the alerts and",
    "start": "1115490",
    "end": "1121550"
  },
  {
    "text": "it's like what do we do do we just let this keep scaling and try and tolerate this right like there's a point at which",
    "start": "1121550",
    "end": "1127160"
  },
  {
    "text": "you can scale far enough that you can handle this the problem was the time by ones that we have for the next scale",
    "start": "1127160",
    "end": "1133400"
  },
  {
    "text": "wasn't good enough and the traffic was essentially getting away from us and whilst I was thinking about all this and",
    "start": "1133400",
    "end": "1139460"
  },
  {
    "start": "1138000",
    "end": "1197000"
  },
  {
    "text": "what to do with that we were kind of hitting out the peak here and I'd stopped it scaling at this point because I'd noticed the traffic was getting away",
    "start": "1139460",
    "end": "1145970"
  },
  {
    "text": "from us there was no way that we were going to scale far enough and this is still like a personal side project that I'm paying for as well I have to admit",
    "start": "1145970",
    "end": "1152270"
  },
  {
    "text": "that had something to do with it and it's just like yeah we're just adding these and every time we add them you",
    "start": "1152270",
    "end": "1157340"
  },
  {
    "text": "know we're doing like 40 50 thousand requests a second on each of these low balances now in terms of traffic volume",
    "start": "1157340",
    "end": "1163100"
  },
  {
    "text": "even on new Reilly monitoring suffered like we couldn't maintain full monitoring but we were seeing kind of",
    "start": "1163100",
    "end": "1168620"
  },
  {
    "text": "like half a gigabit a second of JSON coming into our load balancers so all in all it was about 2.4 gigabits a second",
    "start": "1168620",
    "end": "1175250"
  },
  {
    "text": "of JSON which is just way too much for us to cope with and it's like what do we do but we can't scale to cope with this",
    "start": "1175250",
    "end": "1181850"
  },
  {
    "text": "maybe we can get in touch with the customer and ask them and say hey please can you turn this off because you're literally fire hosing us and we can't do",
    "start": "1181850",
    "end": "1188480"
  },
  {
    "text": "anything about it now the good thing I say good thing it's probably not a good",
    "start": "1188480",
    "end": "1193520"
  },
  {
    "text": "thing the good thing is that we didn't have to make that decision or call them the bad thing was is because our hosting provider got in touch with us and said",
    "start": "1193520",
    "end": "1199190"
  },
  {
    "text": "that they were dropping us because we were getting way too much traffic and impacting their service so digitalocean sent me an email",
    "start": "1199190",
    "end": "1206030"
  },
  {
    "text": "to say your IP addresses are receiving just really abusive levels of traffic they're negatively impacting our",
    "start": "1206030",
    "end": "1211820"
  },
  {
    "text": "infrastructure so we're just going to start routing traffic to them and I was",
    "start": "1211820",
    "end": "1217190"
  },
  {
    "text": "just like oh no they're so mad they're gonna be really cross if your hosting",
    "start": "1217190",
    "end": "1222680"
  },
  {
    "text": "company emails you to say like we're basically killing the traffic to your infrastructure because it's too high I",
    "start": "1222680",
    "end": "1228200"
  },
  {
    "text": "thought that this wasn't going to go really well afterwards and I kind of expected them to be a bit mad but they were really good with this they worked",
    "start": "1228200",
    "end": "1234200"
  },
  {
    "text": "with us they tried to help us out in in any way that they could but ultimately said look is this is negatively",
    "start": "1234200",
    "end": "1239900"
  },
  {
    "text": "impacting all the customers within our environments now so we need to stop your traffic until the inbound stops I was",
    "start": "1239900",
    "end": "1247100"
  },
  {
    "text": "like right okay well that solves our problem now we're completely offline because our servers have literally been pulled down but how do we how do we stop",
    "start": "1247100",
    "end": "1254180"
  },
  {
    "text": "the traffic coming in like if you have too much traffic that's hitting you there's no simple kill switch for that",
    "start": "1254180",
    "end": "1259580"
  },
  {
    "text": "and this is a really big problem because I'm trying to fight through like you know the one email address that",
    "start": "1259580",
    "end": "1265190"
  },
  {
    "text": "registered the account trying to get hold of that person was completely the wrong time of day and they're not going to be awake for another nine hours in",
    "start": "1265190",
    "end": "1271610"
  },
  {
    "text": "America so what do we do and this really highlighted the problem for was if someone actually did this again we would",
    "start": "1271610",
    "end": "1278240"
  },
  {
    "text": "find ourselves in exactly the same situation again and the problem really was was a mistake that I've made early",
    "start": "1278240",
    "end": "1285260"
  },
  {
    "start": "1281000",
    "end": "1394000"
  },
  {
    "text": "on in the project now you may have noticed in the address earlier before when you want to send us a report you",
    "start": "1285260",
    "end": "1291260"
  },
  {
    "text": "send it to report your I comm slash report and then this value here we call your report token it's just a vanity",
    "start": "1291260",
    "end": "1297050"
  },
  {
    "text": "string that you can pick when you create an account and that's how we know any report sent to this endpoint got into my",
    "start": "1297050",
    "end": "1303170"
  },
  {
    "text": "account because that's my report token so you can sign up you can pick whichever one you want and that's how",
    "start": "1303170",
    "end": "1309170"
  },
  {
    "text": "they're routed the problem with this is when a browser comes to resolve the",
    "start": "1309170",
    "end": "1314450"
  },
  {
    "text": "domain to send the report they're all actually sat on the same hostname all of this is sat on the report your icon",
    "start": "1314450",
    "end": "1320300"
  },
  {
    "text": "which means they always alter the same IP and the low bounces that handle our application traffic for like the www for",
    "start": "1320300",
    "end": "1326840"
  },
  {
    "text": "the home page for tools login account the same load balancers also have to handle the inbound report traffic and",
    "start": "1326840",
    "end": "1332600"
  },
  {
    "text": "this meant that when we were getting the flooded reports our website went with it because all of these servers are",
    "start": "1332600",
    "end": "1337800"
  },
  {
    "text": "taken out everything that runs underneath them is also gone and how",
    "start": "1337800",
    "end": "1343200"
  },
  {
    "text": "it's like well this is really bad because our website was literally unavailable throughout this whole process anyway and that's when I had",
    "start": "1343200",
    "end": "1349560"
  },
  {
    "text": "like a real light bulb moment I need to kill this traffic I need to stop it and the problem is if you want to try and",
    "start": "1349560",
    "end": "1354570"
  },
  {
    "text": "filter slash report slash got home you're already doing that on your application servers and that's already too late because the traffic's already",
    "start": "1354570",
    "end": "1360810"
  },
  {
    "text": "hit us and it's already done the damage now because then it and can anyone see what my really silly mistake was what's",
    "start": "1360810",
    "end": "1367350"
  },
  {
    "text": "the solution to this I would say ok so",
    "start": "1367350",
    "end": "1372990"
  },
  {
    "text": "someone was paying a lot of attention take the report token and push it into a subdomain and this is literally all that",
    "start": "1372990",
    "end": "1380310"
  },
  {
    "text": "we had to do to solve this problem so now those report tokens like mine is on Scott helmet report your icon slash",
    "start": "1380310",
    "end": "1386160"
  },
  {
    "text": "report instead of having the Scott helm on the end and what this means is two really big things for us number one we",
    "start": "1386160",
    "end": "1393300"
  },
  {
    "text": "could have a set of IP addresses for our web application with its own dedicated and segregated infrastructure we can",
    "start": "1393300",
    "end": "1400620"
  },
  {
    "text": "then resolve a wildcard for all of our customers it doesn't matter what like vanity token vanity subdomain you picked",
    "start": "1400620",
    "end": "1407160"
  },
  {
    "text": "it will be picked up by our wildcard DNS entry and what this means is that if one",
    "start": "1407160",
    "end": "1412380"
  },
  {
    "text": "particular customer started to become really abusive and really hostile like Troy we can resolve his IP and kill him",
    "start": "1412380",
    "end": "1419790"
  },
  {
    "text": "a DNS of what this means now is that this report doesn't even get sent we",
    "start": "1419790",
    "end": "1424890"
  },
  {
    "text": "don't have to take this onto our load balancers try and kill it at lay seven we can literally stop the browser's out",
    "start": "1424890",
    "end": "1430650"
  },
  {
    "text": "in the world from resolving to Wars and stop the traffic even being sent over the network and this was a huge kind of",
    "start": "1430650",
    "end": "1437730"
  },
  {
    "text": "obvious thing for me after we'd been through the terrible experience of essentially being DDoS but give yourself",
    "start": "1437730",
    "end": "1444090"
  },
  {
    "text": "this flexibility in scenarios like this I had not thought of this and it was a really obvious big win the other cool",
    "start": "1444090",
    "end": "1451080"
  },
  {
    "text": "stuff now since we did this I largely did this for traffic control because we do still use this mechanism if we have",
    "start": "1451080",
    "end": "1456390"
  },
  {
    "text": "really abusive customers that go through a bad spell or someone's just DDoS in your subdomain there's loads of people",
    "start": "1456390",
    "end": "1461700"
  },
  {
    "text": "on the internet that like to do stuff like that we can just kill it a DNS and say look this is just a flood of traffic",
    "start": "1461700",
    "end": "1467640"
  },
  {
    "text": "that we don't want just turn off that subdomain and it will stop hitting us the interesting thing since we've then repurposes the exact",
    "start": "1467640",
    "end": "1474740"
  },
  {
    "text": "same mechanism because we now have customers that need European hosting and processing because of regulations in",
    "start": "1474740",
    "end": "1480049"
  },
  {
    "text": "Europe which is really good because we can just put a specific entry from them and then route that to our European",
    "start": "1480049",
    "end": "1486470"
  },
  {
    "text": "infrastructure so we now have another data center alongside the one in San Francisco in Amsterdam so we can resolve",
    "start": "1486470",
    "end": "1492140"
  },
  {
    "text": "just that particular subdomain - the one in Amsterdam which means that any traffic they have will just naturally",
    "start": "1492140",
    "end": "1497330"
  },
  {
    "text": "flow to our data center announce them so now we're doing like geo sensitive resolution for them as well so you can",
    "start": "1497330",
    "end": "1504980"
  },
  {
    "text": "give yourself a lot of flexibility and some of this wasn't a costly thing to do and in terms of the code changes it was",
    "start": "1504980",
    "end": "1510500"
  },
  {
    "text": "minor because now we just look for the token and a subdomain instead of the path but it gave us so much power so much flexibility in so much control from",
    "start": "1510500",
    "end": "1517789"
  },
  {
    "text": "such a minor thing and I wish that I'd seen this a lot earlier before I went",
    "start": "1517789",
    "end": "1522830"
  },
  {
    "text": "through all the stress of the DDoS so we still had exactly the same infrastructure but during this one of",
    "start": "1522830",
    "end": "1529400"
  },
  {
    "text": "the other things that I decided to do as well was those four time slices we dropped them down to three because of",
    "start": "1529400",
    "end": "1534470"
  },
  {
    "text": "the vast majority of people in our UI when they were querying to see their reports they were using the hour the day",
    "start": "1534470",
    "end": "1539870"
  },
  {
    "text": "in the month the week time slice wasn't it didn't seem to be something that people really used and for the amount of",
    "start": "1539870",
    "end": "1545419"
  },
  {
    "text": "use that it got it wasn't worth the extra traffic against as your that it was costing us so we got rid of the week",
    "start": "1545419",
    "end": "1551900"
  },
  {
    "text": "time slice we now just have our day and month and that got us down to a 1 to 6",
    "start": "1551900",
    "end": "1557120"
  },
  {
    "start": "1554000",
    "end": "1591000"
  },
  {
    "text": "ratio on reports of transactions which isn't very far we've come from 9 down to",
    "start": "1557120",
    "end": "1562400"
  },
  {
    "text": "6 it's a step in the right direction and as the service is scaling this isn't actually making it cheaper what it's",
    "start": "1562400",
    "end": "1568370"
  },
  {
    "text": "doing is just reducing the increase in cost but I was still really struggling at this point because this was a free",
    "start": "1568370",
    "end": "1573620"
  },
  {
    "text": "project this was something that I stood up just so that people could have it and use it and we needed to change that we",
    "start": "1573620",
    "end": "1580549"
  },
  {
    "text": "needed to get the cost write down because otherwise this was blowing my like side project budget of $100 a month",
    "start": "1580549",
    "end": "1585860"
  },
  {
    "text": "my wife was getting really mad and like why are all these big server bills coming in every month so I fix this with",
    "start": "1585860",
    "end": "1593600"
  },
  {
    "start": "1591000",
    "end": "1729000"
  },
  {
    "text": "Redis and this was a more recent thing we made this change earlier this year and what we try to do with Redis was we",
    "start": "1593600",
    "end": "1599990"
  },
  {
    "text": "could get rid of memcached on all of our edge nodes now because we didn't have like an individual cash per server we had one",
    "start": "1599990",
    "end": "1606919"
  },
  {
    "text": "central Redis cash in our infrastructure and this is actually I really like this is a massive powerful service got loads",
    "start": "1606919",
    "end": "1613909"
  },
  {
    "text": "of RAM and what it was acting as was basically a buffer so when the injection",
    "start": "1613909",
    "end": "1619549"
  },
  {
    "text": "servers come in and take the rapport they now do the same basic filtering we do spam detection we throw away junk",
    "start": "1619549",
    "end": "1625460"
  },
  {
    "text": "reports but rather than the ingestion server interacting with Azure and incrementing the count it just places it",
    "start": "1625460",
    "end": "1631789"
  },
  {
    "text": "into Redis so ready does have an increment operation as well which is great because it can just increment counts against Redis and the Redis cash",
    "start": "1631789",
    "end": "1638929"
  },
  {
    "text": "runs in just like a circular buffer so we just fill that up and sat behind it we have what we call our consumer so the",
    "start": "1638929",
    "end": "1645950"
  },
  {
    "text": "consumer will come along every 10 seconds and take the whole content of the readies cache and it will then process those reports into table storage",
    "start": "1645950",
    "end": "1653649"
  },
  {
    "text": "so what this means is that number one the injection servers now have much less load because they're not opening and",
    "start": "1653649",
    "end": "1659299"
  },
  {
    "text": "firing multiple transactions as your so we reduce the overheads there because we can stack with a count in Redis in that",
    "start": "1659299",
    "end": "1665179"
  },
  {
    "text": "ten-second window if we get 8,000 of the same report we just have a single copy",
    "start": "1665179",
    "end": "1670369"
  },
  {
    "text": "of it in Redis with a count of 8,000 and then the consumer only has to do the single transaction against Azure with an",
    "start": "1670369",
    "end": "1676730"
  },
  {
    "text": "increment of 8,000 instead now apart from the actual cost of the ready server the only thing that really changed was",
    "start": "1676730",
    "end": "1683090"
  },
  {
    "text": "it added a 10 second delay for reports to show up in your dashboard because the Redis cache will sit on something for",
    "start": "1683090",
    "end": "1688820"
  },
  {
    "text": "potentially up to 10 seconds after it lands and as much as I don't like that I",
    "start": "1688820",
    "end": "1694850"
  },
  {
    "text": "didn't want to add that artificial delay for the benefits that that brought of the service that was just a no-brainer",
    "start": "1694850",
    "end": "1700429"
  },
  {
    "text": "10 second delay we can pretty much live with to then be able to flatten in some",
    "start": "1700429",
    "end": "1705499"
  },
  {
    "text": "cases like tens of thousands of reports into a single report because we normalize the the JSON here as well",
    "start": "1705499",
    "end": "1711070"
  },
  {
    "text": "different browsers have a tendency of not following the specification exactly and they have like slightly nuances with",
    "start": "1711070",
    "end": "1717710"
  },
  {
    "text": "their JSON payloads so we normalize those as well and this made a huge huge",
    "start": "1717710",
    "end": "1722869"
  },
  {
    "text": "huge difference in our infrastructure because whilst the Redis cash is expensive",
    "start": "1722869",
    "end": "1727970"
  },
  {
    "text": "the number of transactions that we did against as your after we introduced this plummeted and we were now doing an",
    "start": "1727970",
    "end": "1733399"
  },
  {
    "start": "1729000",
    "end": "1837000"
  },
  {
    "text": "average of point zero one transactions against as your for every single inbound rapport because of the",
    "start": "1733399",
    "end": "1738410"
  },
  {
    "text": "deduplication and stacking them on the way in now roundabout this time we were",
    "start": "1738410",
    "end": "1743800"
  },
  {
    "text": "we were almost becoming a commercial service we became a commercial service last year on November the 1st and for",
    "start": "1743800",
    "end": "1751610"
  },
  {
    "text": "the 3 years prior to that I had run it as a free service so anyone could come anyone could sign up anyone could use it and despite all of these changes I had",
    "start": "1751610",
    "end": "1758270"
  },
  {
    "text": "made and all of the progress that I'd done it got to the point where it was just costing too much money and I don't",
    "start": "1758270",
    "end": "1764840"
  },
  {
    "text": "know maybe some people here have liked me little side projects I just like building stuff and like writing a little",
    "start": "1764840",
    "end": "1770240"
  },
  {
    "text": "code projects and things and this one just happened to take off without me having expected it and it got to the",
    "start": "1770240",
    "end": "1775370"
  },
  {
    "text": "point where he's like well what do I do like I can either close this thing down because it's costing me hundreds of",
    "start": "1775370",
    "end": "1780500"
  },
  {
    "text": "dollars a month now to run this or I can commercialize it and ask people to like",
    "start": "1780500",
    "end": "1786110"
  },
  {
    "text": "start paying for it and I like I hate it when services dude this is like hey join our free subscription thing and then two",
    "start": "1786110",
    "end": "1792410"
  },
  {
    "text": "years later it's like hah now you have to pay and I didn't want to be that guy but the alternative was to literally",
    "start": "1792410",
    "end": "1798080"
  },
  {
    "text": "close the service so I didn't want to do that I wanted to keep it running because",
    "start": "1798080",
    "end": "1803179"
  },
  {
    "text": "I felt it was genuinely useful so we commercialize we still have a really good freeze here because I wanted to",
    "start": "1803179",
    "end": "1808370"
  },
  {
    "text": "carry on doing what it started out to do which is to help people deploy these mechanisms but we now do have very large",
    "start": "1808370",
    "end": "1815300"
  },
  {
    "text": "users a paid tier that you have to go onto but even then the free tier is very generous the page is if you have a look",
    "start": "1815300",
    "end": "1821750"
  },
  {
    "text": "at a pricing model we can process millions of reports a month for you for like tens of dollars and to do that we",
    "start": "1821750",
    "end": "1828350"
  },
  {
    "text": "needed to continue to drive this efficiency and we made a change recently which is the start of many that we're",
    "start": "1828350",
    "end": "1835370"
  },
  {
    "text": "making this year where we had to both like literally and figuratively push this to the edge number one in terms of",
    "start": "1835370",
    "end": "1841790"
  },
  {
    "start": "1837000",
    "end": "2036000"
  },
  {
    "text": "what we could squeeze out of our resources we had to absolutely max out what we were getting from them but number two the other thing was we quite",
    "start": "1841790",
    "end": "1848120"
  },
  {
    "text": "literally move some of our code from our own application servers onto our edge nodes because at this point a CDN",
    "start": "1848120",
    "end": "1854570"
  },
  {
    "text": "provider had stepped in and decided to offer us some help so report your IR service now sits behind CloudFlare who",
    "start": "1854570",
    "end": "1861050"
  },
  {
    "text": "are a CDN provider now in the traditional sense of a CDN provider they sit between the browser and our servers",
    "start": "1861050",
    "end": "1867860"
  },
  {
    "text": "now many people have familiar Sirians Oh cache files like static parts of your website maybe even whole pages",
    "start": "1867860",
    "end": "1874460"
  },
  {
    "text": "depending on whether or not you have dynamic content and this is kind of like the more traditional role of a CDN",
    "start": "1874460",
    "end": "1881030"
  },
  {
    "text": "provider they sit between the browser and the server and they they do like fairly basic things but with CloudFlare",
    "start": "1881030",
    "end": "1888770"
  },
  {
    "text": "they change this up a little bit and one client flower actually allow you to do now they have a feature called workers",
    "start": "1888770",
    "end": "1894140"
  },
  {
    "text": "and you can actually write JavaScript against the service workers API that you can deploy into their data centers onto",
    "start": "1894140",
    "end": "1901940"
  },
  {
    "text": "their servers inside the CDM so Clara has got like 152 data centers around the world and normally they just catch our",
    "start": "1901940",
    "end": "1907970"
  },
  {
    "text": "JavaScript and cache our CSS or whatever but now it's like okay you can write this javascript and deploy it into our",
    "start": "1907970",
    "end": "1914060"
  },
  {
    "text": "data center and we will run this code against your inbound requests so what we",
    "start": "1914060",
    "end": "1919640"
  },
  {
    "text": "did was the very first trial of the service workers we took the most simple piece of code that we could from our",
    "start": "1919640",
    "end": "1924830"
  },
  {
    "text": "application servers and we moved it into cloud flies data centers and it was basically just super simple JSON",
    "start": "1924830",
    "end": "1931220"
  },
  {
    "text": "validation is this a valid JSON payload because if it's not a valid JSON payload we're not even interested in it so that",
    "start": "1931220",
    "end": "1937850"
  },
  {
    "text": "was the first thing that we moved into cloud flies edge so instead of the browser sending the JSON over to us and",
    "start": "1937850",
    "end": "1943730"
  },
  {
    "text": "also having to try and parse that and say the JSON isn't literally not even validly formed what happens now is we",
    "start": "1943730",
    "end": "1951320"
  },
  {
    "text": "run that in a cloud fly worker and the client fly worker will just return an error status code to the browser so that",
    "start": "1951320",
    "end": "1958370"
  },
  {
    "text": "doesn't even make a connection back to our origin servers and this worked really well because we can get rid of",
    "start": "1958370",
    "end": "1964010"
  },
  {
    "text": "like 0.7% I think it was from memory 0.7% of the inbound requests because they don't even have a valid JSON",
    "start": "1964010",
    "end": "1969740"
  },
  {
    "text": "payload I was like this is great like we literally don't even see those requests anymore so the amount of load on our",
    "start": "1969740",
    "end": "1975290"
  },
  {
    "text": "application servers goes down next things was like basic schema validation all of these reporting mechanisms have",
    "start": "1975290",
    "end": "1982370"
  },
  {
    "text": "an RFC and a JSON schema that the reports must conform to so we moved our code from our application servers of the",
    "start": "1982370",
    "end": "1988880"
  },
  {
    "text": "cloud fly for that part all these reports do they contain all of the keys that they have necessary according to",
    "start": "1988880",
    "end": "1994610"
  },
  {
    "text": "the spec if they don't discard them if they do pass them through to our origin now we're at the point now where we have",
    "start": "1994610",
    "end": "2001120"
  },
  {
    "text": "pretty much most of our JSON pre-processing done in cloud fly workers and we've also",
    "start": "2001120",
    "end": "2006310"
  },
  {
    "text": "actually moved the user entities I mentioned our application service store they're actually now cashed in the",
    "start": "2006310",
    "end": "2011680"
  },
  {
    "text": "client fly worker as well so the cloud fly worker can do per user specific filtering on JSON payloads for an entity",
    "start": "2011680",
    "end": "2018910"
  },
  {
    "text": "as well the cauliflower worker knows if a user exists or not so it won't pass it through if it knows there's no user",
    "start": "2018910",
    "end": "2024850"
  },
  {
    "text": "account associated and what this allowed us to do is to free up all of the resources on our application servers to",
    "start": "2024850",
    "end": "2031030"
  },
  {
    "text": "do things that we actually wanted to do and then I kind of looked at this this",
    "start": "2031030",
    "end": "2036310"
  },
  {
    "start": "2036000",
    "end": "2251000"
  },
  {
    "text": "was going really well and we managed to significantly reduce again the number of transactions that we were doing against",
    "start": "2036310",
    "end": "2042550"
  },
  {
    "text": "as you're so right now it's about three months old this data but we were doing point zero zero six transactions against",
    "start": "2042550",
    "end": "2048490"
  },
  {
    "text": "as your for every single report that comes in but this month were actually on track to do ten point six billion JSON",
    "start": "2048490",
    "end": "2054490"
  },
  {
    "text": "payloads for our customers so we are still doing quite a significant amount of transactions against Azure and this",
    "start": "2054490",
    "end": "2060760"
  },
  {
    "text": "is our infrastructure I'm kind of where we sit now so this is this is representative of the current day the",
    "start": "2060760",
    "end": "2066820"
  },
  {
    "text": "browser sends it in we've got most of our logic now in that cloud fly worker not running on our servers but running",
    "start": "2066820",
    "end": "2073148"
  },
  {
    "text": "on theirs and also running really close to the user we only have two data centers worldwide CloudFlare has a hundred and fifty two and there's one",
    "start": "2073149",
    "end": "2080020"
  },
  {
    "text": "literally just down the road in sydney so if you send us a JSON payload and it's not valid or it's going to get filtered you can find out like three",
    "start": "2080020",
    "end": "2086110"
  },
  {
    "text": "milliseconds down the road rather than you probably hit our origin in San Francisco which is like a few hundred",
    "start": "2086110",
    "end": "2091540"
  },
  {
    "text": "milliseconds away so it's a lot better performance as well but the thing with this was I looked at this and thought",
    "start": "2091540",
    "end": "2097210"
  },
  {
    "text": "well we've kind of shifted like two-thirds of our functionality from our own application servers into the worker",
    "start": "2097210",
    "end": "2103380"
  },
  {
    "text": "really like what's left here now like why do we still have our application servers can we move our entire code into",
    "start": "2103380",
    "end": "2111220"
  },
  {
    "text": "the cloud fly worker and it turns out we can I've been testing this for quite a",
    "start": "2111220",
    "end": "2117760"
  },
  {
    "text": "while with just my reports and we can actually move the entire functionality into the worker now the one thing that",
    "start": "2117760",
    "end": "2126010"
  },
  {
    "text": "held me back was the reddit cash because what I don't want is you know the ultimate scenario the end goal would be the worker just talks to Azure and then",
    "start": "2126010",
    "end": "2132460"
  },
  {
    "text": "we don't need anything right they could just process the report place it into tables store but we lose the benefit of the reddish",
    "start": "2132460",
    "end": "2139690"
  },
  {
    "text": "cash that if we get 10,000 of the same report we can compress it into a single report a single transaction and we'd",
    "start": "2139690",
    "end": "2145960"
  },
  {
    "text": "lose that economy so I spoke to kind of friend slash Twitter a friend of mine",
    "start": "2145960",
    "end": "2151930"
  },
  {
    "text": "called Kenton who works at CloudFlare on this and there is actually a way that you can use a cloud fly worker to buffer",
    "start": "2151930",
    "end": "2157240"
  },
  {
    "text": "up requests inside it I'm currently experimenting with this on my subdomain right now so all of my",
    "start": "2157240",
    "end": "2163510"
  },
  {
    "text": "reports are hitting this the client fly worker can simulate the buffer in our Redis cache so any reports that come in",
    "start": "2163510",
    "end": "2170740"
  },
  {
    "text": "from the browsers from my website the worker will just stack them all a lot locally with a count and then in ten",
    "start": "2170740",
    "end": "2176470"
  },
  {
    "text": "seconds time it will flush those out and pass them through to the origin so we're kind of in this halfway house right now",
    "start": "2176470",
    "end": "2182829"
  },
  {
    "text": "where once we finish testing this and if the worker can handle this at the volumes that we need which I'm fairly",
    "start": "2182829",
    "end": "2189069"
  },
  {
    "text": "sure that it will be able to we could actually get rid of literally all of our infrastructure we wouldn't actually need",
    "start": "2189069",
    "end": "2194859"
  },
  {
    "text": "any of this for report ingestion because the ingestion servers are just doing filtering the schema validation like",
    "start": "2194859",
    "end": "2200859"
  },
  {
    "text": "custom filtering for users things like that the Redis caches are only there to deduplicate and the consumer is only",
    "start": "2200859",
    "end": "2206710"
  },
  {
    "text": "there to empty the Redis cash so we could literally get rid of all of our infrastructure and maybe we'll be able",
    "start": "2206710",
    "end": "2213579"
  },
  {
    "text": "to do that this year I'm not sure but the ability for us to push our code out into the cloud fly",
    "start": "2213579",
    "end": "2219099"
  },
  {
    "text": "worker was a performance optimization at first was for a better filtering but now as we play around with this I'm actually",
    "start": "2219099",
    "end": "2225970"
  },
  {
    "text": "becoming quite a big fan of what you can do with these things so very soon maybe next year we might not actually have any",
    "start": "2225970",
    "end": "2232059"
  },
  {
    "text": "of our own servers processing reports on the way in which could be quite an interesting scenario so that's kind of",
    "start": "2232059",
    "end": "2240130"
  },
  {
    "text": "all of our infrastructure so far what I want to do now I'm running around time so I want to try and keep it that way if",
    "start": "2240130",
    "end": "2246220"
  },
  {
    "text": "you have any questions on this I'll pick these up specifically at the end I want to change the pace a little bit now and",
    "start": "2246220",
    "end": "2251470"
  },
  {
    "start": "2251000",
    "end": "2339000"
  },
  {
    "text": "switch over to what it is that we're trying to do a larger scale so that's",
    "start": "2251470",
    "end": "2256900"
  },
  {
    "text": "all of our infrastructure that's how we got from Hobby project into current you know tempo like 10 points to extroyer",
    "start": "2256900",
    "end": "2263319"
  },
  {
    "text": "this month I think we're going to do like 10 point six billion reports this month now with that amount of data cut",
    "start": "2263319",
    "end": "2270170"
  },
  {
    "text": "the scale problems that we've just talked about and that we've solved so far and if you have any feedback on that I'd love to hear it at the end because",
    "start": "2270170",
    "end": "2275390"
  },
  {
    "text": "I'm by no means suggesting that we're doing everything perfectly but when you start to get that amount of data there's",
    "start": "2275390",
    "end": "2281180"
  },
  {
    "text": "other interesting things that you can do with it and this is one thing that we've kind of come to find almost by accident",
    "start": "2281180",
    "end": "2286760"
  },
  {
    "text": "and maybe some of you here have large data projects in the organizations that you work for we found that once you",
    "start": "2286760",
    "end": "2293900"
  },
  {
    "text": "start to have this data in volume you can do really cool things with it so for",
    "start": "2293900",
    "end": "2299150"
  },
  {
    "text": "me as a website is the owner of my personal blog I get my reports and I'm like okay I have a problem on this page",
    "start": "2299150",
    "end": "2305720"
  },
  {
    "text": "and I'll go fix it and for every other individual customer with their individual reports they're interested in",
    "start": "2305720",
    "end": "2311329"
  },
  {
    "text": "their individual problems and things that they need to solve but we as a",
    "start": "2311329",
    "end": "2317059"
  },
  {
    "text": "service we can look down on this kind of ecosystem as a whole and say are there",
    "start": "2317059",
    "end": "2322910"
  },
  {
    "text": "many people out there seeing the same thing is this one customer got like a brand new problem that no one's seen",
    "start": "2322910",
    "end": "2328069"
  },
  {
    "text": "before is this report a common scenario across thousands of websites are unique",
    "start": "2328069",
    "end": "2333650"
  },
  {
    "text": "to them and we can start to look at the data in aggregate and there's two particular events that I want to talk",
    "start": "2333650",
    "end": "2338779"
  },
  {
    "text": "about where we've actually used this data for purposes beyond kind of like the obvious fixing your website problem",
    "start": "2338779",
    "end": "2346930"
  },
  {
    "text": "now we get reports from basically every country in the world like if we go through and look at this I'm pretty sure",
    "start": "2346930",
    "end": "2353960"
  },
  {
    "text": "those countries in there that I can't even recognize or spell so we do have some pretty substantial coverage to get",
    "start": "2353960",
    "end": "2359630"
  },
  {
    "text": "those over ten and a half billion reports they come from a lot of different browsers now I mentioned",
    "start": "2359630",
    "end": "2367279"
  },
  {
    "text": "earlier that we used to have spam filtering and the problem with setting up a service like this is like hey",
    "start": "2367279",
    "end": "2373130"
  },
  {
    "text": "here's an endpoint and if you send it some JSON it will do some really expensive processing and then database",
    "start": "2373130",
    "end": "2378440"
  },
  {
    "text": "transactions and I think people see that and think hey this would be fun what if I just send them loads of pointless JSON",
    "start": "2378440",
    "end": "2383839"
  },
  {
    "text": "or whatever it is so we've had spam detection for a long time because people like to do stupid stuff on the Internet",
    "start": "2383839",
    "end": "2389660"
  },
  {
    "text": "including just sending you loads of garbage data if you run a service like this now the spam filtering ones pick",
    "start": "2389660",
    "end": "2397369"
  },
  {
    "text": "something up and what we're trying to do is basically just look at our traffic on a larger scale and figure out if it's",
    "start": "2397369",
    "end": "2402950"
  },
  {
    "text": "something that with the are actually warrants if it's something we can throw away if it's something that's no good and we saw this one report coming in if someone had actually",
    "start": "2402950",
    "end": "2409650"
  },
  {
    "text": "flagged it to me at the time as well which is why I looked at this more specifically and they're like look we're",
    "start": "2409650",
    "end": "2415140"
  },
  {
    "text": "getting this report coming in that's saying I have a script tag on my page and it was like some crazy Russian",
    "start": "2415140",
    "end": "2421470"
  },
  {
    "text": "domain it was like just numbers and letters dot ru /aj s and they were like",
    "start": "2421470",
    "end": "2427560"
  },
  {
    "text": "well why are we getting this crazy Russian domain JavaScript on our page now I looked at their report and I",
    "start": "2427560",
    "end": "2434940"
  },
  {
    "text": "looked at our wider traffic volumes as well to see if anyone else was seeing this and we actually found hundreds of different websites that were reporting",
    "start": "2434940",
    "end": "2440550"
  },
  {
    "text": "the same issue there's these hundreds and hundreds of websites that were all saying we've got this crazy Russian javascript file on our page but no one",
    "start": "2440550",
    "end": "2447810"
  },
  {
    "text": "could replicate that and I went to a couple of the web pages when I was speaking to them I was like okay well I'm on the page there's no crazy Russian",
    "start": "2447810",
    "end": "2454650"
  },
  {
    "text": "JavaScript tag yeah here we have reports coming in saying crazy Russian JavaScript tag I was like so is someone",
    "start": "2454650",
    "end": "2462420"
  },
  {
    "text": "just sending these like he's someone just sat there crafting JSON payloads to make this look like a genuine problem I",
    "start": "2462420",
    "end": "2468839"
  },
  {
    "text": "was like well not really they have nothing to gain from that like what would anyone spending the resources on",
    "start": "2468839",
    "end": "2474270"
  },
  {
    "text": "this game so I actually got the JavaScript file that was linked I beautified it and I was scrolling",
    "start": "2474270",
    "end": "2480000"
  },
  {
    "text": "through and really really sadly I recognized a variable inside the JavaScript and I more recognize the",
    "start": "2480000",
    "end": "2486690"
  },
  {
    "text": "format of it because it was a chromium extension ID but I saw inside the JavaScript and I was like hang on that's",
    "start": "2486690",
    "end": "2493099"
  },
  {
    "text": "like I recognize this this looks familiar not the extension ID there's the format",
    "start": "2493099",
    "end": "2498300"
  },
  {
    "text": "of it that it was a chromium extension ID and that kind of quick fired a series",
    "start": "2498300",
    "end": "2503940"
  },
  {
    "text": "of thoughts in my head that was like hang on a minute this is an extension ID chromium extensions are installed on the",
    "start": "2503940",
    "end": "2510150"
  },
  {
    "text": "client and extensions can do things to the page like inject JavaScript tags",
    "start": "2510150",
    "end": "2516089"
  },
  {
    "text": "into the page what if this isn't that you've actually got a JavaScript tag on",
    "start": "2516089",
    "end": "2521339"
  },
  {
    "text": "your page on your website but what if the user has an extension that's injecting this JavaScript tag into the",
    "start": "2521339",
    "end": "2526650"
  },
  {
    "text": "page because then you would still have a JavaScript tag in your page the browser would trip on the CSP and send the",
    "start": "2526650",
    "end": "2532440"
  },
  {
    "text": "report but if you went to the page and had a look it wouldn't be there and I was like wait wait wait this is",
    "start": "2532440",
    "end": "2537690"
  },
  {
    "text": "not these are not people reporting the fact that the website has a script tag on it they're reporting that their copy",
    "start": "2537690",
    "end": "2543390"
  },
  {
    "text": "of the webpage has a script tag on it and it turned out that it was a chromium extension that had done this there was a",
    "start": "2543390",
    "end": "2549540"
  },
  {
    "text": "Chrome extension that gone rogue we were able to identify it with the extension ID and it was literally just appending a",
    "start": "2549540",
    "end": "2555180"
  },
  {
    "text": "piece of JavaScript to every page that that browser went to and it just so happened that some of those websites",
    "start": "2555180",
    "end": "2560820"
  },
  {
    "text": "were customers of ours so I took all of this data I was like I real don't know what to do with this information",
    "start": "2560820",
    "end": "2566700"
  },
  {
    "text": "and I sent it to a friend at Google and it's like a week or so later with some short time later like Chrome extension",
    "start": "2566700",
    "end": "2573690"
  },
  {
    "text": "banished from the store and they weren't able to talk to me any further about it but what we'd realized was that we'd",
    "start": "2573690",
    "end": "2579090"
  },
  {
    "start": "2577000",
    "end": "2624000"
  },
  {
    "text": "found a compromise on the client so CSP and everyone's kind of thought so but including mine up until that moment in",
    "start": "2579090",
    "end": "2585660"
  },
  {
    "text": "time were about how do we detect like a compromise of the application normal if you have a hostile script tag on your",
    "start": "2585660",
    "end": "2591180"
  },
  {
    "text": "page is because cross-site scripting a developer put it there something kind of on the server side but what we'd",
    "start": "2591180",
    "end": "2597930"
  },
  {
    "text": "realized was this was a Chrome extension and these things are super powerful they can do anything that they want basically",
    "start": "2597930",
    "end": "2604200"
  },
  {
    "text": "to the page this particular one had gone rogue and it decided to start injecting hostile script and we detected that a",
    "start": "2604200",
    "end": "2610860"
  },
  {
    "text": "much higher level and it's the kind of things that we are seeing more and more now so that was kind of the first story",
    "start": "2610860",
    "end": "2618300"
  },
  {
    "text": "and on a very similar thread we also had a similar thing happen again now this",
    "start": "2618300",
    "end": "2625140"
  },
  {
    "start": "2624000",
    "end": "2819000"
  },
  {
    "text": "particular one it wasn't a Chrome extension it was actually a piece of malware installed on an endpoint and at",
    "start": "2625140",
    "end": "2630690"
  },
  {
    "text": "this point what we kind of realized was both of these had been picked up by like some spam filter thing which is like a",
    "start": "2630690",
    "end": "2637050"
  },
  {
    "text": "really super hacky thing that I just kind of built to save us some database transactions I'm simply going to rename",
    "start": "2637050",
    "end": "2643350"
  },
  {
    "text": "it to our threat intelligence feeds because that sounds way cooler and we can probably sell that for more money but we had this other customer come to",
    "start": "2643350",
    "end": "2650610"
  },
  {
    "text": "us and it was a very similar story again they came to us and they were like hey you know we've managed to fix like all",
    "start": "2650610",
    "end": "2656760"
  },
  {
    "text": "of the problems on our website apart from this one our team cannot get to the bottom of why you keep telling us that",
    "start": "2656760",
    "end": "2661860"
  },
  {
    "text": "we're getting this report now the document URI here the page I've obviously mask some information this was",
    "start": "2661860",
    "end": "2668250"
  },
  {
    "text": "an Internet application at the company got in touch and they said look the only people that can get to this application are people literally in our office",
    "start": "2668250",
    "end": "2675170"
  },
  {
    "text": "building or that a vp end in from home so if someone's going to this application they're literally a member of staff on our internal network so this",
    "start": "2675170",
    "end": "2682250"
  },
  {
    "text": "isn't like crazy stuff out on the Internet this is like eight to nine thousand people that are on our corporate campus",
    "start": "2682250",
    "end": "2688010"
  },
  {
    "text": "I was like right okay so someone's gone to a page on your web application your internal Internet",
    "start": "2688010",
    "end": "2694130"
  },
  {
    "text": "they've triggered on a script sauce and again we're seeing about this crazy Russian domain and it was another one of these things where I was like what is it",
    "start": "2694130",
    "end": "2700640"
  },
  {
    "text": "with dot are you domains and so I looked at this and I had like the benefit of",
    "start": "2700640",
    "end": "2706250"
  },
  {
    "text": "hindsight of the previous thing that we'd just been through and I was like well look we had this thing recently where it wasn't a compromise on your",
    "start": "2706250",
    "end": "2712460"
  },
  {
    "text": "application it was actually a compromise on the client it was a hostile browser extension and they're like well again",
    "start": "2712460",
    "end": "2718790"
  },
  {
    "text": "though internet site like this is people within our corporate campus this is not some you know crazy person on the internet with a virus infected laptop",
    "start": "2718790",
    "end": "2725360"
  },
  {
    "text": "I'm like well that's what it says that's what the evidence suggests because they kept going to this page on their application and saying there's no script",
    "start": "2725360",
    "end": "2732020"
  },
  {
    "text": "tag I'm like yes but when the page gets to the client if something on the client puts the script tag there it does have a",
    "start": "2732020",
    "end": "2739880"
  },
  {
    "text": "script tag of a CSP will trip and it will send this report so they were like",
    "start": "2739880",
    "end": "2745520"
  },
  {
    "text": "right okay so how do we figure out which client is I was like well this is kind of a problem because CSP is not meant to",
    "start": "2745520",
    "end": "2751910"
  },
  {
    "text": "tell you that we don't go we get the JSON payload comes as a HTTP POST so all",
    "start": "2751910",
    "end": "2757400"
  },
  {
    "text": "we see is that public IP it's not like a per client thing it's just that public one IP and we do also get the user agent",
    "start": "2757400",
    "end": "2763190"
  },
  {
    "text": "string of the browser neither of which we store anyway so we didn't actually have but those are the only two things",
    "start": "2763190",
    "end": "2769340"
  },
  {
    "text": "that theoretically we could have had anyway and those aren't going to help you identify an internal endpoint now we",
    "start": "2769340",
    "end": "2774620"
  },
  {
    "text": "were trying to think of a way to fix this with a technical solution which looks and still to me is basically impossible but what someone in their",
    "start": "2774620",
    "end": "2780980"
  },
  {
    "text": "organization was able to do was based on the pages on the internet site that this browser kept going to they were able to",
    "start": "2780980",
    "end": "2787760"
  },
  {
    "text": "guess what department in the company they worked him and they literally just went to the department and had like a little stroll around and were asking",
    "start": "2787760",
    "end": "2794420"
  },
  {
    "text": "people looking at people and they found an endpoint that had local admin",
    "start": "2794420",
    "end": "2799520"
  },
  {
    "text": "privileges for a legacy application that this particular person needed to use and it transpired that this endpoint had",
    "start": "2799520",
    "end": "2805730"
  },
  {
    "text": "malware installed so it had a piece of malware on there's like some crappy malvert izing where it was trying to",
    "start": "2805730",
    "end": "2810799"
  },
  {
    "text": "inject stuff into the pages that that user was going to so again it was like",
    "start": "2810799",
    "end": "2816680"
  },
  {
    "text": "this this kind of typical mindset of CSP in these reports is like oh you've got a script tag on a page go look at the",
    "start": "2816680",
    "end": "2822260"
  },
  {
    "text": "server the application has been compromised so there's something there but again it wasn't it was something on the client this kind of had malware the",
    "start": "2822260",
    "end": "2829520"
  },
  {
    "text": "malware was injecting into the page the CSP was blocking you and then dispatching the report to us so with all",
    "start": "2829520",
    "end": "2838339"
  },
  {
    "text": "that in mind I'm finishing right on time and I did want to take some good Q&A in here so thank you very much for everyone",
    "start": "2838339",
    "end": "2845690"
  },
  {
    "start": "2845000",
    "end": "2872000"
  },
  {
    "text": "for coming I will take questions now if there's anything at all that you want to ask or even feedback like I said earlier",
    "start": "2845690",
    "end": "2852410"
  },
  {
    "text": "if you've got any suggestions based on why I've shown you today I'm more than happy to hear it so thank you very much",
    "start": "2852410",
    "end": "2860470"
  },
  {
    "text": "so questions okay so oops I can't move",
    "start": "2862359",
    "end": "2881569"
  },
  {
    "start": "2872000",
    "end": "3380000"
  },
  {
    "text": "acts my laptop will slide off let me just bring up the pricing for clarify workers the answer is five dollars oh",
    "start": "2881569",
    "end": "2886930"
  },
  {
    "text": "sorry yeah repeat the question so essentially how much is workers what",
    "start": "2886930",
    "end": "2891950"
  },
  {
    "text": "would it cost now what would it cost later so classify workers is it five dollars per ten million I'm gonna bring it up",
    "start": "2891950",
    "end": "2898250"
  },
  {
    "text": "right now just so I don't get this wrong and if I put this on to Jew placate so I",
    "start": "2898250",
    "end": "2907069"
  },
  {
    "text": "come up there we go so do they have the workers pricing on here I'm pretty sure",
    "start": "2907069",
    "end": "2912559"
  },
  {
    "text": "he's five dollars per ten million but I don't wanna get that wrong carefully",
    "start": "2912559",
    "end": "2918500"
  },
  {
    "text": "workers pricing billing for workers that's probably it",
    "start": "2918500",
    "end": "2923619"
  },
  {
    "text": "okay I'm pretty sure it's $5 but ten million but you can correct me on that later oh is it there excellent so there we go",
    "start": "2924979",
    "end": "2932849"
  },
  {
    "text": "so 50 cent per million after that as well yeah so that's what I remembered as she wants to make sure I wasn't wrong on",
    "start": "2932849",
    "end": "2940799"
  },
  {
    "text": "the floor are supporting us right now and it really depends on your workload",
    "start": "2940799",
    "end": "2945959"
  },
  {
    "text": "us so whether or not for us it in entirety it would work out cheaper to be exclusively on workers which is where",
    "start": "2945959",
    "end": "2952649"
  },
  {
    "text": "we're driving to but it also depends what you do with them if you're using a worker to do something that's not",
    "start": "2952649",
    "end": "2957959"
  },
  {
    "text": "computationally expensive then it might not be so I guess it depends you're paying per execution and how much it can",
    "start": "2957959",
    "end": "2965249"
  },
  {
    "text": "save you per execution depends on what it was costing you so if you're just doing my basic get requests then is",
    "start": "2965249",
    "end": "2970319"
  },
  {
    "text": "probably not I would say because we don't save money on our web application with this we save it on the report",
    "start": "2970319",
    "end": "2975989"
  },
  {
    "text": "ingestion because we do a lot of work there so I guess it would really depend on what is that you're doing with the",
    "start": "2975989",
    "end": "2981749"
  },
  {
    "text": "worker as to whether or not it would directly save you any money does that answer the question awesome yes",
    "start": "2981749",
    "end": "2990288"
  },
  {
    "text": "how does it sorry can you just elaborate a little bit make sure I get that Oh",
    "start": "2996240",
    "end": "3002028"
  },
  {
    "text": "gotcha okay so that was more specifically basically how to CSP deal with XSS in terms of CSP when you enable",
    "start": "3004099",
    "end": "3013859"
  },
  {
    "text": "this two things happen first of all all script tags have to come from a whitelisted sauce which was the evil calm thing that I explained the other",
    "start": "3013859",
    "end": "3019890"
  },
  {
    "text": "thing that I didn't get to was that all inline script is banned because if you have an inline script tag in the page",
    "start": "3019890",
    "end": "3025230"
  },
  {
    "text": "the browser does have no idea where that came from so what you do is you take",
    "start": "3025230",
    "end": "3030420"
  },
  {
    "text": "that script tag the intern the inline one you externalize it and then load it from your own domain and then the CSP",
    "start": "3030420",
    "end": "3036180"
  },
  {
    "text": "can match on self so that's how the browser knows that it definitely came from you now that's kind of a nuclear",
    "start": "3036180",
    "end": "3042599"
  },
  {
    "text": "option know inline script allowed whatsoever there are ways to whitelist inline scripts you can hash them and",
    "start": "3042599",
    "end": "3049319"
  },
  {
    "text": "include the hash in the CSP which will all our specific inline scripts to run or you can also use something called the",
    "start": "3049319",
    "end": "3054420"
  },
  {
    "text": "nonce where you add a nonce attribute to the script tag and any script tags with a matching nones will execute those are",
    "start": "3054420",
    "end": "3061079"
  },
  {
    "text": "quiet so it is possible whichever way you want to do it those are slightly more in-depth and I went on CSP today",
    "start": "3061079",
    "end": "3067049"
  },
  {
    "text": "but you can you can do whatever you need to do with CSP there is a way to do it I was just very light on the details today",
    "start": "3067049",
    "end": "3075950"
  },
  {
    "text": "what about script inside so again it'd",
    "start": "3080509",
    "end": "3086940"
  },
  {
    "text": "be back to hashing it you could use the sha-256 hash I don't think you can dance",
    "start": "3086940",
    "end": "3093390"
  },
  {
    "text": "that I've not experimented with using non C's there I think your only option would be to Hashi you can't actually just enable unsafe",
    "start": "3093390",
    "end": "3099599"
  },
  {
    "text": "inline as it's called but I I don't like talking about that because you should not do it because it removes all the protection so I would use the hash based",
    "start": "3099599",
    "end": "3106710"
  },
  {
    "text": "approach though questions or feedback yes",
    "start": "3106710",
    "end": "3113568"
  },
  {
    "text": "go ahead hmm",
    "start": "3114410",
    "end": "3120700"
  },
  {
    "text": "okay great questions so I mentioned during the DDoS that the customers",
    "start": "3128969",
    "end": "3134589"
  },
  {
    "text": "browser of our visitors could have been sending comes by my own name would have",
    "start": "3134589",
    "end": "3140739"
  },
  {
    "text": "been sending is like 60-odd whatever post requests and would that have a performance impact for the client did I",
    "start": "3140739",
    "end": "3147069"
  },
  {
    "text": "understand the question correctly and the answer is no the CSP reports are",
    "start": "3147069",
    "end": "3152619"
  },
  {
    "text": "sent asynchronously by the browser and they're also low priority so chrome has like cool features where it will detect",
    "start": "3152619",
    "end": "3158920"
  },
  {
    "text": "slow networks and use various fallback positions and like most of those include sacrificing non-critical stuff like us",
    "start": "3158920",
    "end": "3165039"
  },
  {
    "text": "which is really good for us because we really can't have a negative impact on",
    "start": "3165039",
    "end": "3170439"
  },
  {
    "text": "performance I think this was the article so yeah we can see there's like one of",
    "start": "3170439",
    "end": "3176829"
  },
  {
    "text": "them down here which had like 64 post requests for for the site load but no we",
    "start": "3176829",
    "end": "3184119"
  },
  {
    "text": "can't we should never be in a position where we make your website go slower",
    "start": "3184119",
    "end": "3189538"
  },
  {
    "text": "okay so do we do we basically do anything with the reports that we",
    "start": "3200420",
    "end": "3205920"
  },
  {
    "text": "discard historically no more recently what we started looking at is taking the",
    "start": "3205920",
    "end": "3214440"
  },
  {
    "text": "ones that aren't quite spectrum pliant but I like still well form JSON I'm raising bugs with vendors so I have",
    "start": "3214440",
    "end": "3221609"
  },
  {
    "text": "countless bugs open in like Chrome Safari but I think I have any an edge Firefox so yeah we are trying to improve",
    "start": "3221609",
    "end": "3229019"
  },
  {
    "text": "the ecosystem in that ways well rather than just discard the invalid JSON we have a massive down sample now where we",
    "start": "3229019",
    "end": "3234900"
  },
  {
    "text": "let like one in a thousand through just to see exactly why it was rejected most",
    "start": "3234900",
    "end": "3240209"
  },
  {
    "text": "of the browser vendors are pretty good with this now and getting valid data sewers sometimes it's obvious that people are just sending us absolutely",
    "start": "3240209",
    "end": "3246089"
  },
  {
    "text": "garbage as well why do people send JSON I don't know what they do",
    "start": "3246089",
    "end": "3253519"
  },
  {
    "text": "yes so the question there was kind of an",
    "start": "3253519",
    "end": "3261959"
  },
  {
    "text": "extension change the CSP header and the answer is yes an extension can just like completely new to the CSP and remove it",
    "start": "3261959",
    "end": "3268319"
  },
  {
    "text": "if it really wants to that's the level of control that you give an extension when you stall it into your browser so",
    "start": "3268319",
    "end": "3273479"
  },
  {
    "text": "theoretically we're actually having a conversation we try just about this the other day should because there's loads of valid extensions out there that do",
    "start": "3273479",
    "end": "3280049"
  },
  {
    "text": "things like change the font or load a more readable form for people with visual difficulties the CSP number one",
    "start": "3280049",
    "end": "3286890"
  },
  {
    "text": "can't stop an extension because an extension is on the client and the client is King number two the question",
    "start": "3286890",
    "end": "3292559"
  },
  {
    "text": "then is like we're fighting with the extension so CSP in the extension of like head-butting over who gets to run",
    "start": "3292559",
    "end": "3297809"
  },
  {
    "text": "JavaScript or not extension developers really should either whitelist themselves in the CSP or disable the CSP",
    "start": "3297809",
    "end": "3304799"
  },
  {
    "text": "to prevent the report being sent because we get a lot of reports like that where hey I've tried to add this like high",
    "start": "3304799",
    "end": "3310890"
  },
  {
    "text": "visibility fund a new block date in CSP here's your report looks like well we don't need to know that but the",
    "start": "3310890",
    "end": "3316529"
  },
  {
    "text": "extension developers I think they probably don't know about CSP right now we don't have enough information",
    "start": "3316529",
    "end": "3322140"
  },
  {
    "text": "education out there about it another question no shout",
    "start": "3322140",
    "end": "3330960"
  },
  {
    "text": "oh so now they are all HTTP level so if",
    "start": "3330960",
    "end": "3353430"
  },
  {
    "text": "you want to configure any of these mechanisms you configure all of them with a HTTP response header which some",
    "start": "3353430",
    "end": "3359040"
  },
  {
    "text": "people don't like because you're configuring things further down in the stack like the TLS layer with a HTTP",
    "start": "3359040",
    "end": "3364980"
  },
  {
    "text": "header but for now you do configure all of these with HTTP response headers anymore",
    "start": "3364980",
    "end": "3375349"
  },
  {
    "text": "no I think we're good thanks very much [Applause]",
    "start": "3375349",
    "end": "3382449"
  }
]