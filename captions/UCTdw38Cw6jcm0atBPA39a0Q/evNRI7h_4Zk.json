[
  {
    "start": "0",
    "end": "82000"
  },
  {
    "text": "all right let's get started hello guys how are you i hope you are enjoying the",
    "start": "6799",
    "end": "14000"
  },
  {
    "text": "conference so far and uh yeah that even though uh we are doing it remotely in this way",
    "start": "14000",
    "end": "21439"
  },
  {
    "text": "it's online it's not the same thing as a staying together but at least we're staying safe and uh yeah we still have",
    "start": "21439",
    "end": "26720"
  },
  {
    "text": "the chance to learn uh something my name is uh marco thanks for joining me uh for the next hour um",
    "start": "26720",
    "end": "35440"
  },
  {
    "text": "i'm a developer technologies mvp when i was first awarded 11 years ago it was uh on asp.net and",
    "start": "35440",
    "end": "42320"
  },
  {
    "text": "iis now it has been rebranded in this way which is very fast as a um as an expertise as a topic",
    "start": "42320",
    "end": "49760"
  },
  {
    "text": "but i'm still very focused on anything that's related to web and cloud and today i'm incredibly excited it's my",
    "start": "49760",
    "end": "57120"
  },
  {
    "text": "first time at ndc and i'm incredibly excited to talk about my two favorite topics",
    "start": "57120",
    "end": "62960"
  },
  {
    "text": "uh one is a security identity management in web applications and the other one is a blazer which",
    "start": "62960",
    "end": "68640"
  },
  {
    "text": "is probably i hope you agree with me but it's probably one of the coolest technologies microsoft is working on at",
    "start": "68640",
    "end": "75119"
  },
  {
    "text": "the moment so yeah really exciting things to discuss for the next uh yeah 60 minutes so what are we going",
    "start": "75119",
    "end": "82960"
  },
  {
    "start": "82000",
    "end": "189000"
  },
  {
    "text": "to talk about today um first of all i uh i'd like to give you a glimpse of the",
    "start": "82960",
    "end": "89600"
  },
  {
    "text": "object model that we have available in blazer to deal with security matters and then we will see how the security",
    "start": "89600",
    "end": "97600"
  },
  {
    "text": "aspects so the identity management of our users is a works slightly differently depending on whether we are in blazer",
    "start": "97600",
    "end": "103759"
  },
  {
    "text": "server on blazer web assembly works slightly differently under the hood because from the programmatic",
    "start": "103759",
    "end": "109520"
  },
  {
    "text": "programmatical perspective what we're going to use are pretty much the same classes which is cool",
    "start": "109520",
    "end": "114960"
  },
  {
    "text": "um then once we've successfully authenticated our users so we're going to move on and start having some",
    "start": "114960",
    "end": "123040"
  },
  {
    "text": "including some authorization rules based on roles and then we will see a way to do a better modeling of uh",
    "start": "123040",
    "end": "130239"
  },
  {
    "text": "authorization uh than what we can achieve with roles and then depending on time uh",
    "start": "130239",
    "end": "136720"
  },
  {
    "text": "i might i also have some other goodies to show you like how to deal with security for progressive web apps or with signalr",
    "start": "136720",
    "end": "144160"
  },
  {
    "text": "um so we will see if we can fit it in this hour or otherwise feel free to",
    "start": "144160",
    "end": "149360"
  },
  {
    "text": "reach me on slack if you're interested and i'm i'll be pretty happy to jump on a call perhaps and",
    "start": "149360",
    "end": "154400"
  },
  {
    "text": "and show you that cool so without further ado oh just one last",
    "start": "154400",
    "end": "160400"
  },
  {
    "text": "thing uh i've tried we since the blazer is still a bit unknown in uh in the landscape so",
    "start": "160400",
    "end": "165599"
  },
  {
    "text": "there's there's a sometimes that you feel you talk to people who i have very limited experience with it i tried to",
    "start": "165599",
    "end": "172319"
  },
  {
    "text": "keep the talk uh starting from the basics but i've also i'm also dealing with some",
    "start": "172319",
    "end": "178879"
  },
  {
    "text": "more advanced concepts so hopefully regardless to your level of experience you will be able",
    "start": "178879",
    "end": "184000"
  },
  {
    "text": "to take away something out of this talk or at least i hope so",
    "start": "184000",
    "end": "189440"
  },
  {
    "start": "189000",
    "end": "288000"
  },
  {
    "text": "cool so let's start with having a look at the object model and there are three main classes i want you guys to",
    "start": "189440",
    "end": "195680"
  },
  {
    "text": "focus on for the next five minutes right and because these are the classes that we're going to use throughout",
    "start": "195680",
    "end": "201519"
  },
  {
    "text": "pretty much the entire talk right so it's very important that you we keep them in mind the first one is authorized view",
    "start": "201519",
    "end": "207920"
  },
  {
    "text": "authorized view is a component we can put it on our pages and the nice thing about it is that it",
    "start": "207920",
    "end": "213360"
  },
  {
    "text": "basically allows me to define a couple of uh different",
    "start": "213360",
    "end": "218560"
  },
  {
    "text": "templates depending on which where we're going to show to the user depending on whether he's authenticated",
    "start": "218560",
    "end": "224720"
  },
  {
    "text": "or not right um actually there are three templates here uh available in uh in the authorized",
    "start": "224720",
    "end": "231280"
  },
  {
    "text": "view the third one is called authorizing and this is because usually in the context of a",
    "start": "231280",
    "end": "237360"
  },
  {
    "text": "single page web applications the authorization the authentication process is an asynchronous operation so it might be that for a few",
    "start": "237360",
    "end": "245360"
  },
  {
    "text": "seconds we might want to display a slightly different template okay in this case uh authorized or not",
    "start": "245360",
    "end": "251840"
  },
  {
    "text": "authorized means authenticated because i haven't specified anything but in this point here i can specify what what authorized",
    "start": "251840",
    "end": "258479"
  },
  {
    "text": "uh means and we will have a look at that later on during the talk but this is the",
    "start": "258479",
    "end": "264000"
  },
  {
    "text": "first class or the other the other important thing that it gives me is this context object which is basically",
    "start": "264000",
    "end": "271440"
  },
  {
    "text": "an entry point towards the claims principle of the application so thanks to that i can access the current principle",
    "start": "271440",
    "end": "276880"
  },
  {
    "text": "i can see the claims identity i can look at the claims and all the typical things that we do",
    "start": "276880",
    "end": "282160"
  },
  {
    "text": "with claims principles in uh net applications",
    "start": "282160",
    "end": "287440"
  },
  {
    "text": "the there's a slightly different implementation of the",
    "start": "287840",
    "end": "294400"
  },
  {
    "start": "288000",
    "end": "388000"
  },
  {
    "text": "authorized view called the authorizer root view and this is a kind of a mix",
    "start": "294400",
    "end": "300560"
  },
  {
    "text": "between a concept of the authorized view and the root view that we use for routing",
    "start": "300560",
    "end": "305759"
  },
  {
    "text": "so what does it mean it means that if i try to access a url for which i'm not",
    "start": "305759",
    "end": "312400"
  },
  {
    "text": "authorized uh i can decide what is uh the template that um i'm going to see right as a user",
    "start": "312400",
    "end": "320400"
  },
  {
    "text": "and what does it mean i'm authorized or not to authorize the world basically i think that if you guys are like me and",
    "start": "320400",
    "end": "326080"
  },
  {
    "text": "they've been working with asp.net uh for a while uh you know what this authorized attribute",
    "start": "326080",
    "end": "332160"
  },
  {
    "text": "uh means uh in this case again i'm authenticated or not or it could be that i can i specify",
    "start": "332160",
    "end": "339520"
  },
  {
    "text": "roles or policies or things like that all right um the important bit that uh",
    "start": "339520",
    "end": "346320"
  },
  {
    "text": "we don't have to we we have to focus on on this thing is uh that this authorized attribute",
    "start": "346320",
    "end": "352560"
  },
  {
    "text": "only works in the context of routing you know that in blazer you can you create components",
    "start": "352560",
    "end": "358319"
  },
  {
    "text": "and components can be either displayed as a pages as pages uh when we specify this page",
    "start": "358319",
    "end": "364240"
  },
  {
    "text": "directive or can be embedded in other pages or in other components just by using their",
    "start": "364240",
    "end": "369360"
  },
  {
    "text": "markup right so in this second case if we embed them this thing will not work so it's a very",
    "start": "369360",
    "end": "375440"
  },
  {
    "text": "common mistake and it's important that we um we keep it in mind so author the",
    "start": "375440",
    "end": "382000"
  },
  {
    "text": "authorized attribute only works in the context of rooting when associated to an authorized root view",
    "start": "382000",
    "end": "387840"
  },
  {
    "text": "right the third class that we need to get acquainted with is",
    "start": "387840",
    "end": "394240"
  },
  {
    "start": "388000",
    "end": "464000"
  },
  {
    "text": "the authentication state provider right and this is a class that we were never pretty much never going to use directly",
    "start": "394240",
    "end": "401199"
  },
  {
    "text": "okay but it's the foundation of the two objects that we've seen before as you can see it's an absolute class",
    "start": "401199",
    "end": "407280"
  },
  {
    "text": "it's a very simple classes but it basically exposes just this method here get authentication status",
    "start": "407280",
    "end": "412639"
  },
  {
    "text": "inc which gives me access to the uh current principle",
    "start": "412639",
    "end": "417919"
  },
  {
    "text": "and as you can see it's an abstract class so this means that it will have as we will",
    "start": "417919",
    "end": "423120"
  },
  {
    "text": "see very different implementations depending on which flavor of laser we're using whether we",
    "start": "423120",
    "end": "428960"
  },
  {
    "text": "are in blazer server or blazer blazer web assembly but the good thing is that the other two components that we've seen",
    "start": "428960",
    "end": "436400"
  },
  {
    "text": "so far they only rely on the abstract implementation so it means that if we create components",
    "start": "436400",
    "end": "442800"
  },
  {
    "text": "libraries and things like that they will work regardless to the type of blazer that we're using okay",
    "start": "442800",
    "end": "448400"
  },
  {
    "text": "thanks to this architectural approach right so let's start by having a look at how",
    "start": "448400",
    "end": "454560"
  },
  {
    "text": "authentication works in blazer and the idea here is that i'm gonna show you some uh flows in the in the slides and",
    "start": "454560",
    "end": "460720"
  },
  {
    "text": "then we're gonna head to visual studio and see it in action so play the server in blazer server we",
    "start": "460720",
    "end": "467280"
  },
  {
    "start": "464000",
    "end": "588000"
  },
  {
    "text": "know that oh and i'll be very quick here because i think that laser web assembly is the most intriguing part of blazer but",
    "start": "467280",
    "end": "474960"
  },
  {
    "text": "let's let's talk about this for sake of completeness so in blazer server we have our application which is running on the",
    "start": "474960",
    "end": "481919"
  },
  {
    "text": "browser and the blazer engine is what is running on the server and the two are connected",
    "start": "481919",
    "end": "488160"
  },
  {
    "text": "with the azure signalr now what happens is that if for any reason i have a",
    "start": "488160",
    "end": "493680"
  },
  {
    "text": "an asp.net uh authentication cookie stored in my browser um signalr and",
    "start": "493680",
    "end": "500400"
  },
  {
    "text": "this again is a built-in functionality in signalr will just pass that would just retrieve",
    "start": "500400",
    "end": "506960"
  },
  {
    "text": "the authentication cookie and use it to create the claims principle in the hub that",
    "start": "506960",
    "end": "513200"
  },
  {
    "text": "the browser is connected to and this is basically what allows you to",
    "start": "513200",
    "end": "518640"
  },
  {
    "text": "access your hub context in the hubs that you create and see that there's a user property there which is",
    "start": "518640",
    "end": "524560"
  },
  {
    "text": "the current logged in user the kind of connected user now blazer makes no exceptions",
    "start": "524560",
    "end": "531200"
  },
  {
    "text": "uh it's just running over a particular hub called component hub so how does the implementation of the",
    "start": "531200",
    "end": "538480"
  },
  {
    "text": "authentication state provider um you remember the class that we we just saw in the previous slide",
    "start": "538480",
    "end": "544800"
  },
  {
    "text": "look like in blazer server well it's a it's a pretty simple implementation it's",
    "start": "544800",
    "end": "550720"
  },
  {
    "text": "called the server authentication state provider and all the only thing that we need is uh making sure that we can retrieve this",
    "start": "550720",
    "end": "557680"
  },
  {
    "text": "so the component hub needs to retrieve this its current claims principle and set it in the um in that in the instance",
    "start": "557680",
    "end": "564800"
  },
  {
    "text": "of the current scope of the server authentication state provider and that's it so it's a very simple implementation it",
    "start": "564800",
    "end": "570959"
  },
  {
    "text": "just exposes a set authentication state method and that's how basically blazer server",
    "start": "570959",
    "end": "577920"
  },
  {
    "text": "um is capable of retrieving the the current um claim the current",
    "start": "577920",
    "end": "584080"
  },
  {
    "text": "principle of the uh of the application so this means that if we look at",
    "start": "584080",
    "end": "591680"
  },
  {
    "start": "588000",
    "end": "616000"
  },
  {
    "text": "which providers we can support in blazer server well we definitely support the things that such as a asp.net core",
    "start": "591680",
    "end": "597600"
  },
  {
    "text": "identity or azure active directory both the enterprise or b2c just because uh they work with asp.net",
    "start": "597600",
    "end": "604560"
  },
  {
    "text": "core again the place of server is just leveraging an existing feature which already is there for asp.net core",
    "start": "604560",
    "end": "610560"
  },
  {
    "text": "and signal r so basically anything that works with the xbox core will work with the place of server cube",
    "start": "610560",
    "end": "616320"
  },
  {
    "start": "616000",
    "end": "855000"
  },
  {
    "text": "so have let's have a look at uh uh how this works so let's jump to visual studio and",
    "start": "616320",
    "end": "622720"
  },
  {
    "text": "now the interesting bit is that i just uh uh came to know a couple of days ago that",
    "start": "622720",
    "end": "628000"
  },
  {
    "text": "in the webex if i do ctrl shift b to compile my application it will show a",
    "start": "628000",
    "end": "633440"
  },
  {
    "text": "whiteboard uh and disconnect my sharing screen so i'll try to uh avoid that uh but i'll do my best",
    "start": "633440",
    "end": "641839"
  },
  {
    "text": "but don't play me if it happens cool so we have this as server individual application this is basically",
    "start": "641839",
    "end": "648800"
  },
  {
    "text": "just the normal template of uh uh that you can create from uh from visual studio",
    "start": "648800",
    "end": "654079"
  },
  {
    "text": "um if i do control f5 and i launch it uh what visual studio comprise it um i",
    "start": "654079",
    "end": "661360"
  },
  {
    "text": "go there and if i try to access my counter page i see this message saying that i'm sorry",
    "start": "661360",
    "end": "668240"
  },
  {
    "text": "but you may not see this page and this is because like we were seeing on the slide in my counter page here i have my",
    "start": "668240",
    "end": "674560"
  },
  {
    "text": "authorized attribute and in my update tracer where where i've defined my routing",
    "start": "674560",
    "end": "680640"
  },
  {
    "text": "i have something like this right so this is the message to show when the user is not organized however",
    "start": "680640",
    "end": "686399"
  },
  {
    "text": "if i just add a counter here right and i relaunch the application i will",
    "start": "686399",
    "end": "693600"
  },
  {
    "text": "see the counter so this is the important bit i wanted you to be aware of the authorized attribute only works when uh we are dealing with",
    "start": "693600",
    "end": "701440"
  },
  {
    "text": "routing okay cool now let's log in here and as you can see the moment i hit the",
    "start": "701440",
    "end": "707360"
  },
  {
    "text": "login button what happens is that i've left the blazer application and now i'm in the",
    "start": "707360",
    "end": "713200"
  },
  {
    "text": "normal asp.net core identity page where i perform the login",
    "start": "713200",
    "end": "719040"
  },
  {
    "text": "and the moment i hit log in i just get redirected back to the",
    "start": "719040",
    "end": "724160"
  },
  {
    "text": "uh to the page where the placer application sits and now i can finally access the counter i see that here i",
    "start": "724160",
    "end": "730160"
  },
  {
    "text": "also get a greeting message and this is because uh if we go and have a look at the",
    "start": "730160",
    "end": "736560"
  },
  {
    "text": "login display component this is the component that goes on the top right corner of the",
    "start": "736560",
    "end": "742000"
  },
  {
    "text": "main layout as you can see there's a this authorized view that can differentiate between when i'm",
    "start": "742000",
    "end": "748160"
  },
  {
    "text": "authenticated or not and when i'm authenticated it's uh it shows",
    "start": "748160",
    "end": "753200"
  },
  {
    "text": "me a greeting message otherwise i have a couple of links and again these are the asp.net core",
    "start": "753200",
    "end": "759200"
  },
  {
    "text": "uh spot and mdc basically identity links to the login or register pages",
    "start": "759200",
    "end": "766639"
  },
  {
    "text": "okay if we go and have a look at the dot cs file what we get is uh",
    "start": "766639",
    "end": "774480"
  },
  {
    "text": "other than obviously the uh registration of uh asp.net identity i see this uh trad",
    "start": "774480",
    "end": "781680"
  },
  {
    "text": "scope the authentication state provider which is the absolute class um",
    "start": "781680",
    "end": "788320"
  },
  {
    "text": "that points to this bizarre named sadly named class revalidating identity identity of",
    "start": "788320",
    "end": "794240"
  },
  {
    "text": "navigation state provider or blah blah blah but if i go and have a look at the",
    "start": "794240",
    "end": "800000"
  },
  {
    "text": "hierarchy of uh of inheritance as you can see this ultimately inherits",
    "start": "800000",
    "end": "806800"
  },
  {
    "text": "from uh hopefully you can i can get to the definition of this uh inherits from the server",
    "start": "806800",
    "end": "812720"
  },
  {
    "text": "authentication state provider that we mentioned on the slides and this is the class that exposes the set authentication state",
    "start": "812720",
    "end": "818480"
  },
  {
    "text": "thanks to which the component hub can set the current principle for for this instance of uh of the",
    "start": "818480",
    "end": "825279"
  },
  {
    "text": "application all right uh the reason why we're not using this directly but we're using that",
    "start": "825279",
    "end": "830639"
  },
  {
    "text": "this class here is simply because uh we want to support the remote sign",
    "start": "830639",
    "end": "837120"
  },
  {
    "text": "out uh capability that we have in sp core by uh checking that the security stamp of",
    "start": "837120",
    "end": "843519"
  },
  {
    "text": "the of the user is still valid but apart from that the principle uh the principle by it by uh by which it",
    "start": "843519",
    "end": "850959"
  },
  {
    "text": "works is exactly the one that i've described you on slides okay so uh i would say that this could",
    "start": "850959",
    "end": "857199"
  },
  {
    "start": "855000",
    "end": "1076000"
  },
  {
    "text": "be enough for blazer server again the cool stuff is in a laser web assembly so let's uh go",
    "start": "857199",
    "end": "863600"
  },
  {
    "text": "ahead with that because uh uh it's probably more interesting okay so how all of this is different in blazer web",
    "start": "863600",
    "end": "870959"
  },
  {
    "text": "assembly so in blazer web assembly as you know we have our c-sharp application running on the browser and interacting",
    "start": "870959",
    "end": "878160"
  },
  {
    "text": "with the dom so per se this application is obviously not capable of managing users all right",
    "start": "878160",
    "end": "885040"
  },
  {
    "text": "i needed to rely on an external identity provider which could be either the hosting application azure",
    "start": "885040",
    "end": "890959"
  },
  {
    "text": "active directory or for example could be identity server 4 which is a what we're going to use",
    "start": "890959",
    "end": "896079"
  },
  {
    "text": "during during this talk and uh how does a blazer interact with identity",
    "start": "896079",
    "end": "902880"
  },
  {
    "text": "server do we have some strange c sharp code not at all we are using",
    "start": "902880",
    "end": "908440"
  },
  {
    "text": "idsclient.js it's a piece of javascript but which is uh referenced by by the portal and it's basically the",
    "start": "908440",
    "end": "915440"
  },
  {
    "text": "uh probably the most commonly used uh javascript client for uh uh for open at the open id",
    "start": "915440",
    "end": "922160"
  },
  {
    "text": "connect protocol right so it's not made by microsoft it's it's pretty much an industry standard",
    "start": "922160",
    "end": "928000"
  },
  {
    "text": "and uh so this is why how blazer interacts with uh with the identity",
    "start": "928000",
    "end": "934079"
  },
  {
    "text": "provider under the hood uh again we need an implementation of the authentication",
    "start": "934079",
    "end": "941199"
  },
  {
    "text": "state provider class and this implementation is called the remote authentication service",
    "start": "941199",
    "end": "947680"
  },
  {
    "text": "and the way this works is a very very very again simple uh it's just",
    "start": "947680",
    "end": "953839"
  },
  {
    "text": "uh so let's pretend that i've already authenticated the user via odc client in some way we'll see how",
    "start": "953839",
    "end": "959360"
  },
  {
    "text": "in a second so there is a a token being passed by uh is4 to my browser and stored in the",
    "start": "959360",
    "end": "967519"
  },
  {
    "text": "local in the session storage uh by this client the only thing that",
    "start": "967519",
    "end": "972639"
  },
  {
    "text": "the remote authentication service does is using js interop",
    "start": "972639",
    "end": "977759"
  },
  {
    "text": "to retrieve this user uh from uh from javascript and uh create a claims principle within",
    "start": "977759",
    "end": "984320"
  },
  {
    "text": "the application right um so this is really it it's as simple as that",
    "start": "984320",
    "end": "989920"
  },
  {
    "text": "and uh how do we trigger the uh the authentication process or perhaps the sign out where",
    "start": "989920",
    "end": "996079"
  },
  {
    "text": "it's done through another interface implemented by the same object okay so remote authentication",
    "start": "996079",
    "end": "1002160"
  },
  {
    "text": "service also implements i remote authentication service which exposes the two methods sign in and send out and these methods will just",
    "start": "1002160",
    "end": "1008959"
  },
  {
    "text": "trigger again the justice raptors around the logic which is a uh within the oic client right they will",
    "start": "1008959",
    "end": "1014399"
  },
  {
    "text": "just trigger the uh the function uh in javascript however we're pretty much never gonna",
    "start": "1014399",
    "end": "1020959"
  },
  {
    "text": "use these uh methods directly because uh the default template comes with uh this",
    "start": "1020959",
    "end": "1029438"
  },
  {
    "text": "page here called uh authentication which internally uses this object to call remote",
    "start": "1029439",
    "end": "1035360"
  },
  {
    "text": "authenticator view and what is that so this is an object that wraps up the logic around",
    "start": "1035360",
    "end": "1040959"
  },
  {
    "text": "all the flows that happened during an um open id connect interaction between the",
    "start": "1040959",
    "end": "1047600"
  },
  {
    "text": "client and the identity provider and without going into much detail uh the concept is",
    "start": "1047600",
    "end": "1054320"
  },
  {
    "text": "that it exposes this action property we call it with the flow that we want to trigger so for example action equals",
    "start": "1054320",
    "end": "1060559"
  },
  {
    "text": "login and this will uh trigger all the entire thing for me same for profile or",
    "start": "1060559",
    "end": "1066480"
  },
  {
    "text": "even the callbacks that we might receive from the uh from the identity provider so there's a login",
    "start": "1066480",
    "end": "1071679"
  },
  {
    "text": "called backhand chain for example cool which providers are supported in blazer",
    "start": "1071679",
    "end": "1078000"
  },
  {
    "start": "1076000",
    "end": "1110000"
  },
  {
    "text": "web assembly well we have a obviously uh identity server azure active directory and",
    "start": "1078000",
    "end": "1083600"
  },
  {
    "text": "active directory b2c uh the first two are available directly from visual studio for everyone we need to",
    "start": "1083600",
    "end": "1090080"
  },
  {
    "text": "uh still use the net cli but basically anything that will that works with the uh odc client so",
    "start": "1090080",
    "end": "1096640"
  },
  {
    "text": "implements openly connect and all who can make uh we can make it work with a",
    "start": "1096640",
    "end": "1101919"
  },
  {
    "text": "blazer web assembly sometimes uh i've from my experience we need some tweaking but but you can can potentially work",
    "start": "1101919",
    "end": "1109919"
  },
  {
    "text": "cool let's have a look at all of this uh in visual studio left so let's go back",
    "start": "1109919",
    "end": "1115280"
  },
  {
    "start": "1110000",
    "end": "1413000"
  },
  {
    "text": "here in the solution let me close these files and",
    "start": "1115280",
    "end": "1120960"
  },
  {
    "text": "as you can see i have this blazer web assembly um folder in which the first project is",
    "start": "1120960",
    "end": "1127440"
  },
  {
    "text": "a identity server for and in identity server for the configuration for the security",
    "start": "1127440",
    "end": "1135440"
  },
  {
    "text": "aspect so which clients authorize is usually either in a configuration file or in a c-sharp file like this one right so",
    "start": "1135440",
    "end": "1142559"
  },
  {
    "text": "if i go and have a look at this c-sharp file what i have here is a this client called",
    "start": "1142559",
    "end": "1148960"
  },
  {
    "text": "the blazer that i have configured in which i specified a few things so first of all it's a single page",
    "start": "1148960",
    "end": "1154480"
  },
  {
    "text": "application so i'm using a client type code this is the type of work of a workflow that we're gonna",
    "start": "1154480",
    "end": "1159760"
  },
  {
    "text": "implement uh with a uh open id connect it supports the proof keycode exchanges security",
    "start": "1159760",
    "end": "1166240"
  },
  {
    "text": "protocol and the other important thing that i'm specifying here are these scopes that this laser application",
    "start": "1166240",
    "end": "1172720"
  },
  {
    "text": "is required allowed to request and what are the scopes a scope is basically a think about it as a set of",
    "start": "1172720",
    "end": "1179919"
  },
  {
    "text": "claims a predefined set of claims that blazer can uh can request and then receive so here i have open id and profile uh",
    "start": "1179919",
    "end": "1188000"
  },
  {
    "text": "these scopes are defined here in this section i can potentially add another one like i don't know there are there are a",
    "start": "1188000",
    "end": "1193600"
  },
  {
    "text": "few predefined here in uh in is4 for example email",
    "start": "1193600",
    "end": "1199679"
  },
  {
    "text": "and i can say that yeah blazer can request also this email scope right plus a further a",
    "start": "1199679",
    "end": "1207039"
  },
  {
    "text": "bunch of other parameters like the course configuration redirect uris etc",
    "start": "1207039",
    "end": "1213360"
  },
  {
    "text": "cool um if we go to blazer web assembly uh so i have this application here let's",
    "start": "1213360",
    "end": "1219679"
  },
  {
    "text": "have a look at what i get out of it uh so um if i click on program",
    "start": "1219679",
    "end": "1226960"
  },
  {
    "text": "uh this is pretty much the default template that you obtained when you decided to go and",
    "start": "1226960",
    "end": "1233360"
  },
  {
    "text": "add the new project to your solution you select a blazer application and",
    "start": "1233360",
    "end": "1239840"
  },
  {
    "text": "uh here in this page you you say that you want individual user accounts so all that you",
    "start": "1239840",
    "end": "1245919"
  },
  {
    "text": "get is a very generic configuration um that starts with that basically only",
    "start": "1245919",
    "end": "1251840"
  },
  {
    "text": "has this odd ad or ibc uh authentication uh extension method",
    "start": "1251840",
    "end": "1256960"
  },
  {
    "text": "and then you have to provide the configuration uh you can provide it either by code or in a configuration",
    "start": "1256960",
    "end": "1262720"
  },
  {
    "text": "file in this example is by code simply because it's more clear for for our scopes but but then we will see later how to",
    "start": "1262720",
    "end": "1269919"
  },
  {
    "text": "configure it by um app settings so what do i have here i",
    "start": "1269919",
    "end": "1275120"
  },
  {
    "text": "have basically the counterpart of all the things that i've set in in is4 so i have that the client it is called",
    "start": "1275120",
    "end": "1280640"
  },
  {
    "text": "blazer uh the type of flow is going to be code if i want to um the this the two scopes",
    "start": "1280640",
    "end": "1288480"
  },
  {
    "text": "open id and profile are already predefined in in as default parameters but i can",
    "start": "1288480",
    "end": "1295200"
  },
  {
    "text": "add some additional scopes for so for example the email one",
    "start": "1295200",
    "end": "1300640"
  },
  {
    "text": "that we've added before and that's uh pretty much really really it so let's",
    "start": "1300640",
    "end": "1307520"
  },
  {
    "text": "start these two projects so let's begin by starting the identity provider project",
    "start": "1307520",
    "end": "1315760"
  },
  {
    "text": "all right so this is is4 running and now let's go to the laser application",
    "start": "1316320",
    "end": "1323279"
  },
  {
    "text": "controller 5 not ctrl shift b and let's run this right",
    "start": "1323600",
    "end": "1330559"
  },
  {
    "text": "so how does it work uh here i've also set my uh counter page beyond behind the",
    "start": "1330559",
    "end": "1337679"
  },
  {
    "text": "um uh authorizer uh attributes so if i click counter i get redirected as you can see",
    "start": "1337679",
    "end": "1344960"
  },
  {
    "text": "to uh identity server four um just by a chance how did i do that um",
    "start": "1344960",
    "end": "1351440"
  },
  {
    "text": "well if i go to the pages and look at the counter i have my authorized attribute what",
    "start": "1351440",
    "end": "1358880"
  },
  {
    "text": "happens to be here in the routing this time is a redirect to login component this is a component",
    "start": "1358880",
    "end": "1364880"
  },
  {
    "text": "uh which is here in the application and it just navigates to the uh authentication",
    "start": "1364880",
    "end": "1370640"
  },
  {
    "text": "login endpoint okay this is the page that uses this uh remote authenticator view uh thing",
    "start": "1370640",
    "end": "1376720"
  },
  {
    "text": "that we've seen on the slides and so this allows me to login i can log in as a bob for example",
    "start": "1376720",
    "end": "1385200"
  },
  {
    "text": "and here uh i get my consent screen i can send it to these flames and now",
    "start": "1385200",
    "end": "1391280"
  },
  {
    "text": "i'm back to the application i can successfully access my um my page",
    "start": "1391280",
    "end": "1398480"
  },
  {
    "text": "if i log out i can re-login as a as alice uh the other user default",
    "start": "1398480",
    "end": "1405600"
  },
  {
    "text": "user that i have here and everything will pretty much work exactly exactly in the same way",
    "start": "1405600",
    "end": "1412159"
  },
  {
    "text": "cool so this is uh the very basic thing that we managed to do",
    "start": "1412159",
    "end": "1418559"
  },
  {
    "start": "1413000",
    "end": "1549000"
  },
  {
    "text": "and it's really not that useful unless we are capable of calling an api",
    "start": "1418559",
    "end": "1424720"
  },
  {
    "text": "right so this is uh going to be our next task so how do we call uh an api what do",
    "start": "1424720",
    "end": "1432240"
  },
  {
    "text": "we need to do well what do we need to do is basically uh requesting an access token",
    "start": "1432240",
    "end": "1437760"
  },
  {
    "text": "for for the api for this protected api and in order to do that we have this third interface implemented",
    "start": "1437760",
    "end": "1445120"
  },
  {
    "text": "by the remote authentication service called i access token provider this provides a request access token method uh when i",
    "start": "1445120",
    "end": "1452799"
  },
  {
    "text": "call it it again just a javascript interrupt interrupt it calls a odc client which",
    "start": "1452799",
    "end": "1457919"
  },
  {
    "text": "will request an access token to the identity uh to an entity server",
    "start": "1457919",
    "end": "1463520"
  },
  {
    "text": "what's an access token an access token is a pretty much similar to the id token we've seen before the only difference being that it's not",
    "start": "1463520",
    "end": "1470480"
  },
  {
    "text": "meant to be consumed by my application here it's meant to be just a",
    "start": "1470480",
    "end": "1475840"
  },
  {
    "text": "considered opaque by this application and uh forward it to um the api we want to the resource",
    "start": "1475840",
    "end": "1483440"
  },
  {
    "text": "that we want to consume this access token contains the identity of the user which means that",
    "start": "1483440",
    "end": "1488720"
  },
  {
    "text": "in the web api i will be able to uh access the claims principle uh of uh",
    "start": "1488720",
    "end": "1495039"
  },
  {
    "text": "of the http context right so it's basically like blazer was impersonating the logged in user uh",
    "start": "1495039",
    "end": "1501440"
  },
  {
    "text": "when making this call to the web api all right so we need to request the access token and embed it uh",
    "start": "1501440",
    "end": "1507039"
  },
  {
    "text": "in the subsequent request by the uh as a better token in the authorization header",
    "start": "1507039",
    "end": "1512559"
  },
  {
    "text": "the good thing is that we don't have to do it uh manually okay blazer has a some automatic thing uh components that",
    "start": "1512559",
    "end": "1520400"
  },
  {
    "text": "uh does it for us and it's called the authorization message handler uh it's basically a component",
    "start": "1520400",
    "end": "1527360"
  },
  {
    "text": "that gets embedded in the http client pipeline and can automatically retrieve this access",
    "start": "1527360",
    "end": "1534240"
  },
  {
    "text": "token for us either in the local cache or by querying is4 and add it as a as a",
    "start": "1534240",
    "end": "1542159"
  },
  {
    "text": "better token in the authorization header when making the request to the to the weather api and we will see that in action in a second all right",
    "start": "1542159",
    "end": "1549760"
  },
  {
    "start": "1549000",
    "end": "1909000"
  },
  {
    "text": "cool let's see how oh how all this works i need to close these two uh running applications and",
    "start": "1549760",
    "end": "1558240"
  },
  {
    "text": "let's go back to visual studio and so what do we need to first of all let's go back to",
    "start": "1558240",
    "end": "1564240"
  },
  {
    "text": "my identity provider and here what i have is a i've defined an",
    "start": "1564240",
    "end": "1571039"
  },
  {
    "text": "api resource right so this is my web api that i want to be able to call i gave it a name and i said that um",
    "start": "1571039",
    "end": "1578480"
  },
  {
    "text": "when uh someone asks for an access token for this api these are the claims that need to be",
    "start": "1578480",
    "end": "1585039"
  },
  {
    "text": "added to this api right so this is just another scope that we can request to",
    "start": "1585039",
    "end": "1592080"
  },
  {
    "text": "blazer uh provided that these are it's among the uh allowed scopes that we have now here in",
    "start": "1592080",
    "end": "1598400"
  },
  {
    "text": "is4 okay but apart from that uh it's just a this is these are the only changes that we need",
    "start": "1598400",
    "end": "1604159"
  },
  {
    "text": "to do in um in identity server and then i have a weather api project",
    "start": "1604159",
    "end": "1610400"
  },
  {
    "text": "and in my weather api project in the startup i've configured that i want to use the jotbetter",
    "start": "1610400",
    "end": "1617440"
  },
  {
    "text": "authentication scheme and here i'm saying that uh yeah this is",
    "start": "1617440",
    "end": "1622480"
  },
  {
    "text": "the authority uh which is going to issue those tokens i expect an audience on that token",
    "start": "1622480",
    "end": "1628640"
  },
  {
    "text": "called the weather api and then i've also specified the uh claim uh type that is going to represent my",
    "start": "1628640",
    "end": "1635360"
  },
  {
    "text": "name that's it for the configuration it's just the default standard configuration for oauth to in in web api",
    "start": "1635360",
    "end": "1644399"
  },
  {
    "text": "uh the other thing that i've done is that here in the weather forecast controller i put my",
    "start": "1644399",
    "end": "1651440"
  },
  {
    "text": "authorized attribute so that only authenticated user will be able to call this controller and to show that i",
    "start": "1651440",
    "end": "1657600"
  },
  {
    "text": "get the identity of the user back from is4 as part of that token i'm also returning the",
    "start": "1657600",
    "end": "1663600"
  },
  {
    "text": "the name of the user as part of the response right so pretty standard stuff",
    "start": "1663600",
    "end": "1669279"
  },
  {
    "text": "let's have a look at blazer and if you played with it you know that you",
    "start": "1669279",
    "end": "1674320"
  },
  {
    "text": "call uh there's a this default page called the fetch data that i will call this api uh",
    "start": "1674320",
    "end": "1679760"
  },
  {
    "text": "since the api is protected i felt that it was a good to protect also this page with the authorized",
    "start": "1679760",
    "end": "1684960"
  },
  {
    "text": "attribute i'm injecting an http client and all i do to populate",
    "start": "1684960",
    "end": "1690240"
  },
  {
    "text": "this page is making this call here in which i'm just getting i'm just calling the the get",
    "start": "1690240",
    "end": "1696799"
  },
  {
    "text": "endpoint that i'm supposed exposing here right so i'm not dealing with any type of authentication whatsoever",
    "start": "1696799",
    "end": "1703600"
  },
  {
    "text": "in this particular page everything will be configured in the program.cs file so what do we",
    "start": "1703600",
    "end": "1710559"
  },
  {
    "text": "need to do here well first of all we need to say that we want to request also the weather api scope",
    "start": "1710559",
    "end": "1718640"
  },
  {
    "text": "as part of the as part of the default scopes that uh",
    "start": "1718640",
    "end": "1725520"
  },
  {
    "text": "their api as part of the default scopes and then i needed to configure the http",
    "start": "1725520",
    "end": "1732559"
  },
  {
    "text": "client that i'm going to use in my fetch data right i need to make sure that i can inject an http client",
    "start": "1732559",
    "end": "1739840"
  },
  {
    "text": "in this page how do i do that uh well uh there's a i can register and uh via hdr in fact i",
    "start": "1739840",
    "end": "1747919"
  },
  {
    "text": "http client factory uh this weather api client naming client whose base address is this one",
    "start": "1747919",
    "end": "1753760"
  },
  {
    "text": "and then the idea is that i'm going to register also as a single tone this is",
    "start": "1753760",
    "end": "1760240"
  },
  {
    "text": "pretty much the equivalent thing of the same yeah listening here um so every time",
    "start": "1760240",
    "end": "1766640"
  },
  {
    "text": "uh someone asks for an http client i just return the client from weather api that's",
    "start": "1766640",
    "end": "1772960"
  },
  {
    "text": "really it and then the last bit is configuring this client to uh in order to request automatically",
    "start": "1772960",
    "end": "1780399"
  },
  {
    "text": "this access token when uh when when invoked and we can do that by this add the http",
    "start": "1780399",
    "end": "1787760"
  },
  {
    "text": "message handler method and here we're configuring this authorization message handler",
    "start": "1787760",
    "end": "1792880"
  },
  {
    "text": "and what we're saying is basically that every time we hit a an end point uh whose domain",
    "start": "1792880",
    "end": "1799520"
  },
  {
    "text": "is a localhost 5002 which is my api localhost this is this message handler needs to",
    "start": "1799520",
    "end": "1806000"
  },
  {
    "text": "make sure that there's a weather api access token embedded in the request",
    "start": "1806000",
    "end": "1811760"
  },
  {
    "text": "right cool let's hope that everything works and see it in action",
    "start": "1811760",
    "end": "1818159"
  },
  {
    "text": "so let me just switch to multiple startup projects and i can",
    "start": "1818159",
    "end": "1824960"
  },
  {
    "text": "finally do a control f5 and launch this",
    "start": "1824960",
    "end": "1830320"
  },
  {
    "text": "right so is4 has started the api has started and as you can see it's returning me a 401",
    "start": "1830799",
    "end": "1837760"
  },
  {
    "text": "because i'm not authorized to access this endpoint just by get i need to include obviously an access token to it",
    "start": "1837760",
    "end": "1844720"
  },
  {
    "text": "let me close a few tabs here um and if i go to blazer and i hit the",
    "start": "1844720",
    "end": "1850799"
  },
  {
    "text": "login button let's log in this time with that as alice i hit login and i get asked",
    "start": "1850799",
    "end": "1858320"
  },
  {
    "text": "for the consent over my weather api scope as well i hit yes",
    "start": "1858320",
    "end": "1864960"
  },
  {
    "text": "and let's have a look at what happens uh during the call so if i go to fetch",
    "start": "1864960",
    "end": "1870799"
  },
  {
    "text": "data effectively can get the data back as you can see",
    "start": "1870799",
    "end": "1876240"
  },
  {
    "text": "uh the api was capable of recognizing uh alice smith and if we look at the at the request here at",
    "start": "1876240",
    "end": "1882320"
  },
  {
    "text": "the bottom as you can see there's this better token which has been automatically added to the header of",
    "start": "1882320",
    "end": "1888159"
  },
  {
    "text": "that request and the content of this better token is something we're gonna easily explore with a",
    "start": "1888159",
    "end": "1893279"
  },
  {
    "text": "website like jot.ms and as you can see is uh alice smith for an audience of weather",
    "start": "1893279",
    "end": "1899440"
  },
  {
    "text": "api so that's why why the api is recognizing it and it's issued by our identity server and it has",
    "start": "1899440",
    "end": "1906000"
  },
  {
    "text": "a scope of weather behind it right cool so we've already achieved a lot uh",
    "start": "1906000",
    "end": "1914080"
  },
  {
    "start": "1909000",
    "end": "2027000"
  },
  {
    "text": "in 35 minutes but we can do more and uh so let's go back to these slides one sec",
    "start": "1914080",
    "end": "1921120"
  },
  {
    "text": "because um obviously being able to call an api it's interesting uh especially a secure api",
    "start": "1921120",
    "end": "1928799"
  },
  {
    "text": "but any uh real world application will need something more than that and more specifically we need",
    "start": "1928799",
    "end": "1935039"
  },
  {
    "text": "to be able to differentiate between users so we want to assign some user we want",
    "start": "1935039",
    "end": "1941039"
  },
  {
    "text": "to define roles assign some users to some roles and restrict some part of",
    "start": "1941039",
    "end": "1946320"
  },
  {
    "text": "the application to only those people belonging to those roles right so what are roles in a",
    "start": "1946320",
    "end": "1953360"
  },
  {
    "text": "system like the one we have set up here well they have a slightly different",
    "start": "1953360",
    "end": "1959840"
  },
  {
    "text": "meaning depending on the standpoint we are looking at them from so for example from the point of view of",
    "start": "1959840",
    "end": "1966080"
  },
  {
    "text": "the identity provider identity server um a role is just like any other claim",
    "start": "1966080",
    "end": "1972399"
  },
  {
    "text": "okay so it's just a claim that we need to configure to be added to the either the id token or the access",
    "start": "1972399",
    "end": "1978080"
  },
  {
    "text": "token so that it can be consumed by the client application all right from the point of view of the",
    "start": "1978080",
    "end": "1983919"
  },
  {
    "text": "application it's a a very special type of claim because we have",
    "start": "1983919",
    "end": "1989519"
  },
  {
    "text": "some specific logic attached around it right and um",
    "start": "1989519",
    "end": "1996720"
  },
  {
    "text": "in the specifics here what happens is that we want to make sure that these roles are",
    "start": "1996720",
    "end": "2001919"
  },
  {
    "text": "recognized by the the framework so that i can say authorize all admin and there's a",
    "start": "2001919",
    "end": "2007840"
  },
  {
    "text": "there's a lot of work that is done automatically for me uh to check for that claim to be present",
    "start": "2007840",
    "end": "2013519"
  },
  {
    "text": "in in the claims principle and allow or prevent access to a given resource and",
    "start": "2013519",
    "end": "2018799"
  },
  {
    "text": "this is going to be pretty much the same both for the client application for for the blazer application or the",
    "start": "2018799",
    "end": "2024799"
  },
  {
    "text": "web api application right cool so let's have a look at uh how we can implement this and",
    "start": "2024799",
    "end": "2032720"
  },
  {
    "start": "2027000",
    "end": "2324000"
  },
  {
    "text": "in order to do that i need to do a couple of things so first of all i need to close these running applications here",
    "start": "2032720",
    "end": "2039039"
  },
  {
    "text": "uh let's go back to visual studio and i need to switch to a different branch",
    "start": "2039039",
    "end": "2044399"
  },
  {
    "text": "um so let me go to changes here let's comment this and go to branches",
    "start": "2044399",
    "end": "2051118"
  },
  {
    "text": "and let's go to roles here all right so again let's have a look at what we",
    "start": "2051119",
    "end": "2058878"
  },
  {
    "text": "need to do in the three components of a of our solution here and start with the with identity server",
    "start": "2058879",
    "end": "2066560"
  },
  {
    "text": "well if we look at the startup in identity server we are basically using asp.net identity under",
    "start": "2066560",
    "end": "2073839"
  },
  {
    "text": "the hood and the sportsman's identity already contains a logic to fetch um some roles",
    "start": "2073839",
    "end": "2081040"
  },
  {
    "text": "from the uh from the database uh if uh if these roles are present and it turns out that um in the demo",
    "start": "2081040",
    "end": "2088079"
  },
  {
    "text": "database that i have here let me just retrieve this",
    "start": "2088079",
    "end": "2093440"
  },
  {
    "text": "open the database here and if we run this query as you can see i've",
    "start": "2093919",
    "end": "2099520"
  },
  {
    "text": "already added alice to the user role and bob to the admin and user role",
    "start": "2099520",
    "end": "2105680"
  },
  {
    "text": "right so especially identity will already fetch",
    "start": "2105680",
    "end": "2111440"
  },
  {
    "text": "these roles for me but all i need to do then at this point is a configuring is4 in order to return them as part of",
    "start": "2111440",
    "end": "2118640"
  },
  {
    "text": "the uh two types of types of tokens that we can release the id token and the access token how do we",
    "start": "2118640",
    "end": "2124240"
  },
  {
    "text": "do that well we need to configure them as a as a resource uh here in uh in this",
    "start": "2124240",
    "end": "2132240"
  },
  {
    "text": "particular property here and we have a couple of options either we can define a specific bespoke",
    "start": "2132240",
    "end": "2138800"
  },
  {
    "text": "identity resource for the roles the entity resource is basically just a name a name for the scope and a set of claims",
    "start": "2138800",
    "end": "2146240"
  },
  {
    "text": "that we want to add to it or probably better let's just modify this identity",
    "start": "2146240",
    "end": "2153200"
  },
  {
    "text": "resources profile this predefined set of claims that we associated to the profile",
    "start": "2153200",
    "end": "2158320"
  },
  {
    "text": "to include also these this role claim so that we don't have to request a specific",
    "start": "2158320",
    "end": "2163520"
  },
  {
    "text": "scope to in order to get the roles from the client so what i've done is just uh creating this class called",
    "start": "2163520",
    "end": "2170400"
  },
  {
    "text": "the profile with the role identity resource this class is basically just inheriting from from the default",
    "start": "2170400",
    "end": "2178000"
  },
  {
    "text": "uh identity resources profile and i'm adding the role scope to it right",
    "start": "2178000",
    "end": "2185119"
  },
  {
    "text": "a very similar thing is what i've done here in the this api results i've just added that i want the role claim to be added",
    "start": "2185119",
    "end": "2192960"
  },
  {
    "text": "to it as well and then for uh the find configuration",
    "start": "2192960",
    "end": "2198240"
  },
  {
    "text": "it's absolutely the same thing i don't have to touch anything else let's go to the weather api and here in",
    "start": "2198240",
    "end": "2205680"
  },
  {
    "text": "the weather api again no changes in the configuration whatsoever nothing to do here the only thing i've",
    "start": "2205680",
    "end": "2211920"
  },
  {
    "text": "done is that in my weather controller i'm now restricting the capability of calling this endpoint",
    "start": "2211920",
    "end": "2218560"
  },
  {
    "text": "only to uh bob bestly only to those those users who belong to the admin uh",
    "start": "2218560",
    "end": "2224000"
  },
  {
    "text": "to the admin role right what do we need to do in blazer instead well let's have a look so first of all",
    "start": "2224000",
    "end": "2231599"
  },
  {
    "text": "well in the counter page i've said that a user can access the counter page and uh um same goes for the",
    "start": "2231599",
    "end": "2240559"
  },
  {
    "text": "that's the data page uh here i'm saying that only admins can add it there's no point uh there's no reason",
    "start": "2240960",
    "end": "2246960"
  },
  {
    "text": "for a for normal user to access this page because they want to be able to call uh to call the api",
    "start": "2246960",
    "end": "2252400"
  },
  {
    "text": "uh what about the configuration well all i need to do is specifying that i want to use",
    "start": "2252400",
    "end": "2259280"
  },
  {
    "text": "the claim type role as the role claim and that's really it i don't have to do",
    "start": "2259280",
    "end": "2264720"
  },
  {
    "text": "really anything else so let's see if all of this works so let's do controller 5",
    "start": "2264720",
    "end": "2272160"
  },
  {
    "text": "and launch the application so i'm now not authenticated i log in as",
    "start": "2272160",
    "end": "2278720"
  },
  {
    "text": "alice alice if you remember is a user just a user is not an admin if i say yes",
    "start": "2278720",
    "end": "2285440"
  },
  {
    "text": "i can go to the counter page now perfectly works um if i go to fetch data",
    "start": "2285440",
    "end": "2291520"
  },
  {
    "text": "i see sorry you're not authorized oh and by the way this is interesting uh i slightly changed the routing as",
    "start": "2291520",
    "end": "2297440"
  },
  {
    "text": "well because uh obviously if i'm not authorized and i just",
    "start": "2297440",
    "end": "2305119"
  },
  {
    "text": "blindly redirected the user to the login i would have been stuck in an endless redirect loop here right",
    "start": "2305119",
    "end": "2311440"
  },
  {
    "text": "so i check if the user is authenticated only if it's not authenticated i redirect him to the login otherwise i",
    "start": "2311440",
    "end": "2318800"
  },
  {
    "text": "just display this mess this message saying that you're not authorized to access the resource",
    "start": "2318800",
    "end": "2323920"
  },
  {
    "text": "cool uh okay fine seems to be working let me log out and log in as bob and see",
    "start": "2323920",
    "end": "2330000"
  },
  {
    "start": "2324000",
    "end": "2562000"
  },
  {
    "text": "what happens with bob so i have this user here if login",
    "start": "2330000",
    "end": "2336160"
  },
  {
    "text": "yes go to fetch data done you're not authorized and i'm not even",
    "start": "2336160",
    "end": "2343119"
  },
  {
    "text": "authorized to access the counter page what the heck is going on here",
    "start": "2343119",
    "end": "2348560"
  },
  {
    "text": "so let's look at the claims this is a claims page that i've set up and as you can see it seems to be uh",
    "start": "2348560",
    "end": "2355920"
  },
  {
    "text": "everything seems to be okay so i have my two roles user and admin as as bob smith here and they are coming",
    "start": "2355920",
    "end": "2362560"
  },
  {
    "text": "from as i said from the object that sits uh here in ydc client so this is the",
    "start": "2362560",
    "end": "2370079"
  },
  {
    "text": "counterpart of the claims principle that sits in this client and as you can see i have my array of roles here right user and admin",
    "start": "2370079",
    "end": "2378079"
  },
  {
    "text": "so everything seems to be working correctly why is blazer not recognizing it well it",
    "start": "2378079",
    "end": "2384720"
  },
  {
    "text": "turns out that unfortunately there's a bizarre behavior that blazer has when",
    "start": "2384720",
    "end": "2390560"
  },
  {
    "text": "a claim is an array like what we have here it is basically just grabbing the string",
    "start": "2390560",
    "end": "2397599"
  },
  {
    "text": "representation of the array and it's creating a uh a corresponding claim role claim in the uh",
    "start": "2397599",
    "end": "2405920"
  },
  {
    "text": "claims principle object with that string representation and this obviously doesn't work with the authorized attributes that i put here and there",
    "start": "2405920",
    "end": "2412240"
  },
  {
    "text": "right so we need to basically in order for this to work we need to modify the component of blazer that transforms",
    "start": "2412240",
    "end": "2419680"
  },
  {
    "text": "the user that exists exists in the odc client into the claims principle and",
    "start": "2419680",
    "end": "2428000"
  },
  {
    "text": "the way we do it is uh by adding a custom account claims",
    "start": "2428000",
    "end": "2435440"
  },
  {
    "text": "principle factory so this is the the object that performs the transformation between",
    "start": "2435440",
    "end": "2440960"
  },
  {
    "text": "the java javascript word and dot network and i have created a an implementation of it called the array",
    "start": "2440960",
    "end": "2447839"
  },
  {
    "text": "claims principle factory all the remote user ops remote user",
    "start": "2447839",
    "end": "2453280"
  },
  {
    "text": "account and if we go and have a look at this class here",
    "start": "2453280",
    "end": "2460960"
  },
  {
    "text": "um it's relatively simple so it just inherits from the default account claims principle factory",
    "start": "2461599",
    "end": "2468880"
  },
  {
    "text": "right and overrides this create user sync by calling the base implementation right so",
    "start": "2468880",
    "end": "2476079"
  },
  {
    "text": "uh what i get out of this of this call is basically a flames principle hope you can see it",
    "start": "2476079",
    "end": "2484720"
  },
  {
    "text": "but then what i do is that i iterate over the over this dictionary over all the",
    "start": "2484720",
    "end": "2491040"
  },
  {
    "text": "properties of the object in javascript and for each of them i check whether the",
    "start": "2491040",
    "end": "2497440"
  },
  {
    "text": "object is a either let's see let's remove this it's i it's",
    "start": "2497440",
    "end": "2503440"
  },
  {
    "text": "a a json element and it's an array and in case it is uh like for example for the role claim i",
    "start": "2503440",
    "end": "2510400"
  },
  {
    "text": "remove this role claim and i add two separate claims",
    "start": "2510400",
    "end": "2515920"
  },
  {
    "text": "one for each value right so in a nutshell it's perhaps easier to watch it in action",
    "start": "2515920",
    "end": "2521520"
  },
  {
    "text": "than just explaining it if i launch this again and i login again as",
    "start": "2521520",
    "end": "2529200"
  },
  {
    "text": "bob bob smith what happens is that now my claims are",
    "start": "2529200",
    "end": "2535040"
  },
  {
    "text": "like this right and this is a what allows the authorized attribute",
    "start": "2535040",
    "end": "2540480"
  },
  {
    "text": "to work uh correctly and also the um the call to the weather api service okay",
    "start": "2540480",
    "end": "2547280"
  },
  {
    "text": "so uh it all works pretty much seamlessly uh we needed to just a tweak a little",
    "start": "2547280",
    "end": "2552800"
  },
  {
    "text": "bit the way this uh um json object it gets deserialized into a claims principle",
    "start": "2552800",
    "end": "2558000"
  },
  {
    "text": "otherwise it's pretty it it's pretty simple cool let's go back",
    "start": "2558000",
    "end": "2564240"
  },
  {
    "start": "2562000",
    "end": "2884000"
  },
  {
    "text": "to the slides because there's a one thing i really don't like about roles so i i",
    "start": "2564240",
    "end": "2571040"
  },
  {
    "text": "tend to avoid using roles as my as the way i uh",
    "start": "2571040",
    "end": "2577200"
  },
  {
    "text": "model the authorization from a form for my application because there are some some drawbacks if you do",
    "start": "2577200",
    "end": "2583200"
  },
  {
    "text": "that well first of all uh as you as you know if you've done it uh already well it's very easy to get",
    "start": "2583200",
    "end": "2590720"
  },
  {
    "text": "your roles as uh end up scattered across the entire the entire code base so if you have a",
    "start": "2590720",
    "end": "2596160"
  },
  {
    "text": "a web an api for example with a hundred different endpoints you're most likely",
    "start": "2596160",
    "end": "2601839"
  },
  {
    "text": "gonna have a hundred authorized attribute with role equals to admini overall equals to uh user and uh",
    "start": "2601839",
    "end": "2609440"
  },
  {
    "text": "if i ask you okay what will can you give me the list over the end points uh that a user can call or an admin can",
    "start": "2609440",
    "end": "2615359"
  },
  {
    "text": "call the only way you can do it is going through your entire code base there's no holistic view of what a user",
    "start": "2615359",
    "end": "2621040"
  },
  {
    "text": "can do depending on its role and this is annoying the consequence of this is that refactoring permissions",
    "start": "2621040",
    "end": "2627599"
  },
  {
    "text": "is incredibly hard the moment i ask you to add a super user which role which sits kind",
    "start": "2627599",
    "end": "2634160"
  },
  {
    "text": "of in the middle between a user and an admin good luck with that you probably will need to change",
    "start": "2634160",
    "end": "2640240"
  },
  {
    "text": "dozens of files right simply because uh again you have these roles scattered uh everywhere and",
    "start": "2640240",
    "end": "2647839"
  },
  {
    "text": "this always leads to inconsistencies like i don't know for example end points that",
    "start": "2647839",
    "end": "2653359"
  },
  {
    "text": "can be called by users but not by admins that's bizarre but i bet that it has happened to",
    "start": "2653359",
    "end": "2659839"
  },
  {
    "text": "any of you pretty much once unless so yeah it's just annoying the other thing",
    "start": "2659839",
    "end": "2665440"
  },
  {
    "text": "is that usually you want also the front end to react to the roles that a user belongs to",
    "start": "2665440",
    "end": "2670960"
  },
  {
    "text": "in order to perhaps hide or display some parts of the application enable or disable some buttons and",
    "start": "2670960",
    "end": "2677599"
  },
  {
    "text": "it's not easy to do that i mean the the only thing that you can do is duplicating the logic",
    "start": "2677599",
    "end": "2682880"
  },
  {
    "text": "uh on the front-end side pretty much like we did in the simple example two minutes ago right so the first data",
    "start": "2682880",
    "end": "2688240"
  },
  {
    "text": "endpoint can only be called by admins so there's an authorized admin uh put on",
    "start": "2688240",
    "end": "2693280"
  },
  {
    "text": "on the back inside and need to put another authorized ad pin on front-end side doesn't there's no",
    "start": "2693280",
    "end": "2698720"
  },
  {
    "text": "other way to do that right so can we do better than this i think we can",
    "start": "2698720",
    "end": "2704000"
  },
  {
    "text": "uh because well it would be difficult to do to do any worse than that and uh i've just released a package",
    "start": "2704000",
    "end": "2711839"
  },
  {
    "text": "in um in nuget that uh simplifies this task right it's called the",
    "start": "2711839",
    "end": "2717960"
  },
  {
    "text": "desk.asp.net core permissions it's still in a very uh rough state because i i literally",
    "start": "2717960",
    "end": "2723359"
  },
  {
    "text": "rushed it to the nougat gallery uh before this talk uh but uh you can also download the",
    "start": "2723359",
    "end": "2730800"
  },
  {
    "text": "source code uh in my github account and um yeah i've used it in production in a",
    "start": "2730800",
    "end": "2737200"
  },
  {
    "text": "number of different uh real world applications so it kind of uh it works and it's inspired by a",
    "start": "2737200",
    "end": "2746240"
  },
  {
    "text": "policy server which is a commercial product made by the same company responsible over identity server",
    "start": "2746240",
    "end": "2752480"
  },
  {
    "text": "um there's a in this github link there's a kind of a proof of concept of",
    "start": "2752480",
    "end": "2758319"
  },
  {
    "text": "a local version of policy server i think that my implementation is even lighter but yeah it does it",
    "start": "2758319",
    "end": "2764480"
  },
  {
    "text": "it does its job uh how does it work well first of all we start from a",
    "start": "2764480",
    "end": "2771440"
  },
  {
    "text": "centralized place where we can describe our functional permissions and this could be",
    "start": "2771440",
    "end": "2776640"
  },
  {
    "text": "either my app settings file or my separate file right in which i have my permissions",
    "start": "2776640",
    "end": "2782400"
  },
  {
    "text": "sections and i define things such as for example can let passengers",
    "start": "2782400",
    "end": "2787680"
  },
  {
    "text": "board an airplane and you can only do it if you are either the captain the first officer or a cabin crew member",
    "start": "2787680",
    "end": "2794720"
  },
  {
    "text": "or oh sorry there's a spelling mistake here and you can fly an airplane uh obviously you need to be either a",
    "start": "2794720",
    "end": "2802000"
  },
  {
    "text": "captain or first officer as a role and you can also add additional uh claims to this permission here for",
    "start": "2802000",
    "end": "2807839"
  },
  {
    "text": "example blood alcohol level equals to zero or in the case of uh our examples i can",
    "start": "2807839",
    "end": "2813119"
  },
  {
    "text": "just say can see forecasts are all equal to admin all right something like that now the library will automatically",
    "start": "2813119",
    "end": "2820319"
  },
  {
    "text": "create policies out of this configuration so that i can just say that the",
    "start": "2820319",
    "end": "2826160"
  },
  {
    "text": "get endpoint for weather forecast is going to be authorized only to people who can see a forecast and the",
    "start": "2826160",
    "end": "2832560"
  },
  {
    "text": "same goes up to the uh to the front-end side so that uh",
    "start": "2832560",
    "end": "2837680"
  },
  {
    "text": "either in blazer and in or in the api i just refer to the abstract permission",
    "start": "2837680",
    "end": "2845280"
  },
  {
    "text": "i have here and the moment i need to refactor that permission i i do it in a centralized place all",
    "start": "2845280",
    "end": "2851119"
  },
  {
    "text": "right i don't have to uh modify different files or different locations on my source code both in the",
    "start": "2851119",
    "end": "2856559"
  },
  {
    "text": "front end and in the back end for example uh the other good thing is that the module also exposes a slash my",
    "start": "2856559",
    "end": "2864640"
  },
  {
    "text": "permissions endpoint you call it with an access token and it will return the permissions that",
    "start": "2864640",
    "end": "2871760"
  },
  {
    "text": "uh that user is entitled to uh and you can use those permissions to hide or show",
    "start": "2871760",
    "end": "2876800"
  },
  {
    "text": "uh pieces of the user interface right so let's see this in action",
    "start": "2876800",
    "end": "2884079"
  },
  {
    "start": "2884000",
    "end": "2924000"
  },
  {
    "text": "uh cool so let's go back to the uh to the solution here and as usually i mean as usual i need to",
    "start": "2884079",
    "end": "2890720"
  },
  {
    "text": "um close all the running instances here and",
    "start": "2890720",
    "end": "2898319"
  },
  {
    "text": "move to a different branch so in explorer",
    "start": "2898319",
    "end": "2906480"
  },
  {
    "text": "changes and let me reject those changes",
    "start": "2906480",
    "end": "2911040"
  },
  {
    "text": "here reject those changes and let's go to",
    "start": "2912839",
    "end": "2918160"
  },
  {
    "text": "this permissions branch okay so",
    "start": "2918160",
    "end": "2924559"
  },
  {
    "start": "2924000",
    "end": "2959000"
  },
  {
    "text": "what do we have here let's start with the as usual with the identity server",
    "start": "2924559",
    "end": "2929920"
  },
  {
    "text": "and if i go to my config page here i don't have any changes whatsoever compared to",
    "start": "2929920",
    "end": "2935520"
  },
  {
    "text": "what we had before and this is because rules are an application kind of concept so is4 just",
    "start": "2935520",
    "end": "2942720"
  },
  {
    "text": "will return me uh sorry permissions are an application kind of concept uh is4 will just return me",
    "start": "2942720",
    "end": "2949520"
  },
  {
    "text": "my roles and that's it right and i will be responsible of mapping them to my abstract permissions my functional",
    "start": "2949520",
    "end": "2955599"
  },
  {
    "text": "permissions so no changes whatsoever on s4 if i go to my weather api",
    "start": "2955599",
    "end": "2961920"
  },
  {
    "start": "2959000",
    "end": "2989000"
  },
  {
    "text": "what i've done here is that in my well first of all i got that this permissions dot json file right",
    "start": "2961920",
    "end": "2969040"
  },
  {
    "text": "where i have nc forecast can use counter right mapped it to uh the relevant rules and",
    "start": "2969040",
    "end": "2975040"
  },
  {
    "text": "uh i've added it as a separate file i could have embedded it to the upsettings.json",
    "start": "2975040",
    "end": "2980079"
  },
  {
    "text": "the way i did it it's just adding this additional configuration file right again you can just use one single",
    "start": "2980079",
    "end": "2986400"
  },
  {
    "text": "file i just prefer to have it separately um and then in my startup",
    "start": "2986400",
    "end": "2993200"
  },
  {
    "start": "2989000",
    "end": "3034000"
  },
  {
    "text": "class what i've done is just adding calling this method add permission policies which comes from",
    "start": "2993200",
    "end": "2999200"
  },
  {
    "text": "from that unit package and since we also have a middleware i've also added",
    "start": "2999200",
    "end": "3004319"
  },
  {
    "text": "this my permissions middleware that's really it and thanks to that i can now go in my",
    "start": "3004319",
    "end": "3011680"
  },
  {
    "text": "forecast controller and say that this action is perhaps only allowed to those who can see a",
    "start": "3011680",
    "end": "3017119"
  },
  {
    "text": "forecast right and if we look at the overload that i'm using yeah this is",
    "start": "3017119",
    "end": "3024720"
  },
  {
    "text": "using uh the policy overload right so i'm uh the module will automatically create the",
    "start": "3024720",
    "end": "3030559"
  },
  {
    "text": "relevant policies for me based on on that file cool",
    "start": "3030559",
    "end": "3036240"
  },
  {
    "start": "3034000",
    "end": "3119000"
  },
  {
    "text": "let's go and have a look at the blazer what happens in blazer so first of all if i go to my",
    "start": "3036240",
    "end": "3043760"
  },
  {
    "text": "counter page i have a authorized can use counter and same goes for to my",
    "start": "3043760",
    "end": "3050559"
  },
  {
    "text": "patch data page right authorize can see forecast right so i'm reusing the same permissions that i have",
    "start": "3050559",
    "end": "3055920"
  },
  {
    "text": "in the back end also in the front end and the nice thing that i can do thanks to that",
    "start": "3055920",
    "end": "3061760"
  },
  {
    "text": "is that um i can now go to for example my menu page my menu component so the the thing",
    "start": "3061760",
    "end": "3068559"
  },
  {
    "text": "that displays all my links on the left hand side of the page and here as you can see i'm i've added a",
    "start": "3068559",
    "end": "3076079"
  },
  {
    "text": "couple of authorized views here and here that will just that will add the",
    "start": "3076079",
    "end": "3084240"
  },
  {
    "text": "um links to those menus only if the person is",
    "start": "3084240",
    "end": "3091119"
  },
  {
    "text": "has the right permission right so again i i hope you appreciate it that there's no duplication of",
    "start": "3091119",
    "end": "3098240"
  },
  {
    "text": "authorization logic here i just define what uh those those permissions as a",
    "start": "3098240",
    "end": "3104640"
  },
  {
    "text": "combination of claims these are issued and managed by the back-end api",
    "start": "3104640",
    "end": "3110400"
  },
  {
    "text": "and i just use these names these permission names as a the authorization policies for",
    "start": "3110400",
    "end": "3116960"
  },
  {
    "text": "various parts of my ui right what do i need to do also in blazer for this for this entire",
    "start": "3116960",
    "end": "3124480"
  },
  {
    "start": "3119000",
    "end": "3189000"
  },
  {
    "text": "thing to work well i need to first of all",
    "start": "3124480",
    "end": "3129839"
  },
  {
    "text": "um add a custom authorization policy provider this is",
    "start": "3129839",
    "end": "3135839"
  },
  {
    "text": "basically what blazer uses when it sees something like this",
    "start": "3135839",
    "end": "3141760"
  },
  {
    "text": "policy can use counter okay how how is it can use counter defined and this is basically done by this",
    "start": "3141760",
    "end": "3149119"
  },
  {
    "text": "implementation here permission policy provider and if we look at this implementation what i",
    "start": "3149119",
    "end": "3155200"
  },
  {
    "text": "have here is uh that i just look for a specific claim a special claim called",
    "start": "3155200",
    "end": "3161119"
  },
  {
    "text": "permission in my claims principle okay i'm just returning so give me the policy name can use",
    "start": "3161119",
    "end": "3166880"
  },
  {
    "text": "counter i just return an authorization policy builder which is satisfied only when",
    "start": "3166880",
    "end": "3172319"
  },
  {
    "text": "i have a permission called uh can use counter in my claims principle right and how does this permission claim",
    "start": "3172319",
    "end": "3180400"
  },
  {
    "text": "end up in the claims principle well this is done by um do you remember the",
    "start": "3180400",
    "end": "3188880"
  },
  {
    "text": "custom array claims principle factory that we had created before so if we go and have a look at this now",
    "start": "3188880",
    "end": "3195520"
  },
  {
    "start": "3189000",
    "end": "3224000"
  },
  {
    "text": "i have this additional uh logic here right this is a",
    "start": "3195520",
    "end": "3201119"
  },
  {
    "text": "piece of code here in which i'm calling the weather api and more specifically i'm calling the my",
    "start": "3201119",
    "end": "3207200"
  },
  {
    "text": "permissions endpoint of the weather api and then i'm just",
    "start": "3207200",
    "end": "3212319"
  },
  {
    "text": "this will return me an array of strings which are all the permissions i have as a user and i will just add a",
    "start": "3212319",
    "end": "3218800"
  },
  {
    "text": "permission claim for each one of them to the claims principle okay simple as that so let's let's see it in",
    "start": "3218800",
    "end": "3225359"
  },
  {
    "text": "action so i do control f5 launch the application",
    "start": "3225359",
    "end": "3230960"
  },
  {
    "text": "and let me close some of these tabs as you",
    "start": "3234839",
    "end": "3240000"
  },
  {
    "text": "can see i don't have a the link to uh call the counter page",
    "start": "3240000",
    "end": "3247200"
  },
  {
    "text": "or the fetch data page simply because i'm not uh i'm not authorized to them i can",
    "start": "3247200",
    "end": "3253520"
  },
  {
    "text": "obviously go there by typing your the url and in that case there's a",
    "start": "3253520",
    "end": "3259280"
  },
  {
    "text": "routing that prevents me to see seeing this page but again it's a better user user experience that i'm not seeing",
    "start": "3259280",
    "end": "3265040"
  },
  {
    "text": "these links if i'm not authorized to see them uh okay then i can login as a let's",
    "start": "3265040",
    "end": "3270720"
  },
  {
    "text": "login as a alice first uh right",
    "start": "3270720",
    "end": "3276480"
  },
  {
    "text": "so i need to do this here let's login as alice",
    "start": "3276480",
    "end": "3285200"
  },
  {
    "text": "okay and moment i login as alice see the counter page link to the counter",
    "start": "3286319",
    "end": "3292880"
  },
  {
    "text": "page i don't see the link to the fetch data page because if i go and have a look at my permissions",
    "start": "3292880",
    "end": "3298799"
  },
  {
    "text": "this is the permission i've retrieved from from the backend only can use counter right and this is",
    "start": "3298799",
    "end": "3304640"
  },
  {
    "text": "also added as a this is obviously added as a claim to my uh my um principle obviously again i can go",
    "start": "3304640",
    "end": "3311839"
  },
  {
    "text": "manually to fetch data and in that case i will see sorry you're not authorized",
    "start": "3311839",
    "end": "3317440"
  },
  {
    "text": "right so i'm still protected it's just a better user user experience from user i log out and i now log in",
    "start": "3317440",
    "end": "3325280"
  },
  {
    "text": "again as a bob who's an admin",
    "start": "3325280",
    "end": "3330160"
  },
  {
    "text": "i now see both links because uh uh i have both missions and i can go to",
    "start": "3331599",
    "end": "3338319"
  },
  {
    "text": "fetch data and see my uh see my weather forecasts okay because i'm entitled to see them",
    "start": "3338319",
    "end": "3345200"
  },
  {
    "text": "right cool um guys i think the time is pretty",
    "start": "3345200",
    "end": "3350240"
  },
  {
    "text": "much over and uh um so this is uh all i had to uh show you uh",
    "start": "3350240",
    "end": "3357440"
  },
  {
    "text": "for the these uh uh these subjects um yeah there are some uh",
    "start": "3357440",
    "end": "3363440"
  },
  {
    "text": "some additional info on my on my blog so you can go there and i leave in a couple of articles there are",
    "start": "3363440",
    "end": "3368960"
  },
  {
    "text": "more coming soon so follow me on twitter uh if you want to be notified when uh",
    "start": "3368960",
    "end": "3374160"
  },
  {
    "text": "when i release these new articles um yeah just a a big big big thank you",
    "start": "3374160",
    "end": "3379680"
  },
  {
    "text": "for having spent this hour together with me uh and yeah uh this is the github link",
    "start": "3379680",
    "end": "3384960"
  },
  {
    "text": "where you can download the demos i will post it on on slack as well",
    "start": "3384960",
    "end": "3390160"
  },
  {
    "text": "for your benefits so yeah if you have any questions feel free to open your mic and ask",
    "start": "3390160",
    "end": "3405838"
  },
  {
    "text": "you",
    "start": "3406319",
    "end": "3408400"
  }
]