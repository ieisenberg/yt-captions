[
  {
    "text": "are back inside of kubernetes so kind of a journey of what it is why it matters",
    "start": "0",
    "end": "6240"
  },
  {
    "text": "um I am the CTO and co-founder of a company called ksoc uh you can guess what the k",
    "start": "6240",
    "end": "11460"
  },
  {
    "text": "stands for I have been using kubernetes in production since 0.8 which is my",
    "start": "11460",
    "end": "18119"
  },
  {
    "text": "stamp of approval or disapproval so spend some time in this ecosystem learn",
    "start": "18119",
    "end": "23580"
  },
  {
    "text": "some things and hopefully we can share those today so let's Dive Right In",
    "start": "23580",
    "end": "30900"
  },
  {
    "text": "so uh brief agenda we're gonna kind of cover the basics what is kubernetes in a",
    "start": "30900",
    "end": "37079"
  },
  {
    "text": "single slide does anybody use kubernetes here look at that okay I'm sorry for your",
    "start": "37079",
    "end": "43920"
  },
  {
    "text": "loss uh so um anybody actually dealing with our back day to",
    "start": "43920",
    "end": "49739"
  },
  {
    "text": "day trying to build a system in their place of work around authenticating",
    "start": "49739",
    "end": "54840"
  },
  {
    "text": "users do we have to do that yeah a little bit you just cluster admin good to go okay",
    "start": "54840",
    "end": "60960"
  },
  {
    "text": "um so we're going to talk about what kubernetes is and why identity matters right that's kind of the buzzword uh",
    "start": "60960",
    "end": "67740"
  },
  {
    "text": "we'll probably say the word zero trust one time so you can check it off your buzzword bingo card and uh also expand",
    "start": "67740",
    "end": "75360"
  },
  {
    "text": "on the our back terminology right there's a lot going on under the hood when you run Cube CTL get pods all",
    "start": "75360",
    "end": "82380"
  },
  {
    "text": "namespaces right we're going to go through that flow how it works we're going to tie it back into authentication",
    "start": "82380",
    "end": "87960"
  },
  {
    "text": "because that matters too right proving you are who you said you are and then what you are allowed to do in the",
    "start": "87960",
    "end": "93600"
  },
  {
    "text": "cluster some of the built-ins gotchas and then how do we make our back better",
    "start": "93600",
    "end": "98939"
  },
  {
    "text": "right that's the end of the journey is to kind of level up your our back program in your organization and if you",
    "start": "98939",
    "end": "105840"
  },
  {
    "text": "like slides and and you're on your laptop and you like also clicking random",
    "start": "105840",
    "end": "111720"
  },
  {
    "text": "shortened links you can go view the slides as we go at tinyurl.com ndc-kates",
    "start": "111720",
    "end": "120659"
  },
  {
    "text": "if you wish um or not so",
    "start": "120780",
    "end": "126000"
  },
  {
    "text": "we kind of know everybody raised their hand what kubernetes is Right container orchestration system it does a lot more",
    "start": "126000",
    "end": "133500"
  },
  {
    "text": "these days we are approaching 1.26 or so as the latest release it's been around",
    "start": "133500",
    "end": "139620"
  },
  {
    "text": "since 2014 2013 in open source land and it's",
    "start": "139620",
    "end": "145860"
  },
  {
    "text": "used everywhere we have managed kubernetes we have on-prem kubernetes we talked about yesterday I worked with a",
    "start": "145860",
    "end": "152580"
  },
  {
    "text": "customer that runs kubernetes nodes in fake rocks and they use it to monitor",
    "start": "152580",
    "end": "159140"
  },
  {
    "text": "the weather and eavesdrop on people out in the desert so you can use kubernetes",
    "start": "159140",
    "end": "164580"
  },
  {
    "text": "for just about anything today's Focus obviously is our back and that stands",
    "start": "164580",
    "end": "170160"
  },
  {
    "text": "for what role-based Access Control right so this is a very special thing in kubernetes",
    "start": "170160",
    "end": "177540"
  },
  {
    "text": "our back as a concept has existed for forever but today we're going to talk about kubernetes are back",
    "start": "177540",
    "end": "184500"
  },
  {
    "text": "um so identity is the new perimeter right so who you are matters when I started using",
    "start": "184500",
    "end": "192180"
  },
  {
    "text": "kubernetes in 2015 we only created one",
    "start": "192180",
    "end": "197340"
  },
  {
    "text": "user cluster Dash admin and we would share that user in uh not great ways with the",
    "start": "197340",
    "end": "204480"
  },
  {
    "text": "rest of the Ops Team why is that bad right because I don't know who's doing what at any given moment in the cluster",
    "start": "204480",
    "end": "211260"
  },
  {
    "text": "and kubernetes is a very complicated system it's the new Cloud right you can",
    "start": "211260",
    "end": "216540"
  },
  {
    "text": "list Secrets store secrets you can create workloads you can actually kind",
    "start": "216540",
    "end": "221700"
  },
  {
    "text": "of pivot if you wish outside of the cluster context and get access to AWS",
    "start": "221700",
    "end": "227400"
  },
  {
    "text": "for example so it's not good to share identities in general in the year 2023",
    "start": "227400",
    "end": "232620"
  },
  {
    "text": "it's really bad if you do it inside of kubernetes and we'll talk about why so we come into the cluster we have an",
    "start": "232620",
    "end": "240060"
  },
  {
    "text": "identity token something that we've proven we're authenticated and allowed to be there then what happens right",
    "start": "240060",
    "end": "246120"
  },
  {
    "text": "that's the flow we're going to discuss today so the",
    "start": "246120",
    "end": "251700"
  },
  {
    "text": "um Steve here is actually going to give a talk later on a new project we've been working on for the past six months",
    "start": "251700",
    "end": "257959"
  },
  {
    "text": "through the owasp organization and I just want to outline it is number three",
    "start": "257959",
    "end": "263160"
  },
  {
    "text": "overly permissive our back configurations right in this new owasp top 10 rendition just for kubernetes",
    "start": "263160",
    "end": "270600"
  },
  {
    "text": "this is a big deal it has uh serious ramifications and we see this happening",
    "start": "270600",
    "end": "277080"
  },
  {
    "text": "in the what like issues happening out in the world during engagements all the time and they always lead back to our",
    "start": "277080",
    "end": "284220"
  },
  {
    "text": "back being overly permissive so here's the flow",
    "start": "284220",
    "end": "291540"
  },
  {
    "text": "of a request right have we used Cube CTL before followed some tutorial Cube CTL get pods",
    "start": "291540",
    "end": "298860"
  },
  {
    "text": "all namespaces create a pod things like that right Cube CTL is the CLI utility",
    "start": "298860",
    "end": "305699"
  },
  {
    "text": "we use to interact with kubernetes but really you can talk to kubernetes",
    "start": "305699",
    "end": "310740"
  },
  {
    "text": "through a variety of different ways right we can talk to kubernetes Via a",
    "start": "310740",
    "end": "315780"
  },
  {
    "text": "service account these are special tokens in the form of secrets that you present to the API",
    "start": "315780",
    "end": "321180"
  },
  {
    "text": "server and usually from the inside of the cluster to ask to do things right",
    "start": "321180",
    "end": "326699"
  },
  {
    "text": "they're headless users and we've used service count tokens for years kubernetes is no different we can use",
    "start": "326699",
    "end": "332340"
  },
  {
    "text": "them inside or outside and then we have different clients and all sorts of you know you can use Curl if you wish to",
    "start": "332340",
    "end": "339300"
  },
  {
    "text": "interact with kubernetes so it doesn't really matter how you get there what matters is this flow in the middle so",
    "start": "339300",
    "end": "344820"
  },
  {
    "text": "you have our API server this is a very special component inside of kubernetes",
    "start": "344820",
    "end": "350039"
  },
  {
    "text": "right first step who are you are you supposed to be here are you a valid user you can use AWS IAM you can use",
    "start": "350039",
    "end": "358380"
  },
  {
    "text": "hard-coded tokens you can use OCTA there's a variety of ways to actually",
    "start": "358380",
    "end": "364759"
  },
  {
    "text": "validate that this is an authenticated legitimate user The Next Step which is",
    "start": "364759",
    "end": "373080"
  },
  {
    "text": "more the our back focus is what can you do right so it's one thing to say I'm",
    "start": "373080",
    "end": "379199"
  },
  {
    "text": "here I'm allowed to make a request to the API it's another thing to actually put the pieces together and say Jimmy is",
    "start": "379199",
    "end": "386940"
  },
  {
    "text": "allowed to get a specific pod in a specific namespace or List secrets in",
    "start": "386940",
    "end": "392819"
  },
  {
    "text": "the cube system namespace these are objects and these are verbs right and then admission control which we won't",
    "start": "392819",
    "end": "398699"
  },
  {
    "text": "really discuss too much today is are there policies or some sort of governance around this request",
    "start": "398699",
    "end": "404880"
  },
  {
    "text": "and then things happen magic kubernetes uh uh you know fairy dust sprinkles and",
    "start": "404880",
    "end": "411240"
  },
  {
    "text": "then your your workload is uh scheduled on a node so what does our back do",
    "start": "411240",
    "end": "417840"
  },
  {
    "text": "per the oauth top 10 enables fine-grained access for users groups and service accounts within kubernetes that",
    "start": "417840",
    "end": "424380"
  },
  {
    "text": "can be extremely difficult to scope appropriately right which is why we're spending time talking about it today",
    "start": "424380",
    "end": "430919"
  },
  {
    "text": "so what does that really mean so you have kind of three key players or batches of um of kind of objects that",
    "start": "430919",
    "end": "438600"
  },
  {
    "text": "we're dealing with when we build an rbac policy first one user is pretty simple me Jimmy ksoc.com or Jenkins right",
    "start": "438600",
    "end": "447960"
  },
  {
    "text": "Jenkins would be an example of a service account maybe that's running inside of the cluster that needs to talk to the",
    "start": "447960",
    "end": "453720"
  },
  {
    "text": "API and then API resources right there's a great command Cube CTL uh API",
    "start": "453720",
    "end": "460560"
  },
  {
    "text": "resources Dash o y that prints out everything to the screen you could possibly want to see when it comes to",
    "start": "460560",
    "end": "467880"
  },
  {
    "text": "the resources available in your cluster these are pods Secrets Services Etc and",
    "start": "467880",
    "end": "473160"
  },
  {
    "text": "then operations HTTP verbs essentially right git list",
    "start": "473160",
    "end": "478680"
  },
  {
    "text": "delete patch etc etc when you create an rbac policy you're just having some combination",
    "start": "478680",
    "end": "485460"
  },
  {
    "text": "combination of these together to give a user or service account the authorization to perform that particular",
    "start": "485460",
    "end": "493259"
  },
  {
    "text": "task so the terminology rolls cluster rolls roll bindings",
    "start": "493259",
    "end": "499800"
  },
  {
    "text": "cluster roll bindings what you will notice in kubernetes is there is no Cube CTL get users doesn't exist kubernetes",
    "start": "499800",
    "end": "507539"
  },
  {
    "text": "doesn't care right it's a it's a bring your own authentication mechanism so what you are responsible for is making",
    "start": "507539",
    "end": "515039"
  },
  {
    "text": "those bindings work in a way that's usable for an end user but also least",
    "start": "515039",
    "end": "520919"
  },
  {
    "text": "permissive right and that's really really tricky right so um I'll kind of give some examples here",
    "start": "520919",
    "end": "527700"
  },
  {
    "text": "uh sorry for the yaml that's just the world we live in today so",
    "start": "527700",
    "end": "533880"
  },
  {
    "text": "first thing is a role right as defined by Our Kind at the Top This is a kubernetes object and we scope a role to",
    "start": "533880",
    "end": "541860"
  },
  {
    "text": "a namespace typically but the important thing here is down below these resources",
    "start": "541860",
    "end": "547680"
  },
  {
    "text": "right you're explicitly defining what is allowed you notice there's no deny here it's not uh that's not how our back",
    "start": "547680",
    "end": "554940"
  },
  {
    "text": "Works in kubernetes it's always an allow list and everything else is denied so you have verbs and resources and no",
    "start": "554940",
    "end": "562920"
  },
  {
    "text": "binding though right we have no use concept of a user yet here and we'll get into that in a second in this particular",
    "start": "562920",
    "end": "568800"
  },
  {
    "text": "role is used in the dev group one namespace cholesterol very similar except you can",
    "start": "568800",
    "end": "576480"
  },
  {
    "text": "guess that it's cluster wide right so this these two lines below also support",
    "start": "576480",
    "end": "583920"
  },
  {
    "text": "Stars what do stars do typically what is a star if I threw it",
    "start": "583920",
    "end": "589320"
  },
  {
    "text": "down in the resources block well everything right it's that's the",
    "start": "589320",
    "end": "596220"
  },
  {
    "text": "YOLO button right and you can put a star there and you will just have access to all resources right and and the single",
    "start": "596220",
    "end": "604200"
  },
  {
    "text": "quickest audit you can do in your cluster and we'll talk about how to do that in a second is just the presence of",
    "start": "604200",
    "end": "610560"
  },
  {
    "text": "a star right and that could possibly mean that somebody was a little lazy and didn't want to actually give the access",
    "start": "610560",
    "end": "617220"
  },
  {
    "text": "necessary so how do we actually take a user or a subject in kubernetes language and bind",
    "start": "617220",
    "end": "624240"
  },
  {
    "text": "it to that role or cluster role well role bindings and cluster role bindings right so you could see some unique",
    "start": "624240",
    "end": "631440"
  },
  {
    "text": "blocks here um yeah and I apologize if you didn't want to watch me talk about yaml at 10",
    "start": "631440",
    "end": "637680"
  },
  {
    "text": "30 in the morning but here we are um you can see some unique blocks here under subject right this user Jane",
    "start": "637680",
    "end": "644399"
  },
  {
    "text": "is allowed to read pods in the default namespace right so we take our subject",
    "start": "644399",
    "end": "649920"
  },
  {
    "text": "and our role reference down below and we tie those together this is The Binding",
    "start": "649920",
    "end": "656100"
  },
  {
    "text": "right it's very literal and we say this subject is now bound to this role that we just created previously and that",
    "start": "656100",
    "end": "663000"
  },
  {
    "text": "gives Jane access to do the thing that Jane needs to do right which is apparently reading pods in the default",
    "start": "663000",
    "end": "669300"
  },
  {
    "text": "namespace which is a problem in another way but that's okay and then cluster role",
    "start": "669300",
    "end": "674820"
  },
  {
    "text": "binding right so um this is just a cluster-wide scope so your job now as an operator or",
    "start": "674820",
    "end": "682140"
  },
  {
    "text": "security team is number one audit your cluster figure out what is running what our back exists",
    "start": "682140",
    "end": "688800"
  },
  {
    "text": "then number two make it better right and that's what we're going to kind of dive into for the rest of the the talk so",
    "start": "688800",
    "end": "697019"
  },
  {
    "text": "kubernetes out of the box and we see this all the time it comes with some what they call and Define as user-facing",
    "start": "697019",
    "end": "703260"
  },
  {
    "text": "cluster roles some of these are to be used as roles but that's a different story and",
    "start": "703260",
    "end": "709200"
  },
  {
    "text": "this is something kubernetes gives us and has been giving us for since the",
    "start": "709200",
    "end": "714240"
  },
  {
    "text": "beginning for us to use instead of the pain and suffering that is custom our",
    "start": "714240",
    "end": "719579"
  },
  {
    "text": "back right so the top one um probably the most commonly used",
    "start": "719579",
    "end": "725579"
  },
  {
    "text": "uh user-facing cluster role it's called cluster admin right this is uh this is",
    "start": "725579",
    "end": "731040"
  },
  {
    "text": "what you get if you've ever spun up a gke cluster or something in eks your",
    "start": "731040",
    "end": "736500"
  },
  {
    "text": "first experience of kubernetes is probably using cluster admin or something like it and as you can imagine",
    "start": "736500",
    "end": "742800"
  },
  {
    "text": "star star star star Stars there's uh Steve put it five star",
    "start": "742800",
    "end": "747959"
  },
  {
    "text": "review right and that's any resource at any time and the the that presents",
    "start": "747959",
    "end": "753600"
  },
  {
    "text": "problems for obvious reasons but that doesn't mean that the rest of these built-ins are exactly perfect oftentimes",
    "start": "753600",
    "end": "760560"
  },
  {
    "text": "we'll see folks giving developers admin access like they'll be placing every",
    "start": "760560",
    "end": "766260"
  },
  {
    "text": "developer in an organization potentially hundreds of developers who can access a single cluster as admin right but that's",
    "start": "766260",
    "end": "773639"
  },
  {
    "text": "that's read write access across namespaces and sometimes it gives you the ability to",
    "start": "773639",
    "end": "779880"
  },
  {
    "text": "actually alter cluster roles which is a whole different problem and then you can go down all the way to view right right",
    "start": "779880",
    "end": "785820"
  },
  {
    "text": "so we'll see why Vue is also dangerous in a second in the gotcha section but this is what kubernetes is going to",
    "start": "785820",
    "end": "791820"
  },
  {
    "text": "provide out of the box so here's a cluster role binding",
    "start": "791820",
    "end": "798779"
  },
  {
    "text": "um let's figure out what's wrong with this right again back to yaml and uh this is",
    "start": "798779",
    "end": "806459"
  },
  {
    "text": "an interesting one because it's combining some other configuration that is uh not so desirable so number one we",
    "start": "806459",
    "end": "814980"
  },
  {
    "text": "have some a single subject right a subject can be a service account a group",
    "start": "814980",
    "end": "820440"
  },
  {
    "text": "or just a user right as we saw with Jane in this case we're talking about a service account called default but it's",
    "start": "820440",
    "end": "826800"
  },
  {
    "text": "also in the default namespace that's interesting right so there's this token called a service account that's",
    "start": "826800",
    "end": "833399"
  },
  {
    "text": "just sitting in this namespace ready to be used pods can consume it present it to the API and authenticate to the",
    "start": "833399",
    "end": "840540"
  },
  {
    "text": "server the dangerous part happens below right your basically taking a static",
    "start": "840540",
    "end": "846839"
  },
  {
    "text": "token that lots of different workloads can use binding it to this lovely",
    "start": "846839",
    "end": "852860"
  },
  {
    "text": "cluster role called cluster Dash admin so Stars across the board you can access the cluster do whatever you want",
    "start": "852860",
    "end": "859860"
  },
  {
    "text": "the problem here is that you know the the appsec in the app SEC side of me",
    "start": "859860",
    "end": "866399"
  },
  {
    "text": "um you know always loves to try to find things like remote code execution or traversing through files or directories",
    "start": "866399",
    "end": "873180"
  },
  {
    "text": "server side request forgery so if you discover this token that's now sitting",
    "start": "873180",
    "end": "878579"
  },
  {
    "text": "there in your file system on your pod you can Replay that token to the kubernetes API and you are admin you can",
    "start": "878579",
    "end": "886800"
  },
  {
    "text": "do whatever you want right so it's a pretty dangerous thing and I'm not sure that the average uh security engineer",
    "start": "886800",
    "end": "894839"
  },
  {
    "text": "that's kind of just like scrolling through thousands of lines of yaml this wouldn't necessarily pop out to me at",
    "start": "894839",
    "end": "900959"
  },
  {
    "text": "least right so we have some tools out there that attempt to uh",
    "start": "900959",
    "end": "907760"
  },
  {
    "text": "visualize our back some work some don't that's okay right",
    "start": "907800",
    "end": "914579"
  },
  {
    "text": "this is a hard problem because there is no Cube CTL on it our back command like it doesn't exist so you end up with",
    "start": "914579",
    "end": "922019"
  },
  {
    "text": "somebody else's kind of representation of what our back should look like this tool rackous pretty good right it kind",
    "start": "922019",
    "end": "928680"
  },
  {
    "text": "of gives you green checks or red x's on who has access to what still doesn't say if it's good or bad it's up to you to",
    "start": "928680",
    "end": "935220"
  },
  {
    "text": "make that decision and then there's quite a few different visualization tools this one is called our back with a",
    "start": "935220",
    "end": "942899"
  },
  {
    "text": "K very clever and this is great if you're looking at a tiny little sliver",
    "start": "942899",
    "end": "948779"
  },
  {
    "text": "of the cluster but it becomes unusable untenable at a large scale but it is a",
    "start": "948779",
    "end": "954360"
  },
  {
    "text": "start right we can actually start to to view what's going on inside of the rbac landscape because it is such a problem",
    "start": "954360",
    "end": "961560"
  },
  {
    "text": "um we've built um a cluster uh role and role aggregation mechanism at ksoc as",
    "start": "961560",
    "end": "969120"
  },
  {
    "text": "part of our kind of of offering and it's our take on you know a visualization so the big problem is we don't have the",
    "start": "969120",
    "end": "976560"
  },
  {
    "text": "connective tissue in the single command so if you see down below we can actually say this service account can do these",
    "start": "976560",
    "end": "984360"
  },
  {
    "text": "things in this namespace or cluster wide in a single view which seems crazy that",
    "start": "984360",
    "end": "990240"
  },
  {
    "text": "that is a novel but it actually is inside of kubernetes are back",
    "start": "990240",
    "end": "996000"
  },
  {
    "text": "so within uh this is a really interesting uh submission actually to",
    "start": "996000",
    "end": "1003019"
  },
  {
    "text": "the owas top 10 that we had a few months ago the verbs themselves right that we",
    "start": "1003019",
    "end": "1009320"
  },
  {
    "text": "talked about get lists post delete these verbs that are supported by the API",
    "start": "1009320",
    "end": "1014720"
  },
  {
    "text": "server don't always do exactly what you think they should right and this actually came to a surprise to me when somebody",
    "start": "1014720",
    "end": "1021320"
  },
  {
    "text": "submitted this um and I'll show you why in a second but list and watch are two verbs that are",
    "start": "1021320",
    "end": "1027980"
  },
  {
    "text": "available they seem benign right if you've ever run Cube CTL",
    "start": "1027980",
    "end": "1033319"
  },
  {
    "text": "um watch on pods in a namespace right typically you're going to see the Pod",
    "start": "1033319",
    "end": "1038780"
  },
  {
    "text": "name and the status right how many containers within that pot are up and",
    "start": "1038780",
    "end": "1043819"
  },
  {
    "text": "that's it like that's what you would expect out of a watch style command but what we've learned is that's not",
    "start": "1043819",
    "end": "1050120"
  },
  {
    "text": "actually the case as you can see kind of alluded to into this redacted redacted",
    "start": "1050120",
    "end": "1055640"
  },
  {
    "text": "block down below and I'll show you that in a second so the the kind of example here is",
    "start": "1055640",
    "end": "1063740"
  },
  {
    "text": "using cubectl versus a curl Command right you like I said in the beginning you can interact with kubernetes pretty",
    "start": "1063740",
    "end": "1070400"
  },
  {
    "text": "much any way you want and when you use Cube CTL we have uh this example role with myself",
    "start": "1070400",
    "end": "1078080"
  },
  {
    "text": "service account Jimmy that is actually allowed to what list Secrets right that's the only permission",
    "start": "1078080",
    "end": "1085160"
  },
  {
    "text": "that Jimmy this service account has access to do a list in my mind",
    "start": "1085160",
    "end": "1091220"
  },
  {
    "text": "um maybe my mind is not correct should not expose the actual content of the",
    "start": "1091220",
    "end": "1096740"
  },
  {
    "text": "payload when it's returned back it should be a list of the name of each individual Secret in this case so you",
    "start": "1096740",
    "end": "1104179"
  },
  {
    "text": "can store kubernetes Secrets people do it all the time your cluster probably has secrets in it that you didn't",
    "start": "1104179",
    "end": "1109520"
  },
  {
    "text": "realize so that list command when you run Cube CTL lists Secret in XYZ namespace",
    "start": "1109520",
    "end": "1118220"
  },
  {
    "text": "really when you run Cube CTL only shows the name of the secret fine right that's",
    "start": "1118220",
    "end": "1123620"
  },
  {
    "text": "not a problem any old developer can have access to that so with this gentleman who contributed to the OAS project with",
    "start": "1123620",
    "end": "1131240"
  },
  {
    "text": "us has discovered is that all you have to do is run a curl command with that",
    "start": "1131240",
    "end": "1136460"
  },
  {
    "text": "same permission and it actually prints to the screen via I only have access to",
    "start": "1136460",
    "end": "1142640"
  },
  {
    "text": "list but it prints the secret key value plain text well base64 encoded does not",
    "start": "1142640",
    "end": "1149480"
  },
  {
    "text": "um a zero day that's not actually a vulnerability it's just how kubernetes works and these are the gotchas that",
    "start": "1149480",
    "end": "1156080"
  },
  {
    "text": "really like are causing problems in in kind of the greater our back ecosystem",
    "start": "1156080",
    "end": "1161840"
  },
  {
    "text": "we get how that works because it's pretty dangerous right a list dumps secrets to the screen right which is",
    "start": "1161840",
    "end": "1168140"
  },
  {
    "text": "really not the intention that should be a describe action so you can write policies in a variety",
    "start": "1168140",
    "end": "1176240"
  },
  {
    "text": "of different language languages to detect things like this it's not perfect this is kind of static",
    "start": "1176240",
    "end": "1182660"
  },
  {
    "text": "analysis of yaml but we have built rules along the lines of",
    "start": "1182660",
    "end": "1188840"
  },
  {
    "text": "um you know the title here right it's pretty self-explanatory minimize Wild Card use and roles and cluster roles",
    "start": "1188840",
    "end": "1194539"
  },
  {
    "text": "right that's a CIS Benchmark standard like you can start there and it's a",
    "start": "1194539",
    "end": "1201020"
  },
  {
    "text": "great start right so when you run that across a noisy large cluster you're",
    "start": "1201020",
    "end": "1207440"
  },
  {
    "text": "actually going to find that a lot of the tools that you don't own flux in this case or Argo CD or istio or",
    "start": "1207440",
    "end": "1215240"
  },
  {
    "text": "whatever it is pulled in our back and it needs access to crazy things maybe it needs it maybe",
    "start": "1215240",
    "end": "1221780"
  },
  {
    "text": "it doesn't and you're going to find your third parties are violating our back",
    "start": "1221780",
    "end": "1227780"
  },
  {
    "text": "best practice right so in this case you have a cluster role that flux has created and flux is just a",
    "start": "1227780",
    "end": "1235120"
  },
  {
    "text": "continuous delivery platform that runs in the cluster similar to Argo CD what",
    "start": "1235120",
    "end": "1240679"
  },
  {
    "text": "is this right that's ever I mean that's everything we don't call it cluster admin here but",
    "start": "1240679",
    "end": "1246080"
  },
  {
    "text": "it's it's five stars across the board it's the best review you can get so one",
    "start": "1246080",
    "end": "1251780"
  },
  {
    "text": "thing you can do and what what we use is we we use open policy agent there's actually a talk happening right now",
    "start": "1251780",
    "end": "1257720"
  },
  {
    "text": "um so I'm glad you're here on Opa and Rego um to kind of comb through the entire",
    "start": "1257720",
    "end": "1263780"
  },
  {
    "text": "landscape of the cluster right and you're going to surface things like this that you had no idea existed and some of",
    "start": "1263780",
    "end": "1270919"
  },
  {
    "text": "them are almost not fixable we don't really know what flux needs right but probably not this",
    "start": "1270919",
    "end": "1278120"
  },
  {
    "text": "so how do we make this a little better we have this concept of audit logs",
    "start": "1278120",
    "end": "1284059"
  },
  {
    "text": "inside of kubernetes Does anybody read these logs before",
    "start": "1284059",
    "end": "1290179"
  },
  {
    "text": "other than me they're actually really exciting right so the API server generates these rich",
    "start": "1290179",
    "end": "1298100"
  },
  {
    "text": "this Rich set of logs to tell you the exact story of every single request that's coming across the wire from the",
    "start": "1298100",
    "end": "1304760"
  },
  {
    "text": "API server itself and it you know which verb who did it when did it happen What IP address",
    "start": "1304760",
    "end": "1311059"
  },
  {
    "text": "um and where do most of these logs go in large organizations just straight to S3 never to be seen",
    "start": "1311059",
    "end": "1317419"
  },
  {
    "text": "again or they don't collect them at all so our recommendation is always use them",
    "start": "1317419",
    "end": "1323480"
  },
  {
    "text": "right you don't have to read every log but there's some really deep insight into who's doing what from an R back",
    "start": "1323480",
    "end": "1329659"
  },
  {
    "text": "perspective in that cluster and I know this is a little hard to see but this is what a log entry inside of",
    "start": "1329659",
    "end": "1338059"
  },
  {
    "text": "kubernetes would look like and again if you're running eks or AKs or some",
    "start": "1338059",
    "end": "1343820"
  },
  {
    "text": "sort of managed kubernetes like you just have to click a button and like you get this pretty much for free right you just",
    "start": "1343820",
    "end": "1349159"
  },
  {
    "text": "pay for storage so these logs um have some interesting data points",
    "start": "1349159",
    "end": "1354620"
  },
  {
    "text": "right we have an IP address we know where you came from yes it can be spoofed we know that but at least it's a",
    "start": "1354620",
    "end": "1360559"
  },
  {
    "text": "start we have the response status we have the user agent right we can see",
    "start": "1360559",
    "end": "1365600"
  },
  {
    "text": "that Jimmy is using an old version of cube CTL or he's hitting the kubernetes API with curl and that's weird or W get",
    "start": "1365600",
    "end": "1373220"
  },
  {
    "text": "or something odd and then down below is how we use these logs to make our our back story better and that's hard to see",
    "start": "1373220",
    "end": "1379820"
  },
  {
    "text": "but there's two lines here first one is the decision important allow or deny was this request allowed",
    "start": "1379820",
    "end": "1387020"
  },
  {
    "text": "through the rbac ecosystem or not and then the reason and I'm very thankful",
    "start": "1387020",
    "end": "1392419"
  },
  {
    "text": "that kubernetes decided to bundle this right they didn't probably have to do that but because of that reason we can",
    "start": "1392419",
    "end": "1398600"
  },
  {
    "text": "tie it back to existing policies that you have in place roles and cluster rules and things of that nature so you",
    "start": "1398600",
    "end": "1405200"
  },
  {
    "text": "can use your audit log in a variety of ways to do better our back across the board there's a tool that's gained some",
    "start": "1405200",
    "end": "1412700"
  },
  {
    "text": "traction over the years it's not highly maintained but it works called audit to our back down below and the the whole",
    "start": "1412700",
    "end": "1420260"
  },
  {
    "text": "premise here if you use auditar back or not there's a couple options is take this log file this giant set of logs and",
    "start": "1420260",
    "end": "1427880"
  },
  {
    "text": "then give me our back that fits with in the mold of what people are doing or",
    "start": "1427880",
    "end": "1433340"
  },
  {
    "text": "service accounts right so you can actually get to this point of least privilege",
    "start": "1433340",
    "end": "1438440"
  },
  {
    "text": "and there's new tools coming out in in that sort of space as well so let's talk about how authentication",
    "start": "1438440",
    "end": "1445240"
  },
  {
    "text": "ties into this do a time check",
    "start": "1445240",
    "end": "1449740"
  },
  {
    "text": "the the whole concept of authentication is usually handled solely outside of",
    "start": "1451120",
    "end": "1457460"
  },
  {
    "text": "kubernetes right and it still plays a role inside of the rbac uh kind of",
    "start": "1457460",
    "end": "1463940"
  },
  {
    "text": "decision decisioning engine but authentication itself is pretty complicated so bear with me lots of",
    "start": "1463940",
    "end": "1471380"
  },
  {
    "text": "boxes lots of lines um I'm going to walk through who here's use eks before",
    "start": "1471380",
    "end": "1478159"
  },
  {
    "text": "Yeah couple people that's that's aws's managed kubernetes service right so if",
    "start": "1478159",
    "end": "1483740"
  },
  {
    "text": "you run eks a bunch of magic happens and all of a sudden you well after pain there's magic",
    "start": "1483740",
    "end": "1490159"
  },
  {
    "text": "but there is Magic that happens where you can access the cluster using your",
    "start": "1490159",
    "end": "1495320"
  },
  {
    "text": "IAM credentials right this is how you authenticate inside of of AWS and it was",
    "start": "1495320",
    "end": "1500480"
  },
  {
    "text": "always kind of like no one talks about how we got there right there's some stuff that needs to happen and it's",
    "start": "1500480",
    "end": "1505760"
  },
  {
    "text": "worth discussing because it ties directly into our back right so again we have our different types of users you",
    "start": "1505760",
    "end": "1512299"
  },
  {
    "text": "know Origins if you will of a request to the API server and when you're using",
    "start": "1512299",
    "end": "1517460"
  },
  {
    "text": "something like eks um it that actually ties into IIM",
    "start": "1517460",
    "end": "1523580"
  },
  {
    "text": "there's some interesting components that have to make some elevated calls if you will gke is the same AKs is the same in",
    "start": "1523580",
    "end": "1531080"
  },
  {
    "text": "some degree they all work like this right so I come in Cube CTL lists",
    "start": "1531080",
    "end": "1537320"
  },
  {
    "text": "secrets I'm Jimmy I authenticated to AWS and I'm going to pass that IAM token",
    "start": "1537320",
    "end": "1543559"
  },
  {
    "text": "along with my desired requests like list Secrets the API server then bounces that",
    "start": "1543559",
    "end": "1550220"
  },
  {
    "text": "to this special AWS IM authenticator server right and it talks to AWS IM",
    "start": "1550220",
    "end": "1557179"
  },
  {
    "text": "which means it has access to AWS which is a different part of your threat model and then we get an identity back but",
    "start": "1557179",
    "end": "1564140"
  },
  {
    "text": "kubernetes doesn't speak AWS it doesn't care it doesn't understand what an AWS",
    "start": "1564140",
    "end": "1569299"
  },
  {
    "text": "identity is we have to translate that I am identity to a subject right like we saw in our",
    "start": "1569299",
    "end": "1577640"
  },
  {
    "text": "cluster role bindings we have subjects that can be groups and that's typically what you use here or just individual",
    "start": "1577640",
    "end": "1583940"
  },
  {
    "text": "users and then we have this special AWS config map that sits in the r cluster",
    "start": "1583940",
    "end": "1590179"
  },
  {
    "text": "that maintains the state and only then can we take that subject combine it back",
    "start": "1590179",
    "end": "1595220"
  },
  {
    "text": "with our action that we wanted and then our back kicks in right and it's going to say yeah you can do that",
    "start": "1595220",
    "end": "1601100"
  },
  {
    "text": "so every request you make to kubernetes is going to go through this flow which is you know not something you would see",
    "start": "1601100",
    "end": "1608960"
  },
  {
    "text": "and this is how it all ties together right so there's other pieces of our back that",
    "start": "1608960",
    "end": "1615500"
  },
  {
    "text": "make it this is I know this is a wall of text but we'll go through it in a second that make it complicated right",
    "start": "1615500",
    "end": "1622580"
  },
  {
    "text": "when I think of misconfigured our back it's not typically some ins Rogue Insider that's part of",
    "start": "1622580",
    "end": "1629360"
  },
  {
    "text": "the threat right I have some sort of engineer that just went crazy one day",
    "start": "1629360",
    "end": "1634640"
  },
  {
    "text": "and he wants to just kind of smash the keyboard and steal some things what we see happening is a vulnerable",
    "start": "1634640",
    "end": "1642140"
  },
  {
    "text": "workload right there's there's a web app flaw remote code execution as I mentioned before somebody steals a",
    "start": "1642140",
    "end": "1648320"
  },
  {
    "text": "service count token somebody checks in their Cube config into GitHub and it's",
    "start": "1648320",
    "end": "1653960"
  },
  {
    "text": "public for some reason like those are the kind of things we have to worry about and if you're running kubernetes inside",
    "start": "1653960",
    "end": "1659900"
  },
  {
    "text": "of a cloud provider there's a chance that it's publicly accessible right we found last year",
    "start": "1659900",
    "end": "1665840"
  },
  {
    "text": "through a showdance search that there were like 950 000 publicly accessible kubernetes apis that's just like one day",
    "start": "1665840",
    "end": "1673279"
  },
  {
    "text": "of scanning right that's not that's not even the full picture so you have to harden the cluster from a more holistic",
    "start": "1673279",
    "end": "1679880"
  },
  {
    "text": "perspective and our back is one piece right so privilege mode we have all sorts of",
    "start": "1679880",
    "end": "1685039"
  },
  {
    "text": "configuration around volume mounts who is that container running as and do you",
    "start": "1685039",
    "end": "1690380"
  },
  {
    "text": "have any policies in place whether it's the deprecated pod security policies open policy agent or something of that",
    "start": "1690380",
    "end": "1697400"
  },
  {
    "text": "nature is there anything stopping bad things from entering the cluster how do you store Secrets right because our back",
    "start": "1697400",
    "end": "1705380"
  },
  {
    "text": "if you can list Secrets or you can steal a token that can get to the API and it has Secrets capability",
    "start": "1705380",
    "end": "1712600"
  },
  {
    "text": "you can dump the secrets and do what you will with them and then least privilege right we talked about a few ways to",
    "start": "1712600",
    "end": "1719120"
  },
  {
    "text": "handle lease privilege but you know step one look for wild cards step two put",
    "start": "1719120",
    "end": "1724640"
  },
  {
    "text": "some admission control in place check your logs use groups appropriately Etc and then networking networking kind",
    "start": "1724640",
    "end": "1731720"
  },
  {
    "text": "of plays into our back as well pod a maybe it shouldn't be allowed to talk to pod B so we can use things like",
    "start": "1731720",
    "end": "1737360"
  },
  {
    "text": "Network policies to actually enforce that and uh where are you sending your audit",
    "start": "1737360",
    "end": "1743000"
  },
  {
    "text": "logs this is an area that's vastly underserved there's really not a",
    "start": "1743000",
    "end": "1749299"
  },
  {
    "text": "good anomaly detection approach out there in open source or commercially",
    "start": "1749299",
    "end": "1754340"
  },
  {
    "text": "that takes these Auto logs and surfaces real insights about who's talking to the cluster from Inside and Out imagine a",
    "start": "1754340",
    "end": "1761659"
  },
  {
    "text": "world where you can have an alert that says we just noticed a service account token called Jenkins is coming from a",
    "start": "1761659",
    "end": "1769159"
  },
  {
    "text": "public IP address and accessing your kubernetes API that from an IP you don't even recognize",
    "start": "1769159",
    "end": "1775880"
  },
  {
    "text": "that could be a huge problem that's full cluster compromise right and then inventory right so make sure to maintain",
    "start": "1775880",
    "end": "1783500"
  },
  {
    "text": "kind of an overall inventory of what's running in your cluster scan it for misconfigurations right",
    "start": "1783500",
    "end": "1790100"
  },
  {
    "text": "that's going to be talked about ad nauseam later and then have a plan of action to kind of Harden these things",
    "start": "1790100",
    "end": "1795740"
  },
  {
    "text": "right so um and there's also threat modeling I don't know if anybody here does proper threat modeling in their",
    "start": "1795740",
    "end": "1801860"
  },
  {
    "text": "day-to-day but there is a whole world of kubernetes specific threat modeling",
    "start": "1801860",
    "end": "1807200"
  },
  {
    "text": "exercises that you can perform where our back user access service account access actually has something has a big place",
    "start": "1807200",
    "end": "1815539"
  },
  {
    "text": "in that threat modeling exercise um so that's about it and and we're",
    "start": "1815539",
    "end": "1822620"
  },
  {
    "text": "going to I have time for questions um War Stories what have you if you",
    "start": "1822620",
    "end": "1828020"
  },
  {
    "text": "would like to uh talk Jimmy kstock.com or just gymnast on",
    "start": "1828020",
    "end": "1833899"
  },
  {
    "text": "Twitter for those of us who are just still hanging out on Twitter I'm still there for some reason",
    "start": "1833899",
    "end": "1839720"
  },
  {
    "text": "um yeah so thanks for coming and hopefully you found that useful we'll see you around the conference",
    "start": "1839720",
    "end": "1845500"
  },
  {
    "text": "[Applause] any questions",
    "start": "1847200",
    "end": "1853640"
  },
  {
    "text": "yeah",
    "start": "1853640",
    "end": "1856120"
  },
  {
    "text": "Secrets or all kind of objects it's a great question does does",
    "start": "1862419",
    "end": "1868760"
  },
  {
    "text": "this example only apply to Secrets right so you know again",
    "start": "1868760",
    "end": "1875179"
  },
  {
    "text": "it no it applies to any object right secrets are impactful because they have",
    "start": "1875179",
    "end": "1881899"
  },
  {
    "text": "this items block right so I would say this this applies to everything secrets",
    "start": "1881899",
    "end": "1887659"
  },
  {
    "text": "are the top priority and then for me number two would be config Maps the same",
    "start": "1887659",
    "end": "1892760"
  },
  {
    "text": "behavior works with config maps and if you're not familiar that's how we store General configuration inside of",
    "start": "1892760",
    "end": "1898880"
  },
  {
    "text": "kubernetes but sometimes it can be sensitive so it would it would operate all the same for config Maps",
    "start": "1898880",
    "end": "1907360"
  },
  {
    "text": "any questions yeah",
    "start": "1907640",
    "end": "1911020"
  },
  {
    "text": "that's a great question so five five star five star review",
    "start": "1916820",
    "end": "1922279"
  },
  {
    "text": "um scope down to a namespace that is super common right you go most organizations that's where people start",
    "start": "1922279",
    "end": "1929240"
  },
  {
    "text": "like I'm a developer I can have unfettered access to my namespace",
    "start": "1929240",
    "end": "1934880"
  },
  {
    "text": "um I think it's an okay start I do I do think you can probably do better you",
    "start": "1934880",
    "end": "1940760"
  },
  {
    "text": "know but it's uh it's at least uh some namespaces for those who aren't familiar",
    "start": "1940760",
    "end": "1947840"
  },
  {
    "text": "are are an interesting concept where you you know kind of group different areas",
    "start": "1947840",
    "end": "1953120"
  },
  {
    "text": "of your cluster right like I have a development front end namespace and then development backend name space or",
    "start": "1953120",
    "end": "1959299"
  },
  {
    "text": "different team namespaces they don't offer real isolation from a network",
    "start": "1959299",
    "end": "1965299"
  },
  {
    "text": "perspective right that you know namespace a can talk to namespace B that's not a problem",
    "start": "1965299",
    "end": "1970399"
  },
  {
    "text": "from an rbac perspective they actually can so I think it's that's an okay start but you want to be careful of with stars",
    "start": "1970399",
    "end": "1977299"
  },
  {
    "text": "across the board you don't want to give people access to create other roles and role bindings right which is kind of",
    "start": "1977299",
    "end": "1983840"
  },
  {
    "text": "tricky right because you if you're a developer all of a sudden now you can create your own our back and maybe that",
    "start": "1983840",
    "end": "1990200"
  },
  {
    "text": "our back is elevated or it's given to a service account that you can",
    "start": "1990200",
    "end": "1995440"
  },
  {
    "text": "oh my countries get more absolutely you'll be able to create it in that",
    "start": "1995600",
    "end": "2001899"
  },
  {
    "text": "namespace a role which could be appropriate you know it just depends but",
    "start": "2001899",
    "end": "2007299"
  },
  {
    "text": "yeah star stars are uh I think they're they're okay if scope to name space as a starting point",
    "start": "2007299",
    "end": "2014760"
  },
  {
    "text": "anything else cool all right oh go",
    "start": "2014860",
    "end": "2021179"
  },
  {
    "text": "sh",
    "start": "2025419",
    "end": "2027539"
  },
  {
    "text": "um well",
    "start": "2030519",
    "end": "2036100"
  },
  {
    "text": "if you have access to Secrets I would first I would try to get out of",
    "start": "2036100",
    "end": "2041980"
  },
  {
    "text": "kubernetes right and and go straight to AWS for example and",
    "start": "2041980",
    "end": "2047620"
  },
  {
    "text": "oftentimes we see AWS credentials stored in the form of secrets in kubernetes",
    "start": "2047620",
    "end": "2053260"
  },
  {
    "text": "because people need to access the API or do some IM stuff so what I would do is",
    "start": "2053260",
    "end": "2060040"
  },
  {
    "text": "leave kubernetes at that point and hit an RDS database you'll probably find secrets to",
    "start": "2060040",
    "end": "2066339"
  },
  {
    "text": "some maybe even like a GitHub access token but a database credential would be",
    "start": "2066339",
    "end": "2072820"
  },
  {
    "text": "that would be pretty juicy right or you can you know I mean Secrets can vary wildly depending on on how you use them",
    "start": "2072820",
    "end": "2079839"
  },
  {
    "text": "so that's I would collect the secret find the target system and uh",
    "start": "2079839",
    "end": "2084878"
  },
  {
    "text": "leave kubernetes and go do more fun things that's a good question",
    "start": "2084879",
    "end": "2092440"
  },
  {
    "text": "anything else cool all right we'll see you around the conference thank you all for attending",
    "start": "2092440",
    "end": "2100000"
  },
  {
    "text": "and uh yeah feel free to pull me aside later if you want to talk kubernetes",
    "start": "2100000",
    "end": "2106080"
  },
  {
    "text": "foreign",
    "start": "2106119",
    "end": "2109119"
  }
]