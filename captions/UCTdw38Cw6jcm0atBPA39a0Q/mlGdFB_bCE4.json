[
  {
    "text": "anyway I'm Glenn we'll be talking about awesome Azure authentication Adventures",
    "start": "2820",
    "end": "9240"
  },
  {
    "text": "um if you are familiar with Azure ID app registrations client certificates or",
    "start": "9240",
    "end": "15000"
  },
  {
    "text": "client secrets um Microsoft web identity Library",
    "start": "15000",
    "end": "22260"
  },
  {
    "text": "um what else demon apps calling apis from other apis",
    "start": "22260",
    "end": "28019"
  },
  {
    "text": "getting focused if you're familiar with that you're in the wrong room so go find another route you'll be bored",
    "start": "28019",
    "end": "34920"
  },
  {
    "text": "if you don't know what those things are welcome we're gonna have fun I hope",
    "start": "34920",
    "end": "41160"
  },
  {
    "text": "so we're going to talk a little about Azure active directory we're going to talk about how to sign in users in a web app",
    "start": "41160",
    "end": "46800"
  },
  {
    "text": "calling apis from other web apps protecting the apis and we're going to touch on something called manage system",
    "start": "46800",
    "end": "52680"
  },
  {
    "text": "identity and we're all going to talk about demons we're going to level set a little bit",
    "start": "52680",
    "end": "59280"
  },
  {
    "text": "with some terms we need to um get in place for everyone to follow along does anyone know the difference",
    "start": "59280",
    "end": "66060"
  },
  {
    "text": "between authentication and authorization no offense you dares",
    "start": "66060",
    "end": "71340"
  },
  {
    "text": "you sir",
    "start": "71340",
    "end": "74000"
  },
  {
    "text": "excellent answer you win the chocolate",
    "start": "78500",
    "end": "83420"
  },
  {
    "text": "ah excellent answer so authentication is",
    "start": "85979",
    "end": "91920"
  },
  {
    "text": "identity saying I am me it is the when you walk up to the",
    "start": "91920",
    "end": "97500"
  },
  {
    "text": "bouncer at a club and he goes sorry sir you're not getting in here it's like yeah I'm on the VIP list really and you show me your idea",
    "start": "97500",
    "end": "104520"
  },
  {
    "text": "and he says oh you're actually that guy great go on in",
    "start": "104520",
    "end": "110399"
  },
  {
    "text": "otherwise when you you folks defrag 20 30 years ago when you used to go at the",
    "start": "110399",
    "end": "115619"
  },
  {
    "text": "clubs when you showed your idea to a bouncer he wouldn't care about your name he wouldn't care about your age",
    "start": "115619",
    "end": "122219"
  },
  {
    "text": "your date of birth on your driver's license or ID card your date of birth is what's called a claim",
    "start": "122219",
    "end": "129840"
  },
  {
    "text": "it is something your identity tokened your driver's license your ID thing",
    "start": "129840",
    "end": "137220"
  },
  {
    "text": "claims to be true by you date of birth so and so and every bouncer had to know in their",
    "start": "137220",
    "end": "143640"
  },
  {
    "text": "head if you were born before that day on that year and you're old enough and that's about the limit of the",
    "start": "143640",
    "end": "149040"
  },
  {
    "text": "intellectual level of a bouncer I can say that because it used to be what",
    "start": "149040",
    "end": "154620"
  },
  {
    "text": "so if your claim on your ID will look at the ideas like yeah that looks like you",
    "start": "154620",
    "end": "159660"
  },
  {
    "text": "you're authenticated picture matches pretty much",
    "start": "159660",
    "end": "164819"
  },
  {
    "text": "now let's authorize you to get into this club you are more than 18 or more than 21 or",
    "start": "164819",
    "end": "171180"
  },
  {
    "text": "whatever the age limit of that club was you are less than 30. and you're allowed to get in",
    "start": "171180",
    "end": "177659"
  },
  {
    "text": "that's the authorization part we're going to talk about both of these things",
    "start": "177659",
    "end": "183080"
  },
  {
    "text": "back then you use the driver's license in authentication for especially for the",
    "start": "183120",
    "end": "190200"
  },
  {
    "text": "web but also many other cases today we use something called Json web token",
    "start": "190200",
    "end": "195239"
  },
  {
    "text": "spelled JWT pronounced jart why is it pronounced jot because they",
    "start": "195239",
    "end": "201959"
  },
  {
    "text": "said so in the standard why nobody knows",
    "start": "201959",
    "end": "207659"
  },
  {
    "text": "at least I don't so a Json Webb token is a Json string",
    "start": "207659",
    "end": "214379"
  },
  {
    "text": "with claims that's all it really is and claims is like your date of birth",
    "start": "214379",
    "end": "220860"
  },
  {
    "text": "is a key and your actual date of birth is the value so it's a list of key value",
    "start": "220860",
    "end": "226019"
  },
  {
    "text": "pairs all of those key value pairs are claims",
    "start": "226019",
    "end": "232140"
  },
  {
    "text": "the Json web token the jot claims that these things are true about",
    "start": "232140",
    "end": "237659"
  },
  {
    "text": "this entity",
    "start": "237659",
    "end": "241879"
  },
  {
    "text": "today's web token contains two other parts it has a header",
    "start": "243060",
    "end": "248159"
  },
  {
    "text": "which has some information about the how the token is constructed",
    "start": "248159",
    "end": "254099"
  },
  {
    "text": "and it has a last part which is a signature anyone have a vague idea of how public",
    "start": "254099",
    "end": "261000"
  },
  {
    "text": "key encryption and signing works no they use it every day",
    "start": "261000",
    "end": "268620"
  },
  {
    "text": "you don't just don't know it every day you use public key encryption whenever you go to an https site",
    "start": "268620",
    "end": "274259"
  },
  {
    "text": "public private key encryption is on a way of encrypting messages where I have",
    "start": "274259",
    "end": "280259"
  },
  {
    "text": "a private key and a public key that are connected and anything that is encrypted with one",
    "start": "280259",
    "end": "285479"
  },
  {
    "text": "key can only be decrypted with the other key and one is public so I can publish that",
    "start": "285479",
    "end": "291780"
  },
  {
    "text": "the other one is private so I keep that private this is mine now everything I encrypt with my public",
    "start": "291780",
    "end": "299040"
  },
  {
    "text": "key or anyone else at Christmas public key can only be decrypt from a private key so that way people can send me stuff",
    "start": "299040",
    "end": "305699"
  },
  {
    "text": "that only I can read but I can do it the other way around I can encrypt something with my private",
    "start": "305699",
    "end": "312419"
  },
  {
    "text": "key and give you my public key that way you can decrypt it with my",
    "start": "312419",
    "end": "317639"
  },
  {
    "text": "public key and if you're confident that this is my actual public key you can be certain that that message came from me",
    "start": "317639",
    "end": "323280"
  },
  {
    "text": "and only me we use this for digital signatures",
    "start": "323280",
    "end": "328860"
  },
  {
    "text": "what we do in the jot is that we hash the jot the text the key value Pairs and",
    "start": "328860",
    "end": "334440"
  },
  {
    "text": "all that we run into the mathematics mathematical function",
    "start": "334440",
    "end": "339539"
  },
  {
    "text": "that creates a string and then we encrypt that with our private key",
    "start": "339539",
    "end": "346380"
  },
  {
    "text": "and then we attach that result at the bottom of the message",
    "start": "346380",
    "end": "351560"
  },
  {
    "text": "if I now publish my public key somewhere that you can reliably download it you",
    "start": "351560",
    "end": "356880"
  },
  {
    "text": "can verify that not only that this message came from me",
    "start": "356880",
    "end": "362039"
  },
  {
    "text": "because you will run it through the same hash which has as you specified in the header",
    "start": "362039",
    "end": "368520"
  },
  {
    "text": "and you can also in the header you can find the key or the a pointer to the key",
    "start": "368520",
    "end": "375000"
  },
  {
    "text": "and you can say okay I'll go there I'll download that key and I'll decrypt the hash I'll run the same hash",
    "start": "375000",
    "end": "382139"
  },
  {
    "text": "and I'll match those two up if those match I get this token I can be pretty",
    "start": "382139",
    "end": "389520"
  },
  {
    "text": "confident that this token came from the right Authority and has not been changed underway",
    "start": "389520",
    "end": "397080"
  },
  {
    "text": "this is what makes Json Webb tokens work there are a bunch of claims key value",
    "start": "397080",
    "end": "402780"
  },
  {
    "text": "pairs and I can reliably authenticate this token",
    "start": "402780",
    "end": "408960"
  },
  {
    "text": "with his issuer and or authority",
    "start": "408960",
    "end": "415440"
  },
  {
    "text": "and that has not been changed therefore I can we can use that from a trusted party can issue tokens to",
    "start": "415440",
    "end": "423720"
  },
  {
    "text": "users and the users can present these tokens to other people or other services",
    "start": "423720",
    "end": "430099"
  },
  {
    "text": "pretty much like a driver's license we look at a driver's license we tilt it see the magic little reflections",
    "start": "430740",
    "end": "437460"
  },
  {
    "text": "we have our own verification we don't use public keys and private keys in private because they involve huge",
    "start": "437460",
    "end": "443099"
  },
  {
    "text": "mathematical structures with primes and stuff like that so we don't do that but it's the same thing",
    "start": "443099",
    "end": "449819"
  },
  {
    "text": "this is the process that happens usually in a process like that",
    "start": "449819",
    "end": "455220"
  },
  {
    "text": "you navigate to some web application the web application redirects you in our",
    "start": "455220",
    "end": "461520"
  },
  {
    "text": "case to Azure ID Azure ID says hi who are you",
    "start": "461520",
    "end": "467699"
  },
  {
    "text": "when you type in your username and your password or Windows hello or in with your Fido key or whatever you",
    "start": "467699",
    "end": "473759"
  },
  {
    "text": "authentication methods you have approve on your phone all that stuff Azure ID now takes care of that that's where your",
    "start": "473759",
    "end": "480180"
  },
  {
    "text": "user is we will get to that it will return what's called an ID token",
    "start": "480180",
    "end": "487259"
  },
  {
    "text": "which is a Json token with some known parameters as a client",
    "start": "487259",
    "end": "494639"
  },
  {
    "text": "normally in well in the basic case my browser would now present this token",
    "start": "494639",
    "end": "500940"
  },
  {
    "text": "to whatever website I'm trying to get into and this website is familiar with Azure",
    "start": "500940",
    "end": "507780"
  },
  {
    "text": "ID we've hooked it up earlier so it can go to Azure ID and download",
    "start": "507780",
    "end": "513240"
  },
  {
    "text": "the current keys it can verify the signature and it can verify",
    "start": "513240",
    "end": "520080"
  },
  {
    "text": "different fields or claims and it can allow or deny me access to",
    "start": "520080",
    "end": "525899"
  },
  {
    "text": "what I'm trying to do it can verify who I am or it can deny",
    "start": "525899",
    "end": "531899"
  },
  {
    "text": "me Services based on my claims so how does this work in practice",
    "start": "531899",
    "end": "540500"
  },
  {
    "text": "let's look at that let me see",
    "start": "540779",
    "end": "547399"
  },
  {
    "text": "not done with that one so this is we could do all of this just",
    "start": "549200",
    "end": "556920"
  },
  {
    "text": "using HTTP client just constructing requests going back and forth but luckily we live in a modern world and we",
    "start": "556920",
    "end": "562620"
  },
  {
    "text": "don't have to so let's make this a little bit bigger",
    "start": "562620",
    "end": "569959"
  },
  {
    "text": "we're going to use a library called Microsoft identity.web",
    "start": "572820",
    "end": "579480"
  },
  {
    "text": "in this case there are several libraries for doing this kind of stuff this is based on two",
    "start": "579480",
    "end": "585600"
  },
  {
    "text": "standards open ID connect and oauth 2. they overlap a little bit but this",
    "start": "585600",
    "end": "592800"
  },
  {
    "text": "basically one of them is identification one of them is granting access different services",
    "start": "592800",
    "end": "598320"
  },
  {
    "text": "there are libraries for these for every single platform in the world",
    "start": "598320",
    "end": "604100"
  },
  {
    "text": "if you're using asp.net which I'm going to be using in these demos I'll be using a",
    "start": "604500",
    "end": "610560"
  },
  {
    "text": "Library called Microsoft identity web which handles this stuff but is also tailored specifically for Azure ID",
    "start": "610560",
    "end": "618980"
  },
  {
    "text": "so Azure ID let's before we move on let's talk about Azure ad Azure ad Azure active director he's familiar with that",
    "start": "619560",
    "end": "626519"
  },
  {
    "text": "well good chance he went in this talk then so just to make sure everyone's on the",
    "start": "626519",
    "end": "632100"
  },
  {
    "text": "same page Azure ID is uh is called where you have a directory it is a directory",
    "start": "632100",
    "end": "638040"
  },
  {
    "text": "of objects users is one object machines are a different accounts service principles",
    "start": "638040",
    "end": "644100"
  },
  {
    "text": "can be other objects groups all that stuff it's a list of your users more or less",
    "start": "644100",
    "end": "650339"
  },
  {
    "text": "each directory in Azure ad can be connected to one or more",
    "start": "650339",
    "end": "656519"
  },
  {
    "text": "subscriptions which is where you have your resources there you have your web",
    "start": "656519",
    "end": "661980"
  },
  {
    "text": "sites your functions your VMS your databases whatever they are all in functions and they're further grouped",
    "start": "661980",
    "end": "667860"
  },
  {
    "text": "into resource groups and all that the directory is also called a tenant",
    "start": "667860",
    "end": "673800"
  },
  {
    "text": "a user will only exist in one tenant but can be granted access in other",
    "start": "673800",
    "end": "679860"
  },
  {
    "text": "tenants one company we usually have one directory and one tenant",
    "start": "679860",
    "end": "685500"
  },
  {
    "text": "or they're the same thing if you have more than that you're probably the result of a merger or",
    "start": "685500",
    "end": "692100"
  },
  {
    "text": "something like that and you're in for a world of pain",
    "start": "692100",
    "end": "697100"
  },
  {
    "text": "now in my tenant I can",
    "start": "700140",
    "end": "707600"
  },
  {
    "text": "register apps here I am in the Azure portal",
    "start": "707640",
    "end": "713760"
  },
  {
    "text": "and I've registered a couple of apps here because we can't just go",
    "start": "713760",
    "end": "719220"
  },
  {
    "text": "put up a web page and start authenticated user willy-nilly and start get grabbing claims every now there has to be some kind of order structure to",
    "start": "719220",
    "end": "725100"
  },
  {
    "text": "this so the first one you have to do is that we have to register an application in my",
    "start": "725100",
    "end": "730740"
  },
  {
    "text": "Azure ad tenant I've registered some here let me just show you how this works",
    "start": "730740",
    "end": "737700"
  },
  {
    "text": "new registration a name demo",
    "start": "737700",
    "end": "743160"
  },
  {
    "text": "I can figure I can say who can use this are you okay in the back you didn't get",
    "start": "743160",
    "end": "748740"
  },
  {
    "text": "a chance to check before I started yeah thumbs up who can use this accounts in this",
    "start": "748740",
    "end": "754860"
  },
  {
    "text": "directory only which is called sandcastle in any Azure directory",
    "start": "754860",
    "end": "760440"
  },
  {
    "text": "personal accounts whatever so you're saying what users are allowed to talk or",
    "start": "760440",
    "end": "766680"
  },
  {
    "text": "authenticate through this app registration I'm just going to pick users in my directory",
    "start": "766680",
    "end": "774800"
  },
  {
    "text": "let's skip that register there we go I've created an App",
    "start": "776160",
    "end": "782339"
  },
  {
    "text": "there's a couple one thing that is important here which is the application client ID",
    "start": "782339",
    "end": "789860"
  },
  {
    "text": "the application client ID is the username of this app it uniquely identifies this particular",
    "start": "790380",
    "end": "798000"
  },
  {
    "text": "app registration globally",
    "start": "798000",
    "end": "802220"
  },
  {
    "text": "so when I set up an application",
    "start": "804959",
    "end": "810740"
  },
  {
    "text": "to use Azure ID I have to put some information into my",
    "start": "811740",
    "end": "818339"
  },
  {
    "text": "web app now again I'm using Microsoft identity",
    "start": "818339",
    "end": "823680"
  },
  {
    "text": "web Library which assumes that I'll have a configuration setting called Azure ID",
    "start": "823680",
    "end": "830519"
  },
  {
    "text": "and I'll have some values here one of which is client ID",
    "start": "830519",
    "end": "836000"
  },
  {
    "text": "I also have tenant ID which is the ID of my directory my",
    "start": "836760",
    "end": "843420"
  },
  {
    "text": "tenant you'll find that on the same page as your app registration",
    "start": "843420",
    "end": "848760"
  },
  {
    "text": "here tenant ID I also need the domain for my app",
    "start": "848760",
    "end": "856019"
  },
  {
    "text": "which is sand castle in Norwegian Sunset dot on microsoft.com it if you have a",
    "start": "856019",
    "end": "862440"
  },
  {
    "text": "your own tenant you might have your own custom domain but normally you'll always have the whatever you call your domain",
    "start": "862440",
    "end": "868740"
  },
  {
    "text": "dot on microsoft.com that will always work and I have a callback path",
    "start": "868740",
    "end": "876380"
  },
  {
    "text": "remember the back and forth graph I send if I go with my browser I am sent to",
    "start": "876899",
    "end": "884339"
  },
  {
    "text": "azure ad and along with that",
    "start": "884339",
    "end": "890040"
  },
  {
    "text": "transfer I also have information about where to go next which is my redirect URL",
    "start": "890040",
    "end": "897060"
  },
  {
    "text": "in this case the slash sign in oidc which is a URL given it works on this",
    "start": "897060",
    "end": "902880"
  },
  {
    "text": "machine because of Microsoft web if we go back to Sandcastle and we open",
    "start": "902880",
    "end": "908579"
  },
  {
    "text": "the sign in app foreign",
    "start": "908579",
    "end": "914360"
  },
  {
    "text": "URL specified localhost port steinin oidc",
    "start": "914360",
    "end": "920940"
  },
  {
    "text": "so on the app registration I have to specify where can uses be redirected",
    "start": "920940",
    "end": "926040"
  },
  {
    "text": "from when they're trying to authenticate to this app so that means you can't set up a website",
    "start": "926040",
    "end": "933540"
  },
  {
    "text": "on evildomain.com and start authenticating as this app it",
    "start": "933540",
    "end": "939060"
  },
  {
    "text": "doesn't work because you won't be sent to it you'll get an error so that's part of the security here",
    "start": "939060",
    "end": "946519"
  },
  {
    "text": "and I specified I want an ID token there are in uh open ID connect there",
    "start": "947399",
    "end": "955139"
  },
  {
    "text": "are several what's called flows we're not going to go into that there's a whole different rabbit hole",
    "start": "955139",
    "end": "961680"
  },
  {
    "text": "but there are there are different ways of authenticating based on what kind of client you have we're going to use",
    "start": "961680",
    "end": "967259"
  },
  {
    "text": "simplicism hybrid so we get ID tokens back",
    "start": "967259",
    "end": "971480"
  },
  {
    "text": "now once I put that in",
    "start": "973800",
    "end": "977060"
  },
  {
    "text": "I go to my startup code and I add these two lines here",
    "start": "979860",
    "end": "986279"
  },
  {
    "text": "add authentication open ID connect default certification scheme which is the name of my authentication scheme",
    "start": "986279",
    "end": "991860"
  },
  {
    "text": "it's not particularly important unless I want to have more of them and I say add Microsoft identity web app",
    "start": "991860",
    "end": "999420"
  },
  {
    "text": "which is a extension that comes from the identity web Library",
    "start": "999420",
    "end": "1005199"
  },
  {
    "text": "and I say configuration gets a get Section key Azure ID which is corresponds to the Azure ID section in",
    "start": "1006320",
    "end": "1013579"
  },
  {
    "text": "my app config and then this is standard",
    "start": "1013579",
    "end": "1020180"
  },
  {
    "text": "asp.net authentication stuff I create an authentication policy",
    "start": "1020180",
    "end": "1026178"
  },
  {
    "text": "which says I require an authenticated user and I add a filter to all my controllers",
    "start": "1026179",
    "end": "1033380"
  },
  {
    "text": "with this authorized filter policy this makes it so every request coming into my",
    "start": "1033380",
    "end": "1040280"
  },
  {
    "text": "controllers goes through the authentication filter policy the authentication filter policy says you",
    "start": "1040280",
    "end": "1045980"
  },
  {
    "text": "have to be our authenticated user if you're not it",
    "start": "1045980",
    "end": "1051559"
  },
  {
    "text": "will return on HTTP challenge which is you need to go authenticate and",
    "start": "1051559",
    "end": "1058039"
  },
  {
    "text": "it contains the URL to Azure ID",
    "start": "1058039",
    "end": "1064000"
  },
  {
    "text": "I'm sent to Azure ID I come back I get a token into my browser I come into the sign in oacd it creates",
    "start": "1064460",
    "end": "1070940"
  },
  {
    "text": "a bunch of cookies and everything and then web the identity.web library picks that",
    "start": "1070940",
    "end": "1078320"
  },
  {
    "text": "up so and that's pretty much it I need to",
    "start": "1078320",
    "end": "1084799"
  },
  {
    "text": "do I also have these two here use authentication use authorization middleware to actually make this happen",
    "start": "1084799",
    "end": "1091700"
  },
  {
    "text": "in between so if I run this thing",
    "start": "1091700",
    "end": "1097059"
  },
  {
    "text": "I get my welcome and up here is my email address",
    "start": "1111740",
    "end": "1117580"
  },
  {
    "text": "did anyone see me authenticate no of course you didn't because my machine is enrolled in active",
    "start": "1119360",
    "end": "1127100"
  },
  {
    "text": "directory Azure active directory so it has single sign-on it just goes straight through",
    "start": "1127100",
    "end": "1133100"
  },
  {
    "text": "um let's take this and go into a private mode",
    "start": "1133100",
    "end": "1139900"
  },
  {
    "text": "now you see I'm redirected to login.microsoft online up there with a huge URL says sign in",
    "start": "1140720",
    "end": "1147740"
  },
  {
    "text": "sure I can do that",
    "start": "1147740",
    "end": "1150820"
  },
  {
    "text": "and take a password",
    "start": "1155660",
    "end": "1158620"
  },
  {
    "text": "sure I can stay signed it and then I'm in",
    "start": "1166520",
    "end": "1172960"
  },
  {
    "text": "hello Jay I'm that comes from the",
    "start": "1173539",
    "end": "1179600"
  },
  {
    "text": "regular which people might know the login partial with just at user.identity.net",
    "start": "1179600",
    "end": "1187580"
  },
  {
    "text": "because now I've got my token and it typed the identity web library takes",
    "start": "1187580",
    "end": "1193160"
  },
  {
    "text": "this token and populates what's called a claims user",
    "start": "1193160",
    "end": "1198220"
  },
  {
    "text": "and this thing just works",
    "start": "1198860",
    "end": "1202059"
  },
  {
    "text": "so let's run this again just with debug uh that's okay",
    "start": "1209120",
    "end": "1216820"
  },
  {
    "text": "and I'm debugging here and here's my",
    "start": "1222980",
    "end": "1227020"
  },
  {
    "text": "let's go to do watch",
    "start": "1229700",
    "end": "1232899"
  },
  {
    "text": "oh it doesn't want to do that in the racer mode oh well never mind let's go",
    "start": "1242960",
    "end": "1249760"
  },
  {
    "text": "oh there we go let's zoom in a little bit",
    "start": "1254600",
    "end": "1261460"
  },
  {
    "text": "so here's my user which is claims principle it has an identity",
    "start": "1263600",
    "end": "1270820"
  },
  {
    "text": "and this UI is horrible here's all my claims",
    "start": "1272720",
    "end": "1281260"
  },
  {
    "text": "these are the claims that Azure identity Microsoft empty web picked out of my",
    "start": "1282500",
    "end": "1287840"
  },
  {
    "text": "token which is my preferred username and a bunch of stuff that nobody really cares",
    "start": "1287840",
    "end": "1293360"
  },
  {
    "text": "about a lot here is my uh other name",
    "start": "1293360",
    "end": "1299000"
  },
  {
    "text": "and these things are decoded for you by the",
    "start": "1299000",
    "end": "1305480"
  },
  {
    "text": "identity web you can pick them up and look at them if you want as well you can add more claims but",
    "start": "1305480",
    "end": "1311600"
  },
  {
    "text": "the basic scenario you don't have to okay",
    "start": "1311600",
    "end": "1317140"
  },
  {
    "text": "so that's that",
    "start": "1317600",
    "end": "1320559"
  },
  {
    "text": "let's change this a little bit",
    "start": "1329419",
    "end": "1333880"
  },
  {
    "text": "so we're gonna go into this",
    "start": "1346820",
    "end": "1351158"
  },
  {
    "text": "copy that and then we'll go back to the app we created the",
    "start": "1354860",
    "end": "1361220"
  },
  {
    "text": "demo one and we're going to change to that",
    "start": "1361220",
    "end": "1367640"
  },
  {
    "text": "when I do this client here I copy that client ID I go into sign in",
    "start": "1367640",
    "end": "1374000"
  },
  {
    "text": "I put in a new client ID there save this",
    "start": "1374000",
    "end": "1382179"
  },
  {
    "text": "and I need to in my demo app specify where I should",
    "start": "1384320",
    "end": "1389900"
  },
  {
    "text": "redirect this is a web app and we redirect here we don't care about the logon log out because you can do that as",
    "start": "1389900",
    "end": "1397159"
  },
  {
    "text": "well uh oh",
    "start": "1397159",
    "end": "1402820"
  },
  {
    "text": "that was the wrong one that's the one I wanted",
    "start": "1403280",
    "end": "1408220"
  },
  {
    "text": "and there we go that should do it so if we now run this thing",
    "start": "1412100",
    "end": "1419860"
  },
  {
    "text": "we should end up",
    "start": "1421640",
    "end": "1425020"
  },
  {
    "text": "no thanks then I get this one which I didn't get the first time because I already had",
    "start": "1444340",
    "end": "1450260"
  },
  {
    "text": "that one this is a consent screen so when you go through",
    "start": "1450260",
    "end": "1457580"
  },
  {
    "text": "this is part of the open ID connect oauth standards",
    "start": "1457580",
    "end": "1463159"
  },
  {
    "text": "because my app is asking for information is asking to know who you are",
    "start": "1463159",
    "end": "1470059"
  },
  {
    "text": "and I need to consent to that because I can't just put up no kind of",
    "start": "1470059",
    "end": "1475580"
  },
  {
    "text": "people just putting up a nap and say I want a bunch of data from my all my users",
    "start": "1475580",
    "end": "1481159"
  },
  {
    "text": "so there's not much info here it's just called I could add more info here but it's called demo this app would like to",
    "start": "1481159",
    "end": "1486980"
  },
  {
    "text": "view your basic profile and maintain that access I'm an administrator so I can consent on",
    "start": "1486980",
    "end": "1492740"
  },
  {
    "text": "behalf of my organization so that means everyone else in my org that tried to go to this app wouldn't get the screen because I've consented on their behalf",
    "start": "1492740",
    "end": "1500120"
  },
  {
    "text": "but I'm just going to accept if I don't my app will get the",
    "start": "1500120",
    "end": "1505279"
  },
  {
    "text": "information and there I'm back in again so we'll get these can you'll get these consent screens the first time you go to",
    "start": "1505279",
    "end": "1511640"
  },
  {
    "text": "an app saying do you want to transfer this information to that app okay let's try another example",
    "start": "1511640",
    "end": "1520480"
  },
  {
    "text": "I want to call an API so now I've authenticated",
    "start": "1524480",
    "end": "1529880"
  },
  {
    "text": "I was allowed to log in it came to okay you are this person great",
    "start": "1529880",
    "end": "1536659"
  },
  {
    "text": "now I want to protect my API as well",
    "start": "1536659",
    "end": "1541539"
  },
  {
    "text": "let's go to Startup and in this case I want to log in",
    "start": "1542600",
    "end": "1550880"
  },
  {
    "text": "and I want to be allowed to call an API in this case I'll be calling the Microsoft graph API which is the API for",
    "start": "1550880",
    "end": "1558440"
  },
  {
    "text": "your organization or tenant I'm going to get the name",
    "start": "1558440",
    "end": "1565039"
  },
  {
    "text": "so we do the similar thing here we add Authentication at Microsoft identity web app",
    "start": "1565039",
    "end": "1571100"
  },
  {
    "text": "configuration section and then I have another thing here enable token acquisition to call down screen API",
    "start": "1571100",
    "end": "1577279"
  },
  {
    "text": "again extension method from Microsoft web identity",
    "start": "1577279",
    "end": "1583159"
  },
  {
    "text": "the thing is the ID token I'm getting is not allowed to be used to access",
    "start": "1583159",
    "end": "1589159"
  },
  {
    "text": "resources it can only be used for authentication but not authorization",
    "start": "1589159",
    "end": "1597200"
  },
  {
    "text": "in order to access a resource I need to swap or exchange my ID token",
    "start": "1597200",
    "end": "1603320"
  },
  {
    "text": "for what's called an access token so I log on to the site",
    "start": "1603320",
    "end": "1611480"
  },
  {
    "text": "the site gets my ID token and then my backend service in this case",
    "start": "1611480",
    "end": "1618140"
  },
  {
    "text": "has to send this ID token to Azure ad and say hey",
    "start": "1618140",
    "end": "1623900"
  },
  {
    "text": "I would like to get an access token for this user but not only for this user I would like",
    "start": "1623900",
    "end": "1629840"
  },
  {
    "text": "to get an access token for this user",
    "start": "1629840",
    "end": "1634880"
  },
  {
    "text": "using this app accessing that particular resource",
    "start": "1634880",
    "end": "1640279"
  },
  {
    "text": "so it's very narrow it is this user on this app accessing that resource",
    "start": "1640279",
    "end": "1647720"
  },
  {
    "text": "in this case it's B glad using my demo app",
    "start": "1647720",
    "end": "1653600"
  },
  {
    "text": "and I want to access Microsoft graph",
    "start": "1653600",
    "end": "1657880"
  },
  {
    "text": "we specify this using something called scopes",
    "start": "1660320",
    "end": "1665620"
  },
  {
    "text": "and I go into my registration",
    "start": "1667340",
    "end": "1672799"
  },
  {
    "text": "and I can add what's called API permissions I can say these are the apis",
    "start": "1673520",
    "end": "1679580"
  },
  {
    "text": "you are allowed to call from this app I can't just call any API",
    "start": "1679580",
    "end": "1686419"
  },
  {
    "text": "I have to be very specific I can call Microsoft graph API",
    "start": "1686419",
    "end": "1692919"
  },
  {
    "text": "and not only just graph API",
    "start": "1692960",
    "end": "1697179"
  },
  {
    "text": "but I can add I can filter different things I can say what are they allowed to collect",
    "start": "1699620",
    "end": "1706520"
  },
  {
    "text": "in this case I have the user.read",
    "start": "1706520",
    "end": "1711620"
  },
  {
    "text": "which is a claim that's a scope that allows me to sign in and read the",
    "start": "1711620",
    "end": "1717500"
  },
  {
    "text": "profile of myself",
    "start": "1717500",
    "end": "1721000"
  },
  {
    "text": "it is for instance different from users",
    "start": "1722899",
    "end": "1728720"
  },
  {
    "text": "user.read.all which allows me to read all profiles",
    "start": "1728720",
    "end": "1734299"
  },
  {
    "text": "so the access token I'm getting or will be getting allows me I've scoped it down",
    "start": "1734299",
    "end": "1742399"
  },
  {
    "text": "to only give me permission to read from the Microsoft graph API and",
    "start": "1742399",
    "end": "1748640"
  },
  {
    "text": "my own user profile if I'm trying to read another different profile",
    "start": "1748640",
    "end": "1753860"
  },
  {
    "text": "I'll get a an error saying I don't have access",
    "start": "1753860",
    "end": "1758500"
  },
  {
    "text": "I cannot write my profile that's a different scope these Scopes are defined by the",
    "start": "1760220",
    "end": "1767539"
  },
  {
    "text": "downstream in the API we'll check that out in a little bit",
    "start": "1767539",
    "end": "1774158"
  },
  {
    "text": "so I have to specify when I'm getting a token here so in app settings here again I have the domain the client ads",
    "start": "1776059",
    "end": "1782960"
  },
  {
    "text": "tenant ID and a little bit down here I have my down screen make bi which I've called",
    "start": "1782960",
    "end": "1789320"
  },
  {
    "text": "Downstream API because that's what it was in the demo it could be anything in configuration",
    "start": "1789320",
    "end": "1795260"
  },
  {
    "text": "as a base URL and it has Scopes you can have multiple Scopes space separated",
    "start": "1795260",
    "end": "1801140"
  },
  {
    "text": "I would like to be able to access these different scopes so I want you to read I want to be able",
    "start": "1801140",
    "end": "1807620"
  },
  {
    "text": "to read all but write myself and stuff like that I can add different scopes",
    "start": "1807620",
    "end": "1814940"
  },
  {
    "text": "so here I can specify I can minimize here as well if I have if I'm allowed to access a broad set of",
    "start": "1814940",
    "end": "1822020"
  },
  {
    "text": "scopes I can in my application say I could have accessed all of these but I'm going to",
    "start": "1822020",
    "end": "1827419"
  },
  {
    "text": "access just this one that's what I'm doing here and then this is picked up by the",
    "start": "1827419",
    "end": "1833120"
  },
  {
    "text": "enabled token acquisition called Downstream API and here we go add Microsoft graph",
    "start": "1833120",
    "end": "1839659"
  },
  {
    "text": "from the downstream API section",
    "start": "1839659",
    "end": "1843640"
  },
  {
    "text": "and there's the URL for the graph API and I'm adding an in-memory token cache",
    "start": "1845120",
    "end": "1852440"
  },
  {
    "text": "because it would be ineffective to every time I want to do an API call it would have to do first an API call to",
    "start": "1852440",
    "end": "1859820"
  },
  {
    "text": "Azure ID get that back verify the keys and do all that stuff that's because the and that's why the",
    "start": "1859820",
    "end": "1866779"
  },
  {
    "text": "Microsoft identity web has a token cache built in which will take your tokens and store",
    "start": "1866779",
    "end": "1873500"
  },
  {
    "text": "them in the cache okay that's another thing another claim on all the tokens are is an expiry date",
    "start": "1873500",
    "end": "1880039"
  },
  {
    "text": "you're only valid for a certain amount of time and they can also be valid from a",
    "start": "1880039",
    "end": "1885320"
  },
  {
    "text": "certain type they have not before you not used before and",
    "start": "1885320",
    "end": "1892399"
  },
  {
    "text": "expire at those are claims in a token",
    "start": "1892399",
    "end": "1897519"
  },
  {
    "text": "so again uh this is the same thing added a user all that stuff let's try and",
    "start": "1897980",
    "end": "1903919"
  },
  {
    "text": "run this one",
    "start": "1903919",
    "end": "1906880"
  },
  {
    "text": "so what I'm getting here is the same login up in the corner but now I've got something interesting down here API",
    "start": "1909019",
    "end": "1914120"
  },
  {
    "text": "result Glenn Hendrickson which is my name you don't need to see it just believe it's there",
    "start": "1914120",
    "end": "1919460"
  },
  {
    "text": "let's look at the interesting part is where does it come from instead",
    "start": "1919460",
    "end": "1924759"
  },
  {
    "text": "so my controllers I have a home controller in this case my home controller takes in",
    "start": "1929740",
    "end": "1936140"
  },
  {
    "text": "a graph service client which is part of the graph SDK which works with",
    "start": "1936140",
    "end": "1944720"
  },
  {
    "text": "the identity web so this is an easy way to get more information from Microsoft graph logged",
    "start": "1944720",
    "end": "1951080"
  },
  {
    "text": "in I'm authorized for this and I just called the graph service client dot me dot request get I think",
    "start": "1951080",
    "end": "1956480"
  },
  {
    "text": "that's the way you get your profile and I said get user display name this could be anything for my profile",
    "start": "1956480",
    "end": "1963740"
  },
  {
    "text": "interesting part here this thing authorize for scopes",
    "start": "1963740",
    "end": "1969760"
  },
  {
    "text": "scope key section Downstream API colon Scopes it says this controller",
    "start": "1969799",
    "end": "1977059"
  },
  {
    "text": "expects to be authorized for this particular scope",
    "start": "1977059",
    "end": "1982519"
  },
  {
    "text": "if and that what that attribute does is that if this controller",
    "start": "1982519",
    "end": "1987919"
  },
  {
    "text": "returns an exception or throws an exception",
    "start": "1987919",
    "end": "1993080"
  },
  {
    "text": "of a type which Microsoft identity web determines has to",
    "start": "1993080",
    "end": "2001000"
  },
  {
    "text": "do with you haven't got the right Scopes you haven't got the right keys it will do an authentication run for",
    "start": "2001000",
    "end": "2007419"
  },
  {
    "text": "those particular scopes this is part of a thing called incremental consent",
    "start": "2007419",
    "end": "2014639"
  },
  {
    "text": "anyone have a mobile phone remember when you installed apps it",
    "start": "2015220",
    "end": "2020679"
  },
  {
    "text": "would give you this app needs these permissions and you would go okay and you'd Grant",
    "start": "2020679",
    "end": "2027640"
  },
  {
    "text": "all but that changed now now when you install an app you don't get that when you install but when they want to use",
    "start": "2027640",
    "end": "2033880"
  },
  {
    "text": "that particular features as I need access to your position do you want to do that okay great",
    "start": "2033880",
    "end": "2039039"
  },
  {
    "text": "that's called incremental consent you can get the same thing web apps where you can use a web app",
    "start": "2039039",
    "end": "2045580"
  },
  {
    "text": "with a particular scope a particular access token that calls an API",
    "start": "2045580",
    "end": "2051398"
  },
  {
    "text": "and for instance on the page where you want to make changes to your profile",
    "start": "2051399",
    "end": "2057638"
  },
  {
    "text": "then you can specify in this particular case we're going to need the user dot read write scope",
    "start": "2057639",
    "end": "2065440"
  },
  {
    "text": "so instead of granting your token that has that permission from the start doing whatever you do when you're just",
    "start": "2065440",
    "end": "2070540"
  },
  {
    "text": "browsing you can incrementally increase the consent either to more data or a more access",
    "start": "2070540",
    "end": "2078398"
  },
  {
    "text": "and says this particular controller we're going to need that a Microsoft identity web handles that part for you",
    "start": "2078399",
    "end": "2085720"
  },
  {
    "text": "it will say oh you're through an exception of this type that I can handle that by incrementing",
    "start": "2085720",
    "end": "2090760"
  },
  {
    "text": "the consent it will redirect you you will get a new consent screen I want",
    "start": "2090760",
    "end": "2095858"
  },
  {
    "text": "access to this is that okay yes come back",
    "start": "2095859",
    "end": "2101079"
  },
  {
    "text": "the controller runs again this time without exceptions and you get the result",
    "start": "2101079",
    "end": "2106440"
  },
  {
    "text": "so let's call them the grasp let's call our own API now you might have noticed something",
    "start": "2113380",
    "end": "2121859"
  },
  {
    "text": "let's go back to that I skipped the part here client Secret",
    "start": "2122980",
    "end": "2129720"
  },
  {
    "text": "because now I'm not just authenticating against my",
    "start": "2131079",
    "end": "2136240"
  },
  {
    "text": "web app but I'm asking my web app to authorize me",
    "start": "2136240",
    "end": "2141400"
  },
  {
    "text": "on my behalf and I need to upgrade my web app from",
    "start": "2141400",
    "end": "2146560"
  },
  {
    "text": "just being a registered app just saying like I'm this guy and everybody goes okay sure whatever",
    "start": "2146560",
    "end": "2152560"
  },
  {
    "text": "to being I'm actually this guy and and Azure idea okay I'm sure yes I",
    "start": "2152560",
    "end": "2159280"
  },
  {
    "text": "have the secret to prove it I have the secret handshake for the Freemasons much like lights which is in hotels",
    "start": "2159280",
    "end": "2165460"
  },
  {
    "text": "you have to have the secret handshake to figure out how to turn on the light and showers and hotels",
    "start": "2165460",
    "end": "2173339"
  },
  {
    "text": "but I have to upgrade my web app to what's called a confidential client",
    "start": "2174520",
    "end": "2180359"
  },
  {
    "text": "and I do that by supplying it a secret it could be a secret or it could be a certificate",
    "start": "2180820",
    "end": "2186400"
  },
  {
    "text": "so there's an entry here for client certificates which I can point I can do stuff I can",
    "start": "2186400",
    "end": "2191980"
  },
  {
    "text": "add the certificate here I can point it to a key Vault I can do different things and this is a demo so I'm being simple",
    "start": "2191980",
    "end": "2198820"
  },
  {
    "text": "I'm just using a client secret which is totally fine certificates are a little bit more secure but for many cases you just using",
    "start": "2198820",
    "end": "2206020"
  },
  {
    "text": "secrets are fine secrets",
    "start": "2206020",
    "end": "2211140"
  },
  {
    "text": "are defined not on that browser but this browser",
    "start": "2212680",
    "end": "2217260"
  },
  {
    "text": "Downstream certificates and secrets here's my client secret I just go new",
    "start": "2219520",
    "end": "2225640"
  },
  {
    "text": "client Secret and then it would tell me a secret",
    "start": "2225640",
    "end": "2231720"
  },
  {
    "text": "test I can set when it expires so anyone watching this on YouTube thinking ah now",
    "start": "2232300",
    "end": "2238060"
  },
  {
    "text": "they have my secret don't worry it expires tomorrow way before things end up on YouTube",
    "start": "2238060",
    "end": "2244839"
  },
  {
    "text": "there's my secret it is showing and this is I don't want to say hello listen very carefully I'm going to say",
    "start": "2244839",
    "end": "2251260"
  },
  {
    "text": "this once this only says it but copy that secret now once you move away",
    "start": "2251260",
    "end": "2256839"
  },
  {
    "text": "and move back you will never see it again so copy it keep it secret keep it safe",
    "start": "2256839",
    "end": "2264299"
  },
  {
    "text": "and this has a warning here because this secret is about to expire because this expires tomorrow",
    "start": "2264460",
    "end": "2271019"
  },
  {
    "text": "I don't need that secret so we can just delete that here I put this secret in the",
    "start": "2272260",
    "end": "2280180"
  },
  {
    "text": "app settings to show it to you you should never do that",
    "start": "2280180",
    "end": "2285400"
  },
  {
    "text": "you should put it in you use use the secrets when you're developing locally or put in a key Vault or some secure",
    "start": "2285400",
    "end": "2290740"
  },
  {
    "text": "location where it can't be easily found and discovered but for demo purposes",
    "start": "2290740",
    "end": "2298599"
  },
  {
    "text": "and I know like five of you will do that once I showed you but it's a risk I'm willing to take",
    "start": "2298599",
    "end": "2303760"
  },
  {
    "text": "it's a sacrifice I'm willing to take that you've screwed up right",
    "start": "2303760",
    "end": "2309940"
  },
  {
    "text": "so let's go to another example here's a web API this is",
    "start": "2309940",
    "end": "2315460"
  },
  {
    "text": "my API not graph anymore here I just have the Azure ID",
    "start": "2315460",
    "end": "2321640"
  },
  {
    "text": "stuff my tenant ID my client ID I have my startup class",
    "start": "2321640",
    "end": "2328920"
  },
  {
    "text": "add Microsoft identity web API which acts a little bit differently",
    "start": "2328920",
    "end": "2333940"
  },
  {
    "text": "because if your ex when the first time I access the",
    "start": "2333940",
    "end": "2340720"
  },
  {
    "text": "page when I was not authenticated I was redirected I got a uh redirect message",
    "start": "2340720",
    "end": "2346480"
  },
  {
    "text": "says go that go there instead authenticate come back when you when you're done",
    "start": "2346480",
    "end": "2352920"
  },
  {
    "text": "authenticating a web API is slightly different",
    "start": "2355000",
    "end": "2359640"
  },
  {
    "text": "here's the Swagger file here's the weather forecast which is the API try this out let's just execute that",
    "start": "2360579",
    "end": "2368460"
  },
  {
    "text": "that didn't go too well I got a 401.",
    "start": "2369700",
    "end": "2375060"
  },
  {
    "text": "anyone know the 40 hdb 401 code is unauthorized",
    "start": "2375700",
    "end": "2383320"
  },
  {
    "text": "so I'm not off I'm not authorized it's not very helpful it doesn't tell you where to go to get off of my students",
    "start": "2383320",
    "end": "2389140"
  },
  {
    "text": "that's like you have no access it's probably the bouncer that just yeah you're not coming in here why not",
    "start": "2389140",
    "end": "2395500"
  },
  {
    "text": "because you're not he doesn't like your shoes or whatever it and when anybody will tell you you",
    "start": "2395500",
    "end": "2401859"
  },
  {
    "text": "have no idea why he's not letting you in but luckily we know where to go",
    "start": "2401859",
    "end": "2409140"
  },
  {
    "text": "so that's a pretty simple setup for that to deny everyone access at Microsoft identity web API",
    "start": "2410319",
    "end": "2418560"
  },
  {
    "text": "and then I have my weather forecast controller that says",
    "start": "2418839",
    "end": "2424780"
  },
  {
    "text": "you need to be authorized standard authorized attribute in asp.net",
    "start": "2424780",
    "end": "2429819"
  },
  {
    "text": "you need to be authorized but here I can also say",
    "start": "2429819",
    "end": "2437400"
  },
  {
    "text": "I would Define a scope pair called access user or I'm just I haven't defined it here but I'm",
    "start": "2438940",
    "end": "2444280"
  },
  {
    "text": "referencing here saying these are the scope required and I can use an extension method here",
    "start": "2444280",
    "end": "2449740"
  },
  {
    "text": "saying that verify user has any accepted scope and these",
    "start": "2449740",
    "end": "2456280"
  },
  {
    "text": "if I don't specify which scope then I would accept any registered users",
    "start": "2456280",
    "end": "2464339"
  },
  {
    "text": "and how do we do that in the portal so oh",
    "start": "2468640",
    "end": "2474539"
  },
  {
    "text": "so in the portal here um let's see uh sandcastle",
    "start": "2476200",
    "end": "2483940"
  },
  {
    "text": "API I have exposed an API",
    "start": "2483940",
    "end": "2492339"
  },
  {
    "text": "which is a bit broad because what I'm actually doing is staticoscope",
    "start": "2492339",
    "end": "2497640"
  },
  {
    "text": "I add a scope and I add a scope name which can be whatever I want",
    "start": "2498040",
    "end": "2505060"
  },
  {
    "text": "it can who can consent to this only admins or admins and users and I give it a little bit information the scope",
    "start": "2505060",
    "end": "2512680"
  },
  {
    "text": "I've I've added is this one",
    "start": "2512680",
    "end": "2518800"
  },
  {
    "text": "scope name acts as user and I get this really ugly string below which is the standard so my API needs",
    "start": "2518800",
    "end": "2527079"
  },
  {
    "text": "a base scope it is set",
    "start": "2527079",
    "end": "2533740"
  },
  {
    "text": "up here it's the application ID URI the default is that it starts with API",
    "start": "2533740",
    "end": "2540220"
  },
  {
    "text": "colon slash the application ID it can be anything but it has to be globally",
    "start": "2540220",
    "end": "2545440"
  },
  {
    "text": "unique so I can change it to whatever I want",
    "start": "2545440",
    "end": "2551740"
  },
  {
    "text": "but it has to be Global unique so if I wanted to be something more human readable I would have for instance as a",
    "start": "2551740",
    "end": "2557980"
  },
  {
    "text": "domain I own I could have API dot henrikson.no slash whatever but",
    "start": "2557980",
    "end": "2567480"
  },
  {
    "text": "it will default to that the access user who can access what message do you get when you consent",
    "start": "2567700",
    "end": "2574599"
  },
  {
    "text": "to this scope which is you'll get that in the same consent screen that we showed earlier",
    "start": "2574599",
    "end": "2581079"
  },
  {
    "text": "now we also have an app called API client",
    "start": "2581079",
    "end": "2586240"
  },
  {
    "text": "in API client I can have ADD API permissions I can go add a permission",
    "start": "2586240",
    "end": "2593740"
  },
  {
    "text": "my apis it will show me my other applications that I've registered that",
    "start": "2593740",
    "end": "2598960"
  },
  {
    "text": "have exposed an API and I'll say go to API and I can select",
    "start": "2598960",
    "end": "2604720"
  },
  {
    "text": "what Scopes I would like to access I've already done this so it's access as",
    "start": "2604720",
    "end": "2610180"
  },
  {
    "text": "user which is a scope",
    "start": "2610180",
    "end": "2614640"
  },
  {
    "text": "and then I see here in the server on my API as I verify that the user has accepted scope",
    "start": "2616300",
    "end": "2623619"
  },
  {
    "text": "now on my client",
    "start": "2623619",
    "end": "2627059"
  },
  {
    "text": "I also have my domain my client ID maternity and I need a client Secret",
    "start": "2630280",
    "end": "2636640"
  },
  {
    "text": "because this client is going to access resources on my behalf and it needs to",
    "start": "2636640",
    "end": "2642280"
  },
  {
    "text": "be a confidential client so it needs a client secret a client certificate I have to have those things",
    "start": "2642280",
    "end": "2649020"
  },
  {
    "text": "I have some configuration it's put in configuration because that's easy you could hard code it in if you wanted to",
    "start": "2650020",
    "end": "2655660"
  },
  {
    "text": "you can get this from App configuration you can create it by convention whatever",
    "start": "2655660",
    "end": "2660880"
  },
  {
    "text": "you do but I put it in because it's easy paste URL to the site",
    "start": "2660880",
    "end": "2667300"
  },
  {
    "text": "and the scope I'm accessing default scope including the application URI and the scope at the",
    "start": "2667300",
    "end": "2675640"
  },
  {
    "text": "end so let's take a look at home controller",
    "start": "2675640",
    "end": "2681119"
  },
  {
    "text": "I get injected myself with the service or with a",
    "start": "2684760",
    "end": "2691260"
  },
  {
    "text": "service called I token acquisition it is part of the Microsoft web identity",
    "start": "2691260",
    "end": "2697359"
  },
  {
    "text": "Library which is a helper function for getting tokens I could and have done so and which is",
    "start": "2697359",
    "end": "2704319"
  },
  {
    "text": "why I never do it again get these tokens by again using HTTP client constructing calls sending the right endpoint getting",
    "start": "2704319",
    "end": "2710800"
  },
  {
    "text": "back doing all the stuff and it's a mess identity web identity makes it a lot",
    "start": "2710800",
    "end": "2716440"
  },
  {
    "text": "easier the author writes for Scopes again for handling incremental consent saying that",
    "start": "2716440",
    "end": "2722440"
  },
  {
    "text": "if you don't have these Scopes then we need to upgrade your access token",
    "start": "2722440",
    "end": "2727480"
  },
  {
    "text": "and then it's a matter of calling that service here I'd specify the Scopes I",
    "start": "2727480",
    "end": "2733900"
  },
  {
    "text": "want is an array access user token acquisition get access token for",
    "start": "2733900",
    "end": "2739420"
  },
  {
    "text": "user Asic with these scopes token acquisition service will handle",
    "start": "2739420",
    "end": "2746020"
  },
  {
    "text": "the caching of tokens we'll check the token cache do I have a valid token for this particular scope for this",
    "start": "2746020",
    "end": "2751780"
  },
  {
    "text": "particular user that is not expired yes no if not go to Azure ID fetch one send in the id",
    "start": "2751780",
    "end": "2758740"
  },
  {
    "text": "id token get back an access token put it in the cache return it that's what happens",
    "start": "2758740",
    "end": "2766079"
  },
  {
    "text": "we log this information and then I do a HTTP client I set the header the authorization",
    "start": "2767319",
    "end": "2773980"
  },
  {
    "text": "header is set to an authentication header value Bearer and my access token which is",
    "start": "2773980",
    "end": "2779680"
  },
  {
    "text": "standard HTTP how you send a job normally you add Bearer here's the token",
    "start": "2779680",
    "end": "2785680"
  },
  {
    "text": "send that as a header and then connect to",
    "start": "2785680",
    "end": "2791260"
  },
  {
    "text": "get string from weather forecast there is zero error handling here because there's a demo you should",
    "start": "2791260",
    "end": "2797140"
  },
  {
    "text": "obviously have error handling and all the stuff you need to do when you're calling third-party apis",
    "start": "2797140",
    "end": "2802780"
  },
  {
    "text": "not do the common mistake of assuming that the cloud is always online all that stuff don't do that for clarity that is not part of this",
    "start": "2802780",
    "end": "2811240"
  },
  {
    "text": "and I just stuff it into view data because I don't need the whole model here",
    "start": "2811240",
    "end": "2817660"
  },
  {
    "text": "so let's see how this works first let's start the",
    "start": "2817660",
    "end": "2824319"
  },
  {
    "text": "let's see what do we have running here now I have no idea but let's close it",
    "start": "2824319",
    "end": "2830680"
  },
  {
    "text": "we start the web API",
    "start": "2830680",
    "end": "2834000"
  },
  {
    "text": "um I don't think you heard me computer start the web API",
    "start": "2841720",
    "end": "2846960"
  },
  {
    "text": "maybe it's just building anyway let's switch to the",
    "start": "2855220",
    "end": "2860680"
  },
  {
    "text": "client and start the client",
    "start": "2860680",
    "end": "2864660"
  },
  {
    "text": "there's my Swagger UI is it running yeah so now I go to the home page oh I got a",
    "start": "2868000",
    "end": "2874599"
  },
  {
    "text": "result these are the Json that I get from the weather API if",
    "start": "2874599",
    "end": "2882220"
  },
  {
    "text": "I I logged my token so here's my token",
    "start": "2882220",
    "end": "2887800"
  },
  {
    "text": "everyone can read that right let's now that we got a token let's see",
    "start": "2887800",
    "end": "2893140"
  },
  {
    "text": "what a token looks like jwt.ms",
    "start": "2893140",
    "end": "2897039"
  },
  {
    "text": "which is a nice little site for decoding your tokens",
    "start": "2901300",
    "end": "2907800"
  },
  {
    "text": "it never leaves your browser it does the decoding internally it is",
    "start": "2908380",
    "end": "2914020"
  },
  {
    "text": "three strings base64 encoded separated with a DOT",
    "start": "2914020",
    "end": "2919059"
  },
  {
    "text": "you see how different colors all the way up to the right third there's a DOT so that's the first that's the header",
    "start": "2919059",
    "end": "2925000"
  },
  {
    "text": "then there's the actual token and then the green part at the bottom here is the signature",
    "start": "2925000",
    "end": "2931780"
  },
  {
    "text": "it says this token was issued by Azure directory it can tell this is what the token looks like",
    "start": "2931780",
    "end": "2939579"
  },
  {
    "text": "it has an audience which is this token is meant for this",
    "start": "2939579",
    "end": "2944980"
  },
  {
    "text": "API it has an issuer it is issued by",
    "start": "2944980",
    "end": "2951520"
  },
  {
    "text": "security token service windows.net at this tenant",
    "start": "2951520",
    "end": "2956619"
  },
  {
    "text": "so I can tell which tenant it comes from",
    "start": "2956619",
    "end": "2960480"
  },
  {
    "text": "a bunch of timestamps issued at not before expires at some ID specific Keys the app ID my",
    "start": "2961960",
    "end": "2970300"
  },
  {
    "text": "email my family name given name my email is my given name according to Azure ID apparently",
    "start": "2970300",
    "end": "2976660"
  },
  {
    "text": "and a bunch of stuff here in call including a subject ID",
    "start": "2976660",
    "end": "2982920"
  },
  {
    "text": "subject ID is the ID of my user local to this",
    "start": "2985240",
    "end": "2991780"
  },
  {
    "text": "particular app so I can use that to keep track of to",
    "start": "2991780",
    "end": "2997540"
  },
  {
    "text": "recognize me as a user in this app I cannot use it to cross-reference a user across apps",
    "start": "2997540",
    "end": "3005300"
  },
  {
    "text": "but is guaranteed to be unique and persistent within this app I have oid object ID",
    "start": "3007319",
    "end": "3014819"
  },
  {
    "text": "which is the object ID for my user in active directory",
    "start": "3014819",
    "end": "3021119"
  },
  {
    "text": "it is going to be unique and persistent across all apps so I can save that and be confident that",
    "start": "3021119",
    "end": "3028140"
  },
  {
    "text": "I can get back to my user if all of these operations look weird",
    "start": "3028140",
    "end": "3034200"
  },
  {
    "text": "you can always go to claims and it will let you more know more about these",
    "start": "3034200",
    "end": "3041180"
  },
  {
    "text": "so",
    "start": "3044579",
    "end": "3047059"
  },
  {
    "text": "um what's next",
    "start": "3050099",
    "end": "3055559"
  },
  {
    "text": "oh now demons I promise would look at demons a demon spelled d-a-e",
    "start": "3055559",
    "end": "3063660"
  },
  {
    "text": "-m-o-n is the traditional name of a service that runs without a UI it runs",
    "start": "3063660",
    "end": "3069119"
  },
  {
    "text": "on its own and sometimes it needs to access other resources",
    "start": "3069119",
    "end": "3076920"
  },
  {
    "text": "now we want those accesses also to be authenticated",
    "start": "3076920",
    "end": "3082980"
  },
  {
    "text": "so again we can use the traditional",
    "start": "3082980",
    "end": "3088940"
  },
  {
    "text": "microsoft.web identity to set up a confidential client using a client secret or client certificate",
    "start": "3088940",
    "end": "3096119"
  },
  {
    "text": "this is a console application",
    "start": "3096119",
    "end": "3099619"
  },
  {
    "text": "it has some stuff here for using setting up the authentication it gets a secret if",
    "start": "3101819",
    "end": "3108359"
  },
  {
    "text": "you have it add them token cache and it uses the acquire token for client",
    "start": "3108359",
    "end": "3116220"
  },
  {
    "text": "so this is slightly different call but then it does the same thing that we",
    "start": "3116220",
    "end": "3123480"
  },
  {
    "text": "did gets the token from before who's in",
    "start": "3123480",
    "end": "3130200"
  },
  {
    "text": "so quiet talking gets a token and then it just calls an API with that token the interesting part here is that",
    "start": "3130200",
    "end": "3137099"
  },
  {
    "text": "it doesn't have um",
    "start": "3137099",
    "end": "3142579"
  },
  {
    "text": "it cannot log on so we kind of consent to stuff on its own",
    "start": "3142980",
    "end": "3148680"
  },
  {
    "text": "you cannot do an Interactive log on so what we do instead we use something",
    "start": "3148680",
    "end": "3154319"
  },
  {
    "text": "called app roles so here's my to-do API",
    "start": "3154319",
    "end": "3160260"
  },
  {
    "text": "which has approach called demon April I can create an app role",
    "start": "3160260",
    "end": "3166859"
  },
  {
    "text": "I can say that who's allowed to use this app role is it just you it uses or groups just applications of both of them",
    "start": "3166859",
    "end": "3174480"
  },
  {
    "text": "a value to it can be whatever I want should be short and no spaces a description can be whatever you want",
    "start": "3174480",
    "end": "3181500"
  },
  {
    "text": "here I made called one demon April it's available for both users and applications",
    "start": "3181500",
    "end": "3188720"
  },
  {
    "text": "and in my console app here",
    "start": "3190440",
    "end": "3195260"
  },
  {
    "text": "app settings I have this scope",
    "start": "3196559",
    "end": "3202760"
  },
  {
    "text": "API colon slash same form this is the client ID for the API that I'm going to",
    "start": "3204180",
    "end": "3210180"
  },
  {
    "text": "call and the scope is dot default when calling",
    "start": "3210180",
    "end": "3216780"
  },
  {
    "text": "apis with app roles you need to add dot default as a scope and the token would then come back with",
    "start": "3216780",
    "end": "3223619"
  },
  {
    "text": "whatever roles you have on this particular app you are granted these roles on this app",
    "start": "3223619",
    "end": "3231119"
  },
  {
    "text": "here they are and then I can in my",
    "start": "3231119",
    "end": "3237599"
  },
  {
    "text": "to-do list app in my to-do list controller",
    "start": "3237599",
    "end": "3242838"
  },
  {
    "text": "can authorize same as we've always done it has it only authorizes it doesn't do",
    "start": "3243780",
    "end": "3251099"
  },
  {
    "text": "anything on behalf of a user it only the client secret here",
    "start": "3251099",
    "end": "3255440"
  },
  {
    "text": "add Microsoft identity web app fine",
    "start": "3258180",
    "end": "3262940"
  },
  {
    "text": "I can also hear validate my Approach which is an",
    "start": "3269400",
    "end": "3274619"
  },
  {
    "text": "extension method in the web identity saying validate the role demonapro",
    "start": "3274619",
    "end": "3281640"
  },
  {
    "text": "saying unless you have this particular role unless this role is present in your",
    "start": "3281640",
    "end": "3286799"
  },
  {
    "text": "token you're not getting in",
    "start": "3286799",
    "end": "3290960"
  },
  {
    "text": "so let's run the web API",
    "start": "3293099",
    "end": "3297240"
  },
  {
    "text": "there we go let's run the console app which has a secret social confidential",
    "start": "3304440",
    "end": "3310920"
  },
  {
    "text": "application you can get a token on its behalf as itself not as me not as",
    "start": "3310920",
    "end": "3316920"
  },
  {
    "text": "someone else but as its own identity and we see it gets some data here pick",
    "start": "3316920",
    "end": "3324900"
  },
  {
    "text": "up groceries finish invoice report and water the plants pretty eclectic",
    "start": "3324900",
    "end": "3330960"
  },
  {
    "text": "task list",
    "start": "3330960",
    "end": "3333680"
  },
  {
    "text": "now now I've been making my own application registrations",
    "start": "3338880",
    "end": "3345480"
  },
  {
    "text": "in azure I can also",
    "start": "3345480",
    "end": "3351180"
  },
  {
    "text": "let's go to Resource Group and you see London let's find oh let's go for",
    "start": "3351180",
    "end": "3358740"
  },
  {
    "text": "this one I can go anyone who'd been here before",
    "start": "3358740",
    "end": "3364140"
  },
  {
    "text": "the web app and uh this is a web app uh service",
    "start": "3364140",
    "end": "3369299"
  },
  {
    "text": "I can add what's called a system assigned managed identity",
    "start": "3369299",
    "end": "3374599"
  },
  {
    "text": "it's a matter of turning that on and Azure ad will add Azure portal will",
    "start": "3375599",
    "end": "3381599"
  },
  {
    "text": "automatically create an app for me in Azure ID it will put it up here there's the",
    "start": "3381599",
    "end": "3387599"
  },
  {
    "text": "object the principal ID of that app and I can give a role assignments",
    "start": "3387599",
    "end": "3395779"
  },
  {
    "text": "I can use this app or I can assume the identity of this app",
    "start": "3396480",
    "end": "3403740"
  },
  {
    "text": "by calling let's go to this one this particular call now I'm using",
    "start": "3403740",
    "end": "3410339"
  },
  {
    "text": "another a library called Azure identity",
    "start": "3410339",
    "end": "3414920"
  },
  {
    "text": "and I can do Azure identity default default Azure credential",
    "start": "3416220",
    "end": "3423020"
  },
  {
    "text": "it returns to me a set of credentials",
    "start": "3424980",
    "end": "3430640"
  },
  {
    "text": "and I can do you know ask for tokens from that",
    "start": "3432000",
    "end": "3437700"
  },
  {
    "text": "credential Prudential get token where they want to get the token in this case I'm getting for database I can use",
    "start": "3437700",
    "end": "3445020"
  },
  {
    "text": "this token to access graph API to access my own",
    "start": "3445020",
    "end": "3450900"
  },
  {
    "text": "apis or in this case access Azure SQL Server",
    "start": "3450900",
    "end": "3457260"
  },
  {
    "text": "and I'm going to have my service and we don't have time to go through that but I can have my service",
    "start": "3457260",
    "end": "3464220"
  },
  {
    "text": "be granted its ad user can be granted permissions in my database",
    "start": "3464220",
    "end": "3469859"
  },
  {
    "text": "and it can access the database in this case through EF core with a token instead of a connection string with",
    "start": "3469859",
    "end": "3475559"
  },
  {
    "text": "username and password which is a lot more secure because they don't have username and password so your",
    "start": "3475559",
    "end": "3481020"
  },
  {
    "text": "production data laying around if someone gets into your configuration story they cannot get your data because",
    "start": "3481020",
    "end": "3487920"
  },
  {
    "text": "the actual machine running it is the one with the permissions",
    "start": "3487920",
    "end": "3493380"
  },
  {
    "text": "not a random username password combination we use this in our functions we use",
    "start": "3493380",
    "end": "3500220"
  },
  {
    "text": "Azure functions to call apis the function has as many system identity we use Azure event grid",
    "start": "3500220",
    "end": "3506880"
  },
  {
    "text": "which has its own system identity which is allowed to call webhook endpoints in",
    "start": "3506880",
    "end": "3512579"
  },
  {
    "text": "some of our apis so instead of having connection strings with username and passwords we can use",
    "start": "3512579",
    "end": "3518819"
  },
  {
    "text": "manage system identities and have the my code assume the managed identity that",
    "start": "3518819",
    "end": "3526859"
  },
  {
    "text": "the service is running on and ask for tokens on its own behalf",
    "start": "3526859",
    "end": "3533540"
  },
  {
    "text": "right any questions I think I'm out of time at least I spent an hour so I'm thinking",
    "start": "3538680",
    "end": "3544079"
  },
  {
    "text": "about it right yes over there",
    "start": "3544079",
    "end": "3549619"
  },
  {
    "text": "I use uh I log on either through Visual Studio or through the command line with",
    "start": "3556500",
    "end": "3561599"
  },
  {
    "text": "AC login and the command here",
    "start": "3561599",
    "end": "3567020"
  },
  {
    "text": "so the question was how will I debug this locally how will I use it the default Azure credential will also",
    "start": "3568079",
    "end": "3574079"
  },
  {
    "text": "pick up my local credentials if I'm logged in through Visual Studio Visual Studio code or with AC CLI I think",
    "start": "3574079",
    "end": "3582000"
  },
  {
    "text": "Powershell as well do I do I'm on my workflow I do AC login I log in and then I run my app",
    "start": "3582000",
    "end": "3589859"
  },
  {
    "text": "default Azure credential will pick up my local credentials as my me my user I can",
    "start": "3589859",
    "end": "3596160"
  },
  {
    "text": "also use uh set some environment variables with a client need and client secret and",
    "start": "3596160",
    "end": "3601920"
  },
  {
    "text": "pretend to be another principle in the ID on my local computer",
    "start": "3601920",
    "end": "3607020"
  },
  {
    "text": "so there's two ways of doing it I have a my workstation is connected to Azure ID so we'll just use my login",
    "start": "3607020",
    "end": "3614099"
  },
  {
    "text": "or you can specify through Enlightenment variables use this particular principle",
    "start": "3614099",
    "end": "3621299"
  },
  {
    "text": "the answer question yes sir",
    "start": "3621299",
    "end": "3626059"
  },
  {
    "text": "you chose um",
    "start": "3627980",
    "end": "3632480"
  },
  {
    "text": "it is in principle any but you can pick and choose which one you want to allow",
    "start": "3639980",
    "end": "3647059"
  },
  {
    "text": "you in your code you can specify who the who you want to have issue you're going to filter on issuers",
    "start": "3647059",
    "end": "3653160"
  },
  {
    "text": "so notice in the uh in when we looked at token there was a field called issuer and it contains the uh tenant ID of",
    "start": "3653160",
    "end": "3661440"
  },
  {
    "text": "whoever issued a token so I can allow from anyone",
    "start": "3661440",
    "end": "3666720"
  },
  {
    "text": "in ad to give me a token but then my code can filter so I will only accept",
    "start": "3666720",
    "end": "3672059"
  },
  {
    "text": "tokens from these three issuers for instance",
    "start": "3672059",
    "end": "3677299"
  },
  {
    "text": "yep",
    "start": "3678299",
    "end": "3680900"
  },
  {
    "text": "yeah I haven't tried that particular scenario but yeah that should work so the question was if you have azure b2c",
    "start": "3689359",
    "end": "3697319"
  },
  {
    "text": "can you use that as a tenant to log on to this app if you allow it from multiple tenants and I think that should",
    "start": "3697319",
    "end": "3705480"
  },
  {
    "text": "work because as you paid to see is just another tenant",
    "start": "3705480",
    "end": "3710700"
  },
  {
    "text": "um so that I think that should work yeah so you could allow you could also set up different authentication schemes so if",
    "start": "3710700",
    "end": "3717539"
  },
  {
    "text": "you want uh what you would do if you have web API and web pages in the same one",
    "start": "3717539",
    "end": "3724920"
  },
  {
    "text": "you would basically add multiple of these ad",
    "start": "3724920",
    "end": "3731220"
  },
  {
    "text": "Authentication with just different different schemes",
    "start": "3731220",
    "end": "3736920"
  },
  {
    "text": "and wonderful web API and one for for logging on I think you could do the same thing with the b2c you could have one",
    "start": "3736920",
    "end": "3743099"
  },
  {
    "text": "that authenticated b2c customers and wonder then to get your internal lash customers other questions",
    "start": "3743099",
    "end": "3750440"
  },
  {
    "text": "right okay if anyone wants to talk more I'll be here so uh",
    "start": "3750720",
    "end": "3757559"
  },
  {
    "text": "that's it for me",
    "start": "3757559",
    "end": "3760460"
  }
]