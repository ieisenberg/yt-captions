[
  {
    "text": "i'm back um so",
    "start": "2480",
    "end": "7759"
  },
  {
    "text": "i'm going to talk about c groups and i've been talking about c groups to people for years but i'm going to talk about them for the",
    "start": "7759",
    "end": "14160"
  },
  {
    "text": "first time in a way that i've not talked about them before which is",
    "start": "14160",
    "end": "19359"
  },
  {
    "text": "my presentation's voice gone before this is secrets version one which you're all using",
    "start": "19359",
    "end": "25119"
  },
  {
    "text": "and here's what's going to change in secrets version two but now secrets version 2 has really",
    "start": "25119",
    "end": "31599"
  },
  {
    "text": "arrived so i'm just going to say here's c groups by the way this is version two",
    "start": "31599",
    "end": "37600"
  },
  {
    "text": "and i'm not going to tell you about version one um soon it'll",
    "start": "37600",
    "end": "43280"
  },
  {
    "text": "well for some of us at least it'll be a distant memory for some of us with embedded products",
    "start": "43280",
    "end": "49840"
  },
  {
    "text": "perhaps not alrighty so um",
    "start": "49840",
    "end": "55440"
  },
  {
    "text": "a little bit of introduction um i'm the maintainer of the linux manual pages project this is the project that",
    "start": "55440",
    "end": "61359"
  },
  {
    "text": "documents system calls and c library functions i've been doing this for a while",
    "start": "61359",
    "end": "67760"
  },
  {
    "text": "and i wrote a lot of those pages as well i wrote a book",
    "start": "68240",
    "end": "74000"
  },
  {
    "text": "these days um i i my primary business i'm a trainer by background though i'm",
    "start": "74000",
    "end": "79280"
  },
  {
    "text": "i'm a software engineer and the stuff i'm going to talk about in",
    "start": "79280",
    "end": "85280"
  },
  {
    "text": "this slot is sort of an introduction to you know what is it what are c groups an example or two",
    "start": "85280",
    "end": "92560"
  },
  {
    "text": "then a discussion of the kinds of things that we can control with c groups and there's various things that we can",
    "start": "92560",
    "end": "98320"
  },
  {
    "text": "control um and then a little bit of the mechanics about how how c groups well in",
    "start": "98320",
    "end": "105280"
  },
  {
    "text": "particular secrets version two work how you enable and disable controllers",
    "start": "105280",
    "end": "110799"
  },
  {
    "text": "um and um manage controls to different levels of",
    "start": "110799",
    "end": "116159"
  },
  {
    "text": "granularity in when you're managing processes and then there's another slot that comes after this which talks about",
    "start": "116159",
    "end": "121759"
  },
  {
    "text": "some of the more fine-grained details about how c-groups",
    "start": "121759",
    "end": "127040"
  },
  {
    "text": "work okay so a little bit of history",
    "start": "127040",
    "end": "133120"
  },
  {
    "text": "c groups it's been around as a feature for a long time started in 2006 there was a feature developed internally on",
    "start": "133120",
    "end": "139840"
  },
  {
    "text": "google's kernels but soon afterwards it got released into the mainline linux",
    "start": "139840",
    "end": "146080"
  },
  {
    "text": "kernel and at the beginning of 2008. at the beginning there were three",
    "start": "146080",
    "end": "151200"
  },
  {
    "text": "controllers that were all sort of cpu related functionality but pretty quickly",
    "start": "151200",
    "end": "157040"
  },
  {
    "text": "various other controllers got added because people looked on this idea and they saw that it was good and they",
    "start": "157040",
    "end": "162879"
  },
  {
    "text": "wanted one too the thing is the way this was done was",
    "start": "162879",
    "end": "168640"
  },
  {
    "text": "a diverse groups who did their own thing added their own controller for the thing",
    "start": "168640",
    "end": "175040"
  },
  {
    "text": "that they wanted to control and there was no sort of",
    "start": "175040",
    "end": "180080"
  },
  {
    "text": "global oversight no coordination no one managing all of this everyone did their own thing and added their own bit",
    "start": "180159",
    "end": "186879"
  },
  {
    "text": "and very soon things turned into a mess",
    "start": "186879",
    "end": "192159"
  },
  {
    "text": "as i like to say there's many examples of this in linux decentralized design failed us",
    "start": "192879",
    "end": "200319"
  },
  {
    "text": "again it didn't take long for people to realize there was a mess here and",
    "start": "200319",
    "end": "206159"
  },
  {
    "text": "already by 2012 not only are people recognized as a mess we're going to fix it and the",
    "start": "206159",
    "end": "212080"
  },
  {
    "text": "way we're going to fix it is let's do it do it over again",
    "start": "212080",
    "end": "217439"
  },
  {
    "text": "so 2012 the work starts already by 2015 system d supports secrets version 2",
    "start": "221200",
    "end": "227519"
  },
  {
    "text": "which is even before it is officially released in 2016. um so",
    "start": "227519",
    "end": "234000"
  },
  {
    "text": "2016 four years later secrets version 2 is officially released but it's incomplete what i mean by that is",
    "start": "234000",
    "end": "240480"
  },
  {
    "text": "there's a lot of controllers that were present in version one that were not yet present in version two",
    "start": "240480",
    "end": "249280"
  },
  {
    "text": "and crucially for example there was no cpu controller in secrets version 2 and that",
    "start": "249280",
    "end": "255200"
  },
  {
    "text": "was a big blocker for many people because that was that's an important controller",
    "start": "255200",
    "end": "261199"
  },
  {
    "text": "but things did progress and by 2019 fedora becomes the first distribution to",
    "start": "262320",
    "end": "268160"
  },
  {
    "text": "switch to using secrets version 2 by default docker adds cigarettes version 2 support",
    "start": "268160",
    "end": "274639"
  },
  {
    "text": "in 2020 and suddenly everyone else is rushing onto the bandwagon as well all the other",
    "start": "274639",
    "end": "281040"
  },
  {
    "text": "distributions this year pretty much are switching to sea groups version two by default so um ubuntu just switched days",
    "start": "281040",
    "end": "289520"
  },
  {
    "text": "ago debian a few months ago arch further back in time but i think it was this",
    "start": "289520",
    "end": "294960"
  },
  {
    "text": "year might have been last year other distributions either they've switched already or",
    "start": "294960",
    "end": "300880"
  },
  {
    "text": "they're going to switch soon so",
    "start": "300880",
    "end": "306400"
  },
  {
    "text": "there is a lot of existing infrastructure that depends on secrets version one but there's been a lot of migration work done as well and so",
    "start": "306400",
    "end": "314080"
  },
  {
    "text": "that's why i'm going to ignore secrets version one just talk about serious version two i'm gonna pretend",
    "start": "314080",
    "end": "320080"
  },
  {
    "text": "that version one doesn't exist",
    "start": "320080",
    "end": "324680"
  },
  {
    "text": "nevertheless it could well be that when you boot up your linux system you're booting into cigarettes version one by",
    "start": "325199",
    "end": "332560"
  },
  {
    "text": "default and you actually want to do some of this stuff try it out in secrets version two",
    "start": "332560",
    "end": "338000"
  },
  {
    "text": "probably the easiest thing for you to do is reboot your system so you actually use",
    "start": "338000",
    "end": "343759"
  },
  {
    "text": "secrets version two by default after boot and there's a couple of ways that you can um",
    "start": "343759",
    "end": "349759"
  },
  {
    "text": "do this oh and by the way you can tell what you perhaps have when you boot up by grabbing to see how many c group",
    "start": "349759",
    "end": "357039"
  },
  {
    "text": "lines there are in your proc mountains file and if there's more than one you probably need to re-boost",
    "start": "357039",
    "end": "364160"
  },
  {
    "text": "and when you reboot you can use one of two boot options you",
    "start": "364160",
    "end": "370400"
  },
  {
    "text": "know that the grub command line either you can say disable secrets version one",
    "start": "370400",
    "end": "377680"
  },
  {
    "text": "system d will then take that as a signal to say i only need to use secrets version two",
    "start": "377680",
    "end": "383440"
  },
  {
    "text": "alternatively instead of disabling secrets version one in the kernel you can tell system d hey",
    "start": "383440",
    "end": "390080"
  },
  {
    "text": "just use c groups version two and then it during the boot up process it only",
    "start": "390080",
    "end": "396000"
  },
  {
    "text": "mounts c groups version 2. it doesn't bother trying to mount series version 1. either way works but the second way you",
    "start": "396000",
    "end": "403919"
  },
  {
    "text": "could still use secrets version 1 if you felt inclined",
    "start": "403919",
    "end": "409840"
  },
  {
    "text": "once we've booted the c group file system and this is the point really that the interface to c",
    "start": "412560",
    "end": "418080"
  },
  {
    "text": "groups is a pseudo file system and that pseudo file system is mounted at a certain location um either cis fsc group",
    "start": "418080",
    "end": "426160"
  },
  {
    "text": "or csfs c group unified depending how we've booted it'll be at one of",
    "start": "426160",
    "end": "432720"
  },
  {
    "text": "those locations the pseudo file system that's mounted is",
    "start": "432720",
    "end": "438080"
  },
  {
    "text": "a file system of type c group 2. this",
    "start": "438080",
    "end": "444080"
  },
  {
    "text": "file system this mount point is sometimes called the unified hierarchy and the contrast here is with c groups",
    "start": "444080",
    "end": "450960"
  },
  {
    "text": "version one in cigarettes version two there is only one file system but in the secrets",
    "start": "450960",
    "end": "457840"
  },
  {
    "text": "version one there were many file systems in use many hierarchies this was",
    "start": "457840",
    "end": "465120"
  },
  {
    "text": "pretty messy and so one of the science decisions in secrets version 2 is let's have one hierarchy",
    "start": "465120",
    "end": "472080"
  },
  {
    "text": "and people call it the unified hierarchy",
    "start": "472080",
    "end": "477560"
  },
  {
    "text": "so what is this thing c groups essentially two components a",
    "start": "478240",
    "end": "483919"
  },
  {
    "text": "way of hierarchically grouping processes so you can have",
    "start": "483919",
    "end": "489280"
  },
  {
    "text": "c groups that have child c groups that have child c groups and so on in other words a tree of c groups that's one part",
    "start": "489280",
    "end": "496639"
  },
  {
    "text": "of it and the other thing is controllers in other words kernel components",
    "start": "496639",
    "end": "502960"
  },
  {
    "text": "that can do resource resource measurement",
    "start": "502960",
    "end": "508240"
  },
  {
    "text": "some kind of control on groups of processes rather than",
    "start": "508240",
    "end": "513440"
  },
  {
    "text": "individual processes so it's those two pieces and as i",
    "start": "513440",
    "end": "518560"
  },
  {
    "text": "mentioned already the interface is via a pseudo file system uh which means you interact with c",
    "start": "518560",
    "end": "525279"
  },
  {
    "text": "groups using in the ways you would normally interact with a file system you could do it from the shell and that's",
    "start": "525279",
    "end": "530399"
  },
  {
    "text": "what i'll do in a few examples or you could write a program that does is or you could use a daemon that does it for",
    "start": "530399",
    "end": "535839"
  },
  {
    "text": "you like system d system d has an interface for controlling c groups",
    "start": "535839",
    "end": "541040"
  },
  {
    "text": "and of course the container frameworks themselves are under the covers",
    "start": "541040",
    "end": "548080"
  },
  {
    "text": "using c groups to do their management of processes inside containers",
    "start": "548080",
    "end": "554800"
  },
  {
    "text": "what sort of things can you do one possibility is limiting resource usage to say that this group of",
    "start": "555760",
    "end": "561760"
  },
  {
    "text": "processes only gets a certain percentage of one cpu or this group of processes",
    "start": "561760",
    "end": "567120"
  },
  {
    "text": "only gets a certain amount of memory or a certain amount of network bandwidth",
    "start": "567120",
    "end": "573600"
  },
  {
    "text": "conversely you might turn things around and prioritize some group of processes",
    "start": "573600",
    "end": "579040"
  },
  {
    "text": "so they get more of a resource perhaps they get favored for the network bandwidth for their outgoing network",
    "start": "579040",
    "end": "585760"
  },
  {
    "text": "traffic some of the controllers",
    "start": "585760",
    "end": "591200"
  },
  {
    "text": "or some of the features of some of the controllers are just about doing resource measurement how much cpu time",
    "start": "591200",
    "end": "598000"
  },
  {
    "text": "is this group of processors consuming or how much memory are they consuming currently",
    "start": "598000",
    "end": "604480"
  },
  {
    "text": "and then there's some sort of funky controllers things like the freezer controller what the freezer",
    "start": "604480",
    "end": "610800"
  },
  {
    "text": "controller lets you do is say this group of processors freeze them take them off the cpu",
    "start": "610800",
    "end": "617120"
  },
  {
    "text": "off the cpu run queue the processors still exist they're just not getting cpu",
    "start": "617120",
    "end": "623279"
  },
  {
    "text": "time until later on you thaw them and there are some use cases for this to",
    "start": "623279",
    "end": "629200"
  },
  {
    "text": "do with containers so a bit of terminology we've got the",
    "start": "629200",
    "end": "635200"
  },
  {
    "text": "idea of a control group or a c group what i mean by that is a group of",
    "start": "635200",
    "end": "641600"
  },
  {
    "text": "processes that are being bound together for the purposes of resource management",
    "start": "641600",
    "end": "647680"
  },
  {
    "text": "in other words this group of processes sharing a memory allocation or sharing a cpu location",
    "start": "647680",
    "end": "655360"
  },
  {
    "text": "but together their use is being measured against that allocation rather than as individual",
    "start": "655360",
    "end": "661200"
  },
  {
    "text": "processes then we've got the notion of a resource controller and what i mean by a resource",
    "start": "661200",
    "end": "667440"
  },
  {
    "text": "controller is a component inside the kernel that does some sort of resource limitation",
    "start": "667440",
    "end": "674399"
  },
  {
    "text": "or resource measurement or some other kind of management of groups of",
    "start": "674399",
    "end": "679440"
  },
  {
    "text": "processes so for instance there's a memory controller that limits memory consumption or a cpu controller that",
    "start": "679440",
    "end": "686000"
  },
  {
    "text": "limits cpu consumption sometimes in documentation and inside",
    "start": "686000",
    "end": "691920"
  },
  {
    "text": "the kernel source code you'll see another term being used synonymously a",
    "start": "691920",
    "end": "697120"
  },
  {
    "text": "subsystem people talk about c group subsystems i don't really like this term very much it",
    "start": "697120",
    "end": "703360"
  },
  {
    "text": "is quite common problem for me is that the word subsystem is so generic as to be almost",
    "start": "703360",
    "end": "710160"
  },
  {
    "text": "meaningless so i prefer the term resource controller and the point about these c groups they",
    "start": "710160",
    "end": "716800"
  },
  {
    "text": "are arranged in a hierarchy each c group can have child c groups which have child",
    "start": "716800",
    "end": "722160"
  },
  {
    "text": "c groups and this hierarchy is meaningful so that for instance if you impose a limit on a high level c group",
    "start": "722160",
    "end": "729839"
  },
  {
    "text": "that limit applies to the lower level c groups as well",
    "start": "729839",
    "end": "735519"
  },
  {
    "text": "the interface as i've mentioned already it's a file system and you interact with this file system obviously doing file",
    "start": "736800",
    "end": "743200"
  },
  {
    "text": "system operations for example to create a c group what you do is make a directory on the file system simply the",
    "start": "743200",
    "end": "749920"
  },
  {
    "text": "act of making a directory creates a new c group when you want to get rid of that c group",
    "start": "749920",
    "end": "755760"
  },
  {
    "text": "you remove the directory each one of these directory directories",
    "start": "755760",
    "end": "761680"
  },
  {
    "text": "that we create has some automatically created files",
    "start": "761680",
    "end": "767440"
  },
  {
    "text": "and these files are used for a couple of purposes one is to manage the c group itself",
    "start": "767440",
    "end": "774320"
  },
  {
    "text": "things like which processes are members of the c group and the other thing is to do the",
    "start": "774320",
    "end": "779440"
  },
  {
    "text": "resource limitation functionality there are various files that you can whose values you can update to set limits for",
    "start": "779440",
    "end": "787040"
  },
  {
    "text": "the processes inside this c group some of the other files are doing things",
    "start": "787040",
    "end": "793200"
  },
  {
    "text": "like exposing information about the c group how much memory is being consumed how much cpu is being consumed and so on",
    "start": "793200",
    "end": "801360"
  },
  {
    "text": "so let's try an example and i have got some slides here but it's",
    "start": "801360",
    "end": "806560"
  },
  {
    "text": "so much more fun to do a live demo because things could go wrong",
    "start": "806560",
    "end": "811850"
  },
  {
    "text": "[Music] that's what everyone's here for really the mistakes um let's uh",
    "start": "811850",
    "end": "819440"
  },
  {
    "text": "try some stuff out so what i'm going to do is some experiments with the pids",
    "start": "819440",
    "end": "825199"
  },
  {
    "text": "controller and now i mentioned already that the file system is mounted at a location",
    "start": "825199",
    "end": "831120"
  },
  {
    "text": "like this and the file system is owned by super user",
    "start": "831120",
    "end": "837839"
  },
  {
    "text": "so i'm going to do all of these commands as super user so i'm just going to start up a",
    "start": "837839",
    "end": "843839"
  },
  {
    "text": "super user shell",
    "start": "843839",
    "end": "846800"
  },
  {
    "text": "it's a noisy prompt okay so",
    "start": "851760",
    "end": "857360"
  },
  {
    "text": "then i'm going to make a directory which i'll call",
    "start": "857360",
    "end": "864320"
  },
  {
    "text": "my group now i'm going to put this shell into that",
    "start": "864320",
    "end": "871680"
  },
  {
    "text": "group at least in a moment um now the",
    "start": "871680",
    "end": "877600"
  },
  {
    "text": "i want to check one or two things first though sis",
    "start": "877600",
    "end": "883320"
  },
  {
    "text": "already in that directory i didn't need to do that but i can just okay i've got a range of controllers",
    "start": "884000",
    "end": "890880"
  },
  {
    "text": "available to me i'll talk about some of these controllers a bit later on some of these controllers are enabled i'll talk",
    "start": "890880",
    "end": "898240"
  },
  {
    "text": "about these details a bit later on as well what i wanted to just check there is that the pids controller is enabled",
    "start": "898240",
    "end": "905600"
  },
  {
    "text": "and that means that i can do pids control in the child c group and so what",
    "start": "905600",
    "end": "911519"
  },
  {
    "text": "i'm going to do is move this shell into that c group",
    "start": "911519",
    "end": "919120"
  },
  {
    "text": "and the way i do that is by writing a pid into a file inside that directory",
    "start": "922720",
    "end": "929199"
  },
  {
    "text": "so the files see procs so now this shell is in that c group",
    "start": "929199",
    "end": "936000"
  },
  {
    "text": "one of things you can do with any process on the system is cat the file proc pid",
    "start": "936000",
    "end": "942800"
  },
  {
    "text": "c group",
    "start": "942800",
    "end": "945279"
  },
  {
    "text": "um cap the file proctored c group and you can discover the c group membership of the corresponding process",
    "start": "947839",
    "end": "955199"
  },
  {
    "text": "and what i see there is some colon delimited fields",
    "start": "955199",
    "end": "961440"
  },
  {
    "text": "if i was using a system that had both secrets version one and secrets version two i'd see several records in this file",
    "start": "961440",
    "end": "968480"
  },
  {
    "text": "but because i've booted up into secrets version two only mode which is the default on fedora",
    "start": "968480",
    "end": "973759"
  },
  {
    "text": "i see just one line here and that is the line the one that begins zero colon colon is the line that tells me about c",
    "start": "973759",
    "end": "980240"
  },
  {
    "text": "groups version two and this is telling me that in the secrets version two hierarchy this process is a member of",
    "start": "980240",
    "end": "986959"
  },
  {
    "text": "the c group with the path slash my group where my group of course is relative to the mount",
    "start": "986959",
    "end": "993759"
  },
  {
    "text": "point now that files",
    "start": "993759",
    "end": "1000240"
  },
  {
    "text": "cgroup.prox in the c group that i've just placed this shell",
    "start": "1000720",
    "end": "1006320"
  },
  {
    "text": "in we can write pids into that file to add processes to that cgroup we also read",
    "start": "1006320",
    "end": "1012880"
  },
  {
    "text": "that file and we see the the pids of the member processes now one",
    "start": "1012880",
    "end": "1018240"
  },
  {
    "text": "of those pids of course is the pid of the shell",
    "start": "1018240",
    "end": "1023680"
  },
  {
    "text": "guest is about what the other one is martin",
    "start": "1023680",
    "end": "1029678"
  },
  {
    "text": "okay it's the cat process because the cat process was created as a child of the shell",
    "start": "1029679",
    "end": "1035839"
  },
  {
    "text": "and child processes when they're created start their life in the same",
    "start": "1035839",
    "end": "1041678"
  },
  {
    "text": "c group as their as the parent process at least that's how it's always been",
    "start": "1041679",
    "end": "1047438"
  },
  {
    "text": "until relatively recently there is nowadays a feature that the limits kernel has and this was added in the",
    "start": "1047439",
    "end": "1052720"
  },
  {
    "text": "last year or so where you can say i want to create a new process that starts its life in a different c group it's an",
    "start": "1052720",
    "end": "1059679"
  },
  {
    "text": "option of the clone 3 system call some people wanted that functionality",
    "start": "1059679",
    "end": "1065440"
  },
  {
    "text": "okay now inside that file inside that directory",
    "start": "1065440",
    "end": "1073679"
  },
  {
    "text": "that's the wrong file i'm looking at there's another file and this is a file that relates to the",
    "start": "1076000",
    "end": "1081840"
  },
  {
    "text": "pids controller and this tells me how many processes are there in this c group",
    "start": "1081840",
    "end": "1089039"
  },
  {
    "text": "okay there's two one of them is the shell of course another one is this cat command that was just running there",
    "start": "1089039",
    "end": "1094799"
  },
  {
    "text": "momentarily now there is another file in that directory",
    "start": "1094799",
    "end": "1101600"
  },
  {
    "text": "called i meant to say cat",
    "start": "1102400",
    "end": "1109840"
  },
  {
    "text": "called pids.max and this allows me to find out what is the limit of the number of pids in the c",
    "start": "1112559",
    "end": "1120799"
  },
  {
    "text": "group and has the string max in at the moment which means there's no limit inside this",
    "start": "1120799",
    "end": "1127600"
  },
  {
    "text": "c group but i'm going to put a limit in there so i'm going to say echo",
    "start": "1127600",
    "end": "1133679"
  },
  {
    "text": "5 greater",
    "start": "1133679",
    "end": "1137840"
  },
  {
    "text": "video ids.max just verify that change",
    "start": "1140000",
    "end": "1146880"
  },
  {
    "text": "okay limit's now 5 and then i'm going to say for [Music]",
    "start": "1146880",
    "end": "1152400"
  },
  {
    "text": "j in seek one five in other words five times",
    "start": "1152400",
    "end": "1158960"
  },
  {
    "text": "to run a sleep process uh",
    "start": "1158960",
    "end": "1164480"
  },
  {
    "text": "sleep for 60 seconds in the background and done",
    "start": "1164480",
    "end": "1170960"
  },
  {
    "text": "now what happened was that the loop managed to create four sleep processes but when it tried to create the fifth",
    "start": "1171520",
    "end": "1178480"
  },
  {
    "text": "we'd already hit the limit of processes inside the c group now what bash is trying to now do now is retries i",
    "start": "1178480",
    "end": "1185039"
  },
  {
    "text": "couldn't create a process and it's gonna try again a few times and then it then it gives up",
    "start": "1185039",
    "end": "1191039"
  },
  {
    "text": "okay but the point is i've reached the limit of processes inside that c group",
    "start": "1191039",
    "end": "1197919"
  },
  {
    "text": "i could if i wanted to say cat pids dot current let's find out how",
    "start": "1197919",
    "end": "1205280"
  },
  {
    "text": "many processes are in the c group i could try that but of course",
    "start": "1205280",
    "end": "1210640"
  },
  {
    "text": "the cap process is a child of the shell so i can't create a cap process inside that c group but what i can do",
    "start": "1210640",
    "end": "1217919"
  },
  {
    "text": "and did i i should have carefully noted the pid of my shell back there",
    "start": "1217919",
    "end": "1223280"
  },
  {
    "text": "it is this pid what i can do is from a shell that is in",
    "start": "1223280",
    "end": "1229200"
  },
  {
    "text": "the in the root c group the root pid or the root c group i could then",
    "start": "1229200",
    "end": "1235200"
  },
  {
    "text": "instead say cat slash prop pids",
    "start": "1235200",
    "end": "1241440"
  },
  {
    "text": "p ideas dot",
    "start": "1241440",
    "end": "1245240"
  },
  {
    "text": "no i'm getting confused what am i doing i'm saying i should be i i've got myself a bit confused there cis fs",
    "start": "1250000",
    "end": "1257440"
  },
  {
    "text": "c group now i'm going to race against time of course because 60 seconds will run out",
    "start": "1257440",
    "end": "1263679"
  },
  {
    "text": "soon",
    "start": "1263679",
    "end": "1266080"
  },
  {
    "text": "okay i was too late okay let's try that again",
    "start": "1270400",
    "end": "1277120"
  },
  {
    "text": "run that loop okay and then down below",
    "start": "1277120",
    "end": "1283280"
  },
  {
    "text": "i've had the limit okay five processors in this group and the limit is five processes",
    "start": "1283280",
    "end": "1290840"
  },
  {
    "text": "okay i think i've covered everything's on these following slides now let me just double check",
    "start": "1295840",
    "end": "1303559"
  },
  {
    "text": "yes oh one more thing um",
    "start": "1306559",
    "end": "1313519"
  },
  {
    "text": "to remove a c group i just remove the directory so i could now",
    "start": "1314159",
    "end": "1319360"
  },
  {
    "text": "let's just my sleep processes are still running by the look of it yes",
    "start": "1319360",
    "end": "1325440"
  },
  {
    "text": "i could now say to remove the c group which was called my group",
    "start": "1325440",
    "end": "1330559"
  },
  {
    "text": "wrong window wrong window um i remember",
    "start": "1331280",
    "end": "1337520"
  },
  {
    "text": "i better go down here and become super user down here as well",
    "start": "1337520",
    "end": "1342679"
  },
  {
    "text": "[Music] c group my group",
    "start": "1351380",
    "end": "1360039"
  },
  {
    "text": "now that failed because the",
    "start": "1360720",
    "end": "1366400"
  },
  {
    "text": "cigarette i'm trying to remove is not empty in other words it either has child c",
    "start": "1366400",
    "end": "1371600"
  },
  {
    "text": "groups or member processes or both in this case it's got a member process",
    "start": "1371600",
    "end": "1377280"
  },
  {
    "text": "because the upper shell the shell on the top window is a member of that c group",
    "start": "1377280",
    "end": "1383200"
  },
  {
    "text": "so what i'm now going to do is move that oh well i can't do it that way can i oh",
    "start": "1383200",
    "end": "1388480"
  },
  {
    "text": "no no hang on no yes i can echo dollar dollar into",
    "start": "1388480",
    "end": "1394960"
  },
  {
    "text": "um cgroup 1. just to make this clear i'll write out the full path name",
    "start": "1394960",
    "end": "1403399"
  },
  {
    "text": "okay why did that work by the way why i couldn't run a cat command up",
    "start": "1414000",
    "end": "1419919"
  },
  {
    "text": "there before oh no i'm starting that's true i'm not at the limit anymore but even if i had been at the limit i could",
    "start": "1419919",
    "end": "1425360"
  },
  {
    "text": "have done this because echo is a shell built in it doesn't create another process",
    "start": "1425360",
    "end": "1431440"
  },
  {
    "text": "okay now if i now look at",
    "start": "1431440",
    "end": "1436640"
  },
  {
    "text": "cis fs c group",
    "start": "1436640",
    "end": "1441679"
  },
  {
    "text": "my group p ids pids.current there's no member processes",
    "start": "1441679",
    "end": "1447039"
  },
  {
    "text": "so now with a bit of luck i can remove that c group and it's gone",
    "start": "1447039",
    "end": "1454679"
  },
  {
    "text": "one of the things i didn't have to do inside that directory i didn't actually show we saw a few files inside that",
    "start": "1460000",
    "end": "1465679"
  },
  {
    "text": "directory things like pids.com pids.max and so on and secret.procs i",
    "start": "1465679",
    "end": "1471520"
  },
  {
    "text": "didn't have to remove those files before i remove directory",
    "start": "1471520",
    "end": "1476559"
  },
  {
    "text": "you can't remove those files if you try to you get an error okay but those are",
    "start": "1476559",
    "end": "1481600"
  },
  {
    "text": "just magic files that were made up on the fly by the kernel anyway and it's making up its own rules about what we can do about this do with the strength",
    "start": "1481600",
    "end": "1487760"
  },
  {
    "text": "tree and in this case for c group territories it says yeah you can delete those directories even if it looks like they have member fire member files",
    "start": "1487760",
    "end": "1496880"
  },
  {
    "text": "okay so quickly then to look at what controllers do we have what sort of things can we",
    "start": "1497200",
    "end": "1503600"
  },
  {
    "text": "control with with c groups and we've got a few different controllers",
    "start": "1503600",
    "end": "1509679"
  },
  {
    "text": "there is by the way in the kernel source tree a documentation file that talks about the various controllers",
    "start": "1509679",
    "end": "1517440"
  },
  {
    "text": "what have we got we've got a cpu controller what the cpu controller does of course is let you all let you do two",
    "start": "1517440",
    "end": "1523919"
  },
  {
    "text": "things really limit cpu usage and also measure cpu usage and the cpu controller",
    "start": "1523919",
    "end": "1531039"
  },
  {
    "text": "has a couple of modes of operation there's a so called shares mode or proportional weight division mode which",
    "start": "1531039",
    "end": "1537360"
  },
  {
    "text": "is uh the default mode and there's another mode called bandwidth control",
    "start": "1537360",
    "end": "1542720"
  },
  {
    "text": "and you can mix these two modes at different levels in the hierarchy if you",
    "start": "1542720",
    "end": "1547919"
  },
  {
    "text": "want now the way that the proportional weight division mode works is",
    "start": "1547919",
    "end": "1554320"
  },
  {
    "text": "at each level in the tree or in each branch of the tree there's a bunch of siblings at the same level here i've got",
    "start": "1554320",
    "end": "1560640"
  },
  {
    "text": "a b and c and each one of those um",
    "start": "1560640",
    "end": "1566720"
  },
  {
    "text": "c groups has some sort of weighting it was called shares in version one it's called weight in version two and what",
    "start": "1566720",
    "end": "1573760"
  },
  {
    "text": "happens is all the shares at one level are added together to make a total and then each c group gets its share of the",
    "start": "1573760",
    "end": "1581120"
  },
  {
    "text": "total so the total error of a b and c of course is 4096",
    "start": "1581120",
    "end": "1586559"
  },
  {
    "text": "and uh that would mean that the prices in cba are going to get one",
    "start": "1586559",
    "end": "1591760"
  },
  {
    "text": "quarter of the overall cpu time the processes in b are going to get one half",
    "start": "1591760",
    "end": "1597039"
  },
  {
    "text": "and the process in c again again going to get one quarter",
    "start": "1597039",
    "end": "1602720"
  },
  {
    "text": "it's a hierarchical controller they're all hierarchical controls but the the limits are hierarchical so",
    "start": "1602720",
    "end": "1610159"
  },
  {
    "text": "the resources that are distributed into b can be further subdivided at lower",
    "start": "1610159",
    "end": "1615440"
  },
  {
    "text": "levels so in the c group x and the c group y we've got some weight values of",
    "start": "1615440",
    "end": "1620480"
  },
  {
    "text": "one thousand and four thousand this means that the processes in c group x would get one-fifth",
    "start": "1620480",
    "end": "1627120"
  },
  {
    "text": "of one-half one-tenth of the overall cpu time the processes and y would get",
    "start": "1627120",
    "end": "1633840"
  },
  {
    "text": "four-fifths of one-half four-tenths of the overall cpu time",
    "start": "1633840",
    "end": "1639840"
  },
  {
    "text": "so on and so on you can further subdivide as many times you like using this this shares this weight mechanism",
    "start": "1639840",
    "end": "1647120"
  },
  {
    "text": "the way that this mechanism works by the way it only the limits only apply if",
    "start": "1647120",
    "end": "1652320"
  },
  {
    "text": "there is competition for the cpu so for instance if there are no processors in the",
    "start": "1652320",
    "end": "1658960"
  },
  {
    "text": "branches b and c that are trying to use the cpu but the processes in ni are trying to use the cpu flat out",
    "start": "1658960",
    "end": "1665760"
  },
  {
    "text": "they'll get a hundred percent of the cpu the the limits only apply if there is",
    "start": "1665760",
    "end": "1671120"
  },
  {
    "text": "competition now there is another mode which is what's called bandwidth control and",
    "start": "1671120",
    "end": "1677600"
  },
  {
    "text": "bandwidth control really is strict limits even if no one else is using the cpu you don't get more than your",
    "start": "1677600",
    "end": "1685679"
  },
  {
    "text": "allocation and the way that the bandwidth control mode works is",
    "start": "1685679",
    "end": "1692000"
  },
  {
    "text": "the the proportion of cpu that the processors get is expressed as two numbers a quota and a period and the quota",
    "start": "1692000",
    "end": "1699600"
  },
  {
    "text": "divided by the period of course expresses a fraction and that's the fraction of cpu that the processes in",
    "start": "1699600",
    "end": "1705679"
  },
  {
    "text": "this c group receive so here for example i'm assuming that in every one of these c groups the period",
    "start": "1705679",
    "end": "1711679"
  },
  {
    "text": "is one hundred thousand um the the the",
    "start": "1711679",
    "end": "1717200"
  },
  {
    "text": "processes in c group p would get twenty percent of the overall cpu time",
    "start": "1717200",
    "end": "1724159"
  },
  {
    "text": "also i'll rephrase that 20 at most 20 percent of the cpu time",
    "start": "1724159",
    "end": "1729520"
  },
  {
    "text": "um oh sorry i've jumped down level the process in a would get 50",
    "start": "1729520",
    "end": "1735600"
  },
  {
    "text": "below that the process in p would get 20 percent prices in q would get 40 process",
    "start": "1735600",
    "end": "1741279"
  },
  {
    "text": "in r would get 10 percent and yes there's some funniness in those numbers there",
    "start": "1741279",
    "end": "1746799"
  },
  {
    "text": "the children of i are over subscribed they've said that overall they can get",
    "start": "1746799",
    "end": "1752320"
  },
  {
    "text": "70 percent of the cpu but the parent can only get 50 percent so",
    "start": "1752320",
    "end": "1757919"
  },
  {
    "text": "if p q and r if the process is there all trying to use cpu they won't get 70",
    "start": "1757919",
    "end": "1763200"
  },
  {
    "text": "because there is a higher level limit that says 50 in this tree",
    "start": "1763200",
    "end": "1770240"
  },
  {
    "text": "and as i say this applies even if there is no competition for the cpu which is nice for hosting providers to say things",
    "start": "1770960",
    "end": "1777360"
  },
  {
    "text": "like you know you paid for this much cpu that's all you're going to get even if no one else is using the cpu",
    "start": "1777360",
    "end": "1785840"
  },
  {
    "text": "there's other controllers there's a controller called the cpu set controller what this",
    "start": "1786159",
    "end": "1792240"
  },
  {
    "text": "lets you do is choose the cpu affinity and the memory affinity of a group of",
    "start": "1792240",
    "end": "1797520"
  },
  {
    "text": "processes choose which cpus a group of processors is going to use and there's a",
    "start": "1797520",
    "end": "1803919"
  },
  {
    "text": "couple of reasons that you might do this one is that maybe you want to force most",
    "start": "1803919",
    "end": "1809919"
  },
  {
    "text": "processes off a certain cpu so that some process that really needs to seep that",
    "start": "1809919",
    "end": "1815120"
  },
  {
    "text": "cpu always has that cpu available to it another possibility is you're on a numa",
    "start": "1815120",
    "end": "1821360"
  },
  {
    "text": "system non-uniform memory access system these are boxes you know with very large numbers of cpus you know maybe 1024 cpus",
    "start": "1821360",
    "end": "1829520"
  },
  {
    "text": "and the cpus are organized into nodes where maybe there are 16 cpus in a node",
    "start": "1829520",
    "end": "1834559"
  },
  {
    "text": "each node has associated memory and",
    "start": "1834559",
    "end": "1840240"
  },
  {
    "text": "if a process execute well i'll rephrase it if a process xq on a certain cpu uses memory",
    "start": "1840720",
    "end": "1847840"
  },
  {
    "text": "in the local bank this is more efficient all the cpus can access all the memory",
    "start": "1847840",
    "end": "1852880"
  },
  {
    "text": "on all the nodes but accessing local memory is faster so it is desirable to ensure that in a",
    "start": "1852880",
    "end": "1860799"
  },
  {
    "text": "newer environment processes related processes run on the same node and they use memory associated",
    "start": "1860799",
    "end": "1867440"
  },
  {
    "text": "with that same node for reasons of efficient memory access this is one of the things that you can",
    "start": "1867440",
    "end": "1873760"
  },
  {
    "text": "bring about using the cpu set controller",
    "start": "1873760",
    "end": "1879120"
  },
  {
    "text": "we've got a memory controller memory control lets you limit the amount of memory that is being used",
    "start": "1879120",
    "end": "1885200"
  },
  {
    "text": "by a group of processors and for each c group you can set up a couple of limits a so-called soft limit if the processes",
    "start": "1885200",
    "end": "1892480"
  },
  {
    "text": "go over that soft limit they'll start getting swapped out if there is memory pressure",
    "start": "1892480",
    "end": "1898799"
  },
  {
    "text": "and there's a hard limit and if processors go over the hard limit then the um killer comes out to play the um",
    "start": "1898799",
    "end": "1906399"
  },
  {
    "text": "killer out of memory killer is a kernel component that is designed to relieve low memory situations by choosing a",
    "start": "1906399",
    "end": "1913919"
  },
  {
    "text": "victim a process to be eliminated and therefore freeing up memory for the",
    "start": "1913919",
    "end": "1919279"
  },
  {
    "text": "other processes the killer is",
    "start": "1919279",
    "end": "1925360"
  },
  {
    "text": "it's just a dumb kernel component what i mean is it doesn't have any intelligence about people's applications it picks a",
    "start": "1925360",
    "end": "1930960"
  },
  {
    "text": "victim there is an alternative with the memory controller where you can say um",
    "start": "1930960",
    "end": "1936960"
  },
  {
    "text": "if memory gets low send a notification to a user space process",
    "start": "1936960",
    "end": "1942559"
  },
  {
    "text": "and the user space process might make a more sensible decision about how to deal",
    "start": "1942559",
    "end": "1948000"
  },
  {
    "text": "with the low memory situation like saying picking which process to kill for example or telling various processes you",
    "start": "1948000",
    "end": "1954240"
  },
  {
    "text": "know it's you know we we're consuming too much memory you should terminate or you should release some memory in order",
    "start": "1954240",
    "end": "1960399"
  },
  {
    "text": "to relieve this low memory situation",
    "start": "1960399",
    "end": "1964799"
  },
  {
    "text": "other controllers there's an i o controller what this is about is limiting i o bandwidth",
    "start": "1965760",
    "end": "1971760"
  },
  {
    "text": "to block devices things like ssds hard disk drives and so on",
    "start": "1971760",
    "end": "1977519"
  },
  {
    "text": "um and you can uh again but like this the cpu control",
    "start": "1977519",
    "end": "1983039"
  },
  {
    "text": "there's two kinds of limitation that you can do um proportional weight division or",
    "start": "1983039",
    "end": "1988240"
  },
  {
    "text": "absolute throttling of the traffic and you can do this on a per device",
    "start": "1988240",
    "end": "1994399"
  },
  {
    "text": "basis of course there's a devices controller",
    "start": "1994399",
    "end": "2000080"
  },
  {
    "text": "this is one that is quite important for containers because one of things that you typically want to do in a container",
    "start": "2000080",
    "end": "2006720"
  },
  {
    "text": "is ensure that containers only can access a very limited set of",
    "start": "2006720",
    "end": "2011760"
  },
  {
    "text": "devices and this is what the devices controller allows you to do to choose",
    "start": "2011760",
    "end": "2016799"
  },
  {
    "text": "which devices the processes in a certain c group are",
    "start": "2016799",
    "end": "2022720"
  },
  {
    "text": "allowed to access for instance in a container a typical",
    "start": "2022720",
    "end": "2028799"
  },
  {
    "text": "use case is to ensure that processors can only access say devices null xero",
    "start": "2028799",
    "end": "2034480"
  },
  {
    "text": "full random and maybe one or two others",
    "start": "2034480",
    "end": "2038960"
  },
  {
    "text": "the devices controller looks very different in secrets version two than what was done in secrets version one and",
    "start": "2039760",
    "end": "2045760"
  },
  {
    "text": "secrets version two the way that this control is done is with an ebpf program",
    "start": "2045760",
    "end": "2053040"
  },
  {
    "text": "i like to say you're not a cool kid kernel developer these days if you're not trying to do something with ebpf",
    "start": "2053040",
    "end": "2058079"
  },
  {
    "text": "because everyone's trying to do it and the way that this ebpf program works",
    "start": "2058079",
    "end": "2064800"
  },
  {
    "text": "you can attach an ebpf program to a c group and when a process inside the c group tries to access the device open a",
    "start": "2064800",
    "end": "2071679"
  },
  {
    "text": "device or create a device the kernel kicks the bpf program into action and",
    "start": "2071679",
    "end": "2077358"
  },
  {
    "text": "the bpf program makes a decision is that kind of device access allowed or not",
    "start": "2077359",
    "end": "2084638"
  },
  {
    "text": "okay we can do network traffic control with",
    "start": "2084879",
    "end": "2090398"
  },
  {
    "text": "um with um c groups as well nowadays and well i'll rephrase that",
    "start": "2090399",
    "end": "2095839"
  },
  {
    "text": "with secrets version two there is now the facility to attach again an ebpf",
    "start": "2095839",
    "end": "2101200"
  },
  {
    "text": "program to c groups and the ebpf program does shaping of the network traffic so",
    "start": "2101200",
    "end": "2107760"
  },
  {
    "text": "you can cause some c groups network traffic to be favored or",
    "start": "2107760",
    "end": "2113119"
  },
  {
    "text": "disfavored there's a pids controller i've just",
    "start": "2113119",
    "end": "2118400"
  },
  {
    "text": "shown you that one limit the number of pids in a c group of course that's uh interesting for people who like to",
    "start": "2118400",
    "end": "2124560"
  },
  {
    "text": "prevent containers creating fork bombs that overrun the",
    "start": "2124560",
    "end": "2129920"
  },
  {
    "text": "system there's a freezer controller and i mentioned this one briefly already",
    "start": "2129920",
    "end": "2136160"
  },
  {
    "text": "what it allows you to do is freeze a group of processors take them off the cpu run queue",
    "start": "2136160",
    "end": "2142160"
  },
  {
    "text": "until they're later thawed and then they put back on the run queue again and they can",
    "start": "2142160",
    "end": "2149200"
  },
  {
    "text": "do stuff execute this is useful uh in particular due to",
    "start": "2149920",
    "end": "2156240"
  },
  {
    "text": "to do with container migration use cases the idea that you take a container running on one physical system and move",
    "start": "2156240",
    "end": "2164000"
  },
  {
    "text": "it over to run on another physical system perhaps because you're going to shut down the first system but you want",
    "start": "2164000",
    "end": "2170000"
  },
  {
    "text": "to keep the process inside the container running so you want to migrate the container",
    "start": "2170000",
    "end": "2175280"
  },
  {
    "text": "and there's a whole lot of work that needs to happen to make that work but the infrastructure is there part of",
    "start": "2175280",
    "end": "2181520"
  },
  {
    "text": "the infrastructure is you know when we finally decide that we're ready to move the processes over the other system we",
    "start": "2181520",
    "end": "2187760"
  },
  {
    "text": "want to freeze the process in the container and then move them over to the other system",
    "start": "2187760",
    "end": "2195200"
  },
  {
    "text": "there's a few other container controllers i'm not going to try and talk about any sort of detail but i just mentioned there are two or three other",
    "start": "2195599",
    "end": "2201440"
  },
  {
    "text": "controllers as well",
    "start": "2201440",
    "end": "2204640"
  },
  {
    "text": "now we've got i glossed over at the start",
    "start": "2206960",
    "end": "2213359"
  },
  {
    "text": "a detail about enabling and disabling controls and the point is that every in",
    "start": "2213359",
    "end": "2218560"
  },
  {
    "text": "every c group directory there are two um two files c group dot controllers and c",
    "start": "2218560",
    "end": "2225359"
  },
  {
    "text": "group dot subtree control and the first file tells us what controllers",
    "start": "2225359",
    "end": "2232000"
  },
  {
    "text": "are available in this c group and the other one says which of those available",
    "start": "2232000",
    "end": "2237040"
  },
  {
    "text": "controllers is enabled the reason these two files exist is",
    "start": "2237040",
    "end": "2244800"
  },
  {
    "text": "to allow us to manage different controllers to different depths within the tree in",
    "start": "2244800",
    "end": "2251200"
  },
  {
    "text": "other words managed controllers to different levels of granularity with respect to the processes on the system",
    "start": "2251200",
    "end": "2259680"
  },
  {
    "text": "so if we look inside the seagroup.controllers file we'll see some list of controllers here now i i was",
    "start": "2260320",
    "end": "2267359"
  },
  {
    "text": "just talking about the controllers before and i said there were about a dozen what you probably didn't count them but there are about a dozen controllers",
    "start": "2267359",
    "end": "2273760"
  },
  {
    "text": "and yet when you look inside this file inside the root c group you probably see a small a smaller number well you will",
    "start": "2273760",
    "end": "2279680"
  },
  {
    "text": "see a smaller number of um controllers and there's a couple of reasons why you",
    "start": "2279680",
    "end": "2285839"
  },
  {
    "text": "might not see so many controllers in this file one of them is",
    "start": "2285839",
    "end": "2293040"
  },
  {
    "text": "some controllers might also be in use in secrets version one and this is one of the points c group version two is",
    "start": "2293040",
    "end": "2299760"
  },
  {
    "text": "designed so it can co-exist with c groups version one",
    "start": "2299760",
    "end": "2304960"
  },
  {
    "text": "subject to a restriction which is if you use a controller in secrets version one you can't use it in secrets version 2.",
    "start": "2304960",
    "end": "2312160"
  },
  {
    "text": "so if i was on a system that had both secrets version 1 and secrets version 2 available",
    "start": "2312160",
    "end": "2318240"
  },
  {
    "text": "and i was using a certain controller on secrets version 1 then i wouldn't see it",
    "start": "2318240",
    "end": "2323359"
  },
  {
    "text": "in the cgroup.controllers file in the root of the version 2 hierarchy",
    "start": "2323359",
    "end": "2329280"
  },
  {
    "text": "so this is one reason why i might not see some controllers there there's another reason uh which is",
    "start": "2329280",
    "end": "2336240"
  },
  {
    "text": "uh well sorry there's another reason i'll come to in a moment but that was i was thinking of something else for a moment another reason you might not see",
    "start": "2336240",
    "end": "2341839"
  },
  {
    "text": "a c group i'm sorry a controller in a certain c group is it's not enabled in the parent c group",
    "start": "2341839",
    "end": "2348880"
  },
  {
    "text": "but there's also a certain set of controllers that are the so-called implicit controllers they are always",
    "start": "2348880",
    "end": "2355599"
  },
  {
    "text": "available everywhere in the version 2 hierarchy they don't need to be enabled",
    "start": "2355599",
    "end": "2360720"
  },
  {
    "text": "or disabled they're always available and because they're always available they are not listed in this",
    "start": "2360720",
    "end": "2366839"
  },
  {
    "text": "cgroup.control file so example an example of an implicit controller is the",
    "start": "2366839",
    "end": "2372400"
  },
  {
    "text": "freezer controller it's always available now",
    "start": "2372400",
    "end": "2380280"
  },
  {
    "text": "maybe rather than walking through slides i will show an example",
    "start": "2382480",
    "end": "2388320"
  },
  {
    "text": "so just here i'm in the root c group uh my current director is the root c",
    "start": "2394839",
    "end": "2401520"
  },
  {
    "text": "group and if i can't see group",
    "start": "2401520",
    "end": "2406640"
  },
  {
    "text": "dot controllers there's a certain set of controllers that are available",
    "start": "2406640",
    "end": "2412400"
  },
  {
    "text": "and if i can't subtree control there's a certain set of",
    "start": "2412400",
    "end": "2420079"
  },
  {
    "text": "controllers that are enabled at this level now the idea here is that if i enable a",
    "start": "2420079",
    "end": "2426880"
  },
  {
    "text": "controller at a certain level then i can do the corresponding control at the next",
    "start": "2426880",
    "end": "2433280"
  },
  {
    "text": "level down so what i'm going to do now is well in",
    "start": "2433280",
    "end": "2438400"
  },
  {
    "text": "fact no before i do that i'll make a child c group um i'll call it group one",
    "start": "2438400",
    "end": "2445680"
  },
  {
    "text": "now i'm going to look inside that child c group that i just created",
    "start": "2445680",
    "end": "2451400"
  },
  {
    "text": "there's a certain set of files there certain set of interface files now i'm just going to refine that slightly",
    "start": "2452400",
    "end": "2459040"
  },
  {
    "text": "that output the files that have the prefix cpu now",
    "start": "2459040",
    "end": "2466000"
  },
  {
    "text": "these two files they just give us statistics about cpu usage",
    "start": "2466000",
    "end": "2472160"
  },
  {
    "text": "in the c group these files are always present in every c group there are also files that are used by",
    "start": "2472160",
    "end": "2479200"
  },
  {
    "text": "the cpu controller but they are not present in this cigarette mode because the cpu",
    "start": "2479200",
    "end": "2485040"
  },
  {
    "text": "controller is not enabled at the level above okay just to remind you",
    "start": "2485040",
    "end": "2492160"
  },
  {
    "text": "at the level above the cpu controller is not enabled it's available but it's not enabled",
    "start": "2492160",
    "end": "2498079"
  },
  {
    "text": "so if i now turn around and enable that controller at the level above",
    "start": "2498079",
    "end": "2504319"
  },
  {
    "text": "and the way i do that is by writing a certain string into the subtree control file i've chosen the",
    "start": "2504319",
    "end": "2511520"
  },
  {
    "text": "wrong string of course",
    "start": "2511520",
    "end": "2515440"
  },
  {
    "text": "i and then just verify that change okay we now see cpu there and now if i",
    "start": "2517359",
    "end": "2523680"
  },
  {
    "text": "look in group 1 for the files cpu.star",
    "start": "2523680",
    "end": "2531520"
  },
  {
    "text": "a whole bunch of other files have just appeared those files have been created because i",
    "start": "2531520",
    "end": "2536560"
  },
  {
    "text": "enabled the controller at the level above so that now i can do control in the next level down",
    "start": "2536560",
    "end": "2543119"
  },
  {
    "text": "and so now for example i could",
    "start": "2543119",
    "end": "2549200"
  },
  {
    "text": "run a program down here",
    "start": "2549200",
    "end": "2553359"
  },
  {
    "text": "i've got a little program that burns up cpu time and tells us how much cpu time is being",
    "start": "2558480",
    "end": "2565119"
  },
  {
    "text": "uh what percentage of cpu time the process is getting and at the moment it's getting you know 100 of the cpu",
    "start": "2565119",
    "end": "2571760"
  },
  {
    "text": "that it wants now up above i'm now going to say",
    "start": "2571760",
    "end": "2578560"
  },
  {
    "text": "echo let's say twenty thousand",
    "start": "2578560",
    "end": "2585599"
  },
  {
    "text": "one hundred thousand this is the quota and the period that that expresses that fraction",
    "start": "2585599",
    "end": "2591520"
  },
  {
    "text": "that i was talking about before when i was talking about the cpu controller i'm going to put that into",
    "start": "2591520",
    "end": "2596960"
  },
  {
    "text": "group 1 cpu.max",
    "start": "2596960",
    "end": "2602839"
  },
  {
    "text": "just count that file okay the numbers are there",
    "start": "2603359",
    "end": "2609359"
  },
  {
    "text": "and then i'm going to move the process down below into that c group",
    "start": "2609359",
    "end": "2614640"
  },
  {
    "text": "so in",
    "start": "2614640",
    "end": "2618440"
  },
  {
    "text": "into group one slash",
    "start": "2623200",
    "end": "2627920"
  },
  {
    "text": "c group dot prox and",
    "start": "2628480",
    "end": "2635800"
  },
  {
    "text": "yeah okay we're gonna quickly enough converge to 20 cpu usage",
    "start": "2636480",
    "end": "2644680"
  },
  {
    "text": "okay now just continuing on from this um",
    "start": "2648240",
    "end": "2654960"
  },
  {
    "text": "uh this idea a little bit more at each level we can enable a controller in",
    "start": "2654960",
    "end": "2661040"
  },
  {
    "text": "order to do control at the next level down now if i look at the next level down in the group in the file group one",
    "start": "2661040",
    "end": "2669760"
  },
  {
    "text": "at the cgroup dot controllers file i see a certain set of controllers",
    "start": "2670560",
    "end": "2676319"
  },
  {
    "text": "available they are the ones that were enabled at the level above",
    "start": "2676319",
    "end": "2682400"
  },
  {
    "text": "okay just to remind you there if i say cat",
    "start": "2682400",
    "end": "2687839"
  },
  {
    "text": "sub tree control at the level above okay those were the ones that were enabled at the level above so they uh",
    "start": "2687839",
    "end": "2694640"
  },
  {
    "text": "sorry yeah they enabled the level above so they're available at the next level down",
    "start": "2694640",
    "end": "2700640"
  },
  {
    "text": "if i look at the next level down to see which controllers are",
    "start": "2700640",
    "end": "2707200"
  },
  {
    "text": "enabled to begin with no controllers are enabled at that level",
    "start": "2711760",
    "end": "2716960"
  },
  {
    "text": "so what that means is if i created the grandchild c group one group two",
    "start": "2716960",
    "end": "2724960"
  },
  {
    "text": "and then looked inside that directory i'd see a small set of files there",
    "start": "2726400",
    "end": "2733040"
  },
  {
    "text": "these are files that appear in every c group directory but there are no interface files that let me do any sort",
    "start": "2733040",
    "end": "2738800"
  },
  {
    "text": "of control because none of the controllers are enabled at the level above",
    "start": "2738800",
    "end": "2744160"
  },
  {
    "text": "but if i now said echo plus pids into",
    "start": "2744160",
    "end": "2749280"
  },
  {
    "text": "group into group one slash",
    "start": "2749280",
    "end": "2754880"
  },
  {
    "text": "c group uh procs did i do",
    "start": "2754880",
    "end": "2761839"
  },
  {
    "text": "actually i really meant to say cpu but uh",
    "start": "2761839",
    "end": "2767760"
  },
  {
    "text": "yes uh yeah okay it's been a busy week already",
    "start": "2768640",
    "end": "2774720"
  },
  {
    "text": "um into subtree control and then look in the grandchild",
    "start": "2774720",
    "end": "2780319"
  },
  {
    "text": "c group now a whole bunch of cpu file cpu",
    "start": "2780319",
    "end": "2786160"
  },
  {
    "text": "related files have appeared and this allows me to do cpu control at the next level down",
    "start": "2786160",
    "end": "2791359"
  },
  {
    "text": "likewise if i now said plus pids",
    "start": "2791359",
    "end": "2797400"
  },
  {
    "text": "now when looking at grandchild directory there's some pids files that have appeared",
    "start": "2798800",
    "end": "2806400"
  },
  {
    "text": "on the other hand if i tried to enable the i o controller",
    "start": "2806480",
    "end": "2814640"
  },
  {
    "text": "i get an error and that's because at this level the i o controller is not an available controller because it was not",
    "start": "2814640",
    "end": "2821680"
  },
  {
    "text": "enabled at the level above so what these two files the controllers",
    "start": "2821680",
    "end": "2829119"
  },
  {
    "text": "file and the subtree control file are enabling us to do is to enable different controllers to different",
    "start": "2829119",
    "end": "2836400"
  },
  {
    "text": "depths in different branches of the hierarchy and this enables us to do the",
    "start": "2836400",
    "end": "2841599"
  },
  {
    "text": "so-called granularity use case where certain controls weren't managed to a certain depth",
    "start": "2841599",
    "end": "2848000"
  },
  {
    "text": "a certain we want to perhaps want to manage we want fine-grained control of cpu",
    "start": "2848000",
    "end": "2853119"
  },
  {
    "text": "allocation to processes but we don't care so much about fine grain control of",
    "start": "2853119",
    "end": "2858160"
  },
  {
    "text": "memory allocation so we have the memory controller enabled to a certain depth in the hierarchy but",
    "start": "2858160",
    "end": "2864480"
  },
  {
    "text": "the cpu controller enabled at lower levels so that we can make fine-grained decisions about cpu allocation to",
    "start": "2864480",
    "end": "2872400"
  },
  {
    "text": "processes",
    "start": "2872400",
    "end": "2875119"
  },
  {
    "text": "is it is it strictly tree-like or can a child group have permissions that its parent doesn't have",
    "start": "2884480",
    "end": "2891359"
  },
  {
    "text": "i i presume what you mean by permissions is uh make use of controllers that is",
    "start": "2891359",
    "end": "2896559"
  },
  {
    "text": "parent and that is the point that for these uh explicit controls things like cpu and",
    "start": "2896559",
    "end": "2903359"
  },
  {
    "text": "and memory and so on the answer is no and that's that's the very point it has to come through the parent there",
    "start": "2903359",
    "end": "2910079"
  },
  {
    "text": "are these implicit controllers that are always available everywhere but for controllers like cpu and memory and",
    "start": "2910079",
    "end": "2917040"
  },
  {
    "text": "io they can only be used at a lower level if they were enabled at a level at the",
    "start": "2917040",
    "end": "2923359"
  },
  {
    "text": "level above",
    "start": "2923359",
    "end": "2926599"
  },
  {
    "text": "the parent needs to have that controller enabled the middle layer would need to have the controller enabled",
    "start": "2929359",
    "end": "2936160"
  },
  {
    "text": "okay i think i've covered pretty much what",
    "start": "2938160",
    "end": "2944400"
  },
  {
    "text": "what is on the slides just let me just double check",
    "start": "2944400",
    "end": "2949838"
  },
  {
    "text": "yes we did an example and i've talked about this granularity use case and",
    "start": "2951440",
    "end": "2957119"
  },
  {
    "text": "so the idea here is that we might enable some controllers to a certain depth",
    "start": "2957119",
    "end": "2962240"
  },
  {
    "text": "other controls to a deeper depth simply because we want to manage resources to different levels of granularity",
    "start": "2962240",
    "end": "2969680"
  },
  {
    "text": "and this is part of our design and that's as much as i have to say for",
    "start": "2969680",
    "end": "2974880"
  },
  {
    "text": "now but i'll take questions yes please",
    "start": "2974880",
    "end": "2980558"
  },
  {
    "text": "yes yes",
    "start": "2982240",
    "end": "2985839"
  },
  {
    "text": "yeah let's try that let's try that",
    "start": "2988319",
    "end": "2994640"
  },
  {
    "text": "so we've currently got a limit of 20 there so but if i now",
    "start": "2994640",
    "end": "3001280"
  },
  {
    "text": "see where is that line there we are",
    "start": "3001280",
    "end": "3008078"
  },
  {
    "text": "i could change that to",
    "start": "3008240",
    "end": "3012280"
  },
  {
    "text": "okay so let's just view the situation that we have yes so",
    "start": "3017200",
    "end": "3022319"
  },
  {
    "text": "in group one c group dot controllers",
    "start": "3022319",
    "end": "3028480"
  },
  {
    "text": "cpu is enable is available and it is",
    "start": "3028480",
    "end": "3033839"
  },
  {
    "text": "in enabled that's for the children of group one but",
    "start": "3033839",
    "end": "3039200"
  },
  {
    "text": "of course the process down below is is inside group one let's let's um",
    "start": "3039200",
    "end": "3046000"
  },
  {
    "text": "try saying echo minus cpu",
    "start": "3046000",
    "end": "3052000"
  },
  {
    "text": "in group one c group dot subtree control",
    "start": "3052000",
    "end": "3057760"
  },
  {
    "text": "okay now that's but that's for the children of group one this hasn't affect the processes that are in group one yeah",
    "start": "3057760",
    "end": "3065520"
  },
  {
    "text": "now then the question is if i s disabled the cpu controller",
    "start": "3065520",
    "end": "3072960"
  },
  {
    "text": "in the root c group",
    "start": "3072960",
    "end": "3077359"
  },
  {
    "text": "okay control's been taken away",
    "start": "3079599",
    "end": "3085040"
  },
  {
    "text": "christian",
    "start": "3086000",
    "end": "3089000"
  },
  {
    "text": "ah it's a nice question so if you've got some existing processes and you",
    "start": "3097200",
    "end": "3102559"
  },
  {
    "text": "uh enable a pid limit for the for the process already in an existing c group",
    "start": "3102559",
    "end": "3107920"
  },
  {
    "text": "what happens the what the pids controller is doing is",
    "start": "3107920",
    "end": "3113200"
  },
  {
    "text": "limiting the creation of new processes the existing processes are uneffective",
    "start": "3113200",
    "end": "3118240"
  },
  {
    "text": "now you might have set a limit of say 10 in a certain secret maybe there are 15 processes in the c group already that's",
    "start": "3118240",
    "end": "3124240"
  },
  {
    "text": "fine they'll stay and even the system administrator could move more processes in there if they wanted to by writing",
    "start": "3124240",
    "end": "3130160"
  },
  {
    "text": "pids into the c group or proxima but if any one of those processes tried to create a child process",
    "start": "3130160",
    "end": "3136800"
  },
  {
    "text": "the fork call would fail there would be an error",
    "start": "3136800",
    "end": "3142720"
  },
  {
    "text": "martin you mentioned",
    "start": "3142720",
    "end": "3146079"
  },
  {
    "text": "yes",
    "start": "3150319",
    "end": "3153319"
  },
  {
    "text": "so the question was is the the i mentioned that clone three it's the clone three system call has a facility",
    "start": "3157839",
    "end": "3165280"
  },
  {
    "text": "for saying i want to create a child process in a different c group from the parent a different version to c group",
    "start": "3165280",
    "end": "3171520"
  },
  {
    "text": "um the way that you specify the c group that you want to create the process in is",
    "start": "3171520",
    "end": "3176800"
  },
  {
    "text": "you open a file descriptor for a particular cgroup directory you would need to have permission to do",
    "start": "3176800",
    "end": "3182319"
  },
  {
    "text": "that now so not just anyone can do this sort of stuff",
    "start": "3182319",
    "end": "3188800"
  },
  {
    "text": "other questions yes please you're the first person's name i don't know",
    "start": "3190000",
    "end": "3195838"
  },
  {
    "text": "it's specifically devices yeah device inodes",
    "start": "3204319",
    "end": "3209838"
  },
  {
    "text": "um no but you're probably interested in other kinds of tools potentially things like",
    "start": "3213680",
    "end": "3220800"
  },
  {
    "text": "sc linux or app armor secrets isn't the job isn't this isn't the job",
    "start": "3220800",
    "end": "3226480"
  },
  {
    "text": "it isn't the thing for this job hello i don't know your name either but",
    "start": "3226480",
    "end": "3232079"
  },
  {
    "text": "hey um",
    "start": "3232079",
    "end": "3236119"
  },
  {
    "text": "ah you want to come back in the next hour the answer is yes",
    "start": "3240640",
    "end": "3246960"
  },
  {
    "text": "yes it's a feature called delegation",
    "start": "3246960",
    "end": "3251119"
  },
  {
    "text": "thomas yes you are sitting on that side of the room i ran a class at the beginning of",
    "start": "3254160",
    "end": "3260319"
  },
  {
    "text": "this week and thomas knew ikea was sitting on the same",
    "start": "3260319",
    "end": "3265040"
  },
  {
    "text": "well the program the programmatic aspect of it is you know people sometimes say to me is there a",
    "start": "3274559",
    "end": "3281200"
  },
  {
    "text": "c groups api and i say yes open close read and write",
    "start": "3281200",
    "end": "3288319"
  },
  {
    "text": "and and yeah people have in the past invented apis but those apis never seem",
    "start": "3288319",
    "end": "3296160"
  },
  {
    "text": "to have really taken off um i think they just didn't do the job well enough or give enough extra",
    "start": "3296160",
    "end": "3302720"
  },
  {
    "text": "functionality beyond just doing it yourself perhaps a more common way that people",
    "start": "3302720",
    "end": "3308960"
  },
  {
    "text": "might interact with c groups these days programmatically is via systemd",
    "start": "3308960",
    "end": "3314640"
  },
  {
    "text": "because systemd has some interfaces for doing this sort of thing",
    "start": "3314640",
    "end": "3320760"
  },
  {
    "text": "hello",
    "start": "3322000",
    "end": "3324400"
  },
  {
    "text": "you have to sorry you have to speak up for me i'm just a little bit i'm sorry",
    "start": "3329920",
    "end": "3335000"
  },
  {
    "text": "we saw content in there right yeah and remember these aren't real files they're just made up by the kernel",
    "start": "3347040",
    "end": "3354480"
  },
  {
    "text": "and the kernel shows you what it wants to show you yeah in a consistent way",
    "start": "3354480",
    "end": "3363078"
  },
  {
    "text": "well you might say you might say that you know real files the real disk files",
    "start": "3363680",
    "end": "3368960"
  },
  {
    "text": "wasn't made up by the computer at least i like to think of it that way some things are more made up than others",
    "start": "3368960",
    "end": "3377838"
  },
  {
    "text": "other questions i think we're about on the hour now oh and i've got a couple of minutes",
    "start": "3380079",
    "end": "3385680"
  },
  {
    "text": "so i will talk about some other features in the next hour one of them is delegation",
    "start": "3386240",
    "end": "3391599"
  },
  {
    "text": "um another one what are the oh gee i forgot what other things i'm going to talk",
    "start": "3391599",
    "end": "3396960"
  },
  {
    "text": "about a thread mode and delegation thread mode and",
    "start": "3396960",
    "end": "3402640"
  },
  {
    "text": "something else okay more detail about secrets version 2 basically",
    "start": "3402640",
    "end": "3408480"
  },
  {
    "text": "alrighty thank you [Applause]",
    "start": "3408480",
    "end": "3418320"
  }
]