[
  {
    "start": "0",
    "end": "112000"
  },
  {
    "text": "hello everybody I hope you're having a great time Australia has been very interesting I've enjoyed the visit so",
    "start": "10320",
    "end": "16529"
  },
  {
    "text": "far I hope you are as well today during this hour we're gonna be taking a look",
    "start": "16529",
    "end": "21990"
  },
  {
    "text": "at micro services at scale and although this is based on the way Bing manages",
    "start": "21990",
    "end": "27210"
  },
  {
    "text": "its services in production with its development teams and how it does its operations",
    "start": "27210",
    "end": "32369"
  },
  {
    "text": "I wanted to organize this talk in a way that was something that you could take",
    "start": "32369",
    "end": "37410"
  },
  {
    "text": "back with you so that it wasn't literally the same as Bing but was based",
    "start": "37410",
    "end": "43350"
  },
  {
    "text": "on things that are commercially available the azure in the visual studio product line and scaled down to a small",
    "start": "43350",
    "end": "49680"
  },
  {
    "text": "toy system that you could scale back up so that you could you could go back to your homes or offices with something",
    "start": "49680",
    "end": "55559"
  },
  {
    "text": "that that you can apply it in the interest of doing that I set it up in a",
    "start": "55559",
    "end": "62850"
  },
  {
    "text": "way that might potentially be a bad idea you can if you want to log in to the NDC",
    "start": "62850",
    "end": "68220"
  },
  {
    "text": "Bing Visual Studio com I created a guest user name and DC guest",
    "start": "68220",
    "end": "74039"
  },
  {
    "text": "at nd C bing.com and the password is hello Sydney v capital H capital S",
    "start": "74039",
    "end": "79560"
  },
  {
    "text": "number five that user should be read-only so you can take a look at the",
    "start": "79560",
    "end": "85020"
  },
  {
    "text": "code you can take a look at the release histories and things like that but you shouldn't be able to push code or change",
    "start": "85020",
    "end": "90240"
  },
  {
    "text": "things in deployment the one thing that you can do and I would ask you not to it's change the password I couldn't",
    "start": "90240",
    "end": "96390"
  },
  {
    "text": "figure out how to reset and stop password resets so if you do that basically you're just ruining it for",
    "start": "96390",
    "end": "101670"
  },
  {
    "text": "everybody else so if you do login there there is a project named Sydney and you",
    "start": "101670",
    "end": "107460"
  },
  {
    "text": "can click on the wiki to find a page that has links in it that said while",
    "start": "107460",
    "end": "114659"
  },
  {
    "start": "112000",
    "end": "203000"
  },
  {
    "text": "you're logging in there and feel free to if you want to a bit about myself I am currently like I said on the Bing team",
    "start": "114659",
    "end": "121290"
  },
  {
    "text": "prior to that I was on the asp net core team and helped rewrite asp net with",
    "start": "121290",
    "end": "127130"
  },
  {
    "text": "David Fowler and Damion Edwards and Barry dorrance I believe Barry and Damien are actually at this conference",
    "start": "127130",
    "end": "133980"
  },
  {
    "text": "so say hi from Lulu if you happen to bump into them and before that I did",
    "start": "133980",
    "end": "142199"
  },
  {
    "text": "work in the real world is as to working in Microsoft and that was largely in the online financial news and",
    "start": "142199",
    "end": "148620"
  },
  {
    "text": "data industry it was in market watch and big chart so and I did the sparkvue engine open source and Dow Jones and",
    "start": "148620",
    "end": "156150"
  },
  {
    "text": "that's why as asp net core became a 1.0 product i kind of looked at my career",
    "start": "156150",
    "end": "161819"
  },
  {
    "text": "path and found that I actually missed that production environment the the live site and you know how some doctors say",
    "start": "161819",
    "end": "168780"
  },
  {
    "text": "they they enjoy working in the emergency room that kind that kind of experience which is why I transitioned from being",
    "start": "168780",
    "end": "175200"
  },
  {
    "text": "brought from asp net core over to bing and oh also my wife always asks me when",
    "start": "175200",
    "end": "181919"
  },
  {
    "text": "i go to work if i talk about her or if i mention her presentations and of course the answer is no because she has she's not based on software but if you do",
    "start": "181919",
    "end": "189930"
  },
  {
    "text": "happen to see her she's the one on the right feel free to say hi her name has been Brenda so now now I can say I have",
    "start": "189930",
    "end": "196590"
  },
  {
    "text": "mentioned her in a presentation and hopefully she doesn't mind that picture otherwise I'll be in trouble but like I",
    "start": "196590",
    "end": "204480"
  },
  {
    "start": "203000",
    "end": "392000"
  },
  {
    "text": "say I my my own history has come from the online production live site realm",
    "start": "204480",
    "end": "211590"
  },
  {
    "text": "for for quite a while like a decade and then within Microsoft I've returned to it so there was a gap where I I wasn't",
    "start": "211590",
    "end": "219269"
  },
  {
    "text": "really involved in that from 2009 to 2017 and when I joined the Bing team",
    "start": "219269",
    "end": "225299"
  },
  {
    "text": "there were a couple of things that were actually kind of amazing when when I when I saw how their systems were",
    "start": "225299",
    "end": "230549"
  },
  {
    "text": "working and how their teams operated and one was that in 2009 there was a",
    "start": "230549",
    "end": "235889"
  },
  {
    "text": "distinct division between operations and development development is about making",
    "start": "235889",
    "end": "241259"
  },
  {
    "text": "change and deploying change or changing coding rolling it out operations is about stability if something breaks it's",
    "start": "241259",
    "end": "247590"
  },
  {
    "text": "because it changed so there's always that tension and back in the day they tried to separate those two even to the",
    "start": "247590",
    "end": "253620"
  },
  {
    "text": "point of having two departments where development would describe two operations what you need to do and operations would do it ironically that",
    "start": "253620",
    "end": "260009"
  },
  {
    "text": "made things even less stable because as long as you could write down the steps they would do anything you told them to do in 2017 the refreshing thing is it",
    "start": "260009",
    "end": "268229"
  },
  {
    "text": "seems like those roles have been merged back together into devops powered by automation and that's where that image",
    "start": "268229",
    "end": "275039"
  },
  {
    "text": "comes from the idea that a two meter tall person can be powering you know a 70 meter tall",
    "start": "275039",
    "end": "282009"
  },
  {
    "text": "utility mech and control thousands of machines one person can affect so much",
    "start": "282009",
    "end": "288339"
  },
  {
    "text": "capacity in a way that scales because one person can control any number of machines and that's that's the thing",
    "start": "288339",
    "end": "294729"
  },
  {
    "text": "that's kind of striking when I went to Bing was that it's so large you think it's intimidating but it's really a",
    "start": "294729",
    "end": "300189"
  },
  {
    "text": "website it's just that the slider is cranked all the way to the right in 2009",
    "start": "300189",
    "end": "306789"
  },
  {
    "text": "the buzzwords were continuous integration and test-driven development that you wrote tests and as you checked",
    "start": "306789",
    "end": "313719"
  },
  {
    "text": "in code it was constantly merged into the codebase and constantly tested and in 2017 has taken the next logical step",
    "start": "313719",
    "end": "320679"
  },
  {
    "text": "to continuous deployment continuous deployment being once the build is done you are going to production your master",
    "start": "320679",
    "end": "328240"
  },
  {
    "text": "branch's production and that requires a lot of automation and a lot of unit",
    "start": "328240",
    "end": "333519"
  },
  {
    "text": "testing and a lot of discipline it's that kind of setup that we're going to be taking a look at putting in place",
    "start": "333519",
    "end": "339219"
  },
  {
    "text": "with a commercial product line the reward for that is agility back in the",
    "start": "339219",
    "end": "346599"
  },
  {
    "text": "day there was six to four four to six week release cycles or sometimes four to six months depending on how large the",
    "start": "346599",
    "end": "352449"
  },
  {
    "text": "project was and banging genuinely deploys more than once a day it takes",
    "start": "352449",
    "end": "359259"
  },
  {
    "text": "four to six hours to release the entire application and that's kind of amazing",
    "start": "359259",
    "end": "367089"
  },
  {
    "text": "to me that it has that much automation yet that much size combined with that",
    "start": "367089",
    "end": "372849"
  },
  {
    "text": "much agility this is where it also really pushes towards the micro service",
    "start": "372849",
    "end": "377860"
  },
  {
    "text": "direction which is kind of service oriented architecture done correctly SOA kind of missed the ops part of it how do",
    "start": "377860",
    "end": "384159"
  },
  {
    "text": "you know where your service is running how they're talking to each other how do you make sure it's all live and and",
    "start": "384159",
    "end": "389709"
  },
  {
    "text": "you're aware of everything that's happening and so the system we're going to be taking a look at and basically a",
    "start": "389709",
    "end": "396879"
  },
  {
    "start": "392000",
    "end": "462000"
  },
  {
    "text": "model of how you set up this kind of thing is is basically these four parts you have production in the center and",
    "start": "396879",
    "end": "403659"
  },
  {
    "text": "none of this is rocket science this is not an amazing dazzling presentation this is very practical practical working kind of",
    "start": "403659",
    "end": "411760"
  },
  {
    "text": "common-sense things you have production in the center that's where your service fabric clusters are in your eyes REM",
    "start": "411760",
    "end": "417340"
  },
  {
    "text": "scale sets on the left your DevOps actor has two arms he needs to get code into",
    "start": "417340",
    "end": "424180"
  },
  {
    "text": "production and he needs to get telemetry out of it the actor on the right is your client",
    "start": "424180",
    "end": "429310"
  },
  {
    "text": "that is going to be getting information out of production through routing anything whether it's a mobile",
    "start": "429310",
    "end": "435100"
  },
  {
    "text": "application desktop application web request browser it all comes out of production through routing those three",
    "start": "435100",
    "end": "442570"
  },
  {
    "text": "code telemetry and routing if you implement those in a stable way you can",
    "start": "442570",
    "end": "447670"
  },
  {
    "text": "do as many development changes to prod as quickly as you want to in a way that",
    "start": "447670",
    "end": "452950"
  },
  {
    "text": "does not impact your availability and stability you can get as many nines as you want to you just have to set them up",
    "start": "452950",
    "end": "458590"
  },
  {
    "text": "properly and have a certain amount of discipline before I set this up like I",
    "start": "458590",
    "end": "464680"
  },
  {
    "start": "462000",
    "end": "607000"
  },
  {
    "text": "said I did want to do it in a way that you could take back and apply yourself so I started with a clean slate and I",
    "start": "464680",
    "end": "472590"
  },
  {
    "text": "also wanted to sort of place a constraint on myself to stay within a",
    "start": "472590",
    "end": "478810"
  },
  {
    "text": "budget I wanted to know how much this kind of thing would cost in practice if you did want to scale it out so I did it",
    "start": "478810",
    "end": "485140"
  },
  {
    "text": "first by creating an azure subscription on on my own you know credit card and a",
    "start": "485140",
    "end": "491650"
  },
  {
    "text": "visual studio team services account the average subscription envy STS were first",
    "start": "491650",
    "end": "497890"
  },
  {
    "text": "set up using a live login you know is a live.com Microsoft account you know I",
    "start": "497890",
    "end": "503440"
  },
  {
    "text": "think you can use Gmail or any other kind of accounts you want to but it should be must be two-factor off and you should not know",
    "start": "503440",
    "end": "510400"
  },
  {
    "text": "the password to your own login how many people show of hands have to factor off",
    "start": "510400",
    "end": "515409"
  },
  {
    "text": "and use a password manager okay if your hand is not up right now the reason it",
    "start": "515410",
    "end": "522250"
  },
  {
    "text": "should not be up is because it should be on your phone going to Gmail and turning on two-factor off and also searching for",
    "start": "522250",
    "end": "529420"
  },
  {
    "text": "a password manager like dashlane or don't actually cost $10 a year those are",
    "start": "529420",
    "end": "535070"
  },
  {
    "text": "invaluable if you are compromised in any way those will stop anything bad from",
    "start": "535070",
    "end": "542360"
  },
  {
    "text": "happening especially when you have something that's an account that's for personal or business use the third thing",
    "start": "542360",
    "end": "549110"
  },
  {
    "text": "that was on the shopping list after we have an azure subscription and visual studio team services set up is DNS",
    "start": "549110",
    "end": "557780"
  },
  {
    "text": "domain I set up NDC bing.com and that's the first thing that actually cost money",
    "start": "557780",
    "end": "563570"
  },
  {
    "text": "so for seven dollars I had a domain and then I set up an",
    "start": "563570",
    "end": "568760"
  },
  {
    "text": "azure aad domain called NDC Bing talk you do that in the azure portal what you",
    "start": "568760",
    "end": "575390"
  },
  {
    "text": "get within a ad domain are 5'4 users and you can create as many security groups",
    "start": "575390",
    "end": "580580"
  },
  {
    "text": "as you want to and then you can use those users and groups to put into roles for your address subscription and for V",
    "start": "580580",
    "end": "587960"
  },
  {
    "text": "STS so that login you saw at the beginning is a member of a group called vs readers and I took that security",
    "start": "587960",
    "end": "594680"
  },
  {
    "text": "group and put it into the azure subscription so you can go to the portal to log in and see the resources and you",
    "start": "594680",
    "end": "600230"
  },
  {
    "text": "can go into the STS and logon",
    "start": "600230",
    "end": "603519"
  },
  {
    "start": "607000",
    "end": "675000"
  },
  {
    "text": "once that was set up it was just a matter of doing everything else these",
    "start": "607240",
    "end": "614620"
  },
  {
    "text": "are the three different arms we were looking at before one for code one for routing one for telemetry and the kind",
    "start": "614620",
    "end": "622300"
  },
  {
    "text": "of service fabric clusters that are running in the center in production we're going to be taking a look at these",
    "start": "622300",
    "end": "628300"
  },
  {
    "text": "in about this order and it is it is",
    "start": "628300",
    "end": "634000"
  },
  {
    "text": "about what you would expect some of the routing is actually really interesting if you haven't seen an azure traffic",
    "start": "634000",
    "end": "639940"
  },
  {
    "text": "manager before we'll take a look at that it's very powerful if you want to get extremely high availability and then",
    "start": "639940",
    "end": "645580"
  },
  {
    "text": "failover in there the only two that do not scale disproportionately our dev and",
    "start": "645580",
    "end": "655000"
  },
  {
    "text": "ticketing systems so only the code development and only incident handling",
    "start": "655000",
    "end": "661560"
  },
  {
    "text": "are things that are limited by the number of humans involved everything else once you've set it up it can scale",
    "start": "661560",
    "end": "668350"
  },
  {
    "text": "disproportionately so very small teams can do very large work the first branch",
    "start": "668350",
    "end": "677170"
  },
  {
    "start": "675000",
    "end": "755000"
  },
  {
    "text": "we're going to jump into is the code branch how many people here are familiar with Visual Studio comm the STS team",
    "start": "677170",
    "end": "684460"
  },
  {
    "text": "services it's pretty good pretty good pretty good portion that was never actually my favorite historically I have",
    "start": "684460",
    "end": "690790"
  },
  {
    "text": "always been a fan of well you know it gets back in a day also team city cruise",
    "start": "690790",
    "end": "695980"
  },
  {
    "text": "control net Jenkins github of course for open source development it wasn't until coming to Bing that I",
    "start": "695980",
    "end": "702400"
  },
  {
    "text": "was first an actual active productive user individual studio.com account and I",
    "start": "702400",
    "end": "710170"
  },
  {
    "text": "have to say they have really they have really nailed that product I think in",
    "start": "710170",
    "end": "715720"
  },
  {
    "text": "the last couple of years especially for the build and deployment pipelines they have as well as their get source control",
    "start": "715720",
    "end": "723130"
  },
  {
    "text": "the thing that's a little lacking I think you would say is their ability to",
    "start": "723130",
    "end": "728440"
  },
  {
    "text": "support open source projects just because they don't give you the idea of an anonymous login and you know free any",
    "start": "728440",
    "end": "734860"
  },
  {
    "text": "number of people can fork off of your code so that's still where github really but if you are doing commercial work a",
    "start": "734860",
    "end": "741169"
  },
  {
    "text": "private work a visual studio is fantastic and like I say this has been set up without paying for it yet",
    "start": "741169",
    "end": "749649"
  },
  {
    "text": "so all of this stuff really had not hit",
    "start": "749649",
    "end": "756169"
  },
  {
    "start": "755000",
    "end": "962000"
  },
  {
    "text": "the point where I had to go beyond the free account in order to create",
    "start": "756169",
    "end": "761589"
  },
  {
    "text": "repositories and create any of these these kind of artifacts these four steps",
    "start": "761589",
    "end": "768529"
  },
  {
    "text": "are in Bing what we call the inner and outer loop kind of like a nested for",
    "start": "768529",
    "end": "773959"
  },
  {
    "text": "loop the dev is the inner loop so like an inner for loop it's more rapidly",
    "start": "773959",
    "end": "780619"
  },
  {
    "text": "iterating you check out code you make a feature branch you make changes you run",
    "start": "780619",
    "end": "785720"
  },
  {
    "text": "unit tests you push and you keep doing that and you're working with other people on the same branch and that is",
    "start": "785720",
    "end": "794809"
  },
  {
    "text": "pretty much exactly like you would expect it to be I mean here's a small example of a web application that we're",
    "start": "794809",
    "end": "801529"
  },
  {
    "text": "gonna be taking a look at and we'll walk a change through these four stages the",
    "start": "801529",
    "end": "807259"
  },
  {
    "text": "first is making a change let's see the",
    "start": "807259",
    "end": "813919"
  },
  {
    "text": "about page will say this is the NDC Bing demo web app you can run all of our unit",
    "start": "813919",
    "end": "823939"
  },
  {
    "text": "tests we can run the website itself this",
    "start": "823939",
    "end": "833689"
  },
  {
    "text": "is a asp net core running from the command line so there's no is involved",
    "start": "833689",
    "end": "839169"
  },
  {
    "text": "it's set up as an exe so it starts as an exe at lo Davis peanut chord listens on",
    "start": "839169",
    "end": "845299"
  },
  {
    "text": "a port and it serves a service one of the things you might be wondering is why",
    "start": "845299",
    "end": "851269"
  },
  {
    "text": "is it an ace peanut core exe if it's actually a service fabric application service fabric can host guest exe s so",
    "start": "851269",
    "end": "857989"
  },
  {
    "text": "that's that's actually kind of one of the ways I like to run it myself the project is set up so it will publish a",
    "start": "857989",
    "end": "864470"
  },
  {
    "text": "service fabric application folder layout but for development I really like the F",
    "start": "864470",
    "end": "870280"
  },
  {
    "text": "I've plain old Exe you know like the the whole UNIX mantra if it ain't broke",
    "start": "870280",
    "end": "875380"
  },
  {
    "text": "don't fix console applications are fantastic we have logging information coming out",
    "start": "875380",
    "end": "880990"
  },
  {
    "text": "this is Cyril log that's connected and we can see that I've got some list of thoughts added to the home page from my",
    "start": "880990",
    "end": "887680"
  },
  {
    "text": "Jack Handley the old Saturday Night Live bit and then the about page will see",
    "start": "887680",
    "end": "892930"
  },
  {
    "text": "that I have updated the the texture so it seems to work and we ship it by",
    "start": "892930",
    "end": "899350"
  },
  {
    "text": "jumping over to get and within get we",
    "start": "899350",
    "end": "905440"
  },
  {
    "text": "work on the right directory and say",
    "start": "905440",
    "end": "911970"
  },
  {
    "text": "updating the about text committin bush",
    "start": "911970",
    "end": "918720"
  },
  {
    "text": "yep new branch is fine tracking references fine",
    "start": "918780",
    "end": "924690"
  },
  {
    "text": "so now for the first time let's actually look at our visual studio account",
    "start": "926790",
    "end": "934760"
  },
  {
    "text": "within Visual Studio in the code we can see that there are multiple repositories",
    "start": "939650",
    "end": "947029"
  },
  {
    "text": "set up one for each microservice essentially so they each have their own history and in the website we do have a",
    "start": "947029",
    "end": "955040"
  },
  {
    "text": "new branch that was updated and we can create a pull request for this is now",
    "start": "955040",
    "end": "962600"
  },
  {
    "start": "962000",
    "end": "1008000"
  },
  {
    "text": "the first time we're entering into the second box there is a branch policy on",
    "start": "962600",
    "end": "968240"
  },
  {
    "text": "this repo that says you cannot push the master has everybody familiar with that",
    "start": "968240",
    "end": "975020"
  },
  {
    "text": "should I or should I show that quickly but we'll see if we have time we'll take a look at that in a second you cannot push to master there's a",
    "start": "975020",
    "end": "981230"
  },
  {
    "text": "policy on it that policy says that only changes can come in a master if they come through a pull request so let's",
    "start": "981230",
    "end": "988430"
  },
  {
    "text": "create a pull request the policy also says it must have at least one other",
    "start": "988430",
    "end": "993560"
  },
  {
    "text": "person review and approve and they can't be yourself for the purpose of the demo I said I can't improve my own changes",
    "start": "993560",
    "end": "998950"
  },
  {
    "text": "also it has to pass a build so there's already built in progress creating the",
    "start": "998950",
    "end": "1004990"
  },
  {
    "text": "pull request kicked off a build so the",
    "start": "1004990",
    "end": "1010000"
  },
  {
    "start": "1008000",
    "end": "1175000"
  },
  {
    "text": "first step in the pull request is creates a build that's going to compile run the unit test deploy to a testing",
    "start": "1010000",
    "end": "1015880"
  },
  {
    "text": "cluster run functional tests in addition to unit tests and only if all of these",
    "start": "1015880",
    "end": "1021940"
  },
  {
    "text": "have passed will it enable you to merge",
    "start": "1021940",
    "end": "1026550"
  },
  {
    "text": "as the build has been going in the background we can see how many steps it's gotten through already and like I",
    "start": "1032470",
    "end": "1042188"
  },
  {
    "text": "said I use console applications instead of service fabric applications and when you do that you do have a couple of",
    "start": "1042189",
    "end": "1048188"
  },
  {
    "text": "extra steps here this just copies the application manifest and service manifest in the right spot and then this",
    "start": "1048189",
    "end": "1054700"
  },
  {
    "text": "is running msbuild with the target being published and so it says in the code",
    "start": "1054700",
    "end": "1060730"
  },
  {
    "text": "subdirectory of that new folder put the Exe and all the things that you need to run so those two steps are basically",
    "start": "1060730",
    "end": "1068799"
  },
  {
    "text": "creating the service fabric application directory layout there is a built-in",
    "start": "1068799",
    "end": "1074320"
  },
  {
    "text": "task that you can use that says update service fabric app versions so the build number is going to be put in the end of",
    "start": "1074320",
    "end": "1080770"
  },
  {
    "text": "that service fabric application so it's 0.9 normally this is build 209 so my app",
    "start": "1080770",
    "end": "1086770"
  },
  {
    "text": "will be zero point nine point two oh nine and now it's deploying it to the",
    "start": "1086770",
    "end": "1092770"
  },
  {
    "text": "testing environment you can see the",
    "start": "1092770",
    "end": "1098470"
  },
  {
    "text": "version number there once it deploys to the test environment it should run functional tests I ran out of time I",
    "start": "1098470",
    "end": "1105159"
  },
  {
    "text": "don't have a functional test project in place but you have to imagine that functional tests ran after this",
    "start": "1105159",
    "end": "1111760"
  },
  {
    "text": "deployment finishes back at my",
    "start": "1111760",
    "end": "1117190"
  },
  {
    "text": "definition I can go to the pull request and we don't really need to wait for",
    "start": "1117190",
    "end": "1129750"
  },
  {
    "text": "this to finish because as this is going",
    "start": "1129750",
    "end": "1135220"
  },
  {
    "text": "on I can just say set autocomplete and to prove my own change there so now it's",
    "start": "1135220",
    "end": "1143710"
  },
  {
    "text": "going to wait for the bill to finish and I've already approved it this should be a co-worker not me but when this is",
    "start": "1143710",
    "end": "1149830"
  },
  {
    "text": "finished it will autocomplete how bills exceeded great and it merged the change",
    "start": "1149830",
    "end": "1155940"
  },
  {
    "text": "so we now have the change we made in master and like I said if you agree to",
    "start": "1155940",
    "end": "1162280"
  },
  {
    "text": "master the next step is going into production so your master because everything is a PR you have one change at a time they're",
    "start": "1162280",
    "end": "1169299"
  },
  {
    "text": "all squash merged and the rest of it is also automated the pull request is now",
    "start": "1169299",
    "end": "1177190"
  },
  {
    "start": "1175000",
    "end": "1436000"
  },
  {
    "text": "finished now it's time for continuous integration o CI continuous integration CD continuous",
    "start": "1177190",
    "end": "1182769"
  },
  {
    "text": "deployment the next step is continuous integration there is a build definition that triggers whenever master changes",
    "start": "1182769",
    "end": "1190979"
  },
  {
    "text": "let's jump over to the builds again this",
    "start": "1190979",
    "end": "1200440"
  },
  {
    "text": "is the build definition that was attached to the pull request policy this is the one that is attached to the",
    "start": "1200440",
    "end": "1206200"
  },
  {
    "text": "master branch commit appearing as you can see it's already in progress when",
    "start": "1206200",
    "end": "1214509"
  },
  {
    "text": "the pro request auto completed because the unit test succeeded for the PR this build was",
    "start": "1214509",
    "end": "1221049"
  },
  {
    "text": "created and it does mostly the same things and it's also getting ready to",
    "start": "1221049",
    "end": "1228090"
  },
  {
    "text": "basically finish up its work by deploying the service fabrica application to a testing cluster should",
    "start": "1228090",
    "end": "1234909"
  },
  {
    "text": "run tests and then it creates a drop we might even be able to see that happening",
    "start": "1234909",
    "end": "1241919"
  },
  {
    "text": "so as your automation is amazing it can do so many things see there it's",
    "start": "1245159",
    "end": "1251409"
  },
  {
    "text": "upgrading the background already so you can you can watch it happen in many different ways the automation is amazing",
    "start": "1251409",
    "end": "1258519"
  },
  {
    "text": "you can create a hundred machines in 15 minutes where it used to take an entire",
    "start": "1258519",
    "end": "1264460"
  },
  {
    "text": "team a weekend of you know install a thon and then they would all fly out to the data center and rack'em now it only",
    "start": "1264460",
    "end": "1271989"
  },
  {
    "text": "takes 15 minutes which is an awkward amount of time if it was 45 seconds we'd be hard to be talking about something",
    "start": "1271989",
    "end": "1277899"
  },
  {
    "text": "else right now because it's 15 minutes it's short enough to put in a demo but long enough that you have to",
    "start": "1277899",
    "end": "1283269"
  },
  {
    "text": "occasionally have these little parts where you're filling",
    "start": "1283269",
    "end": "1287729"
  },
  {
    "text": "the first two things we took a look at the pull request build and the continuous integration build those were",
    "start": "1296920",
    "end": "1302470"
  },
  {
    "text": "both build definitions Visual Studio for continuous deployment has a thing called a release definition how many people are",
    "start": "1302470",
    "end": "1309700"
  },
  {
    "text": "familiar with that maybe you have to ask got the other way around how many people have never heard of release definitions",
    "start": "1309700",
    "end": "1315130"
  },
  {
    "text": "in Visual Studio mmm all right I think there's a lot of dark matter here and I",
    "start": "1315130",
    "end": "1321160"
  },
  {
    "text": "don't think that added up to the total number of humans the release definition",
    "start": "1321160",
    "end": "1327400"
  },
  {
    "text": "can be thought of as kind of like a collection of environments and we'll",
    "start": "1327400",
    "end": "1334000"
  },
  {
    "text": "take a look at the website release definition it's a collection of",
    "start": "1334000",
    "end": "1340270"
  },
  {
    "text": "environments and here I have staging us east and us West defined and each",
    "start": "1340270",
    "end": "1346810"
  },
  {
    "text": "environment is a collection of tasks so",
    "start": "1346810",
    "end": "1351850"
  },
  {
    "text": "really what it is is it's kind of like a bunch of different builds each environment works like its own build",
    "start": "1351850",
    "end": "1358390"
  },
  {
    "text": "definition it's the same tasks even so if you have a task that deploys a service fabric app and you used it in",
    "start": "1358390",
    "end": "1364270"
  },
  {
    "text": "the build you can also use it in a release",
    "start": "1364270",
    "end": "1368340"
  },
  {
    "text": "the build definition here you can see it's already starting to go out to",
    "start": "1375920",
    "end": "1381870"
  },
  {
    "text": "staging the build definition here is set up to trigger staging for example I'm",
    "start": "1381870",
    "end": "1398370"
  },
  {
    "text": "getting a little lost here I don't remember how to find where the",
    "start": "1398370",
    "end": "1403890"
  },
  {
    "text": "deployment configurations are here we go staging for example will kick off as",
    "start": "1403890",
    "end": "1409950"
  },
  {
    "text": "soon as the release is created the release has created as soon as the build is complete so as soon as the build",
    "start": "1409950",
    "end": "1416520"
  },
  {
    "text": "completes it goes out to testing succeeds creates a drop folder as soon",
    "start": "1416520",
    "end": "1423690"
  },
  {
    "text": "as that drop folder is created the staging environment begins to play",
    "start": "1423690",
    "end": "1429590"
  },
  {
    "start": "1436000",
    "end": "1593000"
  },
  {
    "text": "so that's what this number three is it deploys the staging tests staging and",
    "start": "1437140",
    "end": "1442390"
  },
  {
    "text": "then deploys to all the production zones and then tests the production zones that's pretty much it like I said a lot",
    "start": "1442390",
    "end": "1450160"
  },
  {
    "text": "of this isn't very fancy but it is stable if you have functional tests at",
    "start": "1450160",
    "end": "1455860"
  },
  {
    "text": "each of those they should stop they should stop the deployment right there if you have circuit breakers that's the",
    "start": "1455860",
    "end": "1461710"
  },
  {
    "text": "way that you can have continuous deployment changes going out multiple times a day anything bad happens it",
    "start": "1461710",
    "end": "1467980"
  },
  {
    "text": "stops right there and that's something you can tell your new employees to and",
    "start": "1467980",
    "end": "1473410"
  },
  {
    "text": "they do it Bing and it's true if you are there for your first day and you make a change and you break the website that's",
    "start": "1473410",
    "end": "1479080"
  },
  {
    "text": "not your fault you get congratulated for that because you found a gap in the testing it should",
    "start": "1479080",
    "end": "1484809"
  },
  {
    "text": "not be possible for you to break the test and break the break the website by deploying code inside service fabric",
    "start": "1484809",
    "end": "1491890"
  },
  {
    "text": "when it deploys to a cluster I'm not sure if you're aware but it does it in 20 percent increments so it'll deploy 20",
    "start": "1491890",
    "end": "1498070"
  },
  {
    "text": "percent of the machines wait for them to see if they're stable or not and deploy another 20 percent and go forward from",
    "start": "1498070",
    "end": "1503740"
  },
  {
    "text": "there so even within those zones those zones are each 20 percent increments in",
    "start": "1503740",
    "end": "1510340"
  },
  {
    "text": "terms of 20 percent can go out it'll break and it'll revert so even within a",
    "start": "1510340",
    "end": "1516970"
  },
  {
    "text": "cluster it can do a partial deployment see that it's unhealthy and then rollback and that all happens within",
    "start": "1516970",
    "end": "1522130"
  },
  {
    "text": "this single task this deploy service fabric application tasks",
    "start": "1522130",
    "end": "1527370"
  },
  {
    "text": "well staging is deployed and now it's deploying the to production simultaneously we can jump into WW",
    "start": "1528240",
    "end": "1535660"
  },
  {
    "text": "staging and DC being calm if we're curious and you don't trust automation",
    "start": "1535660",
    "end": "1542380"
  },
  {
    "text": "or you want to get into it incrementally you can also go to an environment and say it needs manual confirmation to",
    "start": "1542380",
    "end": "1547960"
  },
  {
    "text": "proceed like you can put an exit gate on staging that says a human has to go here check it and then go back to visual",
    "start": "1547960",
    "end": "1553179"
  },
  {
    "text": "studio and give a thumbs up to continue to production but that's what we're doing right now is we are going to the",
    "start": "1553179",
    "end": "1559299"
  },
  {
    "text": "dub-dub-dub staging in DC going in the about and we can see that we now have this is the NDC Bing demo web app so our",
    "start": "1559299",
    "end": "1568360"
  },
  {
    "text": "changes made it all the way through you can even check here to see if we",
    "start": "1568360",
    "end": "1573480"
  },
  {
    "text": "have to plug it or not no hasn't ray traced us yet so that took I don't know",
    "start": "1573480",
    "end": "1578550"
  },
  {
    "text": "how long maybe deploying to service fabric itself is actually the long pole on this operation",
    "start": "1578550",
    "end": "1583590"
  },
  {
    "text": "but in that amount of time you can do a stable incremental deployment out to production the next thing that you need",
    "start": "1583590",
    "end": "1595290"
  },
  {
    "start": "1593000",
    "end": "1716000"
  },
  {
    "text": "to do is get that material out to the clients in the way that we basically",
    "start": "1595290",
    "end": "1601980"
  },
  {
    "text": "just did I went to WW staging and EC comm NDC bing.com and it routed me to",
    "start": "1601980",
    "end": "1608310"
  },
  {
    "text": "the staging implementation of that service the total topology and we've",
    "start": "1608310",
    "end": "1614070"
  },
  {
    "text": "also moved to the second arm of the three arms now we're talking about routing which is completely distinct",
    "start": "1614070",
    "end": "1619200"
  },
  {
    "text": "from code were there any questions on code probably not yeah",
    "start": "1619200",
    "end": "1626810"
  },
  {
    "text": "yes oh so every cluster it runs in an",
    "start": "1631240",
    "end": "1639710"
  },
  {
    "text": "adder region so it knows what region it's in and also when the applications deploy that deployment has given a",
    "start": "1639710",
    "end": "1646370"
  },
  {
    "text": "surface fabric variable for the environment itself and that is put into",
    "start": "1646370",
    "end": "1652250"
  },
  {
    "text": "place in the doodoo duty to do",
    "start": "1652250",
    "end": "1658809"
  },
  {
    "text": "environment variable HP net core environment so here we have a parameters for the different sort of zones so when",
    "start": "1658840",
    "end": "1667130"
  },
  {
    "text": "we're deploying to staging we use this file and it says the environment of staging that will go into an environment",
    "start": "1667130",
    "end": "1675950"
  },
  {
    "text": "variable at launch time so when the program starts up that you actually launches it has this environment variable that changes the HP net cor-ai",
    "start": "1675950",
    "end": "1683419"
  },
  {
    "text": "hosting environment dot environment property to staging that's where there's",
    "start": "1683419",
    "end": "1691850"
  },
  {
    "text": "a lot of little goodies buried in there which is why I kind of really do want to at the end of this talk turns maybe into",
    "start": "1691850",
    "end": "1699380"
  },
  {
    "text": "a github repo so that we can continue this and maybe I can turn into its own little toolkit but but this is how you",
    "start": "1699380",
    "end": "1705500"
  },
  {
    "text": "know you kind of get if it ain't broke don't fix it it's an exe with environment variables and when this instance is launched its told you are",
    "start": "1705500",
    "end": "1712340"
  },
  {
    "text": "running in staging to route to these the",
    "start": "1712340",
    "end": "1720380"
  },
  {
    "text": "way I have this organized is it's a very complex picture and then I deleted things until it was simple and then put",
    "start": "1720380",
    "end": "1726260"
  },
  {
    "text": "them in reverse order so the simplest thing to do is to have a DNS point and name pointing at an exe and this doesn't",
    "start": "1726260",
    "end": "1732650"
  },
  {
    "text": "scale of course because that service will eventually need to be running on a mainframe to handle your capacity so to",
    "start": "1732650",
    "end": "1738650"
  },
  {
    "text": "work around that you put a load balancer in place so several computers can each be running the program and the load",
    "start": "1738650",
    "end": "1744289"
  },
  {
    "text": "balancer decides which one is going to get the request whenever one arrives now that you have multiple axes you need",
    "start": "1744289",
    "end": "1750890"
  },
  {
    "text": "something like service fabric to manage them that's basically service fabrics job you have three computers or 30 and",
    "start": "1750890",
    "end": "1756980"
  },
  {
    "text": "you want five copies of the CXC it figures out where they're going to run and launch with them you now have a",
    "start": "1756980",
    "end": "1763130"
  },
  {
    "text": "different DNS name - the fabric cluster itself on port 19 no 80 we did see that briefly here so",
    "start": "1763130",
    "end": "1773360"
  },
  {
    "text": "this is the DNS name talking to service fabric exe itself and seeing the information it has about the state of",
    "start": "1773360",
    "end": "1778760"
  },
  {
    "text": "the universe as far as its concerned",
    "start": "1778760",
    "end": "1782800"
  },
  {
    "start": "1785000",
    "end": "1846000"
  },
  {
    "text": "that's fine for one service the second you have another service you have a",
    "start": "1785950",
    "end": "1791630"
  },
  {
    "text": "choice to make you can either have multiple domain names each pointing to a",
    "start": "1791630",
    "end": "1797090"
  },
  {
    "text": "different IP address and load balance those IP addresses to your different programs a different way you can",
    "start": "1797090",
    "end": "1803090"
  },
  {
    "text": "approach it is to have an additional service that you're right and call it a gateway which will receive any request",
    "start": "1803090",
    "end": "1810500"
  },
  {
    "text": "for starter comm so all requests for port start phu kham go through for her 3",
    "start": "1810500",
    "end": "1820040"
  },
  {
    "text": "or 82 the gateway and then the gateway based on the DNS name decides which service that they go to does that make",
    "start": "1820040",
    "end": "1827090"
  },
  {
    "text": "sense so the gateway talks to service fabric and says which computers is be running on and then it goes through that list",
    "start": "1827090",
    "end": "1834170"
  },
  {
    "text": "and order and then sends the request and returns the response so the Gateway is the request router the load balancer is",
    "start": "1834170",
    "end": "1841550"
  },
  {
    "text": "your TCP layer routing the last thing",
    "start": "1841550",
    "end": "1847190"
  },
  {
    "start": "1846000",
    "end": "2185000"
  },
  {
    "text": "you need to be really redundant and resilient is geo routing and you can't",
    "start": "1847190",
    "end": "1852260"
  },
  {
    "text": "really do that with a load balancer effectively but you can do it with Azure traffic manager which is a fascinating",
    "start": "1852260",
    "end": "1859040"
  },
  {
    "text": "piece of technology it operates at the DNS level so when you go into after",
    "start": "1859040",
    "end": "1864290"
  },
  {
    "text": "traffic manager you give it rules for a few com that say this DNS name and it's",
    "start": "1864290",
    "end": "1870950"
  },
  {
    "text": "not a TCP level thing it's a DNS level thing when somebody does a DNS lookup on that name it decides which of these two",
    "start": "1870950",
    "end": "1877640"
  },
  {
    "text": "clusters or both is currently serving that properly and then it responds with",
    "start": "1877640",
    "end": "1883430"
  },
  {
    "text": "the DNS information to connect to one of those two it can even use information about geo proximity so that your",
    "start": "1883430",
    "end": "1888890"
  },
  {
    "text": "customers go to a region that's closest to them at the time for performance reasons we can take a look at that",
    "start": "1888890",
    "end": "1896720"
  },
  {
    "text": "in the azure setup and I should add that",
    "start": "1896720",
    "end": "1903010"
  },
  {
    "text": "all of this relies on automation there is a repository that has the azure",
    "start": "1903010",
    "end": "1909860"
  },
  {
    "text": "resource manager templates that create all of these artifacts in the subscription and I created a release",
    "start": "1909860",
    "end": "1916820"
  },
  {
    "text": "definition that runs those templates for me so I don't run these manually I kick off a release and I tell it deploy the",
    "start": "1916820",
    "end": "1923840"
  },
  {
    "text": "environment which contains the arm templates to configure DNS you know what",
    "start": "1923840",
    "end": "1929360"
  },
  {
    "text": "I mean so I actually deploy my resources I don't run them from a PowerShell",
    "start": "1929360",
    "end": "1934370"
  },
  {
    "text": "locally yes mhm yep right now when we",
    "start": "1934370",
    "end": "1941630"
  },
  {
    "text": "were taking a look at WWE Jing and DC Bing this DNS name was actually taking a",
    "start": "1941630",
    "end": "1950720"
  },
  {
    "text": "look at these two region specific DNS names so there's two clusters and like I",
    "start": "1950720",
    "end": "1958910"
  },
  {
    "text": "said I was trying to be cheap I'm actually using the u.s. West cluster as staging and as testing as well as",
    "start": "1958910",
    "end": "1966080"
  },
  {
    "text": "production so I'm sort of overloading that one but it also makes for a good example of how the azure traffic manager",
    "start": "1966080",
    "end": "1973420"
  },
  {
    "text": "sees that staging is degraded in the east because the app has never been deployed there so by going to that DNS",
    "start": "1973420",
    "end": "1980330"
  },
  {
    "text": "name it's already doing its job sending us to the West US and then the West US",
    "start": "1980330",
    "end": "1986750"
  },
  {
    "text": "is taking this first part of the DNS name ww staging that first part is what's",
    "start": "1986750",
    "end": "1993320"
  },
  {
    "text": "used in service fabric to find out what service it should route to and I don't",
    "start": "1993320",
    "end": "1999890"
  },
  {
    "text": "know if you noticed but when you take a look at these clusters the fabric",
    "start": "1999890",
    "end": "2005860"
  },
  {
    "text": "application name matches that DNS name",
    "start": "2005860",
    "end": "2010080"
  },
  {
    "text": "see what I mean fabric ww testing is the",
    "start": "2013160",
    "end": "2018300"
  },
  {
    "text": "fabric application so the Gateway really doesn't have any brains to it it just takes the first part of the DNS name uses that as the service name asks where",
    "start": "2018300",
    "end": "2026130"
  },
  {
    "text": "it's running and forwards the requests to it",
    "start": "2026130",
    "end": "2029780"
  },
  {
    "text": "you can take a look at that code it's a little interesting",
    "start": "2036559",
    "end": "2041528"
  },
  {
    "text": "so it's implement it as an asp net core middleware no this is a custom gateway",
    "start": "2042100",
    "end": "2054108"
  },
  {
    "text": "there is a gateway that ships with service fabric it has a policy of putting the service name into the path",
    "start": "2054109",
    "end": "2060550"
  },
  {
    "text": "which unfortunately does kind of expose a service name in to parts of the path I like to keep the path unchanged which is",
    "start": "2060550",
    "end": "2067790"
  },
  {
    "text": "why I like to put the service name in the DNS oh you mean the to be able to",
    "start": "2067790",
    "end": "2082280"
  },
  {
    "text": "change that name yeah that's a setting that you can provide in that's one of those same files we were just looking at",
    "start": "2082280",
    "end": "2088419"
  },
  {
    "text": "here mm-hmm yep in the application parameters in the",
    "start": "2088419",
    "end": "2094158"
  },
  {
    "text": "application parameters for the different environments you get to say what the app name is mm-hmm so this is kind of its",
    "start": "2094159",
    "end": "2100970"
  },
  {
    "text": "trick but you can put DNS information in there if you want to get the information out of there and then here's how the",
    "start": "2100970",
    "end": "2107720"
  },
  {
    "text": "Gateway is working it's basically saying you know splitting the hostname up it",
    "start": "2107720",
    "end": "2114530"
  },
  {
    "text": "sees if the first part is numeric if it's numeric it's because the load balancer is doing that keep alive a",
    "start": "2114530",
    "end": "2120940"
  },
  {
    "text": "status health check which is the last thing we should mention about routing is",
    "start": "2120940",
    "end": "2128839"
  },
  {
    "text": "how these systems know if your app is",
    "start": "2128839",
    "end": "2134270"
  },
  {
    "text": "alive or not and that's a Status page so",
    "start": "2134270",
    "end": "2139400"
  },
  {
    "text": "the load balancer and the ATM the DNS based one so the alb a driller balancer",
    "start": "2139400",
    "end": "2145069"
  },
  {
    "text": "for TCP balancing and the ATM as your traffic manager for DNS balancing both",
    "start": "2145069",
    "end": "2150859"
  },
  {
    "text": "have probes that probe is basically sending an HTTP request to till the",
    "start": "2150859",
    "end": "2156109"
  },
  {
    "text": "status and looking for a 200 result code",
    "start": "2156109",
    "end": "2159970"
  },
  {
    "text": "so here we have it looks up what the service location is and then it forwards",
    "start": "2161750",
    "end": "2168180"
  },
  {
    "text": "it this really isn't I mean it's interesting but it's not interesting",
    "start": "2168180",
    "end": "2173310"
  },
  {
    "text": "enough to spend time looking at it does its job the request goes through it the",
    "start": "2173310",
    "end": "2186210"
  },
  {
    "start": "2185000",
    "end": "2285000"
  },
  {
    "text": "third and final part is telemetry so so",
    "start": "2186210",
    "end": "2191550"
  },
  {
    "text": "far we have a stable way of getting changes into the production we have a",
    "start": "2191550",
    "end": "2196740"
  },
  {
    "text": "stable way of getting requests out to the user oh it's worth mentioning",
    "start": "2196740",
    "end": "2203190"
  },
  {
    "text": "because of that tilde status any one of",
    "start": "2203190",
    "end": "2208380"
  },
  {
    "text": "these can go dark and it will route around it so you have to have many many simultaneous failures before you will",
    "start": "2208380",
    "end": "2214350"
  },
  {
    "text": "actually get a failed a failure situation you can even have a way of informing an application to stop doing",
    "start": "2214350",
    "end": "2221910"
  },
  {
    "text": "200s for the tilde status and that's a quick way of taking an app offline you can just decide I want service B not",
    "start": "2221910",
    "end": "2228420"
  },
  {
    "text": "come out of cluster one by flipping a bit somewhere and having service B stop",
    "start": "2228420",
    "end": "2233640"
  },
  {
    "text": "responding to hundreds to till the status requests in flight will still succeed the only thing it'll do is it'll",
    "start": "2233640",
    "end": "2240480"
  },
  {
    "text": "announce to the traffic manager stop sending new people to me so it'll eventually drain with without",
    "start": "2240480",
    "end": "2245820"
  },
  {
    "text": "any without any failures which is which is fantastic if you're trying to get four or five nines you you do need to",
    "start": "2245820",
    "end": "2252330"
  },
  {
    "text": "worry about how can you direct traffic away without suddenly killing the things",
    "start": "2252330",
    "end": "2257460"
  },
  {
    "text": "that are already in flight so we've",
    "start": "2257460",
    "end": "2262560"
  },
  {
    "text": "talked about getting code into production and we talked about routing requests the last part is telemetry",
    "start": "2262560",
    "end": "2268860"
  },
  {
    "text": "which is extremely important you have to know before your customers or before",
    "start": "2268860",
    "end": "2274890"
  },
  {
    "text": "your boss knows that something is going wrong and you have to have enough information to evaluate what's happening",
    "start": "2274890",
    "end": "2281880"
  },
  {
    "text": "and do something about it inside HP net core is a new logging",
    "start": "2281880",
    "end": "2288440"
  },
  {
    "start": "2285000",
    "end": "2347000"
  },
  {
    "text": "subsystem it's an abstraction really it pairs very well with sewer log which",
    "start": "2288440",
    "end": "2294640"
  },
  {
    "text": "has the idea of properties on events so when you see something in your code like",
    "start": "2294640",
    "end": "2299950"
  },
  {
    "text": "log or log information fetching a thought ID with a number this looks like",
    "start": "2299950",
    "end": "2306010"
  },
  {
    "text": "a console.writeline when you see all the text scroll by but when you put it into",
    "start": "2306010",
    "end": "2312040"
  },
  {
    "text": "a database like elasticsearch or elk this thought ID is actually a property it becomes a multi-dimensional database",
    "start": "2312040",
    "end": "2319810"
  },
  {
    "text": "that you can query any of these properties and kestrel the server in asp",
    "start": "2319810",
    "end": "2326020"
  },
  {
    "text": "net core and all of those subsystems they're also using this logger to say what events are happening within them so",
    "start": "2326020",
    "end": "2333940"
  },
  {
    "text": "if you put your application events in the same log stream and direct it someplace where you can you can navigate",
    "start": "2333940",
    "end": "2339520"
  },
  {
    "text": "it then the amount of information you have at your fingertips is tremendous",
    "start": "2339520",
    "end": "2346740"
  },
  {
    "text": "we've already seen this page run a few",
    "start": "2346740",
    "end": "2351910"
  },
  {
    "start": "2347000",
    "end": "2805000"
  },
  {
    "text": "times every time we visit one of these",
    "start": "2351910",
    "end": "2357280"
  },
  {
    "text": "pages in any of the environments it's creating a number of log messages and we",
    "start": "2357280",
    "end": "2362590"
  },
  {
    "text": "can jump over to an instance of elasticsearch I was going to set up",
    "start": "2362590",
    "end": "2368320"
  },
  {
    "text": "elasticsearch on the subscription to get an idea of how much it costs there are some templates created by elastic that",
    "start": "2368320",
    "end": "2374560"
  },
  {
    "text": "make it very practical to deploy but for expediency I just hooked up a demo logs",
    "start": "2374560",
    "end": "2382570"
  },
  {
    "text": "IO accountant so you can go here and get a 15-day free trial so you can experiment with how elastic search looks",
    "start": "2382570",
    "end": "2390160"
  },
  {
    "text": "and feels inside the application itself",
    "start": "2390160",
    "end": "2396480"
  },
  {
    "text": "the logging really doesn't look very complicated that that example is literally coming from some of the code",
    "start": "2397230",
    "end": "2405030"
  },
  {
    "text": "the logging is hooked up through seer log in a common dll so it's not code in",
    "start": "2405030",
    "end": "2411460"
  },
  {
    "text": "each exe I put it into a common nougat package and each exe imports that and",
    "start": "2411460",
    "end": "2417000"
  },
  {
    "text": "without doing anything it's specific in the application it just streams out to this target",
    "start": "2417000",
    "end": "2423299"
  },
  {
    "text": "you can take a look at a dashboard and some of the features of a solid logging",
    "start": "2423579",
    "end": "2429609"
  },
  {
    "text": "solution give you things like this is a query of the difference summaries per",
    "start": "2429609",
    "end": "2438099"
  },
  {
    "text": "request query so per request we can see what some of the status codes are what some of the latencies are and we can",
    "start": "2438099",
    "end": "2444369"
  },
  {
    "text": "also see here two charts and here's where you really start to play around",
    "start": "2444369",
    "end": "2450069"
  },
  {
    "text": "with the tools to see how many dashboards you need to get good visualization of the health of your",
    "start": "2450069",
    "end": "2455079"
  },
  {
    "text": "application everybody's application is different everybody's telemetry is different in this case there were so many tilde",
    "start": "2455079",
    "end": "2461650"
  },
  {
    "text": "status messages that it almost hid everything else so I created two queries one would tell the status one that",
    "start": "2461650",
    "end": "2467859"
  },
  {
    "text": "excluded tilde status so these are all of the health probes that we have for production staging and testing",
    "start": "2467859",
    "end": "2474549"
  },
  {
    "text": "environments and we can see how many are returning 200 and 400 so these 400 oh I",
    "start": "2474549",
    "end": "2482650"
  },
  {
    "text": "don't know we could we can experiment and drill down and see where those are coming from it might be some of the apps that are not running in the other",
    "start": "2482650",
    "end": "2488440"
  },
  {
    "text": "cluster ah no it's admin in this demo I set up W W and API so the website is",
    "start": "2488440",
    "end": "2495729"
  },
  {
    "text": "calling a Web API site to return data and display it I also set up admin as a",
    "start": "2495729",
    "end": "2501009"
  },
  {
    "text": "name but I never wrote in had been app so these four o fours are traffic",
    "start": "2501009",
    "end": "2506529"
  },
  {
    "text": "manager asking who's running admin and both of the clusters are saying 404 not me so that's why those have 404 here but",
    "start": "2506529",
    "end": "2513519"
  },
  {
    "text": "these are all the keeper lives these are all the status requests and here are the requests that are everything else",
    "start": "2513519",
    "end": "2521249"
  },
  {
    "text": "here we can jump in here and see these operations",
    "start": "2523880",
    "end": "2530920"
  },
  {
    "text": "one of them let's go here this this one",
    "start": "2535710",
    "end": "2543039"
  },
  {
    "text": "looks like an interesting response because it's for the /resources and you",
    "start": "2543039",
    "end": "2548769"
  },
  {
    "text": "can fold open this log message and see all the properties that are attached to it is this large enough can this be seen",
    "start": "2548769",
    "end": "2557440"
  },
  {
    "text": "or should I shred you this trick ok so here are all",
    "start": "2557440",
    "end": "2562869"
  },
  {
    "text": "the properties attached just to that single log message and we can also do",
    "start": "2562869",
    "end": "2569200"
  },
  {
    "text": "something like find this operation ID and say filter on it when I hit that",
    "start": "2569200",
    "end": "2577839"
  },
  {
    "text": "little plus it added this operation ID to the restrictions in the query and I",
    "start": "2577839",
    "end": "2585339"
  },
  {
    "text": "can pin it and go back to the full log which is just like all the messages",
    "start": "2585339",
    "end": "2591849"
  },
  {
    "text": "except that operation ID is now in effect so I'm taking a look at all the log messages from wrong request more",
    "start": "2591849",
    "end": "2603519"
  },
  {
    "text": "interestingly these are actually requests that go from the website to the",
    "start": "2603519",
    "end": "2608980"
  },
  {
    "text": "backend because this code has a system where when it makes a client request to",
    "start": "2608980",
    "end": "2615819"
  },
  {
    "text": "API is also running in the cluster it goes through a component that's adding the operation ID to the downstream",
    "start": "2615819",
    "end": "2623440"
  },
  {
    "text": "request so when the web application gets a request it makes up an operation ID and it flows down the rest of the way",
    "start": "2623440",
    "end": "2630240"
  },
  {
    "text": "so we can add additional fields here",
    "start": "2630240",
    "end": "2635589"
  },
  {
    "text": "like the application name",
    "start": "2635589",
    "end": "2639509"
  },
  {
    "text": "and see that this is actually a combination of the Gateway and the website and the web api all of the",
    "start": "2643910",
    "end": "2652170"
  },
  {
    "text": "things that happened across multiple exe s or any on multiple machines are in",
    "start": "2652170",
    "end": "2657510"
  },
  {
    "text": "this single story and it's in one sense",
    "start": "2657510",
    "end": "2664590"
  },
  {
    "text": "it's kind of an advertisement for elastic search the elastic table is",
    "start": "2664590",
    "end": "2670440"
  },
  {
    "text": "right outside this door and it is fantastic I encourage you to say hi and thank them for having a fantastic",
    "start": "2670440",
    "end": "2676140"
  },
  {
    "text": "product but there are lots of ways that you can kind of put this sort of log capturing and analytics together and",
    "start": "2676140",
    "end": "2683910"
  },
  {
    "text": "this is the kind of thing that you're going to need in order to troubleshoot especially once you start to do micro services because you don't know which",
    "start": "2683910",
    "end": "2690750"
  },
  {
    "text": "computer any particular service is running on it could be running on any computer it could be running in different data centers and you will need",
    "start": "2690750",
    "end": "2697350"
  },
  {
    "text": "to do things like say this operation executed in these 17 places I went to",
    "start": "2697350",
    "end": "2702690"
  },
  {
    "text": "see all of the logs at once once you have the kind of log navigation and a",
    "start": "2702690",
    "end": "2710340"
  },
  {
    "text": "visualization in place you're also going to want to create alerts once you know what your data is supposed to look like",
    "start": "2710340",
    "end": "2716340"
  },
  {
    "text": "you can start to create alerts that will set off alarms when it looks wrong for",
    "start": "2716340",
    "end": "2724590"
  },
  {
    "text": "example in this visualization we take a look at the exceptions that are happening maybe for the last four hours",
    "start": "2724590",
    "end": "2734040"
  },
  {
    "text": "I have to get rid of this operation ID constraint there we go and we can see",
    "start": "2734040",
    "end": "2739620"
  },
  {
    "text": "productions that have happened or exceptions that have happened in production exceptions that have happened",
    "start": "2739620",
    "end": "2744750"
  },
  {
    "text": "in staging and what exception class they were and this is just because I these",
    "start": "2744750",
    "end": "2750750"
  },
  {
    "text": "are panels I put together because they seemed like interesting queries again you play with a tool you find queries",
    "start": "2750750",
    "end": "2756030"
  },
  {
    "text": "that are meaningful to your domain and you and you put them up ah interesting",
    "start": "2756030",
    "end": "2761980"
  },
  {
    "text": "Kestrel through a bad HTTP request exception somebody is attacking the web",
    "start": "2761980",
    "end": "2767380"
  },
  {
    "text": "application so there's a lot of things that happen in the dark that you don't know about things like being attacked",
    "start": "2767380",
    "end": "2773710"
  },
  {
    "text": "with malicious requests there's BOTS out there that are trolling and looking for things left and right and it's it's amazing what you can",
    "start": "2773710",
    "end": "2781510"
  },
  {
    "text": "uncover when you look for it even just spending a day leafing through the logs",
    "start": "2781510",
    "end": "2787630"
  },
  {
    "text": "you'll find bugs in your program you didn't even know we're there on top of the benefit of being alarmed to alert it",
    "start": "2787630",
    "end": "2794680"
  },
  {
    "text": "when when the application is you know genuinely down for something that you know might have happened and took into account so that actually has gone",
    "start": "2794680",
    "end": "2806650"
  },
  {
    "start": "2805000",
    "end": "3175000"
  },
  {
    "text": "through the three different arms of the",
    "start": "2806650",
    "end": "2813040"
  },
  {
    "text": "kind of production architecture we can spend the rest of the time jumping into",
    "start": "2813040",
    "end": "2819730"
  },
  {
    "text": "some of the common code that is in place to hook up these features through things",
    "start": "2819730",
    "end": "2827530"
  },
  {
    "text": "like seer log but I should stop and ask if there are any questions that people have on this sort of like architectural",
    "start": "2827530",
    "end": "2833830"
  },
  {
    "text": "setup Before we jump into the actual implementation",
    "start": "2833830",
    "end": "2837869"
  },
  {
    "text": "well and so the question the question was they are using a lot of this technology in production and they are",
    "start": "2878430",
    "end": "2884650"
  },
  {
    "text": "seeing some issues that seem to arise from service fabric itself specifically when you're doing stateful services some",
    "start": "2884650",
    "end": "2891670"
  },
  {
    "text": "of the partitions seem to go rolled some of the information seems to need to get a hard hard reset before it'll become",
    "start": "2891670",
    "end": "2899410"
  },
  {
    "text": "green again exactly yeah for that reason you might have noticed",
    "start": "2899410",
    "end": "2907599"
  },
  {
    "text": "that these are all gas deoxys it's not really using service fabric features these aren't even really stateless",
    "start": "2907599",
    "end": "2913690"
  },
  {
    "text": "services so the extent to which this demonstration and some of the systems within Bing",
    "start": "2913690",
    "end": "2919300"
  },
  {
    "text": "our using service fabric is as a process manager so we keep state in systems that",
    "start": "2919300",
    "end": "2928119"
  },
  {
    "text": "are optimized for storing state like that blob storage and the well and you",
    "start": "2928119",
    "end": "2938740"
  },
  {
    "text": "know it depends they give you a tool they give you a tool and so you know like any tool you you evaluate it you",
    "start": "2938740",
    "end": "2944800"
  },
  {
    "text": "you see if it's comfortable you see if if you know if the bandsaw is taking your fingers off too many times I'm",
    "start": "2944800",
    "end": "2955329"
  },
  {
    "text": "really the wrong person to ask like I say I came from asp net core and also",
    "start": "2955329",
    "end": "2960430"
  },
  {
    "text": "from you know other production rooms in working in Bing so my take on it is there are a lot of cluster managers",
    "start": "2960430",
    "end": "2966940"
  },
  {
    "text": "available mesosphere kubernetes service fabric they can be used in a way where",
    "start": "2966940",
    "end": "2972160"
  },
  {
    "text": "they are sort of like a resource management and load balancing and I I",
    "start": "2972160",
    "end": "2978130"
  },
  {
    "text": "suppose in the short term until until you can see that those are resolved you might want to lean more on things like",
    "start": "2978130",
    "end": "2983470"
  },
  {
    "text": "you know the blob storage or the or the attached you know sequel databases for persistence hmm the question",
    "start": "2983470",
    "end": "2993270"
  },
  {
    "text": "ah okay thank you so service fabric",
    "start": "2993450",
    "end": "2999900"
  },
  {
    "text": "itself is the expensive part at the end of the day when you have a cluster it",
    "start": "2999900",
    "end": "3005599"
  },
  {
    "text": "needs to run on virtual machines and the smallest VM though the question was related to the total cost at the end of",
    "start": "3005599",
    "end": "3011030"
  },
  {
    "text": "the day the smallest VM size on Azure that you can use for service fabric is a d 2v2 not a ds2 v2 but a d 2v2 and those",
    "start": "3011030",
    "end": "3020780"
  },
  {
    "text": "I believe are about a hundred maybe 140 per server per month within a cluster",
    "start": "3020780",
    "end": "3026990"
  },
  {
    "text": "you can do a dev or staging cluster with three machines if you go for bronze",
    "start": "3026990",
    "end": "3032410"
  },
  {
    "text": "reliability durability but for production clusters they say the minimum is five so five d2v twos in two data",
    "start": "3032410",
    "end": "3042050"
  },
  {
    "text": "centers would be sort of the minbar for industrial production application so",
    "start": "3042050",
    "end": "3049730"
  },
  {
    "text": "you're probably looking at ballpark about a thousand a month twelve thousand a year for budget everything else is",
    "start": "3049730",
    "end": "3057560"
  },
  {
    "text": "fairly cheap the other thing that I spent money on was $30 on visual studio",
    "start": "3057560",
    "end": "3063500"
  },
  {
    "text": "comm to add more build agents because the free lets you use one build agent which means my environments in my builds",
    "start": "3063500",
    "end": "3070190"
  },
  {
    "text": "were lining up behind each other so by paying that $30 a month it was it was it",
    "start": "3070190",
    "end": "3076040"
  },
  {
    "text": "made it possible to have simultaneous builds going on and simultaneous deployments going on so this demo is",
    "start": "3076040",
    "end": "3085369"
  },
  {
    "text": "made up of two clusters of three machines each and I killed them overnight I turned them off deallocate",
    "start": "3085369",
    "end": "3092210"
  },
  {
    "text": "and and that comes to one of the things you're mentioning when you deallocate a machine it actually gets rid of the D Drive so when you reallocate them in the",
    "start": "3092210",
    "end": "3100250"
  },
  {
    "text": "morning they are amnesiac they have no applications they have no state so when",
    "start": "3100250",
    "end": "3105800"
  },
  {
    "text": "you turn them back on you have to redeploy the last known good web application so that's something else",
    "start": "3105800",
    "end": "3111619"
  },
  {
    "text": "to keep in mind in production if your fabric cluster needs to be torn down or",
    "start": "3111619",
    "end": "3117079"
  },
  {
    "text": "restarted or if something really bad happens you should know what the last known good version of each of your",
    "start": "3117079",
    "end": "3122300"
  },
  {
    "text": "applications was so that you can go to visual studio comm wipe the cluster to play them all and be back up and",
    "start": "3122300",
    "end": "3128310"
  },
  {
    "text": "running within an hour maybe 45 minutes depending on how quickly the automation can run yeah",
    "start": "3128310",
    "end": "3135990"
  },
  {
    "text": "the advantage you get there though with those d 2v2 s is the minimum size is about 10 of those but now you have 20",
    "start": "3135990",
    "end": "3142920"
  },
  {
    "text": "CPUs in the world and you can run a lot more properties than than those 20 machines so you can run 30 40 50",
    "start": "3142920",
    "end": "3150480"
  },
  {
    "text": "different micro services on those machines you only need to grow out once you start",
    "start": "3150480",
    "end": "3156090"
  },
  {
    "text": "to utilize all of the CPU that they have available if that makes sense so in the",
    "start": "3156090",
    "end": "3163140"
  },
  {
    "text": "long haul they're more efficient than doing like a PA's v1 because there you have one virtual machine per web",
    "start": "3163140",
    "end": "3169920"
  },
  {
    "text": "application mm-hmm all right",
    "start": "3169920",
    "end": "3175550"
  },
  {
    "start": "3175000",
    "end": "3472000"
  },
  {
    "text": "the other things we can take a look at or maybe some of these common libraries",
    "start": "3175550",
    "end": "3181340"
  },
  {
    "text": "like I mentioned there is an API which is returning thoughts that are being",
    "start": "3181340",
    "end": "3187710"
  },
  {
    "text": "displayed on the front of the site",
    "start": "3187710",
    "end": "3192440"
  },
  {
    "text": "and so it has two applications one for the front end and one for the back end they both reference a common library",
    "start": "3196440",
    "end": "3202650"
  },
  {
    "text": "that common library exists in its own get repo and it creates a new Capac egde",
    "start": "3202650",
    "end": "3208800"
  },
  {
    "text": "and pushes it onto a feed both of the other websites depend on that nougat",
    "start": "3208800",
    "end": "3214620"
  },
  {
    "text": "package and in Visual Studio you can create your own nougat feeds and push things to them so the common code",
    "start": "3214620",
    "end": "3220470"
  },
  {
    "text": "involves things like program startup inside this API the program main just",
    "start": "3220470",
    "end": "3231030"
  },
  {
    "text": "says use the bootstrap of classes main function and I'm gonna hand in a reference to my startup class so all",
    "start": "3231030",
    "end": "3239220"
  },
  {
    "text": "that code has been duplicated because in the two examples it was the same in the",
    "start": "3239220",
    "end": "3244890"
  },
  {
    "text": "common project we can see what that is it's a bootstrapper class that does the",
    "start": "3244890",
    "end": "3251100"
  },
  {
    "text": "web hosting it grabs this environment variable from service fabric service",
    "start": "3251100",
    "end": "3256530"
  },
  {
    "text": "fabric has been doing dynamic port allocation this environment variable is how it tells the instance which part to",
    "start": "3256530",
    "end": "3261570"
  },
  {
    "text": "serve so it grabs that port passes it to asp net core by changing the environment",
    "start": "3261570",
    "end": "3267030"
  },
  {
    "text": "variable name and starts up kestrel and runs the site it adds a few common",
    "start": "3267030",
    "end": "3274140"
  },
  {
    "text": "services one of the services is a startup filter that startup filters sort",
    "start": "3274140",
    "end": "3280410"
  },
  {
    "text": "of wraps around your startup class and lets you put additional middleware in on every web application so everybody who",
    "start": "3280410",
    "end": "3287940"
  },
  {
    "text": "does bootstrap Romain gets middleware for free that startup filter basically",
    "start": "3287940",
    "end": "3295140"
  },
  {
    "text": "is saying if it's development use the friendly exception page otherwise use",
    "start": "3295140",
    "end": "3301410"
  },
  {
    "text": "the exception handler which does not leak information you should not use the exception page in production this is",
    "start": "3301410",
    "end": "3308730"
  },
  {
    "text": "development in HP net core is driven by that environment variable we took a look",
    "start": "3308730",
    "end": "3314910"
  },
  {
    "text": "at earlier if that environment variable is set to the string development is",
    "start": "3314910",
    "end": "3320010"
  },
  {
    "text": "development is true here is where it's responding to the Status page if you've gotten this far you're healthy",
    "start": "3320010",
    "end": "3328490"
  },
  {
    "text": "it also does a thing where there's an HTTP client in order to get that effect",
    "start": "3328780",
    "end": "3339020"
  },
  {
    "text": "of having the operation ID flow I wanted to have all outgoing calls go through",
    "start": "3339020",
    "end": "3344600"
  },
  {
    "text": "the same code paths in the website that",
    "start": "3344600",
    "end": "3349610"
  },
  {
    "text": "looks like this so in the home controller I get the thoughts client",
    "start": "3349610",
    "end": "3356360"
  },
  {
    "text": "ooh that's that's actually talking about swagger so the thoughts client is generated by swagger you can take a look",
    "start": "3356360",
    "end": "3362810"
  },
  {
    "text": "at that also and it depends on i HT TP client of high thoughts swagger okay",
    "start": "3362810",
    "end": "3372910"
  },
  {
    "text": "hmm trying to think of the best way of explaining this well basically the",
    "start": "3378140",
    "end": "3383150"
  },
  {
    "text": "client here you use it by calling this get API that get API is going to be",
    "start": "3383150",
    "end": "3390680"
  },
  {
    "text": "creating an HTTP client and wrapping an operation ID injector in as the call is",
    "start": "3390680",
    "end": "3397490"
  },
  {
    "text": "going out",
    "start": "3397490",
    "end": "3399880"
  },
  {
    "text": "and it does that here actually this is going to be at this point I think this",
    "start": "3408530",
    "end": "3414800"
  },
  {
    "text": "is too random and there's not enough time to really get value from just hopping around in the code but suffice",
    "start": "3414800",
    "end": "3423560"
  },
  {
    "text": "to say I think that something like this if you're going to have micro services which you want to have consistent",
    "start": "3423560",
    "end": "3429230"
  },
  {
    "text": "logging consistent telemetry and a consistent operation ID so that you can",
    "start": "3429230",
    "end": "3434330"
  },
  {
    "text": "see everything that happened for one logical operation you are going to need something like this common code where it",
    "start": "3434330",
    "end": "3441290"
  },
  {
    "text": "has the same setup for your startup this same setup for your logging and the same",
    "start": "3441290",
    "end": "3451160"
  },
  {
    "text": "setup for your outgoing HTTP calls for a service to service calls all right well",
    "start": "3451160",
    "end": "3458480"
  },
  {
    "text": "thank you very much for coming out today I think that's pretty much the end of who you have time they're every bit [Applause]",
    "start": "3458480",
    "end": "3469919"
  }
]