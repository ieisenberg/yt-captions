[
  {
    "text": "and so one day I decided to try and set myself of a little",
    "start": "12120",
    "end": "17560"
  },
  {
    "text": "challenge can I make a container I feel like I know a lot about",
    "start": "17560",
    "end": "23039"
  },
  {
    "text": "containers at least know a lot about how to make them but can I do it just using shell commands can I make something that",
    "start": "23039",
    "end": "29279"
  },
  {
    "text": "expl like a container just using some shell commands and after a few days I",
    "start": "29279",
    "end": "36680"
  },
  {
    "text": "concluded that yes I can um your definition of decent and my definition of decent might differ but I think it's",
    "start": "36680",
    "end": "43719"
  },
  {
    "text": "kind of decent it's not perfect there's some messy Corners there's some steps you",
    "start": "43719",
    "end": "49360"
  },
  {
    "text": "have to do manually still um and there are ones who think you simply can't do",
    "start": "49360",
    "end": "55800"
  },
  {
    "text": "um so I don't do them for instance I have no set comp system called filing because there is no shell command to set",
    "start": "55800",
    "end": "62559"
  },
  {
    "text": "that up um but it is just standard shell",
    "start": "62559",
    "end": "68119"
  },
  {
    "text": "commands that you'll find on any Linux distribution and gives a reasonable",
    "start": "68119",
    "end": "73600"
  },
  {
    "text": "approximation of what kind of isation you would have in say a Docker",
    "start": "73600",
    "end": "80720"
  },
  {
    "text": "container shell commands I'm going to use aside from the standard commands that You' know about every day some less",
    "start": "81520",
    "end": "87520"
  },
  {
    "text": "common commands that I want to use unshare Mount command and the pivot",
    "start": "87520",
    "end": "93000"
  },
  {
    "text": "roote command all those commands are built on top of system calls that have exactly the same name basically they",
    "start": "93000",
    "end": "99640"
  },
  {
    "text": "tend to be sort of pretty thin rappers on top of the actual system Calles and I'm going to use buy box",
    "start": "99640",
    "end": "106880"
  },
  {
    "text": "because buy box is great gives me one binary that does a few hundred different things gives me I put a few hundred",
    "start": "106880",
    "end": "112719"
  },
  {
    "text": "different shell commands into my container I just put busy box in there and I've got something that's usable",
    "start": "112719",
    "end": "120159"
  },
  {
    "text": "okay um buy box implements the the core functionality of about 400 different",
    "start": "120159",
    "end": "126200"
  },
  {
    "text": "shell commands but it does does it using just one statically linked binary so I didn't have to copy in 400 binaries and",
    "start": "126200",
    "end": "133760"
  },
  {
    "text": "shared libraries into my container to set things up I can just do it really in a couple of",
    "start": "133760",
    "end": "140680"
  },
  {
    "text": "steps um it is all shell commands but of course I'm not going to type all the",
    "start": "140680",
    "end": "145800"
  },
  {
    "text": "shell commands I've put them into scripts and what I'm going to do is talk through the",
    "start": "145800",
    "end": "151400"
  },
  {
    "text": "scripts and so I've got three three principal scripts one is a script that can creates",
    "start": "151400",
    "end": "159080"
  },
  {
    "text": "the the file system that my container is going to use because a container needs to have a file system and so I need to",
    "start": "159080",
    "end": "166200"
  },
  {
    "text": "build that file system the next",
    "start": "166200",
    "end": "171400"
  },
  {
    "text": "script launches the container um it does a number of things to get the container ready to go and",
    "start": "171400",
    "end": "177879"
  },
  {
    "text": "then it launches it and then there's one more script and this script is",
    "start": "177879",
    "end": "183680"
  },
  {
    "text": "automatically executed once the container has been launched and it does some steps that need to be done inside",
    "start": "183680",
    "end": "189159"
  },
  {
    "text": "the container after it's been",
    "start": "189159",
    "end": "193080"
  },
  {
    "text": "launched so the various pieces our container needs a file system",
    "start": "194519",
    "end": "201519"
  },
  {
    "text": "and a root file system soall and of course each container should have",
    "start": "201519",
    "end": "208400"
  },
  {
    "text": "its own private file system so that when one container changes files of course that doesn't affect other",
    "start": "208400",
    "end": "215799"
  },
  {
    "text": "containers each container is going to have some files that are unique to that container but there's a lot of files",
    "start": "217040",
    "end": "224879"
  },
  {
    "text": "that are the same in every Container for instance every containers can have a bin directory with some binaries in it and",
    "start": "224879",
    "end": "230519"
  },
  {
    "text": "they're the same binaries so there's there's a lot of duplication in terms of",
    "start": "230519",
    "end": "236079"
  },
  {
    "text": "file system content across the containers now if the way we did things was each",
    "start": "236079",
    "end": "243079"
  },
  {
    "text": "container gets a separate copy of all of the files that would be a bit of a",
    "start": "243079",
    "end": "248439"
  },
  {
    "text": "problem for a couple of reasons one is a lot of wasted space because a lot of containers that mostly have the same",
    "start": "248439",
    "end": "255200"
  },
  {
    "text": "file system content so we just we just chew chewed up disk space for for no",
    "start": "255200",
    "end": "260519"
  },
  {
    "text": "reason and chewed up memory as well um the other thing is that when we launch",
    "start": "260519",
    "end": "265680"
  },
  {
    "text": "the container because the container needs to be launched with a fastest IM we need to C copy all of those files",
    "start": "265680",
    "end": "270960"
  },
  {
    "text": "that takes some time that would make our container startup a little bit slower the solution to these problems is",
    "start": "270960",
    "end": "278759"
  },
  {
    "text": "to use what's called a union Mount now a union Mount",
    "start": "278759",
    "end": "285320"
  },
  {
    "text": "is really just a technique for combining the contents of several different",
    "start": "285320",
    "end": "290840"
  },
  {
    "text": "directories stacking them up in a way and providing a merged view of that stack of directories and the idea is",
    "start": "290840",
    "end": "298560"
  },
  {
    "text": "that um you have in the lower part of the layers",
    "start": "298560",
    "end": "303720"
  },
  {
    "text": "one or more readon directories and then",
    "start": "303720",
    "end": "308759"
  },
  {
    "text": "on the top layer you have a read right layer read right directory that is the",
    "start": "308759",
    "end": "314000"
  },
  {
    "text": "differences between the contents of the lower layers and it's that read write uper layer in each container that is",
    "start": "314000",
    "end": "320960"
  },
  {
    "text": "going to contain the stuff that is unique for each container but the lower layers are going to be actually the same",
    "start": "320960",
    "end": "327479"
  },
  {
    "text": "files same directories across all containers",
    "start": "327479",
    "end": "331639"
  },
  {
    "text": "um so yeah the idea then is you know lower layers or lower layer is content",
    "start": "333560",
    "end": "339960"
  },
  {
    "text": "common to all the containers upper layer is the stuff that is private to individual",
    "start": "339960",
    "end": "346319"
  },
  {
    "text": "containers there's a few different ways of doing this the modern way of doing this uh this is used by um Docker and",
    "start": "346319",
    "end": "354240"
  },
  {
    "text": "podman and a few other tools is to use a union Mount file system called overlay",
    "start": "354240",
    "end": "359319"
  },
  {
    "text": "effect there are other ways there's a few other te techniques I've just listed at the bottom of the slides including some some",
    "start": "359319",
    "end": "366520"
  },
  {
    "text": "predecessors of overlay FS um Union fs and Au",
    "start": "366520",
    "end": "371720"
  },
  {
    "text": "ufs the idea with overlay FS is you mount an overlay create an overlay FS",
    "start": "371720",
    "end": "380120"
  },
  {
    "text": "Mount by specifying what directories are going to be part of the mount and so",
    "start": "380120",
    "end": "386400"
  },
  {
    "text": "here I've got a mount command where I'm saying it's an overlay Mount and then I",
    "start": "386400",
    "end": "392680"
  },
  {
    "text": "specify elsewhere in the mount command what are my layers and here I've said my",
    "start": "392680",
    "end": "399319"
  },
  {
    "text": "lower layers and this is a list of directories now in this particular case I've specified two directories separated",
    "start": "399319",
    "end": "406960"
  },
  {
    "text": "by colons okay lower one and lower two and then elsewhere I specify what",
    "start": "406960",
    "end": "414479"
  },
  {
    "text": "directory is going to be the upper layer and then there's one more thing that I need to do",
    "start": "414479",
    "end": "420800"
  },
  {
    "text": "uh as part of that mount is to create what's called or to set to also specify",
    "start": "420800",
    "end": "426160"
  },
  {
    "text": "directory that's going to be used as a working directory now this directory is used behind the scenes by overl FS for",
    "start": "426160",
    "end": "434479"
  },
  {
    "text": "doing sort of temporary setup for files um sometimes there are certain actions",
    "start": "434479",
    "end": "439759"
  },
  {
    "text": "that need to be done and then once they've been done the resulting file needs to be moved into the upper layer",
    "start": "439759",
    "end": "445720"
  },
  {
    "text": "but before the action is complete the um that that file shouldn't be visible in",
    "start": "445720",
    "end": "451759"
  },
  {
    "text": "the upper layer and I give an example for instance here you know suppose you do an echo command and you say I want to",
    "start": "451759",
    "end": "458280"
  },
  {
    "text": "add some content at the end of a file that's in a lower layer now ultimately",
    "start": "458280",
    "end": "464440"
  },
  {
    "text": "what you end up within the uper layer is a complete file with that additional content but until that complete file has",
    "start": "464440",
    "end": "471520"
  },
  {
    "text": "been built you don't want the partially copied file to be visible because it's",
    "start": "471520",
    "end": "476879"
  },
  {
    "text": "not yet um completed and is done in in the working",
    "start": "476879",
    "end": "482919"
  },
  {
    "text": "directory um the work directory needs to be on the same file system as the upper",
    "start": "482919",
    "end": "489159"
  },
  {
    "text": "directory because what's going to happen is when the work is finished when the setup work is finished what happens is the file gets moved from the work",
    "start": "489159",
    "end": "495240"
  },
  {
    "text": "directory into the upper directory just using rename and rename is",
    "start": "495240",
    "end": "500800"
  },
  {
    "text": "atomic okay so if I do um a mount command like that the arrangement I'm",
    "start": "501680",
    "end": "507639"
  },
  {
    "text": "ending up with is like this I've got a series of stacked directories and they're stacked up like",
    "start": "507639",
    "end": "514839"
  },
  {
    "text": "this lower two lower one notice the order there um corresponding in the command um the the first named lower",
    "start": "514839",
    "end": "522240"
  },
  {
    "text": "directory is the one that's at the top of the lower layers and so on and then",
    "start": "522240",
    "end": "527320"
  },
  {
    "text": "above that the upper layer and what I also specified as part",
    "start": "527320",
    "end": "532480"
  },
  {
    "text": "of my Mount was the location where the mount is the the merged view of all",
    "start": "532480",
    "end": "541279"
  },
  {
    "text": "of these directories and so what I'm going to be able to see in that merged view is the combination of everything",
    "start": "541279",
    "end": "548040"
  },
  {
    "text": "that's visible from the lower layers now of course you could have in the different lower layers files that have",
    "start": "548040",
    "end": "555240"
  },
  {
    "text": "the same name in the same place in that case the file you actually see in the merg view is the one that is in the",
    "start": "555240",
    "end": "561920"
  },
  {
    "text": "uppermost layer so you can see here I've got a file called all that is visible in all of those lower layers or it's part",
    "start": "561920",
    "end": "567920"
  },
  {
    "text": "of all of those layer layers lower layers the one that's visible in the merge view is the topmost one the one",
    "start": "567920",
    "end": "573399"
  },
  {
    "text": "from the upper directory uh here I've got a file that is is present in two",
    "start": "573399",
    "end": "579720"
  },
  {
    "text": "different pathes in in the two different lower layers the one that's visible at the top is the one in the uppermost",
    "start": "579720",
    "end": "587640"
  },
  {
    "text": "layer um you can also have the concept where you have a file from a lower layer",
    "start": "587640",
    "end": "593600"
  },
  {
    "text": "that has been deleted and of course therefore it shouldn't be visible in an",
    "start": "593600",
    "end": "598680"
  },
  {
    "text": "upper layer and the way this is done is by creating what's called a white out and that's",
    "start": "598680",
    "end": "603920"
  },
  {
    "text": "just my way of representing a white out a white out is a special entry in the file system is basically saying",
    "start": "603920",
    "end": "609880"
  },
  {
    "text": "hide the thing that is below and so you can um you can remove",
    "start": "609880",
    "end": "616519"
  },
  {
    "text": "files or make them become invisible from the lower layers using a white out or",
    "start": "616519",
    "end": "622279"
  },
  {
    "text": "that's what the the file system is doing for you okay so",
    "start": "622279",
    "end": "630160"
  },
  {
    "text": "um what I'm going to do for my container is have a um an overlay file system",
    "start": "630160",
    "end": "635920"
  },
  {
    "text": "where I have a single lower layer which is the contents of uh the direct the",
    "start": "635920",
    "end": "642120"
  },
  {
    "text": "files that are common to all of my containers it's going to my bin directory and things like that for example and then my upper layer is the",
    "start": "642120",
    "end": "650399"
  },
  {
    "text": "differences the the stuff that is unique to this container I've got my script that builds",
    "start": "650399",
    "end": "658519"
  },
  {
    "text": "that love lower layer and I give one argument just the directory where that",
    "start": "658519",
    "end": "665320"
  },
  {
    "text": "lower layer the the the path name with the directory containing that lower layer should be constructed what I do is",
    "start": "665320",
    "end": "673480"
  },
  {
    "text": "um in the script make that directory step into that directory and then I create the",
    "start": "673480",
    "end": "680519"
  },
  {
    "text": "kinds of directories you'd expect to see in a root file system bin Dev Etc and so",
    "start": "680519",
    "end": "687680"
  },
  {
    "text": "on then I step into the bin directory and copy",
    "start": "687680",
    "end": "694440"
  },
  {
    "text": "in buy box okay um the Wich command if you're not familiar with it just tells you",
    "start": "694440",
    "end": "700440"
  },
  {
    "text": "what's the path name where a certain command is located so I'm just using command substitution there to get the path name of the busy box binary and I",
    "start": "700440",
    "end": "707680"
  },
  {
    "text": "copy it into my bin directory and then busy box has this really cool",
    "start": "707680",
    "end": "715639"
  },
  {
    "text": "feature where it emulates the functionality of about 400 different Shel commands and the way that it way",
    "start": "715639",
    "end": "721079"
  },
  {
    "text": "that it does that is there are links to the binary with 400 different names a",
    "start": "721079",
    "end": "726480"
  },
  {
    "text": "link called alls meaning busy box should list files a link called RM meaning that buy box should remove files and of",
    "start": "726480",
    "end": "733199"
  },
  {
    "text": "course one of the things I need to do is construct the links well busy box does that for you you can say busy box you",
    "start": "733199",
    "end": "739959"
  },
  {
    "text": "need to give a full path name um dash dash install Dot and it makes the links",
    "start": "739959",
    "end": "745760"
  },
  {
    "text": "and after I've done that I've got about 400 links to the busy box binary in that",
    "start": "745760",
    "end": "751519"
  },
  {
    "text": "bin directory okay so that's my f or the",
    "start": "751519",
    "end": "758880"
  },
  {
    "text": "start of my file system at least now in our container we need to be doing",
    "start": "758880",
    "end": "764760"
  },
  {
    "text": "various kinds of isolation the whole idea of container is to provide an",
    "start": "764760",
    "end": "770240"
  },
  {
    "text": "illusion that there is no outside world there's a bunch of processes inside the container they seem to be in a world of",
    "start": "770240",
    "end": "776639"
  },
  {
    "text": "their own there is no outside world and how do we provide that illusion and Nam",
    "start": "776639",
    "end": "783000"
  },
  {
    "text": "spaces are a key part of that",
    "start": "783000",
    "end": "787399"
  },
  {
    "text": "illusion the um what we want to have for our container each container should have its",
    "start": "789079",
    "end": "795320"
  },
  {
    "text": "own set of mounted file systems have its own host name have its own network",
    "start": "795320",
    "end": "800680"
  },
  {
    "text": "infrastructure a private set of PS for that container and one of the",
    "start": "800680",
    "end": "806399"
  },
  {
    "text": "reasons we want to be able to have that is we want in each container to have a p id1 an init process init is a rather",
    "start": "806399",
    "end": "814000"
  },
  {
    "text": "special process on classical Unix systems and it's special in containers as well one of the things that in it",
    "start": "814000",
    "end": "820160"
  },
  {
    "text": "does for example is when a process becomes orphaned because it's parent terminated the the orphaned child",
    "start": "820160",
    "end": "827560"
  },
  {
    "text": "process gets reparented to the init process and of course we want that to also work inside the container so that",
    "start": "827560",
    "end": "834720"
  },
  {
    "text": "if a um a process inside the container becomes orphaned it gets reparented not",
    "start": "834720",
    "end": "840279"
  },
  {
    "text": "to the init process on the outside system but rather to the init process inside the",
    "start": "840279",
    "end": "847880"
  },
  {
    "text": "container we also want in our container the concept of super user a privileged",
    "start": "848199",
    "end": "855120"
  },
  {
    "text": "privileged processors processors that can do super Usery things inside the",
    "start": "855120",
    "end": "861399"
  },
  {
    "text": "container but are not privileged outside the container and again Nam spaces allow",
    "start": "861399",
    "end": "868360"
  },
  {
    "text": "this possibility so the general idea of a namespace is to",
    "start": "868360",
    "end": "876600"
  },
  {
    "text": "isolate some kind of resource and make it seem like there is a private copy of",
    "start": "876600",
    "end": "881880"
  },
  {
    "text": "that resource for a certain group of processes we' got a number of different types of namespace I'm not going to talk",
    "start": "881880",
    "end": "888399"
  },
  {
    "text": "about all of them but here's a few examples P namespaces these make the set",
    "start": "888399",
    "end": "893759"
  },
  {
    "text": "of P IDs private to that group of processes and in particular as I've",
    "start": "893759",
    "end": "899800"
  },
  {
    "text": "mentioned already this means that we can have a p id1 in our container um we've got Mountain a spaces",
    "start": "899800",
    "end": "907199"
  },
  {
    "text": "what mountain a space is doing is isolating the set of mounts this means that different groups of processors can",
    "start": "907199",
    "end": "913959"
  },
  {
    "text": "see different sets of mounts and therefore different single directory hierarchies different sets of mounted",
    "start": "913959",
    "end": "920480"
  },
  {
    "text": "file systems um UTS name spaces are the simplest one all they're doing is",
    "start": "920480",
    "end": "926639"
  },
  {
    "text": "isolating isolating a couple of system identif um notably the host name and this means",
    "start": "926639",
    "end": "932720"
  },
  {
    "text": "each one of our containers can have a different host name uh the container can broadcast that host name on DHCP so it",
    "start": "932720",
    "end": "940279"
  },
  {
    "text": "gets assigned an IP address and we've got Network namespaces",
    "start": "940279",
    "end": "946399"
  },
  {
    "text": "which of course are also rather important because it means each container can have its own pieces of",
    "start": "946399",
    "end": "952360"
  },
  {
    "text": "network infrastructure its own virtual networking device with an IP address its",
    "start": "952360",
    "end": "957440"
  },
  {
    "text": "own set of um socket port numbers its own rooting table rules its own firewall",
    "start": "957440",
    "end": "963680"
  },
  {
    "text": "rules and so on and the idea of there of course is you know let's make our containers useful in a networking",
    "start": "963680",
    "end": "973199"
  },
  {
    "text": "sense for our container we're going to create one namespace of each one of the types I've talked about four namespace",
    "start": "973680",
    "end": "980880"
  },
  {
    "text": "types there there are eight types of namespace all together but I'm not going to talk about all the",
    "start": "980880",
    "end": "986720"
  },
  {
    "text": "others so this then the question is how do we do super user inside a container",
    "start": "986720",
    "end": "993680"
  },
  {
    "text": "and that concept is supported by another type of name space called a username",
    "start": "993680",
    "end": "998959"
  },
  {
    "text": "space and what username spaces are doing is um isolating the user ID and the",
    "start": "998959",
    "end": "1007560"
  },
  {
    "text": "group ID number space what this means is that you can have a process that in the",
    "start": "1007560",
    "end": "1013399"
  },
  {
    "text": "outside world has an unproved user ID maybe user ID 1,000 but in the inside",
    "start": "1013399",
    "end": "1019959"
  },
  {
    "text": "the container it has a different user ID and in particularly the interesting case here is a process that inside the",
    "start": "1019959",
    "end": "1025798"
  },
  {
    "text": "container has uid zero it has super user Powers inside the",
    "start": "1025799",
    "end": "1032600"
  },
  {
    "text": "container now the other piece that goes along with user namespaces here is",
    "start": "1032600",
    "end": "1037839"
  },
  {
    "text": "capabilities um capabilities are the modern way of implementing privilege on",
    "start": "1037839",
    "end": "1043480"
  },
  {
    "text": "Linux systems um the idea of cable user is let's break the power of super user",
    "start": "1043480",
    "end": "1048520"
  },
  {
    "text": "into smaller pieces there are currently 41 of those smaller pieces and what we",
    "start": "1048520",
    "end": "1054840"
  },
  {
    "text": "think of as being um uh classical super user nowadays is really conceptually",
    "start": "1054840",
    "end": "1062000"
  },
  {
    "text": "just a process that has all 41 of those capabilities and processes that have uid",
    "start": "1062000",
    "end": "1067720"
  },
  {
    "text": "Z normally have all 41 of those",
    "start": "1067720",
    "end": "1073400"
  },
  {
    "text": "capabilities um so we're going to create a new usern name space for our container one of the things that happens when a",
    "start": "1074400",
    "end": "1080200"
  },
  {
    "text": "new username space is created the konel magically says the first process that's",
    "start": "1080200",
    "end": "1085640"
  },
  {
    "text": "created inside that username space you shall have all capabilities it's just a thing that the",
    "start": "1085640",
    "end": "1092280"
  },
  {
    "text": "colonel does and so as a concept consequence of simly creating usern space with a process inside it that",
    "start": "1092280",
    "end": "1098159"
  },
  {
    "text": "process has all 41 capabilities which is great it's a super user process we want",
    "start": "1098159",
    "end": "1103200"
  },
  {
    "text": "to one of those the way we create",
    "start": "1103200",
    "end": "1109520"
  },
  {
    "text": "um a uh name space at the Shell level is a command called unshare it's a funny",
    "start": "1109520",
    "end": "1115400"
  },
  {
    "text": "name but there's a funny history beside behind it um and it's built on top of",
    "start": "1115400",
    "end": "1121720"
  },
  {
    "text": "the unshare system call and so we can do something like this for example here I'm saying unshare D- user create a username",
    "start": "1121720",
    "end": "1130880"
  },
  {
    "text": "space d-p ID create a PID namespace as well-- Fork create a child Pro process",
    "start": "1130880",
    "end": "1140000"
  },
  {
    "text": "okay because I want a child process that I'm going to use to execute a command and then the rest of the line is the",
    "start": "1140000",
    "end": "1146840"
  },
  {
    "text": "command that's going to be executed by that child process and I've said my command is a shell and it has some",
    "start": "1146840",
    "end": "1153159"
  },
  {
    "text": "options- C says execute the command that is uh in the argument in the in the",
    "start": "1153159",
    "end": "1159000"
  },
  {
    "text": "quoted argument there and I say echo my PID is dollar dollar okay the P ID of",
    "start": "1159000",
    "end": "1166440"
  },
  {
    "text": "the shell and when I do that magically that shell has P id1 because",
    "start": "1166440",
    "end": "1173919"
  },
  {
    "text": "it was the first process in that new PID",
    "start": "1173919",
    "end": "1179279"
  },
  {
    "text": "namespace okay now another part of the isolation that we want to do inside a container is",
    "start": "1181600",
    "end": "1188120"
  },
  {
    "text": "cgroups um we want to limit the resources that the processors in the",
    "start": "1188120",
    "end": "1195200"
  },
  {
    "text": "container can use uh we want to do that because first of all we want to prevent",
    "start": "1195200",
    "end": "1200840"
  },
  {
    "text": "our container from overwhelming the rest of the system by trying to consume too much resource you know create too many",
    "start": "1200840",
    "end": "1208039"
  },
  {
    "text": "processes or use too much memory or burn up too much CPU time so that's that's",
    "start": "1208039",
    "end": "1213799"
  },
  {
    "text": "one side of the guarantee we want but there's also the the mirror side of the guarantee which is we want to make sure",
    "start": "1213799",
    "end": "1219320"
  },
  {
    "text": "the other containers don't overwhelm the system so we can actually get something",
    "start": "1219320",
    "end": "1224600"
  },
  {
    "text": "two sides of the same coin um but you also want to do things like limiting access to De to devices",
    "start": "1224600",
    "end": "1231320"
  },
  {
    "text": "inside a container we don't generally want our the processes to be able to",
    "start": "1231320",
    "end": "1236600"
  },
  {
    "text": "access random devices on the system there are some good security reasons for",
    "start": "1236600",
    "end": "1241760"
  },
  {
    "text": "that um some some devices can be used for some kinds of privilege escalations so we actually want to only allow a very",
    "start": "1241760",
    "end": "1248799"
  },
  {
    "text": "limited set of cont of devices to be Vis visible inside a container we do this",
    "start": "1248799",
    "end": "1253960"
  },
  {
    "text": "using cgroups um we can also use the cgroups to measure the resources that are being",
    "start": "1253960",
    "end": "1261240"
  },
  {
    "text": "consumed by the container how much CPU time has been used how much memory is the container using and so",
    "start": "1261240",
    "end": "1269200"
  },
  {
    "text": "on and the way this is being done is with uh this Linux feature called",
    "start": "1269200",
    "end": "1275320"
  },
  {
    "text": "cgroups control groups the important point about cgroups is they are allowing",
    "start": "1275320",
    "end": "1281880"
  },
  {
    "text": "us to do resource limitation and Resource Management per",
    "start": "1281880",
    "end": "1287520"
  },
  {
    "text": "group of processes we can set a limit that applies to a group of processes maybe one process uses a lot of the",
    "start": "1287520",
    "end": "1294039"
  },
  {
    "text": "resource and the other process use a little but the point is whatever we allocate is shared across the",
    "start": "1294039",
    "end": "1300400"
  },
  {
    "text": "group um there were older mechanisms there are they still exist for doing uh",
    "start": "1300400",
    "end": "1305960"
  },
  {
    "text": "resource limitation on Unix systems the U liit command but the thing about the U limit command it is just a per process",
    "start": "1305960",
    "end": "1313320"
  },
  {
    "text": "limit it's not the limits not shared across groups of processes",
    "start": "1313320",
    "end": "1319559"
  },
  {
    "text": "the way that cgroups work the interface for uh controlling cgroups it's a file",
    "start": "1319559",
    "end": "1325880"
  },
  {
    "text": "system and in order to make a cgroup what we do is on that file system it's so-called um cgroup two file system",
    "start": "1325880",
    "end": "1331960"
  },
  {
    "text": "mounted at this location here to make a cgroup all we do is make a directory in that file system and that is synonymous",
    "start": "1331960",
    "end": "1339480"
  },
  {
    "text": "with the act of creating a cgroup and cgroups have a hierarchal Arrangement",
    "start": "1339480",
    "end": "1346799"
  },
  {
    "text": "and when you set limits in cgroups the the limits apply to the lower parts of the hierarchy and of course the way",
    "start": "1346799",
    "end": "1352600"
  },
  {
    "text": "we're going to construct our hierarchy is by having a hierarchy of",
    "start": "1352600",
    "end": "1358200"
  },
  {
    "text": "directories the directory hierarchy is synonymous with the cgroup",
    "start": "1358200",
    "end": "1364279"
  },
  {
    "text": "hierarchy okay now",
    "start": "1364840",
    "end": "1370039"
  },
  {
    "text": "we want to look at the commands now to actually launch our our um container so",
    "start": "1370039",
    "end": "1379120"
  },
  {
    "text": "I'm going to make I've got another script here it takes a few arguments um one of them is the directory that",
    "start": "1379120",
    "end": "1385640"
  },
  {
    "text": "contains the lower level of our file system that's the directory that my first script",
    "start": "1385640",
    "end": "1392400"
  },
  {
    "text": "created uh another argument is the location where the overlay file system",
    "start": "1392400",
    "end": "1398200"
  },
  {
    "text": "is going to be mounted my merged directory and the a couple of other uh",
    "start": "1398200",
    "end": "1405679"
  },
  {
    "text": "possible options here um a path name that might container is going to use for its cgroup and also the host name that",
    "start": "1405679",
    "end": "1413880"
  },
  {
    "text": "my container should set up uh in its in its UTS",
    "start": "1413880",
    "end": "1419559"
  },
  {
    "text": "namespace and um I'm going to skip over some details and just say those various",
    "start": "1419559",
    "end": "1425039"
  },
  {
    "text": "pieces there my script just sticks them into some suitably named variables okay lower overlay dur cgroup host just",
    "start": "1425039",
    "end": "1433520"
  },
  {
    "text": "assume that that was done I'm not going to show you that that's mechanical Okay so having got those",
    "start": "1433520",
    "end": "1440200"
  },
  {
    "text": "variables what am I doing well I'm making some directories um in in my overlay dur I'm",
    "start": "1440200",
    "end": "1446880"
  },
  {
    "text": "making uh an upper directory that's going to be my readwrite upper layer in my overlay file system Mount uh the work",
    "start": "1446880",
    "end": "1453919"
  },
  {
    "text": "directory that is needed for overlay FS uh the mount Point create the mount point where the overlay FS is going to",
    "start": "1453919",
    "end": "1461080"
  },
  {
    "text": "be mounted then I do the mount um sudu mountt overlay there's my lower",
    "start": "1461080",
    "end": "1467559"
  },
  {
    "text": "directory there's my my upper directory here's my work directory and then um",
    "start": "1467559",
    "end": "1474120"
  },
  {
    "text": "source of the mount is any string I've just written overlay there but then here's the mount",
    "start": "1474120",
    "end": "1479559"
  },
  {
    "text": "point and then my script steps into that",
    "start": "1479559",
    "end": "1485398"
  },
  {
    "text": "directory okay just by way of demonstration I then create my my script",
    "start": "1487320",
    "end": "1493559"
  },
  {
    "text": "in creates a little file with a bit of information about the startup of the script just puts um date in there P ID",
    "start": "1493559",
    "end": "1501320"
  },
  {
    "text": "and one or two other things and then um",
    "start": "1501320",
    "end": "1506520"
  },
  {
    "text": "that file will actually be created in the upper directory of that overlay",
    "start": "1506520",
    "end": "1511720"
  },
  {
    "text": "Mount um setup now",
    "start": "1511720",
    "end": "1517240"
  },
  {
    "text": "if I specified a cgroup when I launched my script then this variable here will",
    "start": "1517240",
    "end": "1523039"
  },
  {
    "text": "be set and so what I'm going to do is create a cgroup that is going to be used",
    "start": "1523039",
    "end": "1528120"
  },
  {
    "text": "by by this um by by this container so my SRP path is CFS crrp",
    "start": "1528120",
    "end": "1535679"
  },
  {
    "text": "that's the standard Mount point for the cgroup file system and then whatever path whatever name I gave as an argument",
    "start": "1535679",
    "end": "1543200"
  },
  {
    "text": "to my script I make that directory sud sud make- p and then I say here um Echo",
    "start": "1543200",
    "end": "1554080"
  },
  {
    "text": "I do a shell command where I say Echo the P ID of this shell scrip",
    "start": "1554080",
    "end": "1559799"
  },
  {
    "text": "into a file called cp. paths in sorry coup. procs in that um",
    "start": "1559799",
    "end": "1568120"
  },
  {
    "text": "cgroup what that is doing this is the way you put a process into a cgroup you",
    "start": "1568120",
    "end": "1573799"
  },
  {
    "text": "write its P ID to that file and so now the shell script it's a member of that c",
    "start": "1573799",
    "end": "1581520"
  },
  {
    "text": "group that the shell that is running the script is a member of that cgroup there's a bit more",
    "start": "1581520",
    "end": "1589640"
  },
  {
    "text": "okay um still still here with cgroups one more thing I do what's called",
    "start": "1589640",
    "end": "1596559"
  },
  {
    "text": "delegation for the cgroup this the files in in the cgroup",
    "start": "1596559",
    "end": "1603080"
  },
  {
    "text": "file system are all owned by super user so um the default situation is in order",
    "start": "1603080",
    "end": "1609559"
  },
  {
    "text": "to do things with those files you need to be have a root shell um but I want to",
    "start": "1609559",
    "end": "1615200"
  },
  {
    "text": "run a container for an unpr user so what I'm going to do is take my sub",
    "start": "1615200",
    "end": "1622120"
  },
  {
    "text": "hierarchy they're the cgroup that I'm creating change its ownership to be the",
    "start": "1622120",
    "end": "1627960"
  },
  {
    "text": "unproved user and as well I need to change the ownership of a certain set of files inside that directory there's a",
    "start": "1627960",
    "end": "1635799"
  },
  {
    "text": "file here CIS Colonel cgroup delegate and it tells me which of those files",
    "start": "1635799",
    "end": "1641640"
  },
  {
    "text": "also need to have their ownership changed because not all the files need to be changed and certain files their ownership should not be changed but",
    "start": "1641640",
    "end": "1648600"
  },
  {
    "text": "there's a certain set of whose ownership must be changed and as well the ownership of the directory must be",
    "start": "1648600",
    "end": "1653960"
  },
  {
    "text": "changed so what I'm doing here is saying um sudu sh- C here's my shell command",
    "start": "1653960",
    "end": "1659880"
  },
  {
    "text": "where I say step into that c group and then work out which files need to be delegated what I do is I list the",
    "start": "1659880",
    "end": "1666360"
  },
  {
    "text": "contents of this file to see which files are actually present in the directory some of them won't be they'll generate",
    "start": "1666360",
    "end": "1671799"
  },
  {
    "text": "errors but I'm going to throw the errors away but the result of the ls is I'm going to have a list of files that",
    "start": "1671799",
    "end": "1677320"
  },
  {
    "text": "actually exist in the directory and then I say uh that's my list of files and then I say CH own to my user id my group",
    "start": "1677320",
    "end": "1686399"
  },
  {
    "text": "ID the unproved user own group and uh on",
    "start": "1686399",
    "end": "1691519"
  },
  {
    "text": "dot the the the cgroup directory and though that set of files that I've",
    "start": "1691519",
    "end": "1697880"
  },
  {
    "text": "discovered inside the directory that whose ownership needs to be",
    "start": "1697880",
    "end": "1703360"
  },
  {
    "text": "changed okay now the next step in my shell script I",
    "start": "1705480",
    "end": "1713320"
  },
  {
    "text": "use exac now I don't know if you're familiar with the shell command exec what exec says is replace this shell",
    "start": "1713320",
    "end": "1721519"
  },
  {
    "text": "with a different program it's the same process it was running a shell but now the shell is saying um I don't need to",
    "start": "1721519",
    "end": "1727919"
  },
  {
    "text": "be here anymore replace me with another program and the program I'm replacing the shell withd is another program",
    "start": "1727919",
    "end": "1734039"
  },
  {
    "text": "called en now en is a program that does things with environment variables and",
    "start": "1734039",
    "end": "1741519"
  },
  {
    "text": "what I'm doing here is saying n-i initialize some environment",
    "start": "1741519",
    "end": "1747640"
  },
  {
    "text": "variables um I'm going to initialize the environment variable home to be SL root",
    "start": "1747640",
    "end": "1753600"
  },
  {
    "text": "my home directory you know for my for my super for my super user shell that I'm going to have inside the container um",
    "start": "1753600",
    "end": "1760960"
  },
  {
    "text": "and initialize path with some suitable list of path names um set host name to whatever was",
    "start": "1760960",
    "end": "1769480"
  },
  {
    "text": "supplied to the script and then one more environment",
    "start": "1769480",
    "end": "1775720"
  },
  {
    "text": "variable that I'm going to set up here is called in I'll delay explaining that",
    "start": "1775720",
    "end": "1781240"
  },
  {
    "text": "just for a moment all I'll just say is that I'm setting up that environment variable to point to another script I'll",
    "start": "1781240",
    "end": "1789279"
  },
  {
    "text": "show you that script in a moment okay and then having done its work and then itself does an exec",
    "start": "1789279",
    "end": "1798200"
  },
  {
    "text": "Corporation to replace itself with another program the program I'm replacing it with is",
    "start": "1798200",
    "end": "1804960"
  },
  {
    "text": "unshare and what I'm saying with unshare here is create a new username space uh",
    "start": "1804960",
    "end": "1811159"
  },
  {
    "text": "with the socalled uh on just jump forward a slide or two here create a new username space and then with the root",
    "start": "1811159",
    "end": "1820279"
  },
  {
    "text": "mappings root mappings means my credentials in the outside world are",
    "start": "1820279",
    "end": "1825480"
  },
  {
    "text": "going to be mapped to zero in the inside world so in the outside world I might",
    "start": "1825480",
    "end": "1830559"
  },
  {
    "text": "have had user ID 1000 but in the inside world I Want U ID zero I want super user",
    "start": "1830559",
    "end": "1836720"
  },
  {
    "text": "Powers same thing for um for the group ID the group ID also gets mapped to zero",
    "start": "1836720",
    "end": "1843840"
  },
  {
    "text": "so we end up with a process that has u id0 g id0 inside the namespace and then as well I'm saying",
    "start": "1843840",
    "end": "1851240"
  },
  {
    "text": "create a p ID name space create a child process because that's going to be the process inside my container and then",
    "start": "1851240",
    "end": "1858080"
  },
  {
    "text": "create the other kinds of namespaces as well a mount namespace a network namespace an IPC namespace a UTS namespace and a cgroup namespace I",
    "start": "1858080",
    "end": "1865279"
  },
  {
    "text": "haven't talked about all of those but that doesn't matter and then aner is going to launch a command",
    "start": "1865279",
    "end": "1872320"
  },
  {
    "text": "in that child process what command am I going to launch I'm going to launch buy box okay and when you launch busy box",
    "start": "1872320",
    "end": "1879480"
  },
  {
    "text": "you can say what do you want it to be and I'm saying I want my busy box to behave like a shell okay and this is",
    "start": "1879480",
    "end": "1886360"
  },
  {
    "text": "going to be my very first process inside the container it's a shell it has super user powers and it has",
    "start": "1886360",
    "end": "1893070"
  },
  {
    "text": "[Music] pid1",
    "start": "1893070",
    "end": "1899120"
  },
  {
    "text": "okay now um I could have just written instead of busy box sh there I could",
    "start": "1899120",
    "end": "1905120"
  },
  {
    "text": "have written just bash but I wanted to use a busy box sh because I want the",
    "start": "1905120",
    "end": "1911039"
  },
  {
    "text": "initial shell to be the same kind of shell that is already available in the bin file system inside my container okay",
    "start": "1911039",
    "end": "1917120"
  },
  {
    "text": "otherwise I'd have a more powerful shell as the root shell which would just it's not wrong it's just a little bit",
    "start": "1917120",
    "end": "1924518"
  },
  {
    "text": "confusing okay oh hurry up okay",
    "start": "1925480",
    "end": "1933919"
  },
  {
    "text": "so after all of that there's still some more initialization steps that I need to",
    "start": "1933919",
    "end": "1939240"
  },
  {
    "text": "do I'm going do those in another script this one um con post setup and I",
    "start": "1939240",
    "end": "1946720"
  },
  {
    "text": "automate the execution of that script remember that end of environment variable that I set um earlier on that",
    "start": "1946720",
    "end": "1953760"
  },
  {
    "text": "is a special variable that is understood by shells when a shell is launched it says if the end of environment variable",
    "start": "1953760",
    "end": "1960679"
  },
  {
    "text": "is initialized I'm going to execute the commands that are inside it and so I'm",
    "start": "1960679",
    "end": "1966760"
  },
  {
    "text": "automating the creation of the script I don't even need to do it manually my busy box shell is going to do this as it",
    "start": "1966760",
    "end": "1971880"
  },
  {
    "text": "starts up and the very first thing I do in that",
    "start": "1971880",
    "end": "1977840"
  },
  {
    "text": "next script is unset in because I don't want you know when I launch another shell inside the container I don't want",
    "start": "1977840",
    "end": "1983440"
  },
  {
    "text": "it to execute that in script that would be a mess okay now my container inherited",
    "start": "1983440",
    "end": "1991600"
  },
  {
    "text": "some mounts from the um from the initial mount a space I don't want those mounts",
    "start": "1991600",
    "end": "1999240"
  },
  {
    "text": "all I really want to do is have mounted is my container root file system and so",
    "start": "1999240",
    "end": "2005240"
  },
  {
    "text": "I need to swap the current root file system with my overlay file system and make that the root file system and",
    "start": "2005240",
    "end": "2011880"
  },
  {
    "text": "there's a special command to do that's called pivot root you say pivot roote and you say this is the directory I want",
    "start": "2011880",
    "end": "2017480"
  },
  {
    "text": "to be the new root directory and I want you to move the old root directory the old root Mount to this location",
    "start": "2017480",
    "end": "2025799"
  },
  {
    "text": "instead um eventually I'm going to unmount that that old root file system",
    "start": "2025960",
    "end": "2032799"
  },
  {
    "text": "because we don't need it in a picture this is what pivot root is doing you know we've got before we've",
    "start": "2032799",
    "end": "2040120"
  },
  {
    "text": "got a our real route directory we've got some location underneath which is where my I'm going to mount my new root file",
    "start": "2040120",
    "end": "2047480"
  },
  {
    "text": "system um and what's happening is all that pivot root is doing is shuffling the mounts around it's arranging things",
    "start": "2047480",
    "end": "2053919"
  },
  {
    "text": "so this new route is now the root Mount and the slash Mount here got mounted",
    "start": "2053919",
    "end": "2059480"
  },
  {
    "text": "down here so now it's sitting underneath the new root Mount that's all it's doing just shuffling mounts",
    "start": "2059480",
    "end": "2066158"
  },
  {
    "text": "around um there's a lot of rules about using pivot roote I don't want to try and explain",
    "start": "2066159",
    "end": "2071800"
  },
  {
    "text": "them all uh you can read the manual page but um there's a few rules like the the",
    "start": "2071800",
    "end": "2077638"
  },
  {
    "text": "new root and put old um must not be on the uh same Mount as the current route",
    "start": "2077639",
    "end": "2084599"
  },
  {
    "text": "and when you look at that picture of course well you you can work out why we'd end up with something quite",
    "start": "2084599",
    "end": "2090040"
  },
  {
    "text": "circular um the uh what else should I say um new route must be the path name",
    "start": "2090040",
    "end": "2097240"
  },
  {
    "text": "of an existing Mount the reason is all the pivot R is doing is rearranging mounts now if our new root Mount is not",
    "start": "2097240",
    "end": "2105920"
  },
  {
    "text": "a mount that's easy to fix all we do is make a bind Mount where we Mount the",
    "start": "2105920",
    "end": "2111640"
  },
  {
    "text": "same directory on top of itself and then it looks like a mount point and pivot roote can Shuffle it around and that's",
    "start": "2111640",
    "end": "2117359"
  },
  {
    "text": "what I will be doing there's also another detail that I I'm not going to try and explain which",
    "start": "2117359",
    "end": "2123680"
  },
  {
    "text": "is I need to turn off what is called Mount propagation in the new mountain and space for the various mounts and the",
    "start": "2123680",
    "end": "2129560"
  },
  {
    "text": "reason is Mount propagation is a a mechanism that the kernel uses to automatically copy mounts from one",
    "start": "2129560",
    "end": "2136880"
  },
  {
    "text": "Mountain Land space to another and this happens by default but I don't want that to happen because if I did that and the",
    "start": "2136880",
    "end": "2143280"
  },
  {
    "text": "M new amounts I'm going to create got propagated to the main mountain l space that' be a mess for everyone else so I'm",
    "start": "2143280",
    "end": "2149640"
  },
  {
    "text": "going to disable Mount propagation so to disable Mount propagation I say Mount D-",
    "start": "2149640",
    "end": "2156280"
  },
  {
    "text": "make our private private is the opposite of shared shared is the thing that",
    "start": "2156280",
    "end": "2161359"
  },
  {
    "text": "propagates private says don't do propagation um then um make my new root mount a amount",
    "start": "2161359",
    "end": "2170440"
  },
  {
    "text": "make my directory merged amount by saying Mount D- bind merged on top of merge all that did was create a mount",
    "start": "2170440",
    "end": "2176440"
  },
  {
    "text": "point at that directory and it's still the same contents that divisible there it's just a way of making a mount at",
    "start": "2176440",
    "end": "2182079"
  },
  {
    "text": "that location um make uh old Route ifs that's wrong that the old rout the old",
    "start": "2182079",
    "end": "2187680"
  },
  {
    "text": "route is going to end up the old Route Mount uh and then do the pivot where I say make merge the new route and move",
    "start": "2187680",
    "end": "2194240"
  },
  {
    "text": "the old rout to merged old root FS then simple stuff here I want some",
    "start": "2194240",
    "end": "2202599"
  },
  {
    "text": "other nice stuff in terms of mounts in my container mount a proc file system mount a CFS file system mount a cgroup",
    "start": "2202599",
    "end": "2209960"
  },
  {
    "text": "file system mount an mq file system for for my posix message cues that's all simple stuff and then I want some",
    "start": "2209960",
    "end": "2216200"
  },
  {
    "text": "devices um this is the standard sort of set of devices you'd find inside a container",
    "start": "2216200",
    "end": "2221480"
  },
  {
    "text": "full device null device random TTY Ur random zero I pull when I first learned",
    "start": "2221480",
    "end": "2228240"
  },
  {
    "text": "how to do this I was kind of surprised that it works but it does I say in the",
    "start": "2228240",
    "end": "2233560"
  },
  {
    "text": "dev directory make a file with that name and then Mount D- bind from the old root",
    "start": "2233560",
    "end": "2239839"
  },
  {
    "text": "file system in the dev directory bind Mount that device to slev in my new root",
    "start": "2239839",
    "end": "2245680"
  },
  {
    "text": "Mount and this just works um I was surprised that it just works but it does um and this gives me those",
    "start": "2245680",
    "end": "2252960"
  },
  {
    "text": "devices and then I don't need the old root Mount anymore so I do an unmount of",
    "start": "2252960",
    "end": "2258520"
  },
  {
    "text": "that old root Mount that throws away all the old root Mount and all the submounts underneath it uh and then I can remove",
    "start": "2258520",
    "end": "2264960"
  },
  {
    "text": "that directory then I set my host name from the environment variable that got set up earlier on and that's",
    "start": "2264960",
    "end": "2273440"
  },
  {
    "text": "it oh what was I what time was I supposed to finish was it about 10:00 I suppose was it no sorry um",
    "start": "2273440",
    "end": "2281319"
  },
  {
    "text": "11:00 maybe um the second half is just going to be demonstrating how this all works in practice okay and we'll see how",
    "start": "2281319",
    "end": "2288359"
  },
  {
    "text": "things look um but maybe there are some questions first before we yes please down the back ignut I recognize you",
    "start": "2288359",
    "end": "2298000"
  },
  {
    "text": "I'm going to I think you're good it's just hello hello yeah yeah so it's recording like",
    "start": "2318319",
    "end": "2324000"
  },
  {
    "text": "in your preset upscript you're first creating the merged View using overlay fs and then creating the container yeah",
    "start": "2324000",
    "end": "2330720"
  },
  {
    "text": "and for that you need super user privileges in the host file system do you think it's possible to arrange it in",
    "start": "2330720",
    "end": "2336880"
  },
  {
    "text": "a way that you can do it from an unprivileged user for example if you create a username space first and then",
    "start": "2336880",
    "end": "2343720"
  },
  {
    "text": "create overlay FS inside the name space so perhaps you can do everything without",
    "start": "2343720",
    "end": "2349160"
  },
  {
    "text": "having super user privileges to hang hang I'm I'm a little puzzled they say I needed super user PR but when I created",
    "start": "2349160",
    "end": "2355160"
  },
  {
    "text": "that lower directory I didn't use any super user Powers no I mean when you did the mount overlay ah um yeah and that",
    "start": "2355160",
    "end": "2363440"
  },
  {
    "text": "mount was being done yes okay um I think it is not possible M um to do that",
    "start": "2363440",
    "end": "2371480"
  },
  {
    "text": "step from within the container uh I'm moderately sure of that I want to double",
    "start": "2371480",
    "end": "2377680"
  },
  {
    "text": "check but I think it's not possible because I didn't never research how that works in inside but like there is a",
    "start": "2377680",
    "end": "2384440"
  },
  {
    "text": "project called rootless containers and I just recently yesterday not Docker has",
    "start": "2384440",
    "end": "2389880"
  },
  {
    "text": "like a you can switch a runtime to a rootless runtime where can you run Docker as an unprivileged user so they",
    "start": "2389880",
    "end": "2396839"
  },
  {
    "text": "might be doing some Tri some tricks like with some privileged username spaces",
    "start": "2396839",
    "end": "2401920"
  },
  {
    "text": "there I'm I'm not sure what they're doing there I'm sorry thank",
    "start": "2401920",
    "end": "2408200"
  },
  {
    "text": "you I I think not because the point is that inside a usern name space and and a new Mount name space there's only",
    "start": "2408200",
    "end": "2414280"
  },
  {
    "text": "certain kinds of mounts that you're allowed to create for instance you can't Mount block file systems from a",
    "start": "2414280",
    "end": "2420480"
  },
  {
    "text": "non-initial user namespace and I think the same is true for overlay FS as well",
    "start": "2420480",
    "end": "2426240"
  },
  {
    "text": "okay I mean I'll research that myself as well okay other questions",
    "start": "2426240",
    "end": "2433318"
  },
  {
    "text": "perhaps one okay maybe this better be the last question I guess uh you just briefly mentioned that",
    "start": "2434520",
    "end": "2441839"
  },
  {
    "text": "the SE comp will not work inside of this but um it's not that it will not work",
    "start": "2441839",
    "end": "2449200"
  },
  {
    "text": "it's rather there is no shell command that I can use to set up set comp filtering oh so that was the entire",
    "start": "2449200",
    "end": "2455920"
  },
  {
    "text": "reason it doesn't have a shell okay yep you you give me a standard shell command and I'll use it but there isn't",
    "start": "2455920",
    "end": "2462400"
  },
  {
    "text": "one uh LD pre well um ignot is the person who talk about",
    "start": "2462400",
    "end": "2467920"
  },
  {
    "text": "that um yes I know I looked at your talk just",
    "start": "2467920",
    "end": "2473720"
  },
  {
    "text": "last night actually um the um yeah you you you you",
    "start": "2473720",
    "end": "2479680"
  },
  {
    "text": "can pull some tricks with LD preload but um those tricks are not",
    "start": "2479680",
    "end": "2484839"
  },
  {
    "text": "bulletproof and um they it's not a complete",
    "start": "2484839",
    "end": "2490560"
  },
  {
    "text": "solution either okay see you if you want in whenever the",
    "start": "2490560",
    "end": "2499119"
  },
  {
    "text": "next session starts is it what 40 minutes 40 minutes from now I still have",
    "start": "2499119",
    "end": "2504280"
  },
  {
    "text": "20 minutes what oh here I was thinking I was supposed to be finished by now wow",
    "start": "2504280",
    "end": "2513240"
  },
  {
    "text": "okay thanks for that then I'll keep going let's launch our",
    "start": "2514960",
    "end": "2522240"
  },
  {
    "text": "container um so um I'm going to do these steps let's do",
    "start": "2523440",
    "end": "2529960"
  },
  {
    "text": "a live demo um live demos are the best because they can go wrong",
    "start": "2529960",
    "end": "2537520"
  },
  {
    "text": "um some of some people have already heard the joke but many years ago a training colleague said to me never pred",
    "start": "2537520",
    "end": "2544559"
  },
  {
    "text": "any live demonstration with a statement more predict then watch",
    "start": "2544559",
    "end": "2550640"
  },
  {
    "text": "this okay um all of the scripts by the way that I've shown you um they're all on my",
    "start": "2551920",
    "end": "2559119"
  },
  {
    "text": "website you can download the tab all in the location that's at the end of the slides okay so",
    "start": "2559119",
    "end": "2568319"
  },
  {
    "text": "um my scripts what I'm going to first of all do is make a directory let's call it demo and and",
    "start": "2568319",
    "end": "2577559"
  },
  {
    "text": "this is where I'm going to make my container file system so I'll step into",
    "start": "2577559",
    "end": "2583160"
  },
  {
    "text": "that directory and I'll maybe I'll make the",
    "start": "2583160",
    "end": "2589440"
  },
  {
    "text": "font size is that font size still okay down the back yep thank",
    "start": "2589440",
    "end": "2594680"
  },
  {
    "text": "you and then I'm going to use my um script that creates the lower",
    "start": "2594680",
    "end": "2603040"
  },
  {
    "text": "level layer of the file system and I'm I'm going to make that lower layer in a",
    "start": "2603040",
    "end": "2610119"
  },
  {
    "text": "directory called Lower okay it's done its thing if I look",
    "start": "2610119",
    "end": "2616680"
  },
  {
    "text": "inside the directory lower you know I've got a bunch of subd directories reasonable sorts of things you'd expect",
    "start": "2616680",
    "end": "2622400"
  },
  {
    "text": "to see in a root file system and then I'm going to run my next",
    "start": "2622400",
    "end": "2627599"
  },
  {
    "text": "script whoops",
    "start": "2627599",
    "end": "2631720"
  },
  {
    "text": "wrong uh my next script it takes as arguments the name of a group let's call",
    "start": "2632720",
    "end": "2639040"
  },
  {
    "text": "this um cgr1 uh and I should have said by the",
    "start": "2639040",
    "end": "2645319"
  },
  {
    "text": "way um I am doing all of this here's a just to show these two shells it is an",
    "start": "2645319",
    "end": "2651040"
  },
  {
    "text": "un I'm doing this as an unpre user um and",
    "start": "2651040",
    "end": "2658359"
  },
  {
    "text": "um [Music] the oh and one other thing I want to show you over here this is the host name",
    "start": "2658359",
    "end": "2665920"
  },
  {
    "text": "on my outer system okay and",
    "start": "2665920",
    "end": "2671520"
  },
  {
    "text": "a in my container I want a different host name let's say BN and",
    "start": "2671520",
    "end": "2678440"
  },
  {
    "text": "then um my lower directory which is just called Lower and then the place where I want",
    "start": "2678440",
    "end": "2686480"
  },
  {
    "text": "the rest of the pieces to be created for the overlay Mount which is just the current",
    "start": "2686480",
    "end": "2691680"
  },
  {
    "text": "directory and when I do that I'm going to ask for my password",
    "start": "2691680",
    "end": "2699040"
  },
  {
    "text": "okay that is now my root shell inside the",
    "start": "2702640",
    "end": "2709200"
  },
  {
    "text": "container and if I say Echo dollar",
    "start": "2709200",
    "end": "2717040"
  },
  {
    "text": "dollar one if I say show me my IDs zero okay U",
    "start": "2717040",
    "end": "2725920"
  },
  {
    "text": "ID z g ID if I say what am I cap oh now let's try",
    "start": "2725920",
    "end": "2732119"
  },
  {
    "text": "something else let's try this um the processes that are in the",
    "start": "2732119",
    "end": "2737800"
  },
  {
    "text": "container well there's the shell and there the PS that's it if I said you know let's say",
    "start": "2737800",
    "end": "2743040"
  },
  {
    "text": "PS sorry PS a you know list all the processes there are just two okay um",
    "start": "2743040",
    "end": "2751640"
  },
  {
    "text": "then what else should we should we see um",
    "start": "2751640",
    "end": "2758920"
  },
  {
    "text": "in the outside world in the P name space in the outside world this process this",
    "start": "2759400",
    "end": "2765599"
  },
  {
    "text": "busy box shell has a different PID if I say PID of busy box I hope I've only got",
    "start": "2765599",
    "end": "2772119"
  },
  {
    "text": "one of them running oh yes good it's got a different",
    "start": "2772119",
    "end": "2776839"
  },
  {
    "text": "PID this process in a lower level p namespace in the container has two different P IDs a PID in it in its PID",
    "start": "2777559",
    "end": "2784680"
  },
  {
    "text": "space but also P ID in the upper level P namespace you can actually see this in",
    "start": "2784680",
    "end": "2791760"
  },
  {
    "text": "the proc file system I can say GP for field called",
    "start": "2791760",
    "end": "2796960"
  },
  {
    "text": "nstg in the file proc1",
    "start": "2796960",
    "end": "2802240"
  },
  {
    "text": "13198 SL status this shows at this P",
    "start": "2802240",
    "end": "2807839"
  },
  {
    "text": "this P namespace level what are the various PS of that process",
    "start": "2807839",
    "end": "2814559"
  },
  {
    "text": "and two different P IDs now as well if I look at that file using",
    "start": "2814559",
    "end": "2825240"
  },
  {
    "text": "less um remember remember over here the process uid Z GID Z but if I look from",
    "start": "2825599",
    "end": "2833160"
  },
  {
    "text": "the outside world at the uids and the GS of that process in the outside world it",
    "start": "2833160",
    "end": "2839760"
  },
  {
    "text": "has uid G zero uh 1,000 I should say okay in the outside world this process",
    "start": "2839760",
    "end": "2846000"
  },
  {
    "text": "is not privileged but it is privileged in the inside World okay and of course one of the",
    "start": "2846000",
    "end": "2852520"
  },
  {
    "text": "things I did over here was you know the script set a host name there I'm seeing the host name BN over here in the",
    "start": "2852520",
    "end": "2861240"
  },
  {
    "text": "initial UTS name space I'm still seeing the host name",
    "start": "2861240",
    "end": "2868240"
  },
  {
    "text": "Wan if over here I now change the host name",
    "start": "2868240",
    "end": "2875160"
  },
  {
    "text": "lit and then just verify that change was made okay now a different host name there and over here the host name is",
    "start": "2875160",
    "end": "2883559"
  },
  {
    "text": "still W okay um now any other demonstrations I",
    "start": "2883559",
    "end": "2891640"
  },
  {
    "text": "should do uh no I think I've done that let's move",
    "start": "2891640",
    "end": "2898119"
  },
  {
    "text": "on so these are the steps where I launched my container just on the slides everything's on the slides um yeah so",
    "start": "2900160",
    "end": "2907240"
  },
  {
    "text": "then the question is you know um what about the name spaces inside my",
    "start": "2907240",
    "end": "2913240"
  },
  {
    "text": "container well we saw that my shell has pid1 that's because of the new P Nam space we saw that outside the process",
    "start": "2913240",
    "end": "2921040"
  },
  {
    "text": "has a different PID and the point here is that P namespaces exist in a",
    "start": "2921040",
    "end": "2928599"
  },
  {
    "text": "hierarchy um each P Nam space has a parent P npace which has a parent which has a parent and so on all the way back",
    "start": "2928599",
    "end": "2934880"
  },
  {
    "text": "to the very first p n space on the system which doesn't have a parent and a",
    "start": "2934880",
    "end": "2940079"
  },
  {
    "text": "process that's in a lower layer PID space has a PID in that npace but also",
    "start": "2940079",
    "end": "2945520"
  },
  {
    "text": "in the first ancestor and then the next ancestor and then the next ancestor probably the p is different in every",
    "start": "2945520",
    "end": "2951599"
  },
  {
    "text": "names space but the point is it has a PID in each namespace and",
    "start": "2951599",
    "end": "2959359"
  },
  {
    "text": "um we've also then got the idea that the container of course has a a file system",
    "start": "2959359",
    "end": "2965040"
  },
  {
    "text": "and so what I should really do is a live demo there um again my P of my uh busy",
    "start": "2965040",
    "end": "2972920"
  },
  {
    "text": "box process that that number just just just here let's from the outside world",
    "start": "2972920",
    "end": "2978000"
  },
  {
    "text": "do a find MN um- o whoops Das o um",
    "start": "2978000",
    "end": "2987079"
  },
  {
    "text": "Source Target that'll Target uh and then I think it's",
    "start": "2987079",
    "end": "2994960"
  },
  {
    "text": "oh dasht I think it is that was what was on the slide wasn't it no-",
    "start": "2994960",
    "end": "3001319"
  },
  {
    "text": "n-n 13198 show me the mounts that that",
    "start": "3001319",
    "end": "3007480"
  },
  {
    "text": "process sees in its Mount name space and I see a very small set of mounts",
    "start": "3007480",
    "end": "3015520"
  },
  {
    "text": "really compared to what you normally see on your wider Linux system where you probably see a boatload of mounts okay",
    "start": "3015520",
    "end": "3021480"
  },
  {
    "text": "there is the root Mount um there's a proc mount a Cy mount an mq file system some Dev mounts those were my various",
    "start": "3021480",
    "end": "3028240"
  },
  {
    "text": "devices that got bind mounted and and that's",
    "start": "3028240",
    "end": "3033200"
  },
  {
    "text": "it okay um I've already showed you the",
    "start": "3035640",
    "end": "3041480"
  },
  {
    "text": "credentials of the shell from inside and outside um how did that happen why is it",
    "start": "3041480",
    "end": "3047480"
  },
  {
    "text": "that this process here looks like it has uid zero but over in the outside world",
    "start": "3047480",
    "end": "3052839"
  },
  {
    "text": "looks like it has uid 1000 it's because along the way I created I used an option with unshare",
    "start": "3052839",
    "end": "3059520"
  },
  {
    "text": "saying map root user what map root user did was create what's called a uid map",
    "start": "3059520",
    "end": "3064760"
  },
  {
    "text": "for the username space and the uid map says what do IDs in the outside world",
    "start": "3064760",
    "end": "3070440"
  },
  {
    "text": "map to in the inside world and if I look at the uid map for that",
    "start": "3070440",
    "end": "3077960"
  },
  {
    "text": "process if I say cat slpr slash",
    "start": "3080520",
    "end": "3087559"
  },
  {
    "text": "uid Map There's the mapping it's saying inside the land space zero maps to 1,000",
    "start": "3087559",
    "end": "3095280"
  },
  {
    "text": "in the outside world and the length of the mapping is one so only a single U ID is being mapped you can have mappings",
    "start": "3095280",
    "end": "3100640"
  },
  {
    "text": "that are ranges of IDs by having a number that's bigger than one there at the end I've got a similar G",
    "start": "3100640",
    "end": "3108960"
  },
  {
    "text": "map looks exactly the same mapping 0 to 1,000 in the outside",
    "start": "3108960",
    "end": "3115040"
  },
  {
    "text": "world okay",
    "start": "3115040",
    "end": "3118520"
  },
  {
    "text": "I've already shown you the host name stuff uh I've got five",
    "start": "3122680",
    "end": "3130240"
  },
  {
    "text": "minutes let's keep going",
    "start": "3130240",
    "end": "3136520"
  },
  {
    "text": "um the question is how do I get to be super user inside the",
    "start": "3138960",
    "end": "3145520"
  },
  {
    "text": "container and and how does being super user work even as a concept inside the container and the point here is it's all",
    "start": "3145520",
    "end": "3152920"
  },
  {
    "text": "about namespaces and the relationship between username spaces and non username",
    "start": "3152920",
    "end": "3159440"
  },
  {
    "text": "spaces every non username space is owned by some particular username space and",
    "start": "3159440",
    "end": "3168599"
  },
  {
    "text": "um so uh when I say a non-user name space a m Nam space a UTS Nam space and so on every one of those non-user name",
    "start": "3168599",
    "end": "3175280"
  },
  {
    "text": "spaces owned by some particular username space and to be being super user means",
    "start": "3175280",
    "end": "3181440"
  },
  {
    "text": "you have super user Powers over the resources that are governed by the non-",
    "start": "3181440",
    "end": "3187559"
  },
  {
    "text": "username spaces that are owned by your username space now um what happened was that in",
    "start": "3187559",
    "end": "3194960"
  },
  {
    "text": "my container I think I've got a picture coming up um and I I should say um do we",
    "start": "3194960",
    "end": "3201079"
  },
  {
    "text": "uh we we can see that my shell has all capabilities because what I can do from",
    "start": "3201079",
    "end": "3206200"
  },
  {
    "text": "the outside world is um look in the proc PID status file and down",
    "start": "3206200",
    "end": "3213680"
  },
  {
    "text": "below some lines here that whoops tell me about the capabilities that my this",
    "start": "3213680",
    "end": "3221240"
  },
  {
    "text": "process has and the the numbers you're seeing there those are hexadecimal bit marks representing the capabilities and",
    "start": "3221240",
    "end": "3227599"
  },
  {
    "text": "there are 41 bits that are on there representing all 41 capabilities that",
    "start": "3227599",
    "end": "3233160"
  },
  {
    "text": "this shell has the colonel just magically did that it",
    "start": "3233160",
    "end": "3238640"
  },
  {
    "text": "said you are the first processor in a new username space and you shall have all capabilities but those capabilities",
    "start": "3238640",
    "end": "3244920"
  },
  {
    "text": "can only be exercised in the username",
    "start": "3244920",
    "end": "3249119"
  },
  {
    "text": "space okay and there's the picture I",
    "start": "3251200",
    "end": "3257200"
  },
  {
    "text": "wanted here's the setup We've Ended up with here's our",
    "start": "3257200",
    "end": "3262319"
  },
  {
    "text": "container like this it's got a username space and there's a number of other",
    "start": "3262319",
    "end": "3268040"
  },
  {
    "text": "namespaces a mountain namespace a time namespace a UTS namespace and so on that",
    "start": "3268040",
    "end": "3273640"
  },
  {
    "text": "are all owned by that username space and",
    "start": "3273640",
    "end": "3279480"
  },
  {
    "text": "our init process is a member of all of those Nam spaces I haven't shown all the name spaces because I don't have space",
    "start": "3279480",
    "end": "3285119"
  },
  {
    "text": "on the slide but that's the arrangement that we have and just wonder if I've got another",
    "start": "3285119",
    "end": "3292680"
  },
  {
    "text": "I thought I just I need to check if I have another picture that might be useful",
    "start": "3292680",
    "end": "3298319"
  },
  {
    "text": "uh not in the slide deck okay um the the point here is that you know",
    "start": "3299880",
    "end": "3306520"
  },
  {
    "text": "suppose this process tries to let's say change the host name what the colonel",
    "start": "3306520",
    "end": "3311960"
  },
  {
    "text": "says is host names are governed by UTS namespaces and then the colel says well which UTS namespace is this process a",
    "start": "3311960",
    "end": "3319440"
  },
  {
    "text": "member of and the answer is this UTS Nam space here and then the colonel says",
    "start": "3319440",
    "end": "3325319"
  },
  {
    "text": "well which you username space owns that UTS name space and the answer is this",
    "start": "3325319",
    "end": "3331400"
  },
  {
    "text": "username space and then the says well what capability does this process have in that uh usern name space and",
    "start": "3331400",
    "end": "3339960"
  },
  {
    "text": "need have a certain capability called capsus admin um but the point is the process this notation here is the",
    "start": "3339960",
    "end": "3345920"
  },
  {
    "text": "notation that says the process has all capabilities and it is a member of the usern name space therefore it's allowed",
    "start": "3345920",
    "end": "3351640"
  },
  {
    "text": "to do that thing but for instance uh if there was someone way that this process",
    "start": "3351640",
    "end": "3357280"
  },
  {
    "text": "could see the initial UTS namespace uh even if it could somehow see that namespace it wouldn't be able",
    "start": "3357280",
    "end": "3364000"
  },
  {
    "text": "to change the host name because it it's in it's in it has all capabilities in",
    "start": "3364000",
    "end": "3369200"
  },
  {
    "text": "its own usern name space has no capabilities up there in the initial username space and so this is how this",
    "start": "3369200",
    "end": "3375839"
  },
  {
    "text": "concept of super user inside the container Works without being super user in the outside",
    "start": "3375839",
    "end": "3382640"
  },
  {
    "text": "world um there is a program you can do use oh it's a little program of mind that we can use to do a bit of",
    "start": "3382680",
    "end": "3388480"
  },
  {
    "text": "visualization of what's going on um see the shape of the name spaces um",
    "start": "3388480",
    "end": "3396039"
  },
  {
    "text": "the",
    "start": "3396039",
    "end": "3399039"
  },
  {
    "text": "um I can say sudu name spaces oh sorry sudu go",
    "start": "3403359",
    "end": "3411280"
  },
  {
    "text": "run Nam spaces of.go if I just run the command like that it's going to show me all the process on my system and all the",
    "start": "3411640",
    "end": "3417280"
  },
  {
    "text": "name spaces too much information let's just compare the shell on the left here with",
    "start": "3417280",
    "end": "3425119"
  },
  {
    "text": "another process that's in the initial instance of the Nam spaces so let's try that PID that's the shell over here and",
    "start": "3425119",
    "end": "3431920"
  },
  {
    "text": "pid1 on my system even that is too much information",
    "start": "3431920",
    "end": "3437440"
  },
  {
    "text": "because that's going to show me eight different types of namespaces um so I'm going just just restrict the view a little bit I'm going",
    "start": "3437440",
    "end": "3443520"
  },
  {
    "text": "to say well don't show me all the namespaces just show me a few of the Nam spaces and I'm going to say show me the",
    "start": "3443520",
    "end": "3448799"
  },
  {
    "text": "user Nam space let's say the mount names space the p namespace and the UTS Nam",
    "start": "3448799",
    "end": "3454039"
  },
  {
    "text": "space memberships of those processes",
    "start": "3454039",
    "end": "3459280"
  },
  {
    "text": "and [Music] okay there there's my view the hierarchy",
    "start": "3459280",
    "end": "3467880"
  },
  {
    "text": "is represented through indentation what you see there at the top is the initial username",
    "start": "3467880",
    "end": "3473720"
  },
  {
    "text": "space which has um p id1 in it um below that there's the new new usern an space",
    "start": "3473720",
    "end": "3480480"
  },
  {
    "text": "that was created for my container and you can see there that it owns that's what the indentation is telling us also",
    "start": "3480480",
    "end": "3486359"
  },
  {
    "text": "about is telling us about ownership um it owns some um uh uh some Mountain Nam",
    "start": "3486359",
    "end": "3494960"
  },
  {
    "text": "space a p n space and UTS Nam space you can see the process there is a member of those Nam spaces um and then p id1 on",
    "start": "3494960",
    "end": "3501839"
  },
  {
    "text": "the other hand is a member of the initial Mountain aace the initial P namespace the initial UTS",
    "start": "3501839",
    "end": "3509119"
  },
  {
    "text": "namespace uh my program is very simplistic there is a much nicer program floating around written by someone who",
    "start": "3509119",
    "end": "3516079"
  },
  {
    "text": "lives not very far from me by chance called Alex knns and if you are curious",
    "start": "3516079",
    "end": "3525520"
  },
  {
    "text": "um go and find out about that project you can download gives you nice graphical visualizations of the name",
    "start": "3525520",
    "end": "3531079"
  },
  {
    "text": "spaces on your system um",
    "start": "3531079",
    "end": "3537039"
  },
  {
    "text": "I'm supposed to finish this this hour embarrassingly I've almost finished the",
    "start": "3542000",
    "end": "3550079"
  },
  {
    "text": "presentation what do you want to do take a short break now or I can go for another 15 minutes and I'll probably just",
    "start": "3550680",
    "end": "3557000"
  },
  {
    "text": "finish take the 15 yeah if you leave I won't hold it against",
    "start": "3557000",
    "end": "3563359"
  },
  {
    "text": "you I will keep going then so then the question is c groups inside",
    "start": "3563359",
    "end": "3571440"
  },
  {
    "text": "the container um my container was set up with",
    "start": "3571440",
    "end": "3577480"
  },
  {
    "text": "a cgroup for doing resource management and we can see",
    "start": "3577480",
    "end": "3584599"
  },
  {
    "text": "this because there was a a c group that was created what I can do is say cat slpr SL",
    "start": "3584599",
    "end": "3592880"
  },
  {
    "text": "my P ID of my shell on the left SL cgroup there's the cgroup that was",
    "start": "3592880",
    "end": "3598720"
  },
  {
    "text": "created and this this is telling us this process is a member of that c group",
    "start": "3598720",
    "end": "3605079"
  },
  {
    "text": "now um I can use cgroups for doing resource",
    "start": "3605079",
    "end": "3610119"
  },
  {
    "text": "limitation what I'm going to do is step into another",
    "start": "3610119",
    "end": "3617480"
  },
  {
    "text": "directory where I'm going to say copy a",
    "start": "3617480",
    "end": "3622839"
  },
  {
    "text": "little program that I created earlier on um what prr does is just burn up CPU time and print out how much CPU time",
    "start": "3622839",
    "end": "3629079"
  },
  {
    "text": "it's getting each second and I'm going to copy that into my container so I'm",
    "start": "3629079",
    "end": "3635319"
  },
  {
    "text": "going to say copy into uh oh hang on a",
    "start": "3635319",
    "end": "3643240"
  },
  {
    "text": "second which directory I did I do all this in let's have a quick look um alas",
    "start": "3643240",
    "end": "3649599"
  },
  {
    "text": "alas tool LSP con looks like I did it there good okay",
    "start": "3649599",
    "end": "3658000"
  },
  {
    "text": "um so I'm going to copy that binary CPU",
    "start": "3658000",
    "end": "3663720"
  },
  {
    "text": "burner um I did prepare this early and I just want to mention in passing it is statically linked and the reason is I",
    "start": "3663720",
    "end": "3670640"
  },
  {
    "text": "don't have any shared libraries in my container so I need to have a statically linked",
    "start": "3670640",
    "end": "3675920"
  },
  {
    "text": "binary um and so I'm going to copy that into T LSP",
    "start": "3675920",
    "end": "3683880"
  },
  {
    "text": "ksh and into the directory demo and then let's just copy it into the upper level",
    "start": "3683880",
    "end": "3690480"
  },
  {
    "text": "file system the upper level directory of the overlay Mount and hopefully I've done things right now um there it is",
    "start": "3690480",
    "end": "3698760"
  },
  {
    "text": "sitting there in the root directory of my container file system and then I'm going to run that",
    "start": "3698760",
    "end": "3705599"
  },
  {
    "text": "program and what it's doing is every second printing out how much CPU time I got",
    "start": "3705599",
    "end": "3713000"
  },
  {
    "text": "um that's remarkable",
    "start": "3713000",
    "end": "3717240"
  },
  {
    "text": "I think there's something is I think I wonder if my clock is a bit of skew my clock this m there's some",
    "start": "3718119",
    "end": "3725440"
  },
  {
    "text": "something strange going on with the clock on my machine it's running 8% fast um so this is a magnificent program it",
    "start": "3725440",
    "end": "3732640"
  },
  {
    "text": "gets 108% of Time Each CPU second um yeah okay ignore that little glitch um",
    "start": "3732640",
    "end": "3741279"
  },
  {
    "text": "now what I'm going to do from the outside world is now use that cgroup",
    "start": "3741279",
    "end": "3747319"
  },
  {
    "text": "to limit the CPU time that this processor can get I was going to say it",
    "start": "3747319",
    "end": "3752359"
  },
  {
    "text": "can get 50% well it's going to get 54% I think the right thing is going but really it's 50% so to do that what I do",
    "start": "3752359",
    "end": "3761480"
  },
  {
    "text": "is say pseudo um sh- C and I want to say",
    "start": "3761480",
    "end": "3769079"
  },
  {
    "text": "Echo um oh look I'm going to do this different way I'm going to step into the",
    "start": "3769079",
    "end": "3775079"
  },
  {
    "text": "CIS FSC group directory and then give myself a root",
    "start": "3775079",
    "end": "3783200"
  },
  {
    "text": "shell okay change that shell prompt to something shorter and then say",
    "start": "3784400",
    "end": "3791880"
  },
  {
    "text": "Echo two numbers these two numbers are essentially expressing a",
    "start": "3791880",
    "end": "3797359"
  },
  {
    "text": "fraction and um what I'm saying it's 50% half of",
    "start": "3797359",
    "end": "3802920"
  },
  {
    "text": "a CPU and I'm going to write that number into",
    "start": "3802920",
    "end": "3808279"
  },
  {
    "text": "that um hang",
    "start": "3808279",
    "end": "3814079"
  },
  {
    "text": "on okay write that number sorry about",
    "start": "3820279",
    "end": "3825960"
  },
  {
    "text": "that Echo",
    "start": "3825960",
    "end": "3830160"
  },
  {
    "text": "50,000 100,000 into",
    "start": "3832920",
    "end": "3840640"
  },
  {
    "text": "um cgr1 cpu.",
    "start": "3841359",
    "end": "3847920"
  },
  {
    "text": "Max and there we go it's sort of settled",
    "start": "3847920",
    "end": "3854119"
  },
  {
    "text": "down now now now my clock's doing the right thing okay so I'm getting 50% of the CPU",
    "start": "3854119",
    "end": "3859559"
  },
  {
    "text": "time okay so this is you know just an example of how cgroups can be used to do",
    "start": "3859559",
    "end": "3866400"
  },
  {
    "text": "resource limitation um you can also do things like limiting memory usage limiting Network bandwidth there's",
    "start": "3866400",
    "end": "3873079"
  },
  {
    "text": "various resources that you can limit using",
    "start": "3873079",
    "end": "3878279"
  },
  {
    "text": "cgroups Okay um what else do I want to say I've",
    "start": "3878279",
    "end": "3883480"
  },
  {
    "text": "already done that demo um I'm not going to try look I'm going",
    "start": "3883480",
    "end": "3889599"
  },
  {
    "text": "to just go a little bit further and then call it a day um yes sorry ignot",
    "start": "3889599",
    "end": "3896279"
  },
  {
    "text": "50% of our CPU yeah",
    "start": "3903160",
    "end": "3910680"
  },
  {
    "text": "yes these numbers are always absolute so a low a higher level percent is a cap",
    "start": "3915240",
    "end": "3923200"
  },
  {
    "text": "for the lower level percent yeah there's another way of using the CPU controller where you can say I want to actually do",
    "start": "3923200",
    "end": "3929839"
  },
  {
    "text": "subdivision um but that's not the mode I'm demonstrating at the moment you",
    "start": "3929839",
    "end": "3936039"
  },
  {
    "text": "so yeah no when I use the C CPU controller",
    "start": "3946960",
    "end": "3953440"
  },
  {
    "text": "in this mode these are always absolute numbers if I said 50% at the top level",
    "start": "3953440",
    "end": "3958640"
  },
  {
    "text": "and you know 40% or let's say 50% at the next level down it's 50% absolutely in",
    "start": "3958640",
    "end": "3964559"
  },
  {
    "text": "both places but there is another mode you can use where you can say uh these two groups I get half each but then",
    "start": "3964559",
    "end": "3971079"
  },
  {
    "text": "under this one I'll create two child secrets to get half each of what came from above and they would get quarter",
    "start": "3971079",
    "end": "3978839"
  },
  {
    "text": "then okay look I'm going to skip the networking demo I'll just say you can do it um but um",
    "start": "3978839",
    "end": "3986920"
  },
  {
    "text": "I just want to perhaps just finish off with one more",
    "start": "3986920",
    "end": "3992279"
  },
  {
    "text": "thing if this was a cool container what would what would be a",
    "start": "3994440",
    "end": "3999960"
  },
  {
    "text": "cool container I think or maybe just one inside",
    "start": "3999960",
    "end": "4006799"
  },
  {
    "text": "another yeah it' be a cool container I think if I could have a container inside a container",
    "start": "4006799",
    "end": "4013559"
  },
  {
    "text": "yeah I can do it okay one more thing that I should be",
    "start": "4013559",
    "end": "4019119"
  },
  {
    "text": "able to do in a decent container container inside a container Docker couldn't do that for",
    "start": "4019119",
    "end": "4024720"
  },
  {
    "text": "years I did it in days okay um so there are a few",
    "start": "4024720",
    "end": "4031680"
  },
  {
    "text": "challenges one is buy box does have an unshare outlet but the unshare outlet doesn't know about all the name spaces",
    "start": "4031680",
    "end": "4037839"
  },
  {
    "text": "yet so it doesn't know about cgroup name spaces I didn't talk about CP name spaces but point is it just simply",
    "start": "4037839",
    "end": "4043000"
  },
  {
    "text": "doesn't do them doesn't have the option for doing a coup name space the way I'm going to fix that problem is I'm going",
    "start": "4043000",
    "end": "4048599"
  },
  {
    "text": "to take the standard unshare program copy it into my bin directory",
    "start": "4048599",
    "end": "4055279"
  },
  {
    "text": "um uh my ksh setup script uses pseudo but busy box doesn't have a pseudo",
    "start": "4055279",
    "end": "4061880"
  },
  {
    "text": "applet um that doesn't matter my shell inside my container has super user",
    "start": "4061880",
    "end": "4067640"
  },
  {
    "text": "Powers anyway so what I'm going to do is edit my script just to remove the pseudo",
    "start": "4067640",
    "end": "4073680"
  },
  {
    "text": "strings and then one more thing uh the upper layer of an overlay file system",
    "start": "4073680",
    "end": "4079760"
  },
  {
    "text": "cannot itself be an overlay file system so the way I'm going to solve that problem is I'm going to mount a",
    "start": "4079760",
    "end": "4086720"
  },
  {
    "text": "temps uh and use that as the upper layer for the overlay file system used in the",
    "start": "4086720",
    "end": "4093039"
  },
  {
    "text": "lower level container okay let's it's always best",
    "start": "4093039",
    "end": "4099758"
  },
  {
    "text": "when we do it live isn't it it'll go wrong um now let's step",
    "start": "4099759",
    "end": "4107600"
  },
  {
    "text": "back um I've got my scripts here and I want to put those into my container file",
    "start": "4107600",
    "end": "4115679"
  },
  {
    "text": "system so what I'm going to do is say copy those script files into",
    "start": "4115679",
    "end": "4122560"
  },
  {
    "text": "demo lower and now if I look there are the",
    "start": "4122560",
    "end": "4130640"
  },
  {
    "text": "scripts now in my container file system then I want to",
    "start": "4130640",
    "end": "4137440"
  },
  {
    "text": "edit the files so the pseudo words are gone in those copies",
    "start": "4137440",
    "end": "4144960"
  },
  {
    "text": "so whoops uh I'm cheating here a little bit I",
    "start": "4144960",
    "end": "4151440"
  },
  {
    "text": "prepared this command earlier um and uh had it in my history and this",
    "start": "4151440",
    "end": "4158719"
  },
  {
    "text": "is just the thing that edits out those pseudo words oh what did I do wrong",
    "start": "4158719",
    "end": "4165960"
  },
  {
    "text": "wrong Oh wrong place is it the wrong place yes it's the wrong place isn't",
    "start": "4165960",
    "end": "4172080"
  },
  {
    "text": "it no hang on oh did I did I put them in lower that",
    "start": "4174199",
    "end": "4179798"
  },
  {
    "text": "was it ah yeah of course I did there I are you can see it there there we",
    "start": "4179799",
    "end": "4185798"
  },
  {
    "text": "go um and I need a an unchair so I need to uh I'll say RM",
    "start": "4185799",
    "end": "4198040"
  },
  {
    "text": "out of demo lower",
    "start": "4198040",
    "end": "4203360"
  },
  {
    "text": "bin remove the unshare link because I'm going to replace it with something",
    "start": "4203360",
    "end": "4209640"
  },
  {
    "text": "else and then",
    "start": "4209640",
    "end": "4216719"
  },
  {
    "text": "uh ah again I'm just grabbing this out of my history to save myself some time this is my statically link version",
    "start": "4218920",
    "end": "4225320"
  },
  {
    "text": "version of the standard unshare command and I'm copying that um into demol lower",
    "start": "4225320",
    "end": "4232800"
  },
  {
    "text": "bin unshare uh have I now done all the steps that I need to do I said I need the",
    "start": "4232800",
    "end": "4241520"
  },
  {
    "text": "unshare I need to do the edit and oh I need to do the the the Mount of the",
    "start": "4241520",
    "end": "4247719"
  },
  {
    "text": "camper Fest file system of course um",
    "start": "4247719",
    "end": "4254760"
  },
  {
    "text": "now I need to remind myself of what I need to do there yeah yes okay so",
    "start": "4255440",
    "end": "4263000"
  },
  {
    "text": "um those were the steps I needed to do outside the container but what I want to",
    "start": "4263000",
    "end": "4268960"
  },
  {
    "text": "do now is some steps inside the container where I will say I've got to",
    "start": "4268960",
    "end": "4274239"
  },
  {
    "text": "remind myself of one or two things here um yeah um here's my my outer container",
    "start": "4274239",
    "end": "4279440"
  },
  {
    "text": "here I'm going to make a subdirectory called demo inner",
    "start": "4279440",
    "end": "4286719"
  },
  {
    "text": "and then uh um do a mount DT",
    "start": "4286719",
    "end": "4295880"
  },
  {
    "text": "temps uh temps demo",
    "start": "4295920",
    "end": "4301840"
  },
  {
    "text": "inner and step into that",
    "start": "4301840",
    "end": "4307400"
  },
  {
    "text": "directory and then just do an Al dot dot yeah so I've got all the pieces in place",
    "start": "4307400",
    "end": "4313560"
  },
  {
    "text": "now and I'm going to now run my create lower FS script create the",
    "start": "4313560",
    "end": "4321239"
  },
  {
    "text": "lower layer file system for the inner container in a directory and again I'll",
    "start": "4321239",
    "end": "4326800"
  },
  {
    "text": "just call the directory lower and then create oops",
    "start": "4326800",
    "end": "4335440"
  },
  {
    "text": "ksh setup uh Dash C group group let's call",
    "start": "4335440",
    "end": "4342159"
  },
  {
    "text": "it cgroup C group two different host name let's",
    "start": "4342159",
    "end": "4352239"
  },
  {
    "text": "try langid oh no let's try something else um",
    "start": "4352239",
    "end": "4359560"
  },
  {
    "text": "pukaki and then the directory with my lower layer file system and where I want",
    "start": "4359880",
    "end": "4366159"
  },
  {
    "text": "the file system to be set up which is just the current directory oh",
    "start": "4366159",
    "end": "4373320"
  },
  {
    "text": "no it's a demo um what did I do wrong uh",
    "start": "4373320",
    "end": "4380678"
  },
  {
    "text": "sorry yes but I've why have I done this how have I done this",
    "start": "4381639",
    "end": "4386800"
  },
  {
    "text": "wrong uh interestingly I've done something suddenly wrong but I have got a process",
    "start": "4386800",
    "end": "4393000"
  },
  {
    "text": "with p id1 and I think that that's a different busy box now let's just say I",
    "start": "4393000",
    "end": "4398520"
  },
  {
    "text": "did something subtly wrong there but let's just say p ID of busy box",
    "start": "4398520",
    "end": "4403760"
  },
  {
    "text": "here there are two busy boxes that's my inner busy box I've just messed up",
    "start": "4403760",
    "end": "4410080"
  },
  {
    "text": "something in the file system um and if I say GP",
    "start": "4410080",
    "end": "4418679"
  },
  {
    "text": "NSG inpr sl11 14244 that's the second",
    "start": "4419960",
    "end": "4426960"
  },
  {
    "text": "layer uh status three p IDs because three levels",
    "start": "4426960",
    "end": "4434400"
  },
  {
    "text": "of P space okay it's a nearly working container inside a container I just did",
    "start": "4434400",
    "end": "4440239"
  },
  {
    "text": "something subtly wrong okay um you I think if I over here",
    "start": "4440239",
    "end": "4446400"
  },
  {
    "text": "if I prob if I type commands like LS yeah I messed up but you",
    "start": "4446400",
    "end": "4454159"
  },
  {
    "text": "it I did just something subtle subtle wrong I I missed some step um so I'm",
    "start": "4454159",
    "end": "4462239"
  },
  {
    "text": "going to say I made a container and a container but I just messed up a little bit on the way you can check my slides",
    "start": "4462239",
    "end": "4468400"
  },
  {
    "text": "to see where I went wrong okay best thing about live demos is they can go wrong okay ignot of course a",
    "start": "4468400",
    "end": "4477960"
  },
  {
    "text": "question I could but you know let's not compound my [Laughter]",
    "start": "4481400",
    "end": "4488000"
  },
  {
    "text": "errors um any other questions okay you got two talks for the",
    "start": "4488000",
    "end": "4494280"
  },
  {
    "text": "price of one you probably even sneak into another session now okay um I don't know why I went so fast getting too much",
    "start": "4494280",
    "end": "4501440"
  },
  {
    "text": "practice I guess um thank you for your time unless there's any more questions oh",
    "start": "4501440",
    "end": "4508230"
  },
  {
    "text": "[Applause]",
    "start": "4508230",
    "end": "4510830"
  }
]