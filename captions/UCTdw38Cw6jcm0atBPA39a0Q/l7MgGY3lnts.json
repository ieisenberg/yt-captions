[
  {
    "text": "hello thank you who's been using identity server in the",
    "start": "6490",
    "end": "14660"
  },
  {
    "text": "past okay version three are working for free for a",
    "start": "14660",
    "end": "20680"
  },
  {
    "text": "couple of people okay why are you here [Laughter]",
    "start": "20680",
    "end": "25840"
  },
  {
    "text": "so this talk is mostly useful for people you know that that have been using free",
    "start": "25840",
    "end": "32210"
  },
  {
    "text": "and now want to go to for and to see like what's the Delta between the versions but obviously if you haven't",
    "start": "32210",
    "end": "38059"
  },
  {
    "text": "used it at all you use the you know you'll still get something out of it by me trying to write code on this lovely",
    "start": "38059",
    "end": "45440"
  },
  {
    "text": "table here so you know we we created",
    "start": "45440",
    "end": "50869"
  },
  {
    "text": "identity server free oh well I don't know two and a half three years ago to",
    "start": "50869",
    "end": "58010"
  },
  {
    "text": "to solve the problem right so it's not like like it didn't happen because we",
    "start": "58010",
    "end": "63559"
  },
  {
    "text": "wanted to sell something it happened because we wanted to solve a problem and the problem was that basically none of",
    "start": "63559",
    "end": "70369"
  },
  {
    "text": "the commercial offerings identity offerings are really good enough for today's scenarios yeah so they might be",
    "start": "70369",
    "end": "78049"
  },
  {
    "text": "okay if you're starting on a complete cream-filled scenario and if you are adapting your business to how their",
    "start": "78049",
    "end": "83929"
  },
  {
    "text": "stuff works but if you are want to do your death the way you want to do it and just have a framework that works the way",
    "start": "83929",
    "end": "90380"
  },
  {
    "text": "you want it or if you're you know having more complicated scenarios like my",
    "start": "90380",
    "end": "95780"
  },
  {
    "text": "creation and all these things then you know customers just came to me and said like we evaluated all of these products",
    "start": "95780",
    "end": "102109"
  },
  {
    "text": "and they don't work for us there so that's what why Brock and I started writing this framework for identity so",
    "start": "102109",
    "end": "109159"
  },
  {
    "text": "yeah it's it's it's not a server that comes with an install XE and you just walk through a wizard and then you're",
    "start": "109159",
    "end": "114679"
  },
  {
    "text": "done because that's what all the others do yeah you get a framework it's for developers identity server is only",
    "start": "114679",
    "end": "120889"
  },
  {
    "text": "useful if you're willing to write code against it okay so that was our intention tech back in you know actually",
    "start": "120889",
    "end": "128509"
  },
  {
    "text": "did the very first version was in 2009 but the whole framework thing started I",
    "start": "128509",
    "end": "134540"
  },
  {
    "text": "guess three years ago or so where we actually hit a brick wall as well with",
    "start": "134540",
    "end": "139940"
  },
  {
    "text": "our like all in the box solution style which realized wow there are so many",
    "start": "139940",
    "end": "145880"
  },
  {
    "text": "other scenarios out there which you can't cover with a turnkey style solution ma'am",
    "start": "145880",
    "end": "151420"
  },
  {
    "text": "so you know many people use a dental of three it was built on top of katana yeah",
    "start": "151420",
    "end": "157580"
  },
  {
    "text": "which was the predecessor to a spinet core katana had a couple of issues",
    "start": "157580",
    "end": "163300"
  },
  {
    "text": "mostly lack of features that we actually needed yeah things like the eye and",
    "start": "163300",
    "end": "168440"
  },
  {
    "text": "logging and actually a UI framework and and so on so we had to work around all of these",
    "start": "168440",
    "end": "174470"
  },
  {
    "text": "things we are not proud that we wrote our own few engine believe me nobody",
    "start": "174470",
    "end": "181100"
  },
  {
    "text": "wants to do that yeah and that we had to implement our own anti fitori cookies",
    "start": "181100",
    "end": "186350"
  },
  {
    "text": "and protection and all these things so but yeah that's the way it was and you",
    "start": "186350",
    "end": "192440"
  },
  {
    "text": "know people were happy and for the most part with that now when the Holy Spirit",
    "start": "192440",
    "end": "197480"
  },
  {
    "text": "coughing started Microsoft the eighth canet team came to us and said like you know what we have these or",
    "start": "197480",
    "end": "205180"
  },
  {
    "text": "authorizations of a middle way of thing and and we gave a lot of vocal feedback",
    "start": "205180",
    "end": "210950"
  },
  {
    "text": "that this is not really good what they're doing yeah and they knew that and it said yeah yeah yeah you are right",
    "start": "210950",
    "end": "216260"
  },
  {
    "text": "yeah I mean we should stay with our core competence and just build the web framework and let's security to the",
    "start": "216260",
    "end": "221450"
  },
  {
    "text": "professionals s-silly once said to me so",
    "start": "221450",
    "end": "227630"
  },
  {
    "text": "they said okay you know what for a third core we're going to focus on just consuming tokens right so we're going to",
    "start": "227630",
    "end": "233750"
  },
  {
    "text": "build all the middleware that you can connect your MVC applications to a token service to consume the tokens we're going to build a middleware for your",
    "start": "233750",
    "end": "240380"
  },
  {
    "text": "chasing for your Web API to consume tokens but we are not going to build",
    "start": "240380",
    "end": "246769"
  },
  {
    "text": "anything that will produce tokens so they said like are you guys willing to",
    "start": "246769",
    "end": "252080"
  },
  {
    "text": "fill that gap with identities of tossing it to a student core and by the time you",
    "start": "252080",
    "end": "260329"
  },
  {
    "text": "know I was young and I needed the money I said yeah let's do that sounds good yeah and then there was this whole long",
    "start": "260330",
    "end": "266900"
  },
  {
    "text": "period of a spinet core you know having trauma every day and",
    "start": "266900",
    "end": "272360"
  },
  {
    "text": "you know nightly builds our seas which were pre-alpha status and rtems which",
    "start": "272360",
    "end": "278720"
  },
  {
    "text": "were our seas and yeah keeping up with that was was tough right so a year later",
    "start": "278720",
    "end": "284810"
  },
  {
    "text": "I have gray hair I didn't have that a year before and and and we finally",
    "start": "284810",
    "end": "290479"
  },
  {
    "text": "release that yeah so in the end we are happy with the end result but it was a",
    "start": "290479",
    "end": "296810"
  },
  {
    "text": "long road and that was mostly the.net Coral Road which was long way and we and",
    "start": "296810",
    "end": "301939"
  },
  {
    "text": "we had to basically you know keep up with that so what what is talk really is about is what what has changed in",
    "start": "301939",
    "end": "308659"
  },
  {
    "text": "between three and four which is also about what is new in a spirit core which",
    "start": "308659",
    "end": "314120"
  },
  {
    "text": "allowed us to make these changes so we deleted a lot of code and that's a good thing yeah why because that code was",
    "start": "314120",
    "end": "321469"
  },
  {
    "text": "moved into the base framework so the first thing that is actually new is we",
    "start": "321469",
    "end": "327590"
  },
  {
    "text": "have a website finally you know the cool IO website for you know the cool open",
    "start": "327590",
    "end": "336349"
  },
  {
    "text": "source project that is basically your starting point into everything identical",
    "start": "336349",
    "end": "342979"
  },
  {
    "text": "for related yeah so you can get to the github repo from here we have documentation now well we had it before",
    "start": "342979",
    "end": "349339"
  },
  {
    "text": "but I think it's better than the one behaviour before we do training on a regular basis I just did do the training",
    "start": "349339",
    "end": "356180"
  },
  {
    "text": "yesterday and the day before what they're just more for example in Oslo again people were underwear that we are",
    "start": "356180",
    "end": "362779"
  },
  {
    "text": "actually doing consulting so you know just if you asking yourselves writing open-source software doesn't pay the",
    "start": "362779",
    "end": "368000"
  },
  {
    "text": "bills right because it's for many people open source means free software right so",
    "start": "368000",
    "end": "373159"
  },
  {
    "text": "we are actually doing consulting most of the time to be having the luxury of",
    "start": "373159",
    "end": "378349"
  },
  {
    "text": "doing open source on the side ma'am what is actually new is we have production",
    "start": "378349",
    "end": "383900"
  },
  {
    "text": "support for you know like SLA so many people said like yeah we would like to use our identity server but our admins",
    "start": "383900",
    "end": "390770"
  },
  {
    "text": "are nervous they want to have a you know production support plan where they can call someone",
    "start": "390770",
    "end": "396349"
  },
  {
    "text": "if something goes wrong and we have that now above for the states and for Europe",
    "start": "396349",
    "end": "402099"
  },
  {
    "text": "okay let's go to the source code so here's our organization in case you",
    "start": "402099",
    "end": "408490"
  },
  {
    "text": "haven't seen it it's basically now it's all about identity server we have four and free free is still being maintained",
    "start": "408490",
    "end": "415360"
  },
  {
    "text": "right so we're not abandoning it completely we still do bug fixes if we",
    "start": "415360",
    "end": "420430"
  },
  {
    "text": "think there's there's a really important feature missing we're gonna back port that but obviously being just a two-man",
    "start": "420430",
    "end": "426550"
  },
  {
    "text": "team right and a couple of contributors we cannot do full feature work on both",
    "start": "426550",
    "end": "431979"
  },
  {
    "text": "versions so all of our investments are going into for right now now we think",
    "start": "431979",
    "end": "437949"
  },
  {
    "text": "four is the best token service we've ever written we added many nice features some some of",
    "start": "437949",
    "end": "444340"
  },
  {
    "text": "them I'll show you and yeah I would recommend everyone who now makes a",
    "start": "444340",
    "end": "450250"
  },
  {
    "text": "decision to do three or four just use for now we are we are happy with that so",
    "start": "450250",
    "end": "456879"
  },
  {
    "text": "in fact a very common scenario we have is that people have an existing identity",
    "start": "456879",
    "end": "462789"
  },
  {
    "text": "for free and then started writing applications using HP nerdcore and MVC core with free which is totally fine",
    "start": "462789",
    "end": "469779"
  },
  {
    "text": "right I mean it's just a protocol implementation and it doesn't matter which framework you're using but now",
    "start": "469779",
    "end": "477250"
  },
  {
    "text": "since four is done they wanna get rid of the katana stuff and move even identify",
    "start": "477250",
    "end": "482800"
  },
  {
    "text": "were to to HDNet core so that is kind of like the scenario I'm uncovering here so we have an we have two little we're we",
    "start": "482800",
    "end": "490150"
  },
  {
    "text": "have an API we have a client which simulates like a server to serve our style communication and we have an MVC",
    "start": "490150",
    "end": "496270"
  },
  {
    "text": "client and they are all working with without any server free so my plan is now to just my create that configuration",
    "start": "496270",
    "end": "503860"
  },
  {
    "text": "from three to four and just leave the applications unchanged right and just",
    "start": "503860",
    "end": "509020"
  },
  {
    "text": "prove that this is how it works okay so just just to see what we have",
    "start": "509020",
    "end": "515169"
  },
  {
    "text": "here yeah so we have an API host you know using MVC so let's run that and this",
    "start": "515169",
    "end": "525399"
  },
  {
    "text": "this API house is just echoing back the claims of the user we have a console client so what is the console klein",
    "start": "525399",
    "end": "531970"
  },
  {
    "text": "doing again the console client should simulate a server to server style communication so you know it",
    "start": "531970",
    "end": "538900"
  },
  {
    "text": "it goes to the discovery endpoint it finds out where the token endpoint is",
    "start": "538900",
    "end": "544029"
  },
  {
    "text": "and then it requests a token from the token endpoint and once this is done it will call an API okay pretty simple so",
    "start": "544029",
    "end": "554170"
  },
  {
    "text": "when I run that it doesn't it works right we have a token we call the API",
    "start": "554170",
    "end": "559900"
  },
  {
    "text": "the API just echoes back to claims all is good and here's our identity server",
    "start": "559900",
    "end": "566020"
  },
  {
    "text": "running in the background we have an MVC client yeah again pretty standard NBC",
    "start": "566020",
    "end": "576600"
  },
  {
    "text": "NBC core right we have the open that you connect middleware from Microsoft so you",
    "start": "576600",
    "end": "582400"
  },
  {
    "text": "know you point to you point to your foreign team you pass in a client ID and",
    "start": "582400",
    "end": "588640"
  },
  {
    "text": "the secret you select your scopes and so on and so forth yeah so when I run that and click the secure link it will",
    "start": "588640",
    "end": "596560"
  },
  {
    "text": "trigger the authentication handshake we end up on an identity here we support",
    "start": "596560",
    "end": "602589"
  },
  {
    "text": "both local logins and something you know external Google in that case but could be anything else",
    "start": "602589",
    "end": "609400"
  },
  {
    "text": "so I'm logging in I'm logged in to my website and I can call now an API on",
    "start": "609400",
    "end": "614950"
  },
  {
    "text": "behalf of the currently logged on user okay so that's the their scenario so",
    "start": "614950",
    "end": "621070"
  },
  {
    "text": "let's have a look at at how that how that looks like okay so in in",
    "start": "621070",
    "end": "628270"
  },
  {
    "text": "additive-free you use the katana hosting api's either in IAS or in or in self oh so basically",
    "start": "628270",
    "end": "635860"
  },
  {
    "text": "you configured the base address you call Bev app don't start past in your startup",
    "start": "635860",
    "end": "643720"
  },
  {
    "text": "class and then this thing start running one little interesting detail here is a",
    "start": "643720",
    "end": "649450"
  },
  {
    "text": "katana didn't have build in logging right so there was no logging infrastructure in katana so as a library",
    "start": "649450",
    "end": "656740"
  },
  {
    "text": "developer you had a hard time what are you doing right I mean you don't want to",
    "start": "656740",
    "end": "661870"
  },
  {
    "text": "use I don't know log for net or n log or Siri log or whatever and then force everyone else that uses your library to",
    "start": "661870",
    "end": "668920"
  },
  {
    "text": "use the same locking library now so we using a library which is an abstraction",
    "start": "668920",
    "end": "676630"
  },
  {
    "text": "over-logging right because the world needs more abstractions and that that is called lip-lock from a guy called Damien",
    "start": "676630",
    "end": "683380"
  },
  {
    "text": "Hickey and he does some very tricky things like basically he gives you a",
    "start": "683380",
    "end": "688720"
  },
  {
    "text": "general purpose logging API and at runtime he pokes around in your app domain to find out which locking",
    "start": "688720",
    "end": "694510"
  },
  {
    "text": "framework is being used and then we'll figure out oh they using fury lock so",
    "start": "694510",
    "end": "700450"
  },
  {
    "text": "now let's just dynamically invoke theory lock locking on the fly right and if you",
    "start": "700450",
    "end": "705730"
  },
  {
    "text": "will use n lock key with n log and lock for night and so on the for ya many people were confused by this level",
    "start": "705730",
    "end": "712480"
  },
  {
    "text": "of magic like how do I configure login with identity server that you don't just",
    "start": "712480",
    "end": "718060"
  },
  {
    "text": "just do it yeah it'll work automatically ma'am and that was a really good",
    "start": "718060",
    "end": "724540"
  },
  {
    "text": "solution and it worked quite well so basically what that means is that we free you you configure locking at a",
    "start": "724540",
    "end": "731170"
  },
  {
    "text": "hosting level and then it was being picked up the startup class in katana",
    "start": "731170",
    "end": "737800"
  },
  {
    "text": "you know looks looks like this typically you have an configuration method with an",
    "start": "737800",
    "end": "744640"
  },
  {
    "text": "if' builder then then is the next thing we needed to do because because it",
    "start": "744640",
    "end": "751690"
  },
  {
    "text": "wasn't built into katana was dependency injection right so we needed a way to give you a configurable wear container",
    "start": "751690",
    "end": "761200"
  },
  {
    "text": "where you could put in your own services so you could modify the behavior of identity server so again not nothing was",
    "start": "761200",
    "end": "768340"
  },
  {
    "text": "built into katana so we pick the favorites the I container by the time",
    "start": "768340",
    "end": "774100"
  },
  {
    "text": "which was Autofac and then build our own abstraction around it which is called the identity server service factory",
    "start": "774100",
    "end": "779680"
  },
  {
    "text": "right and yet the purpose of that was that you could plug in your own custom implementation for example like where",
    "start": "779680",
    "end": "785590"
  },
  {
    "text": "are your clients toward where are your scope stored and where are your users stored right and then this would",
    "start": "785590",
    "end": "793750"
  },
  {
    "text": "internally be turned into an auto set container and that would hang off the",
    "start": "793750",
    "end": "800770"
  },
  {
    "text": "katana pipeline and then the other thing that was",
    "start": "800770",
    "end": "805930"
  },
  {
    "text": "the prevalent style in katana is that now you had the middle way and the middle way I had like an options object",
    "start": "805930",
    "end": "813670"
  },
  {
    "text": "yeah and or the options object configured every aspect of of that middleware ma'am so you know here's your",
    "start": "813670",
    "end": "821980"
  },
  {
    "text": "site name your signing certificate then you pass in the factory which is the DI container and then whatever other",
    "start": "821980",
    "end": "828209"
  },
  {
    "text": "configuration things you have to do okay so that that was the style in katana and",
    "start": "828209",
    "end": "833290"
  },
  {
    "text": "now let's see how that style has changed for a spinet core so in a spinet core",
    "start": "833290",
    "end": "840089"
  },
  {
    "text": "let's start by adding the new get package identity server for you know we",
    "start": "840089",
    "end": "847000"
  },
  {
    "text": "have this nice project JSON file which will be gone in two weeks so it's enjoy",
    "start": "847000",
    "end": "854500"
  },
  {
    "text": "it while it's there because other because then you're going to continue starting to think in terms of icon",
    "start": "854500",
    "end": "861130"
  },
  {
    "text": "groups and property groups in XML files okay so once we have that you see now of",
    "start": "861130",
    "end": "870670"
  },
  {
    "text": "all first of all the locking yeah we are still using Siri lock as our preferred Locker but this time it's different in",
    "start": "870670",
    "end": "878560"
  },
  {
    "text": "in a single chord S is that the startup class has dependency injection even into starter plus itself so when they when",
    "start": "878560",
    "end": "885760"
  },
  {
    "text": "they knew of the startup class which is actually done by this piece of code here the web host builder which you pass in",
    "start": "885760",
    "end": "891790"
  },
  {
    "text": "the type that implements your your startup code they call the constructor and I think you already get like 14",
    "start": "891790",
    "end": "898810"
  },
  {
    "text": "dependencies like did the local factory the hosting environment so you can know if you are in def or you know staging or",
    "start": "898810",
    "end": "906850"
  },
  {
    "text": "whatever and a typical pattern is actually not the parent edit that is use for Microsoft but my preferred pattern",
    "start": "906850",
    "end": "912520"
  },
  {
    "text": "is that you set up all the logging in the constructor yeah and then it's it's available from very very early okay same",
    "start": "912520",
    "end": "920320"
  },
  {
    "text": "idea we're new up Siri log but this time we just say on the logger factory edge theory log and then we are using the",
    "start": "920320",
    "end": "927040"
  },
  {
    "text": "built-in locking facilities of a screen core so what else do we need to do to",
    "start": "927040",
    "end": "935589"
  },
  {
    "text": "enable the first scenario is we need to add the identity server we're okay you see that there there are",
    "start": "935589",
    "end": "944150"
  },
  {
    "text": "no options anymore because that is not how it typically works anymore in HP net core the idea is that if you want to",
    "start": "944150",
    "end": "950060"
  },
  {
    "text": "configure middleware you're typically using the DI container to provide the right services for that middleware so we",
    "start": "950060",
    "end": "956630"
  },
  {
    "text": "have a thing called a poop services dot",
    "start": "956630",
    "end": "961700"
  },
  {
    "text": "add identity server which now puts up all of our dependencies into the I okay",
    "start": "961700",
    "end": "969140"
  },
  {
    "text": "now we need need to do a little bit more here so that the very first thing we probably should do is we should",
    "start": "969140",
    "end": "974720"
  },
  {
    "text": "configure key material to sign the tokens that gets produced by identify",
    "start": "974720",
    "end": "980510"
  },
  {
    "text": "and again this is all done by wiring up a service into the AI that has the key material right so we have this new thing",
    "start": "980510",
    "end": "988280"
  },
  {
    "text": "called add signing credential and you can see now we can use raw as a keys",
    "start": "988280",
    "end": "993500"
  },
  {
    "text": "here we can you can pass in any signing credential type from from the from the identity model library you can pass in",
    "start": "993500",
    "end": "1000310"
  },
  {
    "text": "an x.509 certificate or you can pass in just the name of the search that lives",
    "start": "1000310",
    "end": "1005950"
  },
  {
    "text": "in your certificate store okay another thing that we added because of feedback",
    "start": "1005950",
    "end": "1012430"
  },
  {
    "text": "is you know people said like yeah in my company I am not allowed to create my",
    "start": "1012430",
    "end": "1019090"
  },
  {
    "text": "own x.509 certificate so I have to wait for the admin to to give me one blah blah blah and he's very slow or he said",
    "start": "1019090",
    "end": "1026230"
  },
  {
    "text": "you know busy with other really important things like reading ad groups or something yeah so we have this new",
    "start": "1026230",
    "end": "1032439"
  },
  {
    "text": "thing called at temporary signing credential and what this does is at startup time we just create a random RSA",
    "start": "1032440",
    "end": "1039130"
  },
  {
    "text": "key pair so you have something to work with right and you know and then when you",
    "start": "1039130",
    "end": "1046150"
  },
  {
    "text": "have the real key material from whoever approves that you can just switch back to the normal at signing credential yeah",
    "start": "1046150",
    "end": "1052420"
  },
  {
    "text": "I don't use that in production you won't have fun with that yeah yeah okay so now",
    "start": "1052420",
    "end": "1063580"
  },
  {
    "text": "let's have a look at a configuration that we had in in an identity of free so",
    "start": "1063580",
    "end": "1068770"
  },
  {
    "text": "let's go back to our config file here so one thing we we needed to define in in identify three where",
    "start": "1068770",
    "end": "1076390"
  },
  {
    "text": "so-called scopes okay so scopes are the other resources in your system that that clients want to",
    "start": "1076390",
    "end": "1084309"
  },
  {
    "text": "access right so whenever I explained the term scope to someone I said you know a scope is like a resource yeah recent",
    "start": "1084309",
    "end": "1092289"
  },
  {
    "text": "there are two types of scopes yeah one are more like the identity related scopes like first name last name and",
    "start": "1092289",
    "end": "1098080"
  },
  {
    "text": "there are the API scopes yeah like API is you want to call and most people typically understood what a",
    "start": "1098080",
    "end": "1106179"
  },
  {
    "text": "client is and what the user is what scopes they struggled with yeah and the more and more I started explaining that",
    "start": "1106179",
    "end": "1112630"
  },
  {
    "text": "I realized I always say a scope is like a resource so we fought you know what",
    "start": "1112630",
    "end": "1117639"
  },
  {
    "text": "let's just rename that class to resource an identical for now and you don't have to you you know explain it anymore so",
    "start": "1117639",
    "end": "1125100"
  },
  {
    "text": "you see we had two types of scopes one was called an identity scope one was called an API is a resource scope and",
    "start": "1125100",
    "end": "1131889"
  },
  {
    "text": "one of them model and API one modeled more like identity data so what we now have in in for our two classes identity",
    "start": "1131889",
    "end": "1138880"
  },
  {
    "text": "resource and API resource just to make it really clear what you are modeling here now so let's do this let's add a",
    "start": "1138880",
    "end": "1149529"
  },
  {
    "text": "class called config and do a public",
    "start": "1149529",
    "end": "1158309"
  },
  {
    "text": "static a new mirabile api resource get",
    "start": "1159419",
    "end": "1167950"
  },
  {
    "text": "api's",
    "start": "1167950",
    "end": "1170730"
  },
  {
    "text": "okay new API resource and you know in the in the easiest sense yeah you say",
    "start": "1174240",
    "end": "1180280"
  },
  {
    "text": "like okay I have an API it's called I don't know whatever yeah API one yeah or",
    "start": "1180280",
    "end": "1185410"
  },
  {
    "text": "my calendar API yeah that's all you need to do sorry not this one but this one",
    "start": "1185410",
    "end": "1190540"
  },
  {
    "text": "yeah to just register an API with a dentist's over and now we can reason",
    "start": "1190540",
    "end": "1195940"
  },
  {
    "text": "about this API and you can assign clients to this API who is allowed to talk to the API and so on but there are",
    "start": "1195940",
    "end": "1201910"
  },
  {
    "text": "more options here if this API will ever be used on a Content screen you can give",
    "start": "1201910",
    "end": "1208360"
  },
  {
    "text": "it a display name you know my cool API number one and just most of the free",
    "start": "1208360",
    "end": "1217750"
  },
  {
    "text": "most common things if you want to define that whenever a client asks for an API",
    "start": "1217750",
    "end": "1222970"
  },
  {
    "text": "number one the token should contain these claims about the user you can just",
    "start": "1222970",
    "end": "1229030"
  },
  {
    "text": "put the claim types you know maybe maybe you need like I don't know the the",
    "start": "1229030",
    "end": "1234250"
  },
  {
    "text": "location of the user yeah I mean actually we could do that so that is an",
    "start": "1234250",
    "end": "1241630"
  },
  {
    "text": "you know an important thing for your API and that's that's how you can model that",
    "start": "1241630",
    "end": "1246810"
  },
  {
    "text": "okay there are more options oh yeah and",
    "start": "1246810",
    "end": "1253000"
  },
  {
    "text": "what what is that under the covers and that it basically creates an API with",
    "start": "1253000",
    "end": "1259150"
  },
  {
    "text": "exactly one scope and the name of the API and the scope are the same okay if you have more more more complex things",
    "start": "1259150",
    "end": "1265600"
  },
  {
    "text": "like you want to create an API but you want to subdivide that into multiple scopes like maybe a read scope and the",
    "start": "1265600",
    "end": "1271120"
  },
  {
    "text": "right scope or read-only or something like that you know you could do something like start with this you know",
    "start": "1271120",
    "end": "1280060"
  },
  {
    "text": "give this a name API note that's the complex API yeah",
    "start": "1280060",
    "end": "1286590"
  },
  {
    "text": "it has a display name you know complex API it has user claims right so you could",
    "start": "1286590",
    "end": "1294550"
  },
  {
    "text": "set like whenever you ask for this API put these claims into the token but not what you can also do is you can have a",
    "start": "1294550",
    "end": "1301240"
  },
  {
    "text": "list of scopes here like this and then say new scope you",
    "start": "1301240",
    "end": "1308129"
  },
  {
    "text": "know complex complex API read or full",
    "start": "1308129",
    "end": "1316080"
  },
  {
    "text": "full access for example yeah and then",
    "start": "1316080",
    "end": "1322950"
  },
  {
    "text": "could have user claims here so what what that means is let's say you're just",
    "start": "1322950",
    "end": "1327990"
  },
  {
    "text": "calling you you can't call the complex API you will get a standard claim if you're calling the full access Cove you",
    "start": "1327990",
    "end": "1333659"
  },
  {
    "text": "get in addition the claims that you define per scope yeah so you can model",
    "start": "1333659",
    "end": "1338909"
  },
  {
    "text": "pretty complex things here now so we think that that's that's an improvement over the old approach where everything",
    "start": "1338909",
    "end": "1345179"
  },
  {
    "text": "was just a scope and we you know by by being limited to object orientation we",
    "start": "1345179",
    "end": "1351840"
  },
  {
    "text": "had to share the properties between the scope types that you know didn't really belong to each other okay so that's how",
    "start": "1351840",
    "end": "1359460"
  },
  {
    "text": "you model a TI's now the next thing we're going to model our clients so actually clients haven't changed that",
    "start": "1359460",
    "end": "1365399"
  },
  {
    "text": "much but let's just go to here and just",
    "start": "1365399",
    "end": "1373320"
  },
  {
    "text": "copy that over",
    "start": "1373320",
    "end": "1375980"
  },
  {
    "text": "like this so client is still a client it has a client ID it has a client display",
    "start": "1389130",
    "end": "1395640"
  },
  {
    "text": "name right it still has a client secret we we change that internally a little bit to",
    "start": "1395640",
    "end": "1402150"
  },
  {
    "text": "make that nicer so you can now use this",
    "start": "1402150",
    "end": "1408830"
  },
  {
    "text": "oops this style of setting up that in memory",
    "start": "1409700",
    "end": "1416840"
  },
  {
    "text": "same here API one I'll probably call it",
    "start": "1416960",
    "end": "1426870"
  },
  {
    "text": "API line to be compatible with the client so the what what have you changed",
    "start": "1426870",
    "end": "1433799"
  },
  {
    "text": "here as you can see the flow doesn't exist anymore yeah so flow flow is a",
    "start": "1433799",
    "end": "1440070"
  },
  {
    "text": "term from the spec and it describes how a client talks to a token service to get",
    "start": "1440070",
    "end": "1445770"
  },
  {
    "text": "tokens and they were like you know that ever there's a client credential flow which is for for server to server style",
    "start": "1445770",
    "end": "1451200"
  },
  {
    "text": "but that of the hybrid flow and the implicit flow and and so on and when we implemented a madessa were",
    "start": "1451200",
    "end": "1458760"
  },
  {
    "text": "in the first place we we we were aware that certain flows are incompatible okay",
    "start": "1458760",
    "end": "1466650"
  },
  {
    "text": "so for example if you would configure recline to use both implicit flow and authorization code flow and",
    "start": "1466650",
    "end": "1473159"
  },
  {
    "text": "authorization code flow is the more secure one because it demands a back-channel command authenticated",
    "start": "1473159",
    "end": "1478650"
  },
  {
    "text": "back-channel communication then a malicious user could just down create",
    "start": "1478650",
    "end": "1483659"
  },
  {
    "text": "from code flow down to implicit flow just by changing a parameter in the protocol right so that wouldn't make",
    "start": "1483659",
    "end": "1490380"
  },
  {
    "text": "sense to allow both flows for the same client because you are not getting what",
    "start": "1490380",
    "end": "1495390"
  },
  {
    "text": "you're expecting you're getting okay so we've before you know played safe and only allow one flow per client now but",
    "start": "1495390",
    "end": "1503039"
  },
  {
    "text": "then this and then we learned by you know just just by by by using that in",
    "start": "1503039",
    "end": "1508260"
  },
  {
    "text": "practice that there are indeed certain situations where multiple flows are useful may I like for example let's say",
    "start": "1508260",
    "end": "1515100"
  },
  {
    "text": "you want to do interactive using implicit flow but have a back channel",
    "start": "1515100",
    "end": "1520290"
  },
  {
    "text": "server the server style with client good answer this kind of forced you to write to",
    "start": "1520290",
    "end": "1525360"
  },
  {
    "text": "register to clients in the past yeah  you know wasn't that nice so in",
    "start": "1525360",
    "end": "1530400"
  },
  {
    "text": "the new style we went back to the original term in the spec called the",
    "start": "1530400",
    "end": "1536160"
  },
  {
    "text": "current type you see it's plural now so we saw this with report multiple grant types we have a grant types class which",
    "start": "1536160",
    "end": "1542910"
  },
  {
    "text": "models the most common combinations right like code and clang credential or",
    "start": "1542910",
    "end": "1550230"
  },
  {
    "text": "hybrid and clang credentials and if you want to be completely free form you can use the list one and just pass in the",
    "start": "1550230",
    "end": "1556470"
  },
  {
    "text": "current types yourself but we're still doing validation at at creation time so",
    "start": "1556470",
    "end": "1563100"
  },
  {
    "text": "to make sure that you are not using the vulnerable combinations okay so let's do",
    "start": "1563100",
    "end": "1569700"
  },
  {
    "text": "client good initial fill tool I think that's it yeah so maybe we have a client",
    "start": "1569700",
    "end": "1575820"
  },
  {
    "text": "that that is allowed to talk to API ma'am it has a secret and we have set up",
    "start": "1575820",
    "end": "1582990"
  },
  {
    "text": "the API resource okay so now how do we",
    "start": "1582990",
    "end": "1588750"
  },
  {
    "text": "wire that up basically again by putting them into the DI container we still have",
    "start": "1588750",
    "end": "1595140"
  },
  {
    "text": "multiple versions of that we have an in-memory ad in memory API resources",
    "start": "1595140",
    "end": "1601140"
  },
  {
    "text": "where you just used you know the class you've just written you could use a entity framework based thing or you",
    "start": "1601140",
    "end": "1607080"
  },
  {
    "text": "could write up your own eye resource store that loads that stuff from arbitrary locations so we do add in",
    "start": "1607080",
    "end": "1615330"
  },
  {
    "text": "memory clients as well same thing you know we have we have so many different",
    "start": "1615330",
    "end": "1621799"
  },
  {
    "text": "customers that you know like to do it differently so we have a couple of people that that preferred the CI style",
    "start": "1621799",
    "end": "1629610"
  },
  {
    "text": "where when they change something someone does a pull request internally someone review reviews it it merges it and then",
    "start": "1629610",
    "end": "1635340"
  },
  {
    "text": "it gets redeployed other people like to you know use databases so that's up to",
    "start": "1635340",
    "end": "1640559"
  },
  {
    "text": "you you just wire up the right services here okay so that looks like it could",
    "start": "1640559",
    "end": "1646470"
  },
  {
    "text": "work let's have a look",
    "start": "1646470",
    "end": "1650000"
  },
  {
    "text": "okay so here's our our host you know using console logging to see what's",
    "start": "1653000",
    "end": "1658830"
  },
  {
    "text": "going on and the first the first end point you want to check is the well",
    "start": "1658830",
    "end": "1664050"
  },
  {
    "text": "known and point right that's the that's the configuration of the token service",
    "start": "1664050",
    "end": "1669600"
  },
  {
    "text": "it's the meta data if you like and that is all being handled by the identities of a middleware right so we are handling",
    "start": "1669600",
    "end": "1675780"
  },
  {
    "text": "the protocol end point and now you can see we have a we have a token service that is named like this here are the",
    "start": "1675780",
    "end": "1682440"
  },
  {
    "text": "URLs of all the the protocol endpoints here are the two scopes we support API",
    "start": "1682440",
    "end": "1687630"
  },
  {
    "text": "and offline access here's the one claim we supported that is all sourced by the",
    "start": "1687630",
    "end": "1693060"
  },
  {
    "text": "definitions you made with your resources okay and the most important thing here",
    "start": "1693060",
    "end": "1698520"
  },
  {
    "text": "is that's where you can get to the public key that can be used by clients or by api's to validate the tokens that",
    "start": "1698520",
    "end": "1705930"
  },
  {
    "text": "we emit right that's the public key that belongs to the private key that I configured in mine in my startup cool so",
    "start": "1705930",
    "end": "1715920"
  },
  {
    "text": "let's see the API should probably be restarted let's let's kill the API host",
    "start": "1715920",
    "end": "1726680"
  },
  {
    "text": "so it has a chance to refresh its configuration No ok yes our API so",
    "start": "1726680",
    "end": "1738810"
  },
  {
    "text": "here's our console client let's run that and here we are ok so yeah in other",
    "start": "1738810",
    "end": "1746280"
  },
  {
    "text": "words you don't have to change anything in your client applications because on the wire it's the same protocol we",
    "start": "1746280",
    "end": "1753090"
  },
  {
    "text": "actually have a have a test project in our repo that has all that all the different combinations of you know",
    "start": "1753090",
    "end": "1758640"
  },
  {
    "text": "running identical free and for having api's on katana having API on HDNet core and just calling them in all",
    "start": "1758640",
    "end": "1765270"
  },
  {
    "text": "permutations just to make sure that you know they they are crossed version compatible so to speak em so that's",
    "start": "1765270",
    "end": "1772560"
  },
  {
    "text": "working fine a couple of things about the client where is it",
    "start": "1772560",
    "end": "1782120"
  },
  {
    "text": "here so we got feedback from a couple of",
    "start": "1782390",
    "end": "1787409"
  },
  {
    "text": "people so again in in version 3 we we demanded that every client has a secret",
    "start": "1787409",
    "end": "1794480"
  },
  {
    "text": "right so you know as a security guy it didn't make sense to me to start with",
    "start": "1794480",
    "end": "1800520"
  },
  {
    "text": "that why shouldn't we have a secret for a client if that is supported by the",
    "start": "1800520",
    "end": "1806250"
  },
  {
    "text": "spec right but again after doing lots of work with different customers it turns out there are situations where secrets",
    "start": "1806250",
    "end": "1812760"
  },
  {
    "text": "don't make any sense for example for publicly deployed clients right so",
    "start": "1812760",
    "end": "1818039"
  },
  {
    "text": "something that you deploy from the App Store to an iPhone why would you need a secret there yeah and I always said like",
    "start": "1818039",
    "end": "1824070"
  },
  {
    "text": "yeah you know what then don't treat it as a secret College secret right but there were internal you know penetration",
    "start": "1824070",
    "end": "1830850"
  },
  {
    "text": "tests and stuff and they said like yeah you are using a secret here you shouldn't use a secret even if even even if it's not secret",
    "start": "1830850",
    "end": "1836750"
  },
  {
    "text": "so we forced people kind of to introduce secrets even if they didn't you know didn't need it too so yeah that's gone",
    "start": "1836750",
    "end": "1844049"
  },
  {
    "text": "ok so we removed that so in in our in our config here if you want to and if",
    "start": "1844049",
    "end": "1850440"
  },
  {
    "text": "it's a so-called public client you know you can say require a client secret false and then the secret is gone ok",
    "start": "1850440",
    "end": "1858980"
  },
  {
    "text": "another thing we got feedback on is especially for server to server style",
    "start": "1858980",
    "end": "1864179"
  },
  {
    "text": "communication is when you are requesting the token we demanded in version free to",
    "start": "1864179",
    "end": "1871590"
  },
  {
    "text": "pass in the api's you want to talk to you at the scopes yeah API one API two API free whatever ma'am now when you",
    "start": "1871590",
    "end": "1879450"
  },
  {
    "text": "have many scopes and many clients and so on and especially for package you know like",
    "start": "1879450",
    "end": "1884610"
  },
  {
    "text": "data center style communication they said like why do we need to pass in those API is explicitly I can't you just",
    "start": "1884610",
    "end": "1890460"
  },
  {
    "text": "give me a token for all the api's the client has access to otherwise every time we are adding an API we need to",
    "start": "1890460",
    "end": "1897000"
  },
  {
    "text": "change the client code when you change configuration blah blah blah so in other word if I remove that now then you will",
    "start": "1897000",
    "end": "1903240"
  },
  {
    "text": "get whatever is configured in the allowed scopes list okay again something",
    "start": "1903240",
    "end": "1910409"
  },
  {
    "text": "to make it a little bit easier especially for bigger bigger",
    "start": "1910409",
    "end": "1916039"
  },
  {
    "text": "environments so good let's go to the MBC",
    "start": "1916200",
    "end": "1923970"
  },
  {
    "text": "style client where is that is the",
    "start": "1923970",
    "end": "1931620"
  },
  {
    "text": "configuration so here's our MBC climb so let's just copy this guy as well copy",
    "start": "1931620",
    "end": "1942929"
  },
  {
    "text": "that over here so you see it's almost",
    "start": "1942929",
    "end": "1949909"
  },
  {
    "text": "almost the same right again flow became",
    "start": "1949909",
    "end": "1956700"
  },
  {
    "text": "allowed crammed types and there's a grant types but hybrid hybrid flow means",
    "start": "1956700",
    "end": "1966419"
  },
  {
    "text": "the the first leg is done wire the browser to get the identity token in the code and then the client does a",
    "start": "1966419",
    "end": "1972629"
  },
  {
    "text": "back-channel communication to exchange the code with the actual access token so that's the hybrid flow that that's the",
    "start": "1972629",
    "end": "1978149"
  },
  {
    "text": "recommended flow for browser-based clients if the application is server-side we introduced something",
    "start": "1978149",
    "end": "1986129"
  },
  {
    "text": "called so what we've seen is that many people didn't use the hybrid flow in in",
    "start": "1986129",
    "end": "1991919"
  },
  {
    "text": "the past because they either you know I mean that's like a later chapter in the",
    "start": "1991919",
    "end": "1997740"
  },
  {
    "text": "spec and maybe they didn't read the spec until that point but the hybrid flow is",
    "start": "1997740",
    "end": "2003919"
  },
  {
    "text": "the most secure one for web applications because as I said you are not exchanging the actual access token Y at the browser",
    "start": "2003919",
    "end": "2010460"
  },
  {
    "text": "right I mean what's the point of you you need to X talk on the server to talk to an API which is also on the server but",
    "start": "2010460",
    "end": "2017419"
  },
  {
    "text": "you are transporting your access token once across the world you know back in down to the Hecht Wi-Fi in Starbucks",
    "start": "2017419",
    "end": "2023570"
  },
  {
    "text": "yeah and up again to to your server so we introduced this thing called allow",
    "start": "2023570",
    "end": "2029029"
  },
  {
    "text": "access tokens by a browser may also jump to and that defaulted to fault",
    "start": "2029029",
    "end": "2034580"
  },
  {
    "text": "unfortunately because it would have been a breaking change in in free now this defaults to sorry this is this",
    "start": "2034580",
    "end": "2042019"
  },
  {
    "text": "default to true before and now it is false - false so in other words if you are trying to",
    "start": "2042019",
    "end": "2048849"
  },
  {
    "text": "- implicit flow here and you want to transport the access token by the browser you will get an exception by",
    "start": "2048849",
    "end": "2055089"
  },
  {
    "text": "default saying hey you are trying to send an access token by the browser but you haven't opted into that feature",
    "start": "2055089",
    "end": "2060730"
  },
  {
    "text": "because you know it's dangerous a little bit at least yeah so that that is gone",
    "start": "2060730",
    "end": "2067539"
  },
  {
    "text": "now because that's our default value so here are our redirect you arise we have",
    "start": "2067539",
    "end": "2073780"
  },
  {
    "text": "we still have a client secret here already allowed scopes so that's all fine so what we now need is disguise",
    "start": "2073780",
    "end": "2084128"
  },
  {
    "text": "open ID and profile they are now in our new configuration system they are identity resources here and not API",
    "start": "2084129",
    "end": "2090780"
  },
  {
    "text": "resources so let's create a method",
    "start": "2090780",
    "end": "2098849"
  },
  {
    "text": "called get identity resources yet identity resources return so open idea",
    "start": "2102089",
    "end": "2116470"
  },
  {
    "text": "is a standard scope from from the open ID spec so we can just do new identity",
    "start": "2116470",
    "end": "2121779"
  },
  {
    "text": "oh that should be attentive resolve new",
    "start": "2121779",
    "end": "2127089"
  },
  {
    "text": "identity resource s dot open ID and the",
    "start": "2127089",
    "end": "2137109"
  },
  {
    "text": "profile is a custom one plus to a new identity resource give it a name profile",
    "start": "2137109",
    "end": "2144250"
  },
  {
    "text": "so whenever somebody asks for profile we can return I don't know whatever we want",
    "start": "2144250",
    "end": "2151329"
  },
  {
    "text": "give the display name profile data and we can return let's say a given name and",
    "start": "2151329",
    "end": "2163589"
  },
  {
    "text": "a family name the name and location",
    "start": "2164279",
    "end": "2173650"
  },
  {
    "text": "again okay so that's how you define your own identity of resources",
    "start": "2173650",
    "end": "2181720"
  },
  {
    "text": "and then we just wire them up in our startup class so we say add in memory I",
    "start": "2181720",
    "end": "2191550"
  },
  {
    "text": "add in memory identity resources",
    "start": "2191550",
    "end": "2198099"
  },
  {
    "text": "conflicts get identity resources ok so as I said logically the scopes haven't",
    "start": "2198099",
    "end": "2206829"
  },
  {
    "text": "changed but we try to split it up into two distinct things identity and api's",
    "start": "2206829",
    "end": "2211930"
  },
  {
    "text": "and that is the main reason as I said was because that's how you model right is when you're drawing your like like",
    "start": "2211930",
    "end": "2218500"
  },
  {
    "text": "when you're on the drawing board and draw your system you have the api's right and you have your your your",
    "start": "2218500",
    "end": "2224619"
  },
  {
    "text": "identity and these are two distinct things that's why we thought it makes more sense to separate them into two",
    "start": "2224619",
    "end": "2230589"
  },
  {
    "text": "distinct classes okay so now we have defined get identity resources we have",
    "start": "2230589",
    "end": "2238180"
  },
  {
    "text": "defined the MVC client now now we need two things use us obviously and a UI okay so the UI",
    "start": "2238180",
    "end": "2249730"
  },
  {
    "text": "is probably the biggest thing that has changed between three and four so we you know I said in the beginning the reason",
    "start": "2249730",
    "end": "2258490"
  },
  {
    "text": "why why we wrote our own few engine and fourth you guys to use it is because by",
    "start": "2258490",
    "end": "2265990"
  },
  {
    "text": "the time there was no M UI framework that was running outside of identify is",
    "start": "2265990",
    "end": "2271720"
  },
  {
    "text": "right dddd only thing was MVC really at least full-featured our design goal was",
    "start": "2271720",
    "end": "2279250"
  },
  {
    "text": "to not be tied to I is because we have many customers that just want to run that in an NT service right so yeah so",
    "start": "2279250",
    "end": "2286000"
  },
  {
    "text": "that was what we had to do ma'am and we weren't happy with that now in a spinet core right we have MVC proper which runs",
    "start": "2286000",
    "end": "2293400"
  },
  {
    "text": "out of the vias if you want to about know it always runs outside of I is there or there are other alternatives",
    "start": "2293400",
    "end": "2301780"
  },
  {
    "text": "soon I'm pretty sure ma'am so okay so let's why the UI arm so we're going to",
    "start": "2301780",
    "end": "2310780"
  },
  {
    "text": "use MVC for that so let's add MBC Microsoft Microsoft dot",
    "start": "2310780",
    "end": "2318599"
  },
  {
    "text": "asp net core dot MVC 1.1.1 and we need",
    "start": "2318599",
    "end": "2327929"
  },
  {
    "text": "static files one point 1.0 so now you",
    "start": "2327929",
    "end": "2337319"
  },
  {
    "text": "have a couple of options how to get your UI in here now one very common scenario is here that you started with an",
    "start": "2337319",
    "end": "2344219"
  },
  {
    "text": "application that had all the login stuff built in and you now want to write the second application and you want to share",
    "start": "2344219",
    "end": "2350099"
  },
  {
    "text": "the login pages between the two by putting them into identity server so you just copy your existing login page out",
    "start": "2350099",
    "end": "2356039"
  },
  {
    "text": "and put it into a dentist server that's one way to start the idea the other one is to start from scratch obviously the",
    "start": "2356039",
    "end": "2362369"
  },
  {
    "text": "third one is you can even just use one of the default MVC template so if you want to get started with MVC login pages",
    "start": "2362369",
    "end": "2370589"
  },
  {
    "text": "using asp.net identity you free then just use that template in Visual Studio and you can add us to that template and",
    "start": "2370589",
    "end": "2379049"
  },
  {
    "text": "it works as well or we have a think of a like a starter kit for you yeah",
    "start": "2379049",
    "end": "2386219"
  },
  {
    "text": "so they used to be a thing called new get content packages where you just basically pulled in and you get and it",
    "start": "2386219",
    "end": "2392249"
  },
  {
    "text": "spit out static files into your project that that's gone that feature in you get",
    "start": "2392249",
    "end": "2397650"
  },
  {
    "text": "or not not back again already I don't know it's gone right now so what we did",
    "start": "2397650",
    "end": "2406140"
  },
  {
    "text": "is we have this repo called identical for QuickStart UI and what this contains",
    "start": "2406140",
    "end": "2411809"
  },
  {
    "text": "is just the UI part that you need for for for an identical right it's a login",
    "start": "2411809",
    "end": "2417989"
  },
  {
    "text": "page it's a logout page it's a Content page done ok so what you can do is you",
    "start": "2417989",
    "end": "2424259"
  },
  {
    "text": "can just go here download download that and put it into your into your project",
    "start": "2424259",
    "end": "2434269"
  },
  {
    "text": "so with this little script here hello",
    "start": "2434269",
    "end": "2441540"
  },
  {
    "text": "we can just copy that down so let's do this demo is Delta demo before so 3",
    "start": "2441540",
    "end": "2457590"
  },
  {
    "text": "sauce identity server for host right",
    "start": "2457590",
    "end": "2466290"
  },
  {
    "text": "so we can copy that in here and this pulls down the the content of the github",
    "start": "2466290",
    "end": "2471540"
  },
  {
    "text": "repo and copies it into your into your directory okay so what do we get when we",
    "start": "2471540",
    "end": "2480720"
  },
  {
    "text": "do that well we get an account controller now which has a login page",
    "start": "2480720",
    "end": "2491270"
  },
  {
    "text": "here's your login page we have a couple of services that our UI related so the",
    "start": "2491360",
    "end": "2498210"
  },
  {
    "text": "most important one is the identity server interaction service so when you're writing your own UI you probably",
    "start": "2498210",
    "end": "2503400"
  },
  {
    "text": "still want to know what's going on right now in what are the details of the current authentication requests like who's the client you know which",
    "start": "2503400",
    "end": "2509910"
  },
  {
    "text": "parameters did you send in for that that's all you get from from this new service here and basically how our logic",
    "start": "2509910",
    "end": "2516750"
  },
  {
    "text": "works is the client goes to the authorized endpoint which is handled by the middleware where and when the user",
    "start": "2516750",
    "end": "2522330"
  },
  {
    "text": "is not authenticated we just redirect - by default - slash account slash login",
    "start": "2522330",
    "end": "2528150"
  },
  {
    "text": "that's that's configurable but that's the default value and that's where you trade in MVC worlds you typically have",
    "start": "2528150",
    "end": "2534030"
  },
  {
    "text": "your login page right and then it arrives here and we give you a return URL yeah just like you would with cookie",
    "start": "2534030",
    "end": "2541380"
  },
  {
    "text": "authentication always you know in the old days with form space of indication and this return URL points back to the",
    "start": "2541380",
    "end": "2547560"
  },
  {
    "text": "authorized endpoint so we can continue with the flow and now you are in full control of you know you can do whatever",
    "start": "2547560",
    "end": "2554370"
  },
  {
    "text": "you want right you can start an arbitrary complex login workflow maybe register the user you know do your",
    "start": "2554370",
    "end": "2560730"
  },
  {
    "text": "two-factor or whatever when you are done with whatever you need to do to make the",
    "start": "2560730",
    "end": "2566310"
  },
  {
    "text": "login happen yeah you sign in the user",
    "start": "2566310",
    "end": "2572160"
  },
  {
    "text": "just using the normal age peanut Quorra authentication manager API you",
    "start": "2572160",
    "end": "2577349"
  },
  {
    "text": "make sure that return URL hasn't been tampered with here and then you return",
    "start": "2577349",
    "end": "2582869"
  },
  {
    "text": "and then you redirect back to us and we continue with the protocol stuff okay so",
    "start": "2582869",
    "end": "2589290"
  },
  {
    "text": "we think that is the best way of doing that yeah we handle the protocol stuff",
    "start": "2589290",
    "end": "2594720"
  },
  {
    "text": "you handle the UI and you go back to us when you're done make sense because to",
    "start": "2594720",
    "end": "2603089"
  },
  {
    "text": "be fair the UI is always the thing you will you will always change right I mean",
    "start": "2603089",
    "end": "2608420"
  },
  {
    "text": "you typically don't want to use our login pages there okay",
    "start": "2608420",
    "end": "2613470"
  },
  {
    "text": "so that'sthat's this thing the next",
    "start": "2613470",
    "end": "2621390"
  },
  {
    "text": "thing is where do we get users from and we had a class we had a class in",
    "start": "2621390",
    "end": "2627089"
  },
  {
    "text": "identifiy called in memory user yeah and in memory user store and we",
    "start": "2627089",
    "end": "2632520"
  },
  {
    "text": "thought it's pretty clear that this is only useful for development scenarios now but then you start getting issues on",
    "start": "2632520",
    "end": "2640740"
  },
  {
    "text": "github saying huh how do I load my sequel server users into your in memory user store and for like mm maybe maybe",
    "start": "2640740",
    "end": "2650660"
  },
  {
    "text": "that's not the best way of doing it so we saw so we removed the in memory users altogether but then we realized for for",
    "start": "2650660",
    "end": "2657720"
  },
  {
    "text": "for doing demos like this it's handy to have something like that yeah then we put it into a different assembly",
    "start": "2657720",
    "end": "2663660"
  },
  {
    "text": "then we put it into the QuickStart UI and finally we brought it back and now",
    "start": "2663660",
    "end": "2669240"
  },
  {
    "text": "renamed it to test user I hope that's clear now yeah it's it's not for",
    "start": "2669240",
    "end": "2675359"
  },
  {
    "text": "production okay so what what the test user gives you basically is a way you",
    "start": "2675359",
    "end": "2681119"
  },
  {
    "text": "know to just have a couple of users in your system you can give them arbitrary claims here you can give you a password",
    "start": "2681119",
    "end": "2686390"
  },
  {
    "text": "so you can you know play around with the token service ma'am okay so how do we",
    "start": "2686390",
    "end": "2694500"
  },
  {
    "text": "wire up that um you say add in hold on",
    "start": "2694500",
    "end": "2704099"
  },
  {
    "text": "add test users that's what it's called yeah and that class is called test users dot",
    "start": "2704099",
    "end": "2711999"
  },
  {
    "text": "users okay and again which is putting them into the eye so the the login the login page can now",
    "start": "2711999",
    "end": "2717880"
  },
  {
    "text": "use it cool let's one at again and let's see if our",
    "start": "2717880",
    "end": "2723430"
  },
  {
    "text": "MVC client is now working as expected",
    "start": "2723430",
    "end": "2727469"
  },
  {
    "text": "okay so we go to secure ooh oh I know",
    "start": "2732299",
    "end": "2739059"
  },
  {
    "text": "what so here we obviously have to add",
    "start": "2739059",
    "end": "2744519"
  },
  {
    "text": "first of all at MVC now because they're using MVC right so we do services but",
    "start": "2744519",
    "end": "2750999"
  },
  {
    "text": "add MVC and here we do apt or do static",
    "start": "2750999",
    "end": "2757569"
  },
  {
    "text": "files and apt or use MVC with default",
    "start": "2757569",
    "end": "2764229"
  },
  {
    "text": "route okay",
    "start": "2764229",
    "end": "2770339"
  },
  {
    "text": "good and I want NDC client secure okay",
    "start": "2779190",
    "end": "2786210"
  },
  {
    "text": "yes blocking page so we have Bob and Bob content page and we are back okay so now",
    "start": "2786210",
    "end": "2798900"
  },
  {
    "text": "I'm not sure if my API is still running we'll see ya when that works as well now",
    "start": "2798900",
    "end": "2804420"
  },
  {
    "text": "so the only thing that's missing now from our little migration project is the external login right so we used to have",
    "start": "2804420",
    "end": "2810780"
  },
  {
    "text": "Google logins before and that that's not there yet so let's have a look how that worked in in free here in our startup so",
    "start": "2810780",
    "end": "2826099"
  },
  {
    "text": "basically what is what you need to do in free is you had to give us a callback",
    "start": "2826099",
    "end": "2832010"
  },
  {
    "text": "method that wires up the external middleware like Google you know ad FS",
    "start": "2832010",
    "end": "2838099"
  },
  {
    "text": "Facebook whatever and since we are like building the pipeline we had to inject",
    "start": "2838099",
    "end": "2843359"
  },
  {
    "text": "these middlewares in the right at the right point in the pipeline so basically we said you know here's a callback we",
    "start": "2843359",
    "end": "2850170"
  },
  {
    "text": "call that at the right point in time to wire up the middleware okay",
    "start": "2850170",
    "end": "2856460"
  },
  {
    "text": "so that's not needed anymore in in for we can just pretty much copy that to our",
    "start": "2856460",
    "end": "2868800"
  },
  {
    "text": "startup class like",
    "start": "2868800",
    "end": "2874630"
  },
  {
    "text": "it's now called Google options I think let's see if how good intelligence is",
    "start": "2874630",
    "end": "2881559"
  },
  {
    "text": "here come on go green yeah I think it",
    "start": "2881559",
    "end": "2893769"
  },
  {
    "text": "kind of did cream so this is now called sign in authentication scheme in eight",
    "start": "2893769",
    "end": "2899319"
  },
  {
    "text": "minute core and this is gone what we also need is a cookie middleware to you",
    "start": "2899319",
    "end": "2909819"
  },
  {
    "text": "know store the temporary outcome of the of the Google authentication so let's",
    "start": "2909819",
    "end": "2916119"
  },
  {
    "text": "add that as well okay Jason we have",
    "start": "2916119",
    "end": "2922150"
  },
  {
    "text": "cookies already here no it's been a core cookie",
    "start": "2922150",
    "end": "2930519"
  },
  {
    "text": "authentication what we do after use",
    "start": "2930519",
    "end": "2937329"
  },
  {
    "text": "cookie authentication new cookie authentication options we give this a",
    "start": "2937329",
    "end": "2943960"
  },
  {
    "text": "thing detecting a name of indication scheme that's called now just to be able to work with our default UI we have we",
    "start": "2943960",
    "end": "2950559"
  },
  {
    "text": "have a constant what what what the name of this middleware should be and it's called identities constants dot external",
    "start": "2950559",
    "end": "2960430"
  },
  {
    "text": "authentication scheme and we won't do automatic authenticated false and automatic challenges false as well so",
    "start": "2960430",
    "end": "2970539"
  },
  {
    "text": "and then here we say sign-in scheme is now I dentists of constants dot external",
    "start": "2970539",
    "end": "2980349"
  },
  {
    "text": "authentication scheme okay so that's",
    "start": "2980349",
    "end": "2985479"
  },
  {
    "text": "that's how you might create that and that that is not even identity of a specific it's just a spirit core ma'am so now the way this works is we have 10",
    "start": "2985479",
    "end": "2992619"
  },
  {
    "text": "more minutes that's good the way this works is on our account controller you see on the login page what we're",
    "start": "2992619",
    "end": "2998829"
  },
  {
    "text": "actually doing is we're building a few model so when we go here you see that now we are calling on this interaction",
    "start": "2998829",
    "end": "3005670"
  },
  {
    "text": "service we call the get authorization contact method which returns you an",
    "start": "3005670",
    "end": "3010950"
  },
  {
    "text": "authorization request so now in your UI you have all the details that you need to know about the current authentication",
    "start": "3010950",
    "end": "3016680"
  },
  {
    "text": "request as you see the client ID is there and display mode and blah blah blah and if you want to pass custom",
    "start": "3016680",
    "end": "3022589"
  },
  {
    "text": "parameters from the client to the server we give them to you in this parameters collection okay so you can pass in your",
    "start": "3022589",
    "end": "3028859"
  },
  {
    "text": "custom stuff as well and ultimately what this this is building is a few model for",
    "start": "3028859",
    "end": "3036359"
  },
  {
    "text": "the login page which looks like this yeah a do we allow local logins and that's the the the left side of the",
    "start": "3036359",
    "end": "3044099"
  },
  {
    "text": "screen with name and password right and if you have that do you want to have the check box with the remember me but check",
    "start": "3044099",
    "end": "3051000"
  },
  {
    "text": "box here and do we have external provide us now that that's how the few model",
    "start": "3051000",
    "end": "3056099"
  },
  {
    "text": "looks like for the login page and then what we can do is you see on the a",
    "start": "3056099",
    "end": "3062220"
  },
  {
    "text": "spirit core of Education manager that there's a method called get authentication schemes and that returns",
    "start": "3062220",
    "end": "3068849"
  },
  {
    "text": "now all of the externally registered providers like Google and Facebook and hrad and so on that's how we can",
    "start": "3068849",
    "end": "3076290"
  },
  {
    "text": "automatically fill the view model that gives you like you know log in with Google log in with whatever buttons on",
    "start": "3076290",
    "end": "3082410"
  },
  {
    "text": "the on the screen and if you see the actual view it gets pretty clear how",
    "start": "3082410",
    "end": "3087540"
  },
  {
    "text": "that works so when we go to the login view you see we have to log in few model here so if we allow local login we",
    "start": "3087540",
    "end": "3094890"
  },
  {
    "text": "render the name and password box if we allow to remember me beer you know model that and if we have",
    "start": "3094890",
    "end": "3102720"
  },
  {
    "text": "external providers then for each provider we have rendering a little button so it's not black magic it's just",
    "start": "3102720",
    "end": "3113790"
  },
  {
    "text": "a spinet cool so let's see if that works",
    "start": "3113790",
    "end": "3119869"
  },
  {
    "text": "for the last demo I guess is run the",
    "start": "3119869",
    "end": "3125070"
  },
  {
    "text": "server again",
    "start": "3125070",
    "end": "3127790"
  },
  {
    "text": "and one declined again",
    "start": "3138780",
    "end": "3145110"
  },
  {
    "text": "can you see now we have to the Google login as well okay and now I'm locked in",
    "start": "3150310",
    "end": "3158620"
  },
  {
    "text": "you know with Google and my data is coming from Google now so we have a",
    "start": "3158620",
    "end": "3165610"
  },
  {
    "text": "little bit more time for the may be the very last thing I want to talk about is a very common request we had with with",
    "start": "3165610",
    "end": "3172240"
  },
  {
    "text": "identity 7-3 was you know a scenario where you had a mixture of internal",
    "start": "3172240",
    "end": "3178150"
  },
  {
    "text": "users using Active Directory and external users using a password or Google or what's the area and believe it",
    "start": "3178150",
    "end": "3186640"
  },
  {
    "text": "or not it was very very hard in Kitana and asp.net to support both windows authentication and something else in the",
    "start": "3186640",
    "end": "3193600"
  },
  {
    "text": "same host now so our solution to that was we wrote a little mini STS yeah that",
    "start": "3193600",
    "end": "3200830"
  },
  {
    "text": "you hosted in a different application that was set up for windows authentication and then all of and at",
    "start": "3200830",
    "end": "3206920"
  },
  {
    "text": "the top of this mini thing was to authenticate the user using Windows and then return a token back to us so we you",
    "start": "3206920",
    "end": "3214630"
  },
  {
    "text": "know we could give you the Windows integrated authentication experience now this has changed a lot actually in in a",
    "start": "3214630",
    "end": "3223180"
  },
  {
    "text": "spirit core so you know that in a spirit core you are not tied to iis anymore so",
    "start": "3223180",
    "end": "3228880"
  },
  {
    "text": "when you are on Mac or whatever you don't have i ASO is is an optional",
    "start": "3228880",
    "end": "3234040"
  },
  {
    "text": "component but in the windows world windows authentication for web",
    "start": "3234040",
    "end": "3239230"
  },
  {
    "text": "applications is implemented by I is okay so yes this little thing here that they",
    "start": "3239230",
    "end": "3245860"
  },
  {
    "text": "give you in the standard templates called use iis integration and what is tough actually I don't like that it's so",
    "start": "3245860",
    "end": "3252880"
  },
  {
    "text": "much magic but that's the way implement is what it does is it actually wires up middleware yeah so you would think you",
    "start": "3252880",
    "end": "3259660"
  },
  {
    "text": "can only wire up middleware in the configure method no that's wrong there's a start-up filter something you can",
    "start": "3259660",
    "end": "3264670"
  },
  {
    "text": "implement that allows you to hook into the configuration process as well and that's what this thing is doing and one",
    "start": "3264670",
    "end": "3270910"
  },
  {
    "text": "of the things that this use is integration middle a call is doing is it wires up a Windows authentication",
    "start": "3270910",
    "end": "3277480"
  },
  {
    "text": "middleware okay so you can now explicitly do a challenge on",
    "start": "3277480",
    "end": "3284170"
  },
  {
    "text": "windows authentication middleware and trigger windows authentication explicitly from within your host even if",
    "start": "3284170",
    "end": "3289930"
  },
  {
    "text": "your host is using cookies as the main authentication method okay that's pretty cool how do we need to get it to work",
    "start": "3289930",
    "end": "3298950"
  },
  {
    "text": "you see I'm running self-hosted now so we have to switch to I is for obvious",
    "start": "3299069",
    "end": "3305740"
  },
  {
    "text": "reasons right let's see how this is",
    "start": "3305740",
    "end": "3311380"
  },
  {
    "text": "configured so it should run on localhost 5,000 so you need to enable windows",
    "start": "3311380",
    "end": "3316540"
  },
  {
    "text": "authentication here right and if I now run that again I'm running in I is now",
    "start": "3316540",
    "end": "3324630"
  },
  {
    "text": "so I have this windows authentication middleware and if I'm now starting my",
    "start": "3324630",
    "end": "3332710"
  },
  {
    "text": "client what I should see I hope III never prep this but you know let's see",
    "start": "3332710",
    "end": "3338740"
  },
  {
    "text": "what happens yeah give you okay I'm gonna now click this guy I'm logged in with my binos",
    "start": "3338740",
    "end": "3344799"
  },
  {
    "text": "account ok and you know what what",
    "start": "3344799",
    "end": "3350559"
  },
  {
    "text": "actually many people do is this on the on the login page yeah they do this they",
    "start": "3350559",
    "end": "3358119"
  },
  {
    "text": "do would check like if there does the IP address of the client machine is in the intranet lets directly switch to the",
    "start": "3358119",
    "end": "3365109"
  },
  {
    "text": "call the external login method and pass in Windows as the provider and then for your internal users they get directly",
    "start": "3365109",
    "end": "3371650"
  },
  {
    "text": "Windows integrated authentication for the external users they will get the screen with the buttons how they want to",
    "start": "3371650",
    "end": "3376780"
  },
  {
    "text": "authenticate now so yeah we are pretty happy how this worked out because",
    "start": "3376780",
    "end": "3381869"
  },
  {
    "text": "nothing of that needs to be an identity server feature anymore right because HTML car has all these pretty pretty",
    "start": "3381869",
    "end": "3389109"
  },
  {
    "text": "good actually authentication API so we don't need to reinvent the wheel here we just give you full control how you want",
    "start": "3389109",
    "end": "3396339"
  },
  {
    "text": "to interact with us any questions for that we have four minutes here",
    "start": "3396339",
    "end": "3402510"
  },
  {
    "text": "yep thank you mm-hmm well so that for",
    "start": "3404500",
    "end": "3415970"
  },
  {
    "text": "the thing is this um let me show you",
    "start": "3415970",
    "end": "3421070"
  },
  {
    "text": "that wrestle I start up so when you are",
    "start": "3421070",
    "end": "3426380"
  },
  {
    "text": "configuring identity server here you can pass in an options object here like this",
    "start": "3426380",
    "end": "3437920"
  },
  {
    "text": "like this and you can do authentication options or non authentication options",
    "start": "3439240",
    "end": "3450220"
  },
  {
    "text": "dot authentication dot sign login what",
    "start": "3450220",
    "end": "3457340"
  },
  {
    "text": "is it called authentication scheme I know it oh sorry interaction options it's called user",
    "start": "3457340",
    "end": "3463190"
  },
  {
    "text": "interaction dot login URL okay so this is basically the reader that the URL we",
    "start": "3463190",
    "end": "3469250"
  },
  {
    "text": "redirect you to whenever we need to show a login page okay and that it could be anything right it's up to you that the",
    "start": "3469250",
    "end": "3478970"
  },
  {
    "text": "only the only thing you need to do you know that that could point to some things like slash hashtag you know like",
    "start": "3478970",
    "end": "3485540"
  },
  {
    "text": "some routing angular whatever the only thing you need to do when you are done",
    "start": "3485540",
    "end": "3490550"
  },
  {
    "text": "with your login UI you have to call a controller in the in the server-side",
    "start": "3490550",
    "end": "3496640"
  },
  {
    "text": "application that sets the cookie right and when the cookie is set you direct back to do to the return URL that we",
    "start": "3496640",
    "end": "3503870"
  },
  {
    "text": "give you and that's it all right yeah",
    "start": "3503870",
    "end": "3510100"
  },
  {
    "text": "any other questions yes",
    "start": "3510100",
    "end": "3516460"
  },
  {
    "text": "no because they are actually mandatory by the protocol right but what you rather I would do is you would in in the",
    "start": "3520530",
    "end": "3528820"
  },
  {
    "text": "client middle where you know the the opmod reconnect middleware has these events thing here so you can say events",
    "start": "3528820",
    "end": "3536820"
  },
  {
    "text": "equals you know new open ID connect events like this and then there's an",
    "start": "3536820",
    "end": "3548369"
  },
  {
    "text": "there is an on token received event and",
    "start": "3549510",
    "end": "3555100"
  },
  {
    "text": "then what you what you get here is on e dot ticket taught principal baby the on",
    "start": "3555100",
    "end": "3562390"
  },
  {
    "text": "token received event runs after the token has been validated but before they hand over the control to the cookie",
    "start": "3562390",
    "end": "3568210"
  },
  {
    "text": "middleware - sighs - to issue the cookie so what you can do is you can just take",
    "start": "3568210",
    "end": "3573610"
  },
  {
    "text": "the principal take the claims you want throw away the others and just let it throw flu and then and then then you",
    "start": "3573610",
    "end": "3579880"
  },
  {
    "text": "only get the claims you really care about and you have the same option with the baby is but in fact the baby is it's",
    "start": "3579880",
    "end": "3586690"
  },
  {
    "text": "not that terrible but here you want to save space in the cookie problem yeah so that that that would be that data",
    "start": "3586690",
    "end": "3592870"
  },
  {
    "text": "brochure there were other questions",
    "start": "3592870",
    "end": "3598110"
  },
  {
    "text": "some people erased and no good then we",
    "start": "3598920",
    "end": "3604780"
  },
  {
    "text": "on time thank you [Applause]",
    "start": "3604780",
    "end": "3613989"
  }
]