[
  {
    "text": "blimey that's loud good morning everyone all right stay",
    "start": "7270",
    "end": "13140"
  },
  {
    "text": "hands up if you've got a hangover well you obviously yeah",
    "start": "13140",
    "end": "18840"
  },
  {
    "text": "so welcome to build your own Azir which is honestly no we're not going to build",
    "start": "18840",
    "end": "25990"
  },
  {
    "text": "as you because as you as really it's big it's complicated",
    "start": "25990",
    "end": "31210"
  },
  {
    "text": "it's got databases and document databases and storage systems and",
    "start": "31210",
    "end": "36690"
  },
  {
    "text": "InfiniBand ultra-flat mesh networking and media services and whatever else",
    "start": "36690",
    "end": "43420"
  },
  {
    "text": "we're just going to build a very small part of as you there's a thing in SEO",
    "start": "43420",
    "end": "49240"
  },
  {
    "text": "now and in most clouds actually but in Azure it's called app services it was called Web Apps and",
    "start": "49240",
    "end": "56580"
  },
  {
    "text": "it's basically a part of Azure where you can just build an application and then",
    "start": "56580",
    "end": "62920"
  },
  {
    "text": "just push it into us here and run it this was a trend it was started by",
    "start": "62920",
    "end": "68619"
  },
  {
    "text": "Heroku I think the first people who do it you basically did a git push Heroku master and it just automatically built",
    "start": "68619",
    "end": "75130"
  },
  {
    "text": "all your code and ran it for you so I'm going to show you how to build your own app services the original plan was that",
    "start": "75130",
    "end": "83860"
  },
  {
    "text": "I was going to bring in a little server rack that was about that big and I",
    "start": "83860",
    "end": "89710"
  },
  {
    "text": "started I tried it with Raspberry Pi but it didn't work and then I was going to import a bunch of kangaroo mini PCs from",
    "start": "89710",
    "end": "97780"
  },
  {
    "text": "the states but that would have cost me nearly a thousand pounds for a talk and no so I'm going to build my own Azure",
    "start": "97780",
    "end": "106510"
  },
  {
    "text": "and I'm going to run it in Azure because",
    "start": "106510",
    "end": "112240"
  },
  {
    "text": "I know what I'm doing with a zero I understand it but I'm going to run it cheaply and cost-effectively so why",
    "start": "112240",
    "end": "119590"
  },
  {
    "text": "would you want to do this well this is the primary reason if you use app",
    "start": "119590",
    "end": "125619"
  },
  {
    "text": "services all that convenience and lovely stuff that they've built on top of the",
    "start": "125619",
    "end": "131080"
  },
  {
    "text": "underlying infrastructure comes at a premium cost and it's a big premium an app service VM costs fifty five",
    "start": "131080",
    "end": "138940"
  },
  {
    "text": "pounds a month and the same size of VM running Ubuntu 1604",
    "start": "138940",
    "end": "144550"
  },
  {
    "text": "costs 36 pounds a month and that's for the kind of dual-core D Series VMS and",
    "start": "144550",
    "end": "155070"
  },
  {
    "text": "36 pounds a month gets you quite a nice box for running Linux but it's not a great box for running windows and iis",
    "start": "155070",
    "end": "161650"
  },
  {
    "text": "and all the stuff that goes on top of that so you also get more performance out of that 36 pounds a month then you",
    "start": "161650",
    "end": "166870"
  },
  {
    "text": "do another 55 pounds a month so that's that's one reason and you know multiply that up by the number of cores you",
    "start": "166870",
    "end": "172600"
  },
  {
    "text": "actually need to run all your apps and services and everything else and that becomes a fairly substantial amount of",
    "start": "172600",
    "end": "179620"
  },
  {
    "text": "money I know because I used to run an app that was in every Azure data center",
    "start": "179620",
    "end": "185530"
  },
  {
    "text": "and I was running it on App Services and when my Bismark plus ran out I nearly went bankrupt honestly that's why this",
    "start": "185530",
    "end": "193930"
  },
  {
    "text": "laptop is so old I'm still like recovering from from app services so but",
    "start": "193930",
    "end": "201940"
  },
  {
    "text": "the other reason that you might want to do this is the just the control so when you run app services they basically go",
    "start": "201940",
    "end": "208780"
  },
  {
    "text": "it's a VM and they don't tell you what kind of VM it is so you don't know whether it's an AC series or a D series",
    "start": "208780",
    "end": "214000"
  },
  {
    "text": "what kind of storage it's got whether it's using SSDs or the old kind of spinning rust whether it's using premium",
    "start": "214000",
    "end": "221020"
  },
  {
    "text": "storage with the really fast disk access underneath or anything else and there",
    "start": "221020",
    "end": "227200"
  },
  {
    "text": "are this basically you've got one core to cause for calls or eight calls that's it and so if you switch over to the ends",
    "start": "227200",
    "end": "234340"
  },
  {
    "text": "then you've got all the available options the massive compute things and everything else and you can run whatever",
    "start": "234340",
    "end": "241570"
  },
  {
    "text": "you want and you can spec them according to your requirements so that's kind of",
    "start": "241570",
    "end": "247360"
  },
  {
    "text": "also a very good reason to build your own app services on top of this thing",
    "start": "247360",
    "end": "252820"
  },
  {
    "text": "even though I am just running it in Azure I'm building my own Azir insiders here it's like googling Google it's",
    "start": "252820",
    "end": "260079"
  },
  {
    "text": "going to make the internet explode so what are we actually going to build what we want is something with easy",
    "start": "260080",
    "end": "266919"
  },
  {
    "text": "deployment so I can build an application and then just deploy it without really",
    "start": "266919",
    "end": "271960"
  },
  {
    "text": "thinking about it automatically handle domain assignments and routing and everything",
    "start": "271960",
    "end": "278600"
  },
  {
    "text": "else that goes on there and because this is 2017 we want HTTPS on everything by",
    "start": "278600",
    "end": "284720"
  },
  {
    "text": "default so we're gonna build all of that in an hour",
    "start": "284720",
    "end": "289960"
  },
  {
    "text": "actually in 55 minutes because that's what I've got left because I talk too much so step one they're not gonna be a",
    "start": "289960",
    "end": "298490"
  },
  {
    "text": "lot of live demos in this because there's an awful lot of moving parts and",
    "start": "298490",
    "end": "305229"
  },
  {
    "text": "it works eventually but you kind of have to restart scripts and things occasionally and also Niall is in the",
    "start": "305229",
    "end": "313039"
  },
  {
    "text": "room and he's got an internet disrupter and so I don't want to depend too much on the internet just in case he decides",
    "start": "313039",
    "end": "320360"
  },
  {
    "text": "it would be funny to break me so runtime we're going to use docker obviously this",
    "start": "320360",
    "end": "328099"
  },
  {
    "text": "is now your opportunity to get up and walk out of the room if you are really sick to the back teeth of hearing about",
    "start": "328099",
    "end": "333259"
  },
  {
    "text": "King docker know it's a DevOps talk so you know docker we're going to use",
    "start": "333259",
    "end": "339470"
  },
  {
    "text": "docker swarm and docker swarm is the new thing in the most the current version of",
    "start": "339470",
    "end": "344810"
  },
  {
    "text": "docker 1.12 they added swarm mode into the core system so you can spin up a",
    "start": "344810",
    "end": "350389"
  },
  {
    "text": "bunch of machines run docker on them till some of them that their managers and some of them that their workers and",
    "start": "350389",
    "end": "355490"
  },
  {
    "text": "then just say create a service and run it for me and it handles everything in",
    "start": "355490",
    "end": "360530"
  },
  {
    "text": "there and you can do this from the command line or you can use kind of GUI",
    "start": "360530",
    "end": "365720"
  },
  {
    "text": "tools there's Dockers Universal control plane if you're running in Azure there's",
    "start": "365720",
    "end": "371060"
  },
  {
    "text": "docker for Azure if you're running in AWS there's docker for AWS I would be very surprised if there's not a docker for Google cloud at some point so that's",
    "start": "371060",
    "end": "378680"
  },
  {
    "text": "what we're going to set up and the infrastructure that we need to run this on in Azure tone so we need some servers",
    "start": "378680",
    "end": "385280"
  },
  {
    "text": "obviously and we need those servers to be in a network and for disaster",
    "start": "385280",
    "end": "390680"
  },
  {
    "text": "recovery and availability and load balancing we need them to be in an availability set and then we need a load",
    "start": "390680",
    "end": "396349"
  },
  {
    "text": "balancer in front of them pointing at those different machines and doing the routing the server's we're going to",
    "start": "396349",
    "end": "403909"
  },
  {
    "text": "create one manager and two workers so the manager is the thing that controls cluster and tells the workers what to do",
    "start": "403909",
    "end": "411030"
  },
  {
    "text": "and works out that that work is not doing very much and that work is overloaded so I'm gonna move that service from there to there and just",
    "start": "411030",
    "end": "417930"
  },
  {
    "text": "Auto balancing and everything else we're going to run this on a bun to 1604 LTS because why would you run any other",
    "start": "417930",
    "end": "425010"
  },
  {
    "text": "linux but it actually no it doesn't matter you can run it on anything that's",
    "start": "425010",
    "end": "430140"
  },
  {
    "text": "the nice thing about docker is you get a machine if it can run docker then it can",
    "start": "430140",
    "end": "435480"
  },
  {
    "text": "run pretty much anything and Ubuntu just happens to be the one their package",
    "start": "435480",
    "end": "441690"
  },
  {
    "text": "manager I know what I'm talking about I know all the libs are called and everything else but you can use Fedora CentOS Red Hat Enterprise Linux if you",
    "start": "441690",
    "end": "449730"
  },
  {
    "text": "work in the financial sector where they actually won't use something if they're not allowed to pay for it I love the",
    "start": "449730",
    "end": "455490"
  },
  {
    "text": "financial sector and you can use Oracle Linux if you hate yourself and you want to die they're not a sponsor are they no",
    "start": "455490",
    "end": "466230"
  },
  {
    "text": "not anymore so to set up a manager you",
    "start": "466230",
    "end": "473040"
  },
  {
    "text": "spin up your box in in Azure with this",
    "start": "473040",
    "end": "478470"
  },
  {
    "text": "is assuming a wouldn't - and then you do this that first line their hands up who",
    "start": "478470",
    "end": "485640"
  },
  {
    "text": "thinks that first line there is the worst line of anything they've ever seen anywhere ever yeah yeah download",
    "start": "485640",
    "end": "491790"
  },
  {
    "text": "something off the internet and pipe it straight into SH preferably with sudo so",
    "start": "491790",
    "end": "500520"
  },
  {
    "text": "yes I say it's ok because it's HTTP and so I know it's coming from what you",
    "start": "500520",
    "end": "506910"
  },
  {
    "text": "would actually do though is you would download that shell script and you would go through it and make sure it was doing what you thought it was doing and then",
    "start": "506910",
    "end": "512940"
  },
  {
    "text": "you would just run it with with SH but this is this is easier and and I like",
    "start": "512940",
    "end": "518969"
  },
  {
    "text": "telling people to do this because it creates millions of machines running in clouds all around the world that are vulnerable to my botnet so that so that",
    "start": "518970",
    "end": "527730"
  },
  {
    "text": "I can infect and elasticsearch clusters and then hold them to ransom and tell them that if they give me",
    "start": "527730",
    "end": "534180"
  },
  {
    "text": "Bitcoin I will give them their data back now I've just deleted it",
    "start": "534180",
    "end": "540050"
  },
  {
    "text": "that's assuming that they get my message and Niall hasn't come along since then and dropped in his message telling them",
    "start": "541329",
    "end": "547490"
  },
  {
    "text": "to give him Bitcoin then I'm going to that second line there is really handy when you when you've installed docker",
    "start": "547490",
    "end": "552740"
  },
  {
    "text": "you add your login to the docker group and then you kind of need to log out and",
    "start": "552740",
    "end": "558199"
  },
  {
    "text": "log back in again usually but that means you don't need to use sudo to communicate with the dock demon anymore",
    "start": "558199",
    "end": "563329"
  },
  {
    "text": "and then to create the manager we just say docker swarm in it and then the",
    "start": "563329",
    "end": "570709"
  },
  {
    "text": "advertiser dress is your internal IP address on your network so ten or",
    "start": "570709",
    "end": "575779"
  },
  {
    "text": "whatever and then we are going to secure it because seriously I got a call from",
    "start": "575779",
    "end": "585050"
  },
  {
    "text": "one of my consulting type customers saying have you ever heard of a container called runner's root did you",
    "start": "585050",
    "end": "591680"
  },
  {
    "text": "put that on our system and I'm like no no that wasn't me they hadn't secured",
    "start": "591680",
    "end": "597410"
  },
  {
    "text": "their swarm so anybody could just deploy anything they wanted on it and there is",
    "start": "597410",
    "end": "602600"
  },
  {
    "text": "a docker container called runner's root which allows you to do root things on the host operating system and yeah and",
    "start": "602600",
    "end": "610730"
  },
  {
    "text": "the thing is docker when it's listening on TCP it listens on port 23 75 and",
    "start": "610730",
    "end": "617779"
  },
  {
    "text": "there aren't that many IP addresses and machines are very fast these days and so if you've got a botnet you can just scan",
    "start": "617779",
    "end": "624649"
  },
  {
    "text": "all the IP addresses in the world and see if there's something listening on port 23 75 and if there is you can go",
    "start": "624649",
    "end": "631579"
  },
  {
    "text": "can I run docker things on that oh yes I can so secure your swarm it's not actually",
    "start": "631579",
    "end": "638269"
  },
  {
    "text": "that complicated all you have to do is create your own certificate authority",
    "start": "638269",
    "end": "643699"
  },
  {
    "text": "and that's it's not complicated so you",
    "start": "643699",
    "end": "648980"
  },
  {
    "text": "know like Komodo or let's encrypt or whatever you just create your own certificate authority then you create",
    "start": "648980",
    "end": "654350"
  },
  {
    "text": "and sign a certificate and use that on the server to secure that and then any",
    "start": "654350",
    "end": "659629"
  },
  {
    "text": "other you create client certificates and any client certificate that is signed by",
    "start": "659629",
    "end": "665269"
  },
  {
    "text": "the same Authority as the server certificate will be able to communicate with that server okay so that sounds",
    "start": "665269",
    "end": "672230"
  },
  {
    "text": "really complicated but actually this is how you create certificate authority it's it's two lines of code you generate a key and a",
    "start": "672230",
    "end": "679300"
  },
  {
    "text": "public key and a signing thing and what I don't understand I just typed the words in and stuff happens and it seems",
    "start": "679300",
    "end": "685459"
  },
  {
    "text": "to work but that's how you create a certificate authority so the things that are coming out of this basically your",
    "start": "685459",
    "end": "691869"
  },
  {
    "text": "CAPM and you'll see a dot PM check those into github because you know as long as",
    "start": "691869",
    "end": "699619"
  },
  {
    "text": "you put it in a private repository it's fine how is anybody going to be able to access it if it's in the private repo I",
    "start": "699619",
    "end": "705079"
  },
  {
    "text": "swear to god I'm gonna strangle some of my customers so yeah that's that's how",
    "start": "705079",
    "end": "711920"
  },
  {
    "text": "we create a certificate authority then this is how we cite we create a service certificate and that's basically so we",
    "start": "711920",
    "end": "719420"
  },
  {
    "text": "generate a key and then we add a subject to it which needs our domain name in there so I've already got my stuff up",
    "start": "719420",
    "end": "726439"
  },
  {
    "text": "and running on honest you it's running on spiffy manager theoretically",
    "start": "726439",
    "end": "733459"
  },
  {
    "text": "about.com I'm gonna add in the internal IP addresses it's running on so the",
    "start": "733459",
    "end": "738769"
  },
  {
    "text": "other things inside can talk to it as well and then that last bit there is just how you sign your your certificate",
    "start": "738769",
    "end": "746509"
  },
  {
    "text": "this bit here I could have done this with the mouse goodnight whatever that's",
    "start": "746509",
    "end": "753470"
  },
  {
    "text": "that's my password that's the password I use for everything so so you can access pretty much anything of mine on the",
    "start": "753470",
    "end": "758779"
  },
  {
    "text": "internet just with the password secret squirrel with numbers instead of letters does anyone remember secret squirrel old",
    "start": "758779",
    "end": "766670"
  },
  {
    "text": "people is the best I just made up a",
    "start": "766670",
    "end": "772730"
  },
  {
    "text": "cartoon that I'm trying to convince my children was real calling called um Captain Spang in the monthly bump please",
    "start": "772730",
    "end": "778459"
  },
  {
    "text": "and I'm trying to seed the internet with evidence that this was a thing",
    "start": "778459",
    "end": "784069"
  },
  {
    "text": "the monthly bum pleas were always stealing captain's bangs cheese so yes",
    "start": "784069",
    "end": "791480"
  },
  {
    "text": "and generating the client certificate it's pretty much the same thing except instead of the the domain name we just",
    "start": "791480",
    "end": "798079"
  },
  {
    "text": "put C N equals client and that goes into files on your system and then you copy",
    "start": "798079",
    "end": "804439"
  },
  {
    "text": "those into your docker directory in your home directory and then docker will use those",
    "start": "804439",
    "end": "811940"
  },
  {
    "text": "to communicate with the remote server to add the you can get all this off the",
    "start": "811940",
    "end": "819560"
  },
  {
    "text": "slides the slides are public and theoretically by the end of the talk there will be a website that you can go",
    "start": "819560",
    "end": "824570"
  },
  {
    "text": "to that's got links to the slides and to all this code on github as well as long as the demo works okay so then we just",
    "start": "824570",
    "end": "832910"
  },
  {
    "text": "configure docker to tell it to listen on the TCP so docker by default listens on",
    "start": "832910",
    "end": "838820"
  },
  {
    "text": "a UNIX socket which is just a file we're gonna add some stuff to the startup here",
    "start": "838820",
    "end": "844070"
  },
  {
    "text": "to say I want you to listen on TCP I want you to use transport level security here's your key",
    "start": "844070",
    "end": "850250"
  },
  {
    "text": "here's your certificate and here's the address I want you to listen on which is just the network host and when doc is",
    "start": "850250",
    "end": "857029"
  },
  {
    "text": "running securely it runs on port 23 76 so it's not worth your botnet trying to",
    "start": "857029",
    "end": "863209"
  },
  {
    "text": "connect on 23 76 because it's going to be secure so we do that and then we just",
    "start": "863209",
    "end": "868640"
  },
  {
    "text": "restart docker so it's secure and then on our kind of machine that we're doing",
    "start": "868640",
    "end": "875449"
  },
  {
    "text": "stuff on the the client a desktop machine to attach to the swarm we say",
    "start": "875449",
    "end": "883149"
  },
  {
    "text": "export docker host equal you know create an environment variable in Windows",
    "start": "883149",
    "end": "888709"
  },
  {
    "text": "however you do that export docker host equals TCP colon slash slash and then",
    "start": "888709",
    "end": "894769"
  },
  {
    "text": "the the web address of our manager TLS verify equals 1 just tells it to use TLS",
    "start": "894769",
    "end": "903740"
  },
  {
    "text": "certificate authentication and then talking to our manager we say docker",
    "start": "903740",
    "end": "908930"
  },
  {
    "text": "swarm join token - queue just says don't put all the other stuff out just give me",
    "start": "908930",
    "end": "914630"
  },
  {
    "text": "the token and I want to join token for a worker we can then use that token which",
    "start": "914630",
    "end": "920329"
  },
  {
    "text": "is a hash of something somewhere no idea what to tell the workers so you SSH into",
    "start": "920329",
    "end": "928519"
  },
  {
    "text": "your worker machines and just do sudo docker swarm join - - token and the IP",
    "start": "928519",
    "end": "934279"
  },
  {
    "text": "address and it will become part of your swarm okay everyone get that good there will",
    "start": "934279",
    "end": "943949"
  },
  {
    "text": "be questions in the pub quiz this evening I've got a whole section on how do you do this in Dhaka it's gonna be a",
    "start": "943949",
    "end": "950609"
  },
  {
    "text": "fun quiz so the next thing you need is a",
    "start": "950609",
    "end": "956759"
  },
  {
    "text": "registry a registry is where you put your docker images and there are",
    "start": "956759",
    "end": "962569"
  },
  {
    "text": "multiple options here the simplest one and the one that I advise people to do",
    "start": "962569",
    "end": "970379"
  },
  {
    "text": "just for small projects and making life",
    "start": "970379",
    "end": "975629"
  },
  {
    "text": "easy on yourself is you can just pay a small amount of money for a private repo on the docker hub they will host your",
    "start": "975629",
    "end": "983369"
  },
  {
    "text": "image for you and keep it private and safe that's fine for a lot of things if",
    "start": "983369",
    "end": "988439"
  },
  {
    "text": "you've got like proper security concerns like your a bang course you know scary data type stuff then don't do that",
    "start": "988439",
    "end": "995789"
  },
  {
    "text": "because it is public and they might get hacked they probably won't but they might so the other option or one other",
    "start": "995789",
    "end": "1002329"
  },
  {
    "text": "option is to use your cloud providers registry so as your and Amazon and Google all provide docker registries",
    "start": "1002329",
    "end": "1008779"
  },
  {
    "text": "built into the system and so you can push your images into there or you can just run your own docker registry guess",
    "start": "1008779",
    "end": "1015829"
  },
  {
    "text": "which one we're going to do haha it's actually really really easy all you have",
    "start": "1015829",
    "end": "1022459"
  },
  {
    "text": "to do is run the registry and then you have to secure the registry for the same reason you have to secure the swamp",
    "start": "1022459",
    "end": "1027740"
  },
  {
    "text": "because otherwise people can go oh that looks like a nice image I'll just replace it with one of mine so I'm gonna",
    "start": "1027740",
    "end": "1034519"
  },
  {
    "text": "use docker compose for this if you are using docker and you are not using docker compose you are an idiot and you",
    "start": "1034519",
    "end": "1040850"
  },
  {
    "text": "should stop and just go and learn docker compose it's rather than running docker",
    "start": "1040850",
    "end": "1045980"
  },
  {
    "text": "commands with all those - - this and - - the other and - - whatever else you",
    "start": "1045980",
    "end": "1051200"
  },
  {
    "text": "created yeah more file and you put all the things you want to run in it and all the parameters and configuration and",
    "start": "1051200",
    "end": "1056899"
  },
  {
    "text": "everything and then you just say docker compose up and it starts it running and you can spin up 15 different services",
    "start": "1056899",
    "end": "1063740"
  },
  {
    "text": "and multiple networks and volumes and all sorts of stuff it's great so this is the docker compose for starting a",
    "start": "1063740",
    "end": "1069559"
  },
  {
    "text": "registry restart or where you says to the doctor demon if this crashes",
    "start": "1069559",
    "end": "1075230"
  },
  {
    "text": "can you start it again please Cheers and then the docker registry is available as a docker image from docker",
    "start": "1075230",
    "end": "1082460"
  },
  {
    "text": "so you want to run a registry you go docker run registry and it's we're using",
    "start": "1082460",
    "end": "1088160"
  },
  {
    "text": "version two we're exposing a couple of ports 5004 unsecured access and 443 for",
    "start": "1088160",
    "end": "1093950"
  },
  {
    "text": "secured access and then we're mounting some volumes onto it so we're mounting",
    "start": "1093950",
    "end": "1099830"
  },
  {
    "text": "our own configuration file in there and we've got an authentication folder which",
    "start": "1099830",
    "end": "1104900"
  },
  {
    "text": "it's got something in it that we'll look at and we've got cache folder as well which is where it could potentially keep",
    "start": "1104900",
    "end": "1112040"
  },
  {
    "text": "the actual image data this one's a bit more scary this is the configuration",
    "start": "1112040",
    "end": "1117830"
  },
  {
    "text": "file but it's it's not difficult to write what you do is you go to doc accom",
    "start": "1117830",
    "end": "1123800"
  },
  {
    "text": "you find the page with this on it and then you copy and paste it into a file on your machine and then you delete the",
    "start": "1123800",
    "end": "1129350"
  },
  {
    "text": "bits that you don't want that's that's how the professionals do it anyway so this is a docker registry configuration",
    "start": "1129350",
    "end": "1135650"
  },
  {
    "text": "file important lines so we are going to use Azure storage because we're running",
    "start": "1135650",
    "end": "1142100"
  },
  {
    "text": "in Azure we're just going to use blob storage to to store our image data and",
    "start": "1142100",
    "end": "1149750"
  },
  {
    "text": "push it and pull it in everything else and then we're going to tell it what to do on HTTP and because we want this",
    "start": "1149750",
    "end": "1155660"
  },
  {
    "text": "running on HTTPS we are going to use let's encrypt to grab a certificate and",
    "start": "1155660",
    "end": "1163870"
  },
  {
    "text": "apply it to the registry and the docker registry image has support for this",
    "start": "1163870",
    "end": "1169610"
  },
  {
    "text": "built in so you start it and because it's in the configuration it goes to let's encrypt and says give me a",
    "start": "1169610",
    "end": "1175880"
  },
  {
    "text": "certificate and let's encrypt says are you the domain you say you are on the IP air do you laugh why are you smiling at",
    "start": "1175880",
    "end": "1182000"
  },
  {
    "text": "me in that way it is it is it just does it it's fantastic this is this is the",
    "start": "1182000",
    "end": "1189440"
  },
  {
    "text": "alternative to applying for a certificate from GoDaddy or Komodo or",
    "start": "1189440",
    "end": "1194990"
  },
  {
    "text": "whatever and then waiting 24 hours while they verify that your gmail address is actually you so yes",
    "start": "1194990",
    "end": "1203450"
  },
  {
    "text": "and then we're gonna so that's what the cache directory is for look cache obviously that's let's encrypt cache and",
    "start": "1203450",
    "end": "1209359"
  },
  {
    "text": "the email address there that's going to become the certificates contact thing so",
    "start": "1209359",
    "end": "1215509"
  },
  {
    "text": "if anyone wants to get in touch with me to find out who I am and what the hell I think I'm doing they will be able to and",
    "start": "1215509",
    "end": "1223570"
  },
  {
    "text": "then so we've got storage driver and then the HT password down at the bottom bit there we're just using basic",
    "start": "1223570",
    "end": "1229309"
  },
  {
    "text": "authentication for this because that's easy but you can also set this up to use the same kind of certificate based",
    "start": "1229309",
    "end": "1235279"
  },
  {
    "text": "authentication that you use for the swarm security so basic authentication",
    "start": "1235279",
    "end": "1245289"
  },
  {
    "text": "one of the things I really love about docker is it's not just for spinning up",
    "start": "1245289",
    "end": "1252109"
  },
  {
    "text": "services and running them and leaving them running and so forth there were really complicated kind of commands or",
    "start": "1252109",
    "end": "1259159"
  },
  {
    "text": "or things and you have to install an absolute shed load of stuff on your system to get it to work properly and so",
    "start": "1259159",
    "end": "1267139"
  },
  {
    "text": "you can use docker containers just as command line things and the registry",
    "start": "1267139",
    "end": "1273559"
  },
  {
    "text": "container actually will allow you to run it and use its built-in HT password",
    "start": "1273559",
    "end": "1281389"
  },
  {
    "text": "thing to create your encrypted password file so we create a directory called off",
    "start": "1281389",
    "end": "1289159"
  },
  {
    "text": "in the same directory as an aqua compose file and then we docker run tell it to",
    "start": "1289159",
    "end": "1295279"
  },
  {
    "text": "run HT password as the entry point instead of what it normally does and then just pass in those parameters there",
    "start": "1295279",
    "end": "1301969"
  },
  {
    "text": "so this is Mark that's my password again and that's going to go into an HT password file on my local system which",
    "start": "1301969",
    "end": "1308119"
  },
  {
    "text": "is then going to get mounted into the docker registry when I run that okay so",
    "start": "1308119",
    "end": "1313429"
  },
  {
    "text": "I do that then I do docker compose up I do - D - tell it to run into tat mode so",
    "start": "1313429",
    "end": "1320479"
  },
  {
    "text": "it just carries on going and then I log out of the Machine and I have a secure docker registry that I can access over",
    "start": "1320479",
    "end": "1326509"
  },
  {
    "text": "the Internet okay it's incredibly easy and straightforward how long do you think",
    "start": "1326509",
    "end": "1332539"
  },
  {
    "text": "all this is going to take when you do this like what half an hour maybe an hour to run these commands and",
    "start": "1332539",
    "end": "1339380"
  },
  {
    "text": "so forth so that's that's all very well and good but it gets boring",
    "start": "1339380",
    "end": "1346730"
  },
  {
    "text": "it gets boring really quickly did anyone go to James Newton's talk on terraform on console yesterday no there's some",
    "start": "1346730",
    "end": "1356120"
  },
  {
    "text": "people it's terraform is awesome",
    "start": "1356120",
    "end": "1361270"
  },
  {
    "text": "essentially all you're doing here with all this sort of modern cloudy DevOps",
    "start": "1362050",
    "end": "1367400"
  },
  {
    "text": "type of thing is you're entering commands into a console and waiting",
    "start": "1367400",
    "end": "1373130"
  },
  {
    "text": "until I finish and then entering another command in or you know if you are more",
    "start": "1373130",
    "end": "1378230"
  },
  {
    "text": "of a GUI kind of person you're navigating the lovely blade system in the azure portal and ticking tick boxes",
    "start": "1378230",
    "end": "1385610"
  },
  {
    "text": "and putting settings in there and uploading files and everything else and terraform",
    "start": "1385610",
    "end": "1392440"
  },
  {
    "text": "basically does all that stuff for you it's a system for scripting",
    "start": "1392440",
    "end": "1399190"
  },
  {
    "text": "infrastructure and and you tell it what state you want your infrastructure to be",
    "start": "1399190",
    "end": "1404900"
  },
  {
    "text": "in and then you do an apply and it just goes and does it for you and it's really",
    "start": "1404900",
    "end": "1411770"
  },
  {
    "text": "powerful and it will work with all the different clouds and digitalocean and various other things as well and it also",
    "start": "1411770",
    "end": "1418400"
  },
  {
    "text": "works with ancillary providers and so forth so I'm going to show you a couple",
    "start": "1418400",
    "end": "1423680"
  },
  {
    "text": "of terraform files here I'm going to close all of those I'm going to ctrl +",
    "start": "1423680",
    "end": "1433060"
  },
  {
    "text": "so here's terraform is the registry",
    "start": "1433660",
    "end": "1440350"
  },
  {
    "text": "so this is a terraforming script file and all this is going to do is it's",
    "start": "1445300",
    "end": "1450560"
  },
  {
    "text": "going to buzz through all my various commands here and I just tell it what I want to exist and then when I run it it",
    "start": "1450560",
    "end": "1458450"
  },
  {
    "text": "goes off and it looks and for anything that doesn't exist it will create it and",
    "start": "1458450",
    "end": "1464030"
  },
  {
    "text": "so I say I want a resource for a group called spiffy registry and I want a virtual network and I want to subnet",
    "start": "1464030",
    "end": "1472220"
  },
  {
    "text": "within that virtual network and then I need a public IP address and I want that to be static and then I need network",
    "start": "1472220",
    "end": "1480020"
  },
  {
    "text": "interface that I can attach to my virtual machine and then I need some security rules to say what ports are",
    "start": "1480020",
    "end": "1485990"
  },
  {
    "text": "allowed in so I want 80 and 443 and 5,000 and I might want to SSH into it so",
    "start": "1485990",
    "end": "1492020"
  },
  {
    "text": "I'm going to open port 22 as well and then I need a storage account which is",
    "start": "1492020",
    "end": "1498200"
  },
  {
    "text": "where all the images and also my disk images and so forth are going to go so I'm going to create a container in there",
    "start": "1498200",
    "end": "1503270"
  },
  {
    "text": "called VH DS and then I'm going to create my virtual machine and so this is",
    "start": "1503270",
    "end": "1510020"
  },
  {
    "text": "the fun bit you say this is the image I want to use to create the virtual machine so it's canonical Ubuntu server",
    "start": "1510020",
    "end": "1517910"
  },
  {
    "text": "16 point Oh 4.0 - LTS used the latest version of that create an operating",
    "start": "1517910",
    "end": "1524150"
  },
  {
    "text": "system disk create a login disabled password authentication and upload my",
    "start": "1524150",
    "end": "1529730"
  },
  {
    "text": "local RSA key so I can SSH into this machine without passwords and I will log",
    "start": "1529730",
    "end": "1538250"
  },
  {
    "text": "in as that user there I want to tag it with a production tag",
    "start": "1538250",
    "end": "1544750"
  },
  {
    "text": "to say this is a production system even though it's not it's a demo and then",
    "start": "1544750",
    "end": "1550280"
  },
  {
    "text": "when I get to the bottom here I am going to say remote exec and tell it to login",
    "start": "1550280",
    "end": "1558170"
  },
  {
    "text": "using the spiffy admin user and then run that get docker and pipe it to so SH and",
    "start": "1558170",
    "end": "1564290"
  },
  {
    "text": "then add the thing in there and then I'll going to add in the steps to just",
    "start": "1564290",
    "end": "1570500"
  },
  {
    "text": "run the registry and create stuff and everything as well again what you would do if you were",
    "start": "1570500",
    "end": "1577110"
  },
  {
    "text": "concerned about security is you would download that shell script and add it to",
    "start": "1577110",
    "end": "1582419"
  },
  {
    "text": "the resources within your terraform directory and then you can just upload that script from your local machine and",
    "start": "1582419",
    "end": "1588389"
  },
  {
    "text": "then execute it on the remote machine and that works perfectly well as well",
    "start": "1588389",
    "end": "1595230"
  },
  {
    "text": "and then so at this point a lot of people say what do you think of your",
    "start": "1595230",
    "end": "1600659"
  },
  {
    "text": "resource manager so as your resource manager is essentially terraform ish but",
    "start": "1600659",
    "end": "1607649"
  },
  {
    "text": "it's just for Azure and there are two things that turn me off as your resource",
    "start": "1607649",
    "end": "1613590"
  },
  {
    "text": "manager I love the fact that it exists it's only because as your resource manager exists that terraform can do",
    "start": "1613590",
    "end": "1620880"
  },
  {
    "text": "what it does because terraform is using it under the covers but they have this thing called arm templates which are",
    "start": "1620880",
    "end": "1626279"
  },
  {
    "text": "JSON the files that do roughly the same thing except Jason it's not a scripting",
    "start": "1626279",
    "end": "1633450"
  },
  {
    "text": "language it's it's a serialization format and I wish people would just get over Jason as a scripting language just",
    "start": "1633450",
    "end": "1640620"
  },
  {
    "text": "stop it it may be for configuration may be for sort of like a couple of settings and",
    "start": "1640620",
    "end": "1645929"
  },
  {
    "text": "whatever else it's fine or if you've got something that handles it for you automatically like NPM then that's fine",
    "start": "1645929",
    "end": "1652799"
  },
  {
    "text": "too because NPM choice with Jason fine but um so that's that's one issue with",
    "start": "1652799",
    "end": "1658679"
  },
  {
    "text": "it and the other thing is that for some reason that I cannot fathom as your",
    "start": "1658679",
    "end": "1663779"
  },
  {
    "text": "resource manager templates don't work with AWS or Google or CloudFlare and",
    "start": "1663779",
    "end": "1671899"
  },
  {
    "text": "terraform works with CloudFlare so I have a key a token so I can talk to CloudFlare so",
    "start": "1671899",
    "end": "1679320"
  },
  {
    "text": "at the end when all this is up and running in terraform will also attach to the CloudFlare api and set up a registry",
    "start": "1679320",
    "end": "1685919"
  },
  {
    "text": "subdomain on my spiffy demo com domain that I registered just for this talk",
    "start": "1685919",
    "end": "1691289"
  },
  {
    "text": "eight quid that cost and it will create that record and so once this finishes I",
    "start": "1691289",
    "end": "1698190"
  },
  {
    "text": "then have my daugher thing running and it is actually addressable from the internet so that's that's quite a fun",
    "start": "1698190",
    "end": "1706919"
  },
  {
    "text": "script and again that's going to be the resources that there'll be a link to at the end of the talk",
    "start": "1706919",
    "end": "1712130"
  },
  {
    "text": "here's an even more fun one so this does",
    "start": "1712130",
    "end": "1717810"
  },
  {
    "text": "actually create the entire swarm and it secures it and it gets it up and running",
    "start": "1717810",
    "end": "1724410"
  },
  {
    "text": "and you know once this is done it's done and it's not actually that much more",
    "start": "1724410",
    "end": "1731130"
  },
  {
    "text": "complicated so essentially the same",
    "start": "1731130",
    "end": "1738990"
  },
  {
    "text": "things go through here quick note about variables so all your tokens and your",
    "start": "1738990",
    "end": "1748200"
  },
  {
    "text": "hashes and API keys and everything else that you need to operate as your",
    "start": "1748200",
    "end": "1753210"
  },
  {
    "text": "resource manager or plowshares api or whatever else you're working with I don't care if your repository is private",
    "start": "1753210",
    "end": "1760050"
  },
  {
    "text": "do not check credentials into github at all ever don't do it all right just stop",
    "start": "1760050",
    "end": "1766320"
  },
  {
    "text": "has anyone ever done that on purpose just gone it's fine it's a private repo no one's going to admit to it now mark",
    "start": "1766320",
    "end": "1772650"
  },
  {
    "text": "you've scared the out of them that one guy there he's big all right",
    "start": "1772650",
    "end": "1778620"
  },
  {
    "text": "big guy don't surrender look at him",
    "start": "1778620",
    "end": "1783870"
  },
  {
    "text": "berries of poor puss right so yeah the secure variables are all in ATF VARs",
    "start": "1783870",
    "end": "1790800"
  },
  {
    "text": "file and you just add star dot TF arse to your git ignore and that stops it",
    "start": "1790800",
    "end": "1795990"
  },
  {
    "text": "from ever going in there so I just declare those variables up at the top here and then I've got other variables",
    "start": "1795990",
    "end": "1801750"
  },
  {
    "text": "that I'm declaring and I'm putting defaults in because it's fine people can know that this is running in the North",
    "start": "1801750",
    "end": "1807060"
  },
  {
    "text": "Europe data center they can know I'm running standard d1 v2 s it's all good I'm not scared of those things so my",
    "start": "1807060",
    "end": "1815280"
  },
  {
    "text": "CloudFlare email and token and domain are also across in there as well right",
    "start": "1815280",
    "end": "1821060"
  },
  {
    "text": "so we now have our same sort of thing virtual network subnets bunch of public",
    "start": "1821060",
    "end": "1827520"
  },
  {
    "text": "IP addresses we're creating a load balancer in this one so we need an IP address for the load balancer as well",
    "start": "1827520",
    "end": "1833810"
  },
  {
    "text": "and then we've got back-end address Paul is just this is what you're going to use",
    "start": "1833810",
    "end": "1840540"
  },
  {
    "text": "is your routing system three network interfaces so we've got",
    "start": "1840540",
    "end": "1845879"
  },
  {
    "text": "our manager here which is being set up one way and then we're creating workers and the workers are all identical so we",
    "start": "1845879",
    "end": "1853499"
  },
  {
    "text": "just declare it once and then we tell it how many of those things we want to create for a production system",
    "start": "1853499",
    "end": "1860119"
  },
  {
    "text": "incidentally you would be looking at creating three managers and then as many",
    "start": "1860119",
    "end": "1865499"
  },
  {
    "text": "workers as you need and the workers don't have to be the same you can create different kinds of workers for running",
    "start": "1865499",
    "end": "1870809"
  },
  {
    "text": "different workloads with completely different configurations and then you can tag them and then when you start",
    "start": "1870809",
    "end": "1876989"
  },
  {
    "text": "services you can say to docker swarm I need you to run this only on workers with this tag so if you've got stuff",
    "start": "1876989",
    "end": "1883739"
  },
  {
    "text": "that's doing really complicated compute then you can spin up 36 calls and half a",
    "start": "1883739",
    "end": "1889769"
  },
  {
    "text": "terabyte of RAM and so on and then tell the big compute tasks to run on those",
    "start": "1889769",
    "end": "1895379"
  },
  {
    "text": "but all the website stuff can just run on little d1 v2 s or whatever if you're",
    "start": "1895379",
    "end": "1901200"
  },
  {
    "text": "running D ones by the way stop switch to the v2 s they're cheaper and they're much faster so yeah as your tips so",
    "start": "1901200",
    "end": "1909389"
  },
  {
    "text": "network interface on the workers security group inbound rules we've just got 84 4 3 2 376 for the manager so that",
    "start": "1909389",
    "end": "1920940"
  },
  {
    "text": "we can control it remotely SSH as usual and then similar sort of",
    "start": "1920940",
    "end": "1927599"
  },
  {
    "text": "stuff we've got storage things we're creating an availability set because we're going to put each of these",
    "start": "1927599",
    "end": "1932669"
  },
  {
    "text": "machines into the availability set and then that allows us to have a load",
    "start": "1932669",
    "end": "1937679"
  },
  {
    "text": "balancer that points to all three of them if you don't have an availability set the load balancer will just go no",
    "start": "1937679",
    "end": "1943049"
  },
  {
    "text": "not not talking to that and what the availability set does is it makes sure that each of your machines is in a",
    "start": "1943049",
    "end": "1948809"
  },
  {
    "text": "separate cargo container in the azure data center so if one of them explodes your whole system doesn't come down then",
    "start": "1948809",
    "end": "1956279"
  },
  {
    "text": "we create our manager virtual machine which is pretty much the same as the things before except down at the bottom",
    "start": "1956279",
    "end": "1962999"
  },
  {
    "text": "here we're going to run a generate cert SH which is going to generate do that",
    "start": "1962999",
    "end": "1969839"
  },
  {
    "text": "holes crater certificate and sign it for us and put that into a file then we're",
    "start": "1969839",
    "end": "1975179"
  },
  {
    "text": "going to upload docker config directory up onto the remote machine then we're going to",
    "start": "1975179",
    "end": "1982220"
  },
  {
    "text": "attach to the remote machine using SSH and we're going to run all the security",
    "start": "1982220",
    "end": "1991050"
  },
  {
    "text": "still piping the thing through a shell script create the swarm and then run",
    "start": "1991050",
    "end": "1996900"
  },
  {
    "text": "that configured akhada SSH which is going to secure it and everything else and then on the local machine we're",
    "start": "1996900",
    "end": "2003650"
  },
  {
    "text": "going to run a script called get token de Sh none of these are going to work on Windows by the way so I hope you're all",
    "start": "2003650",
    "end": "2010280"
  },
  {
    "text": "running either Mac or Linux as your as your primary desktop operating system they would be fairly straightforward to",
    "start": "2010280",
    "end": "2017420"
  },
  {
    "text": "convert to CMD files yes yeah I have",
    "start": "2017420",
    "end": "2024380"
  },
  {
    "text": "issues getting bash on Windows to talk to the docker for Windows host for some reason and the bash subsystem for",
    "start": "2024380",
    "end": "2032240"
  },
  {
    "text": "Windows absolute bad words when it when",
    "start": "2032240",
    "end": "2038240"
  },
  {
    "text": "it comes to dock it tries to run docker and it can't run docker because it's not actually Linux underneath and also it's",
    "start": "2038240",
    "end": "2045380"
  },
  {
    "text": "it's it will III actually believe that once they get the whole windows subsystem for Linux and bash on Windows",
    "start": "2045380",
    "end": "2051169"
  },
  {
    "text": "working and I've been to on Windows working I think we'll be able to run docker inside it because the stuff you",
    "start": "2051169",
    "end": "2058730"
  },
  {
    "text": "can already do is just amazing yes funnily enough you can't run the",
    "start": "2058730",
    "end": "2065210"
  },
  {
    "text": "Linux version of.net core on bash on windows or linux on windows yet but",
    "start": "2065210",
    "end": "2070879"
  },
  {
    "text": "again when I get my new laptop in March",
    "start": "2070880",
    "end": "2078230"
  },
  {
    "text": "which is going to be probably in the same Lee powerful kind of four core thing people think I run Linux I tell",
    "start": "2078230",
    "end": "2085580"
  },
  {
    "text": "people I run Linux if they're kind of accusing me of being a hipster because I",
    "start": "2085580",
    "end": "2091158"
  },
  {
    "text": "say oh no it's because the machine is so old and Windows just runs like a dog on it but actually I've been doing it for",
    "start": "2091159",
    "end": "2097340"
  },
  {
    "text": "two years I kind of like it it's it's nice so yeah I am just going to put",
    "start": "2097340",
    "end": "2103850"
  },
  {
    "text": "Linux on whatever I get and then run Windows in a virtual machine for demos so this is creating the workers so",
    "start": "2103850",
    "end": "2111740"
  },
  {
    "text": "what that lost this script here basically sets those things sets the",
    "start": "2111740",
    "end": "2116960"
  },
  {
    "text": "docker host and the docker TLS verify and then gets the token and dumps it into a file on my local machine then",
    "start": "2116960",
    "end": "2123770"
  },
  {
    "text": "when the swarm worker things are being created I can use that token while",
    "start": "2123770",
    "end": "2129050"
  },
  {
    "text": "they're starting up and I can just copy the token up into the temp directory there and then do the config thing and",
    "start": "2129050",
    "end": "2138200"
  },
  {
    "text": "then say docker swarm join and pass the token up as well so this terraform",
    "start": "2138200",
    "end": "2143810"
  },
  {
    "text": "script creates the manager gets the token and then creates the workers and then joins them to the swarm as well so",
    "start": "2143810",
    "end": "2150650"
  },
  {
    "text": "we're the time this thing is finished you have an up and running swarm and then we've got some load balance of stuff down there just saying do HTTP and",
    "start": "2150650",
    "end": "2159740"
  },
  {
    "text": "HTTPS and a probe which is just literally going to say can I attach to",
    "start": "2159740",
    "end": "2165770"
  },
  {
    "text": "this machine using SSH or can I attach to this machine on port 22 and if I can",
    "start": "2165770",
    "end": "2172819"
  },
  {
    "text": "good so if the SSH daemon is running it will consider the Machine healthy you would want a more realistic health check",
    "start": "2172819",
    "end": "2180290"
  },
  {
    "text": "for that in reality and then down at the",
    "start": "2180290",
    "end": "2186140"
  },
  {
    "text": "bottom here we've got a couple of CloudFlare records that we're creating a",
    "start": "2186140",
    "end": "2191240"
  },
  {
    "text": "wild card because CloudFlare will do wildcard DNS records it won't do all the",
    "start": "2191240",
    "end": "2197900"
  },
  {
    "text": "CloudFlare magic on them but it will at least do the dns so anything anything",
    "start": "2197900",
    "end": "2203810"
  },
  {
    "text": "dot spiffy demo com will now get routed to this cluster unless there's a",
    "start": "2203810",
    "end": "2210500"
  },
  {
    "text": "specific record for it and I'm also going to create a record for the root domain which is just to do with let's",
    "start": "2210500",
    "end": "2216050"
  },
  {
    "text": "encrypt if you don't have the root domain on the right IP address for some reason let's encrypt doesn't like it",
    "start": "2216050",
    "end": "2221450"
  },
  {
    "text": "okay so when I have better internet and",
    "start": "2221450",
    "end": "2227750"
  },
  {
    "text": "more confidence and everything I just run both those scripts at this point and they take about ten minutes both of them",
    "start": "2227750",
    "end": "2234800"
  },
  {
    "text": "to complete I have three or four minutes for the first one and then the second one takes between five and ten minutes",
    "start": "2234800",
    "end": "2240440"
  },
  {
    "text": "depending on how was yours feeling that day I wasn't I'm not confident enough of",
    "start": "2240440",
    "end": "2246050"
  },
  {
    "text": "the Internet in the Excel to do that so trust me I ran this and you can run it",
    "start": "2246050",
    "end": "2252650"
  },
  {
    "text": "as well you just download terraform it's a single executable written and go by Hoshi call and you put it on your",
    "start": "2252650",
    "end": "2259250"
  },
  {
    "text": "machine and then you just do terraform plan and it'll show you what it's going to do and terraform apply and it'll show",
    "start": "2259250",
    "end": "2265550"
  },
  {
    "text": "you it'll do it and then tell you what it's done down at the bottom here I'm just getting it to output a couple of",
    "start": "2265550",
    "end": "2272090"
  },
  {
    "text": "the variables that it's generated fqdn is fully qualified domain name so that's",
    "start": "2272090",
    "end": "2277310"
  },
  {
    "text": "going to be spiffy demo cloud app dollars you know spiffy demo dot north europe play on that door zero calm okay",
    "start": "2277310",
    "end": "2286119"
  },
  {
    "text": "so now we've got a cluster running and we can do docker service create and we can run things on it and everything else",
    "start": "2287140",
    "end": "2292880"
  },
  {
    "text": "but we still need a way to get it to serve websites really really easily",
    "start": "2292880",
    "end": "2298600"
  },
  {
    "text": "that's that's kind of the point of this whole thing I just want to be able to create a website and then just run it so",
    "start": "2298600",
    "end": "2305770"
  },
  {
    "text": "we need to serve web and to do that you",
    "start": "2305770",
    "end": "2310820"
  },
  {
    "text": "want some kind of proxy running on this cluster that you can say right I'm going",
    "start": "2310820",
    "end": "2316670"
  },
  {
    "text": "to spin up a service and I want you to just automatically root requests based on the domain name the header record to",
    "start": "2316670",
    "end": "2323540"
  },
  {
    "text": "the relevant service within here there are three sort of major things that",
    "start": "2323540",
    "end": "2330680"
  },
  {
    "text": "people use as proxies and I have almost certainly missed a couple and I have left I is off on purpose nginx is the",
    "start": "2330680",
    "end": "2338359"
  },
  {
    "text": "kind of one that always wins web server slash proxy of the year I love engine X you can script stuff in",
    "start": "2338359",
    "end": "2344090"
  },
  {
    "text": "it with lure you can script stuff in it with JavaScript now and you can run it in docker and all this sort of stuff",
    "start": "2344090",
    "end": "2349520"
  },
  {
    "text": "there's also a che proxy which has similar characteristics nginx is also a",
    "start": "2349520",
    "end": "2355220"
  },
  {
    "text": "web server H a proxy is primarily concerned with with proxies and load",
    "start": "2355220",
    "end": "2360470"
  },
  {
    "text": "balancing and health checking and everything else and then there's traffic which is a new thing that's written in",
    "start": "2360470",
    "end": "2367040"
  },
  {
    "text": "go and it doesn't it's not quite as blazingly fast as nginx but because it's go and you know Engine X is",
    "start": "2367040",
    "end": "2373940"
  },
  {
    "text": "written in really hardcore kernel-level see the traffic does have another a few",
    "start": "2373940",
    "end": "2379130"
  },
  {
    "text": "nice characteristics it has built in support for an awful lot of stuff and it",
    "start": "2379130",
    "end": "2385370"
  },
  {
    "text": "has a gopher dressed as one of the guys at the airport which I kind of like I",
    "start": "2385370",
    "end": "2391900"
  },
  {
    "text": "hate go oh I've never like right go code myself but people do build some nice",
    "start": "2391900",
    "end": "2397100"
  },
  {
    "text": "stuff with it I'll give them that if they put generics in then I'm gone you know I'm there but yeah so what does",
    "start": "2397100",
    "end": "2403730"
  },
  {
    "text": "traffic give us magical docker integration you can literally when you",
    "start": "2403730",
    "end": "2408890"
  },
  {
    "text": "start traffic you can say you're running on a docker swarm and the manager is here and just just watch and when",
    "start": "2408890",
    "end": "2417530"
  },
  {
    "text": "something starts up if I've applied certain labels to the surface then do",
    "start": "2417530",
    "end": "2423170"
  },
  {
    "text": "your thing and traffic just sits there and goes alright I'm waiting yeah it's",
    "start": "2423170",
    "end": "2428990"
  },
  {
    "text": "got let's encrypt built in so you can just say here's my email address please do let's encrypt for all the sites that",
    "start": "2428990",
    "end": "2436430"
  },
  {
    "text": "I run and the performance is acceptable you would have to be hitting like a lot of requests a second before traffic",
    "start": "2436430",
    "end": "2442790"
  },
  {
    "text": "became the bottleneck in your cluster so it's it's perfectly decent much much",
    "start": "2442790",
    "end": "2448820"
  },
  {
    "text": "simpler to get it up and running than it is to get nginx to do what I'm trying to do in this this",
    "start": "2448820",
    "end": "2454850"
  },
  {
    "text": "talk here it's mature and supported enough that it has an official docker",
    "start": "2454850",
    "end": "2460700"
  },
  {
    "text": "library image basically a docker library image is one that doesn't have a name",
    "start": "2460700",
    "end": "2465920"
  },
  {
    "text": "space slash prefix on it so if it's just traffic or registry or nginx or anything",
    "start": "2465920",
    "end": "2473210"
  },
  {
    "text": "like that that means it's official and docker like monitor it and approve it and it has their seal of approval",
    "start": "2473210",
    "end": "2479360"
  },
  {
    "text": "doesn't necessarily mean it works but it means that docker have like checked it",
    "start": "2479360",
    "end": "2486620"
  },
  {
    "text": "over and made sure that it's not malicious and so forth so to deploy traffic we're now going to we've got our",
    "start": "2486620",
    "end": "2495050"
  },
  {
    "text": "environment variable set so our local docker command on our machine here is now controlling our manager in the swab",
    "start": "2495050",
    "end": "2503540"
  },
  {
    "text": "if you've got multiple managers you can connect to any of them it's fine they'll they'll all just communicate and do raft",
    "start": "2503540",
    "end": "2509120"
  },
  {
    "text": "consensus things always an odd number of managers by the way and probably never",
    "start": "2509120",
    "end": "2515000"
  },
  {
    "text": "more than five three is the magic number for all these sort of men docker",
    "start": "2515000",
    "end": "2520820"
  },
  {
    "text": "managers and console and calf care and zookeeper always three once we set those",
    "start": "2520820",
    "end": "2527360"
  },
  {
    "text": "then we can just say docker network create and we're going to create overlay network which is a virtual network with",
    "start": "2527360",
    "end": "2533450"
  },
  {
    "text": "docker puts over the top of whatever the actual network is so that the machines can talk to each other and we're going",
    "start": "2533450",
    "end": "2539150"
  },
  {
    "text": "to call that network traffic I did briefly experiment with pronouncing it",
    "start": "2539150",
    "end": "2545780"
  },
  {
    "text": "with a sort of Afrikaans accent but no I",
    "start": "2545780",
    "end": "2550820"
  },
  {
    "text": "will just get shot something and then",
    "start": "2550820",
    "end": "2558040"
  },
  {
    "text": "before I set up my traffic server like I said the default behavior for the docker",
    "start": "2558040",
    "end": "2566660"
  },
  {
    "text": "is to run on a network socket and for some reason if I point traffic",
    "start": "2566660",
    "end": "2572510"
  },
  {
    "text": "internally at one of the managers it doesn't work and so what I've got here",
    "start": "2572510",
    "end": "2578360"
  },
  {
    "text": "is an image called so cat - docker what's or socket and socket which really",
    "start": "2578360",
    "end": "2587170"
  },
  {
    "text": "attaches to a UNIX socket so one of the file things and proxies everything in",
    "start": "2587170",
    "end": "2592760"
  },
  {
    "text": "and out over a TCP socket and so I'm running that just so that my docker",
    "start": "2592760",
    "end": "2598580"
  },
  {
    "text": "proxy is running internally and is addressable over the overlay network",
    "start": "2598580",
    "end": "2604010"
  },
  {
    "text": "that's the issue with telling traffic to attach directly to the manager is the",
    "start": "2604010",
    "end": "2609710"
  },
  {
    "text": "manager is not running as a service on the cluster it's running the cluster and so things can't talk out of the cluster",
    "start": "2609710",
    "end": "2616430"
  },
  {
    "text": "it's like trying to talk to God you know he might be there but he's not",
    "start": "2616430",
    "end": "2622250"
  },
  {
    "text": "listening so we do that and then we run traffic you only have to do this once",
    "start": "2622250",
    "end": "2628970"
  },
  {
    "text": "and then you get done and it's fine you just bang this in a shell script so docker service great those first five -",
    "start": "2628970",
    "end": "2636350"
  },
  {
    "text": "- our parameters to docker service and we're saying so great service called",
    "start": "2636350",
    "end": "2643560"
  },
  {
    "text": "traffic published these ports so it will listen on all those ports attach it to",
    "start": "2643560",
    "end": "2649920"
  },
  {
    "text": "the traffic network mode global says run an instance of this on every node in the cluster ok so you have options with this",
    "start": "2649920",
    "end": "2657480"
  },
  {
    "text": "you can say I wanted to only run on workers I want it to only run on managers I want at least this many",
    "start": "2657480",
    "end": "2663510"
  },
  {
    "text": "instances of it running but I don't care where they are but I want this one running everywhere so there are as many",
    "start": "2663510",
    "end": "2669750"
  },
  {
    "text": "of it as possible so that's going to go there and then I'm just going to mount a",
    "start": "2669750",
    "end": "2675450"
  },
  {
    "text": "temporary directory on the host machine into the container to store the",
    "start": "2675450",
    "end": "2680550"
  },
  {
    "text": "certificates that I get from let's encrypt ok this is quite an info information rich talk isn't it I've just",
    "start": "2680550",
    "end": "2687900"
  },
  {
    "text": "kind of realized that yeah who would have thought that building your own Azir",
    "start": "2687900",
    "end": "2693720"
  },
  {
    "text": "would be so complicated if Microsoft can do it then sorry mark russinovich can do",
    "start": "2693720",
    "end": "2704670"
  },
  {
    "text": "it and write books at the same time it's just what is that guy does they do seem to have some good people working for",
    "start": "2704670",
    "end": "2711390"
  },
  {
    "text": "them I'll give them that right then traffic traffic : latest is just the current traffic image and then",
    "start": "2711390",
    "end": "2717480"
  },
  {
    "text": "everything underneath that is just arguments to the traffic daemon so we're",
    "start": "2717480",
    "end": "2722760"
  },
  {
    "text": "saying you're running in docker you're running in docker swarm mode because it will support multiple ways of doing this in docker but it's warm mode is the",
    "start": "2722760",
    "end": "2728370"
  },
  {
    "text": "easiest here's your docker endpoint that you need to listen to to find out wind services being created and get",
    "start": "2728370",
    "end": "2734130"
  },
  {
    "text": "information about them here's the base domain for all the things we're running in docker so spiffy demo com",
    "start": "2734130",
    "end": "2740820"
  },
  {
    "text": "we'll look at what that's used for in a minute docker watch says watch docker",
    "start": "2740820",
    "end": "2746910"
  },
  {
    "text": "and when something starts maybe proxy it and then entry points this is one that I",
    "start": "2746910",
    "end": "2753060"
  },
  {
    "text": "really like you look at doing a redirect from like port when something comes in",
    "start": "2753060",
    "end": "2758790"
  },
  {
    "text": "on HTTP doing an automatic redirect to HTTPS so the you always serve the site",
    "start": "2758790",
    "end": "2766230"
  },
  {
    "text": "securely and and Google does good indexing and so forth do that in iis and you're",
    "start": "2766230",
    "end": "2772190"
  },
  {
    "text": "installing URL rewrite modules restarting your iis server and then writing half a dozen lines of",
    "start": "2772190",
    "end": "2777950"
  },
  {
    "text": "impenetrable XML to get the damn thing to work here you just say as a TLS entry",
    "start": "2777950",
    "end": "2785630"
  },
  {
    "text": "point and there's also an HTTP entry point but if anything comes in on that redirect it to HTTPS that single line",
    "start": "2785630",
    "end": "2792770"
  },
  {
    "text": "does your whole redirect thing there the default entry points things can come in",
    "start": "2792770",
    "end": "2798589"
  },
  {
    "text": "on HTTP or HTTPS and then the Acme stuff I don't know why it sacked me but that's",
    "start": "2798589",
    "end": "2804049"
  },
  {
    "text": "let's encrypt does anyone know why it sacked me is it just a roadrunner thing you like Wiley coyote going haha my",
    "start": "2804049",
    "end": "2810859"
  },
  {
    "text": "server is secure they didn't think that through it's because I wasn't in the",
    "start": "2810859",
    "end": "2818180"
  },
  {
    "text": "meeting yes that's just so here's my email again stall certificates in this",
    "start": "2818180",
    "end": "2824119"
  },
  {
    "text": "file here which I've mounted up at the top there and get the certificate the first time a request comes in that's",
    "start": "2824119",
    "end": "2830210"
  },
  {
    "text": "what the Acme dot on demand thing does",
    "start": "2830210",
    "end": "2833710"
  },
  {
    "text": "is it thank you it's apparently it is automatic certificate management",
    "start": "2836109",
    "end": "2841390"
  },
  {
    "text": "environment and nothing to do with roadrunner and Wiley coyote and and",
    "start": "2841390",
    "end": "2848829"
  },
  {
    "text": "catapults that kill you no matter where you stand that is my favorite scene in a",
    "start": "2848829",
    "end": "2854299"
  },
  {
    "text": "cartoon ever way the catapult kills in three different ways I just love that also if you look on YouTube you can now",
    "start": "2854299",
    "end": "2861799"
  },
  {
    "text": "get the video where he catches the roadrunner and eats him which is just really good closure for anyone who grew",
    "start": "2861799",
    "end": "2868369"
  },
  {
    "text": "up in the 1970s it's it's awesome so now we're ready to go now we can just use",
    "start": "2868369",
    "end": "2874490"
  },
  {
    "text": "our pears so I've run both my terraform scripts and I've run my traffic scripts I've got a traffic start SH and there's",
    "start": "2874490",
    "end": "2882950"
  },
  {
    "text": "an le start door SH in the in the github repository that will start the traffic",
    "start": "2882950",
    "end": "2887990"
  },
  {
    "text": "thing for you so now we're ready to use our platform as a service so the publish",
    "start": "2887990",
    "end": "2893569"
  },
  {
    "text": "process to get a service up and running on our new cluster you build the docker",
    "start": "2893569",
    "end": "2899630"
  },
  {
    "text": "image and you push it to your private registry and then you create the service okay and so this is how you publish it you need",
    "start": "2899630",
    "end": "2906830"
  },
  {
    "text": "to login to your registry and then you need to build your your docker image and",
    "start": "2906830",
    "end": "2912860"
  },
  {
    "text": "tag it with the registry name and then push it to the registry and then create",
    "start": "2912860",
    "end": "2918440"
  },
  {
    "text": "the service with this line here and then you will be able to browse to your thing see that's that's a very simple deploy",
    "start": "2918440",
    "end": "2924560"
  },
  {
    "text": "prayer is still too difficult that's that's far too complicated I just want",
    "start": "2924560",
    "end": "2929810"
  },
  {
    "text": "to run it and so I wrote a thing JFR I",
    "start": "2929810",
    "end": "2935680"
  },
  {
    "text": "just run it it's pronounced Jeffrey",
    "start": "2935680",
    "end": "2941800"
  },
  {
    "text": "because it's the thing I'm actually going to support it I I'm gonna you know",
    "start": "2941800",
    "end": "2948590"
  },
  {
    "text": "and so the Jeffrey this Jeffrey repository has got the terraform scripts for spinning up the cluster and it's got",
    "start": "2948590",
    "end": "2954560"
  },
  {
    "text": "the shell script but eventually it's going to actually have kind of Jeffrey",
    "start": "2954560",
    "end": "2960050"
  },
  {
    "text": "create cluster will run the terraform scripts for you and it'll have terraform as a dependency and so forth so yeah so",
    "start": "2960050",
    "end": "2967100"
  },
  {
    "text": "you can get that so I'm going to show you how that works so I'm going to CD",
    "start": "2967100",
    "end": "2973400"
  },
  {
    "text": "dot dot I'm going to make this a bit bigger can everyone see that okay right",
    "start": "2973400",
    "end": "2980750"
  },
  {
    "text": "so I'm going to make a directory I do want to prove that this is working so someone give me a name for my site",
    "start": "2980750",
    "end": "2987160"
  },
  {
    "text": "there's like ND c and o ND SERO drana",
    "start": "2987160",
    "end": "2992420"
  },
  {
    "text": "okay",
    "start": "2992420",
    "end": "2994869"
  },
  {
    "text": "yes we'll be all right with the profanity filters on on CloudFlare so that should be okay right so now I'm",
    "start": "3000840",
    "end": "3006810"
  },
  {
    "text": "going to say dot dot net oh just to prove how absolutely hardcore I really",
    "start": "3006810",
    "end": "3011880"
  },
  {
    "text": "am by the way look at this yeah I am running preview for because because I",
    "start": "3011880",
    "end": "3019050"
  },
  {
    "text": "can I like living on the edge songs they don't net new type web that's going to",
    "start": "3019050",
    "end": "3024780"
  },
  {
    "text": "create me a web application there you go there's my web application I'm gonna save dotnet restore so that I can work",
    "start": "3024780",
    "end": "3030750"
  },
  {
    "text": "with it locally okay I never jumped down to here I'm gonna run code dot to open",
    "start": "3030750",
    "end": "3037920"
  },
  {
    "text": "it up in Visual Studio code okay I'm going to go into my views bit here and",
    "start": "3037920",
    "end": "3043350"
  },
  {
    "text": "my home and my index this is where Microsoft put all their marketing stuff by by marketing stuff we're going to",
    "start": "3043350",
    "end": "3051900"
  },
  {
    "text": "grab these lines out of here instead that's my marketing stuff and we're going to paste that in there we're just",
    "start": "3051900",
    "end": "3059100"
  },
  {
    "text": "going to jump into the home controller no we're not going to jump into the layout and in here not now and in layout",
    "start": "3059100",
    "end": "3072000"
  },
  {
    "text": "here we're going to change MVC app to in DC Road Runner and change down to the",
    "start": "3072000",
    "end": "3079380"
  },
  {
    "text": "bottom there and I'm going to put my",
    "start": "3079380",
    "end": "3086190"
  },
  {
    "text": "name in here okay I'm gonna save that and I'm going to",
    "start": "3086190",
    "end": "3091770"
  },
  {
    "text": "save that and then this is the fun bit",
    "start": "3091770",
    "end": "3096920"
  },
  {
    "text": "okay that's not working",
    "start": "3098420",
    "end": "3102559"
  },
  {
    "text": "there we go JFR I does need a couple of environment variables to be set for it",
    "start": "3110410",
    "end": "3117220"
  },
  {
    "text": "to work so this is building my docker container that's installing all my stuff locally there I've got my own docker",
    "start": "3117220",
    "end": "3124180"
  },
  {
    "text": "base image Rendel lab slash net which includes its pre-installed and cached",
    "start": "3124180",
    "end": "3130840"
  },
  {
    "text": "all of the web libraries and and",
    "start": "3130840",
    "end": "3140740"
  },
  {
    "text": "everything so when I do a dotnet restore in my child image it doesn't have to go",
    "start": "3140740",
    "end": "3146050"
  },
  {
    "text": "to the Internet that's a public image on the docker registry and you're welcome to use that or fork it from my github",
    "start": "3146050",
    "end": "3153160"
  },
  {
    "text": "repository and build it that's running theoretically now I'm gonna go gonna go",
    "start": "3153160",
    "end": "3159610"
  },
  {
    "text": "to the browser and I'm going to go to NDC roadrunner dot spiffy demo comm and",
    "start": "3159610",
    "end": "3165780"
  },
  {
    "text": "this is going to be running place your bets ladies and gentlemen and it's going",
    "start": "3165780",
    "end": "3175330"
  },
  {
    "text": "to redirect me to HTTPS and I'm going to",
    "start": "3175330",
    "end": "3180850"
  },
  {
    "text": "close my eyes",
    "start": "3180850",
    "end": "3183300"
  },
  {
    "text": "it can take it well you know it's hitted because it did the HTTP redirect thing",
    "start": "3189090",
    "end": "3195660"
  },
  {
    "text": "sometimes it takes it a couple of tries to get the certificate back",
    "start": "3195660",
    "end": "3202470"
  },
  {
    "text": "I swear to God this worked just before I",
    "start": "3227960",
    "end": "3236119"
  },
  {
    "text": "walked into this room that's saying it's",
    "start": "3236119",
    "end": "3245510"
  },
  {
    "text": "not private sorry yep okay",
    "start": "3245510",
    "end": "3283089"
  },
  {
    "text": "it's not doing it why won't you do it",
    "start": "3291299",
    "end": "3296489"
  },
  {
    "text": "okay docker service PS NDC oh oh that's",
    "start": "3296489",
    "end": "3306190"
  },
  {
    "text": "interesting",
    "start": "3306190",
    "end": "3308400"
  },
  {
    "text": "well where did you just go",
    "start": "3313530",
    "end": "3317640"
  },
  {
    "text": "that would explain that no no it",
    "start": "3326570",
    "end": "3333690"
  },
  {
    "text": "actually it were it doesn't explain where it's gone let's go over to this one today it's running",
    "start": "3333690",
    "end": "3346460"
  },
  {
    "text": "and it's running okay",
    "start": "3351920",
    "end": "3355690"
  },
  {
    "text": "see that works that's the one I put up literally just before this talk using exactly the same thing that's working",
    "start": "3359970",
    "end": "3365670"
  },
  {
    "text": "fine and this one is not so yeah I",
    "start": "3365670",
    "end": "3377400"
  },
  {
    "text": "always like to finish my my talks with a really abject case of demo fail docker",
    "start": "3377400",
    "end": "3383760"
  },
  {
    "text": "service RM I did yes yeah it's yeah this",
    "start": "3383760",
    "end": "3391050"
  },
  {
    "text": "is exactly what I hear does this is this is entirely right let's try dropping it and recreating it again so we'll just",
    "start": "3391050",
    "end": "3397490"
  },
  {
    "text": "run J Fri again which is going to be a much quicker because nothing's changed",
    "start": "3397490",
    "end": "3402860"
  },
  {
    "text": "I like that yeah Joffrey so that's done",
    "start": "3402860",
    "end": "3416160"
  },
  {
    "text": "that let's give it another try oh that it's different",
    "start": "3416160",
    "end": "3425030"
  },
  {
    "text": "nope I'm going to debug this afterwards",
    "start": "3427430",
    "end": "3432619"
  },
  {
    "text": "I'm just going to try one more thing MV NDC roadrunner in roadrunner",
    "start": "3432619",
    "end": "3444130"
  },
  {
    "text": "run it one more time with the different things if I get more like I was deep",
    "start": "3458809",
    "end": "3464640"
  },
  {
    "text": "debugging this at 2 o'clock on Thursday morning Wednesday morning trying to get",
    "start": "3464640",
    "end": "3470490"
  },
  {
    "text": "it to work and it turned out that let's encrypt was down or something so Roadrunner dots Biffy demo calm",
    "start": "3470490",
    "end": "3480740"
  },
  {
    "text": "nope I'm going to debug this and find out why it doesn't work but it will be there seriously oh the other thing I can",
    "start": "3486530",
    "end": "3497280"
  },
  {
    "text": "do for the time being is I can see the into labs NDC JFR I trap resources",
    "start": "3497280",
    "end": "3507980"
  },
  {
    "text": "traffic and I can do docker service RM",
    "start": "3507980",
    "end": "3513950"
  },
  {
    "text": "traffic and then just do dot slash start this is the version that",
    "start": "3513950",
    "end": "3521540"
  },
  {
    "text": "those were already running sorry",
    "start": "3530670",
    "end": "3539359"
  },
  {
    "text": "that's because I've just taken traffic offline so get rid of it again and then",
    "start": "3539359",
    "end": "3545329"
  },
  {
    "text": "start it again and then just go to http",
    "start": "3545329",
    "end": "3554010"
  },
  {
    "text": ": Roadrunner dot and now I'm getting bad gateway right",
    "start": "3554010",
    "end": "3563808"
  },
  {
    "text": "start those again one minute to go well",
    "start": "3579530",
    "end": "3592430"
  },
  {
    "text": "I blow I'm gonna fix this but I'm not",
    "start": "3592430",
    "end": "3597950"
  },
  {
    "text": "gonna do it now so yes I will get that working and then I will tweet the link to it it's a good job I didn't do the",
    "start": "3597950",
    "end": "3604880"
  },
  {
    "text": "thing where I'm running my slides on this so yeah eventually you're gonna",
    "start": "3604880",
    "end": "3610340"
  },
  {
    "text": "want to sort of automate everything and so look at building things like a build server it's really easy to setup a build",
    "start": "3610340",
    "end": "3617150"
  },
  {
    "text": "server for this because you don't have complicated libraries and everything it's just docker build so you can use any of these to do that if you can",
    "start": "3617150",
    "end": "3624110"
  },
  {
    "text": "figure out Jenkins because the documentation is awful the build steps are literally you have a get web hook",
    "start": "3624110",
    "end": "3629300"
  },
  {
    "text": "you clone it you build it you tag it you push it and then the registry sends another web hook and you have something",
    "start": "3629300",
    "end": "3634820"
  },
  {
    "text": "listening that automatically updates the service in the server that's where you",
    "start": "3634820",
    "end": "3640670"
  },
  {
    "text": "can get the resources the slides are there jeffrey is there I will get this bloody working I'm gonna go outside and",
    "start": "3640670",
    "end": "3646730"
  },
  {
    "text": "I'm gonna do it and it's just gonna work yeah exactly it's that's just that's just what happens so yes but feel free",
    "start": "3646730",
    "end": "3654650"
  },
  {
    "text": "to contact me on rendell Lev's comm I'm doing consulting on all this stuff if",
    "start": "3654650",
    "end": "3660920"
  },
  {
    "text": "you want to do this at your business I'll coming out you get it set up donate core or whatever it is you want to run",
    "start": "3660920",
    "end": "3666070"
  },
  {
    "text": "thanks very much and I hope to see you at the end of the day when I'm doing another talk about what I'm going to be",
    "start": "3666070",
    "end": "3672770"
  },
  {
    "text": "talking about in 10 years time Cheers enjoy the rest of your day [Applause]",
    "start": "3672770",
    "end": "3679349"
  }
]