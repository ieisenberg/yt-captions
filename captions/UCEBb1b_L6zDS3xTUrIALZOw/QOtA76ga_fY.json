[
  {
    "text": " The following content is\nprovided under a Creative Commons license. Your support will help\nMIT OpenCourseWare",
    "start": "0",
    "end": "6060"
  },
  {
    "text": "continue to offer high quality\neducational resources for free. To make a donation or to\nview additional materials",
    "start": "6060",
    "end": "12690"
  },
  {
    "text": "from hundreds of MIT courses,\nvisit MIT OpenCourseWare at ocw.mit.edu. ",
    "start": "12690",
    "end": "26340"
  },
  {
    "text": "PROFESSOR: So today, we're going\nto talk about Kerberos, which is a cryptographically\nsecure, in some ways,",
    "start": "26340",
    "end": "32750"
  },
  {
    "text": "protocol for\nauthenticating computers and applications to one\nanother over the network.",
    "start": "32750",
    "end": "38670"
  },
  {
    "text": "So this is now finally\ngoing to use cryptography whereas last lecture,\nwe looked at just using these TCP sequence\nnumbers to provide security.",
    "start": "38671",
    "end": "46242"
  },
  {
    "text": "So before we dive\ninto the details, I want to mention there's\ntwo bits of administrivia that you might want to know.",
    "start": "46242",
    "end": "51970"
  },
  {
    "text": "There's a quiz review today\n7 to 9 o'clock in some room, I think 32 or 23. It's on schedule page and\nthe quiz is next Wednesday.",
    "start": "51970",
    "end": "59910"
  },
  {
    "text": "And also, we want\nyou guys to post some idea for your\nfinal project on Piazza by tomorrow just so\nthat your classmates can",
    "start": "59910",
    "end": "67800"
  },
  {
    "text": "know what you're thinking\nand help you form groups. All right, so let's talk\nabout Kerberos, all right?",
    "start": "67800",
    "end": "74560"
  },
  {
    "text": "So what is the\nsetting that Kerberos is trying to support, here? So the model for\nKerberos, what these guys",
    "start": "74560",
    "end": "81900"
  },
  {
    "text": "had in mind when\nthey were designing Athena guess 25 or\n30 years ago now, is that they were\nimagining they were",
    "start": "81900",
    "end": "88360"
  },
  {
    "text": "going to have a network\nwith many server machines and many client machines\ninteracting with one another.",
    "start": "88360",
    "end": "93790"
  },
  {
    "text": "So you could imagine, well, you\nhave a file server somewhere out there. You probably have a mail server\nconnected to the network, maybe",
    "start": "93790",
    "end": "101140"
  },
  {
    "text": "other services-- printer. And all these are just connected\nto some sort of a network",
    "start": "101140",
    "end": "110509"
  },
  {
    "text": "rather than being processes\non a single machine. So the prelude to\nAthena and Kerberos",
    "start": "110510",
    "end": "117497"
  },
  {
    "text": "is that you just have a\ntime sharing machine where everything was a single\nprocess and everyone would just log into the same system\nand store their files there.",
    "start": "117497",
    "end": "125760"
  },
  {
    "text": "So these guys wanted a\nmore distributed system. So this meant that you'd have\nthese servers on one side",
    "start": "125760",
    "end": "132360"
  },
  {
    "text": "and you'd also have a\nbunch of workstations that users would\nuse themselves which",
    "start": "132360",
    "end": "138207"
  },
  {
    "text": "would run applications\nand potentially connect to these servers\nand store the user's files, get their mail et cetera.",
    "start": "138207",
    "end": "144560"
  },
  {
    "text": "And the problem that\nthey wanted to solve was how to authenticate\nthe users that are using these workstations\nto all these different servers",
    "start": "144560",
    "end": "151590"
  },
  {
    "text": "in the back end without\nhaving to trust the network to be correct, which seems\nlike a sensible design",
    "start": "151590",
    "end": "156890"
  },
  {
    "text": "requirement in many ways. And I should\nmention that I guess",
    "start": "156890",
    "end": "162890"
  },
  {
    "text": "the alternative to\nKerberos at the time was these R login\ncommands that we're looking at in last lecture,\nwhich seems like a bad plan.",
    "start": "162890",
    "end": "168519"
  },
  {
    "text": "They just use IP addresses\nto authenticate the users. And Kerberos was\nreasonably successful.",
    "start": "168520",
    "end": "174330"
  },
  {
    "text": "It actually still\nis used at MIT. And actually, it's the basis\nof Microsoft's Active Directory server.",
    "start": "174330",
    "end": "179780"
  },
  {
    "text": "So pretty much every Microsoft\nbased sort of Windows Server uses Kerberos in\nsome form or another.",
    "start": "179780",
    "end": "185920"
  },
  {
    "text": "But of course,\nbecause this protocol was designed 25 or 30 years\nago, requirements change.",
    "start": "185921",
    "end": "191720"
  },
  {
    "text": "What people assume change. People now understand\nmuch more about security. So their version of\nKerberos that's in use today",
    "start": "191720",
    "end": "199050"
  },
  {
    "text": "is noticeably\ndifferent in many ways from the version in the paper. And we'll look at exactly what\nassumptions aren't good enough",
    "start": "199050",
    "end": "207520"
  },
  {
    "text": "anymore today and what\ndid they get wrong. It's sort of inevitable\nfor any protocol that was the first protocol to\nreally use cryptography",
    "start": "207520",
    "end": "214650"
  },
  {
    "text": "to authenticate parties over\nthe network in this sort of full system scale.",
    "start": "214650",
    "end": "220810"
  },
  {
    "text": "Anyway, so that's the sort\nof setting for Kerberos. And it might be\ninteresting to figure out what's the trust model, right?",
    "start": "220810",
    "end": "226379"
  },
  {
    "text": "So Kerberos is going to\nintroduce this extra Kerberos server sitting on the side.",
    "start": "226379",
    "end": "231450"
  },
  {
    "text": " So our third model\nat some level is",
    "start": "231450",
    "end": "238040"
  },
  {
    "text": "that the network is\nuntrusted like we were thinking about in last lecture.",
    "start": "238040",
    "end": "243420"
  },
  {
    "text": "But who do we have to trust\nin this Kerberos setting? ",
    "start": "243420",
    "end": "249700"
  },
  {
    "text": "So of course, one thing is\neveryone-- all parties have to trust the Kerberos server.",
    "start": "249700",
    "end": "256229"
  },
  {
    "text": " So that's an assumption\nthese guys were willing to make at the time\nthat this Kerberos server would",
    "start": "256230",
    "end": "262657"
  },
  {
    "text": "be in charge of all\nnetwork authentication in some form or another. Do we have anyone else\nthat has to trust anything",
    "start": "262657",
    "end": "269930"
  },
  {
    "text": "in the setting?  For example, yeah. STUDENT: Well users should\ntrust their own machines.",
    "start": "269930",
    "end": "276304"
  },
  {
    "text": "PROFESSOR: Yes, so that's\na good point, right? There's the users that\nI didn't draw here. But these guys are\nusing some workstation.",
    "start": "276304",
    "end": "283780"
  },
  {
    "text": "And it's actually pretty\nimportant in Kerberos that the user trusts\ntheir workstation.",
    "start": "283780",
    "end": "290199"
  },
  {
    "text": "So what goes wrong if you\ndon't trust your workstation? Or presumably, it can\njust sniff your password and do whatever you type-- you\nknow, LS, it tries-- runs RMX.",
    "start": "290199",
    "end": "299405"
  },
  {
    "text": "That seems kind of unfortunate. Yeah. STUDENT: But it's\nmore than that though, because they could even, like,\nsniff your Kerberos ticket.",
    "start": "299405",
    "end": "307020"
  },
  {
    "text": "PROFESSOR: Yeah, exactly. Or when you log in, you\ntype in your password, which is even worse than the ticket. Yeah, absolutely, yeah.",
    "start": "307020",
    "end": "312240"
  },
  {
    "text": "So this is actually a bit\nof a problem with Kerberos in the sense that if you don't\ntrust the workstation, then",
    "start": "312240",
    "end": "319050"
  },
  {
    "text": "you're in a bit of trouble. So if you have your\nown laptop, this seems like a sensible\nassumption to make.",
    "start": "319050",
    "end": "325030"
  },
  {
    "text": "If you're using a\npublic computer, this is a bit more questionable. And we'll see exactly\nwhat could go wrong.",
    "start": "325030",
    "end": "330860"
  },
  {
    "text": "Yeah. STUDENT: You have to trust the\npeople administrating aren't doing anything bad with\n[INAUDIBLE] servers",
    "start": "330860",
    "end": "337106"
  },
  {
    "text": "and giving them privilege\naccess to one another. STUDENT: So what do you mean? So of course,\nlike, ISNT is going",
    "start": "337106",
    "end": "343220"
  },
  {
    "text": "to run these machines down here. But I think the machines\nthemselves don't necessarily",
    "start": "343220",
    "end": "348300"
  },
  {
    "text": "have to trust one another. So the mail server doesn't trust\nthe print server or the file server necessarily.",
    "start": "348300",
    "end": "354908"
  },
  {
    "text": "STUDENT: Not to\ntrust, but he might be able to access\na server you're not supposed to have access to by\ngoing through another server.",
    "start": "354908",
    "end": "361497"
  },
  {
    "text": "PROFESSOR: Yeah,\nthat's true, I guess. Yeah, so if you set up\nany trust relationship between these guys-- like,\nif you give the mail server",
    "start": "361497",
    "end": "367360"
  },
  {
    "text": "some back end to go access your\nfiles just for convenience, then this could be abused, yeah.",
    "start": "367360",
    "end": "373139"
  },
  {
    "text": "So you have to be careful\nabout not introducing additional sort of levels of\ntrust or trust relations here.",
    "start": "373140",
    "end": "380990"
  },
  {
    "text": "All right, anything\nelse that matters here? Do the servers have\nto trust the users",
    "start": "380990",
    "end": "387090"
  },
  {
    "text": "in any way or the workstations?  No, I guess presumably not.",
    "start": "387090",
    "end": "392900"
  },
  {
    "text": "So this was the whole\ngoal that the server doesn't have to a priori\neven know necessarily",
    "start": "392900",
    "end": "398160"
  },
  {
    "text": "what all these users or\nhow to authenticate them or what this workstation\nis doing until it can",
    "start": "398160",
    "end": "403220"
  },
  {
    "text": "cryptographically prove that\nthis is a legitimate user and they should have access\nto their data or whatnot.",
    "start": "403220",
    "end": "411460"
  },
  {
    "text": "All right, so let's look\nat how does Kerberos work or what's the overall\narchitecture, at least.",
    "start": "411460",
    "end": "417340"
  },
  {
    "text": "So the plan that\nthese guys had in mind is that there would be\nthis Kerberos server.",
    "start": "417340",
    "end": "423500"
  },
  {
    "text": "We have drawn it up\nthere but let's draw it in a slightly bigger scale. So this is the Kerberos server.",
    "start": "423500",
    "end": "430539"
  },
  {
    "text": "And today, it's typically called\nKDC-- Key Distribution Center.",
    "start": "430540",
    "end": "436650"
  },
  {
    "text": "And there's all these users\nout here somewhere and also",
    "start": "436650",
    "end": "442430"
  },
  {
    "text": "services that you might\nwant to connect to. And the plan is that\nthe Kerberos server",
    "start": "442430",
    "end": "450860"
  },
  {
    "text": "is going to be responsible\nfor storing a shared key between the Kerberos server\nand every entity in the world,",
    "start": "450860",
    "end": "459070"
  },
  {
    "text": "or in this realm at least. So if the user has some\nsort of a key KC for client,",
    "start": "459070",
    "end": "465884"
  },
  {
    "text": "than the Kerberos\nserver is going to remember this\nkey somewhere here. And similarly for the\nserver, the key KS",
    "start": "465885",
    "end": "473680"
  },
  {
    "text": "is going to be known\nto the service itself and to the Kerberos server\nbut hopefully no one else.",
    "start": "473680",
    "end": "479300"
  },
  {
    "text": "So you can think of it as like\na generalization of passwords, right? So you know a password\nand the Kerberos server",
    "start": "479300",
    "end": "484440"
  },
  {
    "text": "knows your password\nbut no one else. And this is how you guys are\ngoing to prove to each other, yeah, I'm the right guy.",
    "start": "484440",
    "end": "490130"
  },
  {
    "text": "I know this password\nand no one else does. Makes sense? And the other thing the Kerberos\nserver is going to have to do",
    "start": "490130",
    "end": "497982"
  },
  {
    "text": "is, of course, keep\ntrack of who is it that owns this key, right? So it's going to have this table\nmapping some sort of a name.",
    "start": "497982",
    "end": "507080"
  },
  {
    "text": "So this is some sort of a user. This is maybe service maybe\nAFS or something like this.",
    "start": "507080",
    "end": "515630"
  },
  {
    "text": "And the KDC is responsible for\nstoring the gigantic table-- well, not very large in\nterms of the number of bytes,",
    "start": "515630",
    "end": "521659"
  },
  {
    "text": "necessarily, but\none entry per entity at MIT that the Kerberos\nserver knows about.",
    "start": "521659",
    "end": "530310"
  },
  {
    "text": "Makes sense? All right, and then we're\ngoing to have sort of provide",
    "start": "530310",
    "end": "536634"
  },
  {
    "text": "two interfaces, right? The paper is a little\nfuzzy above this or it pretends like there's\nreally two services.",
    "start": "536634",
    "end": "542200"
  },
  {
    "text": "But really, what's going on\nis that there's two interfaces to the same machine. One of them is called Kerberos\nin the paper and one of them",
    "start": "542200",
    "end": "551560"
  },
  {
    "text": "is called TGS for\nTicket Granting Service. And really, these\nare just two ways",
    "start": "551560",
    "end": "556980"
  },
  {
    "text": "of talking to the same\nthing in the back end. And the protocol is a little\ndifferent for these things.",
    "start": "556980",
    "end": "564340"
  },
  {
    "text": "So initially, when\nthe user logs in, they're going to talk\nto this guy over here. And they're going to\nsend their client name,",
    "start": "564340",
    "end": "572110"
  },
  {
    "text": "C. So this might be\nyour Athena username. And the server is\ngoing to respond to back with a ticket,\na TGS or-- well,",
    "start": "572110",
    "end": "583804"
  },
  {
    "text": "some sort of a ticket. We'll look at the\ndetails in a bit. And then when you want to\ntalk to some server down here,",
    "start": "583804",
    "end": "591130"
  },
  {
    "text": "KS, then you're going to\ntalk to this TGS first and say, oh, hey,\nI already logged in",
    "start": "591130",
    "end": "596529"
  },
  {
    "text": "through the Kerberos interface. Now, I want to talk\nto the server S. So you'd tell the TGS about\nthe server you want to talk to.",
    "start": "596530",
    "end": "603560"
  },
  {
    "text": "And then it returns you\nback some sort of a ticket for talking to the server\nS. And then you can finally",
    "start": "603560",
    "end": "612780"
  },
  {
    "text": "start talking to\nthe server over here by initially passing\nit this ticket for S.",
    "start": "612780",
    "end": "622230"
  },
  {
    "text": "Does this all make sense? This is the sort\nof high level plan.",
    "start": "622230",
    "end": "627269"
  },
  {
    "text": "So why do these guys\nhave two interfaces? ",
    "start": "627270",
    "end": "632967"
  },
  {
    "text": "Well, I guess I\nwanted to actually ask a bunch of questions. Like, in the case of a\nservice, this service",
    "start": "632967",
    "end": "638080"
  },
  {
    "text": "is probably going to\nbe stored on disk. What's going on with\nthis KC on the user side? Where does KC come\nfrom in Kerberos?",
    "start": "638080",
    "end": "646240"
  },
  {
    "text": "Yeah. STUDENT: KDMS\n[INAUDIBLE] the database. PROFESSOR: Yeah, well,\nthe key C sits here.",
    "start": "646240",
    "end": "652735"
  },
  {
    "text": "And that's absolutely true. It's sits on this\ngiant database. But it also has to\nbe known to the user because the user has to\nprove that they are the user.",
    "start": "652736",
    "end": "659610"
  },
  {
    "text": "Yeah. STUDENT: Is that a one way\nfunction and then the password? PROFESSOR: Yeah,\nso they actually have this sort of cute plan\nwhere the KC is actually",
    "start": "659610",
    "end": "665930"
  },
  {
    "text": "going to be derived by\nhashing the user's password or really some sort of\nkey duration function.",
    "start": "665930",
    "end": "671319"
  },
  {
    "text": "And there's several different\nones of perverse uses. But you're basically\ngoing to take a password,",
    "start": "671320",
    "end": "676360"
  },
  {
    "text": "transform it in some\nway, and get this key KC. All right, so that seems good.",
    "start": "676360",
    "end": "685180"
  },
  {
    "text": "Why do we need two\nprotocols, right? You could imagine that you just\nalways ask the Kerberos server",
    "start": "685180",
    "end": "692020"
  },
  {
    "text": "for tickets directly this way. You say, well, hey,\nI want a ticket for this particular\nprinciple name. And it'll send you back a\nticket and you can decrypt it",
    "start": "692020",
    "end": "699070"
  },
  {
    "text": "with your KC afterwards. Yeah. STUDENT: Can you\n[INAUDIBLE] or ask the user",
    "start": "699070",
    "end": "704861"
  },
  {
    "text": "to reenter their\npassword each time they want to [INAUDIBLE] service? PROFESSOR: Right, so the\nreason for the difference between these two interfaces\nis that on this interface,",
    "start": "704861",
    "end": "712440"
  },
  {
    "text": "all the responses come back\nencrypted with your key KC. And the Kerberos designers\nare a little worried",
    "start": "712440",
    "end": "719500"
  },
  {
    "text": "about keeping this KC\naround for a long time. Because either you have to\nask the user to enter it,",
    "start": "719500",
    "end": "725260"
  },
  {
    "text": "which is just\nannoying for the user, or it sits around in memory. And this is basically as\ngood as the user's password.",
    "start": "725260",
    "end": "732400"
  },
  {
    "text": "So if this gets disclosed,\nthen someone with access to KC",
    "start": "732400",
    "end": "737730"
  },
  {
    "text": "can keep accessing the user's\nfiles until the user maybe changes their password and\npotentially even longer.",
    "start": "737730",
    "end": "742800"
  },
  {
    "text": "We'll see about that. So this KC is a really\ndangerous thing to leak.",
    "start": "742800",
    "end": "748570"
  },
  {
    "text": "So the whole point of using\nthis interface first and using this interface later for\nall subsequent requests",
    "start": "748570",
    "end": "754270"
  },
  {
    "text": "is that you can\nactually forget KC as soon as you decrypt this\nTGS response from the Kerberos",
    "start": "754270",
    "end": "760430"
  },
  {
    "text": "interface. And from that point on,\neven if you leak it, there is a lifetime\nassociated with this ticket.",
    "start": "760430",
    "end": "766993"
  },
  {
    "text": "So worst case,\nsomeone gets access to your account for\na couple of hours, not for an unbounded\namount of time.",
    "start": "766994",
    "end": "773358"
  },
  {
    "text": "So that's the sort\nof main difference why you guys have this slightly\nmore complicated picture",
    "start": "773359",
    "end": "779020"
  },
  {
    "text": "with two ways of\naccessing the same thing. All right, so before we dive\ninto the mechanics of how",
    "start": "779020",
    "end": "786360"
  },
  {
    "text": "these protocols actually\nlook like on the wire, let's talk a little bit about\nthis naming aspect in Kerberos,",
    "start": "786360",
    "end": "793060"
  },
  {
    "text": "right? So at some level, you\ncould think of Kerberos as being a name registry, right?",
    "start": "793060",
    "end": "798529"
  },
  {
    "text": "So it's really\nresponsible for mapping these cryptographic\nkeys onto string names.",
    "start": "798530",
    "end": "804089"
  },
  {
    "text": "And this is the fundamental\nsort of operation that Kerberos needs to provide. In fact, you'll see in the\nnext lecture even on the web,",
    "start": "804090",
    "end": "811467"
  },
  {
    "text": "we need some function like this. It's implemented\ndifferently from Kerberos but this is a fundamentally\nvery important thing",
    "start": "811467",
    "end": "816570"
  },
  {
    "text": "to have in almost any\ndistributed system for security. So let's look at how Kerberos\nactually deals with names.",
    "start": "816570",
    "end": "825080"
  },
  {
    "text": "So in Kerberos,\nthe sort of system calls every entity in\nthis database a principal",
    "start": "825080",
    "end": "833560"
  },
  {
    "text": "And a principal in Kerberos is\nactually just a string, right? So you can actually have some\nprincipal like, I don't know,",
    "start": "833560",
    "end": "839779"
  },
  {
    "text": "nickolei. So that's a string. And that could be a principal\nin some Kerberos realm.",
    "start": "839780",
    "end": "845170"
  },
  {
    "text": "So it would literally\nbe the thing that sits in this left\ncolumn of the KDC's table.",
    "start": "845170",
    "end": "852000"
  },
  {
    "text": "And there's also\nsome extra instances that the protocl supports.",
    "start": "852000",
    "end": "857090"
  },
  {
    "text": "I could say, you know,\nnikolai.extra secure or something.",
    "start": "857090",
    "end": "862740"
  },
  {
    "text": "And I might use this\nas a different entity for machines I\nreally care about.",
    "start": "862740",
    "end": "867960"
  },
  {
    "text": "So maybe I will have\na different password for really secure things\nand a different password for my regular account.",
    "start": "867960",
    "end": "874120"
  },
  {
    "text": "So this is just sort\nof how Kerberos-- this is what the paper\ntalks about with instances.",
    "start": "874120",
    "end": "880690"
  },
  {
    "text": "So one might actually\nwonder-- where do you actually see instances? Where do influences come from? So the Kerberos service\nmaps names to keys for you,",
    "start": "880690",
    "end": "889930"
  },
  {
    "text": "but how do you know\nwhich name to ask for or which name to expect when\nyou are talking to some machine?",
    "start": "889930",
    "end": "896600"
  },
  {
    "text": "So I guess what I'm asking is,\nwhat are names appear outside of the Kerberos machine.",
    "start": "896600",
    "end": "903050"
  },
  {
    "text": "So I guess we could ask, OK,\nwhere do user names appear? Any ideas? Yeah.",
    "start": "903050",
    "end": "908200"
  },
  {
    "text": "STUDENT: You can ask the\nMIT server for usernames presumably. PROFESSOR: Right, yeah. So you could enumerate\nthese things.",
    "start": "908200",
    "end": "913900"
  },
  {
    "text": "Also, the users just\ntype them in when they log into a machine. So that's where it\ninitially comes from. Do usernames appear\nanywhere else?",
    "start": "913900",
    "end": "921019"
  },
  {
    "text": "Should they appear\nanywhere else? Yeah. STUDENT: Possibly\naccess the [INAUDIBLE]",
    "start": "921020",
    "end": "926084"
  },
  {
    "text": "lists on the various services. PROFESSOR: Yes, that's actually\nan important point, right? The goal of Kerberos is\njust to map keys to names.",
    "start": "926084",
    "end": "933850"
  },
  {
    "text": "But it doesn't tell you what\nthat name should have access to. In fact, the way the\napplications typically",
    "start": "933850",
    "end": "938950"
  },
  {
    "text": "use Kerberos is that\none of these servers uses Kerberos to figure out,\nOK, what string name am I",
    "start": "938950",
    "end": "945730"
  },
  {
    "text": "talking to? So when the mail server\ngets a connection from some workstation and it\nget the Kerberos ticket that",
    "start": "945730",
    "end": "950920"
  },
  {
    "text": "prove that maybe this\nuser is called Nikolai, then the mail server\ninternally now",
    "start": "950920",
    "end": "956110"
  },
  {
    "text": "has to figure out,\nOK, well, what should that guy have access to? And same for a file server. So inside of all\nthese servers, there's",
    "start": "956110",
    "end": "963150"
  },
  {
    "text": "probably things like access\ncontrol lists, maybe groups, maybe other things that actually\ndo the authorization step.",
    "start": "963150",
    "end": "971770"
  },
  {
    "text": "So Kerberos provides\nauthentication which tells you who is\nthis person I'm talking to.",
    "start": "971770",
    "end": "977690"
  },
  {
    "text": "And the service itself is\nresponsible for implementing the authorization part where\nthey decide what access",
    "start": "977690",
    "end": "983870"
  },
  {
    "text": "you should have based\non your username here. Makes sense?",
    "start": "983870",
    "end": "990440"
  },
  {
    "text": "All right, so that's where\nthe user names appear. There's also other\nprincipal names the Kerberos supports\nfor services, right?",
    "start": "990440",
    "end": "997399"
  },
  {
    "text": "So services, I guess\nthe paper suggests, look something like this. That's rcmd.hostname. ",
    "start": "997400",
    "end": "1007910"
  },
  {
    "text": "And the reason that you need a\nname for one of these services",
    "start": "1007910",
    "end": "1013589"
  },
  {
    "text": "is that you want to\nknow, for example, when I connect to a file\nserver, I actually",
    "start": "1013589",
    "end": "1018980"
  },
  {
    "text": "want mutual authentication. It's not just the final\nserver learns who I am,",
    "start": "1018980",
    "end": "1024160"
  },
  {
    "text": "but I, the user or\nthe workstation, want to be convinced that\nI'm talking to the right file server and not some\nfake file server that's",
    "start": "1024160",
    "end": "1030599"
  },
  {
    "text": "impersonating my files. Because maybe I'll\nlook at the grades file and submit it\nto the registrar.",
    "start": "1030599",
    "end": "1035689"
  },
  {
    "text": "It would be too bad\nif some file server can impersonate the response and\ngive me the wrong grades file",
    "start": "1035690",
    "end": "1041319"
  },
  {
    "text": "all of a sudden. So this is why the\nservice principles also need their own name and the\nworkstations need to figure out",
    "start": "1041319",
    "end": "1049770"
  },
  {
    "text": "what name should I expect to see\nwhen I connect to the service. And typically, this comes\nfrom the user at some level.",
    "start": "1049770",
    "end": "1056500"
  },
  {
    "text": "So for example, if I type\nSSH some machine foo, then this means that\nI should be expecting",
    "start": "1056500",
    "end": "1064150"
  },
  {
    "text": "a Kerberos principal\ncalled rcmd.foo on the other end\nof this connection. And if it turns out\nto be someone else,",
    "start": "1064150",
    "end": "1071210"
  },
  {
    "text": "this SSH client\nshould abort and not let me connect because then\nI will be misled into talking to some other machine.",
    "start": "1071210",
    "end": "1077936"
  },
  {
    "text": "That make sense? So here's one\ninteresting question. When can we reuse\nnames in Kerberos?",
    "start": "1077936",
    "end": "1084365"
  },
  {
    "text": "It's like, all of you\nguys have Athena accounts. And when you\ngraduate, could MIT, like, wipe out\nyour database entry",
    "start": "1084365",
    "end": "1091480"
  },
  {
    "text": "and allow someone else to\nregister that same username? Would that be a good idea?",
    "start": "1091480",
    "end": "1096600"
  },
  {
    "text": "Well, aside from the fact\nthat you guys want accounts. Yeah. STUDENT: Updated services\nas well so that they would,",
    "start": "1096600",
    "end": "1103205"
  },
  {
    "text": "like map that username\nto [INAUDIBLE] permission theoretically? PROFESSOR: Yeah, because\nthese guys are actually",
    "start": "1103205",
    "end": "1108470"
  },
  {
    "text": "just string entries somewhere\nin some ACL on a file server on a mail server.",
    "start": "1108470",
    "end": "1113950"
  },
  {
    "text": "And just because you wipe out\nthis entry in the Kerberos database doesn't mean\nthat this entry is gone.",
    "start": "1113950",
    "end": "1120075"
  },
  {
    "text": "And they're not versioning\nin any way, right? This entry could\nliterally say, you know, Alice has access to\nsome Athena locker.",
    "start": "1120075",
    "end": "1127270"
  },
  {
    "text": "And if this Alice graduates\nand her entry gets removed, then some new Alice\ncomes along, registers,",
    "start": "1127270",
    "end": "1132790"
  },
  {
    "text": "in the Kerberos database. But she gets a\nprincipal that looks identical to the old Alice.",
    "start": "1132790",
    "end": "1137894"
  },
  {
    "text": "It's the same string. So all of a sudden,\nthe file server will give access to the new\nAlice to old Alice's data.",
    "start": "1137895",
    "end": "1144740"
  },
  {
    "text": "So there's a bit of\na complicated process for reclaiming principal\nnames in Kerberos because there's\nno real connection",
    "start": "1144740",
    "end": "1151160"
  },
  {
    "text": "or versioning\nbetween these guys. So as a result, it's\nactually kind of hard to reuse principal names.",
    "start": "1151160",
    "end": "1156749"
  },
  {
    "text": "Once you register a\nprincipal, you probably don't want to reuse\nit very often.",
    "start": "1156749",
    "end": "1162160"
  },
  {
    "text": "And same for, in some\nsense, these principal names for service as well. As long as this hostname\nremain some well-known service",
    "start": "1162160",
    "end": "1170910"
  },
  {
    "text": "that people expect to\nfunction in a certain way, you probably don't want\nto get rid of its key even if the service goes on.",
    "start": "1170910",
    "end": "1175940"
  },
  {
    "text": "Because maybe a year later,\nsome guy tries to connect to it and expects certain things. And if it's been reused\nfor a different service,",
    "start": "1175940",
    "end": "1181580"
  },
  {
    "text": "that guy can impersonate things. Probably not as dramatic\nor as bad, but still,",
    "start": "1181580",
    "end": "1187620"
  },
  {
    "text": "you have to be careful with\nreusing principal names in this kind of protocol.",
    "start": "1187620",
    "end": "1192910"
  },
  {
    "text": "Makes sense? Any questions? All right, so let's look at how\nthe protocol itself now works.",
    "start": "1192910",
    "end": "1199590"
  },
  {
    "text": "So we'll look first and\nthis step of the protocol where you initially get your\nticket with your password.",
    "start": "1199590",
    "end": "1206160"
  },
  {
    "text": "And then we'll look at how\nthis TGS interface works and how it differs\nthen a little bit.",
    "start": "1206160",
    "end": "1212660"
  },
  {
    "text": "All right, so I guess\nthere's this main data structure that Kerberos\nuses called a ticket.",
    "start": "1212660",
    "end": "1217790"
  },
  {
    "text": "And this ticket looks like this. So there's a ticket to\nbetween a client and a server.",
    "start": "1217790",
    "end": "1225270"
  },
  {
    "text": "And this guy is\nbasically the names of the server and\nthe client that we're",
    "start": "1225270",
    "end": "1230550"
  },
  {
    "text": "talking about-- the IP\naddress of the client,",
    "start": "1230550",
    "end": "1236190"
  },
  {
    "text": "some kind of timestamp, and an\nexpiration time for how long",
    "start": "1236190",
    "end": "1243049"
  },
  {
    "text": "the stick is valid. And there's also\na key, KCS, that's",
    "start": "1243050",
    "end": "1248400"
  },
  {
    "text": "going to be shared between\nthe client and the server. So that's what's in a ticket.",
    "start": "1248400",
    "end": "1253790"
  },
  {
    "text": "And there's also this\nother weird data structure that Kerberos introduces\ncalled an authenticator.",
    "start": "1253790",
    "end": "1259380"
  },
  {
    "text": "And an authenticator goes\nwith a particular client C. And this thing is just\nthe client's name,",
    "start": "1259380",
    "end": "1266529"
  },
  {
    "text": "the IP address of the\nclient, and the time stamp",
    "start": "1266530",
    "end": "1271640"
  },
  {
    "text": "when the client generated\nthis authenticator. And typically, both of\nthese things are encrypted.",
    "start": "1271640",
    "end": "1278270"
  },
  {
    "text": "And authenticator is\ntypically scripted with the key between the\nclient on the server.",
    "start": "1278270",
    "end": "1283760"
  },
  {
    "text": "So the authenticator\nsort of has to do with a particular connection\nbetween a client and a server.",
    "start": "1283760",
    "end": "1289110"
  },
  {
    "text": "And the Kerberos\nticket itself here is typically encrypted with\nthe key for the service KS.",
    "start": "1289110",
    "end": "1298140"
  },
  {
    "text": "So the subscript\nnotation denotes here encryption with\na particular key.",
    "start": "1298140",
    "end": "1305050"
  },
  {
    "text": "All right, so what does this--\nso using this sort of notation here, let's try to figure\nout what is the protocol.",
    "start": "1305050",
    "end": "1310669"
  },
  {
    "text": "By which the user initially\nlogs into this Kerberos and gets their TGS ticket.",
    "start": "1310670",
    "end": "1316010"
  },
  {
    "text": "So as we saw here\nbefore, right, the plan is the client is going to\nsend their username over",
    "start": "1316010",
    "end": "1326030"
  },
  {
    "text": "to the Kerberos server\nor that interface. And the response is\ngoing to be a ticket.",
    "start": "1326030",
    "end": "1332140"
  },
  {
    "text": "And what precisely\nthe client actually sends over-- both the username\nC of the client that's",
    "start": "1332140",
    "end": "1337710"
  },
  {
    "text": "issuing the request as well\nas the principal name-- well, the client is also\na principal name.",
    "start": "1337710",
    "end": "1343760"
  },
  {
    "text": "But the client also\nsends the principal name of the service for which it\nwould like to get a ticket.",
    "start": "1343760",
    "end": "1349720"
  },
  {
    "text": "And typically, the service name\nis actually the service name of this TGS guy over here. So you get a ticket for them.",
    "start": "1349720",
    "end": "1356149"
  },
  {
    "text": "But you could get a ticket\nfor almost any service you want in this way. And their response\nis going to be",
    "start": "1356150",
    "end": "1362429"
  },
  {
    "text": "this sort of interesting tuple. It's going to be your\nticket between the client and the server encrypted\njust with that key KS",
    "start": "1362430",
    "end": "1370930"
  },
  {
    "text": "as shown above. I guess we should\nwrite that down with KS",
    "start": "1370930",
    "end": "1376170"
  },
  {
    "text": "And also, you get to\nthis shared key-- key CS. And this whole thing\nis encrypted with KC.",
    "start": "1376170",
    "end": "1386180"
  },
  {
    "text": "So that's the wire protocol. So I guess let's try to\nfigure out a couple things.",
    "start": "1386180",
    "end": "1391190"
  },
  {
    "text": "So first of all, how\ndoes the Kerberos server",
    "start": "1391190",
    "end": "1397769"
  },
  {
    "text": "authenticate the client here? How does it know that this\nis the right user making this request? ",
    "start": "1397770",
    "end": "1404395"
  },
  {
    "text": "Yeah. STUDENT: It can make\nsure that the ticket that it sent because it has KC. PROFESSOR: Yes, I think\nthat's what's going on",
    "start": "1404395",
    "end": "1411020"
  },
  {
    "text": "is that the Kerberos server\nagain on some level actually doesn't know whether this\nis the right client or not. But it thinks oh, well,\nsure, it doesn't matter",
    "start": "1411020",
    "end": "1417500"
  },
  {
    "text": "who is making this request. I'll just send this blob\nout and the only person who should be able to\nmake any use of this blob",
    "start": "1417500",
    "end": "1424010"
  },
  {
    "text": "is the person that knows\nthis key KC over here. So that's actually kind\nof cool because the client",
    "start": "1424010",
    "end": "1430432"
  },
  {
    "text": "doesn't have to\nsend their password over the network at all. So in some ways, this is\nactually better than the client",
    "start": "1430432",
    "end": "1436650"
  },
  {
    "text": "sending a password to\nthe Kerberos server because even if the\nKerberos server here",
    "start": "1436650",
    "end": "1441710"
  },
  {
    "text": "was listening for\nthese passwords and trying to record them, it\nwould never get your password. Or maybe if someone was\nimpersonating the Kerberos",
    "start": "1441710",
    "end": "1448899"
  },
  {
    "text": "server, they wouldn't get\na copy of your password. All right, yeah.",
    "start": "1448900",
    "end": "1454090"
  },
  {
    "text": "STUDENT: [INAUDIBLE]\nadversary wants to [INAUDIBLE] your password offline without--",
    "start": "1454090",
    "end": "1460200"
  },
  {
    "text": "PROFESSOR: Yeah, so this is\nactually not a great aspect of Kerberos, in fact, right? So does everyone see\nwhat the problem is?",
    "start": "1460200",
    "end": "1466030"
  },
  {
    "text": "The problem is that the\nway the client could tell if they got the\nright password or not or the workstation tells\nif the client supplied",
    "start": "1466030",
    "end": "1472520"
  },
  {
    "text": "the right password is they\ntry to decrypt this ticket and they see if it works or not.",
    "start": "1472520",
    "end": "1477759"
  },
  {
    "text": "And decryption is fairly cheap. This is symmetric\nencryption and you can do probably\nmillions of decryptions",
    "start": "1477760",
    "end": "1485059"
  },
  {
    "text": "a second if you try\nhard on modern machines. And this means that\nyou can try millions",
    "start": "1485060",
    "end": "1492299"
  },
  {
    "text": "of potential\npasswords per second to guess what the\nperson's password is. And you could do this\nfor any person at all.",
    "start": "1492300",
    "end": "1498330"
  },
  {
    "text": "You could just send\ntheir principal to the Kerberos server. It'll very happily give you\nback this response encrypted",
    "start": "1498330",
    "end": "1503998"
  },
  {
    "text": "with the user's password. Then you can just try different\npasswords and just see what works or what doesn't. Yeah.",
    "start": "1503999",
    "end": "1509798"
  },
  {
    "text": "STUDENT: But won't the\ncontent [INAUDIBLE] decrypted [INAUDIBLE] advantage? How can we be sure\nthat you directly--",
    "start": "1509798",
    "end": "1516752"
  },
  {
    "text": "PROFESSOR: Yes, this is actually\nanother interesting aspect where the Kerberos 4\ndevelopers didn't quite realize that the time they were\nbuilding this that they really",
    "start": "1516752",
    "end": "1524299"
  },
  {
    "text": "should have been very careful\nabout separating encryption from authentication. So in the paper, there's\nthis implicit assumption",
    "start": "1524300",
    "end": "1533150"
  },
  {
    "text": "that-- hopefully, that's not us. All right, sorry. So in the paper, there's\nthis implicit assumption",
    "start": "1533150",
    "end": "1540191"
  },
  {
    "text": "that whenever you\nencrypt a piece of data and you send it to someone\nelse, if that person can decrypt",
    "start": "1540191",
    "end": "1546210"
  },
  {
    "text": "the data and it\nsort of looks OK, then no, they must have\ngotten the right key and the data wasn't\ntampered with in flight.",
    "start": "1546210",
    "end": "1552520"
  },
  {
    "text": "But it seems like a\ntotally bad plan now that we think of\nit 30 years later. But at the time,\nit wasn't so clear.",
    "start": "1552520",
    "end": "1558230"
  },
  {
    "text": "So in order to do\nKerberos right, and in fact, what\nKerberos 5 does now, is they both encrypt\nall the pieces of data",
    "start": "1558230",
    "end": "1564277"
  },
  {
    "text": "and they also\nauthenticate the message by basically computing\na hash with a key.",
    "start": "1564277",
    "end": "1569350"
  },
  {
    "text": "And then the result\nactually tells you that, oh, that piece of data\njust wasn't tampered with. It was correctly signed\nwith this key, et cetera.",
    "start": "1569350",
    "end": "1576388"
  },
  {
    "text": "And what actually\nhappens in Kerberos version 4 is there\nare some extra bits in this thing that was\nencrypted that should all",
    "start": "1576389",
    "end": "1583110"
  },
  {
    "text": "be some pattern like zeros. And typically, if you\nget the key wrong,",
    "start": "1583110",
    "end": "1588150"
  },
  {
    "text": "that pattern will not look\nlike all zeros just by chance. It's not cryptographically\nguaranteed to be that.",
    "start": "1588150",
    "end": "1594210"
  },
  {
    "text": "But most times, it will\nnot look like zeros and you will be able to decide\nwhether you got the correct key",
    "start": "1594210",
    "end": "1600029"
  },
  {
    "text": "or not. All right, so that's\nsort of the plan",
    "start": "1600030",
    "end": "1605400"
  },
  {
    "text": "for how the clients\ntells, I guess, whether the ticket is valid. They just try to decrypt\nit and see how it works.",
    "start": "1605400",
    "end": "1612384"
  },
  {
    "text": "So another interesting\nquestion is why is this key\nKCS included twice in the ticket in\nsome form, right?",
    "start": "1612384",
    "end": "1618630"
  },
  {
    "text": "So it's included once here\nand another time actually sort of implicitly in\nthis ticket T. Why",
    "start": "1618630",
    "end": "1626060"
  },
  {
    "text": "do we have two copies\nof the same key KCS? Yeah. STUDENT: The client\ncan't decrypt that ticket",
    "start": "1626060",
    "end": "1632658"
  },
  {
    "text": "because it's encrypted\nwith a service key. PROFESSOR: Yeah, so it's\nactually kind of cute, right? Like, there's this key\nthat the client can get to.",
    "start": "1632658",
    "end": "1639067"
  },
  {
    "text": "But then there's another\ncopy of it in here. It's encrypted with KS. And the reason for this is that\nthe Kerberos server is actually",
    "start": "1639067",
    "end": "1647400"
  },
  {
    "text": "trying to set up the\nclient and this other guy to talk to each other securely. So the Kerberos generates\nthis hopefully random key KCS",
    "start": "1647400",
    "end": "1655650"
  },
  {
    "text": "and wants to give one copy\nto the client and one copy to the write other server\nthat you want to talk to. And one thing you could\nimagine doing naively",
    "start": "1655650",
    "end": "1662840"
  },
  {
    "text": "is maybe the Kerberos will\njust go and say, hey service, this guy wants to talk to you. Here's the key for it. But that would be\nkind of unfortunate.",
    "start": "1662840",
    "end": "1669349"
  },
  {
    "text": "You'd have to have the Kerberos\nserver call back to the service and so on. So instead, these guys have\nthis nice trick where they just",
    "start": "1669349",
    "end": "1676610"
  },
  {
    "text": "to give the client does\nblob that the client can't actually do\nanything with other than give to the right service.",
    "start": "1676610",
    "end": "1682289"
  },
  {
    "text": "And if the service\nhas the right key KS, they'll decrypt it and say, aha. Well, here's the key I should be\nusing to speak to this client.",
    "start": "1682290",
    "end": "1690420"
  },
  {
    "text": "And that's how these two guys,\nthe client and the service, are going to establish a\nshared key for protecting",
    "start": "1690420",
    "end": "1696320"
  },
  {
    "text": "their communication. Yeah. STUDENT: So what exactly is TGS? PROFESSOR: So TGS\nis-- OK, so there's",
    "start": "1696320",
    "end": "1704160"
  },
  {
    "text": "sort of two sides to it. From the client's point of\nview, it's just another service that you can get a ticket for.",
    "start": "1704160",
    "end": "1710290"
  },
  {
    "text": "And the kinds of\noperations it supports is getting more tickets. It's a Ticket Granting Service. STUDENT: Sorry, I meant what\nis the ticket called TGS.",
    "start": "1710290",
    "end": "1717310"
  },
  {
    "text": "PROFESSOR: Oh, yeah, sorry. This TGS is just shorthand\nfor this whole blob except where S is actually\nthe principal name of this TGS",
    "start": "1717310",
    "end": "1725565"
  },
  {
    "text": "service.  So you can think of it as\nlike, well, there's a Kerberos",
    "start": "1725565",
    "end": "1730860"
  },
  {
    "text": "server, there's this\nTGS service out there, and then there's the real\nthing I want to get to. So you first ask\nthis guy to give me",
    "start": "1730860",
    "end": "1736169"
  },
  {
    "text": "a ticket for some service. You could ask it to give you\ndirectly a ticket for the file server.",
    "start": "1736170",
    "end": "1741550"
  },
  {
    "text": "And this would work. But you'd need your\nKC to decrypt it and then you'd need your\nKC around all the time. So instead, what\nyou do is you get",
    "start": "1741550",
    "end": "1747460"
  },
  {
    "text": "a ticket for this special\nservice over here. It looks just like a service\nexcept that it happens",
    "start": "1747460",
    "end": "1752720"
  },
  {
    "text": "to be provided by the same box. And then this guy will\nhappily give you more tickets",
    "start": "1752720",
    "end": "1758310"
  },
  {
    "text": "later without having to\npresent your initial KC again. Makes sense?",
    "start": "1758310",
    "end": "1764143"
  },
  {
    "text": "All right, other questions? Yeah. STUDENT: So [INAUDIBLE] the idea\nis once you get the TGS ticket,",
    "start": "1764143",
    "end": "1772481"
  },
  {
    "text": "you can just get rid of your KC? PROFESSOR: Yes,\nso that's actually the cool thing about\nit is that once you get this ticket-- well, this\nticket with the S being TGS,",
    "start": "1772482",
    "end": "1780250"
  },
  {
    "text": "then you're going to get\nrid of the password and KC. So you log into Athena\nworkstation and a couple",
    "start": "1780250",
    "end": "1786836"
  },
  {
    "text": "of seconds into\nthe boot process, you already get\nyour ticket here. It scrubs the\npassword from memory. So even if someone, like,\ngrabs you and grab the machine",
    "start": "1786836",
    "end": "1794240"
  },
  {
    "text": "and runs off, all they\ngot was your ticket. And OK, well, maybe they can\naccess your stuff for 10 hours",
    "start": "1794240",
    "end": "1799830"
  },
  {
    "text": "or whatever the\nticket lifetime was, but not for longer than that. The password is gone.",
    "start": "1799830",
    "end": "1805580"
  },
  {
    "text": "Yeah. So if the password's\ngone, then on that picture there when Kerberos\nsends a reply",
    "start": "1805580",
    "end": "1811000"
  },
  {
    "text": "encrypted with KC,\nhow does the client-- Oh yeah, so this is the one\nplace you need your password.",
    "start": "1811000",
    "end": "1816679"
  },
  {
    "text": "So you send this message,\nyou get this reply, you decrypt this, and then\nyou forget the password.",
    "start": "1816680",
    "end": "1822603"
  },
  {
    "text": "So you can't forget\nabout the password before you use it for\ndecryption of course. STUDENT: [INAUDIBLE]",
    "start": "1822603",
    "end": "1828150"
  },
  {
    "text": "PROFESSOR: Ah, no, so this is\njust this interface, right? So this is the thing\nyou do initially.",
    "start": "1828150",
    "end": "1833470"
  },
  {
    "text": "And we'll talk in a second\nabout how you basically also can get any ticket you want\nfrom the second interface",
    "start": "1833470",
    "end": "1838840"
  },
  {
    "text": "without needing\nthe initial key KC.",
    "start": "1838840",
    "end": "1843924"
  },
  {
    "text": "Right, make sense? All right, so I guess\nwe already talked",
    "start": "1843924",
    "end": "1849530"
  },
  {
    "text": "about two particular problems\nthat the Kerberos protocol had sort of baked into it, which\nis a little unfortunate.",
    "start": "1849530",
    "end": "1856830"
  },
  {
    "text": "One is that they assumed\nthat encryption also provides authentication\nor integrity of messages.",
    "start": "1856830",
    "end": "1862440"
  },
  {
    "text": "So don't do that. And Kerberos\nversion 5 fixes this by explicitly\nauthenticating messages.",
    "start": "1862440",
    "end": "1867770"
  },
  {
    "text": "Another thing they sort\nof had a problem with is the ability for\narbitrary clients",
    "start": "1867770",
    "end": "1874820"
  },
  {
    "text": "to guess people's passwords. So any suggestions of\nhow we could fix this?",
    "start": "1874820",
    "end": "1881101"
  },
  {
    "text": "How do you prevent\nguessing attacks in a protocol like this? What could we try?",
    "start": "1881102",
    "end": "1886242"
  },
  {
    "text": "Yeah. STUDENT: Some sort of salting? I'm not sure. PROFESSOR: Well, so\nsalting would just",
    "start": "1886242",
    "end": "1891540"
  },
  {
    "text": "means that the client\nhas to hash the password in different ways, maybe. But it still\ndoesn't prevent them from trying lots of things.",
    "start": "1891540",
    "end": "1897658"
  },
  {
    "text": "So maybe it'll be more\nexpensive to build a dictionary. Yeah. STUDENT: You could [INAUDIBLE]\nderivation function?",
    "start": "1897659",
    "end": "1903109"
  },
  {
    "text": "PROFESSOR: Yeah, so\nanother good idea is to make this hashing\nprocess super expensive. So that might be\nkind of nice, right?",
    "start": "1903109",
    "end": "1909490"
  },
  {
    "text": "So if this hash function took\na second to compute like you guys did in lab two,\nthen OK, wow, this would be actually\nreally expensive",
    "start": "1909490",
    "end": "1915820"
  },
  {
    "text": "to try different passwords. So that seems like\na reasonable plan. So in combination\nwith salting, those would be make it pretty\nexpensive to do password",
    "start": "1915820",
    "end": "1922880"
  },
  {
    "text": "guessing attacks. Anything else?  So another thing is,\nyeah, challenge respond.",
    "start": "1922880",
    "end": "1928910"
  },
  {
    "text": "So you could actually hear\nin the initial protocol, the Kerberos server\ndoesn't have any idea if this was the\nright client or not.",
    "start": "1928910",
    "end": "1935720"
  },
  {
    "text": "But in fact, what\nyou could do is maybe give a little bit of a\nproof that, well, you're probably the right client.",
    "start": "1935720",
    "end": "1942010"
  },
  {
    "text": "So maybe you could encrypt\nthe current time stamp with your hash\npassword or something",
    "start": "1942010",
    "end": "1947890"
  },
  {
    "text": "like this-- has them together. And then the Kerberos\nserver could just check if that's the right-- if\nthat matches, and if so, return",
    "start": "1947890",
    "end": "1954250"
  },
  {
    "text": "you back a ticket. You probably don't want to\nnecessarily add more rounds but this could work. So just to precise about\nwhat I'm sort of suggesting.",
    "start": "1954250",
    "end": "1960760"
  },
  {
    "text": "OK, well, maybe you take\nthe current time stamp and maybe you hash the current\ntime stamp and the KC together.",
    "start": "1960760",
    "end": "1971549"
  },
  {
    "text": "And maybe you include\nthe timestamp as well. And then the server could\nsee, well, it has your KC. It could hash the current\ntimestamp as well.",
    "start": "1971550",
    "end": "1977790"
  },
  {
    "text": "If it gets the same\nvalue, then yeah, it's probably the right\nuser requesting it. And I can send back the ticket.",
    "start": "1977790",
    "end": "1982870"
  },
  {
    "text": "If not, then it wasn't\nthe right password at all. Question? STUDENT: [INAUDIBLE] you just do\n[INAUDIBLE] if the servers see",
    "start": "1982870",
    "end": "1993041"
  },
  {
    "text": "too many requests [INAUDIBLE] PROFESSOR: That's right. So the problem is that\nwe could write limit. But there's no\nreason for the hacker",
    "start": "1993041",
    "end": "1999070"
  },
  {
    "text": "to request this more than once. That hacker requests a\nparticular user more than once and then it gets\nthis encrypted blob.",
    "start": "1999070",
    "end": "2006240"
  },
  {
    "text": "And then it can try decrypting\nit offline as many times as it wants with\ndifferent passwords without having to re request it.",
    "start": "2006240",
    "end": "2013080"
  },
  {
    "text": "So I think the whole\npoint of including some sort of a\nchallenge response thing like this in the particle\nis so that the server will--",
    "start": "2013080",
    "end": "2021057"
  },
  {
    "text": "you'll have to actually\nask the server again and again to try to log in\nwith different passwords.",
    "start": "2021057",
    "end": "2026809"
  },
  {
    "text": "And then you could rate\nlimit of the server and get a much better defense. Yeah. STUDENT: [INAUDIBLE] Kerberos?",
    "start": "2026809",
    "end": "2034930"
  },
  {
    "text": "PROFESSOR: So I think you could\ncertainly replay this message",
    "start": "2034930",
    "end": "2040210"
  },
  {
    "text": "so if I sent this message\nnow, you could probably look at that message\nand send it as well",
    "start": "2040210",
    "end": "2045419"
  },
  {
    "text": "and get a response back\nfrom the Kerberos server. I guess if you're\nwatching the network, you could observe this\nthing on the wire as well.",
    "start": "2045420",
    "end": "2052429"
  },
  {
    "text": "So I think this is sort of a bit\nof a stopgap measure-- improves security a bit. But certainly if you're\nwatching someone else's network,",
    "start": "2052429",
    "end": "2061002"
  },
  {
    "text": "then you're going to see this\npacket coming back regardless of what happened in this step. So coming back,\nyou'll see this guy",
    "start": "2061002",
    "end": "2067003"
  },
  {
    "text": "and you can then\ntry to attack it. There's probably some\nmore elaborate schemes you could design\nbut I didn't think",
    "start": "2067004",
    "end": "2072500"
  },
  {
    "text": "Kerberos 5 even\nimplements anything more elaborate than roughly this\nplan, which seems good enough",
    "start": "2072500",
    "end": "2077590"
  },
  {
    "text": "to prevent arbitrary\npeople from trying to break anyone's or brute\nforce anyone's password.",
    "start": "2077590",
    "end": "2083129"
  },
  {
    "text": "Make sense? Yeah. STUDENT: So presume\nthat you could do authenticated [INAUDIBLE]\nor something here",
    "start": "2083130",
    "end": "2090527"
  },
  {
    "text": "to establish the shared key. And then you could\nencrypt this thing with KC and the shared key. PROFESSOR: That's right, yeah. So if you're really\ndoing this right,",
    "start": "2090528",
    "end": "2096841"
  },
  {
    "text": "there's all these nice\nparticles out there that are basically called\npassword authenticated key",
    "start": "2096841",
    "end": "2102079"
  },
  {
    "text": "exchange particles, which is\nexactly what's going on here. So if you're actually\nbuilding a system, you should basically\nGoogle for SRP or PAKE.",
    "start": "2102080",
    "end": "2108800"
  },
  {
    "text": "And these protocols\nand related particles will actually do this in\na much better way where",
    "start": "2108800",
    "end": "2115480"
  },
  {
    "text": "you can prove to both\nparties that you established a new key and both parties\nare convinced that it's",
    "start": "2115480",
    "end": "2120850"
  },
  {
    "text": "the right other party\nand there's no way to mount these offline\npassword guessing attacks",
    "start": "2120850",
    "end": "2126240"
  },
  {
    "text": "on the set of network packets\nthat you observe and so on. So these are the\nsort of protocols. And they're much more\nelaborate in terms",
    "start": "2126240",
    "end": "2133220"
  },
  {
    "text": "of crypto they rely on. So it's hard to explain on a\nboard exactly why they work. Yeah. STUDENT: [INAUDIBLE]\npart of the reason",
    "start": "2133220",
    "end": "2139050"
  },
  {
    "text": "they did it this\nway is because they wanted to maintain the ability\nof just sending the password.",
    "start": "2139050",
    "end": "2144713"
  },
  {
    "text": "And protocols just allow\nyou to send a single thing as your authentication\n[INAUDIBLE].",
    "start": "2144714",
    "end": "2150840"
  },
  {
    "text": "PROFESSOR: Well,\nyeah, there's lots of sort of weird requirements\nthat these guys had in mind.",
    "start": "2150840",
    "end": "2156950"
  },
  {
    "text": "I think they-- well,\ncertainly in practice, these servers could accept\nboth Kerberos and non Kerberos",
    "start": "2156950",
    "end": "2166340"
  },
  {
    "text": "connections. And for non Kerberos\nconnections, you get-- like someone\nconnects to the mail server but they're not using\nan Athena workstation.",
    "start": "2166340",
    "end": "2171520"
  },
  {
    "text": "They just want to\nsend their password. And then the mail\nclient here, let's say, is going to take\nyour password and is going to get a ticket on\nyour behalf just to check it.",
    "start": "2171520",
    "end": "2178770"
  },
  {
    "text": "And then it's going to\nallow you to use it. So you certainly want conversion\nfrom Kerberos from passwords into checking against Kerberos.",
    "start": "2178770",
    "end": "2185119"
  },
  {
    "text": "I don't think this precludes\nit because certainly Kerberos 5 deploys although\nthis hashes of timestamps,",
    "start": "2185119",
    "end": "2190833"
  },
  {
    "text": "et cetera. STUDENT: Yeah but it's\nbecause they wouldn't want multiple [INAUDIBLE]. PROFESSOR: Yeah, well,\nI think that probably",
    "start": "2190833",
    "end": "2197620"
  },
  {
    "text": "doesn't matter quite as much. You could certainly have\nmultiple rounds in the back end behind your library.",
    "start": "2197620",
    "end": "2203380"
  },
  {
    "text": "But there's some downsides\nto these particles-- probably not significant enough\nto stop you from using them.",
    "start": "2203380",
    "end": "2210180"
  },
  {
    "text": "Other questions? All right, I guess\nthe other thing I want to mention that\nyou should watch out",
    "start": "2210180",
    "end": "2217039"
  },
  {
    "text": "for in the paper is that these\nguys, in designing Kerberos 4, they picked a single\nencryption scheme.",
    "start": "2217040",
    "end": "2223550"
  },
  {
    "text": "And at the time,\nthey basically picked DES, which was a popular\nencryption scheme of the time.",
    "start": "2223550",
    "end": "2229260"
  },
  {
    "text": "It's a symmetric block cypher. It goes pretty fast. It was reasonably secure,\nnot necessarily the best,",
    "start": "2229260",
    "end": "2236090"
  },
  {
    "text": "but certainly good\nenough at the time. And they just baked\nit into the protocol. Everything in Kerberos has\nto use single DES or at least",
    "start": "2236090",
    "end": "2242880"
  },
  {
    "text": "everything in\nKerberos version 4. And this was a bit problematic\nbecause 25 years later,",
    "start": "2242880",
    "end": "2247934"
  },
  {
    "text": "30 years later\nnow, it's actually very cheap to brute\nforce DES encryption because the keys are\nactually very small.",
    "start": "2247935",
    "end": "2254690"
  },
  {
    "text": "They're 56 bits. So you could just search build\nsome custom hardware that iterates over all the possible\n2 to the 56 combinations",
    "start": "2254690",
    "end": "2262089"
  },
  {
    "text": "and tries them all and figures\nout what someone's password is. So this is something\nalso you want to avoid",
    "start": "2262090",
    "end": "2268170"
  },
  {
    "text": "in any protocol you design now. Kerberos version 5\nactually supports multiple different\nencryption schemes including",
    "start": "2268170",
    "end": "2274730"
  },
  {
    "text": "AES and other things as well. So that seems like a\nmuch better way to do it. On the other hand, MIT\nactually kept supporting DES up",
    "start": "2274730",
    "end": "2282320"
  },
  {
    "text": "until two years ago, which\nis a little unfortunate. But now they don't.",
    "start": "2282320",
    "end": "2287560"
  },
  {
    "text": "So that's good. Your principal is secure at\nleast from this kind of attack.",
    "start": "2287560",
    "end": "2292860"
  },
  {
    "text": "All right, so does\nthat make sense? This is the initial\nway you'd get any ticket at all in Kerberos.",
    "start": "2292860",
    "end": "2298210"
  },
  {
    "text": "And typically, you'd get this\nticket from this TGS service. So now let's look at what's\ngoing on in this TGS service.",
    "start": "2298210",
    "end": "2304090"
  },
  {
    "text": "So here, the interaction\nwith the TGS service is going to be a\nlittle different.",
    "start": "2304090",
    "end": "2309349"
  },
  {
    "text": "On one hand, you're\ngoing to-- as a client, you're going to have\nto speak to it as if you're speaking to any\nother Kerberos enabled service.",
    "start": "2309350",
    "end": "2317910"
  },
  {
    "text": "So we'll see how you\nauthenticate yourself with a ticket to some machine. But then the response\nyou're going to get back",
    "start": "2317910",
    "end": "2323630"
  },
  {
    "text": "is just a ticket for\nsome other principle that you're going to want to\ncommunicate with like your file server.",
    "start": "2323630",
    "end": "2330230"
  },
  {
    "text": "So the protocol level messages\nthat show up here kind of look like this. So here's your TGS service.",
    "start": "2330230",
    "end": "2337049"
  },
  {
    "text": "And here's a client. The client already\ngot a ticket for TGS",
    "start": "2337050",
    "end": "2342750"
  },
  {
    "text": "using this protocol above. So what the client is\nactually going to send over is some combination\nof messages that",
    "start": "2342750",
    "end": "2350190"
  },
  {
    "text": "prove that this is\nthe right client and they're issuing a request\nfor some particular principle",
    "start": "2350190",
    "end": "2356900"
  },
  {
    "text": "through TGS. So what the client is going\nto send to TGS is this tuple. So first, it's\ngoing to say, well, here's the service that\nI want to talk to next.",
    "start": "2356900",
    "end": "2364000"
  },
  {
    "text": "So this might be your mail\nserver or your file server. Then is going to\ninclude the ticket.",
    "start": "2364000",
    "end": "2369440"
  },
  {
    "text": "It already got 4TGS. So this is going to be TC\nof TGS encrypted with KTGS.",
    "start": "2369440",
    "end": "2378099"
  },
  {
    "text": "So this is just this\nthing where S is TGS. And then you're going to have\nto include this authenticator",
    "start": "2378100",
    "end": "2383890"
  },
  {
    "text": "blob. This is this AC\nthing from up there. And this thing is\ngoing to be encrypted",
    "start": "2383890",
    "end": "2389780"
  },
  {
    "text": "with a shared key between the\nclient and the TGS service.",
    "start": "2389780",
    "end": "2394892"
  },
  {
    "text": "So this is the message that\nyou're going to send to TGS. It's going to look\nat this message,",
    "start": "2394892",
    "end": "2400399"
  },
  {
    "text": "do something with it that\nwe'll talk about in a second, and respond back with a\nticket for this new service S.",
    "start": "2400399",
    "end": "2407770"
  },
  {
    "text": "So the response here looks\nalmost exactly like here. In fact, it is exactly\nthe same thing. It's going to be a\nticket between the client",
    "start": "2407770",
    "end": "2414610"
  },
  {
    "text": "and this new service\nS encrypted with KS and the shared key between the\nclient and this new service",
    "start": "2414610",
    "end": "2421320"
  },
  {
    "text": "S encrypted-- well, now,\nhere's a little bit different. Instead of encrypting with KC,\nwhich the client has probably",
    "start": "2421320",
    "end": "2427550"
  },
  {
    "text": "forgotten since\nthen, now we're going to encrypt it with this\nshared key between the client and the TGS service.",
    "start": "2427550",
    "end": "2435510"
  },
  {
    "text": "Makes sense? All right, so in this-- how does\nthe server actually figure out",
    "start": "2435510",
    "end": "2444850"
  },
  {
    "text": "what the client wants to do? Or, how does server\nauthenticate the client? Well, in this case, it's\ngoing to-- TGS server actually",
    "start": "2444850",
    "end": "2452650"
  },
  {
    "text": "knows its own key, KTGS. So it's going to first\ndecrypt this blob and look inside the ticket and\nfigure out what's going on.",
    "start": "2452650",
    "end": "2460089"
  },
  {
    "text": "And there's all those\nnice fields in the ticket. So let's just double check. Why do we need all those\nfields in the ticket?",
    "start": "2460090",
    "end": "2467099"
  },
  {
    "text": "So is it important to have the\nserver name S in the ticket?",
    "start": "2467100",
    "end": "2472687"
  },
  {
    "text": "What would go wrong if you\ndidn't have S in there? ",
    "start": "2472687",
    "end": "2477722"
  },
  {
    "text": "Anything? Yeah. STUDENT: They could\npotentially get authorized to use any server.",
    "start": "2477722",
    "end": "2484609"
  },
  {
    "text": "PROFESSOR: Yeah, so it's\nin general a good idea to be very explicit\nin network protocols and to say exactly\nwhat a message means.",
    "start": "2484610",
    "end": "2491580"
  },
  {
    "text": "So in this case,\nif you omit an S, you might be relying\non the fact that, well,",
    "start": "2491580",
    "end": "2497189"
  },
  {
    "text": "if it's the wrong S that you're\ntrying to use the ticket for, then maybe you'll have a\ndifferent key over here",
    "start": "2497189",
    "end": "2502320"
  },
  {
    "text": "and then it wouldn't decrypt\nor something like this. But it seems like a good idea\nto include it to make sure that the server that\nreceives this tickets",
    "start": "2502320",
    "end": "2508630"
  },
  {
    "text": "decrypts and checks. Is that a ticket for\nme or for someone else? Yeah. STUDENT: What does the\nclient get KTGS on?",
    "start": "2508630",
    "end": "2515522"
  },
  {
    "text": "PROFESSOR: Ah, good question. The client has no\nidea what this is. Because this is like\na super secret key. If you knew this,\nyou'd probably be",
    "start": "2515522",
    "end": "2521770"
  },
  {
    "text": "able to break all of Kerberos. So the client has no\nidea what KTGS is. STUDENT: [INAUDIBLE]",
    "start": "2521770",
    "end": "2527294"
  },
  {
    "text": "PROFESSOR: Ah, yeah, yeah. And then the where\nyou get it from is actually-- it's the\nKerberos server itself that generates this whole blob\nfor you where this is actually",
    "start": "2527294",
    "end": "2534830"
  },
  {
    "text": "TGS and this is KTGS over here. So you don't construct\nthis yourself.",
    "start": "2534830",
    "end": "2540450"
  },
  {
    "text": "You just copy it over. OK So what is the client\nname there important for?",
    "start": "2540450",
    "end": "2547153"
  },
  {
    "text": "That should be\nfairly easy, right? If you don't put the\nclient name in the ticket, then the server\ngets this nice blob but it has no idea who\nit's trying to talk to.",
    "start": "2547154",
    "end": "2554382"
  },
  {
    "text": "So it has no idea\nwhether it should issue a ticket for my\nprincipal or for someone else's principle, et cetera.",
    "start": "2554382",
    "end": "2561250"
  },
  {
    "text": "So what's the deal\nwith the other fields? Why do these guys stick\nan address in the ticket?",
    "start": "2561250",
    "end": "2566625"
  },
  {
    "text": " This is the client's IP address. Does it matter?",
    "start": "2566625",
    "end": "2573741"
  },
  {
    "text": "Yeah. STUDENT: Can they\nuse that address with the ticket to verify\nagainst the [INAUDIBLE]?",
    "start": "2573741",
    "end": "2579899"
  },
  {
    "text": "PROFESSOR: Sort of. Well, so I think\nthe general plan for why there's\naddresses appearing everywhere here,\nthese IP addresses,",
    "start": "2579899",
    "end": "2585290"
  },
  {
    "text": "is that these guys at the\ntime were still slightly confused and--\nwell, in some ways--",
    "start": "2585290",
    "end": "2591401"
  },
  {
    "text": "they were still\nthinking, OK, well, we're going to rely\non IP addresses for a little bit of security. So they wanted to make sure\nthat if the client logged in",
    "start": "2591402",
    "end": "2599350"
  },
  {
    "text": "from some IP address, then\neverything else going on with that ticket happen\nfrom that same IP address. So if you logged in\nfrom some IP address",
    "start": "2599350",
    "end": "2607070"
  },
  {
    "text": "on 18.26.4.9 or something,\nthen every connection you make to a file server\nor to a mail server",
    "start": "2607070",
    "end": "2612940"
  },
  {
    "text": "has to be from the\nsame IP address. Otherwise, the server should\nreject your connection as being stolen by-- or\nsomeone stole your ticket.",
    "start": "2612940",
    "end": "2619570"
  },
  {
    "text": "So we're thinking,\nOK, well, maybe we'll defend against ticket\ntheft this way. If you still a ticket,\nwell, but you're",
    "start": "2619570",
    "end": "2625010"
  },
  {
    "text": "not using the same IP address. So it won't work. It's probably a little bit\nmisguided at this point but-- that sort of gets in the\nway And Kerberos 5 still has it",
    "start": "2625010",
    "end": "2632980"
  },
  {
    "text": "but it's largely optional. Really, you should just rely on\ncryptography instead of any IP",
    "start": "2632980",
    "end": "2638410"
  },
  {
    "text": "address security. So what's the point of the\ntime stamp and lifetime things in the ticket up there?",
    "start": "2638410",
    "end": "2644760"
  },
  {
    "text": "One are those guys good for? Are they useful? Yeah. STUDENT: Preventing\nreplay attacks.",
    "start": "2644760",
    "end": "2651270"
  },
  {
    "text": "PROFESSOR: Well,\nso the syndicator is the thing that's\ngoing to help us prevent replay attacks in a second. Because that thing gets\ngenerated every time",
    "start": "2651270",
    "end": "2658470"
  },
  {
    "text": "you do a new request. On the other hand, the\nticket just stays the same. So it's certainly not\npreventing replay attacks there.",
    "start": "2658470",
    "end": "2664739"
  },
  {
    "text": "Yeah. STUDENT: It prevents somebody\nfrom stealing your ticket then using it [INAUDIBLE] PROFESSOR: Oh, sorry, yes. This just bounds the time\nfor which a ticket is valid,",
    "start": "2664739",
    "end": "2672050"
  },
  {
    "text": "meaning that the damage\nfrom disclosing it is hopefully reduced.",
    "start": "2672050",
    "end": "2677109"
  },
  {
    "text": "So the plan is the timestamp\nis roughly the time when you initially got the ticket. And a lifetime in\nthe ticket represents",
    "start": "2677110",
    "end": "2684070"
  },
  {
    "text": "how many hours,\nlet's say, it's valid from that initial timestamp. So if you try to use it\ntoo early or too late,",
    "start": "2684070",
    "end": "2691049"
  },
  {
    "text": "then every server should\nreject such a ticket in the Kerberos protocol. So this kind of means\nthat every server",
    "start": "2691050",
    "end": "2698180"
  },
  {
    "text": "has to have a loosely\nsynchronized, clock which is a bit of a-- well,\nmaybe you've run into this.",
    "start": "2698180",
    "end": "2704900"
  },
  {
    "text": "Like, your laptop clock is off\nand you can't log into Kerberos anymore. Question? Yeah. STUDENT: You said before\nthat the client discards KC",
    "start": "2704900",
    "end": "2711980"
  },
  {
    "text": "but they're still\nkeeping KCS [INAUDIBLE] the TGS. [INAUDIBLE] PROFESSOR: That's right, yeah.",
    "start": "2711980",
    "end": "2717555"
  },
  {
    "text": "So the client discards\nKC after logging in. But it still keeps KCS. You're exactly right.",
    "start": "2717555",
    "end": "2722997"
  },
  {
    "text": "STUDENT: So if someone\nsteals the KCS, then they have access\nto [INAUDIBLE]. PROFESSOR: Yeah, OK.",
    "start": "2722997",
    "end": "2728320"
  },
  {
    "text": "So how bad is that? Like, why is it better\nto disclose this KCS fof-- actually, well,\nthis is TGS, right?",
    "start": "2728320",
    "end": "2734600"
  },
  {
    "text": "Why is it better to\ndisclose KCTGS than KC? ",
    "start": "2734600",
    "end": "2739980"
  },
  {
    "text": "Yeah. STUDENT: Someone [INAUDIBLE]\nsomewhere [INAUDIBLE]. PROFESSOR: It's\nthe kind of thing that they're both keys, though.",
    "start": "2739980",
    "end": "2745390"
  },
  {
    "text": "So neither of them are\nreally hashed, yeah. STUDENT: You would take\nKCS and you'd just steal that session between those two.",
    "start": "2745390",
    "end": "2751238"
  },
  {
    "text": "But if you steal KC, you\ncan impersonate the client. PROFESSOR: That's right. Yeah. So I guess one\nway to answer this",
    "start": "2751238",
    "end": "2756730"
  },
  {
    "text": "is that KCTGS, this is actually\na new key generated every time you log in initially.",
    "start": "2756730",
    "end": "2762820"
  },
  {
    "text": "And this thing is only good\nbecause you have this ticket that goes along with it.",
    "start": "2762820",
    "end": "2768620"
  },
  {
    "text": "If you lose this ticket or if\nthis ticket is no longer valid, then yeah, you have these\n56 bits in this key.",
    "start": "2768620",
    "end": "2774500"
  },
  {
    "text": "But no one is going to assume\nanything from those bits. The only reason these\nbits are interesting",
    "start": "2774500",
    "end": "2780759"
  },
  {
    "text": "is because this ticket talks\nabout this KCS being valid right now. And there's a bound on it.",
    "start": "2780760",
    "end": "2786886"
  },
  {
    "text": "STUDENT: Yeah, so if\nthey stole both of those [INAUDIBLE] be bounded. PROFESSOR: Yeah, if someone\nsteals both of these blogs,",
    "start": "2786886",
    "end": "2792870"
  },
  {
    "text": "than they can impersonate you\nor, like, log into your file server, mail server for the\nlifetime of that ticket, which",
    "start": "2792870",
    "end": "2799450"
  },
  {
    "text": "is a couple of\nhours or 10 hours. Stealing this, there's no time\nbound on that until you change",
    "start": "2799450",
    "end": "2804760"
  },
  {
    "text": "your password and maybe worse. Make sense? All right, so it\nseems like, yeah,",
    "start": "2804760",
    "end": "2813050"
  },
  {
    "text": "all those fields are\nkind of important, IP address maybe less so. And now in response, right, we\ncan get this ticket finally.",
    "start": "2813050",
    "end": "2822220"
  },
  {
    "text": "And because we know KCTGS,\nwe can decrypt the response from this TGS server. And now we have a\nticket for any server",
    "start": "2822220",
    "end": "2829790"
  },
  {
    "text": "we want-- a file server,\nmail server, whatever it is that we finally\ncare about connecting to.",
    "start": "2829790",
    "end": "2835840"
  },
  {
    "text": "Make sense? All right, so let's look at\nhow you might sort of finally",
    "start": "2835840",
    "end": "2843050"
  },
  {
    "text": "use this in some\napplication level protocol. So suppose that maybe I'm\ntalking to a mail server",
    "start": "2843050",
    "end": "2850090"
  },
  {
    "text": "to fetch my messages. So presumably, what my client\nworkstation is going to do is going to send a tickets\nrequesting for, I don't know,",
    "start": "2850090",
    "end": "2857245"
  },
  {
    "text": "mail.po12. And it'll get back a ticket\nfor the principal mail.po12",
    "start": "2857245",
    "end": "2863380"
  },
  {
    "text": "or something like this. And then inside of this ticket\nor inside of this response,",
    "start": "2863380",
    "end": "2869340"
  },
  {
    "text": "now I have a shared\nkey between me and the mail server-- S is\nthe male server over here--",
    "start": "2869340",
    "end": "2875079"
  },
  {
    "text": "and this ticket a blob\nthat I can to the mail server to convince it\nthat I'm the right guy or anyone with this key\nis the right principle.",
    "start": "2875080",
    "end": "2884679"
  },
  {
    "text": "And then we can actually have\nan encrypted conversation with the mail server\nusing this new key KCS.",
    "start": "2884679",
    "end": "2892220"
  },
  {
    "text": "So what I might do as\na client is-- well, initially, I send some\nmessage to the mail server",
    "start": "2892220",
    "end": "2900200"
  },
  {
    "text": "that includes this\nticket TC mail encrypted",
    "start": "2900200",
    "end": "2905980"
  },
  {
    "text": "with the key of the mail server. And then I can actually\nsend some message along",
    "start": "2905980",
    "end": "2911509"
  },
  {
    "text": "with this request that maybe\nsays something like, well, delete some message-- delete 5.",
    "start": "2911510",
    "end": "2920640"
  },
  {
    "text": "And I can encrypt\nthis with KC mail.",
    "start": "2920640",
    "end": "2926359"
  },
  {
    "text": "Does that make sense? OK, so what happens in this\nprotocol on the mail server side?",
    "start": "2926360",
    "end": "2932060"
  },
  {
    "text": "The mail server is going to\nuse its secret key K mail to decrypt this ticket first.",
    "start": "2932060",
    "end": "2937474"
  },
  {
    "text": "And then it looks\ninside there and finds two important things-- the\nprincipal name C of who",
    "start": "2937474",
    "end": "2942799"
  },
  {
    "text": "is it that's talking to it in\nthe first place and the key KCS that it should be\nusing to decrypt",
    "start": "2942800",
    "end": "2948430"
  },
  {
    "text": "all the subsequent traffic\nand authenticate it ideally in Kerberos 5, at least. And then you can decrypt this\nmessage and say oh, well, yeah.",
    "start": "2948430",
    "end": "2955150"
  },
  {
    "text": "User C is trying to\ndelete message five. So I'll run this command. Make sense? You had a question?",
    "start": "2955150",
    "end": "2961316"
  },
  {
    "text": "STUDENT: Yeah, so\nKerberos initially sends the TGS ticket in KCTGS.",
    "start": "2961316",
    "end": "2970370"
  },
  {
    "text": "Where's [INAUDIBLE]? PROFESSOR: So AC, those\nauthenticators are actually",
    "start": "2970370",
    "end": "2975500"
  },
  {
    "text": "generated by the client. Note that the client\nonly needs KCS to generate an authenticator.",
    "start": "2975500",
    "end": "2982390"
  },
  {
    "text": "So the client can make\nthese up any time it wants. So the general plan for\nindicators or the reason",
    "start": "2982390",
    "end": "2988250"
  },
  {
    "text": "to use authenticators is roughly\nto prevent replay attack. So the client, or at least in\nthe way that the Kerberos 4",
    "start": "2988250",
    "end": "2995470"
  },
  {
    "text": "developers were\nintending it, the client, every time it sends\na new request , it would generate a new\nauthenticator to say OK, well,",
    "start": "2995470",
    "end": "3002980"
  },
  {
    "text": "this is a new request. I'm issuing it now. It's different from all\nthe previous requests. Go do it. And the general plan\nwas that the server",
    "start": "3002980",
    "end": "3011110"
  },
  {
    "text": "would keep a cache of\nthese authenticators that were sent within the\nlast five minutes or so.",
    "start": "3011110",
    "end": "3018830"
  },
  {
    "text": "So if it ever sees a\nduplicate authenticator, it says oh, that's\na replay request. I'm going to reject it.",
    "start": "3018830",
    "end": "3024130"
  },
  {
    "text": "And if it sees an\nauthenticator that's outside of a five\nminute boundary, it doesn't have it in the cache.",
    "start": "3024130",
    "end": "3029970"
  },
  {
    "text": "But it will look at the time\nstamp in the authenticator and say, well, this is a\nvery old authenticator.",
    "start": "3029970",
    "end": "3035220"
  },
  {
    "text": "I'll just reject your\nrequest because it's too old. Send it again if\nyou really care. So that's the general\nplan for indicators.",
    "start": "3035220",
    "end": "3042170"
  },
  {
    "text": "As with many things\nin Kerberos, they were slightly broken--\nin Kerberos 4, at least. Because this\nauthenticator actually",
    "start": "3042170",
    "end": "3048890"
  },
  {
    "text": "says nothing about the\nmessage you're sending, right? It's some blob. So the way you would\nuse it, for example, in this mail server protocol\nis-- or at least in Kerberos",
    "start": "3048890",
    "end": "3057609"
  },
  {
    "text": "4-- well, you would\ngenerate some authenticator and you would be to\ntake the authenticator and you would encrypt\nit with also KC mail.",
    "start": "3057610",
    "end": "3066571"
  },
  {
    "text": "And the mail server would\nkeep track of, well, yeah, you've sent this [INAUDIBLE]\nindicator before. No, you haven't.",
    "start": "3066572",
    "end": "3072006"
  },
  {
    "text": "But there's nothing here that\nconnects the authenticator to the message you are sending. So for the first\nmessage, this was great.",
    "start": "3072007",
    "end": "3077912"
  },
  {
    "text": "But when you send\na second message, you're going to generate\na second authenticator. And someone on the\nnetwork can say, oh, yeah,",
    "start": "3077912",
    "end": "3082980"
  },
  {
    "text": "I got your new authenticator. I can take your\nnew authenticator and splice in the\nold delete message.",
    "start": "3082980",
    "end": "3088130"
  },
  {
    "text": "So I'll force you to delete\nthe fifth message twice, even though the\nsecond command meant to send some other operation.",
    "start": "3088130",
    "end": "3095960"
  },
  {
    "text": "So Kerberos 5 gets this\nright where you actually stick something in the\nauthenticator that relates",
    "start": "3095960",
    "end": "3102860"
  },
  {
    "text": "to the command you're issuing. You could do this, of course,\nbut sort of took a while for people to realize\nthat, well, here's",
    "start": "3102860",
    "end": "3109390"
  },
  {
    "text": "how you should design\na protocol correctly. Make sense? Yeah, other question.",
    "start": "3109390",
    "end": "3114714"
  },
  {
    "text": "STUDENT: [INAUDIBLE]  PROFESSOR: Ah, so the\nclient gets case email",
    "start": "3114714",
    "end": "3121050"
  },
  {
    "text": "from this response. So the client, when it wants\nto talk to the mail server, it's going to ask the TGS for\na ticket for the mail server.",
    "start": "3121050",
    "end": "3128240"
  },
  {
    "text": "And here, S is basically this\nmail server's principal name. So when it comes back,\nthis says S equals mail",
    "start": "3128240",
    "end": "3136370"
  },
  {
    "text": "and this server key\nS is equal to mail. And this KCS is\nactually KC mail.",
    "start": "3136370",
    "end": "3142470"
  },
  {
    "text": " So this is how the client\nlearns of the shared key",
    "start": "3142470",
    "end": "3148829"
  },
  {
    "text": "that it has between it and the\nfiles and the mail server here. And there's a copy of\nit inside the ticket.",
    "start": "3148830",
    "end": "3154850"
  },
  {
    "text": "Question back there? STUDENT: How does the\nmail server get KC mail? PROFESSOR: Ah, yes. So how does the mail\nserver get this shared key?",
    "start": "3154850",
    "end": "3160980"
  },
  {
    "text": "Like, the mail server\nmight have never heard of your connection before,\nnever heard of you. Where does KC mail come from\non the mail server side?",
    "start": "3160980",
    "end": "3167760"
  },
  {
    "text": "Yeah. STUDENT: Isn't it\npart of the ticket? PROFESSOR: Yeah, yeah, so\nthis is the cool thing. You send this ticket over to the\nmail server and the mail server",
    "start": "3167760",
    "end": "3174106"
  },
  {
    "text": "knows its own secret key K mail. And it uses that to decrypt the\nticket TC mail and the shared",
    "start": "3174106",
    "end": "3180980"
  },
  {
    "text": "key is in there along\nwith the name of whoever it is that you're\nsharing this key with. That's how it finds out,\noh, I'm talking to the guy",
    "start": "3180980",
    "end": "3187780"
  },
  {
    "text": "and that's the shared\nkey we should use. Makes sense?",
    "start": "3187780",
    "end": "3192930"
  },
  {
    "text": "All right, so that's\nthe sort of basic plan for how you use this protocol\nin some actual application.",
    "start": "3192930",
    "end": "3200950"
  },
  {
    "text": "There's-- well, there's a\nbunch of problems with this.",
    "start": "3200950",
    "end": "3207490"
  },
  {
    "text": "So Kerberos is-- it's\na nice paper to read but then there's all these\nproblems these guys didn't",
    "start": "3207490",
    "end": "3212570"
  },
  {
    "text": "know about 30 years ago. So it's sort of inevitable\nthat there's problems you have to go through.",
    "start": "3212570",
    "end": "3218240"
  },
  {
    "text": "So one interesting\nproblem in the way Kerberos 4 encrypted and\nauthenticated messages",
    "start": "3218240",
    "end": "3225819"
  },
  {
    "text": "for applications is that\nthey use the same key for encrypting messages from\nthe client to the server",
    "start": "3225820",
    "end": "3232960"
  },
  {
    "text": "as well as messages from the\nserver back to the client. So suppose that the client\nissues, I don't know,",
    "start": "3232960",
    "end": "3241300"
  },
  {
    "text": "a request to fetch a\nparticular message. So then I say, you know,\nfetch the message 7.",
    "start": "3241300",
    "end": "3248720"
  },
  {
    "text": "And I encrypt this\nthing with KC mail. That seems all great.",
    "start": "3248720",
    "end": "3255170"
  },
  {
    "text": "The mail server has\nthe shared key that's going to decrypt this message. And it's going to send me back\nthe body of this email message",
    "start": "3255170",
    "end": "3263690"
  },
  {
    "text": "also encrypted with KC mail. Does anyone see a\nproblem with this?",
    "start": "3263690",
    "end": "3269500"
  },
  {
    "text": "Why is this is potentially\na bad thing to do? Anyone else?",
    "start": "3269500",
    "end": "3274869"
  },
  {
    "text": "Sure. STUDENT: So there's\na chapter [INAUDIBLE] they can make [INAUDIBLE] look\nlike some other things they",
    "start": "3274870",
    "end": "3282104"
  },
  {
    "text": "want [INAUDIBLE] PROFESSOR: Yes, so\nthose are actually worrisome because I could send\nyou any email message I want. So suppose I really want\nto delete some message that",
    "start": "3282104",
    "end": "3288610"
  },
  {
    "text": "is sitting here in\nyour inbox and I don't want you to read it. I know it's maybe\nmessage, I don't know, 23.",
    "start": "3288610",
    "end": "3293640"
  },
  {
    "text": "So I'm going to send you an\nemail that says, delete 23. You're going to read it. You're going to fetch\nit and a response",
    "start": "3293640",
    "end": "3298799"
  },
  {
    "text": "is going to come from\nthe mail server saying, delete 23 encrypted\nwith this key. And so far, it's not being\nsent to the mail server.",
    "start": "3298800",
    "end": "3305210"
  },
  {
    "text": "But if I look at the\nnetwork at the right time and capture this packet,\nI can send the packet back to the mail server.",
    "start": "3305210",
    "end": "3310690"
  },
  {
    "text": "It would look like a message\nsaying delete 23 encrypted with the right key. And the mail server\nwill say, oh yeah, sure.",
    "start": "3310690",
    "end": "3316900"
  },
  {
    "text": "You're trying to\ndelete this message. I'll do it. So this is a bit of\na problem because we",
    "start": "3316900",
    "end": "3321970"
  },
  {
    "text": "are allowing an adversary\nto confuse the mail server into whether our\nmessage was generated by it",
    "start": "3321970",
    "end": "3327860"
  },
  {
    "text": "or was sent to it\nin the first place. So this is quite troublesome. So these are what's\ntypically called",
    "start": "3327860",
    "end": "3333520"
  },
  {
    "text": "in cryptography and\nprotocol literature as reflection attacks. So you have any suggestions for\nhow we can avoid this problem?",
    "start": "3333520",
    "end": "3340260"
  },
  {
    "text": "Yeah. STUDENT: Can't you just include\na header saying its origins? PROFESSOR: Yeah,\nso typically, you want to have some very\nunambiguous way to state what's",
    "start": "3340260",
    "end": "3346950"
  },
  {
    "text": "going on. One way is to have a header\nin every message that says, this is going from the client\nto the server or from server",
    "start": "3346950",
    "end": "3352780"
  },
  {
    "text": "to the client. And even better plan\nin practice turns out to be just use\ntwo separate keys. Because you might want to\nhave a long stream of data",
    "start": "3352780",
    "end": "3360170"
  },
  {
    "text": "where you don't really have\nspace for this header bit. So instead, what Kerberos 5\ndoes is every time you establish",
    "start": "3360170",
    "end": "3366380"
  },
  {
    "text": "a connection with some service ,\nyou actually negotiate two keys instead of just one key. And the first key is going to\nbe used for encrypting stuff",
    "start": "3366380",
    "end": "3373530"
  },
  {
    "text": "from client to server and other\nfrom server back to the client. So that seems like a much\nbetter way to do it in practice.",
    "start": "3373530",
    "end": "3381010"
  },
  {
    "text": "Make sense? All right, so I guess\nlet's now talk a little bit",
    "start": "3381010",
    "end": "3390750"
  },
  {
    "text": "about what happens with KDC. So the Kerberos server is\npretty important to the system.",
    "start": "3390750",
    "end": "3398870"
  },
  {
    "text": "But what happens if\nthis KDC goes down? So how bad is it to our system.",
    "start": "3398870",
    "end": "3404360"
  },
  {
    "text": "Like, in Athena,\nsuppose if KDC crashes, does this affect your life? Well, if you use Athena.",
    "start": "3404360",
    "end": "3410514"
  },
  {
    "text": "STUDENT: Is that why\nyou can't log in? PROFESSOR: Yeah, so\nyou can't log in. I guess the other thing is\nyou also can't get tickets",
    "start": "3410514",
    "end": "3416030"
  },
  {
    "text": "to new things as well. But kind of the cool thing\nis that the KDC is largely off the critical path\nfor existing connection.",
    "start": "3416030",
    "end": "3422820"
  },
  {
    "text": "So no data passes\nthrough the KDC. And if you already have\na ticket for something, you can keep using\nit and keep logging",
    "start": "3422820",
    "end": "3427853"
  },
  {
    "text": "into some service\nover the network. So in that way, it's actually\nquite nicely cacheable.",
    "start": "3427853",
    "end": "3433056"
  },
  {
    "text": "I guess the other\nnice thing these guys do is they actually have\na way of replicating the KDC potentially.",
    "start": "3433056",
    "end": "3438880"
  },
  {
    "text": "So they have one\nmaster Kerberos server that stores the sort of primary\ncopy of this whole database.",
    "start": "3438880",
    "end": "3445799"
  },
  {
    "text": "And then they can have\nread only replicas that hold a copy of this database. They don't allow\nany updates to this",
    "start": "3445800",
    "end": "3452080"
  },
  {
    "text": "like registering users\nor updating keys. But they do allow responding\nto login and TJS requests.",
    "start": "3452080",
    "end": "3459600"
  },
  {
    "text": "So this way, these backup\nclones of this Kerberos database allow you to keep logging in\nand keep talking to services",
    "start": "3459600",
    "end": "3465860"
  },
  {
    "text": "even if the master\ncrashed and hopefully make it possible to upgrade\nto master without breaking",
    "start": "3465860",
    "end": "3473590"
  },
  {
    "text": "everything at the same time. Makes sense? Any questions? Yeah. STUDENT: How hard\nis it to compromise",
    "start": "3473590",
    "end": "3478741"
  },
  {
    "text": "the KDC server and [INAUDIBLE]? PROFESSOR: Well, yes,\nthis is a huge sort of target for any system\nthat runs Kerberos.",
    "start": "3478741",
    "end": "3485852"
  },
  {
    "text": "Because if you\ncompromise this guy, you're in complete\ncontrol of the system. You can mint tickets for\nany service you want,",
    "start": "3485852",
    "end": "3492620"
  },
  {
    "text": "pretending to be\nclient you want. So this is pretty bad. So you really want to\nkeep this guy secure.",
    "start": "3492620",
    "end": "3498654"
  },
  {
    "text": "Now, how hard is\nit to compromise? Well, ideally, it's hard. And I don't know\nof any instances",
    "start": "3498654",
    "end": "3505450"
  },
  {
    "text": "where the MIT KDC has actually\nbeen compromised in, I guess, 20 years or so.",
    "start": "3505450",
    "end": "3511700"
  },
  {
    "text": "So it's , I think, possible to\nrun this reasonably security. But presumably, the things\nyou would worry about",
    "start": "3511700",
    "end": "3517069"
  },
  {
    "text": "are just software\nimplementation security of the things that's listening\non these two services, right?",
    "start": "3517070",
    "end": "3523010"
  },
  {
    "text": "So if there's buffer\noverflows on this guys or some other vulnerability\nlike that, that's really bad.",
    "start": "3523010",
    "end": "3528850"
  },
  {
    "text": "Or if there's an SSH server\nrunning on the Kerberos KDC and someone guesses the root\npassword on that SSH server,",
    "start": "3528850",
    "end": "3535430"
  },
  {
    "text": "they'll just log in and\ncopy the database over. So I think you really want\nto be careful in minimizing the attack surface there.",
    "start": "3535430",
    "end": "3541151"
  },
  {
    "text": "Maybe be very careful\nwriting the KDC code. Don't allow you to\nlog into it directly.",
    "start": "3541151",
    "end": "3546300"
  },
  {
    "text": "Maybe you even worry about\nphysical security, et cetera. Absolutely.",
    "start": "3546300",
    "end": "3551690"
  },
  {
    "text": "Luckily, this is actually\none of the few places where you have to be\nsuper paranoid, though. Right, so the servers,\nunlike in some other systems",
    "start": "3551690",
    "end": "3559020"
  },
  {
    "text": "that do trust all the\nmachines, the servers are actually not that important. They of course store some data.",
    "start": "3559020",
    "end": "3564410"
  },
  {
    "text": "But if someone compromises a\nmail server or a print server, you can probably\nrecover reasonably well.",
    "start": "3564410",
    "end": "3570337"
  },
  {
    "text": "So actually, here's an\ninteresting question. Like, suppose someone\ncompromised the mail server. What should you do to\nrecover from this attack?",
    "start": "3570337",
    "end": "3577156"
  },
  {
    "text": "Like, if someone\nstole your mail, I guess that's kind\nof unfortunate. But what do you do so that the\nattacker doesn't keep accessing",
    "start": "3577156",
    "end": "3582710"
  },
  {
    "text": "your mail in the future? Yeah. STUDENT: [INAUDIBLE] PROFESSOR: Yeah, so\nin Kerberos, there's no sort of revoke operation.",
    "start": "3582710",
    "end": "3589830"
  },
  {
    "text": "But what you could\ndo is you could change generate a new\nkey for the mail server and stick it in this\ndatabase over here.",
    "start": "3589830",
    "end": "3596000"
  },
  {
    "text": "And then you install a new mail\nserver, give it the new key, and then some attacker that\nhas the mail server's old key",
    "start": "3596000",
    "end": "3602880"
  },
  {
    "text": "has no way of-- like, no\ninfluence at all on this mail server now, right?",
    "start": "3602880",
    "end": "3608167"
  },
  {
    "text": "On the other hand, suppose you\ndidn't change the mail server's key, K mail.",
    "start": "3608167",
    "end": "3613220"
  },
  {
    "text": "How that is that? STUDENT: [INAUDIBLE] fine. PROFESSOR: OK, so suppose\nyou didn't change the mail.",
    "start": "3613220",
    "end": "3619500"
  },
  {
    "text": "You, like, install\nthe new mail server. You patch whatever bug\nthat hacker exploited. But it still has\nthe same key K mail.",
    "start": "3619500",
    "end": "3625130"
  },
  {
    "text": "And maybe it's taken a day so\nall the tickets are expired. Can that hacker do anything\ninteresting in the system",
    "start": "3625130",
    "end": "3630380"
  },
  {
    "text": "anymore? Yeah. STUDENT: [INAUDIBLE] PROFESSOR: Yeah, OK, so you give\nthe new mail server the old K",
    "start": "3630380",
    "end": "3636245"
  },
  {
    "text": "mail. Is that bad? Yeah. STUDENT: This is--",
    "start": "3636245",
    "end": "3641536"
  },
  {
    "text": " PROFESSOR: Sure. STUDENT: [INAUDIBLE]\nmail server.",
    "start": "3641536",
    "end": "3648571"
  },
  {
    "text": "And [INAUDIBLE] mail\nserver because you can encrypt that initial ticket. PROFESSOR: Right. So K mail is actually\nsuper important.",
    "start": "3648571",
    "end": "3654779"
  },
  {
    "text": "And, OK, so you're saying you\ncan decrypt all the things going on to the mail server. So suppose the client now\nconnects to the mail server",
    "start": "3654780",
    "end": "3660670"
  },
  {
    "text": "after it's been fixed up. But the attacker\nstill knows K mail from the last time they\ncompromised the system.",
    "start": "3660670",
    "end": "3665849"
  },
  {
    "text": "They can now decrypt\nthis ticket k mail and they can now look inside the\nticket to get the session key",
    "start": "3665850",
    "end": "3671382"
  },
  {
    "text": "and they can use that to\ndecrypt all the messages you send, all the responses\nyou get back, and so on. So it's pretty important\nto change this key K mail.",
    "start": "3671382",
    "end": "3678950"
  },
  {
    "text": "And in many ways, it's\nactually even worse than just looking\nat the traffic. Because if the attacker\nknow this key K mail,",
    "start": "3678950",
    "end": "3686440"
  },
  {
    "text": "they can synthesize new\ntickets for the mail server without talking to the key DC. So suppose that I\nknow K mail and I",
    "start": "3686440",
    "end": "3692710"
  },
  {
    "text": "want to read your mail\nfrom the mail server. I'll just make up this ticket. I'll plop down all those five\nfields in the right order.",
    "start": "3692710",
    "end": "3699030"
  },
  {
    "text": "I'll generate a new key. I'll encrypt it with K mail. It'll look like the real\nthing generated by the KDC.",
    "start": "3699030",
    "end": "3705072"
  },
  {
    "text": "And I'll just connect\nto the mail server. And it'll decrypt it. It'll decrypt correctly and\nthen it'll think, oh, yeah, this is some particular user.",
    "start": "3705072",
    "end": "3712980"
  },
  {
    "text": "And you can read all their mail\nand you know the shared key and so on. So it's critically important\ntoo that no one knows",
    "start": "3712980",
    "end": "3719870"
  },
  {
    "text": "the secret key of a service. Because otherwise, not\nonly is the traffic to the service decryptable\nand observable,",
    "start": "3719870",
    "end": "3726330"
  },
  {
    "text": "but also you could impersonate\nanyone to that service. So this is actually all\npretty important in Kerberos.",
    "start": "3726330",
    "end": "3733730"
  },
  {
    "text": "Makes sense? Any questions? Yeah. STUDENT: So if the attacker\nhas to [INAUDIBLE],",
    "start": "3733730",
    "end": "3740547"
  },
  {
    "text": "what's stopping him from\nchanging the [INAUDIBLE] key [INAUDIBLE]?",
    "start": "3740548",
    "end": "3745785"
  },
  {
    "text": "PROFESSOR: Yeah, so presumably,\nhow you'd recover-- like, ISNT would, like, call up\nthe guy that runs this KDC and say, oh man, our mail\nserver got compromised.",
    "start": "3745785",
    "end": "3752569"
  },
  {
    "text": "Why don't you go and, like,\ndelete this key from there and put in this new key instead? So you'd probably want to\nhave some out of bounds",
    "start": "3752570",
    "end": "3758330"
  },
  {
    "text": "mechanism for proving that\nyou're really the mail server. Because we'll look\nat a second on how do",
    "start": "3758330",
    "end": "3763434"
  },
  {
    "text": "you change keys-- like a\npassword changing protocol, for example. And you can in general\nchange passwords in Kerberos.",
    "start": "3763434",
    "end": "3769410"
  },
  {
    "text": "So if you know the\nold password, you can change the user's password\nto a new password here. So in order to recover, you\nprobably-- like the attacker,",
    "start": "3769410",
    "end": "3776702"
  },
  {
    "text": "might get your key mail,\nchange it to something else. Someone with ISNT basically has\nto go to the Accounts office",
    "start": "3776702",
    "end": "3781750"
  },
  {
    "text": "and say, hey,\nwe're hear at ISNT. Could you please change the\npassword of the mail server for us?",
    "start": "3781750",
    "end": "3786920"
  },
  {
    "text": "And they're going to\ngenerate some new password the attacker doesn't know. So yeah, otherwise, if the\nattacker knows this key K mail,",
    "start": "3786920",
    "end": "3794230"
  },
  {
    "text": "there's nothing differentiating\nthe attacker from you, from the real mail\nserver operator. In fact, the attacker probably\nchanged the key so now they",
    "start": "3794230",
    "end": "3800976"
  },
  {
    "text": "know the new thing\nand you don't. It's like you're not on\nthe mail server anymore. So absolutely, you need\nsome out of band protocol",
    "start": "3800976",
    "end": "3807210"
  },
  {
    "text": "for initially registering\nprinciples in the database and for changing keys if you\nforget your password or someone",
    "start": "3807210",
    "end": "3814359"
  },
  {
    "text": "changes for you and\nyou lose it as well. So there's someone\nat MIT or there's",
    "start": "3814360",
    "end": "3820020"
  },
  {
    "text": "a group of people at\nMIT that help users register for accounts and\nchange their passwords by, you know, you present your\nMIT ID and say, oh, well, OK.",
    "start": "3820020",
    "end": "3828440"
  },
  {
    "text": "Well, whatever\nhappened, we'll be able to change your\nkey for you then. Make sense?",
    "start": "3828440",
    "end": "3833890"
  },
  {
    "text": "So it's pretty\nimportant, of course, to do that right so\nif the person that is allowing password resets does\nthe wrong thing when checking",
    "start": "3833890",
    "end": "3841310"
  },
  {
    "text": "your MIT ID, you'll be able to\ncompromise the system as well, right? So they are sort of part\nof the trusted computing",
    "start": "3841310",
    "end": "3846321"
  },
  {
    "text": "base in Kerberos, right? Like, anyone that can go\nand muck with the database is pretty important\nfor security here.",
    "start": "3846321",
    "end": "3853990"
  },
  {
    "text": "All right, so let's look at\nanother sort of interesting use of Kerberos, right? So you could use Kerberos to try\nto log into some remote machine",
    "start": "3853990",
    "end": "3862750"
  },
  {
    "text": "over SSH. And the way this would work\nis, of course, very similar to a mail server. You'd get a ticket\nfor the SSH server",
    "start": "3862750",
    "end": "3868881"
  },
  {
    "text": "and you'd send the ticket\nalong with your SSH connection. But what if you're SSHing\ninto Athena dot dial-up",
    "start": "3868881",
    "end": "3874860"
  },
  {
    "text": "and you don't have a Kerberos\nclient on your machine? You just want to log\ninto Athena dot dial-up with your regular password.",
    "start": "3874860",
    "end": "3882360"
  },
  {
    "text": "So how would Athena dial-up\nauthenticate you, then, if you're just plugging into\nthis machine with a password?",
    "start": "3882360",
    "end": "3888060"
  },
  {
    "text": "But you have no password\nfor Athena dot dial-up. It's on a Kerberos server. So which should\nthe dial-up machine",
    "start": "3888060",
    "end": "3893230"
  },
  {
    "text": "do when you log into\nit with a password? Yeah. STUDENT: You can\naccess the [INAUDIBLE]. PROFESSOR: Yeah, so\nthe dial-up is then",
    "start": "3893230",
    "end": "3898770"
  },
  {
    "text": "going to basically play the\nsame protocol logging you in. So it's going to send a request.",
    "start": "3898770",
    "end": "3903849"
  },
  {
    "text": "This thing, right? It's going to send a request\nto the Kerberos service asking, give me a ticket for, I\ndon't know, this user Alice.",
    "start": "3903850",
    "end": "3911550"
  },
  {
    "text": "And in response, it's going to\nget back this reply encrypted with Alice's password. And then it's going to try\nthe password you just applied",
    "start": "3911550",
    "end": "3919250"
  },
  {
    "text": "and see if it\ndecrypts correctly. And if it decrypts\ncorrectly, it's going to let you log in, right?",
    "start": "3919250",
    "end": "3925270"
  },
  {
    "text": "Yeah. STUDENT: You don't\neven really have to send your key\nto the SSH server.",
    "start": "3925270",
    "end": "3930370"
  },
  {
    "text": "Because it could\nrelay this back-- the dot encrypted thing with KC. It could relay that back to the\nuser over the SSH connection.",
    "start": "3930370",
    "end": "3938948"
  },
  {
    "text": "PROFESSOR: Potentially, yeah. Right, so this requires\nsome fancy SSH client that you might not have. But-- so yeah, absolutely right.",
    "start": "3938948",
    "end": "3945400"
  },
  {
    "text": "If you want to do\nthis right, you probably want to have a\nKerberos client on your machine and get a ticket\nyourself or maybe",
    "start": "3945400",
    "end": "3951370"
  },
  {
    "text": "proxy it somehow\nthrough the SSH server but not allow the SSH\nserver to have your key. That's probably a good plan.",
    "start": "3951370",
    "end": "3957270"
  },
  {
    "text": "STUDENT: [INAUDIBLE]\njust, the server could get through this wall [INAUDIBLE]",
    "start": "3957270",
    "end": "3962940"
  },
  {
    "text": "PROFESSOR: That's right. Then you might decrypt\nit and send back. OK, but in either case,\nright, all we're doing here is someone is going to try\nto decrypt this blob with KC.",
    "start": "3962940",
    "end": "3971279"
  },
  {
    "text": "And then the server is\ngoing to get this resolved and see if it looks right. It's going to allow you in.",
    "start": "3971279",
    "end": "3976476"
  },
  {
    "text": "Seem like a good plan? So, turns out this is actually\na fairly dangerous thing to do",
    "start": "3976476",
    "end": "3981760"
  },
  {
    "text": "and allows you to potentially\nlog into the SSH server as anyone. And the reason is\nthat previously,",
    "start": "3981760",
    "end": "3988650"
  },
  {
    "text": "when we were talking about\na client trying to log in, the client basically\nknew that it was trying to supply\na legitimate password,",
    "start": "3988650",
    "end": "3995340"
  },
  {
    "text": "it was getting a reply from\nthe right Kerberos server, and if it can decrypt it, then\nprobably the password works out",
    "start": "3995340",
    "end": "4000870"
  },
  {
    "text": "correctly. However, there's nothing\nhere in this protocol that authenticates the fact\nthat this reply is coming",
    "start": "4000870",
    "end": "4007500"
  },
  {
    "text": "from the right Kerberos server. So if I try to log into a\nmachine by typing in a password",
    "start": "4007500",
    "end": "4017470"
  },
  {
    "text": "and the machine sends\nout this request and some response\ncomes back that seems",
    "start": "4017470",
    "end": "4022700"
  },
  {
    "text": "to be encrypted with\nthe password I typed in, this response might not be\nfrom the Kerberos server.",
    "start": "4022700",
    "end": "4029750"
  },
  {
    "text": "So suppose I have some\nmachine I want to log into. I type a password X into it. And then the machine\nsends out this response.",
    "start": "4029750",
    "end": "4036960"
  },
  {
    "text": "And before the Kerberos\nserver can respond back with the real reply, I'll\nsend my own reply that",
    "start": "4036960",
    "end": "4043210"
  },
  {
    "text": "looks like this real response\nencrypted with my password X. And the workstation to which I\ntry to log in or the SSH server",
    "start": "4043210",
    "end": "4051539"
  },
  {
    "text": "is going to decrypt it\nwith my fake password. It's going to look OK\nbecause this response was generated by me rather than\nthe real Kerberos server.",
    "start": "4051540",
    "end": "4059880"
  },
  {
    "text": "And you'll be able to\nlog in This make sense?",
    "start": "4059880",
    "end": "4065394"
  },
  {
    "text": "Why does this happen? ",
    "start": "4065395",
    "end": "4071704"
  },
  {
    "text": "Yeah. STUDENT: [INAUDIBLE]\nthere's no authentication from the Kerberos\nserver [INAUDIBLE] PROFESSOR: Right,\nyeah, so there's",
    "start": "4071704",
    "end": "4077549"
  },
  {
    "text": "nothing really here that's\ntying this to the real Kerberos server. So the way that\nKerberos fixes this",
    "start": "4077550",
    "end": "4084849"
  },
  {
    "text": "for remotely accessible\nmachines like Athena dot dial-up is that\nthe dial-ups themselves",
    "start": "4084850",
    "end": "4091100"
  },
  {
    "text": "have some sort of a secret key\nthat they share with the KDC. So in order to log\nyou in into a dial-up",
    "start": "4091100",
    "end": "4096719"
  },
  {
    "text": "or to any workstation that\nreally cares about checking whether you are\nreally the right user, it's actually going\nto do two things.",
    "start": "4096720",
    "end": "4102700"
  },
  {
    "text": "It's going to first log you\ninto Kerberos like this. But then just because this\nreply decrypts correctly,",
    "start": "4102700",
    "end": "4108880"
  },
  {
    "text": "it's not going to trust that. It's going to try\nto get a service ticket for itself using TGS.",
    "start": "4108880",
    "end": "4115909"
  },
  {
    "text": "So the dial-up machine here\nhas its own secret key. And it logs you in\nwith this round one.",
    "start": "4115910",
    "end": "4122229"
  },
  {
    "text": "Then it talks to TGS\nsaying, oh, please give me a service ticket for\nmy own principle,",
    "start": "4122229",
    "end": "4128739"
  },
  {
    "text": "from the dial-up\nprinciple, for this client. Then it gets the response back. And then it checks if it can\ndecrypt the response correctly.",
    "start": "4128740",
    "end": "4135479"
  },
  {
    "text": "Because it knows the\ndial-up key for this KS. And if this decrpyts,\nthat it knows, oh yeah,",
    "start": "4135479",
    "end": "4141390"
  },
  {
    "text": "I must have talked to the\nright Kerberos server. Because only the\nright Kerberos server would have sent me this\nsecond round ticket encrypted",
    "start": "4141390",
    "end": "4147200"
  },
  {
    "text": "with my secret key K dial-up. So this is actually\npretty important.",
    "start": "4147200",
    "end": "4152778"
  },
  {
    "text": "And typically,\nAthena workstations don't do this extra step because\nAthena workstations don't have any secret\nkey stored on them",
    "start": "4152779",
    "end": "4159100"
  },
  {
    "text": "that's shared with the KDC. Why is this OK for Athena\nworkstations to let you log in in this one round\ntrip and not for dial-ups?",
    "start": "4159100",
    "end": "4166535"
  },
  {
    "text": "Yeah. STUDENT: If you don't have\naccess to any services because the attacker\ncouldn't forge the ticket. PROFESSOR: That's right, yeah.",
    "start": "4166535",
    "end": "4172284"
  },
  {
    "text": "So there's nothing interesting\non the dial-up machine itself-- sorry, on the\nworkstation itself. So workstation, whenever-- you\nhave root access on it anyway.",
    "start": "4172284",
    "end": "4179659"
  },
  {
    "text": "So if you log into it with\na fake password, who cares? It's not like you'll be\nable to do anything else",
    "start": "4179660",
    "end": "4185009"
  },
  {
    "text": "outside of your workstation. Whereas on a dial-up, things\nare much more interesting. It might be that you have\nother processes running",
    "start": "4185010",
    "end": "4190851"
  },
  {
    "text": "on the dial-up from\nother login sessions. And there, the fact that you log\nin with a particular Unix UID",
    "start": "4190851",
    "end": "4196440"
  },
  {
    "text": "is actually pretty important. And there, they really\nwant to authenticate that you are the right entity.",
    "start": "4196440",
    "end": "4202360"
  },
  {
    "text": "So that's why they do this sort\nof 2-step process for logging into some shared\ntime-sharing machine.",
    "start": "4202360",
    "end": "4209139"
  },
  {
    "text": "Make sense? All right, so the last\nthing I want to talk about",
    "start": "4209140",
    "end": "4215230"
  },
  {
    "text": "is how do we change keys. So we sort of talked about\nit briefly here with the idea that the mail server's\nkey might get compromised.",
    "start": "4215230",
    "end": "4222029"
  },
  {
    "text": "But as a user, you\nprobably also want to change passwords as well. Like, maybe you're thinking, oh,\nthat password is not so great",
    "start": "4222029",
    "end": "4228861"
  },
  {
    "text": "anymore. Maybe I accidentally wrote it\non a piece of paper and someone looked at it. So you probably\nwant to change it.",
    "start": "4228861",
    "end": "4234099"
  },
  {
    "text": "So the way this\nworks is actually at some level fairly\nstraightforward. So there's an extra interface\nto this Kerberos server.",
    "start": "4234100",
    "end": "4241440"
  },
  {
    "text": "In addition to Kerberos\nand TGS, there's this extra service\ncalled kpassword. ",
    "start": "4241440",
    "end": "4248719"
  },
  {
    "text": "And the service lets you\nchange your password. And the way it works is you\nget a ticket for this service",
    "start": "4248720",
    "end": "4255744"
  },
  {
    "text": "very much like you'd get\na ticket for the mail server or any other service. And then you send\nyour new password",
    "start": "4255744",
    "end": "4261592"
  },
  {
    "text": "to this kpassword service\nencrypted with your session key. And then if everything checks\nout, your key in the database",
    "start": "4261592",
    "end": "4268900"
  },
  {
    "text": "is going to be updated\nto the new key. Question. STUDENT: [INAUDIBLE]\nif there was, like,",
    "start": "4268900",
    "end": "4274736"
  },
  {
    "text": "no [INAUDIBLE] they wanted to\nhave them use a [INAUDIBLE] had to go through this. PROFESSOR: That's right. OK, yeah, OK. So this is a good point.",
    "start": "4274736",
    "end": "4280169"
  },
  {
    "text": "So for changing your\npassword, remember that we have this whole\ngoal that if someone steals your ticket, it shouldn't be\ngood enough to completely take",
    "start": "4280169",
    "end": "4288270"
  },
  {
    "text": "over your account. So for this reason, the key\npassword service actually doesn't accept just any ticket.",
    "start": "4288270",
    "end": "4294140"
  },
  {
    "text": "It accepts a ticket that you\ninitially get from the Kerberos service with your KC.",
    "start": "4294140",
    "end": "4299739"
  },
  {
    "text": "So the way this actually works\nis that inside of every ticket, in addition to all the stuff\nI showed you there, there's",
    "start": "4299740",
    "end": "4304763"
  },
  {
    "text": "an extra bit that tells you\nwhich of these two things gave you the ticket. So if you get the ticket\nfrom this Kerberos server,",
    "start": "4304763",
    "end": "4310960"
  },
  {
    "text": "the bit has one. If you get the ticket from the\nTGS server, the bit is zero, let's say. And then the kpassword service,\nin addition to everything",
    "start": "4310960",
    "end": "4318160"
  },
  {
    "text": "that any mail server or\nfile server would do, it also looks at the\nbit on the ticket and says, well, if you got it\nfrom Kerberos, that's good.",
    "start": "4318160",
    "end": "4324210"
  },
  {
    "text": "If you got it from\nTGS, that means that maybe you stole\nsomeone's ticket and you didn't know their\npassword right away.",
    "start": "4324210",
    "end": "4330000"
  },
  {
    "text": "So I'm not going to accept this. So this is how a key password\nensures that you can only change the password if you just\nknew the password immediately",
    "start": "4330000",
    "end": "4337637"
  },
  {
    "text": "prior to this. So you never actually supply\nthe old password to kpassword. You supply that to-- well,\nyou supply that in order",
    "start": "4337637",
    "end": "4344172"
  },
  {
    "text": "to decrypt the response\nfrom the Kerberos server for the kpassword\npassword principal. Makes sense?",
    "start": "4344172",
    "end": "4351390"
  },
  {
    "text": "All right, so let's\njust actually spell out",
    "start": "4351390",
    "end": "4356670"
  },
  {
    "text": "the interactions with\nthe key password service because there'll be something\na little bit interesting there.",
    "start": "4356670",
    "end": "4363320"
  },
  {
    "text": "So when you're going to\nchange your password, what",
    "start": "4363320",
    "end": "4368480"
  },
  {
    "text": "the client is going\nto do is, of course, obtain this initial\nticket from Kerberos.",
    "start": "4368480",
    "end": "4374989"
  },
  {
    "text": "So it sends a message to the\nKerberos service saying here is my client ID and I want to\ntalk to the kpassword service.",
    "start": "4374990",
    "end": "4383760"
  },
  {
    "text": "And the Kerberos server is\ngoing to send a response back including the ticket\nbetween the client",
    "start": "4383760",
    "end": "4389690"
  },
  {
    "text": "and the kpassword service\nencrypted with a key of kpass",
    "start": "4389690",
    "end": "4396370"
  },
  {
    "text": "and the shared key\nbetween KC and kpass.",
    "start": "4396370",
    "end": "4401801"
  },
  {
    "text": "Makes sense? This is exactly this thing\nup here encrypted with KC. Makes sense? Everyone's runs on board?",
    "start": "4401801",
    "end": "4408050"
  },
  {
    "text": "And then very much like you talk\nto a mail server, you take this and you send it to kpassword. You say, well, here's my\nticket-- tckpass encrypted",
    "start": "4408050",
    "end": "4417420"
  },
  {
    "text": "with kpass. And in addition, you\nsend your new password",
    "start": "4417420",
    "end": "4425370"
  },
  {
    "text": "and you encrypt this\nwith the key kcpass with shared key for\nyour interaction.",
    "start": "4425370",
    "end": "4432340"
  },
  {
    "text": "I just separated these\ntwo things out here. Make sense? So this is the thing you\nsend to the kpassword service",
    "start": "4432340",
    "end": "4437650"
  },
  {
    "text": "with a new password encrypted\nwith the session key. Yeah. STUDENT: But in the [INAUDIBLE] ",
    "start": "4437650",
    "end": "4446367"
  },
  {
    "text": "PROFESSOR: So if the\nattacker knows your password, they can change your\npassword-- absolutely.",
    "start": "4446367",
    "end": "4451420"
  },
  {
    "text": "So it seems reasonable, right? Like, there's no other way to\ntell whether it's you or not. If someone walks up to an\nAthena workstation, types",
    "start": "4451420",
    "end": "4457060"
  },
  {
    "text": "in your username and\npassword, runs password, change my password to this new\nthing, they know your password? They're going to be\nable to change it.",
    "start": "4457060",
    "end": "4463340"
  },
  {
    "text": "So that's totally the\nsame in almost any system you could imagine. This is true for Gmail probably. This is true for any system\nthat uses passwords in general.",
    "start": "4463340",
    "end": "4471239"
  },
  {
    "text": "The reason that we had to talk\nto the Kerberos server instead of the TGS server here is that\nif someone steals your ticket,",
    "start": "4471240",
    "end": "4479610"
  },
  {
    "text": "then we don't want them to be\nable to change your password. So if someone corrupts an Athena\nworkstation after you log in,",
    "start": "4479610",
    "end": "4486170"
  },
  {
    "text": "your password is gone from\nmemory, the ticket remains. You could, in principle,\nuse the ticket",
    "start": "4486170",
    "end": "4491370"
  },
  {
    "text": "to obtain more tickets for\nthe password changing service. But the password\nchanging service says that's not going\nto be good enough.",
    "start": "4491370",
    "end": "4497270"
  },
  {
    "text": "It's going to look\nat this ticket here-- ticket between the\nclient and the password service. And if that was\nupdated through TGS,",
    "start": "4497270",
    "end": "4504764"
  },
  {
    "text": "it's going to\nreject your request. It's only going to accept it\nif it was obtained directly from the Kerberos\nservice using KC.",
    "start": "4504764",
    "end": "4511260"
  },
  {
    "text": "Makes sense? Question. STUDENT: So if you [INAUDIBLE]\npassword with the [INAUDIBLE] Athena, right? PROFESSOR: Yeah. STUDENT: So if I would\nsteal your private key--",
    "start": "4511260",
    "end": "4518375"
  },
  {
    "text": "PROFESSOR: Yeah,\nso actually, KC is basically equivalent\nto your password here. As far as the Kerberos\nprotocol is concerned,",
    "start": "4518375",
    "end": "4524770"
  },
  {
    "text": "that don't even think\nthat you have a password. It thinks you have\na private key KC. If someone knows KC, that's\nbasically your password.",
    "start": "4524770",
    "end": "4531000"
  },
  {
    "text": "So you can change\nyour key from KC to something else so you\ndon't lose this thing, yeah. Uh, yeah, question?",
    "start": "4531000",
    "end": "4536690"
  },
  {
    "text": "STUDENT: [INAUDIBLE]\ninitial message [INAUDIBLE]",
    "start": "4536690",
    "end": "4541926"
  },
  {
    "text": "from changing the [INAUDIBLE] PROFESSOR: Oh, you\ncan certainly get a ticket for some other\nservice or an attacker",
    "start": "4541926",
    "end": "4548725"
  },
  {
    "text": "could drop this message\naltogether or corrupt this exchange. And then you're not going\nto successfully change your password. STUDENT: [INAUDIBLE]",
    "start": "4548725",
    "end": "4554088"
  },
  {
    "text": " PROFESSOR: Yeah, so\nthe client actually knows exactly what service\nit wants to talk to.",
    "start": "4554088",
    "end": "4560350"
  },
  {
    "text": "So if it-- it's going\nto make sure, well,",
    "start": "4560350",
    "end": "4567120"
  },
  {
    "text": "there are some messages, some\nparts of this protocol I'm not showing that allow the\nclient to make sure they actually got the\nticket for the right thing.",
    "start": "4567120",
    "end": "4574330"
  },
  {
    "text": "But yeah, so the-- sorry. Question? STUDENT: [INAUDIBLE] very easy\nto denial of service attack",
    "start": "4574330",
    "end": "4580941"
  },
  {
    "text": "when an attacker [INAUDIBLE]\nmodifying the encrypted version of the new password.",
    "start": "4580941",
    "end": "4586926"
  },
  {
    "text": "PROFESSOR: Yeah, so there's\nactually lot of things. Because, for example, Kerberos\ndoesn't do authentication",
    "start": "4586926",
    "end": "4594391"
  },
  {
    "text": "properly of messages--\nit just does encryption-- you could\ntotally corrupt this blob. And-- STUDENT: [INAUDIBLE]",
    "start": "4594392",
    "end": "4599870"
  },
  {
    "text": "PROFESSOR: Yeah, you\ncould flip it around and it'll decrypt\nto something else. The service was like, oh\nyeah, that's the new password, and set it.",
    "start": "4599870",
    "end": "4604882"
  },
  {
    "text": "And then you're\nsort of locked out. So it seems really unfortunate. And this is yet\nanother reason why you want separate encryption and\nauthentication in the protocol.",
    "start": "4604882",
    "end": "4612324"
  },
  {
    "text": "There's actually an even\nbigger problem here. But actually, yeah, question? STUDENT: What's the\npoint of having a one way function to [INAUDIBLE] your\npassword in KC if they're",
    "start": "4612325",
    "end": "4619196"
  },
  {
    "text": "essentially [INAUDIBLE]? PROFESSOR: Basically because\nKC is a 56-bit ds key",
    "start": "4619196",
    "end": "4625060"
  },
  {
    "text": "and your password might\nbe of different lengths. And even if it's longer\nthan 56 bits, which is seven bites or\nseven characters,",
    "start": "4625060",
    "end": "4631360"
  },
  {
    "text": "you want to use all\nthose extra bytes too. So it's mostly just to condense\nit down to a fixed width blob,",
    "start": "4631360",
    "end": "4637900"
  },
  {
    "text": "yeah. But there's actually a much\nmore interesting problem here, which is that suppose\nthat I change my password",
    "start": "4637900",
    "end": "4643990"
  },
  {
    "text": "and then I decide, OK,\nwell, I change my password. A day goes by and I'm\nthinking, oh yeah, sure.",
    "start": "4643990",
    "end": "4649929"
  },
  {
    "text": "I'll tell everyone what my\nstupid old password was. Is this a good idea in Kerberos?",
    "start": "4649930",
    "end": "4655200"
  },
  {
    "text": "Yeah. STUDENT: [INAUDIBLE]\nimmediately expire until the-- PROFESSOR: Yeah, OK. But someone's got to wait\nfor all my tickets to expire.",
    "start": "4655200",
    "end": "4660470"
  },
  {
    "text": "I wait for, like, a week. And then no tickets\nare good anymore. Can I give out my\nold password now?",
    "start": "4660470",
    "end": "4665611"
  },
  {
    "text": "Yeah. STUDENT: It might take\na while to replicate. PROFESSOR: Yeah,\nsuppose the replicas are all updated,\nyeah, all the stuff.",
    "start": "4665611",
    "end": "4671661"
  },
  {
    "text": "Yeah. STUDENT: [INAUDIBLE] if someone\nsaves the initial transaction [INAUDIBLE] to get,\nlike, your old password now that they have\nyour new password.",
    "start": "4671661",
    "end": "4677570"
  },
  {
    "text": "PROFESSOR: Yeah,\nso this is actually super worrisome\nin Kerberos, which is that-- suppose\nsome attacker was watching all of my\nprevious password changes.",
    "start": "4677570",
    "end": "4684240"
  },
  {
    "text": "They didn't know what my\npassword was or is or anything. But they're just saving these\npackets very diligently.",
    "start": "4684240",
    "end": "4690460"
  },
  {
    "text": "And then a month later, I\ngo and say, oh, my password was poodle or something\nsilly like this.",
    "start": "4690460",
    "end": "4695820"
  },
  {
    "text": "And then they go say ah, ha, ha. I can now decrypt\nthis initial thing because it was encrypted\nwith your old KC.",
    "start": "4695820",
    "end": "4701550"
  },
  {
    "text": "And I can get this KC\nwith pass that you shared. Then I can use this to\ndecrypt the new password",
    "start": "4701550",
    "end": "4707270"
  },
  {
    "text": "you sent to the KDC. And even if you change\nthe password again, I can decrypt the\nnext round as well. And you can just keep going\nand get the newest password.",
    "start": "4707270",
    "end": "4713833"
  },
  {
    "text": "So in this particular password,\nchanging protocol, if you ever disclose an old\npassword, then someone",
    "start": "4713833",
    "end": "4720040"
  },
  {
    "text": "could sort of unzip this whole\nchain of encrypted messages and get your newest\npassword as well.",
    "start": "4720040",
    "end": "4725860"
  },
  {
    "text": "This is actually very\ntroublesome in the design. Yeah. STUDENT: Doesn't the later\nversion of Kerberos [INAUDIBLE]",
    "start": "4725860",
    "end": "4731114"
  },
  {
    "text": "PROFESSOR: Absolutely, yes. So there's actually\na solution to this that's not sort of fundamental. And this is\nsomething they didn't realize in Kerberos version 4.",
    "start": "4731115",
    "end": "4737160"
  },
  {
    "text": "There's actually this nice\nmechanism called Diffie-Hellman that I'll just sketch\nout in like one minute",
    "start": "4737160",
    "end": "4743800"
  },
  {
    "text": "just so that you guys know\nwhen to use it or et cetera. But it's basically a solution\nfor this kind of a problem",
    "start": "4743800",
    "end": "4748920"
  },
  {
    "text": "where you want to stop this\nunzipping from happening. So what happens in\nthe Kerberos version 5 password changing protocol\nis that actually you",
    "start": "4748920",
    "end": "4756910"
  },
  {
    "text": "want to establish a new secret\nthat will not be apparent if you happen to decrypt all\nthe messages on the wire.",
    "start": "4756910",
    "end": "4763360"
  },
  {
    "text": "And the way this works\nis-- this is like some math that you don't have\nto fully understand. But the client some random value\nX. And the kpassword server is",
    "start": "4763360",
    "end": "4773590"
  },
  {
    "text": "going to pick some\nother random value Y. And what they send to each\nother are exponentiations of these values.",
    "start": "4773590",
    "end": "4779050"
  },
  {
    "text": "So the client sends\nG to the power X to the server and the server\nsends G to the power Y",
    "start": "4779050",
    "end": "4785810"
  },
  {
    "text": "back to the client. And it turns out\nthat mathematically, what we can do now is the\nclient can take G to the Y,",
    "start": "4785810",
    "end": "4792110"
  },
  {
    "text": "raise it to X, and get\nthis value G to the XY. The server can take G to the\nX, raise it to the power Y,",
    "start": "4792110",
    "end": "4798680"
  },
  {
    "text": "and get G to the XY as well. They can now use this\nsecret value G to the XY to encrypt their\nsubsequent messages,",
    "start": "4798680",
    "end": "4805440"
  },
  {
    "text": "including the new password. So you send the new password\nencrypted with this value G",
    "start": "4805440",
    "end": "4811263"
  },
  {
    "text": "to the XY, roughly speaking. But for some\nmathematical reasons that we're not going\nto cover right now,",
    "start": "4811263",
    "end": "4816600"
  },
  {
    "text": "it turns out to be super\ndifficult for someone that just gets G to the X and G to the Y\nby examining your packets later",
    "start": "4816600",
    "end": "4823350"
  },
  {
    "text": "from figuring out\nwhat was G to the XY. So this is something called\nthe discrete log problem.",
    "start": "4823350",
    "end": "4828560"
  },
  {
    "text": "Yeah, question? STUDENT: But they have to\n[INAUDIBLE] G at some point. PROFESSOR: Yeah, yeah. So G is some parameter\nyou could sort of send at the beginning of a protocol\nor it could be just cooked",
    "start": "4828560",
    "end": "4835910"
  },
  {
    "text": "into Kerberos. It turns out to be\nrelatively less important.",
    "start": "4835910",
    "end": "4842030"
  },
  {
    "text": "All right, so anyway, use\nDiffie-Hellman because this is called-- well, what you\nshould Google for if you're building a protocol like this\nis this Diffie-Hellman key",
    "start": "4842030",
    "end": "4850920"
  },
  {
    "text": "exchange protocol. And Kerberos 5 actually\ndoes this correctly. But this is something\nto really watch out",
    "start": "4850920",
    "end": "4856010"
  },
  {
    "text": "for if you're designing any\nkind of new protocol yourself. All right, so that's\nit for Kerberos. Let's talk about SSL on Monday.",
    "start": "4856010",
    "end": "4863160"
  }
]