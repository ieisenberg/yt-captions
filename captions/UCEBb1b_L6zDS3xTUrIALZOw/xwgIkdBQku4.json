[
  {
    "text": "The following content is\nprovided under a Creative Commons license. Your support will help\nMIT OpenCourseWare",
    "start": "0",
    "end": "6330"
  },
  {
    "text": "continue to offer high-quality\neducational resources for free. To make a donation or\nview additional materials",
    "start": "6330",
    "end": "13320"
  },
  {
    "text": "from hundreds of MIT courses,\nvisit MIT OpenCourseWare at ocw.mit.edu.",
    "start": "13320",
    "end": "18369"
  },
  {
    "text": " RUSS TEDRAKE: OK, welcome back.",
    "start": "18370",
    "end": "23800"
  },
  {
    "text": " So last week, we spent the week\ntalking about policy search",
    "start": "23800",
    "end": "31510"
  },
  {
    "text": "methods, and trying to make\na distinction between those and the value-based\nmethods we started with.",
    "start": "31510",
    "end": "39040"
  },
  {
    "text": "And by the end of the\nweek, we had a couple pretty slick methods\nfor optimizing",
    "start": "39040",
    "end": "46660"
  },
  {
    "text": "an open-loop trajectory\nof the system. So we talked about\nat least two ways.",
    "start": "46660",
    "end": "52360"
  },
  {
    "start": "52360",
    "end": "75790"
  },
  {
    "text": "So by open-loop, I mean\nit's a function of time, not a function of state.",
    "start": "75790",
    "end": "80880"
  },
  {
    "text": "We talked about the\nshooting methods,",
    "start": "80880",
    "end": "90750"
  },
  {
    "text": "where we evaluated J of alpha\nx0 times 0 just by simulation.",
    "start": "90750",
    "end": "107070"
  },
  {
    "text": "And we evaluated-- explicitly\nevaluated the gradients by--",
    "start": "107070",
    "end": "115495"
  },
  {
    "text": "well, I gave you two\nalgorithms for it. I gave you one that I called\nback prop through time--",
    "start": "115495",
    "end": "121750"
  },
  {
    "text": "which was an adjoint method-- and another one\nthat I called RTRL--",
    "start": "121750",
    "end": "126990"
  },
  {
    "text": "real-time recurrent\nlearning, which are the names from the\nneural network community, but perfectly good\nnames for those methods.",
    "start": "126990",
    "end": "134490"
  },
  {
    "start": "134490",
    "end": "146292"
  },
  {
    "text": "And then the claim\nwas that, if you can compute those two\nthings by simulation or--",
    "start": "146292",
    "end": "153780"
  },
  {
    "text": "forward simulation and then\na back propagation pass, or a simulation, which carried\nalso the derivatives forward",
    "start": "153780",
    "end": "160890"
  },
  {
    "text": "in time, then we could\nhand those gradients to SNOPT or some other\nnon-linear optimization",
    "start": "160890",
    "end": "170364"
  },
  {
    "text": "package.  And if we're good, we\ncan also lean on SNOPT",
    "start": "170365",
    "end": "176400"
  },
  {
    "text": "to handle things like\nfinal value constraints. If you want to make sure\nthe trajectory succeeds in getting you\nexactly to the goal",
    "start": "176400",
    "end": "182610"
  },
  {
    "text": "or if you want to make sure that\nyour torques are never bigger than some maximum\ntalk allowed, then you can take advantage of that.",
    "start": "182610",
    "end": "190770"
  },
  {
    "text": "And the second method, remember,\nwas direct co-location method, which we often\nabbreviate as DIRCOL.",
    "start": "190770",
    "end": "197400"
  },
  {
    "text": " And the big idea there\nwas to over-parameterized",
    "start": "197400",
    "end": "206290"
  },
  {
    "text": "our optimization with the\nopen-loop trajectory, but also",
    "start": "206290",
    "end": "218099"
  },
  {
    "text": "the state trajectory,\nwhich makes coming up",
    "start": "218100",
    "end": "224780"
  },
  {
    "text": "with gradients simple.",
    "start": "224780",
    "end": "231485"
  },
  {
    "text": " And then I have to enforce\nthe constraint that x of--",
    "start": "231485",
    "end": "245455"
  },
  {
    "text": "let's say, in\ndiscrete time here, n plus 1 had better be\nsubject to the dynamics--",
    "start": "245455",
    "end": "251301"
  },
  {
    "start": "251301",
    "end": "257560"
  },
  {
    "text": "so two very similar\nmethods of trying",
    "start": "257560",
    "end": "263230"
  },
  {
    "text": "to compute some\nopen-loop trajectory",
    "start": "263230",
    "end": "268673"
  },
  {
    "text": "as a function of time. Ultimately, what I care\nabout is a set of actions that I apply over time that\nwill get me to the goal",
    "start": "268673",
    "end": "277539"
  },
  {
    "text": "or minimize my cost function. In the case where I\nexplicitly parameterized",
    "start": "277540",
    "end": "284020"
  },
  {
    "text": "an open-loop trajectory,\nboth of these results",
    "start": "284020",
    "end": "290770"
  },
  {
    "text": "in a solution which satisfies\nthe Pontryagin minimum principle, subject\nto discretization",
    "start": "290770",
    "end": "299323"
  },
  {
    "text": "errors and things like that. ",
    "start": "299323",
    "end": "329636"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE] RUSS TEDRAKE: We did, right.",
    "start": "329636",
    "end": "335220"
  },
  {
    "text": "So I should say, subject\nto time discretization.",
    "start": "335220",
    "end": "340540"
  },
  {
    "text": "That's the one place\nwhere technically, it would satisfy a discrete\ntime version of Pontryagin's",
    "start": "340540",
    "end": "347980"
  },
  {
    "text": "minimum principle. AUDIENCE: [INAUDIBLE]",
    "start": "347980",
    "end": "361895"
  },
  {
    "text": "RUSS TEDRAKE: You\ncan think of it whichever way it\nmakes you happier-- so in fact, the parameters\nthat you hand in--",
    "start": "361895",
    "end": "369900"
  },
  {
    "text": "maybe it's easier to think\nof it as a function-- a discrete function of time,\nbecause you're going to hand it",
    "start": "369900",
    "end": "375210"
  },
  {
    "text": "u at certain points in time,\nand you're going to handle x--",
    "start": "375210",
    "end": "380310"
  },
  {
    "text": "hand it x at certain\npoints in time. And this discrete time update\ncan be an Euler integration",
    "start": "380310",
    "end": "387300"
  },
  {
    "text": "or a higher order integration\nof your continuous dynamics, but you only satisfy\nthe constraints",
    "start": "387300",
    "end": "392760"
  },
  {
    "text": "of discrete intervals of time. Yeah. ",
    "start": "392760",
    "end": "399660"
  },
  {
    "text": "OK, I did give you a\nslightly more general-- I tried to point out that these\nmethods could equally well",
    "start": "399660",
    "end": "407470"
  },
  {
    "text": "compute, find good parameters of\na feedback control or something too.",
    "start": "407470",
    "end": "413800"
  },
  {
    "text": "The simple case was\nwhen my parameters alpha were explicitly my\ncontrol tape, but more",
    "start": "413800",
    "end": "420879"
  },
  {
    "text": "generally, if you wanted\nto tune a feedback controller-- a linear\nfeedback controller, or a non-linear\nfeedback controller,",
    "start": "420880",
    "end": "426580"
  },
  {
    "text": "or a neural network,\nor whatever it is, you can use the same\nmethods to do that. I would only make this\nstatement in the case",
    "start": "426580",
    "end": "433600"
  },
  {
    "text": "where the controller\nspecifically is the open-loop tape,\nbecause if I parameterized",
    "start": "433600",
    "end": "446267"
  },
  {
    "text": "my trajectory by some feedback\ncontroller, for instance, then that's going to\nrestrict the policy class. That's going to restrict\nthe class of tapes",
    "start": "446267",
    "end": "453250"
  },
  {
    "text": "that I can look over, which\nmakes it a more compact, more efficient way to solve\nyour optimization,",
    "start": "453250",
    "end": "458889"
  },
  {
    "text": "but potentially prevents\nyou from achieving a perfect minimum. ",
    "start": "458890",
    "end": "466998"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE] RUSS TEDRAKE: Yep. So by virtue of saying\nthat they satisfy",
    "start": "466998",
    "end": "473163"
  },
  {
    "text": "Pontryagin's minimum\nprinciple, we know that that's\nonly a local optima. This says that I can't\nmake a small change in u",
    "start": "473163",
    "end": "481479"
  },
  {
    "text": "to get better performance. Yep. But it's only a necessary\ncondition for optimality, not",
    "start": "481480",
    "end": "488692"
  },
  {
    "text": "a sufficient one.  But there's a bigger problem\nwith it-- with both of those.",
    "start": "488692",
    "end": "496220"
  },
  {
    "text": "And that's the fact\nthat they're completely useless in real\nlife, unless I do",
    "start": "496220",
    "end": "503320"
  },
  {
    "text": "one more step, which is to\nstabilize the trajectory as I get out. So finding some open-loop\ntrajectory by these methods,",
    "start": "503320",
    "end": "515529"
  },
  {
    "text": "satisfying Pontryagin's\nminimum principle-- fine. But there's nothing in\nthis process that says,",
    "start": "515530",
    "end": "522760"
  },
  {
    "text": "if I don't-- if I changed my\ninitial conditions by epsilon, I could completely\ndiverge when I follow--",
    "start": "522760",
    "end": "528970"
  },
  {
    "text": "when I execute that\nopen-loop trajectory. If I change my simulation\ntime step by a little bit,",
    "start": "528970",
    "end": "535330"
  },
  {
    "text": "I might diverge. If I have modeling\nerrors, I might diverge. ",
    "start": "535330",
    "end": "541120"
  },
  {
    "text": "So in order to make these\nuseful for a real system, we have to do\nanother step, which is trajectory stabilization.",
    "start": "541120",
    "end": "548350"
  },
  {
    "text": "And it actually follows quite\nnaturally from the things we've already talked about.",
    "start": "548350",
    "end": "553530"
  },
  {
    "text": "OK, so today we're going\nto give these guys teeth with a trajectory optimization.",
    "start": "553530",
    "end": "558896"
  },
  {
    "start": "558896",
    "end": "592160"
  },
  {
    "text": "And I'll show you\nexamples of a trajectory that's optimized beautifully\nfor the pendulum even, and if I simulate it a\nlittle differently back--",
    "start": "592160",
    "end": "599060"
  },
  {
    "text": "just does the wrong thing. It never gets to the top. So we want to get\nrid of that problem.",
    "start": "599060",
    "end": "606459"
  },
  {
    "text": " OK, so the solution is to design\na trajectory stabilization.",
    "start": "606460",
    "end": "612675"
  },
  {
    "start": "612675",
    "end": "619330"
  },
  {
    "text": "Now, for those of\nyou that have been",
    "start": "619330",
    "end": "627040"
  },
  {
    "text": "playing with robots\nfor many years, when you hear trajectory\nstabilization, what do you think of? What kind of tricks\nto people use",
    "start": "627040",
    "end": "633730"
  },
  {
    "text": "for trajectory stabilization?  AUDIENCE: Sliding surfaces.",
    "start": "633730",
    "end": "638860"
  },
  {
    "text": "RUSS TEDRAKE: Sliding surfaces--\nthat's a good one for-- [INAUDIBLE] often will\ndesign a sliding surface",
    "start": "638860",
    "end": "645820"
  },
  {
    "text": "and squish the aerodynamics.  That's actually\npretty encompassing.",
    "start": "645820",
    "end": "653320"
  },
  {
    "text": "I think a lot of the\ntrajectory stabilizers are based on sliding\nmodes or feedback",
    "start": "653320",
    "end": "659410"
  },
  {
    "text": "linearization in some form. And all I'll say about it\nis that the story's sort",
    "start": "659410",
    "end": "666388"
  },
  {
    "text": "of the same as\neverything we've said. If you have a fully\nactuated system, it's not hard to design\na trajectory stabilizer.",
    "start": "666388",
    "end": "674980"
  },
  {
    "text": "A good sliding mode\ncontroller could take-- could work even for an\nunderactuated system,",
    "start": "674980",
    "end": "681190"
  },
  {
    "text": "but I think there's a-- I prefer the linear\nquadratic form of these trajectories\nstabilizers.",
    "start": "681190",
    "end": "687610"
  },
  {
    "text": "OK, so we want to do a\ntrajectory stabilization that's suitable for\nunderactuated systems.",
    "start": "687610",
    "end": "693410"
  },
  {
    "start": "693410",
    "end": "705069"
  },
  {
    "text": "And the approach is\ngoing to be with LQR. ",
    "start": "705070",
    "end": "722490"
  },
  {
    "text": "OK, so if we're\ngoing to use LQR, we better be able to\nlinearize our system. ",
    "start": "722490",
    "end": "728920"
  },
  {
    "text": "So far, when we've done\nthe linearizations, we've only done them\nat fixed points.",
    "start": "728920",
    "end": "735875"
  },
  {
    "text": "So the first thing\nwe have to ask ourselves is, what happens if\nwe try to linearize at a more",
    "start": "735875",
    "end": "741060"
  },
  {
    "text": "arbitrary point in state space? Yeah. ",
    "start": "741060",
    "end": "751860"
  },
  {
    "text": "So let's say I've got the\nsystem x dot equals f of xu,",
    "start": "751860",
    "end": "758890"
  },
  {
    "text": "and now I want to linearize\naround some x0, u0, but not",
    "start": "758890",
    "end": "766200"
  },
  {
    "text": "necessarily a carefully\nchosen x0, u0-- just something random\nin state space.",
    "start": "766200",
    "end": "771270"
  },
  {
    "text": " The Taylor expansion\nof this says",
    "start": "771270",
    "end": "777810"
  },
  {
    "text": "that this thing's going\nto be approximately f of x0, u0, partial f,\npartial x evaluated at x.",
    "start": "777810",
    "end": "789579"
  },
  {
    "start": "789579",
    "end": "807209"
  },
  {
    "text": "OK, and we called this\nbefore A and this B, and so that thing we can\nactually write as, in general,",
    "start": "807210",
    "end": "829509"
  },
  {
    "text": "in the case where f\nof x0, u0-- if x0, u0 was a fixed\npoint of the system,",
    "start": "829510",
    "end": "834790"
  },
  {
    "text": "that term disappears,\nbut be careful. If you're doing your\nlinearization out here,",
    "start": "834790",
    "end": "842860"
  },
  {
    "text": "if you're at-- not\nat a fixed point, if you have any\nvelocity, for instance, then, in the original\nx-coordinates,",
    "start": "842860",
    "end": "851915"
  },
  {
    "text": "it's not actually-- the Taylor\nexpansion doesn't give you a linear system. It gives you some affine system. This thing is harder\nto work with-- not",
    "start": "851915",
    "end": "858768"
  },
  {
    "text": "incredibly harder, but\nharder to work with. ",
    "start": "858768",
    "end": "863820"
  },
  {
    "text": "The solution is quite\nsimple, but I just wanted to say it\nthe bad way first",
    "start": "863820",
    "end": "870820"
  },
  {
    "text": "so that you appreciate\nthe good way. If we change coordinates\nand we use instead",
    "start": "870820",
    "end": "887779"
  },
  {
    "text": "for our coordinates the\ndifference between x and x0",
    "start": "887780",
    "end": "897530"
  },
  {
    "text": "of t, then x bar dot is going\nto be x dot minus x0 dot",
    "start": "897530",
    "end": "927080"
  },
  {
    "text": "equals x dot minus f of\nx0, u0, which is that C.",
    "start": "927080",
    "end": "937730"
  },
  {
    "text": "This guy here is taken care of\nin this new coordinate system,",
    "start": "937730",
    "end": "945149"
  },
  {
    "text": "which allows me to write\nthe whole thing as x bar dot equals A of x bar.",
    "start": "945150",
    "end": "951680"
  },
  {
    "start": "951680",
    "end": "963220"
  },
  {
    "text": "You with me on that? Linearizing a system at\na more arbitrary point--",
    "start": "963220",
    "end": "971290"
  },
  {
    "text": "doing a Taylor expansion\nresults in a linear system only if you change\ncoordinates to lie",
    "start": "971290",
    "end": "977639"
  },
  {
    "text": "on some system trajectory. So x0, u0 must be a solution of\nx of f of xu of that equation.",
    "start": "977640",
    "end": "1000650"
  },
  {
    "text": "And then the system reduces to\na linear system description.",
    "start": "1000650",
    "end": "1006830"
  },
  {
    "text": "But the cost you pay for\nthis beautiful, simple-- well, let me be even a\nlittle bit more careful.",
    "start": "1006830",
    "end": "1014600"
  },
  {
    "text": "So A here, this\npartial f, partial x,",
    "start": "1014600",
    "end": "1021690"
  },
  {
    "text": "is evaluated at xt u of t.",
    "start": "1021690",
    "end": "1027030"
  },
  {
    "text": "And in general,\nA and B in this-- when I do this are functions\nof time, as well as x and t.",
    "start": "1027030",
    "end": "1035603"
  },
  {
    "text": " That's a pretty important point. ",
    "start": "1035603",
    "end": "1042730"
  },
  {
    "text": "So if I'm willing to change\ncoordinates to live along the trajectory, then the\nresult is I can get this linear",
    "start": "1042730",
    "end": "1049420"
  },
  {
    "text": "time-varying model of the\ndynamics along feasible trajectories--",
    "start": "1049420",
    "end": "1055540"
  },
  {
    "text": "system trajectories. The cost is that\nyou have to work in a coordinate system that\nmoves along your trajectory.",
    "start": "1055540",
    "end": "1063340"
  },
  {
    "text": "So we'll see where that\ncomes in in a little bit. But the first question is, OK,\nlet's say I've got this linear",
    "start": "1063340",
    "end": "1068980"
  },
  {
    "text": "time-varying-- time-varying linear system. Can I do all the things\nI want to do with that?",
    "start": "1068980",
    "end": "1075940"
  },
  {
    "text": "In most of our control classes,\nwe end up doing LTI systems. ",
    "start": "1075940",
    "end": "1082779"
  },
  {
    "text": "LTV systems-- linear\ntime-varying-- ",
    "start": "1082780",
    "end": "1099070"
  },
  {
    "text": "are actually a fantastically\nrich class of systems",
    "start": "1099070",
    "end": "1104679"
  },
  {
    "text": "that we don't talk about\nenough, I think, in life. They're still linear systems. Superposition still holds.",
    "start": "1104680",
    "end": "1113320"
  },
  {
    "text": "If I have initial\ncondition 1 and some u",
    "start": "1113320",
    "end": "1122210"
  },
  {
    "text": "trajectory 1 for t\ngreater than equal to t0,",
    "start": "1122210",
    "end": "1128649"
  },
  {
    "text": "and that gives me some\nresulting x trajectory out for t greater than t0, and\nI have another solution",
    "start": "1128650",
    "end": "1140710"
  },
  {
    "text": "with a different\ninitial condition and a different control, and\nthat gives me a different--",
    "start": "1140710",
    "end": "1154760"
  },
  {
    "text": "I call this x1, x2 for t\ngreater than or equal to t0--",
    "start": "1154760",
    "end": "1160240"
  },
  {
    "start": "1160240",
    "end": "1165420"
  },
  {
    "text": "if I have that,\nthen it better be the case that alpha 1 x1\nof t0 plus alpha 2 x2 of t0",
    "start": "1165420",
    "end": "1177960"
  },
  {
    "text": "plus alpha 1 u1 tape\nplus alpha 2 u2 tape",
    "start": "1177960",
    "end": "1188520"
  },
  {
    "text": "is going to result\nin a trajectory which is alpha 1 x1 plus alpha 2 x2.",
    "start": "1188520",
    "end": "1195779"
  },
  {
    "text": " That's superposition.",
    "start": "1195780",
    "end": "1201330"
  },
  {
    "text": "That's the defining\ncharacteristic of linearity.",
    "start": "1201330",
    "end": "1208470"
  },
  {
    "text": "And even though this is a\nricher class of systems-- these A of t, x of\nt, B of t, u of t--",
    "start": "1208470",
    "end": "1217200"
  },
  {
    "text": "superposition still holds. ",
    "start": "1217200",
    "end": "1222710"
  },
  {
    "text": "And in fact, a lot\nof our derivations that we've done that are for\nlinear systems still hold.",
    "start": "1222710",
    "end": "1228140"
  },
  {
    "start": "1228140",
    "end": "1236660"
  },
  {
    "text": "OK, so now the question\nis, how do we design-- how do we work with the fact\nthat this thing is still easy,",
    "start": "1236660",
    "end": "1242950"
  },
  {
    "text": "and design a\ncontroller that works with this new linearized system? ",
    "start": "1242950",
    "end": "1273117"
  },
  {
    "text": "Maybe first I should break out\nmy colored chalk and make sure we have intuition about this. ",
    "start": "1273118",
    "end": "1281278"
  },
  {
    "text": "Do you understand\nwhat this is doing, if I do this time-varying\nlinearization?",
    "start": "1281278",
    "end": "1286769"
  },
  {
    "text": "Let me do an example\nwith the pendulum here, our favorite\ntheta, theta dot.",
    "start": "1286770",
    "end": "1294480"
  },
  {
    "text": "And let's say we carve up-- we find some nice solution which\ngets me from my one fixed point",
    "start": "1294480",
    "end": "1303420"
  },
  {
    "text": "to the other fixed point. The ones we were getting were\nthese pump-up trajectories, which looked\nsomething like this.",
    "start": "1303420",
    "end": "1309570"
  },
  {
    "start": "1309570",
    "end": "1316029"
  },
  {
    "text": "I'm moving through\nstate space here, and the dynamics here vary\nwith state in a non-linear way.",
    "start": "1316030",
    "end": "1325660"
  },
  {
    "text": "But if I have a trajectory,\na feasible trajectory that goes through the\nrelevant parts of state space,",
    "start": "1325660",
    "end": "1332230"
  },
  {
    "text": "then this time-varying\nlinearization takes my non-linear system, and\nmakes it parameterized",
    "start": "1332230",
    "end": "1340570"
  },
  {
    "text": "only-- instead of by being\nparameterized by state, it's going to make\nit parameterized only by time along the trajectory.",
    "start": "1340570",
    "end": "1348483"
  },
  {
    "text": " The trick is the\ntrajectory allows",
    "start": "1348483",
    "end": "1361910"
  },
  {
    "text": "me to reparameterize my\nnon-linearity in terms of time,",
    "start": "1361910",
    "end": "1381720"
  },
  {
    "text": "instead of state. It sounds like a simple thing-- I'm just reparameterizing it-- but it makes all the\ndifference in the world.",
    "start": "1381720",
    "end": "1388170"
  },
  {
    "text": "If things are parameterized\nas a function of time, and are otherwise linear,\nthen I could do all kinds",
    "start": "1388170",
    "end": "1393902"
  },
  {
    "text": "of computation on them. I can integrate the equations. I can design quadratic\nregulators on it.",
    "start": "1393902",
    "end": "1400832"
  },
  {
    "text": "It makes all the\ndifference in the world. ",
    "start": "1400832",
    "end": "1406650"
  },
  {
    "text": "So what I'm effectively\ndoing is coming up with local linear\nrepresentations of the dynamics",
    "start": "1406650",
    "end": "1414360"
  },
  {
    "text": "along the trajectory. I'm not sure if this is a\nhelpful way for me to draw it, but you can think of this thing\nas approximating the dynamics",
    "start": "1414360",
    "end": "1421710"
  },
  {
    "text": "along that trajectory. At every given\ninstant in time, I'm going to use one of\nthese linear models.",
    "start": "1421710",
    "end": "1429600"
  },
  {
    "text": "This is supposed\nto be some plane that you're driving through-- not sure if that's\nactually helpful graphic, but it's the\nway I think of it.",
    "start": "1429600",
    "end": "1437919"
  },
  {
    "text": " And by virtue of taking a\nparticular path through,",
    "start": "1437920",
    "end": "1444279"
  },
  {
    "text": "I can make locally linear\nmodels on which these things have eigenvectors,\nand eigenvalues,",
    "start": "1444280",
    "end": "1449320"
  },
  {
    "text": "or whatever that are\nvalid in the neighborhood",
    "start": "1449320",
    "end": "1454480"
  },
  {
    "text": "of the trajectory. So if you can imagine, even\nwithout any stabilization,",
    "start": "1454480",
    "end": "1462970"
  },
  {
    "text": "it could be that I\ncould quickly assess the stability of my\ntime-varying linear model.",
    "start": "1462970",
    "end": "1470170"
  },
  {
    "text": "And trajectories in\nthis linear model may converge to the\nnominal limit cycle,",
    "start": "1470170",
    "end": "1475900"
  },
  {
    "text": "or they may diverge,\ndepending on A and B. Or they may blow up.",
    "start": "1475900",
    "end": "1482380"
  },
  {
    "text": " This is by far the more\ncommon case, unfortunately.",
    "start": "1482380",
    "end": "1488470"
  },
  {
    "text": "You'd be very lucky to come\nout of a shooting method or a direct co-location method,\nand end up with a system",
    "start": "1488470",
    "end": "1493570"
  },
  {
    "text": "where if you played it\nout, it just happened to be a stable trajectory. But we can assess\nall that quickly",
    "start": "1493570",
    "end": "1500260"
  },
  {
    "text": "with these time-varying\nlinearizations found locally.",
    "start": "1500260",
    "end": "1505810"
  },
  {
    "text": "Make sense? Yeah? AUDIENCE: [INAUDIBLE]\ntalk about that there",
    "start": "1505810",
    "end": "1512330"
  },
  {
    "text": "is a bad way of doing this. This is not a bad way\nof doing this, right? We were talkinga about it. ",
    "start": "1512330",
    "end": "1521559"
  },
  {
    "text": "RUSS TEDRAKE: If I do a\nTaylor expansion of my system in the original coordinate\nsystem, which is x,",
    "start": "1521560",
    "end": "1528040"
  },
  {
    "text": "then it's not linear. End parentheses, that\nwas the bad way to do it.",
    "start": "1528040",
    "end": "1533170"
  },
  {
    "text": "Yeah? Good way to do it-- change the coordinates to\na coordinate system, which",
    "start": "1533170",
    "end": "1539500"
  },
  {
    "text": "moves with the trajectory. If you do that, things\nbecome time-varying linear.",
    "start": "1539500",
    "end": "1546523"
  },
  {
    "text": "That was a good way to\ndo it, and that's still in open parentheses. We're still going. Yeah. ",
    "start": "1546523",
    "end": "1560210"
  },
  {
    "text": "OK, so our task now is to\ndesign a time-varying feedback",
    "start": "1560210",
    "end": "1566360"
  },
  {
    "text": "controller-- since our\nmodel is time-varying, you'd expect our solution\nto also be time-varying--",
    "start": "1566360",
    "end": "1571970"
  },
  {
    "text": "which takes these bad, unstable\ntrajectories of the system-- and they really are-- I'll show you simple pendulum.",
    "start": "1571970",
    "end": "1579350"
  },
  {
    "text": "This trajectory comes out. Actually, if you just\nintegrate in a different way, it'll go off and\ndo the wrong thing.",
    "start": "1579350",
    "end": "1584929"
  },
  {
    "text": "It typically doesn't go off\nand add energy to the system so much. The ones I get-- I see, I'll show you, are more--",
    "start": "1584930",
    "end": "1591230"
  },
  {
    "text": "they diverge and the other way,\nand end up just floating around here, for instance.",
    "start": "1591230",
    "end": "1597260"
  },
  {
    "text": "But they're not going\nto get you up here. So can we design a\ntime-varying stabilizer",
    "start": "1597260",
    "end": "1605150"
  },
  {
    "text": "that regulates that trajectory? ",
    "start": "1605150",
    "end": "1616230"
  },
  {
    "text": "OK, I did actually do the\noriginal finite horizon LQR",
    "start": "1616230",
    "end": "1624570"
  },
  {
    "text": "derivation on the\nboard that day--",
    "start": "1624570",
    "end": "1630419"
  },
  {
    "text": "definitely won't write\nall that again, but let me say that roughly nothing\nin that derivation breaks--",
    "start": "1630420",
    "end": "1642790"
  },
  {
    "text": "I'm going to show you\nthe important pieces-- nothing in that derivation\nbreaks, surprisingly,",
    "start": "1642790",
    "end": "1648260"
  },
  {
    "text": "if A and B are now\na function of time. So let's remember that--",
    "start": "1648260",
    "end": "1653670"
  },
  {
    "start": "1653670",
    "end": "1662480"
  },
  {
    "text": "the LQR derivation. ",
    "start": "1662480",
    "end": "1676860"
  },
  {
    "text": "Now I'm working with this\nx bar coordinate system. ",
    "start": "1676860",
    "end": "1692150"
  },
  {
    "text": "And I want to design\na cost function to minimize here, which lives\nin this coordinate system",
    "start": "1692150",
    "end": "1697460"
  },
  {
    "text": "again here. Let's say it's the\nfinal horizon times Qf--",
    "start": "1697460",
    "end": "1704795"
  },
  {
    "text": " I've been trying\nto use t little f,",
    "start": "1704795",
    "end": "1710600"
  },
  {
    "text": "since my transposes look\nlike the final horizon time otherwise--",
    "start": "1710600",
    "end": "1716179"
  },
  {
    "text": "0 to tf dt x bar-- again, transpose\nQ plus u bar Ru.",
    "start": "1716180",
    "end": "1726380"
  },
  {
    "start": "1726380",
    "end": "1737800"
  },
  {
    "text": "OK, in the original\nLQR derivation, we guessed that the form--",
    "start": "1737800",
    "end": "1743590"
  },
  {
    "text": "that the optimal policy had\nthe form x bar S of t x bar.",
    "start": "1743590",
    "end": "1753850"
  },
  {
    "text": "That's still intact. That's still a good assumption. This thing's linear.",
    "start": "1753850",
    "end": "1759108"
  },
  {
    "text": "It's just in a different\ncoordinate system. ",
    "start": "1759108",
    "end": "1765620"
  },
  {
    "text": "And we started cranking through\nthe sufficiency theorem, the Hamilton-Jacobi-Bellman\nequation.",
    "start": "1765620",
    "end": "1772900"
  },
  {
    "start": "1772900",
    "end": "1781590"
  },
  {
    "text": "And we found that our\noptimal feedback policy-- first of all, our\noptimal cost-to-go",
    "start": "1781590",
    "end": "1787080"
  },
  {
    "text": "was described by this\nRiccati equation, which was negative S of t\nis Q minus S of t B",
    "start": "1787080",
    "end": "1800670"
  },
  {
    "text": "our inverse B transpose S of t\nplus S of t A plus A transpose",
    "start": "1800670",
    "end": "1814500"
  },
  {
    "text": "S of t. And it turns out that,\nwith the-- if you have a time-varying A\nand B, that it's--",
    "start": "1814500",
    "end": "1821490"
  },
  {
    "text": "exact same dynamics govern it. You just have your time\ndependence also in A and B.",
    "start": "1821490",
    "end": "1830100"
  },
  {
    "text": "And that exact same\nRiccati equation works,",
    "start": "1830100",
    "end": "1835190"
  },
  {
    "text": "and our final value\ncondition was just Qf.",
    "start": "1835190",
    "end": "1840220"
  },
  {
    "start": "1840220",
    "end": "1849813"
  },
  {
    "text": "And you can see from this, if it\ndidn't make a difference for me when A and B became\nfunctions of time,",
    "start": "1849813",
    "end": "1856160"
  },
  {
    "text": "it's pretty simple-- although\nless interesting, I guess. If Q were to be a function\nof time-- no problem.",
    "start": "1856160",
    "end": "1862160"
  },
  {
    "text": "If R was a function\nof time-- no problem. ",
    "start": "1862160",
    "end": "1868039"
  },
  {
    "text": "They still have to be positive\ndefinite and symmetric.",
    "start": "1868040",
    "end": "1874580"
  },
  {
    "start": "1874580",
    "end": "1884450"
  },
  {
    "text": "Oops-- I did it the wrong way. Q can be 0, but R can not be 0.",
    "start": "1884450",
    "end": "1889520"
  },
  {
    "start": "1889520",
    "end": "1898910"
  },
  {
    "text": "OK, so the LQR\nyou know and love, that you've used in Matlab,\nis the time invariant infinite",
    "start": "1898910",
    "end": "1908120"
  },
  {
    "text": "horizon LQR. I told you that, if you\ncared about a finite horizon and you had a time invariant\nlinear system, then",
    "start": "1908120",
    "end": "1915530"
  },
  {
    "text": "suddenly you had to-- you couldn't just find the\nstationary points in this. Remember, Matlab's solution\njust tells you the long-term",
    "start": "1915530",
    "end": "1921590"
  },
  {
    "text": "behavior of S. In the time--",
    "start": "1921590",
    "end": "1926779"
  },
  {
    "text": "finite horizon time,\neven the LTI case, which is the A and B\ndo not depend on time--",
    "start": "1926780",
    "end": "1933480"
  },
  {
    "text": "the linear time invariant case-- I still had to integrate back\nthis Riccati equation in order to get my LQR controller.",
    "start": "1933480",
    "end": "1940730"
  },
  {
    "text": "It's no more expensive\nto do the same thing in the linear time-varying\nfeedback case.",
    "start": "1940730",
    "end": "1945890"
  },
  {
    "text": " And the resulting\ncontroller is--",
    "start": "1945890",
    "end": "1952400"
  },
  {
    "text": " u star is my nominal controller\nminus my R inverse B transpose",
    "start": "1952400",
    "end": "1965650"
  },
  {
    "text": "S of t x bar. ",
    "start": "1965650",
    "end": "1979809"
  },
  {
    "text": "These equations come\nup enough that these are pretty famous, pretty\nimportant equations, and so I--",
    "start": "1979810",
    "end": "1987220"
  },
  {
    "text": "those I know off\nthe top of my head. They come up all the time. ",
    "start": "1987220",
    "end": "1995320"
  },
  {
    "text": "And this is the resulting\noptimal trajectory, which is my nominal trajectory\nplus my feedback gain, which",
    "start": "1995320",
    "end": "2002840"
  },
  {
    "text": "came out of my original\nLQR controller, if you remember that. ",
    "start": "2002840",
    "end": "2008872"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE] RUSS TEDRAKE: Yes-- good.",
    "start": "2008872",
    "end": "2014020"
  },
  {
    "text": "I should definitely put\na T under B. Thank you.",
    "start": "2014020",
    "end": "2019372"
  },
  {
    "text": "I haven't written that case,\nbut R could equally well be time-dependent. ",
    "start": "2019372",
    "end": "2029020"
  },
  {
    "text": "OK, so something\nbig just happened. ",
    "start": "2029020",
    "end": "2034660"
  },
  {
    "text": "I can take a really, really\ncomplicated non-linear system",
    "start": "2034660",
    "end": "2039880"
  },
  {
    "text": "along some trajectory-- if\nI find a good trajectory, then I can actually\nlinearize that system",
    "start": "2039880",
    "end": "2046210"
  },
  {
    "text": "along this trajectory\nand stabilize it. The thing I haven't convinced\nyou of yet-- because I only",
    "start": "2046210",
    "end": "2052330"
  },
  {
    "text": "know how to do it\nfrom showing examples, but it really works well.",
    "start": "2052330",
    "end": "2057590"
  },
  {
    "text": "So even though it's\na linear system-- it's a linear approximation\nof the non-linear system,",
    "start": "2057590",
    "end": "2063609"
  },
  {
    "text": "something like the [INAUDIBLE]\nor the cartpole swing-up. It's got a huge\nbasin of attraction.",
    "start": "2063610",
    "end": "2069699"
  },
  {
    "text": "Lots and lots of\ninitial conditions will find their way to the\ntrajectory and get to the goal.",
    "start": "2069699",
    "end": "2075339"
  },
  {
    "text": "If you want to do non-linear\ncontrol of a humanoid robot or something like this, this\nactually scales pretty nicely.",
    "start": "2075340",
    "end": "2085449"
  },
  {
    "text": "I just have to\nsolve this equation. S is the size-- is a matrix that's\nby number of states.",
    "start": "2085449",
    "end": "2094570"
  },
  {
    "text": "But I could do that\nin 30 dimensions. That's no problem. And even for very\nnon-linear systems,",
    "start": "2094570",
    "end": "2101500"
  },
  {
    "text": "local linear feedback\nworks very, very well-- so well, in fact, that I\nthink that, if you ask--",
    "start": "2101500",
    "end": "2108740"
  },
  {
    "text": "and when I did ask\nthe [INAUDIBLE] guys, Sasha Megretski says,\nthis is definitely",
    "start": "2108740",
    "end": "2113743"
  },
  {
    "text": "what I would do if I was\ncontrolling a walking robot or something like that.",
    "start": "2113743",
    "end": "2119770"
  },
  {
    "text": "We're trying to do the\nsame thing to control neurons in a dish now. We're trying to\nbuild good models",
    "start": "2119770",
    "end": "2125020"
  },
  {
    "text": "of the dynamics-- time-varying\nmodels, for instance-- and then doing this\nkind of control.",
    "start": "2125020",
    "end": "2130530"
  },
  {
    "text": "Yeah. It works really, really well. The only complaint\nabout it is that it's",
    "start": "2130530",
    "end": "2137500"
  },
  {
    "text": "going to have-- it's based\non this linear approximation, so it will have a finite\nbasin of attraction.",
    "start": "2137500",
    "end": "2143559"
  },
  {
    "text": "For some systems,\nit can be quite big. If you have systems with\nhard non-linearities,",
    "start": "2143560",
    "end": "2148809"
  },
  {
    "text": "it won't be as big. Later in the course,\nI'll show you ways to explicitly reason\nabout the size of those basins",
    "start": "2148810",
    "end": "2155320"
  },
  {
    "text": "of attraction, but\ntoday let's just say this is a good\nthing to know,",
    "start": "2155320",
    "end": "2160523"
  },
  {
    "text": "good thing to have\nin your pocket. ",
    "start": "2160523",
    "end": "2166430"
  },
  {
    "text": "Let me show you a working-- try to convince you\nthat it's pretty good. ",
    "start": "2166430",
    "end": "2203910"
  },
  {
    "text": "OK, so let's see where\nI've left myself here. I took this-- the pendulum--",
    "start": "2203910",
    "end": "2210020"
  },
  {
    "text": "let's do the shooting version. They both work fine, but\nlet's do the shooting version. ",
    "start": "2210020",
    "end": "2220130"
  },
  {
    "text": "Is that bigger than\nI did last time? That's pretty obnoxious. Maybe it's always\nbeen obnoxious. ",
    "start": "2220130",
    "end": "2229660"
  },
  {
    "text": "Can we get away with that? Yeah. You guys are like,\nI'm not blind.",
    "start": "2229660",
    "end": "2236300"
  },
  {
    "text": "OK. ",
    "start": "2236300",
    "end": "2242090"
  },
  {
    "text": "So I showed you last\ntime the shooting code. It comes out with a\nresulting tape x, t, and u.",
    "start": "2242090",
    "end": "2251809"
  },
  {
    "text": "After the result of these\ntrajectory optimizers, whether it's shooting\nor whether it's",
    "start": "2251810",
    "end": "2257180"
  },
  {
    "text": "direct co-location--\nwhatever it is-- it comes up with\nsome open-loop tape. I put x in there too just to--\nas the reference trajectory",
    "start": "2257180",
    "end": "2263720"
  },
  {
    "text": "that results, but\nwhat really matters is the time stamps and u\ncommand, the open-loop tape.",
    "start": "2263720",
    "end": "2270140"
  },
  {
    "start": "2270140",
    "end": "2298119"
  },
  {
    "text": "Why don't I save it this time? ",
    "start": "2298120",
    "end": "2314260"
  },
  {
    "text": "OK, so it comes\nup-- in this case, with these parameters\nI've chosen, comes up with some\none-pump policy. With the torque limits I\nhave, the [INAUDIBLE] I have,",
    "start": "2314260",
    "end": "2321750"
  },
  {
    "text": "it comes up with a one-pump\npolicy that gets me to the top in four seconds.",
    "start": "2321750",
    "end": "2327510"
  },
  {
    "text": "OK, let me now just simulate\nthat a little bit differently.",
    "start": "2327510",
    "end": "2333421"
  },
  {
    "start": "2333421",
    "end": "2346190"
  },
  {
    "text": "So the only thing I'm\ngoing to do here now is-- this control_ode is just a\nsimulation which plays back",
    "start": "2346190",
    "end": "2355599"
  },
  {
    "text": "exactly the same open-loop\ntape, but it plays it back with a little more\ncareful integration--",
    "start": "2355600",
    "end": "2360970"
  },
  {
    "text": "because in the actual-- in\nthe shooting code I used, I used the big time step just\nso I don't waste time computing",
    "start": "2360970",
    "end": "2366010"
  },
  {
    "text": "gradients to the n-th\ndegree of accuracy. That's not worthwhile. If I simulate the\nexact same thing back",
    "start": "2366010",
    "end": "2371140"
  },
  {
    "text": "with a more careful\node integration, let's see what happens. ",
    "start": "2371140",
    "end": "2383690"
  },
  {
    "text": "So that was that same\ntrajectory that-- exact same control inputs,\njust simulated more carefully.",
    "start": "2383690",
    "end": "2389980"
  },
  {
    "text": "It made its honest\neffort to get up there, but it didn't\nquite get up there, turned around, and\ncame back down.",
    "start": "2389980",
    "end": "2396549"
  },
  {
    "text": "I'm trying to show\nit also in just-- this is the different state\ntrajectories over time.",
    "start": "2396550",
    "end": "2403640"
  },
  {
    "text": "You can see that the\nred and blue lines are the desired versus actual\nin the-- in theta, in this case.",
    "start": "2403640",
    "end": "2409570"
  },
  {
    "text": "And these two lines\nare the desired versus actual in theta dot.",
    "start": "2409570",
    "end": "2415075"
  },
  {
    "text": "They start off exactly\non top of each other, but just little\ndifferences in the numerics causes them to go in\ndifferent directions--",
    "start": "2415075",
    "end": "2423020"
  },
  {
    "text": "part ways.  OK, so now I've got\nthis LTV LQR solution,",
    "start": "2423020",
    "end": "2432240"
  },
  {
    "text": "which is exactly what\nI just showed you. ",
    "start": "2432240",
    "end": "2440020"
  },
  {
    "text": "So I was just simulating\na just now with just u being the nominal u. Now I'm going to add this\ntime-varying feedback term,",
    "start": "2440020",
    "end": "2447810"
  },
  {
    "text": "x minus x desired. ",
    "start": "2447810",
    "end": "2455030"
  },
  {
    "text": "And now my more\ncareful integration results in a closed-loop system,\nwhich not only got to the goal,",
    "start": "2455030",
    "end": "2460829"
  },
  {
    "text": "but actually stayed up\nat the goal, because I have a stable system\nall the way to the top.",
    "start": "2460830",
    "end": "2466590"
  },
  {
    "text": "OK? All right, so what I just\nsaid was very unimpressive. I said I computed a open-loop\npolicy with my methods",
    "start": "2466590",
    "end": "2475580"
  },
  {
    "text": "from Thursday. I simulated them back. They didn't work. But I then put a\nfeedback controller",
    "start": "2475580",
    "end": "2481212"
  },
  {
    "text": "on, and from the exact\nsame initial conditions, I now can simulate\nthem, and they work. So it's disappointing that\nwe had to do that at all,",
    "start": "2481212",
    "end": "2489510"
  },
  {
    "text": "but I can now-- the stability is more\nthan just stabilizing",
    "start": "2489510",
    "end": "2494870"
  },
  {
    "text": "the initial conditions. Let's add some fairly\nbig random numbers to that initial condition\nand see what happens.",
    "start": "2494870",
    "end": "2501590"
  },
  {
    "text": " It's recomputing the\npolicy every time,",
    "start": "2501590",
    "end": "2509387"
  },
  {
    "text": "just because it was\nfast enough that I didn't bother to change it. OK, so that actually\nstarted with pretty big",
    "start": "2509387",
    "end": "2515710"
  },
  {
    "text": "different initial conditions. So theta was off by--",
    "start": "2515710",
    "end": "2520755"
  },
  {
    "text": "I don't know-- 2/10 of a\nradian or something like this. The velocities were off by\n1/2 a radian per second.",
    "start": "2520756",
    "end": "2526212"
  },
  {
    "text": "We could crank that up. I bet it does a lot\nbetter than that. But if you watch\nthese things, they",
    "start": "2526212",
    "end": "2531609"
  },
  {
    "text": "converge quite nicely to\ntogether at the end there. ",
    "start": "2531610",
    "end": "2542580"
  },
  {
    "text": "And what matters is\nthey get up to the top. ",
    "start": "2542580",
    "end": "2552069"
  },
  {
    "text": "So again, these things come\ntogether, find their way up to the top, and live.",
    "start": "2552070",
    "end": "2557770"
  },
  {
    "text": "I bet, if I put it a lot\nbigger, it'll still work.",
    "start": "2557770",
    "end": "2564280"
  },
  {
    "text": "I normally do an\norder of magnitude, but let's not be silly.",
    "start": "2564280",
    "end": "2570470"
  },
  {
    "text": "Oh-- didn't make it. There's only one reason it\ndidn't make it, actually.",
    "start": "2570470",
    "end": "2576130"
  },
  {
    "text": "It's because, if\nyou look in here, I'm actually honest about\nimplementing the max torques.",
    "start": "2576130",
    "end": "2582830"
  },
  {
    "text": "Yeah. So I actually have a\ntorque limit, I impose it, and it lives on there. If I didn't, I bet\nI could convince you",
    "start": "2582830",
    "end": "2588532"
  },
  {
    "text": "it works for any\ninitial condition. But let's try it one more\ntime-- get a little more lucky with the initial conditions.",
    "start": "2588532",
    "end": "2594561"
  },
  {
    "text": " Oh, come on. Come on. Yes.",
    "start": "2594561",
    "end": "2601420"
  },
  {
    "text": "OK, that was pretty far off, and\nit's still found its way back to the trajectory. Good-- yeah?",
    "start": "2601420",
    "end": "2607780"
  },
  {
    "text": "Look at how big those\ninitial conditions are. There and there versus--\nwow, that's really good.",
    "start": "2607780",
    "end": "2614680"
  },
  {
    "text": "OK. Did I see a question? No? All right, so this stuff\nworks for pendulum.",
    "start": "2614680",
    "end": "2622690"
  },
  {
    "text": "It works for more\ninteresting systems too. I'll just show you the\ncartpole real quick here. ",
    "start": "2622690",
    "end": "2633140"
  },
  {
    "text": "I won't do the-- here is what it looks\nlike without feedback. I'll just do the initial\nconditions corrupted solution,",
    "start": "2633140",
    "end": "2642680"
  },
  {
    "text": "pump up-- OK, so if you remember my\nsolutions from last time, I never drove off\nthe screen before,",
    "start": "2642680",
    "end": "2649140"
  },
  {
    "text": "so that it was actually it\ncatching it by deviating enough that it came off\nthe screen, and then slowly coming back to the top.",
    "start": "2649140",
    "end": "2654720"
  },
  {
    "start": "2654720",
    "end": "2661000"
  },
  {
    "text": "It must be its x position\nor something going way off. No, not x position--\nwhat is that? That's my control.",
    "start": "2661000",
    "end": "2666560"
  },
  {
    "text": "Yeah. Did I do torque\nlimits on that one? I still did torque limits. I just set them high, I guess.",
    "start": "2666560",
    "end": "2673589"
  },
  {
    "text": "Yeah. So it really works. And the cool thing is\nthe cost of implementing",
    "start": "2673590",
    "end": "2679319"
  },
  {
    "text": "that LQR LTV stabilizer\nwas negligibly more than implementing the--",
    "start": "2679320",
    "end": "2686040"
  },
  {
    "text": "most of that time was the\nshooting optimization. ",
    "start": "2686040",
    "end": "2695575"
  },
  {
    "text": "Yes? AUDIENCE: Why do you\nalways start at the 0 time? You could look at the\ninitial conditions",
    "start": "2695575",
    "end": "2701750"
  },
  {
    "text": "and look where is\nthe closest point on my nominal trajectories and\nthen do your control policy",
    "start": "2701750",
    "end": "2708109"
  },
  {
    "text": "from that moment in time. RUSS TEDRAKE: OK. So that's a really, really good. OK, that's exactly what I want\nto talk about next, actually.",
    "start": "2708110",
    "end": "2715530"
  },
  {
    "start": "2715530",
    "end": "2723740"
  },
  {
    "text": "I designed a time-varying\nfeedback controller,",
    "start": "2723740",
    "end": "2731480"
  },
  {
    "text": "is negative K of t x bar of t.",
    "start": "2731480",
    "end": "2736580"
  },
  {
    "text": "I designed that ahead of time. And then, from the\ninitial conditions, I started simulating from 0,\nand I just played out the--",
    "start": "2736580",
    "end": "2745970"
  },
  {
    "text": "my nominal trajectory just\nmarched forward with time, my feedback controller just\nmarched forward with time, and my aerodynamics just\nmarched forward with time.",
    "start": "2745970",
    "end": "2754070"
  },
  {
    "text": "OK, so before I explicitly\naddress your question, let me point out-- let me ask even a\nsimpler question here.",
    "start": "2754070",
    "end": "2762320"
  },
  {
    "start": "2762320",
    "end": "2768187"
  },
  {
    "text": "If I had plotted that in state\nspace, what you would have seen is that the trajectory starts\noff somewhere in state space",
    "start": "2768187",
    "end": "2774040"
  },
  {
    "text": "and comes together. That would have a good idea. Maybe I should do\nthat in a minute. But it comes together and finds\nits way onto that trajectory.",
    "start": "2774040",
    "end": "2781390"
  },
  {
    "text": "Yeah?  OK, so here's the question. ",
    "start": "2781390",
    "end": "2788950"
  },
  {
    "text": "Instead of just changes\nin initial conditions, what happens if I\nhave disturbances",
    "start": "2788950",
    "end": "2794110"
  },
  {
    "text": "that push me off the trajectory? Well, that's OK. That's no different really than\na different initial condition.",
    "start": "2794110",
    "end": "2799900"
  },
  {
    "text": "They'll come back on here. What happens if I have\na disturbance that pushes me along the trajectory\nwith this controller?",
    "start": "2799900",
    "end": "2809140"
  },
  {
    "text": "Let's say I've got the\nhelpful disturbance, which,",
    "start": "2809140",
    "end": "2814329"
  },
  {
    "text": "when I was right\nhere, just happened to push me right to there.",
    "start": "2814330",
    "end": "2819609"
  },
  {
    "text": " What's my feedback\ncontroller going to do?",
    "start": "2819610",
    "end": "2826030"
  },
  {
    "text": "AUDIENCE: Slow it down. RUSS TEDRAKE: Yeah-- probably\nin a dramatic fashion.",
    "start": "2826030",
    "end": "2832910"
  },
  {
    "text": "It's the same way-- it tries\nto quickly converge from here. It's going to push itself back\ntowards that point, possibly.",
    "start": "2832910",
    "end": "2840850"
  },
  {
    "text": "Slowing down doesn't--\nmakes it sound-- no big deal. It can't go backwards,\nbut it might",
    "start": "2840850",
    "end": "2845860"
  },
  {
    "text": "try to do something more\nsevere to try to catch up with that old trajectory.",
    "start": "2845860",
    "end": "2853509"
  },
  {
    "text": "So the major limitation of\nthis is that it's blindly-- in order to have the strong\nconvergence properties",
    "start": "2853510",
    "end": "2859869"
  },
  {
    "text": "that we have, the controller\nis blindly marching forward in time.",
    "start": "2859870",
    "end": "2865330"
  },
  {
    "text": "The great thing about switching\nto a time parameterization I can compute everything--\neverything's linear again.",
    "start": "2865330",
    "end": "2872080"
  },
  {
    "text": "The bad thing is\nyou're a slave to time. So Phillip asked\na next question.",
    "start": "2872080",
    "end": "2879100"
  },
  {
    "text": "He says, so why not-- why do I just blindly start\nmarching forward from time 0?",
    "start": "2879100",
    "end": "2885010"
  },
  {
    "text": "Maybe, if I have a\ncontroller, I should just look for the closest\npoint in my trajectory,",
    "start": "2885010",
    "end": "2892030"
  },
  {
    "text": "and then, instead of\nindexing off time, index off some sort of phase,\nsome fraction of my trajectory,",
    "start": "2892030",
    "end": "2898780"
  },
  {
    "text": "and then execute\nthat controller. And you can do that.",
    "start": "2898780",
    "end": "2905710"
  },
  {
    "text": "I wish you the best\nif you do that, but my suspicion is\nthat, if on every dt,",
    "start": "2905710",
    "end": "2911950"
  },
  {
    "text": "you pick the closest\npoint in the trajectory, then the result is you're going\nto chatter like you wouldn't believe.",
    "start": "2911950",
    "end": "2918369"
  },
  {
    "text": "So there's a lot of\nprotection you get when you-- you could think\nof this very much as a gain-scheduled\nlinear controller.",
    "start": "2918370",
    "end": "2926980"
  },
  {
    "text": "This is a time-varying\ngain scheduling, and the problem is if\nI switch gain quickly,",
    "start": "2926980",
    "end": "2932900"
  },
  {
    "text": "then you're going\nto get chattering. So it might make a lot\nof sense, for instance, if you were to get a big\ndisturbance, to re-evaluate,",
    "start": "2932900",
    "end": "2940743"
  },
  {
    "text": "and try to find\nthe closest point, and start executing that new\npolicy with time re-indexed.",
    "start": "2940743",
    "end": "2946690"
  },
  {
    "text": "But it's probably a bad\nidea, in my experience, to decide which part\nof the trajectory",
    "start": "2946690",
    "end": "2952450"
  },
  {
    "text": "you're closest to on every-- every dt. That's probably a bad idea.",
    "start": "2952450",
    "end": "2957510"
  },
  {
    "start": "2957510",
    "end": "2963250"
  },
  {
    "text": "Yes? AUDIENCE: Could you\nmaybe play some tricks if you had some idea of\nthe basin of attraction",
    "start": "2963250",
    "end": "2968815"
  },
  {
    "text": "of the current point\nyou're trying to get to? And if you know that\nyou're outside of it, then work around\nit, [INAUDIBLE]??",
    "start": "2968815",
    "end": "2976540"
  },
  {
    "text": "RUSS TEDRAKE: Yes.  So I have a particular trick\nthe does that does that in--",
    "start": "2976540",
    "end": "2985270"
  },
  {
    "text": "we'll talk about it in\nthe motion planning, but-- yeah, so Mark knows\nabout these tricks",
    "start": "2985270",
    "end": "2990400"
  },
  {
    "text": "for computing basins of\nattraction pretty efficiently. And so these days what\nwe do is we actually",
    "start": "2990400",
    "end": "2997150"
  },
  {
    "text": "try to compute the funnel-- the basin of attraction\nof this trajectory around the trajectory, and\nyou could know discretely",
    "start": "2997150",
    "end": "3005610"
  },
  {
    "text": "if you left that\nbasin of attraction. So I'll give you\nthe recipe for that, but it actually\nmakes more sense,",
    "start": "3005610",
    "end": "3011010"
  },
  {
    "text": "I think, in the motion planning\ncontext, where we actually will design\ntrajectories that fill",
    "start": "3011010",
    "end": "3016713"
  },
  {
    "text": "the space with these basins.  This is very similar to\nthe concept of flow tubes.",
    "start": "3016713",
    "end": "3024190"
  },
  {
    "text": "Yes. ",
    "start": "3024190",
    "end": "3032390"
  },
  {
    "text": "OK, so big idea-- turn my non-linear system into\na linear time-varying system,",
    "start": "3032390",
    "end": "3040160"
  },
  {
    "text": "because I've re-parameterized\nit that along the trajectory. Do linear time-varying control,\nand even really complicated",
    "start": "3040160",
    "end": "3048770"
  },
  {
    "text": "systems-- it'll work well. We're doing on our\n[INAUDIBLE] plane. I mean, it's really\na pretty good idea.",
    "start": "3048770",
    "end": "3056510"
  },
  {
    "text": " When I first started\nworking with it, I thought that it would\nhave the problem that--",
    "start": "3056510",
    "end": "3065599"
  },
  {
    "text": " it would have the property\nthat it uses a lot of control",
    "start": "3065600",
    "end": "3072500"
  },
  {
    "text": "to force itself back\nto the trajectory and rigidly follow\nthe trajectory. It's easy to equate\nlinear control",
    "start": "3072500",
    "end": "3079130"
  },
  {
    "text": "with high-gain linear feedback,\nwhich people do a lot of, but it doesn't necessarily\nneed that property.",
    "start": "3079130",
    "end": "3084590"
  },
  {
    "text": "If R is small in\nthis derivation, it can actually take very\nsubtle approaches back",
    "start": "3084590",
    "end": "3090440"
  },
  {
    "text": "to the trajectory. Your system might come\nin and do whatever it needs to get back on\nthe trajectory with very",
    "start": "3090440",
    "end": "3096470"
  },
  {
    "text": "little torque. ",
    "start": "3096470",
    "end": "3101880"
  },
  {
    "text": "The only price you pay is,\nif your torque is smaller, if you're penalizing\ntorque use higher,",
    "start": "3101880",
    "end": "3108650"
  },
  {
    "text": "then you might restrict\nyour-- that might shrink your basin of attraction. It might be that, because it's\ntrying to use less torque,",
    "start": "3108650",
    "end": "3116450"
  },
  {
    "text": "it will not overcome\nthe non-linearities. But in the neighborhood\nof the trajectory, you can get these\nvery elegant solutions",
    "start": "3116450",
    "end": "3125089"
  },
  {
    "text": "which look like minimal\nenergy kind of solutions for the non-linear\nproblem in the vicinity of these trajectories.",
    "start": "3125090",
    "end": "3130829"
  },
  {
    "text": "So one of the ideas we'll\ntalk about later is how do you design the minimal set\nof trajectories-- which, if you use these controllers,\nwhich do the right thing",
    "start": "3130830",
    "end": "3139077"
  },
  {
    "text": "in a lot of places-- ",
    "start": "3139077",
    "end": "3145187"
  },
  {
    "text": "if you walked away from\nthis class knowing nothing but direct co-location and\nlinear time-varying feedback",
    "start": "3145187",
    "end": "3151350"
  },
  {
    "text": "control, I bet you could\ncontrol a lot of cool systems. Yeah. I guess you also have to\nknow sys id, which I'm not",
    "start": "3151350",
    "end": "3157555"
  },
  {
    "text": "going to tell you about. That's the gotcha. You have to have a model\nfor all this stuff.",
    "start": "3157555",
    "end": "3162633"
  },
  {
    "text": " If someone gives you\na model, if you're willing to construct a model,\nthen you can do a lot of things",
    "start": "3162633",
    "end": "3170130"
  },
  {
    "text": "with this. ",
    "start": "3170130",
    "end": "3178569"
  },
  {
    "text": "OK, I want to give you\none more mental picture",
    "start": "3178570",
    "end": "3185770"
  },
  {
    "text": "to think about what this\nis doing so it launches into the next thing here.",
    "start": "3185770",
    "end": "3193340"
  },
  {
    "text": "So my cost-to-go function, which\nI just erased, is, remember--",
    "start": "3193340",
    "end": "3200140"
  },
  {
    "text": "my cost-to-go function, J of x\nbar t, is x bar S of t x bar.",
    "start": "3200140",
    "end": "3209890"
  },
  {
    "text": " This is a quadratic form.",
    "start": "3209890",
    "end": "3215680"
  },
  {
    "text": "Just like the original\nLQR, you can think of this as a quadratic bowl. In the LTI LQR case--",
    "start": "3215680",
    "end": "3222340"
  },
  {
    "text": "am I OK throwing around\nthese three-letter acronyms? In the LTI LQR case, it\nwas a static quadratic bowl",
    "start": "3222340",
    "end": "3231339"
  },
  {
    "text": "centered around the point\nI'm trying to stabilize-- so my cost-to-go. It said-- says, as I move\naway from the point I'm trying",
    "start": "3231340",
    "end": "3239260"
  },
  {
    "text": "to regulate, I'm going to incur\nmore cost in the direction--",
    "start": "3239260",
    "end": "3244380"
  },
  {
    "text": "the rate it grows depends\non the variables inside S.",
    "start": "3244380",
    "end": "3250809"
  },
  {
    "text": "Now, in this picture, I\nhave still a time-varying--",
    "start": "3250810",
    "end": "3255910"
  },
  {
    "text": "I have a time-varying\nquadratic bowl, but it's also\nmoving through time,",
    "start": "3255910",
    "end": "3262630"
  },
  {
    "text": "because it's based on x bar.",
    "start": "3262630",
    "end": "3267940"
  },
  {
    "text": "So in my pendulum world, if I\nhave this nominal trajectory,",
    "start": "3267940",
    "end": "3276099"
  },
  {
    "text": "you can think of it as having\nsome quadratic bowl here. ",
    "start": "3276100",
    "end": "3281950"
  },
  {
    "text": "And the LTI stabilizer\nthat we did come up with that was based\non LQR did have",
    "start": "3281950",
    "end": "3287080"
  },
  {
    "text": "some sort of quadratic bowl\nshape that looked like that. ",
    "start": "3287080",
    "end": "3293377"
  },
  {
    "text": "Backwards in time, there's going\nto be another quadratic bowl. Can I draw it very\nbadly like this?",
    "start": "3293377",
    "end": "3298450"
  },
  {
    "start": "3298450",
    "end": "3304010"
  },
  {
    "text": "If I can just draw coming off\nthe board a little bit-- so there's some quadratic bowl\ncentered around this point,",
    "start": "3304010",
    "end": "3311940"
  },
  {
    "text": "which is my costs-to-go. At that point, if I marched\nfurther backwards in time, I've got some other quadratic\nbowl around this point.",
    "start": "3311940",
    "end": "3318740"
  },
  {
    "text": "That makes the\npoint, again, that-- ",
    "start": "3318740",
    "end": "3324589"
  },
  {
    "text": "if my quadratic\nball is currently this because time is 5--",
    "start": "3324590",
    "end": "3329720"
  },
  {
    "text": "or I had a 4-second trajectory--\nmaybe times 3 here-- and I'm pushed along\nthe trajectory, it's actually going to\nincur just as much cost,",
    "start": "3329720",
    "end": "3337520"
  },
  {
    "text": "roughly, as I'm pushed\nanother direction. There's a quadratic bowl\nliterally centered around x0",
    "start": "3337520",
    "end": "3343700"
  },
  {
    "text": "at time t. That's what this equation says.",
    "start": "3343700",
    "end": "3349070"
  },
  {
    "text": " And this quadratic bowl is\nthe cost-to-go estimate.",
    "start": "3349070",
    "end": "3356070"
  },
  {
    "text": "It says, if I'm away\nfrom the trajectory, I should expect the cost\nI incur in getting back",
    "start": "3356070",
    "end": "3364350"
  },
  {
    "text": "towards that trajectory\nto be this quadratic form.",
    "start": "3364350",
    "end": "3370080"
  },
  {
    "text": "Is that OK? ",
    "start": "3370080",
    "end": "3375810"
  },
  {
    "text": "And the key point is,\nbecause I've re-parameterized my equations in terms of x\nbar, this quadratic bowl always",
    "start": "3375810",
    "end": "3383670"
  },
  {
    "text": "lives on that trajectory. ",
    "start": "3383670",
    "end": "3390570"
  },
  {
    "text": "My cost function\nwas x bar Q x bar. My best thing to\ndo is to drive x",
    "start": "3390570",
    "end": "3396195"
  },
  {
    "text": "bar to 0, which means\nto drive my system back to the trajectory. ",
    "start": "3396195",
    "end": "3402970"
  },
  {
    "text": "People OK with that imagery? It doesn't look like they are. Everybody's OK. ",
    "start": "3402970",
    "end": "3410870"
  },
  {
    "text": "Are we OK here\nthe LTI stabilizer being an LQR bowl--\nor a quadratic bowl? So the farther I am away in\nthe directions defined by S,",
    "start": "3410870",
    "end": "3419440"
  },
  {
    "text": "I'm going to cut some\ncost getting back. This is just the\nsame thing that says,",
    "start": "3419440",
    "end": "3425470"
  },
  {
    "text": "if I'm at this point\nin the trajectory, I'm going to cover\nthis cost-to-go.",
    "start": "3425470",
    "end": "3432010"
  },
  {
    "text": "And the best thing to do,\nthe minimal cost-to-go is living right on\nthat trajectory.",
    "start": "3432010",
    "end": "3438670"
  },
  {
    "text": "As a consequence, the\noptimal controller, which tries to go down the\nlandscape of the cost-to-go,",
    "start": "3438670",
    "end": "3444609"
  },
  {
    "text": "is going to drive you\nback to the trajectory. Now, I said all that because\nI'm about to do something",
    "start": "3444610",
    "end": "3450460"
  },
  {
    "text": "that sounds totally wacky. ",
    "start": "3450460",
    "end": "3460580"
  },
  {
    "text": "Would it ever make sense for me\nto design a slightly different cost function, which, when\nI linearize and design",
    "start": "3460580",
    "end": "3468200"
  },
  {
    "text": "the feedback controller, I end\nup with a cost-to-go over here? ",
    "start": "3468200",
    "end": "3476930"
  },
  {
    "text": "Let's say I have some\nnominal trajectory. I found, through\nwhatever method,",
    "start": "3476930",
    "end": "3481970"
  },
  {
    "text": "some reasonable system\ntrajectory, but I really-- I'm still not happy with that.",
    "start": "3481970",
    "end": "3487700"
  },
  {
    "text": "The trajectory I really wanted\nwas something like this,",
    "start": "3487700",
    "end": "3493260"
  },
  {
    "text": "let's say. Would it make any sense\nto do my linearization",
    "start": "3493260",
    "end": "3498880"
  },
  {
    "text": "around this trajectory,\nand try to drive the system to this other trajectory?",
    "start": "3498880",
    "end": "3505327"
  },
  {
    "text": " AUDIENCE: You mean like scaling\nyour optimal trajectory?",
    "start": "3505327",
    "end": "3512648"
  },
  {
    "text": "RUSS TEDRAKE: I don't\neven mean scaling. They could cross. They could do whatever. It's not a simple scaling. ",
    "start": "3512648",
    "end": "3519829"
  },
  {
    "text": "Let me give you a simpler\nversion of the problem. ",
    "start": "3519830",
    "end": "3530511"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE] RUSS TEDRAKE: Say that again.",
    "start": "3530511",
    "end": "3536000"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE]",
    "start": "3536000",
    "end": "3545520"
  },
  {
    "text": "RUSS TEDRAKE: Yes. I'm going to divine a\ncost function, which would have it so I prefer\nto live on that trajectory.",
    "start": "3545520",
    "end": "3555210"
  },
  {
    "text": "Let me do it in the\ntime invariant case just so it's clear. ",
    "start": "3555210",
    "end": "3572700"
  },
  {
    "text": "Let's say my coordinate\nsystem's back and simple. It lives around 0. ",
    "start": "3572700",
    "end": "3579820"
  },
  {
    "text": "Let's say I have that\ncost function, or actually that dynamics. And instead of-- my original\ncost function was just x",
    "start": "3579820",
    "end": "3587460"
  },
  {
    "text": "transpose Qx-- let's say my cost\nfunction now is--",
    "start": "3587460",
    "end": "3593775"
  },
  {
    "start": "3593775",
    "end": "3639687"
  },
  {
    "text": "let's think about this\nproblem for a second. ",
    "start": "3639687",
    "end": "3649610"
  },
  {
    "text": "So let's say I have\na linear system. Now, the LQR controller\nwe did initially-- ",
    "start": "3649610",
    "end": "3657950"
  },
  {
    "text": "little sloppy with that. ",
    "start": "3657950",
    "end": "3664630"
  },
  {
    "text": "The LQR controller\nI did initially always assumed that the desired\nplace you wanted to be in life was 0.",
    "start": "3664630",
    "end": "3669910"
  },
  {
    "text": " If the desired place you want\nto be in life is a constant--",
    "start": "3669910",
    "end": "3675640"
  },
  {
    "text": "it's 3, let's say-- then you can still do your\nlinear quadratic regulator.",
    "start": "3675640",
    "end": "3681670"
  },
  {
    "text": "Just move your coordinate\nsystem so the 3 is 0. But let's say I've\ngot a linear system,",
    "start": "3681670",
    "end": "3687099"
  },
  {
    "text": "but I want to drive it\nthrough some trajectory-- time-varying trajectory-- x\ndesired as a function of time.",
    "start": "3687100",
    "end": "3694570"
  },
  {
    "text": "Then I can't quite just\nrecenter the origin. I've got to think\nabout, how do I drive my linear system through\nsome other trajectories?",
    "start": "3694570",
    "end": "3702312"
  },
  {
    "start": "3702312",
    "end": "3708590"
  },
  {
    "text": "Now the-- it's actually-- ",
    "start": "3708590",
    "end": "3715040"
  },
  {
    "text": "LTI system, but my cost function\nis time-varying, because my--",
    "start": "3715040",
    "end": "3720900"
  },
  {
    "text": "I have the desired trajectory\nthat varies with time. The result-- I won't\nwrite it down again--",
    "start": "3720900",
    "end": "3727790"
  },
  {
    "text": "again, I can do this\nRiccati equation. Back up. ",
    "start": "3727790",
    "end": "3735410"
  },
  {
    "text": "The only difference is\nthat the quadratic bowl is no longer going to be\ncentered on the origin.",
    "start": "3735410",
    "end": "3743682"
  },
  {
    "text": "The quadratic bowl is going\nto move with that desired trajectory. ",
    "start": "3743682",
    "end": "3749859"
  },
  {
    "text": "OK? Yeah? AUDIENCE: If that's far away\nfrom where you linearized, could you-- RUSS TEDRAKE: That's\nan excellent question.",
    "start": "3749860",
    "end": "3757542"
  },
  {
    "text": "But this is a linear\nsystem, so first, we don't have to worry\nabout that, but don't let me forget to go back to that. ",
    "start": "3757542",
    "end": "3766330"
  },
  {
    "text": "So I can drive my linear system\nthrough some trajectory that's non-zero beautifully\nwith an LQR controller.",
    "start": "3766330",
    "end": "3774940"
  },
  {
    "text": "The only problem is\nthat my LQR controller has to have has a cost-to-go\nfunction and a controller which",
    "start": "3774940",
    "end": "3781720"
  },
  {
    "text": "is not pointing me\nalways at the origin. You wouldn't want that.",
    "start": "3781720",
    "end": "3786763"
  },
  {
    "text": "So in fact, the way it\nlooks-- there's a lot of ways that people derive it. With Pontryagin, it's\nnot too hard to derive.",
    "start": "3786763",
    "end": "3793360"
  },
  {
    "text": "I prefer to derive\nit with the HJB. ",
    "start": "3793360",
    "end": "3805849"
  },
  {
    "text": "I'm not going to do\nthe derivation, but-- I don't mean to bore\nyou, but what you end up",
    "start": "3805850",
    "end": "3811730"
  },
  {
    "text": "with is J of x of t has a form\nx transpose S of t x plus x",
    "start": "3811730",
    "end": "3823730"
  },
  {
    "text": "transpose-- I call this S2-- S1 of t plus S0 of t.",
    "start": "3823730",
    "end": "3831035"
  },
  {
    "text": "It's a full quadratic form.  When I just have this, it's\nalways a quadratic bowl.",
    "start": "3831035",
    "end": "3838500"
  },
  {
    "text": "It's always centered around 0. If you want it, in general,\nto be a quadratic bowl that's not necessarily at 0, you\nneed the full quadratic form.",
    "start": "3838500",
    "end": "3846270"
  },
  {
    "text": "I could equally well\nhave written this as x minus x something\ndesired, S of t.",
    "start": "3846270",
    "end": "3854550"
  },
  {
    "text": "But let's work with this form. Yeah? ",
    "start": "3854550",
    "end": "3863260"
  },
  {
    "text": "So this is just an equation of a\nquadratic bowl, not necessarily centered on the origin.",
    "start": "3863260",
    "end": "3869620"
  },
  {
    "text": "And the LQR derivation gives me\nmy backwards dynamics for S2.",
    "start": "3869620",
    "end": "3875920"
  },
  {
    "text": "It gives me the backwards\ndynamics for S1 and for S0. ",
    "start": "3875920",
    "end": "3885440"
  },
  {
    "text": "And it's in the notes. It's actually already\nin your notes. It's in the HJB chapter that\nhas been up there for a while.",
    "start": "3885440",
    "end": "3893330"
  },
  {
    "text": " OK, now, the reason\nI'm on about all this",
    "start": "3893330",
    "end": "3903770"
  },
  {
    "text": "is that there's another way-- I told you about\nshooting methods. I told you about\ndirect co-location.",
    "start": "3903770",
    "end": "3910170"
  },
  {
    "text": "There is yet another\nway that people like to design trajectories,\nwhich use LQR directly.",
    "start": "3910170",
    "end": "3919998"
  },
  {
    "start": "3919998",
    "end": "3925250"
  },
  {
    "text": "And that's this\niterative LQR procedure. ",
    "start": "3925250",
    "end": "3942910"
  },
  {
    "text": "OK. ",
    "start": "3942910",
    "end": "3966089"
  },
  {
    "text": "So let's say I have some\ntrajectory that I've already found, x 0 of t, and I have\nsome different trajectory, which",
    "start": "3966090",
    "end": "3976440"
  },
  {
    "text": "is my desired trajectory,\nx desired of t. ",
    "start": "3976440",
    "end": "3984710"
  },
  {
    "text": "Then, using this\noptimal tracking-- if you stick back in the\ntime-varying components,",
    "start": "3984710",
    "end": "3990020"
  },
  {
    "text": "using this optimal\ntracking, I can linearize my dynamical\nsystem around that.",
    "start": "3990020",
    "end": "3995420"
  },
  {
    "text": "So I have no guarantees\nthat x desired is a feasible trajectory. In fact, many cases-- it's not. For instance, x desired might\nbe B at the goal at all times.",
    "start": "3995420",
    "end": "4004030"
  },
  {
    "text": "If I came up with a perfectly\nfeasible x desired trajectory, I probably wouldn't be\nrunning an open-loop solver.",
    "start": "4004030",
    "end": "4012280"
  },
  {
    "text": "I want to get to I want to\nget as close as desired-- as possible to the x\ndesired while potentially",
    "start": "4012280",
    "end": "4017710"
  },
  {
    "text": "minimizing cost and respecting\nthe dynamics of the system. ",
    "start": "4017710",
    "end": "4022880"
  },
  {
    "text": "Here's one way to do it-- linearize my system around\nmy initial guess, x0 of t,",
    "start": "4022880",
    "end": "4030100"
  },
  {
    "text": "then design a linear\noptimal tracking-- linear time-varying\noptimal tracking which tries to regulate my\nsystem as close as",
    "start": "4030100",
    "end": "4037690"
  },
  {
    "text": "possible to that trajectory. Now, what Steven said\nwas exactly on point.",
    "start": "4037690",
    "end": "4044600"
  },
  {
    "text": "If I drive my system away\nfrom where I linearized,",
    "start": "4044600",
    "end": "4050510"
  },
  {
    "text": "there's no guarantee\nthat my linear model is going to be any good here.",
    "start": "4050510",
    "end": "4056660"
  },
  {
    "text": "But the hope is that this\ntrajectory is better-- a better guess than\nthe one before.",
    "start": "4056660",
    "end": "4064480"
  },
  {
    "text": "And you iterate, make another\napproximation around there,",
    "start": "4064480",
    "end": "4072310"
  },
  {
    "text": "design the LQR controller, run\nthe LQR controller that drives me here to find the new u tape.",
    "start": "4072310",
    "end": "4078040"
  },
  {
    "text": "That defines my new\ntrajectory-- repeat. OK? That's called iterative LQR.",
    "start": "4078040",
    "end": "4085120"
  },
  {
    "text": "What else is it called? Do you know? ",
    "start": "4085120",
    "end": "4099728"
  },
  {
    "text": "Yeah. Do you see that? It's differential\ndynamic programming-- ",
    "start": "4099728",
    "end": "4117740"
  },
  {
    "text": "almost. There's a subtle difference,\nwhich I can tell you, if you want. There's a lot of names for it.",
    "start": "4117740",
    "end": "4124068"
  },
  {
    "text": "There's another guy, Bobrow--\nsome of you know Jim Bobrow-- he wrote this up called the\nsequential linear quadratic",
    "start": "4124069",
    "end": "4130609"
  },
  {
    "text": "regulators. Any four-letter acronym\nthat ends in LQR--",
    "start": "4130609",
    "end": "4137422"
  },
  {
    "text": "if you put it in Google,\nyou'll find something that's probably this idea. Yeah. If you put in whatever arbitrary\nconstant in front of it,",
    "start": "4137423",
    "end": "4144049"
  },
  {
    "text": "you'll probably\nget this idea out. AUDIENCE: What prevents\nyour actuator costs",
    "start": "4144050",
    "end": "4150645"
  },
  {
    "text": "from accumulating from\none iteration to another? RUSS TEDRAKE: Every\niteration, you're",
    "start": "4150645",
    "end": "4156520"
  },
  {
    "text": "trying to minimize\nyour actuator cost. AUDIENCE: Right, but I mean, if\nyou have a lot of iterations,",
    "start": "4156520",
    "end": "4163050"
  },
  {
    "text": "couldn't that potentially grow? RUSS TEDRAKE: I don't\nactually add to my old u tape.",
    "start": "4163051",
    "end": "4168950"
  },
  {
    "text": "I actually completely\nreplace my old u tape with a new controller which\ndrives me to the system.",
    "start": "4168950",
    "end": "4174350"
  },
  {
    "text": "AUDIENCE: Oh, OK. RUSS TEDRAKE: So there's no\nworries about additive actions.",
    "start": "4174350",
    "end": "4179509"
  },
  {
    "text": "It actually tells me in my\noriginal non-linear system what's my best guess as\na u tape that goes there.",
    "start": "4179510",
    "end": "4184700"
  },
  {
    "text": " AUDIENCE: Is this\nbasically a trick",
    "start": "4184700",
    "end": "4190520"
  },
  {
    "text": "to get rid of the\nslow [INAUDIBLE]?? RUSS TEDRAKE: So very,\nvery good-- so why would",
    "start": "4190520",
    "end": "4195840"
  },
  {
    "text": "I want to do this? Why didn't I tell you\nabout this first, or why-- how does this compare\nto the other methods? ",
    "start": "4195840",
    "end": "4203219"
  },
  {
    "text": "There is a sense by which-- and\nI thought about doing the whole derivation, but I think this-- I hope that this short\ndiscussion is sufficient.",
    "start": "4203220",
    "end": "4212130"
  },
  {
    "text": "So what I'm roughly\ndoing is I'm using LQR to come up with a quadratic\napproximation of where",
    "start": "4212130",
    "end": "4219660"
  },
  {
    "text": "my cost-- where my minimum is. ",
    "start": "4219660",
    "end": "4224760"
  },
  {
    "text": "This is very much in\nthe spirit of those SQP methods, the sequential\nquadratic methods.",
    "start": "4224760",
    "end": "4231150"
  },
  {
    "text": "I'm using computation\non this line to come up with a quadratic\napproximation of where I think",
    "start": "4231150",
    "end": "4237447"
  },
  {
    "text": "the new minimum should be.  So as such, it's a relatively\ncheap way with SQP properties,",
    "start": "4237447",
    "end": "4261400"
  },
  {
    "text": "convergence properties. ",
    "start": "4261400",
    "end": "4272640"
  },
  {
    "text": "OK. The methods I told you\nabout on Thursday--",
    "start": "4272640",
    "end": "4278179"
  },
  {
    "text": "the backprop through\ntime, the RTRL--  they computed J\nover my trajectory.",
    "start": "4278180",
    "end": "4285770"
  },
  {
    "text": "They computed partial J, partial\nalpha over my trajectory. They did not ever explicitly\ncompute the second derivative.",
    "start": "4285770",
    "end": "4294830"
  },
  {
    "text": "I never computed partial J,\npartial alpha, partial alpha.",
    "start": "4294830",
    "end": "4302450"
  },
  {
    "text": "To explicitly do an\nSQP update, somebody needs to compute the Hessian\nof that optimization.",
    "start": "4302450",
    "end": "4310280"
  },
  {
    "text": "I'm relying on SNOPT\nto do some bookkeeping to estimate the Hessian to\ndo the second-order update.",
    "start": "4310280",
    "end": "4317660"
  },
  {
    "text": "I would do better if\nI had an efficient way to compute the\nsecond derivatives, and I could hand that\ndirectly to SNOPT or whatever,",
    "start": "4317660",
    "end": "4324830"
  },
  {
    "text": "and we'd get-- expect\nfaster convergence. This isn't quite the\ngradients that I want,",
    "start": "4324830",
    "end": "4332760"
  },
  {
    "text": "but it has that feel to it,\nand it has similar convergence properties. So what you should\nthink about is",
    "start": "4332760",
    "end": "4338090"
  },
  {
    "text": "you should think\nabout this is a more explicit second-order\nmethod for making a large jump in my trajectories\nwith sequential quadratic",
    "start": "4338090",
    "end": "4349287"
  },
  {
    "text": "convergence results.  I feel like I've lost everybody\nnow, but ask questions,",
    "start": "4349287",
    "end": "4356270"
  },
  {
    "text": "if you need to. The advantage of it\nis that it's fast.",
    "start": "4356270",
    "end": "4363679"
  },
  {
    "text": "It could potentially\nrequire very few iterations to converge. One of the strongest advantages\nis that there's no explicit way",
    "start": "4363680",
    "end": "4371090"
  },
  {
    "text": "to do constraints. You have to think harder about\nhow to do constraints in this. ",
    "start": "4371090",
    "end": "4378170"
  },
  {
    "text": "And I know less\nformal guarantees that it will succeed,\nbecause it's an approximation of that quadratic.",
    "start": "4378170",
    "end": "4383645"
  },
  {
    "text": " So the RL community\nuses DDP a lot,",
    "start": "4383645",
    "end": "4390860"
  },
  {
    "text": "and actually, a lot of\npeople who do DDP do iterative LQR, for instance. For instance, Peter\n[INAUDIBLE] and those guys--",
    "start": "4390860",
    "end": "4396180"
  },
  {
    "text": "they always call DDP. They're actually\ndoing iterative LQR. DDP explicitly actually has--",
    "start": "4396180",
    "end": "4401929"
  },
  {
    "text": "you have to do a second-order\nexpansion of your dynamics, so you don't just get A of t x.",
    "start": "4401930",
    "end": "4407840"
  },
  {
    "text": "You actually go to second-order\nexpansion of your dynamics. So it's a little bit more\nexpensive of an update,",
    "start": "4407840",
    "end": "4413750"
  },
  {
    "text": "but most people equate it\nalmost exactly to iterative LQR. ",
    "start": "4413750",
    "end": "4420570"
  },
  {
    "text": "AUDIENCE: So this\nx0 trajectory, this isn't a trajectory\nyou found by doing",
    "start": "4420570",
    "end": "4427460"
  },
  {
    "text": "RTRL or something like that? This is something different? RUSS TEDRAKE: Good--\nso this could be a standard replacement to RTRL.",
    "start": "4427460",
    "end": "4434350"
  },
  {
    "text": "I could start with a\nrandom x0 trajectory. So maybe it's better to start\nwith a random u trajectory,",
    "start": "4434350",
    "end": "4440560"
  },
  {
    "text": "simulate it, and get\nan x0 trajectory. And then it will\nquickly reshape until it",
    "start": "4440560",
    "end": "4446500"
  },
  {
    "text": "gets as close as possible to\nthis x desired trajectory. AUDIENCE: But you're reshaping\nyour control actions that",
    "start": "4446500",
    "end": "4452202"
  },
  {
    "text": "get you to the x trajectory? RUSS TEDRAKE: Yes. So I'm reshaping u,\nresimulating to get the new x.",
    "start": "4452202",
    "end": "4457840"
  },
  {
    "text": "Yeah. I wrote it more carefully\nin the notes, and-- but I hope this is the\nright level to do the class.",
    "start": "4457840",
    "end": "4464560"
  },
  {
    "text": "And there's one\nextra thing that-- so I say this works if\nyou have a desired x--",
    "start": "4464560",
    "end": "4469929"
  },
  {
    "text": "desired trajectory, which\nmeans your cost function",
    "start": "4469930",
    "end": "4476180"
  },
  {
    "text": "has this sort of a form.  The advocates of\niterative LQR and DDP",
    "start": "4476180",
    "end": "4483590"
  },
  {
    "text": "say that every cost\nfunction has this form. This is just a second-order\nTaylor expansion",
    "start": "4483590",
    "end": "4490590"
  },
  {
    "text": "of whatever non-linear\ncost function you want. So write down whatever\nnon-linear cost function",
    "start": "4490590",
    "end": "4496800"
  },
  {
    "text": "you have, do a second-order\nexpansion on it, and you end up with a quadratic\ncost function like this.",
    "start": "4496800",
    "end": "4505159"
  },
  {
    "text": "And you can then\napproximate that solution with an iterative LQR scheme--",
    "start": "4505160",
    "end": "4510970"
  },
  {
    "text": "or RTRL, or backprop\nthrough time. This is the third out\nof our list of methods.",
    "start": "4510970",
    "end": "4518019"
  },
  {
    "text": "My goal is only to know-- so that you know that it exists. And you can read the\nnotes if you want more, and you can read the\npapers if you want more.",
    "start": "4518020",
    "end": "4524449"
  },
  {
    "text": "OK? Yeah, Michael? AUDIENCE: So I\nthink last time you talked about you're\nparallelizing the deviation",
    "start": "4524450",
    "end": "4531130"
  },
  {
    "text": "from your non-control input. So what if you were--\nlike as you iterate the controller, [INAUDIBLE]?",
    "start": "4531130",
    "end": "4537579"
  },
  {
    "text": " RUSS TEDRAKE: Good-- the total\ncost is actually the cost",
    "start": "4537580",
    "end": "4548620"
  },
  {
    "text": "with respect to some u desired. So I end up trying to optimize\nthat in a coordinate system",
    "start": "4548620",
    "end": "4555460"
  },
  {
    "text": "based on u0, but the cost I'm\ntrying to minimize is the u",
    "start": "4555460",
    "end": "4560950"
  },
  {
    "text": "the original coordinate\nsystem minus u desired-- which, in a lot of cases, is 0. ",
    "start": "4560950",
    "end": "4567849"
  },
  {
    "text": "Although I do it in a\nweird coordinate system, and it actually eventually\nsubtracts itself out because I add it back\nin at the end, and--",
    "start": "4567850",
    "end": "4576010"
  },
  {
    "text": "it's quite easy\nto, for instance, minimize u squared in the\noriginal coordinate system.",
    "start": "4576010",
    "end": "4581560"
  },
  {
    "text": "OK? ",
    "start": "4581560",
    "end": "4587217"
  },
  {
    "text": "So on Thursday, we get\nto do walking robots. We're going to move on\nto the next major thing. But you've now learned three\nof the open-loop trajectory",
    "start": "4587217",
    "end": "4597119"
  },
  {
    "text": "optimizers that\npeople really use-- iterative LQR very quickly,\nRTRL backprop through time--",
    "start": "4597120",
    "end": "4605010"
  },
  {
    "text": "I grouped as one-- the shooting methods\nand direct co-location.",
    "start": "4605010",
    "end": "4610800"
  },
  {
    "text": "There's another one\nthat's recent addition to the scene, which is\nthis discrete mechanics and optimal control, this DMOC.",
    "start": "4610800",
    "end": "4617764"
  },
  {
    "text": "If anybody was\nexcited about that and wanted to do a\nclass project on that, that would be a perfect thing. Grab that paper.",
    "start": "4617765",
    "end": "4623630"
  },
  {
    "text": "Show us that it works on\nthe [INAUDIBLE] carpole. That'd be beautiful. I'd love to have that--",
    "start": "4623630",
    "end": "4629920"
  },
  {
    "text": "have us try that and see how it\ncompares to the other methods. ",
    "start": "4629920",
    "end": "4638083"
  },
  {
    "text": "You've got a pretty good toolkit\nfor optimal control now-- practical optimal control.",
    "start": "4638083",
    "end": "4643650"
  },
  {
    "text": "And it works for flying\nrobots, but it also worked for your wheeled robots,\nif you want to control them",
    "start": "4643650",
    "end": "4650070"
  },
  {
    "text": "with better control. ",
    "start": "4650070",
    "end": "4655469"
  },
  {
    "text": "You could do a drop-in\nreplacement LTI optimal tracking controller,\nand it would be better-- assuming your model's better.",
    "start": "4655470",
    "end": "4662880"
  },
  {
    "text": "So you have these tools. Quick procedural things--\nI know we're out of time.",
    "start": "4662880",
    "end": "4669190"
  },
  {
    "text": "So next Thursday-- well, so let\nme say the good thing first. In two weeks, you're\non spring break.",
    "start": "4669190",
    "end": "4674640"
  },
  {
    "text": "Yeah. The Thursday preceding\nthat is our midterm. ",
    "start": "4674640",
    "end": "4682270"
  },
  {
    "text": "We haven't had a midterm\nin the class before, so there's no old exams\nfor me to give you, but John and I are\ngoing to try to come up",
    "start": "4682270",
    "end": "4688000"
  },
  {
    "text": "with some representative\nproblems for you to take home for\nThursday of this week",
    "start": "4688000",
    "end": "4693570"
  },
  {
    "text": "so you can have some problems\nto munch on over the weekend. It'll be an in-class exam\nThursday before spring break,",
    "start": "4693570",
    "end": "4701170"
  },
  {
    "text": "which is a week from Thursday. OK? AUDIENCE: [INAUDIBLE]",
    "start": "4701170",
    "end": "4707280"
  },
  {
    "text": "RUSS TEDRAKE: Yes. So open-book-- well, you\ncan grab whatever notes--",
    "start": "4707280",
    "end": "4712409"
  },
  {
    "text": "open-note exam-- absolutely. Well, I'll say it more in\nthe preparation package,",
    "start": "4712410",
    "end": "4718949"
  },
  {
    "text": "but roughly, we're going to-- I think, if you have\nyour notes with you, if you've done the problem set--",
    "start": "4718950",
    "end": "4724350"
  },
  {
    "text": "and most importantly, if you\nknow how these algorithms-- where the algorithms relate to\neach other and where they'd be",
    "start": "4724350",
    "end": "4731190"
  },
  {
    "text": "used in different systems-- I can guarantee I'm going to\nask you something about that-- then it's not designed\nto be a killer.",
    "start": "4731190",
    "end": "4738540"
  },
  {
    "text": " Good-- and I hope you start\nthinking about projects.",
    "start": "4738540",
    "end": "4746385"
  },
  {
    "text": " Just out of being a\nfairly nice person,",
    "start": "4746385",
    "end": "4752830"
  },
  {
    "text": "I wasn't going to ask you to do\nprojects before your midterm. But this time last year,\nI was asking people",
    "start": "4752830",
    "end": "4758460"
  },
  {
    "text": "to submit project proposals. We're going to do that\nimmediately after the midterm.",
    "start": "4758460",
    "end": "4763950"
  },
  {
    "text": "If you've been chewing\non, this method looked like a really good\nmatch to my research problem, or I've never actually thought\nabout juggling robots before,",
    "start": "4763950",
    "end": "4772390"
  },
  {
    "text": "or something like\nthis, you can imagine-- so in the fairly\nnear future, we're going to ask you for a\nhalf-page project proposal",
    "start": "4772390",
    "end": "4781290"
  },
  {
    "text": "that we can iterate\nwith you on to get going on a world-class final project. Yeah?",
    "start": "4781290",
    "end": "4788070"
  },
  {
    "text": "See you Thursday. ",
    "start": "4788070",
    "end": "4791000"
  }
]