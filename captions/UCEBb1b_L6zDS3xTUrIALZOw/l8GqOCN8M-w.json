[
  {
    "text": " The following content is\nprovided under a Creative Commons license.",
    "start": "0",
    "end": "6049"
  },
  {
    "text": "Your support will help MIT\nOpenCourseWare continue to offer high quality educational\nresources for free.",
    "start": "6050",
    "end": "12740"
  },
  {
    "text": "To make a donation or view\nadditional materials from hundreds of MIT courses, visit\nMIT OpenCourseWare at",
    "start": "12740",
    "end": "19560"
  },
  {
    "text": "ocw.mit.edu. ",
    "start": "19560",
    "end": "31380"
  },
  {
    "text": "PROFESSOR: OK, so by this time,\nmost of you should have",
    "start": "31380",
    "end": "36899"
  },
  {
    "text": "had your meetings with\nyour masters. How many of you had meetings\nwith your masters?",
    "start": "36900",
    "end": "44650"
  },
  {
    "text": "Who didn't yet? AUDIENCE: Today. PROFESSOR: Today? And Friday. Who hasn't scheduled\na meeting?",
    "start": "44650",
    "end": "53060"
  },
  {
    "text": "So are you talking to them,\nand do you know-- AUDIENCE: [INAUDIBLE] PROFESSOR: OK, make sure you get\nmasters meetings scheduled",
    "start": "53060",
    "end": "61230"
  },
  {
    "text": "because this is a very\nimportant part. We are getting feedback\nfrom the masters. I think they are giving you guys\na lot of good advice, and",
    "start": "61230",
    "end": "68820"
  },
  {
    "text": "so make sure you schedule, you\ngo, you meet, get that result,",
    "start": "68820",
    "end": "74900"
  },
  {
    "text": "use that result. It's very hard to arrange that\nkind of a senior person spending a lot of time\nwith only two of",
    "start": "74900",
    "end": "82280"
  },
  {
    "text": "you at a given time. That's a really good ratio\nto have, so take advantage of that.",
    "start": "82280",
    "end": "88330"
  },
  {
    "text": "OK, so also, I think at this\npoint, most of the beta issues",
    "start": "88330",
    "end": "94630"
  },
  {
    "text": "for project one, we have been\nprobably worked with, and they",
    "start": "94630",
    "end": "100274"
  },
  {
    "text": "have some issues some people\nlooked at that they are performance code. They were not happy because\nthe thing is this.",
    "start": "100275",
    "end": "108850"
  },
  {
    "text": "You can always run everything\ninstantaneously if it doesn't",
    "start": "108850",
    "end": "113920"
  },
  {
    "text": "have to produce a\ncorrect answer. You can just return, and so part\nof performance is also it",
    "start": "113920",
    "end": "120580"
  },
  {
    "text": "has to have some correctness. So certain amount of correctness\nhas to be passed",
    "start": "120580",
    "end": "125759"
  },
  {
    "text": "before we can give\nperformer grade. So some people have\nthis question. Why are you giving me a\ncorrectness grade because it",
    "start": "125760",
    "end": "132850"
  },
  {
    "text": "seemed to run? But if you haven't done the\nright checks and stuff like that, then it's unfair for other\npeople because there's",
    "start": "132850",
    "end": "138940"
  },
  {
    "text": "no way people who do the correct\nimplementation can match that performance\nbecause we're using that as upper bound.",
    "start": "138940",
    "end": "144550"
  },
  {
    "text": "So make sure you do that. And another issue people had\nwas when you go to masters,",
    "start": "144550",
    "end": "150660"
  },
  {
    "text": "you're going to work with one\nor two other students. And in your group, you're\ngoing to share all the",
    "start": "150660",
    "end": "158470"
  },
  {
    "text": "material with your group\nmember and nobody else. But between the beta and final,\nyou get opportunity to",
    "start": "158470",
    "end": "167680"
  },
  {
    "text": "basically get input from your\nmasters, and also see what the other people who are coming\nto a project in your",
    "start": "167680",
    "end": "175720"
  },
  {
    "text": "discussion have done. So it's OK for you to\nsee those code. You can't take the code home. You can't just say give me a\nprint-out, I am going to take",
    "start": "175720",
    "end": "182000"
  },
  {
    "text": "home and re-implement. That doesn't count, but if you\nsee some clever things they have done, it's all\nhere to learn.",
    "start": "182000",
    "end": "187560"
  },
  {
    "text": "Class is all the mostly\nabout learning. However we have to grade you, so\nit's not all about grading,",
    "start": "187560",
    "end": "192650"
  },
  {
    "text": "it's about learning. So we are trying to get a\nbalance where we opportunity for you to learn from\nyour peers.",
    "start": "192650",
    "end": "198890"
  },
  {
    "text": "So if you go look at other\npeople's code, if you find something cool they\nhave done, learn. And also if you [UNINTELLIGIBLE]",
    "start": "198890",
    "end": "204950"
  },
  {
    "text": "for you [UNINTELLIGIBLE] say, look, I did\nsomething cool. It's a good learning experience\nin there, so that's",
    "start": "204950",
    "end": "211239"
  },
  {
    "text": "one opportunity you have to talk\nto other people on other groups, to basically learn\nsomething or find some",
    "start": "211240",
    "end": "217850"
  },
  {
    "text": "interesting tidbits of how\nto get good performance. And hopefully, you learn some\ninteresting things and able to",
    "start": "217850",
    "end": "223500"
  },
  {
    "text": "implement that in your final. OK? So today we are going to talk\nabout memory systems and",
    "start": "223500",
    "end": "231370"
  },
  {
    "text": "performance engineering. So if you look at basic idea\nof what memory systems, you",
    "start": "231370",
    "end": "240640"
  },
  {
    "text": "want to build a computer\nthat seemed to have a really fast memory.",
    "start": "240640",
    "end": "245860"
  },
  {
    "text": "You don't want things\nto be slow. For example, a long time ago,\npeople build these computers where memory's always slow,\neverything [UNINTELLIGIBLE]",
    "start": "245860",
    "end": "253590"
  },
  {
    "text": "further away. It doesn't help anybody. The way we know how to do that\nis to build small amount of",
    "start": "253590",
    "end": "260190"
  },
  {
    "text": "memory very close to\nthe processor. You can't build a huge amount\nof things all close to you.",
    "start": "260190",
    "end": "265860"
  },
  {
    "text": "That doesn't work, doesn't\nscale like that. And we made a cache just like\nthat, and you build larger and",
    "start": "265860",
    "end": "272090"
  },
  {
    "text": "larger memory [UNINTELLIGIBLE]\ngoing down, and the illusion is you want to give the illusion\nof you have huge",
    "start": "272090",
    "end": "277550"
  },
  {
    "text": "amount of memory. Everybody's very close to you. OK, so it looks like you have\nmillions of friends, that you",
    "start": "277550",
    "end": "284370"
  },
  {
    "text": "talk to everybody, and\nthat doesn't happen. But how do you give\nthat illusion? And the way that you give that\nillusion is when you use",
    "start": "284370",
    "end": "292670"
  },
  {
    "text": "normal programming practice,\nwhen you normally using data, people have found there\nare two properties.",
    "start": "292670",
    "end": "298065"
  },
  {
    "text": " The first thing is called\ntemporal locality.",
    "start": "298065",
    "end": "304010"
  },
  {
    "text": "That means if I use some data\nitem, there's a good chance I use that data item\nagain very soon.",
    "start": "304010",
    "end": "311400"
  },
  {
    "text": "There is something I haven't\nused for a long time, probably has a good chance I will\nnot use it for a",
    "start": "311400",
    "end": "318360"
  },
  {
    "text": "very, very long time. So can I take advantage\nof temporal locality? So that mean some data will be\nget for use a lot of time, in",
    "start": "318360",
    "end": "324505"
  },
  {
    "text": "a very quick [UNINTELLIGIBLE],\nso those things should be very near to you because you might. Other one is spatial locality.",
    "start": "324505",
    "end": "331060"
  },
  {
    "text": "That means if I use some data\nitem, there's a good chance you'll be using data items next\nto that, closer to that.",
    "start": "331060",
    "end": "336760"
  },
  {
    "text": "So can we take advantage\nof that? So those two properties help you\nhelp the compiler to fool",
    "start": "336760",
    "end": "343500"
  },
  {
    "text": "the system, fool everybody,\nthinking that it has this huge amount of memory very close to\nyou, but internally doesn't.",
    "start": "343500",
    "end": "350310"
  },
  {
    "text": "Unfortunately, since it's trying\nto fool you, it doesn't work all the time, and when it\ndoesn't work, it's good to",
    "start": "350310",
    "end": "356110"
  },
  {
    "text": "recognize and able to\nfix those things. So I showed this picture\nsometime ago, too.",
    "start": "356110",
    "end": "365280"
  },
  {
    "text": "Memories in a big hierarchy. L1, L2, in fact, we have L3\ncache and a memory, disk,",
    "start": "365280",
    "end": "372630"
  },
  {
    "text": "tapes, it can go up and down. And the key thing is when you go\nhere, you're starting from registers, you have very\nsmall amount of",
    "start": "372630",
    "end": "378629"
  },
  {
    "text": "things, very fast access. Here, we have almost\ninfinite amount of things, very slow access.",
    "start": "378630",
    "end": "384290"
  },
  {
    "text": "And the two reasons why this has\nto be smart because first of all, those things\nare very expensive.",
    "start": "384290",
    "end": "390510"
  },
  {
    "text": "And second of course, you can't\n[UNINTELLIGIBLE] too much, and when you go down,\nthings get somewhat cheaper. So that was one of the kind of\neconomic incentive here.",
    "start": "390510",
    "end": "397750"
  },
  {
    "text": " So I talked about cache issues,\nand I'm going to go",
    "start": "397750",
    "end": "403690"
  },
  {
    "text": "through this again because we\nare really going to dig deep into these things. So when you have a cache, that\nmeans you have a small memory",
    "start": "403690",
    "end": "410430"
  },
  {
    "text": "close to you that's basically\nshadowing something sitting behind you. So when you ask for the data in\nthe cache, there are many",
    "start": "410430",
    "end": "418490"
  },
  {
    "text": "reasons why it's not there. First thing is cold miss. What that means is you're asking\nfor something that you",
    "start": "418490",
    "end": "425760"
  },
  {
    "text": "have never asked before. It's the first time you're\nasking, so the data is probably sitting way behind\nin your memory where,",
    "start": "425760",
    "end": "431890"
  },
  {
    "text": "[UNINTELLIGIBLE] in a disk. We haven't even loaded\nit in there. And the first time you have to\nget it, so that get pulled in,",
    "start": "431890",
    "end": "441780"
  },
  {
    "text": "and so this seems to be a place\nwhere there's nothing you can do.",
    "start": "441780",
    "end": "447080"
  },
  {
    "text": "But another part of locality is\na thing called prefetching.",
    "start": "447080",
    "end": "452460"
  },
  {
    "text": "These modern processors\nhave a crystal ball. They carry most of the things\nthat branch prediction and",
    "start": "452460",
    "end": "459780"
  },
  {
    "text": "stuff is trying to predict\nwhat you want to do. You can do the same\nthing in memory.",
    "start": "459780",
    "end": "466320"
  },
  {
    "text": "You can look at what\nyou have done. And Intel has this huge amount\nof circuitry that they don't",
    "start": "466320",
    "end": "471470"
  },
  {
    "text": "tell anybody what they do, but\nthey're trying to predict what you might fetch next, what data\nyou might look for next.",
    "start": "471470",
    "end": "477060"
  },
  {
    "text": "And if it is working well,\nsomething you had never, ever looked before, it might deduce\nthat you might need it and go",
    "start": "477060",
    "end": "484590"
  },
  {
    "text": "get it for you. So if that works, great.",
    "start": "484590",
    "end": "490130"
  },
  {
    "text": "So then there's thing called\ncapacity miss. What that means is as I said,\nI am trying to keep my best",
    "start": "490130",
    "end": "498240"
  },
  {
    "text": "friends, or the people I will\nbe working with a lot-- Oh, nice. What's going on here?",
    "start": "498240",
    "end": "506240"
  },
  {
    "text": "Please start later. OK. ",
    "start": "506240",
    "end": "512169"
  },
  {
    "text": "--the people I'm going to work\na lot with, close to me. The problem is I can have only\ncertain number of friends, and",
    "start": "512169",
    "end": "518880"
  },
  {
    "text": "if you have more than that,\nI can't keep everybody. So hopefully, your program is\ngoing to use a lot what we",
    "start": "518880",
    "end": "526430"
  },
  {
    "text": "call the working set that\ncan fit in the cache. And at that point, you get all\nof those people, like I said,",
    "start": "526430",
    "end": "532030"
  },
  {
    "text": "get everybody into one room,\nand the problem is if your party spills over from\nthe room, then",
    "start": "532030",
    "end": "538149"
  },
  {
    "text": "there's a lot of issues. But if everybody fits in the\nroom, things are very nice. You can have a good interaction,\ncontinuous",
    "start": "538150",
    "end": "543390"
  },
  {
    "text": "interaction, with them. And what happens is, if not, the\nworst case is the caches",
    "start": "543390",
    "end": "550899"
  },
  {
    "text": "have eviction policy, normally\nis called least recently used. That means if I don't have room\nin the cache, I figure",
    "start": "550900",
    "end": "558480"
  },
  {
    "text": "out the cache line that I\nhaven't touched for longest, and I get rid of that,\nbring the next one.",
    "start": "558480",
    "end": "564710"
  },
  {
    "text": "So that's a good policy. It fits in your locality\nthing, but when",
    "start": "564710",
    "end": "569740"
  },
  {
    "text": "will did not work?  [UNINTELLIGIBLE] going to figure out when least\nrecently used will create a",
    "start": "569740",
    "end": "579879"
  },
  {
    "text": "really bad problem\nin capacity. AUDIENCE: [INAUDIBLE] ",
    "start": "579880",
    "end": "585410"
  },
  {
    "text": "just one. Say you're [INAUDIBLE] set,\nand that set is, by one,",
    "start": "585410",
    "end": "591060"
  },
  {
    "text": "bigger than the [INAUDIBLE] missing. PROFESSOR: Very good. So what you're going through,\nyou're going round some data",
    "start": "591060",
    "end": "596900"
  },
  {
    "text": "again and again, and that amount\nof data is one bigger than your cache line.",
    "start": "596900",
    "end": "603209"
  },
  {
    "text": "You are going to have\nno locality because [UNINTELLIGIBLE], and when you\ngo to, just before you use that data, they said, oops, I\nneed to bring one more data.",
    "start": "603210",
    "end": "610360"
  },
  {
    "text": "I need to evict something, and\nwho am I going to evict? The guy I'm going to use next\nbecause it was the least",
    "start": "610360",
    "end": "617630"
  },
  {
    "text": "recently used thing. So it goes, and then you go\nthere, and you bring that. Who's it going to evict? You're going to evict the\none I just brought.",
    "start": "617630",
    "end": "623579"
  },
  {
    "text": "You're going to evict the next\none that I am just about to use and bring that one. And you go use that, and then\nto use the next one, you're",
    "start": "623580",
    "end": "630450"
  },
  {
    "text": "going evict the one you're\njust about to use. So by going and doing that, you\nbasically get no locality.",
    "start": "630450",
    "end": "635480"
  },
  {
    "text": "So that's a really bad\nproblem in here.  So another interesting thing is\ncalled a conflict misses.",
    "start": "635480",
    "end": "643370"
  },
  {
    "text": "Conflict misses says normally,\nwhen you have a cache-- so what we have is you have\nthis large storage, which",
    "start": "643370",
    "end": "650360"
  },
  {
    "text": "[UNINTELLIGIBLE] the memory, you're going to map\ninto smaller storage in here, which is cache.",
    "start": "650360",
    "end": "657420"
  },
  {
    "text": "So one way to say is any of\nthis value line can be anywhere here.",
    "start": "657420",
    "end": "663550"
  },
  {
    "text": "That's called fully\nassociative cache. ",
    "start": "663550",
    "end": "668670"
  },
  {
    "text": "Implementing that is somewhat\ncomplicated, so the other extreme is called direct\nmap cache.",
    "start": "668670",
    "end": "673940"
  },
  {
    "text": "What that means is this segment,\nthe same size here, can map into here, and then\nthe next segment also",
    "start": "673940",
    "end": "680570"
  },
  {
    "text": "can map into here. That means if you get this cache\nline here, it can be only mapped into one\nplace in this here.",
    "start": "680570",
    "end": "690200"
  },
  {
    "text": "This cache line can only be\nhere, and also this cache line can also only be here if\nit is the same offset.",
    "start": "690200",
    "end": "697620"
  },
  {
    "text": "So that means for every cache\nline, there's only one location in the cache. So here, what would be\nreally sad scenario?",
    "start": "697620",
    "end": "705550"
  },
  {
    "start": "705550",
    "end": "711214"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE] PROFESSOR: Yeah, I mean\nI assume I have a lot of these slots.",
    "start": "711214",
    "end": "717010"
  },
  {
    "text": "I read something here, and the\nnext time I read something here, next time I read something\nhere, and I go round and round this way.",
    "start": "717010",
    "end": "723350"
  },
  {
    "text": "I might be touching only very\nfew number of data items, but they also mapping into one\ncache line even though my",
    "start": "723350",
    "end": "729630"
  },
  {
    "text": "working set is very small\nthan the cache. I still don't have\nany cache usage",
    "start": "729630",
    "end": "738340"
  },
  {
    "text": "because I am having conflicts. And then there are two other\nmisses when you're going to",
    "start": "738340",
    "end": "743430"
  },
  {
    "text": "multi-process. We'll go through them\nin later lectures. One is called true sharing. That means there are caches\nprivate to each core, and what",
    "start": "743430",
    "end": "753560"
  },
  {
    "text": "happens is if one core uses some\ndata, you've have to get the cache line there. If the other core wants to use\nthat data, you have to bring",
    "start": "753560",
    "end": "759100"
  },
  {
    "text": "the cache line back there, and\nthe cache lines can ping-pong [UNINTELLIGIBLE] that. False sharing is even\na worst way.",
    "start": "759100",
    "end": "766090"
  },
  {
    "text": "So what happens is if the first\nprocessor here touches this value of the cache line,\nsecond processor touches this",
    "start": "766090",
    "end": "773910"
  },
  {
    "text": "value of the cache line. We're not sharing anything,\nbut unfortunately, the two",
    "start": "773910",
    "end": "779320"
  },
  {
    "text": "things I'm using sits next to\neach other, so when I ride this thing, I get the cache\nline, he doesn't.",
    "start": "779320",
    "end": "784500"
  },
  {
    "text": "When he need to ride this\nthing, he has to get the cache line. So I am seemingly using\nindependent data, but I am",
    "start": "784500",
    "end": "790860"
  },
  {
    "text": "bouncing cache line in between,\nand if that happened, that going to have a huge\nbig performance impact.",
    "start": "790860",
    "end": "796879"
  },
  {
    "text": "So these other things. The last two, we'll get\nto a little bit later. So today I am going to start\nwith modeling how caches work",
    "start": "796880",
    "end": "806009"
  },
  {
    "text": "with a very simplistic cache. So here's, assume, my cache. I have 32 kilobytes in here.",
    "start": "806010",
    "end": "812730"
  },
  {
    "text": " This is a direct map cache. That means that in my memory, 32\nkilobyte chucks get mapped",
    "start": "812730",
    "end": "821600"
  },
  {
    "text": "to direct [UNINTELLIGIBLE]. This 32 kilobyte get\nmapped here. That 32 kilobyte get\nmapped here.",
    "start": "821600",
    "end": "827970"
  },
  {
    "text": "And the cache line inside is 64\nbytes, 64, and that means I",
    "start": "827970",
    "end": "837889"
  },
  {
    "text": "have basically\n[UNINTELLIGIBLE PHRASE]. ",
    "start": "837890",
    "end": "843280"
  },
  {
    "text": "32 kilobyte in here. OK? So just remember this as we go\non doing this, we will use",
    "start": "843280",
    "end": "852770"
  },
  {
    "text": "this as a formula. OK? And we assume if you getting\nthe cache, [UNINTELLIGIBLE] single cycle, if you\nmiss 100 cycles.",
    "start": "852770",
    "end": "859400"
  },
  {
    "text": "OK, so it's nice numbers\nto do that. And so the first thing is we\nhave a reference like this.",
    "start": "859400",
    "end": "868630"
  },
  {
    "text": "OK? You go from [i] equals 0 to\n[i] less than very large",
    "start": "868630",
    "end": "875820"
  },
  {
    "text": "number, A[i]. I just go to accessing memory\nlike one after another after",
    "start": "875820",
    "end": "881600"
  },
  {
    "text": "another after another. ",
    "start": "881600",
    "end": "886610"
  },
  {
    "text": "So you see how this is\ngoing on in here? So also I am accessing integers,\nso that means four bytes at a time in cache line.",
    "start": "886610",
    "end": "894460"
  },
  {
    "text": "So what happens here? So I assume size of int is four,\nso you're getting four bytes in here.",
    "start": "894460",
    "end": "901490"
  },
  {
    "text": "So yeah, you're doing s reads\nto A. I'm accessing s elements in here. And you have 16 elements\nof a per cache line.",
    "start": "901490",
    "end": "910490"
  },
  {
    "text": "OK, you see why 16 if there? Because I have 64 in here,\n64 bytes in here.",
    "start": "910490",
    "end": "919009"
  },
  {
    "text": "Each time axises four bytes,\nso I have 16 of integers in cache line.",
    "start": "919010",
    "end": "924748"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE] bits or bytes? PROFESSOR: Bytes. Byte. Did I say bits?",
    "start": "924748",
    "end": "929775"
  },
  {
    "text": "No, bytes. So what happens is if it axises\nthe same element, 15 of",
    "start": "929775",
    "end": "937322"
  },
  {
    "text": "every 16 is in the cache because\nwhen we are going one after the first guy, cache miss,\nI had to go bring it,",
    "start": "937322",
    "end": "944230"
  },
  {
    "text": "and the next 15, I have\nbrought to it. It's in the cache. So what should be my cost?",
    "start": "944230",
    "end": "951170"
  },
  {
    "text": "[UNINTELLIGIBLE] cost of memory access. ",
    "start": "951170",
    "end": "957840"
  },
  {
    "text": "I am accessing s data, and\n1/16th of that is a cache",
    "start": "957840",
    "end": "963715"
  },
  {
    "text": "miss, 15/16th is a cache hit. So basically total\n[UNINTELLIGIBLE]",
    "start": "963715",
    "end": "969320"
  },
  {
    "text": "is a 15/16th of s is a cache\nhit, and other 1/16th I have",
    "start": "969320",
    "end": "975970"
  },
  {
    "text": "100 times cycles I need because\nit's a cache miss.",
    "start": "975970",
    "end": "981970"
  },
  {
    "text": "Everybody good so far? OK, so what type of locality\ndo we have here?",
    "start": "981970",
    "end": "987110"
  },
  {
    "text": " First of all, do we\nhave locality? ",
    "start": "987110",
    "end": "993870"
  },
  {
    "text": "Who thinks we have locality? OK, lot of people thinks\nwe have locality. What type?",
    "start": "993870",
    "end": "1000399"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE] PROFESSOR: Spatial locality\nbecause what we are doing is we are accessing the nearby\nelements even though we are",
    "start": "1000400",
    "end": "1007030"
  },
  {
    "text": "not getting back any of the\ndata yet, so we get some spacial locality axis here. That's good, so this is our\nvery -- most simple",
    "start": "1007030",
    "end": "1015150"
  },
  {
    "text": "thing we can do. So what kind of misses are we\ngoing to have in the cache? ",
    "start": "1015150",
    "end": "1026119"
  },
  {
    "text": "Cold misses. I'm missing because I have never\nseen that data before, so it's a cold miss in here.",
    "start": "1026119",
    "end": "1033280"
  },
  {
    "text": "OK, so that's that. Let's look at this one. I'm accessing A[0]",
    "start": "1033280",
    "end": "1038949"
  },
  {
    "text": " s times. ",
    "start": "1038950",
    "end": "1045689"
  },
  {
    "text": "OK? What's the total access time? ",
    "start": "1045690",
    "end": "1060950"
  },
  {
    "text": "How many cache misses\nam I going to get? One, so I basically have 100\ntime for the first cache miss,",
    "start": "1060950",
    "end": "1070780"
  },
  {
    "text": "and s minus 1 for the rest\nbasically it's a hit. OK? That's good, so what kind\nof locality's this?",
    "start": "1070780",
    "end": "1076760"
  },
  {
    "start": "1076760",
    "end": "1082070"
  },
  {
    "text": "Spatial or temporal. There's not too many choices. Or none. ",
    "start": "1082070",
    "end": "1089140"
  },
  {
    "text": "How many people think spatial?  How many people think\ntemporal?",
    "start": "1089140",
    "end": "1095770"
  },
  {
    "text": "How many people said there's\nnone locality? OK, that's a lot of temporal.",
    "start": "1095770",
    "end": "1100990"
  },
  {
    "text": "OK, you want to get\n[UNINTELLIGIBLE]. That's temporal locality here\nbecause you're accessing to",
    "start": "1100990",
    "end": "1106059"
  },
  {
    "text": "the same thing again and again\nand again, same data. So this is-- Oh, OK. Want to restart, OK.",
    "start": "1106060",
    "end": "1112350"
  },
  {
    "text": "Wait a little. So this is only time we\nnotice in a hurry. Every time, I go to do\nsomething, I get hourglass.",
    "start": "1112350",
    "end": "1118840"
  },
  {
    "text": " So what kind of misses\nare we getting?",
    "start": "1118840",
    "end": "1125190"
  },
  {
    "text": "Trick question. ",
    "start": "1125190",
    "end": "1134149"
  },
  {
    "text": "I got one cold miss, and\nthat's about it. And the rest I don't\nhave any misses. So if I have a miss,\nit's a cold miss.",
    "start": "1134150",
    "end": "1141409"
  },
  {
    "text": "OK, so here I am doing something\ninteresting. So what the heck is\nin this list?",
    "start": "1141410",
    "end": "1148720"
  },
  {
    "text": "So I'm accessing A[i] [UNINTELLIGIBLE] this 2 to the power number,\none shifted to the entire",
    "start": "1148720",
    "end": "1154860"
  },
  {
    "text": "miss, 2 to the power N. I\nshifted between 4 and 13.",
    "start": "1154860",
    "end": "1161470"
  },
  {
    "text": "What this 13? Why is 13? Less than 13. ",
    "start": "1161470",
    "end": "1169590"
  },
  {
    "text": "What's 2 the power of 13? I think I got this right. ",
    "start": "1169590",
    "end": "1177625"
  },
  {
    "text": "AUDIENCE: 8,192.",
    "start": "1177625",
    "end": "1183070"
  },
  {
    "text": "PROFESSOR: What's 2 to\nthe power of 13? AUDIENCE: 8,192. PROFESSOR: Yeah, 8K. And I have 32K.",
    "start": "1183070",
    "end": "1190330"
  },
  {
    "text": "So 8K of 32 [UNINTELLIGIBLE]. 8K of integers, which is each\nas 4 bytes is how much?",
    "start": "1190330",
    "end": "1199680"
  },
  {
    "text": "32K. So what this says is everything\nI access should fit",
    "start": "1199680",
    "end": "1205410"
  },
  {
    "text": "into the cache. I am accessing data like that. I'm going back and accessing\ndata like that. I'm going back and accessing\ndata like that, and it should",
    "start": "1205410",
    "end": "1211520"
  },
  {
    "text": "all fit into the cache. Do you see what I do? I access up to 2 to the power\nof 18, and I go back and",
    "start": "1211520",
    "end": "1218370"
  },
  {
    "text": "access that again. I'm just going back\nand back because of the model operation. Everybody see what's going on?",
    "start": "1218370",
    "end": "1225670"
  },
  {
    "text": "So how many cache misses\nshould I have? ",
    "start": "1225670",
    "end": "1240916"
  },
  {
    "text": "AUDIENCE: There are four\ncache [INAUDIBLE]. PROFESSOR: OK, how many cache\nlines I would be accessing if",
    "start": "1240916",
    "end": "1248090"
  },
  {
    "text": "I am doing i1 2 to\nthe power N? ",
    "start": "1248090",
    "end": "1254875"
  },
  {
    "text": "[i] mod 2 to the power N.",
    "start": "1254875",
    "end": "1260974"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE] ",
    "start": "1260974",
    "end": "1277720"
  },
  {
    "text": "PROFESSOR: So one miss\nfor each axis line the first time around. Afterward, it's only\nin the cache.",
    "start": "1277720",
    "end": "1283289"
  },
  {
    "text": "So how many axis lines?",
    "start": "1283290",
    "end": "1288430"
  },
  {
    "text": "2 to the power N. Is that right? I think this is wrong. ",
    "start": "1288430",
    "end": "1296087"
  },
  {
    "text": "Oh, yeah, this is right\nbecause every axis-- So in the cache line,\nhow many--",
    "start": "1296087",
    "end": "1304676"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE]  PROFESSOR: This is four. ",
    "start": "1304676",
    "end": "1311730"
  },
  {
    "text": "So there are 16 entries here. ",
    "start": "1311730",
    "end": "1317759"
  },
  {
    "text": "16 entries in here. OK, only one of them basically\nmisses that, so that means if",
    "start": "1317760",
    "end": "1325470"
  },
  {
    "text": "2 to the power N axises-- AUDIENCE: [INAUDIBLE]",
    "start": "1325470",
    "end": "1331090"
  },
  {
    "text": "PROFESSOR: You are doing 2 to\nthe power N axises before you",
    "start": "1331090",
    "end": "1337679"
  },
  {
    "text": "go back in here. So what you're doing\nis you are-- you make this many axises before\nyou go back again.",
    "start": "1337680",
    "end": "1347320"
  },
  {
    "text": "OK? And how many axises assigned to\nbe in the same cache line?",
    "start": "1347320",
    "end": "1354130"
  },
  {
    "text": "You have 64 bytes\nin the cache. OK each axis is four.",
    "start": "1354130",
    "end": "1361730"
  },
  {
    "text": "16. AUDIENCE: [INAUDIBLE] PROFESSOR: 16.",
    "start": "1361730",
    "end": "1368210"
  },
  {
    "text": "So that's true [UNINTELLIGIBLE]. AUDIENCE: [INAUDIBLE] ",
    "start": "1368210",
    "end": "1373410"
  },
  {
    "text": "PROFESSOR: Yeah, but what I'm\nsaying is I might not access the [UNINTELLIGIBLE] because if any small.",
    "start": "1373410",
    "end": "1378890"
  },
  {
    "text": "I only access a certain amount\nof cache line, so I'm accessing a part of the cache. I might not go through the--\ncan everybody see this, how",
    "start": "1378890",
    "end": "1384520"
  },
  {
    "text": "this is working? Because if I'm only accessing,\nwe'll say, accessing one, if",
    "start": "1384520",
    "end": "1392170"
  },
  {
    "text": "this is, we'll say, 2\nto the power of 5. OK, I am not going to access\nthe entire cache line.",
    "start": "1392170",
    "end": "1398570"
  },
  {
    "text": "[UNINTELLIGIBLE] cache is I'm going to\n[UNINTELLIGIBLE] go through the cache. So this many cache lines\nI'm accessing.",
    "start": "1398570",
    "end": "1407669"
  },
  {
    "text": "OK, and the first time I access\nthat, I get a cache miss, and after that, it say\neverything is in the cache.",
    "start": "1407670",
    "end": "1414680"
  },
  {
    "text": " Everybody's following me? Or are we like lost in here?",
    "start": "1414680",
    "end": "1421649"
  },
  {
    "text": "How many people are lost? OK, let's do this. ",
    "start": "1421650",
    "end": "1429430"
  },
  {
    "text": "So what happens is if you have\na modular 2 to the power N.",
    "start": "1429430",
    "end": "1437120"
  },
  {
    "text": "What that means is I'm going\nto keep accessing one to",
    "start": "1437120",
    "end": "1443390"
  },
  {
    "text": "somewhere 2 to the power N, and\nthe next one, I am going back here again.",
    "start": "1443390",
    "end": "1449150"
  },
  {
    "text": " That's my axises, basically,\nbecause it goes",
    "start": "1449150",
    "end": "1454580"
  },
  {
    "text": "[UNINTELLIGIBLE] accessing to the power of N. I nicely said n is\nbetween 4 and 13.",
    "start": "1454580",
    "end": "1463840"
  },
  {
    "text": "So n is 13 means the maximum\nI can do is 8K.",
    "start": "1463840",
    "end": "1478820"
  },
  {
    "text": "8K increase.  8K increase equals 32K\nkilobytes of memory.",
    "start": "1478820",
    "end": "1491470"
  },
  {
    "text": " So that means you don't\nhave any option of",
    "start": "1491470",
    "end": "1496580"
  },
  {
    "text": "overwriting the cache. So you go to cache,\n[UNINTELLIGIBLE].",
    "start": "1496580",
    "end": "1502790"
  },
  {
    "text": "You don't wrap around\nin the cache. Do you see that? OK, you know wrap arounding is\nso bad, that means all these",
    "start": "1502790",
    "end": "1509450"
  },
  {
    "text": "things is going to fit in the\ncache, and then when you get [UNINTELLIGIBLE], this is\ngoing to be in the cache",
    "start": "1509450",
    "end": "1514860"
  },
  {
    "text": "because the data you access is\nsmaller than the entire cache.",
    "start": "1514860",
    "end": "1522630"
  },
  {
    "text": "OK, so what that means is only\nthe first line has to have some cache misses.",
    "start": "1522630",
    "end": "1528410"
  },
  {
    "text": "So how many cache misses\nyou are going to have in the first line? Or any of the lines going to\nhave cache misses because the first line still fit\nin the cache.",
    "start": "1528410",
    "end": "1534430"
  },
  {
    "text": "[UNINTELLIGIBLE] anything. We don't need everything. How many cache misses\nhave in here? The interesting thing is because\nthese are four bytes,",
    "start": "1534430",
    "end": "1545410"
  },
  {
    "text": "we have a 64-byte cache line,\nand each is four bytes.",
    "start": "1545410",
    "end": "1555830"
  },
  {
    "text": " So that means I can do 16 axises\nevery time I have a",
    "start": "1555830",
    "end": "1563980"
  },
  {
    "text": "cache miss. OK, so up to here to here is 2\nto the N. My cache misses I do",
    "start": "1563980",
    "end": "1573280"
  },
  {
    "text": "[UNINTELLIGIBLE] basically. My cache misses is basically\nthis much. ",
    "start": "1573280",
    "end": "1581460"
  },
  {
    "text": "Everything else is in the cache,\nand after the first line, everything else is\nin the cache again, [UNINTELLIGIBLE] nicely,\ngot my working set",
    "start": "1581460",
    "end": "1587030"
  },
  {
    "text": "to fit in the cache. I'm really happy. Everybody see this? How many people don't\nsee it now?",
    "start": "1587030",
    "end": "1594529"
  },
  {
    "text": "OK, good. So let's move to something a\nlittle bit more complicated. What kind of locality\ndo we have?",
    "start": "1594530",
    "end": "1600630"
  },
  {
    "start": "1600630",
    "end": "1605698"
  },
  {
    "text": "AUDIENCE: Temporal\nand spatial. PROFESSOR: Good. We have temporal and spatial.",
    "start": "1605698",
    "end": "1611559"
  },
  {
    "text": "You have spatial because every\ntime you go, you only get the first line of the cache. Rest is in the cache.",
    "start": "1611560",
    "end": "1618850"
  },
  {
    "text": "From that, I got a 16x\nimprovement because I have temporal locality. And since I only access when I\ngo back to the data, after",
    "start": "1618850",
    "end": "1626690"
  },
  {
    "text": "accessing this, since it's\nalready in the cache, I get",
    "start": "1626690",
    "end": "1632659"
  },
  {
    "text": "spatial locality because\nof the 16. 16 things are in the cache,\nI am going through that. I get spatial locality.",
    "start": "1632660",
    "end": "1638049"
  },
  {
    "text": "I get temporal locality because\nnext time I access, it's still in the cache.",
    "start": "1638050",
    "end": "1643580"
  },
  {
    "text": "I haven't taken anything\nout of the cache. OK, what kind of misses? ",
    "start": "1643580",
    "end": "1650960"
  },
  {
    "text": "Should be cold misses again. Cold misses because the first\ntime I [UNINTELLIGIBLE] things. I haven't seen that data.",
    "start": "1650960",
    "end": "1656860"
  },
  {
    "text": "After I get it, everything\nis in the cache. So now, here's interesting\ncase.",
    "start": "1656860",
    "end": "1664700"
  },
  {
    "text": "Now, I am doing 2 to the power\nN, where N is great than 14. ",
    "start": "1664700",
    "end": "1672800"
  },
  {
    "text": "Now, what happens? Now, what happens in our picture\nhere is I am going--",
    "start": "1672800",
    "end": "1680920"
  },
  {
    "text": " So as you might cache\nis somewhere here.",
    "start": "1680920",
    "end": "1688220"
  },
  {
    "text": "At this point, I fill\nout the cache.",
    "start": "1688220",
    "end": "1693470"
  },
  {
    "text": "I still keep going, and minute\nI access something [UNINTELLIGIBLE]",
    "start": "1693470",
    "end": "1699300"
  },
  {
    "text": "cache, what's going to happen? ",
    "start": "1699300",
    "end": "1704630"
  },
  {
    "text": "So I went through accessing\n34 kilobyte. If I access the next\none, what happens?",
    "start": "1704630",
    "end": "1710570"
  },
  {
    "text": " OK, no, no, no shutting\ndown, please.",
    "start": "1710570",
    "end": "1718130"
  },
  {
    "text": "OK, what happened?  So I am accessing more than\nI can fit into the cache.",
    "start": "1718130",
    "end": "1725940"
  },
  {
    "text": "Next time access, what's\ngoing to happen? Anyone want to take\na wild guess?",
    "start": "1725940",
    "end": "1731638"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE]  PROFESSOR:\n[UNINTELLIGIBLE PHRASE]",
    "start": "1731638",
    "end": "1737450"
  },
  {
    "text": "before that. [UNINTELLIGIBLE] in there. So what happens is then am\nI ever going to have any",
    "start": "1737450",
    "end": "1744410"
  },
  {
    "text": "temporal locality? No. OK, so now, first access to\neach line basically misses",
    "start": "1744410",
    "end": "1754590"
  },
  {
    "text": "forever because by the time\nI get back to the [UNINTELLIGIBLE],\nit's not there.",
    "start": "1754590",
    "end": "1759880"
  },
  {
    "text": "So basically, it's gone\nout of the cache. So what that means is my total\naccess time is basically every",
    "start": "1759880",
    "end": "1766059"
  },
  {
    "text": "16th element, I am getting\ncache miss forever. So what that means, every 15th\nof 16, I have a hit.",
    "start": "1766060",
    "end": "1773890"
  },
  {
    "text": "So what I have is 15 out of\n16, I have a cache hit.",
    "start": "1773890",
    "end": "1780070"
  },
  {
    "text": "1/16th of the time, I have\na cache miss forever. So what kind of locality\ndo I have now?",
    "start": "1780070",
    "end": "1785929"
  },
  {
    "text": " I have spatial locality.",
    "start": "1785930",
    "end": "1792250"
  },
  {
    "text": "I don't have any temporal\nlocality. I don't ever go back to\nsomething in the cache again. So what I have is spatial\nlocality, so what type of",
    "start": "1792250",
    "end": "1798280"
  },
  {
    "text": "misses now do I have? ",
    "start": "1798280",
    "end": "1803679"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE] PROFESSOR: Cold, right. AUDIENCE: Is it like\nshared misses?",
    "start": "1803679",
    "end": "1809438"
  },
  {
    "text": "[INAUDIBLE] PROFESSOR: It's not shared. When you fill out the cache,\nyou go back to [UNINTELLIGIBLE]. You fill the cache.",
    "start": "1809438",
    "end": "1815690"
  },
  {
    "text": "So what type of miss is that? AUDIENCE: Capacity? PROFESSOR: Capacity miss. OK, so you have basically\ncold and capacity",
    "start": "1815690",
    "end": "1822910"
  },
  {
    "text": "misses happening now. OK? AUDIENCE: One question. [INAUDIBLE]",
    "start": "1822910",
    "end": "1827981"
  },
  {
    "text": "that you multiplied whenever\nyou're trying to load from memory, is that like an\narbitrary number, or is that",
    "start": "1827982",
    "end": "1835302"
  },
  {
    "text": "the actual cost of going-- PROFESSOR: Every machine, you\ncan get this beautiful table. I will go off what your\nmachines have.",
    "start": "1835302",
    "end": "1842860"
  },
  {
    "text": "We still have a number saying\nthis is your miss [UNINTELLIGIBLE], this\nis the thing-- I mean, so some of these things\nyou realize because of",
    "start": "1842860",
    "end": "1850120"
  },
  {
    "text": "all of the complexity. It's not that nice and simple,\nbut this, I just pull out of hat, and it's kind of normal.",
    "start": "1850120",
    "end": "1855570"
  },
  {
    "text": " So what do I do, now?",
    "start": "1855570",
    "end": "1862110"
  },
  {
    "text": "I am doing the mod, but I am\nmultiplying [i] by 16. ",
    "start": "1862110",
    "end": "1870150"
  },
  {
    "text": "So now, I am accessing this\nvalue, this value, this value, this value in here.",
    "start": "1870150",
    "end": "1875549"
  },
  {
    "text": "I'm accessing this value, this\nvalue, this value, this value. One value in each cache line.",
    "start": "1875550",
    "end": "1882490"
  },
  {
    "text": "OK? How much cache misses do you\nthink I'm going to get? ",
    "start": "1882490",
    "end": "1889895"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE]  PROFESSOR: 100 for every access\nis basically beginning",
    "start": "1889895",
    "end": "1897250"
  },
  {
    "text": "a cache line, you're taking one\nvalue and if I go back to that value, I have already\nfilled up the cache.",
    "start": "1897250",
    "end": "1905230"
  },
  {
    "text": "So basically, I have first\naccess in the cache. And what's your total\naccess time?",
    "start": "1905230",
    "end": "1913700"
  },
  {
    "text": "Anyone will take a guess? AUDIENCE: [INAUDIBLE] PROFESSOR: Yep, 100 times\nx because I have no-- OK, so this is a\n[UNINTELLIGIBLE]",
    "start": "1913700",
    "end": "1920470"
  },
  {
    "text": "locality. That was clear. What kind of misses\nam I getting now? AUDIENCE: [INAUDIBLE]",
    "start": "1920470",
    "end": "1926130"
  },
  {
    "text": "PROFESSOR: Now, I'm getting\nconflict misses. I get a cold miss at the\nbeginning, first time around, and then every time I do\nsomething, I'm getting conflict miss because the thing\nis, now, this N, I am",
    "start": "1926130",
    "end": "1935870"
  },
  {
    "text": "only accessing small\namount of data. It doesn't fit in the cache, but\nI'm not still getting any",
    "start": "1935870",
    "end": "1943090"
  },
  {
    "text": "kind of sharing, so I'm having\nconflict misses. ",
    "start": "1943090",
    "end": "1950910"
  },
  {
    "text": "[UNINTELLIGIBLE] second\ntime, I guess I will probably jump over this. I just did OK, if I go random\naccess, what happens?",
    "start": "1950910",
    "end": "1955980"
  },
  {
    "text": "So let me jump over that. Actually can do a calculation\nto figure out how many, probabilistically, how\nmuch you might have",
    "start": "1955980",
    "end": "1961230"
  },
  {
    "text": "and stuff like that. OK. So now, if you look at what's\ngoing on, when you have no",
    "start": "1961230",
    "end": "1968790"
  },
  {
    "text": "locality, you'd have\nno locality. That's a pretty obvious\nstatement. And then if you have spatial\nlocality and no temporal",
    "start": "1968790",
    "end": "1977470"
  },
  {
    "text": "locality, we are\nstreaming data. That means you are going through\nthe data, but you're not getting back to it\nfast enough, so I",
    "start": "1977470",
    "end": "1984910"
  },
  {
    "text": "have temporal locality. So I stream through data, so\nthat means I go through data in a streaming fashion.",
    "start": "1984910",
    "end": "1991170"
  },
  {
    "text": "OK? ",
    "start": "1991170",
    "end": "1996820"
  },
  {
    "text": "So what we have is if working\nset fits in cache, you have InCache mode.",
    "start": "1996820",
    "end": "2002640"
  },
  {
    "text": "If working set is too big for\ncache, you can get some streaming mode and still get\nsome locality because we are",
    "start": "2002640",
    "end": "2008550"
  },
  {
    "text": "bringing the lines in here. And you can do other things\nlike optimizers like",
    "start": "2008550",
    "end": "2014800"
  },
  {
    "text": "prefetching we'll get to. And other issues\n[UNINTELLIGIBLE]",
    "start": "2014800",
    "end": "2020059"
  },
  {
    "text": "this last one, but to deal\nwith cache axises.",
    "start": "2020060",
    "end": "2026130"
  },
  {
    "text": "So if you have more than one\naxis-- so here what I have is too nice arrays.",
    "start": "2026130",
    "end": "2033039"
  },
  {
    "text": "[UNINTELLIGIBLE] is 2 to the\npower size array 2 to the 19 power arrays.",
    "start": "2033040",
    "end": "2039429"
  },
  {
    "text": "OK, so now what happens when\nI put this in the cache? Look what happens in here. So what happens is this array\nget mapped in this one.",
    "start": "2039430",
    "end": "2050080"
  },
  {
    "text": "This array get maps this\nnicely in here. So what happens is this line\ncan only be in this cache",
    "start": "2050080",
    "end": "2057580"
  },
  {
    "text": "line, and this line also\nonly can be in this line of the cache.",
    "start": "2057580",
    "end": "2064310"
  },
  {
    "text": "Do you see what's\ngoing on, now? So if you do this one, basically\nevery time you",
    "start": "2064310",
    "end": "2070739"
  },
  {
    "text": "access something-- See, assume I'm accessing this\ndata item, so I'm doing A, B.",
    "start": "2070739",
    "end": "2076129"
  },
  {
    "text": "I access A, I get this line. I access B, what happens? AUDIENCE: [INAUDIBLE]",
    "start": "2076130",
    "end": "2081510"
  },
  {
    "text": "PROFESSOR: So this\n[UNINTELLIGIBLE] is gone. It is gone. Now, I am accessing the\nnext one in that cache line we made.",
    "start": "2081510",
    "end": "2087829"
  },
  {
    "text": "AUDIENCE: How do you know\nwhat cache line-- or how [INAUDIBLE] cache? [INAUDIBLE]",
    "start": "2087829",
    "end": "2093699"
  },
  {
    "text": "PROFESSOR: Normally, in language\nlike C, if people two arrays next to each other, they\nshould be mapped next to",
    "start": "2093699",
    "end": "2100079"
  },
  {
    "text": "each other in memory. And if you want to be more\nadventurous, you can go to the assembly and then see what\ntheir locations is.",
    "start": "2100080",
    "end": "2108070"
  },
  {
    "text": "So if you put A, A next to each\nother, you normally kind of get it next to each other. So what this one is this\nis pretty bad.",
    "start": "2108070",
    "end": "2115540"
  },
  {
    "text": "I should have gotten at least\nsome spatial locality. I'm getting nothing.",
    "start": "2115540",
    "end": "2120585"
  },
  {
    "text": "Do you see what's\ngoing on here? ",
    "start": "2120585",
    "end": "2126140"
  },
  {
    "text": "Do you know what's\ngoing on here? Know why I'm not getting\nany spatial locality? Because I am bouncing.",
    "start": "2126140",
    "end": "2131940"
  },
  {
    "text": "When I access this one, this one\nis gone even though I have more data in the same cache\nline, so I'm kind of bouncing",
    "start": "2131940",
    "end": "2136960"
  },
  {
    "text": "two cache lines because\nof that. What's a good solution\nfor this? Back there. AUDIENCE: [INAUDIBLE]",
    "start": "2136960",
    "end": "2142500"
  },
  {
    "text": "A and B could be mapped to\nthe same cache line. PROFESSOR: The thing A is\na nice 2 to the power.",
    "start": "2142500",
    "end": "2149330"
  },
  {
    "text": "A size is a multiple\nof the cache size.",
    "start": "2149330",
    "end": "2154422"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE] PROFESSOR: The size of A is a\nmultiple of the cache size. So what happens is if you have\nmemory in here, you map",
    "start": "2154422",
    "end": "2164480"
  },
  {
    "text": "something like A, C here. If this is a multiple of cache\nline, so assume this is 32K",
    "start": "2164480",
    "end": "2173960"
  },
  {
    "text": "times some number, and you map\nB here, and then this is normally what happens in C.\nYou put all adjacent map",
    "start": "2173960",
    "end": "2182589"
  },
  {
    "text": "allocations next to each\nother in memory. Do you got A here, and\nyou start having B in",
    "start": "2182590",
    "end": "2187829"
  },
  {
    "text": "here, next to it. OK, so what happens is now if\nA starts to assume address,",
    "start": "2187830",
    "end": "2194839"
  },
  {
    "text": "we'll say 100, this is 100 plus\n32K times N, basically.",
    "start": "2194840",
    "end": "2207710"
  },
  {
    "text": "And you do this mod 32K, this\nmod 32K, this same number.",
    "start": "2207710",
    "end": "2215680"
  },
  {
    "text": "It maps into the same line. OK, so I kind of gave\nyou the problem.",
    "start": "2215680",
    "end": "2221740"
  },
  {
    "text": "What can be the solution? AUDIENCE: [INAUDIBLE] allocate one line.",
    "start": "2221740",
    "end": "2226980"
  },
  {
    "text": "PROFESSOR: Yes, it's\ncalled padding. ",
    "start": "2226980",
    "end": "2232530"
  },
  {
    "text": "OK, so I have no locality in\nhere, let me go to the next slide, what kind of misses? I have cold and conflict. What I can do is just\nbasically add a",
    "start": "2232530",
    "end": "2239710"
  },
  {
    "text": "little bit of padding. I did 16 here. Normally, you do a prime number\nso it will not clash",
    "start": "2239710",
    "end": "2246400"
  },
  {
    "text": "with anything. Add a little bit of padding at\nthe end of array, and that means the next array\nwill not be",
    "start": "2246400",
    "end": "2253230"
  },
  {
    "text": "conflicted most of the time. So a lot of times when you\ndeclare things next to each other, it's always good\nto add a little bit of",
    "start": "2253230",
    "end": "2259630"
  },
  {
    "text": "a padding in between. Normally, a smaller prime number\nwould be a good thing",
    "start": "2259630",
    "end": "2266010"
  },
  {
    "text": "to add a padding.  Now, I start getting back my\nnice locality because the two",
    "start": "2266010",
    "end": "2274180"
  },
  {
    "text": "things are mapping the\ntwo cache lines. What type of locality\ndo I get here? ",
    "start": "2274180",
    "end": "2285960"
  },
  {
    "text": "Anybody want to take any\nguess what type of locality I have here? ",
    "start": "2285960",
    "end": "2291816"
  },
  {
    "text": "AUDIENCE: Question, sorry. [INAUDIBLE] you actually added\njust an extra 16.",
    "start": "2291816",
    "end": "2296942"
  },
  {
    "text": "PROFESSOR: Yes. AUDIENCE: Why would that just\nmake the A and B [INAUDIBLE]? PROFESSOR: Because what happens\nis normally it doesn't",
    "start": "2296942",
    "end": "2304640"
  },
  {
    "text": "make A and B into leaving the\ncache, but it makes A[0]",
    "start": "2304640",
    "end": "2309829"
  },
  {
    "text": "not exactly matching to B[0]. A[0]",
    "start": "2309830",
    "end": "2315200"
  },
  {
    "text": "will interleave with something\nlike B[16] or something.",
    "start": "2315200",
    "end": "2320670"
  },
  {
    "text": "This thing might map into\nthe same place. AUDIENCE: I mean, but\nI [INAUDIBLE].",
    "start": "2320670",
    "end": "2327480"
  },
  {
    "text": "PROFESSOR: Yes, normally\nin a computation, people do that, A[i] equals B[i] plus something. AUDIENCE: Oh, OK,\nso [INAUDIBLE].",
    "start": "2327480",
    "end": "2333725"
  },
  {
    "text": " Like I understand what you're\nsaying, but I don't understand",
    "start": "2333725",
    "end": "2339312"
  },
  {
    "text": "how that [INAUDIBLE] because they're both accessing\n[i] at the same time. Why would they [INAUDIBLE]?",
    "start": "2339312",
    "end": "2344835"
  },
  {
    "start": "2344835",
    "end": "2349980"
  },
  {
    "text": "PROFESSOR: So here's\nthe problem. Assume I have [UNINTELLIGIBLE] 32K.",
    "start": "2349980",
    "end": "2356710"
  },
  {
    "text": "I'm assuming [UNINTELLIGIBLE]. OK, so first one is, we'll say,\nyou start with 100, 100",
    "start": "2356710",
    "end": "2365599"
  },
  {
    "text": "plus [i], and the other one\nis 100 plus 32K plus [i].",
    "start": "2365600",
    "end": "2376400"
  },
  {
    "text": "OK, then you take a mod\n32K, and this end up",
    "start": "2376400",
    "end": "2386250"
  },
  {
    "text": "being 100 plus [i] with another 100 plus [i].",
    "start": "2386250",
    "end": "2393110"
  },
  {
    "text": "So this is basically\n[UNINTELLIGIBLE]. You still have one or one\nelement in the cache it's all",
    "start": "2393110",
    "end": "2398950"
  },
  {
    "text": "going to map into. You see that? But now, if I add 16 more to\nthis one, then this map into",
    "start": "2398950",
    "end": "2411556"
  },
  {
    "text": "116 plus [i]. AUDIENCE: I don't see that\nreflected in the code.",
    "start": "2411556",
    "end": "2418286"
  },
  {
    "text": "You just [INAUDIBLE], so\nhow is B different from A in your code? PROFESSOR: Because\n[UNINTELLIGIBLE] my S. I added",
    "start": "2418286",
    "end": "2424450"
  },
  {
    "text": "16 to S, so my A is a little\nbit bigger, now. AUDIENCE: But isn't B\nalso [INAUDIBLE]?",
    "start": "2424450",
    "end": "2430280"
  },
  {
    "text": "PROFESSOR: Yeah, B's\nalso bigger here. I don't care. B goes down here. B, I add a little bit more to\nthe B. It doesn't matter.",
    "start": "2430280",
    "end": "2437780"
  },
  {
    "text": "I padded B, too. So what that means\nis the first A[i] and B[i] are not in the\nsame cache line.",
    "start": "2437780",
    "end": "2445282"
  },
  {
    "text": "AUDIENCE: How do we allocate\nA and B right next to each other? PROFESSOR: So normally in C, if\nyou declare something like",
    "start": "2445282",
    "end": "2457270"
  },
  {
    "text": "int A [100], int B [100], more\nor less, they will be",
    "start": "2457270",
    "end": "2468010"
  },
  {
    "text": "allocated next to each other. If you look at the assembly\nlisting, it'll say code allocated next to each\nother in memory.",
    "start": "2468010",
    "end": "2475640"
  },
  {
    "text": "Even in the stack, if you do\nthat, if you allocate things, compiler has no incentive to\ngo and move things around.",
    "start": "2475640",
    "end": "2484265"
  },
  {
    "text": "AUDIENCE: This is only for\nglobal and [INAUDIBLE]? PROFESSOR: Global variable,\nlocal variables.",
    "start": "2484265",
    "end": "2490172"
  },
  {
    "text": "AUDIENCE: Does any of it still\napply if you use malloc? ",
    "start": "2490172",
    "end": "2498520"
  },
  {
    "text": "PROFESSOR: The thing\nabout malloc is--  AUDIENCE: [INAUDIBLE]",
    "start": "2498520",
    "end": "2504150"
  },
  {
    "text": "PROFESSOR: It might do something\n[UNINTELLIGIBLE], but on the other hand, if it is\nfitting on the same page, it might also do something\nlike that, too.",
    "start": "2504150",
    "end": "2510460"
  },
  {
    "text": "So it depends on\nhow we do that. At the beginning, if you keep\nmallocing things, it might be",
    "start": "2510460",
    "end": "2516400"
  },
  {
    "text": "[UNINTELLIGIBLE]. They might be a little bit off\nbecause malloc put some metadata with each status.",
    "start": "2516400",
    "end": "2522920"
  },
  {
    "text": "If you ask for [UNINTELLIGIBLE],\nyou're not getting exactly 100. You're getting a little\nbit of a bigger size. But you might have some\nconfiguring to do, but after",
    "start": "2522920",
    "end": "2529930"
  },
  {
    "text": "some time, when you have done a\nlot of [UNINTELLIGIBLE], we have no idea where\nit's going to go. It's random.",
    "start": "2529930",
    "end": "2535290"
  },
  {
    "text": "Anymore questions? OK, good, that is\na good question.",
    "start": "2535290",
    "end": "2540940"
  },
  {
    "text": "So what kind of locality\ndo I have here? ",
    "start": "2540940",
    "end": "2549030"
  },
  {
    "text": "[UNINTELLIGIBLE] two lines, I am accessing each,\nand I got 16 times 15",
    "start": "2549030",
    "end": "2557130"
  },
  {
    "text": "out of 16 hits.  What's that?",
    "start": "2557130",
    "end": "2562650"
  },
  {
    "text": "AUDIENCE: Spatial? PROFESSOR: Spatial locality. And of course, if you have\nspatial locality, you get cold",
    "start": "2562650",
    "end": "2567990"
  },
  {
    "text": "misses, basically. And I think [UNINTELLIGIBLE],\nyou get what other type of misses?",
    "start": "2567990",
    "end": "2574605"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE] PROFESSOR: [UNINTELLIGIBLE]\nconflict here. Basically, capacity. Capacity miss, exactly.",
    "start": "2574605",
    "end": "2581260"
  },
  {
    "text": "So in order to avoid this, what\nwe have done is we make",
    "start": "2581260",
    "end": "2588260"
  },
  {
    "text": "cache-- instead of mapping into\none place before, and what we said was we had\nthis memory, and",
    "start": "2588260",
    "end": "2594800"
  },
  {
    "text": "assume we have 32 sets. And if you have a cache like\nthis, we make this entire map",
    "start": "2594800",
    "end": "2600270"
  },
  {
    "text": "into this one, and this\nmap into this one. What people have done is instead\nof doing that, what",
    "start": "2600270",
    "end": "2607250"
  },
  {
    "text": "you can make is make the cache,\ninstead of one big block, two small blocks.",
    "start": "2607250",
    "end": "2614436"
  },
  {
    "text": "So what that means is this\ncan happen to this one.",
    "start": "2614436",
    "end": "2620890"
  },
  {
    "text": " My drawings are not\nthat great, but I",
    "start": "2620890",
    "end": "2626150"
  },
  {
    "text": "hope you get the picture. This map into this one, so\nwhat that means is each reference here, so maps\nhere, and these",
    "start": "2626150",
    "end": "2635630"
  },
  {
    "text": "two basically conflicts. But now with that\n[UNINTELLIGIBLE] too, I can put this\none here or here.",
    "start": "2635630",
    "end": "2641609"
  },
  {
    "text": "I have two places to put the\nvalue, basically, and that [UNINTELLIGIBLE].",
    "start": "2641610",
    "end": "2647480"
  },
  {
    "text": "OK, so that means if I access\nsomething conflicting, [UNINTELLIGIBLE], you cannot\njust two things.",
    "start": "2647480",
    "end": "2654960"
  },
  {
    "text": "Still, there are places in\nthe cache for them to go. And one way to do people is\nfully associative cache.",
    "start": "2654960",
    "end": "2660510"
  },
  {
    "text": "It can go anywhere, but that's\nvery hard to do in hardware, but you can do some small\nnumber of ways.",
    "start": "2660510",
    "end": "2666560"
  },
  {
    "text": "So in here, if you do two basic\nassociative cache, in the first axis in here, even\nthough these are conflicted,",
    "start": "2666560",
    "end": "2675609"
  },
  {
    "text": "on can go to one\n[UNINTELLIGIBLE] set, another one can go to the other set. ",
    "start": "2675610",
    "end": "2681070"
  },
  {
    "text": "OK, so two associative cache\n[UNINTELLIGIBLE]. So total access time, again, I\nhave nice locality in here,",
    "start": "2681070",
    "end": "2688779"
  },
  {
    "text": "spatial locality, and I have\nboth cold and, I guess, capacity misses.",
    "start": "2688780",
    "end": "2696490"
  },
  {
    "text": "But if you have two associative\ncache, what's the next problem? How about if you have three\ndifferent things? ",
    "start": "2696490",
    "end": "2704280"
  },
  {
    "text": "So we have two different\nthings like that. OK, now that I only have two\nassociated [UNINTELLIGIBLE], it doesn't work because, in\na [UNINTELLIGIBLE], I will",
    "start": "2704280",
    "end": "2710630"
  },
  {
    "text": "replace the last thing, and you\nmight still end up with nothing in here because you are\nreplacing nothing, and the",
    "start": "2710630",
    "end": "2715830"
  },
  {
    "text": "next thing replaced\nthe other thing. And basically after you\ngave B, C, then you go to A. A Is not there.",
    "start": "2715830",
    "end": "2721450"
  },
  {
    "text": "When you go to B, B is not\nthere, C is not there. You kind of go back to the same\nproblem in here, and then",
    "start": "2721450",
    "end": "2726560"
  },
  {
    "text": "basically have to access\neverything again. ",
    "start": "2726560",
    "end": "2733569"
  },
  {
    "text": "There is some spatial locality\nbut cache can't use it. Basically, you have\nconflict misses.",
    "start": "2733570",
    "end": "2739190"
  },
  {
    "text": "OK, so you see that? So associative is good because\nnormally people assume you",
    "start": "2739190",
    "end": "2744410"
  },
  {
    "text": "don't need that much associativity, but it's limited.",
    "start": "2744410",
    "end": "2749590"
  },
  {
    "text": "So if you have too many things,\nyou might run into this problem again. AUDIENCE: [INAUDIBLE]",
    "start": "2749590",
    "end": "2755666"
  },
  {
    "start": "2755666",
    "end": "2762320"
  },
  {
    "text": "PROFESSOR: You mean capacity? AUDIENCE: Yeah, [INAUDIBLE]\ncapacity. PROFESSOR: Less. AUDIENCE: [INAUDIBLE]",
    "start": "2762320",
    "end": "2767754"
  },
  {
    "text": "elements in a cache before you\npick [INAUDIBLE] because it looks as though the matrix\nis is using half",
    "start": "2767754",
    "end": "2774670"
  },
  {
    "text": "the cache by itself. PROFESSOR: Because it's\nassociated, you mean? You have multiple there? I mean, the thing is since it's\nassociated, no, because",
    "start": "2774670",
    "end": "2781030"
  },
  {
    "text": "you have enough room. I mean, if you're going\n[UNINTELLIGIBLE] everything, you have two\nplaces to put the name because it maps.",
    "start": "2781030",
    "end": "2788730"
  },
  {
    "text": "That's a good question. So what happens is now, assume\nthis many things fit into the",
    "start": "2788730",
    "end": "2795599"
  },
  {
    "text": "cache before. Now, cache has two banks, and\nin each bank, only this many",
    "start": "2795600",
    "end": "2800610"
  },
  {
    "text": "things fit in, but the\nnext thing can go to the other bank. So if you go through\n[UNINTELLIGIBLE], you have the same behavior even if you\nhave associativity.",
    "start": "2800610",
    "end": "2807620"
  },
  {
    "text": "OK, you can go and-- because if the cache is the same\nsize, the size is what matters for if you are going\nthrough [UNINTELLIGIBLE] axis.",
    "start": "2807620",
    "end": "2814767"
  },
  {
    "text": "AUDIENCE: So far, [INAUDIBLE]\nmachines that we're working on, do they have a fixed\nkind of cache, or",
    "start": "2814767",
    "end": "2820773"
  },
  {
    "text": "can we decide like-- PROFESSOR: The fixed\nkind of cache. It's built into the hardware. I will show the table\nto say what type of",
    "start": "2820773",
    "end": "2826650"
  },
  {
    "text": "associativity is in there. AUDIENCE: Is there not a\nway to say [INAUDIBLE]",
    "start": "2826650",
    "end": "2832817"
  },
  {
    "text": "three-way associative? Can you have something on top\nof it so that it looks like it's two-way associative\nor something?",
    "start": "2832818",
    "end": "2838769"
  },
  {
    "text": "PROFESSOR: I mean, you can do\nthings like that in software, but they're very expensive.",
    "start": "2838770",
    "end": "2843810"
  },
  {
    "text": "I mean, think about cache is\ntrying to fool the cache in that direction cannot be that\neasy because they are like",
    "start": "2843810",
    "end": "2850710"
  },
  {
    "text": "really hard-baked into hardware.\nthat's a good question, but there are things\nyou can do, not exactly modeling something, but kind of\nputting offsets and stuff",
    "start": "2850710",
    "end": "2858690"
  },
  {
    "text": "like that so it doesn't get into\nthese kind of conflicts. ",
    "start": "2858690",
    "end": "2866140"
  },
  {
    "text": "So yeah, I will answer\nthis thing. Why don't you have more? Because if you go back to\nyour [UNINTELLIGIBLE]",
    "start": "2866140",
    "end": "2871950"
  },
  {
    "text": "lectures. Perhaps it might have\nexplanation in it's hardware why it's much harder to build. And if you have the\nlinked lists now--",
    "start": "2871950",
    "end": "2880730"
  },
  {
    "text": "so assume I have linked lists we\nare going through in here.",
    "start": "2880730",
    "end": "2886674"
  },
  {
    "text": "And what's my [UNINTELLIGIBLE]?",
    "start": "2886674",
    "end": "2892450"
  },
  {
    "text": "Basically, depending on\nallocation and using some things, so best case is\neverything is in cache, so I",
    "start": "2892450",
    "end": "2897980"
  },
  {
    "text": "have a small list. And I go through again and\nagain, round and around my list, everything's in cache\nand [UNINTELLIGIBLE]",
    "start": "2897980",
    "end": "2906280"
  },
  {
    "text": "S. That's really great. Next best is everything\nis adjacent.",
    "start": "2906280",
    "end": "2912130"
  },
  {
    "text": "OK, everything might not be in\nthe cache, but everything at least in adjacent memory. So basically, first time I\nallocate my malloc did a nice",
    "start": "2912130",
    "end": "2920120"
  },
  {
    "text": "thing for me, and at that time,\nI basically get a nice",
    "start": "2920120",
    "end": "2925480"
  },
  {
    "text": "basic spatial locality since\nmy size is 16 in here. So I get this much.",
    "start": "2925480",
    "end": "2931180"
  },
  {
    "text": "And the worst case is random. Malloc puts it all\nover the place. Question? AUDIENCE: [INAUDIBLE]",
    "start": "2931180",
    "end": "2937127"
  },
  {
    "text": "cache, does the thing behind it\n[UNINTELLIGIBLE] in front of it [UNINTELLIGIBLE]\nalso going to?",
    "start": "2937127",
    "end": "2942505"
  },
  {
    "text": "Do those both have a\nspatial locality? PROFESSOR: What happens is\nnormally, we assume 64 element",
    "start": "2942506",
    "end": "2956289"
  },
  {
    "text": "cache, so it's at that boundary,\nso basically 2 to",
    "start": "2956290",
    "end": "2964873"
  },
  {
    "text": "the 8 boundaries is\nwhat happens. So what happens is cache line\nbegins at 0 address, 64",
    "start": "2964873",
    "end": "2973829"
  },
  {
    "text": "address here. So if you get 63, that means\nthis value is not in the cache, so you get\nthis cache line.",
    "start": "2973830",
    "end": "2982120"
  },
  {
    "text": "So the cache line\ndoesn't shift. It's fixed chunks in here, so\nthat if you get address 0, you",
    "start": "2982120",
    "end": "2988839"
  },
  {
    "text": "get this one, and all\nthese things. If you get something in the\nmiddle, you'll get the left and right [UNINTELLIGIBLE], but\nif you get here, you only",
    "start": "2988840",
    "end": "2994300"
  },
  {
    "text": "get the right. So this basically 0 and 64,\nthey are boundaries [INAUDIBLE]. If you like 65, that's it.",
    "start": "2994300",
    "end": "3000430"
  },
  {
    "text": "But that said, if you're\naccessing [UNINTELLIGIBLE], that's this thing called\nprefetcher that say you are",
    "start": "3000430",
    "end": "3005789"
  },
  {
    "text": "going through linear pattern,\nand you might need that next, and it'll bring this\nup for you. And what you find, I'll show\nlater, that in fact, the",
    "start": "3005790",
    "end": "3015470"
  },
  {
    "text": "machine you're using has a\nreally powerful prefetcher, so it can hide a lot\nof these things. So we'll get to that.",
    "start": "3015470",
    "end": "3021520"
  },
  {
    "text": " So this is my total access\ntime in here.",
    "start": "3021520",
    "end": "3027940"
  },
  {
    "text": "Random case. Random case is basically, every\ntime I access something, it's not in the cache. ",
    "start": "3027940",
    "end": "3038339"
  },
  {
    "text": "And then if you have a bigger\nstruct in here-- but assume I have this big\nstruct in here, but I am only",
    "start": "3038340",
    "end": "3045690"
  },
  {
    "text": "accessing one element of\nthis struct in here.",
    "start": "3045690",
    "end": "3050829"
  },
  {
    "text": "I do a lot. I created this large struct,\nand I am [UNINTELLIGIBLE]",
    "start": "3050830",
    "end": "3055910"
  },
  {
    "text": "things in the struct,\nand I just basically looking at my data. Only one element.",
    "start": "3055910",
    "end": "3062310"
  },
  {
    "text": "What's the problem here? ",
    "start": "3062310",
    "end": "3078420"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE]  PROFESSOR: Exactly, so I bring\nthe entire cache line, but I'm",
    "start": "3078420",
    "end": "3085180"
  },
  {
    "text": "only using a little bit of it. Because I bring all these things\ninto the cache, it comes with axis and that,\nbut I'm only using data.",
    "start": "3085180",
    "end": "3093260"
  },
  {
    "text": "So basically, what happens is,\nif everything in the cache, I have access time S.\nThat's great.",
    "start": "3093260",
    "end": "3098440"
  },
  {
    "text": "That's not a problem,\n[UNINTELLIGIBLE] streaming. ",
    "start": "3098440",
    "end": "3104990"
  },
  {
    "text": "Even though I'm getting spatial\nlocality, I only get half of it because even though\nI'm bringing the cache line,",
    "start": "3104990",
    "end": "3110809"
  },
  {
    "text": "only two have datas because\nthis is 32 bytes long. It's in my cache.",
    "start": "3110810",
    "end": "3117150"
  },
  {
    "text": "Even though I am bringing all\nthis data, I only two of them in the cache because rest of\nthis other data is kind of",
    "start": "3117150",
    "end": "3124599"
  },
  {
    "text": "hanging in there with me,\nand so I don't get that. And random, of course,\nyou have no locality.",
    "start": "3124600",
    "end": "3130610"
  },
  {
    "text": "So how can I basically\nmake this better? ",
    "start": "3130610",
    "end": "3136010"
  },
  {
    "text": "How can I make this better? OK, I just showed\nit very fast. OK. AUDIENCE: [INAUDIBLE]",
    "start": "3136010",
    "end": "3141513"
  },
  {
    "text": " PROFESSOR: So instead, if I\nask you, I have this large data structure, but most of\ntime, I'm only accessing a",
    "start": "3141513",
    "end": "3149560"
  },
  {
    "text": "small part of it, this is kind\nof a little bit of a hack.",
    "start": "3149560",
    "end": "3156040"
  },
  {
    "text": "I mean, this is kind of going\nagainst, I guess 6005 kind of building, but this\nactually works.",
    "start": "3156040",
    "end": "3162120"
  },
  {
    "text": "What you can do is, you can go\nback and instead of doing structs, what you can do\nis you can do arrays",
    "start": "3162120",
    "end": "3168010"
  },
  {
    "text": "of each data item. And now what happens is that I\nam basically bringing these,",
    "start": "3168010",
    "end": "3173750"
  },
  {
    "text": "and then the data I am accessing\nis basically right now next to each other. ",
    "start": "3173750",
    "end": "3179700"
  },
  {
    "text": "So you might have this very\nlarge data structure representing something you\nhave a lot of, then.",
    "start": "3179700",
    "end": "3184880"
  },
  {
    "text": "But most of the time, you're\nonly using few of them, so you don't have to be structs\nof arrays. You might have couple of\ndifferent data structures.",
    "start": "3184880",
    "end": "3191930"
  },
  {
    "text": "One is the one that you access\nregularly hopefully you get them next to each other. And the nice thing about arrays\nis it guarantees things",
    "start": "3191930",
    "end": "3198635"
  },
  {
    "text": "are next to each other. Of course, was managing\nit is harder. AUDIENCE: [UNINTELLIGIBLE] ",
    "start": "3198635",
    "end": "3206358"
  },
  {
    "text": "PROFESSOR: You can do both. So that means instead of doing\nthe structs, you use arrays of each field.",
    "start": "3206358",
    "end": "3212440"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE] PROFESSOR: Instead of. So instead of doing this one,\nyou just do this one. AUDIENCE: [INAUDIBLE]",
    "start": "3212440",
    "end": "3218247"
  },
  {
    "text": "instead of being able\nto pass stuff over. Now you have to kind of be able\nto know [UNINTELLIGIBLE],",
    "start": "3218247",
    "end": "3225013"
  },
  {
    "text": "so what that is where because\nyou cannot just pass the struct [UNINTELLIGIBLE]. PROFESSOR: No, you can't\npass the struct.",
    "start": "3225013",
    "end": "3230410"
  },
  {
    "text": "You basically have to pad the\nindex in here for this structure, basically. So you have to know something\nin there. So this is a lot messier, but\nit can actually give you a",
    "start": "3230410",
    "end": "3238869"
  },
  {
    "text": "performance if you do this type\nof access, so it's not something you want everywhere. That's why you still want to\nuse structures and nice",
    "start": "3238870",
    "end": "3246130"
  },
  {
    "text": "classes and stuff. But this, if you're doing very\nlarge data, but most of the",
    "start": "3246130",
    "end": "3251580"
  },
  {
    "text": "you're accessing only small\namount, this kind of representation can help.",
    "start": "3251580",
    "end": "3257750"
  },
  {
    "text": "So I want to get a little bit\ninto matrix multiplying. So what we're looking at is this\nfour by four matrix, and",
    "start": "3257750",
    "end": "3266420"
  },
  {
    "text": "you can represent it using\nthis representation. But to make it clear, what I'm\ngoing to do is I'm just going",
    "start": "3266420",
    "end": "3273150"
  },
  {
    "text": "to allocate this entire thing\nas a single array, and I'm going to do that\n[UNINTELLIGIBLE] calculation myself because if you go a\nlittle bit down, you realize",
    "start": "3273150",
    "end": "3283080"
  },
  {
    "text": "this is allocated in a little\nbit of a weird way. And so this is what we call\nrow-major because all rows are",
    "start": "3283080",
    "end": "3292039"
  },
  {
    "text": "next to each other, and you\ncan access allocated column-major. Basically that means now A001,\ninstead of that, 1, 0 is next",
    "start": "3292040",
    "end": "3300790"
  },
  {
    "text": "to 0, 0, 1, 0, 2, 0. And then basically saying same\nthing, [UNINTELLIGIBLE]",
    "start": "3300790",
    "end": "3306859"
  },
  {
    "text": "instead of saying 4i plus\nj, it's just 4j plus i. You can do both.",
    "start": "3306860",
    "end": "3312340"
  },
  {
    "text": "So this is my nice matrix\nmultiply function, because the",
    "start": "3312340",
    "end": "3318460"
  },
  {
    "text": "reason I did it this way, it's\njust very clear how many axis I'm going to use.",
    "start": "3318460",
    "end": "3323810"
  },
  {
    "text": "So if you look at C, let's look\nat only the inner loop.",
    "start": "3323810",
    "end": "3328920"
  },
  {
    "text": "Most of the mapping matters\nin the inner loop. I go for k in 0 to size.",
    "start": "3328920",
    "end": "3335820"
  },
  {
    "text": "Only first axis on C is going to\nmiss because it's going up",
    "start": "3335820",
    "end": "3340830"
  },
  {
    "text": "[UNINTELLIGIBLE] same K, da-da-da-da-da, so\nC is very nice in here. Only get one miss in here. You have a question?",
    "start": "3340830",
    "end": "3346273"
  },
  {
    "text": "OK. A has a streaming pattern\nbecause every time I update K,",
    "start": "3346273",
    "end": "3351680"
  },
  {
    "text": "I go to the next element,\nnext element, next element, next element. [INAUDIBLE].",
    "start": "3351680",
    "end": "3357090"
  },
  {
    "text": "What type of a pattern\ndo I have in B? AUDIENCE: Looks like\n[INAUDIBLE]. PROFESSOR: Yeah, exactly. I have jumping on memory.",
    "start": "3357090",
    "end": "3363270"
  },
  {
    "text": "I'm jumping one to another. So if you look at that, I am\ngoing through A like that, and B, and going through C element\nat a time, basically.",
    "start": "3363270",
    "end": "3371730"
  },
  {
    "text": "So if you look at doing this\nin order to calculate one element of A, [INAUDIBLE]\ncalculating these, what you",
    "start": "3371730",
    "end": "3378710"
  },
  {
    "text": "have to do is I am getting\nB and C this way. I'm going through row here\nand column, and this row",
    "start": "3378710",
    "end": "3384820"
  },
  {
    "text": "[UNINTELLIGIBLE] fit into the cache line through\nthat because this is the memory. But C is just jumping all over\nthe memory, and I have no",
    "start": "3384820",
    "end": "3391970"
  },
  {
    "text": "locality in here. So what can we do here? What's the simplest\nthing in here?",
    "start": "3391970",
    "end": "3398290"
  },
  {
    "text": "How do we get some locality\ninto the C? ",
    "start": "3398290",
    "end": "3406166"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE] PROFESSOR: So yeah, you're\ncoming, you're getting it. That's the next thing that's\nmost important.",
    "start": "3406166",
    "end": "3413170"
  },
  {
    "text": "That's the more advanced\nthing you can do. We'll get there. What was a simple thing\nyou can do for C?",
    "start": "3413170",
    "end": "3418298"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE] PROFESSOR: [UNINTELLIGIBLE]  So here's the [UNINTELLIGIBLE]",
    "start": "3418298",
    "end": "3423630"
  },
  {
    "text": "execution time, original, and\nvoila, when you transpose that, you can actually get a\nhuge benefit in here because,",
    "start": "3423630",
    "end": "3430829"
  },
  {
    "text": "now, I get spatial locality\nin both sides in here. And so now when you're\ntransposed, I am going",
    "start": "3430830",
    "end": "3436570"
  },
  {
    "text": "through like this. So now what I did was I am\ngiving this CPI, and what",
    "start": "3436570",
    "end": "3442500"
  },
  {
    "text": "happens is when you transpose,\nI have a 5x improvement in sync CPI. That means instructions actually\nnot waiting, not",
    "start": "3442500",
    "end": "3448570"
  },
  {
    "text": "doing nothing. I have a pretty good reduce\nof cache misread.",
    "start": "3448570",
    "end": "3454900"
  },
  {
    "text": "because, now, I'm\nactually going through cache very nicely. So the next thing we can\ndo is, what she just",
    "start": "3454900",
    "end": "3461089"
  },
  {
    "text": "pointed out, blocking. So instead of matrix multiply,\njust multiplying this matrix at a time, you can multiply\nsubmatrices and calculate",
    "start": "3461090",
    "end": "3468920"
  },
  {
    "text": "small submatrices. And if you do that, the\nsubmatrix can nicely fit in the memory, so let\nme show you that.",
    "start": "3468920",
    "end": "3474440"
  },
  {
    "text": "This is the blocking code. Let me show you what\nthat means. So what we are doing is you are\nmultiplying this matrix by",
    "start": "3474440",
    "end": "3482580"
  },
  {
    "text": "this matrix in there and\ngetting this matrix. So what that means is, normally,\nwhat you do is, to",
    "start": "3482580",
    "end": "3489240"
  },
  {
    "text": "get one element, you have to\nmultiply a row and a column. Normally, we are calculating\na row of A at a time.",
    "start": "3489240",
    "end": "3496200"
  },
  {
    "text": "In order to get a row of A,\nI had to get a row of B [UNINTELLIGIBLE] entire C has to participate into\ncalculate A. So by the",
    "start": "3496200",
    "end": "3504520"
  },
  {
    "text": "time I have calculated 1024\nelements, I have gone through this many axises to new elements\nbasically because I",
    "start": "3504520",
    "end": "3512230"
  },
  {
    "text": "am getting B again and again,\nbut I had to go through the entire C in here. So if this much data is bigger\nthan the cache, I have no",
    "start": "3512230",
    "end": "3520550"
  },
  {
    "text": "locality in here. But if, instead of calculating\na row, if I calculate a 32 by",
    "start": "3520550",
    "end": "3527590"
  },
  {
    "text": "32 block, which is again 1024\nelements I am calculating. If I do that, I need a block\nhere and a block here, and I",
    "start": "3527590",
    "end": "3536050"
  },
  {
    "text": "only type this much data. ",
    "start": "3536050",
    "end": "3541200"
  },
  {
    "text": "OK, I'm getting the same amount\nof output, but because of reuse, I touch a lot\nless inputting here.",
    "start": "3541200",
    "end": "3551150"
  },
  {
    "text": "And just by doing this\ntransformation, I can really reduce the amount of data.",
    "start": "3551150",
    "end": "3556540"
  },
  {
    "text": "Basically, I can create a\nsmaller working set, go through that much more, and\nreduce the amount of cache",
    "start": "3556540",
    "end": "3562240"
  },
  {
    "text": "misses you get. So by doing that, I basically go\nout another 3x improvement in my CPI, really brought down\nmy L1 cache misses, and",
    "start": "3562240",
    "end": "3570140"
  },
  {
    "text": "basically eliminated\nL2 cache misses. OK, so I got a really good\nspeed up in here.",
    "start": "3570140",
    "end": "3578280"
  },
  {
    "text": "So you can block multiple\nlevels, L1, L2, L3, because every time you figure out the\nworkings and size, you block",
    "start": "3578280",
    "end": "3583750"
  },
  {
    "text": "so the data in that will be\nsafe in the cache in here. And this is kind of nasty\nto do by hand.",
    "start": "3583750",
    "end": "3591160"
  },
  {
    "text": "We'll see.  So the other interesting thing\nis call stack locality.",
    "start": "3591160",
    "end": "3597839"
  },
  {
    "text": "So if you do something like fib\nin here, traditional fib, if you do fib(4), you calculate\na fib(4), fib(3),",
    "start": "3597840",
    "end": "3606100"
  },
  {
    "text": "fib(2), you kind of build\na stack, go up back again in here. So if you keep doing that,\nthe nice thing is you're",
    "start": "3606100",
    "end": "3614020"
  },
  {
    "text": "going up, but its-- Hopefully, one of these days,\nI am going to hit the wrong",
    "start": "3614020",
    "end": "3620050"
  },
  {
    "text": "button, and-- ",
    "start": "3620050",
    "end": "3628520"
  },
  {
    "text": "What kind of locality do we have\nif we are accessing data like this in my call stack? ",
    "start": "3628520",
    "end": "3638089"
  },
  {
    "text": "What kind of locality\ndo we have? ",
    "start": "3638090",
    "end": "3643650"
  },
  {
    "text": "I mean, I access here, fib(4),\nand I get back to fib(4) here. ",
    "start": "3643650",
    "end": "3651319"
  },
  {
    "text": "So within each frame, I am\naccessing data next to each other, so I can have a little\nbit of a spatial locality",
    "start": "3651320",
    "end": "3661809"
  },
  {
    "text": "because, each frame, all the\ndata is next to each other. But across frames, normally,\nI will have some temporal",
    "start": "3661810",
    "end": "3667779"
  },
  {
    "text": "because I will get back to\nthat data some time. OK? ",
    "start": "3667780",
    "end": "3678790"
  },
  {
    "text": "OK, before I summarize,\nthis one. If you are reading a lot of\ndata, processing through stage",
    "start": "3678790",
    "end": "3686240"
  },
  {
    "text": "one, [UNINTELLIGIBLE] and producing [UNINTELLIGIBLE],\nthat means you're reading a huge amount\nof data through stage one,",
    "start": "3686240",
    "end": "3692000"
  },
  {
    "text": "save, save data again, do stage\ntwo, you have really bad",
    "start": "3692000",
    "end": "3697600"
  },
  {
    "text": "cache locality. One thing you can do is read a\nsmall chunk, do all the stages on that small chunk, save it,\nand go to another chunk.",
    "start": "3697600",
    "end": "3704970"
  },
  {
    "text": "So instead of doing the entire\ndata, doing something [UNINTELLIGIBLE] producing, you can do this\nchunk-ifying, and by doing",
    "start": "3704970",
    "end": "3710550"
  },
  {
    "text": "that, you can get a\nlot of locality. So once you bring in data, you\nlike to do as many things as",
    "start": "3710550",
    "end": "3716099"
  },
  {
    "text": "possible to that data before\nit gets out of the cache. That's the entire thing about\nlocality, and you can",
    "start": "3716100",
    "end": "3721260"
  },
  {
    "text": "restructure code through that. So if you look at that, what\nwe have done today, we have",
    "start": "3721260",
    "end": "3727680"
  },
  {
    "text": "looked at things like\nassociativity, cache lines, cache sets in here, and how to\naddress and map to a cache, we",
    "start": "3727680",
    "end": "3736035"
  },
  {
    "text": "kind of did this thing, and we\nlook at [UNINTELLIGIBLE] streamings versus InCache\nversus no",
    "start": "3736035",
    "end": "3741550"
  },
  {
    "text": "locality type patterns. And then when you look at data\nstructure transformation, we",
    "start": "3741550",
    "end": "3747540"
  },
  {
    "text": "look at how to basically replace\nstructured arrays and split data structures to make\nsure that you get a lot of",
    "start": "3747540",
    "end": "3755130"
  },
  {
    "text": "nice locality if you access a\ncertain amount of data, and",
    "start": "3755130",
    "end": "3760230"
  },
  {
    "text": "pack data to get smaller cache\nfootprints kind of things. And we also look at computer\ntransformations, things like",
    "start": "3760230",
    "end": "3765760"
  },
  {
    "text": "transpose copying, compute copy,\nouttype things you can do, so you can actually get nice\nlocality, so you can do",
    "start": "3765760",
    "end": "3773040"
  },
  {
    "text": "both data and compute\ntransformations. And [UNINTELLIGIBLE] axises and [? re-cast ?]",
    "start": "3773040",
    "end": "3781360"
  },
  {
    "text": "calculation stages, so this\nis kind of summary. Next thing I want go is\nlook at what machines",
    "start": "3781360",
    "end": "3787560"
  },
  {
    "text": "you guys are using. So this is the machines\nwe used last year. These are quad cores, and it\nhad L1 cache, so these",
    "start": "3787560",
    "end": "3795390"
  },
  {
    "text": "[UNINTELLIGIBLE]. So this has 32 kilobyte\nL1 cache, data cache",
    "start": "3795390",
    "end": "3800799"
  },
  {
    "text": "[UNINTELLIGIBLE] two caches in here for data and\ninstructions, each core, and then the cache line size\nis normally 64 bytes",
    "start": "3800800",
    "end": "3807890"
  },
  {
    "text": "[UNINTELLIGIBLE]. And here, latency\n[UNINTELLIGIBLE], you get three cycles.",
    "start": "3807890",
    "end": "3813780"
  },
  {
    "text": "If not, you get 14 cycles to\ngo to to L2 in here if data",
    "start": "3813780",
    "end": "3821420"
  },
  {
    "text": "doesn't meet there. And associated with this\n[UNINTELLIGIBLE PHRASE].  So that was what we\ndid last year.",
    "start": "3821420",
    "end": "3828690"
  },
  {
    "text": "This year, we have a bigger\nmachine that has multiple levels of caches. So each core has L1 instruction\nand data cache.",
    "start": "3828690",
    "end": "3837490"
  },
  {
    "text": "It's kind of the same, 32\nkilobyte cache, four nanosecond latency in here. Eight, three and four\n[UNINTELLIGIBLE], they kind of",
    "start": "3837490",
    "end": "3843930"
  },
  {
    "text": "reduced that, but they added a\n256-kilobyte L2 cache in here,",
    "start": "3843930",
    "end": "3850369"
  },
  {
    "text": "and then a pretty large humongo 12-megabyte L3 cache in here.",
    "start": "3850370",
    "end": "3856280"
  },
  {
    "text": "The interesting thing is here,\nthis pretty fast access to these ones. If you miss in here, this is\nabout 2 and 1/2 times cost",
    "start": "3856280",
    "end": "3867410"
  },
  {
    "text": "from going from here to here. From here to [UNINTELLIGIBLE],\nabout a five times cost, so",
    "start": "3867410",
    "end": "3873780"
  },
  {
    "text": "here to here is a\nfive times cost. The interesting thing that\nactually surprises a lot us was here to here, it's cost\nis not that different.",
    "start": "3873780",
    "end": "3880410"
  },
  {
    "text": "[UNINTELLIGIBLE PHRASE] So actually memory, even though\nit's sitting out in there, they have managed to get\nit pretty cheap access.",
    "start": "3880410",
    "end": "3888520"
  },
  {
    "text": "Normally, my intuition say this\nshould be much higher because you're going off-chip,\nso this is the structure here.",
    "start": "3888520",
    "end": "3894200"
  },
  {
    "text": "It's a lot more complicated. So here's something I\nproduced last year. So what I did was I\nran this program.",
    "start": "3894200",
    "end": "3902829"
  },
  {
    "text": "And in these machines, there's a\nway to turn off the prefetch of the previous\n[UNINTELLIGIBLE].",
    "start": "3902830",
    "end": "3908060"
  },
  {
    "text": "So when you've turned on the\nprefetch and then you run, what you are doing is I am\naccessing data with a working",
    "start": "3908060",
    "end": "3913230"
  },
  {
    "text": "set, small working set, little\nbit bigger working set. So this is basically when you\nconsider working set size.",
    "start": "3913230",
    "end": "3919360"
  },
  {
    "text": "So you get a graph like this. I am hitting my L1 cache, and\nif it is more than that, I",
    "start": "3919360",
    "end": "3928119"
  },
  {
    "text": "[UNINTELLIGIBLE] L1 cache, I go to my L2 cache. ",
    "start": "3928120",
    "end": "3934440"
  },
  {
    "text": "And if L2 misses, I have\nto go to main memory. Very traditional kind\nof a graph in here.",
    "start": "3934440",
    "end": "3940319"
  },
  {
    "text": " Another a little bit of an\ninteresting thing, which is",
    "start": "3940320",
    "end": "3946160"
  },
  {
    "text": "instead of accessing\nnext item, I kind of skipped in here. So this trying to force how\nto get conflict misses.",
    "start": "3946160",
    "end": "3957590"
  },
  {
    "text": "And so if you line up things\nlike this exactly, what happens is you get these\nconflict misses, and you get",
    "start": "3957590",
    "end": "3964470"
  },
  {
    "text": "this number. So I have interesting\nstory to tell. When I was a graduate student,\nwe were running this bunch of",
    "start": "3964470",
    "end": "3969860"
  },
  {
    "text": "benchmarks, and normally when\nyou run a benchmark, you try it for an equal",
    "start": "3969860",
    "end": "3975240"
  },
  {
    "text": "[UNINTELLIGIBLE], stuff like that. And we got this graph\nlike this.",
    "start": "3975240",
    "end": "3981310"
  },
  {
    "text": "I mean, we expect a graph\ngoing like this.",
    "start": "3981310",
    "end": "3986410"
  },
  {
    "text": "OK, that how a benchmark\n[UNINTELLIGIBLE]. Then at one point, by accident,\ninstead of typing an",
    "start": "3986410",
    "end": "3992079"
  },
  {
    "text": "equal 64-something, I typed an\nequal 63, and suddenly, I got",
    "start": "3992080",
    "end": "3997120"
  },
  {
    "text": "a performance like this. Wait a minute, what's\ngoing on? So in here, what I got\nwas not a line.",
    "start": "3997120",
    "end": "4003420"
  },
  {
    "text": "I got 16, 32, 64, 128,\nnice graph like that.",
    "start": "4003420",
    "end": "4009020"
  },
  {
    "text": "And then I just did 63,\nlike down to here. I'm like, geeze, that\ncan't be right. And then I start looking\nat 62, which is here.",
    "start": "4009020",
    "end": "4015500"
  },
  {
    "text": "61 is here. So I realize if I enumerate\nall those things, I got a",
    "start": "4015500",
    "end": "4020720"
  },
  {
    "text": "graph like this, basically.  Kind of something like this.",
    "start": "4020720",
    "end": "4027599"
  },
  {
    "text": "And the thing is, if I had never\ntried the 63, I would have basically thought my\nperformance was like",
    "start": "4027600",
    "end": "4033780"
  },
  {
    "text": "this, so far worse. Never realized because it was\nall having conflicts in memory",
    "start": "4033780",
    "end": "4040210"
  },
  {
    "text": "because I'm [UNINTELLIGIBLE] 2 to the power numbers. So this is what happens if you\njust look at 2 to the power",
    "start": "4040210",
    "end": "4045300"
  },
  {
    "text": "numbers, you'll think, yeah,\nthis is the performance you're getting, without realizing\nthat, in fact, you can get this far.",
    "start": "4045300",
    "end": "4051289"
  },
  {
    "text": "So this is good. So I ran it on the\nnew machine. The problem with our new machine\nis there's no way to",
    "start": "4051290",
    "end": "4056650"
  },
  {
    "text": "turn off prefetching. OK, so this is what\nyou're getting. Everything, because I am\naccessing this nice linear,",
    "start": "4056650",
    "end": "4064320"
  },
  {
    "text": "looks same. This is exactly what\nyou want to happen. What it's doing is, minute you\ngo to access, it realizes you",
    "start": "4064320",
    "end": "4070760"
  },
  {
    "text": "accessing linearly. It start fetching, fetching,\nfetching data in front you, it's going to catch up. It's not feeding you data, so\nyou're not going to have any",
    "start": "4070760",
    "end": "4077840"
  },
  {
    "text": "cache missed because you're\ngoing through this nice, linear pattern, and you just\nbasic end up with this",
    "start": "4077840",
    "end": "4084060"
  },
  {
    "text": "beautiful graph, which gives the\nfeeling your working set could be, now, gigabytes long.",
    "start": "4084060",
    "end": "4089870"
  },
  {
    "text": " At this point, I am fitting into\nthe entire L3 cache, and",
    "start": "4089870",
    "end": "4099620"
  },
  {
    "text": "still look like this works\nbeautiful because this is what you want for it to figure out. So now I'm like, geeze,\nthis is great.",
    "start": "4099620",
    "end": "4105739"
  },
  {
    "text": "This means my cache works, it's\nvery nice, but I want to show you guys what's going\non, so that doesn't help.",
    "start": "4105740",
    "end": "4110849"
  },
  {
    "text": "So I came up with\nthis program. So this program, what I did was\nI created a working set,",
    "start": "4110850",
    "end": "4117240"
  },
  {
    "text": "but I'm accessing randomly\nwithin that working set. I calculated this address. This is my poor man's random\nnumber generator, so basically",
    "start": "4117240",
    "end": "4124699"
  },
  {
    "text": "I'm adding number in here and\nmultiplying this, and then the",
    "start": "4124700",
    "end": "4135630"
  },
  {
    "text": "masking these to get the\nright [UNINTELLIGIBLE] so I get within that\nset in here.",
    "start": "4135630",
    "end": "4141850"
  },
  {
    "text": "And then I just access\ndata, so I'm getting [UNINTELLIGIBLE]. So I get a number like this,\nand this jump up here, and then I had this kind\nof behavior.",
    "start": "4141850",
    "end": "4149620"
  },
  {
    "text": "This is a lot more\ncomplicated. I need to figure out what the\nhell is going on in here, so I said, OK, let's now look at\nperformance counters.",
    "start": "4149620",
    "end": "4155729"
  },
  {
    "text": "I look at L1 cache miss. OK, up to 32K, I have\nno cache misses. Boom, cache misses jump up.",
    "start": "4155729",
    "end": "4162693"
  },
  {
    "text": "Perfect. And I have this little bit of a\nkink in here, this beautiful describes because I have 32K\nL1 cache, and until then, I",
    "start": "4162694",
    "end": "4170670"
  },
  {
    "text": "have no things, and then when\nthe cache start missing, I'm jumping up. Perfect. I got that description here.",
    "start": "4170670",
    "end": "4176549"
  },
  {
    "text": "Then I look at my\nL2 cache misses. This is, I think, the L2 cache\nin this machine might have a",
    "start": "4176550",
    "end": "4181915"
  },
  {
    "text": "little bit more complex\n[UNINTELLIGIBLE] telling us because this\nis not going like here had jumping up.",
    "start": "4181915",
    "end": "4187449"
  },
  {
    "text": "That's a 256K [UNINTELLIGIBLE] get. Is this 256? Yeah. [INAUDIBLE]",
    "start": "4187450",
    "end": "4192580"
  },
  {
    "text": "250 is [UNINTELLIGIBLE] these things. OK, so we have 32 256 2L\nmegabytes in here.",
    "start": "4192580",
    "end": "4198920"
  },
  {
    "text": "Even if you have 256 in here-- AUDIENCE: [INAUDIBLE]",
    "start": "4198920",
    "end": "4204284"
  },
  {
    "text": " PROFESSOR: Hm? AUDIENCE: Should it\nbe 256 or 32--",
    "start": "4204284",
    "end": "4209385"
  },
  {
    "text": "PROFESSOR: [UNINTELLIGIBLE] because everything's backed\nup, it's hierarchy [UNINTELLIGIBLE], so it's not\nadded to, it's not next to each other, because at this\npoint, L1 is now useless.",
    "start": "4209386",
    "end": "4216820"
  },
  {
    "text": "It'll run everything is just\ngoing to L2, so L2 is the one who was serving it. ",
    "start": "4216820",
    "end": "4224800"
  },
  {
    "text": "Come on. ",
    "start": "4224800",
    "end": "4229920"
  },
  {
    "text": "So what happens in here, this\nnormally should start jumping here, 256, but it start jumping\nearlier, so there",
    "start": "4229920",
    "end": "4236390"
  },
  {
    "text": "might be some other interesting thing going on here. It might be interesting\nto investigate.",
    "start": "4236390",
    "end": "4242130"
  },
  {
    "text": "So this is OK, so still\nI am pretty close. I realized this jump is\nbasically because of L2",
    "start": "4242130",
    "end": "4248740"
  },
  {
    "text": "happen, this jump in here. L2 start missing. Then I look at L3.",
    "start": "4248740",
    "end": "4253889"
  },
  {
    "text": "It's here. What's happening here?",
    "start": "4253890",
    "end": "4258940"
  },
  {
    "text": "So this was a big mystery the\ntwo of us were trying to debug what one hour ago.",
    "start": "4258940",
    "end": "4266130"
  },
  {
    "text": "Not one hour. Class is going. Like two hours ago. We was trying to figure out,\nOK, wait a minute, this doesn't make sense. My performance is here.",
    "start": "4266130",
    "end": "4272000"
  },
  {
    "text": "L3 should be just basically a\nnice flattening out here, and just jumping. It's not doing that, and we are\nlike what's going on here.",
    "start": "4272000",
    "end": "4278480"
  },
  {
    "text": "So then we were scratching our\nheads, and we start looking. I say, ha, there were other\nthings going on.",
    "start": "4278480",
    "end": "4283630"
  },
  {
    "text": "We looked at this thing\ncalled TLB. Let me tell you what TLB is. What we realize is at this\npoint, we are [? seeing ?]",
    "start": "4283630",
    "end": "4289989"
  },
  {
    "text": "TLB misses. How many people know\nwhat a TLB is?",
    "start": "4289990",
    "end": "4295900"
  },
  {
    "text": "OK, good, so let me spend the\nlast couple of minutes explaining what a TLB this,\nand that kind of explain",
    "start": "4295900",
    "end": "4301360"
  },
  {
    "text": "what's going on in this graph. So TLB means--",
    "start": "4301360",
    "end": "4308080"
  },
  {
    "text": "Normally, data is stored in\nmemory using real addresses.",
    "start": "4308080",
    "end": "4314910"
  },
  {
    "text": "That means there's a memory\nsize in here, there's an address format, there's certain\n[UNINTELLIGIBLE]. And then the program for\nit use virtual memory.",
    "start": "4314910",
    "end": "4322400"
  },
  {
    "text": "That means programs want to feel\nlike they have a lot more memory than actual, physical\nmemory available.",
    "start": "4322400",
    "end": "4327540"
  },
  {
    "text": "So what happens is you have\nvirtual memory address, but somebody has to map virtual\nmemory to physical memory.",
    "start": "4327540",
    "end": "4333260"
  },
  {
    "text": "So the way it work is there's\na thing called translation lookaside buffer, TLB, that says\nif you give this virtual",
    "start": "4333260",
    "end": "4340690"
  },
  {
    "text": "address, here's the right\nphysical address. So of course you can't do it for\neach address by address. What you have is you have 4K\npages, so the address space is",
    "start": "4340690",
    "end": "4350880"
  },
  {
    "text": "broken down into 4K pages.  Each page will have an entry in\nthis TLB, saying if you get",
    "start": "4350880",
    "end": "4362140"
  },
  {
    "text": "this virtual address, here's\nthe right physical address. So normally what happens is when\nthe operating system they",
    "start": "4362140",
    "end": "4368530"
  },
  {
    "text": "created this large table, for\nevery place in memory, you use this table, and it loads\ninto memory.",
    "start": "4368530",
    "end": "4376039"
  },
  {
    "text": "Then the hardware will fetch\nand cache some of those entries in this TLB\ncache in there.",
    "start": "4376040",
    "end": "4383820"
  },
  {
    "text": "So normally what happens is in\nhere, it caches 52L entries.",
    "start": "4383820",
    "end": "4389679"
  },
  {
    "text": "It can keep 52L entries\nto 52L pages, saying here's the mapping. The problem with 52L pages is\nin a 4K byte page size, 52L",
    "start": "4389680",
    "end": "4400240"
  },
  {
    "text": "pages can only hold two\nmegabytes of data. If you're accessing more than\ntwo megabytes of data, you",
    "start": "4400240",
    "end": "4407640"
  },
  {
    "text": "have to go more than 52L pages,\nand at that point, that mapping is not in the TLB, and\nthat means that you have to go",
    "start": "4407640",
    "end": "4414010"
  },
  {
    "text": "do a mapping translation. The problem for this is\nthese 4K pages is a very ancient artifact.",
    "start": "4414010",
    "end": "4422440"
  },
  {
    "text": "There's the new machines, you\ncan I ask for what we call large-pages or super, but you\ncan ask for 2-megabyte or",
    "start": "4422440",
    "end": "4428195"
  },
  {
    "text": "4-megabyte pages. If you ask for super-pages, then\nof course, 52L entry's",
    "start": "4428195",
    "end": "4433220"
  },
  {
    "text": "good enough. It can hold enough things not\nto have TLB miss, at least",
    "start": "4433220",
    "end": "4438550"
  },
  {
    "text": "while you're in the cache. But since Linux, without doing\nanything, only asks for 4K pages, before you run out of\nyour L3 cache, you run out of",
    "start": "4438550",
    "end": "4446230"
  },
  {
    "text": "the TLB table. And it has to start fetching\nand [UNINTELLIGIBLE]",
    "start": "4446230",
    "end": "4451650"
  },
  {
    "text": "data table, that means you had\nto actually fetch the table entries, and so you have\nto do more fetchings. So that is why this is even\nrunning higher, because it's",
    "start": "4451650",
    "end": "4458880"
  },
  {
    "text": "trying to fetch this TLB entry\nand stuff like that. Question? AUDIENCE: Is there a way to then\nactually fiddle with the",
    "start": "4458880",
    "end": "4465508"
  },
  {
    "text": "TLB so that you have to fit\nyour pages rather than-- PROFESSOR: So in allocation, you\ncan ask for super-pages or",
    "start": "4465508",
    "end": "4472449"
  },
  {
    "text": "large-pages. But in Linux, normally just ask\nfor 4K pages, so that the",
    "start": "4472450",
    "end": "4478520"
  },
  {
    "text": "operating systems haven't\nkind of caught up to the current hardware. And this is was built\n[UNINTELLIGIBLE]",
    "start": "4478520",
    "end": "4483559"
  },
  {
    "text": "doesn't make sense TLB\nto run out before you run out the cache. I mean, that's kind of\nmismatch in here.",
    "start": "4483560",
    "end": "4489590"
  },
  {
    "text": "But it's built assuming you'll\nget large-pages, but if you don't, you're going to run\nout of the TLB in there.",
    "start": "4489590",
    "end": "4494780"
  },
  {
    "text": "So this is why sometimes\nperformance engineering is interesting, exciting, and\nfrustrating, because you",
    "start": "4494780",
    "end": "4501469"
  },
  {
    "text": "assume you know where the\nhell this is going. You assume this is going to go\nhere and that, and suddenly, this miss shows up, and so we\nhave to scratch our heads.",
    "start": "4501470",
    "end": "4508239"
  },
  {
    "text": "And luckily, we found what's\ngoing on, but we could have spent hours or days trying to\nfigure out what's going on",
    "start": "4508240",
    "end": "4514560"
  },
  {
    "text": "here because this is one\n[UNINTELLIGIBLE] say OK, let's try TLB,\nand it worked.",
    "start": "4514560",
    "end": "4519900"
  },
  {
    "text": "That was really good, but I\nhave, many cases, spent days trying to figure out why\nsomething is going on because",
    "start": "4519900",
    "end": "4527450"
  },
  {
    "text": "performance is kind of\na [UNINTELLIGIBLE] of everything. There's no nice abstractions\nand stuff like that. If you think abstraction wise,\nsomewhere outside the",
    "start": "4527450",
    "end": "4535590"
  },
  {
    "text": "abstraction, that's\ngoing to kill you. So that is why it can be\ninteresting, because you have to know everything.",
    "start": "4535590",
    "end": "4541870"
  },
  {
    "text": "And the fun thing is, once you\nunderstand performance, you basically understand end-to-end,\nsoup to nuts,",
    "start": "4541870",
    "end": "4547730"
  },
  {
    "text": "what's going on. OK, with that encouraging\nthought, let's see how you guys do in the next part\nof project two.",
    "start": "4547730",
    "end": "4555335"
  },
  {
    "start": "4555335",
    "end": "4563691"
  }
]