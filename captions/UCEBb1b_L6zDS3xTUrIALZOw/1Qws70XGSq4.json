[
  {
    "start": "0",
    "end": "53000"
  },
  {
    "text": " The following content is\nprovided under a Creative Commons license. Your support will help\nMIT OpenCourseWare",
    "start": "0",
    "end": "7060"
  },
  {
    "text": "continue to offer high quality\neducational resources for free. To make a donation or to\nview additional materials",
    "start": "7060",
    "end": "13690"
  },
  {
    "text": "from hundreds of MIT courses,\nvisit MIT OpenCourseWare at ocw.mit.edu. ",
    "start": "13690",
    "end": "22519"
  },
  {
    "text": "TADGE DRYJA: Today we're going\nto talk about synchronization-- how all these different\nnodes on the network",
    "start": "22520",
    "end": "27949"
  },
  {
    "text": "come to consensus,\nhow they link up. So it's sort of bringing\nit all together.",
    "start": "27950",
    "end": "33540"
  },
  {
    "text": "So so far in these\nlectures we've talked about signatures,\nmining and blocks, transactions",
    "start": "33540",
    "end": "40910"
  },
  {
    "text": "and scripts. And now we're going to\nput it all together. How does this all actually work? What do all these components\ncome together to do?",
    "start": "40910",
    "end": "47730"
  },
  {
    "text": "And how does this\nmake this cool money? Quick recap on\nsignatures that I think",
    "start": "47730",
    "end": "54860"
  },
  {
    "start": "53000",
    "end": "113000"
  },
  {
    "text": "you got the idea\nfrom the homeworks, from the lectures-- you have\nthese public and private keys.",
    "start": "54860",
    "end": "60980"
  },
  {
    "text": "This key pair where you\ngenerate the private key, you distribute the public key. The private key\ncan sign a message.",
    "start": "60980",
    "end": "68299"
  },
  {
    "text": "And anyone can verify, given\nthe triple public key, message,",
    "start": "68300",
    "end": "74240"
  },
  {
    "text": "signature group. This is useful for\nlots of things-- providing identity, ownership,\nall sorts of things.",
    "start": "74240",
    "end": "80390"
  },
  {
    "text": "And it's better than\npaper signatures. Paper signatures don't\nreally sign the message.",
    "start": "80390",
    "end": "86120"
  },
  {
    "text": "They just sort of\nsign the paper. So if you change some\npart of a document,",
    "start": "86120",
    "end": "92090"
  },
  {
    "text": "the signature still\nsort of looks OK. Maybe you can see-- you want the paper\nto not be tampered.",
    "start": "92090",
    "end": "97850"
  },
  {
    "text": "But you can sign a\nblank piece of paper and then add all this\ntext on afterwards.",
    "start": "97850",
    "end": "103159"
  },
  {
    "text": "You can't do that\nwith these systems. So signatures are really cool. And they are sort of a necessary\nthing for this network to work.",
    "start": "103160",
    "end": "113760"
  },
  {
    "start": "113000",
    "end": "160000"
  },
  {
    "text": "So mining and blocks-- I think you sort of got the idea\nwith the Lamport signatures. If you've looked at the\ncurrent problem set,",
    "start": "113760",
    "end": "120880"
  },
  {
    "text": "it makes a lot of sense. You change it nonce, hash a\nbunch of times while you change",
    "start": "120880",
    "end": "126560"
  },
  {
    "text": "a nonce a bunch of times. Try to get a low output. So you get the idea of mining. You're proving work\nby repeatedly going",
    "start": "126560",
    "end": "134920"
  },
  {
    "text": "through different nonces, trying\nto find a certain hash output that there's no shortcut to.",
    "start": "134920",
    "end": "139990"
  },
  {
    "text": "You just have the\nguess and check. And now if you include\nthe previous data as part of your input\nto that hash function,",
    "start": "139990",
    "end": "147069"
  },
  {
    "text": "you can make a chain of work. And that's what we call\na blockchain I guess.",
    "start": "147070",
    "end": "153220"
  },
  {
    "text": "Any questions on this so far? It's the basic idea\nfrom two lectures ago.",
    "start": "153220",
    "end": "159120"
  },
  {
    "text": "Cool. And a recap of what\nNeha said yesterday--",
    "start": "159120",
    "end": "164815"
  },
  {
    "text": "there's transactions\nand scripts. I'm not going to go\ninto scripts too much yet, because in practice,\n99% of the scripts",
    "start": "164815",
    "end": "173870"
  },
  {
    "text": "are just checking a\npublic key signature. You can do all sorts of other\ncrazy things with the scripts.",
    "start": "173870",
    "end": "181160"
  },
  {
    "text": "But almost nobody does yet. Basically they say, OK, I'm\nsending to a public key hash.",
    "start": "181160",
    "end": "186860"
  },
  {
    "text": "When I spend from it, I\nreveal the public key, check that the hash\nmatches, check a signature.",
    "start": "186860",
    "end": "192892"
  },
  {
    "text": "And transactions have\ninputs and outputs. We went over this yesterday. Just a sort of\nreal-world numbers,",
    "start": "192892",
    "end": "202120"
  },
  {
    "text": "this is how big\nthings are, \"ish,\" so a transaction ID\nand index to point",
    "start": "202120",
    "end": "208810"
  },
  {
    "text": "to a previous transaction. The transaction ID is 32 bytes. The index is encoded as a\nfour byte, so 32-bit integer,",
    "start": "208810",
    "end": "216677"
  },
  {
    "text": "which is kind of overkill,\nbecause I think the most that there's ever-- the most outputs\nthere's ever been is like 1,000 or something.",
    "start": "216677",
    "end": "223480"
  },
  {
    "text": "So you really don't need it to\nbe able to go up to 4 billion. But that's how it is.",
    "start": "223480",
    "end": "229450"
  },
  {
    "text": "The signature ends up\nbeing about 100 bytes because you have to provide\nthe public key, which is either",
    "start": "229450",
    "end": "235000"
  },
  {
    "text": "33 or 65. And then the signature itself\nis encoded to something like 70 bytes.",
    "start": "235000",
    "end": "241360"
  },
  {
    "text": "Both of those things could\nbe much more efficient. But they're not yet.",
    "start": "241360",
    "end": "246461"
  },
  {
    "text": "And the output is\nactually a lot smaller. An output, the script-- the main thing is\nyour public key hash,",
    "start": "246462",
    "end": "252110"
  },
  {
    "text": "which in Bitcoin is 20 bytes. And then you have those\nother little opcodes, which it adds a\nfew bytes, and then",
    "start": "252110",
    "end": "258338"
  },
  {
    "text": "your amount, which is--\nso all amounts in Bitcoin are encoded as 8-byte,\nsigned 64-bit integers.",
    "start": "258339",
    "end": "265405"
  },
  {
    "text": "So you can have\npretty high precision. And that's also overkill, since\nall the bitcoins ever mined,",
    "start": "265405",
    "end": "272500"
  },
  {
    "text": "put together-- if you added them all up, it's\nnowhere near 64 bits to the 64.",
    "start": "272500",
    "end": "279100"
  },
  {
    "text": "It's like 2 to the 40 something. So it's also kind of\noverkill but yeah, whatever.",
    "start": "279100",
    "end": "286180"
  },
  {
    "text": "So this ends up being for a one\ninput, one output transaction, less than 200 bytes.",
    "start": "286180",
    "end": "291640"
  },
  {
    "text": " So that's a message,\npretty small. You can broadcast it\naround the network.",
    "start": "291640",
    "end": "298986"
  },
  {
    "text": "Inputs point to old\noutputs, have signatures. Outputs have scripts\nand coin amounts. So what do we do with\nall these things?",
    "start": "298986",
    "end": "305630"
  },
  {
    "start": "303000",
    "end": "450000"
  },
  {
    "text": "What is the mining process? So in the homework,\nyou're mining your name. You connect to the\nserver, figure out",
    "start": "305630",
    "end": "312100"
  },
  {
    "text": "with the last block was, put\nyour name on, put a nonce, and continue to mine. That's not super useful,\nunless you want to prove that",
    "start": "312100",
    "end": "318940"
  },
  {
    "text": "you're-- hey, this is me. In Bitcoin, the\nbasic idea is users",
    "start": "318940",
    "end": "324220"
  },
  {
    "text": "are making these transactions. Transactions are moving coins\nfrom one place to another, from one key to another.",
    "start": "324220",
    "end": "330819"
  },
  {
    "text": "They make the transactions, they\nsign them, and they broadcast. I'll get in to what\n\"broadcast\" means.",
    "start": "330820",
    "end": "336860"
  },
  {
    "text": "So in the current\nproblem set, there's one server, which is not really\na robust distributed system,",
    "start": "336860",
    "end": "344500"
  },
  {
    "text": "as people may have\nseen yesterday from about 1:30 to 3:00 PM,\nwhen the whole thing went down.",
    "start": "344500",
    "end": "352390"
  },
  {
    "text": "In Bitcoin, it's\ncompletely peer-to-peer. Every node is the same. They're all listening\nfor people connecting in.",
    "start": "352390",
    "end": "359180"
  },
  {
    "text": "They're all connecting\nout to other nodes. And they broadcast. So if someone sends\nyou a message,",
    "start": "359180",
    "end": "365410"
  },
  {
    "text": "you'll pass it on to\nall the other people. So it's called a gossip network. In practice, it works OK.",
    "start": "365410",
    "end": "372310"
  },
  {
    "text": "It's fairly heavy load\non some network traffic, but you can make transactions,\nsign them, broadcast them.",
    "start": "372310",
    "end": "378880"
  },
  {
    "text": "And then someone,\nthe miner, takes all these recent\ntransactions that they've",
    "start": "378880",
    "end": "384590"
  },
  {
    "text": "seen, and puts them into a\nblock, and then does some work. So those transactions\nare now confirmed,",
    "start": "384590",
    "end": "391080"
  },
  {
    "text": "and people can build\nthe next block. So the only difference from\nthe current problem set",
    "start": "391080",
    "end": "396840"
  },
  {
    "text": "is instead of putting\nyour name in, you put-- you can put your name-- but\nyou also put all these messages",
    "start": "396840",
    "end": "403290"
  },
  {
    "text": "that you've seen recently. And so you commit\nto them that way. You could do it by just\nsticking them all in,",
    "start": "403290",
    "end": "409930"
  },
  {
    "text": "but instead, there's a bit\nmore advanced way to do it. You use what's called\na block header.",
    "start": "409930",
    "end": "417450"
  },
  {
    "text": "So yeah, the block header\nitself is the message. So similar to the problem\nset, it's the block header",
    "start": "417450",
    "end": "423090"
  },
  {
    "text": "that you need to hash to get a\nlow output value, not the block itself, which is\nkind of interesting.",
    "start": "423090",
    "end": "429040"
  },
  {
    "text": "And the headers have a hash\nof all the transactions in the blocks. So you don't just put\nall the transactions",
    "start": "429040",
    "end": "434730"
  },
  {
    "text": "into one big megabyte\ndata structure, hash the whole thing, and\nthen try to get a low output.",
    "start": "434730",
    "end": "439860"
  },
  {
    "text": "You actually do some\nintermediate steps first. And what's interesting\nis it's actually just the headers that\nmake a chain, not",
    "start": "439860",
    "end": "446040"
  },
  {
    "text": "the blocks themselves. So instead of blockchain, you\ncould call it a headerchain. So I'll talk about headers.",
    "start": "446040",
    "end": "453260"
  },
  {
    "start": "450000",
    "end": "607000"
  },
  {
    "text": "The headers are 80 bytes. And they're actually quite\nsimilar to the blocks in problem set 2.",
    "start": "453260",
    "end": "458900"
  },
  {
    "text": "So the main three\ncomponents are you've got the previous hash, the\nMerkle root, and the nonce. And so this is like\nin the problem set.",
    "start": "458900",
    "end": "465490"
  },
  {
    "text": "You start with\nthe previous hash. Then you have data that\nyou're actually committing to.",
    "start": "465490",
    "end": "471073"
  },
  {
    "text": "And then you have\nsome data that doesn't have any actual meaning,\njust to get the work done. So I can-- to reference, if\nyou look through the work",
    "start": "471073",
    "end": "480389"
  },
  {
    "text": "people are doing right\nnow, this is all public, the current problem set.",
    "start": "480390",
    "end": "485430"
  },
  {
    "text": "There's a previous\nhash, which is basically the hash of the line above it. And then there's some data\nyou're committing to, in this",
    "start": "485430",
    "end": "492420"
  },
  {
    "text": "case people's user names, and\nthen some non-meaningful data here with just random numbers\nand stuff it looks like--",
    "start": "492420",
    "end": "503080"
  },
  {
    "text": "so very similar. Any questions about this idea? ",
    "start": "503080",
    "end": "510379"
  },
  {
    "text": "Cool.  So we use a Merkle root, which\nI think I talked about last week",
    "start": "510380",
    "end": "518069"
  },
  {
    "text": "Monday, instead of\njust concatenating all the transactions and\nhashing them in together.",
    "start": "518070",
    "end": "523690"
  },
  {
    "text": "You could do that. That actually would work. It wouldn't make\na huge difference. But this is a\nlittle nicer if you",
    "start": "523690",
    "end": "528940"
  },
  {
    "text": "want to prove that a\ntransaction was in this block, without giving the whole block.",
    "start": "528940",
    "end": "535839"
  },
  {
    "text": "So the idea is I\nhave these TXIDs. And a TXID, transaction ID, is\njust a hash of the transaction.",
    "start": "535840",
    "end": "544540"
  },
  {
    "text": "Stick all the components of\nthe transaction into bytes, hash that, and you've\ngot what's called a TXID.",
    "start": "544540",
    "end": "549670"
  },
  {
    "text": "And that's how you\nrefer to transactions. ",
    "start": "549670",
    "end": "555060"
  },
  {
    "text": "You hash these two together to\nget this intermediate point. Do the same thing\nup to the root.",
    "start": "555060",
    "end": "560980"
  },
  {
    "text": "And so you can't change any of\nthese little transaction IDs without changing\nthe Merkle root.",
    "start": "560980",
    "end": "567279"
  },
  {
    "text": "So it commits to\nall the transactions just the same way it would\nif you just concatenated them",
    "start": "567280",
    "end": "573402"
  },
  {
    "text": "all together and hashed that.  So it really-- we'll go in\nto, later, why this is useful.",
    "start": "573402",
    "end": "582400"
  },
  {
    "text": "But in many cases, it really\ndoesn't help too much. Any getting questions\nabout Merkle, Merkle tree?",
    "start": "582400",
    "end": "589370"
  },
  {
    "text": "Good. So the actual Bitcoin headers,\nwhich many things use,",
    "start": "589370",
    "end": "596230"
  },
  {
    "text": "has a couple of fields. Some of them are\nactually not very useful. But the main two are previous\nhash, Merkle root, nonce.",
    "start": "596230",
    "end": "605199"
  },
  {
    "text": "And then there's-- I'll\ntalk about the other things. So there's also a version\nfield right at the beginning.",
    "start": "605200",
    "end": "610300"
  },
  {
    "start": "607000",
    "end": "679000"
  },
  {
    "text": "It's 4 bytes. It indicates block version. It's not clear what that's going\nto be used for in the future.",
    "start": "610300",
    "end": "617530"
  },
  {
    "text": "It used to be used for sort\nof signaling protocol changes. I'm not sure that's going to\nbe the case going forward,",
    "start": "617530",
    "end": "623500"
  },
  {
    "text": "because it didn't really\nwork very well for that. So right now I think they all\nstart like 02 and then a bunch",
    "start": "623500",
    "end": "630970"
  },
  {
    "text": "of zeros. And that's the current\nversion, whatever that means.",
    "start": "630970",
    "end": "636110"
  },
  {
    "text": "And if you mine something\nwith a different version, everyone will accept it.",
    "start": "636110",
    "end": "641959"
  },
  {
    "text": "But there'll be like these\nwarnings that show up in your Bitcoin log files that\nsay, warning, unknown version",
    "start": "641960",
    "end": "648520"
  },
  {
    "text": "detected. The idea is maybe, well, if the\ninversion increases or changes,",
    "start": "648520",
    "end": "653710"
  },
  {
    "text": "maybe there's some new rules\nin this system, or new opcodes, or new something going on.",
    "start": "653710",
    "end": "659243"
  },
  {
    "text": "And you're not aware\nof it, so you might need to upgrade your software. That was the idea anyway.",
    "start": "659243",
    "end": "666050"
  },
  {
    "text": "In practice, what happens is-- you'll see in your\nlogs all the time, that like, unknown\nversion detected.",
    "start": "666050",
    "end": "671360"
  },
  {
    "text": "And it's just someone\njust set random numbers in the version field. And it doesn't seem to mean\nanything, so not super useful.",
    "start": "671360",
    "end": "679680"
  },
  {
    "start": "679000",
    "end": "692000"
  },
  {
    "text": "Previous hash, just\nlike in the problem set, it's the hash of the\nprevious block, 32 bytes.",
    "start": "679680",
    "end": "684910"
  },
  {
    "text": "Merkle root, as described\na few slides before-- hash of all the\ntransactions in the block. ",
    "start": "684910",
    "end": "692458"
  },
  {
    "start": "692000",
    "end": "1063000"
  },
  {
    "text": "Time, actually kind of complex-- I'm not going to go into\nthe whole thing right here.",
    "start": "692458",
    "end": "699160"
  },
  {
    "text": "So far we haven't really\ntalked about time. Does anyone know why we'd\nwant time in these headers?",
    "start": "699160",
    "end": "708240"
  },
  {
    "text": " Yeah. AUDIENCE: You had\nmentioned earlier that you don't accept blocks\nbetween a certain interval",
    "start": "708240",
    "end": "716670"
  },
  {
    "text": "if they were too late. TADGE DRYJA: Right. So it makes sense intuitively\nthat like if someone says, hey,",
    "start": "716670",
    "end": "722850"
  },
  {
    "text": "I mined this in 1987. It's like well,\nthat seems crazy.",
    "start": "722850",
    "end": "728640"
  },
  {
    "text": "Or if someone says,\nhere's a block. It came out in 2046. Like, this doesn't\nmake any sense.",
    "start": "728640",
    "end": "735960"
  },
  {
    "text": "So intuitively,\nyeah, you shouldn't accept things that have\nsome crazy date that's clearly wrong.",
    "start": "735960",
    "end": "741260"
  },
  {
    "text": "But why? Why do we need time at all?  Yeah. AUDIENCE: If you want\nto lock the transaction",
    "start": "741260",
    "end": "748035"
  },
  {
    "text": "until a certain time. TADGE DRYJA: Yeah, you could\nsay, here's a transaction, and I don't want it to\nbe valid before August 1.",
    "start": "748035",
    "end": "757040"
  },
  {
    "text": "And so then, you could say,\nif it goes into a block, and that block has a\ntimestamp before August 1,",
    "start": "757040",
    "end": "764570"
  },
  {
    "text": "consider the block invalid. You could. You can also do timestamping\nbased just on block height.",
    "start": "764570",
    "end": "771980"
  },
  {
    "text": "But what's the main-- does\nanyone know the main reason to have height here? Yeah. AUDIENCE: Is it\nbecause if they're",
    "start": "771980",
    "end": "777372"
  },
  {
    "text": "a competing transaction? And then you would\npick one or the other.",
    "start": "777372",
    "end": "783680"
  },
  {
    "text": "TADGE DRYJA: So the competing\ntransactions, when they get in, they sort of get into a block. And that sort of solves\nthat competition.",
    "start": "783680",
    "end": "789925"
  },
  {
    "text": "So you have two\ntransactions that both are mutually exclusive. Well, if they're both in the\nsame Merkle root and both",
    "start": "789925",
    "end": "796333"
  },
  {
    "text": "in the same block,\nthen that block is considered invalid,\nbecause it's like, hey, you've given me a block.",
    "start": "796333",
    "end": "801589"
  },
  {
    "text": "It's got two things that\ncan't both exist here. So throw the block away.",
    "start": "801590",
    "end": "807020"
  },
  {
    "text": "If you find two blocks\nthat both seem to have-- that sort of collide. They're both pointing to the--",
    "start": "807020",
    "end": "813350"
  },
  {
    "text": "they've both got the\nsame previous hash. So they're both in the same\nheight, we call, of the chain.",
    "start": "813350",
    "end": "820550"
  },
  {
    "text": "You could say, oh, well,\nwhichever one came out first. I'll look at the\ntimestamp and say, OK,",
    "start": "820550",
    "end": "826270"
  },
  {
    "text": "the block that came out\nfirst will be the valid one. But the problem is this\nis claimed block creation.",
    "start": "826270",
    "end": "833680"
  },
  {
    "text": "You can put whatever 4\nbytes you want in there. And so you can always\nsay, oh, I just wanted it exactly 1 second\nafter the previous block.",
    "start": "833680",
    "end": "841690"
  },
  {
    "text": "It just took me a\nwhile to broadcast it. So you can't really\ntrust the timestamp",
    "start": "841690",
    "end": "847630"
  },
  {
    "text": "to see which came first. If you could, you wouldn't need\nall this crazy mining stuff. And transactions themselves\ncould just have a timestamp.",
    "start": "847630",
    "end": "855520"
  },
  {
    "text": "And you wouldn't need\nthis whole structure. So the fundamental\nreason you're mining is we can't trust people to\nsay when they did something.",
    "start": "855520",
    "end": "864643"
  },
  {
    "text": "You can always say, no,\nthis transaction came first. No, this came first. So the real reason\nfor this blockchain",
    "start": "864643",
    "end": "870160"
  },
  {
    "text": "is, OK, we know which\ncame before what. AUDIENCE: In practice,\nwhich one happens? Do people just lie and say\nit happened a second later?",
    "start": "870160",
    "end": "877540"
  },
  {
    "text": "Or is it [INAUDIBLE]? TADGE DRYJA: Oh, in\npractice the timestamps are pretty unreliable.",
    "start": "877540",
    "end": "883810"
  },
  {
    "text": "They can be off by minutes. It can be before the\nprevious block's time.",
    "start": "883810",
    "end": "890650"
  },
  {
    "text": "And that's OK. It seems intuitively like, well,\nthat should just be a rule.",
    "start": "890650",
    "end": "895987"
  },
  {
    "text": "And it probably-- it would have\nbeen cool if it was a rule and made things simpler\nfrom the beginning. But if you're pointing\nto a previous block,",
    "start": "895987",
    "end": "904420"
  },
  {
    "text": "I'm building on top of it. And the previous block\ncame out at 10:15.",
    "start": "904420",
    "end": "909870"
  },
  {
    "text": "And I set my timestamp\nto 10:12, 3 minutes prior to the previous block.",
    "start": "909870",
    "end": "915009"
  },
  {
    "text": "Logically, that's impossible. I'm referencing\nsomething, and I'm saying I'm coming before it. But the software says that's OK.",
    "start": "915010",
    "end": "922001"
  },
  {
    "text": "AUDIENCE: So if we're\ncreating a version, would it be useful to just\nget rid of version and time, like if we're creating\na new blockchain?",
    "start": "922002",
    "end": "928640"
  },
  {
    "text": "TADGE DRYJA: So version,\nmaybe you could get rid of, or you could put it somewhere\nin the Merkle root or something. Time actually does have\na really useful purpose.",
    "start": "928640",
    "end": "936430"
  },
  {
    "text": " Does anyone, maybe if you know?",
    "start": "936430",
    "end": "941690"
  },
  {
    "text": "AUDIENCE: I don't\nknow, but does it play into the\ndifficulty of the mine? Does it? TADGE DRYJA: Yeah, so\nthe main reason for time",
    "start": "941690",
    "end": "949350"
  },
  {
    "text": "here is to adjust\nthe difficulty. And that happens\nevery 2,016 blocks.",
    "start": "949350",
    "end": "956970"
  },
  {
    "text": "You just look at, OK, how long\ndid this 2,016-block period take according to\nthese timestamps?",
    "start": "956970",
    "end": "962790"
  },
  {
    "text": "And if it took two\nweeks, OK, we're good. The difficulty doesn't\nhave to change. If it took three weeks,\nthat means the blocks",
    "start": "962790",
    "end": "969450"
  },
  {
    "text": "were coming out very slowly. And we need to reduce\nthe difficulty. If the 2,016 blocks came\nout in one week, that means,",
    "start": "969450",
    "end": "977670"
  },
  {
    "text": "wow, people were\nmining really fast. And so we need to\nincrease the difficulty. So there's this negative\nfeedback mechanism",
    "start": "977670",
    "end": "985320"
  },
  {
    "text": "based on this time. And it can be tweaked. It's not accurate.",
    "start": "985320",
    "end": "991529"
  },
  {
    "text": "You can have things\ncoming in the wrong order. The general rule of thumb-- the rule in the software\nis about two hours.",
    "start": "991530",
    "end": "998970"
  },
  {
    "text": "If you see something\nthat's two hours off from what your internal clock\nsays, you will reject it.",
    "start": "998970",
    "end": "1006170"
  },
  {
    "text": "But that's a huge gap. Most network systems,\neveryone's got their clocks",
    "start": "1006170",
    "end": "1012350"
  },
  {
    "text": "to the same second at\nleast, or millisecond. Two hours is like\nkind of enormous gaps.",
    "start": "1012350",
    "end": "1020670"
  },
  {
    "text": "But the system works\nOK, because you've got these really long-term\ndifficulty adjustments that",
    "start": "1020670",
    "end": "1026359"
  },
  {
    "text": "only happen every 2,016 blocks,\nwhich in practice is something like two weeks.",
    "start": "1026359",
    "end": "1031619"
  },
  {
    "text": "So if someone gets\nsomething a few minutes off, it doesn't really\naffect things too much.",
    "start": "1031619",
    "end": "1037809"
  },
  {
    "text": "And it's really only used for,\nOK, look at the last 2,016 blocks, two weeks-ish of\nwork, of all these blocks,",
    "start": "1037810",
    "end": "1045380"
  },
  {
    "text": "and see how fast we\nneed to make things. So that ties into the next\nfield, which is difficulty.",
    "start": "1045380",
    "end": "1053270"
  },
  {
    "text": "It's in a sort of weird\nfloating pointlike format with a mantissa\nand exponent, which",
    "start": "1053270",
    "end": "1059120"
  },
  {
    "text": "is totally custom. And you kind of have to write\nyour own code to deal with it. But it basically\nsays, OK, what does",
    "start": "1059120",
    "end": "1065570"
  },
  {
    "start": "1063000",
    "end": "1771000"
  },
  {
    "text": "the number have to-- what does\nthe hash have to be below? It's not just number of bits.",
    "start": "1065570",
    "end": "1070790"
  },
  {
    "text": "So in the problem set,\nI said 33 bits of work. So that's fairly easy to\ndetect, because you just look",
    "start": "1070790",
    "end": "1077420"
  },
  {
    "text": "for 33 0-bits in the front. In Bitcoin, it's not\njust number of bits. It's actually a number\nthat it must be below.",
    "start": "1077420",
    "end": "1084478"
  },
  {
    "text": "If it were just number\nof bits, the problem then is your adjustments are\nfairly coarse, because you can",
    "start": "1084478",
    "end": "1090260"
  },
  {
    "text": "only adjust by a factor of 2. You can double your\ndifficulty or half it.",
    "start": "1090260",
    "end": "1095930"
  },
  {
    "text": "But with this, you can have much\nsmaller difficulty adjustments of like a fraction of a percent.",
    "start": "1095930",
    "end": "1100940"
  },
  {
    "text": " Yeah, this field is\npretty much useless",
    "start": "1100940",
    "end": "1107872"
  },
  {
    "text": "since you can calculate\nit from the time fields of the previous blocks. So you could just\nhave it be implied.",
    "start": "1107873",
    "end": "1113065"
  },
  {
    "text": " But it's in there. And you can just whatever. It's an extra 4 bytes.",
    "start": "1113065",
    "end": "1119910"
  },
  {
    "text": "I don't think you\nactually-- like, you don't have to store it\non a disk if you want, because you can just figure\nit out from the other things.",
    "start": "1119910",
    "end": "1127893"
  },
  {
    "text": "AUDIENCE: Wouldn't you\nneed it for [INAUDIBLE]??",
    "start": "1127893",
    "end": "1132971"
  },
  {
    "text": "TADGE DRYJA: No, because you\ncan figure out what difficulty is just from the headers. ",
    "start": "1132972",
    "end": "1138833"
  },
  {
    "text": "I mean, it's in there. I guess it's nice\nif you just want to validate whether a single\nheader has enough work.",
    "start": "1138833",
    "end": "1146880"
  },
  {
    "text": "But it's like, how much\nwork does it claim it needs? And then you can validate it. But I don't know.",
    "start": "1146880",
    "end": "1152897"
  },
  {
    "text": "It's in there. It doesn't-- you could take\nit out and reorganize the code a little if you\nwanted to optimize it. But that would change so\nmuch that no one bothers.",
    "start": "1152897",
    "end": "1160580"
  },
  {
    "text": "AUDIENCE: So when we talk about\nthe adjusting difficulties and even just showing the\nproblem or proof of work, who",
    "start": "1160580",
    "end": "1167960"
  },
  {
    "text": "[INAUDIBLE] for\nthe problems that will go to the central server?",
    "start": "1167960",
    "end": "1173260"
  },
  {
    "text": "TADGE DRYJA: So in\nthis, it's just everyone broadcasts their blocks. So if you've received a block or\nif you found a block yourself,",
    "start": "1173260",
    "end": "1181139"
  },
  {
    "text": "you just send it to all your\npeers that you're connected to. And so there's no like, oh,\nthis is the canonical block.",
    "start": "1181140",
    "end": "1190180"
  },
  {
    "text": "There can be competing\nblocks where you have two at the same time and just\nstochastically, one of them",
    "start": "1190180",
    "end": "1196110"
  },
  {
    "text": "will pull ahead,\nbecause, well, randomly. So you can have\nconflicting things.",
    "start": "1196110",
    "end": "1201780"
  },
  {
    "text": "Yeah, and then the\nadjustments-- also, everyone computes\nthe adjustments. And this is an actually\nvery quick computation,",
    "start": "1201780",
    "end": "1208590"
  },
  {
    "text": "because you're just looking at-- you're not even looking\nat 2,016 timestamps.",
    "start": "1208590",
    "end": "1215250"
  },
  {
    "text": "You're basically just\nsaying, OK, if height-- so height is just what\nblock number it is. So if you're-- right now,\nit's about 500 million.",
    "start": "1215250",
    "end": "1223840"
  },
  {
    "text": "No, sorry, 500,000. So you basically\nin the code just say, well, if\nheight modulo 2,016",
    "start": "1223840",
    "end": "1230820"
  },
  {
    "text": "is equal to 0, check\nheight minus 2,016's block.",
    "start": "1230820",
    "end": "1238799"
  },
  {
    "text": "Compare the two timestamps. Subtract them. Get a duration.",
    "start": "1238800",
    "end": "1243809"
  },
  {
    "text": "And then compare that\nduration to two weeks. And then change the\ndifficulty proportionally.",
    "start": "1243810",
    "end": "1249580"
  },
  {
    "text": "So it's actually, like,\nsuper quick for everyone to compute the new difficulty. And they only do it\nonce every two weeks.",
    "start": "1249580",
    "end": "1256120"
  },
  {
    "text": "And it, yeah, it's\npretty straightforward. There are weird\nattacks and stuff.",
    "start": "1256120",
    "end": "1261690"
  },
  {
    "text": "And it's kind of some weird\noff by 1 errors, where you're-- I don't remember. Like, it's kind of confusing.",
    "start": "1261690",
    "end": "1267420"
  },
  {
    "text": "It's also confusing because\nthe test network, which I haven't gone into but will\nuse probably in two weeks.",
    "start": "1267420",
    "end": "1275240"
  },
  {
    "text": "There's a Bitcoin test network,\nwhich operates pretty much exactly the same as\nBitcoin, except everyone",
    "start": "1275240",
    "end": "1281790"
  },
  {
    "text": "agrees that the coins\nare not worth any money. What's interesting is it's\nactually called testnet3.",
    "start": "1281790",
    "end": "1287850"
  },
  {
    "text": "The first two test networks\nhave the same setup. However, the agreement that\nthey were not worth any money",
    "start": "1287850",
    "end": "1293970"
  },
  {
    "text": "broke down. So at testnet1,\nsomeone said, hey, I'll pay you a bitcoin for\na million testnet coins.",
    "start": "1293970",
    "end": "1302580"
  },
  {
    "text": "And once people\nsaw this happening, they said, oh, well,\nyou just ruined testnet. Now they're worth money. So we'll go to testnet2.",
    "start": "1302580",
    "end": "1308040"
  },
  {
    "text": "It happened again. Testnet3 has had\nsome staying power. I think people realized that if\nthey try to buy testnet3 coins,",
    "start": "1308040",
    "end": "1315000"
  },
  {
    "text": "everyone's going to\nleave and go to testnet4. So it's kind of fun.",
    "start": "1315000",
    "end": "1322230"
  },
  {
    "text": "I'd actually be OK with testnet3\ncoins being worth money, because I have many,\nmany thousands of them.",
    "start": "1322230",
    "end": "1330269"
  },
  {
    "text": "But yeah, so one\ndifference, though,",
    "start": "1330270",
    "end": "1338470"
  },
  {
    "text": "between the test networks\nand the real network is the difficulty adjustments. So I think in the\nfirst test network,",
    "start": "1338470",
    "end": "1346080"
  },
  {
    "text": "it just worked\nexactly like Bitcoin. But one of the problems\nwas people would mine,",
    "start": "1346080",
    "end": "1351600"
  },
  {
    "text": "and the difficulty\nwould increase. And then people would\nstop mining, say, oh, I'm going to test out\nmy mining software.",
    "start": "1351600",
    "end": "1358590"
  },
  {
    "text": "I'll mine a couple\nthousand blocks. Maybe it only takes me\na day or two to do so, because I have a very\nfast computer compared",
    "start": "1358590",
    "end": "1365760"
  },
  {
    "text": "to the rest of the network. And then I say, OK,\nwell, it works, cool. I'm going to go to\nthe real network now. And I leave the test network.",
    "start": "1365760",
    "end": "1371750"
  },
  {
    "text": "And now the\ndifficulty increased, because let's say 2,000\nor 4,000 blocks came out. And they came out very quickly,\nso the difficulty went up.",
    "start": "1371750",
    "end": "1379410"
  },
  {
    "text": "And then all the\nmining power left. And so now blocks\naren't coming out. And since the adjustment\ncan be up or down",
    "start": "1379410",
    "end": "1387010"
  },
  {
    "text": "but happens based on number\nof blocks, not based on time,",
    "start": "1387010",
    "end": "1392190"
  },
  {
    "text": "if you have a very high\ndifficulty and the very low hash rate relative\nto that difficulty,",
    "start": "1392190",
    "end": "1398100"
  },
  {
    "text": "it can take weeks\nor months or years for the difficulty to reduce.",
    "start": "1398100",
    "end": "1403830"
  },
  {
    "text": "So testnet3 put in this\nsort of difficulty nerfing code, which is probably wrong\nand not what they intended.",
    "start": "1403830",
    "end": "1412950"
  },
  {
    "text": "And it has this thing where\nlike if 20 minutes have gone by, the difficulty lowers. And it's kind of ugly.",
    "start": "1412950",
    "end": "1420540"
  },
  {
    "text": "So that's the main place\nI've dealt with this field. One other rule with the\nrestriction-- the difficulty",
    "start": "1420540",
    "end": "1427350"
  },
  {
    "text": "can go up by at\nmost a factor of 4 and drop by at\nmost a factor of 4.",
    "start": "1427350",
    "end": "1433770"
  },
  {
    "text": "So if you mine 2,016\nblocks in one day, the difficulty goes\nup 4x but does not",
    "start": "1433770",
    "end": "1439919"
  },
  {
    "text": "go up 14x or whatever\nthe implied would.",
    "start": "1439920",
    "end": "1445750"
  },
  {
    "text": "Any-- go ahead. AUDIENCE: So the\ndifficulty is definitely constant for two weeks then? TADGE DRYJA: Yeah.",
    "start": "1445750",
    "end": "1451080"
  },
  {
    "text": "Well, sorry, not two weeks-- 2,016 blocks, which is generally\naround two weeks, but yeah.",
    "start": "1451080",
    "end": "1456920"
  },
  {
    "text": "AUDIENCE: So it\nunblocks and blocks, within literally an\nalmost two-week period, that difficulty\nwould be the same. TADGE DRYJA: Yeah, so if you\nactually look at the headers,",
    "start": "1456920",
    "end": "1463797"
  },
  {
    "text": "this is just the constant. It just is always the same. So it's kind of a silly\nfield to be in there. You never need it, and\nit's always the same.",
    "start": "1463797",
    "end": "1471475"
  },
  {
    "text": "Any other questions\nabout-- yeah? AUDIENCE: How many transactions\nare usually [INAUDIBLE]?? TADGE DRYJA: Oh,\nI'll get to that--",
    "start": "1471475",
    "end": "1476840"
  },
  {
    "text": "right now, a couple\nthousand, 4,000-ish. We'll get to that I think.",
    "start": "1476840",
    "end": "1482580"
  },
  {
    "text": "But yeah, in the Merkle root-- so the height of the\nMerkle root's like 12-ish. And it goes out to maybe\n4,000 transactions,",
    "start": "1482580",
    "end": "1491450"
  },
  {
    "text": "sometimes more,\nsometimes very few. You'll find empty\nblocks that just have one transaction in them.",
    "start": "1491450",
    "end": "1498990"
  },
  {
    "text": "And that transaction ID just\nbecomes the Merkle root, because a height-- it's like a height-zero\nMerkle tree,",
    "start": "1498990",
    "end": "1506390"
  },
  {
    "text": "but yeah, something like that. And then last-- pretty easy-- there's a nonce, 4 byte.",
    "start": "1506390",
    "end": "1513049"
  },
  {
    "text": "Anything you want goes in there. You can think of it\nas a you went 32,",
    "start": "1513050",
    "end": "1518510"
  },
  {
    "text": "there's no meaning to it. So does anyone see a problem\nwith this nonce field?",
    "start": "1518510",
    "end": "1526450"
  },
  {
    "text": "Yeah. AUDIENCE: It's too small. TADGE DRYJA: Yeah,\nit's too small. 4 bytes-- even in\nthe homework, people",
    "start": "1526450",
    "end": "1533519"
  },
  {
    "text": "are using 12 something\nbytes for a nonce. With only 4 bytes of\nnonce, you can go through 2",
    "start": "1533520",
    "end": "1540990"
  },
  {
    "text": "to the 32 possibilities,\nwhich is not enough to mine in\nalmost all cases,",
    "start": "1540990",
    "end": "1547559"
  },
  {
    "text": "because you're going to need\nto go through 2 to the 70 possibilities to find a block.",
    "start": "1547560",
    "end": "1553500"
  },
  {
    "text": "So what are some ideas for how\ndo you deal with this problem? Like, it would be nice\nif it was just 8 bytes.",
    "start": "1553500",
    "end": "1559919"
  },
  {
    "text": "That'd make things simpler. But the system is what it is. It's very hard to change. How, as a miner, would you\nwork around this issue?",
    "start": "1559920",
    "end": "1568992"
  },
  {
    "text": "AUDIENCE: Adjust the\nversion and time. TADGE DRYJA: Yeah, so\nyou can adjust version. So that may be why sometimes\nweird version numbers come up.",
    "start": "1568992",
    "end": "1576000"
  },
  {
    "text": "Time is a good one\ntoo, since time-- ",
    "start": "1576000",
    "end": "1581610"
  },
  {
    "text": "so yeah, adjust time\nand also Merkle root. So time, if you're off by a\nfew seconds, nobody cares.",
    "start": "1581610",
    "end": "1591710"
  },
  {
    "text": "So use the low bits of this time\nfield as part of your nonce. It's kind of in the wrong\nplace, but you can make chips",
    "start": "1591710",
    "end": "1599000"
  },
  {
    "text": "to sort of fiddle-- twiddle these bits as well. What's also nice is that\nevery second you can sort of--",
    "start": "1599000",
    "end": "1607340"
  },
  {
    "text": "you can do it the wrong way. And you can say,\noh, I'm just going to take the least significant\n4 bits of my time field",
    "start": "1607340",
    "end": "1614450"
  },
  {
    "text": "and just use them as\nnonce space randomly. What's nice is that the\nactual time progresses by one",
    "start": "1614450",
    "end": "1620720"
  },
  {
    "text": "bit every second. So as long as your\nchip has enough space--",
    "start": "1620720",
    "end": "1628002"
  },
  {
    "text": "so you're like, OK,\nI've got 2 bit to 32 here, another 4 bits here,\nso I'm at 2 to the 36.",
    "start": "1628003",
    "end": "1634300"
  },
  {
    "text": "If you're chip only goes\nthrough 2 to the 36 hashes every second, you're good\nbecause the actual time",
    "start": "1634300",
    "end": "1640660"
  },
  {
    "text": "progresses. The other way you can do it\nis modify the Merkle root.",
    "start": "1640660",
    "end": "1646659"
  },
  {
    "text": "And you can do that-- so can\nyou think of ways to modify that",
    "start": "1646660",
    "end": "1652210"
  },
  {
    "text": "without breaking things? AUDIENCE: Add or\ndrop the transaction. TADGE DRYJA: Yeah,\nyou could add or you",
    "start": "1652210",
    "end": "1657590"
  },
  {
    "text": "could drop a transaction. So you say, OK, I have\nall these transactions. I'm going to drop one. That's got some\ndisadvantages, because it",
    "start": "1657590",
    "end": "1663320"
  },
  {
    "text": "may pay fees to the miner. AUDIENCE: Changing the order? TADGE DRYJA: Yep,\nyou can swap them. ",
    "start": "1663320",
    "end": "1670549"
  },
  {
    "text": "You can just say, OK, well,\nthese two are independent. I'm going to swap them. This will change,\nwhich will change that.",
    "start": "1670550",
    "end": "1676780"
  },
  {
    "text": "So you can swap\ntransactions around. You can also edit what's called\nthe Coinbase, which I think",
    "start": "1676780",
    "end": "1683120"
  },
  {
    "text": "is in like one more slide. So yeah, so there's\na bunch of ways that you can change things. And so this is really\nwhere you're going",
    "start": "1683120",
    "end": "1689799"
  },
  {
    "text": "to have all the variation. You have 32-bit bytes here.",
    "start": "1689800",
    "end": "1695139"
  },
  {
    "text": "And just even if it\nwas just swapping, and if you have 1,000\ntransactions, swap in whatever order you want-- there's enough sort\nof entropy there",
    "start": "1695140",
    "end": "1701570"
  },
  {
    "text": "that you'll be able to find it. So what's interesting is\nthat the nonce is there. And it's important,\nbecause that's",
    "start": "1701570",
    "end": "1706797"
  },
  {
    "text": "where sort of the\nhigh-speed mining occurs. But most mining chips will also\nhave circuitry to modify this,",
    "start": "1706797",
    "end": "1715610"
  },
  {
    "text": "because they're operating\nso quickly that they will exhaust the\n4-byte nonce space",
    "start": "1715610",
    "end": "1721370"
  },
  {
    "text": "in a fraction of a second. And so they'll have to\nswap two transactions,",
    "start": "1721370",
    "end": "1726790"
  },
  {
    "text": "recalculate a Merkle root, which\ninvolves a few dozen hashes,",
    "start": "1726790",
    "end": "1731803"
  },
  {
    "text": "and then go back here. So it actually doesn't hurt\ntheir efficiency too much, because, OK, I just did 4\nbillion hash operations.",
    "start": "1731803",
    "end": "1738980"
  },
  {
    "text": "And then I need to\ndo a few dozen more to get to the next 4 billion. So it doesn't hurt\nthings too much.",
    "start": "1738980",
    "end": "1745710"
  },
  {
    "text": "Also, in Bitcoin-- a\nsort of weird quirk-- it's called SHA-256d.",
    "start": "1745710",
    "end": "1751820"
  },
  {
    "text": "They do SHA-256. And then from the output,\nthey do a SHA-256 again,",
    "start": "1751820",
    "end": "1757180"
  },
  {
    "text": "not sure why. I think in one person's\nfirst problem set,",
    "start": "1757180",
    "end": "1762767"
  },
  {
    "text": "they inadvertently were\ndoing the same thing and was like, yeah, that works. Satoshi, whoever he\nor she was, or they,",
    "start": "1762767",
    "end": "1770572"
  },
  {
    "text": "just put that in there. Any questions about this header\nin this format and anything about it?",
    "start": "1770572",
    "end": "1775780"
  },
  {
    "start": "1771000",
    "end": "2039000"
  },
  {
    "text": "It's pretty compact. It's 80 bytes. ",
    "start": "1775780",
    "end": "1781243"
  },
  {
    "text": "AUDIENCE: [INAUDIBLE]\nincluding the Merkle root. So if you end up\nmining something, you don't have to\nput anything there.",
    "start": "1781244",
    "end": "1787380"
  },
  {
    "text": "So the only incentive\nis the transaction fees? TADGE DRYJA: In the\nblock reward, which I'll get to in a second, but yeah.",
    "start": "1787380",
    "end": "1793538"
  },
  {
    "text": " That's a good question. Can you put nothing\nin as a Merkle?",
    "start": "1793538",
    "end": "1800710"
  },
  {
    "text": "I don't think so. I'm pretty sure you\nneed one transaction. AUDIENCE: Oh, that's right. I mean, you need\nthe base for the-- because even if just did it, you\nneed a [INAUDIBLE] transaction.",
    "start": "1800710",
    "end": "1808120"
  },
  {
    "text": "TADGE DRYJA: You can do that. And there's many blocks. So in the first\nyear or so in 2009, almost all the blocks are empty\nand only have one transaction,",
    "start": "1808120",
    "end": "1815880"
  },
  {
    "text": "because no one was using it. But people were mining. So it was very similar\nto the problem set, where",
    "start": "1815880",
    "end": "1820960"
  },
  {
    "text": "everyone's just mining,\nand they're not actually using the system. AUDIENCE: Bu then right now-- TADGE DRYJA: Right\nnow there's tons.",
    "start": "1820960",
    "end": "1826340"
  },
  {
    "text": "AUDIENCE: People aren't doing\nthat just because there's transaction fees. TADGE DRYJA: Right now-- AUDIENCE: It's their\nonly incentive? People just decided-- TADGE DRYJA: No, you\nstill get more bitcoins.",
    "start": "1826340",
    "end": "1833100"
  },
  {
    "text": "So you still get a reward. The reason you'll see empty\nblocks now is a little tricky.",
    "start": "1833100",
    "end": "1840039"
  },
  {
    "text": "We're not sure,\nbecause who knows? But it's probably because of\nblind mining, where you receive",
    "start": "1840040",
    "end": "1847409"
  },
  {
    "text": "a block, and you\nhaven't actually looked through the\ncontents of the block yet.",
    "start": "1847410",
    "end": "1852420"
  },
  {
    "text": "But you want to\nmine the next block. But you're not sure what\ntransactions to put in.",
    "start": "1852420",
    "end": "1857820"
  },
  {
    "text": "You see this 80-byte\nheader, and you're like, oh, someone find a block. But you only have\nthe header, and you",
    "start": "1857820",
    "end": "1863009"
  },
  {
    "text": "want to build on top of it.  You have a bunch of transactions\nyou'd like to put in,",
    "start": "1863010",
    "end": "1868890"
  },
  {
    "text": "but they may have already been\nput into the previous one. And so you're like,\nwell, I have no idea what's in the previous one.",
    "start": "1868890",
    "end": "1874965"
  },
  {
    "text": "I'm just going to mine a\nblock with nothing in it, that way I'm sure that\nI'm not going to conflict with my previous one.",
    "start": "1874965",
    "end": "1880650"
  },
  {
    "text": " You'll often see a block with\nonly one transaction very soon",
    "start": "1880650",
    "end": "1886740"
  },
  {
    "text": "after its predecessor block. AUDIENCE: So like every once\nin a while, it would check.",
    "start": "1886740",
    "end": "1892053"
  },
  {
    "text": "So you're saying if it happened\nand went to a block really quickly, there's just more\nlikely to be more transactions.",
    "start": "1892053",
    "end": "1897197"
  },
  {
    "text": "TADGE DRYJA: Right, right,\nbecause a miner might-- it's actually an optimal\nstrategy for a miner to say, look, first thing\nI'm going do, download",
    "start": "1897197",
    "end": "1903610"
  },
  {
    "text": "the 80-byte header. Figure out if it's got\na valid proof of work.",
    "start": "1903610",
    "end": "1908649"
  },
  {
    "text": "If it does, I'm\ngoing to just assume it's valid for the\nnext few seconds, because it probably is.",
    "start": "1908650",
    "end": "1916000"
  },
  {
    "text": "And then I'm going to try to\nmine a block on top of that. Reference this previous block. Mine a block on top.",
    "start": "1916000",
    "end": "1921730"
  },
  {
    "text": "The thing is, I have no idea\nwhat's actually in the block. I have no idea what contributes\nto this Merkle root,",
    "start": "1921730",
    "end": "1927039"
  },
  {
    "text": "because I haven't even\ndownloaded that data yet. But I can build on top of\nit, just from the header.",
    "start": "1927040",
    "end": "1932890"
  },
  {
    "text": "But I can't include\ntransactions, because I have no idea what\ntransactions are in here, so they might conflict.",
    "start": "1932890",
    "end": "1938110"
  },
  {
    "text": "So I'll just mine sort of\nblind for a second or two. And then download all the\ntransactions, validate it.",
    "start": "1938110",
    "end": "1946960"
  },
  {
    "text": "And now I can include\nmy transactions that haven't been included. And so that happens.",
    "start": "1946960",
    "end": "1953230"
  },
  {
    "text": "It can be an OK strategy. Sometimes it can lead to\nyou mining an invalid block.",
    "start": "1953230",
    "end": "1958870"
  },
  {
    "text": "If someone produces an invalid\nblock, and you just see, oh, well, it's got proof of work,\nyou grab that header, start",
    "start": "1958870",
    "end": "1965380"
  },
  {
    "text": "mining on top of it. No matter what you\nmine, it's going to be invalid, because it's\npointing to an invalid block.",
    "start": "1965380",
    "end": "1972460"
  },
  {
    "text": "That happened 2015 or 2016. The summer of 2015 it happened.",
    "start": "1972460",
    "end": "1978187"
  },
  {
    "text": "And it was like quite extensive. It was like seven\nor eight blocks in a row that were all invalid,\nbecause none of the miners",
    "start": "1978187",
    "end": "1983870"
  },
  {
    "text": "were actually\nverifying anything. They were just downloading\nthe headers from each other and being like, yeah, I\nmean, you did the work.",
    "start": "1983870",
    "end": "1992720"
  },
  {
    "text": "So they were just\nassuming everyone else was verifying the Merkle roots. And yeah, so then it ended--",
    "start": "1992720",
    "end": "2000170"
  },
  {
    "text": "so they lost 25 times 8,\nhowever many bitcoins. They lost hundreds of bitcoins,\nwhich at the time was still",
    "start": "2000170",
    "end": "2008890"
  },
  {
    "text": "worth quite a bit-- and now\nit's worth millions of dollars-- just because they weren't\nactually checking things.",
    "start": "2008890",
    "end": "2015580"
  },
  {
    "text": "AUDIENCE: If I mine a\nblock and it's empty, do I decrease my chances\nof being mined afterwards?",
    "start": "2015580",
    "end": "2021070"
  },
  {
    "text": "TADGE DRYJA: No, actually,\nI would say you'd, sort of game theoretically, you would\nincrease it, because you're not",
    "start": "2021070",
    "end": "2029690"
  },
  {
    "text": "depleting the mempool. I need to talk about\nthe actual mining coinbase and mempool and stuff.",
    "start": "2029690",
    "end": "2034860"
  },
  {
    "text": "But yeah, it's a\ntricky question. And I'll try to get back to it. If I don't, bug me again.",
    "start": "2034860",
    "end": "2040049"
  },
  {
    "text": "TX-- so in this\nMerkle root, you've got all these transactions. They have a specified order.",
    "start": "2040050",
    "end": "2045230"
  },
  {
    "text": "Transaction 0 is the\ncoinbase transaction. And it's special. It generates new coins,\nand it takes fees",
    "start": "2045230",
    "end": "2051965"
  },
  {
    "text": "from all the other\ntransactions in the block. I think Neha mentioned\nthis yesterday, where if you have a difference\nbetween the input amounts",
    "start": "2051965",
    "end": "2060138"
  },
  {
    "text": "and output amounts,\nthat's implicitly a fee. So if your input--",
    "start": "2060139",
    "end": "2066090"
  },
  {
    "text": "so here, Neha's thing,\nyou're spending 20 coins. You've got 5, 10, 4.",
    "start": "2066090",
    "end": "2071388"
  },
  {
    "text": "Well, there's only 19\ncoins in the output, so there's an implicit\nfee of 1 coin.",
    "start": "2071389",
    "end": "2078469"
  },
  {
    "text": "That one coin can go\nto transactions 0. So transaction 0 has\nessentially no input.",
    "start": "2078469",
    "end": "2087149"
  },
  {
    "text": "Transaction 0's input\nfield is just empty, anything you want to put, any\nbytes you want to put in there.",
    "start": "2087150",
    "end": "2093030"
  },
  {
    "text": "Its output field\ngenerates new coins. So that's currently\n12 and 1/2 coins. So currently, if you mine\na block with only TX0,",
    "start": "2093030",
    "end": "2101130"
  },
  {
    "text": "you get 12 and 1/2 coins. If you mine a block with\nthousands of transactions, you get the 12 and 1/2\ncoins plus the difference",
    "start": "2101130",
    "end": "2108092"
  },
  {
    "text": "between the input and outputs\nof all the other transactions in the block, which can\nbe even more than 12",
    "start": "2108092",
    "end": "2113490"
  },
  {
    "text": "and-- which can recently,\nlike in January or December, there were quite a few blocks\nwhere they're getting 25, 26,",
    "start": "2113490",
    "end": "2121240"
  },
  {
    "text": "27 coins, because the total\nfees for the entire block were more than 12 and 1/2 coins,\nwhich is hundreds of thousands",
    "start": "2121240",
    "end": "2129510"
  },
  {
    "text": "of dollars now. So it's kind of cool. The fees have since decreased. Fees are highly variable.",
    "start": "2129510",
    "end": "2135779"
  },
  {
    "text": "And we'll talk about fees\nin a few more lectures. And it's kind of a mess,\nbut it's an evolving area",
    "start": "2135780",
    "end": "2142800"
  },
  {
    "text": "in this whole network thing. So you've got your\ncoinbase transaction.",
    "start": "2142800",
    "end": "2148410"
  },
  {
    "text": "That's important. That's why people are doing this\nstuff, because they want money. All the other transactions\ncan be shuffled around.",
    "start": "2148410",
    "end": "2155310"
  },
  {
    "text": "However, they can\nonly spend outputs from previous transactions.",
    "start": "2155310",
    "end": "2160349"
  },
  {
    "text": "And previous means\nthey have an index within the block that's lower. So for example, you\nhave transaction",
    "start": "2160350",
    "end": "2167040"
  },
  {
    "start": "2164000",
    "end": "2328000"
  },
  {
    "text": "B spends an output of\ntransaction A. Transaction A must come first in\nthe block ordering.",
    "start": "2167040",
    "end": "2174840"
  },
  {
    "text": "This makes it so that you can\ngo through in a linear fashion and validate every\ntransaction in order.",
    "start": "2174840",
    "end": "2180180"
  },
  {
    "text": "Otherwise, you'd go through,\nsee, OK, transaction 0, I don't have to validate that. That's coinbase--\ntransaction 1, transaction 2.",
    "start": "2180180",
    "end": "2187228"
  },
  {
    "text": "And then you see transaction 3. It appears to be\nspending something you've never heard of.",
    "start": "2187228",
    "end": "2192640"
  },
  {
    "text": "So that would at first-- that would appear to be invalid. And then maybe you go through\nanother few transactions,",
    "start": "2192640",
    "end": "2198070"
  },
  {
    "text": "say, oh, this creates the\noutput that this thing I just saw before spends.",
    "start": "2198070",
    "end": "2204270"
  },
  {
    "text": "It's sort of out of order. It makes things very\ncomplicated to validate. And so this rule ensures that\nif you go through and just check",
    "start": "2204270",
    "end": "2211720"
  },
  {
    "text": "every transaction in order,\nit'll all make sense. Yes. AUDIENCE: Is there any benefit\nmoving earlier or later?",
    "start": "2211720",
    "end": "2218547"
  },
  {
    "text": "TADGE DRYJA: In the block? AUDIENCE: Yeah. TADGE DRYJA: No,\nI don't think so. I mean, I can't think of one.",
    "start": "2218547",
    "end": "2226430"
  },
  {
    "text": "Yeah, it's just sort of random. A lot of times they'll\norganize it by fee rate. Or by default, they'll\njust organize it",
    "start": "2226430",
    "end": "2233350"
  },
  {
    "text": "by when they saw them first. So it's pretty arbitrary. AUDIENCE: Does\nthat mean that you have to wait until\nthe transaction",
    "start": "2233350",
    "end": "2239825"
  },
  {
    "text": "that the major output\nhas been mined, in order spend that again? TADGE DRYJA: No,\nalthough if they did,",
    "start": "2239825",
    "end": "2246190"
  },
  {
    "text": "that would make the software\na lot simpler and easier to deal with. But that is not how it works.",
    "start": "2246190",
    "end": "2251849"
  },
  {
    "start": "2251850",
    "end": "2256920"
  },
  {
    "text": "So for example-- I'll draw\nit-- you can have a block where",
    "start": "2256920",
    "end": "2263400"
  },
  {
    "text": "there's-- let's do it this way. So you have TX0. There's coinbase transaction,\ntransaction 1, transaction 2,",
    "start": "2263400",
    "end": "2271230"
  },
  {
    "text": "transaction 3. And transaction 3 may be\nspending something that",
    "start": "2271230",
    "end": "2276570"
  },
  {
    "text": "was generated in transaction 1. That can happen. So if you make transaction 1\nbroadcast it. it's unconfirmed.",
    "start": "2276570",
    "end": "2285300"
  },
  {
    "text": "You then make transaction\n3 broadcast it, spends transaction 1. The miner can put\nthose in the blocks.",
    "start": "2285300",
    "end": "2290849"
  },
  {
    "text": "They must put it in order. So if this happens, you\ncan't switch them in order.",
    "start": "2290850",
    "end": "2296309"
  },
  {
    "text": "But that's considered OK. It makes parallel-- it makes\nmulti-core validation more",
    "start": "2296310",
    "end": "2301680"
  },
  {
    "text": "annoying. If you said, no, you can only\nuse outputs that have already been confirmed, then\nthe block validation",
    "start": "2301680",
    "end": "2309839"
  },
  {
    "text": "becomes embarrassingly\nparallel, because you can just validate every\ntransaction independently.",
    "start": "2309840",
    "end": "2314955"
  },
  {
    "text": "That would be kind of nice.  There's other\ninteresting reasons",
    "start": "2314955",
    "end": "2320400"
  },
  {
    "text": "why this is also useful. I mean, if I were\ndesigning it, I would say you have to\nconfirm, because it just",
    "start": "2320400",
    "end": "2325680"
  },
  {
    "text": "makes things simpler. But I was not Satoshi. So yeah, the order\nis fairly arbitrary. Any other questions about block\nordering, Merkle root stuff?",
    "start": "2325680",
    "end": "2333060"
  },
  {
    "text": "And then we're going to\nhave a quick intermission right at the halfway point. ",
    "start": "2333060",
    "end": "2338980"
  },
  {
    "text": "Sounds good, so\n256-second break.",
    "start": "2338980",
    "end": "2344400"
  },
  {
    "text": "So now I'll talk about the\nsynchronization process. How does this actually\nwork in the software",
    "start": "2344400",
    "end": "2350220"
  },
  {
    "text": "when you download Bitcoin? So first, you download Bitcoin. You go to bitcoin.org.",
    "start": "2350220",
    "end": "2356460"
  },
  {
    "text": "of Your friend hands you\na USB drive and says, hey, I got some good stuff, man,\nthis new thing called Bitcoin.",
    "start": "2356460",
    "end": "2363030"
  },
  {
    "text": "And so you've got the\nBitcoin EXE file or DMG file, or the binary, or the code.",
    "start": "2363030",
    "end": "2368702"
  },
  {
    "text": "And you want to know what's\nbeen going on for the last nine years? So first, you\ndownload the binary,",
    "start": "2368702",
    "end": "2374010"
  },
  {
    "text": "or you compile the code. And you verify all the GPG\nsignatures of this code,",
    "start": "2374010",
    "end": "2379756"
  },
  {
    "text": "if you want to do this securely. So I'm sure everyone has their\nPGP keys on the MIT PGP server",
    "start": "2379757",
    "end": "2387120"
  },
  {
    "text": "and goes to key signing parties\nheld on the weekends, right? Yeah, no?",
    "start": "2387120",
    "end": "2394047"
  },
  {
    "text": "AUDIENCE: Keybase is cool. Base TADGE DRYJA: Keybase\nis also useful, yeah. So I have my PGP key\nhash on my business card.",
    "start": "2394047",
    "end": "2400950"
  },
  {
    "text": "I don't think anyone's\nactually ever used it. But the Bitcoin nerds\nactually do do this.",
    "start": "2400950",
    "end": "2406920"
  },
  {
    "text": "And they're very sort\nof annoying about it,",
    "start": "2406920",
    "end": "2412680"
  },
  {
    "text": "because a really\ngood attack vector is to get someone to download\ncompromised Bitcoin code.",
    "start": "2412680",
    "end": "2419430"
  },
  {
    "text": "It's like the best\nattack vector ever if you're trying to do\nsomething sneaky, mainly just",
    "start": "2419430",
    "end": "2425130"
  },
  {
    "text": "to steal all the money. If you get them to download\na Bitcoin binary that you control, that you put\nsome backdoor code in,",
    "start": "2425130",
    "end": "2432840"
  },
  {
    "text": "the code can be like two lines. It's like, open a TCP\nconnection to my computer.",
    "start": "2432840",
    "end": "2438240"
  },
  {
    "text": "Send me all the private keys. We're good. Or if you want to be\nmore sophisticated,",
    "start": "2438240",
    "end": "2443790"
  },
  {
    "text": "every time they click Send\nand type in their password, I just change all the addresses\nand all the outputs to me,",
    "start": "2443790",
    "end": "2450060"
  },
  {
    "text": "and like, every time\nthey try to send money. To UI sort of shows that they're\nsending money but actually just",
    "start": "2450060",
    "end": "2455079"
  },
  {
    "text": "send to me. And they won't find\nout for a little while. There's a lot of\nthings where you want to be running the\nright Bitcoin code.",
    "start": "2455080",
    "end": "2462930"
  },
  {
    "text": "And that's a hard problem. Because we're sort of\noperating in this Trust List, decentralized\nnetwork, how do you",
    "start": "2462930",
    "end": "2469590"
  },
  {
    "text": "get into this in the beginning? If it's your friend\nand saying, hey, here's the Bitcoin I'm running.",
    "start": "2469590",
    "end": "2474760"
  },
  {
    "text": "I know this is good. Then it works. But just a website-- what if\nsomeone hacks the website-- things like that? It's like a huge rabbit hole.",
    "start": "2474760",
    "end": "2481020"
  },
  {
    "text": "And you can try to worry\nabout it for years. But anyway, you\ndownload the binary,",
    "start": "2481020",
    "end": "2486540"
  },
  {
    "text": "assume you've somehow\ngotten the binary, and you're pretty sure\nit's the right software. So how do you connect\nto this network?",
    "start": "2486540",
    "end": "2492990"
  },
  {
    "start": "2490000",
    "end": "2593000"
  },
  {
    "text": "Well, there are these\nhardcoded DNS seeds in order to find peers in the beginning. If you know how DNS works, it's\nhow you look up IP addresses",
    "start": "2492990",
    "end": "2500640"
  },
  {
    "text": "based on a hostname. There are some servers that will\nreturn multiple different IP addresses every\ntime you query them.",
    "start": "2500640",
    "end": "2509270"
  },
  {
    "text": "And those are IP addresses\nof currently running",
    "start": "2509270",
    "end": "2514890"
  },
  {
    "text": "Bitcoin nodes. So the idea is, OK, someone's\nrunning a Bitcoin node. They've got their DNS server.",
    "start": "2514890",
    "end": "2520020"
  },
  {
    "text": "You query that DNS server,\nand it will hand you out some IP addresses.",
    "start": "2520020",
    "end": "2525720"
  },
  {
    "text": "This is also sort\nof centralized, slash trusted, slash whatever,\nin that if someone compromises",
    "start": "2525720",
    "end": "2532500"
  },
  {
    "text": "these four or five\nDNS servers, you might not be able to connect\nto the Bitcoin network.",
    "start": "2532500",
    "end": "2537540"
  },
  {
    "text": "So in practice, it's not\ncompletely mathematically secure in Trust List. There's all these\nreal-world issues",
    "start": "2537540",
    "end": "2542840"
  },
  {
    "text": "that's like, how do I know\nI've got the right software? How do I know I'm connecting\nto the actual Bitcoin network?",
    "start": "2542840",
    "end": "2548080"
  },
  {
    "text": "What if my ISP is\nblocking me and sending me to some other network,\nor things like that?",
    "start": "2548080",
    "end": "2553540"
  },
  {
    "text": "So in practice, it sort\nof works OK right now. You connect to the DNS seeds. And then you connect\nto a Bitcoin node,",
    "start": "2553540",
    "end": "2560309"
  },
  {
    "text": "and you ask for headers. You say, hey, I just showed up. I know about one header.",
    "start": "2560310",
    "end": "2566490"
  },
  {
    "text": "There's a hardcoded header in\nthe code called the genesis block that Satoshi did.",
    "start": "2566490",
    "end": "2572520"
  },
  {
    "text": "And you say, hey, I've\ngot this genesis block. Do you know anything that builds\nabove this genesis block, that",
    "start": "2572520",
    "end": "2578130"
  },
  {
    "text": "comes after? And they say, yes, I\nactually know 500,000 headers that come after it.",
    "start": "2578130",
    "end": "2583380"
  },
  {
    "text": "And they'll start\nsending it to you. They send it to you in\na couple of thousand of headers at a time.",
    "start": "2583380",
    "end": "2589710"
  },
  {
    "text": "And then you start to download\nall those and verify them. The header chain,\nyou get it first.",
    "start": "2589710",
    "end": "2596970"
  },
  {
    "text": "And it's actually very quick. You can do it in under a minute\nif you have a good internet connection. And you verify all the work\nbefore you do anything else.",
    "start": "2596970",
    "end": "2603990"
  },
  {
    "text": "So this is nice in that\nthe attacker, in order to sort of make you\ndo more work here,",
    "start": "2603990",
    "end": "2610650"
  },
  {
    "text": "would have to do a\nlot of proof of work. But for you, it's very\nquick to verify everything.",
    "start": "2610650",
    "end": "2616890"
  },
  {
    "text": "Even half a million\nheaders, 30 seconds if you've got a good internet\nconnection, something",
    "start": "2616890",
    "end": "2622560"
  },
  {
    "text": "like that, because all you're\ndoing is one hash per header. You just download the\nheader, check the bits,",
    "start": "2622560",
    "end": "2628710"
  },
  {
    "text": "check the time, make\nsure the times are like progressing reasonably. If the times keep going\nbackwards for like,",
    "start": "2628710",
    "end": "2635270"
  },
  {
    "text": "I think it's 10 blocks, then\nyou consider it invalid. But your computer\ncan actually do this.",
    "start": "2635270",
    "end": "2640920"
  },
  {
    "text": "It's 500,000 hash functions. And I'm sure if you've\nseen for the problem set, you can do that in a few\nseconds in many cases.",
    "start": "2640920",
    "end": "2648310"
  },
  {
    "text": "So you can verify the work\ndone throughout the entirety of the Bitcoin's\nexistence pretty quickly.",
    "start": "2648310",
    "end": "2655520"
  },
  {
    "text": "So then you've got\n500,000 headers. And now you need to actually\ndownload the blocks.",
    "start": "2655520",
    "end": "2662109"
  },
  {
    "text": "Any questions about\nheader synchronization? Seems pretty\nstraight-- oh, yeah.",
    "start": "2662110",
    "end": "2668141"
  },
  {
    "text": "AUDIENCE: Can you\ncatch any of that work, since you're going to see some\nof these every time you sync?",
    "start": "2668142",
    "end": "2673800"
  },
  {
    "text": "TADGE DRYJA: Well, yeah,\nyou save it to disk. So you don't have to, like,\nif you shut your computer off, turn it on the next\ntime, you've already",
    "start": "2673800",
    "end": "2680430"
  },
  {
    "text": "got all those headers on disk. Basically, you save them to\ndisk once you've verified them. So you download a\ncouple thousand.",
    "start": "2680430",
    "end": "2686710"
  },
  {
    "text": "It builds linearly,\nso it's nice for you to like download them, validate,\nand as you validate, write them to disk. And then when you start\nbackup, they're on disk.",
    "start": "2686710",
    "end": "2693810"
  },
  {
    "text": "You trust your own disk. If someone goes in\nand modifies things on disk between running of\nBitcoin, all bets are off.",
    "start": "2693810",
    "end": "2701940"
  },
  {
    "text": "So you sort of\nimplicitly trust that. So yeah, that's pretty\nquick, works well.",
    "start": "2701940",
    "end": "2706992"
  },
  {
    "text": "Then you get to\nthe real hard part, where you now have to\nvalidate all these signatures and download all\nthese transactions.",
    "start": "2706992",
    "end": "2712567"
  },
  {
    "text": "Any other questions? Good? So then it's called IBD,\ninitial block download.",
    "start": "2712567",
    "end": "2719152"
  },
  {
    "text": "So you get the headers first. That's quick. Now you start asking\nyour peers, hey, here's",
    "start": "2719152",
    "end": "2724350"
  },
  {
    "text": "this header from\n2009, block height 1.",
    "start": "2724350",
    "end": "2729510"
  },
  {
    "text": "Here's the header. Can you give me the full block? I have the header. What are all the things that\ngo into the Merkle root?",
    "start": "2729510",
    "end": "2737450"
  },
  {
    "text": "So you request\nblocks from peers. You match the transaction lists,\nthe Merkle root and the header.",
    "start": "2737450",
    "end": "2743010"
  },
  {
    "text": "And you process each\ntransaction in order. So download it. Say, OK, here's all\nthese transactions.",
    "start": "2743010",
    "end": "2748210"
  },
  {
    "text": "Let me take the\nhash of all of them. Compute the Merkle root. Make sure it matches\nthe Merkle root",
    "start": "2748210",
    "end": "2753840"
  },
  {
    "text": "I see in the header\nI've already gotten. And now process\neach transaction.",
    "start": "2753840",
    "end": "2759340"
  },
  {
    "text": "So what do we do to\nprocess transactions? So you've got this UTXO DB.",
    "start": "2759340",
    "end": "2766250"
  },
  {
    "text": "So this is unspent\ntransaction output. So all the cool--",
    "start": "2766250",
    "end": "2771770"
  },
  {
    "text": "I'm sure in like 2030, there\nwill be a new slang term where we'll just\ncall money UTXOs,",
    "start": "2771770",
    "end": "2777119"
  },
  {
    "text": "like, hey I've\ngot a lot of UTXO. I mean, I'm already doing that. And I'm pretty ahead\nof the times, so.",
    "start": "2777120",
    "end": "2782420"
  },
  {
    "text": " So you've got this\ndatabase, which is basically a key-value store.",
    "start": "2782420",
    "end": "2789410"
  },
  {
    "text": "And it just has\ntransaction ID index-- so this sort of how\nyou reference inputs",
    "start": "2789410",
    "end": "2798049"
  },
  {
    "text": "in Bitcoin, the transaction\nID index as the key. And then the value\nis just the output,",
    "start": "2798050",
    "end": "2804799"
  },
  {
    "text": "the scriptsig and 8-byte amount.",
    "start": "2804800",
    "end": "2810000"
  },
  {
    "text": "So it's pretty compact. You've got all these key values. And it's using level DB. But you could use some other\nkey-value store database.",
    "start": "2810000",
    "end": "2817290"
  },
  {
    "text": "And the idea is, OK, every\ntime you get a transaction, validate all the inputs. Make sure all the\nsignatures are good.",
    "start": "2817290",
    "end": "2823410"
  },
  {
    "text": "Make sure it's spending\nthings that actually exist in your UTXO set. ",
    "start": "2823410",
    "end": "2830130"
  },
  {
    "text": "And delete those inputs\nfrom your UTXO DB. You say, OK, this\ntransaction is spending",
    "start": "2830130",
    "end": "2835800"
  },
  {
    "text": "these inputs, so delete. So [INAUDIBLE], sorry. First, make sure the\ntransaction's valid,",
    "start": "2835800",
    "end": "2840900"
  },
  {
    "text": "given your current UTXO DB. So validate that all\nthese inputs exist. Validate all the\nsignatures are correct.",
    "start": "2840900",
    "end": "2848450"
  },
  {
    "text": "Then you're saying, OK,\nthis transaction is good. Now I modify my database by\ndeleting all the inputs that",
    "start": "2848450",
    "end": "2855530"
  },
  {
    "text": "are consumed and adding\nall these new outputs for the transaction.",
    "start": "2855530",
    "end": "2863280"
  },
  {
    "text": "So this modifies the\ndatabase in place. And you're sort of\nconstantly reading",
    "start": "2863280",
    "end": "2868380"
  },
  {
    "text": "from it to validate\ninputs, and then writing",
    "start": "2868380",
    "end": "2873440"
  },
  {
    "text": "to it to delete inputs,\nand then writing to it again to add outputs.",
    "start": "2873440",
    "end": "2878450"
  },
  {
    "text": "So it doesn't seem too bad. But there's a lot\nof disk access. And the UTXO DB is a key-value\nstore with a lot of keys.",
    "start": "2878450",
    "end": "2886280"
  },
  {
    "text": "The values are very small. So it's not like a\ncrazy database problem, if anyone's interested\nin databases and stuff.",
    "start": "2886280",
    "end": "2894500"
  },
  {
    "text": "But it can be slow. And we want to\nreally optimize it. So when you think the\ninitial block download,",
    "start": "2894500",
    "end": "2902319"
  },
  {
    "text": "you're doing this\n300 million times. So there's about 300 million\ntransactions historically.",
    "start": "2902320",
    "end": "2908120"
  },
  {
    "text": "So you're validating signature,\ndeleting input, adding output, 300 million times. It ends up being about 170\ngigabytes of downloads.",
    "start": "2908120",
    "end": "2916000"
  },
  {
    "start": "2913000",
    "end": "2975000"
  },
  {
    "text": "And then the end\nresult, when you're done modifying this\ndatabase, is that you",
    "start": "2916000",
    "end": "2921160"
  },
  {
    "text": "have 55 million transaction\noutputs remaining. And it's about 3.2\ngigabytes of disk use.",
    "start": "2921160",
    "end": "2928250"
  },
  {
    "text": "So yeah, but you had to download\nthat 170 gigabytes to get to the 3.2-gigabyte\nend state, because most",
    "start": "2928250",
    "end": "2936850"
  },
  {
    "text": "of the transactions that\nhave been created and most of the outputs have\nthen later been spent.",
    "start": "2936850",
    "end": "2941890"
  },
  {
    "text": "So there's a lot of churn. So yeah, of the 300 million-- sorry, these are not\nthe same numbers.",
    "start": "2941890",
    "end": "2948340"
  },
  {
    "text": "I was actually looking. How many transaction\noutputs have been created throughout all of Bitcoin? And I couldn't find the number.",
    "start": "2948340",
    "end": "2954212"
  },
  {
    "text": "And I didn't want to write\nsoftware to figure it out. But you can certainly figure\nit out from the blockchain.",
    "start": "2954212",
    "end": "2962460"
  },
  {
    "text": "But yeah, this is\ntransaction outputs. How many total\ntransactions have TXOs?",
    "start": "2962460",
    "end": "2967468"
  },
  {
    "text": "I'm not sure. But yeah, so it's pretty big. But it's reasonable. Like, we can do this\non today's computers. If you've got a decent\nlaptop, this is possible.",
    "start": "2967468",
    "end": "2974700"
  },
  {
    "text": "This total time taken\ndepends on a lot of factors. Has anyone actually done\ninitial block download",
    "start": "2974700",
    "end": "2981120"
  },
  {
    "start": "2975000",
    "end": "3221000"
  },
  {
    "text": "and synced to Bitcoin\nnode, and like, want to say about how\nquickly they did it or? OK, James, how long did it take?",
    "start": "2981120",
    "end": "2986820"
  },
  {
    "text": "AUDIENCE: For 0.15, it's\nactually quite quick. On a spinning disk it will\ntake about six hours maybe.",
    "start": "2986820",
    "end": "2994117"
  },
  {
    "text": "TADGE DRYJA: On a spinning disk? AUDIENCE: Yeah, yeah, with the\nnew one, it's really quick. TADGE DRYJA:\nBecause I run 0.15.1",
    "start": "2994117",
    "end": "3000590"
  },
  {
    "text": "on a laptop with\na spinning disk, and it'll take like overnight\nto just sync up a week or so.",
    "start": "3000590",
    "end": "3007220"
  },
  {
    "text": "It's really slow,\nbut I don't know. AUDIENCE: Like, my\nmum tried to start it, and it did it from scratch. It did it in like eight hours.",
    "start": "3007220",
    "end": "3012397"
  },
  {
    "text": "TADGE DRYJA: Wow, cool, so eight\nhours to do the whole thing-- anyone else have tried it?",
    "start": "3012397",
    "end": "3018130"
  },
  {
    "text": "Yeah. AUDIENCE: A while back\nit took me a week. TADGE DRYJA: Yeah, a\nwhile back it took a week. So the software has been\nimproved quite a bit.",
    "start": "3018130",
    "end": "3025270"
  },
  {
    "text": "So if you downloaded it-- like, I first\ndownloaded it in 2011. And it took overnight\nto download everything.",
    "start": "3025270",
    "end": "3032750"
  },
  {
    "text": "And the download\nwas vastly smaller. It was less than a gigabyte to\ndownload the entire blockchain. So what's interesting\nis that the time taken",
    "start": "3032750",
    "end": "3039930"
  },
  {
    "text": "for initial block download\nover the last seven years has been somewhat constant\nin that the blockchain gets",
    "start": "3039930",
    "end": "3047340"
  },
  {
    "text": "bigger and bigger. But there's all\nthese optimizations to the code and the databases. And so that sort of keeps pace.",
    "start": "3047340",
    "end": "3055160"
  },
  {
    "text": "Although actually, I'd say\nrecently it's gotten faster, because like 0.15-- wait, 0.11 or 0.12 had\na big speed-up as well.",
    "start": "3055160",
    "end": "3063830"
  },
  {
    "text": "AUDIENCE: They completely\nrefactored the net web code. It used to be couples\nof the synchronization. And then they decoupled it.",
    "start": "3063830",
    "end": "3069185"
  },
  {
    "text": "TADGE DRYJA: Yeah, I think\nthat was mostly Cory, right? So Cory Fields, who\nalso works for the DCI,",
    "start": "3069185",
    "end": "3075200"
  },
  {
    "text": "helped to refactor the\ncode, make it a lot faster. There's definitely still\noptimizations, a lot of cool--",
    "start": "3075200",
    "end": "3083089"
  },
  {
    "text": "a lot of it's pretty low-level\ntweaks kind of stuff. But some of them are\npretty big things. Most of the big things,\nlow-hanging fruit,",
    "start": "3083090",
    "end": "3089700"
  },
  {
    "text": "has already been gotten. The worry is that long-term,\nthis just keeps going up.",
    "start": "3089700",
    "end": "3095210"
  },
  {
    "text": "As the blockchain gets\nbigger and longer, it's going to take heart. It's going to be\nharder to validate.",
    "start": "3095210",
    "end": "3100880"
  },
  {
    "text": "It can be parallelized\nto some extent. But there's also network I/O\nconcerns, things like that.",
    "start": "3100880",
    "end": "3106760"
  },
  {
    "text": "So it's tricky but doable. Any questions about\ninitial block download?",
    "start": "3106760",
    "end": "3114360"
  },
  {
    "text": "Good? So here's a question. You've got this UTXO DB.",
    "start": "3114360",
    "end": "3121349"
  },
  {
    "text": "What about this 170 gigabytes? Do you have to store it? Or can you delete it?",
    "start": "3121350",
    "end": "3126602"
  },
  {
    "text": "This you can't delete, right?  So you think this is OK?",
    "start": "3126602",
    "end": "3133809"
  },
  {
    "text": "Yeah, you can maybe\ndelete some of this. Actually, there's\na lot of research into maybe we can delete\nthis, accumulators, cool stuff",
    "start": "3133810",
    "end": "3142170"
  },
  {
    "text": "like that. It would be really cool to have\nsome kind of data structure where we can keep adding these--",
    "start": "3142170",
    "end": "3147960"
  },
  {
    "text": "we can add, remove, and\nprove, and then seek, and see if something's\nin there, where it either",
    "start": "3147960",
    "end": "3154168"
  },
  {
    "text": "is like constant size, or login\nsize, or something like that. That'd be really cool. There are constructions\nlike that,",
    "start": "3154168",
    "end": "3160140"
  },
  {
    "text": "but they don't work for what\nwe're trying to do right now. But there's a lot of\nresearch into that. If anyone here finds\nsome cool data structure",
    "start": "3160140",
    "end": "3167070"
  },
  {
    "text": "that you can use for the UTXO\nDB that doesn't keep growing linear at size of the number\nof keys, everyone in Bitcoin",
    "start": "3167070",
    "end": "3174750"
  },
  {
    "text": "will sing your praises forever. But it's an active\nresearch area.",
    "start": "3174750",
    "end": "3180780"
  },
  {
    "text": "So pruning-- by default-- oh,\nthat should be a K, not an M,",
    "start": "3180780",
    "end": "3186210"
  },
  {
    "text": "sorry. There's only 500K\nblocks, not 500M. Anyway, by default, your client\nwill download all these blocks",
    "start": "3186210",
    "end": "3193920"
  },
  {
    "text": "and store them on the disk. And that's important\nbecause what if someone else requests them from you?",
    "start": "3193920",
    "end": "3202020"
  },
  {
    "text": "Everyone starts out as a noob. Someone else comes\nand says, hey, guys, I just downloaded Bitcoin.",
    "start": "3202020",
    "end": "3207750"
  },
  {
    "text": "What's going on for\nthe last nine years? And you might want\nto give them blocks to let them into the system.",
    "start": "3207750",
    "end": "3215210"
  },
  {
    "text": "So you can serve to\nothers who are doing IBD. However, if you want, and\nyour hard drive's small, or you have an SSD\nor something, you",
    "start": "3215210",
    "end": "3221609"
  },
  {
    "text": "can prune and delete the\nblocks after you've done IBD, with no loss of security.",
    "start": "3221610",
    "end": "3229110"
  },
  {
    "text": "Anyone think of\ndownsides doing so? ",
    "start": "3229110",
    "end": "3238140"
  },
  {
    "text": "Not really, right? The only real downside\nis sort of this. Well, not everyone can prune.",
    "start": "3238140",
    "end": "3244680"
  },
  {
    "text": "If everyone prunes, no new\nentrants to the system. So it's a little\nbit of a tricky sort",
    "start": "3244680",
    "end": "3250670"
  },
  {
    "start": "3247000",
    "end": "3343000"
  },
  {
    "text": "of seed versus leech\nkind of problem, where someone's got to be\nthere to serve up these blocks.",
    "start": "3250670",
    "end": "3257321"
  },
  {
    "text": "You don't have to trust them. You're still validating\nall the work, validating all the signatures. They can't do anything bad.",
    "start": "3257322",
    "end": "3264440"
  },
  {
    "text": "But someone's got to be there\nto provide the network capacity. And so it is tricky. Like, most of the\nnodes on the network",
    "start": "3264440",
    "end": "3271010"
  },
  {
    "text": "are behind people's cable\nmodem firewall kind of thing. So you can't actually\nconnect to them and download.",
    "start": "3271010",
    "end": "3276860"
  },
  {
    "text": "And if you run a node\nthat does allow people to connect in and\nserve them blocks, people will download\nquite a bit.",
    "start": "3276860",
    "end": "3283010"
  },
  {
    "text": "So I have one in the\noffice over there. It ends up sending out about\nthree terabytes a month,",
    "start": "3283010",
    "end": "3291600"
  },
  {
    "text": "which is a lot. Like, it's dozens of gigabytes\na day, 20, 30, I don't know.",
    "start": "3291600",
    "end": "3297800"
  },
  {
    "text": "So yeah, people are doing this. People are connecting in and\ndownloading all the blocks, either through IBD\nor just keeping up",
    "start": "3297800",
    "end": "3304070"
  },
  {
    "text": "with current transactions. So yeah, pruning is possible. But not everyone can do it, so\nit's sort of an unsolved issue",
    "start": "3304070",
    "end": "3312750"
  },
  {
    "text": "there. There's a lot of\nresearch into how we can do partial\npruning, where, OK, I'm going to only store the last\nmonth's worth of blocks, which",
    "start": "3312750",
    "end": "3320180"
  },
  {
    "text": "is mostly what people do,\nbecause a lot of people have intermittent connectivity,\nwhere they'll turn off",
    "start": "3320180",
    "end": "3325310"
  },
  {
    "text": "their node and then start it\nback up again a few days later. And they just need to catch\nup with the last few blocks.",
    "start": "3325310",
    "end": "3331930"
  },
  {
    "text": "So pruning's cool. That's been in since\n0.12 or something. So I'll go through--",
    "start": "3331930",
    "end": "3338770"
  },
  {
    "text": "in practice, if you go\nto your Bitcoin node, what does that actually store? And if you just go to\nyour Bitcoin folder,",
    "start": "3338770",
    "end": "3345080"
  },
  {
    "start": "3343000",
    "end": "3376000"
  },
  {
    "text": "which in Unix-type OS's is\nlike home directory /.Bitcoin-- ",
    "start": "3345080",
    "end": "3352030"
  },
  {
    "text": "total random aside,\nI don't like how they put a dot in front of all\nthe really important folders.",
    "start": "3352030",
    "end": "3358090"
  },
  {
    "text": "It's like they hide all the\nimportant things, like your GPG folder, It's got a dot. And your Bitcoin\nfolder's got a dot.",
    "start": "3358090",
    "end": "3363430"
  },
  {
    "text": "But like, downloads doesn't. And like, who cares about that?",
    "start": "3363430",
    "end": "3368740"
  },
  {
    "text": "Anyway, so if you just\nls in your folder, here's all the files.",
    "start": "3368740",
    "end": "3374620"
  },
  {
    "text": "And we'll just go\nthrough it real quick. Here's the files,\nand I'll describe. So there's a banlist.dat.",
    "start": "3374620",
    "end": "3381850"
  },
  {
    "start": "3376000",
    "end": "3443000"
  },
  {
    "text": "This is a list of IP\naddresses that you have banned, because they're bad.",
    "start": "3381850",
    "end": "3387190"
  },
  {
    "text": "They're doing something weird. So I'll get to it at the end. I sort of am thinking of making\na ban list for the problem set,",
    "start": "3387190",
    "end": "3393640"
  },
  {
    "text": "because there are some nodes\nthat are doing non-good things. That was what caused\nyesterday's outage.",
    "start": "3393640",
    "end": "3400390"
  },
  {
    "text": "Someone was connecting. Although it was really my\nfault, because the server code was not verifying\ninputs correctly.",
    "start": "3400390",
    "end": "3406030"
  },
  {
    "text": "But yeah, in Bitcoin,\nyou verify everything. If people start sending you\nnonsense data, or they say, hey, here's a block,\nand it's wrong,",
    "start": "3406030",
    "end": "3412420"
  },
  {
    "text": "or hey, here's a transaction,\nand the signatures are wrong, you'll pretty quickly ban\nthem, because it's like, well,",
    "start": "3412420",
    "end": "3419599"
  },
  {
    "text": "if they're making a mistake-- it's computer. There's no excuse\nfor making a mistake.",
    "start": "3419600",
    "end": "3424790"
  },
  {
    "text": "So either their software is\njust different than mine, or something's wrong with their\nsoftware or their hardware, I don't know.",
    "start": "3424790",
    "end": "3430032"
  },
  {
    "text": "But they're wasting my time. They're sending\nme nonsense-- ban. So you have your own ban list.",
    "start": "3430032",
    "end": "3436339"
  },
  {
    "text": "Then the blue ones are folders. I'll talk about those later. But you have peers.dat,\nwhich is good nodes.",
    "start": "3436340",
    "end": "3443350"
  },
  {
    "start": "3443000",
    "end": "3493000"
  },
  {
    "text": "So it's quite a\nbit, 4 megabytes. And you keep track of here's\nall the different nodes",
    "start": "3443350",
    "end": "3448780"
  },
  {
    "text": "I've connected to for\nthe duration of however long I've been using Bitcoin.",
    "start": "3448780",
    "end": "3454330"
  },
  {
    "text": "I keep track of all\ntheir IP addresses, how much uptime they've had,\nwhat I've downloaded from them.",
    "start": "3454330",
    "end": "3460520"
  },
  {
    "text": "And so I sort of sort them and\nput the good ones at the top. And like, OK, here's all\nthe different Bitcoin nodes.",
    "start": "3460520",
    "end": "3466330"
  },
  {
    "text": "So next time I start\nup Bitcoin, I'm going to try to connect to them. So this makes the\nnetwork very robust,",
    "start": "3466330",
    "end": "3472060"
  },
  {
    "text": "because everyone\nremembers everyone else. And then when they need to-- if there's a network\ndisruption, maybe half the nodes",
    "start": "3472060",
    "end": "3478330"
  },
  {
    "text": "go off the network,\nyou can still try to connect to all the rest. And also peers will share their\npeers files, not directly,",
    "start": "3478330",
    "end": "3486910"
  },
  {
    "text": "but they'll sort of take\nrandom samplings of this file and share it with each other,\nso that everyone sort of knows about everyone else.",
    "start": "3486910",
    "end": "3494510"
  },
  {
    "start": "3493000",
    "end": "3599000"
  },
  {
    "text": "Then there's a wallet.dat,\nwhich is very important, because that's got all\nyour precious UTXOs.",
    "start": "3494510",
    "end": "3501200"
  },
  {
    "text": "And we'll talk about\nwallets Monday, I think. There's a bitcoin.conf,\nlittle config file.",
    "start": "3501200",
    "end": "3507770"
  },
  {
    "text": "You can set some settings\nand things like that; a debug file, which shows\nall these weird messages;",
    "start": "3507770",
    "end": "3514340"
  },
  {
    "text": "and a mempool.dat. So the mempool is a transaction\nyou've seen that you've not",
    "start": "3514340",
    "end": "3520130"
  },
  {
    "text": "seen in a block yet. So people are\nbroadcasting transactions. And you store them.",
    "start": "3520130",
    "end": "3525859"
  },
  {
    "text": "It used to be just in memory,\nhence the word \"mempool.\" Now it's more like disk\npool, because you actually",
    "start": "3525860",
    "end": "3530900"
  },
  {
    "text": "store them on disk, because it\nsaves a little speed when you shut down and start up again. So any questions about just\nwhat all these files are doing?",
    "start": "3530900",
    "end": "3539120"
  },
  {
    "text": " Makes sense, so now the folders. ",
    "start": "3539120",
    "end": "3546570"
  },
  {
    "text": "Chainstate blocks\nand database-- so any guesses onto how\nbig these things are based on previous slides or?",
    "start": "3546570",
    "end": "3554000"
  },
  {
    "text": "So how big is\nchainstate, for example?  Yes?",
    "start": "3554000",
    "end": "3559330"
  },
  {
    "text": "AUDIENCE: 3 gigs. TADGE DRYJA: Yeah, 3 gigs. This is a UTXO set, 3-ish gigs.",
    "start": "3559330",
    "end": "3566972"
  },
  {
    "text": "This is all the blocks. What? Oh, no. ",
    "start": "3566972",
    "end": "3572547"
  },
  {
    "text": "And then database,\nactually, I have no idea. Does anyone know what that is? There's a database folder, and\nit's got one little log file.",
    "start": "3572547",
    "end": "3578849"
  },
  {
    "text": "And it's like 80 kilobytes. I don't know what it is. Do you guys know? Yeah, I don't know.",
    "start": "3578850",
    "end": "3585630"
  },
  {
    "text": "But there's a blocks folder,\nand that's got all the blocks. And that's your\nhuge amount of data.",
    "start": "3585630",
    "end": "3592440"
  },
  {
    "text": "And this is the UTXO\nset, not too bad. So yeah, you can look in it. It's reasonable but\nyeah, it's kind of big.",
    "start": "3592440",
    "end": "3600827"
  },
  {
    "text": "So any questions\nabout the data stuff? I'm going to go into\nblockchain as a database, real quick at the end.",
    "start": "3600827",
    "end": "3606789"
  },
  {
    "text": "So it's 186 gigabytes,\nor alternatively, you can think of it as\njust 3 gigabytes.",
    "start": "3606790",
    "end": "3612310"
  },
  {
    "text": "But it's a really\ncrummy database. So I've heard a\nlot that blockchain is going to change the world. And it's like a database\nthat's shared among everyone.",
    "start": "3612310",
    "end": "3619090"
  },
  {
    "text": "And you can query things. It's a really bad database. So for example,\nI'm going to have",
    "start": "3619090",
    "end": "3625150"
  },
  {
    "text": "some fun interactive\nquestions, where some of these",
    "start": "3625150",
    "end": "3630819"
  },
  {
    "text": "are answerable. Some of these are not. And I'm posing the question\nto my Bitcoin node.",
    "start": "3630820",
    "end": "3637506"
  },
  {
    "text": "So I posed this question\nto my Bitcoin node. Hey, remember transaction\n9e95c3 dot, dot, dot,",
    "start": "3637507",
    "end": "3642970"
  },
  {
    "text": "from back in 2014? And how do you think the\nBitcoin node will answer?",
    "start": "3642970",
    "end": "3648170"
  },
  {
    "text": "Will it answer, or\nwill it not be able to? Any ideas? Yeah. AUDIENCE: Wait, where does\none be easiest [INAUDIBLE]??",
    "start": "3648170",
    "end": "3655195"
  },
  {
    "text": " TADGE DRYJA: 183 plus 3,\nso the total data usage",
    "start": "3655195",
    "end": "3662120"
  },
  {
    "text": "on this computer is 186 gigs. The rest are kind of small.",
    "start": "3662120",
    "end": "3669071"
  },
  {
    "text": "AUDIENCE: What do you mean? TADGE DRYJA: So I mean like,\nwhen you're using Bitcoin, you've got 186 gigs\non your hard drive",
    "start": "3669072",
    "end": "3675680"
  },
  {
    "text": "or your SSD devoted to Bitcoin. So you've got this 186-gigabyte\ndatabase, essentially.",
    "start": "3675680",
    "end": "3683900"
  },
  {
    "text": "But it's a really\ncrummy database. And it can't do a lot of the\nthings you might expect it to.",
    "start": "3683900",
    "end": "3689670"
  },
  {
    "text": "So for example, this-- arbitrary transaction\nfrom the past-- you say, hey, there was this transaction\na couple of years ago.",
    "start": "3689670",
    "end": "3696920"
  },
  {
    "text": "Give me the\ninformation about it. And what do you think the\nresponse from the full node is? AUDIENCE: It's valid.",
    "start": "3696920",
    "end": "3702050"
  },
  {
    "text": "TADGE DRYJA: What, sorry? AUDIENCE: It's\nvalid or not valid. TADGE DRYJA: It's\nvalid or not valid. Any other ideas? AUDIENCE: What's the header?",
    "start": "3702050",
    "end": "3707150"
  },
  {
    "text": "TADGE DRYJA: What, sorry? AUDIENCE: What's the\nheader of [INAUDIBLE]?? TADGE DRYJA: It asks\ninstead for a header. Any other ideas? Yeah, so sort of that--\nit'll say, remember TX disk?",
    "start": "3707150",
    "end": "3715900"
  },
  {
    "text": "No, it's somewhere\nin the blocks maybe, but I have no idea where. It's not in the chainstate.",
    "start": "3715900",
    "end": "3721530"
  },
  {
    "text": "So it just stores the blocks. Like, here's this block. Here's that block, in line.",
    "start": "3721530",
    "end": "3728170"
  },
  {
    "text": "And if you say, hey,\nthere's this transaction. OK, go look for it. Oh, 2014, well, that might\nbe somewhere in the middle.",
    "start": "3728170",
    "end": "3737309"
  },
  {
    "text": "But yeah, if you don't know\nwhat block it's in, forget it. So it does have an\nindex of blocks. It'll tell you a block,\nbut transaction, no luck.",
    "start": "3737310",
    "end": "3744450"
  },
  {
    "text": "Yeah. AUDIENCE: So it pretty much\ntells you if it exists, and that's it. TADGE DRYJA: It won't even\ntell you if this exists.",
    "start": "3744450",
    "end": "3749470"
  },
  {
    "text": "It has no idea. AUDIENCE: What's the\n[INAUDIBLE] in the block though? TADGE DRYJA: I might\nhave made that up.",
    "start": "3749470",
    "end": "3755107"
  },
  {
    "text": "So if you're saying, hey,\nhere's this transaction. Do you remember it? Does it exist? I don't know. Yeah.",
    "start": "3755107",
    "end": "3760110"
  },
  {
    "text": "AUDIENCE: If you ask-- if you\nquery about a certain block, will it be able to? TADGE DRYJA: Yes, and I'll--",
    "start": "3760110",
    "end": "3765397"
  },
  {
    "text": "yeah, good question. But I'll get to that. I think it's in\nthe later slides. But yes, if you create\nyour base on a block hash,",
    "start": "3765397",
    "end": "3772890"
  },
  {
    "text": "then it does have\nthat in the database. And it'll be able\nto get it for you. Yeah, James. AUDIENCE: I know what the\ndatabase directory does.",
    "start": "3772890",
    "end": "3779140"
  },
  {
    "text": "TADGE DRYJA: You know what\nthe database directory does. AUDIENCE: Yeah,\nit's the journaling for the other databases. TADGE DRYJA: Journaling\nfor other databases--",
    "start": "3779140",
    "end": "3785490"
  },
  {
    "text": "OK, I didn't-- yeah, cool. It's very small, so I\nguess it helps things work.",
    "start": "3785490",
    "end": "3790789"
  },
  {
    "text": "So this one-- do you\nknow this transaction? No. How about this?",
    "start": "3790790",
    "end": "3796579"
  },
  {
    "text": "Well, I've got this output. It's still there in the UTX--\nlike, someone spent here.",
    "start": "3796580",
    "end": "3804230"
  },
  {
    "text": "It's like, this a\ntransaction in the first one. It's an op_return output. So it's got some extra data.",
    "start": "3804230",
    "end": "3809359"
  },
  {
    "text": "But op_return\nmeans it's invalid. It can't spend it. Can you tell me\nwhat the data is? Do you think it'll be able to?",
    "start": "3809360",
    "end": "3816640"
  },
  {
    "text": "If you query, hey,\nhere's this output, what do you think\nthe response will be?",
    "start": "3816640",
    "end": "3823340"
  },
  {
    "text": "Yea, nay? Nay, OK, I'm seeing nays. Yeah. Nope. If it's an op_return output,\neven though it's unspent,",
    "start": "3823340",
    "end": "3830630"
  },
  {
    "text": "well, it's unspendable. So you don't put it\nin the UTXO database, because you just see, oh, this\noutput, op_return is in there.",
    "start": "3830630",
    "end": "3838715"
  },
  {
    "text": "Don't bother putting it in. No one will ever be\nable to spend it. So there's no\nreason to put it in. So op_returns are\nused to sort of commit",
    "start": "3838715",
    "end": "3845780"
  },
  {
    "text": "to data and all these\ndifferent protocols. But the actual normal\ncode won't store them.",
    "start": "3845780",
    "end": "3853786"
  },
  {
    "text": "Anything else? Next one, this one-- hey, I have a public key.",
    "start": "3853787",
    "end": "3859808"
  },
  {
    "text": "And here's the hash\nof my public key. This is essentially an address. So we didn't talk\nabout addresses. But the Bitcoin addresses\nthat start with like a 1,",
    "start": "3859808",
    "end": "3866500"
  },
  {
    "text": "and then have these\nalphanumeric stuff-- it's just a different\nencoding, slightly shorter",
    "start": "3866500",
    "end": "3871710"
  },
  {
    "text": "than hexadecimal,\nfor a pubkey hash. So you say, hey, I've got this. I have a private key.",
    "start": "3871710",
    "end": "3877290"
  },
  {
    "text": "I just computed the public key. I hashed it. I got this. Do I have any money? I think I did.",
    "start": "3877290",
    "end": "3883250"
  },
  {
    "text": "I don't remember. But I remember my private key. I backed that up. That was the important part. Everyone says keep\nyour private keys.",
    "start": "3883250",
    "end": "3889450"
  },
  {
    "text": "So I have my private key. But all this data and\nall this blockchain stuff, I lost my computer.",
    "start": "3889450",
    "end": "3895357"
  },
  {
    "text": "But I have my private,\nso I've got my money. How many coins do I have? How many outputs?",
    "start": "3895357",
    "end": "3900580"
  },
  {
    "text": "What do you think the\nfull node will tell you? Yeah, any ideas?",
    "start": "3900580",
    "end": "3908130"
  },
  {
    "text": "It'll say, I don't know. Well, you're going to have\nto search through everything in chainstate.",
    "start": "3908130",
    "end": "3914040"
  },
  {
    "text": "And it doesn't index based on\nthe public key script, only the transaction ID index there. It's a key-value store, and the\nkey is this 36-byte txid:index.",
    "start": "3914040",
    "end": "3924510"
  },
  {
    "text": "So this is a very real problem. Like, OK, I backed up my key. Or I took my private keys\nto some other computer",
    "start": "3924510",
    "end": "3930630"
  },
  {
    "text": "or something like that. And this is fairly-- it's gotten a lot faster. It used to take hours,\nwhere you had a hard drive,",
    "start": "3930630",
    "end": "3937980"
  },
  {
    "text": "and you're like, OK, import\na key to this wallet. And it's like, well, when\ndid you do transactions?",
    "start": "3937980",
    "end": "3943430"
  },
  {
    "text": "It has to look through the\nentire blockchain, [INAUDIBLE] and linearly, to see if\nany of these transactions",
    "start": "3943430",
    "end": "3949110"
  },
  {
    "text": "have an output that matches\nthat, and then says, oh, yeah, you got\nmoney back in 2013. Oh, then you spent it--",
    "start": "3949110",
    "end": "3955850"
  },
  {
    "text": "and sort of replays\nthings, because it doesn't have an address index. ",
    "start": "3955850",
    "end": "3962530"
  },
  {
    "text": "Next one-- this is an example. How many coins-- so you say,\nhey, here's this output,",
    "start": "3962530",
    "end": "3968349"
  },
  {
    "text": "this transaction:1, how\nmany coins does it have? Will the full node be\nable to tell you this?",
    "start": "3968350",
    "end": "3974970"
  },
  {
    "text": "Yea, nay? I'm seeing a bunch of nays. No, it will.",
    "start": "3974970",
    "end": "3980910"
  },
  {
    "text": "Yeah, this is the\none thing it can do. So if you say, hey, 7434,\ndot, dot, dot, colon 1,",
    "start": "3980910",
    "end": "3988413"
  },
  {
    "text": "it'll know that. That's in the UTXO DB,\nbecause that's the key that the UTXO DB sorts by.",
    "start": "3988413",
    "end": "3994400"
  },
  {
    "text": "So yep, this is a UTXO. It's unspent. And it has a bunch of coins.",
    "start": "3994400",
    "end": "4000177"
  },
  {
    "text": "And this is fairly recent. I was just looking through. Someone got a couple\nmillion bucks worth, cool. Is that a million?",
    "start": "4000177",
    "end": "4006047"
  },
  {
    "text": "Man. Yeah, it's a new UTXO\nset, hasn't been spent,",
    "start": "4006048",
    "end": "4011400"
  },
  {
    "text": "and you can sort quickly\nbased on txid:index pair. So I think this is in\nsome software called",
    "start": "4011400",
    "end": "4018180"
  },
  {
    "text": "an outpoint, where it's\nlike, you concatenate them. And it ends up being 36 bytes.",
    "start": "4018180",
    "end": "4023310"
  },
  {
    "text": "This is 32 bytes. This is 4. So you sort of have\na 36-byte outpoint, which describes what goes\ninto the UTXO database.",
    "start": "4023310",
    "end": "4030200"
  },
  {
    "text": "AUDIENCE: But once\nit gets respent, it's hard to find it again. TADGE DRYJA: Yeah,\nonce this is spent,",
    "start": "4030200",
    "end": "4035330"
  },
  {
    "text": "you delete it from the UTXO, and\nyou won't remember it anymore. It'll just be, hey, you, how\nmany coins does this have?",
    "start": "4035330",
    "end": "4040950"
  },
  {
    "text": "You're like, well-- well,\nyou can still answer it. You say \"none.\" If it's spent, and you say, how\nmany coins does this guy have?",
    "start": "4040950",
    "end": "4048480"
  },
  {
    "text": "None. It's not in the UTXO set.  Yeah, so the previous one--",
    "start": "4048480",
    "end": "4053820"
  },
  {
    "text": "I just copied these randomly.  So any questions about what is\nstored and what is not stored?",
    "start": "4053820",
    "end": "4061790"
  },
  {
    "text": " Basically, keeps\ntrack of UTXOs, and it",
    "start": "4061790",
    "end": "4067220"
  },
  {
    "text": "keeps track of historic\nblocks in order to give them to people. And it keeps after the headers. The headers ends up being small.",
    "start": "4067220",
    "end": "4072720"
  },
  {
    "text": "All the headers\ntotal is like, what? 40 megs, something like that. So yeah, you can\nadd further indices.",
    "start": "4072720",
    "end": "4080470"
  },
  {
    "text": "You could write software to\nanswer all these questions very quickly. But that's not what\nBitcoin does by default.",
    "start": "4080470",
    "end": "4088500"
  },
  {
    "text": "Those types of indices would\ntake a lot of extra space and add a lot of CPU\nor things like that.",
    "start": "4088500",
    "end": "4095440"
  },
  {
    "text": "So a very common thing\nis an address index, so people can ask if\nthey have any money. So the second to last\none, where you say,",
    "start": "4095440",
    "end": "4102580"
  },
  {
    "text": "hey, I have this key hash. Do I have any money? Do I have any transactions?",
    "start": "4102580",
    "end": "4107850"
  },
  {
    "text": "Having an address\nindex is actually pretty useful for\na lot of things, for example, importing keys or\nlike web wallet kind of things.",
    "start": "4107850",
    "end": "4117080"
  },
  {
    "text": "But Bitcoin by default doesn't\ndo it, because, well, why?",
    "start": "4117080",
    "end": "4122598"
  },
  {
    "text": "You can make arguments that\nit would be actually useful to have in the normal\ncode, but we don't.",
    "start": "4122598",
    "end": "4129109"
  },
  {
    "text": "Any other questions about\nwhat indices, what it can do, what it cannot do?",
    "start": "4129109",
    "end": "4134630"
  },
  {
    "text": "Somewhat counterintuitive in\nmany cases, where you say, hey, here's this transaction. And you can't actually find it.",
    "start": "4134630",
    "end": "4141180"
  },
  {
    "text": "Or you have to scan through 180\ngigabytes in order to find it. So wait, James, I\nhave a question.",
    "start": "4141180",
    "end": "4147289"
  },
  {
    "text": "So how big is an address index\nfor what you were working on? AUDIENCE: Usually, equal to\nthe size of the chain inside.",
    "start": "4147290",
    "end": "4154799"
  },
  {
    "text": "TADGE DRYJA: Wow, so it\ncould be hundreds of gigs. Yeah. AUDIENCE: It only takes what? At least for Bitcoin, it\ntakes usually multiple weeks",
    "start": "4154800",
    "end": "4161560"
  },
  {
    "text": "to generate. TADGE DRYJA: Weeks to generate? I bet you, well-- AUDIENCE: Although [INAUDIBLE]\nusually takes a few days",
    "start": "4161560",
    "end": "4166613"
  },
  {
    "text": "on the inside, which is\nwhat [INAUDIBLE] takes-- weeks. TADGE DRYJA: Well,\nthat's inside.",
    "start": "4166614",
    "end": "4172120"
  },
  {
    "text": "So the other thing is, these\nare like fairly involved sort",
    "start": "4172120",
    "end": "4177250"
  },
  {
    "text": "of CSE software\nengineering problems. And optimization really works. If you download like Bitcoin\n0.9, it'll still work.",
    "start": "4177250",
    "end": "4186339"
  },
  {
    "text": "But you're never\ngoing to catch up. Maybe not never, I don't know. If you have a fast computer, but\nit'll take months and months.",
    "start": "4186340",
    "end": "4192939"
  },
  {
    "text": "And as people have been\nupdating the software and making it faster,\nmaking it more efficient, now it's quite fast.",
    "start": "4192939",
    "end": "4198310"
  },
  {
    "text": "And you can sync the\nwhole thing in a few hours on a good computer.",
    "start": "4198310",
    "end": "4203810"
  },
  {
    "text": "So address index is one\nof those things where it hasn't had like the full\nforce of all these Bitcoin",
    "start": "4203810",
    "end": "4208929"
  },
  {
    "text": "protocol coder people on it,\nbecause it's sort of seen as like, well, yeah that's kind\nof a fun feature if you want.",
    "start": "4208930",
    "end": "4214630"
  },
  {
    "text": "But it's not like a\ncore utility of Bitcoin. So yeah, it is a database,\nmaybe not the best way",
    "start": "4214630",
    "end": "4223040"
  },
  {
    "text": "to think of it though. Don't think of the blockchain as\nlike a global shared database, because it sort of is.",
    "start": "4223040",
    "end": "4228470"
  },
  {
    "text": "But it's a fairly\nspecific database that isn't useful for\nmany other things.",
    "start": "4228470",
    "end": "4234469"
  },
  {
    "text": "Yeah, and it's also untrusted. Another part of why\nis it's untrusted. Most of these things\nexist so that they",
    "start": "4234470",
    "end": "4241560"
  },
  {
    "text": "can be used over the\npeer-to-peer peer network. If you request a block,\nI'll give it to you. If you give me a\ntransaction, I'll",
    "start": "4241560",
    "end": "4247139"
  },
  {
    "text": "match it against my UTXO set. But an address index\ndoesn't work that way. It's sort of trusted.",
    "start": "4247140",
    "end": "4252245"
  },
  {
    "text": "I can easily omit things. If you say, hey, I've got a key. What are the transactions\ninvolved with this key?",
    "start": "4252245",
    "end": "4258410"
  },
  {
    "text": "I can omit things very\neasily, and there's no way for you to\nprove it or verify it. So your DB queries aren't really\ngiven out to network peers.",
    "start": "4258410",
    "end": "4266820"
  },
  {
    "text": "And network peers are scary. And you need to ban\nthem if they act funny. And this happens all the time.",
    "start": "4266820",
    "end": "4272440"
  },
  {
    "text": "If you look through\nBitcoin logs, and you have a node that's\nup, every few seconds, you're going to be disconnecting\nfrom someone or banning them,",
    "start": "4272440",
    "end": "4279400"
  },
  {
    "text": "because they're doing something\ncrazy, trying to hack into you or whatever. So basically, all\nyou're doing is",
    "start": "4279400",
    "end": "4285010"
  },
  {
    "text": "you're providing headers,\nblocks, transactions. And you're sharing the\nother IPs and nodes.",
    "start": "4285010",
    "end": "4290400"
  },
  {
    "text": "You try to simplify it. Other questions? Yeah, bad database, good for\nconsensus, it kind of works.",
    "start": "4290400",
    "end": "4298530"
  },
  {
    "text": "Everyone's got\nthe same UTXO set, even though they\nall really would like to change that UTXO set.",
    "start": "4298530",
    "end": "4304270"
  },
  {
    "text": "I would much rather\neveryone had a UTXO set where I had\nthose 27-coin UTXO.",
    "start": "4304270",
    "end": "4310780"
  },
  {
    "text": "So almost everyone\nin the systems would rather there was\na different UTXO set. And yet, they all managed to\nagree on a single UTXO set,",
    "start": "4310780",
    "end": "4318700"
  },
  {
    "text": "so pretty cool.",
    "start": "4318700",
    "end": "4320850"
  }
]