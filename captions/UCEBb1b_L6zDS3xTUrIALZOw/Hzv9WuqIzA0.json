[
  {
    "start": "0",
    "end": "46000"
  },
  {
    "text": " The following content is\nprovided under a Creative Commons license. Your support will help\nMIT OpenCourseWare",
    "start": "0",
    "end": "6880"
  },
  {
    "text": "continue to offer high quality\neducational resources for free. To make a donation or to\nview additional materials",
    "start": "6880",
    "end": "13540"
  },
  {
    "text": "from hundreds of MIT courses,\nvisit MIT OpenCourseWare at ocw.mit.edu. ",
    "start": "13540",
    "end": "22293"
  },
  {
    "text": "TADGE DRYJA: OK. So today, I'll talk\nabout payment channels and the lightning network.",
    "start": "22293",
    "end": "28000"
  },
  {
    "text": "And I am sorry if I\ngloss over things. I've explained this, like,\na lot in the last two years",
    "start": "28000",
    "end": "33579"
  },
  {
    "text": "because that's, sort\nof, what I work on. So I might skip over\nsomething, and you're like, wait, how did you get there?",
    "start": "33580",
    "end": "39640"
  },
  {
    "text": "So let me know. So I'll have uni-directional\npayment channels, and then lightning channels. And then, multi-hop.",
    "start": "39640",
    "end": "46750"
  },
  {
    "start": "46000",
    "end": "107000"
  },
  {
    "text": "OK, so the idea of\npayment channels. Why do we need to do all\nthis complicated, weird stuff with payment channels?",
    "start": "46750",
    "end": "52880"
  },
  {
    "text": "Well, the problem\nis these networks are really poor in scalability. Right? Every transaction on the\nblockchain, you know,",
    "start": "52880",
    "end": "61100"
  },
  {
    "text": "that whole idea doesn't scale. People say it's O of n squared.",
    "start": "61100",
    "end": "66530"
  },
  {
    "text": "Depends on what you define as\nn and then things like that. So if you double the number\nof nodes, it actually doesn't.",
    "start": "66530",
    "end": "75612"
  },
  {
    "text": "You can say, well, if you\ndouble the number of nodes, each node is going to be\nmaking some transactions. Right?",
    "start": "75612",
    "end": "81090"
  },
  {
    "text": "And then, you're\nlike, OK, yeah, it's n squared if you count the\ntotal number of computations throughout the entire system.",
    "start": "81090",
    "end": "86509"
  },
  {
    "text": "But at the same time,\nit's like, well, you've doubled the number of nodes. So really, it's O of n, right? For any one computer,\nyour amount of computation",
    "start": "86510",
    "end": "94409"
  },
  {
    "text": "you have to do scales with how\nmany other computers there are. So it's a little questionable.",
    "start": "94410",
    "end": "101238"
  },
  {
    "text": "But basically, it\ndoesn't scale well. Right? It doesn't scale\nto what you want. And so I put a little history\nat the first response of anyone",
    "start": "101238",
    "end": "108840"
  },
  {
    "start": "107000",
    "end": "160000"
  },
  {
    "text": "ever referring to Bitcoin. So there was a 2008-- like October, Halloween 2008,\nor maybe after midnight, so",
    "start": "108840",
    "end": "117009"
  },
  {
    "text": "November 1st-- and Satoshi wrote,\nI've been working on a new electronic cash system\nthat's fully peer-to-peer,",
    "start": "117010",
    "end": "122700"
  },
  {
    "text": "with no trusted third party. Then, he has a little blurb. The first reply on this\nmailing list was some guy--",
    "start": "122700",
    "end": "128729"
  },
  {
    "text": "James A. Donald--\nsaying, we very, very much need such\na system, but the way I understand your\nproposal, it does not",
    "start": "128729",
    "end": "134225"
  },
  {
    "text": "seem to scale to\nthe required size. So that was the\nfirst thing anyone's ever said about Bitcoin.",
    "start": "134225",
    "end": "140129"
  },
  {
    "text": "And we're still talking about\nit almost 10 years later. I wonder who James Donald is. Maybe he's got a ton of\nBitcoin now and he mined it.",
    "start": "140130",
    "end": "148650"
  },
  {
    "text": "So it was written\nabout in late 2008. The actual software\nwas released in 2009.",
    "start": "148650",
    "end": "156267"
  },
  {
    "text": "There was a couple emails. No one really looked into\nit much, at the time. OK, so you can start with\na one way payment channel.",
    "start": "156267",
    "end": "164800"
  },
  {
    "start": "160000",
    "end": "265000"
  },
  {
    "text": " I think Satoshi, sort of,\nmentioned these ideas.",
    "start": "164800",
    "end": "171319"
  },
  {
    "text": "Never really\nimplemented anything. And the way he talked about\nit didn't actually work.",
    "start": "171320",
    "end": "176360"
  },
  {
    "text": "Some people in 2012 I\nremember looking at this. I think [INAUDIBLE]\nand Mike Hearn",
    "start": "176360",
    "end": "182540"
  },
  {
    "text": "gave a talk about how you\ncould make payment channels. That didn't quite work either,\nbut the idea made sense.",
    "start": "182540",
    "end": "190568"
  },
  {
    "text": "So the idea is you have\nsome kind of shared balance between two parties. And you can move\ncoins in one direction",
    "start": "190568",
    "end": "197400"
  },
  {
    "text": "without making new\ntransactions on the blockchain. ",
    "start": "197400",
    "end": "212359"
  },
  {
    "text": "So if you look at\na transaction-- you probably have seen this\nkind of thing through homework--",
    "start": "212360",
    "end": "219680"
  },
  {
    "text": "it's got a lock time. And in this case,\nthe lock time is 0. That means this transaction\nis valid at any point.",
    "start": "219680",
    "end": "225760"
  },
  {
    "text": "Above height 0, it's valid. And every block\nis above height 0.",
    "start": "225760",
    "end": "231200"
  },
  {
    "text": "You can also find\ntransactions, let's see,",
    "start": "231200",
    "end": "243810"
  },
  {
    "text": "which has a block time of this. So this looks like a Unix\ntime where you set a time.",
    "start": "243810",
    "end": "251320"
  },
  {
    "text": "This is like a Unix time. So Unix time, if\nyou don't know, it's",
    "start": "251320",
    "end": "256500"
  },
  {
    "text": "seconds since January 1, 1970. That's, sort of, like\nthe first second.",
    "start": "256500",
    "end": "261898"
  },
  {
    "text": "And I don't know. That's probably a\nweek ago or something. So you can have that\nfield in a transaction.",
    "start": "261899",
    "end": "268620"
  },
  {
    "text": "The idea is the transaction\nis only valid after that time or height. It's a little weird.",
    "start": "268620",
    "end": "273720"
  },
  {
    "text": "Below-- what is it-- 500 million, it\ncounts as a height. Above 500 million, it\ncounts as a Unix time,",
    "start": "273720",
    "end": "281280"
  },
  {
    "text": "which ends up working because\nthe Unix times below 500 million are in the 80s. So you know, Bitcoin\ndidn't exist then.",
    "start": "281280",
    "end": "289500"
  },
  {
    "text": "There's no real need to\nhave time locks them. Sorry? AUDIENCE: What about when you\nget that far in block height?",
    "start": "289500",
    "end": "295195"
  },
  {
    "text": "TADGE DRYJA: About what? Sorry. AUDIENCE: Don't\nyou eventually get that far in block\nheight, though? TADGE DRYJA: 500 million? Yeah, couple thousand years.",
    "start": "295195",
    "end": "301620"
  },
  {
    "text": "So yeah. No, there's way more problems\nwith Bitcoin before that. The time field in the\nheader is four bytes.",
    "start": "301620",
    "end": "309060"
  },
  {
    "text": "So if it was\nsigned, it'd be 2038 that it flips over\nand goes negative. But it's unsigned, so\nyou got until 2106.",
    "start": "309060",
    "end": "318170"
  },
  {
    "text": "There's actually a\nhard fork to fix that. So you know, there's\nall sorts of weird, like, wait, what do we do in the\nhundreds of thousands of years?",
    "start": "318170",
    "end": "324979"
  },
  {
    "text": "We have to make these little\ntweaks, which, hopefully, wouldn't be super controversial\nbecause it's like, well, it'll stop working unless we\nchange this little thing.",
    "start": "324980",
    "end": "331450"
  },
  {
    "text": " OK. So yeah, you can have\nthese lock times.",
    "start": "331450",
    "end": "336550"
  },
  {
    "text": "And you can use those. So what you can do\nis make a channel. And a channel is really\njust a multisig output.",
    "start": "336550",
    "end": "344199"
  },
  {
    "text": "Multisig, a lot of\ntimes, is used for-- I don't want to say two\nfactor authentication--",
    "start": "344200",
    "end": "349419"
  },
  {
    "text": "but you could have\ntwo of two multisig where your phone needs to sign,\nand your desktop needs to sign.",
    "start": "349420",
    "end": "354737"
  },
  {
    "text": "And then, if someone\nsteals your phone or you know hacks your\nphone and gets the key out, well, they have to\nalso get your computer.",
    "start": "354737",
    "end": "362380"
  },
  {
    "text": "So this is useful. But in these cases, it's,\nsort of, adversarial multisig",
    "start": "362380",
    "end": "368890"
  },
  {
    "text": "where it's not just you and you. It's not like your\nphone and your computer. OK, it's Alice and Bob.",
    "start": "368890",
    "end": "374530"
  },
  {
    "text": "They're completely\nseparate people. They're not necessarily friends. You know, it could be a\ncustomer merchant kind of thing.",
    "start": "374530",
    "end": "381490"
  },
  {
    "text": "And they create a\ntransaction together. So they fund it. And Alice is funding\nthis channel.",
    "start": "381490",
    "end": "386530"
  },
  {
    "text": "And so she takes her own\ncoins, her own txid:index, her own output, signs it,\nand sends to an Alice and Bob",
    "start": "386530",
    "end": "394120"
  },
  {
    "text": "multisig and sends 10 coins. So in order to spend this,\nthey both have to cooperate.",
    "start": "394120",
    "end": "403139"
  },
  {
    "text": "But before doing this, Bob\ngives her a refund transaction.",
    "start": "403140",
    "end": "408880"
  },
  {
    "text": "So the idea is, if Alice just\nbroadcasts this and says, OK, I'm taking my coins\nand I'm sending it",
    "start": "408880",
    "end": "415090"
  },
  {
    "text": "to Alice and Bob multisig,\nBob can just disappear. And then, Alice is stuck. And the money's\nstuck there forever",
    "start": "415090",
    "end": "420958"
  },
  {
    "text": "because Bob can never sign. Or Bob can say, oh, Alice,\nlooks like you sent 10 coins.",
    "start": "420958",
    "end": "426970"
  },
  {
    "text": "How about this. I'll give you nine of them. You just give me one of them. You're not buying anything. This is just I'm holding\nyour coins hostage.",
    "start": "426970",
    "end": "435040"
  },
  {
    "text": "Bob could even make a even\nbetter threat and say, I will sign a bunch of\ntime lock transactions.",
    "start": "435040",
    "end": "442770"
  },
  {
    "text": "If you want your money\ntoday, you only get one coin. If you want your money in a\nweek, you'll get two coins. And you know, sign these\nthings with lock times.",
    "start": "442770",
    "end": "450690"
  },
  {
    "text": "Hand all the transactions\nover to Alice and say, well, you can pick. How long do you want to\nwait to get your money back?",
    "start": "450690",
    "end": "457250"
  },
  {
    "text": "And then, Alice's only\nresponse is, oh shoot, well, if I wait years, maybe I'll\nget most of my coins back.",
    "start": "457250",
    "end": "462540"
  },
  {
    "text": "But if I want my\nmoney now-- you know, there's all sorts of\nhorrible hostage situations, even if they both\nhave money at stake.",
    "start": "462540",
    "end": "470460"
  },
  {
    "text": "One person could have\nless time value of money. So they're like, look, I\ndon't need this anytime soon.",
    "start": "470460",
    "end": "475800"
  },
  {
    "text": "So I'm willing to wait. So this is dangerous. So what they do\nbeforehand is Alice says,",
    "start": "475800",
    "end": "481170"
  },
  {
    "text": "hey Bob, give me a\nrefund transaction. So Bob signs a\nrefund transaction",
    "start": "481170",
    "end": "486450"
  },
  {
    "text": "with a lock time of one\nweek from now, March 28. And the input is the\nfund transaction ID.",
    "start": "486450",
    "end": "493380"
  },
  {
    "text": "Even though the fund transaction\ncomes later, thanks to segwit, you can say I know what\nthe Tx ID's gonna be.",
    "start": "493380",
    "end": "500310"
  },
  {
    "text": "I'm gonna reference\na spin for that. And Bob's signature is\ngoing to be on there.",
    "start": "500310",
    "end": "505319"
  },
  {
    "text": "Bob signs it. Hands it over to Alice. Alice's signature\nis not there yet. So Alice can sign it and\nstore it on her drive,",
    "start": "505320",
    "end": "513339"
  },
  {
    "text": "or she can sign later. But until March 28th, this\ntransaction is not happening.",
    "start": "513340",
    "end": "519789"
  },
  {
    "text": "If you try to broadcast it,\neveryone will reject it. In the output from this\nrefund transaction,",
    "start": "519789",
    "end": "525470"
  },
  {
    "text": "it just sends to Alice's\naddress, all 10 coins. Yes? AUDIENCE: How do they\nknow the transaction in the future, the\ntransaction ID in the future?",
    "start": "525470",
    "end": "534808"
  },
  {
    "text": "TADGE DRYJA: Oh, how do\nthey know the funds Tx ID? Alice can calculate\nit and tell Bob.",
    "start": "534808",
    "end": "540190"
  },
  {
    "text": "Alice can say I'm building\na fund transaction. Alice knows her inputs. She doesn't actually\nhave to sign it all",
    "start": "540190",
    "end": "546490"
  },
  {
    "text": "because the Tx ID won't\ncontain the signature and what their key is.",
    "start": "546490",
    "end": "552550"
  },
  {
    "text": "So Alice can compute the Tx ID\nand tell Bob, hey, sign this.",
    "start": "552550",
    "end": "558196"
  },
  {
    "text": "You know, this is\nwhat the transaction is going to look like. Sign it. And Bob, at this\npoint, has no risk.",
    "start": "558197",
    "end": "565180"
  },
  {
    "text": "Bob, I guess, needs to make\nsure that he's not inadvertently signing his own money.",
    "start": "565180",
    "end": "570580"
  },
  {
    "text": "So if Alice says,\nhey, here's the Tx ID, Bob should make sure,\nOK, this is not my Tx ID. Right?",
    "start": "570580",
    "end": "576700"
  },
  {
    "text": "But it actually doesn't matter\nsince he, sort of, commits",
    "start": "576700",
    "end": "583410"
  },
  {
    "text": "to Alice's pub key here. So even if you've swapped\nthe Tx ID, when you sign,",
    "start": "583410",
    "end": "589759"
  },
  {
    "text": "you say this is two\nof two multisig. So if this was Bob's\nsingle key, it wouldn't it wouldn't even work.",
    "start": "589760",
    "end": "596720"
  },
  {
    "text": "Yeah, so Alice has to give\nsome information to Bob. Bob signs, hands the\nrefund over to Alice, then Alice is able to create\nthis fund transaction.",
    "start": "596720",
    "end": "604490"
  },
  {
    "text": "And now Alice's risk is\nminimized because she says, OK, I'll send this to this\nchannel and, worst case,",
    "start": "604490",
    "end": "611972"
  },
  {
    "text": "I have to wait a week. Right? If Bob disappears as\nsoon as I broadcast this, well, then Bob's gone.",
    "start": "611973",
    "end": "617449"
  },
  {
    "text": "I can't do anything. We can't sign. But then, next week, I'll be\nable to use this transaction",
    "start": "617450",
    "end": "623330"
  },
  {
    "text": "and get all my money back. Yes? AUDIENCE: You said\nthat if this refund transaction is broadcasted, all\nthe notes will be discarded.",
    "start": "623330",
    "end": "632260"
  },
  {
    "text": "TADGE DRYJA: Yes. AUDIENCE: But then-- TADGE DRYJA: This week. AUDIENCE: --it has to\nbe sent before Alice",
    "start": "632260",
    "end": "639010"
  },
  {
    "text": "sends out the other\ntransaction, right? Because what makes\nsure that Alice",
    "start": "639010",
    "end": "644509"
  },
  {
    "text": "will have this transaction\nup there in the systems before the other transaction,\nbefore they're bought?",
    "start": "644510",
    "end": "650745"
  },
  {
    "text": "TADGE DRYJA: Which transaction? So there's the fund\nand the refund. Right? AUDIENCE: Right. So the refund must be\nsent before the fund.",
    "start": "650745",
    "end": "657445"
  },
  {
    "text": "TADGE DRYJA: No, it needs to\nbe created before the fund. Right? So it's not going to\nbe on the network.",
    "start": "657445",
    "end": "663170"
  },
  {
    "text": "But Bob creates this\nfirst, signs it, and gives it to Alice. That way Alice knows,\nwell, I have this",
    "start": "663170",
    "end": "669890"
  },
  {
    "text": "that will be valid in a week. And so that means it's safe\nto sign and broadcast this.",
    "start": "669890",
    "end": "675110"
  },
  {
    "text": "Yeah. AUDIENCE: And the\nrefund just requires Alice's initial signature. TADGE DRYJA: Yeah. AUDIENCE: They're [INAUDIBLE]. OK.",
    "start": "675110",
    "end": "680680"
  },
  {
    "text": "TADGE DRYJA: Yeah. So the refund transaction,\nit's got Bob's signature. And that's what\nhand you hand over. And then, Alice can sign later.",
    "start": "680680",
    "end": "687860"
  },
  {
    "text": "She can sign it immediately on\nreception and then store it. Or she can sign\nit on March 28th.",
    "start": "687860",
    "end": "694545"
  },
  {
    "text": "But the idea is she's got\nBob's signature endorsing this. And it's not valid yet, but\nshe knows minimize risk.",
    "start": "694545",
    "end": "699769"
  },
  {
    "text": "Right? Worst case, wait a week. OK, so then what can\nyou do with this?",
    "start": "699770",
    "end": "705740"
  },
  {
    "text": "You can make, sort of, similar\nto refund transactions, but they give Bob more money.",
    "start": "705740",
    "end": "712389"
  },
  {
    "text": "So you make two outputs. You say, OK, I'm spending\nthe fund transaction ID. I put Alice's signature.",
    "start": "712390",
    "end": "718940"
  },
  {
    "text": "And I say Alice gets nine coins. Bob gets one coin. And Alice hands\nthat over to Bob.",
    "start": "718940",
    "end": "724438"
  },
  {
    "start": "724000",
    "end": "941000"
  },
  {
    "text": "So you make a transaction\nlike that, right. It spends the fund\ntransaction output. Alice and Bob's key\nare both needed.",
    "start": "724438",
    "end": "730910"
  },
  {
    "text": "And Alice signs this and\nsays, OK, I get nine. You get one. Hands it over to Bob.",
    "start": "730910",
    "end": "736320"
  },
  {
    "text": "And Bob says, basically,\nI just got the money. I can broadcast this if I want.",
    "start": "736320",
    "end": "742430"
  },
  {
    "text": "Right? Bob's got Alice's signature. Bob can add his signature. Broadcast this transaction,\nand receive one Bitcoin.",
    "start": "742430",
    "end": "749449"
  },
  {
    "text": "OK, but see, Bob doesn't\nsign his side in broadcast. Bob just waits. Bob's like, cool,\nI've got this coin.",
    "start": "749450",
    "end": "755959"
  },
  {
    "text": "I'm not even going to\nsign and broadcast this. I know it's as good\nas having received the actual coin because\nthere's nothing else Alice",
    "start": "755960",
    "end": "764210"
  },
  {
    "text": "can do on her own. She can't take these 10 coins. She can, eventually, get\nthe refund in a week. But for now, Bob's safe.",
    "start": "764210",
    "end": "771980"
  },
  {
    "text": "And then, maybe a\nday later Alice says, OK, I'm giving you another coin.",
    "start": "771980",
    "end": "777800"
  },
  {
    "text": "What I'm doing is I'm\nsigning a new transaction. It spends the same output.",
    "start": "777800",
    "end": "782839"
  },
  {
    "text": "This is still there. These have not been broadcast. But in this one, Alice\ngets eight coins.",
    "start": "782840",
    "end": "788240"
  },
  {
    "text": "Bob gets two coins. Alice signs it. Hands that over to Bob. Bob's like, great,\nI got another coin.",
    "start": "788240",
    "end": "794390"
  },
  {
    "text": "I will also just wait. Bob can actually delete this\nbecause, well, this is better.",
    "start": "794390",
    "end": "801040"
  },
  {
    "text": "Right? From Bob's perspective, I'd\nrather have two than one.",
    "start": "801040",
    "end": "806060"
  },
  {
    "text": "And any of them are valid. According to the network,\nthe network itself,",
    "start": "806060",
    "end": "811070"
  },
  {
    "text": "no one's seen these things. They're not broadcast. Only this exists as an output.",
    "start": "811070",
    "end": "816690"
  },
  {
    "text": "And you can keep doing this. You can keep doing this\nas many times as you want. Well, within limits, right?",
    "start": "816690",
    "end": "822320"
  },
  {
    "text": "What's the obvious limit here? AUDIENCE: 10 BTC\nwhen Alice bought it. TADGE DRYJA: Yeah. Sure. Once Bob gets all 10, there's no\nreason to keep it open anymore.",
    "start": "822320",
    "end": "831830"
  },
  {
    "text": "Also, you can't reverse. Right? ",
    "start": "831830",
    "end": "837350"
  },
  {
    "text": "So Alice is always\nsending money. If Bob says, hey, I'm going\nto give you some money back, and Bob signs something and\nsay, hey, now I have two coins",
    "start": "837350",
    "end": "844310"
  },
  {
    "text": "and you have eight coins. Alice is like, yeah,\nbut you have this. Right? You have this Alice\n7 Bob 3 transaction.",
    "start": "844310",
    "end": "852790"
  },
  {
    "text": "I know you can broadcast\nthat whenever you want. So there's no\ncredible way for Bob to say like, oh, I'm giving you\nthe money back in this channel.",
    "start": "852790",
    "end": "860090"
  },
  {
    "text": "Right? Yes? AUDIENCE: But what if the\nnext transaction Alice signs--",
    "start": "860090",
    "end": "866850"
  },
  {
    "text": "so she gave 1, 2, and 3. And the next one, she gives\nBob 2.5 and keeps 7.5.",
    "start": "866850",
    "end": "874774"
  },
  {
    "text": "Is that right? TADGE DRYJA: Yeah, Bob\nwould just ignore it. Bob would be like, yeah,\nbut I already have three.",
    "start": "874775",
    "end": "882440"
  },
  {
    "text": "Why would I want 2 1/2?  And it's more\nlike, in that case,",
    "start": "882440",
    "end": "888315"
  },
  {
    "text": "if Alice says, oh,\nI have two, Alice is trying to take some money back. Essentially, Bob is paying\nAlice, in that case.",
    "start": "888315",
    "end": "893450"
  },
  {
    "text": "But it's not credible. Alice is like, yeah,\nI can sign this again. Or I have all 10 again.",
    "start": "893450",
    "end": "899750"
  },
  {
    "text": "But you know, Bob's\nidea is like, I'm just going to sign the one\nwhere I get the most money.",
    "start": "899750",
    "end": "905500"
  },
  {
    "text": "So you know, that's\na limitation. It's one direction. Alice can keep paying Bob.",
    "start": "905500",
    "end": "910800"
  },
  {
    "text": "Bob can't pay back. But that's still pretty\nuseful, in some cases. If you have some kind\nof recurrent payment,",
    "start": "910800",
    "end": "917600"
  },
  {
    "text": "you're streaming\nvideos or something. You open a channel,\nyou can keep paying. One thing that's nice is\nthese can be really fast.",
    "start": "917600",
    "end": "924440"
  },
  {
    "text": "So this, you have\nto actually wait till it's in the blockchain. But these transactions,\nthere's no blockchain involved.",
    "start": "924440",
    "end": "930170"
  },
  {
    "text": "You just sign it, and hand\nit over to the other party. And as soon as they've\nreceived it, they're like, yep, I got the money.",
    "start": "930170",
    "end": "936079"
  },
  {
    "text": "So this can be very low latency. So this is pretty cool. There are limitations.",
    "start": "936080",
    "end": "942030"
  },
  {
    "start": "941000",
    "end": "1176000"
  },
  {
    "text": "So, yeah. Bob keeps getting these\nhalf signed transactions with more and more\nmoney going to him.",
    "start": "942030",
    "end": "947120"
  },
  {
    "text": "The old ones are useless. Why would I keep\nthis old transaction where I got one coin? Just delete it.",
    "start": "947120",
    "end": "952339"
  },
  {
    "text": "So Bob only actually\nhas to store one thing. Bob also has to be\nvery careful, though. He's got to sign and broadcast\none of these before next week.",
    "start": "952340",
    "end": "961250"
  },
  {
    "text": "If he doesn't, Alice could\njust broadcast the refund transaction. And you know, he thinks\nhe's getting three coins,",
    "start": "961250",
    "end": "967125"
  },
  {
    "text": "but Alice is like, no, I'm\njust taking all 10 back. And Bob was like, shoot,\nI just got ripped off.",
    "start": "967125",
    "end": "972920"
  },
  {
    "text": "So from the Bitcoin\nnetwork's point of view, no one's seen any of this.",
    "start": "972920",
    "end": "978500"
  },
  {
    "text": "All they see is the\nfund transaction. Nothing happens for days. And then, they see\none of these payment",
    "start": "978500",
    "end": "984920"
  },
  {
    "text": "channel closing transactions. And they might see multiple. Right? Bob could broadcast all three.",
    "start": "984920",
    "end": "990644"
  },
  {
    "text": "It would be dumb. Bob only wants this one. But you're, basically,\nusing double spends",
    "start": "990645",
    "end": "996080"
  },
  {
    "text": "to create these channels.  yes?",
    "start": "996080",
    "end": "1001300"
  },
  {
    "text": "AUDIENCE: So the\nrefund transaction is pretty much insurance,\nright, for Alice? TADGE DRYJA: Yeah.",
    "start": "1001300",
    "end": "1006780"
  },
  {
    "text": "If it happens, that means either\nBob went down or Bob never--",
    "start": "1006780",
    "end": "1013750"
  },
  {
    "text": "you should never\nuse it in real life. It's insurance so\nthat you're not",
    "start": "1013750",
    "end": "1019290"
  },
  {
    "text": "worried that Bob's just\ngoing to run off and get your funds stuck. AUDIENCE: So in the case\nthat, both, Allison and Bob",
    "start": "1019290",
    "end": "1024310"
  },
  {
    "text": "are honest actors, I\nguess, in this situation,",
    "start": "1024310",
    "end": "1029630"
  },
  {
    "text": "if a week does go by, there's\nno reason for Alice to actually use that refund\ntransaction, right?",
    "start": "1029630",
    "end": "1038050"
  },
  {
    "text": "There's no guarantee that she's\ngoing to use it in a week. TADGE DRYJA: Right. But you can't keep\nusing the cha--",
    "start": "1038050",
    "end": "1043289"
  },
  {
    "text": "like, at that point, there's\nso much trust involved. If you keep trying to use the\nchannel after the weeks gone",
    "start": "1043290",
    "end": "1049559"
  },
  {
    "text": "by, Bob now-- like, it's the same reason you\ncan't make it bidirectional. Right?",
    "start": "1049560",
    "end": "1054690"
  },
  {
    "text": "If Bob says, hey, here's\na transaction where you get more of the money,\nAlice is like, yeah, but that's not\ncredible because I",
    "start": "1054690",
    "end": "1060929"
  },
  {
    "text": "know you can broadcast\nand take more. And similarly, if\nAlice says, let's just keep the channel\nopen, Bob's like,",
    "start": "1060930",
    "end": "1066690"
  },
  {
    "text": "no, that's not credible. I know you can just take\nall the money at any time. So you handing me\nthese new signatures,",
    "start": "1066690",
    "end": "1072929"
  },
  {
    "text": "like, it's, sort\nof, meaningless. There's so much trust\ninvolved that like, why bother with this whole\npayment channel thing, right?",
    "start": "1072930",
    "end": "1080790"
  },
  {
    "text": "So this is nice in\nthat you don't have to trust the counter parties. The worst they can\ndo is disappear.",
    "start": "1080790",
    "end": "1089355"
  },
  {
    "text": "I mean, yeah, they\ncan hurt themselves. Right? Bob can broadcast this\nafter this exists.",
    "start": "1089355",
    "end": "1094458"
  },
  {
    "text": "And Alice is like,\nOK, that was dumb. Thanks for the two coins back. Or Bob can just disappear.",
    "start": "1094458",
    "end": "1099690"
  },
  {
    "text": "And Alice is like, hey,\nI'm going to do the refund. You're supposed to get these\nthree coins, but you're gone.",
    "start": "1099690",
    "end": "1105720"
  },
  {
    "text": "And the refund is my only\noption, so I'm broadcasting it.",
    "start": "1105720",
    "end": "1111343"
  },
  {
    "text": "So you don't have to worry\nabout who is your counterparty. And you don't have any debt. There's no custody or\nanything like that.",
    "start": "1111343",
    "end": "1117760"
  },
  {
    "text": "So that's really nice. You can add trust,\nbut we already have that with Coinbase\nand Gemini-- you know,",
    "start": "1117760",
    "end": "1124400"
  },
  {
    "text": "the exchanges. OK, so this is pretty useful. ",
    "start": "1124400",
    "end": "1130130"
  },
  {
    "text": "Time limits. Limits on back and forth. Refund transactions have\nto be built before the fund",
    "start": "1130130",
    "end": "1137510"
  },
  {
    "text": "transaction, and so\nmalleability hurts that. Before segwit, this\nwas very risky,",
    "start": "1137510",
    "end": "1143610"
  },
  {
    "text": "slash you couldn't really do it. The refund transaction has to\nspend the fund transaction.",
    "start": "1143610",
    "end": "1149540"
  },
  {
    "text": "And without segwit,\nyou don't know what that transaction\nID is going to be before it gets confirmed.",
    "start": "1149540",
    "end": "1157320"
  },
  {
    "text": "And so you can try to\nanticipate, oh, well it might get malleated to\nthese five different things.",
    "start": "1157320",
    "end": "1162590"
  },
  {
    "text": "Let's do it.  But it's risky.",
    "start": "1162590",
    "end": "1167620"
  },
  {
    "text": "So with segit, it's nice. You don't have to\nworry about it. OK, so any questions about the\nsimple, one direction payments?",
    "start": "1167620",
    "end": "1173780"
  },
  {
    "text": " Makes sense? OK. So how can you make\nit even better?",
    "start": "1173780",
    "end": "1181160"
  },
  {
    "start": "1176000",
    "end": "1281000"
  },
  {
    "text": "What if you want to make it\nbidirectional and last forever? That would be much more useful. Right?",
    "start": "1181160",
    "end": "1186310"
  },
  {
    "text": "But it's a tricky problem. The refund transaction is\nthere, and the clock's ticking.",
    "start": "1186310",
    "end": "1191710"
  },
  {
    "text": "Also, how do you delete or\nrevoke these old transaction? if you've signed over, OK,\nyou've got eight coins.",
    "start": "1191710",
    "end": "1197800"
  },
  {
    "text": "I've got two coins. That's there forever. And the blockchain doesn't know\nthat it's not valid anymore.",
    "start": "1197800",
    "end": "1205080"
  },
  {
    "text": "Right? The whole point\nof the blockchain is to say, OK, this is gone. Actually, between the\nunidirectional and lightening,",
    "start": "1205080",
    "end": "1213740"
  },
  {
    "text": "I think-- how did the order go? Like, Christian\nDecker wrote a thing about decrementing time locks.",
    "start": "1213740",
    "end": "1220600"
  },
  {
    "text": "And I don't think he published. I think he published\nafter we wrote lightning. But the idea was these\nwould have lock times.",
    "start": "1220600",
    "end": "1227830"
  },
  {
    "text": "It's like, you could\nbroadcast this on the 27th.",
    "start": "1227830",
    "end": "1234419"
  },
  {
    "text": "All three of these could\nbe broadcast on the 27th. And then, the idea is Bob\nwants to send money back. And you put a lock\ntime on the 26th.",
    "start": "1234420",
    "end": "1242020"
  },
  {
    "text": "And the idea is like, oh,\nnow these all are 27th. But now there's a Bob 2\nAlice 8 over here that's",
    "start": "1242020",
    "end": "1249650"
  },
  {
    "text": "the broadcastable on the 26th. And so the idea is, well,\nAlice can get the money back.",
    "start": "1249650",
    "end": "1255330"
  },
  {
    "text": "Bob can go back to paying\nAlice because it's sooner, and Alice can raise. So that helps a little in that\nyou can switch back and forth",
    "start": "1255330",
    "end": "1262139"
  },
  {
    "text": "a few times. But each time you do it,\nthe time window gets sooner.",
    "start": "1262140",
    "end": "1267850"
  },
  {
    "text": "So that's, kind of, a cool idea. But I think the lightening one\nis nicer because it makes it-- OK, the goal is back and forth\nbetween these two parties.",
    "start": "1267850",
    "end": "1276355"
  },
  {
    "text": "And it lasts forever. And you can do as many\ntransactions as you want. OK. So how do you do that? So there's two\ntiming up quotes that",
    "start": "1276355",
    "end": "1284090"
  },
  {
    "start": "1281000",
    "end": "1344000"
  },
  {
    "text": "have been added to Bitcoin. And CHECKSEQUENCEVERIFY is\npretty much for lightning,",
    "start": "1284090",
    "end": "1289160"
  },
  {
    "text": "in my opinion. That's the real use case. There's also\nCHECKLOCKTIMEVERIFY.",
    "start": "1289160",
    "end": "1294960"
  },
  {
    "text": "So the idea of SEQUENCEVERIFY\nis it's a relative lock time. So it doesn't specify,\nOK, this transaction",
    "start": "1294960",
    "end": "1301710"
  },
  {
    "text": "is valid on March 28th. It says, this\ntransaction is valid when the input it's\nspending is a week old.",
    "start": "1301710",
    "end": "1309390"
  },
  {
    "text": "And by a week old, it's in\na week's worth of blocks. In the actual software,\nwe don't usually use time.",
    "start": "1309390",
    "end": "1315900"
  },
  {
    "text": "We always use block height. It's simpler to think\nabout, in a lot of ways.",
    "start": "1315900",
    "end": "1321150"
  },
  {
    "text": "But you can say, OK, well\nI send to an output script.",
    "start": "1321150",
    "end": "1326670"
  },
  {
    "text": "And the output script\nspecifies that you can only spend these coins after\nthe transaction creating",
    "start": "1326670",
    "end": "1333059"
  },
  {
    "text": "them has been 100 blocks deep. So that's, kind of, an\ninteresting, useful thing.",
    "start": "1333060",
    "end": "1341520"
  },
  {
    "text": "Yeah, and confirmations. If not, you can't spend it. OP_CHECKLOCKTIMEVERIFY.",
    "start": "1341520",
    "end": "1346760"
  },
  {
    "start": "1344000",
    "end": "1561000"
  },
  {
    "text": "It's a lot absolute\nlock time opcode. So you require that\nthe transaction be",
    "start": "1346760",
    "end": "1352130"
  },
  {
    "text": "confirmed at high end or above.",
    "start": "1352130",
    "end": "1357320"
  },
  {
    "text": "So what we said in the refund\ntransaction, the refund transaction, the transaction\nfield has a lock time.",
    "start": "1357320",
    "end": "1365790"
  },
  {
    "text": " Where is it?",
    "start": "1365790",
    "end": "1371130"
  },
  {
    "text": "Oh, well, in this case, yeah. But the transaction\nitself has a locktime. But that's difference\nfrom the opcode.",
    "start": "1371130",
    "end": "1378100"
  },
  {
    "text": "What the opcode does,\nit says, OK, this output has a locktime\nbecause the output script ensures that\nthe transaction itself",
    "start": "1378100",
    "end": "1386380"
  },
  {
    "text": "has a locktime. So basically, you say\nOP_CHECKLOCKTIMEVERIFY 500,000.",
    "start": "1386380",
    "end": "1393910"
  },
  {
    "text": "And then, it checks that the\ntransactions locktime field is exactly equal to 500,000.",
    "start": "1393910",
    "end": "1403570"
  },
  {
    "text": "So it's a way to enforce\na transaction wide field inside of an output. It's a little weird.",
    "start": "1403570",
    "end": "1409899"
  },
  {
    "text": "But both of these become opcodes\nthat you can use in scripts. And now, you can specify,\nlike, make an address that has",
    "start": "1409900",
    "end": "1416680"
  },
  {
    "text": "these weird timing properties. OK. Any questions about these two? AUDIENCE: Can you\nuse both of them? TADGE DRYJA: Yep.",
    "start": "1416680",
    "end": "1422360"
  },
  {
    "text": "You can mix them and match them.  CHECKSEQUENCEVERIFY is\nspecific to an input.",
    "start": "1422360",
    "end": "1429220"
  },
  {
    "text": "So there's a sequence field in\neach input that was completely useless until like--",
    "start": "1429220",
    "end": "1434825"
  },
  {
    "text": "AUDIENCE: This or-- TADGE DRYJA: What? AUDIENCE: Like, this or that. TADGE DRYJA: Well, OK, so if\nyou look, there's a sequence.",
    "start": "1434825",
    "end": "1442440"
  },
  {
    "text": "And it was always just FFFFF. You know, that's like 2\nto the 32 or whatever.",
    "start": "1442440",
    "end": "1447800"
  },
  {
    "text": "2 to 32 minus 1, I think. And it didn't do anything. Satoshi put it in because\nhe thought, OK, this",
    "start": "1447800",
    "end": "1454650"
  },
  {
    "text": "will let you indicate finality\nwhere you can increment the sequence number. So you say, OK,\nthis is sequence 1.",
    "start": "1454650",
    "end": "1461279"
  },
  {
    "text": "And then, I can replace\nit with sequence 2. And it didn't work\nbecause you can't have consensus on those things.",
    "start": "1461280",
    "end": "1467110"
  },
  {
    "text": "So this was a field that was,\nsort of, unused in the inputs. And what they did is\nthey said, OK, we'll",
    "start": "1467110",
    "end": "1473820"
  },
  {
    "text": "make that a sequence number\nwhere if you now make this, say-- ",
    "start": "1473820",
    "end": "1481062"
  },
  {
    "text": "how did it work-- you make the sequence\nnumber 100, for example.",
    "start": "1481062",
    "end": "1486710"
  },
  {
    "text": "And then, in your\ntransaction, it will say, OK, this transaction output\nthat you're spending,",
    "start": "1486710",
    "end": "1495590"
  },
  {
    "text": "is it 100 blocks old? And if so, we're good. If not, this input\nspending fails.",
    "start": "1495590",
    "end": "1501560"
  },
  {
    "text": "So it's another check in\naddition to the signature. And then, you can also ensure\nthat, with CHECKSEQUENCEVERIFY,",
    "start": "1501560",
    "end": "1509840"
  },
  {
    "text": "you can put in the opcodes. You can put in the script. OK, this must have\na sequence of 100.",
    "start": "1509840",
    "end": "1516200"
  },
  {
    "text": "And then, check that sequence\nis equal or greater to the depth of the transaction.",
    "start": "1516200",
    "end": "1522442"
  },
  {
    "text": "And yeah, you can mix them and\nmatch them in the same script. It's a little ugly\nto use because it",
    "start": "1522442",
    "end": "1528430"
  },
  {
    "text": "was introduced as a soft work. And they rename and op and op.",
    "start": "1528430",
    "end": "1535710"
  },
  {
    "text": "A no op opcode got\nrenamed to this. This is, like, no op 3. 6 And so you have\nto push the number",
    "start": "1535710",
    "end": "1543780"
  },
  {
    "text": "you're checking on the stack,\nOP_CHECKSEQUENCEVERIFY. And then, you have to drop\nthe number off the stack",
    "start": "1543780",
    "end": "1549060"
  },
  {
    "text": "because this opcode doesn't\nactually consume anything off the top of the stack so\nthat it looks the same as a no up to nodes that\ndon't know about it.",
    "start": "1549060",
    "end": "1556780"
  },
  {
    "text": "Anyway. So you've got these two ways\nto specify output timing.",
    "start": "1556780",
    "end": "1562010"
  },
  {
    "start": "1561000",
    "end": "1969000"
  },
  {
    "text": "OK. Questions there? Good. So then, what you can do is\nyou can revoke based on timing.",
    "start": "1562010",
    "end": "1568050"
  },
  {
    "text": "So the idea of the script-- and this is, sort of,\nin C like notation, not the actual\nopcodes for Bitcoin",
    "start": "1568050",
    "end": "1574160"
  },
  {
    "text": "because the actual opcodes\nare, kind of, confusing-- the idea is, OK, you can\nspend with 2 of 2 multisig,",
    "start": "1574160",
    "end": "1581480"
  },
  {
    "text": "essentially, right? keyA and keyB, or keyC,\nand wait 100 blocks.",
    "start": "1581480",
    "end": "1589250"
  },
  {
    "text": "And by wait 100 blocks, it means\nthat whatever you're spending has to be confirmed\n100 blocks ago or more.",
    "start": "1589250",
    "end": "1595700"
  },
  {
    "text": "So A and B together, they\ncan spend any time they want. Together? Oops.",
    "start": "1595700",
    "end": "1602210"
  },
  {
    "text": "C can spend, but must wait. And A and B can grab\ntheir coins first.",
    "start": "1602210",
    "end": "1607530"
  },
  {
    "text": " So this is a\nrevokable transaction.",
    "start": "1607530",
    "end": "1612770"
  },
  {
    "text": "So the idea is you've got some-- and we call it a commitment\ntransaction in the lightning paper.",
    "start": "1612770",
    "end": "1617780"
  },
  {
    "text": "You've got some input. The funding transaction output. You're spending that. You need 2 of 2 multisig.",
    "start": "1617780",
    "end": "1623409"
  },
  {
    "text": "So like, Bob's signs and\nsends it over to Alice. And then, you've got\nthat script where",
    "start": "1623410",
    "end": "1628940"
  },
  {
    "text": "it's, OK, it's Alice's key,\nand you wait 100 blocks. Or Alice's key and you\nmake a new key for Bob.",
    "start": "1628940",
    "end": "1634020"
  },
  {
    "text": "Like, the Bob revoke key. And this has 2 coins. This has 8 coins.",
    "start": "1634020",
    "end": "1639789"
  },
  {
    "text": " Oh. Oops.",
    "start": "1639790",
    "end": "1645280"
  },
  {
    "text": "This should be our-- hold on. I should change that. That's, kind of, going\nto be really confusing. Wait.",
    "start": "1645280",
    "end": "1650400"
  },
  {
    "text": "I put the r in the wrong place. Let me redo this.",
    "start": "1650400",
    "end": "1656210"
  },
  {
    "text": "That's a typo, but\nit's super confusing. ",
    "start": "1656210",
    "end": "1662630"
  },
  {
    "text": "Yeah, that is opposite. Wait. AliceR and Bob.",
    "start": "1662630",
    "end": "1668480"
  },
  {
    "text": " Alice and Bob are-- wait.",
    "start": "1668480",
    "end": "1673847"
  },
  {
    "text": "So I put the same thing on both. Right? Alice and Bob are--",
    "start": "1673847",
    "end": "1679050"
  },
  {
    "text": "this one is AliceR and Bob. Yeah, and when you're\nactually coding this stuff,",
    "start": "1679050",
    "end": "1688289"
  },
  {
    "text": "it's pretty easy to screw up. There's a lot of like, wait,\nwho is Alice and who is Bob? So in any of the code, I\ndon't use Alice and Bob.",
    "start": "1688290",
    "end": "1694282"
  },
  {
    "text": "I use mine and theirs. But a lot of times,\nit's not clear",
    "start": "1694282",
    "end": "1699500"
  },
  {
    "text": "because it's held by Alice. So this is the transaction\nthat Bob creates, Bob's signs,",
    "start": "1699500",
    "end": "1706000"
  },
  {
    "text": "transfers to Alice, and then\nit sits on Alice's hard drive. Yes? AUDIENCE: AliceR? TADGE DRYJA: OK, so you\nmake these separate keys.",
    "start": "1706000",
    "end": "1715070"
  },
  {
    "text": "Right? It's a key that Alice creates. Alice creates\nanother pub key pair,",
    "start": "1715070",
    "end": "1721160"
  },
  {
    "text": "and tells the pub key to Bob. And this is her revocable key.",
    "start": "1721160",
    "end": "1727087"
  },
  {
    "text": "AUDIENCE: The revocation. TADGE DRYJA: Yeah,\nwhere Alice can then-- basically, what\nAlice does is Alice gives the private\nkey to Bob in order",
    "start": "1727088",
    "end": "1734560"
  },
  {
    "text": "to revoke this transaction. So they're, sort\nof, mirror images.",
    "start": "1734560",
    "end": "1740470"
  },
  {
    "text": "In both cases, both\nparties agree, look, Alice has got 2 coins. Bob's got 8 coins.",
    "start": "1740470",
    "end": "1745710"
  },
  {
    "text": "Right? But the transaction that\nBob creates and signs--",
    "start": "1745710",
    "end": "1751420"
  },
  {
    "text": " yes, the transaction that\nBob creates and signs",
    "start": "1751420",
    "end": "1756860"
  },
  {
    "text": "sends Bob 8 coins in the clear. This is just a regular\nold pay to pub key hash",
    "start": "1756860",
    "end": "1761870"
  },
  {
    "text": "where Bob gets 8 coins. The coins that are\nAlice's though, Alice",
    "start": "1761870",
    "end": "1767030"
  },
  {
    "text": "has to wait 100 blocks. If she broadcasts this\ncommitment transaction, she can't spend her\nmoney for a day.",
    "start": "1767030",
    "end": "1774200"
  },
  {
    "text": "Like, whatever 100 block is. Bob can get the money, but\nonly if he knows Alice's R key,",
    "start": "1774200",
    "end": "1783120"
  },
  {
    "text": "Alice's revocable key. So Alice has this Bob\ndoesn't and in the Bob case",
    "start": "1783120",
    "end": "1793210"
  },
  {
    "text": "it's similar you know\nthe outputs are the same but the ideas\nAlice creates this.",
    "start": "1793210",
    "end": "1798940"
  },
  {
    "text": "Alice signs it. Hands it over to Bob. And in this case,\nthe transaction is, well, Alice gets\n2 coins in the clear.",
    "start": "1798940",
    "end": "1806660"
  },
  {
    "text": "This is immediately spendable. No fancy scripts or anything. Bob gets the money, but\nhe has to wait a day.",
    "start": "1806660",
    "end": "1814179"
  },
  {
    "text": "Or Alice can spend\nthe money if she knows Bob's revokable\nkey is BobR key.",
    "start": "1814180",
    "end": "1821210"
  },
  {
    "text": "So either party,\nat any time, can broadcast these transactions. The thing is, the money\nthey're supposed to get--",
    "start": "1821210",
    "end": "1827780"
  },
  {
    "text": "so in Bob's case, Bob can have\nBob's signature broadcast, but now he has to wait.",
    "start": "1827780",
    "end": "1833330"
  },
  {
    "text": "No big deal. Wait 100 blocks. OK. In Alice's case, OK, she can\nclose it and put her signature",
    "start": "1833330",
    "end": "1840320"
  },
  {
    "text": "on here, broadcast, wait\na day, spend the money. But what's nice is\nyou can revoke it.",
    "start": "1840320",
    "end": "1847410"
  },
  {
    "text": "Right? So Alice can tell Bob\nI'm not going to do this.",
    "start": "1847410",
    "end": "1854750"
  },
  {
    "text": "I'm not going to use\nthis transaction. You know, I deleted it. And Bob's like, yeah,\nsure you deleted it.",
    "start": "1854750",
    "end": "1861680"
  },
  {
    "text": "The way I'll prove to you\nthat I deleted this is I will tell you the private key. I'll tell you AliceR.",
    "start": "1861680",
    "end": "1868010"
  },
  {
    "text": "So now Bob knows because Bob\ncreated this transaction. Right? Bob signed it.",
    "start": "1868010",
    "end": "1873140"
  },
  {
    "text": "Bob knows what it looks like. And Bob knows, well,\nyeah, this is the script. Since Bob knows AliceR and Bob\nknows his own key, Bob knows,",
    "start": "1873140",
    "end": "1881299"
  },
  {
    "text": "look, this money is mine. This money's mine too because\nI can do this immediately.",
    "start": "1881300",
    "end": "1887700"
  },
  {
    "text": "So if you broadcast\nthis transaction, I don't have to even touch\nthis because this was my money. And this output, I\ncan spend immediately",
    "start": "1887700",
    "end": "1895419"
  },
  {
    "text": "while you have to\nwait 100 blocks. And you know, my software is\ngoing to automatically do that.",
    "start": "1895420",
    "end": "1900660"
  },
  {
    "text": "So I know AliceR's private key. I know Bob's private key. I just take these 2 coins.",
    "start": "1900660",
    "end": "1905780"
  },
  {
    "text": "As soon as I see\nthis transaction, I take these 2 coins, I spend\nthem back to Bob's address and get all 10.",
    "start": "1905780",
    "end": "1912750"
  },
  {
    "text": "So that's a pretty\nconvincing way for Alice to say, look, I'm not\ngoing to use this. I'm deleting to show,\neven if I do use it, here.",
    "start": "1912750",
    "end": "1920039"
  },
  {
    "text": "Here's the key. Any questions about this? AUDIENCE: Does Alice have to\nvoluntarily give her key up?",
    "start": "1920040",
    "end": "1926840"
  },
  {
    "text": "TADGE DRYJA: Yep. Yeah, so Alice has\nto hand it over. Right? This is just a regular 32 byte\nprivate key that Alice created",
    "start": "1926840",
    "end": "1935570"
  },
  {
    "text": "and same idea for Bob. They both create, essentially,\nthe same transaction",
    "start": "1935570",
    "end": "1941480"
  },
  {
    "text": "but with everything swapped. Bob can broadcast this. If he does, he\nhas to wait a day.",
    "start": "1941480",
    "end": "1949279"
  },
  {
    "text": "But if he reveals BobR\nprivate key to Alice, Alice knows, OK, I get\ntwo coins in the clear.",
    "start": "1949280",
    "end": "1955370"
  },
  {
    "text": "And then, these 8\ncoins, I can sign this. I can sign this. I can get these 8\ncoins immediately.",
    "start": "1955370",
    "end": "1960710"
  },
  {
    "text": "Bob's got to wait a day. So that's a way to say, look,\nI'm not going to use these.",
    "start": "1960710",
    "end": "1965950"
  },
  {
    "text": "Any other questions? OK. So what you do with that\nis, yeah, either party",
    "start": "1965950",
    "end": "1972340"
  },
  {
    "start": "1969000",
    "end": "2944000"
  },
  {
    "text": "can broadcast. They have to wait. They exchange these\nrevocation private keys.",
    "start": "1972340",
    "end": "1979440"
  },
  {
    "text": "And now, if they\nbroadcast, the counterparty can take all the faults. So it's pretty good.",
    "start": "1979440",
    "end": "1986195"
  },
  {
    "text": "So the idea is this is\na lightning channel. You've got this output.",
    "start": "1986195",
    "end": "1992582"
  },
  {
    "text": "You create these dates. OK, the first date\nis Alice gets 1 coin. Bob gets 9 coins. Then, Bob wants to pay Alice.",
    "start": "1992582",
    "end": "2000890"
  },
  {
    "text": "So Bob says, hey, Alice,\nI'm paying you 4 coins. Here. I'll sign and create this new\noutput, this new transaction.",
    "start": "2000890",
    "end": "2007500"
  },
  {
    "text": "Hand it to Alice. And Alice says, OK, but now\nwe have to revoke this one.",
    "start": "2007500",
    "end": "2012740"
  },
  {
    "text": " Alice has this. It's signed. Alice can broadcast\nit, but Alice also",
    "start": "2012740",
    "end": "2019040"
  },
  {
    "text": "wants to be sure that Bob\ncan't broadcast this anymore. So they, sort of, trash it.",
    "start": "2019040",
    "end": "2024320"
  },
  {
    "text": "They reveal their R\nprivate keys to each other. So in practice, it\ncould be, well, only Bob",
    "start": "2024320",
    "end": "2031760"
  },
  {
    "text": "has to reveal the\nprivate key, in this case because Alice is going to\nbroadcast this, not this.",
    "start": "2031760",
    "end": "2039679"
  },
  {
    "text": "It's just so much simpler if\nthey both reveal their R keys because then you don't have\nto worry about something.",
    "start": "2039680",
    "end": "2046760"
  },
  {
    "text": "You know, what happens in\nthe future when Alice has 0.5 and Alice still has this thing? So it's really simple.",
    "start": "2046760",
    "end": "2052760"
  },
  {
    "text": "They both reveal. Now this transaction--\nthis state 1--",
    "start": "2052760",
    "end": "2057770"
  },
  {
    "text": "it's, basically, unbroadcast. You know, you're\nnot going to use it. And they can keep doing that. And they can go back and forth.",
    "start": "2057770",
    "end": "2063230"
  },
  {
    "text": "Right? So now Alice pays\nBob and says, hey. Whoops. I wanted to make it\ngo back and forth.",
    "start": "2063230",
    "end": "2068469"
  },
  {
    "text": "Oh well. Oops. Anyway, you can make this\nlike Alice back to 2 and Bob back to 8 or whatever.",
    "start": "2068469",
    "end": "2074870"
  },
  {
    "text": "Basically, arbitrary numbers. You can keep going\nin both directions and deleting the old one.",
    "start": "2074870",
    "end": "2082489"
  },
  {
    "text": "So that's pretty useful. There's no lock time\nfor the channel itself.",
    "start": "2082489",
    "end": "2088940"
  },
  {
    "text": "The channel can just\nkeep going on forever. And Alice and Bob can\nkeep sending these things.",
    "start": "2088940",
    "end": "2095750"
  },
  {
    "text": "It's a little more complicated. Yeah, I didn't put the messages.",
    "start": "2095750",
    "end": "2101660"
  },
  {
    "text": "But they have to\nsend four messages. You can optimize it to three.",
    "start": "2101660",
    "end": "2107620"
  },
  {
    "text": " Right. So if you have Alice and\nBob, the first thing they do",
    "start": "2107620",
    "end": "2117320"
  },
  {
    "text": "is Alice sends a signature. So let's say they're at state 5.",
    "start": "2117320",
    "end": "2125630"
  },
  {
    "text": "OK, so she says, here's a\nsignature for state six. And Bob says, OK, I'll give\nyou a signature for state 6.",
    "start": "2125630",
    "end": "2134550"
  },
  {
    "text": "So now, they both\nbuild the state 6. All right? Let's say, go from 5 to 6. And then, Alice\ncan say, OK, I'll",
    "start": "2134550",
    "end": "2140970"
  },
  {
    "text": "give you your revocation\nkey for state 5.",
    "start": "2140970",
    "end": "2147630"
  },
  {
    "text": "And then, Bob can\nsay, OK, I'll give you a revocation key for state 5. And then, they're done.",
    "start": "2147630",
    "end": "2153839"
  },
  {
    "text": "They've created the new state\nand revoked the old state. ",
    "start": "2153840",
    "end": "2162070"
  },
  {
    "text": "Alice can not put rev 5\nhere in the same message.",
    "start": "2162070",
    "end": "2167240"
  },
  {
    "text": "Do you know why it went on? AUDIENCE: You need rev key. TADGE DRYJA: Well, yeah. Rev key just abbreviate\nto rev. So why would this",
    "start": "2167240",
    "end": "2175800"
  },
  {
    "text": "be bad if Alice says,\nlook, here's state six, and I'm revoking my\nclaim on state 5?",
    "start": "2175800",
    "end": "2181270"
  },
  {
    "text": "What goes wrong if you do that? AUDIENCE: Bob just\ntakes them all.",
    "start": "2181270",
    "end": "2186576"
  },
  {
    "text": "TADGE DRYJA: Not quite. Bob broadcasting state\n6 is OK, in that case.",
    "start": "2186576",
    "end": "2192265"
  },
  {
    "text": " AUDIENCE: Bob can sign\nthe rev key for 5.",
    "start": "2192265",
    "end": "2200300"
  },
  {
    "text": "TADGE DRYJA: No because\nstate 5 is not broadcast.",
    "start": "2200300",
    "end": "2206100"
  },
  {
    "text": "Right? Only Alice can sign\nand broadcast state 5. So the problem with this is,\nif you do this, Bob's fine.",
    "start": "2206100",
    "end": "2214220"
  },
  {
    "text": "Alice is stuck\nbecause Alice does not have state 6 on her drive.",
    "start": "2214220",
    "end": "2221590"
  },
  {
    "text": "All Alice has on her\ndrive is state 5, and she's just revealed the\nkey for state 5 to revoke it.",
    "start": "2221590",
    "end": "2226830"
  },
  {
    "text": "So basically, Alice has\nnothing, at this point. And Bob can just wait,\nand Alice is stuck.",
    "start": "2226830",
    "end": "2232730"
  },
  {
    "text": "And that's a really\ngood position for Bob to be in because Bob is like,\nhey, I can close the channel. I can close the channel\nat state 5 or state 6.",
    "start": "2232730",
    "end": "2241190"
  },
  {
    "text": "Probably, he wants state 6. Usually, you're sending money. But I can close this\nchannel, and you can't.",
    "start": "2241190",
    "end": "2248560"
  },
  {
    "text": "So give me some money, and\nI'll close the channel. That's the attack. AUDIENCE: So\nconceptually, a new state",
    "start": "2248560",
    "end": "2254547"
  },
  {
    "text": "has to be created before\nyou can revoke it. TADGE DRYJA: Right. And you want it on your side. So this is creating\na new state for Bob,",
    "start": "2254548",
    "end": "2263410"
  },
  {
    "text": "but it's revoking the old\nstate for Alice if and when you do this.",
    "start": "2263410",
    "end": "2268510"
  },
  {
    "text": "So that's dangerous. Alice doesn't want to do that. So the simplest way is,\nOK, create the new state",
    "start": "2268510",
    "end": "2274690"
  },
  {
    "text": "by signing 6, revoking\n5, revoking 5.",
    "start": "2274690",
    "end": "2281371"
  },
  {
    "text": "You can optimize this though.  Can you guys see the--",
    "start": "2281372",
    "end": "2287566"
  },
  {
    "text": "it reduces the three messages? AUDIENCE: He can\nsend rev 5 back? TADGE DRYJA: Yeah. He can send 6, 6 rev\n5 at the same time.",
    "start": "2287566",
    "end": "2297120"
  },
  {
    "text": "So you can do it down\ninto three messages. So that's cool. It's basically, here's state 6.",
    "start": "2297120",
    "end": "2303780"
  },
  {
    "text": "OK, here is state 6, and I\nrevoke my claim on state 5. OK, revoke my claim on state 5. Then, they both update their--",
    "start": "2303780",
    "end": "2311490"
  },
  {
    "text": "once this happens,\nthe UI is finished. AUDIENCE: And you're generating\nkeys on the fly, right? You don't need to\npre-generate them?",
    "start": "2311490",
    "end": "2317575"
  },
  {
    "text": " TADGE DRYJA: It ends up being\nfaster if you pre-generate,",
    "start": "2317575",
    "end": "2323799"
  },
  {
    "text": "like, one key ahead\nwhere you say like, hey, here's the next public key I'm\ngoing to use so that I can--",
    "start": "2323800",
    "end": "2331060"
  },
  {
    "text": " because Alice, when\nshe's building state 6,",
    "start": "2331060",
    "end": "2337820"
  },
  {
    "text": "she needs to know Bob's\nrevocation key in the state 6. So you pre-share\none or two steps",
    "start": "2337820",
    "end": "2344180"
  },
  {
    "text": "ahead so that you\ndon't have to say, hey, can you give me the next key? OK. Otherwise, you'd have\nthis message where it's",
    "start": "2344180",
    "end": "2350385"
  },
  {
    "text": "like request state six key. Send it. Send the signature back. So there's more data in these\nmessages without optimizing.",
    "start": "2350385",
    "end": "2358318"
  },
  {
    "text": "AUDIENCE: So I assume with\npublic keys, in that case, it's similar. TADGE DRYJA: Yeah. Yeah, so you also put\nsome public keys in here.",
    "start": "2358318",
    "end": "2364850"
  },
  {
    "text": "And this is the private key. Yes? AUDIENCE: Where does\nstate 6 [INAUDIBLE]??",
    "start": "2364850",
    "end": "2371644"
  },
  {
    "text": "TADGE DRYJA: In here. You're sending the signature,\nbut you can also send here's how much I'm giving you.",
    "start": "2371644",
    "end": "2376950"
  },
  {
    "text": "Here's what the\ntimes and stuff are. Most of it can be computed\nbecause the transactions don't",
    "start": "2376950",
    "end": "2384570"
  },
  {
    "text": "change that much. The scripts are the same. Everyone knows what this\nis going to look like, so you don't have to\nactually send too much data.",
    "start": "2384570",
    "end": "2390340"
  },
  {
    "text": "Another optimization I didn't\nput in is you're going to, potentially, have to retain\nall of these R private keys.",
    "start": "2390340",
    "end": "2398710"
  },
  {
    "text": "So if you make a million\nstates and 900 and whatever are revoked, Bob has\nto keep track of all",
    "start": "2398710",
    "end": "2406559"
  },
  {
    "text": "those million old\nAlice private keys. And Alice has to keep track of\nall those old Bob private keys.",
    "start": "2406560",
    "end": "2412680"
  },
  {
    "text": "That's, kind of, annoying. Not the end of the world,\nbut it's like 32 bytes each.",
    "start": "2412680",
    "end": "2417720"
  },
  {
    "text": "Can be a couple\nhundred megabytes if you use this channel a lot.",
    "start": "2417720",
    "end": "2422970"
  },
  {
    "text": "So I thought I came up with it. But at the same time, when I was\ncoming up with it, I was like, no, I'm pretty sure this\nis in some paper somewhere,",
    "start": "2422970",
    "end": "2428850"
  },
  {
    "text": "and I can't find it. And then, talking\nto people here, apparently, it's Goldwasser. Like, a professor here came\nup with it in, like, the '80s.",
    "start": "2428850",
    "end": "2437910"
  },
  {
    "text": "I called it elkrem because\nspelled backwards it's",
    "start": "2437910",
    "end": "2444039"
  },
  {
    "text": "merkle, right? So you have a binary tree.",
    "start": "2444040",
    "end": "2449230"
  },
  {
    "text": "And you say, OK,\n0, 1, 2, 3, 4, 5.",
    "start": "2449230",
    "end": "2456170"
  },
  {
    "text": "6 Is the root, for example. And when you want to\ndescend to the left,",
    "start": "2456170",
    "end": "2463790"
  },
  {
    "text": "you take the value here,\nappend an l, or maybe 0 is left",
    "start": "2463790",
    "end": "2470210"
  },
  {
    "text": "and 1 is right or something\nor l or r, and you hash it. So you say, OK, I'm\ntaking this value,",
    "start": "2470210",
    "end": "2476390"
  },
  {
    "text": "sticking something on\nhashing to get down here. And similarly to here,\nyou make a big tree.",
    "start": "2476390",
    "end": "2482563"
  },
  {
    "text": "The idea there is you can\nreveal things sequentially and say, OK, I reveal 0. Fine. I'll store it. I'll reveal 1.",
    "start": "2482563",
    "end": "2488510"
  },
  {
    "text": "Store it. I reveal 2. Now, you can delete 0 and 1\nbecause you know the parent, and you can compute 0\nand 1 from knowing 2.",
    "start": "2488510",
    "end": "2496500"
  },
  {
    "text": "Right? So I give you 0. Give you 1. Give me 2. You delete 0 and 1. Going to give me 3, 4, 5.",
    "start": "2496500",
    "end": "2503210"
  },
  {
    "text": "You delete 3 and 4. When I give you 6,\nyou delete 2 and 5. So that way, you only have\nto store login secrets.",
    "start": "2503210",
    "end": "2512150"
  },
  {
    "text": " Given 0 and 1, you\ncan't compute 2.",
    "start": "2512150",
    "end": "2517290"
  },
  {
    "text": "And given 2, 3, and 4,\nyou can't compute 5 or 6. But once you've got them, you\ncan compute all the old ones.",
    "start": "2517290",
    "end": "2525480"
  },
  {
    "text": "So if we do that\nfor the secret keys,",
    "start": "2525480",
    "end": "2531220"
  },
  {
    "text": "that reduces storage a lot. So that's kind of a\nnice optimization. It was pretty quick.",
    "start": "2531220",
    "end": "2537869"
  },
  {
    "text": "And so then, your\ntotal data you're storing for these channels\nnever gets more than a kilobyte",
    "start": "2537870",
    "end": "2543570"
  },
  {
    "text": "or two. So that's pretty useful. OK. Other questions on this?",
    "start": "2543570",
    "end": "2551300"
  },
  {
    "text": "This alone, actually,\nis really complicated. AUDIENCE: You only want\none active state, right?",
    "start": "2551300",
    "end": "2558390"
  },
  {
    "text": "TADGE DRYJA: So there is a,\nsort of, superposition time here where-- ",
    "start": "2558390",
    "end": "2566630"
  },
  {
    "text": "so let's say this is time 0. This is time 1. This is time 2. This is time 3. So at time 1, Bob's got 2\nstates he can broadcast.",
    "start": "2566630",
    "end": "2577140"
  },
  {
    "text": "Right? Bob's like, I can do 6 or 5. Alice can only broadcast 5. But Alice knows that\nBob can broadcast 6.",
    "start": "2577140",
    "end": "2585799"
  },
  {
    "text": "So Alice is also like, well,\nI'm not sure which it is. From Alice's perspective,\nif I close, I'm at state 5.",
    "start": "2585800",
    "end": "2593000"
  },
  {
    "text": "If Bob closes, he's at state 6. And then, at state 2, Alice\ncan only broadcast state 6",
    "start": "2593000",
    "end": "2601340"
  },
  {
    "text": "but Bob can broadcast-- sorry, Alice can\nbroadcast either,",
    "start": "2601340",
    "end": "2607230"
  },
  {
    "text": "but Bob can only broadcast one. So yeah, during\nthis process, it's not clear which state it is.",
    "start": "2607230",
    "end": "2613590"
  },
  {
    "text": "And you know, if something\nhappens, like Alice sends sig--",
    "start": "2613590",
    "end": "2620740"
  },
  {
    "text": "signature for 6-- and Bob goes offline. Then, it's like, OK, I\nnever got a response.",
    "start": "2620740",
    "end": "2626880"
  },
  {
    "text": "I'll just try to close\nat state 5, I guess. And then, I guess that\npayment never went through. But then, Bob could say, no,\nI got it and broadcast it.",
    "start": "2626880",
    "end": "2633612"
  },
  {
    "text": "So things can get\nweird where you're not really sure what happens here. So it's more a UI\nissue where, in the UI,",
    "start": "2633612",
    "end": "2641220"
  },
  {
    "text": "you only show things\nafter you get to the end. Hopefully, in most\ncases, this whole process",
    "start": "2641220",
    "end": "2647670"
  },
  {
    "text": "takes a fraction of a second\nbecause you're just sending some messages to each other.",
    "start": "2647670",
    "end": "2652730"
  },
  {
    "text": "So that's the nice part. That's, sort of, the\nlightning-y thing. It's fast right. Yes?",
    "start": "2652730",
    "end": "2658230"
  },
  {
    "text": "AUDIENCE: Does this\nrequire both actors to be online at the same time? TADGE DRYJA: Yeah. Yeah, right. So they're sending\nmessages to each other.",
    "start": "2658230",
    "end": "2666540"
  },
  {
    "text": "They can't really\npre-compute these things because they don't\nknow how much money is getting sent back and forth.",
    "start": "2666540",
    "end": "2672160"
  },
  {
    "text": "So when you're signing\nstate 6, you're also signing the output values.",
    "start": "2672160",
    "end": "2677190"
  },
  {
    "text": "And when Bob receives state 6\nand signs his version of state 6, he also is like,\nyou know, I don't know",
    "start": "2677190",
    "end": "2683518"
  },
  {
    "text": "how much money I'm getting yet. So I need to sign off on that. So yeah, both parties need\nto be online to receive,",
    "start": "2683518",
    "end": "2690177"
  },
  {
    "text": "which is different than\nnormally in Bitcoin.  That's the same as the\nuni-directional payment",
    "start": "2690177",
    "end": "2696990"
  },
  {
    "text": "channels. In the unidirectional one,\nwhere Bob's the receiver, he doesn't have to sign. But he still has to be online\nbecause the transaction just",
    "start": "2696990",
    "end": "2705900"
  },
  {
    "text": "goes directly to him. It doesn't go onto\nthe block chain. None of these are\npublicly known.",
    "start": "2705900",
    "end": "2711480"
  },
  {
    "text": "OK. AUDIENCE: One question. TADGE DRYJA: Yes? AUDIENCE: Why do we\ncare about old states? Say you had a million states. Why do we care\nabout the old ones?",
    "start": "2711480",
    "end": "2717667"
  },
  {
    "text": "TADGE DRYJA: Well, this was\nstate 1 where Alice had 1",
    "start": "2717667",
    "end": "2723170"
  },
  {
    "text": "and Bob had 9. And then, you keep going,\nand the general trend",
    "start": "2723170",
    "end": "2728210"
  },
  {
    "text": "is Bob's losing money. Right? You go back and forth but,\nat the end, Bob has 1.",
    "start": "2728210",
    "end": "2734420"
  },
  {
    "text": "Bob needs to worry that\nAlice holds onto state 1. And then, months\nlater, broadcasts it",
    "start": "2734420",
    "end": "2740540"
  },
  {
    "text": "while Bob's not watching. Sorry, wait. No.",
    "start": "2740540",
    "end": "2746210"
  },
  {
    "text": "Opposite. Alice has to worry\nabout Bob broadcasting state 1 in the future. AUDIENCE: Well, everything's\ngoing to be revoked, right?",
    "start": "2746210",
    "end": "2753523"
  },
  {
    "text": "TADGE DRYJA: Right. So you still need to\nkeep the secret, though. It's revoked, but the\nwhole process of revocation",
    "start": "2753523",
    "end": "2759560"
  },
  {
    "text": "is Bob gives a key to Alice. So if Bob forgets that key--",
    "start": "2759560",
    "end": "2765680"
  },
  {
    "text": "sorry. If Alice forgets this\nkey, Bob can broadcast it. And then, Alice can't grab it. AUDIENCE: It doesn't stop\nthem from broadcasting.",
    "start": "2765680",
    "end": "2773220"
  },
  {
    "text": "TADGE DRYJA: Yeah,\nthey can broadcast. So from the network's\nperspective, these are all equally valid.",
    "start": "2773220",
    "end": "2779680"
  },
  {
    "text": "The network has no\nidea which came when or anything like that. The only way you enforce it\nis, if Bob broadcasts this,",
    "start": "2779680",
    "end": "2788680"
  },
  {
    "text": "Alice is like, uh uh,\nI'm taking this one because I have the key. So that's also a pretty\nsignificant, different security",
    "start": "2788680",
    "end": "2797570"
  },
  {
    "text": "model. It's a security reduction. Right? Now, you have to actively\ndefend your channel",
    "start": "2797570",
    "end": "2803950"
  },
  {
    "text": "because if you go offline-- I'm Alice. I'm supposed to have 9 coins. I go on vacation.",
    "start": "2803950",
    "end": "2809859"
  },
  {
    "text": "I turn off my\ncomputer, and Bob knows I've turned off my computer. Then, Bob can say,\noh, Alice is out like.",
    "start": "2809860",
    "end": "2817795"
  },
  {
    "text": "It's this 100 block delay. She's not going to be online. I'm just going to broadcast\nthis, get the 9 coins,",
    "start": "2817795",
    "end": "2823840"
  },
  {
    "text": "wait 100 blocks, and then\nsweep them as soon as I can. And then, Alice comes back,\nplugs in, and it's like, oh,",
    "start": "2823840",
    "end": "2829839"
  },
  {
    "text": "you were-- wait. Oh, it says I lost 8 coins. What?",
    "start": "2829840",
    "end": "2835030"
  },
  {
    "text": "Because Bob defrauded,\nso you have to be online.",
    "start": "2835030",
    "end": "2840130"
  },
  {
    "text": "I think I'm going to\nget into it next time. There is a way to\noutsource that so that you",
    "start": "2840130",
    "end": "2845307"
  },
  {
    "text": "don't have to be watching. You can have someone\nelse watch for you. And I'll, probably, talk\nabout that next time.",
    "start": "2845307",
    "end": "2852680"
  },
  {
    "text": "But then, the last\n20ish minutes-- ",
    "start": "2852680",
    "end": "2859670"
  },
  {
    "text": "yeah, so this is cool. This is lightning channels. Two parties. Indefinite. You still need to create\na channel to pay people.",
    "start": "2859670",
    "end": "2866020"
  },
  {
    "text": "So you're going to do\n1 on chain transaction to open the channel. 1 to close the channel.",
    "start": "2866020",
    "end": "2871480"
  },
  {
    "text": "Potentially, 2 to\nclose the channel, but that's pretty rare. If you need to immediately grab\nit, then you're time sensitive,",
    "start": "2871480",
    "end": "2877180"
  },
  {
    "text": "and you're going to have\ntwo closing transactions. If you close normally-- like, you close\nthe current state--",
    "start": "2877180",
    "end": "2884140"
  },
  {
    "text": "you need to wait 100 blocks\nfor your money to be active. But you don't have to spend\nit immediately after that.",
    "start": "2884140",
    "end": "2889710"
  },
  {
    "text": "You can just leave\nit because you know. So in this case, let's say,\nthis is Bob's held transaction.",
    "start": "2889710",
    "end": "2897120"
  },
  {
    "text": "Bob broadcasts it. Bob knows, OK, Alice\ngets her 2 coins.",
    "start": "2897120",
    "end": "2902600"
  },
  {
    "text": "I get my 8 coins. I have to wait 100 blocks,\nbut I don't actually have to spend it\nafter 100 blocks. I can just leave it in my\nwallet because Bob knows",
    "start": "2902600",
    "end": "2911180"
  },
  {
    "text": "he never gave Alice this key. So this clause-- this or\nAlice and BobR key-- this",
    "start": "2911180",
    "end": "2916785"
  },
  {
    "text": "is not going to happen. So Bob's safe and\njust leaves it. So he can just\nuse that, as well.",
    "start": "2916785",
    "end": "2924000"
  },
  {
    "text": "However, if it's the no\nyou don't kind of thing, then you have to do\ntwo transactions.",
    "start": "2924000",
    "end": "2929359"
  },
  {
    "text": "That's rare though. So this is pretty\ngood, but you still have to do two transactions.",
    "start": "2929360",
    "end": "2934860"
  },
  {
    "text": "So if you use this, you open\na channel, you use it once, and then you close it. Well, that was dumb.",
    "start": "2934860",
    "end": "2939920"
  },
  {
    "text": "You just paid twice as much\nin fees that you needed to. So it's useful for some\nthings, not for others.",
    "start": "2939920",
    "end": "2947300"
  },
  {
    "start": "2944000",
    "end": "3209000"
  },
  {
    "text": "Could we do something like\nmultiple party channels? So there's research about this. It gets real ugly real fast.",
    "start": "2947300",
    "end": "2953540"
  },
  {
    "text": "Like, I want a single\nchannel with three or four users or, like,\na tree of channels where the first top output has 4\nof 4 multisig and then branches",
    "start": "2953540",
    "end": "2963319"
  },
  {
    "text": "into these 2 of 2 multisigs. There's a lot of\ninteresting ideas, but it gets a little ugly.",
    "start": "2963320",
    "end": "2969650"
  },
  {
    "text": "But the off chain\nscalability gets bad. There's a lot of n\nsquared kind of stuff.",
    "start": "2969650",
    "end": "2975950"
  },
  {
    "text": "So what about a forwarding\nnetwork of point to point channels? So OK, we have these\ntwo party channels,",
    "start": "2975950",
    "end": "2981260"
  },
  {
    "text": "and people are\nconnected with them. So Alice and Bob have a\nchannel, and Bob and Carol have a channel.",
    "start": "2981260",
    "end": "2987770"
  },
  {
    "text": "So this would be cool. Alice can just say hey, Bob, I\nwill pay you if you pay Carol.",
    "start": "2987770",
    "end": "2993349"
  },
  {
    "text": "And you can do that. Alice says, look, I'm\njust making a new state where you have an extra coin. Now, please, give\nthis extra coin Carol.",
    "start": "2993350",
    "end": "3001180"
  },
  {
    "text": "And Bob says, yeah, OK and does. So the word there that\nshould have immediately",
    "start": "3001180",
    "end": "3008329"
  },
  {
    "text": "raised a, uh oh, that's not how\nthis stuff works, is the word please. You don't say please in Bitcoin.",
    "start": "3008330",
    "end": "3015950"
  },
  {
    "text": "So yeah, the other option\nis Bob just keeps it.",
    "start": "3015950",
    "end": "3021619"
  },
  {
    "text": "So Alice says, OK, here. I'll add a coin to your\noutput in this channel.",
    "start": "3021620",
    "end": "3027650"
  },
  {
    "text": "And please add a coin\nto Carol's output in your channel with her. And Bob says, yeah. No, I'm just going\nto keep the coin.",
    "start": "3027650",
    "end": "3033890"
  },
  {
    "text": "Thanks. So this might not be super\ncrazy in that, well, you",
    "start": "3033890",
    "end": "3041170"
  },
  {
    "text": "got a channel with them. Maybe they're [INAUDIBLE] chain. Also, you can you reduce\nthe number of coins",
    "start": "3041170",
    "end": "3046490"
  },
  {
    "text": "you send per update. You can say, look, I'm going\nto send one Satoshi at a time. And so worst case,\nyou keep one Satoshi",
    "start": "3046490",
    "end": "3055180"
  },
  {
    "text": "that you shouldn't have. Right? You could. Right? It's not as scalable,\nthough, because let's say",
    "start": "3055180",
    "end": "3061842"
  },
  {
    "text": "you want to send a\nlot of money to Carol. You're going to have to keep\ndoing these little things. It's, kind of, annoying. Also, what if you\nwant multiple hops",
    "start": "3061842",
    "end": "3068930"
  },
  {
    "text": "where you're not even sure who's\nin the middle of your chain? It doesn't work for that.",
    "start": "3068930",
    "end": "3074619"
  },
  {
    "text": "OK. So you can have\nwhat's called HTLCs. And these are even\nmore complicated.",
    "start": "3074620",
    "end": "3081390"
  },
  {
    "text": "OK, so the idea is it's\nHash/Time Locked Contract. Or Hash/Time Lock Contract.",
    "start": "3081390",
    "end": "3086430"
  },
  {
    "text": "Whatever. The script is,\nessentially, this. KeyA and preimageR.",
    "start": "3086430",
    "end": "3092580"
  },
  {
    "text": "You need to present\nthe preimage of a hash. Or KeyB and some\nabsolute lock time.",
    "start": "3092580",
    "end": "3099539"
  },
  {
    "text": "Op check lock time verify. And it's important that this\nis an absolute time, not a relative time\nbecause these should",
    "start": "3099540",
    "end": "3106440"
  },
  {
    "text": "be able to expire, regardless\nof when they get broadcast onto the blockchain.",
    "start": "3106440",
    "end": "3111539"
  },
  {
    "text": "So the idea is, in this case-- so let's say A is\nAlice, B is Bob--",
    "start": "3111540",
    "end": "3116810"
  },
  {
    "text": "Alice gets the money if\nshe knows this preimageR.",
    "start": "3116810",
    "end": "3123870"
  },
  {
    "text": "This 32 bite. So what actually goes\nhere is the hash of R. It's like a Pay-to-PubKey\nHash, where you say op dup,",
    "start": "3123870",
    "end": "3133105"
  },
  {
    "text": "op hash 160, the\nthing, op equal verify. So you need to know some\npreimage, and you need to sign.",
    "start": "3133105",
    "end": "3140090"
  },
  {
    "text": "Or you can be Bob, and then you\ncan sign after a certain date. ",
    "start": "3140090",
    "end": "3147986"
  },
  {
    "text": "So this is, kind of, nice. It's like, well, if R is\nknown, then it's Alice's money.",
    "start": "3147987",
    "end": "3153420"
  },
  {
    "text": "If R is unknown,\nthen it's Bob's money after a certain period of time.",
    "start": "3153420",
    "end": "3158440"
  },
  {
    "text": "OK, so this was the revokable\ntransaction where Alice got 2 coins, Bob's got\n8 coins, and then you",
    "start": "3158440",
    "end": "3166260"
  },
  {
    "text": "add a third output, this\nHTLC output where now Alice has 2 coins, Bob has 7 coins,\nand Alice might be getting",
    "start": "3166260",
    "end": "3175170"
  },
  {
    "text": "an extra coin if she learns R. Bob gets the coin back\nafter height 500,000.",
    "start": "3175170",
    "end": "3182579"
  },
  {
    "text": "So similarly, with this it's\nlike, OK, this is Bob's money.",
    "start": "3182580",
    "end": "3188010"
  },
  {
    "text": "But if he does something\nbad, Alice can grab it. This is Alice's money if she\nknows R. If she doesn't, Bob",
    "start": "3188010",
    "end": "3195660"
  },
  {
    "text": "gets it back. So there's no-- like,\nreally, this is Bob's money. Right?",
    "start": "3195660",
    "end": "3200970"
  },
  {
    "text": "This only happens if someone's\ntrying to rip someone off. This, on the other hand,\nis well it depends.",
    "start": "3200970",
    "end": "3207510"
  },
  {
    "text": "Is Alice going to\nlearn R or not? And what is R? OK. So the multi-party\nadversarial payment model.",
    "start": "3207510",
    "end": "3215200"
  },
  {
    "start": "3209000",
    "end": "3599000"
  },
  {
    "text": "So the lightning forwarding\nis Alice wants to pay Carol. Right? She doesn't want to just ask\nBob to keep forwarding the funds",
    "start": "3215200",
    "end": "3221779"
  },
  {
    "text": "because she doesn't trust Bob. So she connects to Carol-- and by connect I mean, like,\nregular TCP connection--",
    "start": "3221780",
    "end": "3229050"
  },
  {
    "text": "and says, hey, Carol,\nmake a random number R, and send me the hash.",
    "start": "3229050",
    "end": "3235040"
  },
  {
    "text": "carol OK, here you go. Carol knows H, which is the hash\nand R, which is the pre-image.",
    "start": "3235040",
    "end": "3241410"
  },
  {
    "text": "She sends over H to Alice. Alice then says to\nBob, hey, I'm going",
    "start": "3241410",
    "end": "3247180"
  },
  {
    "text": "to add an HTLC to our channel. So basically, Bob, if you\nknow the pre-image of H--",
    "start": "3247180",
    "end": "3253660"
  },
  {
    "text": "if you know R-- you can get this coin. If not, I get the\ncoin back after 5:00.",
    "start": "3253660",
    "end": "3262540"
  },
  {
    "text": "And then, Bob says, OK, cool. I know H now, but I don't know\nR. So I can't grab this money.",
    "start": "3262540",
    "end": "3270599"
  },
  {
    "text": "I don't know this,\nso there's no way this is going to be my money. It's just going to go\nback to you after 5:00.",
    "start": "3270600",
    "end": "3277740"
  },
  {
    "text": "And Alice says, yeah, but\nCarol knows R, so ask Carol. Bob says, OK, I get it.",
    "start": "3277740",
    "end": "3284440"
  },
  {
    "text": "I will forward this on to Carol. And then, I create\na similar output. I make sure that these are\nthe same R or the same H.",
    "start": "3284440",
    "end": "3292289"
  },
  {
    "text": "I don't know R yet. But I say, hey,\nCarol, if you know R-- if you know the pre-image of H--",
    "start": "3292290",
    "end": "3297990"
  },
  {
    "text": "you can get this coin. If not, after 4:00 o'clock,\nI get the money back.",
    "start": "3297990",
    "end": "3303480"
  },
  {
    "text": "And then, Carol says, oh, cool. Well guess what? I know R because I made R up.",
    "start": "3303480",
    "end": "3310512"
  },
  {
    "text": "So from Carol's\nperspective, Carrol could broadcast this onto\nthe blockchain immediately. And she will be able to grab\nthe money because she knows",
    "start": "3310512",
    "end": "3318480"
  },
  {
    "text": "R. She has to grab it soon\nbecause, by 4:00 o'clock, Bob can grab the money. ",
    "start": "3318480",
    "end": "3326280"
  },
  {
    "text": "And if Carol does this-- she closes the\nchannel, she uses R because she knows it to take\nthis coin from this output.",
    "start": "3326280",
    "end": "3334250"
  },
  {
    "text": "Carol doing that will reveal\nR to everyone in the world because it's on\nthe blockchain now. And so then Bob can\nsay, ah, I know R now.",
    "start": "3334250",
    "end": "3343048"
  },
  {
    "text": "I need to get this money. So Bob can close the channel. Grab the money. Yes? AUDIENCE: Those times are\nactually block heights, right?",
    "start": "3343048",
    "end": "3349712"
  },
  {
    "text": "TADGE DRYJA: In the software,\nyeah, we use heights. You could do it with time.",
    "start": "3349712",
    "end": "3356010"
  },
  {
    "text": "The main reason for\nheights is, what if a block's full because\nheight's, sort of, variable.",
    "start": "3356010",
    "end": "3364272"
  },
  {
    "text": "Like, maybe a bunch of\nblocks come out quickly, and maybe they come out slowly. So time is a little\ndangerous in that you",
    "start": "3364272",
    "end": "3370790"
  },
  {
    "text": "could say, OK, 4:00 o'clock. But maybe in the\nnext five hours, only a couple blocks\ncome out, just by chance.",
    "start": "3370790",
    "end": "3377510"
  },
  {
    "text": "And they're full, and you're\nnot able to broadcast. You're not able to get\nthis in, and it's risky.",
    "start": "3377510",
    "end": "3383250"
  },
  {
    "text": "So the height takes into account\nthe variable nature of it a little bit better. AUDIENCE: What if there's some\nsituation where blocks are",
    "start": "3383250",
    "end": "3391090"
  },
  {
    "text": "[INAUDIBLE]? TADGE DRYJA: Yeah. Well, child pays for parent-- yeah.",
    "start": "3391090",
    "end": "3397040"
  },
  {
    "text": "So the question is, what if\nthe fees get really high?",
    "start": "3397040",
    "end": "3402150"
  },
  {
    "text": "The thing is, this whole process\nshould take a few seconds. So it's not like these outputs\nhave weird fees that are old.",
    "start": "3402150",
    "end": "3411710"
  },
  {
    "text": "One issue is what if you're\nbuilding these states back and forth. And then, you sit on\none for a few weeks.",
    "start": "3411710",
    "end": "3416839"
  },
  {
    "text": "And then, the fee\nrate goes way up. And you're like\nshoot, if I tried to broadcast these\ntransactions, the fee's too low",
    "start": "3416840",
    "end": "3422760"
  },
  {
    "text": "and it might not get confirmed. It's not a huge risk\nbecause if you're not",
    "start": "3422760",
    "end": "3429050"
  },
  {
    "text": "trying to rip people\noff, you don't actually have any time risk.",
    "start": "3429050",
    "end": "3435320"
  },
  {
    "text": "In this case, this gets\nbuilt. This gets built. These are, sort\nof, in real time. And so you know what the\nfee rate is in the network,",
    "start": "3435320",
    "end": "3441770"
  },
  {
    "text": "so you can adapt to it. But yeah, that's\nan interesting one. Yeah? AUDIENCE: Are there any problems\nin this system being slow?",
    "start": "3441770",
    "end": "3448527"
  },
  {
    "text": "Because I think, as we\nwere reading literature prior to blockchain,\nlike 1980, that I",
    "start": "3448528",
    "end": "3454400"
  },
  {
    "text": "read some stuff about\ndistributed computing that if you n\nnumber of nodes, you need a minimal number\nof 3 [INAUDIBLE]",
    "start": "3454400",
    "end": "3461370"
  },
  {
    "text": "or something in order\nto get consensus. But does blockchain\nsort of make something underneath all of the--",
    "start": "3461370",
    "end": "3467150"
  },
  {
    "text": "TADGE DRYJA: You don't need\nglobal consensus in that-- ",
    "start": "3467150",
    "end": "3473270"
  },
  {
    "text": "I did only 3, so you can't show. If you have four,\nyou can sort of say-- let's say you have\nAlice, Bob, Carol, Dave.",
    "start": "3473270",
    "end": "3480040"
  },
  {
    "text": " You don't actually have\nto know the whole thing. You just have to know the\nperson before you and the person",
    "start": "3480040",
    "end": "3486400"
  },
  {
    "text": "after you. And you don't care what\nthe actual endpoints are. So to some extent, Bob\ndoesn't need to know.",
    "start": "3486400",
    "end": "3493840"
  },
  {
    "text": "Maybe Alice got this HTLC\nforwarded from someone else before. And Bob's like, all I know is I\ncould get money from Alice if I",
    "start": "3493840",
    "end": "3501910"
  },
  {
    "text": "know R, and Carol\ngets it from me if she knows R. And maybe\nthat keeps going or something.",
    "start": "3501910",
    "end": "3508150"
  },
  {
    "text": "You don't need global consensus. AUDIENCE: And that's\nbecause of how it's chained? TADGE DRYJA: Yeah.",
    "start": "3508150",
    "end": "3513539"
  },
  {
    "text": "AUDIENCE: Like the message? TADGE DRYJA: Yeah.  You're only concerned\nwith the channels",
    "start": "3513540",
    "end": "3519850"
  },
  {
    "text": "you're participating in. If there's something\nelse happening before it,",
    "start": "3519850",
    "end": "3525420"
  },
  {
    "text": "you might want to watch\nin case ours shows up. But you don't have\nto worry about it.",
    "start": "3525420",
    "end": "3532750"
  },
  {
    "text": "And then, these will\nall get broadcast. The failure mode is broadcast\neverything onto the blockchain,",
    "start": "3532750",
    "end": "3538320"
  },
  {
    "text": "and let the blockchain\nsort it out. And that's very high latency\nbecause it's, like, 10 minutes.",
    "start": "3538320",
    "end": "3544650"
  },
  {
    "text": "But the idea is the\nblockchain already has that global\nconsensus because it's really high latency and\neveryone can agree on it.",
    "start": "3544650",
    "end": "3551309"
  },
  {
    "text": "So I think that's\nthe basic idea. Yeah, so what you could do here\nis you could just close it.",
    "start": "3551310",
    "end": "3557349"
  },
  {
    "text": "Right? You could broadcast this whole\ntransaction on the blockchain and get the payment through. That's really inefficient.",
    "start": "3557350",
    "end": "3562470"
  },
  {
    "text": "You want to keep your channels\nopen so what instead happens-- when everything's working.",
    "start": "3562470",
    "end": "3569333"
  },
  {
    "text": "It could happen. right? Carol could just broadcast it. OK, that's annoying. Whatever. But no one loses money. Or Carol can go\noffline, at this point.",
    "start": "3569333",
    "end": "3575725"
  },
  {
    "text": "And then, these\nthings get stuck. And there's all sorts of weird\nthings that can go wrong, but you don't lose money. But what happens\nwhen things go right",
    "start": "3575725",
    "end": "3581720"
  },
  {
    "text": "is Carol says, hey, Bob,\nI know R. And so really,",
    "start": "3581720",
    "end": "3587450"
  },
  {
    "text": "this whole crazy HTLC\nthing, it's just my money. I know what R is.",
    "start": "3587450",
    "end": "3593900"
  },
  {
    "text": "You're not getting this\nmoney at 4:00 o'clock because I know R. So here. Look. I'll tell you R. And\nwhen Carol tells Bob R,",
    "start": "3593900",
    "end": "3602450"
  },
  {
    "text": "she's doing two things. She's proving that\nthis HTLC is her money. She's also giving Bob R so that\nhe can then grab Alice's money.",
    "start": "3602450",
    "end": "3611690"
  },
  {
    "text": " And so as soon as she\nreveals R to Bob, Bob says,",
    "start": "3611690",
    "end": "3616850"
  },
  {
    "text": "yeah, I agree. This HTLC is superfluous,\nat this point. I know you know R, so\nthis is just your money.",
    "start": "3616850",
    "end": "3623480"
  },
  {
    "text": "And if it gets close\nto 4:00 o'clock, I know you're going to broadcast\nthis channel onto the chain",
    "start": "3623480",
    "end": "3629480"
  },
  {
    "text": "if I don't let you clear it out. So let's just make a new state\nthrough these state updates",
    "start": "3629480",
    "end": "3635390"
  },
  {
    "text": "where you just have\nthe extra money. Let's clear out that HTLC. So that 1 coin goes to you.",
    "start": "3635390",
    "end": "3641494"
  },
  {
    "text": "And Carol's like, OK, cool. I agree. We'll sign this,\nand they'll all just get rid of the HTLC output. Then, Bob goes to Alice and\nsays, hey, Alice, guess what?",
    "start": "3641495",
    "end": "3648940"
  },
  {
    "text": "I know R. So this part,\nI'm going to do it. I know R and Bob.",
    "start": "3648940",
    "end": "3655590"
  },
  {
    "text": "Alice, after 5:00 o'clock,\nit's not happening. If you stop answering\nme and it gets to 4:30,",
    "start": "3655590",
    "end": "3662070"
  },
  {
    "text": "I'm just going to broadcast\nthe channel on chain and grab it that way.",
    "start": "3662070",
    "end": "3669010"
  },
  {
    "text": "And then, Bob\nreveals R to Alice. Alice says, oh yeah, you do know\nR. OK, we'll clear the HTLC up,",
    "start": "3669010",
    "end": "3675119"
  },
  {
    "text": "and you get the money. And then, Alice gets\nR. And that's, sort of, a receipt for the payment.",
    "start": "3675120",
    "end": "3680800"
  },
  {
    "text": "And Alice knows, well,\nCarol was the one who told me H. Carol must\nhave gotten the money.",
    "start": "3680800",
    "end": "3686880"
  },
  {
    "text": "Right? So that's my\nconfirmation of that. AUDIENCE: How does creating a\nnew channel state of the HTLC--",
    "start": "3686880",
    "end": "3695420"
  },
  {
    "text": "how does that provoke\nthe HTLC itself? TADGE DRYJA: Oh, so I\ndidn't put it in the script.",
    "start": "3695420",
    "end": "3700690"
  },
  {
    "text": "But it's revocable the same\nway the regular outputs are revocable. There's also this,\nwhich you don't even",
    "start": "3700690",
    "end": "3709240"
  },
  {
    "text": "have to do because the idea\nis that the HTLCs are very small in comparison with the\nother outputs in the state",
    "start": "3709240",
    "end": "3716860"
  },
  {
    "text": "that, if you try to\nbroadcast an old one, you'll lose way more\nthan the HTLCs worth. But you can also tack on a or\nother clause to the HTLC script",
    "start": "3716860",
    "end": "3727580"
  },
  {
    "text": "with a relative lock time. So there's actually a couple\ndifferent ways to do it. The simplest is\nyou just say, look,",
    "start": "3727580",
    "end": "3735210"
  },
  {
    "text": "I've got 2 coins, 7 coins,\nand then a 1 coin HTLC.",
    "start": "3735210",
    "end": "3740420"
  },
  {
    "text": "I'm not going to risk my\n7 coins to go back and try to get this 1 coin in HTLC.",
    "start": "3740420",
    "end": "3747590"
  },
  {
    "text": "But that's not how most\nof the software does it. You just add a new clause. OK, so this is a multiple\nparty adversarial.",
    "start": "3747590",
    "end": "3756950"
  },
  {
    "text": "Whoops. So yeah, that would\nbe really useful. Right? You build lots of nodes\nwith channels connecting.",
    "start": "3756950",
    "end": "3764090"
  },
  {
    "text": "And they form a big graph. And then, you can\nrequest payment routing via these HTLC outputs.",
    "start": "3764090",
    "end": "3770930"
  },
  {
    "text": "And if you open a few\nchannels, then you can pay lots of different\nusers on the network. Yes? AUDIENCE: I may\nhave missed this,",
    "start": "3770930",
    "end": "3777200"
  },
  {
    "text": "but what is Bob's incentive\nin relaying transactions? TADGE DRYJA: OK. So yeah, Bob could charge a fee,\nor he could just be a nice guy.",
    "start": "3777200",
    "end": "3785900"
  },
  {
    "text": "That's, basically, the-- AUDIENCE: But you said you\nnever ask for [INAUDIBLE],,",
    "start": "3785900",
    "end": "3791760"
  },
  {
    "text": "because you know\nBob's not a nice guy. TADGE DRYJA: Yeah,\nso you can pay him. It's going to be\nhard to pay him much",
    "start": "3791760",
    "end": "3797930"
  },
  {
    "text": "because Alice is going to say,\nlook, we've got a channel. We're using it. If you charge me a ton to\nforward payments to Carol,",
    "start": "3797930",
    "end": "3804532"
  },
  {
    "text": "I'm just going to\nclose the channel and open with someone\nwho does it cheaper. So yeah, you can make the\namounts slightly less.",
    "start": "3804532",
    "end": "3811910"
  },
  {
    "text": "So Alice says, I'm\nsending you 1 coin. And Bob says, OK, I'm sending\n0.9999 coins to Carol,",
    "start": "3811910",
    "end": "3819140"
  },
  {
    "text": "and I'm keeping the difference. You can have that. And then, it's\nreally up to Carol",
    "start": "3819140",
    "end": "3825290"
  },
  {
    "text": "to decide if the fee-- because\nall Alice knows is, hey, I'm sending one coin.",
    "start": "3825290",
    "end": "3831380"
  },
  {
    "text": "What if Bob puts a crazy\nfee, like 1/2 a coin? Carol sees 0.5. And Carol's like, no,\nthat's way too low.",
    "start": "3831380",
    "end": "3838590"
  },
  {
    "text": "I don't know what\nhappened, if Alice sent 0.5 and Bob\nforwarded it to me or if Alice sent 1 and\nBob forwarded me 0.5.",
    "start": "3838590",
    "end": "3846059"
  },
  {
    "text": "But I'm not accepting this. Right? I'm not going to\nreveal R to you. I'm just going to say no.",
    "start": "3846060",
    "end": "3851799"
  },
  {
    "text": "So you can do that. At this point, Carol\nhas not yet revealed R. Carol can refuse\nand say, look, Bob,",
    "start": "3851800",
    "end": "3858230"
  },
  {
    "text": "I'm not going to\naccept this HTLC. We can just clear it out\nright away without revealing R and just, basically,\nundo what we just did.",
    "start": "3858230",
    "end": "3864970"
  },
  {
    "text": "Yeah. AUDIENCE: So two\nfollow-ups to that. The first is, can there\nbe a situation where",
    "start": "3864970",
    "end": "3871730"
  },
  {
    "text": "it's an efficient market\nplace for these relaying points in the network\nwhere Alice asks for a bid,",
    "start": "3871730",
    "end": "3879170"
  },
  {
    "text": "and the lowest\ntransaction fee wins and she routes it from that? TADGE DRYJA: You can. So let's say Alice is connected\nto three Bob's in the middle,",
    "start": "3879170",
    "end": "3888590"
  },
  {
    "text": "and then asks all\nof them, hey, what are you going to charge me\nto forward a coin to Carol? Then, they can all answer.",
    "start": "3888590",
    "end": "3895940"
  },
  {
    "text": "It's a little weird because\nthey can lie, at that point because they haven't\nactually signed anything.",
    "start": "3895940",
    "end": "3900990"
  },
  {
    "text": "And this, Bob can say,\noh, I'll do it for free. And this Bob says, oh,\nI'll do it for 1/2 a coin. And this Bob says, I'll\ndo it a tenth of a coin.",
    "start": "3900990",
    "end": "3907520"
  },
  {
    "text": "And then, you try to\ngo for the free one, and Carol gets some really\nlow amount and says,",
    "start": "3907520",
    "end": "3914180"
  },
  {
    "text": "I'm not telling you\nR. Let's cancel this. And then, if Alice trusts\nCarol, Carol could be like,",
    "start": "3914180",
    "end": "3922310"
  },
  {
    "text": "Alice, Bob just tried to\ncharge a ridiculous fee. Don't use this. You know, this Bob is bad.",
    "start": "3922310",
    "end": "3927757"
  },
  {
    "text": "And then, you try the other\nBob, and the other Bob does the right thing. Yeah. AUDIENCE: Can't Alice just\nsend directly to Carol?",
    "start": "3927757",
    "end": "3935603"
  },
  {
    "text": "TADGE DRYJA: Open a channel? So yeah, you could. You just have to open a channel. AUDIENCE: Is that\nexpensive or something?",
    "start": "3935603",
    "end": "3941539"
  },
  {
    "text": "TADGE DRYJA: Yeah. You have to go on chain. ",
    "start": "3941540",
    "end": "3947960"
  },
  {
    "text": "We, sort of, saw a preview\nof it in November, December, and January where it\nwas actually, kind of, expensive to use Bitcoin.",
    "start": "3947960",
    "end": "3954530"
  },
  {
    "text": "Now it's cheap again. Costs a few cents. But for a month or two,\nit was like, oh shoot.",
    "start": "3954530",
    "end": "3959990"
  },
  {
    "text": "Like, this costs $5 to make\na on chain transaction.",
    "start": "3959990",
    "end": "3965760"
  },
  {
    "text": "And so creating a direct\nchannel from Alice to Carol, it might cost $5. Or it might cost $20.",
    "start": "3965760",
    "end": "3971720"
  },
  {
    "text": "Or long term, if everyone's\ntrying to use the blockchain and the fees go really high, it\ncould be, kind of, expensive.",
    "start": "3971720",
    "end": "3978470"
  },
  {
    "text": "And so the idea is, well, if\nI've got a channel already, I'd rather use that and move\nmy money around that way",
    "start": "3978470",
    "end": "3983780"
  },
  {
    "text": "without having to\ntouch the blockchain. Yeah. AUDIENCE: Wouldn't\nit be a graph problem",
    "start": "3983780",
    "end": "3991353"
  },
  {
    "text": "trying to figure out what the\ncheapest way to get to Carol is? Would that be [INAUDIBLE],,\nand would that be scalable?",
    "start": "3991353",
    "end": "3997530"
  },
  {
    "text": "TADGE DRYJA: So\nyou can sort of-- so it's [INAUDIBLE] or\nit's like [INAUDIBLE],, kind of, if you know\nthe whole graph.",
    "start": "3997530",
    "end": "4004810"
  },
  {
    "text": "AUDIENCE: Yeah, but\nthen you have to ask. TADGE DRYJA: Yeah. So the one part is if\nyou know the whole graph.",
    "start": "4004810",
    "end": "4010540"
  },
  {
    "text": "And you can know the whole\ngraph because the graph never gets bigger than the UTXO set.",
    "start": "4010540",
    "end": "4015910"
  },
  {
    "text": "Every channel is a\ntransaction output. And so, if you're\nrunning a full node and you have the whole\nUTXO set, the entire graph",
    "start": "4015910",
    "end": "4023140"
  },
  {
    "text": "is on the order of that size. So maybe it's twice\nas big in that you have to have some\nextra metadata about what",
    "start": "4023140",
    "end": "4030400"
  },
  {
    "text": "these outputs are. And Bob and Carol\ncan make proof. So like, oh, here\nis our channel,",
    "start": "4030400",
    "end": "4036190"
  },
  {
    "text": "and it's in the UTXO set. And we can reveal our pub\nkeys, the big O in here. So if you have the\nwhole graph, you",
    "start": "4036190",
    "end": "4042700"
  },
  {
    "text": "could do some routing that's\nin login kind of speed. But then, it might not work.",
    "start": "4042700",
    "end": "4048610"
  },
  {
    "text": " So there's actually tons of ways\nthings can go wrong in this.",
    "start": "4048610",
    "end": "4056810"
  },
  {
    "text": "That's the, sort of, fun\npart of dealing with it. One of the ways it can not\nwork is you're like, yeah,",
    "start": "4056810",
    "end": "4063700"
  },
  {
    "text": "I found a path. The simplest is, I found\na path, and I query Bob,",
    "start": "4063700",
    "end": "4069570"
  },
  {
    "text": "and Bob is just offline. I'm like, oh, OK. Well, that's not an active path. OK, what's the\nsecond shortest path?",
    "start": "4069570",
    "end": "4076450"
  },
  {
    "text": "OK, this other Bob,\nand he says, yes. But the fee seems really high. So OK, I found the--",
    "start": "4076450",
    "end": "4081789"
  },
  {
    "text": "So most of the\nalgorithms, though, will get you the second and\nthird and fourth and fifth",
    "start": "4081790",
    "end": "4086859"
  },
  {
    "text": "shortest in much less\ntime than recomputing the whole thing from scratch.",
    "start": "4086860",
    "end": "4091970"
  },
  {
    "text": "So you can get a bunch of pretty\ngood ones and try them all. Like query and the--",
    "start": "4091970",
    "end": "4098624"
  },
  {
    "text": "AUDIENCE: By the time\nyou try them all, what if the first Bob is online\nand you try the first Bob? TADGE DRYJA: Yeah.",
    "start": "4098624",
    "end": "4103870"
  },
  {
    "text": "The thing is, in practice,\nit's all real fast. Well right now, for a small\nnetwork, it's nothing.",
    "start": "4103870",
    "end": "4111430"
  },
  {
    "text": "But even total number\nof UTXOs is on the order of, like, millions. Right? So if you've got a graph\nwith millions of edges,",
    "start": "4111430",
    "end": "4120700"
  },
  {
    "text": "that's easy for a computer. Right? They'll do it in\nless than a second. And then, your main thing\nhere is network latency",
    "start": "4120700",
    "end": "4128830"
  },
  {
    "text": "for all of these things. For building new states, it's\nthe time taken for the data",
    "start": "4128830",
    "end": "4135303"
  },
  {
    "text": "to get from one\nside to the other. It's much larger than\ncomputing the signatures, verifying the signatures,\nbuilding the hash tree thing.",
    "start": "4135303",
    "end": "4142660"
  },
  {
    "text": "All that stuff is real\nfast compared to a network. So the same with routing. Looking at the graph\nand dissecting it",
    "start": "4142660",
    "end": "4150040"
  },
  {
    "text": "is going to be faster than\ncontacting all the things. There's a bunch of other\nthings that can go wrong.",
    "start": "4150040",
    "end": "4156759"
  },
  {
    "text": "So for example, this\ngets built, get to here,",
    "start": "4156760",
    "end": "4164149"
  },
  {
    "text": "and Carol just stops responding. So now you've got\nthese two HTLCs.",
    "start": "4164149",
    "end": "4170849"
  },
  {
    "text": "They're a third output in\nyour channel transaction, and Carol's just\nnot saying anything.",
    "start": "4170849",
    "end": "4176797"
  },
  {
    "text": "And then, Alice goes to Bob. He's like, Bob, what's up? Like, we're going\nto clear this HTLC. Usually, these\nonly take a second.",
    "start": "4176798",
    "end": "4182479"
  },
  {
    "text": "And Bob's like,\nuh, yeah, hold on. And so it's, kind of, awkward\nbecause now we've got this HTLC",
    "start": "4182479",
    "end": "4188920"
  },
  {
    "text": "and you don't know whose\nmoney it ends up being. The way to mitigate\nthat, Rusty--",
    "start": "4188920",
    "end": "4194710"
  },
  {
    "text": "yeah, I think it works;\nRusty's the other guy who works on this stuff-- was that he has a\ntimeout period--",
    "start": "4194710",
    "end": "4202099"
  },
  {
    "text": "I think 30 seconds,\na minute, whatever-- where Alice says, OK, Bob, I\nmade this HTLC a minute ago.",
    "start": "4202100",
    "end": "4208760"
  },
  {
    "text": "Minute's up. You need to either\nshut down this channel right now because you're\ndoing something bad,",
    "start": "4208760",
    "end": "4214970"
  },
  {
    "text": "or you need to prove to me that\na channel has been shut down",
    "start": "4214970",
    "end": "4220400"
  },
  {
    "text": "with this HTLC,\nthis H value in it. And then, I know where\nto ascribe blame.",
    "start": "4220400",
    "end": "4226190"
  },
  {
    "text": "So if Bob's like, yeah,\nI can't contact Carol. Carol's offline. Then, Alice says, all right. Well, then, shut\ndown the channel.",
    "start": "4226190",
    "end": "4231490"
  },
  {
    "text": "AUDIENCE: Isn't that\npretty expensive considering Carol isn't\nnecessarily malicious?",
    "start": "4231490",
    "end": "4237060"
  },
  {
    "text": "TADGE DRYJA: Yeah,\nso that's a downside. Right? AUDIENCE: Yeah, it seems\na little harsh on Carol. TADGE DRYJA: Well, the thing\nis, if you don't do that--",
    "start": "4237060",
    "end": "4243860"
  },
  {
    "text": "AUDIENCE: It just seems\nto me like running a lightning node is not anywhere\nnear as voluntary as running a Bitcoin node in this\nworld where it's, like,",
    "start": "4243860",
    "end": "4251230"
  },
  {
    "text": "being live really matters. Responding even faster than\nthe timeouts really matters. TADGE DRYJA: OK. OK, one thing to mitigate that.",
    "start": "4251230",
    "end": "4257930"
  },
  {
    "text": " Carol responded by\nsigning off on the HTLC,",
    "start": "4257930",
    "end": "4266270"
  },
  {
    "text": "and then immediately\ngoes offline. It's not like you accident-- AUDIENCE: This is all protocol. She didn't truly break\nthe rule by doing so.",
    "start": "4266270",
    "end": "4272620"
  },
  {
    "text": "TADGE DRYJA: Well,\npart of the protocol is, if you have an HTLC\nand you don't remove it within 30 to 60 seconds,\nit's like, you know,",
    "start": "4272620",
    "end": "4280850"
  },
  {
    "text": "that's a violation of\nthe rules, and we're going to close their\nchannels because if you're",
    "start": "4280850",
    "end": "4286370"
  },
  {
    "text": "just straight up offline,\nand then it's like, well, OK, I'm not going to\nuse that channel. But it's like, oh,\nI accepted this,",
    "start": "4286370",
    "end": "4292640"
  },
  {
    "text": "and immediately said, OK, I'm\nnot talking to you anymore. And they're like, well, now\nit's stuck because the attack",
    "start": "4292640",
    "end": "4298970"
  },
  {
    "text": "vector is build a ton of HTLCs. You could add multiple per\nchannel and build them all,",
    "start": "4298970",
    "end": "4305210"
  },
  {
    "text": "and they all get stuck. And one party is just not\nresponding with their R values. And then, everyone's like,\nOK, if we try to close,",
    "start": "4305210",
    "end": "4312800"
  },
  {
    "text": "our transactions now\nhave, like, 100 outputs. And they're huge and\nhave all these fees. Also, all these HTLCs, yeah,\nthey might be really little,",
    "start": "4312800",
    "end": "4320360"
  },
  {
    "text": "and we have to wait. And then, it charges a lot of\nfees to recover them and stuff. So you don't want\npeople to be able to,",
    "start": "4320360",
    "end": "4327469"
  },
  {
    "text": "sort of, blow up the number\nof HTLCs in your channels. So the way to do it is,\nif one of them is stuck,",
    "start": "4327470",
    "end": "4332570"
  },
  {
    "text": "you need to find\nsomeone to blame. And yeah, it's possible. Right? But the thing is, you accurately\nfind the person to blame.",
    "start": "4332570",
    "end": "4340340"
  },
  {
    "text": "If Carol accepts the HTLC, and\nthen, a split second later, unplugs their computer,\nBob's like, what?",
    "start": "4340340",
    "end": "4346920"
  },
  {
    "text": "OK, fine. I'm closing the channel. You just did something\nreally annoying. And Bob's like, if I\ndon't close this channel,",
    "start": "4346920",
    "end": "4353048"
  },
  {
    "text": "Alice is going to close the\nchannel on me because Alice is going to think I'm\nthe one acting weird. So yeah, there's all\nsorts of weird edge cases.",
    "start": "4353048",
    "end": "4362525"
  },
  {
    "text": " There's all sorts of weird\nstuff that can happen. It's definitely more complicated\nthan just the straight up UTXOs",
    "start": "4362525",
    "end": "4369980"
  },
  {
    "text": "in Bitcoin. Yes? AUDIENCE: Couldn't\nCarol respond to Bob, and then Bob be malicious\nand close the channel?",
    "start": "4369980",
    "end": "4376430"
  },
  {
    "text": "And then say, hey,\nAlice, check it out. Carol was malicious. TADGE DRYJA: Yep. That's OK.",
    "start": "4376430",
    "end": "4381630"
  },
  {
    "text": "AUDIENCE: And then, you\nwouldn't get the blame, but Carol presumably-- TADGE DRYJA: Bob blames Carol.",
    "start": "4381630",
    "end": "4386800"
  },
  {
    "text": "Carol says, no, it\nwas actually Bob. From Alice's point of\nview, like, whatever. Like, something got closed.",
    "start": "4386800",
    "end": "4393220"
  },
  {
    "text": "There was a cost to\nadding this HTLC. You know, there was a\ncost to having me stuck with this HTLC for five hours.",
    "start": "4393220",
    "end": "4400340"
  },
  {
    "text": "Right? Something unchained happened. So the thing is, having one\nHTLC stuck for a few hours",
    "start": "4400340",
    "end": "4406240"
  },
  {
    "text": "is no big deal. After 5:00, Alice\njust goes to Bob",
    "start": "4406240",
    "end": "4411340"
  },
  {
    "text": "and is like, look,\nwell let's clear it. Right? You don't know R. If you knew\nR, you would've told me by now,",
    "start": "4411340",
    "end": "4416822"
  },
  {
    "text": "so let's just get\nrid of this thing. And Bob's like, yeah, fine. And they clear it out.",
    "start": "4416822",
    "end": "4422630"
  },
  {
    "text": "So the idea is it's\nnot a big attack if you only have one of them. You want some cost\nto performing that.",
    "start": "4422630",
    "end": "4429460"
  },
  {
    "text": "And so if Bob\ncloses the channel-- whether it's Carol's\nfault or Bob's fault-- Alice is sort of like, look,\nwell something happened,",
    "start": "4429460",
    "end": "4434788"
  },
  {
    "text": "so someone's bearing\nthe cost for this. So they're not going\nto keep doing it. OK. AUDIENCE: So in reality, is\nit maybe like five hours,",
    "start": "4434788",
    "end": "4441970"
  },
  {
    "text": "or is it more like\ncouple minutes? TADGE DRYJA: You actually\nneed hours because--",
    "start": "4441970",
    "end": "4447190"
  },
  {
    "text": "oh, other attack. AUDIENCE: Yeah. TADGE DRYJA: Let's say\nthese were both at 5:00.",
    "start": "4447190",
    "end": "4453480"
  },
  {
    "text": "Right? And then, Carol closes\nthe channel right at 5:00.",
    "start": "4453480",
    "end": "4459170"
  },
  {
    "text": " Right before 5:00 o'clock, Carol\ncloses the channel, uses R,",
    "start": "4459170",
    "end": "4467000"
  },
  {
    "text": "grabs it. Bob then says, oh shoot, there's\nR. Alice is like, nuh uh. Alice closes the channel right\nafter 5:00 and grabs hers",
    "start": "4467000",
    "end": "4475010"
  },
  {
    "text": "by signing with her key. And then, Bob's screwed. Right? Bob's like, shoot. Wait. Carol just got the\nmoney from me using R.",
    "start": "4475010",
    "end": "4481443"
  },
  {
    "text": "And then, Alice closed\nand got the money from me using the time out. And I didn't get anything.",
    "start": "4481443",
    "end": "4487160"
  },
  {
    "text": "I lost the money on this side,\nand I didn't get the money on this side. So Bob just had a\nhuge loss there.",
    "start": "4487160",
    "end": "4494460"
  },
  {
    "text": "So Bob really wants to make\nsure that this is later. Like, Alice can't get\nthe money until well",
    "start": "4494460",
    "end": "4500720"
  },
  {
    "text": "after Carol can get the money\nwith the timeout function. Or sorry, well after Bob can\nget his money with the timeout.",
    "start": "4500720",
    "end": "4507620"
  },
  {
    "text": "AUDIENCE: Did Bob\nset that time though? TADGE DRYJA: Yeah. Hold on.",
    "start": "4507620",
    "end": "4513110"
  },
  {
    "text": "Bob sets this time, yes. Then, Alice sets this time. AUDIENCE: So he just has to\nmake sure they're [INAUDIBLE]..",
    "start": "4513110",
    "end": "4518448"
  },
  {
    "text": "TADGE DRYJA: Yeah, he has\nto make sure his earlier. And continuing that, if\nCarol makes HTLC today--",
    "start": "4518448",
    "end": "4526730"
  },
  {
    "text": "if she makes it at 3:00\no'clock or whatever-- I don't remember\nwhat the defaults are in the different-- like,\nI do it all in testnet.",
    "start": "4526730",
    "end": "4533690"
  },
  {
    "text": "And so in testnet, I do five\nblocks because who cares. I think in the main net\none's people are trying out,",
    "start": "4533690",
    "end": "4539480"
  },
  {
    "text": "they do quite a bit\nmore because it's better to have your money stuck for a\nday than to lose it, I guess.",
    "start": "4539480",
    "end": "4548030"
  },
  {
    "text": "So you can make different\ntime outs and stuff like that. OK, what else? I'm, basically, done.",
    "start": "4548030",
    "end": "4554019"
  },
  {
    "text": "There's a whole bunch of\nother cool things you can do. And I think I'll talk\nabout that next time.",
    "start": "4554020",
    "end": "4560390"
  },
  {
    "text": "Yeah, you can do\ncross chain swaps. So this is a preview of after-- just real quick.",
    "start": "4560390",
    "end": "4565850"
  },
  {
    "text": "This channel and\nthis channel do not need to be on the\nsame blockchain. Totally fine for this to be\nBitcoin and this to be Litecoin",
    "start": "4565850",
    "end": "4571790"
  },
  {
    "text": "or this to be Dogecoin. It actually totally works. So that's kind of cool.",
    "start": "4571790",
    "end": "4578220"
  },
  {
    "text": "Security. So you want to monitor your\nchannels in case someone tries to rip you off.",
    "start": "4578220",
    "end": "4583400"
  },
  {
    "text": "You can outsource that\nin a nice way where you can give it to a\nthird party and say, hey, I've got this channel.",
    "start": "4583400",
    "end": "4589760"
  },
  {
    "text": "Watch it for me. Not only that. I've got a channel. Watch it for me. I'm not going to\ntell you what channel it is, how much money I have.",
    "start": "4589760",
    "end": "4595250"
  },
  {
    "text": "Basically, anything. And you can still\nprotect it for me. So that's, kind of, cool.",
    "start": "4595250",
    "end": "4600480"
  },
  {
    "text": "You can anonymously do that. Stuck HTLCs, I\njust talked about. Dust and fees gets really ugly.",
    "start": "4600480",
    "end": "4606200"
  },
  {
    "text": "There's a lot of cool\nstuff you can do. So I think the\nschedule is I'll talk about the rest of lightning\non Monday after spring break,",
    "start": "4606200",
    "end": "4613970"
  },
  {
    "text": "and then go into discrete\nlog contracts, which is another similar construction\non the Wednesday after.",
    "start": "4613970",
    "end": "4620070"
  },
  {
    "text": "OK. Any questions about\nall this stuff? I'm sure, yeah. AUDIENCE: What are the\ntime factors that miners",
    "start": "4620070",
    "end": "4628060"
  },
  {
    "text": "pose to this situation? TADGE DRYJA: Miners can\nmake time outs not happen. If they're coordinated,\nthey can say",
    "start": "4628060",
    "end": "4635170"
  },
  {
    "text": "we're just going to not accept\nthis transaction till later. So that's bad.",
    "start": "4635170",
    "end": "4640590"
  },
  {
    "text": "You know, there's other\nweird attack factors. The one that I\nworry about most--",
    "start": "4640590",
    "end": "4645640"
  },
  {
    "text": "not most-- the one\nthat I worry about is, if you make a backup of\nyour wallet and you restore it,",
    "start": "4645640",
    "end": "4652510"
  },
  {
    "text": "you lose all your money. So you make a backup here at\nstate two onto your USB stick,",
    "start": "4652510",
    "end": "4662679"
  },
  {
    "text": "and you go home, and you\ndrop your laptop in the pool. And you're like, shoot. Well, good thing\nI got my backup.",
    "start": "4662680",
    "end": "4670630"
  },
  {
    "text": "Well, sorry. You make a backup here at\nwork on your USB stick. And then, you keep\nspending money.",
    "start": "4670630",
    "end": "4676530"
  },
  {
    "text": "And then, you drop your\nlaptop in the pool. And then, you restore from\nyour USB stick to here.",
    "start": "4676530",
    "end": "4681870"
  },
  {
    "text": "And then, you try\nto broadcast this. But you've already\nrevealed your private keys.",
    "start": "4681870",
    "end": "4687150"
  },
  {
    "text": "And so Bob's just like, what? Like, that's red. Like, you revealed it. And then, he takes\nall the money.",
    "start": "4687150",
    "end": "4694880"
  },
  {
    "text": "So yeah, don't make backups. The reason I worry about it\nis it's very counterintuitive.",
    "start": "4694880",
    "end": "4701322"
  },
  {
    "text": "There's nothing in the\nsoftware that does this. The software I can write, like,\nyou know, don't make backups. Always only keep this, but\nyou can just copy the files.",
    "start": "4701322",
    "end": "4709250"
  },
  {
    "text": "And it seems like the\nkind of thing people might do and put warnings\non the read me's and stuff.",
    "start": "4709250",
    "end": "4716119"
  },
  {
    "text": "So that's, kind of, a big risk. So there's a lot of how\ndo we make this safe. And a lot of people\ncriticize it.",
    "start": "4716120",
    "end": "4722300"
  },
  {
    "text": "Like, this is too complicated. There's enormous\ncommunities on the internet that hate this and hate me.",
    "start": "4722300",
    "end": "4728090"
  },
  {
    "text": "And go to RBTC sometimes. They really don't like\nthe Lightning Network. ",
    "start": "4728090",
    "end": "4734719"
  },
  {
    "text": "On the other hand, it's like,\nwell, you don't like it, you don't have to use it. Right? I'm just running the software\nfor free for you guys",
    "start": "4734720",
    "end": "4740025"
  },
  {
    "text": "but anyway. But yeah, and you know,\nthere's legitimate, like, this is kind\nof complicated.",
    "start": "4740025",
    "end": "4746967"
  },
  {
    "text": "It's not going to\nwork for everything. There's all sorts of\nlimits to this too.",
    "start": "4746967",
    "end": "4754239"
  }
]