[
  {
    "text": "[Music] my name is R SM I'm going to talk about",
    "start": "6990",
    "end": "12679"
  },
  {
    "text": "Storage storage at Uber uh and particular about how you build big",
    "start": "12679",
    "end": "17960"
  },
  {
    "text": "scalable Power Systems this is some work that we have been doing over the last Almost 3 years",
    "start": "17960",
    "end": "24599"
  },
  {
    "text": "2 and a half years plus uh inmark actually not here",
    "start": "24599",
    "end": "30880"
  },
  {
    "text": "in so in case you're not from Denmark we have a uber office uh in OS and Uber is",
    "start": "30880",
    "end": "38120"
  },
  {
    "text": "as sort of as you know a global company where we do riots across the world uh and the engineering organization is",
    "start": "38120",
    "end": "44879"
  },
  {
    "text": "actually also distributed across the world um so we have offices in in",
    "start": "44879",
    "end": "49960"
  },
  {
    "text": "Denmark we have offices in Bulgaria and a bunch of places in the US too um and",
    "start": "49960",
    "end": "56800"
  },
  {
    "text": "and for myself uh so I worked there for about three years um primarily on storage before that I have worked on a",
    "start": "56800",
    "end": "63559"
  },
  {
    "text": "bunch of other companies um VMware mostly um and VMware actually did uh the",
    "start": "63559",
    "end": "70320"
  },
  {
    "text": "what was called virtual Center it was the management platform for building out uh ESX servers across a big data center",
    "start": "70320",
    "end": "77799"
  },
  {
    "text": "so that is actually somewhat similar to uh what we ended up doing here at Uber of managing our huge Fleet of storage",
    "start": "77799",
    "end": "85960"
  },
  {
    "text": "systems uh and if any of you remember what your website is it's pretty amazing",
    "start": "85960",
    "end": "91920"
  },
  {
    "text": "um all righty uh let me just sort of set the stage for for this storage system um",
    "start": "92079",
    "end": "97960"
  },
  {
    "text": "so I want to tell you a little bit about how Uber Works um I assume you sort of know what",
    "start": "97960",
    "end": "103360"
  },
  {
    "text": "Uber is right you you install an app on your phone you uh request a ride and so",
    "start": "103360",
    "end": "109719"
  },
  {
    "text": "forth uh so on the top of our stack of course we have the the cell phone app and that basically talks to a layer we",
    "start": "109719",
    "end": "116719"
  },
  {
    "text": "call the Marketplace so this is where we're matching riders with drivers the marketplace system keeps track of",
    "start": "116719",
    "end": "122600"
  },
  {
    "text": "all active trips that are going on at any given time so it tracks all the GPS coordinates it matches finds the closest",
    "start": "122600",
    "end": "129119"
  },
  {
    "text": "car keep track of the route and and so forth uh and then when the the driver",
    "start": "129119",
    "end": "134200"
  },
  {
    "text": "clicks end trip then it basically generates a Json blop with all the GPS",
    "start": "134200",
    "end": "139480"
  },
  {
    "text": "tracks you know who the rider was who the driver was was the search uh and all",
    "start": "139480",
    "end": "144640"
  },
  {
    "text": "kind of interesting information there's like 20 40 fields or something like that",
    "start": "144640",
    "end": "150040"
  },
  {
    "text": "and that g basically get put into the back end of the system and the back end of the system has to do you know send an",
    "start": "150040",
    "end": "156720"
  },
  {
    "text": "email with a receipt has to charge the credit card has to eventually put in some money into the driver's bank",
    "start": "156720",
    "end": "162800"
  },
  {
    "text": "account uh and so forth it does a lot of Fraud and then those kind of things all",
    "start": "162800",
    "end": "169159"
  },
  {
    "text": "those data all those trip histories all those receipts of course has to be stored uh in some kind of storage system",
    "start": "169159",
    "end": "175440"
  },
  {
    "text": "and this is what we call operational storage this is the storage that basically drivve the whole thing it has",
    "start": "175440",
    "end": "180640"
  },
  {
    "text": "all the city definitions all the user accounts all the the trips that has been done and so forth um and that's what I'm",
    "start": "180640",
    "end": "188280"
  },
  {
    "text": "going to talk about today we also have a warehouse where everything gets into it's all of a big Hado hdfs kind of",
    "start": "188280",
    "end": "195280"
  },
  {
    "text": "thingy where you can do all kind of queries that's not the part that I'm going to talk about going to talk about the operational part uh and the key",
    "start": "195280",
    "end": "202080"
  },
  {
    "text": "thing about the operational part is that this is actually part of the online business right so when you are in the app and requesting like I want to see my",
    "start": "202080",
    "end": "208920"
  },
  {
    "text": "past trip history I want to see my receipts I want to look up my account I want to change my phone number and those",
    "start": "208920",
    "end": "214120"
  },
  {
    "text": "kind of things that's what is in operational storage now uh as as most startups uh you start",
    "start": "214120",
    "end": "222599"
  },
  {
    "text": "out small uh and simple so not very long ago actually two years ago everything",
    "start": "222599",
    "end": "230000"
  },
  {
    "text": "was in a single postr database pretty much uh and of course we had sort of",
    "start": "230000",
    "end": "235840"
  },
  {
    "text": "scaled that up and bought a big machine and had a lot of ssds and those kind of things but it was sort of clear this was",
    "start": "235840",
    "end": "242519"
  },
  {
    "text": "early uh 2014 it was sort of clear that this is not going to work uh forever um actually",
    "start": "242519",
    "end": "250480"
  },
  {
    "text": "it's probably not going to work by Halloween uh if we don't do anything uh about this problem of scaling out our",
    "start": "250480",
    "end": "257799"
  },
  {
    "text": "storage by by January 2 Halloween 2014 then Uber will basically stop",
    "start": "257799",
    "end": "264400"
  },
  {
    "text": "working um so it's pretty clear now that we actually succeeded in solving this problem we we're still still here of",
    "start": "264400",
    "end": "270280"
  },
  {
    "text": "course uh but that was sort of the the challenge we had like what do we do um",
    "start": "270280",
    "end": "276800"
  },
  {
    "text": "and just sort of you know when you can sort of look in Insight uh of where we were it's pretty easy to see that you",
    "start": "276800",
    "end": "282759"
  },
  {
    "text": "know this was definitely something we needed to do about uh January two 2014",
    "start": "282759",
    "end": "288039"
  },
  {
    "text": "um is basically where that era was and at that time we actually didn't really do very many trips um today we do almost",
    "start": "288039",
    "end": "295120"
  },
  {
    "text": "50 times more trips than we did at that time and that's only two and a half years ago uh so things are growing",
    "start": "295120",
    "end": "300600"
  },
  {
    "text": "really really fast and since we have changed to the storage system I'm going to talk about that we actually been able",
    "start": "300600",
    "end": "306120"
  },
  {
    "text": "to scale to this sort of massive growth um we just did our two billionth trip uh",
    "start": "306120",
    "end": "311759"
  },
  {
    "text": "in June this year uh was is sort of a major Milestone U right now we do just so for",
    "start": "311759",
    "end": "319120"
  },
  {
    "text": "sort of reference um about 5 million trips a week which basically means that every second there's 60 people uh",
    "start": "319120",
    "end": "325720"
  },
  {
    "text": "getting out of an Uber across the world so it's uh",
    "start": "325720",
    "end": "331639"
  },
  {
    "text": "it's fairly big if you follow if you compared to Twitter of course it's very few but this is actually real people",
    "start": "332280",
    "end": "338800"
  },
  {
    "text": "moving around in in the real world now when you have to address this problem right so we have this postr",
    "start": "338800",
    "end": "345080"
  },
  {
    "text": "database you have millions of lines of code that uh that basically access all",
    "start": "345080",
    "end": "350759"
  },
  {
    "text": "these tables we had hundreds plus tables to to keep track of this whole system so how do you sort of go about attacking",
    "start": "350759",
    "end": "356440"
  },
  {
    "text": "that you cannot just say well in 6 months we're going to rewrite the whole system and and things will be good um so",
    "start": "356440",
    "end": "361960"
  },
  {
    "text": "you have to sort of figure out where to attack it so we did some analysis uh of the data we had in the post database and",
    "start": "361960",
    "end": "368560"
  },
  {
    "text": "not too surprising it turns out the trips is sort of the big thing right you know this is basically what we do uh we",
    "start": "368560",
    "end": "374960"
  },
  {
    "text": "do a r of trips uh so 70% of the data was more or less trips in the postgress",
    "start": "374960",
    "end": "381120"
  },
  {
    "text": "database so we decided to address this up front and say well this is the first problem we're going to attack by",
    "start": "381120",
    "end": "387000"
  },
  {
    "text": "Halloween and if we can get trips out of the post data store we will be in good shape um it turns out that it was not",
    "start": "387000",
    "end": "395160"
  },
  {
    "text": "just scale and and latency and those kind of things that were problem it was actually also that making changes to a",
    "start": "395160",
    "end": "403160"
  },
  {
    "text": "big relational database turned out to be sort of complicated sometimes when people needed a new index let's say you",
    "start": "403160",
    "end": "408960"
  },
  {
    "text": "need a new index on a trip table the whole postr database will stall and then everything stalls in the whole system so",
    "start": "408960",
    "end": "415840"
  },
  {
    "text": "we also wanted to have a system where developers very very quickly could make change es to the data it didn't have and",
    "start": "415840",
    "end": "421919"
  },
  {
    "text": "they could do it online without taking the system down you know this is sort of you know the system itself is sort of a",
    "start": "421919",
    "end": "428280"
  },
  {
    "text": "ship that has left the harbor right you cannot stop it it has to keep going you can never turn it off so everything we",
    "start": "428280",
    "end": "434120"
  },
  {
    "text": "do to the system has to be done online um so very simply that is sort of",
    "start": "434120",
    "end": "441199"
  },
  {
    "text": "the the world we we want to get to at that point and and the world we are in now where we still use post and my SQL",
    "start": "441199",
    "end": "448800"
  },
  {
    "text": "uh and all database Technologies um for various things but but sort of the main",
    "start": "448800",
    "end": "454080"
  },
  {
    "text": "part is the schema system the marketplace is actually run mostly on Cassandra uh and those kind of things so",
    "start": "454080",
    "end": "460639"
  },
  {
    "text": "there's sort of a bunch of different Technologies in",
    "start": "460639",
    "end": "465039"
  },
  {
    "text": "play the system we have then ended up building now two and a half years later I have come up with is U is a fairly",
    "start": "465759",
    "end": "473080"
  },
  {
    "text": "substantial system I would say it it's not just storing trips uh it's storing",
    "start": "473080",
    "end": "479039"
  },
  {
    "text": "uh uh a lot of different databases for a lot of our services it's installed",
    "start": "479039",
    "end": "484440"
  },
  {
    "text": "across multiple data centers across the world uh there's a huge amount of",
    "start": "484440",
    "end": "489479"
  },
  {
    "text": "self-service and self-healing infrastructure uh and I'm actually going to spend a little bit of time too",
    "start": "489479",
    "end": "495039"
  },
  {
    "text": "talking about sort of the operational aspects of running a huge system that runs across thousands and thousands of",
    "start": "495039",
    "end": "502080"
  },
  {
    "text": "hosts uh so it's I I'm sort of thinking about",
    "start": "502080",
    "end": "508159"
  },
  {
    "text": "installing a single databases easy right you know once you want to have 300",
    "start": "508159",
    "end": "513518"
  },
  {
    "text": "databases uh across thousands of hosts it's sort of becomes very interesting so",
    "start": "513519",
    "end": "520200"
  },
  {
    "text": "a quick summary sort of the status where we are uh today about 80% of the data",
    "start": "520200",
    "end": "525920"
  },
  {
    "text": "particularly user uh user accounts and trips stored in this system um we have",
    "start": "525920",
    "end": "531120"
  },
  {
    "text": "gone from this single trips data store that we actually targeted uh back in 2014 to more than 300 data stores uh uh",
    "start": "531120",
    "end": "540120"
  },
  {
    "text": "and this is B think of these are Separate Tables or separate databases instances if you will um Uber is a very",
    "start": "540120",
    "end": "547160"
  },
  {
    "text": "microservice oriented architecture so basically Services can get their own storage uh and and back in the in the",
    "start": "547160",
    "end": "553920"
  },
  {
    "text": "days when we set up the first 48 machine cluster to to run trips you know we",
    "start": "553920",
    "end": "559399"
  },
  {
    "text": "thought that was huge uh we have since revised sort of our idea of what is huge",
    "start": "559399",
    "end": "565680"
  },
  {
    "text": "um but it's something that that scales uh and grows and and again if you look",
    "start": "565680",
    "end": "571279"
  },
  {
    "text": "at the graph we basically double every six months right so things just sort of quickly gets bigger and bigger and",
    "start": "571279",
    "end": "577560"
  },
  {
    "text": "bigger um okay so let's dive into a little bit about the how schema has been",
    "start": "577560",
    "end": "584040"
  },
  {
    "text": "designed uh and is working and as all systems when you start up building a new system you sort",
    "start": "584040",
    "end": "590440"
  },
  {
    "text": "of look at you know how does it has to perform you know what kind of features should it have what should the availability be and so forth the",
    "start": "590440",
    "end": "598000"
  },
  {
    "text": "interesting thing as you know if you look at all these requirements it's always a trade-off but you cannot just",
    "start": "598000",
    "end": "603839"
  },
  {
    "text": "say I want the perfect API I want it to scale you know uh without any bounds it",
    "start": "603839",
    "end": "610560"
  },
  {
    "text": "has to be super efficient it has to cost nothing and so forth so it always sort of a trade-off uh and particularly with",
    "start": "610560",
    "end": "617000"
  },
  {
    "text": "storage systems this is definitely a trade-off you cannot just get full consistency and full availability and",
    "start": "617000",
    "end": "623519"
  },
  {
    "text": "those kind of things this is what the for example the cap theum tells us so there has to be some kind of trade-off",
    "start": "623519",
    "end": "629320"
  },
  {
    "text": "and you really have to figure out sort of what storage model does really work for for your problem um and then the",
    "start": "629320",
    "end": "635399"
  },
  {
    "text": "final part is sort of the time to Market uh at at the time when we started doing this we knew we had six months so",
    "start": "635399",
    "end": "641560"
  },
  {
    "text": "whatever we decided to do it had to be done within six months so you're not you know you're not going to reinvent the",
    "start": "641560",
    "end": "647079"
  },
  {
    "text": "world or spend three months sort of prototyping some uh idea you you actually want to have something rather",
    "start": "647079",
    "end": "653959"
  },
  {
    "text": "simple because you are going to run this in production it has to work",
    "start": "653959",
    "end": "659639"
  },
  {
    "text": "so let me just quickly go through sort of the basic requirements we had when we decided designed the",
    "start": "659639",
    "end": "665600"
  },
  {
    "text": "system um the first part was IND indexes uh indices was super important as all",
    "start": "665600",
    "end": "672760"
  },
  {
    "text": "the code that that was running ruber was written to work against the postgress database and they are used to having",
    "start": "672760",
    "end": "677800"
  },
  {
    "text": "indices and and there was lot of um queries like you know the one that I I show here on the right where you're sort",
    "start": "677800",
    "end": "684079"
  },
  {
    "text": "of looking up all the trips for a particular user in some kind of time range the code here was written in most",
    "start": "684079",
    "end": "691399"
  },
  {
    "text": "of the code was written in Python using SQL Alchemy directly into the um into",
    "start": "691399",
    "end": "697279"
  },
  {
    "text": "the post database so in some sense we were actually in good shape because people didn't write SQL statements",
    "start": "697279",
    "end": "702440"
  },
  {
    "text": "itself it was actually modeled using uh SQL Alchemy R uses classes and so forth",
    "start": "702440",
    "end": "709200"
  },
  {
    "text": "so we can actually fairly easy if we had the right abstraction sort of change these classes inside the existing code",
    "start": "709200",
    "end": "716360"
  },
  {
    "text": "and then it will suddenly call into the scheal system the the next requirement was on batch",
    "start": "716360",
    "end": "724519"
  },
  {
    "text": "operation so if you if you sort of think about how Uber works right is that people take a trip a trip comes into the",
    "start": "724519",
    "end": "731240"
  },
  {
    "text": "system you have to build it you have to do payouts you have to do some fraud detection you have to do various kind of",
    "start": "731240",
    "end": "738639"
  },
  {
    "text": "analytics uh and then you just sort of sit there so it's very much sort of computing in the front of data or you",
    "start": "738639",
    "end": "744920"
  },
  {
    "text": "can think think of it sort of as a stream of data that is moving in that you sort of have to be",
    "start": "744920",
    "end": "750120"
  },
  {
    "text": "processing so we also wanted the the trips data store to sort of support that model that all these trips are sort of",
    "start": "750120",
    "end": "756199"
  },
  {
    "text": "trickling in we do a lot of computation on them uh we ideally do it it potently so you don't get charged you know twice",
    "start": "756199",
    "end": "762920"
  },
  {
    "text": "for the same trip or or worse that we we forget to pay out the the driver so we",
    "start": "762920",
    "end": "768600"
  },
  {
    "text": "had to have sort of a robust system for processing all these trips uh and then they sort of lay dominant um and this is",
    "start": "768600",
    "end": "775320"
  },
  {
    "text": "actually very true we have done some analysis where we sort of look at the access wait to trips you know after it's",
    "start": "775320",
    "end": "781160"
  },
  {
    "text": "been taken and you know you you can imagine it sort of a curve that sort of goes like this um there's of course a",
    "start": "781160",
    "end": "786760"
  },
  {
    "text": "little bit people look up the trip histories um but you know as as opposed to Facebook where people go and look",
    "start": "786760",
    "end": "792160"
  },
  {
    "text": "every time you know looking at past trip histories is not sort of a favorite pastime yet so uh that was the the",
    "start": "792160",
    "end": "800240"
  },
  {
    "text": "second requirement uh and then the last one uh as I mentioned before we are big into microservices uh the Uber system",
    "start": "800240",
    "end": "807600"
  },
  {
    "text": "actually consist of more than a thousand microservices most of them are fairly",
    "start": "807600",
    "end": "812639"
  },
  {
    "text": "simple but this is the idea with microservices they call into other microservices to to to perform some kind",
    "start": "812639",
    "end": "817920"
  },
  {
    "text": "of function but uh a bunch of them of course have State uh and then basically",
    "start": "817920",
    "end": "823360"
  },
  {
    "text": "get their own local database or we call it data store their own local data store this can be a mySQL database but it can",
    "start": "823360",
    "end": "830120"
  },
  {
    "text": "also be a data store backed by schemes which is basically just uh scalable to",
    "start": "830120",
    "end": "835440"
  },
  {
    "text": "to whether you want to store trips uh trip scale data um similar",
    "start": "835440",
    "end": "840759"
  },
  {
    "text": "stuff um so it's important to build a system where we sort of quickly can support this model of creating new data",
    "start": "840759",
    "end": "847560"
  },
  {
    "text": "stores tearing down data stores when a microservice dies or sort of get decommissioned and replaced by other",
    "start": "847560",
    "end": "853920"
  },
  {
    "text": "ones and generally the this sort of microservice Architecture is making it",
    "start": "853920",
    "end": "859440"
  },
  {
    "text": "very agile to make stuff right because we can easily add a new feature we can easily take out a new feature uh take",
    "start": "859440",
    "end": "866360"
  },
  {
    "text": "out a feature that is not needed anymore has been replaced by by a better implementation as it single uh single",
    "start": "866360",
    "end": "872720"
  },
  {
    "text": "microservices and as each microservice has their own storage it's sort of clear exactly you know what storage belongs to",
    "start": "872720",
    "end": "879000"
  },
  {
    "text": "this we can migrate it into a new data store if need be and and and then of course the",
    "start": "879000",
    "end": "884680"
  },
  {
    "text": "obvious one you know the data sort of has to be stored on discs somewhere and this is sort of the Crocs of the problem",
    "start": "884680",
    "end": "891000"
  },
  {
    "text": "of scale because these discs uh are not really very big you can maybe get a two",
    "start": "891000",
    "end": "896519"
  },
  {
    "text": "terabyte uh or or maybe a 16 gab if you're lucky U and then actually this",
    "start": "896519",
    "end": "902320"
  },
  {
    "text": "disc actually looks like this nowadays just in case it's just so kind of nice with the old ones but you know we",
    "start": "902320",
    "end": "908720"
  },
  {
    "text": "underst store this across a lot of ssds uh and how many ssds do you really need well uh it doesn't take a lot of",
    "start": "908720",
    "end": "917320"
  },
  {
    "text": "calculation to sort of figureing out that let's say you have an SSD card with two terabytes uh you STI four of those",
    "start": "917320",
    "end": "923360"
  },
  {
    "text": "into a server then you have a server with 8 terabyte if you want to store a pyte um which is sort of the scale real",
    "start": "923360",
    "end": "929000"
  },
  {
    "text": "looking at here you know one two terab terabytes you need at least 128 machines",
    "start": "929000",
    "end": "934560"
  },
  {
    "text": "and you cannot just thr it on one machine right because machines dies racks dies data centers goes off so what",
    "start": "934560",
    "end": "942000"
  },
  {
    "text": "we normally do is actually replicating data across two data centers and we end up having four copies uh so that means",
    "start": "942000",
    "end": "948720"
  },
  {
    "text": "for a pedite you need 52 machines so that that's already very serious amount",
    "start": "948720",
    "end": "954759"
  },
  {
    "text": "of machine and infrastructure you need that and that's actually only a pide you know this is just sort of the the the",
    "start": "954759",
    "end": "960199"
  },
  {
    "text": "tip of the iceberg of the scale that that we eventually will get to here U you can ask why 8 T why don't you just",
    "start": "960199",
    "end": "966519"
  },
  {
    "text": "use a bigger machine of course you can do that but the number still gets big uh and and I'll talk about a little bit later why uh making that number bigger",
    "start": "966519",
    "end": "974199"
  },
  {
    "text": "too has a different set of problems actually the the API uh that we did uh",
    "start": "974199",
    "end": "981639"
  },
  {
    "text": "and again you sort of have okay what is Trips Trips is really just a stream of data coming in uh all these trips",
    "start": "981639",
    "end": "989279"
  },
  {
    "text": "actually tracking real life events that are happening out uh in the real world uh and the nice thing about events is",
    "start": "989279",
    "end": "996240"
  },
  {
    "text": "that they are sort of by definition immutable you know they happened and this is what happened and that is",
    "start": "996240",
    "end": "1002079"
  },
  {
    "text": "actually how we want to model our data inside Uber when we track trips is that it's sort of a stream of changes that we",
    "start": "1002079",
    "end": "1008959"
  },
  {
    "text": "we that we track so so the way we designed this API and also inspired by",
    "start": "1008959",
    "end": "1014319"
  },
  {
    "text": "for example a big table from from Google and other places where is just sort of a",
    "start": "1014319",
    "end": "1020040"
  },
  {
    "text": "big column uh or sort of a table style API where you for a given row you can",
    "start": "1020040",
    "end": "1025918"
  },
  {
    "text": "store a number of columns in each column you can just store Json blobs um so this this is the schema less aspect you just",
    "start": "1025919",
    "end": "1032079"
  },
  {
    "text": "store a random Json blob you can store whatever it is the developers can change that Json blob anytime they want to",
    "start": "1032079",
    "end": "1038360"
  },
  {
    "text": "store something else you don't have to make any table modifications to this um and then you can think of a trip coming",
    "start": "1038360",
    "end": "1044438"
  },
  {
    "text": "in as like here's a base information about a trip you know this is the rer driver",
    "start": "1044439",
    "end": "1049600"
  },
  {
    "text": "here is the route it's another column with the GPS points then there's some process that kicks in saying ah based on",
    "start": "1049600",
    "end": "1055679"
  },
  {
    "text": "this I can compute uh the fair then it stores the fair and we basically store all this information so each row is sort",
    "start": "1055679",
    "end": "1062760"
  },
  {
    "text": "of the entire sort of computation or history of one particular trip and this",
    "start": "1062760",
    "end": "1067840"
  },
  {
    "text": "is all immutable so we have the whole track we can go back and say well at this given time uh you know we computed",
    "start": "1067840",
    "end": "1074559"
  },
  {
    "text": "this value for this field uh and this is very important because because this is actually transactional sort of business",
    "start": "1074559",
    "end": "1081559"
  },
  {
    "text": "transactions that we are tracking if you are if you are familiar with the lamp",
    "start": "1081559",
    "end": "1087240"
  },
  {
    "text": "architecture that they very much Advocate this model where you never overwrite data you really want to keep",
    "start": "1087240",
    "end": "1093960"
  },
  {
    "text": "all values uh in your database just in case right you you could have code uh",
    "start": "1093960",
    "end": "1099919"
  },
  {
    "text": "that accidentally overwrite your data and and then you are sort of in a bad place so so this is actually following",
    "start": "1099919",
    "end": "1106679"
  },
  {
    "text": "this model this also means that this is an pend only data store you once you write a cell you cannot overwrite it",
    "start": "1106679",
    "end": "1113080"
  },
  {
    "text": "again that value is there you can write a new value in in the same uh in the",
    "start": "1113080",
    "end": "1118320"
  },
  {
    "text": "same row uh and the same column but with a different uh time stamp if you want to and this sort of how we track changes",
    "start": "1118320",
    "end": "1124600"
  },
  {
    "text": "over time it turns out that from a scalability perspective this API also makes it very very easy to scale which",
    "start": "1124600",
    "end": "1131360"
  },
  {
    "text": "is also nice um so how do we actually scale it uh the physical layout of the",
    "start": "1131360",
    "end": "1138320"
  },
  {
    "text": "database is that we take each of these rows uh it is using uid the uid I just",
    "start": "1138320",
    "end": "1143760"
  },
  {
    "text": "have a very short one here to get it to fit uh on the slide but in practice it's 128bit uid and and we just do module uh",
    "start": "1143760",
    "end": "1151960"
  },
  {
    "text": "4k on that um that value and divide it pre-art it into a number of charts uh",
    "start": "1151960",
    "end": "1159200"
  },
  {
    "text": "and these charts are then collocated on a set of uh database clusters or my SQL",
    "start": "1159200",
    "end": "1165159"
  },
  {
    "text": "clusters so we didn't have to reinvent sort of a big storage technology we",
    "start": "1165159",
    "end": "1170400"
  },
  {
    "text": "basically take a rock solid foundation MySQL MySQL has uh support for basically",
    "start": "1170400",
    "end": "1177360"
  },
  {
    "text": "replicating uh into slaves right across multiple even across data centers and so forth so we're reusing the async",
    "start": "1177360",
    "end": "1183440"
  },
  {
    "text": "replication in my SQL we are reusing all the query capabilities for indices and so forth from my SQL and just have this",
    "start": "1183440",
    "end": "1190559"
  },
  {
    "text": "in some sense fairly thin uh sharting layer on top of my SQL to to sh it out",
    "start": "1190559",
    "end": "1196559"
  },
  {
    "text": "like like this uh and then we can actually run up to you know 4,000 clusters here if we want to as as we",
    "start": "1196559",
    "end": "1203640"
  },
  {
    "text": "shout but we start out with with typically relatively few clusters let's say eight or 16 and so forth and I'll",
    "start": "1203640",
    "end": "1210840"
  },
  {
    "text": "talk a little bit about how we we actually uh can expand this dynamically as we go but the trick here",
    "start": "1210840",
    "end": "1218919"
  },
  {
    "text": "again is that it's actually very very simple uh and very very simple translate into robustness uh and this is really",
    "start": "1218919",
    "end": "1226480"
  },
  {
    "text": "what what we after the the next feature which which is sort of unique uh and and actually hard to",
    "start": "1226480",
    "end": "1233080"
  },
  {
    "text": "find in a lot of these scaleout Solutions is the efficient indices U and",
    "start": "1233080",
    "end": "1238640"
  },
  {
    "text": "and as as I mentioned earlier this is a key thing that that we had to support uh to to support the migration from the old",
    "start": "1238640",
    "end": "1245080"
  },
  {
    "text": "codebase to to to this one and the idea with indices is that for a you you",
    "start": "1245080",
    "end": "1251320"
  },
  {
    "text": "basically specify an index we see it here on the right it's called the client index and it basic say every time you",
    "start": "1251320",
    "end": "1257000"
  },
  {
    "text": "write the column base then take the field client ID uh and shot on that uh and then store",
    "start": "1257000",
    "end": "1265840"
  },
  {
    "text": "an entry based on that client ID and this is what you see here on the left if I do a a put cell now I'm putting a base",
    "start": "1265840",
    "end": "1273039"
  },
  {
    "text": "column at you know the U ID here is 100 uh and if you let's assume we just have",
    "start": "1273039",
    "end": "1278919"
  },
  {
    "text": "four sharts as shown here if you do 100 model of four it it's cell shot zero so",
    "start": "1278919",
    "end": "1284559"
  },
  {
    "text": "it will be stored on on the Zero shot right now there's a index defined for",
    "start": "1284559",
    "end": "1289840"
  },
  {
    "text": "for the base column here and then on the client ID we take the client ID and also",
    "start": "1289840",
    "end": "1296559"
  },
  {
    "text": "shot on that uh and that means that we end up having an index entry on chart two and that's based on the client ID",
    "start": "1296559",
    "end": "1303440"
  },
  {
    "text": "and that has a reference then to um the the real cell or the real row which is",
    "start": "1303440",
    "end": "1309480"
  },
  {
    "text": "100 uh and if you can see how this works that let's say this is I'm client ID 10",
    "start": "1309480",
    "end": "1315360"
  },
  {
    "text": "and I take another trip well my trip just gets random U ID right so they get distributed across all the",
    "start": "1315360",
    "end": "1321279"
  },
  {
    "text": "shots but my client ID ends up being the same",
    "start": "1321279",
    "end": "1326840"
  },
  {
    "text": "uh and since now the index is shoted on client ID all the index entries ends up",
    "start": "1326840",
    "end": "1332080"
  },
  {
    "text": "on the same shot so if I now have to do a query to find all my trips I know I",
    "start": "1332080",
    "end": "1337400"
  },
  {
    "text": "can just do that on chart two and get all those U IDs I don't have to do a distributed query across all the",
    "start": "1337400",
    "end": "1342840"
  },
  {
    "text": "Clusters uh to find that so it's very very efficient indices U and in in this",
    "start": "1342840",
    "end": "1348200"
  },
  {
    "text": "particular case we also included the fair this is basically what we call a denormalized field that I can very",
    "start": "1348200",
    "end": "1353760"
  },
  {
    "text": "quickly get access to the fair Tobe so I don't have to sort of go back and and pick it out on the original",
    "start": "1353760",
    "end": "1360480"
  },
  {
    "text": "cells the last feature is the the ability to sort of process the trips as",
    "start": "1361000",
    "end": "1367000"
  },
  {
    "text": "they come in um and this is also sort of very cool uh in the sense that as it's",
    "start": "1367000",
    "end": "1373400"
  },
  {
    "text": "an app pendon data store that that means you it is really also just a log and you",
    "start": "1373400",
    "end": "1378799"
  },
  {
    "text": "can think of all their pens if you order them by the time they're put in it is just a long sequence lock and we",
    "start": "1378799",
    "end": "1384279"
  },
  {
    "text": "actually have an API that allows you to sort of look at well what happened in exactly this range you know how did the",
    "start": "1384279",
    "end": "1390799"
  },
  {
    "text": "database look in in this time range we can actually look that up uh and we can",
    "start": "1390799",
    "end": "1396760"
  },
  {
    "text": "use that if we just have some we call them triggers that sort of looks in the front of the database all the time say",
    "start": "1396760",
    "end": "1403360"
  },
  {
    "text": "what happened you know what got put in now and then you basically just get a call back say you know somebody called in put in a base column for this row",
    "start": "1403360",
    "end": "1411000"
  },
  {
    "text": "somebody put in you know a route column for this row and so forth so we can sort of tail the front of the datab base all",
    "start": "1411000",
    "end": "1416919"
  },
  {
    "text": "the time and and this is what we use to drive all the backend processing uh of all the flows and there is one simple uh",
    "start": "1416919",
    "end": "1425400"
  },
  {
    "text": "API call to basically do this we call it partition read um you can sort of think it sort of an analogy is would be tail",
    "start": "1425400",
    "end": "1433559"
  },
  {
    "text": "on a file if you're on Unix you can sort of tail everything that gets into the database and then the triggers basically",
    "start": "1433559",
    "end": "1439880"
  },
  {
    "text": "just sort of look at ah there's a base column coming in ah there's a route already exist for this row ah I can",
    "start": "1439880",
    "end": "1446799"
  },
  {
    "text": "compute fair and then it computes fair and puts fairs into the database then there's another tailor that says Ah",
    "start": "1446799",
    "end": "1453559"
  },
  {
    "text": "there's base and there's a fair ah I can do client building and and we just sort of process it all so by moving through",
    "start": "1453559",
    "end": "1460720"
  },
  {
    "text": "all these shots uh in this way we actually treat the database both as sort",
    "start": "1460720",
    "end": "1466120"
  },
  {
    "text": "of the the primary operational storage but also as the sort of the Quee of things that needs to get",
    "start": "1466120",
    "end": "1472320"
  },
  {
    "text": "processed and then we don't end up in this sort of we have to store the information twice it can get out of sync",
    "start": "1472320",
    "end": "1478200"
  },
  {
    "text": "do we have to do two- phase commits in two different system and so forth all that stuff uh uh is basically not needed",
    "start": "1478200",
    "end": "1485480"
  },
  {
    "text": "which also translated into a simpler uh and more robust",
    "start": "1485480",
    "end": "1491039"
  },
  {
    "text": "system so that sort of uh SK is just the sort of the the core database uh in a",
    "start": "1491039",
    "end": "1497480"
  },
  {
    "text": "nutshell and and as you can see it is a big table style API so if you're",
    "start": "1497480",
    "end": "1503600"
  },
  {
    "text": "used to something like that well I guess you're only if you work for Google but uh that's that's sort of how it is it's",
    "start": "1503600",
    "end": "1510000"
  },
  {
    "text": "sort of a very standard API it turns out that this API is applicable a lot of",
    "start": "1510000",
    "end": "1516080"
  },
  {
    "text": "places so we have written it was originally designed to do the trips uh we use it for a ton of stuff now it",
    "start": "1516080",
    "end": "1522480"
  },
  {
    "text": "turns out it it's It just fits for a lot of St a lot of places there's and",
    "start": "1522480",
    "end": "1527679"
  },
  {
    "text": "especially we are in a business where we are sort of tracking real life events um this is sort of what you want to do you",
    "start": "1527679",
    "end": "1533240"
  },
  {
    "text": "don't want to override you don't want to you want to keep a lock of everything that has happened uh it's horizontal",
    "start": "1533240",
    "end": "1538880"
  },
  {
    "text": "scalable by Shing which you have to do in some way or another and U we can both",
    "start": "1538880",
    "end": "1545799"
  },
  {
    "text": "scale the io and the capacity by adding more clusters so cool um talk a little bit about",
    "start": "1545799",
    "end": "1553880"
  },
  {
    "text": "availability and once you get into operation right people will click on on the app and On's right and it sort of",
    "start": "1553880",
    "end": "1560559"
  },
  {
    "text": "has to work all the time so so how does this system fair in the in the case of",
    "start": "1560559",
    "end": "1566360"
  },
  {
    "text": "availability and this is sort of where where the rber hits the road in some sense right that that anybody can write",
    "start": "1566360",
    "end": "1573000"
  },
  {
    "text": "a system uh uh or you you can buy some kind of thing but you know no matter what kind",
    "start": "1573000",
    "end": "1578520"
  },
  {
    "text": "of uh product you buy whether it's something you know for for the garden",
    "start": "1578520",
    "end": "1584039"
  },
  {
    "text": "for the kitchen or for your data center that the difference is you know how does it hold up you know once you start",
    "start": "1584039",
    "end": "1589679"
  },
  {
    "text": "stressing and when when everything starts to fail right does it suddenly just fall off a cliff performance wise",
    "start": "1589679",
    "end": "1596440"
  },
  {
    "text": "or does it suddenly start losing data and you cannot get it started for for minutes and so forth um so so this is",
    "start": "1596440",
    "end": "1603360"
  },
  {
    "text": "clearly very important to us that it's something that we can we have high confidence uh that is working all the",
    "start": "1603360",
    "end": "1610799"
  },
  {
    "text": "time and when it's not working we can fix it very very quickly uh that that is just super important you know there's no",
    "start": "1610799",
    "end": "1617360"
  },
  {
    "text": "time to call anyone uh when when that happens so so let look into a little bit about what happens",
    "start": "1617360",
    "end": "1623120"
  },
  {
    "text": "actually U and the fundamental thing here everything is in MySQL databases so we basically have to make sure these",
    "start": "1623120",
    "end": "1629000"
  },
  {
    "text": "MySQL databases are up uh so this is where we spend a lot of time sort of",
    "start": "1629000",
    "end": "1634279"
  },
  {
    "text": "worrying about keeping them up well we don't really want to keep them up but we want to make sure that when something",
    "start": "1634279",
    "end": "1640360"
  },
  {
    "text": "bad happens to them we can quickly recover because they are going to die once in a while discs dies hose dies",
    "start": "1640360",
    "end": "1646600"
  },
  {
    "text": "racks dies or they get miscon figured uh or or people accidentally turn them off",
    "start": "1646600",
    "end": "1651760"
  },
  {
    "text": "uh well you know what so if a slave dies it's not not a big deal right we we we",
    "start": "1651760",
    "end": "1656840"
  },
  {
    "text": "still have the master we still have a second slave everything is fine uh so life goes on uh slaves we really only",
    "start": "1656840",
    "end": "1664039"
  },
  {
    "text": "have to to recover in case the master goes down so what happens if a master dies well we have to sort of write to",
    "start": "1664039",
    "end": "1671240"
  },
  {
    "text": "the SQL database so if there is a trip coming in that has the right for example to that shot uh how do you you know what",
    "start": "1671240",
    "end": "1679159"
  },
  {
    "text": "do we do about that right and we really only have two options well either we can fail and says sorry you not cannot write",
    "start": "1679159",
    "end": "1685519"
  },
  {
    "text": "right now you have to wait a little bit uh and that is actually an okay answer for some cases right because a bunch of",
    "start": "1685519",
    "end": "1691679"
  },
  {
    "text": "the stuff that we do is batch processing like sending out receipts and trips so this is actually something that we can",
    "start": "1691679",
    "end": "1697320"
  },
  {
    "text": "safely delay without thought of doing you know too bad of a user experience in",
    "start": "1697320",
    "end": "1703159"
  },
  {
    "text": "some sense it doesn't mean that you cannot get right um but what we the the problem of course is that the caller",
    "start": "1703159",
    "end": "1709519"
  },
  {
    "text": "wants this stuff to be persisted and replicated so we never lose it so we",
    "start": "1709519",
    "end": "1714600"
  },
  {
    "text": "actually have this what we call Buffer rights uh or what if you're used to Cassandra terminology call hinted",
    "start": "1714600",
    "end": "1720360"
  },
  {
    "text": "handoff where well we'll just thr it somewhere else right we have more than one cluster we have 16 or we have maybe",
    "start": "1720360",
    "end": "1725880"
  },
  {
    "text": "128 clusters so we can just store it in one of those clusters so we just sort of put it aside and said okay it's fine",
    "start": "1725880",
    "end": "1731559"
  },
  {
    "text": "we'll taken care of it uh it's sted it's replicated we'll never lose it uh but",
    "start": "1731559",
    "end": "1737200"
  },
  {
    "text": "you cannot read it right you you'll be able to read it later uh that that's sort of the guarantee we get",
    "start": "1737200",
    "end": "1743360"
  },
  {
    "text": "uh and the API is very simple just just the put cells and you say if you want this semantics if you really want really",
    "start": "1743360",
    "end": "1750720"
  },
  {
    "text": "high availability or really high durability you just say it's okay to buffer it it's fine I just need to get",
    "start": "1750720",
    "end": "1756240"
  },
  {
    "text": "you know to get this thought I don't need to read it right away it's fine uh and we do that when trips actually come",
    "start": "1756240",
    "end": "1763120"
  },
  {
    "text": "down from the marketplace in into the system uh and the reason why this works is is because all this processing",
    "start": "1763120",
    "end": "1769799"
  },
  {
    "text": "exactly happen by triggers right so people don't need to read this right away the triggers uh doesn't need to",
    "start": "1769799",
    "end": "1775880"
  },
  {
    "text": "know that this actually got put aside in s of this hinted handoff table once it gets put back into the right place when",
    "start": "1775880",
    "end": "1782399"
  },
  {
    "text": "the master is alive the triggers runs and everything works flawlessly so this is s of the nice thing about an an asuk",
    "start": "1782399",
    "end": "1789240"
  },
  {
    "text": "uh programming model Now growth what you know as as I",
    "start": "1789240",
    "end": "1796000"
  },
  {
    "text": "said we are we're growing every um basically doubling every six months",
    "start": "1796000",
    "end": "1803000"
  },
  {
    "text": "so so what happens when when these clusters gets full um and this is also in some sense simple um I'll show a",
    "start": "1803000",
    "end": "1810399"
  },
  {
    "text": "little bit picture of how simple it really was uh but in principle we we just create a new cluster on the side we",
    "start": "1810399",
    "end": "1817440"
  },
  {
    "text": "set up my SQL replication so all these six databases will have the same amount of data uh and then now we have two",
    "start": "1817440",
    "end": "1825000"
  },
  {
    "text": "duplicate setups uh and then we can basically just tear them apart so now",
    "start": "1825000",
    "end": "1830840"
  },
  {
    "text": "they're separate with the same data uh and then we'll just configure the distribution layer say well half of the",
    "start": "1830840",
    "end": "1836039"
  },
  {
    "text": "Shadows on one side or the other half is on the other side uh and delete them and then we're basically done what we call a",
    "start": "1836039",
    "end": "1841360"
  },
  {
    "text": "split uh so we can basically double the size of the whole system by doubling all",
    "start": "1841360",
    "end": "1846440"
  },
  {
    "text": "the Clusters at any point and that is actually a fairly fast",
    "start": "1846440",
    "end": "1851480"
  },
  {
    "text": "operation so the key thing here uh is really to",
    "start": "1851480",
    "end": "1857200"
  },
  {
    "text": "handle all these my SQL instances um so so let me dive into a little bit about how we do this uh and",
    "start": "1857200",
    "end": "1864720"
  },
  {
    "text": "how fast is it actually possible to to create a new a myql database U and and",
    "start": "1864720",
    "end": "1869960"
  },
  {
    "text": "this is actually also interesting uh you have these networks right uh on",
    "start": "1869960",
    "end": "1875880"
  },
  {
    "text": "host uh and you have discs on host uh and if you want to get data into a host you have to get it through the network",
    "start": "1875880",
    "end": "1882880"
  },
  {
    "text": "and if you have a 10 gab 10 gbit uh Nick on your host the amount of data you you",
    "start": "1882880",
    "end": "1888000"
  },
  {
    "text": "can get into a host in an hour is about 3.6 terabyte that that's actually sort of the maximum uh in practice you can",
    "start": "1888000",
    "end": "1895679"
  },
  {
    "text": "probably get much less in because you're using your network for other stuff too U and if a host",
    "start": "1895679",
    "end": "1902120"
  },
  {
    "text": "dies uh it it typically has to be restored in less than 30 minutes uh ideally much faster right so how do you",
    "start": "1902120",
    "end": "1910039"
  },
  {
    "text": "deal with this uh in in the example I had before there was 8 terab in dis space in each host right we have host",
    "start": "1910039",
    "end": "1916760"
  },
  {
    "text": "that are that are much bigger like with 100 terab and so forth how can you actually restore that and says Ah those",
    "start": "1916760",
    "end": "1922120"
  },
  {
    "text": "100 terab is going to take forever to get through the network to get that um",
    "start": "1922120",
    "end": "1927440"
  },
  {
    "text": "the answer of course as it always is when you're writing storage system is that you have to partition stuff uh so",
    "start": "1927440",
    "end": "1934080"
  },
  {
    "text": "and the trick here is you don't have to think about the host you have to think about the data uh and you should think",
    "start": "1934080",
    "end": "1939279"
  },
  {
    "text": "about the host just as as a conduit for a bunch of data blocks uh and what you",
    "start": "1939279",
    "end": "1944360"
  },
  {
    "text": "want to restore is not the host it's the data blocks and you can restore those data blocks in parallel if let's say",
    "start": "1944360",
    "end": "1951799"
  },
  {
    "text": "there was 16 data blocks which is all 5 12 gigabytes then you can actually",
    "start": "1951799",
    "end": "1957000"
  },
  {
    "text": "restore them in 30 minutes in parallel across a lot of hosts so we actually",
    "start": "1957000",
    "end": "1962080"
  },
  {
    "text": "have not only to partition the data across all the host we also have to partition them within the host so when a",
    "start": "1962080",
    "end": "1967919"
  },
  {
    "text": "host dies we can just restore the the chunks in parallel in a lot of systems",
    "start": "1967919",
    "end": "1973799"
  },
  {
    "text": "and then we can actually doesn't really matter how much dis host has it just means means that when something dies we",
    "start": "1973799",
    "end": "1978919"
  },
  {
    "text": "just have to have more parallelism in the case where we start up so let me move into the the operational a scale so",
    "start": "1978919",
    "end": "1987000"
  },
  {
    "text": "so how do you start thinking about this right because now an operation is not just about a host right it's suddenly",
    "start": "1987000",
    "end": "1992600"
  },
  {
    "text": "like if a host dies I have to find 16 new hosts you know I have to start things in parallel and 16",
    "start": "1992600",
    "end": "1999279"
  },
  {
    "text": "things that that doesn't happen sort of like by itself and uh so this basic going to talk about",
    "start": "1999279",
    "end": "2006480"
  },
  {
    "text": "this sort of red block uh and and I sort of think of the the storage system is that you want to keep",
    "start": "2006480",
    "end": "2012760"
  },
  {
    "text": "the storage system itself as minimal as possible uh and then you want to have a side system I call it an outer shell or",
    "start": "2012760",
    "end": "2019880"
  },
  {
    "text": "something like that that knows how to manage this and this is sort of a microservice architecture for for",
    "start": "2019880",
    "end": "2025360"
  },
  {
    "text": "storage Services itself right that you don't want it as sort of one monolitic block right because the operational",
    "start": "2025360",
    "end": "2030960"
  },
  {
    "text": "system we have a tendency to have you know it's something you can update much quicker uh and and with a less risk than",
    "start": "2030960",
    "end": "2038679"
  },
  {
    "text": "than sort of the core storage engine so having this separated out makes a lot of sense in practice and basically once we",
    "start": "2038679",
    "end": "2046679"
  },
  {
    "text": "operate this let's say we have you know a few thousand um host we have multiple",
    "start": "2046679",
    "end": "2053118"
  },
  {
    "text": "data centers we have a lot of data stores we basically want to be able to grow this you know grow and grow and",
    "start": "2053119",
    "end": "2058638"
  },
  {
    "text": "grow without having more people um for one one reason is that you know of course it's much more cost effective to",
    "start": "2058639",
    "end": "2064720"
  },
  {
    "text": "have fewer people operating bigger systems uh the the bigger problem really is that you cannot hire more people fast",
    "start": "2064720",
    "end": "2070480"
  },
  {
    "text": "enough so in some you just have to fix it you know it is like um people just",
    "start": "2070480",
    "end": "2075839"
  },
  {
    "text": "don't exist um and the traditional way of dealing with this uh and this is",
    "start": "2075839",
    "end": "2081560"
  },
  {
    "text": "actually an actual screenshot uh of our first run book for doing a split uh so",
    "start": "2081560",
    "end": "2087440"
  },
  {
    "text": "so this sort of you know splitting things I said it's very easy you just replicate and do stuff uh in in practice",
    "start": "2087440",
    "end": "2092960"
  },
  {
    "text": "you're actually doing this on real life right there is trips going on in this system and you have to do this",
    "start": "2092960",
    "end": "2098760"
  },
  {
    "text": "uh and if if you do something bad there something bad will happen in real life",
    "start": "2098760",
    "end": "2103960"
  },
  {
    "text": "right so so there there was a long run book with a lot of checks and balances and so forth uh and the problem with",
    "start": "2103960",
    "end": "2110280"
  },
  {
    "text": "these run books is that people will not read them the same way or they will forget something or the phone will ring",
    "start": "2110280",
    "end": "2116680"
  },
  {
    "text": "or they will have to get coffee or if you read it at 4:00 at night you'll read",
    "start": "2116680",
    "end": "2121920"
  },
  {
    "text": "ah he really didn't mean that I'll skip that part uh you know so it it is just not scalable uh doing this kind of stuff",
    "start": "2121920",
    "end": "2129320"
  },
  {
    "text": "um so basically everything gets much harder with scale uh in some sense and",
    "start": "2129320",
    "end": "2136520"
  },
  {
    "text": "the the typical things we hear all the time is like well a host fails a rack fails and all those kind of things the",
    "start": "2136520",
    "end": "2141839"
  },
  {
    "text": "biggest biggest biggest biggest problem is really this drift thing you have a big system with 4,000 host let's say",
    "start": "2141839",
    "end": "2148319"
  },
  {
    "text": "that uh it just drifts if you don't keep track of it because some of the host",
    "start": "2148319",
    "end": "2154200"
  },
  {
    "text": "will have one version of the oare some versions some host will have one one version of my SQL then you have upgraded",
    "start": "2154200",
    "end": "2160079"
  },
  {
    "text": "some of your operational agents and some of them then somebody has has aged into some of the host and applied some",
    "start": "2160079",
    "end": "2165960"
  },
  {
    "text": "commands uh inconsistently with some other place uh then there's some half done operations somewhere else uh and if",
    "start": "2165960",
    "end": "2173040"
  },
  {
    "text": "you don't do something it just ends up being complete chaos uh and then thirdly",
    "start": "2173040",
    "end": "2180040"
  },
  {
    "text": "sort of lastly or separately in some sens is that once you did once we did the trips data store we were really",
    "start": "2180040",
    "end": "2187079"
  },
  {
    "text": "deeply involved with the developers doing the trips data store right so we knew the access pattern we could",
    "start": "2187079",
    "end": "2193520"
  },
  {
    "text": "optimize the the indices and so forth but once you get into scale when you have hundreds and hundreds of developers",
    "start": "2193520",
    "end": "2200240"
  },
  {
    "text": "using these data stores you really don't know how what data they are storing in there you don't know how to use the indices and so forth so they're tooling",
    "start": "2200240",
    "end": "2207119"
  },
  {
    "text": "around troubleshooting performance uh creating new indices and so forth just has to be much much better right because",
    "start": "2207119",
    "end": "2213920"
  },
  {
    "text": "they have to be able to do it at s at scale otherwise you cannot on board all the developers in your organization to",
    "start": "2213920",
    "end": "2219359"
  },
  {
    "text": "use this stuff uh so this is also a site that we spend a lot of energy on but I'll mostly focus on sort of the",
    "start": "2219359",
    "end": "2225680"
  },
  {
    "text": "operational part and how you actually um work with this sort of drift thing um",
    "start": "2225680",
    "end": "2233319"
  },
  {
    "text": "and that there are some famous slides this is actually a slide I've stolen from from I think actually a guy",
    "start": "2233319",
    "end": "2238760"
  },
  {
    "text": "Microsoft uh that I think back in 2012 he presented this pets versal cattle idea uh and this is a picture of my",
    "start": "2238760",
    "end": "2246680"
  },
  {
    "text": "daughter's rabbit um and it has a very good life uh it's",
    "start": "2246680",
    "end": "2251920"
  },
  {
    "text": "getting cared for it's called biscuit uh and and the thing about these things like when when you have your pets it's",
    "start": "2251920",
    "end": "2258560"
  },
  {
    "text": "like you care for them all the time even when they are not sick you constantly go and check them uh and it turns out that",
    "start": "2258560",
    "end": "2264440"
  },
  {
    "text": "if you're a developer and have your little uh service and and and you you know you go",
    "start": "2264440",
    "end": "2270200"
  },
  {
    "text": "into work every day it's like ah I'm just going to run a Detro on it just to see if it's fine maybe maybe there's something I can improve that that's how",
    "start": "2270200",
    "end": "2277040"
  },
  {
    "text": "Developers things too right but you have one you have to sort of get into at some point into the the cattle mode where",
    "start": "2277040",
    "end": "2283920"
  },
  {
    "text": "saying like I have a lot right and what matters is that I have a lot uh it",
    "start": "2283920",
    "end": "2289599"
  },
  {
    "text": "doesn't matter that I know all of them by name um and if some of them dies I'll",
    "start": "2289599",
    "end": "2296319"
  },
  {
    "text": "get another one because what matters is that I have them all right uh and I want",
    "start": "2296319",
    "end": "2301920"
  },
  {
    "text": "most of them to be healthy of course um so so what does this mean um How can you",
    "start": "2301920",
    "end": "2307800"
  },
  {
    "text": "whether you're sort of in the pets mode or in the cattle world uh and and there",
    "start": "2307800",
    "end": "2313040"
  },
  {
    "text": "are some very distinct signs that you can sort of see your organization um in",
    "start": "2313040",
    "end": "2318119"
  },
  {
    "text": "in if you in the pets world then there is some developer in your organization you can go and ask he would know",
    "start": "2318119",
    "end": "2323960"
  },
  {
    "text": "everything about the system uh and if he's not there nobody would know uh that that sort of the thing uh all the",
    "start": "2323960",
    "end": "2331480"
  },
  {
    "text": "changes is something about locking into machines running some uh you know big",
    "start": "2331480",
    "end": "2337000"
  },
  {
    "text": "runbook B if you're lucky otherwise he just knows what commands to run on on all the things uh and the most telling",
    "start": "2337000",
    "end": "2343319"
  },
  {
    "text": "one and then this is definitely true is that somebody knows how to do these",
    "start": "2343319",
    "end": "2348520"
  },
  {
    "text": "commands and he is immensely cool uh right because he is all of the magician that that knows all the unix commands",
    "start": "2348520",
    "end": "2354280"
  },
  {
    "text": "that will fix stuff uh and this is how all organizations works I'm pretty sure",
    "start": "2354280",
    "end": "2359640"
  },
  {
    "text": "you have all been there uh or are there to to a certain extent and this is where it has to start when it's small it's",
    "start": "2359640",
    "end": "2366040"
  },
  {
    "text": "easy to do this kind of things but as you scale you sort of have to get out of this that you really want to move to a",
    "start": "2366040",
    "end": "2372079"
  },
  {
    "text": "world where you describe what you want you actually don't really care whether a storage uh a databas is on one host or",
    "start": "2372079",
    "end": "2379640"
  },
  {
    "text": "the other all you care about is that this cluster exists and it has uh three slaves and and put it wherever you",
    "start": "2379640",
    "end": "2387000"
  },
  {
    "text": "want and this is what we call Gold State uh and this means that this whole notion",
    "start": "2387000",
    "end": "2392160"
  },
  {
    "text": "of having these uh you know experts that that knows all the commands is sort of",
    "start": "2392160",
    "end": "2397640"
  },
  {
    "text": "like a nonevent you actually don't want any experts you want all your developers start writing code uh that makes the",
    "start": "2397640",
    "end": "2403079"
  },
  {
    "text": "business better and the system just do it itself right just like this is what we do um so some examples of gold state",
    "start": "2403079",
    "end": "2411119"
  },
  {
    "text": "gold state is really about sort of describing what you want in in a way",
    "start": "2411119",
    "end": "2417440"
  },
  {
    "text": "that the system itself can remediate it um so so a non stor analogy is that well",
    "start": "2417440",
    "end": "2424079"
  },
  {
    "text": "if you have a service you say tell the system I need to run run this service I need to have five instances then the",
    "start": "2424079",
    "end": "2430720"
  },
  {
    "text": "system knows that you need five instances you know the alternative is that you go in and say deploy an",
    "start": "2430720",
    "end": "2436200"
  },
  {
    "text": "instance on machine X deploy an instance on machine y deploy an instance on machine uh you know t or something like",
    "start": "2436200",
    "end": "2443720"
  },
  {
    "text": "that the the problem is if you specified in that way to the system then if one of these machine goes down then the system",
    "start": "2443720",
    "end": "2449440"
  },
  {
    "text": "has no idea what to do it's like well Machine to die I don't know do you want three instance do you want five instance you started again has no idea so you",
    "start": "2449440",
    "end": "2456119"
  },
  {
    "text": "want to move to a model where you can describe what it does so in case something fails you can automatically",
    "start": "2456119",
    "end": "2461640"
  },
  {
    "text": "remediate um if you take a look at these ones uh from from the bottom then you",
    "start": "2461640",
    "end": "2467400"
  },
  {
    "text": "can see I just describe to the system I need instance X then the system says I need to cre an instance okay it needs",
    "start": "2467400",
    "end": "2474160"
  },
  {
    "text": "some clusters uh that that's sort of the second one so I run the Clusters well a",
    "start": "2474160",
    "end": "2479200"
  },
  {
    "text": "cluster needs a master database so we create a master database then another rule kick sentence is well all Masters",
    "start": "2479200",
    "end": "2484359"
  },
  {
    "text": "should have slaves so we add slaves uh and so for for if a slave dies a rule",
    "start": "2484359",
    "end": "2489640"
  },
  {
    "text": "kicks in and says Ah there there's a slave missing for this one I'll create another one if a host dies you know a",
    "start": "2489640",
    "end": "2495560"
  },
  {
    "text": "bunch of slaves will be missing somewhere the system can just go in and create it this might sound a little",
    "start": "2495560",
    "end": "2501000"
  },
  {
    "text": "complicated um but is actually a fairly simple pattern U that we use all the time uh which is this on how to",
    "start": "2501000",
    "end": "2508400"
  },
  {
    "text": "basically deal with this gold State uh system and the idea is that the operator never works directly on anything he just",
    "start": "2508400",
    "end": "2515359"
  },
  {
    "text": "goes in and changes the model describing what he wants this is sort of the gold state on the top here with the Green",
    "start": "2515359",
    "end": "2521640"
  },
  {
    "text": "Arrow and we constantly go in and monitor what is the exact state of the",
    "start": "2521640",
    "end": "2528040"
  },
  {
    "text": "system at any given point and we put that into the actual State then we basically run a diff uh in some sense",
    "start": "2528040",
    "end": "2534280"
  },
  {
    "text": "you know we can report on the drift uh on the diff it is actually a report on the drift you know how different is the",
    "start": "2534280",
    "end": "2540960"
  },
  {
    "text": "real system from from the the um from the desired State and then we can",
    "start": "2540960",
    "end": "2547200"
  },
  {
    "text": "basically have rules that says well based on these drifts I'll kick off some workflows to go and remediate it and",
    "start": "2547200",
    "end": "2552960"
  },
  {
    "text": "this is a continuous process that runs and runs and runs right so we constantly",
    "start": "2552960",
    "end": "2558760"
  },
  {
    "text": "keep track of any kind of drift whether it's simple stuff like you know the OS is different versions uh or or maybe",
    "start": "2558760",
    "end": "2566760"
  },
  {
    "text": "it's just saying that well this OS has run too long you know we want to reboot all our machines every 14 days you know",
    "start": "2566760",
    "end": "2572880"
  },
  {
    "text": "so we'll just go and do that and we can ensure that the entire fleet is done and as a develop this is just a that runs",
    "start": "2572880",
    "end": "2578240"
  },
  {
    "text": "all the time so okay um in some sense it's a",
    "start": "2578240",
    "end": "2583920"
  },
  {
    "text": "very very simple pattern but it's super powerful so a very ex simple example of",
    "start": "2583920",
    "end": "2590720"
  },
  {
    "text": "where we use gold state we actually use this in several levels we use it at the top level where we're talking about",
    "start": "2590720",
    "end": "2595839"
  },
  {
    "text": "databases and clusters but we push it all the way down into the host so when",
    "start": "2595839",
    "end": "2600960"
  },
  {
    "text": "we have to start we run multiple my SQL servers on each host uh because of this",
    "start": "2600960",
    "end": "2606920"
  },
  {
    "text": "s sort of uh chunking we have to do for for ReStore we actually have an agent on each host uh and that agent and as",
    "start": "2606920",
    "end": "2614720"
  },
  {
    "text": "agents are they are supposed to be active entities right so that agent basically runs this gold state Loop and",
    "start": "2614720",
    "end": "2620000"
  },
  {
    "text": "and it goes in up to the the management software which we call UPS uh and pulls what is my desired State uh and then it",
    "start": "2620000",
    "end": "2627599"
  },
  {
    "text": "goes and does local uh basically ps's or or dog PS stuff like that to figure out",
    "start": "2627599",
    "end": "2633160"
  },
  {
    "text": "what is actually running on that host and ensures that all the processes on this toast matches the gold state it's",
    "start": "2633160",
    "end": "2639400"
  },
  {
    "text": "the only uh thing it does and then it also reports on the actual State all the time so this means that when we when we",
    "start": "2639400",
    "end": "2647000"
  },
  {
    "text": "make a change to the gold state it sort of automatically get pulled into all the machines uh and if if you're making a",
    "start": "2647000",
    "end": "2653359"
  },
  {
    "text": "change and a machine is down it's okay you know it's down for a little while or the network is down or maybe it's",
    "start": "2653359",
    "end": "2658440"
  },
  {
    "text": "partitioned or whatever at some point it comes up and these machines will come back up and pull the state and basically",
    "start": "2658440",
    "end": "2665440"
  },
  {
    "text": "get them back into where where they're supposed to be this is super scalable too right because we don't have one",
    "start": "2665440",
    "end": "2670760"
  },
  {
    "text": "process that has to sort of manage thousands of host across all databases this is a big distributor system running",
    "start": "2670760",
    "end": "2676599"
  },
  {
    "text": "across the whole thing so a very simple example um let's assume we have sort of",
    "start": "2676599",
    "end": "2683240"
  },
  {
    "text": "Two Hosts here with a master and a slave in my SQL and this is basically set up in this table saying that you know food",
    "start": "2683240",
    "end": "2689119"
  },
  {
    "text": "DB1 should be a master food db2 should be a slave let's say I want to do a slave promotion you know you can imagine",
    "start": "2689119",
    "end": "2695319"
  },
  {
    "text": "if I've done that with my SQL it's executing all kind of weird commands everywhere um you have to wait for",
    "start": "2695319",
    "end": "2701280"
  },
  {
    "text": "application lag to go down and then so forth what we do is basically just changing this gold State uh and then we",
    "start": "2701280",
    "end": "2707640"
  },
  {
    "text": "sit back uh or get coffee somewhere or and that once you change this gold",
    "start": "2707640",
    "end": "2715000"
  },
  {
    "text": "state right we just have to wait for the obsess agents to basically pull this state this is happening as so they could",
    "start": "2715000",
    "end": "2720520"
  },
  {
    "text": "pull it in uh in any um it could get to one of the host first uh and let's just",
    "start": "2720520",
    "end": "2725599"
  },
  {
    "text": "say it gets to the right one first this one says that well I can it knows the agent knows that well I'm a slave in",
    "start": "2725599",
    "end": "2732160"
  },
  {
    "text": "order to do Transition to a master I have to have all the latest data I can only ensure that I have the latest data",
    "start": "2732160",
    "end": "2737760"
  },
  {
    "text": "if the one I'm replicating for is read only so it's basically sitting there waiting but but the active Loop actually",
    "start": "2737760",
    "end": "2743079"
  },
  {
    "text": "happens all the way out on the host right so there's very little latency uh in this Loop uh and then once the data",
    "start": "2743079",
    "end": "2749880"
  },
  {
    "text": "propagates into the to the other host where it says Ah I'm supposed to get idle I'm not supposed to be a master it",
    "start": "2749880",
    "end": "2755559"
  },
  {
    "text": "basically means that it goes into r mode then the other agent uh figures that out",
    "start": "2755559",
    "end": "2760720"
  },
  {
    "text": "say oh now the one I'm I'm I'm slaving from now has stopped uh being a master",
    "start": "2760720",
    "end": "2766800"
  },
  {
    "text": "uh it's read only my replication lag has gone to zero I become a master uh and then you suddenly do this very very",
    "start": "2766800",
    "end": "2774079"
  },
  {
    "text": "simple two very simple State machines running on two different machines with very little coordination um and of",
    "start": "2774079",
    "end": "2781280"
  },
  {
    "text": "course this is all driven through um an IUI where we have tons of workflows where we can just do this",
    "start": "2781280",
    "end": "2787520"
  },
  {
    "text": "um this is sort of phase one because the ideal thing is of course why do anybody",
    "start": "2787520",
    "end": "2792920"
  },
  {
    "text": "has to click a button um and this is actually the what we're moving into right now is that this slay promotion of",
    "start": "2792920",
    "end": "2800559"
  },
  {
    "text": "course has to happen really really quickly so we're actually moving away from do using MySQL replication and the",
    "start": "2800559",
    "end": "2806680"
  },
  {
    "text": "MySQL host is uh run in a raft cluster so we basically have a process in front",
    "start": "2806680",
    "end": "2811839"
  },
  {
    "text": "of that that selects who is the master and replicates the uh all the rights using consensus protocol to the",
    "start": "2811839",
    "end": "2818079"
  },
  {
    "text": "different databases uh and that means that if some if um if database becomes unavailable maybe even temporary it",
    "start": "2818079",
    "end": "2825280"
  },
  {
    "text": "automatically does the master election in less than 100 milliseconds which is actually fast enough that for most",
    "start": "2825280",
    "end": "2831480"
  },
  {
    "text": "clients they would notice they don't most of course increase in the lack but we do",
    "start": "2831480",
    "end": "2836599"
  },
  {
    "text": "retries and then it's completely transparent so this this is also a way of sort of pushing uh this sort of gold",
    "start": "2836599",
    "end": "2844079"
  },
  {
    "text": "state down there saying that well now the ra consensus prod just make your goal state is just to ensure that one of",
    "start": "2844079",
    "end": "2849240"
  },
  {
    "text": "them is writable uh uh and you handle this so This is actually the end and I",
    "start": "2849240",
    "end": "2857839"
  },
  {
    "text": "think I'm also about out of time right um very very quick tour of uh some of",
    "start": "2857839",
    "end": "2863240"
  },
  {
    "text": "the highlights of this uh schem storage systems uh the takeaway here is you know",
    "start": "2863240",
    "end": "2869359"
  },
  {
    "text": "one thing is the API and another thing is the operational part and and when you're when you're doing sort of an",
    "start": "2869359",
    "end": "2875000"
  },
  {
    "text": "online business the operational part is super important uh you you really you know you develop on it all the time but",
    "start": "2875000",
    "end": "2881559"
  },
  {
    "text": "you also keep it running all the time so you spend a lot of your energy there uh and making stuff uh sort of easy to",
    "start": "2881559",
    "end": "2888680"
  },
  {
    "text": "operate at scale is is not a trivial effort we have spent serious amount of",
    "start": "2888680",
    "end": "2894040"
  },
  {
    "text": "engineering resources on this but this is really what makes it scale uh so so it is super important stuff to do so",
    "start": "2894040",
    "end": "2901720"
  },
  {
    "text": "finally um we do have a block uh in case you find found this interesting a lot of",
    "start": "2901720",
    "end": "2907559"
  },
  {
    "text": "this stuff that I've talked about the schema list migration and stuff like that there's tons of blog post on that",
    "start": "2907559",
    "end": "2913880"
  },
  {
    "text": "on our blog U I have even written one of them and uh and a part of the team up",
    "start": "2913880",
    "end": "2920000"
  },
  {
    "text": "here has written a bunch of them so go and see them there all bunch of other different stuff that we do and I think",
    "start": "2920000",
    "end": "2926640"
  },
  {
    "text": "that's it and we might have time for single question Maybe",
    "start": "2926640",
    "end": "2933599"
  },
  {
    "text": "so I guess I'll ask kind of like a future oriented question you talked a little bit about where you're going but",
    "start": "2937440",
    "end": "2942880"
  },
  {
    "text": "maybe more you can talk about see scha list storage in the next two years and",
    "start": "2942880",
    "end": "2949119"
  },
  {
    "text": "Beyond right uh so where it's going so so clearly we're growing and",
    "start": "2949119",
    "end": "2954680"
  },
  {
    "text": "growing and growing uh and storage is is very tricky right so in some sense this",
    "start": "2954680",
    "end": "2961240"
  },
  {
    "text": "system is all of the first generation what we've got uh and I think where we're going in the future is there's a",
    "start": "2961240",
    "end": "2967839"
  },
  {
    "text": "bunch of different directions um one of the thing and most of it is really about",
    "start": "2967839",
    "end": "2973400"
  },
  {
    "text": "ensuring that we have the right apis uh that makes it easy to develop Services",
    "start": "2973400",
    "end": "2979440"
  },
  {
    "text": "uh and and one of the areas where we I see where we can improve where we are today is how do you deal with data that",
    "start": "2979440",
    "end": "2985079"
  },
  {
    "text": "is partitioned across multiple data centers U we we have various Solutions today but I think we can come up with",
    "start": "2985079",
    "end": "2990480"
  },
  {
    "text": "better ones there is definitely areas where you want better transactional support uh or some kind of uh isolation",
    "start": "2990480",
    "end": "2997960"
  },
  {
    "text": "and multiple updates so so this is also we what we're looking into but we're actually spending quite a lot of time",
    "start": "2997960",
    "end": "3003760"
  },
  {
    "text": "thinking about sort of what are the perfect apis because while while the big table API is sort of is very flexible it",
    "start": "3003760",
    "end": "3011760"
  },
  {
    "text": "sometimes you want some high level abstractions uh and then there is definitely the the cross data center reliability is a big big big Focus for",
    "start": "3011760",
    "end": "3020960"
  },
  {
    "text": "us anything else one more",
    "start": "3022960",
    "end": "3028640"
  },
  {
    "text": "MH",
    "start": "3030920",
    "end": "3033920"
  },
  {
    "text": "elely right so the question is about indices how do we ensure that they actually updated consistency uh and and",
    "start": "3039240",
    "end": "3045480"
  },
  {
    "text": "we actually don't uh so they are secondary indices and they are eventually consistent so we don't",
    "start": "3045480",
    "end": "3050720"
  },
  {
    "text": "guarantee that they're updated at the same time as as the primary sell is written so so typically",
    "start": "3050720",
    "end": "3057480"
  },
  {
    "text": "it will be uh so so we definitely try to do that but if that database is down",
    "start": "3057480",
    "end": "3062839"
  },
  {
    "text": "uh that shot is down where the index is hitting that that will just sort of be put aside also in sort of hinted handoff",
    "start": "3062839",
    "end": "3068440"
  },
  {
    "text": "and applied later so the the secondary indices are eventually consistent this is one of the things that we're actually",
    "start": "3068440",
    "end": "3073480"
  },
  {
    "text": "looking for in the future uh to think about having making them consistent",
    "start": "3073480",
    "end": "3079319"
  },
  {
    "text": "[Applause]",
    "start": "3079940",
    "end": "3088229"
  }
]