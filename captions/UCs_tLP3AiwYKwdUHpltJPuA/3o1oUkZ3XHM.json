[
  {
    "text": "[Music]",
    "start": "2540",
    "end": "11400"
  },
  {
    "text": "let me uh start by saying uh thank you um do a little introduction my name is",
    "start": "11400",
    "end": "16880"
  },
  {
    "text": "Ryan Pratt I've got with me Justin flu and uh Mike Vander Blum we're all from a",
    "start": "16880",
    "end": "22439"
  },
  {
    "text": "company called uh Peak 6 Investments I'm the CTO of that firm and they're both uh senior developers within uh the Capital",
    "start": "22439",
    "end": "29439"
  },
  {
    "text": "Management business which is part of uh um the proprietary trading business",
    "start": "29439",
    "end": "35320"
  },
  {
    "text": "that's part of that business um we are here today to give a presentation in",
    "start": "35320",
    "end": "41160"
  },
  {
    "text": "particular around a system that we built over the last several years that deals with highly our high bandwidth data and",
    "start": "41160",
    "end": "47559"
  },
  {
    "text": "uh low latency systems um some of those L latency systems we've written in in",
    "start": "47559",
    "end": "52960"
  },
  {
    "text": "Java some we've written in C we're going to go through the various areas where we picked and why we picked those things um",
    "start": "52960",
    "end": "59760"
  },
  {
    "text": "and and as you can see we we have sort of a parenthetical renaming of our talk which is drinking from the fire hose",
    "start": "59760",
    "end": "65560"
  },
  {
    "text": "without losing a drop which is maybe a better uh explanation of what the",
    "start": "65560",
    "end": "70640"
  },
  {
    "text": "problem is that we're going to walk through um let me set the stage to begin",
    "start": "70640",
    "end": "76280"
  },
  {
    "text": "with uh when we first started uh dealing",
    "start": "76280",
    "end": "81560"
  },
  {
    "text": "with the or finding out about the problem that we ended up building all these systems around it was around late",
    "start": "81560",
    "end": "88759"
  },
  {
    "text": "2013 and and uh we realized we had spent the last several years building up uh a",
    "start": "88759",
    "end": "95399"
  },
  {
    "text": "new framework for how our overall trading system worked we' made a lot of use of java and along the way one of the",
    "start": "95399",
    "end": "102240"
  },
  {
    "text": "things we built was a new feed dissemination system um feed de dissemination being it's all this Market",
    "start": "102240",
    "end": "108759"
  },
  {
    "text": "data that we are listening to and using as part of our business and we have a bunch of systems that need to get at",
    "start": "108759",
    "end": "115000"
  },
  {
    "text": "that data and do various things with it and we wrote some stuff that would parse it and and hand it uh out call the",
    "start": "115000",
    "end": "120320"
  },
  {
    "text": "systems that needed to use it we had not correctly anticipated some",
    "start": "120320",
    "end": "126320"
  },
  {
    "text": "of the changes that were going to happen with the markets though and in particular one of the things we had",
    "start": "126320",
    "end": "132080"
  },
  {
    "text": "decided from a design perspective was to disseminate the the the data using uh",
    "start": "132080",
    "end": "138239"
  },
  {
    "text": "TCP which had its benefits we needed reliable delivery of this stuff and uh",
    "start": "138239",
    "end": "144560"
  },
  {
    "text": "we wanted to try to keep things as simple as possible and we had in previous iterations of building things",
    "start": "144560",
    "end": "150480"
  },
  {
    "text": "used multicast and tried to use various things for Reliable multicast and it had run into a bunch of problems so we got",
    "start": "150480",
    "end": "157239"
  },
  {
    "text": "very clever and we made something that conflated and compressed and did all this fancy stuff and we thought that we",
    "start": "157239",
    "end": "162920"
  },
  {
    "text": "would be able to manage the amount of data on our Network by uh while still being able to use TCP well 2013 came",
    "start": "162920",
    "end": "170000"
  },
  {
    "text": "along and things really started changing they they already have been a little bit on a on a move in the previous years but",
    "start": "170000",
    "end": "176400"
  },
  {
    "text": "uh they they started sort of ramping up in 2013 and the big thing that was happening",
    "start": "176400",
    "end": "181599"
  },
  {
    "text": "were the options markets were fragmenting and it really wasn't just the options Market but for Peak 6 that's where primarily we focus and by",
    "start": "181599",
    "end": "188640"
  },
  {
    "text": "fragmenting what I mean is there was a lot of new exchanges coming online uh when you go back to 2008 there were",
    "start": "188640",
    "end": "195080"
  },
  {
    "text": "sevenish exchanges uh and although one came on that year um and by today there",
    "start": "195080",
    "end": "200599"
  },
  {
    "text": "are 14 going on 16 by the end of this year options exchang and what matters around that is that every time you have",
    "start": "200599",
    "end": "207959"
  },
  {
    "text": "a new exchange come online the only thing you're sure of is that the amount of data you're going to",
    "start": "207959",
    "end": "213120"
  },
  {
    "text": "handle is going to go up you know roughly you could say double I mean it's a little more complicated than that and",
    "start": "213120",
    "end": "218560"
  },
  {
    "text": "and it doesn't mean that there's necessarily more opportunity from a trading volume perspective because really all you're knowing is there's",
    "start": "218560",
    "end": "224560"
  },
  {
    "text": "another place where there are orders and quotes for the for the uh instruments for which you might be uh trying to do",
    "start": "224560",
    "end": "230920"
  },
  {
    "text": "trading activity on but while there can be more quotes for those things it's not",
    "start": "230920",
    "end": "235959"
  },
  {
    "text": "necessarily uh going to cause any more actual trading activity and so every time you bring a new exchange online the",
    "start": "235959",
    "end": "242079"
  },
  {
    "text": "one guarantee you have is that there's more complexity in the systems you have to build and there's going to be a lot",
    "start": "242079",
    "end": "247680"
  },
  {
    "text": "more data well for for from 2008 to now to have it go from Seven exchanges to",
    "start": "247680",
    "end": "252920"
  },
  {
    "text": "close on 16 exchanges the amount of data we had to handle wouldn't crazy uh to give you a view on options",
    "start": "252920",
    "end": "260040"
  },
  {
    "text": "markets options markets are uh just quickly going over it uh us Equity options are derivative products uh where",
    "start": "260040",
    "end": "268240"
  },
  {
    "text": "uh the the the asset they're derivative of is equity so you would be familiar with this as stocks Public public stocks",
    "start": "268240",
    "end": "274560"
  },
  {
    "text": "that trade on the stock exchanges but for every one Equity that might be trading and quoting on one of the stock",
    "start": "274560",
    "end": "281280"
  },
  {
    "text": "exchanges there can be up to thou you know several thousand individual instruments that are derivative products",
    "start": "281280",
    "end": "286600"
  },
  {
    "text": "against that equity and so while there's a lot of data within the equity markets the amount of data that's just that's",
    "start": "286600",
    "end": "292560"
  },
  {
    "text": "pumped out from a quoting perspective from the options markets is orders of magnitude larger uh to the up to the",
    "start": "292560",
    "end": "298840"
  },
  {
    "text": "point uh I mean it's within the gigabits per second of data that these all of the exchanges pump out and if you're",
    "start": "298840",
    "end": "304440"
  },
  {
    "text": "Building Systems that need to deal with it you have to somehow be able to keep up with it which is where we say where",
    "start": "304440",
    "end": "310360"
  },
  {
    "text": "why I say it's like drinking from the fire hose um to give you a sense in 20 2013 the beginning of the year we were",
    "start": "310360",
    "end": "316800"
  },
  {
    "text": "underway with building a bunch of stuff for our for our for our business and we had things more or less working pretty well and by the end of the year while we",
    "start": "316800",
    "end": "323720"
  },
  {
    "text": "had successfully produced a bunch of um a bunch of uh new software that was both",
    "start": "323720",
    "end": "328759"
  },
  {
    "text": "architectural infrastructure as well as um new actual uh uh strategies for for",
    "start": "328759",
    "end": "334600"
  },
  {
    "text": "the business we also found ourselves a little bit in this crisis mode where things that had been working were no",
    "start": "334600",
    "end": "341039"
  },
  {
    "text": "longer working and I've got I've got a couple Graphics that you know as they say pictures are worth a thousand words that kind of talk through it this is",
    "start": "341039",
    "end": "347240"
  },
  {
    "text": "maybe how we felt at the beginning of of 2013 and and frankly we were maybe not quite so sure that we were getting that",
    "start": "347240",
    "end": "353680"
  },
  {
    "text": "full but we were handling it we had a big amount of data coming out of the options markets but our systems were",
    "start": "353680",
    "end": "359039"
  },
  {
    "text": "able to take it and we're able to more or less manage it and by systems I mean both our software and our Hardware we",
    "start": "359039",
    "end": "365479"
  },
  {
    "text": "were you know turning along feeling really good about things building new new strategies and midy year all of a sudden it started to go like this where",
    "start": "365479",
    "end": "373479"
  },
  {
    "text": "it's a lot more than any of our our systems both hardware and software were really able to fully manage especially",
    "start": "373479",
    "end": "379120"
  },
  {
    "text": "within the spikes and we started seeing our 20 gig capacity Network start dropping packets you know es especially",
    "start": "379120",
    "end": "386639"
  },
  {
    "text": "at the open and at other Peaks within the market day where the we were trying to push more than 20 kigs of data",
    "start": "386639",
    "end": "393240"
  },
  {
    "text": "through our routers and they were just dropping packets left and right and by the end of the year we ended up in a",
    "start": "393240",
    "end": "399120"
  },
  {
    "text": "situation that uh this short little video is probably best represented of us",
    "start": "399120",
    "end": "404199"
  },
  {
    "text": "a Jo Miller you just found the marble in the oatmeal you're a lucky lucky lucky little boy cuz you know why you get to",
    "start": "404199",
    "end": "411240"
  },
  {
    "text": "drink from the fire",
    "start": "411240",
    "end": "415199"
  },
  {
    "text": "hall",
    "start": "418520",
    "end": "421520"
  },
  {
    "text": "okay you ready yeah open [Applause]",
    "start": "428560",
    "end": "434360"
  },
  {
    "text": "wi Jo Miller let's here for him so yeah it was it was a little rough",
    "start": "434360",
    "end": "440879"
  },
  {
    "text": "and and and and the stuff that we were writing that had that was basically was fairly representative of how things were",
    "start": "440879",
    "end": "446960"
  },
  {
    "text": "starting to go it was the core of our business it was our ability to succeed in manage both capturing o finding and",
    "start": "446960",
    "end": "454400"
  },
  {
    "text": "capturing opportunity on the markets but also manage the risk we have at play required that we really be able to keep",
    "start": "454400",
    "end": "459840"
  },
  {
    "text": "up with this fire this fire hose of data otherwise you just don't know what's going on and you don't know what risk you're at so we had to come up with a",
    "start": "459840",
    "end": "468319"
  },
  {
    "text": "way to solve the problem so let me take a step back quickly talk about what pak6 is so that's the trading floor this is",
    "start": "468319",
    "end": "473960"
  },
  {
    "text": "our office we have a bunch of software that we've written and uh a bunch of uh",
    "start": "473960",
    "end": "479720"
  },
  {
    "text": "uh various systems we've put in place that are our way of creating um uh uh",
    "start": "479720",
    "end": "486520"
  },
  {
    "text": "the really the backing infrastructure for all of the Traders on the floor here to be able to implement their strategies",
    "start": "486520",
    "end": "492919"
  },
  {
    "text": "and manage the risk around them uh across the US Equity options markets Pak 6 is a what would be called a",
    "start": "492919",
    "end": "500159"
  },
  {
    "text": "proprietary trading firm and just to like what does that mean I know a lot of people have heard this and don't always know what that means it really just",
    "start": "500159",
    "end": "506400"
  },
  {
    "text": "means PX is a private it's a company that takes the the capital that is from within the company so it's no outside",
    "start": "506400",
    "end": "513000"
  },
  {
    "text": "customers or or anything like that take that Capital use our own Strat proprietary strategies and proprietary",
    "start": "513000",
    "end": "519000"
  },
  {
    "text": "software to try to trade on the market and hopefully make that Capital grow and not shrink uh doing that year after year",
    "start": "519000",
    "end": "525839"
  },
  {
    "text": "is a relatively difficult thing there's a lot of competition in the market and the technical challenges especially when",
    "start": "525839",
    "end": "531760"
  },
  {
    "text": "you try to do it at scale um are very are very Broad and very difficult and in",
    "start": "531760",
    "end": "537480"
  },
  {
    "text": "particular Peak six our strategy is about breadth it's about",
    "start": "537480",
    "end": "542760"
  },
  {
    "text": "being across the market being able to trade and be in most of the things that",
    "start": "542760",
    "end": "548160"
  },
  {
    "text": "are out there as far as liquid Equity options which means we actually care about not a niche of that fire hose of",
    "start": "548160",
    "end": "554680"
  },
  {
    "text": "data we care about all of it to to to further kind of make our",
    "start": "554680",
    "end": "561079"
  },
  {
    "text": "problem hard in the Years leading up the few years leading up to 2013 when we started running into this sort of overc",
    "start": "561079",
    "end": "568320"
  },
  {
    "text": "capacity issue with our networks we had rearchitecturing",
    "start": "568320",
    "end": "572839"
  },
  {
    "text": "over and getting behind on data it was exacerbating what had been a small",
    "start": "588519",
    "end": "594800"
  },
  {
    "text": "problem at the beginning of the year around areas where we needed low latency to be in place and in particular just",
    "start": "594800",
    "end": "600880"
  },
  {
    "text": "some uh stability to be in place and as things got much much worse than what we",
    "start": "600880",
    "end": "606440"
  },
  {
    "text": "had planned on we started hitting big gc's we we built a bunch of stuff in a garbage collected a language that has a",
    "start": "606440",
    "end": "612240"
  },
  {
    "text": "GC and and we had built stuff in a way where we thought we were managing the rate of uh garbage creation that was",
    "start": "612240",
    "end": "618880"
  },
  {
    "text": "going to work and then we found out we were way off on what we were going to need to be able to handle um and the and",
    "start": "618880",
    "end": "624680"
  },
  {
    "text": "and and the problem with that is is that we had spent years building this and now we had a had to figure figure out how to",
    "start": "624680",
    "end": "630399"
  },
  {
    "text": "both F fix our infrastructure from a feed management perspective but not have to go redo everything it was important",
    "start": "630399",
    "end": "637399"
  },
  {
    "text": "that Java still work for us and then to kind of throw in the final a final part of the problem was at that same moment",
    "start": "637399",
    "end": "645680"
  },
  {
    "text": "we had a bunch of new opportunities showing up in the marketplace that for which the solution was basically",
    "start": "645680",
    "end": "652120"
  },
  {
    "text": "creating a bunch of more Downstream client systems and by Downstream I mean you've got your fire hose of data coming",
    "start": "652120",
    "end": "658880"
  },
  {
    "text": "in from the market and you've got some internal management way of disseminating which at the time was TCP and we needed",
    "start": "658880",
    "end": "664959"
  },
  {
    "text": "to more or less you could say double the number of systems that were going to be listening to that streams of data so if we're only already knocking our routers",
    "start": "664959",
    "end": "671760"
  },
  {
    "text": "over with listening to the data on you know however many systems we had going to twice that was going to definitely",
    "start": "671760",
    "end": "678279"
  },
  {
    "text": "not work so I can say we we knew we had a",
    "start": "678279",
    "end": "683639"
  },
  {
    "text": "problem we had to fix it and we really knew just three things about it we didn't exactly know how we were going to do everything but we did know there are",
    "start": "683639",
    "end": "689600"
  },
  {
    "text": "three things that were at play one TCB had to go we had to somehow figure out",
    "start": "689600",
    "end": "694959"
  },
  {
    "text": "how do we go back to using multicast in a reliable way without hitting all the",
    "start": "694959",
    "end": "700519"
  },
  {
    "text": "problems we had before because TCP was not going to scale for us we were killing things killing our systems killing our our network with this and so",
    "start": "700519",
    "end": "707880"
  },
  {
    "text": "that's for sure all we knew number two we knew that Java had to be a part of",
    "start": "707880",
    "end": "713880"
  },
  {
    "text": "our platform we had to figure out how do we make it so that we can stay within this ecosystem scale ba it out manage",
    "start": "713880",
    "end": "720720"
  },
  {
    "text": "the various different types of needs across all the systems we had both where there was true very low latency and and",
    "start": "720720",
    "end": "727839"
  },
  {
    "text": "if you're in Peter's talk before this you low latency means a bunch of things but in in our scenario there were some",
    "start": "727839",
    "end": "733800"
  },
  {
    "text": "systems that we needed to be subm million a very small number consistently subm million there's a few more that we",
    "start": "733800",
    "end": "740079"
  },
  {
    "text": "need consistently to be in single digit millisecond Management on and again consistent so every time no matter what",
    "start": "740079",
    "end": "746680"
  },
  {
    "text": "all day long we can count on end to end this thing from there to there was going to be one you know single digit Millies",
    "start": "746680",
    "end": "752279"
  },
  {
    "text": "and then we had a ton of stuff where it was higher than that variable you know up to 100 milliseconds who cares you know like I mean not totally who cares I",
    "start": "752279",
    "end": "759320"
  },
  {
    "text": "mean if you get into half a second or more we definitely care but a lot less stringent but we had all this stuff in",
    "start": "759320",
    "end": "765160"
  },
  {
    "text": "this bread of things going down to even subm milon and we had to make it work otherwise we were looking at a",
    "start": "765160",
    "end": "770360"
  },
  {
    "text": "multi-year project and not something that we would be able to actually make the business Thrive let alone tackle uh",
    "start": "770360",
    "end": "777360"
  },
  {
    "text": "the new opportunities uh that were coming our away third thing we knew is we had no idea we had learned our lesson",
    "start": "777360",
    "end": "783720"
  },
  {
    "text": "we didn't know what was going to happen scale was going to be just part of the game it could be 2x 10x 100x who knows",
    "start": "783720",
    "end": "789839"
  },
  {
    "text": "and that meant from the data coming in upstream and it meant potentially in the number of systems we put in play",
    "start": "789839",
    "end": "795880"
  },
  {
    "text": "Downstream and so we had to make sure that the architecture we went with would actually work no matter where that",
    "start": "795880",
    "end": "803519"
  },
  {
    "text": "led so we ended up building this thing that internally we called feed",
    "start": "803920",
    "end": "810920"
  },
  {
    "text": "cter and I'm going to initially just jump to the end that's the picture there's no way we go through all of that",
    "start": "810920",
    "end": "817079"
  },
  {
    "text": "all of this in this talk there's a bunch of components to it we're going to for the rest of this talk just pull out the",
    "start": "817079",
    "end": "823320"
  },
  {
    "text": "few pieces of this that I think are the most interesting uh certainly the thing the areas where we learned the most from",
    "start": "823320",
    "end": "829639"
  },
  {
    "text": "and where there was potentially some of the most uh fun in Innovative things that we got we got to play around with",
    "start": "829639",
    "end": "835839"
  },
  {
    "text": "high level though what's going on here is got a bunch of data coming in on on you see there's that little line in the",
    "start": "835839",
    "end": "841440"
  },
  {
    "text": "middle you can consider everything on this side of it to be the server side",
    "start": "841440",
    "end": "846560"
  },
  {
    "text": "the side of the things where you're managing the raw feeds from exchanges and everything on the other side is",
    "start": "846560",
    "end": "852480"
  },
  {
    "text": "effectively systems that are Downstream so you have the stuff you know multiple servers partitioning the world of what's",
    "start": "852480",
    "end": "858360"
  },
  {
    "text": "coming in from the exchanges something called feedster that we did right in C+ plus that is parsing that Raw Feed and",
    "start": "858360",
    "end": "866120"
  },
  {
    "text": "then basically writing it down into a shared memory file then we add another thing that's sitting on that same server",
    "start": "866120",
    "end": "871759"
  },
  {
    "text": "as the thing parsing the raw feeds that is written in C and it is taking the",
    "start": "871759",
    "end": "877720"
  },
  {
    "text": "data out of the shared memory file and just broadcasting it on the network on the other side of the line",
    "start": "877720",
    "end": "884320"
  },
  {
    "text": "there you've got all your client systems there's another little guy WR and see that's listening to that broadcasted data set basically doing the inverse of",
    "start": "884320",
    "end": "891240"
  },
  {
    "text": "what the sender is doing taking it throwing into a shared memory then you have however many apps",
    "start": "891240",
    "end": "896440"
  },
  {
    "text": "you might be running on one of those pieces of of Hardware uh that's on the client side that's accessing this data",
    "start": "896440",
    "end": "903240"
  },
  {
    "text": "the internalized uh Market data out of that shared memory store that's pretty much it that's all there is to the",
    "start": "903240",
    "end": "909120"
  },
  {
    "text": "overall sort of high level view of what we what we did now the real trick was",
    "start": "909120",
    "end": "914399"
  },
  {
    "text": "how do you make it so that that transport mechanism from the server side where it's taking out of shared memory",
    "start": "914399",
    "end": "920360"
  },
  {
    "text": "broad broadcasting it out and then getting down to the client side how do you make it so that it's reliable because again we're we're giving up on",
    "start": "920360",
    "end": "926560"
  },
  {
    "text": "TCP and so we're and and so the the network protocol itself is not going to guarantee us that we see things in order",
    "start": "926560",
    "end": "933839"
  },
  {
    "text": "let alone see them at all but we need it we have to we have to make sure that the client side of things actually does see",
    "start": "933839",
    "end": "940680"
  },
  {
    "text": "everything and so we had to come up with a a way to solve the problem I'm going",
    "start": "940680",
    "end": "946199"
  },
  {
    "text": "to have Justin join the conversation here because Justin pretty much developed most of this stuff there was",
    "start": "946199",
    "end": "951759"
  },
  {
    "text": "he worked with a a small group of other people um o over the time we did this in particular uh another guy named David",
    "start": "951759",
    "end": "957800"
  },
  {
    "text": "where they initially came up with the solution of how do you create this reliable multicast thing and I've got a",
    "start": "957800",
    "end": "964560"
  },
  {
    "text": "you'll notice there's a bunch of names of various things on the screen and and what those are is a bunch of various",
    "start": "964560",
    "end": "970240"
  },
  {
    "text": "third-party open- Source pay for uh some are just uh protocol uh implementations",
    "start": "970240",
    "end": "976160"
  },
  {
    "text": "of getting data from one side of the other of a network where you are attempting to get reliability in place",
    "start": "976160",
    "end": "981880"
  },
  {
    "text": "and multi with multicast as the underlying uh delivery mechanism so Justin walk us through if why didn't we",
    "start": "981880",
    "end": "989000"
  },
  {
    "text": "use one of those third party thank you R so we we did try these these ones out and they kind of they're general purpose",
    "start": "989000",
    "end": "995199"
  },
  {
    "text": "libraries that solve the problem of if you want to multicast data across the network you have given up the uh",
    "start": "995199",
    "end": "1001279"
  },
  {
    "text": "reliability mechanisms that TCP gives you for for free so the way these systems work is that they essentially",
    "start": "1001279",
    "end": "1008680"
  },
  {
    "text": "keep a copy of what has been sent over the network and when somebody listening for that data indicates through what's",
    "start": "1008680",
    "end": "1015319"
  },
  {
    "text": "called a negative acknowledgement an Knack that they didn't receive that dat data the data is retransmitted to uh",
    "start": "1015319",
    "end": "1021680"
  },
  {
    "text": "over the network to give the give the client the uh another chance to to to read it so so we tried these these uh",
    "start": "1021680",
    "end": "1028720"
  },
  {
    "text": "systems out because they were kind of a little bit like a dropin replacement for just our networking code they didn't",
    "start": "1028720",
    "end": "1034918"
  },
  {
    "text": "require us to change an awful lot of the actual kind of application to to use them and unfortunately the results were",
    "start": "1034919",
    "end": "1041319"
  },
  {
    "text": "not really very satisfactory and one of one of the main issue that we had is",
    "start": "1041319",
    "end": "1046760"
  },
  {
    "text": "that once the kind of uh bandwidth of the incoming uh exchange fees increased",
    "start": "1046760",
    "end": "1053240"
  },
  {
    "text": "and the network started to drop packets um the network would quickly become",
    "start": "1053240",
    "end": "1059280"
  },
  {
    "text": "overloaded by the negative acknowledgements by the Knacks themselves so in other words the bandwidth would spike and this would",
    "start": "1059280",
    "end": "1066360"
  },
  {
    "text": "cause some packets to be dropped whereupon the clients would request please send me those packets that we",
    "start": "1066360",
    "end": "1072640"
  },
  {
    "text": "dropped they would then get sent on the network but meanwhile the the incoming ex exchange feed still needs to be",
    "start": "1072640",
    "end": "1078520"
  },
  {
    "text": "delivered IED over the same network so you tend to just magnify exponentially really the amount of bandwidth you you",
    "start": "1078520",
    "end": "1085320"
  },
  {
    "text": "require just to sustain the same kind of data rates effectively I mean what you may have heard this if you've used",
    "start": "1085320",
    "end": "1090720"
  },
  {
    "text": "anything like this is just a knack storm you know the tons of data coming in things start dropping all your clients",
    "start": "1090720",
    "end": "1096320"
  },
  {
    "text": "start saying hey I need this I didn't get this and they're sending all these knacks back upstreams resending more",
    "start": "1096320",
    "end": "1102039"
  },
  {
    "text": "data as it sending the other data coming in the door and it just becomes this vicious cycle right so that didn't work",
    "start": "1102039",
    "end": "1109400"
  },
  {
    "text": "for us that didn't work for us and uh we didn't feel really that um although the",
    "start": "1109400",
    "end": "1114880"
  },
  {
    "text": "the the the general purpose libraries solve the reliability problem in the general case we didn't really feel that",
    "start": "1114880",
    "end": "1121720"
  },
  {
    "text": "they were taking advantage of what was special about the data we were sending over the network which was that it's",
    "start": "1121720",
    "end": "1128120"
  },
  {
    "text": "Market data and with Market data you're really just interested in the most",
    "start": "1128120",
    "end": "1133960"
  },
  {
    "text": "recent message or the most recent values for for something you're not really interested if you've dropped some",
    "start": "1133960",
    "end": "1140559"
  },
  {
    "text": "packets in reconstructing what what was the case a few seconds ago or even a few",
    "start": "1140559",
    "end": "1146559"
  },
  {
    "text": "milliseconds ago you really just want to know what was the very latest piece of data you've received uh for Apple stock",
    "start": "1146559",
    "end": "1154880"
  },
  {
    "text": "or the price of a Google option right so so the one one thing that is different",
    "start": "1154880",
    "end": "1160320"
  },
  {
    "text": "is is the these solutions that you can use are very general purpose they are I'm going to try to give you reliable",
    "start": "1160320",
    "end": "1167200"
  },
  {
    "text": "delivery of packets I don't care care what is in the packet I'm just going to try to say overall mechanism if you drop",
    "start": "1167200",
    "end": "1173120"
  },
  {
    "text": "a packet ask for it and I'll give you that packet if I still have it which by the way the the Upstream doesn't can't",
    "start": "1173120",
    "end": "1179080"
  },
  {
    "text": "hold infinite number of back backlog of of of packets so at some point some",
    "start": "1179080",
    "end": "1184200"
  },
  {
    "text": "client who slow enough might say hey I missed this stuff and the answer is well too bad we don't have it no reliability",
    "start": "1184200",
    "end": "1190760"
  },
  {
    "text": "for you and so so one thing that I'm going to flip to the next slide on which",
    "start": "1190760",
    "end": "1196039"
  },
  {
    "text": "was really this aha moment I would say that that Justin and and the team working on it came to was we don't have",
    "start": "1196039",
    "end": "1202480"
  },
  {
    "text": "to solve world hunger we don't have to solve the general prpose solution we can solve something that's just for the",
    "start": "1202480",
    "end": "1209240"
  },
  {
    "text": "problem at hand right so I mean on on on on the screen you see a kind of a typical example of what's of what's",
    "start": "1209240",
    "end": "1215159"
  },
  {
    "text": "going on when there's a lot of incoming Market data and we've got three Apple quotes kind of on the while one one",
    "start": "1215159",
    "end": "1221840"
  },
  {
    "text": "behind the other probably just you know a few dozen microsc apart and the one",
    "start": "1221840",
    "end": "1227080"
  },
  {
    "text": "that's in blue is the most recent one and that's really the only one that we we care about the we can see on the",
    "start": "1227080",
    "end": "1233600"
  },
  {
    "text": "right of the screen there's our kind of key value store that we're retaining the",
    "start": "1233600",
    "end": "1238880"
  },
  {
    "text": "the the quotes the latest quotes in in the in the client application and the leading two apple quotes in in white",
    "start": "1238880",
    "end": "1245600"
  },
  {
    "text": "really we it would be would have been better if they had never been sent they're they're really superseded",
    "start": "1245600",
    "end": "1250760"
  },
  {
    "text": "entirely by the blue Apple quote Because by the time the client application looks",
    "start": "1250760",
    "end": "1255840"
  },
  {
    "text": "and says what's the current quote for for Apple it really wants the latest one it wants the blue one and the the two",
    "start": "1255840",
    "end": "1261799"
  },
  {
    "text": "that preceded it are redundant right so what did this change like how how did you make use of this in what you did so",
    "start": "1261799",
    "end": "1268120"
  },
  {
    "text": "what that meant was for us that we would we kind of understood that if this this is a peculiar aspect this is a peculiar",
    "start": "1268120",
    "end": "1273960"
  },
  {
    "text": "characteristic of the data we're sending is there some way that we can take advantage of this peculiarity and come",
    "start": "1273960",
    "end": "1280240"
  },
  {
    "text": "up with a better protocol for sending the data and more importantly deciding when not to send the the data and the",
    "start": "1280240",
    "end": "1287960"
  },
  {
    "text": "the the the the kind of the the the strange kind of thing is about Market data is that when the market is moving",
    "start": "1287960",
    "end": "1293000"
  },
  {
    "text": "very very quickly and it's producing a lot of kind of quotes for a lot of different Securities uh that's really",
    "start": "1293000",
    "end": "1299240"
  },
  {
    "text": "the time you care about retransmissions the least because if the market is",
    "start": "1299240",
    "end": "1305080"
  },
  {
    "text": "sending you a whole stream of quotes more and more quickly the chances are that by the time you realize that you",
    "start": "1305080",
    "end": "1310600"
  },
  {
    "text": "missed a quote just a few milliseconds ago or a few micros seconds ago there's going to be another quote that would",
    "start": "1310600",
    "end": "1316400"
  },
  {
    "text": "have superseded it coming along any way so you really don't care about the retransmission at that point it's really",
    "start": "1316400",
    "end": "1322400"
  },
  {
    "text": "when things are moving very very slowly that you might care about the retransmission because you then you've you've you've missed an event which is",
    "start": "1322400",
    "end": "1328760"
  },
  {
    "text": "going to be long lasting in its significance and so that's that's the time you really care about the replay",
    "start": "1328760",
    "end": "1333880"
  },
  {
    "text": "but not when things are really really maxing out so how did you take what how do you take advantage of that how does",
    "start": "1333880",
    "end": "1338919"
  },
  {
    "text": "it actually work where that makes it so that you don't have to retransmit everything so so the way the system",
    "start": "1338919",
    "end": "1344760"
  },
  {
    "text": "works is that um the the publisher of of the quotes in in this case uh Associates",
    "start": "1344760",
    "end": "1351760"
  },
  {
    "text": "with each change in a quote that gets sent out a version number and when the",
    "start": "1351760",
    "end": "1356880"
  },
  {
    "text": "client application realizes that it's missed a packet uh it requests",
    "start": "1356880",
    "end": "1363440"
  },
  {
    "text": "essentially through TCP a reliable Channel it requests to be resent the uh",
    "start": "1363440",
    "end": "1370159"
  },
  {
    "text": "packets that were missed which contain version 27 version 28 of say of the of",
    "start": "1370159",
    "end": "1376080"
  },
  {
    "text": "the Apple quote and then the publisher can look at the version number and meanwhile the publisher is still sending",
    "start": "1376080",
    "end": "1381679"
  },
  {
    "text": "out more recent Apple quotes it can look at the re request from a client that's",
    "start": "1381679",
    "end": "1386840"
  },
  {
    "text": "saying I missed something and actually looking at the version number say well I you've requested version 27 of the Apple",
    "start": "1386840",
    "end": "1394200"
  },
  {
    "text": "quote but I've just multicast out version 29 so I'm not going to send you 27 I'm just going to quietly ignore your",
    "start": "1394200",
    "end": "1401679"
  },
  {
    "text": "request because I know you've just going to receive version 29 if you don't",
    "start": "1401679",
    "end": "1406840"
  },
  {
    "text": "receive version 29 then you'll re 29 and we'll we'll we'll start again considering what we need to do but",
    "start": "1406840",
    "end": "1411919"
  },
  {
    "text": "essentially the the publisher realizes that it can avoid uh honoring retransmit",
    "start": "1411919",
    "end": "1417520"
  },
  {
    "text": "requests because it knows it's already multicast data that's superseded that that request so so I mean the the PE the",
    "start": "1417520",
    "end": "1425279"
  },
  {
    "text": "peculiarity of the data is really that it it has a key to it and if you conversion the data that you have on a key your your back channel is basically",
    "start": "1425279",
    "end": "1431960"
  },
  {
    "text": "able to know I already I've sent you the more recent one you don't I'm not I'm not going to send this to you that's right and and the and the and the and",
    "start": "1431960",
    "end": "1438120"
  },
  {
    "text": "the beauty of the protocol is that the more you drop packets because the network is multicasting more and more",
    "start": "1438120",
    "end": "1444960"
  },
  {
    "text": "data the less retransmissions you actually need to recover from that drop",
    "start": "1444960",
    "end": "1450000"
  },
  {
    "text": "and so there's a kind of built-in dampening effect in in the protocol when you with unlike with the general purpose",
    "start": "1450000",
    "end": "1455720"
  },
  {
    "text": "libraries the more you dropped the harder it was to recover with this the more you drop the easier it is to",
    "start": "1455720",
    "end": "1461240"
  },
  {
    "text": "recover right and again it's because of the nature of the data we knew the data and how it behaved and and we were able",
    "start": "1461240",
    "end": "1467679"
  },
  {
    "text": "to sort of at least in theory and this is you know as we built it it was all like theoretically this should be true",
    "start": "1467679",
    "end": "1473240"
  },
  {
    "text": "that we were able to take advantage of the fact that when the market goes crazy that's when you get a lot of data and it",
    "start": "1473240",
    "end": "1478679"
  },
  {
    "text": "goes crazy for a little while and that's when you're likely to get most things multiple quotes you know many sometimes",
    "start": "1478679",
    "end": "1485720"
  },
  {
    "text": "thousands hundreds of thousands in within a millisecond of the same thing over and over again and so we were able",
    "start": "1485720",
    "end": "1491720"
  },
  {
    "text": "to say using this protocol knowing that when it gets bad we're going to we're going to back off and we're going to",
    "start": "1491720",
    "end": "1497840"
  },
  {
    "text": "make it so that we are less likely to actually handle any more traffic on the",
    "start": "1497840",
    "end": "1503919"
  },
  {
    "text": "network than what was already coming in from the Upstream potentially even less whereas in the more general purpose",
    "start": "1503919",
    "end": "1510039"
  },
  {
    "text": "Solutions you get these Knack storms and it actually ends up being more and more and more and you just kind of can't keep up so that was really for us uh this aha",
    "start": "1510039",
    "end": "1518679"
  },
  {
    "text": "moment and I don't I mean for years we've been we've worked with this data and built systems along this and and this said and a after we did it we built",
    "start": "1518679",
    "end": "1526080"
  },
  {
    "text": "it we've both in testing as well as in real it's been out there for years now this is played out to be quite true when",
    "start": "1526080",
    "end": "1532919"
  },
  {
    "text": "when the market goes very goes Bonkers on us this thing just hums along and it",
    "start": "1532919",
    "end": "1538600"
  },
  {
    "text": "hums along not like suddenly you magically have not any bandwidth in use on your network but it's not much higher",
    "start": "1538600",
    "end": "1544919"
  },
  {
    "text": "than what what have what the actual Upstream that is coming from the exchanges is causing so if you're",
    "start": "1544919",
    "end": "1550919"
  },
  {
    "text": "getting 5 gbits per second sustained or 10 gbits per second sustained coming in from the Upstream that's more or less",
    "start": "1550919",
    "end": "1557240"
  },
  {
    "text": "what you're going to see within your internal Network and even if some things are dropping stuff the likelihood and",
    "start": "1557240",
    "end": "1563440"
  },
  {
    "text": "then they're coming back and saying hey I dropped this almost invariably it's doesn't matter because they already have",
    "start": "1563440",
    "end": "1569120"
  },
  {
    "text": "another one that they didn't drop that that means that they don't no longer need to to get it and and for us I mean again it seems obvious now but it took",
    "start": "1569120",
    "end": "1576000"
  },
  {
    "text": "us years to get to this generally simple solution that is now uh working really well and scales pretty well but so so we",
    "start": "1576000",
    "end": "1583960"
  },
  {
    "text": "get this protocol in place and it's great excellent we're able to actually get a bunch of data from the Upstream",
    "start": "1583960",
    "end": "1590440"
  },
  {
    "text": "stuff that's handling all the exchange data and push it out to all these machines and it's on multicast so we can scale those Downstream and it's not",
    "start": "1590440",
    "end": "1596080"
  },
  {
    "text": "going to cause uh generally going to cause uh further issues with copying data and overloading our our routers and",
    "start": "1596080",
    "end": "1602720"
  },
  {
    "text": "whatnot but we still had this big system where we had a bunch of stuff in Java we",
    "start": "1602720",
    "end": "1608120"
  },
  {
    "text": "had frankly a lot of stuff in Python we started using more and more go which by the way we used as part of building out",
    "start": "1608120",
    "end": "1613919"
  },
  {
    "text": "components of this system as well and and we needed all those things to be able to interact with this data that we",
    "start": "1613919",
    "end": "1619760"
  },
  {
    "text": "were now storing in shared memory um oh and also we wanted our stuff to be able",
    "start": "1619760",
    "end": "1625360"
  },
  {
    "text": "to continue to optimize the hardware we had in place so and by by that that",
    "start": "1625360",
    "end": "1630720"
  },
  {
    "text": "would mean that that we wouldn't have to end up having uh if you've got five apps running on a piece of Hardware because",
    "start": "1630720",
    "end": "1636640"
  },
  {
    "text": "the apps themselves are not doing a ton they wouldn't each need their own version of getting this data sent to",
    "start": "1636640",
    "end": "1642520"
  },
  {
    "text": "them and so that was a problem that we had to solve and and we had to do it in a way that would some you know somehow make it relatively easy for all these",
    "start": "1642520",
    "end": "1648880"
  },
  {
    "text": "apps to integrate with this so uh you know Justin I'll let you kind of talk to what do we do how do we solve it so so",
    "start": "1648880",
    "end": "1655120"
  },
  {
    "text": "having kind of solve the Redundant copying problem on the network we didn't really want to reproduce a bunch of",
    "start": "1655120",
    "end": "1661399"
  },
  {
    "text": "redundant copies on the client machines where we've got multiple applications in different languages as you say trying to",
    "start": "1661399",
    "end": "1667320"
  },
  {
    "text": "access this data so the obvious solution is is twofold how can we avoid redundant",
    "start": "1667320",
    "end": "1672919"
  },
  {
    "text": "copying uh which would be the case for instance if these guys were opening a a socket or a connection to service on the",
    "start": "1672919",
    "end": "1679399"
  },
  {
    "text": "machine and requesting data uh we avoid that problem by um using shared memory",
    "start": "1679399",
    "end": "1686159"
  },
  {
    "text": "so we store one copy of the incoming data in a file which we memory map and",
    "start": "1686159",
    "end": "1692279"
  },
  {
    "text": "that makes the data available to every process that requires it without having to reproduce multiple copies of it the",
    "start": "1692279",
    "end": "1699360"
  },
  {
    "text": "other advantage of that is that providing a data in uh a memory at an",
    "start": "1699360",
    "end": "1704399"
  },
  {
    "text": "address it's more or less easy in any language that we we use to access that",
    "start": "1704399",
    "end": "1709720"
  },
  {
    "text": "data there are some languages where it's trivially easy to do that there's some languages where you perhaps need to wrap",
    "start": "1709720",
    "end": "1715279"
  },
  {
    "text": "that access in a library because they don't uh uh expose raw memory to in",
    "start": "1715279",
    "end": "1721600"
  },
  {
    "text": "their programming model so does that mean that then each of these languages you have to write your own custom version of going and looking at that",
    "start": "1721600",
    "end": "1728039"
  },
  {
    "text": "memory and we we we thought about how we can provide a uniform one single way of",
    "start": "1728039",
    "end": "1733679"
  },
  {
    "text": "making it available and there's there's kind of a an obvious Universal",
    "start": "1733679",
    "end": "1739240"
  },
  {
    "text": "uh uh solution to that which is to provide a sea library that accesses the",
    "start": "1739240",
    "end": "1745679"
  },
  {
    "text": "shared memory and the Sea Library the beauty of a sea library is that pretty much every language on the planet allows",
    "start": "1745679",
    "end": "1753039"
  },
  {
    "text": "access to the facilities provided by a C library in one form or another you can import a C library into python pretty",
    "start": "1753039",
    "end": "1759159"
  },
  {
    "text": "easily obviously very easily into C++ very easily into go and and quite easily",
    "start": "1759159",
    "end": "1765000"
  },
  {
    "text": "into into Java maybe a little bit more work in this language all that but it's all very doable it's it's a Well",
    "start": "1765000",
    "end": "1770880"
  },
  {
    "text": "understood programming model and uh the C library also has the advantage that it can hide the messy details of opening a",
    "start": "1770880",
    "end": "1778440"
  },
  {
    "text": "memory map file and setting up that kind of like mapping and make it a kind of a much more comfortable interface to",
    "start": "1778440",
    "end": "1785600"
  },
  {
    "text": "accessing this data for for people in these different languages right so there you go we found a use for c um which by",
    "start": "1785600",
    "end": "1792279"
  },
  {
    "text": "the way if you haven't caught on it is it is Justin's preferred language um and it it's found it's found a good home in",
    "start": "1792279",
    "end": "1798720"
  },
  {
    "text": "in at Peak 6 right now so great so we have a C library we can open up this stuff we can interact with it through",
    "start": "1798720",
    "end": "1804279"
  },
  {
    "text": "that Library you don't have to redo everything in all these languages but let's talk about Java so obviously I",
    "start": "1804279",
    "end": "1811840"
  },
  {
    "text": "mean if if we've got people who are writing Java out there certainly who if you haven't uh done much or any off Heap",
    "start": "1811840",
    "end": "1818440"
  },
  {
    "text": "stuff the first question maybe is wait a minute how how am I going to access this",
    "start": "1818440",
    "end": "1823679"
  },
  {
    "text": "shared memory stuff from java like that doesn't uh it's not something that's naturally offered up to the API it's it",
    "start": "1823679",
    "end": "1830880"
  },
  {
    "text": "kind of falls out of that uh that realm of right once run everywhere and so that",
    "start": "1830880",
    "end": "1836159"
  },
  {
    "text": "was the first thing which is what do you do with memory map files and since Mike did all of this sort of single-handedly",
    "start": "1836159",
    "end": "1843760"
  },
  {
    "text": "let him walk through all the problems and what he had to do sure yeah thanks Ryan uh so yeah I mean just to take a",
    "start": "1843760",
    "end": "1849399"
  },
  {
    "text": "minute like just kind of talk about memory map files a little bit like I mean really you know memory map files you can think of as just like a block of",
    "start": "1849399",
    "end": "1855600"
  },
  {
    "text": "virtual memory that you know like you can map your process and then interact with directly um you know like and it's",
    "start": "1855600",
    "end": "1861320"
  },
  {
    "text": "it's going to be backed by something else like a like a file or just shared memory in this instance so you know like",
    "start": "1861320",
    "end": "1866639"
  },
  {
    "text": "it's it's going to get used often in places where either you need shared memory you need to share memory between",
    "start": "1866639",
    "end": "1871960"
  },
  {
    "text": "two different processes um or um you know like in like places where you just have a lot of high IO and uh you want to",
    "start": "1871960",
    "end": "1879000"
  },
  {
    "text": "make that performant um and so like really yeah we needed to to be able to interact you know like with this shared",
    "start": "1879000",
    "end": "1884120"
  },
  {
    "text": "memory uh we were able to use uh uh Justin's C library in order to kind of handle that for us",
    "start": "1884120",
    "end": "1890480"
  },
  {
    "text": "um you know like in a you like in a way that where we didn't have to reimplement it uh there's definitely ways of you know like doing that you know like in",
    "start": "1890480",
    "end": "1896440"
  },
  {
    "text": "Java like mapping and the memory uh but it's not uh it's not something that's really uh standard you know like across",
    "start": "1896440",
    "end": "1902559"
  },
  {
    "text": "platforms and stuff like that so it um you know like we were able to take advantage of uh of that library in order",
    "start": "1902559",
    "end": "1908240"
  },
  {
    "text": "to open up the file and kind of interrogate it investigate it um but uh",
    "start": "1908240",
    "end": "1913519"
  },
  {
    "text": "but but yeah we didn't exactly want to use that uh that library to have to read every single record or every single",
    "start": "1913519",
    "end": "1921120"
  },
  {
    "text": "field out of the uh out of the Shar memory um and so the main reason is is that you like so we're we're using this",
    "start": "1921120",
    "end": "1927360"
  },
  {
    "text": "library right you know like the C library but you know like we're we're really trying to use jni or in our case",
    "start": "1927360",
    "end": "1933039"
  },
  {
    "text": "like really jna uh to interact with that that file you know like to be able to call functions that know where the",
    "start": "1933039",
    "end": "1938840"
  },
  {
    "text": "records are and all that kind of stuff but you know like really there's there is some uh some performance you like",
    "start": "1938840",
    "end": "1944399"
  },
  {
    "text": "overhead that you're going to get you know like with going through that Library you know like with using jni or you know like even worse with you know",
    "start": "1944399",
    "end": "1950480"
  },
  {
    "text": "like through jna um you know like and so you know there's really there's not not really a need you know like to do that",
    "start": "1950480",
    "end": "1957240"
  },
  {
    "text": "you know once you kind of know where it is you know like where the memory is that you really want to start interacting with then you know like you",
    "start": "1957240",
    "end": "1963080"
  },
  {
    "text": "don't you don't have to go through the library in order to do this kind of raw stuff to be able to read uh this off",
    "start": "1963080",
    "end": "1968679"
  },
  {
    "text": "Heap memory you know like that where the records are actually being stored right so what do you what do you do how do you access it yeah so so the answer is",
    "start": "1968679",
    "end": "1974960"
  },
  {
    "text": "really using unsafe uh so if you hadn't heard of unsafe or haven't seen it like uh unsafe is is you know like the this",
    "start": "1974960",
    "end": "1981399"
  },
  {
    "text": "library that uh you know like really class this part you know like uh that this part of of java where uh it's not",
    "start": "1981399",
    "end": "1989679"
  },
  {
    "text": "uh it's called unsafe for a reason it's not not really meant you know to be used or wasn't originally meant to be used by",
    "start": "1989679",
    "end": "1996000"
  },
  {
    "text": "um you know like developers like us that are just making applications it's it's really meant to be used internally you know uh and so it's unsafe and that you",
    "start": "1996000",
    "end": "2002679"
  },
  {
    "text": "know like it uh it's API itself can change and actually is changing uh you know like in Java 9 and so you know like",
    "start": "2002679",
    "end": "2009000"
  },
  {
    "text": "you're going to have to um you know like redo a bunch of your code if you code too much to the to the API itself uh and",
    "start": "2009000",
    "end": "2015440"
  },
  {
    "text": "then secondly like you know it's it's unsafe because uh in Java like you know we you know like you uh create objects",
    "start": "2015440",
    "end": "2021720"
  },
  {
    "text": "you throw them around like you don't you don't worry about um you know like things like seg FS right but uh you can",
    "start": "2021720",
    "end": "2028360"
  },
  {
    "text": "you can easily get one if you like if you're going through unsafe and and using it directly um so you know like",
    "start": "2028360",
    "end": "2033679"
  },
  {
    "text": "it's it's you know like you got to be careful about it uh but uh but yeah you know like using unsafe is a way that you",
    "start": "2033679",
    "end": "2039600"
  },
  {
    "text": "know like without even using you know like anything external Java we're going to be able to uh interact with these",
    "start": "2039600",
    "end": "2046159"
  },
  {
    "text": "these shared memory files uh in a way that's that's high performant all right so what why you walk us through an",
    "start": "2046159",
    "end": "2051320"
  },
  {
    "text": "example here show us exactly what it is okay so you know like say that we got this like little class uh quote you know",
    "start": "2051320",
    "end": "2057760"
  },
  {
    "text": "like and uh it's only got a few fields in it um you know like typically and you know like systems like you you just kind",
    "start": "2057760",
    "end": "2062800"
  },
  {
    "text": "of create one of these objects you'd populate it you know like and then toss it around uh but you know like the place",
    "start": "2062800",
    "end": "2067919"
  },
  {
    "text": "that you populate it from would typically be from some other on Heap memory Source um some on Heap store uh",
    "start": "2067919",
    "end": "2074800"
  },
  {
    "text": "so you know like here you know like we just have these few Fields like you know basically um you know like you can uh we",
    "start": "2074800",
    "end": "2081599"
  },
  {
    "text": "just have these bid nask you know like Fields here for the these records like um you know like you know like you're",
    "start": "2081599",
    "end": "2087440"
  },
  {
    "text": "these really just represent like basic properties you know like of uh of Market data uh and we just we just want to be",
    "start": "2087440",
    "end": "2093638"
  },
  {
    "text": "able to take these objects read the data from off store and from off heat and use them on he right um so you know like",
    "start": "2093639",
    "end": "2101359"
  },
  {
    "text": "here's an example of us using unsafe in order to to do that so uh we we kind of",
    "start": "2101359",
    "end": "2107440"
  },
  {
    "text": "come in here you know like we we know what record ID that we want to read right U and so what we have to do is",
    "start": "2107440",
    "end": "2112560"
  },
  {
    "text": "just compute the address you know like that we're going to start reading from right so we we see that records Adder",
    "start": "2112560",
    "end": "2117880"
  },
  {
    "text": "there like that's that's really something that we're only going to know by um you know like by reading the uh",
    "start": "2117880",
    "end": "2125160"
  },
  {
    "text": "location out of the uh you know like using the library right like we have to know where the record array or you know",
    "start": "2125160",
    "end": "2130720"
  },
  {
    "text": "like records uh themselves start so we have to get that out of the store using the library we know what the record ID",
    "start": "2130720",
    "end": "2137880"
  },
  {
    "text": "is that we want to use uh but then we have to you know kind of compute the address just using the record size as well uh that was that also came from the",
    "start": "2137880",
    "end": "2144599"
  },
  {
    "text": "library so we get an address this record that we want to start reading you know like we create one of these quotes um",
    "start": "2144599",
    "end": "2149760"
  },
  {
    "text": "you know we we create the you know like the uh the bite array to store the the uh the bites representing the Apple",
    "start": "2149760",
    "end": "2156680"
  },
  {
    "text": "symbol right uh we copy that from off off Heap onto the Heap uh and then we uh",
    "start": "2156680",
    "end": "2162960"
  },
  {
    "text": "we create this string object to to you know like hold those bytes um and we read the bid we read the ask you know",
    "start": "2162960",
    "end": "2169280"
  },
  {
    "text": "like read The Exchange right so we you know like these are these are uh every time that we're calling unsafe here uh",
    "start": "2169280",
    "end": "2175160"
  },
  {
    "text": "then it's reading something that's out of that uh shared memory store uh and then putting it into an object that's on",
    "start": "2175160",
    "end": "2181440"
  },
  {
    "text": "the Heap so wait I thought I mean a big part of this is managing memory off the Heap so that you're not creating much GC",
    "start": "2181440",
    "end": "2188640"
  },
  {
    "text": "but your solution basically is generating a bunch of garbage right yeah that's right no so uh we uh you know",
    "start": "2188640",
    "end": "2193960"
  },
  {
    "text": "like like that's a really good point so you know like you know this is just as bad right like where we're still creating that Cote object we're still",
    "start": "2193960",
    "end": "2199760"
  },
  {
    "text": "creating that bite array right like we we we don't really want to do that because you know like we we build up enough objects and we're just going to",
    "start": "2199760",
    "end": "2205720"
  },
  {
    "text": "get GC that's going to just introduce more pauses right so like we we want to stay away from that so here you know",
    "start": "2205720",
    "end": "2211400"
  },
  {
    "text": "like what we can do is just pass in that quote object uh we can we can get it you know like from the the guy that's that's",
    "start": "2211400",
    "end": "2216760"
  },
  {
    "text": "calling it maybe he's you're using one you know like maybe like a pool of them or something yeah yeah it could be in a pool you know like or even it could just",
    "start": "2216760",
    "end": "2222760"
  },
  {
    "text": "be one that's that's really in a sense bound to the thread that's calling you know like or if we know that we're in a single threaded context we can take",
    "start": "2222760",
    "end": "2228359"
  },
  {
    "text": "advantage of that um lots of ways where you can like just you know like kind of keep one existing object around that",
    "start": "2228359",
    "end": "2233920"
  },
  {
    "text": "you're going to reuse over and over right uh so we're going to just pass that object in uh and then just set the",
    "start": "2233920",
    "end": "2239280"
  },
  {
    "text": "fields on that instead of creating a new one right so still some news there though yeah sorry so you know like we we",
    "start": "2239280",
    "end": "2245040"
  },
  {
    "text": "still got that bite array and we still got that string so you know like how are we going to solve that so uh you know",
    "start": "2245040",
    "end": "2250359"
  },
  {
    "text": "like here we can pass in that that quote object and we can um change instead of",
    "start": "2250359",
    "end": "2256119"
  },
  {
    "text": "having just a string field you know inside that object we're going to have to make it a bite array in this sence",
    "start": "2256119",
    "end": "2261599"
  },
  {
    "text": "like you know like that that's going to allow us to just read it into that pre-existing array okay so then we're",
    "start": "2261599",
    "end": "2267040"
  },
  {
    "text": "still just we're not creating that extra garbage here anymore uh we're able to take advantage of that that you know",
    "start": "2267040",
    "end": "2272280"
  },
  {
    "text": "like the thing that this this might look bad in the sense because like you're thinking like oh yeah everybody that's calling this then is going to have to",
    "start": "2272280",
    "end": "2278000"
  },
  {
    "text": "interpret you know like this is like bites or he going to have to create a string to to really know that that's",
    "start": "2278000",
    "end": "2283200"
  },
  {
    "text": "Apple um but in reality like if you kind of think about it uh this is really the key of the record right the guy that's",
    "start": "2283200",
    "end": "2289680"
  },
  {
    "text": "that's calling this and asking for this record he's asking for this record for a reason right like he knows that this is",
    "start": "2289680",
    "end": "2295400"
  },
  {
    "text": "Apple and he can probably if you you know like he since he knows that it's apple he probably already has a string",
    "start": "2295400",
    "end": "2301680"
  },
  {
    "text": "around that says Apple in it that he can then uh tack onto the object after we",
    "start": "2301680",
    "end": "2306839"
  },
  {
    "text": "kind of read it out of memory so you know like this this actually you know like it's strings are notoriously hard",
    "start": "2306839",
    "end": "2312440"
  },
  {
    "text": "right you know like when you're trying to cons you know like conserve your allocations but um you know like doing doing stuff like this will help where",
    "start": "2312440",
    "end": "2319000"
  },
  {
    "text": "you know like it's it's okay to kind of use it for keys and in context where you know what the data is because you can",
    "start": "2319000",
    "end": "2325599"
  },
  {
    "text": "then go and reuse those strings right all right I mean while somewhat complicated obviously seems relatively",
    "start": "2325599",
    "end": "2332240"
  },
  {
    "text": "simple so I mean why not done quickly I mean you should have been just able to replace everything and if I recall right",
    "start": "2332240",
    "end": "2337640"
  },
  {
    "text": "this took a while yeah that this did take a while uh yeah so I mean really you know like there's all these little",
    "start": "2337640",
    "end": "2342920"
  },
  {
    "text": "problems that kind of start to pop up when you you like just I mean change the system for one but then really start to",
    "start": "2342920",
    "end": "2347960"
  },
  {
    "text": "use more of this different approach so like you know like with these files we have to know you know like what each record represents you know like we have",
    "start": "2347960",
    "end": "2353920"
  },
  {
    "text": "to be able to watch for new records that are added after we start right you know like we have to be able to interact with that C library and we have to know that",
    "start": "2353920",
    "end": "2360839"
  },
  {
    "text": "you know like okay if the uh subscriber on our box you know shoves down and then downloads a new one that he's going to",
    "start": "2360839",
    "end": "2367160"
  },
  {
    "text": "he's going to create a new shared memory store there's there's just all these different problems that just started popping up that you know like are all",
    "start": "2367160",
    "end": "2373560"
  },
  {
    "text": "solvable problems but nonetheless they they they do you know take some work to to sell okay so that actually seems like",
    "start": "2373560",
    "end": "2379599"
  },
  {
    "text": "it's relatively complicated to try to achieve this like how how much of our I",
    "start": "2379599",
    "end": "2384680"
  },
  {
    "text": "mean how often do you have to go through all this nonsense just so that you can use Java and not have a GC like crazy",
    "start": "2384680",
    "end": "2391280"
  },
  {
    "text": "with this amount of data yeah I mean not not as much as you you would think like so I mean really this is the 10% of our",
    "start": "2391280",
    "end": "2397000"
  },
  {
    "text": "code that that you know like we really need to to kind of optimize around like uh and and to kind of make very very",
    "start": "2397000",
    "end": "2403560"
  },
  {
    "text": "quick very fast right but I mean like the the rest of our code like you know like the 90% of it is you know just you",
    "start": "2403560",
    "end": "2409319"
  },
  {
    "text": "know like it's not it's not written to you know you know like avoid allocations this this intensely and all that kind of",
    "start": "2409319",
    "end": "2415160"
  },
  {
    "text": "stuff so you know like you you really got to you know think about the the 910 Rule and kind of you know be able to um",
    "start": "2415160",
    "end": "2420960"
  },
  {
    "text": "when needed you know like apply this stuff but but not all the time so as you can see there's a bunch there really was",
    "start": "2420960",
    "end": "2427000"
  },
  {
    "text": "a bunch bunch of issues that came up as we went some we anticipated some that literally just came up along the way um",
    "start": "2427000",
    "end": "2433040"
  },
  {
    "text": "there's no way we can go through all of them but many of them are pretty interesting we there's two we're going to pull out that are at least",
    "start": "2433040",
    "end": "2439440"
  },
  {
    "text": "interesting to look at so the first one would be this one that's like how to lock without locking which first what",
    "start": "2439440",
    "end": "2445160"
  },
  {
    "text": "what what in the world does that mean and why do why was this a problem yeah I mean you know like so really you know like this isn't exactly locking right",
    "start": "2445160",
    "end": "2451920"
  },
  {
    "text": "like uh this is more just you know like we we want to read an actual like legit value from the story right so you know",
    "start": "2451920",
    "end": "2458640"
  },
  {
    "text": "like we we not really we're not really able to lock in the traditional sense because we we don't want to slow down or",
    "start": "2458640",
    "end": "2464440"
  },
  {
    "text": "kind of create this contention between different processes here remember we're we're sharing this memory you know like",
    "start": "2464440",
    "end": "2469560"
  },
  {
    "text": "we're not just talking about locking inside the jbm or anything like that we're we're talking about you know like potentially you know like by doing any",
    "start": "2469560",
    "end": "2475760"
  },
  {
    "text": "real locking solution blocking other processes right so there's this thing that that Justin wrote that's writing how much data right so so there's",
    "start": "2475760",
    "end": "2483079"
  },
  {
    "text": "there's hundreds of thousands of Records being updated every second and there's in in each file and there's there's a",
    "start": "2483079",
    "end": "2488640"
  },
  {
    "text": "lot of these different files and there's one uh Unix process which is writing to",
    "start": "2488640",
    "end": "2494319"
  },
  {
    "text": "the file and then there's a bunch of different processes application programs on the machine looking at that same",
    "start": "2494319",
    "end": "2500400"
  },
  {
    "text": "memory and they need to kind of uh be able to read that memory in uh in a in a",
    "start": "2500400",
    "end": "2505920"
  },
  {
    "text": "correct way not read garbage out of it because they read partial update and yet they can't really lock the record",
    "start": "2505920",
    "end": "2512319"
  },
  {
    "text": "because they may be written something that's running quite slowly or they may be doing some long update or or something like that it's going to block",
    "start": "2512319",
    "end": "2518720"
  },
  {
    "text": "the whole some python thing could be written that you that needs to look at this data that for whatever reason it",
    "start": "2518720",
    "end": "2524119"
  },
  {
    "text": "was written a way where it locks the the writer out goes and hits a database comes back some time later and then says",
    "start": "2524119",
    "end": "2530839"
  },
  {
    "text": "oh yeah that's that quote I wanted and and all of a sudden everything's falling over so can't do that so we need to see",
    "start": "2530839",
    "end": "2537200"
  },
  {
    "text": "data correctly but not lock so this is really about avoiding reading partial data right partially written data yeah",
    "start": "2537200",
    "end": "2544319"
  },
  {
    "text": "yeah that's definitely right like so I mean you know like we're going to go through this example quick like so say that we we've got this this Apple quote",
    "start": "2544319",
    "end": "2550319"
  },
  {
    "text": "you know like first we write out you know like oh it's 106 and5 and then you know like the ask is 106 of 10 cents",
    "start": "2550319",
    "end": "2556440"
  },
  {
    "text": "right then you know like a new quote comes along and we're now where the bid is changed to 10615 and the ask has",
    "start": "2556440",
    "end": "2561680"
  },
  {
    "text": "changed to 10620 so you know like when the reader if without really doing anything if we don't try to prevent it",
    "start": "2561680",
    "end": "2567599"
  },
  {
    "text": "then you know like we can get into a situation where this happens where we we read that the bid is 106 and 15 and the",
    "start": "2567599",
    "end": "2574280"
  },
  {
    "text": "ask is 106 and10 cents when real in reality like that number really happened you know like that that that's not really a true record um so you know like",
    "start": "2574280",
    "end": "2581720"
  },
  {
    "text": "what we're going to do is this you know like we're we're really going to try to lock just using the version of the data",
    "start": "2581720",
    "end": "2586800"
  },
  {
    "text": "okay so the so the writer is is you know every time that that he's writing on record he's effectively incrementing this version that's attached to each",
    "start": "2586800",
    "end": "2592920"
  },
  {
    "text": "record but he doesn't just increment okay so he really does three things he he locks it meaning that he negates the",
    "start": "2592920",
    "end": "2598440"
  },
  {
    "text": "version of the record okay he he writes a negative number there you know then he writes the full record value and then he",
    "start": "2598440",
    "end": "2604640"
  },
  {
    "text": "unlocks it he unlocks it by negating that number and then adding one okay so effectively we we incremented it but we",
    "start": "2604640",
    "end": "2610000"
  },
  {
    "text": "had to go through these three steps to get there the reader on the other hand he's going to wait until he sees a positive version you know like in that",
    "start": "2610000",
    "end": "2616000"
  },
  {
    "text": "record he's going to read the version number then he's going to read the full record value and then read that version",
    "start": "2616000",
    "end": "2621200"
  },
  {
    "text": "again all right and he's going to repeat if the versions are different um so as an example of this like you know like",
    "start": "2621200",
    "end": "2626400"
  },
  {
    "text": "see that we see that same first quote okay we have 106 uh and 5 cents for the bid and 106 of 10 cents for the ask",
    "start": "2626400",
    "end": "2633880"
  },
  {
    "text": "right so the writer he's going to you know like it's starting out his 101 he's going to write 101 then he's going to",
    "start": "2633880",
    "end": "2640000"
  },
  {
    "text": "write the new quote out okay so the new record value and then write the version 102 okay uh the reader on the other hand",
    "start": "2640000",
    "end": "2647240"
  },
  {
    "text": "like he's he's going to read the the the the initial version 101 there he's going to read some mixed uh record you know",
    "start": "2647240",
    "end": "2653760"
  },
  {
    "text": "like a record with the new bid but the old ask all right then he's going to see oh okay there's this negative version",
    "start": "2653760",
    "end": "2660040"
  },
  {
    "text": "negative 101 that means that I have to kind of keep going because negative 101 and 10 and 101 the version of the first",
    "start": "2660040",
    "end": "2666599"
  },
  {
    "text": "R are different right so I have to I have to repeat so maybe he reads the version again it's still negative now he reads it and it's",
    "start": "2666599",
    "end": "2672880"
  },
  {
    "text": "102 right and so now he can read that full record value and you know he can read the version again and hey they're",
    "start": "2672880",
    "end": "2679200"
  },
  {
    "text": "the same that means that we got a consistent read and we can use that value so another thing we had to deal",
    "start": "2679200",
    "end": "2685559"
  },
  {
    "text": "with is right there's a C library that we're dealing with and it does a bunch of stuff on us and and we don't control",
    "start": "2685559",
    "end": "2691079"
  },
  {
    "text": "what's on the other side of this as well and it it and both the interaction with that C library live as well as just just",
    "start": "2691079",
    "end": "2697280"
  },
  {
    "text": "in you know General development became problematic right like I mean talk about some pain points we had here yeah so I",
    "start": "2697280",
    "end": "2703440"
  },
  {
    "text": "mean really this isn't a highly concurrent system right so like you know when things go wrong or like during",
    "start": "2703440",
    "end": "2708640"
  },
  {
    "text": "startup or whatever like you know there's definitely times where that that block of memory those or one of those",
    "start": "2708640",
    "end": "2713880"
  },
  {
    "text": "blocks of memory that we're we're reading from uh you know like we all of a sudden you know like need to switch to",
    "start": "2713880",
    "end": "2719920"
  },
  {
    "text": "using a new block of memory for that same uh that same data so that means that so so just to give like the why",
    "start": "2719920",
    "end": "2725920"
  },
  {
    "text": "let's say the other side crashed or something changed and it has to be restarted or moved what's going to end",
    "start": "2725920",
    "end": "2731599"
  },
  {
    "text": "up happening is it's going to you you've got this thing this ecosystem on other side that's going to be saying oh I'm done with that file I'm I'm closing it",
    "start": "2731599",
    "end": "2738480"
  },
  {
    "text": "reopening and putting a new file in place and you might have this other app sitting there trying to access it at the same time because they're dis",
    "start": "2738480",
    "end": "2744359"
  },
  {
    "text": "disconnected yeah so I mean we we really we need to be able to kind of uh switch",
    "start": "2744359",
    "end": "2749440"
  },
  {
    "text": "these two things out and everybody that's reading from this stuff within the process needs to kind of all at once",
    "start": "2749440",
    "end": "2754480"
  },
  {
    "text": "be able to start looking at the new block of memory and try not to seg vault in the process okay so you know like and",
    "start": "2754480",
    "end": "2760520"
  },
  {
    "text": "then the other thing is just like we're we're using Java that's right once run anywhere and everything right like it's it's supposed to be easy to just you",
    "start": "2760520",
    "end": "2766040"
  },
  {
    "text": "know like compile and then start running everywhere like C is not like that you know and so now we're kind of we're",
    "start": "2766040",
    "end": "2771800"
  },
  {
    "text": "trying to make sure that we're building with the the right version of the library the one that that that matches what we want to do stuff with and so we",
    "start": "2771800",
    "end": "2778079"
  },
  {
    "text": "had to kind of write some some custom build stuff just to be able to to to build the C stuff you know like as we're",
    "start": "2778079",
    "end": "2783880"
  },
  {
    "text": "building our Java stuff and ship it along with it right it's just silly practicality but like Justin sitting there furiously writing this API like oh",
    "start": "2783880",
    "end": "2791359"
  },
  {
    "text": "we need this or we have to change that and you're furiously trying to use it and and the uh the tooling for Just DE",
    "start": "2791359",
    "end": "2797599"
  },
  {
    "text": "bugging and stuff was just as bad like just trying to you know like call into the CRA library and and getting SE",
    "start": "2797599",
    "end": "2803040"
  },
  {
    "text": "faults there and then figuring out like where did they go wrong like that I mean you know like that there are are funky",
    "start": "2803040",
    "end": "2808240"
  },
  {
    "text": "ways of doing it but you know like it's it's it's difficult it's not it's not easy right cuz you're looking at the core from your jvm right yeah so",
    "start": "2808240",
    "end": "2815920"
  },
  {
    "text": "definitely pain point and and like I said there's a whole laundry list of things but if you work through them and",
    "start": "2815920",
    "end": "2821800"
  },
  {
    "text": "especially if you contain the area of your program that you're dealing with these problems um you can achieve uh",
    "start": "2821800",
    "end": "2829280"
  },
  {
    "text": "very high performance systems um and controllable amounts even at high data",
    "start": "2829280",
    "end": "2834400"
  },
  {
    "text": "rates and and and and uh a great amount of activity going on within your VM you",
    "start": "2834400",
    "end": "2840440"
  },
  {
    "text": "can still control the amount of garbage getting created and so when all said and done we did do this and we managed to",
    "start": "2840440",
    "end": "2847040"
  },
  {
    "text": "keep it relatively controlled we went from crisis to maybe smooth sailings",
    "start": "2847040",
    "end": "2852720"
  },
  {
    "text": "going a little bit far but it worked it worked we did not have to our three issues were more or less solved our",
    "start": "2852720",
    "end": "2858960"
  },
  {
    "text": "network was no longer being completely destroyed by uh the both the markets as well as our um sort of abuse of them",
    "start": "2858960",
    "end": "2866960"
  },
  {
    "text": "internally by using TCP to get all this big data around we had uh all this stuff",
    "start": "2866960",
    "end": "2872480"
  },
  {
    "text": "that we'd build in Java that we got to keep we had to change some of the core elements of how it interact acted with Market data some other stuff along the",
    "start": "2872480",
    "end": "2879200"
  },
  {
    "text": "way that we learned as a result of of even doing this work that we said hey that'd be smart to do to you know use",
    "start": "2879200",
    "end": "2885920"
  },
  {
    "text": "these same Tech techniques in other places as well and we got a better system as a result and we didn't really",
    "start": "2885920",
    "end": "2891640"
  },
  {
    "text": "cover this exactly in detail but this thing scales extremely well if the Upstream side keeps growing if there's",
    "start": "2891640",
    "end": "2899000"
  },
  {
    "text": "10 more exchanges next year if they all triple the amount of data they're pushing we can scale this out really",
    "start": "2899000",
    "end": "2904640"
  },
  {
    "text": "easily we're not going to have to write a line of code be able to have it scale and again because of the way that we've",
    "start": "2904640",
    "end": "2909839"
  },
  {
    "text": "managed and segmented the data on the downstream that's going to be also true um from that perspective so our the",
    "start": "2909839",
    "end": "2915119"
  },
  {
    "text": "three things we went in knowing we need to solve by doing this we we really got to a good solution and and we ended up",
    "start": "2915119",
    "end": "2921079"
  },
  {
    "text": "having a system that more or less is able to do all these things and here are some of the things we learned as well like 10 gigabits per second while it",
    "start": "2921079",
    "end": "2927440"
  },
  {
    "text": "doesn't happen all day every day some days it happens and it can happen for a uncomfortable long amount of time where",
    "start": "2927440",
    "end": "2934040"
  },
  {
    "text": "you're getting that much data from all the markets and you have to just keep up with it and in fact when that happens",
    "start": "2934040",
    "end": "2940119"
  },
  {
    "text": "it's the worst moment for your business if your stuff doesn't keep up or or is not is starting to drop data and it's",
    "start": "2940119",
    "end": "2946440"
  },
  {
    "text": "the highest opportunity for you if you build stuff that actually can keep up with it there usually aren not 30",
    "start": "2946440",
    "end": "2953240"
  },
  {
    "text": "million messages per second but it does happen and and that's what the 10 10 gigs of data can break down into and you",
    "start": "2953240",
    "end": "2959880"
  },
  {
    "text": "have to be able to not just say here's the bandwidth I've got it but also parse it and do something with it um and from",
    "start": "2959880",
    "end": "2966160"
  },
  {
    "text": "a low lat perspective you know you we had systems that are built in Java where we have to have either sub subm uh",
    "start": "2966160",
    "end": "2973559"
  },
  {
    "text": "consistent subm management or single-digit Millie and and it worked we we also did a bunch of other things",
    "start": "2973559",
    "end": "2979000"
  },
  {
    "text": "along the way we used go for parts of this we didn't go into it in this but we really finding that it's a lovely little",
    "start": "2979000",
    "end": "2985200"
  },
  {
    "text": "language and there's a bunch of things about their philosophy on on keeping things simple that works and we",
    "start": "2985200",
    "end": "2991720"
  },
  {
    "text": "everything we've tried to do with it has has ended up being pretty fast pretty maintainable and definitely more on the",
    "start": "2991720",
    "end": "2998400"
  },
  {
    "text": "fun side of things to to to work with um as we said earlier C is still there SE",
    "start": "2998400",
    "end": "3003559"
  },
  {
    "text": "is still fun C++ is still around we did not fully get rid of it um I you know",
    "start": "3003559",
    "end": "3009960"
  },
  {
    "text": "there's definitely a little bit of a love haate uh amongst people in in at Peak 6 around where we have C++ in use",
    "start": "3009960",
    "end": "3016000"
  },
  {
    "text": "but it has a home um and more or less the way we built this it it it achieved goals across optimizing hardware and",
    "start": "3016000",
    "end": "3023160"
  },
  {
    "text": "working across all these languages and that is pretty much yeah thank [Applause]",
    "start": "3023160",
    "end": "3033280"
  },
  {
    "text": "you",
    "start": "3033280",
    "end": "3036280"
  }
]