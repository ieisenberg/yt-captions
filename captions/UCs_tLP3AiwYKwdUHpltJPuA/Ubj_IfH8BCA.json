[
  {
    "text": "[Music]",
    "start": "2540",
    "end": "11630"
  },
  {
    "text": "so the subtitle of this presentation is not there the subtitle of this",
    "start": "11759",
    "end": "18600"
  },
  {
    "text": "presentation is how we replace search on Wikipedia and didn't break anything and",
    "start": "18600",
    "end": "23800"
  },
  {
    "text": "since I like to keep you guys on your toes there are two lies in this subtitle because it's just more fun to lie right",
    "start": "23800",
    "end": "30119"
  },
  {
    "text": "so the two lies uh the first is when an engineer tells you they they didn't break",
    "start": "30119",
    "end": "35520"
  },
  {
    "text": "anything no no no no no no not at all I broke plenty but uh we broke plenty rather it",
    "start": "35520",
    "end": "43600"
  },
  {
    "text": "was a group effort anyway uh the other part is in the Wikipedia",
    "start": "43600",
    "end": "49280"
  },
  {
    "text": "so let me see this is Windows so we said we repl search on Wikipedia but that",
    "start": "49280",
    "end": "55480"
  },
  {
    "text": "that's a lie I mean we did that but we also replaced it on wiary and Wiki data",
    "start": "55480",
    "end": "61239"
  },
  {
    "text": "and on Commons and Wiki quote so there's lots and lots lots and",
    "start": "61239",
    "end": "66920"
  },
  {
    "text": "lots and lots of different wikis right there there are 888 or something if my notes don't lie",
    "start": "66920",
    "end": "73240"
  },
  {
    "text": "right uh there's some file we cat and word count it right but uh that's in",
    "start": "73240",
    "end": "78479"
  },
  {
    "text": "about 265 languages and you know I could go on and talk to you about how we don't",
    "start": "78479",
    "end": "83600"
  },
  {
    "text": "how we don't speak all those languages and how we rely on Lucine for language support I could tell you about all the awesome features that we used but that",
    "start": "83600",
    "end": "90640"
  },
  {
    "text": "would be an unconscionable waste because I did exactly that when I was talking at",
    "start": "90640",
    "end": "95680"
  },
  {
    "text": "this presentation which you can go watch and you'll get the blog post link so you'll be able to go look up the other",
    "start": "95680",
    "end": "101360"
  },
  {
    "text": "presentation or you could just internet stalk me or whatever and you can find this presentation uh it was a double",
    "start": "101360",
    "end": "107439"
  },
  {
    "text": "right we had a I had my friend uh Chad who worked on the project with me there now let's see ah",
    "start": "107439",
    "end": "117799"
  },
  {
    "text": "so I've lost my place oh so yeah uh I was going to tell you about",
    "start": "117799",
    "end": "124759"
  },
  {
    "text": "why we chose elastic search but I don't have time for that I gave this presentation last night and I went way",
    "start": "124759",
    "end": "131560"
  },
  {
    "text": "over and so I'm cutting things out but uh the the well I'm going to tell you",
    "start": "131560",
    "end": "136720"
  },
  {
    "text": "about half of why we chose elastic Source uh the part of the reason was the community uh this is this was our old",
    "start": "136720",
    "end": "143480"
  },
  {
    "text": "product or our old search it didn't have any Community it relied on this which is undocumented impossible to install but",
    "start": "143480",
    "end": "149959"
  },
  {
    "text": "I'll skip to the part that that is sort of more interesting we really really liked elastic search because of automatic Shard allocation and we",
    "start": "149959",
    "end": "157080"
  },
  {
    "text": "probably liked that more than we were more excited by it than we really deserve to be because with the old",
    "start": "157080",
    "end": "163879"
  },
  {
    "text": "search system we had forgotten how to move shards from node to node right the documentation was gone so figuring out",
    "start": "163879",
    "end": "171040"
  },
  {
    "text": "how to do it would have been an exercise in digital archaeology which sounds really fun but it isn't right and we",
    "start": "171040",
    "end": "177680"
  },
  {
    "text": "would we would totally have brought down search right I mean that thing it just like restarting a node would bring",
    "start": "177680",
    "end": "183120"
  },
  {
    "text": "search down for 15 20 minutes so we were really quite worried that we would have",
    "start": "183120",
    "end": "188319"
  },
  {
    "text": "broken it if we tried to move things around I also would have told you that we loved the analyze and Cat apis and",
    "start": "188319",
    "end": "195319"
  },
  {
    "text": "they're great and they are great but I don't really have time to talk about them so skip um then there's the other big thing",
    "start": "195319",
    "end": "202799"
  },
  {
    "text": "that we jumped on liked about elastic search was the API for creating the mappings so at the time when we were",
    "start": "202799",
    "end": "210040"
  },
  {
    "text": "with uh we started we started working with solar and solar the only way to create the mappings at the time was to",
    "start": "210040",
    "end": "217159"
  },
  {
    "text": "copy a file onto disc in some place and that was just sort of painful and it",
    "start": "217159",
    "end": "222519"
  },
  {
    "text": "just wasn't the way the the application wanted to work so the mapping API that elastic search has is was way better and",
    "start": "222519",
    "end": "229959"
  },
  {
    "text": "I know that solar has gotten better at this so this is not really a fair thing on the other hand this is this link",
    "start": "229959",
    "end": "237720"
  },
  {
    "text": "doesn't work skip it but pretend link show is documentation for a link for an",
    "start": "237720",
    "end": "243200"
  },
  {
    "text": "API in solar so it turns out that there's an API and was an API in solar and I think it still exists uh where you",
    "start": "243200",
    "end": "250519"
  },
  {
    "text": "can do an HTTP get to delete an index and I you know found this AP I was like",
    "start": "250519",
    "end": "256000"
  },
  {
    "text": "oh that's really cute and I copied it and pasted on over IRC to my friend Chad who in that other conference was",
    "start": "256000",
    "end": "261720"
  },
  {
    "text": "standing right there he had this great suit anyway uh so he moused over the the",
    "start": "261720",
    "end": "267040"
  },
  {
    "text": "link and his IRC client was like oh oh let me give him a preview of that link",
    "start": "267040",
    "end": "272440"
  },
  {
    "text": "and it nuked his development index and I felt like a really awesome troll for the day and we walked away we were done no",
    "start": "272440",
    "end": "279600"
  },
  {
    "text": "no more solar for us right um",
    "start": "279600",
    "end": "284880"
  },
  {
    "text": "so let's let me go back to what I to the",
    "start": "284880",
    "end": "290759"
  },
  {
    "text": "point of this talk right the point of this talk is about how we didn't break anything see I lied again right we only",
    "start": "290759",
    "end": "297840"
  },
  {
    "text": "broke a little bit of stuff uh and how we did that right this is an elastic search track so you know I'll talk a lot",
    "start": "297840",
    "end": "304600"
  },
  {
    "text": "about elastic search as well and I just did talk a little bit about it right so getting your money's worth but uh yeah I",
    "start": "304600",
    "end": "312160"
  },
  {
    "text": "want to talk a little bit about how we didn't bring search down for forever and didn't screw too many people didn't",
    "start": "312160",
    "end": "318400"
  },
  {
    "text": "break their workflows things like that so the first step and I don't have a beautiful picture to show you for this",
    "start": "318400",
    "end": "325199"
  },
  {
    "text": "one is that we made the decision not to Fork elastic search we actually as you'll get I'll get to later we",
    "start": "325199",
    "end": "331360"
  },
  {
    "text": "submitted a lot of patches to elastic search we found a lot of things but forking elastic search would have been a",
    "start": "331360",
    "end": "337880"
  },
  {
    "text": "nightmare from like like keeping our own branch of elastic search and back porting all the patches would have been",
    "start": "337880",
    "end": "343800"
  },
  {
    "text": "a nightmare for us CU we were a two person team right we just didn't have time for that there was plenty to do",
    "start": "343800",
    "end": "349039"
  },
  {
    "text": "while we waited for elastic search to cut the next release and even then I have never sent a patch to",
    "start": "349039",
    "end": "356280"
  },
  {
    "text": "elastic search maybe a documentation patch but every every patch that I've sent that is in documentation they've",
    "start": "356280",
    "end": "363520"
  },
  {
    "text": "you know said ah do it this way rename this it make this more consistent or oh",
    "start": "363520",
    "end": "368560"
  },
  {
    "text": "God what are you doing that's totally not the right way to do that uh and that's okay right that's what code",
    "start": "368560",
    "end": "373680"
  },
  {
    "text": "review is for but if I had just like merged that into my local branch I would have diverged quite a bit from the",
    "start": "373680",
    "end": "379520"
  },
  {
    "text": "elastic search release and that would have been really painful so we didn't do that and I'm really glad about it so the",
    "start": "379520",
    "end": "385960"
  },
  {
    "text": "next thing that we did was we had beta communities these are communities that were super excited about the new search",
    "start": "385960",
    "end": "391560"
  },
  {
    "text": "probably I I have no idea why they were so excited like but they were super excited so Italian Wikipedia was yes we",
    "start": "391560",
    "end": "398520"
  },
  {
    "text": "will take your new search as fast as you can give it to us and they reported so many bugs and they worked with us while we learned elastic search and they were",
    "start": "398520",
    "end": "404880"
  },
  {
    "text": "great they were wonderful folks on IRC they were translating stuff from the",
    "start": "404880",
    "end": "410319"
  },
  {
    "text": "wiki community's Village pump and getting it to us we had so many bugs that came from them catalon Wikipedia as",
    "start": "410319",
    "end": "415800"
  },
  {
    "text": "well same deal and finally mediawiki.org Med wiki.org is one of the traditional",
    "start": "415800",
    "end": "421240"
  },
  {
    "text": "Canary sites that uh the wikim media Foundation uses for figuring out whether",
    "start": "421240",
    "end": "426360"
  },
  {
    "text": "we're going to break things we when we when we do deploys every week the first site that gets things is mediawiki.org",
    "start": "426360",
    "end": "432440"
  },
  {
    "text": "and we're always on mediawiki.org right we're looking at documentation I linked you to a couple I brought up a couple of",
    "start": "432440",
    "end": "439080"
  },
  {
    "text": "links on mediawiki.org and I'm going to go back to it on mediawiki.org it's it's we we we hit it a lot right and I've",
    "start": "439080",
    "end": "446560"
  },
  {
    "text": "broken search on mediawiki.org far more times than I would like to account I did it two weeks ago it's that's but that's",
    "start": "446560",
    "end": "453039"
  },
  {
    "text": "okay CU that's what it's for it's a canary right but it's also neat because it's mostly system administrators and",
    "start": "453039",
    "end": "460000"
  },
  {
    "text": "developers they go on there and so they're great at filing bugs man I mean it's not just like it broke it's like it",
    "start": "460000",
    "end": "465639"
  },
  {
    "text": "broke when I did this and this so it's really this has been a great Canary site for us",
    "start": "465639",
    "end": "471639"
  },
  {
    "text": "right so the other thing that was great was that right around the time after we",
    "start": "471639",
    "end": "477440"
  },
  {
    "text": "gone to Italian Wikipedia I maybe get my timelines off a little but right around the time we got to the",
    "start": "477440",
    "end": "482639"
  },
  {
    "text": "Italian Wikipedia some other folks at the foundation wrote this beta features plugin see this is Media wiki.org",
    "start": "482639",
    "end": "488720"
  },
  {
    "text": "see and I had I did a search on mediawiki.org to get here so I'd have known how to find broken search",
    "start": "488720",
    "end": "494800"
  },
  {
    "text": "anyway um so this beta features thing lets users opt in a certain to a certain",
    "start": "494800",
    "end": "501759"
  },
  {
    "text": "thing right to a certain feature so we let users opt into search right we we gave them an option called new search",
    "start": "501759",
    "end": "506840"
  },
  {
    "text": "and they could click it and then they went to our search and they could p test it and it was awesome turns out the beta features was actually written for visual",
    "start": "506840",
    "end": "513440"
  },
  {
    "text": "editor or hover cards or something I kind of forget so the thing is beta",
    "start": "513440",
    "end": "520320"
  },
  {
    "text": "features are really only useful for people that log in Wikipedia and most folks that log into Wikipedia are editors not all editors log into",
    "start": "520320",
    "end": "526440"
  },
  {
    "text": "Wikipedia some just contribute as IP addresses as anons right but others log into Wikipedia and they uh they can set",
    "start": "526440",
    "end": "534320"
  },
  {
    "text": "up their beta features right so to Define my terms a bit editors are people that edit Wikipedia if you've just",
    "start": "534320",
    "end": "540640"
  },
  {
    "text": "viewed it you're a reader that's what we call you it's okay readers are good we like",
    "start": "540640",
    "end": "545959"
  },
  {
    "text": "them editors are good because they contribute and this is kind of a silly term wik Nome uh it's probably not the",
    "start": "545959",
    "end": "554200"
  },
  {
    "text": "correct term but I've heard it bandi about uh if it's kind of hard to read but that upside down exclamation point",
    "start": "554200",
    "end": "560360"
  },
  {
    "text": "up there says this page contains humorous material and should not be taken seriously but I'm going to use it anyway in this presentation because",
    "start": "560360",
    "end": "566920"
  },
  {
    "text": "there really are people that go in and what these guys do is they they go and make some minor change right so there",
    "start": "566920",
    "end": "572640"
  },
  {
    "text": "are like templates that have to include a date and if a user doesn't fill in the date well someone might go fill it in for them or if a link is a reference but",
    "start": "572640",
    "end": "581959"
  },
  {
    "text": "it's to a website well we don't like reference links to websites we like reference links to internet. internet",
    "start": "581959",
    "end": "588200"
  },
  {
    "text": "archive right so that if the site gets obliterated or someone takes it down or whatever we want the thing to live right",
    "start": "588200",
    "end": "594959"
  },
  {
    "text": "we don't want dead links and references or maybe if a reference is a dead link they'll mark it as a dead link my God",
    "start": "594959",
    "end": "600640"
  },
  {
    "text": "right these are great things they're great for the health of this information Source right well my favorite wik Nomes",
    "start": "600640",
    "end": "607480"
  },
  {
    "text": "are people that do searches for spell checks partially they're my favorite because a couple of them were beta",
    "start": "607480",
    "end": "612720"
  },
  {
    "text": "testers and they jumped on me because I broke a lot of their things right so it turns out that these people who do",
    "start": "612720",
    "end": "618920"
  },
  {
    "text": "searches for spell spelling Corrections are really really interested",
    "start": "618920",
    "end": "625079"
  },
  {
    "text": "in uh or rather they're really really sensitive to stemming you know what stemming is anyone not know what steming",
    "start": "625079",
    "end": "631279"
  },
  {
    "text": "is okay all right steming is when steming is when you take the grammar out of a word so if I wanted to search for",
    "start": "631279",
    "end": "638240"
  },
  {
    "text": "wik gnomes well I you should that should find wik Nome as well right without the",
    "start": "638240",
    "end": "643839"
  },
  {
    "text": "S on the end and it gets more complicated it gets a lot more complicated in Russian right or in",
    "start": "643839",
    "end": "649200"
  },
  {
    "text": "Polish or some some of these languages which are heavily declined right um anyway so these wik Nomes they want to",
    "start": "649200",
    "end": "657399"
  },
  {
    "text": "know they want to find just the word right just the word that they're looking for so they're also really sensitive to",
    "start": "657399",
    "end": "662760"
  },
  {
    "text": "something called transclusions and uh let me Define",
    "start": "662760",
    "end": "667839"
  },
  {
    "text": "that so uh that's",
    "start": "667839",
    "end": "672639"
  },
  {
    "text": "unreadable that's unreadable too but it's better so Wikipedia and wikis in general",
    "start": "673519",
    "end": "681480"
  },
  {
    "text": "certainly media Wiki wikies are made up of Wiki Pages which include templates which can include templates which can",
    "start": "681480",
    "end": "687160"
  },
  {
    "text": "include templates which can include templates which can include templates some of which are written in Lua right",
    "start": "687160",
    "end": "692440"
  },
  {
    "text": "because the old templates were actually like turning complete except it was really really slow and so someone said",
    "start": "692440",
    "end": "697639"
  },
  {
    "text": "wow you're writing all this hard code in these templates these are horrible hacks let's just give you a language that you can write your code in and Louis is nice",
    "start": "697639",
    "end": "704160"
  },
  {
    "text": "and sandbox and whatever right that doesn't matter let's move on from that but what matters is",
    "start": "704160",
    "end": "709240"
  },
  {
    "text": "that these pages are include templates and",
    "start": "709240",
    "end": "716200"
  },
  {
    "text": "sometimes people want to search on wikitext and sometimes people want to search search on the actual output of the page uh and these curly brackets",
    "start": "716200",
    "end": "723399"
  },
  {
    "text": "mean invoke a template and stuff like that right uh let me move on this is by",
    "start": "723399",
    "end": "729279"
  },
  {
    "text": "the way the template source for linking to a YouTube video I have no idea like I haven't read",
    "start": "729279",
    "end": "735720"
  },
  {
    "text": "it oh God",
    "start": "735720",
    "end": "740920"
  },
  {
    "text": "so I was gon to yeah let's skip that right all right so we had these beta",
    "start": "740920",
    "end": "746560"
  },
  {
    "text": "users right we had these beta these beta um we had these beta wiks right",
    "start": "746560",
    "end": "753240"
  },
  {
    "text": "well that's useless if you don't actually learn what they want right if you don't listen to them right so I told",
    "start": "753240",
    "end": "758440"
  },
  {
    "text": "you they filed bugs right so I'll give you an example one person filed a bug they said um I need to search in the",
    "start": "758440",
    "end": "765519"
  },
  {
    "text": "wiki text of the document right that's that's that template stuff that I showed you well so the point the reason we did",
    "start": "765519",
    "end": "772399"
  },
  {
    "text": "this search Project the search Project had three count them three requirements",
    "start": "772399",
    "end": "778279"
  },
  {
    "text": "search wikitex or sorry search the rendered text of the page for regular",
    "start": "778279",
    "end": "783320"
  },
  {
    "text": "users um keep the index up to dat uh in a real-time way and real time was not",
    "start": "783320",
    "end": "790000"
  },
  {
    "text": "well- defined but that's okay and three was nobody can hate you those are those are the three requirements right which",
    "start": "790000",
    "end": "795120"
  },
  {
    "text": "is pretty normal I guess anyway so this is the render text of the page right if we if we take out you know the pretty",
    "start": "795120",
    "end": "801760"
  },
  {
    "text": "pictures and the tables that are over here and the links and things that's the render text to the page right so that's",
    "start": "801760",
    "end": "807120"
  },
  {
    "text": "what most people want to search well well some folks want to search the wikitext to the page remember my spelling correction people they care",
    "start": "807120",
    "end": "814519"
  },
  {
    "text": "about misspellings in the wikit text because that's what they have to edit that's what they have to fix right they",
    "start": "814519",
    "end": "819920"
  },
  {
    "text": "don't care about um they don't care about the rendered text I mean they do",
    "start": "819920",
    "end": "825240"
  },
  {
    "text": "that's ultimately why they're doing it right but that's not what they need to find so when we deployed to Med wiki.org",
    "start": "825240",
    "end": "832120"
  },
  {
    "text": "someone said I need to search on on the wiki text and we said okay that's that's absolutely true so we ended up having to",
    "start": "832120",
    "end": "839600"
  },
  {
    "text": "render so we ended up making this in Source operator which you can't read but uh let's try zooming in in a slightly",
    "start": "839600",
    "end": "847079"
  },
  {
    "text": "less hideous way so we made this insource operator that would search in the source see how the",
    "start": "847079",
    "end": "852800"
  },
  {
    "text": "text the highlighted portions are actually Wiki text and when you compare that to to sourcing in to searching in",
    "start": "852800",
    "end": "858759"
  },
  {
    "text": "the page this is actually the render text so",
    "start": "858759",
    "end": "864360"
  },
  {
    "text": "to do that though you have to actually index both parts so this is the giant Json blob",
    "start": "864360",
    "end": "869800"
  },
  {
    "text": "that we store for that Barack Obama page and",
    "start": "869800",
    "end": "876600"
  },
  {
    "text": "if you'll have to believe me because I'm not going to zoom in because it'll break everything but you'll have to believe me",
    "start": "877120",
    "end": "882639"
  },
  {
    "text": "that that's the text of the page",
    "start": "882639",
    "end": "888440"
  },
  {
    "text": "and that's the source text of the page so they're both available and for",
    "start": "888440",
    "end": "893720"
  },
  {
    "text": "those of you playing along that aren't in this room you can follow that link and find and search for quote text text",
    "start": "893720",
    "end": "899199"
  },
  {
    "text": "and quote Source text and find it um and if you have a nice browser that that renders Json nicely then it won't be a",
    "start": "899199",
    "end": "906120"
  },
  {
    "text": "giant wall of text it'll be two giant walls of text so turns out that that's not what",
    "start": "906120",
    "end": "914839"
  },
  {
    "text": "the person who filed that bug wanted turns out when when when we saw when we did that when we gave him the operator",
    "start": "914839",
    "end": "920680"
  },
  {
    "text": "and deployed it they said well that's not right so I wanted to find this page",
    "start": "920680",
    "end": "926560"
  },
  {
    "text": "manual WG name space aliases when I search for namespace",
    "start": "926560",
    "end": "933800"
  },
  {
    "text": "aliases and you know it's hard for me to see so I'm sure it's hard for you to see but",
    "start": "933800",
    "end": "939399"
  },
  {
    "text": "they were searching for namespace aliases like like uh camel case right",
    "start": "939399",
    "end": "944519"
  },
  {
    "text": "lowercase and capital A for Nam aliases but that's not what the page is right",
    "start": "944519",
    "end": "949880"
  },
  {
    "text": "the page is double G WG Capital name space aliases and that WG is in there",
    "start": "949880",
    "end": "955880"
  },
  {
    "text": "right and a normal search is just going to go the WG alysis that's a word so we had to make",
    "start": "955880",
    "end": "963319"
  },
  {
    "text": "search work on Pascal Case campel Case snake case and constant case so by the way the reason this worked is",
    "start": "963319",
    "end": "971800"
  },
  {
    "text": "because this page is made up of a template that includes the name includes",
    "start": "971800",
    "end": "977240"
  },
  {
    "text": "namespace aliases camel case just like that so if you're searching Wiki text you'll find it and that's what the old",
    "start": "977240",
    "end": "983639"
  },
  {
    "text": "system did the old system searched wikitext kind of it tried to use Java to",
    "start": "983639",
    "end": "988920"
  },
  {
    "text": "pars Wiki text and it was halfway and it half only halfway worked but all right",
    "start": "988920",
    "end": "995880"
  },
  {
    "text": "so ignore this for a bit the other thing that we broke this we seriously did break was you used to",
    "start": "995880",
    "end": "1003880"
  },
  {
    "text": "be able to search for food Dash bar and only get food Dash bar if you search for Foo space bar you would find food Dash",
    "start": "1003880",
    "end": "1010639"
  },
  {
    "text": "bar and f space bar the food Dash bar search Behavior was really useful for people who were looking for misspellings",
    "start": "1010639",
    "end": "1018000"
  },
  {
    "text": "where the dash version is a misspelling and we didn't implement it",
    "start": "1018000",
    "end": "1025839"
  },
  {
    "text": "we just broke it and the reason for that is that it would have required a custom analyzer that would have been now after",
    "start": "1025839",
    "end": "1032880"
  },
  {
    "text": "after a year I would have been able to write it but then we couldn't even deploy plugins to the elastic search cluster because we hadn't figured out",
    "start": "1032880",
    "end": "1038760"
  },
  {
    "text": "how to do that yet from oper from an operation standpoint I'll get to that but so we said look we can't do that",
    "start": "1038760",
    "end": "1044600"
  },
  {
    "text": "instead we made him this uh regular expression search that",
    "start": "1044600",
    "end": "1050480"
  },
  {
    "text": "was hideously slow cuz it was uh it was um naive right it would just search",
    "start": "1050480",
    "end": "1056320"
  },
  {
    "text": "every every document so I mean yeah there's sharding and but no it was it",
    "start": "1056320",
    "end": "1061720"
  },
  {
    "text": "would it would take minutes and by that time varnish had timed out this was hideous the moral of the story is",
    "start": "1061720",
    "end": "1067520"
  },
  {
    "text": "eventually we did deploy plugins and eventually we we got a uh trim accelerated regular expression search",
    "start": "1067520",
    "end": "1072880"
  },
  {
    "text": "which is actually quite quick I mean not quite quick it still takes 10 or 15 seconds but that's totally okay for this",
    "start": "1072880",
    "end": "1079400"
  },
  {
    "text": "use case I promise um and so we did eventually solve the problem but we",
    "start": "1079400",
    "end": "1084559"
  },
  {
    "text": "never gave him the dash syntax we just got nice regular Expressions which people have been asking for anyway so",
    "start": "1084559",
    "end": "1091640"
  },
  {
    "text": "anyway getting to this P to this stuff the reason so it's not useful to",
    "start": "1091640",
    "end": "1098240"
  },
  {
    "text": "implement all these features if you then break them right so we had to to do a",
    "start": "1098240",
    "end": "1103919"
  },
  {
    "text": "bunch of testing on this and in fact the old system didn't have tests didn't have",
    "start": "1103919",
    "end": "1109200"
  },
  {
    "text": "integration test didn't have unit test didn't have any tests so I was determined that we wouldn't leave the",
    "start": "1109200",
    "end": "1116760"
  },
  {
    "text": "that we wouldn't leave my successor you know if in 10 years someone has to rewrite the search again they're going to have a spec right so there are like",
    "start": "1116760",
    "end": "1123799"
  },
  {
    "text": "thousands of these things and the interesting thing is that when you write these integration tests they don't just",
    "start": "1123799",
    "end": "1130799"
  },
  {
    "text": "test they don't just test the code you wrote they test elastic search they test plugins this tests the ICU plugin uh",
    "start": "1130880",
    "end": "1137880"
  },
  {
    "text": "this is I don't actually know what that word is um this is three or this is four",
    "start": "1137880",
    "end": "1142919"
  },
  {
    "text": "different representations of the same word when you normaliz when you do Unicode normalization they're the same",
    "start": "1142919",
    "end": "1149320"
  },
  {
    "text": "but when you don't do unic code normalization they're different and you want when you search for any of these",
    "start": "1149320",
    "end": "1154400"
  },
  {
    "text": "four to find to find them together right they're the same you want you want",
    "start": "1154400",
    "end": "1159440"
  },
  {
    "text": "elastic search to think of them in the same term that's what this test is asserting right we also have this test over here where we assert all kinds of",
    "start": "1159440",
    "end": "1166200"
  },
  {
    "text": "stuff about highlighters and that goes in and asserts about the way highlighting works and the highlighting extension that we wrote and that has a",
    "start": "1166200",
    "end": "1172600"
  },
  {
    "text": "lot to do with the queries and elastic search and there's this huge interplay of things that we're testing here right but what matters is ultimately that the",
    "start": "1172600",
    "end": "1181440"
  },
  {
    "text": "right answers come out of the search system so unit testing this would have been silly because unit testing anything",
    "start": "1181440",
    "end": "1188960"
  },
  {
    "text": "like this would have been silly it would have been silly to go oh my search system produced the right Json and it",
    "start": "1188960",
    "end": "1194080"
  },
  {
    "text": "sent the right Json to elastic search and if elastic search sends it the right Json then we render the page correctly",
    "start": "1194080",
    "end": "1199919"
  },
  {
    "text": "this doesn't give me any confidence that we haven't broken anything so elastic searches is involved in all of the tests",
    "start": "1199919",
    "end": "1206280"
  },
  {
    "text": "of our search system and this gave us the confidence to do things like upgrade",
    "start": "1206280",
    "end": "1211679"
  },
  {
    "text": "from 0.9 to 1.0 to 1.1 you know and all Beyond right and yeah we had to fix some",
    "start": "1211679",
    "end": "1218440"
  },
  {
    "text": "things we had to change some things but these tests actually caught everything right when we upgraded didn't break",
    "start": "1218440",
    "end": "1223679"
  },
  {
    "text": "anything it was great it was perfect it was awesome and I feel really proud that these things worked right",
    "start": "1223679",
    "end": "1231039"
  },
  {
    "text": "so next the next thing you have to do is so this is Wikipedia right this is a",
    "start": "1231039",
    "end": "1236240"
  },
  {
    "text": "pretty big site on the internet right there are lots of users um you may not know that there's onsite search on Wikipedia that's okay right most people",
    "start": "1236240",
    "end": "1242320"
  },
  {
    "text": "come to wikkipedia through Google but we get more than a million searches an hour",
    "start": "1242320",
    "end": "1247360"
  },
  {
    "text": "and we get like like several million like five or six million prefixed",
    "start": "1247360",
    "end": "1252600"
  },
  {
    "text": "searches an hour it's it's pretty decent size right so we had to do some load testing uh so I threw together a quick",
    "start": "1252600",
    "end": "1259760"
  },
  {
    "text": "and dirty python script which if you follow the link on the page it's not very long right it's like 104 lines",
    "start": "1259760",
    "end": "1268799"
  },
  {
    "text": "including documentation and shebang and all that and it's probably wrong but we used it anyway to try to te to try to",
    "start": "1268799",
    "end": "1275840"
  },
  {
    "text": "test the this so we were playing the old searches logs right and we wanted to you know we had sampling so we would to do",
    "start": "1275840",
    "end": "1282039"
  },
  {
    "text": "things like ah replay 5% of English Wikipedia's searches against the new uh search index and it would work",
    "start": "1282039",
    "end": "1289440"
  },
  {
    "text": "and the Very but the very first time I crashed it at 20% I didn't crash elastic search I just overloaded it so when we",
    "start": "1289440",
    "end": "1297159"
  },
  {
    "text": "first when we did the first deploy we only got up to 20% of the search traffic that we actually were going to we actually wanted to handle in the end and",
    "start": "1297159",
    "end": "1303919"
  },
  {
    "text": "that's not enough right I mean yeah this just not enough right so we had to break",
    "start": "1303919",
    "end": "1310440"
  },
  {
    "text": "out the you know tools to figure out what was slow right so elastic search comes with this hot threads",
    "start": "1310440",
    "end": "1316279"
  },
  {
    "text": "API which is documented in this link these are all links by the",
    "start": "1316279",
    "end": "1321960"
  },
  {
    "text": "way in the blog post I'm not just bringing up random web pages um anyway the hot threads API is",
    "start": "1321960",
    "end": "1328039"
  },
  {
    "text": "great but it has this tendency to measure which threads are hot and then those those threads have then it",
    "start": "1328039",
    "end": "1335279"
  },
  {
    "text": "measures then it gets the stack traces that are going on in those like the hot threads like the three or four hot threads that's great except if those",
    "start": "1335279",
    "end": "1342240"
  },
  {
    "text": "threads are hot during the measurement time and then they're not hot during the stack Trace collection time and when",
    "start": "1342240",
    "end": "1349520"
  },
  {
    "text": "you're when you have high query load as opposed to high indexing load this is very common that the that the threads",
    "start": "1349520",
    "end": "1356159"
  },
  {
    "text": "that you get in the hot threads are actually not hot anymore by the time you look at them so the only thing you can do is actually hit elastic search with",
    "start": "1356159",
    "end": "1362559"
  },
  {
    "text": "jstack or it's does the same thing as when you Sig quit a Java application so",
    "start": "1362559",
    "end": "1368120"
  },
  {
    "text": "when you Sig quit a Java application on standard out it just spits out all of the stack Trace right it spits out all",
    "start": "1368120",
    "end": "1375000"
  },
  {
    "text": "the like hundred threads that allas six herch has running at the time and well we don't want it on standard",
    "start": "1375000",
    "end": "1381279"
  },
  {
    "text": "out right so we hit it with this thing called jstack which spits it out to the standard out of jstack the command and",
    "start": "1381279",
    "end": "1387080"
  },
  {
    "text": "so then we pipe that pitch it in a file then we wrote A bash script used a to",
    "start": "1387080",
    "end": "1393159"
  },
  {
    "text": "count or use GP I think actually to count the number of threads that were hot in certain places so it didn't it",
    "start": "1393159",
    "end": "1400799"
  },
  {
    "text": "didn't actually count the threads that were doing a lot of things it just sort",
    "start": "1400799",
    "end": "1405880"
  },
  {
    "text": "of we just ran it a bunch of times and said oh this time when we ran it there",
    "start": "1405880",
    "end": "1411200"
  },
  {
    "text": "were six threads doing you know doing work on the phas suggestor and there were three on envel and there were two",
    "start": "1411200",
    "end": "1416559"
  },
  {
    "text": "on this right and then we would run it again and then again and then again and it would just sort of count where the threads were and then the the threads",
    "start": "1416559",
    "end": "1423480"
  },
  {
    "text": "that were spending the most time in these various places were probably those were probably the slow places right and",
    "start": "1423480",
    "end": "1430640"
  },
  {
    "text": "then you know the jvm has safe points and all this other stuff so that's kind of it's complicated right how that works",
    "start": "1430640",
    "end": "1437600"
  },
  {
    "text": "but for the most part we figured out that we had some issues one with mvel so",
    "start": "1437600",
    "end": "1443440"
  },
  {
    "text": "we filed this issue uh and it turns out that it's just and it turns out that we could fix that on our own it",
    "start": "1443440",
    "end": "1452080"
  },
  {
    "text": "was one line change plus some comments uh and that made the script scoring like",
    "start": "1452360",
    "end": "1459400"
  },
  {
    "text": "an order of magnitude faster thanks mvel um then we had some other Chang we had",
    "start": "1459400",
    "end": "1465559"
  },
  {
    "text": "another change which we fixed Upstream which we upstreamed into elastic search some speed ups for the phrase suggestor",
    "start": "1465559",
    "end": "1470960"
  },
  {
    "text": "right we found these out by doing what I said by doing the bass SCP by grepping and finding where we were spending lots",
    "start": "1470960",
    "end": "1476039"
  },
  {
    "text": "of time and some things we had to do on both sides so we we had to implement",
    "start": "1476039",
    "end": "1482399"
  },
  {
    "text": "multiple rescores in elastic search then we had to use them in our extension right so for those we waited",
    "start": "1482399",
    "end": "1489919"
  },
  {
    "text": "after we implemented an elastic search like a month or two before it came out anyway uh the other interesting",
    "start": "1489919",
    "end": "1497320"
  },
  {
    "text": "thing about this is that we did this load testing in production because we're a nonprofit We really can't afford to",
    "start": "1497320",
    "end": "1502720"
  },
  {
    "text": "have two huge clusters to to do the load testing with so it was just very careful",
    "start": "1502720",
    "end": "1508240"
  },
  {
    "text": "to Not Crash the ba crash it while the beta testers were on there and I'm pretty sure I complished that um but I",
    "start": "1508240",
    "end": "1516880"
  },
  {
    "text": "mean that's what you get when you don't have that much money I mean wasn't we're not that bored but still uh fix that",
    "start": "1516880",
    "end": "1526039"
  },
  {
    "text": "please anyway wow that's hard to read so the other thing that we that was super important for us was mediai vagrant",
    "start": "1526039",
    "end": "1532520"
  },
  {
    "text": "mediai vagrant um so V so vagrant is a system that sets up a",
    "start": "1532520",
    "end": "1539320"
  },
  {
    "text": "virtual box VM and then runs puppet against it that's not about all that's",
    "start": "1539320",
    "end": "1544840"
  },
  {
    "text": "sort of interesting there that's that's just basically what it does and the puppet the puppet stuff that we we made",
    "start": "1544840",
    "end": "1550520"
  },
  {
    "text": "so the whole setup together we made media Wiki vagrant its job is to set up",
    "start": "1550520",
    "end": "1556039"
  },
  {
    "text": "a virtual machine that is very much like our production cluster it's like if you scaled down the production cluster and",
    "start": "1556039",
    "end": "1561919"
  },
  {
    "text": "only ran it on one machine so it can do things like host multiple wikis in fact",
    "start": "1561919",
    "end": "1567440"
  },
  {
    "text": "um when you set this up for us for testing search right you you add the little thing you say yes I want to test",
    "start": "1567440",
    "end": "1573039"
  },
  {
    "text": "search you take a box you run a command that takes a box for you basically it will download the one 2vm spin it up",
    "start": "1573039",
    "end": "1579240"
  },
  {
    "text": "clone the code set up Apache install my SQL install Reedus install elastic search install some extra elastic search plugins create a couple of wikis and",
    "start": "1579240",
    "end": "1585240"
  },
  {
    "text": "index them and that actually takes quite a while cuz puppet is slow",
    "start": "1585240",
    "end": "1590919"
  },
  {
    "text": "but eventually it gets set up and then you can use this stuff right and you you can you can use your development",
    "start": "1590919",
    "end": "1596760"
  },
  {
    "text": "environment and this is neat because if you break your development environment you can just destroy it and rebuild it",
    "start": "1596760",
    "end": "1602840"
  },
  {
    "text": "and it doesn't like your development environment is no longer canonical right what's canonical is the development",
    "start": "1602840",
    "end": "1608760"
  },
  {
    "text": "environment that the puppets set up just really cool right because then if production changes or if if you can't",
    "start": "1608760",
    "end": "1615559"
  },
  {
    "text": "reproduce some issue then you go and you can fix puppet and destroy your VM and rebuild it and",
    "start": "1615559",
    "end": "1621080"
  },
  {
    "text": "then if you can produce the issue well that's awesome right now your development environment is more production like it's more it's it's as",
    "start": "1621080",
    "end": "1628000"
  },
  {
    "text": "broken as production which is really important right so this this was sort of an important way of us of us getting",
    "start": "1628000",
    "end": "1634799"
  },
  {
    "text": "users to the point where they could run all those fancy integration tests that we wrote no performance testing because",
    "start": "1634799",
    "end": "1640520"
  },
  {
    "text": "well you can't performance test in vagrant it just no virtual machine inside your laptop is not going to be",
    "start": "1640520",
    "end": "1645880"
  },
  {
    "text": "anything like running normally so I would here talk about plugins let's see",
    "start": "1645880",
    "end": "1653640"
  },
  {
    "text": "oh wow I actually do have time so uh we ended up doing a lot of development our",
    "start": "1653640",
    "end": "1659760"
  },
  {
    "text": "development in plugins eventually so we were sending patches Upstream to elastic surge at some point we started doing a",
    "start": "1659760",
    "end": "1665640"
  },
  {
    "text": "lot of uh plug-in development inside uh uh sorry we started doing a lot of plug-in development inside the Wikimedia",
    "start": "1665640",
    "end": "1671600"
  },
  {
    "text": "foundation and the goal here was so that we could iterate more quickly so we didn't have to wait for a release and",
    "start": "1671600",
    "end": "1677360"
  },
  {
    "text": "this worked right this was this was pretty cool um we ultimately wrote a new highlighter because the ones all the",
    "start": "1677360",
    "end": "1683480"
  },
  {
    "text": "ones in Lucine don't work that's why there are three of them because no one of them Works uh we wrote this grab bag",
    "start": "1683480",
    "end": "1690440"
  },
  {
    "text": "which contains a bunch of backports so you know I said we didn't backport a lot of stuff from elastic search again I",
    "start": "1690440",
    "end": "1696200"
  },
  {
    "text": "like to keep you on your toes we did right we backported a few things from elastic search and we did it in plugins um but it was pretty rare we had",
    "start": "1696200",
    "end": "1704000"
  },
  {
    "text": "to be pretty careful with it right um and we also added things like that's where the trigram accelerated Rex",
    "start": "1704000",
    "end": "1709279"
  },
  {
    "text": "searches things like that and then we made this Swift repository which is",
    "start": "1709279",
    "end": "1715559"
  },
  {
    "text": "where you would do snapshots uh and the reason we did it is because elastic doesn't support Swift because it's not",
    "start": "1715559",
    "end": "1722880"
  },
  {
    "text": "that widely used but we use it so there you go right and the reason you do produ reason you do plug in development is",
    "start": "1722880",
    "end": "1728640"
  },
  {
    "text": "because either the feature doesn't belong in core elastic search you have to move quickly or you're back porning",
    "start": "1728640",
    "end": "1735000"
  },
  {
    "text": "things or all three right and in just showed you actually three examp like an",
    "start": "1735000",
    "end": "1740399"
  },
  {
    "text": "example of all three went through them anyway I wanted to talk about uh",
    "start": "1740399",
    "end": "1747279"
  },
  {
    "text": "what okay I wanted to talk about what's been uh what's been painful about this process what worked right I've talked a",
    "start": "1747279",
    "end": "1753399"
  },
  {
    "text": "lot about like the things that worked like having integration tests and having vagrant and and submitting patches up to",
    "start": "1753399",
    "end": "1758640"
  },
  {
    "text": "elastic search this worked really well right uh plugins and things they all work great what what didn't work very",
    "start": "1758640",
    "end": "1764919"
  },
  {
    "text": "well is uh actually have a list of four it was three last night but I had another one so rolling restarts in",
    "start": "1764919",
    "end": "1771159"
  },
  {
    "text": "elastic search until 1.6 they're hideous took us 3 Days To Do rolling restart",
    "start": "1771159",
    "end": "1777200"
  },
  {
    "text": "right so that's like taking a node down and adding and adding it back that takes like two hours 3 hours per node and if",
    "start": "1777200",
    "end": "1784960"
  },
  {
    "text": "you're willing to script it or willing to have someone watch it around the clock then you can get it done in less than three days but we're always a",
    "start": "1784960",
    "end": "1791679"
  },
  {
    "text": "little bit wary about these things and so we wanted to have a person after every node goes down have a person go look and say okay everything is still",
    "start": "1791679",
    "end": "1797880"
  },
  {
    "text": "good do the next one do the next one do the next one and then at some point your",
    "start": "1797880",
    "end": "1802919"
  },
  {
    "text": "person goes to sleep right so it has to take 3 days for us to do it once once we get to elastic search 1.6 we'll have",
    "start": "1802919",
    "end": "1808559"
  },
  {
    "text": "sync flush which uh will let us do the rolling restart way faster but we still",
    "start": "1808559",
    "end": "1814440"
  },
  {
    "text": "have to be careful because we're doing an upgrade we want to make we're doing an upgrade and you can't downgrade elastic search so you want to make sure",
    "start": "1814440",
    "end": "1821760"
  },
  {
    "text": "that if you don't do them all really fast and then get yourself broken right so we're going to do one and then wait",
    "start": "1821760",
    "end": "1827240"
  },
  {
    "text": "and then do them all but anyway um the next thing is next thing that didn't work for us was jobs or rather they did",
    "start": "1827240",
    "end": "1833760"
  },
  {
    "text": "work for us but they're pain in the butt so to get stin flush to work to get stin",
    "start": "1833760",
    "end": "1839000"
  },
  {
    "text": "flush to be a fast rolling restart you have to not write to the index during the rolling restart process",
    "start": "1839000",
    "end": "1846399"
  },
  {
    "text": "so to do that you have to have you have to cue up all of your rights and in fact",
    "start": "1846399",
    "end": "1851440"
  },
  {
    "text": "we already had this because I am so paranoid about bringing down Wikipedia",
    "start": "1851440",
    "end": "1856720"
  },
  {
    "text": "that we started pushing all of the work that we do all the times when we talk to elastic search unless",
    "start": "1856720",
    "end": "1862399"
  },
  {
    "text": "it's in a search we do it asynchronously we don't even do it after we flush the",
    "start": "1862399",
    "end": "1868320"
  },
  {
    "text": "request this is PHP by the way so we don't have threads right we we do it we push the things to a job queue and then",
    "start": "1868320",
    "end": "1875440"
  },
  {
    "text": "we pick back up pick them back up on another system and this is really useful because of transclusions and you know",
    "start": "1875440",
    "end": "1881039"
  },
  {
    "text": "when you have a template that's used in a million places you want to go and upgrade all them so you have to go explode out the job queue and things",
    "start": "1881039",
    "end": "1887240"
  },
  {
    "text": "like that and and run all those you couldn't do that in one process anyway but just to get just on a regular user",
    "start": "1887240",
    "end": "1892880"
  },
  {
    "text": "change we pitch that thing into the job queue right and to to test this testing",
    "start": "1892880",
    "end": "1898159"
  },
  {
    "text": "this asynchronous thing is a huge pain right and I told you right I'm really passionate about making sure that we",
    "start": "1898159",
    "end": "1903679"
  },
  {
    "text": "have integration tests that actually work right and prove things and that's it's just so brittle to like add things",
    "start": "1903679",
    "end": "1910200"
  },
  {
    "text": "to the index and then wait for things to go through the job queue and the job Q sort of would break on us and they'd change something and it just like ah so",
    "start": "1910200",
    "end": "1919559"
  },
  {
    "text": "anyway um the other thing is that some bugs in elastic search can bring down all the nodes or can bring down lots of",
    "start": "1919559",
    "end": "1925399"
  },
  {
    "text": "nodes there there are ways to send bugs to there are ways to send poison queries to elastic search um I won't tell you",
    "start": "1925399",
    "end": "1932840"
  },
  {
    "text": "what they are uh intentionally um but uh",
    "start": "1932840",
    "end": "1938200"
  },
  {
    "text": "certain Wild Card queries basically can do it right and you can consume tons of memory um and that'll knock out every",
    "start": "1938200",
    "end": "1946639"
  },
  {
    "text": "every shard that got the no or that got the query and English Wikipedia is",
    "start": "1946639",
    "end": "1951799"
  },
  {
    "text": "shorted seven ways we have 31 servers so 31 minus 7 is oh",
    "start": "1951799",
    "end": "1957240"
  },
  {
    "text": " and uh you know I get paged it's the middle of the night this is unhappy right uh this is bad right and I don't",
    "start": "1957240",
    "end": "1963960"
  },
  {
    "text": "actually know the answer to this I don't know the solution other than don't let the Wild Card queries bring you know",
    "start": "1963960",
    "end": "1970840"
  },
  {
    "text": "consume that much RAM but that's the obvious Solution that's not the answer right the answer is in some way to",
    "start": "1970840",
    "end": "1976200"
  },
  {
    "text": "prevent yourself from making these mistakes you don't want to paint paint yourself into a corner right",
    "start": "1976200",
    "end": "1982679"
  },
  {
    "text": "um and finally installing plugins didn't work for us and the reason for that is that our nodes in production don't have",
    "start": "1982679",
    "end": "1989679"
  },
  {
    "text": "access to the internet so the bin plug-in script doesn't work by the way your nodes in production shouldn't have access to the internet either that's how",
    "start": "1989679",
    "end": "1995840"
  },
  {
    "text": "you become an ircbot and a open proxy and malware server don't do that right",
    "start": "1995840",
    "end": "2001639"
  },
  {
    "text": "this is bad right so everyone has to negotiate with their operations team",
    "start": "2001639",
    "end": "2007960"
  },
  {
    "text": "their devops team whatever you call them they have to negotiate a way to install plugins right you've probably already",
    "start": "2007960",
    "end": "2013200"
  },
  {
    "text": "negotiated a way to install deian packages or RPM packages or whatever it is that you do to get elastic search installed but plugins don't come that",
    "start": "2013200",
    "end": "2019519"
  },
  {
    "text": "way come another way so you have to figure out how to get those installed and that's a different way from how we deploy everything else to the foundation",
    "start": "2019519",
    "end": "2025799"
  },
  {
    "text": "so we had to negotiate and get the right things and get them to install things and get the appropriate permissions and",
    "start": "2025799",
    "end": "2031159"
  },
  {
    "text": "this is I think a paino many people are going to suffer because that's the way operation Engineers are they're paranoid",
    "start": "2031159",
    "end": "2037519"
  },
  {
    "text": "and should be paranoid that's their job but it's difficult",
    "start": "2037519",
    "end": "2042639"
  },
  {
    "text": "right so I wanted to wrap up uh I've taken you on a presentation",
    "start": "2042639",
    "end": "2049158"
  },
  {
    "text": "Journey uh and I want to wrap up with the the the the things to which we owe",
    "start": "2049159",
    "end": "2055638"
  },
  {
    "text": "our modest success and by the way I'm actually I actually think that we really did succeed with this project even",
    "start": "2055639",
    "end": "2061320"
  },
  {
    "text": "though we did break a few things and I and I think we succeeded because we replaced search live on a h huge website",
    "start": "2061320",
    "end": "2069560"
  },
  {
    "text": "didn't bring it down right and no one hates us no one hates me right you think that this is the internet right if I had",
    "start": "2069560",
    "end": "2076440"
  },
  {
    "text": "broken something someone there'd be you know hordes of people after me but no so",
    "start": "2076440",
    "end": "2081878"
  },
  {
    "text": "yeah we were successful right and we owe that success to the beta testers right",
    "start": "2081879",
    "end": "2087000"
  },
  {
    "text": "uh they quickly pointed out problems and they worked with us right we rule it we owe it to the phased roll out approach",
    "start": "2087000",
    "end": "2092760"
  },
  {
    "text": "that we did and I didn't I kind of skipped over that right we we W way Wiki when we did this roll out we were",
    "start": "2092760",
    "end": "2098200"
  },
  {
    "text": "intentionally quite slow right we owe it to these Canary deployments to mediawiki.org and to all the people that use it we owe it to lots of integration",
    "start": "2098200",
    "end": "2105240"
  },
  {
    "text": "testing we ow it to load testing we owe it to vagrant for helping us build production like environments and to",
    "start": "2105240",
    "end": "2111400"
  },
  {
    "text": "actually having the The Willpower to to to to set this up when I started the foundation mediawiki vagrant didn't",
    "start": "2111400",
    "end": "2117720"
  },
  {
    "text": "exist right and that's been built in the meantime we owe it to the plug-in infrastructure and to the elastic search",
    "start": "2117720",
    "end": "2123560"
  },
  {
    "text": "folks or the elastic I guess they're called now folks who built the thing and helped work with us and reviewed the",
    "start": "2123560",
    "end": "2129800"
  },
  {
    "text": "patches and to the folks that helped us land patches in Lucine and things like that without that we wouldn't have been",
    "start": "2129800",
    "end": "2135240"
  },
  {
    "text": "able to do it right and yeah so like that's how we didn't break that much",
    "start": "2135240",
    "end": "2141640"
  },
  {
    "text": "stuff when we when we did this change right and I'm excited by it and now I'm",
    "start": "2141640",
    "end": "2147040"
  },
  {
    "text": "done talking so uh this is where you clap and then ask questions",
    "start": "2147040",
    "end": "2153390"
  },
  {
    "text": "[Applause] [Music]",
    "start": "2153390",
    "end": "2159139"
  },
  {
    "text": "so yeah if you have questions go ahead yes you talked about testing Break Stuff more like features did test that people",
    "start": "2159160",
    "end": "2167400"
  },
  {
    "text": "in the old system found things that could still find the new system and that that was how do you do that so yeah this",
    "start": "2167400",
    "end": "2173760"
  },
  {
    "text": "the the information retrieval question and we did it by with the beta systems we did it with the beta testers and for",
    "start": "2173760",
    "end": "2180520"
  },
  {
    "text": "the most so that's like touchy Fey stuff right for the most part they said yes we find we we it is at least as good or",
    "start": "2180520",
    "end": "2186200"
  },
  {
    "text": "better in all cases but that's not really that's not enough right that's so",
    "start": "2186200",
    "end": "2192040"
  },
  {
    "text": "sort of the two sides of it right and we did one side and we didn't do the other and we're starting on the other so the",
    "start": "2192040",
    "end": "2197119"
  },
  {
    "text": "first side is that we went and got a number of canonical test cases a number",
    "start": "2197119",
    "end": "2202880"
  },
  {
    "text": "of we we created a bunch of test documents and did searches and made sure that they appeared in the order that we expected them in to appear in and that",
    "start": "2202880",
    "end": "2210000"
  },
  {
    "text": "works we have integration tests for it they don't fail that's great and that's that's nice but that's not really good",
    "start": "2210000",
    "end": "2216440"
  },
  {
    "text": "enough right but that's what we did and I'm sticking to it right what we didn't do is we didn't instrument and we didn't",
    "start": "2216440",
    "end": "2224200"
  },
  {
    "text": "instrument how good a job we were doing because that's an incredibly complex problem how like just doing the search",
    "start": "2224200",
    "end": "2232119"
  },
  {
    "text": "right and figuring out whether the user liked that search without asking them right because we don't have nobody's",
    "start": "2232119",
    "end": "2237200"
  },
  {
    "text": "going to fill that in or the people that will fill that in are totally going to skew our documents right they're totally going to skew the reports so you have to",
    "start": "2237200",
    "end": "2243359"
  },
  {
    "text": "do it without the user doing it right and so for for a long time we weren't willing to do that",
    "start": "2243359",
    "end": "2249880"
  },
  {
    "text": "we weren't willing to essentially spy on the users right so we're actually coming around to the point now where we we're",
    "start": "2249880",
    "end": "2255680"
  },
  {
    "text": "willing to do very very careful anonymized data collection but this is long after we've done this replacement",
    "start": "2255680",
    "end": "2261680"
  },
  {
    "text": "right so we don't know we can't compare it to the old one but what we can do is start to do this collection and then we",
    "start": "2261680",
    "end": "2267880"
  },
  {
    "text": "can start to to graph how good a job we're doing right but how good a job you're doing in search is very it's a",
    "start": "2267880",
    "end": "2274079"
  },
  {
    "text": "very very hard problem there's a lot of academic papers published on the issue that I haven't red and I have a delegate",
    "start": "2274079",
    "end": "2279240"
  },
  {
    "text": "right a I have a person and I said you go and figure this out for me please um and then you know come up with a plan I",
    "start": "2279240",
    "end": "2286040"
  },
  {
    "text": "don't care how many people it takes right now so the trick is remember how I said there were two people on this project so two of us replace the old",
    "start": "2286040",
    "end": "2292400"
  },
  {
    "text": "search right when you have two people you do not have time to measure this stuff you you don't have time to",
    "start": "2292400",
    "end": "2297760"
  },
  {
    "text": "instrument it it's just not no but when you have 10 or 15 that becomes a lot",
    "start": "2297760",
    "end": "2302839"
  },
  {
    "text": "more possible you can start instrumenting things you can start building the systems you can start building the event log and and pull the",
    "start": "2302839",
    "end": "2308400"
  },
  {
    "text": "events together and you can start building systems where you're actually able to calculate this metric and that's",
    "start": "2308400",
    "end": "2314440"
  },
  {
    "text": "what we're trying to do now but yeah it's going to be a while right I mean that's a hard problem and there's also",
    "start": "2314440",
    "end": "2322160"
  },
  {
    "text": "you know there's existential questions like you know are we doing a good enough job anonymizing the data as it comes in",
    "start": "2322160",
    "end": "2327800"
  },
  {
    "text": "right things like that like because we really really really don't want to spy on you really like we don't but we do",
    "start": "2327800",
    "end": "2335119"
  },
  {
    "text": "want to make search better and that's really hard and I don't have the right answer right I know that that's other",
    "start": "2335119",
    "end": "2341319"
  },
  {
    "text": "other than we're going to try very very hard did that answer your question search results",
    "start": "2341319",
    "end": "2348720"
  },
  {
    "text": "no no that so here's the thing right we we do things like uh phrase rescores and",
    "start": "2348720",
    "end": "2355520"
  },
  {
    "text": "incoming link counts and uh boosting different parts of the of the page and",
    "start": "2355520",
    "end": "2360839"
  },
  {
    "text": "we we also do other things like we let the community um change boo like we let them configure boosts so the community",
    "start": "2360839",
    "end": "2367920"
  },
  {
    "text": "has a thing where they'll they'll go and they'll put um a template on the page if it's a good Wiki article or if it's been",
    "start": "2367920",
    "end": "2373680"
  },
  {
    "text": "a featured Wiki article or if it's a good picture so for Commons this is really important they put good picture",
    "start": "2373680",
    "end": "2378720"
  },
  {
    "text": "and they put bad picture on pictures that are just like garbage um and by garbage I mean like low resolution and",
    "start": "2378720",
    "end": "2384280"
  },
  {
    "text": "like yeah not like distasteful anyway um",
    "start": "2384280",
    "end": "2389319"
  },
  {
    "text": "so we gave give the community the power to configure how these templates boost the search results this works pretty",
    "start": "2389319",
    "end": "2395640"
  },
  {
    "text": "well right but going much beyond",
    "start": "2395640",
    "end": "2401640"
  },
  {
    "text": "that doing anything fancy like topic analysis or semantic networks or even",
    "start": "2401640",
    "end": "2407200"
  },
  {
    "text": "just changing the relative weight of the temp of the of the title to the text you",
    "start": "2407200",
    "end": "2413119"
  },
  {
    "text": "need to do his instrumentation first because you have no clue whether you've made it better or not right unless you",
    "start": "2413119",
    "end": "2420119"
  },
  {
    "text": "can instrument how good a job you're doing implementing you know semantic analysis topic modeling",
    "start": "2420119",
    "end": "2427960"
  },
  {
    "text": "maybe it's fun but it wa it could be a huge waste of time it could be a huge waste of CPU resources you have to check",
    "start": "2427960",
    "end": "2434560"
  },
  {
    "text": "right you don't know right and you you certainly don't know how to tune the parameters in in in the you know in the",
    "start": "2434560",
    "end": "2440480"
  },
  {
    "text": "various ranking algorithms that you have unless you're measuring how good a job you're doing right you can you can do it",
    "start": "2440480",
    "end": "2446480"
  },
  {
    "text": "and then look and go oh well it looks better which is mostly what I've done and I admit that that's like kind of not",
    "start": "2446480",
    "end": "2453200"
  },
  {
    "text": "a good way to do it so yeah so the trick is any anytime we go beyond what's built",
    "start": "2453200",
    "end": "2458599"
  },
  {
    "text": "into Lucin or elastic search anytime where we want to go and develop something interesting and new we got to make sure that it was that it's useful",
    "start": "2458599",
    "end": "2466000"
  },
  {
    "text": "right so you know we may end up doing things like prototyping it and then playing the searches against it and",
    "start": "2466000",
    "end": "2472480"
  },
  {
    "text": "seeing whether the results are better but we'd have to use uh the kind of thing where we we said oh this this user",
    "start": "2472480",
    "end": "2479920"
  },
  {
    "text": "now is clicking on number two right remember the Facebook guy right he was he was standing where I am this morning",
    "start": "2479920",
    "end": "2485720"
  },
  {
    "text": "and they've started to get they they have this data right um you know and what his team was what his team told him",
    "start": "2485720",
    "end": "2491640"
  },
  {
    "text": "was that oh it's actually easier to do the quick win things to do things like have users pin results at the top and",
    "start": "2491640",
    "end": "2498040"
  },
  {
    "text": "just pin them right maybe I actually want to go steal that idea and give my communities basically give logged in",
    "start": "2498040",
    "end": "2504040"
  },
  {
    "text": "users the ability to click a button and say when I search for this that's what I mean bring that up right that's kind of",
    "start": "2504040",
    "end": "2509960"
  },
  {
    "text": "what Google had one of those for a long time and they abandoned it so who knows right I mean everyone's sort of playing",
    "start": "2509960",
    "end": "2517240"
  },
  {
    "text": "catch up to to you know the big guys that that have you know thousands of people working on this problem when we have two or four and so you know you",
    "start": "2517240",
    "end": "2525160"
  },
  {
    "text": "have to but at least the advantage we have is that we're going to open source everything right everything we do is open source I'm not you I'm not going to",
    "start": "2525160",
    "end": "2531800"
  },
  {
    "text": "go bring up all the links but there there are links where you can look at the mapping configuration that we use",
    "start": "2531800",
    "end": "2537480"
  },
  {
    "text": "you can look at the uh analysis configuration you can look at the parameters I showed you the link where",
    "start": "2537480",
    "end": "2542839"
  },
  {
    "text": "you can look at the The Source document that we have for every article you just append question mark action equals",
    "start": "2542839",
    "end": "2549520"
  },
  {
    "text": "Cirrus dump to any article you want and it'll spit out what we have in elastic search for it um if you do a search you",
    "start": "2549520",
    "end": "2556960"
  },
  {
    "text": "can append a search a URL parameter and we spit out the search that we sent to elastic search and if you happen to have elastic",
    "start": "2556960",
    "end": "2565079"
  },
  {
    "text": "search with all over data you could send it too but really this is useful this is useful debugging tool for me and this is",
    "start": "2565079",
    "end": "2570359"
  },
  {
    "text": "a useful tool for other people to go how did they do that thing or why is this thing working the way it is that's kind",
    "start": "2570359",
    "end": "2575680"
  },
  {
    "text": "of silly right we want people to be able to file a bug and go that's not the right way to interpret",
    "start": "2575680",
    "end": "2581800"
  },
  {
    "text": "my query dude so yeah we can only do that with this thing anyway um sorry",
    "start": "2581800",
    "end": "2589079"
  },
  {
    "text": "that was kind of a rambling response but I I guess rambling is pretty normal for me I hope it works for you guys um any",
    "start": "2589079",
    "end": "2596400"
  },
  {
    "text": "other questions yes are you using as your primary no we're using MySQL as your as",
    "start": "2596400",
    "end": "2603240"
  },
  {
    "text": "our primary storage because the Wikipedia Foundation has used MySQL as it primary storage before it was the",
    "start": "2603240",
    "end": "2608559"
  },
  {
    "text": "Wikimedia Foundation when it was servers running media Wiki in Jimmy wales's basement right it's been my sequel It's",
    "start": "2608559",
    "end": "2615599"
  },
  {
    "text": "been my sequel It's been my sequel will continue to be my sequel until the Earth dies heat death right my you know we",
    "start": "2615599",
    "end": "2621559"
  },
  {
    "text": "will be my sequel Forevers we don't have constraints we don't have foreign keys",
    "start": "2621559",
    "end": "2627839"
  },
  {
    "text": "because they didn't exist when we started we're that hardcore all and also once you've have a",
    "start": "2627839",
    "end": "2633559"
  },
  {
    "text": "huge database there's no chance you're going to add them without taking the system offline and by by the way I'm sure there's stuff in that database that",
    "start": "2633559",
    "end": "2639440"
  },
  {
    "text": "violates those constraints and we just have to hope that it doesn't matter because with 10 years worth of mediawiki",
    "start": "2639440",
    "end": "2644960"
  },
  {
    "text": "development who knows what's in there it's kind of scary production is fun um",
    "start": "2644960",
    "end": "2650680"
  },
  {
    "text": "yeah so we don't use a li search as the primary store uh there were times when we started using elastic search where we had accidentally nuked things this was",
    "start": "2650680",
    "end": "2657400"
  },
  {
    "text": "mostly our fault and not elastic search's fault we uh uh so we have a very complex repository where we",
    "start": "2657400",
    "end": "2663119"
  },
  {
    "text": "configure the config parameters and for for a while our extension defaulted to",
    "start": "2663119",
    "end": "2669319"
  },
  {
    "text": "zero replicas because we wanted it to work properly with people that just downloaded media Wiki and it was the",
    "start": "2669319",
    "end": "2676160"
  },
  {
    "text": "only way that you could get the cluster green well that's stupid now we default to um Auto expand to to three replicas",
    "start": "2676160",
    "end": "2683200"
  },
  {
    "text": "that's much better but that's beside the point at some point we screwed up the configuration and went down to zero",
    "start": "2683200",
    "end": "2688400"
  },
  {
    "text": "replicas on the production cluster and then we nuked one of the shards to do a a disc upgrade or something and lost it",
    "start": "2688400",
    "end": "2695960"
  },
  {
    "text": "and that's not a lastar just fall that's totally our fault so yeah that that's when I earned this t-shirt because I BR I brought down",
    "start": "2695960",
    "end": "2703680"
  },
  {
    "text": "the Italian Wikipedia for a while I think I actually brought it down in the sense that they couldn't edit the pages",
    "start": "2703680",
    "end": "2709359"
  },
  {
    "text": "anyway uh you're standing up which means I'm I thought you might be out of questions I am",
    "start": "2709359",
    "end": "2716400"
  },
  {
    "text": "I excellent so you can either pick your favorite question or you can totally off",
    "start": "2716760",
    "end": "2722000"
  },
  {
    "text": "the responsibility on me and we go toek trivia so I like the IR question because it's the hard that we haven't solved yet",
    "start": "2722000",
    "end": "2728480"
  },
  {
    "text": "and and so yeah you get your your nice thing by the way the answers to your question aren't in this book unfortunately it's it's a really hard",
    "start": "2728480",
    "end": "2735680"
  },
  {
    "text": "question and I would love for there to be open source stuff around this and we're going to work on it",
    "start": "2735680",
    "end": "2741119"
  },
  {
    "text": "congratulations everybody let's give Nick another round of applause [Applause]",
    "start": "2741119",
    "end": "2749900"
  },
  {
    "text": "[Music]",
    "start": "2749900",
    "end": "2758989"
  }
]