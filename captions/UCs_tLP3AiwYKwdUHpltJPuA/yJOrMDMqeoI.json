[
  {
    "start": "0",
    "end": "176000"
  },
  {
    "text": "all right Mike Works Mike does work all right hello everyone um so yeah this is me I I work at",
    "start": "6240",
    "end": "13139"
  },
  {
    "text": "doordash on uh infrastructure and trying to get us to get into some better architectural patterns which",
    "start": "13139",
    "end": "19500"
  },
  {
    "text": "means for the last two years or so I've been involved in this very complicated migration and you know before that I",
    "start": "19500",
    "end": "24720"
  },
  {
    "text": "worked at Uber on a bunch of similar things and so so I've been around this space for a while and want to share a",
    "start": "24720",
    "end": "31859"
  },
  {
    "text": "little bit of what I've learned and hopefully maybe uh you can it can ease some of your pain if you encounter this",
    "start": "31859",
    "end": "38760"
  },
  {
    "text": "kind of thing in your job so migrations here's the here is here is",
    "start": "38760",
    "end": "45000"
  },
  {
    "text": "the question to get us started um nobody really wants to do these things right when you mention it people go oh boy",
    "start": "45000",
    "end": "52440"
  },
  {
    "text": "migrations like they they just they're associated with bad like the not fun",
    "start": "52440",
    "end": "59100"
  },
  {
    "text": "part of of working in computers right because they're really hard and they're",
    "start": "59100",
    "end": "64378"
  },
  {
    "text": "hard for any number of reasons but which I'm going to get into but but I I'm",
    "start": "64379",
    "end": "69600"
  },
  {
    "text": "always struck by whenever you ask software Engineers like what kind of you know what kind of problems you want to",
    "start": "69600",
    "end": "74640"
  },
  {
    "text": "work on they're like oh what are your challenging technical problems you know like what's really hard at doordash and",
    "start": "74640",
    "end": "81180"
  },
  {
    "text": "I'm like well this migration has been taking us two years it's super hard and they're like oh boy",
    "start": "81180",
    "end": "87000"
  },
  {
    "text": "um so apparently software Engineers don't want to work on hard problems like I don't know I think they want to work",
    "start": "87000",
    "end": "92400"
  },
  {
    "text": "on Greenfield problems is what they want to do because they're actually easier",
    "start": "92400",
    "end": "97500"
  },
  {
    "text": "um so fun uh fun Paradox anyway you will all by coming here have made an important decision and it should be",
    "start": "97500",
    "end": "103619"
  },
  {
    "text": "recognized if you care about migrations clearly you are very you're enlightened you're wise you're above average",
    "start": "103619",
    "end": "110040"
  },
  {
    "text": "attractiveness and you should get a raise if your boss is here you know let them know",
    "start": "110040",
    "end": "116579"
  },
  {
    "text": "um migrations uh super hot all right very good so now that we're all friends um let's let's establish you know kind",
    "start": "116579",
    "end": "123840"
  },
  {
    "text": "of what specifically we're going to talk about here when I say migration uh what I mean is if you have a system that's",
    "start": "123840",
    "end": "131220"
  },
  {
    "text": "already working that you depend on and you need to make some major change to it",
    "start": "131220",
    "end": "136560"
  },
  {
    "text": "um like it could be decomposing your money with or it could be like like a database migration like you have one",
    "start": "136560",
    "end": "142140"
  },
  {
    "text": "kind of database and like you wish you had another database okay",
    "start": "142140",
    "end": "147239"
  },
  {
    "text": "um or a different kind of database that does you know sort of the same thing but in a You Know Better Way somehow and",
    "start": "147239",
    "end": "152580"
  },
  {
    "text": "this is um particularly the example I'm going to use uh is is kind of focused on going",
    "start": "152580",
    "end": "159420"
  },
  {
    "text": "from small to medium uh and and both in terms of like business size and",
    "start": "159420",
    "end": "166080"
  },
  {
    "text": "sophistication but I think the uh the recommendations are applicable to sort",
    "start": "166080",
    "end": "171840"
  },
  {
    "text": "of any level of of company size or or a technical sophistication okay",
    "start": "171840",
    "end": "177420"
  },
  {
    "start": "176000",
    "end": "468000"
  },
  {
    "text": "so let's get into this here like like why really is this so hard well one big",
    "start": "177420",
    "end": "182519"
  },
  {
    "text": "obvious reason is uh usually if you're doing a migration it's because you got something that was written a while ago",
    "start": "182519",
    "end": "189480"
  },
  {
    "text": "okay maybe a year maybe maybe less if you're lucky uh and if you're lucky the",
    "start": "189480",
    "end": "194879"
  },
  {
    "text": "reason you're lucky is because then the people are still around who actually understand it if you're unlucky uh then",
    "start": "194879",
    "end": "200580"
  },
  {
    "text": "maybe they have moved on and maybe nobody really is exactly sure how this thing works or you know the",
    "start": "200580",
    "end": "206400"
  },
  {
    "text": "institutional knowledge might have uh sort of atrophied a bit the other thing is when you're writing",
    "start": "206400",
    "end": "213780"
  },
  {
    "text": "software typically you're not thinking ah what happens when we want to replace",
    "start": "213780",
    "end": "218819"
  },
  {
    "text": "this like when you're building some system you typically are focused on your product features or you know what",
    "start": "218819",
    "end": "225780"
  },
  {
    "text": "whatever however whatever you think good software looks like and you're making your very straight-offs and you uh",
    "start": "225780",
    "end": "233340"
  },
  {
    "text": "rarely do you think oh what happens when this thing needs to be replaced you're like well that's gonna be someone else's",
    "start": "233340",
    "end": "239819"
  },
  {
    "text": "problem right like it usually is um but but you know sort of the next",
    "start": "239819",
    "end": "245280"
  },
  {
    "text": "level of detail is like when you're actually making the stuff when you're actually making software it's really",
    "start": "245280",
    "end": "250439"
  },
  {
    "text": "hard to know um you know you've got some you've got some goals you're trying to you're trying to achieve some some you know",
    "start": "250439",
    "end": "255900"
  },
  {
    "text": "business need you're trying to meet by writing your software it's hard to know the ways in which you're going to want",
    "start": "255900",
    "end": "261900"
  },
  {
    "text": "to change this thing in the future it's hard to actually even know why you're writing it if you're doing it right or",
    "start": "261900",
    "end": "267240"
  },
  {
    "text": "if you're inadvertently you know creating more code that you hate or also known as technical debt",
    "start": "267240",
    "end": "273540"
  },
  {
    "text": "um like it's hard right software is hard right that's why that's why they need like big rooms full of smart people like",
    "start": "273540",
    "end": "279240"
  },
  {
    "text": "us right but so this is the problem like it's it's hard to know when you're writing software how to make it flexible",
    "start": "279240",
    "end": "285479"
  },
  {
    "text": "in the right way that will make a migration easier and increasingly a lot of us work on",
    "start": "285479",
    "end": "292800"
  },
  {
    "text": "systems that you cannot turn off like they just have to be on all the time",
    "start": "292800",
    "end": "298220"
  },
  {
    "text": "like there's no maintenance window there's no we just reboot it you know",
    "start": "298220",
    "end": "304259"
  },
  {
    "text": "like to install the new version you know if you ship a video game binary you know you can restart it a mobile phone app",
    "start": "304259",
    "end": "310979"
  },
  {
    "text": "right you can restart the app when you install a new version but most service backends these days you kind of can't",
    "start": "310979",
    "end": "319380"
  },
  {
    "text": "take them down and that is a relatively new phenomenon is you know historically",
    "start": "319380",
    "end": "325320"
  },
  {
    "text": "in in software engineering we have not had very many systems that are like this but now we've got a lot of them",
    "start": "325320",
    "end": "332520"
  },
  {
    "text": "so that's what makes it hard and so if you've got one of these systems that you can't ever turn off",
    "start": "332520",
    "end": "339539"
  },
  {
    "text": "there's some rules that you basically need to follow which is everything you do must be forward and Backward",
    "start": "339539",
    "end": "345060"
  },
  {
    "text": "Compatible because you can't turn it off and importantly you're probably going to",
    "start": "345060",
    "end": "350520"
  },
  {
    "text": "make a mistake in the process so you're going to need to be able to roll it back the default answer if",
    "start": "350520",
    "end": "356940"
  },
  {
    "text": "anything ever goes wrong when you're working on one of these these systems is just roll it back and note that it",
    "start": "356940",
    "end": "362580"
  },
  {
    "text": "doesn't mean take it down it means because your changes are forward and Backward Compatible it means rolling it",
    "start": "362580",
    "end": "369539"
  },
  {
    "text": "back online and the system still stays up and hopefully you didn't you know corrupt any data or do anything do",
    "start": "369539",
    "end": "376560"
  },
  {
    "text": "anything really bad so I'm going to take you through uh how like this this big migration that that",
    "start": "376560",
    "end": "383280"
  },
  {
    "text": "doordash is just wrapping up now um as an example but I I think you'll",
    "start": "383280",
    "end": "388680"
  },
  {
    "text": "you can sort of see how this this type of these type of techniques map to all",
    "start": "388680",
    "end": "394020"
  },
  {
    "text": "sorts of different migrations you might undertake so first quick bit of History",
    "start": "394020",
    "end": "400100"
  },
  {
    "text": "this is the first commit to doordash this is Andy Fang and is Stanford I",
    "start": "400100",
    "end": "405600"
  },
  {
    "text": "think it was in his dorm room I don't know but it's Andy Fang at Stanford uh nearly 10 years ago",
    "start": "405600",
    "end": "411060"
  },
  {
    "text": "laying down that first commit so there he is initial Django project and Andy",
    "start": "411060",
    "end": "417479"
  },
  {
    "text": "still works at doordash if you were to say hey Andy um we're having this problem with a",
    "start": "417479",
    "end": "423360"
  },
  {
    "text": "Django thing he'd be like I've I don't know I have no idea like I wrote that thing 10 years ago like I really have no",
    "start": "423360",
    "end": "429479"
  },
  {
    "text": "idea what it is now anymore and furthermore if you'd asked him uh when",
    "start": "429479",
    "end": "436560"
  },
  {
    "text": "he was writing this thing 10 years ago do you think this thing will still be around in 10 years he would almost",
    "start": "436560",
    "end": "441840"
  },
  {
    "text": "certainly say no way like why like why would it be around in 10 years like we're just doing our Silicon Valley",
    "start": "441840",
    "end": "448139"
  },
  {
    "text": "minimum viable product right like it's minimally viable it doesn't this is not",
    "start": "448139",
    "end": "453840"
  },
  {
    "text": "I'm not building some enduring architecture for the you know the next decade um and yet I I ran this on my laptop",
    "start": "453840",
    "end": "462060"
  },
  {
    "text": "just the other day because this is still the active repo for this this thing that is still in production",
    "start": "462060",
    "end": "468840"
  },
  {
    "start": "468000",
    "end": "889000"
  },
  {
    "text": "so um I mean just barely in production is like almost gone okay so this is a super simplified",
    "start": "468840",
    "end": "476280"
  },
  {
    "text": "example of like the kind of major components at doordash you know so like eventually it was more than just it was",
    "start": "476280",
    "end": "482039"
  },
  {
    "text": "more than just the Django as you know with the browser clients and eventually you know hired more engineers and we",
    "start": "482039",
    "end": "487740"
  },
  {
    "text": "wrote we wrote some native clients in IOS and Android and you know we got a security team and don't expose any of",
    "start": "487740",
    "end": "494160"
  },
  {
    "text": "this stuff directly to the internet um you know all that stuff okay cool so then there's there's Django right so",
    "start": "494160",
    "end": "500940"
  },
  {
    "text": "this is our this is our python monolith and um and Django of course talks to",
    "start": "500940",
    "end": "506699"
  },
  {
    "text": "postgres postgres being the only correct Choice uh if you ask anyone on Hacker",
    "start": "506699",
    "end": "512459"
  },
  {
    "text": "News or Twitter they will definitely tell you this do not even think about using a different database to start your",
    "start": "512459",
    "end": "518580"
  },
  {
    "text": "initial project um just use postgres and save yourself a lot of Internet uh internet grief and",
    "start": "518580",
    "end": "524700"
  },
  {
    "text": "that is certainly uh what Andy did he did not want uh to get bombarded by uh",
    "start": "524700",
    "end": "530339"
  },
  {
    "text": "sort of care mat Engineers telling them that you know the various virtues of databases he's just like postgres",
    "start": "530339",
    "end": "537660"
  },
  {
    "text": "No One's Gonna you know No One's Gonna hassle me about making this decision",
    "start": "537660",
    "end": "542880"
  },
  {
    "text": "Okay cool so we got this thing and it's working pretty well it has a lot of benefits the um you know working in this",
    "start": "542880",
    "end": "550080"
  },
  {
    "text": "in this single code base right so it's like a single a single Docker container gets built has all giant pile of python",
    "start": "550080",
    "end": "557160"
  },
  {
    "text": "in it and when you release it you can do you know Atomic changes so you don't",
    "start": "557160",
    "end": "563160"
  },
  {
    "text": "necessarily need to do migrations inside of this monolithic python code base like",
    "start": "563160",
    "end": "568860"
  },
  {
    "text": "that's the cool part right so you can change code and you can change a bunch of apis internally around and you can",
    "start": "568860",
    "end": "575279"
  },
  {
    "text": "roll them out and and this this works pretty well and at small team size this",
    "start": "575279",
    "end": "580860"
  },
  {
    "text": "was working pretty well people you know people were all kind of working the same code base and the company's growing and",
    "start": "580860",
    "end": "587760"
  },
  {
    "text": "and this is this is going pretty well but then eventually they uh the things started to go not so well",
    "start": "587760",
    "end": "594959"
  },
  {
    "text": "which is uh eventually the test Suite started to get really slow uh it started",
    "start": "594959",
    "end": "601320"
  },
  {
    "text": "to get really flaky and developers started um you know with enough more developers",
    "start": "601320",
    "end": "607500"
  },
  {
    "text": "they are they're changing things faster than the kind of Release Train process",
    "start": "607500",
    "end": "613920"
  },
  {
    "text": "that we had set up could accommodate and so uh you know with the chances of",
    "start": "613920",
    "end": "619500"
  },
  {
    "text": "shipping a bug to production are always you know non-zero but with that many",
    "start": "619500",
    "end": "625140"
  },
  {
    "text": "more Engineers writing that much more software some tests or some bugs evade",
    "start": "625140",
    "end": "630360"
  },
  {
    "text": "the test Suite they get shipped to production and now they've got to get rolled back but now you've got way more",
    "start": "630360",
    "end": "635700"
  },
  {
    "text": "of your colleagues code on the same Release Train that all gets rolled back people are increasingly unhappy so so",
    "start": "635700",
    "end": "642779"
  },
  {
    "text": "we're we got to do something about this because um yeah it's sort of collapsing collapsing under its own weight",
    "start": "642779",
    "end": "649380"
  },
  {
    "text": "so um the first thing that we did is people reasonably observed that while it says",
    "start": "649380",
    "end": "655680"
  },
  {
    "text": "iOS client and Android client there's actually two iOS clients and two Android clients because there's the consumer app",
    "start": "655680",
    "end": "662459"
  },
  {
    "text": "which is the the one you've probably seen if you use doordash but then there's the the Dasher app or the driver",
    "start": "662459",
    "end": "667500"
  },
  {
    "text": "app they're separate apps so what they did was they made two deployments of",
    "start": "667500",
    "end": "674160"
  },
  {
    "text": "Django and internally I don't actually abbreviate Dasher as DX and consumer is CX so that's why that says that anyway",
    "start": "674160",
    "end": "681300"
  },
  {
    "text": "so now we've got two independent deployments they handle it's the same",
    "start": "681300",
    "end": "686700"
  },
  {
    "text": "code it's the exact same thing but they can be released independently of each other and you know roll back",
    "start": "686700",
    "end": "692700"
  },
  {
    "text": "independently of each other and you know we had the network layer we just make sure that",
    "start": "692700",
    "end": "698700"
  },
  {
    "text": "we you know we only send the apis you know the the HTTP requests that",
    "start": "698700",
    "end": "704880"
  },
  {
    "text": "correspond to each one of those um you know each one of those Django instances to the correct one and we're",
    "start": "704880",
    "end": "710339"
  },
  {
    "text": "still using the same you know the same sort of shared uh same uh postgres server here and so this we did actually",
    "start": "710339",
    "end": "716940"
  },
  {
    "text": "a few more splits like this but but it only delayed the inevitable because so remember each one of those blue boxes is",
    "start": "716940",
    "end": "723300"
  },
  {
    "text": "actually the same code it's just that they're deployed independently and they have you know different different sort",
    "start": "723300",
    "end": "729120"
  },
  {
    "text": "of externally facing apis garage them but it's the same stuff right so okay so",
    "start": "729120",
    "end": "734720"
  },
  {
    "text": "the you know that's it's it's getting it's getting worse and I want to point out that a neat thing that",
    "start": "734720",
    "end": "742740"
  },
  {
    "text": "um that you know Django and you know a lot of these a lot of sort of monolith architectures have is they have an orm",
    "start": "742740",
    "end": "749760"
  },
  {
    "text": "and an orm is uh interesting trade-off",
    "start": "749760",
    "end": "755880"
  },
  {
    "text": "um it is especially interesting and when you look at that diagram maybe you can",
    "start": "755880",
    "end": "761820"
  },
  {
    "text": "see why um and that's foreshadowing so now we must decide we must do",
    "start": "761820",
    "end": "768180"
  },
  {
    "text": "something right we where this thing is collapsing uh we we you know something's got to give so we got a couple of",
    "start": "768180",
    "end": "774899"
  },
  {
    "text": "choices one rewrite the whole thing um nah definitely that's gonna fix the",
    "start": "774899",
    "end": "780959"
  },
  {
    "text": "problem uh but uh when like no no one knows right and",
    "start": "780959",
    "end": "786360"
  },
  {
    "text": "um and also what is the problem like I guess the problem is the way we designed",
    "start": "786360",
    "end": "791399"
  },
  {
    "text": "the internal python interfaces wasn't right you know so we needed just",
    "start": "791399",
    "end": "797279"
  },
  {
    "text": "a major refactor to to make it so all this code that we've written is actually",
    "start": "797279",
    "end": "803519"
  },
  {
    "text": "organized in a sort of use usable way for as many Engineers as we have",
    "start": "803519",
    "end": "808800"
  },
  {
    "text": "so one way you could do that is you could rewrite it and obviously we're not going to do that so",
    "start": "808800",
    "end": "815040"
  },
  {
    "text": "we're going to break off some small pieces right like obviously we're gonna have to break off some small pieces there's no way we're running this thing we can't take it down cool so break off",
    "start": "815040",
    "end": "822720"
  },
  {
    "text": "some small pieces it is so for example what if we had uh those green boxes there like what if we had a",
    "start": "822720",
    "end": "829200"
  },
  {
    "text": "order service and a cart service and a order database and a cart database sounds pretty good",
    "start": "829200",
    "end": "836779"
  },
  {
    "text": "so how do we get that um first of all I'm going to give you a few options here of of ways in which we",
    "start": "836880",
    "end": "843660"
  },
  {
    "text": "could get to this point and I I just want to get it out of the way right now this all sounds bad like it's it's ugly",
    "start": "843660",
    "end": "850740"
  },
  {
    "text": "is it is not elegant at all it might require",
    "start": "850740",
    "end": "856860"
  },
  {
    "text": "um kind of some trade-offs that make that might make you sort of nervous or",
    "start": "856860",
    "end": "862440"
  },
  {
    "text": "just sort of feel like ah this is gross I don't know uh they all sound bad",
    "start": "862440",
    "end": "867899"
  },
  {
    "text": "and it's because they are all bad like these are these are not uh easy things",
    "start": "867899",
    "end": "873180"
  },
  {
    "text": "to do there are sort of uh there's no good options but there are probably are",
    "start": "873180",
    "end": "878339"
  },
  {
    "text": "some least bad options but remember you're the one that had to have go and have a successful business so uh it's",
    "start": "878339",
    "end": "885420"
  },
  {
    "text": "kind of your fault um so just just keep that in mind so uh recall that if we are making",
    "start": "885420",
    "end": "892500"
  },
  {
    "start": "889000",
    "end": "1130000"
  },
  {
    "text": "changes to an always-on system um everything has to be forwarded Backward Compatible right and if",
    "start": "892500",
    "end": "897720"
  },
  {
    "text": "anything goes wrong we're going to have to roll it back cool so with that in mind I'm going to start explaining some",
    "start": "897720",
    "end": "904260"
  },
  {
    "text": "of the different ways in which we could do that and this first this is uh this this is a a generic way of describing",
    "start": "904260",
    "end": "911820"
  },
  {
    "text": "this technique um depending on like which blog posts you read or whatever they might call this something else",
    "start": "911820",
    "end": "917820"
  },
  {
    "text": "um but I like to call it dual right because I think it emphasizes the gross part so uh so in this case uh we got a",
    "start": "917820",
    "end": "925680"
  },
  {
    "text": "client we got an old service and we got that their client is currently using and we got a new service and we wish the",
    "start": "925680",
    "end": "931920"
  },
  {
    "text": "clients were using that right so the first thing that we do is we get some kind of a backfill or a sink some kind",
    "start": "931920",
    "end": "938699"
  },
  {
    "text": "of thing that runs not um you know not not synchronously but",
    "start": "938699",
    "end": "944180"
  },
  {
    "text": "synchronizes the data uh from you know from the old server to the new service somehow",
    "start": "944180",
    "end": "950940"
  },
  {
    "text": "and then we're going to need some kind of API logic some logic some place where we can run some code that will make some",
    "start": "950940",
    "end": "957180"
  },
  {
    "text": "requests and you know just you know run some code we can put that that API logic",
    "start": "957180",
    "end": "962760"
  },
  {
    "text": "either in the client or we can put it in the old service or maybe we can put it in a intermediate uh service that we",
    "start": "962760",
    "end": "969720"
  },
  {
    "text": "write or maybe you can make your Envoy service mesh thing smart enough to do this like I don't know but",
    "start": "969720",
    "end": "976380"
  },
  {
    "text": "I'm just going to put it as a blue box floating in space there but just know that it could go in either the client or",
    "start": "976380",
    "end": "982320"
  },
  {
    "text": "the old service or maybe if you're good at envoy's webassembly or whatever you can do that",
    "start": "982320",
    "end": "987839"
  },
  {
    "text": "so what does it do with this API logic so it the goal is it wants to make it so",
    "start": "987839",
    "end": "993420"
  },
  {
    "text": "that the client doesn't know anything is happening okay client keeps using the original API as if nothing has changed",
    "start": "993420",
    "end": "999899"
  },
  {
    "text": "this is the goal so the way it does that is is it sends the rights as the system",
    "start": "999899",
    "end": "1006079"
  },
  {
    "text": "is working because remember we can't take it down so the system is always in use so there are rights coming in and it",
    "start": "1006079",
    "end": "1012560"
  },
  {
    "text": "replicates the the apis that are doing these rights and it sends them to both",
    "start": "1012560",
    "end": "1017899"
  },
  {
    "text": "the Old and the new and not only that it sends the reads to",
    "start": "1017899",
    "end": "1023480"
  },
  {
    "text": "old and the new but when it does that it runs some of this logic I was talking about which is to compare to compare the",
    "start": "1023480",
    "end": "1031819"
  },
  {
    "text": "answer so at first you're in a mode where you say we're gonna you know we're sending",
    "start": "1031819",
    "end": "1037400"
  },
  {
    "text": "rights to both and we're going to send reads to both also and then we're going to compare the values",
    "start": "1037400",
    "end": "1043400"
  },
  {
    "text": "and then make sure that things are making sense but that we're not actually",
    "start": "1043400",
    "end": "1048679"
  },
  {
    "text": "going to block anything if they don't we're going to you know go out you know make a metric out to or you know log",
    "start": "1048679",
    "end": "1055220"
  },
  {
    "text": "some event or you know some some way keep track of um how well this thing is working okay",
    "start": "1055220",
    "end": "1060880"
  },
  {
    "text": "and what we send to the client is the reads from the old service",
    "start": "1060880",
    "end": "1067220"
  },
  {
    "text": "but we're still writing and reading so we're running two things at the same time now so our costs have now roughly",
    "start": "1067220",
    "end": "1074660"
  },
  {
    "text": "doubled uh cost of doing business unfortunately so then once we're confident that the",
    "start": "1074660",
    "end": "1080299"
  },
  {
    "text": "you know the metrics are showing that this is working well then we flip that logic to say now",
    "start": "1080299",
    "end": "1086299"
  },
  {
    "text": "now use the new value but we need to keep using the old value or keep keep the old value viable in case we notice",
    "start": "1086299",
    "end": "1094940"
  },
  {
    "text": "some horrifying problem which you know generally you do like often you in the ones that I've worked on we've",
    "start": "1094940",
    "end": "1101900"
  },
  {
    "text": "we've gone back and forth you know we we flip it to use the new and then we're like oh no there's some weird new subtle",
    "start": "1101900",
    "end": "1108919"
  },
  {
    "text": "Edge case let me flip it back to the old and we fix that and you know we just keep flipping it back and forth until we",
    "start": "1108919",
    "end": "1116480"
  },
  {
    "text": "get the answer that that we're looking for so finally party time you can turn",
    "start": "1116480",
    "end": "1123320"
  },
  {
    "text": "that old thing off you've you know you've crossed the Rubicon there's no bringing it back um migration complete good job",
    "start": "1123320",
    "end": "1130460"
  },
  {
    "start": "1130000",
    "end": "1450000"
  },
  {
    "text": "so I know what you're thinking this sounds bad and I told you it would uh it",
    "start": "1130460",
    "end": "1136460"
  },
  {
    "text": "is bad um and here are some reasons that you might specifically think like you can't",
    "start": "1136460",
    "end": "1142039"
  },
  {
    "text": "possibly do this like you can't do migrations this way what if you use Auto and committing keys",
    "start": "1142039",
    "end": "1147799"
  },
  {
    "text": "well um you shouldn't do that you shouldn't",
    "start": "1147799",
    "end": "1153320"
  },
  {
    "text": "do that ever for any number of reasons um one is there will be a tendency to",
    "start": "1153320",
    "end": "1159799"
  },
  {
    "text": "expose those Auto incrementing IDs in your externally facing apis which will",
    "start": "1159799",
    "end": "1164900"
  },
  {
    "text": "allow people who would do you harm to either",
    "start": "1164900",
    "end": "1171280"
  },
  {
    "text": "probe all of the boundaries of your um your authorization system by guessing",
    "start": "1171280",
    "end": "1177380"
  },
  {
    "text": "IDs because you've made guessable IDs now now that the the you know this Auto",
    "start": "1177380",
    "end": "1183620"
  },
  {
    "text": "incrementing thing is is in the public API but also uh competitors can now gain",
    "start": "1183620",
    "end": "1192140"
  },
  {
    "text": "Intelligence on your internal business metrics um such as for example people might just",
    "start": "1192140",
    "end": "1198140"
  },
  {
    "text": "sign up and look at what their new customer ID is and just do that every day and then build a graph of how many",
    "start": "1198140",
    "end": "1204620"
  },
  {
    "text": "customers you have and they might place an order every day they might place them multiple days and they'll draw another graph and they'll completely understand",
    "start": "1204620",
    "end": "1210620"
  },
  {
    "text": "all of your internal metrics just because you're using Auto and commanding IDs okay so first bit of advice never do",
    "start": "1210620",
    "end": "1217760"
  },
  {
    "text": "this ever just uuids are great random IDs",
    "start": "1217760",
    "end": "1223039"
  },
  {
    "text": "it's the way to go if you do find yourself with auto incrementing Keys you're probably going to have to do some",
    "start": "1223039",
    "end": "1229220"
  },
  {
    "text": "form of migration first to get off of Auto incrementing keys so that you can",
    "start": "1229220",
    "end": "1235880"
  },
  {
    "text": "then get onto you know some some different system okay",
    "start": "1235880",
    "end": "1241460"
  },
  {
    "text": "what if one right fails in the other six seats so you know in that picture the API logic it's just like making two rpcs",
    "start": "1241460",
    "end": "1250280"
  },
  {
    "text": "right what happens they don't always both work and so",
    "start": "1250280",
    "end": "1256100"
  },
  {
    "text": "this is again where it gets a little gross um you do at least have the advantage that",
    "start": "1256100",
    "end": "1263480"
  },
  {
    "text": "you're only going to send the read back to the client like you know which one uh",
    "start": "1263480",
    "end": "1269780"
  },
  {
    "text": "you know which system you consider authoritative right you're either the older the new is authoritative at any",
    "start": "1269780",
    "end": "1275360"
  },
  {
    "text": "one time and so you could you could certainly at least send the client you know the",
    "start": "1275360",
    "end": "1280940"
  },
  {
    "text": "client response to the to the one you know from from the one that uh you know",
    "start": "1280940",
    "end": "1286940"
  },
  {
    "text": "you're currently favoring and just allow you know and still tell the client that it worked that's probably what you want",
    "start": "1286940",
    "end": "1293179"
  },
  {
    "text": "to do but remember how I said the very very first step was you needed uh some kind of a backfill or you know",
    "start": "1293179",
    "end": "1299960"
  },
  {
    "text": "synchronization um you probably have to run this regularly just to clean this mess up",
    "start": "1299960",
    "end": "1307760"
  },
  {
    "text": "unfortunately so this is the big one",
    "start": "1307760",
    "end": "1312919"
  },
  {
    "text": "my API is super important and I need transactions this is what everyone says I need transactions you're taking away",
    "start": "1312919",
    "end": "1319100"
  },
  {
    "text": "my transactions how how is this ever going to work well um there are many different ways that uh",
    "start": "1319100",
    "end": "1327200"
  },
  {
    "text": "people building very important systems um that uh you know move money around or",
    "start": "1327200",
    "end": "1333799"
  },
  {
    "text": "do do otherwise important things um have been able to be designed without",
    "start": "1333799",
    "end": "1339020"
  },
  {
    "text": "requiring strict transactions um earlier today we um we we've heard a",
    "start": "1339020",
    "end": "1346280"
  },
  {
    "text": "couple different talks that that discuss this I'm not going to go into the details of like how to avoid transactions but like it is possible",
    "start": "1346280",
    "end": "1354440"
  },
  {
    "text": "um to see other Green Room uh talks earlier today for for examples of uh of",
    "start": "1354440",
    "end": "1361520"
  },
  {
    "text": "how to do that Okay cool so it sounds bad it is bad but we're gonna do it anyway because we got to get rid of this",
    "start": "1361520",
    "end": "1367520"
  },
  {
    "text": "got to get rid of this uh monolith so okay great so here's how it works in our in our example so remember we want to we",
    "start": "1367520",
    "end": "1374480"
  },
  {
    "text": "want to add this order service right so we've got um this new service this new database and we're gonna first we're going to run",
    "start": "1374480",
    "end": "1381020"
  },
  {
    "text": "our you know background catch up you know sync process between the right tables and the postgres and",
    "start": "1381020",
    "end": "1387500"
  },
  {
    "text": "the right tables and the order database and then we're going to get our API wrapper which is really easy to do in",
    "start": "1387500",
    "end": "1393740"
  },
  {
    "text": "something like Django it's kind of cool because there's a a very clear place where all the API calls go through it's",
    "start": "1393740",
    "end": "1399799"
  },
  {
    "text": "a single cut base so um so this is an example of putting the API in the old Service as opposed to",
    "start": "1399799",
    "end": "1407059"
  },
  {
    "text": "putting it in the clients which would you know or or in a separate service inline",
    "start": "1407059",
    "end": "1413179"
  },
  {
    "text": "and so imagine that an API request you know comes in for something to do with",
    "start": "1413179",
    "end": "1418280"
  },
  {
    "text": "an order the API wrapper then does two things it makes the normal",
    "start": "1418280",
    "end": "1424039"
  },
  {
    "text": "python function call that it would have always done um you know previously and then it makes",
    "start": "1424039",
    "end": "1431059"
  },
  {
    "text": "a grpc into the order service and so this is this is the Dual right and and",
    "start": "1431059",
    "end": "1437900"
  },
  {
    "text": "likewise the reads work out the same way it makes a python function call to you know read read the order and it makes a",
    "start": "1437900",
    "end": "1444919"
  },
  {
    "text": "grpc over to the order service to to get the data back out so the other way you can do so note that",
    "start": "1444919",
    "end": "1451580"
  },
  {
    "start": "1450000",
    "end": "1560000"
  },
  {
    "text": "other blue box the orm is actually another very nice place where all of the",
    "start": "1451580",
    "end": "1457400"
  },
  {
    "text": "all of the database traffic goes through so just like all the API traffic goes through this API you know front door all",
    "start": "1457400",
    "end": "1464539"
  },
  {
    "text": "of the database traffic goes through the orm and the reason you might want to do",
    "start": "1464539",
    "end": "1469700"
  },
  {
    "text": "this is the reason that doordash did it which is the Django API that we are using",
    "start": "1469700",
    "end": "1477500"
  },
  {
    "text": "um has some very nice features that are that let you get started very quickly and let client developers do things very",
    "start": "1477500",
    "end": "1485900"
  },
  {
    "text": "flexibly such as for example um you can make a request that says oh",
    "start": "1485900",
    "end": "1491120"
  },
  {
    "text": "by the way I know I'm updating an order but on the response value I'm going to",
    "start": "1491120",
    "end": "1496400"
  },
  {
    "text": "need you to do a bunch of other stuff like join it with these other you know tables and pull back all this other",
    "start": "1496400",
    "end": "1503000"
  },
  {
    "text": "different information that is all you know it's you know it's like query parameters you know so it'll be like",
    "start": "1503000",
    "end": "1508580"
  },
  {
    "text": "update order but then it will be like you know question mark also return",
    "start": "1508580",
    "end": "1514220"
  },
  {
    "text": "arbitrary list of stuff right so this is actually what they were doing and that",
    "start": "1514220",
    "end": "1519860"
  },
  {
    "text": "made it very hard to do this at the purely API level because the API is doing all kinds of stuff it's hard it's",
    "start": "1519860",
    "end": "1526580"
  },
  {
    "text": "hard to know exactly get given a you know given a",
    "start": "1526580",
    "end": "1531820"
  },
  {
    "text": "prefix of a URL like what what it actually is going to do so uh what you",
    "start": "1531820",
    "end": "1538039"
  },
  {
    "text": "can do is do the same dual right logic in the in the orm and then you know eventually you might need to do a sort",
    "start": "1538039",
    "end": "1544460"
  },
  {
    "text": "of lightweight version of it at the API to switch it over or you know maybe in this case if you know everything is is",
    "start": "1544460",
    "end": "1549919"
  },
  {
    "text": "fully synchronized maybe maybe you can pull this off in the sort of internal you know the Ingress router layer this",
    "start": "1549919",
    "end": "1556580"
  },
  {
    "text": "is actually what we do for a number of these so there is a surprising third option",
    "start": "1556580",
    "end": "1563240"
  },
  {
    "start": "1560000",
    "end": "1648000"
  },
  {
    "text": "and so this is kind of interesting because it is it maximizes the ugly like",
    "start": "1563240",
    "end": "1568760"
  },
  {
    "text": "it maximizes the gross Factor um in exchange for something so in this particular case what we've",
    "start": "1568760",
    "end": "1575960"
  },
  {
    "text": "done is order service is sharing",
    "start": "1575960",
    "end": "1581720"
  },
  {
    "text": "the database with postgres and that's kind of interesting that's",
    "start": "1581720",
    "end": "1588140"
  },
  {
    "text": "not usually what you see and we taught the orm how to do half of",
    "start": "1588140",
    "end": "1593720"
  },
  {
    "text": "the Dual right you know but but uh order service is sharing the database and the",
    "start": "1593720",
    "end": "1600080"
  },
  {
    "text": "reason for that is that new green box that's over there on the left which is",
    "start": "1600080",
    "end": "1605419"
  },
  {
    "text": "a new client using a new API okay so the other one the other clients are all using the old and boring API and",
    "start": "1605419",
    "end": "1612799"
  },
  {
    "text": "that's where we we try to make it you know remember the original goal was make the clients think that nothing has",
    "start": "1612799",
    "end": "1618380"
  },
  {
    "text": "changed and this one is just like wow let's just get some new clients that work the way we want them to and you",
    "start": "1618380",
    "end": "1625220"
  },
  {
    "text": "know so it's interesting because it does allow you to make some progress like some some product progress for perhaps",
    "start": "1625220",
    "end": "1632299"
  },
  {
    "text": "like this new client's uh lots of people will probably use it you know and and",
    "start": "1632299",
    "end": "1638659"
  },
  {
    "text": "you're not necessarily stuck behind some multi-year migration before you can you",
    "start": "1638659",
    "end": "1644419"
  },
  {
    "text": "know ship new software or update your apis so what did we do",
    "start": "1644419",
    "end": "1650360"
  },
  {
    "start": "1648000",
    "end": "2104000"
  },
  {
    "text": "well we started with the database tool right because you know like I said we're using",
    "start": "1650360",
    "end": "1656600"
  },
  {
    "text": "that that external API had all that flexibility in it and it was just like really hard to work with so uh doing it",
    "start": "1656600",
    "end": "1664159"
  },
  {
    "text": "at the APA API layer was was too hot took a long time uh this was this was",
    "start": "1664159",
    "end": "1669860"
  },
  {
    "text": "before my time but um apparently I've done you know I've done some archeology on on what the team had done and",
    "start": "1669860",
    "end": "1675740"
  },
  {
    "text": "apparently it just caused all sorts of problems it corrupted a bunch of data and it was just it was really bad",
    "start": "1675740",
    "end": "1682220"
  },
  {
    "text": "um just everyone that was around then that's still here now uh they all have kind of like scars and they're like if",
    "start": "1682220",
    "end": "1688580"
  },
  {
    "text": "you're gonna do if you're you know if you're just I don't even want to know how you're going to do it I just don't even want to be involved because they",
    "start": "1688580",
    "end": "1693760"
  },
  {
    "text": "apparently it was bad anyway after that a really bad experience they said you",
    "start": "1693760",
    "end": "1699980"
  },
  {
    "text": "know what we should we could just share the database for a little while and then we",
    "start": "1699980",
    "end": "1706460"
  },
  {
    "text": "can start you know shipping you new you know features and and we'll have a uh",
    "start": "1706460",
    "end": "1711679"
  },
  {
    "text": "you know that that synchronizing process um if we make a really clever one you know they're really clever uh a",
    "start": "1711679",
    "end": "1719059"
  },
  {
    "text": "background syncing process um maybe we can use that as our kind of",
    "start": "1719059",
    "end": "1724580"
  },
  {
    "text": "cut over switch when we're when we're ready to go um might violate the um the the property",
    "start": "1724580",
    "end": "1731659"
  },
  {
    "text": "of always being able to roll forward and backward maybe a little or not taking a maintenance window I guess is maybe the",
    "start": "1731659",
    "end": "1737240"
  },
  {
    "text": "the bigger one but um anyway so so they I mean they had their reasons but",
    "start": "1737240",
    "end": "1743720"
  },
  {
    "text": "um the main one is that they didn't want to get stuck they didn't want to get stuck so it made everybody happier so they're like yay or",
    "start": "1743720",
    "end": "1751279"
  },
  {
    "text": "we got a new client out there it's got this new API people like the new API you know developers like it because the old",
    "start": "1751279",
    "end": "1756320"
  },
  {
    "text": "one was hard and anyone's good and that was cool for a while except this",
    "start": "1756320",
    "end": "1763700"
  },
  {
    "text": "supporting this thing with the with the shared the shared database and",
    "start": "1763700",
    "end": "1769880"
  },
  {
    "text": "um curiously the um the kind of uh uh yeah currently the um the the the way",
    "start": "1769880",
    "end": "1779899"
  },
  {
    "text": "that we're we're sharing the database to get this you know functionality out um it was it was hard and it uh came at",
    "start": "1779899",
    "end": "1787220"
  },
  {
    "text": "a time when we were growing a lot we uh grew to the point uh where we could no",
    "start": "1787220",
    "end": "1792919"
  },
  {
    "text": "longer use uh normal postgres replication um so this was really unfortunate so",
    "start": "1792919",
    "end": "1799100"
  },
  {
    "text": "it's not really postgres it's AWS Aurora like postgres flavored Aurora and during",
    "start": "1799100",
    "end": "1804320"
  },
  {
    "text": "the pandemic doordash grew a lot we got to the point where we couldn't actually enable the right head log we had to use",
    "start": "1804320",
    "end": "1812600"
  },
  {
    "text": "just magic postgres replication so um the the neat tricks we were going to",
    "start": "1812600",
    "end": "1818899"
  },
  {
    "text": "pull to get our databases synced up uh with with no downtime were increasingly",
    "start": "1818899",
    "end": "1824299"
  },
  {
    "text": "hard to do because the thing got bigger over time so we went back and you know",
    "start": "1824299",
    "end": "1830960"
  },
  {
    "text": "we sort of went and applied a mix of both of these techniques and you know we're slowly Burning It Down",
    "start": "1830960",
    "end": "1837080"
  },
  {
    "text": "um sadly we had to do some Force upgrades um so I don't have the exact um the exact number of of Engineers uh",
    "start": "1837080",
    "end": "1843980"
  },
  {
    "text": "who worked on this but I can tell you that when I was at Uber for our big monolith application for at least a year",
    "start": "1843980",
    "end": "1851080"
  },
  {
    "text": "25 of the engineering team was dedicated to retiring the monolith like 25 and like I",
    "start": "1851080",
    "end": "1860720"
  },
  {
    "text": "mean Uber had a much larger engineering team than doordash does and so this is a incredibly expensive process",
    "start": "1860720",
    "end": "1868539"
  },
  {
    "text": "so uh given the stakes right like this is a lot of if you get this wrong where",
    "start": "1868700",
    "end": "1875240"
  },
  {
    "text": "you're going to Dedicated quarter of your engineers to like doing some migration sounds bad well",
    "start": "1875240",
    "end": "1881179"
  },
  {
    "text": "you know how so I said like there's probably one that that's less bad so the API deal right or the the DB dual",
    "start": "1881179",
    "end": "1888200"
  },
  {
    "text": "right it's it's nice because it's always Backward Compatible you know maintains that property",
    "start": "1888200",
    "end": "1893600"
  },
  {
    "text": "um you've only got one external API to support which probably makes your security people happy",
    "start": "1893600",
    "end": "1898940"
  },
  {
    "text": "um you know it's like the the the the fraud and the rate limiting and all that stuff um it's just it's a lot easier to to",
    "start": "1898940",
    "end": "1905299"
  },
  {
    "text": "manage one uh One external API um but it might be tricky if your",
    "start": "1905299",
    "end": "1912679"
  },
  {
    "text": "external API is flexible or seems like a query language",
    "start": "1912679",
    "end": "1918140"
  },
  {
    "text": "um that might make it hard so also if you if you've been uh been",
    "start": "1918140",
    "end": "1923960"
  },
  {
    "text": "around for a while it might it might if your api's been around for a while it might well be that it has begun to",
    "start": "1923960",
    "end": "1930080"
  },
  {
    "text": "diverge from the actual data model that exists in the database this certainly",
    "start": "1930080",
    "end": "1936320"
  },
  {
    "text": "was the case for us in that that made it harder also",
    "start": "1936320",
    "end": "1941720"
  },
  {
    "text": "but really the main thing to to just get real honest with yourself about is you'll do this whole upgrade and at the",
    "start": "1941720",
    "end": "1949039"
  },
  {
    "text": "end of it you will have two things that work exactly the same way that the that your old one thing did and strictly",
    "start": "1949039",
    "end": "1954799"
  },
  {
    "text": "speaking it might actually be like worse you know like you've got you've not made",
    "start": "1954799",
    "end": "1960799"
  },
  {
    "text": "any progress you've got you're on a new maybe Tech stack but like this whole time you sort of didn't make any",
    "start": "1960799",
    "end": "1967820"
  },
  {
    "text": "progress you just moved it uh and that can be difficult to justify",
    "start": "1967820",
    "end": "1973880"
  },
  {
    "text": "uh I like especially from your your business partners might not um",
    "start": "1973880",
    "end": "1978919"
  },
  {
    "text": "I might have a hard time kind of coming to grips with with that right uh so yeah depending on uh you know",
    "start": "1978919",
    "end": "1985760"
  },
  {
    "text": "which one of these you want to do kind of depends on details of of your thing and so the shared database thing is is",
    "start": "1985760",
    "end": "1993500"
  },
  {
    "text": "interesting especially if you have an API that sort of resists that kind of uh",
    "start": "1993500",
    "end": "1998720"
  },
  {
    "text": "that kind of um you know the the clean clean migration of subsets of it",
    "start": "1998720",
    "end": "2004720"
  },
  {
    "text": "um it might it might well be that you know you can you can do this this and maybe make the business folks happy that",
    "start": "2004720",
    "end": "2011260"
  },
  {
    "text": "you're still making some making some progress um maybe it could well be but um what we",
    "start": "2011260",
    "end": "2017980"
  },
  {
    "text": "found was well at first everyone was happy the the ongoing operational complexity of having Services sharing",
    "start": "2017980",
    "end": "2023860"
  },
  {
    "text": "databases is really really tricky the longer it lives like that the the just",
    "start": "2023860",
    "end": "2029799"
  },
  {
    "text": "like the harder it gets um and like for example does everybody know the caches like are",
    "start": "2029799",
    "end": "2036039"
  },
  {
    "text": "there two caches or are you sharing the cash or you're sharing the cash like now you have code that like in two different",
    "start": "2036039",
    "end": "2042460"
  },
  {
    "text": "places that both reads and writes the cash and region rights database like ah it's crazy so",
    "start": "2042460",
    "end": "2047919"
  },
  {
    "text": "um you know be aware of that um and you know when you get all done with it it might not be so clean to kind",
    "start": "2047919",
    "end": "2054580"
  },
  {
    "text": "of flip the switch forward and backward it might if you you know you have clever database people maybe they can uh you",
    "start": "2054580",
    "end": "2059919"
  },
  {
    "text": "know come up with a layer that you can use to sort of do this but really for us the big problem we had was everyone was",
    "start": "2059919",
    "end": "2066220"
  },
  {
    "text": "excited that they got to work on the new thing and then they were just like I'm not touching that thing a shared database no thanks like this is",
    "start": "2066220",
    "end": "2074138"
  },
  {
    "text": "that's got to be someone else's problem and that's part of part of why this thing took took too long anyway I don't",
    "start": "2074139",
    "end": "2079599"
  },
  {
    "text": "like this way I think you should avoid it at all costs but I wanted to bring it up not only because it's what we",
    "start": "2079599",
    "end": "2085419"
  },
  {
    "text": "actually did for the majority of this migration but also I think it is",
    "start": "2085419",
    "end": "2091960"
  },
  {
    "text": "I think you can do it it is a it makes a very real business trade-off that if",
    "start": "2091960",
    "end": "2098080"
  },
  {
    "text": "you're disciplined I think I think it can work but it didn't work it didn't work very well for us but who knows",
    "start": "2098080",
    "end": "2104200"
  },
  {
    "start": "2104000",
    "end": "2321000"
  },
  {
    "text": "so this all sounds bad and um I there are some things though that you can do",
    "start": "2104200",
    "end": "2110200"
  },
  {
    "text": "if you're building new systems that you can do to make it easier on future you",
    "start": "2110200",
    "end": "2116500"
  },
  {
    "text": "or on Whoever has your job after after you get promoted or leave um there there are ways that you can you",
    "start": "2116500",
    "end": "2124300"
  },
  {
    "text": "can help so the first one is maybe just never use an",
    "start": "2124300",
    "end": "2129640"
  },
  {
    "text": "orm like they sound so tempting but I don't think the productivity gains are",
    "start": "2129640",
    "end": "2135640"
  },
  {
    "text": "are significant and the migration complexity um is is brutal",
    "start": "2135640",
    "end": "2142599"
  },
  {
    "text": "um with um it's it's nice that there's one place that all the queries go",
    "start": "2142599",
    "end": "2148180"
  },
  {
    "text": "through but it's not nice that it's um like if you want to change database Technologies you're going to like kind",
    "start": "2148180",
    "end": "2153940"
  },
  {
    "text": "of implement two different kinds of dual right or or I don't know it's it is it's not a very good choice compared to",
    "start": "2153940",
    "end": "2162040"
  },
  {
    "text": "um explicitly managing queries that um you just know exactly what the query is going to be and you just write SQL or",
    "start": "2162040",
    "end": "2169900"
  },
  {
    "text": "whatever you do you know whatever your query language is for your database also maybe just don't use postgres",
    "start": "2169900",
    "end": "2177579"
  },
  {
    "text": "um you just uh just take the hit of people telling you you're doing it wrong",
    "start": "2177579",
    "end": "2183040"
  },
  {
    "text": "and um just telling you went to this talk or something like I don't know but the uh",
    "start": "2183040",
    "end": "2189339"
  },
  {
    "text": "the single the single primary makes it very hard to always be up to always be",
    "start": "2189339",
    "end": "2197079"
  },
  {
    "text": "online um upgrading it like I mean I'm not even talking about migrations I'm just like operating it",
    "start": "2197079",
    "end": "2203200"
  },
  {
    "text": "um like how do you get the new version well you just like take it down for 10 minutes and do the you know upgrade and",
    "start": "2203200",
    "end": "2209380"
  },
  {
    "text": "then you bring it back and you hope it worked um that same that same problem is uh is",
    "start": "2209380",
    "end": "2215619"
  },
  {
    "text": "there with uh you know with migrations as well like this the single one database that simply can't fail",
    "start": "2215619",
    "end": "2222820"
  },
  {
    "text": "um it just makes it very very hard to to do these kind of migrations so probably probably steer clear of that if",
    "start": "2222820",
    "end": "2230380"
  },
  {
    "text": "you can if you can afford the the uh the the sort of going against conventional wisdom I",
    "start": "2230380",
    "end": "2237099"
  },
  {
    "text": "suppose um so events event-based systems are very",
    "start": "2237099",
    "end": "2242200"
  },
  {
    "text": "cool and they fix a whole bunch of problems in exchange for some other ones",
    "start": "2242200",
    "end": "2248740"
  },
  {
    "text": "um I'm not going to get into that other people have talked about that today the thing that I would just point out with",
    "start": "2248740",
    "end": "2254140"
  },
  {
    "text": "regard to migrations if you have a mix of them it's going to",
    "start": "2254140",
    "end": "2259660"
  },
  {
    "text": "be much harder the because we did we we mixed it was",
    "start": "2259660",
    "end": "2267040"
  },
  {
    "text": "the the system was more than just you know RPC based there were also like",
    "start": "2267040",
    "end": "2272980"
  },
  {
    "text": "some Django things would send events to themselves and then they would some",
    "start": "2272980",
    "end": "2279339"
  },
  {
    "text": "microservice interfaces were event based and some of them were RPC based and it's",
    "start": "2279339",
    "end": "2284560"
  },
  {
    "text": "this is very very complicated uh to to do migration around that for for this",
    "start": "2284560",
    "end": "2290619"
  },
  {
    "text": "reason because it's not a very good abstraction if you if you do it that way and I actually think the key regardless",
    "start": "2290619",
    "end": "2297880"
  },
  {
    "text": "of the specifics of like well or I'm SQL database maybe that's just my opinion",
    "start": "2297880",
    "end": "2303040"
  },
  {
    "text": "um you know or maybe that's just my limited experience you know maybe if I'd done a thousand migrations maybe I would",
    "start": "2303040",
    "end": "2309339"
  },
  {
    "text": "be able to speak more authoritatively about that but what I think the real most important thing you can do is when you're Building",
    "start": "2309339",
    "end": "2316180"
  },
  {
    "text": "Systems is you use what I will call good abstractions and I'm going to spend a",
    "start": "2316180",
    "end": "2321460"
  },
  {
    "start": "2321000",
    "end": "2628000"
  },
  {
    "text": "little time getting into that this is a definition that I have I didn't get this from a book this is just",
    "start": "2321460",
    "end": "2327280"
  },
  {
    "text": "my own personal belief but I like it I think that",
    "start": "2327280",
    "end": "2332380"
  },
  {
    "text": "um this should be the goal especially like especially in your scaling out systems You're Building distributed systems or",
    "start": "2332380",
    "end": "2339160"
  },
  {
    "text": "you're growing teams like this is this the same rule works for you know for teams working in a monolith even",
    "start": "2339160",
    "end": "2346000"
  },
  {
    "text": "which is the abstraction should serve this",
    "start": "2346000",
    "end": "2351400"
  },
  {
    "text": "purpose I believe and if it doesn't I I submitted as maybe not a good abstraction it might be elegant or clean",
    "start": "2351400",
    "end": "2357760"
  },
  {
    "text": "or adhere to some design pattern or something but if you have to make",
    "start": "2357760",
    "end": "2363520"
  },
  {
    "text": "changes on both sides of it every time or most of the time",
    "start": "2363520",
    "end": "2368980"
  },
  {
    "text": "um I think that's probably not a good abstraction so let's you know the the reasons for this is",
    "start": "2368980",
    "end": "2376300"
  },
  {
    "text": "like bull like as you you get more more people working on on this system they need to be able to move independently",
    "start": "2376300",
    "end": "2382119"
  },
  {
    "text": "and if they're always having to coordinate with each other that's hard like they need to be able to",
    "start": "2382119",
    "end": "2387520"
  },
  {
    "text": "change something on one side of the abstraction rather than the you know rather than on both sides otherwise",
    "start": "2387520",
    "end": "2392680"
  },
  {
    "text": "adding more Engineers doesn't actually make you go any faster also uh I I hear this a lot people say",
    "start": "2392680",
    "end": "2400900"
  },
  {
    "text": "oh if we just use this framework we will get all of this stuff for free if you ever hear that my my advice is",
    "start": "2400900",
    "end": "2410440"
  },
  {
    "text": "um don't believe it because it is almost never true given time given some amount",
    "start": "2410440",
    "end": "2416980"
  },
  {
    "text": "of time that freeness um someone's gonna have to pay for it",
    "start": "2416980",
    "end": "2422680"
  },
  {
    "text": "um this might be actually my my favorite version of the the technical debt metaphor uh which is like anytime",
    "start": "2422680",
    "end": "2429040"
  },
  {
    "text": "somebody does something you can get for free I mean someone is going to have to pay it back later um",
    "start": "2429040",
    "end": "2434560"
  },
  {
    "text": "so here's a fun thing think about abstractions that you have in the system that you work on",
    "start": "2434560",
    "end": "2441099"
  },
  {
    "text": "and try to apply that definition to it like can you make a change to one side of it a meaningful change like something",
    "start": "2441099",
    "end": "2447280"
  },
  {
    "text": "that you know helps somehow can you make a change to one side of the abstraction without coordinating with the other side",
    "start": "2447280",
    "end": "2455079"
  },
  {
    "text": "or making a change on the other side like how much of your work can you do",
    "start": "2455079",
    "end": "2460240"
  },
  {
    "text": "like that so here's a couple specific examples like is graphql good a good abstraction",
    "start": "2460240",
    "end": "2467980"
  },
  {
    "text": "I mean certainly from the clients developers perspective it is it's great you can make all kinds of changes change",
    "start": "2467980",
    "end": "2474339"
  },
  {
    "text": "stuff all day long it's cool it's queer language good job um unless you do it really really",
    "start": "2474339",
    "end": "2480540"
  },
  {
    "text": "strictly and carefully um I would say this generally doesn't",
    "start": "2480540",
    "end": "2485800"
  },
  {
    "text": "hold true on the back end now can you throw lots of Engineers at it like a Facebook or you know some",
    "start": "2485800",
    "end": "2491380"
  },
  {
    "text": "other big company yeah sure of course you can um but is it a good abstraction I mean not by default I would say",
    "start": "2491380",
    "end": "2497680"
  },
  {
    "text": "probably not this one's sort of a trick question but um is Kafka a good abstraction",
    "start": "2497680",
    "end": "2504640"
  },
  {
    "text": "and I think the answer is it is a trick question because it's too low level by itself it's not you need to layer",
    "start": "2504640",
    "end": "2512079"
  },
  {
    "text": "something on top of it like there's there's some framework some message format some some way of getting data",
    "start": "2512079",
    "end": "2518740"
  },
  {
    "text": "into and out of Kafka that's the abstraction and it should you should",
    "start": "2518740",
    "end": "2524320"
  },
  {
    "text": "still be able to apply that that property to it it might actually make it easier to apply that property to it but",
    "start": "2524320",
    "end": "2529599"
  },
  {
    "text": "it won't it won't by default like you don't you don't actually get a good abstraction for free like you gotta you",
    "start": "2529599",
    "end": "2535480"
  },
  {
    "text": "got to work out a little bit so wrapping up a little bit why are all these migration so hard like this just",
    "start": "2535480",
    "end": "2541780"
  },
  {
    "text": "it's all ugly and it's all just doesn't seem good the main reason is because everybody",
    "start": "2541780",
    "end": "2547540"
  },
  {
    "text": "builds custom Solutions when they when they have these problems they build their own custom internal tooling this",
    "start": "2547540",
    "end": "2553240"
  },
  {
    "text": "talk that I just gave today I could have given it five years ago or ten years ago maybe I would change graphql because not",
    "start": "2553240",
    "end": "2559060"
  },
  {
    "text": "a lot of people knew about it 10 years ago but um or did it exist I don't know it doesn't matter the point is the this",
    "start": "2559060",
    "end": "2565599"
  },
  {
    "text": "migration problem hasn't changed in 10 years so like here we are we're we were",
    "start": "2565599",
    "end": "2571480"
  },
  {
    "text": "doing dual rights 10 years ago and we're still doing them now um Everybody builds their own thing and",
    "start": "2571480",
    "end": "2577960"
  },
  {
    "text": "it just you know vanishes in their internal you know in their internal code",
    "start": "2577960",
    "end": "2583119"
  },
  {
    "text": "you know and it's hard to justify with your your business partners like the time it will take maybe to to sort of",
    "start": "2583119",
    "end": "2589720"
  },
  {
    "text": "build good abstractions versus product features and and I I think good",
    "start": "2589720",
    "end": "2594819"
  },
  {
    "text": "abstractions is definitely the way to think about it but yeah I understand it's hard um a big another big problem that I",
    "start": "2594819",
    "end": "2600220"
  },
  {
    "text": "noticed is a lot of people they they take this uh premature optimization as a root of all evil uh you know saying",
    "start": "2600220",
    "end": "2608260"
  },
  {
    "text": "um and they they apply it so hard like so hard that you can never optimize",
    "start": "2608260",
    "end": "2614200"
  },
  {
    "text": "anything there's like optimization who cares I don't want to do don't want to do it prematurely so let's just never do",
    "start": "2614200",
    "end": "2620740"
  },
  {
    "text": "it or ever even be able to do it is unfortunately what I what what I somehow people have kind of interpreted",
    "start": "2620740",
    "end": "2627579"
  },
  {
    "text": "that um but like look why is it really so hard it's because these things are you know",
    "start": "2627579",
    "end": "2634180"
  },
  {
    "start": "2628000",
    "end": "3081000"
  },
  {
    "text": "they're not adding Direct business value and they you know they're going to be hard and you know you might break",
    "start": "2634180",
    "end": "2639280"
  },
  {
    "text": "something and after a while you just go uh this is just maybe we can just deal with",
    "start": "2639280",
    "end": "2645520"
  },
  {
    "text": "you know maybe we can just ignore it for another year or maybe like I don't know just after a while you just start",
    "start": "2645520",
    "end": "2650980"
  },
  {
    "text": "thinking ah this is too hard to do let's just not do it um and another related problem is for",
    "start": "2650980",
    "end": "2657280"
  },
  {
    "text": "whatever reason senior Engineers don't think this is interesting which I I is really curious to me like",
    "start": "2657280",
    "end": "2664060"
  },
  {
    "text": "it's so hard Engineers want to work on hard problems so they say what do they do every migration ever like they should",
    "start": "2664060",
    "end": "2670060"
  },
  {
    "text": "they should build this tooling right um and importantly though you get what you reward and I think if we rewarded",
    "start": "2670060",
    "end": "2677800"
  },
  {
    "text": "Engineers for working on migrations I bet you'd find that we suddenly got some good tooling and you know like this got",
    "start": "2677800",
    "end": "2685000"
  },
  {
    "text": "easier for everybody right because it is good for your career um but you know until we fix that",
    "start": "2685000",
    "end": "2691119"
  },
  {
    "text": "problem uh it's probably probably not going to change and I'll probably have to give this talk 10 years from now",
    "start": "2691119",
    "end": "2697780"
  },
  {
    "text": "um but you know senior Engineers that should be your job it should be your job is is is leverage and you know these",
    "start": "2697780",
    "end": "2705880"
  },
  {
    "text": "kind of migrations have tremendous leverage because they're so expensive so if you can find good ways to automate",
    "start": "2705880",
    "end": "2711460"
  },
  {
    "text": "doing these migrations you know building these Frameworks building the comparisons you know the Dual all that",
    "start": "2711460",
    "end": "2716980"
  },
  {
    "text": "dual right stuff all whatever this is tremendously leveraged work um and I wish more people would do it",
    "start": "2716980",
    "end": "2723460"
  },
  {
    "text": "anyway that is all I have thank you very much [Applause]",
    "start": "2723460",
    "end": "2733240"
  },
  {
    "text": "thank you Matt that was a very interesting talk uh we've got a few minutes left so let's start with three",
    "start": "2733240",
    "end": "2739660"
  },
  {
    "text": "questions maybe hands up oh gotta walk all the way there",
    "start": "2739660",
    "end": "2745440"
  },
  {
    "text": "hi uh can you share your experience regarding",
    "start": "2753700",
    "end": "2759400"
  },
  {
    "text": "software Engineers opinions when were you doing when you are doing such migrations because you need to take",
    "start": "2759400",
    "end": "2765339"
  },
  {
    "text": "their suggestions and and they are way of doing of work and their opinions",
    "start": "2765339",
    "end": "2770619"
  },
  {
    "text": "right so there will be oh yeah 10 engineers and how did you deal with that yeah I mean look I am I'm compressing",
    "start": "2770619",
    "end": "2776800"
  },
  {
    "text": "this uh into uh you know what we can fit into a you know 45 minutes of of me",
    "start": "2776800",
    "end": "2782740"
  },
  {
    "text": "talking at you up on this stage but like yeah what what I'm hoping you can do is",
    "start": "2782740",
    "end": "2788520"
  },
  {
    "text": "guide Engineers past whatever their current wrong wrong opinions are",
    "start": "2788520",
    "end": "2794260"
  },
  {
    "text": "um to get them to build better systems that are you know automated and and you",
    "start": "2794260",
    "end": "2799359"
  },
  {
    "text": "know safe to move forward and backward and like make migrations easier everyone thinks they're hard and we can spend all",
    "start": "2799359",
    "end": "2805300"
  },
  {
    "text": "day trying to understand why they think they're hard but I think the real issue is to like motivate people or the real",
    "start": "2805300",
    "end": "2811900"
  },
  {
    "text": "thing to do from a management perspective is is motivate people that this is an automatable problem",
    "start": "2811900",
    "end": "2819339"
  },
  {
    "text": "that is that is my my very strong recommendation is this is a hard engineering problem you will get",
    "start": "2819339",
    "end": "2825400"
  },
  {
    "text": "rewarded you can write software to fix it it's what you want like automate it",
    "start": "2825400",
    "end": "2831400"
  },
  {
    "text": "next question",
    "start": "2831400",
    "end": "2834059"
  },
  {
    "text": "you mentioned that um you recommend not mixing RPC and event",
    "start": "2836920",
    "end": "2842560"
  },
  {
    "text": "um in the same architecture so certainly in the same like like data model okay yeah yeah yeah",
    "start": "2842560",
    "end": "2849000"
  },
  {
    "text": "so why is like you know be different on that yeah yeah sure how do you fix that",
    "start": "2849000",
    "end": "2854140"
  },
  {
    "text": "in order sure sure so the reason that I mean I should have maybe said a couple more sentences about that",
    "start": "2854140",
    "end": "2859300"
  },
  {
    "text": "um like so the reason that that makes it hard is because in a in a purely RPC model you've got uh the one you know",
    "start": "2859300",
    "end": "2867160"
  },
  {
    "text": "that API logic blue box where you're making the decision of are we using the old one or the new one which one you",
    "start": "2867160",
    "end": "2873099"
  },
  {
    "text": "know are comparing and which one are we returning um now you have to have that in two places",
    "start": "2873099",
    "end": "2879220"
  },
  {
    "text": "because now you need some way of also doing that for every event you produce and consume",
    "start": "2879220",
    "end": "2885880"
  },
  {
    "text": "and it's easy if you have one or the or it's easier if you have one or the other",
    "start": "2885880",
    "end": "2891940"
  },
  {
    "text": "but as soon as you have two ways now you have to implement the same kind of dual right logic or something you know",
    "start": "2891940",
    "end": "2898240"
  },
  {
    "text": "whatever the equivalent of it is on the event side and you know it might actually be easier to do this in some",
    "start": "2898240",
    "end": "2904000"
  },
  {
    "text": "cases for event-based systems the the point is is different and so now you have two places where that logic has to",
    "start": "2904000",
    "end": "2911500"
  },
  {
    "text": "live um and it's it's just much harder to sort of understand where I mean I guess like how",
    "start": "2911500",
    "end": "2920260"
  },
  {
    "text": "much progress you're making is certainly what we found is it was very easy to say hey look traffic through the API server",
    "start": "2920260",
    "end": "2926200"
  },
  {
    "text": "it's like going down we're getting this but like all the events are flying all over the place constantly like this will",
    "start": "2926200",
    "end": "2933760"
  },
  {
    "text": "end up with the same number of events when we're done um this yeah I just it it just makes it",
    "start": "2933760",
    "end": "2940119"
  },
  {
    "text": "easier to sort of reason about and operate whatever tooling you come up with but not not impossible",
    "start": "2940119",
    "end": "2947740"
  },
  {
    "text": "okay one last question uh I have got the question here so uh",
    "start": "2947740",
    "end": "2956200"
  },
  {
    "text": "currently I'm doing a sort of migration on the AWS and it's an oral per square database I'm wondering my question is uh",
    "start": "2956200",
    "end": "2965440"
  },
  {
    "text": "how do you comment uh the AWS tool like a DMS the database migration service to",
    "start": "2965440",
    "end": "2971800"
  },
  {
    "text": "do this uh migration so for example you know it will sync data I mean yeah the",
    "start": "2971800",
    "end": "2977380"
  },
  {
    "text": "original database right that could that could be a useful a useful component to to your system",
    "start": "2977380",
    "end": "2984220"
  },
  {
    "text": "absolutely I I think it's especially useful for that you know the",
    "start": "2984220",
    "end": "2990040"
  },
  {
    "text": "the thing that I kind of brushed you know past really quickly which is you need some way to keep these databases in",
    "start": "2990040",
    "end": "2995140"
  },
  {
    "text": "sync while you're doing that work I think if if it works for you the the DMS",
    "start": "2995140",
    "end": "3000660"
  },
  {
    "text": "could could be great for that absolutely but like you probably still need the",
    "start": "3000660",
    "end": "3007920"
  },
  {
    "text": "gradual forward and backward with comparison logic [Music]",
    "start": "3007920",
    "end": "3013200"
  },
  {
    "text": "like to make sure that everything is working correctly because just because",
    "start": "3013200",
    "end": "3018599"
  },
  {
    "text": "you migrated all the data it might actually not be right and you might flip the switch to use it and it blows up",
    "start": "3018599",
    "end": "3025740"
  },
  {
    "text": "right so that that's why that that blue box in the middle that's like that's reading and writing to both systems at",
    "start": "3025740",
    "end": "3032040"
  },
  {
    "text": "the same time is so important because you know it's going to work because you're already using it right",
    "start": "3032040",
    "end": "3037260"
  },
  {
    "text": "like there is no time where you suddenly find yourself using it and then you hope you didn't you hope you didn't break",
    "start": "3037260",
    "end": "3042660"
  },
  {
    "text": "anything you've been using it constantly you know the whole time so you you and",
    "start": "3042660",
    "end": "3047940"
  },
  {
    "text": "you get metrics that says it's doing the correct thing so when you flip that switch it's very very safe to do so and",
    "start": "3047940",
    "end": "3055640"
  },
  {
    "text": "I I haven't seen any tooling uh from Amazon that makes that fixes that",
    "start": "3055640",
    "end": "3061380"
  },
  {
    "text": "problem like maybe they sync the data for you unfortunately we couldn't use it for the same reason that we couldn't do",
    "start": "3061380",
    "end": "3068339"
  },
  {
    "text": "our own clever trick which was our Aurora was too busy um and once your Aurora gets too busy you can't use the you can't use the the",
    "start": "3068339",
    "end": "3075540"
  },
  {
    "text": "nice stuff all right thanks Matt uh how about a big round hat so",
    "start": "3075540",
    "end": "3081920"
  }
]