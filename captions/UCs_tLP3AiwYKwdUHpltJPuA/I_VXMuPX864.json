[
  {
    "start": "0",
    "end": "87000"
  },
  {
    "text": "[Music]",
    "start": "990",
    "end": "7859"
  },
  {
    "text": "good afternoon Berlin how you doing yeah that yeah I know that post lunch thing I",
    "start": "11360",
    "end": "19500"
  },
  {
    "text": "give it I get it I always get the big room too today we're going to talk about tiered",
    "start": "19500",
    "end": "26279"
  },
  {
    "text": "tragedy a quick peek into failure and the presentation is going to focus around a specific incident that we had",
    "start": "26279",
    "end": "32488"
  },
  {
    "text": "at my company and how we went about not only just troubleshooting it but then going through that post mortem process and",
    "start": "32489",
    "end": "37980"
  },
  {
    "text": "understanding what we can do to make the teams especially the developers a bit more effective in the process so I've",
    "start": "37980",
    "end": "45450"
  },
  {
    "text": "got a little bit of good news and a little bit of bad news the good news is that this probably won't go the full 40",
    "start": "45450",
    "end": "51059"
  },
  {
    "text": "minutes the bad news is you know how you go to conferences and they talk about",
    "start": "51059",
    "end": "56960"
  },
  {
    "text": "how everything's going great and everything is perfect and they're going to instill all this great knowledge on you yeah that's not this talk this talk",
    "start": "56960",
    "end": "64588"
  },
  {
    "text": "is going to air a lot of dirty laundry the idea though is to generate a conversation to be open and honest about",
    "start": "64589",
    "end": "70830"
  },
  {
    "text": "the sorts of failures that we got because everyone knows you know how perfect the unicorns are but it sometimes refreshing to hear that other",
    "start": "70830",
    "end": "77610"
  },
  {
    "text": "companies are struggling with some of the same problems that you're having so while I offer some solutions hopefully",
    "start": "77610",
    "end": "83340"
  },
  {
    "text": "it starts a conversation where we can figure out the other pieces together so",
    "start": "83340",
    "end": "88520"
  },
  {
    "start": "87000",
    "end": "180000"
  },
  {
    "text": "first I'll give you a quick high-level overview of what actually went wrong so",
    "start": "88520",
    "end": "95119"
  },
  {
    "text": "we were doing a deployment and it was a standard run in the middle deployment we're a rail shop so we run Ruby on",
    "start": "95119",
    "end": "102540"
  },
  {
    "text": "Rails and the engineer that was doing the deploy ran the database migrations and he's waiting he's waiting he's",
    "start": "102540",
    "end": "109649"
  },
  {
    "text": "waiting and then he says this is taking longer than it should but he didn't know what to do so he paged out to my team",
    "start": "109649",
    "end": "116640"
  },
  {
    "text": "the tech ops team so the tech ops team gets the page and they start investigating things and they're",
    "start": "116640",
    "end": "122520"
  },
  {
    "text": "noticing some weirdness in the database but nothing jumps out immediately then suddenly all the alarms go off saying",
    "start": "122520",
    "end": "128190"
  },
  {
    "text": "that the web nodes are at capacity then we get another alarm saying the site's down",
    "start": "128190",
    "end": "133200"
  },
  {
    "text": "so now we're people are frantically switching over to the web tier trying to figure out what's going on with the web tier after they start figuring out",
    "start": "133200",
    "end": "140220"
  },
  {
    "text": "what's happening at the web tier they realized oh it actually is related to the database problem let's start looking into the database problem turns out",
    "start": "140220",
    "end": "147270"
  },
  {
    "text": "there was a lot of heavy database locking that was going on and there was a migration that was running that was",
    "start": "147270",
    "end": "152819"
  },
  {
    "text": "blocking subsequent requests from going through the system so after diagnosing",
    "start": "152819",
    "end": "158100"
  },
  {
    "text": "that they killed the query that was blocking all of the requests restarted the web nodes life was good",
    "start": "158100",
    "end": "165569"
  },
  {
    "text": "seemed like a fairly basic thing but as we went through the process and as we started digging deeper we realized that",
    "start": "165569",
    "end": "172049"
  },
  {
    "text": "there were some really systemic issues with not just the system but how we go about managing these deployments so",
    "start": "172049",
    "end": "179700"
  },
  {
    "text": "we're gonna dig into that quite a bit so first because this is a 100 level talk I wanted to go through it and make",
    "start": "179700",
    "end": "186630"
  },
  {
    "start": "180000",
    "end": "249000"
  },
  {
    "text": "sure we level set on some of the terms that I'll probably be using specifically talking around systems so when we talk",
    "start": "186630",
    "end": "192540"
  },
  {
    "text": "about systems people have you know different ideas depending on the scope that they're talking about sometime they're talking about you know the",
    "start": "192540",
    "end": "197670"
  },
  {
    "text": "little application that they use sometimes they're talking about a specific server but when I'm talking",
    "start": "197670",
    "end": "203790"
  },
  {
    "text": "about systems what I'm talking about is like this sort of definition a set of connected things or parts forming a complex whole a subsystem is a set of",
    "start": "203790",
    "end": "211590"
  },
  {
    "text": "elements which is a system itself and a component in a component of larger systems so the perfect example that I",
    "start": "211590",
    "end": "216810"
  },
  {
    "text": "always think of that is databases databases are these very complex pieces",
    "start": "216810",
    "end": "221910"
  },
  {
    "text": "of software and if any of you have ever dove into database technology you understand and realize just how many",
    "start": "221910",
    "end": "227970"
  },
  {
    "text": "like moving parts there are but if you're up an abstraction level it's really just this thing you dump data",
    "start": "227970",
    "end": "233430"
  },
  {
    "text": "into and you don't really need to understand the abstraction until you do right and then when you do need to",
    "start": "233430",
    "end": "239549"
  },
  {
    "text": "understand it it's probably too late and you've already screwed yourself but you're going to do a lot of learning really quickly so that's an example of",
    "start": "239549",
    "end": "246000"
  },
  {
    "text": "like a subsystem that's part of this larger system and then failure model to",
    "start": "246000",
    "end": "251340"
  },
  {
    "start": "249000",
    "end": "268000"
  },
  {
    "text": "the particular way in which a system degrades or ultimately fails to perform as intended or designed so we had a",
    "start": "251340",
    "end": "256680"
  },
  {
    "text": "couple different failure modes in this particular incident where the system started to slow down then the system",
    "start": "256680",
    "end": "262169"
  },
  {
    "text": "stopped accepting new queries then the system sort of collapsed altogether",
    "start": "262169",
    "end": "267860"
  },
  {
    "text": "so with that I'll actually introduce myself now that I've set you up hopefully you're leaning in a little bit more my name is Jeff Smith I'm the",
    "start": "268479",
    "end": "275419"
  },
  {
    "text": "director of production operations at a company called Centro in Chicago back in the States",
    "start": "275419",
    "end": "281449"
  },
  {
    "text": "Centro is a media services company well let me back up first director of",
    "start": "281449",
    "end": "286550"
  },
  {
    "text": "production operations my team handles all of the infrastructure for our basis platform solution we run a software as a",
    "start": "286550",
    "end": "292849"
  },
  {
    "text": "service solution and my team handles not just production but we also handle all of the staging environments all the CI",
    "start": "292849",
    "end": "298699"
  },
  {
    "text": "CD environments and soon even local development environments so that we can ensure that what people are running on",
    "start": "298699",
    "end": "303889"
  },
  {
    "text": "their local workstations actually mimics what's running and staging in production this is the slide where I would sell you",
    "start": "303889",
    "end": "310879"
  },
  {
    "text": "on Centro and let you know that we're hiring I'm guessing none of you are relocating to the u.s. at least not",
    "start": "310879",
    "end": "316340"
  },
  {
    "text": "until after the 2020 election then even then I might be asking you for a job so",
    "start": "316340",
    "end": "321580"
  },
  {
    "text": "we'll just go ahead and skip that part until the politics thing works out so",
    "start": "321580",
    "end": "329419"
  },
  {
    "start": "328000",
    "end": "377000"
  },
  {
    "text": "now we'll walk through that failure in a little bit more detail just so that everyone's can kind of understand the",
    "start": "329419",
    "end": "334759"
  },
  {
    "text": "process that we went through and all the issues that we ran into so this is our basic architecture it's nothing fancy",
    "start": "334759",
    "end": "341089"
  },
  {
    "text": "right we're in AWS we've got an elastic load balancer actually it's an Ald now set of web servers we use Postgres for",
    "start": "341089",
    "end": "349099"
  },
  {
    "text": "our database back-end we use RabbitMQ for message processing for message",
    "start": "349099",
    "end": "354439"
  },
  {
    "text": "queuing and for our worker nodes that do background processing we use sidekick for those not familiar with the ruby",
    "start": "354439",
    "end": "361669"
  },
  {
    "text": "community sidekick is a very standard batch processing back-end processing tool in that community we also have a",
    "start": "361669",
    "end": "371569"
  },
  {
    "text": "read-only slave but that's not really going to factor in too much here so that's basic high-level architecture so",
    "start": "371569",
    "end": "378259"
  },
  {
    "start": "377000",
    "end": "443000"
  },
  {
    "text": "for our deployment process we do Bluegreen deployments for those unfamiliar with blue grain deployments",
    "start": "378259",
    "end": "384020"
  },
  {
    "text": "instead of deploying to existing nodes new code we basically bring up brand new nodes that have the new code on it and",
    "start": "384020",
    "end": "390439"
  },
  {
    "text": "then we simply switch our load balancer to point to the new set of servers this occurs both for our web servers and our",
    "start": "390439",
    "end": "397459"
  },
  {
    "text": "sidekick servers we are running a monolith we're now micro-services because we don't hate ourselves yet but that's going to change",
    "start": "397459",
    "end": "404890"
  },
  {
    "text": "because everyone eventually hates themselves but that happens both for the",
    "start": "404890",
    "end": "410870"
  },
  {
    "text": "psychic nodes and on the web server nodes so in our deployment process what happened was our deployment engineer ran",
    "start": "410870",
    "end": "419450"
  },
  {
    "text": "the database migrations on these inactive set of nodes and it turns out that the database migration was doing an",
    "start": "419450",
    "end": "425420"
  },
  {
    "text": "altar table on this earth users table now off users is a fairly contentious",
    "start": "425420",
    "end": "431030"
  },
  {
    "text": "table because ORM czar the devil it gets accessed a lot more frequently than it probably should so that we so we sort of",
    "start": "431030",
    "end": "437780"
  },
  {
    "text": "know that any sort of deployment around this table can be potentially problematic but in addition to that the",
    "start": "437780",
    "end": "446660"
  },
  {
    "start": "443000",
    "end": "483000"
  },
  {
    "text": "sidekick nodes were doing a lot of extra work that they typically don't do and we didn't notice it when it originally",
    "start": "446660",
    "end": "452450"
  },
  {
    "text": "kicked off but basically a user did an action that created these background tasks and the background tasks typically",
    "start": "452450",
    "end": "460160"
  },
  {
    "text": "run fairly fast but this particular user had a specific use case that generated a",
    "start": "460160",
    "end": "465830"
  },
  {
    "text": "lot of history and that history resulted in this usually quick query exploding",
    "start": "465830",
    "end": "471830"
  },
  {
    "text": "into this extremely long-running transaction and the long-running transactions is sort of the lynchpin if",
    "start": "471830",
    "end": "478370"
  },
  {
    "text": "there is one in this particular failure",
    "start": "478370",
    "end": "483820"
  },
  {
    "start": "483000",
    "end": "577000"
  },
  {
    "text": "so before I dig into it a quick primer on Postgres locking for those that are unfamiliar with the database level so in",
    "start": "483820",
    "end": "490190"
  },
  {
    "text": "Postgres every query generates a lock of some sort some lock types conflict with",
    "start": "490190",
    "end": "496190"
  },
  {
    "text": "each other if I'm just doing a select I'll probably just grab an access share lock and as long as everyone else can",
    "start": "496190",
    "end": "502520"
  },
  {
    "text": "share with an access share lock there's no problems there's no conflicts but there are conflicting locks that happen",
    "start": "502520",
    "end": "507980"
  },
  {
    "text": "so for example with this off user table the altar table command needs an access exclusive lock and that conflicts with",
    "start": "507980",
    "end": "515360"
  },
  {
    "text": "the access share lock whenever you have a conflict the query that's trying to",
    "start": "515360",
    "end": "520490"
  },
  {
    "text": "the conflicting lock basically goes into a lock wait queue and it stays there until the other locks are released in",
    "start": "520490",
    "end": "527690"
  },
  {
    "text": "the the executable blocking conflicting locks so in our case the altar table",
    "start": "527690",
    "end": "534329"
  },
  {
    "text": "will block subsequent locks from actually grabbing their lock even if",
    "start": "534329",
    "end": "539429"
  },
  {
    "text": "it's only an access share lock they all stack up behind it locks are held until",
    "start": "539429",
    "end": "545459"
  },
  {
    "text": "the transaction that has them does a commit or rollback so if you query a table at the beginning of your",
    "start": "545459",
    "end": "550980"
  },
  {
    "text": "transaction and don't do anything with it until the end you're still holding that lock until you either commit your",
    "start": "550980",
    "end": "556499"
  },
  {
    "text": "transaction or until you roll it back and that's a key point to this actual failure so to sort of draw a picture",
    "start": "556499",
    "end": "563089"
  },
  {
    "text": "we've got these sidekick tasks that are running these long-running transactions we were talking about earlier they each",
    "start": "563089",
    "end": "570449"
  },
  {
    "text": "are grabbing an access share line but because they're not conflicting with each other they all run concurrently",
    "start": "570449",
    "end": "575850"
  },
  {
    "text": "life is good then comes our altar table command now the altar table command",
    "start": "575850",
    "end": "582179"
  },
  {
    "start": "577000",
    "end": "625000"
  },
  {
    "text": "needs an access exclusive lock it can't get that though because these access share locks are going and they're",
    "start": "582179",
    "end": "587850"
  },
  {
    "text": "continuously held because this transaction is long-running and when I say long I'm talking like hours for plus",
    "start": "587850",
    "end": "593129"
  },
  {
    "text": "hours or something like that so now the altar table command goes into",
    "start": "593129",
    "end": "598170"
  },
  {
    "text": "the waiting in wait in lock you in normal operations that's not the end of the world right but the problem is not",
    "start": "598170",
    "end": "604619"
  },
  {
    "text": "only these transactions long-running but we've also got these edition of web requests the addition of web requests",
    "start": "604619",
    "end": "610470"
  },
  {
    "text": "are coming in and they're trying to access off users they can't because the access exclusive is in the week it is in",
    "start": "610470",
    "end": "616290"
  },
  {
    "text": "the lock queue so they stack up behind waiting to execute and they stack in a",
    "start": "616290",
    "end": "622170"
  },
  {
    "text": "stack and they stack in they stack now on the web front-end side you've got the",
    "start": "622170",
    "end": "630299"
  },
  {
    "start": "625000",
    "end": "691000"
  },
  {
    "text": "internet the Internet users are coming into the web nodes the web nodes are making a request of Postgres but that",
    "start": "630299",
    "end": "637470"
  },
  {
    "text": "HTTP call is blocking forever why because we don't be timeouts there's no",
    "start": "637470",
    "end": "644670"
  },
  {
    "text": "timeouts so they just block and block and block and block well guess what those are blocking but they're still",
    "start": "644670",
    "end": "650220"
  },
  {
    "text": "accepting new connections new transactions right so what happens these HTTP requests keep stacking and stacking",
    "start": "650220",
    "end": "656490"
  },
  {
    "text": "and stacking and stacking until it runs out of possible port port exhaustion or you know even a",
    "start": "656490",
    "end": "662740"
  },
  {
    "text": "peachy and I'm patchy front-end queue or something of that effect bottom line is it's not accepting new requests when",
    "start": "662740",
    "end": "668380"
  },
  {
    "text": "it's not accepting new requests guess what it can't answer to the load balancer health check so it makes a load",
    "start": "668380",
    "end": "674649"
  },
  {
    "text": "balance or health check and it says oh this thing's not responding so the load balancer marks it off does that three four or five times",
    "start": "674649",
    "end": "681279"
  },
  {
    "text": "eventually runs out of web servers all the scaling doesn't fix this why because it's going to run into the exact same problem and we're just going to pay more",
    "start": "681279",
    "end": "687360"
  },
  {
    "text": "sort of a nightmare situation so",
    "start": "687360",
    "end": "692649"
  },
  {
    "start": "691000",
    "end": "718000"
  },
  {
    "text": "timeline of events migrations run they're running longer than expected someone paged tech ops because the",
    "start": "692649",
    "end": "700209"
  },
  {
    "text": "deploy team is stuck on figuring out what goes on the web tier fires a bunch of alerts saying that we're running out",
    "start": "700209",
    "end": "706180"
  },
  {
    "text": "of web capacity we've got Heavy D be locking going on migrations can't make progress until we clear the block and",
    "start": "706180",
    "end": "712600"
  },
  {
    "text": "query it sounds like we've got a pretty solid explanation right so how do we go",
    "start": "712600",
    "end": "719470"
  },
  {
    "start": "718000",
    "end": "771000"
  },
  {
    "text": "about making improvements on this because the thing about failure is it's one of the best learning opportunities you have how do you find out more about",
    "start": "719470",
    "end": "726220"
  },
  {
    "text": "your system unless you start digging into the failures so that's what we did we started looking at it and we said all",
    "start": "726220",
    "end": "731529"
  },
  {
    "text": "right brief recap the altar table was a DDL statement on a very busy table",
    "start": "731529",
    "end": "736750"
  },
  {
    "text": "that's a bad thing no you don't do that yes we should be able to do zero",
    "start": "736750",
    "end": "743560"
  },
  {
    "text": "downtime migrations I know that it's not news to us we're just not there yet organizationally we just haven't got",
    "start": "743560",
    "end": "749170"
  },
  {
    "text": "there yet so we have all these other processes that we do to sort of manage these incidents long-running",
    "start": "749170",
    "end": "754420"
  },
  {
    "text": "transactions four plus hours of transaction time is potentially dangerous we got to figure out how do we",
    "start": "754420",
    "end": "759910"
  },
  {
    "text": "prevent that from happening and then no DB timeouts at the web tier every query",
    "start": "759910",
    "end": "766000"
  },
  {
    "text": "should timeout at some point we shouldn't wait forever so those are things that we can fix right then we started looking at it from",
    "start": "766000",
    "end": "773260"
  },
  {
    "start": "771000",
    "end": "853000"
  },
  {
    "text": "the outside what are the things that we miss possible alerts that could have given us a little bit more clarity into what was going on",
    "start": "773260",
    "end": "779019"
  },
  {
    "text": "maybe we alert on the long-running transaction it's a soft alert though right you can't page someone because",
    "start": "779019",
    "end": "784870"
  },
  {
    "text": "what do they actually do with that information hey Jeff wake up wake up there's a query running really long",
    "start": "784870",
    "end": "792390"
  },
  {
    "text": "okay do I just kill it no so it's got to",
    "start": "792390",
    "end": "797500"
  },
  {
    "text": "be a soft alert so its informational right so that might not have solved the problem but at least you become aware of it and in this particular situation it",
    "start": "797500",
    "end": "803260"
  },
  {
    "text": "might have helped because we would have gotten an email in the middle of the day saying hey this thing's been running for hours and everyone was available to",
    "start": "803260",
    "end": "809830"
  },
  {
    "text": "actually talk about so maybe it would have held database lock threshold all of",
    "start": "809830",
    "end": "816040"
  },
  {
    "text": "these queries have a lock for a very long time maybe we should be alerting on that maybe a lock should only be held",
    "start": "816040",
    "end": "823690"
  },
  {
    "text": "for so long but again it's another one of those soft alerts right do you wake up in the middle of the night and just start killing stuff in this in your",
    "start": "823690",
    "end": "829990"
  },
  {
    "text": "sleep probably not safe block queries alert when a learner a number of large",
    "start": "829990",
    "end": "835630"
  },
  {
    "text": "queries are blocked because that's usually a symptom of something if you're seeing a lot a lot of blocking going on",
    "start": "835630",
    "end": "841240"
  },
  {
    "text": "someone probably needs to know about that and that's probably worth actually waking someone up if necessary just",
    "start": "841240",
    "end": "846610"
  },
  {
    "text": "because you know what that story looks like in the end you know eventually it's going to end bad but when we had this",
    "start": "846610",
    "end": "858490"
  },
  {
    "start": "853000",
    "end": "883000"
  },
  {
    "text": "conversation and everyone was like yeah yeah I think we know what happened it makes perfect sense let's go case closed let's get these",
    "start": "858490",
    "end": "864670"
  },
  {
    "text": "fixes up I said wait a second maybe we need to go a little bit deeper on this",
    "start": "864670",
    "end": "870670"
  },
  {
    "text": "maybe there's other conversations or questions that we should have because there was one part of the system that we never really looked at can anyone think",
    "start": "870670",
    "end": "878800"
  },
  {
    "text": "about what component of the system was missing you",
    "start": "878800",
    "end": "883050"
  },
  {
    "start": "883000",
    "end": "914000"
  },
  {
    "text": "people humans processes all the things that we do around incidents around",
    "start": "885100",
    "end": "893060"
  },
  {
    "text": "development around commit techniques all of this stuff is actually part of the system that we design develop and deploy",
    "start": "893060",
    "end": "899930"
  },
  {
    "text": "we're never really thinking about it in those terms but when you have a failure happen it really starts to highlight it",
    "start": "899930",
    "end": "905660"
  },
  {
    "text": "once you start to dig in into what exactly went wrong how it went wrong and what people were thinking when it went",
    "start": "905660",
    "end": "912140"
  },
  {
    "text": "belly-up when you add operators to this you think about all the different things",
    "start": "912140",
    "end": "917870"
  },
  {
    "start": "914000",
    "end": "985000"
  },
  {
    "text": "that they have to interact with and know about you have to think about you know they need information about the Postgres database how are they getting feedback",
    "start": "917870",
    "end": "924800"
  },
  {
    "text": "about those systems how are they getting feedback about the system overall and how its behaving they need to know about the worker nodes how long is each worker",
    "start": "924800",
    "end": "932120"
  },
  {
    "text": "node running in a process what sort of queue latency is happening these are all metrics data and feedback that we have",
    "start": "932120",
    "end": "938000"
  },
  {
    "text": "to think about in the design phase to make sure that we're getting the information necessary to the people that",
    "start": "938000",
    "end": "943520"
  },
  {
    "text": "going to manage it and it's not just tech ops folks - because it's developers you guys understand the system far",
    "start": "943520",
    "end": "949100"
  },
  {
    "text": "better than I ever could so how do you know that your process is actually working the absence of the barriers",
    "start": "949100",
    "end": "956810"
  },
  {
    "text": "doesn't mean that it's not working oh sorry the absence of errors doesn't mean that it's working all right",
    "start": "956810",
    "end": "964270"
  },
  {
    "text": "it's just failing silently so we have to think about these things in this process",
    "start": "964270",
    "end": "969560"
  },
  {
    "text": "and when we start doing post-mortems on systems a lot of times we're talking",
    "start": "969560",
    "end": "974810"
  },
  {
    "text": "about the technical bits but what about the human bits who's having that conversation so that's what we did we",
    "start": "974810",
    "end": "981140"
  },
  {
    "text": "went back and we said all right let's focus on the human side of this same incident so the first thing I noticed",
    "start": "981140",
    "end": "987829"
  },
  {
    "text": "was when we talked about this the engineer that was doing the deployment had said I noticed the migrations were",
    "start": "987829",
    "end": "994220"
  },
  {
    "text": "running a long time and I said well what does that mean like what is a long time how do you know that it was a long time",
    "start": "994220",
    "end": "1000279"
  },
  {
    "text": "he said well I did the de pointes the staging environment it only took a second or two there so it was going for more than a minute I figured something",
    "start": "1000279",
    "end": "1006310"
  },
  {
    "text": "was up so that's the first thing we focused on we said well what if you weren't the one that did the staging",
    "start": "1006310",
    "end": "1011620"
  },
  {
    "text": "deployment or what if you weren't the one doing the production deployment you have a bit of expertise that's sort",
    "start": "1011620",
    "end": "1017699"
  },
  {
    "text": "of like siloed in you that we need to figure out how to get out for every deployed and people looked at me like I",
    "start": "1017699",
    "end": "1025020"
  },
  {
    "text": "was crazy they're like well I mean as long as he does the stadium deploy everyone's good right but like one day",
    "start": "1025020",
    "end": "1030149"
  },
  {
    "text": "he might not be one day he might walk out and get hit by a bus and now someone else has got to do the deploy and if it weren't for him having done the staging",
    "start": "1030149",
    "end": "1037048"
  },
  {
    "text": "deploy how long would another engineer have waited before they realized there was a problem five minutes",
    "start": "1037049",
    "end": "1042600"
  },
  {
    "text": "ten minutes how long does an alter table run on a five thousand ten thousand row table anybody know off the top of their",
    "start": "1042600",
    "end": "1049440"
  },
  {
    "text": "head that's right because it's all subjective well depends how much activity is going on in the database how big is the database server are you",
    "start": "1049440",
    "end": "1055950"
  },
  {
    "text": "adding a default column right there's all these things that anyone with with just basic information would not be able",
    "start": "1055950",
    "end": "1062789"
  },
  {
    "text": "to gauge appropriately so we tried to tackle this first we said all right how do we codify this get the expertise out",
    "start": "1062789",
    "end": "1069120"
  },
  {
    "text": "of this deployment engineer and into everyone's hands so we as a chatbot for",
    "start": "1069120",
    "end": "1074340"
  },
  {
    "text": "most of our operational activities and we did that specifically so that we could sort of democratize the operations",
    "start": "1074340",
    "end": "1080010"
  },
  {
    "text": "of the systems and one of the things we did was we said all right when we run migrations in a staging environment we will now",
    "start": "1080010",
    "end": "1086669"
  },
  {
    "text": "record how long the migrations ran so that when someone does that same migration in production they get",
    "start": "1086669",
    "end": "1092460"
  },
  {
    "text": "feedback immediately so we see up carried found one staging migration",
    "start": "1092460",
    "end": "1097529"
  },
  {
    "text": "runtime for version 4.9 dot one to zero it rained eleven seconds on staging go to at that date so now regardless of who",
    "start": "1097529",
    "end": "1104549"
  },
  {
    "text": "does the deployment next time they run a migration they're gonna look in there after eleven seconds they're gonna go oh",
    "start": "1104549",
    "end": "1109590"
  },
  {
    "text": "this is weird after 30 seconds are gonna say oh I probably should call someone this is bad so we were able to take that expertise",
    "start": "1109590",
    "end": "1116820"
  },
  {
    "text": "that he had and just sort of democratize it because when you think about it there's a lot of things in tech where",
    "start": "1116820",
    "end": "1122669"
  },
  {
    "text": "the expertise is really about knowing what to look for not necessarily how to get that information we've got Google",
    "start": "1122669",
    "end": "1129510"
  },
  {
    "text": "for that right but if we can take the information that we know how to get and",
    "start": "1129510",
    "end": "1134549"
  },
  {
    "text": "make it available for people people will begin to be connect the dots themselves but we focus so much on the training on",
    "start": "1134549",
    "end": "1141210"
  },
  {
    "text": "how you get this data let's make it easy form",
    "start": "1141210",
    "end": "1146090"
  },
  {
    "start": "1145000",
    "end": "1229000"
  },
  {
    "text": "next question we had why don't we catch this in stage a an obvious question",
    "start": "1146909",
    "end": "1152009"
  },
  {
    "text": "right we're and in staging well we don't have users in staging also the sidekick job that was running in production",
    "start": "1152009",
    "end": "1157940"
  },
  {
    "text": "creating the long-running transaction was initiated by the user than was kind of an unusual case it was a perfect",
    "start": "1157940",
    "end": "1164970"
  },
  {
    "text": "storm and this is something that we fail all the time on we strive to say staging",
    "start": "1164970",
    "end": "1170849"
  },
  {
    "text": "is like production staging will never be like production you can put a lot of energy into it to make it look better",
    "start": "1170849",
    "end": "1177019"
  },
  {
    "text": "but you don't have those pesky things called users going around running crazy",
    "start": "1177019",
    "end": "1182190"
  },
  {
    "text": "reports that are taking four or five hours each but the problem is when we",
    "start": "1182190",
    "end": "1187200"
  },
  {
    "text": "keep reiterating staging is just like production staging is just like production guess what people believe it",
    "start": "1187200",
    "end": "1192539"
  },
  {
    "text": "they actually believe the you're talking wow I ran it in staging so I mean staging is just like production -",
    "start": "1192539",
    "end": "1198899"
  },
  {
    "text": "the user is the actual data changes and you know not refreshing it every other week so we do ourselves a disservice",
    "start": "1198899",
    "end": "1204960"
  },
  {
    "text": "when we constantly talk about staging being just like production it's not it never will be and when you when you",
    "start": "1204960",
    "end": "1212249"
  },
  {
    "text": "accept that you begin to think and program more defensively around those scenarios you get rid of the crutch of",
    "start": "1212249",
    "end": "1218909"
  },
  {
    "text": "well it worked in staging so I can go to bed because I know it's gonna be fine a production now you're thinking more defensively and you're saying well you",
    "start": "1218909",
    "end": "1225599"
  },
  {
    "text": "work in staging but that doesn't necessarily mean anything why did we",
    "start": "1225599",
    "end": "1231960"
  },
  {
    "start": "1229000",
    "end": "1444000"
  },
  {
    "text": "need to pay jobs what is it that ops had that couldn't be fulfilled by the",
    "start": "1231960",
    "end": "1239759"
  },
  {
    "text": "engineering team that was doing the deploy not that I don't mind not that I mind getting page and that trying to skirt work but my thing is I",
    "start": "1239759",
    "end": "1246269"
  },
  {
    "text": "always want to make sure my developers are empowered to do and get the information that they need so when they",
    "start": "1246269",
    "end": "1251970"
  },
  {
    "text": "had to page me for this I got curious and they said nobody else has access to the DB at that layer plus we don't have",
    "start": "1251970",
    "end": "1257879"
  },
  {
    "text": "the Postgres knowledge to find blocking queries I won't even know where to start finding that info so the first bit access to the",
    "start": "1257879",
    "end": "1264840"
  },
  {
    "text": "DB at that layer that's a thing all right I'm pretty sure everyone works in",
    "start": "1264840",
    "end": "1269970"
  },
  {
    "text": "a shop where they have different access controls for different reasons probably because someone screwed something up seven years ago and no one remembers the",
    "start": "1269970",
    "end": "1275999"
  },
  {
    "text": "story but these things are real so we went about trying to solve that",
    "start": "1275999",
    "end": "1282130"
  },
  {
    "text": "through a read-only node but that doesn't really help with things like locking because they still need to be able to actually see what's going on on",
    "start": "1282130",
    "end": "1288280"
  },
  {
    "text": "the actual production server but when they said we don't have the Postgres now is to find blocking queries guess what",
    "start": "1288280",
    "end": "1294970"
  },
  {
    "text": "neither do I I have a really cool snippet of code in my notes app that I",
    "start": "1294970",
    "end": "1300040"
  },
  {
    "text": "can copy and paste whenever I need to but my real expertise is in knowing that I should be looking for blocking queries",
    "start": "1300040",
    "end": "1305820"
  },
  {
    "text": "but the development team knew that they just didn't have the capability to do that so what they're paging me for isn't",
    "start": "1305820",
    "end": "1313570"
  },
  {
    "text": "really my expert opinion it's really for my notepad so let's codify that let's",
    "start": "1313570",
    "end": "1319600"
  },
  {
    "text": "take that and make it something that developers can get to themselves even if they don't have the expertise they know",
    "start": "1319600",
    "end": "1325690"
  },
  {
    "text": "they need to look for blocking queries so how do we make that accessible to them we went back to Marvin and we said",
    "start": "1325690",
    "end": "1332230"
  },
  {
    "text": "Marvin let's do a chat command so then we created a query that says list slot queries for a particular environment",
    "start": "1332230",
    "end": "1338050"
  },
  {
    "text": "Marvin goes out and executes the Notes app so I'm now fireable you don't need",
    "start": "1338050",
    "end": "1343090"
  },
  {
    "text": "me anymore and it tells us well this query is blocked here's the query that's blocking",
    "start": "1343090",
    "end": "1350080"
  },
  {
    "text": "it and here's long how long that query has been running and what's interesting about this particular snippet is this is",
    "start": "1350080",
    "end": "1356770"
  },
  {
    "text": "an incident that we had after this one that I'm talking about today and guess what when it happened the pattern looked",
    "start": "1356770",
    "end": "1363340"
  },
  {
    "text": "very similar someone did a deploy it was an alter table things took longer the",
    "start": "1363340",
    "end": "1369820"
  },
  {
    "text": "deploying engineer knew it took longer because he was getting feedback from Marvin saying hey I ran this in staging and it only took five seconds so he says",
    "start": "1369820",
    "end": "1377230"
  },
  {
    "text": "let me look for block queries now he has the capability to do that and he sees oh",
    "start": "1377230",
    "end": "1382450"
  },
  {
    "text": "look there's an alter table going on that's bad he was able to correct the issue and yes we still encountered the",
    "start": "1382450",
    "end": "1389350"
  },
  {
    "text": "problem but it wasn't catastrophic there was no outage we just stopped it",
    "start": "1389350",
    "end": "1395320"
  },
  {
    "text": "figured out that there was a long-running transaction killed that transaction and redid the deployment so",
    "start": "1395320",
    "end": "1401980"
  },
  {
    "text": "we have to think about how do we react to failure how do we react to incidences",
    "start": "1401980",
    "end": "1407530"
  },
  {
    "text": "versus just strictly trying to prevent them because there's every every time you guys come into code",
    "start": "1407530",
    "end": "1413140"
  },
  {
    "text": "introducing a new failure mode scenario every time doesn't matter how simple it",
    "start": "1413140",
    "end": "1418570"
  },
  {
    "text": "is I once had a failure from a logo change and of course everyone's like there's no way we did was up go well you",
    "start": "1418570",
    "end": "1427810"
  },
  {
    "text": "know there was some weird dependency or something where something didn't get deployed with the rest of the package so every time you deploy code you're",
    "start": "1427810",
    "end": "1433600"
  },
  {
    "text": "introducing a new failure mode so the idea that you're gonna prevent failure is insane all you can do is prepare for",
    "start": "1433600",
    "end": "1440140"
  },
  {
    "text": "how you react to it why wasn't this",
    "start": "1440140",
    "end": "1446500"
  },
  {
    "start": "1444000",
    "end": "1671000"
  },
  {
    "text": "flagged for maintenance release again auth users isn't anything new to us",
    "start": "1446500",
    "end": "1451810"
  },
  {
    "text": "we're familiar with this we know that it causes problems so why didn't we do a",
    "start": "1451810",
    "end": "1457480"
  },
  {
    "text": "maintenance release where we take the application down run the migration bring it back up we've got very forgiving",
    "start": "1457480",
    "end": "1462850"
  },
  {
    "text": "customers at this stage of the game so if we do a release at 10:30 in the evening nobody knows nobody cares those",
    "start": "1462850",
    "end": "1468610"
  },
  {
    "text": "times are coming to an end but for now we're gonna milk it for all it's worth the response was this was the developers",
    "start": "1468610",
    "end": "1475030"
  },
  {
    "text": "first time really working in the platform he wasn't aware of the history or the access contention around this table and it went smoothly in staging so",
    "start": "1475030",
    "end": "1482530"
  },
  {
    "text": "there go staging again screwing us all right that fake security blanket but",
    "start": "1482530",
    "end": "1487840"
  },
  {
    "text": "when they said this is the developers first time I said well this is interesting because the developer that did this I know and have a lot of",
    "start": "1487840",
    "end": "1494380"
  },
  {
    "text": "respect for he's a really sharp person so if he didn't know I'm guessing a lot",
    "start": "1494380",
    "end": "1499390"
  },
  {
    "text": "of other people don't know so I said what is the mechanism where developer gets this information is it infused in",
    "start": "1499390",
    "end": "1505750"
  },
  {
    "text": "them during the the onboarding process well if you ever messed with all users you know you need to take the system",
    "start": "1505750",
    "end": "1510880"
  },
  {
    "text": "down oh and here's your HR benefit information it's probably not how the conversation goes so I asked like well",
    "start": "1510880",
    "end": "1516850"
  },
  {
    "text": "how would they know is there a confluence page if there is that doesn't help because confluence sucks so so how",
    "start": "1516850",
    "end": "1524050"
  },
  {
    "text": "do you find out this stuff so we went around asking they said well you know actually there's a there is a process",
    "start": "1524050",
    "end": "1530800"
  },
  {
    "text": "for this there is a application that we use in bitbucket called work zone anyone familiar with it work zone allows you to",
    "start": "1530800",
    "end": "1538780"
  },
  {
    "text": "say if a file changes of this pattern add these people to the pull requests",
    "start": "1538780",
    "end": "1545820"
  },
  {
    "text": "so yeah helpful right so Josh and Ken are some of our senior folks and they're",
    "start": "1545820",
    "end": "1551920"
  },
  {
    "text": "like whenever there's a DV migration we get added to the pull request so we asked them and they're like I don't remember seeing this really you don't",
    "start": "1551920",
    "end": "1558750"
  },
  {
    "text": "know I would have noticed I would have freaked out I didn't see this so we look",
    "start": "1558750",
    "end": "1564190"
  },
  {
    "text": "and guess what work zone was disabled we dig into that turns out that there was a",
    "start": "1564190",
    "end": "1570160"
  },
  {
    "text": "hotfix a week or two ago and the two gatekeepers weren't available to approve",
    "start": "1570160",
    "end": "1575920"
  },
  {
    "text": "the PR so the stash admin just disabled VR approvers so that we could get the damn thing out and fix our problems but",
    "start": "1575920",
    "end": "1584350"
  },
  {
    "text": "he forgot to turn it back on so now our gatekeeper process directly contributed",
    "start": "1584350",
    "end": "1591220"
  },
  {
    "text": "to our failure mode right but this is something that would never come up in a data dog dashboard so we got burned by",
    "start": "1591220",
    "end": "1600190"
  },
  {
    "text": "our gatekeeping process that was supposed to make us more secure more resilient so gatekeeping isn't always the answer",
    "start": "1600190",
    "end": "1606210"
  },
  {
    "text": "but then my favorite what was the reason for the change why were we doing this in",
    "start": "1606210",
    "end": "1612640"
  },
  {
    "text": "the first place and they said well the change was part of an enhancement to force password expiration it's part of",
    "start": "1612640",
    "end": "1619570"
  },
  {
    "text": "our larger security hardening effort and I applaud security hardening efforts I'd been begging for it because we were",
    "start": "1619570",
    "end": "1624940"
  },
  {
    "text": "talking about going for our sock to compliance the problem is when I asked for it and suggested it I thought I",
    "start": "1624940",
    "end": "1630910"
  },
  {
    "text": "would be involved in the process but I wasn't because had I been involved with the process I probably would have told",
    "start": "1630910",
    "end": "1637450"
  },
  {
    "text": "them that NIST said in 2017 password expiration is no longer a best practice",
    "start": "1637450",
    "end": "1643980"
  },
  {
    "text": "right from the NIST guidelines verifier should not require memorize secrets to",
    "start": "1643980",
    "end": "1649000"
  },
  {
    "text": "be changed arbitrary arbitrarily periodically however verifier shall force a change if there is evidence of a",
    "start": "1649000",
    "end": "1655240"
  },
  {
    "text": "compromise of the authenticator that's from NIST and that's from whatever other UK government standard is",
    "start": "1655240",
    "end": "1661060"
  },
  {
    "text": "that has basically the same language so the thing that brought us down was all",
    "start": "1661060",
    "end": "1667810"
  },
  {
    "text": "inspired by something we didn't even need a change that wasn't needed",
    "start": "1667810",
    "end": "1674590"
  },
  {
    "start": "1671000",
    "end": "1782000"
  },
  {
    "text": "was missed by review process that was disabled for a change that couldn't be",
    "start": "1674590",
    "end": "1680230"
  },
  {
    "text": "simulated in staging that interacted poorly with a user action which led to a",
    "start": "1680230",
    "end": "1686769"
  },
  {
    "text": "system failure is this a technical failure is it a process failure or is it",
    "start": "1686769",
    "end": "1694779"
  },
  {
    "text": "a system failure it's everything because none of these if we took one of these",
    "start": "1694779",
    "end": "1700870"
  },
  {
    "text": "incidents and had it happened in a vacuum it probably isn't going to be an",
    "start": "1700870",
    "end": "1706809"
  },
  {
    "text": "issue and it's definitely not going to be a system outage but when you have all of these complex interactions happening",
    "start": "1706809",
    "end": "1713460"
  },
  {
    "text": "catastrophe occurs and there's no value that's the other thing this feature gave us zero value the only",
    "start": "1713460",
    "end": "1720129"
  },
  {
    "text": "value we got out of it was this talk and a free trip to Berlin right other than",
    "start": "1720129",
    "end": "1726519"
  },
  {
    "text": "that there was really no useful thing that came out of this and it sounds like",
    "start": "1726519",
    "end": "1734529"
  },
  {
    "text": "this might be a one-off case but I guarantee you I've done a bunch of these and it happens in every single one every",
    "start": "1734529",
    "end": "1740710"
  },
  {
    "text": "single one when I have conversations at a deeper level when I ask questions about what were you thinking what would",
    "start": "1740710",
    "end": "1747070"
  },
  {
    "text": "your mind set in this scenario there are always different views that people have on how the system acts how it behaves",
    "start": "1747070",
    "end": "1754980"
  },
  {
    "text": "even something as simple as well Bob we're in the wrong command well that's funny are the commands so similar that",
    "start": "1754980",
    "end": "1761169"
  },
  {
    "text": "Bob could get the two confused maybe that's your problem is it a command that",
    "start": "1761169",
    "end": "1766360"
  },
  {
    "text": "also that list database actions and then with the wrong flash also drops the database might be a bad design right oh",
    "start": "1766360",
    "end": "1773919"
  },
  {
    "text": " man I was trying to list the database tables and accidentally deleted it those are sentences and conversations",
    "start": "1773919",
    "end": "1780549"
  },
  {
    "text": "that should never happen so what were the real lessons learned what do we",
    "start": "1780549",
    "end": "1786249"
  },
  {
    "start": "1782000",
    "end": "1979000"
  },
  {
    "text": "really get out of this we got a handful of things out of it the first thing if you're still doing root cause analysis",
    "start": "1786249",
    "end": "1792909"
  },
  {
    "text": "please stop there is no one cause there's always multiple multiple layers",
    "start": "1792909",
    "end": "1799059"
  },
  {
    "text": "to this work in a vacuum you got to make sure that you talk with all the stakeholders and that's where product",
    "start": "1799059",
    "end": "1806110"
  },
  {
    "text": "ownership comes in management use automation to free expertise think about the things that",
    "start": "1806110",
    "end": "1812600"
  },
  {
    "text": "are sort of tribal knowledge in terms of how people do things and get that in the",
    "start": "1812600",
    "end": "1817850"
  },
  {
    "text": "code because the reality is people really don't even need to know specifically how to do a thing they just",
    "start": "1817850",
    "end": "1823880"
  },
  {
    "text": "need to be able to get that information a perfect example is our kubernetes migration right there are a small group",
    "start": "1823880",
    "end": "1831290"
  },
  {
    "text": "of people that really care about what the specific cubes Heath Jung commands our automation is executing so we still",
    "start": "1831290",
    "end": "1837920"
  },
  {
    "text": "have the automation we just echo the command for those four people yeah this is this is what we executed right but",
    "start": "1837920",
    "end": "1843620"
  },
  {
    "text": "the majority of people don't care they just want to be able to accomplish a task staging is not production staging",
    "start": "1843620",
    "end": "1850280"
  },
  {
    "text": "is not production it will never be like production stop it don't care how much",
    "start": "1850280",
    "end": "1857000"
  },
  {
    "text": "energy you put into it it'll be better but it's not production and the more we",
    "start": "1857000",
    "end": "1863000"
  },
  {
    "text": "keep repeating that the more we keep talking about it the more dangerous we're making it because people believe it and then humans are part of the",
    "start": "1863000",
    "end": "1870140"
  },
  {
    "text": "system our processes are people the administration work that we do they all",
    "start": "1870140",
    "end": "1875660"
  },
  {
    "text": "have technical impacts so you can't divorce that from your technical retrospectives or post-mortems or after",
    "start": "1875660",
    "end": "1883160"
  },
  {
    "text": "what are we calling them this week there was another term I heard after-action report something like that whatever it is make sure that the human component is",
    "start": "1883160",
    "end": "1889490"
  },
  {
    "text": "part of that because it's so crucial to the lessons learned but another",
    "start": "1889490",
    "end": "1894950"
  },
  {
    "text": "interesting thing is that uptime and stability are a feature they don't come",
    "start": "1894950",
    "end": "1899990"
  },
  {
    "text": "for free and this is something that you have to remind your product teams of depending on your organization at Centro",
    "start": "1899990",
    "end": "1906410"
  },
  {
    "text": "our product team is relatively strong and they really have a grasp on what it is the developers work on they really",
    "start": "1906410",
    "end": "1912050"
  },
  {
    "text": "set the tone but the thing is until",
    "start": "1912050",
    "end": "1917180"
  },
  {
    "text": "they're partially responsible for some of the uptime that work doesn't get prioritized it's like Oh web timeouts",
    "start": "1917180",
    "end": "1924620"
  },
  {
    "text": "yeah that's cool and all but what we really need is this new TPS report so if you could go ahead and work on that",
    "start": "1924620",
    "end": "1931010"
  },
  {
    "text": "then I'll figure out prioritizing web timeouts now the product manager is the one getting pulled in the office because",
    "start": "1931010",
    "end": "1936650"
  },
  {
    "text": "we were down he was like guys we need to do web time outs now I don't even know what it means but we need to",
    "start": "1936650",
    "end": "1941720"
  },
  {
    "text": "implement it ASAP so getting product on board with some of these changes is",
    "start": "1941720",
    "end": "1946940"
  },
  {
    "text": "hugely impactful but then also putting skin in the game we've sort of moved this ball already right DevOps put it so",
    "start": "1946940",
    "end": "1953210"
  },
  {
    "text": "that dev and ops shared operational responsibility but guess what if dev isn't in charge of prioritizing all of",
    "start": "1953210",
    "end": "1959690"
  },
  {
    "text": "their work then the people that are in charge of prioritizing it needs some skin in the game as well oh that's it",
    "start": "1959690",
    "end": "1967700"
  },
  {
    "text": "sweet yeah I just sort of crash-landed there sorry well thank you",
    "start": "1967700",
    "end": "1974559"
  }
]