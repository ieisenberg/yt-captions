[
  {
    "start": "0",
    "end": "93000"
  },
  {
    "text": "thanks Rob and welcome about 11 years ago I had a performance",
    "start": "7519",
    "end": "13320"
  },
  {
    "text": "issue and I was drowning in profile data I had to solve it by the end of the week",
    "start": "13320",
    "end": "19560"
  },
  {
    "text": "and by Wednesday I thought this is really not looking good I had that bad feeling that I was not going to solve",
    "start": "19560",
    "end": "25080"
  },
  {
    "text": "this one after work I played around with some visualizations because I thought maybe",
    "start": "25080",
    "end": "31800"
  },
  {
    "text": "there's a way I can see the issue if it wasn't these 10 000 lines of text if I",
    "start": "31800",
    "end": "39120"
  },
  {
    "text": "could come up with a better way I did I came up with flame graphs I went",
    "start": "39120",
    "end": "44280"
  },
  {
    "text": "to work the next day I showed it to my co-workers one of my co-workers Isaac Schluter he's like a younger version of",
    "start": "44280",
    "end": "51539"
  },
  {
    "text": "Jeff Goldblum at the time he was the lead for node.js he looks at it and he says that's too",
    "start": "51539",
    "end": "58260"
  },
  {
    "text": "weird it won't catch on but Isaac is one of the kindest and wisest engineers in the industry he",
    "start": "58260",
    "end": "65518"
  },
  {
    "text": "played with it and tried it out and after a few days he changed his mind and",
    "start": "65519",
    "end": "70740"
  },
  {
    "text": "he told me Brendan I don't know how he did node.js performance before flame graphs",
    "start": "70740",
    "end": "75900"
  },
  {
    "text": "it completely changed that industry I went to Netflix I got it going for Java and other run times and now it's widely",
    "start": "75900",
    "end": "83040"
  },
  {
    "text": "adopted it's my privilege to share this with you I'd like bit like to begin by",
    "start": "83040",
    "end": "88080"
  },
  {
    "text": "acknowledging the traditional owners of this land and pay my respects to Elders past and present",
    "start": "88080",
    "end": "94200"
  },
  {
    "start": "93000",
    "end": "123000"
  },
  {
    "text": "my dream is to completely understand the performance of everything the performance of applications of libraries",
    "start": "94200",
    "end": "102000"
  },
  {
    "text": "of ciscals the kernel device drivers hypervisors",
    "start": "102000",
    "end": "107880"
  },
  {
    "text": "firmware and Metal over the years I've created various tools to to Aid with this latency heat",
    "start": "107880",
    "end": "114360"
  },
  {
    "text": "maps have been widely adopted flame graphs methodologies and lots and lots",
    "start": "114360",
    "end": "119700"
  },
  {
    "text": "of CLI based Performance Tools I'm going to talk about flame graphs",
    "start": "119700",
    "end": "125280"
  },
  {
    "start": "123000",
    "end": "140000"
  },
  {
    "text": "and Flame graphs are really the one that's had the most performance wins the largest monetary wins",
    "start": "125280",
    "end": "132239"
  },
  {
    "text": "it's primarily used to visualize CPU resource usage but you can also use it",
    "start": "132239",
    "end": "137520"
  },
  {
    "text": "for other things as well I'll begin by showing you a quick tour",
    "start": "137520",
    "end": "142920"
  },
  {
    "start": "140000",
    "end": "158000"
  },
  {
    "text": "of implementations so you can understand that maybe you already have access to Flame graphs because it's appeared in a",
    "start": "142920",
    "end": "148980"
  },
  {
    "text": "lot of software so far and then I'll explain what they are in section two with sepia flame graphs show the",
    "start": "148980",
    "end": "155459"
  },
  {
    "text": "challenges and then go through advanced flame graphs the takeaways you will learn how to",
    "start": "155459",
    "end": "160980"
  },
  {
    "start": "158000",
    "end": "187000"
  },
  {
    "text": "interpret CP flame graphs wherever they show up understand the runtime challenges which is where most of the",
    "start": "160980",
    "end": "166860"
  },
  {
    "text": "work has been as I said I coded flame graphs one night and came to work the",
    "start": "166860",
    "end": "171900"
  },
  {
    "text": "next day and it was done all of the work was making sure it worked properly in the jvm and go in node.js and lots of",
    "start": "171900",
    "end": "178860"
  },
  {
    "text": "other runtimes and then why we need edpf a new technology for advanced flame graphs",
    "start": "178860",
    "end": "187080"
  },
  {
    "start": "187000",
    "end": "488000"
  },
  {
    "text": "the slides are also online I should say there's a lot of details here but you can pull them down later",
    "start": "187080",
    "end": "193140"
  },
  {
    "text": "so the first section a tour of some examples I have more examples in a later section",
    "start": "193140",
    "end": "200760"
  },
  {
    "text": "this is also not an endorsement of any of these companies or products it's showing you what's out there",
    "start": "200760",
    "end": "207540"
  },
  {
    "text": "my original version was 2011 I wrote it one night in Pearl",
    "start": "207540",
    "end": "213239"
  },
  {
    "text": "and I'm not ashamed to say I love Pearl seems a lot of people don't like Pearl",
    "start": "213239",
    "end": "218940"
  },
  {
    "text": "but I love it I write nice Pearl some people write not so nice Pearl",
    "start": "218940",
    "end": "224459"
  },
  {
    "text": "I I really love it as a prototyping language as I can knock things out very quickly and then later on WE rewrite",
    "start": "224459",
    "end": "229680"
  },
  {
    "text": "them in C or Java or something else so I prototyped it it worked great",
    "start": "229680",
    "end": "235500"
  },
  {
    "text": "and I had I made it use svgs or spigs and JavaScript for interactivity",
    "start": "235500",
    "end": "243299"
  },
  {
    "text": "a few years later my colleague at Netflix Martin spear came up with a D3 version because I was talking to him",
    "start": "243299",
    "end": "249420"
  },
  {
    "text": "about a problem with my Pearl version was we didn't have so much live interactivity",
    "start": "249420",
    "end": "255420"
  },
  {
    "text": "we had some with the JavaScript but I wanted to go further and so Martin said",
    "start": "255420",
    "end": "260519"
  },
  {
    "text": "let's try D3 and now at the moment a lot of usage in the world are either mild",
    "start": "260519",
    "end": "266040"
  },
  {
    "text": "Pearl version because it just works and it's simple or it's Martin's D3 version",
    "start": "266040",
    "end": "271440"
  },
  {
    "text": "but there's lots more versions just to give you a quick idea Facebook were early adopters they've got a version called strobe light node.js has lots of",
    "start": "271440",
    "end": "278820"
  },
  {
    "text": "versions I really like this one by David mcclements it lets you do there's these canned code searches to highlight",
    "start": "278820",
    "end": "285600"
  },
  {
    "text": "different areas QT Creator was one of the first ones to include them in an IDE",
    "start": "285600",
    "end": "292320"
  },
  {
    "text": "python V Prof this hasn't narrowed the color palette so you have the angry",
    "start": "292320",
    "end": "297540"
  },
  {
    "text": "fruit salad lots of colors Microsoft started adding them so Windows",
    "start": "297540",
    "end": "303060"
  },
  {
    "text": "performance analyzer for etw traces LinkedIn has a really great one they use internally they've blogged about which",
    "start": "303060",
    "end": "310259"
  },
  {
    "text": "does differentials and other Advanced features Oracle added it to developer Studio",
    "start": "310259",
    "end": "317699"
  },
  {
    "text": "Windows finally added it to perfume thanks Adam Sydney and Vance Morrison for accepting that change we've been",
    "start": "317699",
    "end": "323820"
  },
  {
    "text": "pushing on that Google man my colleague from Netflix got",
    "start": "323820",
    "end": "329220"
  },
  {
    "text": "it into p-praft which is used by a lot of things there's a great one by million wolf for",
    "start": "329220",
    "end": "336240"
  },
  {
    "text": "Linux called hotspot which does off CP flame graphs and it also lets you look at the disassembly",
    "start": "336240",
    "end": "342419"
  },
  {
    "text": "from the flame graph the eclipse Foundation Trace compasses this old analyzer that does a lot of",
    "start": "342419",
    "end": "350100"
  },
  {
    "text": "things and it's included flame graphs so so it's like a do everything performance",
    "start": "350100",
    "end": "356639"
  },
  {
    "text": "analysis tool it's in Java Mission Control",
    "start": "356639",
    "end": "362220"
  },
  {
    "text": "at Netflix later on we created flame scope so that we can understand variants",
    "start": "362220",
    "end": "368460"
  },
  {
    "text": "and perturbations though otherwise hidden in flame graph so I'll cover this a bit more later we did a continuous profiler at Netflix",
    "start": "368460",
    "end": "374699"
  },
  {
    "text": "called Flame Commander the differential flame graphs AMD has it in you profits analyzer",
    "start": "374699",
    "end": "382860"
  },
  {
    "text": "it's in your kit it's an IntelliJ Firefox has a great one",
    "start": "382860",
    "end": "388699"
  },
  {
    "text": "profiler.firefox.com where you can upload various profiles and that does have flame graphs",
    "start": "388699",
    "end": "395220"
  },
  {
    "text": "Linux finally added it to the perf which is the standard utility in Linux so you",
    "start": "395220",
    "end": "400259"
  },
  {
    "text": "can run per script flame graph and it will spit it out thanks Andreas and red hat for getting that done",
    "start": "400259",
    "end": "406560"
  },
  {
    "text": "it's in Matlab which kind of surprised me but there you go",
    "start": "406560",
    "end": "411720"
  },
  {
    "text": "AWS has a service to sell it code Guru to do optimizations so does Google",
    "start": "411720",
    "end": "418380"
  },
  {
    "text": "Intel finally added to the v-tune Intel's all-in-one deep analysis tool",
    "start": "418380",
    "end": "424919"
  },
  {
    "text": "it's in Splunk you Relic has it not a dog granulate has G profile and open source",
    "start": "424919",
    "end": "433020"
  },
  {
    "text": "version that does continuous profiling and other features granulates been acquired by Intel so",
    "start": "433020",
    "end": "439860"
  },
  {
    "text": "that's now an Intel product very recently Microsoft Visual Studio",
    "start": "439860",
    "end": "446280"
  },
  {
    "text": "and grafana just added it to grafana so you can incorporate that into",
    "start": "446280",
    "end": "452039"
  },
  {
    "text": "dashboards that's really great I just went through a select few dozen",
    "start": "452039",
    "end": "458099"
  },
  {
    "text": "but there's over 80 implementations there's over 400 related open source",
    "start": "458099",
    "end": "463800"
  },
  {
    "text": "projects I've counted at least 30 commercial products of included flame graphs so far",
    "start": "463800",
    "end": "469860"
  },
  {
    "text": "there's four new startups that I know of that are doing flame graphs or flame graph based tuning or continuous",
    "start": "469860",
    "end": "476099"
  },
  {
    "text": "profiling one of them has already had an exit the amount of money that's been spent on",
    "start": "476099",
    "end": "481139"
  },
  {
    "text": "flame graphs so far is over a billion Australian I don't know how many end users there are there's a lot of people using it",
    "start": "481139",
    "end": "489080"
  },
  {
    "start": "488000",
    "end": "1372000"
  },
  {
    "text": "so that gives you an idea of the scope of flame graphs and I may have mentioned one of those products that you're already using",
    "start": "489300",
    "end": "495539"
  },
  {
    "text": "so CPU profiling here I'll explain an introduction to Flame graphs and how they work",
    "start": "495539",
    "end": "502400"
  },
  {
    "text": "here's the stack Trace from java I'm sure a lot of you have seen this kind of thing a lot",
    "start": "503879",
    "end": "509220"
  },
  {
    "text": "that's a single stack Trace so I can work from what's running on CPU to the parent grandparent and so on",
    "start": "509220",
    "end": "517099"
  },
  {
    "text": "with CPU profiling the word profiling doesn't really mean a specific thing it",
    "start": "517260",
    "end": "522419"
  },
  {
    "text": "means painting a picture of a Target or a person in computer performance it typically",
    "start": "522419",
    "end": "529680"
  },
  {
    "text": "means we will record Stacks at a timed interval but it can mean tracing the execution of",
    "start": "529680",
    "end": "536760"
  },
  {
    "text": "software so I've seen some profilers that will Trace all function calls and then assemble that into a profile that's",
    "start": "536760",
    "end": "542279"
  },
  {
    "text": "I try not to do that because it's it can be CPU expensive to trace all of your method calls or function calls I prefer",
    "start": "542279",
    "end": "549899"
  },
  {
    "text": "this this is commonly what you what what a profiler will Implement where every 10",
    "start": "549899",
    "end": "555660"
  },
  {
    "text": "milliseconds or 100 milliseconds or whatever it is it will take a stack sample",
    "start": "555660",
    "end": "561360"
  },
  {
    "text": "you'll often see these profilers they take stats samples at 99 Hertz or 49 Hertz or 997 Hertz or 103 Hertz or some",
    "start": "561360",
    "end": "570300"
  },
  {
    "text": "weird number the reason for that is we don't like taking stack samples at 100",
    "start": "570300",
    "end": "575700"
  },
  {
    "text": "Hertz or or samples per second or 10 or a thousand because those round numbers",
    "start": "575700",
    "end": "582140"
  },
  {
    "text": "can incur lock stack step sampling with the running software so you have a",
    "start": "582140",
    "end": "587820"
  },
  {
    "text": "background thread that's pulling something every 10 milliseconds or doing some sort of code logic at a regular",
    "start": "587820",
    "end": "593160"
  },
  {
    "text": "interval if the profile sampler is started at just the wrong time it will",
    "start": "593160",
    "end": "598560"
  },
  {
    "text": "always catch that interval or always miss it and so that's why we try to do 99 Hertz or 103. some profilers actually",
    "start": "598560",
    "end": "606720"
  },
  {
    "text": "do a Jitter so it will add and and subtract some time each time",
    "start": "606720",
    "end": "612839"
  },
  {
    "text": "it takes a sample secret profiles don't see what's going on when you're off CPU so you're blocked",
    "start": "612839",
    "end": "620040"
  },
  {
    "text": "unless it's a world-time profiler over time I can draw it like this I've",
    "start": "620040",
    "end": "625680"
  },
  {
    "text": "got stack samples there's the stack depth on the y-axis",
    "start": "625680",
    "end": "631220"
  },
  {
    "text": "so on the first one a called B called C called decal d I can draw frames on them",
    "start": "631380",
    "end": "639060"
  },
  {
    "text": "that's a bit hard to to really see it just looks like a lot of text and boxes",
    "start": "639060",
    "end": "646380"
  },
  {
    "text": "one thing I found is if you just randomly assign colors to function names",
    "start": "646380",
    "end": "652320"
  },
  {
    "text": "and then stick with it it helps reveal patterns and so when I",
    "start": "652320",
    "end": "657839"
  },
  {
    "text": "first look at function names I say a is going to get yellow B is going to get orange C is going to get red and so on",
    "start": "657839",
    "end": "663300"
  },
  {
    "text": "and then I stick with that later on you'll start to visually see things more",
    "start": "663300",
    "end": "668519"
  },
  {
    "text": "easily than just trying to read the text your eye just has to look at colors so far so good",
    "start": "668519",
    "end": "675180"
  },
  {
    "text": "let's try this with a real world profile that's what it looks like awesome ship",
    "start": "675180",
    "end": "681839"
  },
  {
    "text": "it so this doesn't actually work that well so I've called it a hair graph",
    "start": "681839",
    "end": "688800"
  },
  {
    "text": "and this is a this is a real workload the problem is on multi-threaded",
    "start": "688800",
    "end": "695640"
  },
  {
    "text": "programs things are changing so often that at a long time interval it's just a",
    "start": "695640",
    "end": "702180"
  },
  {
    "text": "big mess so we can be a bit smarter if previously we saw a was all the way",
    "start": "702180",
    "end": "710339"
  },
  {
    "text": "across the x-axis instead of always drawing it as a box why don't we merge that frame and then just draw a once",
    "start": "710339",
    "end": "719880"
  },
  {
    "text": "so that's what we can do we can if it's adjacent it's like a terrible version of Tetris",
    "start": "719880",
    "end": "725399"
  },
  {
    "text": "we can just keep joining them together it looks like this",
    "start": "725399",
    "end": "730500"
  },
  {
    "text": "it's improved we can start to see some of the things but we can still go better",
    "start": "730500",
    "end": "738200"
  },
  {
    "text": "If instead of having time on the x-axis we sort by the alphabet and we do an",
    "start": "738839",
    "end": "745500"
  },
  {
    "text": "alphabet sort from bottom to top it groups things together much better and so you can see now I've",
    "start": "745500",
    "end": "752760"
  },
  {
    "text": "got a line of D's and a line of C's and a line of B's when I merged those frames together",
    "start": "752760",
    "end": "759899"
  },
  {
    "text": "oh now that's merging is is much more effective now",
    "start": "759899",
    "end": "765800"
  },
  {
    "text": "whoa and there's the flame graph and I've just explained what flame graphs",
    "start": "765800",
    "end": "771120"
  },
  {
    "text": "are it is the alphabet is on the x-axis and",
    "start": "771120",
    "end": "777480"
  },
  {
    "text": "I sort all of these Stacks by the alphabet and then merge those frames together and when I showed my colleague",
    "start": "777480",
    "end": "784200"
  },
  {
    "text": "Isaac and I said look it's the alphabet and that's we're looking at the whole population that's the bit he thought was",
    "start": "784200",
    "end": "790440"
  },
  {
    "text": "weird because everyone expects time to be on the x-axis whenever you do this kind of plot but it just took him a few",
    "start": "790440",
    "end": "795839"
  },
  {
    "text": "days of playing with it to realize no this is great because the alternate is",
    "start": "795839",
    "end": "801959"
  },
  {
    "text": "not really readable that's a flame graph",
    "start": "801959",
    "end": "807860"
  },
  {
    "text": "I was at Netflix when I first got it working for Java my colleague amraitha who just sits",
    "start": "808139",
    "end": "815760"
  },
  {
    "text": "across from me I was showing my teams like look I got it working for Java for the first time mixed mode flame graphs",
    "start": "815760",
    "end": "820920"
  },
  {
    "text": "you can go in and out of the kernel armor says oh it'd be great if you could change the color so Java is a different",
    "start": "820920",
    "end": "827639"
  },
  {
    "text": "color to C and C plus plus he barely sat down at his desk when I looked at him",
    "start": "827639",
    "end": "832920"
  },
  {
    "text": "like well Java has these slashes and C plus plus",
    "start": "832920",
    "end": "838320"
  },
  {
    "text": "has colons so I'll just do a regular expression and if it has a slash I'll color it green and have it as a cone",
    "start": "838320",
    "end": "844079"
  },
  {
    "text": "I'll color it yellow so I called armor back like two minutes later and said done colors",
    "start": "844079",
    "end": "849720"
  },
  {
    "text": "so very simple vertical Expressions can get abused a lot I worked with a guy",
    "start": "849720",
    "end": "854940"
  },
  {
    "text": "whose name was guy who hated regular Expressions um he actually created bridgexlicense.com",
    "start": "854940",
    "end": "862079"
  },
  {
    "text": "because his theory was he needed a license to be able to use regular Expressions so anyway very quick hack",
    "start": "862079",
    "end": "869660"
  },
  {
    "text": "now I'll replay it but this time using the colored version so there was time columns where I'm doing the stack",
    "start": "870000",
    "end": "875160"
  },
  {
    "text": "samples everything's a column over time now I start to merge things together if",
    "start": "875160",
    "end": "880680"
  },
  {
    "text": "it's the same frame adjacent this is also known as a flame chart I'll",
    "start": "880680",
    "end": "886139"
  },
  {
    "text": "get to that and then I just reshuffle everything to maximize merging",
    "start": "886139",
    "end": "892019"
  },
  {
    "text": "by using the alphabet but you could use a different algorithm it doesn't have to be the alphabet plane graph",
    "start": "892019",
    "end": "899220"
  },
  {
    "text": "the origin was I mentioned it briefly it was a",
    "start": "899220",
    "end": "905339"
  },
  {
    "text": "performance issue where on Monday we had this customer found that the competitive",
    "start": "905339",
    "end": "911760"
  },
  {
    "text": "system ran faster than our system and our system consume more CPU",
    "start": "911760",
    "end": "919620"
  },
  {
    "text": "and as a performance engineer it's like well it's a CPU issue I'll run the profilers often it's the most frequent",
    "start": "919620",
    "end": "925260"
  },
  {
    "text": "stack so I ran a profiler on one system was d-trace and so I'm profiling",
    "start": "925260",
    "end": "931139"
  },
  {
    "text": "way too fast 997 Hertz and then I mean the stack traces were not that deep so I",
    "start": "931139",
    "end": "937079"
  },
  {
    "text": "got away with it and I started looking and the output of this shows IF frequency counts the stack",
    "start": "937079",
    "end": "942480"
  },
  {
    "text": "Trace so the last stack Trace appeared five thousand times and that one appeared 4 800 times and so on great so",
    "start": "942480",
    "end": "949860"
  },
  {
    "text": "I just look at the most frequent stack trace and I see if that's the issue and then I go the next most frequent and so on",
    "start": "949860",
    "end": "955440"
  },
  {
    "text": "the full output was this visualized and so the most frequent Stacks are here",
    "start": "955440",
    "end": "962639"
  },
  {
    "text": "and by Wednesday I'd already gone through the most frequent stacks and not solved the issue",
    "start": "962639",
    "end": "968100"
  },
  {
    "text": "I don't have a vision maybe I do somewhere I don't have the visualization but I had the same profile from the",
    "start": "968100",
    "end": "973680"
  },
  {
    "text": "competitor system which was Linux and I was using perf and it also had this",
    "start": "973680",
    "end": "979980"
  },
  {
    "text": "just wall of text that I had to sort through and I was trying to find the one difference between these two profiles in",
    "start": "979980",
    "end": "986880"
  },
  {
    "text": "a way I was looking for one needle across two haystacks",
    "start": "986880",
    "end": "991760"
  },
  {
    "text": "as it turns out my it was a really important issue and so there's a lot of pressure on me in the office to be working on it and I didn't feel like I",
    "start": "992100",
    "end": "999720"
  },
  {
    "text": "could be goofing around with visualizations while this was so important so I actually did this out of",
    "start": "999720",
    "end": "1006380"
  },
  {
    "text": "hours it was out of it was a Spare Time Project and also my the",
    "start": "1006380",
    "end": "1012860"
  },
  {
    "text": "I had a previous experience where a colleague had goofed around with visualizations that didn't work out and",
    "start": "1012860",
    "end": "1019699"
  },
  {
    "text": "there was pressure not to do not to waste time on that so flame grass didn't come from an environment where I was encouraged to do this quite the opposite",
    "start": "1019699",
    "end": "1026240"
  },
  {
    "text": "I was encouraged not to play around with visualizations but I I come up with latency heat Maps before to visualize",
    "start": "1026240",
    "end": "1032480"
  },
  {
    "text": "the lengthy histograms and I really felt that oh they just has to be a better way",
    "start": "1032480",
    "end": "1037819"
  },
  {
    "text": "to do this that's the flame graph for the same profile data that I came up with",
    "start": "1037819",
    "end": "1044418"
  },
  {
    "text": "and then straight away it's like oh it's we're in my my sequel to do select and we're doing a join and we're spending",
    "start": "1044419",
    "end": "1051200"
  },
  {
    "text": "all our time there when we shouldn't be there's the problem so instead of looking for needle and",
    "start": "1051200",
    "end": "1057140"
  },
  {
    "text": "Haystack it like turned it into this giant Pink pool noodle that was sticking out of the haystack",
    "start": "1057140",
    "end": "1062360"
  },
  {
    "text": "and not so much of an exciting story it's like oh there's the issue it's right there so",
    "start": "1062360",
    "end": "1069039"
  },
  {
    "text": "as an example what that looks like on Linux Linux perfect profiling",
    "start": "1069080",
    "end": "1074299"
  },
  {
    "text": "it Aggregates things a bit better than the other profiler I was using so it does this hierarchy or culture summary",
    "start": "1074299",
    "end": "1081200"
  },
  {
    "text": "but that's still the output of a perf run it's too much data and there's an example flame graph",
    "start": "1081200",
    "end": "1089440"
  },
  {
    "text": "the inspiration was from a colleague some micro C Microsystems",
    "start": "1091039",
    "end": "1098480"
  },
  {
    "text": "came up with function called graph in Ruby and this was",
    "start": "1098539",
    "end": "1103580"
  },
  {
    "text": "over time and Neil was inspired by another",
    "start": "1103580",
    "end": "1109039"
  },
  {
    "text": "colleague of mine from some mic systems Rock Bourbonnais who I worked with a lot he's called stack analyzer and rock",
    "start": "1109039",
    "end": "1114440"
  },
  {
    "text": "would tell me to keep using his call stack analyze like you should use this it's really awesome look this I haven't",
    "start": "1114440",
    "end": "1119660"
  },
  {
    "text": "yet to find it it's so so many years ago I've yet to find a screenshot of it but it looks similar to this and that was",
    "start": "1119660",
    "end": "1126799"
  },
  {
    "text": "inspired by an earlier tool called f Trace so there had already been a lot of work in doing function flow over time",
    "start": "1126799",
    "end": "1134000"
  },
  {
    "text": "this was different to Flame graphs though because the x-axis here is time",
    "start": "1134000",
    "end": "1139520"
  },
  {
    "text": "and this only worked because you traced going in and out of all of the functions",
    "start": "1139520",
    "end": "1144620"
  },
  {
    "text": "so if you gave a profile to these visualizations that didn't work because a a sample based profile has gaps in",
    "start": "1144620",
    "end": "1152840"
  },
  {
    "text": "between those samples so the flame graph summary how would I",
    "start": "1152840",
    "end": "1159679"
  },
  {
    "text": "summarize it on a single slide x-axis is the population alphabet sort y-axis is the sack depth",
    "start": "1159679",
    "end": "1166760"
  },
  {
    "text": "the color I went with random warm colors I reduced",
    "start": "1166760",
    "end": "1172640"
  },
  {
    "text": "the I thought this was too many colors so I just changed it to just be warm ones and that made it much easier I also put",
    "start": "1172640",
    "end": "1180440"
  },
  {
    "text": "in my original version of flying graphs I put all of this in the source code because I like to thank where these ideas come from",
    "start": "1180440",
    "end": "1187779"
  },
  {
    "text": "my original implementation was Pearl but there's lots of other ones and I went through a bunch at the start",
    "start": "1189080",
    "end": "1195080"
  },
  {
    "text": "how do you interpret them here's an example if you look over the top Edge that shows",
    "start": "1195080",
    "end": "1202400"
  },
  {
    "text": "who is running on CPU and by how much by how much you just look at the width",
    "start": "1202400",
    "end": "1208100"
  },
  {
    "text": "and you compare line lengths comparing line lengths has been evaluated as an",
    "start": "1208100",
    "end": "1213799"
  },
  {
    "text": "easy visual task there's a variation on flame graphs that uses polar coordinates",
    "start": "1213799",
    "end": "1219080"
  },
  {
    "text": "and it turns them into these radial diagrams or Sunburst diagrams which I",
    "start": "1219080",
    "end": "1224600"
  },
  {
    "text": "find a bit harder to interpret this is great because everything is a rectangle you get to put the function name in you're just doing line length visual",
    "start": "1224600",
    "end": "1231140"
  },
  {
    "text": "comparisons so I look at this G is on CPU the most because it's the top Edge that's the",
    "start": "1231140",
    "end": "1237860"
  },
  {
    "text": "biggest followed by I when you read down you see the ancestry",
    "start": "1237860",
    "end": "1242960"
  },
  {
    "text": "G was called by F was called by D was called by C and so on",
    "start": "1242960",
    "end": "1248320"
  },
  {
    "text": "the widths are proportional to the presence in the samples I can look down in the stack and and see that b and its",
    "start": "1249380",
    "end": "1255620"
  },
  {
    "text": "children was looks like about three times more than H and its children",
    "start": "1255620",
    "end": "1262659"
  },
  {
    "text": "and the colors I randomized them to differentiate frames some people do implementations",
    "start": "1264200",
    "end": "1270200"
  },
  {
    "text": "where they don't randomize the colors and it can be a little hard to see adjacent Towers",
    "start": "1270200",
    "end": "1275960"
  },
  {
    "text": "I ended up using Hughes my colleague suggested that so that we can see different types of code",
    "start": "1275960",
    "end": "1284140"
  },
  {
    "text": "some flying graph tips and tricks people show me flying graphs all the time Brendan check this out",
    "start": "1284960",
    "end": "1291500"
  },
  {
    "text": "I'm going to start at the bottom frame and look at how many samples it's about time I actually showed you a flame graph",
    "start": "1291500",
    "end": "1298100"
  },
  {
    "text": "let me switch to one so here's a flame graph I said I start at the bottom frame if I",
    "start": "1298100",
    "end": "1304159"
  },
  {
    "text": "Mouse over the bottom frame it says 2963 samples okay",
    "start": "1304159",
    "end": "1311179"
  },
  {
    "text": "if that said 17 samples what might I conclude",
    "start": "1311179",
    "end": "1316220"
  },
  {
    "text": "I might conclude that was an idle system and this hap this would happen at Netflix a lot where you have a instance",
    "start": "1316220",
    "end": "1323000"
  },
  {
    "text": "or ASG that's melting down an instance that's bad it's using too much CPU and then it would get killed",
    "start": "1323000",
    "end": "1329960"
  },
  {
    "text": "and taken out of Discovery the load balancer would send traffic elsewhere and so by the time people looking at it",
    "start": "1329960",
    "end": "1335480"
  },
  {
    "text": "and collecting flame graphs the system was no longer running the workload it was idle so",
    "start": "1335480",
    "end": "1341960"
  },
  {
    "text": "there's no maybe I need to visually put it in there",
    "start": "1341960",
    "end": "1347059"
  },
  {
    "text": "somewhere but I start with the bottom and if I see there's only a handful of samples there's only like 12 samples or",
    "start": "1347059",
    "end": "1353000"
  },
  {
    "text": "24 samples it's like this sounds like an idle system so it's not going to be very very interesting you want to see lots of",
    "start": "1353000",
    "end": "1358460"
  },
  {
    "text": "samples and you can just do the math so if I'm sampling it 49 Hertz on a 64 CPU machine for a 30",
    "start": "1358460",
    "end": "1366919"
  },
  {
    "text": "second flame graph there should be thousands and thousands of samples",
    "start": "1366919",
    "end": "1372559"
  },
  {
    "start": "1372000",
    "end": "1462000"
  },
  {
    "text": "fine graphs you can also zoom in so I can zoom into this and then I can Mouse over and it gives",
    "start": "1372559",
    "end": "1377659"
  },
  {
    "text": "me details file name lookup was 32 samples 1.08 on CPU and I can do a",
    "start": "1377659",
    "end": "1386600"
  },
  {
    "text": "search so let me just zoom back out again look for file name I was only there that's boring look for",
    "start": "1386600",
    "end": "1393140"
  },
  {
    "text": "built-in and another thing I'd like to do is",
    "start": "1393140",
    "end": "1398419"
  },
  {
    "text": "if you do a search I show how much of the profile was",
    "start": "1398419",
    "end": "1404000"
  },
  {
    "text": "matched so I just searched for built-in and it said built-in was in 45 of the",
    "start": "1404000",
    "end": "1410960"
  },
  {
    "text": "profile so I'm not including it twice or three times",
    "start": "1410960",
    "end": "1416059"
  },
  {
    "text": "because it's in those deepest Acts this is useful because as a performance engineer or developer you need to know",
    "start": "1416059",
    "end": "1422600"
  },
  {
    "text": "quickly what is the magnitude of the issue should I solve this issue or that issue and so you quickly want to be able",
    "start": "1422600",
    "end": "1427880"
  },
  {
    "text": "to add it all up so that's why I can search for all sorts",
    "start": "1427880",
    "end": "1433400"
  },
  {
    "text": "of things such word shell is the is different one let's search for Neti this",
    "start": "1433400",
    "end": "1438980"
  },
  {
    "text": "one has the colors so Nettie's 94 of the profile let's search for the kernel code",
    "start": "1438980",
    "end": "1444200"
  },
  {
    "text": "let's search for TCP okay so there's TCP TCP was present in",
    "start": "1444200",
    "end": "1449419"
  },
  {
    "text": "26 of the frames and then of course now that I've found it I can then zoom in and and go into",
    "start": "1449419",
    "end": "1455480"
  },
  {
    "text": "the finer details as to why",
    "start": "1455480",
    "end": "1459100"
  },
  {
    "start": "1462000",
    "end": "2100000"
  },
  {
    "text": "off CPU time such as IO and Lux is not present but their initialization CPU frames may",
    "start": "1462860",
    "end": "1470299"
  },
  {
    "text": "be and so you may see what turns out to be in a way breadcrumbs of their existence",
    "start": "1470299",
    "end": "1477860"
  },
  {
    "text": "so you see like oh look we aren't doing a lot of time in the files like five percent of time in the file system and",
    "start": "1477860",
    "end": "1484280"
  },
  {
    "text": "initializing block i o when you see that in a CPU flame graph you've got to think",
    "start": "1484280",
    "end": "1489320"
  },
  {
    "text": "Chief I'm spending five percent of My Cycles initializing disk IO I may be spending 50 of my time waiting",
    "start": "1489320",
    "end": "1496700"
  },
  {
    "text": "on Disco because I can't see that blocked time we can do enough sleep with plane graph",
    "start": "1496700",
    "end": "1501740"
  },
  {
    "text": "to see it which I'll cover later there are some tiny CP code baths that",
    "start": "1501740",
    "end": "1507020"
  },
  {
    "text": "might be missing it depends on your system and the profiler you're using and all of that",
    "start": "1507020",
    "end": "1512179"
  },
  {
    "text": "if you're on the cloud then you may not be able to see hypervised we shouldn't be able to see hypervisor time from the",
    "start": "1512179",
    "end": "1518240"
  },
  {
    "text": "guest you may not be able to see kernel code paths that disable interrupts doing an",
    "start": "1518240",
    "end": "1523640"
  },
  {
    "text": "interrupt-based profile hardware-based profiles can see more",
    "start": "1523640",
    "end": "1528820"
  },
  {
    "text": "this is a detail of the profiler and the target people send me this stuff from time to time saying Brennan please fix",
    "start": "1528980",
    "end": "1534020"
  },
  {
    "text": "it and it's like this is the flame graph visualizes the profile profiler you need to fix the profiler to see more and then",
    "start": "1534020",
    "end": "1540679"
  },
  {
    "text": "the flame graph will visualize it another tip and trick if if there's",
    "start": "1540679",
    "end": "1546980"
  },
  {
    "text": "still too much hair the top of the flame graph you can reverse the polarity of the neutron flow and merge at the top",
    "start": "1546980",
    "end": "1554900"
  },
  {
    "text": "instead a leaf merge that's not actually what it's called but anyway Leaf merge so",
    "start": "1554900",
    "end": "1561080"
  },
  {
    "text": "this was a profile I had a Netflix where you can see it's hair it's like okay",
    "start": "1561080",
    "end": "1567320"
  },
  {
    "text": "that's not terribly great but what if they're all calling the same function right what if this is the same function",
    "start": "1567320",
    "end": "1572900"
  },
  {
    "text": "at the top of all of those strands of hair and so all I do here is I flip it and I merge",
    "start": "1572900",
    "end": "1578960"
  },
  {
    "text": "at the top instead and I see that oh yeah we're all in Zen hypervisor native flush tlb",
    "start": "1578960",
    "end": "1588860"
  },
  {
    "text": "and we're doing handle do Numa page great and so this was actually a numer",
    "start": "1588860",
    "end": "1594860"
  },
  {
    "text": "issue on this particular build of Ubuntu and I was able to figure out my original",
    "start": "1594860",
    "end": "1600020"
  },
  {
    "text": "flame graph implementation let you do this by doing minus minus inverted in reverse",
    "start": "1600020",
    "end": "1606620"
  },
  {
    "text": "I did this so that I could merge at the top and so the bottom a lot of people actually like to",
    "start": "1606620",
    "end": "1612500"
  },
  {
    "text": "merge at the top that sorry flip the flame graph because they preferred upside down get to that",
    "start": "1612500",
    "end": "1617720"
  },
  {
    "text": "in a sec flying graph interactivity if I was to mention some Essentials I just did a",
    "start": "1617720",
    "end": "1622820"
  },
  {
    "text": "quick demo so you can Mouse over for frame info quick to zoom and search",
    "start": "1622820",
    "end": "1628400"
  },
  {
    "text": "Ctrl f there's various other things that are nice to have so if you're working on a",
    "start": "1628400",
    "end": "1634279"
  },
  {
    "text": "fine graph implementation or if you are buying a flying graph information from a vendor there's plenty of Open Source",
    "start": "1634279",
    "end": "1639500"
  },
  {
    "text": "versions out there but some of you may already have it as part of a commercial product I like to have merge control so you can",
    "start": "1639500",
    "end": "1646039"
  },
  {
    "text": "change whether you're merging from the root or the leaf or maybe you want to merge around the middle frames maybe the",
    "start": "1646039",
    "end": "1651620"
  },
  {
    "text": "middle frames of your developers frames this is my code let's merge around that and then",
    "start": "1651620",
    "end": "1657020"
  },
  {
    "text": "that's my perspective of the world which direction we have the flame graph so you",
    "start": "1657020",
    "end": "1662240"
  },
  {
    "text": "can just flip it so it's an icicle graph instead have a toggle flame chart so you're doing it over time",
    "start": "1662240",
    "end": "1669020"
  },
  {
    "text": "even though it just showed some visualizations where it didn't work sometimes it does work especially if it's single threaded",
    "start": "1669020",
    "end": "1675919"
  },
  {
    "text": "can search as collapse filters and links to code so you can look look at a frame and go to a code link",
    "start": "1675919",
    "end": "1683140"
  },
  {
    "text": "which way up so I did have inverted for an icicle graph it's fine whichever way you want I think",
    "start": "1683299",
    "end": "1689360"
  },
  {
    "text": "it's kind of an Indian argument which end of a boiled egg to break although there is slight advantages for the",
    "start": "1689360",
    "end": "1695480"
  },
  {
    "text": "icicle graph if your UI begins showing at the top because some very tall flame",
    "start": "1695480",
    "end": "1701419"
  },
  {
    "text": "graphs when it begins at the top you just see strands to start with and you have to hit page down",
    "start": "1701419",
    "end": "1707720"
  },
  {
    "text": "so if I look at this one's a bit tall if I reload it it may start there",
    "start": "1707720",
    "end": "1714740"
  },
  {
    "text": "and then I need to scroll down to see it and so that's it's a legitimate reason why you may",
    "start": "1714740",
    "end": "1721340"
  },
  {
    "text": "want to have it upside down so when you load it it starts it the roots of the the flame graph are visible",
    "start": "1721340",
    "end": "1727640"
  },
  {
    "text": "I noticed that Microsoft in their Visual Studio they've got a button so you can just flip the flame graph so you just",
    "start": "1727640",
    "end": "1734360"
  },
  {
    "text": "let the end user choose which way they want it differential flame graphs are another",
    "start": "1734360",
    "end": "1739640"
  },
  {
    "text": "type and here I'm now going to use the",
    "start": "1739640",
    "end": "1746059"
  },
  {
    "text": "the color for a dimension of of information",
    "start": "1746059",
    "end": "1751640"
  },
  {
    "text": "so red I'm showing more samples and blue less samples when you're comparing say",
    "start": "1751640",
    "end": "1757640"
  },
  {
    "text": "one software version to another or one system to another that's running the same code the intensity is the degree of",
    "start": "1757640",
    "end": "1763340"
  },
  {
    "text": "difference and so I can look through this and I can say well red is where we're there's there's more samples so",
    "start": "1763340",
    "end": "1768679"
  },
  {
    "text": "we've grown and blue is where we've shrunk there's another project for this flame graph diff",
    "start": "1768679",
    "end": "1774620"
  },
  {
    "text": "uh with Netflix we have this for flying Commander you've got to be careful about a loaded",
    "start": "1774620",
    "end": "1780740"
  },
  {
    "text": "it's great there's a few tricks about differential flame graphs one is inlining Java can inline differently",
    "start": "1780740",
    "end": "1787039"
  },
  {
    "text": "from one run to the next and so when you're trying to do the differential flame graph if it's the",
    "start": "1787039",
    "end": "1793460"
  },
  {
    "text": "if it's the native frames after inlining they can be completely different and so",
    "start": "1793460",
    "end": "1798860"
  },
  {
    "text": "the differential doesn't work and so you have to differentiate did the differential on uninlined",
    "start": "1798860",
    "end": "1804919"
  },
  {
    "text": "which is just one of the gotchas that you'll run into if you do this another culture is sometimes code just",
    "start": "1804919",
    "end": "1810860"
  },
  {
    "text": "vanishes from the second profile so if I'm comparing the difference from version one and version two of software",
    "start": "1810860",
    "end": "1817340"
  },
  {
    "text": "and like there was a tower in version one that's now gone it's not visible in",
    "start": "1817340",
    "end": "1822740"
  },
  {
    "text": "version two so sometimes you need to have an extra flame graph of like this",
    "start": "1822740",
    "end": "1828260"
  },
  {
    "text": "is the code that's gone that's vanished now I mentioned there's a few ways to a",
    "start": "1828260",
    "end": "1834260"
  },
  {
    "text": "few implementations of different actual flame graphs this is actually how I do differential flame graphs a lot I have",
    "start": "1834260",
    "end": "1840140"
  },
  {
    "text": "them in different tabs of my browser from system A and B and they just flip between them like this",
    "start": "1840140",
    "end": "1847460"
  },
  {
    "text": "oh what's different about these two flame graphs it's this bit this bit over",
    "start": "1847460",
    "end": "1852559"
  },
  {
    "text": "here that's actually how I do it so you can just do that you just load them up in one and the other and you just flick between them done or you can you can do",
    "start": "1852559",
    "end": "1860659"
  },
  {
    "text": "this in software that's fine that's fine too just to mention system CPU profilers on",
    "start": "1860659",
    "end": "1867320"
  },
  {
    "text": "Linux perf is the one that comes with Linux performance ebpf is more efficient it can do kernel",
    "start": "1867320",
    "end": "1874460"
  },
  {
    "text": "aggregations and there's a tool that initially wrote BCC profile for that Windows has it in",
    "start": "1874460",
    "end": "1881299"
  },
  {
    "text": "xperf and WPA and visual studio now OS X instruments",
    "start": "1881299",
    "end": "1887120"
  },
  {
    "text": "there's ways to do it and there's many more use system Pro profiles wherever possible not the runtime profilers so if",
    "start": "1887120",
    "end": "1894140"
  },
  {
    "text": "you go to like in the world of java inject there's a lot of profilers based on jvmti and that only shows you your",
    "start": "1894140",
    "end": "1901880"
  },
  {
    "text": "Java frames and so you don't see the rest of the system the kernel and and the amount of CPU time in garbage",
    "start": "1901880",
    "end": "1908299"
  },
  {
    "text": "collection and other bits and pieces in the slides which I said are online I",
    "start": "1908299",
    "end": "1914419"
  },
  {
    "text": "do have some instructions for Linux for creating them at Linux in fact it's so easy now that perf's",
    "start": "1914419",
    "end": "1921620"
  },
  {
    "text": "gript has flame graph as a sub command that Andreas and red had added you can just run PostScript flame graph and you",
    "start": "1921620",
    "end": "1927320"
  },
  {
    "text": "get it cool that's using ebpf all open source tools",
    "start": "1927320",
    "end": "1932659"
  },
  {
    "text": "you can create it using my old Pearl yes you can install my pulse offeringer systems keep Pearl alive I really don't",
    "start": "1932659",
    "end": "1939440"
  },
  {
    "text": "care you can you can also just rewrite it in whatever language you want you don't have to use my pill code and then generate the SVG",
    "start": "1939440",
    "end": "1949240"
  },
  {
    "text": "and I've got some other instructions in there as well so the old-fashioned way was using perf record on on older Linux",
    "start": "1950240",
    "end": "1958778"
  },
  {
    "text": "just to visually explain why I care about ebpf here's how we were doing it lots of",
    "start": "1958820",
    "end": "1965120"
  },
  {
    "text": "steps involved writing samples to the file system in perth.data and then",
    "start": "1965120",
    "end": "1970700"
  },
  {
    "text": "re-reading that data and processing it and then sticking it out with ebpf we just summarize it in kernel",
    "start": "1970700",
    "end": "1979220"
  },
  {
    "text": "space and then stick out the small summary to flamecraft.pl to visualize much more",
    "start": "1979220",
    "end": "1985100"
  },
  {
    "text": "efficient a lot of you I'm not even going to touch",
    "start": "1985100",
    "end": "1990260"
  },
  {
    "text": "the command line versions you're just going to use guise that's fine a case at Netflix so Engineers solve a",
    "start": "1990260",
    "end": "1996500"
  },
  {
    "text": "lot of issues from the self-service uis and at Netflix I worked on Lots Netflix",
    "start": "1996500",
    "end": "2001960"
  },
  {
    "text": "Vector which we retired flame scope I'll cover later in a continuous profile but there's other open source versions as",
    "start": "2001960",
    "end": "2007779"
  },
  {
    "text": "well it's Granny like cheap profile Eclipse Trace Compass grafana just added flame graphs lots and lots",
    "start": "2007779",
    "end": "2015720"
  },
  {
    "text": "flame charts I mentioned once flame charts were inspired by Flame graphs so there was my post on flame graphs and",
    "start": "2015940",
    "end": "2022360"
  },
  {
    "text": "then someone said let's add flame charts to the dev tools the browser Dev tools",
    "start": "2022360",
    "end": "2027940"
  },
  {
    "text": "for Chrome and that wait let's add flame graphs but Google",
    "start": "2027940",
    "end": "2034000"
  },
  {
    "text": "did not implement it as the alphabet on the x-axis they",
    "start": "2034000",
    "end": "2039039"
  },
  {
    "text": "implemented it as time on the x-axis so either they got it wrong or they got it",
    "start": "2039039",
    "end": "2044200"
  },
  {
    "text": "right that's what it looks like today and you've probably used this this is not as hairy as my earlier",
    "start": "2044200",
    "end": "2051040"
  },
  {
    "text": "examples because with JavaScript the runtime in the kernel V8 and whatever",
    "start": "2051040",
    "end": "2057398"
  },
  {
    "text": "implementation they're typically single threaded and so you don't with a multi-threaded app like back-end servers",
    "start": "2057399",
    "end": "2063520"
  },
  {
    "text": "you could just can't put all those samples on one timeline because it's just a mess but if it's a single",
    "start": "2063520",
    "end": "2069339"
  },
  {
    "text": "threaded app you can sort of get away with it so perhaps it was deliberate they did not",
    "start": "2069339",
    "end": "2074560"
  },
  {
    "text": "call it flame graphs they call it flame charts which is convenient because now flame charts are time on the excess",
    "start": "2074560",
    "end": "2081520"
  },
  {
    "text": "x-axis and graphs as alphabet they should add a way to do both firefox's profiler you can do both so",
    "start": "2081520",
    "end": "2088300"
  },
  {
    "text": "you can do flame graphs and Flame charts two views of the same data which is great that's what I recommend",
    "start": "2088300",
    "end": "2095200"
  },
  {
    "text": "so flame charts excess accesses time and graphs x-axis is the population",
    "start": "2095200",
    "end": "2101640"
  },
  {
    "start": "2100000",
    "end": "2480000"
  },
  {
    "text": "I want to briefly go through some some challenges with flame graphs so that you're aware",
    "start": "2101859",
    "end": "2107800"
  },
  {
    "text": "broken stack traces are super common so here I'm running perfect chord and like",
    "start": "2107800",
    "end": "2114160"
  },
  {
    "text": "hmm my application only has a stack depth of two with this crazy number",
    "start": "2114160",
    "end": "2119500"
  },
  {
    "text": "it's broken happens all happens all the time this is what it looks like it's a flame graph here's my Java frames oh",
    "start": "2119500",
    "end": "2127420"
  },
  {
    "text": "they're just this green grass at the bottom how do we fix it",
    "start": "2127420",
    "end": "2133420"
  },
  {
    "text": "we can turn on frame point it's a very common issue is that a long time ago",
    "start": "2133420",
    "end": "2141420"
  },
  {
    "text": "about 15 years ago frame Point frame pointers were the way a system will work stack traces and the",
    "start": "2141820",
    "end": "2148420"
  },
  {
    "text": "GCC compiler Engineers decided to reuse the frame point or register as an",
    "start": "2148420",
    "end": "2154300"
  },
  {
    "text": "extra general purpose register because it improved performance on i386 on",
    "start": "2154300",
    "end": "2159880"
  },
  {
    "text": "32-bit systems that had limited number of registers it didn't matter so much for 64-bit systems",
    "start": "2159880",
    "end": "2166599"
  },
  {
    "text": "but we're stuck with the change so far and we've been trying to",
    "start": "2166599",
    "end": "2172839"
  },
  {
    "text": "speaking of changes and we've been trying to undo it oh yeah absolutely I want to update my computer in the middle",
    "start": "2172839",
    "end": "2179440"
  },
  {
    "text": "of a presentation they'll be great so frame Point based is this change to",
    "start": "2179440",
    "end": "2186160"
  },
  {
    "text": "happen in GCC a long time ago uh I very recently like the last seven days I've",
    "start": "2186160",
    "end": "2192220"
  },
  {
    "text": "still been pushing on getting that fixed so that you don't have to do the work but a lot of sites like Netflix and",
    "start": "2192220",
    "end": "2198579"
  },
  {
    "text": "Facebook and others they just recompile all the software frame pointers problem solved so Frank point is always",
    "start": "2198579",
    "end": "2205359"
  },
  {
    "text": "there frame point is a way to just start walking there's other ways to do stack walking like dwarf debug info it's not",
    "start": "2205359",
    "end": "2210820"
  },
  {
    "text": "great for it's good for debuggers but not great for profilers or real-time things",
    "start": "2210820",
    "end": "2215980"
  },
  {
    "text": "jits can provide rental runtime work as they should because they need to for exception stack traces and there might",
    "start": "2215980",
    "end": "2222280"
  },
  {
    "text": "be a way to hook into that Intel has a feature called last Branch record to do it in Hardware although it",
    "start": "2222280",
    "end": "2227859"
  },
  {
    "text": "has a limit may only reach 32 frames and an emerging Technologies add-on workers",
    "start": "2227859",
    "end": "2234460"
  },
  {
    "text": "using ebpf so when you I at Netflix did the",
    "start": "2234460",
    "end": "2239800"
  },
  {
    "text": "original work to fix the frame pointers in the jvm and Oracle took my work and included it and rewrote it included as",
    "start": "2239800",
    "end": "2247060"
  },
  {
    "text": "preserve frame pointer so when you run the jvm with that option the stack traces are now fixed which is",
    "start": "2247060",
    "end": "2254020"
  },
  {
    "text": "great the performance impact should be very small it should be 0.1 percent there may",
    "start": "2254020",
    "end": "2259720"
  },
  {
    "text": "be an exception though so do test and see what it looks like there's fixed plane graphs",
    "start": "2259720",
    "end": "2266500"
  },
  {
    "text": "fixed we don't have symbols fixing symbols for compiled software",
    "start": "2266500",
    "end": "2274000"
  },
  {
    "text": "there might be a debug Sim package on Linux or you recompile it with the right options",
    "start": "2274000",
    "end": "2279820"
  },
  {
    "text": "for Java and node.js and other runtimes on Linux kerf likes to use a supplemental file so",
    "start": "2279820",
    "end": "2286839"
  },
  {
    "text": "we I'm running perfscript it's trying to open this thing called temp perf whatever.map it's like oh I can't find",
    "start": "2286839",
    "end": "2293680"
  },
  {
    "text": "it continuing without symbols there's software on GitHub that will create",
    "start": "2293680",
    "end": "2298900"
  },
  {
    "text": "these supplemental files so there's Java's perf map agent that will create that symbol file and then when perf runs",
    "start": "2298900",
    "end": "2305500"
  },
  {
    "text": "it can it can navigate the symbol table for run for runtimes you",
    "start": "2305500",
    "end": "2310839"
  },
  {
    "text": "have to keep refreshing it though because the C2 compiler doesn't doesn't stop although I wish I had a way to stop",
    "start": "2310839",
    "end": "2316000"
  },
  {
    "text": "it stop compiling so I can do things fixed now we can see Java frames",
    "start": "2316000",
    "end": "2324099"
  },
  {
    "text": "when I join Netflix Java profiling actually look like this so Netflix was doing flame graphs using",
    "start": "2324099",
    "end": "2331119"
  },
  {
    "text": "a jvmti profiler so you could just see the Java bits and then using a system profiler to look at the remaining bits",
    "start": "2331119",
    "end": "2338079"
  },
  {
    "text": "and then in your head you're trying to connect the dots but by 2018 I got it all fixed and I",
    "start": "2338079",
    "end": "2345880"
  },
  {
    "text": "talked about this at Yao 2018 so now the Java frames are on top of the system",
    "start": "2345880",
    "end": "2351160"
  },
  {
    "text": "frames you can see going in and out of java and back into the kernel and so on that's a mixed mode flame graph",
    "start": "2351160",
    "end": "2358260"
  },
  {
    "text": "just an example of why that's useful this is one that a developer brought to me and said I've got a performance issue I",
    "start": "2358720",
    "end": "2364960"
  },
  {
    "text": "pulled up the flame graph and went whoa you are calling exceptions",
    "start": "2364960",
    "end": "2371740"
  },
  {
    "text": "like what is there a error in the code exception handling and the developer had a look and went oh",
    "start": "2371740",
    "end": "2379060"
  },
  {
    "text": "someone needed some system property and so they just threw an exception to get it and like that was",
    "start": "2379060",
    "end": "2385599"
  },
  {
    "text": "because it has to work stack traces and do all this systemy stuff it was consuming a lot of time that's",
    "start": "2385599",
    "end": "2391480"
  },
  {
    "text": "not visible in the standard Java profilers so it just stood out straight away in the mixed mode flame graph and they're",
    "start": "2391480",
    "end": "2398380"
  },
  {
    "text": "like oh yeah we just we can just cache that property or we don't need it or we just eliminate unnecessary work",
    "start": "2398380",
    "end": "2405700"
  },
  {
    "text": "various other issues to be aware of jit symbol churn so that snapshot can change",
    "start": "2405700",
    "end": "2411700"
  },
  {
    "text": "over time and so there is a new newer feature in Perth where it can do time stamped symbol logs of java",
    "start": "2411700",
    "end": "2419160"
  },
  {
    "text": "containers bring all sorts of issues solve one issue and create like 10 more",
    "start": "2419160",
    "end": "2424300"
  },
  {
    "text": "so containers like are you reading the files from the right namespace it should now work because there were a bunch of",
    "start": "2424300",
    "end": "2430180"
  },
  {
    "text": "changes to this and stack depth limits we had one microservice at Netflix that",
    "start": "2430180",
    "end": "2437440"
  },
  {
    "text": "would frequently run to over a thousand frames deep and",
    "start": "2437440",
    "end": "2443020"
  },
  {
    "text": "Linux had a 127 frame limit on doing profiling and so Ronaldo",
    "start": "2443020",
    "end": "2448900"
  },
  {
    "text": "Cavallo de Mello fixed that for us and so now there's assist CTL so you can increase the stack limit",
    "start": "2448900",
    "end": "2456520"
  },
  {
    "text": "in learning I mentioned before inlining can be a problem especially for differentials",
    "start": "2456520",
    "end": "2462420"
  },
  {
    "text": "but every I've talked a little bit Java but every runtime can have its own special stack or symbol instructions",
    "start": "2463900",
    "end": "2471520"
  },
  {
    "text": "that you need to look into so whether it's node.js or python Ruby try an internet search and try and sort",
    "start": "2471520",
    "end": "2478240"
  },
  {
    "text": "by date to find it the latest Advanced flame graphs now you've got CP",
    "start": "2478240",
    "end": "2484420"
  },
  {
    "start": "2480000",
    "end": "2820000"
  },
  {
    "text": "flame graphs you've got them working what else can we do flame graphs can visualize any stack",
    "start": "2484420",
    "end": "2490300"
  },
  {
    "text": "Trace collection or really any hierarchical data",
    "start": "2490300",
    "end": "2495180"
  },
  {
    "text": "here I've drawn the Linux events that you can measure to any of these I can do a stack I can do a stack trace for I can",
    "start": "2495940",
    "end": "2501940"
  },
  {
    "text": "do a flame graph the disk IO Network i o Hardware events like cache misses and so on",
    "start": "2501940",
    "end": "2508920"
  },
  {
    "text": "some of the flame graphs people using do memory allocation flame graphs I like to do it this way instead page faults if",
    "start": "2509680",
    "end": "2516820"
  },
  {
    "text": "you do memory allocation flame graphs by tracing the allocation function that can happen a million times a second or 10",
    "start": "2516820",
    "end": "2522579"
  },
  {
    "text": "million times a second and so it can become super expensive to gather all of those stack traces page faults happen",
    "start": "2522579",
    "end": "2529180"
  },
  {
    "text": "when your RSS grows your resin set size and so that's a very infrequent activity",
    "start": "2529180",
    "end": "2534400"
  },
  {
    "text": "it might happen five times a minute and so it's a very it gives you a coarse",
    "start": "2534400",
    "end": "2539859"
  },
  {
    "text": "idea of why you might have a memory leak or memory growth but what's nice about it is the overhead is basically zero so",
    "start": "2539859",
    "end": "2547300"
  },
  {
    "text": "a page fault flame graph like if you're looking at top it shows you why that res column is growing it's like oh here's",
    "start": "2547300",
    "end": "2553780"
  },
  {
    "text": "the here's my code of why it's growing you have to collect it for a long time though at least two minutes",
    "start": "2553780",
    "end": "2558940"
  },
  {
    "text": "you can't do any memory so they've done drawn a diagram of how memory allocation works on demand based operating systems",
    "start": "2558940",
    "end": "2565900"
  },
  {
    "text": "which most are these days so you can you can trace the allocated functions they can be high overhead that's why I like",
    "start": "2565900",
    "end": "2572560"
  },
  {
    "text": "to go into the Heap into page faults when we're going into the mmu because",
    "start": "2572560",
    "end": "2578920"
  },
  {
    "text": "the operating system lies to applications and says yeah sure I've I've mallicked that memory but it hasn't",
    "start": "2578920",
    "end": "2583960"
  },
  {
    "text": "only when you later do loads and stores or stores to start with you'll fault",
    "start": "2583960",
    "end": "2589720"
  },
  {
    "text": "through the memory management unit so that that's a indication of growth",
    "start": "2589720",
    "end": "2595540"
  },
  {
    "text": "you could do disk IO flame graphs but do pick the",
    "start": "2595540",
    "end": "2600880"
  },
  {
    "text": "there's a lot of disk events that are not synchronous with the code so on completions they aren't so you need to",
    "start": "2600880",
    "end": "2606400"
  },
  {
    "text": "pick when you're issuing Disco contact switches when you're blocking",
    "start": "2606400",
    "end": "2612400"
  },
  {
    "text": "and going off CPU that can be useful I was at one point I did it to to look at the difference between IX and Eddie and",
    "start": "2612400",
    "end": "2618700"
  },
  {
    "text": "Tomcat so epul versus cispo TCP events has another issue about a",
    "start": "2618700",
    "end": "2625720"
  },
  {
    "text": "asynchronous but you can do TCP sends as a flame graph I've got the instructions and slides so you can see why I'm",
    "start": "2625720",
    "end": "2631900"
  },
  {
    "text": "calling networking cache misses I can do Hardware style",
    "start": "2631900",
    "end": "2637300"
  },
  {
    "text": "things you do need this if you're on Intel you need pebs for IP accuracy precise event",
    "start": "2637300",
    "end": "2643599"
  },
  {
    "text": "based sampling CPI flame graph I'm taking the",
    "start": "2643599",
    "end": "2648700"
  },
  {
    "text": "differential palette but I'm showing you where your CPU hot versus memory hot using red and blue",
    "start": "2648700",
    "end": "2656880"
  },
  {
    "text": "and then off CPU flame graph which solves everything that's not CPU time CPU time is in pink enough CPU time",
    "start": "2657460",
    "end": "2664300"
  },
  {
    "text": "is in blue there's an example of CPU flame graph I change the colors just to make that",
    "start": "2664300",
    "end": "2669880"
  },
  {
    "text": "point and if you zoom in in this case I've got the tar disk archiver I can see how much",
    "start": "2669880",
    "end": "2675940"
  },
  {
    "text": "time am I reading from disk file reading from disk doing fstat and other things",
    "start": "2675940",
    "end": "2681220"
  },
  {
    "text": "this is a great complement complement to CPU profiling as you get to get to the bottom of all your performance issues",
    "start": "2681220",
    "end": "2689319"
  },
  {
    "text": "see everything if you do both sleep enough CPU flame graphs there I did them both in One Flame graph",
    "start": "2689319",
    "end": "2695680"
  },
  {
    "text": "which sort of works off CP flame graphs can dominate because you have so much time waiting",
    "start": "2695680",
    "end": "2702520"
  },
  {
    "text": "there is another Advanced one I created called off wait time frame graphs because often if you do an off-cb flame",
    "start": "2702520",
    "end": "2708040"
  },
  {
    "text": "graph you find you're blocked on a lock or you're blocked on pulling it's like that's not enough information to",
    "start": "2708040",
    "end": "2713859"
  },
  {
    "text": "understand what's wrong you need to know the Waker thread and its stack Trace why was that lock held for so long that I",
    "start": "2713859",
    "end": "2720640"
  },
  {
    "text": "was blocked and so in this example I have a weaker stack and I paste it on top to explain it",
    "start": "2720640",
    "end": "2726040"
  },
  {
    "text": "and you can keep going all the way to metal so I can chain them and I can do all the weaker Stacks that led to that",
    "start": "2726040",
    "end": "2732819"
  },
  {
    "text": "path blocking um this is still a work in progress though because it's a lot of overhead to capture all of the stack",
    "start": "2732819",
    "end": "2738220"
  },
  {
    "text": "traces flame scope I did mention earlier is",
    "start": "2738220",
    "end": "2744339"
  },
  {
    "text": "another Advanced thing that's where I print a subsequent offset heat map so",
    "start": "2744339",
    "end": "2749380"
  },
  {
    "text": "you can this paints samples from bottom to top one second is a column and the",
    "start": "2749380",
    "end": "2754900"
  },
  {
    "text": "color depth is how many samples are in that second that way you can see issues of variations and perturbations within a",
    "start": "2754900",
    "end": "2760960"
  },
  {
    "text": "second and you can highlight them and it'll give you a flame graph just for that range and so we open source that",
    "start": "2760960",
    "end": "2766599"
  },
  {
    "text": "but it's another Advanced thing you should be using once you've got flame graphs working now you want to the",
    "start": "2766599",
    "end": "2772240"
  },
  {
    "text": "problem with flame graphs is they can be say a 30 second average you want to know what happened within the second or fractions of a second and so I found",
    "start": "2772240",
    "end": "2779140"
  },
  {
    "text": "that was quite an effective approach and here's a plain graph example where",
    "start": "2779140",
    "end": "2784660"
  },
  {
    "text": "there's all these patterns so this diagonal line is from when you have a thread that's waking up every",
    "start": "2784660",
    "end": "2790060"
  },
  {
    "text": "second and doing a little bit of work but then it's blocking for an entire second and so you get that offset and",
    "start": "2790060",
    "end": "2795880"
  },
  {
    "text": "then I've got these Stripes that are appearing it's probably garbage collection I can see these horizontal lines from threads that are waking up",
    "start": "2795880",
    "end": "2803140"
  },
  {
    "text": "and doing little work or they're using a different timer so they're always waking up at the same offset",
    "start": "2803140",
    "end": "2809338"
  },
  {
    "text": "so that's some Advanced line graphs it's an agenda recap I went through implementation CP flame graphs some",
    "start": "2810160",
    "end": "2816040"
  },
  {
    "text": "challenges and some ideas for future work",
    "start": "2816040",
    "end": "2820980"
  },
  {
    "start": "2820000",
    "end": "2832000"
  },
  {
    "text": "you can look at the slides to how to interpret CP flying graphs and hopefully you've learned that understand some",
    "start": "2821319",
    "end": "2826900"
  },
  {
    "text": "challenges and ebpf is necessary for these Advanced flame graphs for efficiency",
    "start": "2826900",
    "end": "2833319"
  },
  {
    "start": "2832000",
    "end": "2852000"
  },
  {
    "text": "the site has lots of links and references and thank you we have some time for",
    "start": "2833319",
    "end": "2839079"
  },
  {
    "text": "questions",
    "start": "2839079",
    "end": "2841319"
  },
  {
    "text": "[Applause] does anyone have any questions",
    "start": "2844150",
    "end": "2850540"
  },
  {
    "text": "this one",
    "start": "2850540",
    "end": "2853200"
  },
  {
    "start": "2852000",
    "end": "2977000"
  },
  {
    "text": "uh have you seen many examples of teams incorporating flame graphs into their",
    "start": "2856960",
    "end": "2862900"
  },
  {
    "text": "continuous integration build processes to be continuously showing a current",
    "start": "2862900",
    "end": "2868000"
  },
  {
    "text": "flame graph for a given branch of the system yes absolutely so for continuous",
    "start": "2868000",
    "end": "2873700"
  },
  {
    "text": "integration Jenkins and other things it it's great because you'll have regressions and then you straight away",
    "start": "2873700",
    "end": "2880960"
  },
  {
    "text": "have the flame graph to explain the regressions also companies have say uh automated micro benchmarking so it will",
    "start": "2880960",
    "end": "2887920"
  },
  {
    "text": "it will do a benchmark every night of this code base again you include a flame graph with it because when you have the",
    "start": "2887920",
    "end": "2894280"
  },
  {
    "text": "the difference the first thing you want to see is the flame ground it's like why do I have the different and now I know I have a difference why do I have a",
    "start": "2894280",
    "end": "2899920"
  },
  {
    "text": "difference absolutely should include it if you if you're managing that stuff there's heaps of Open Source options all",
    "start": "2899920",
    "end": "2906640"
  },
  {
    "text": "those commercial options go for it",
    "start": "2906640",
    "end": "2910619"
  },
  {
    "text": "are there any good tricks for recognizing whether you have the sort of synchronous problem you know you",
    "start": "2914400",
    "end": "2919900"
  },
  {
    "text": "mentioned 100 101 Hertz 99 Hertz",
    "start": "2919900",
    "end": "2924720"
  },
  {
    "text": "recognizing that problem uh recognizing the lockstep sampling issue um I don't know I haven't really spent",
    "start": "2925060",
    "end": "2930940"
  },
  {
    "text": "much time on it so maybe you can come up with something if you think you have it I never do like 100 Hertz sampling I'm",
    "start": "2930940",
    "end": "2936819"
  },
  {
    "text": "always doing 99 Hertz sampling flame scope is great because with flame",
    "start": "2936819",
    "end": "2941980"
  },
  {
    "text": "scope you can see the there are some periodic things and you can control how many rows you have so these horizontal",
    "start": "2941980",
    "end": "2949060"
  },
  {
    "text": "lines maybe it's multiple threads or maybe a threads waking up 10 times a second there's a line for each wake up",
    "start": "2949060",
    "end": "2954460"
  },
  {
    "text": "and so that might be I would use this as an approach to try and look for periodic activity",
    "start": "2954460",
    "end": "2960480"
  },
  {
    "text": "thank you Brendan that's all we have time for thanks very much for that talk Brendan today and Brendan's available in",
    "start": "2961300",
    "end": "2967720"
  },
  {
    "text": "the exhibition area through the day and probably tomorrow as well thanks again",
    "start": "2967720",
    "end": "2972880"
  },
  {
    "text": "to Brendan [Applause]",
    "start": "2972880",
    "end": "2977749"
  }
]