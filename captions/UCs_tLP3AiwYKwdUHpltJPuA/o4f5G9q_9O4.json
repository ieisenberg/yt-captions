[
  {
    "text": "[Music]",
    "start": "980",
    "end": "7849"
  },
  {
    "text": "all right thank you so much can you hear me okay great and as I was instructed getting through",
    "start": "14889",
    "end": "21710"
  },
  {
    "text": "our first slide there yeah so my name is Keith I work at slack I've been there for about two and a half years and today",
    "start": "21710",
    "end": "27920"
  },
  {
    "text": "it's gonna be my honor to talk about a bunch of the work that some of the hundreds of brilliant engineers at slack",
    "start": "27920",
    "end": "33769"
  },
  {
    "text": "I've done together with me it's always or at least very often my pleasure to be",
    "start": "33769",
    "end": "40000"
  },
  {
    "text": "presenting group work on behalf of slack but I really want to especially emphasize that the systems and ideas",
    "start": "40000",
    "end": "46820"
  },
  {
    "text": "that I'm presenting here today are you know a joint work with with my colleagues I couldn't do this by myself",
    "start": "46820",
    "end": "53530"
  },
  {
    "text": "so we start off with a twist I'm going to try to convince you that slack can't work that there's actually no way for it",
    "start": "53530",
    "end": "59360"
  },
  {
    "text": "to work at all I will resolve that twist by explaining why it does even though it apparently can't we'll try to ground",
    "start": "59360",
    "end": "65720"
  },
  {
    "text": "those abstractions in reality into major ways we'll go kind of deep into two different flows in slack and talk about",
    "start": "65720",
    "end": "72290"
  },
  {
    "text": "how they've changed as a slack has grown and hopefully if any of you find",
    "start": "72290",
    "end": "77690"
  },
  {
    "text": "yourselves in the boat of working on something that's hyper scaling will have some takeaways for you so I guess my",
    "start": "77690",
    "end": "85790"
  },
  {
    "text": "thunder got stolen here a little bit in the intro I guess a lot of you use slack but very briefly it's a persistent",
    "start": "85790",
    "end": "91880"
  },
  {
    "text": "messaging application it's the market leader in this category right now there are kind of three really obvious",
    "start": "91880",
    "end": "97850"
  },
  {
    "text": "abstractions that are hard to say anything about slack without talking about which is there are users these are",
    "start": "97850",
    "end": "103430"
  },
  {
    "text": "send one another messages and they do so in channels and channels are this different thing for you know an",
    "start": "103430",
    "end": "110240"
  },
  {
    "text": "abstraction that's new with slack it's basically a combination of a subject line and audience right so you don't",
    "start": "110240",
    "end": "116210"
  },
  {
    "text": "write a two line you don't write our realign you just choose a channel and whenever this comes up on Hacker News",
    "start": "116210",
    "end": "123170"
  },
  {
    "text": "sort of most of the ink spilled in the comments is about how this is just IRC I whenever that happens always wonder if",
    "start": "123170",
    "end": "128989"
  },
  {
    "text": "people have actually used IRC before like I actually spent thousands of hours of my life in IRC and it's hard to",
    "start": "128989",
    "end": "134840"
  },
  {
    "text": "imagine an experience of the Internet that's as different from slack as IRC it is pixal why is a screen dump looks kind of",
    "start": "134840",
    "end": "141560"
  },
  {
    "text": "similar like the us vaguely resemble each other but everything about IRC is about how ephemeral everything is right if you",
    "start": "141560",
    "end": "147410"
  },
  {
    "text": "weren't in the channel when it was said it wasn't said to you and slack is on the opposite end of the spectrum or at",
    "start": "147410",
    "end": "153620"
  },
  {
    "text": "the entire point of slack is that it's persistent by default it can be searched it can be archived if it wasn't online I",
    "start": "153620",
    "end": "160100"
  },
  {
    "text": "can catch up tomorrow and see what I missed so there's some of the same abstractions but by putting persistence",
    "start": "160100",
    "end": "166670"
  },
  {
    "text": "in that mix you change everything up it turns out and so let's see we can",
    "start": "166670",
    "end": "171680"
  },
  {
    "text": "formalize a little bit and talk about what we mean by persistence here right what is it what properties does a",
    "start": "171680",
    "end": "176870"
  },
  {
    "text": "channel need to have let's say that slack doesn't exist yet we decided we want to create it and we'd like to come",
    "start": "176870",
    "end": "183290"
  },
  {
    "text": "up with some minimal definition of what getting the persistence layer of this thing right would be like so for",
    "start": "183290",
    "end": "190730"
  },
  {
    "text": "starters we'd like you to be the case that you know what messages are in the channel right so if I send something and",
    "start": "190730",
    "end": "197330"
  },
  {
    "text": "my UI makes it look like it's sent then all the members are received it or at least are capable of receiving it and",
    "start": "197330",
    "end": "202459"
  },
  {
    "text": "similarly if I didn't send something but it shows up in the channel I pretty",
    "start": "202459",
    "end": "207590"
  },
  {
    "text": "confident the whole rest of the audience of the channel sees it that's that first sort of validity agreement property this",
    "start": "207590",
    "end": "213230"
  },
  {
    "text": "integrity one sounds a little funny but basically says the system doesn't hallucinate messages write the messages all originate from actual send",
    "start": "213230",
    "end": "219680"
  },
  {
    "text": "operations and finally we agree about the order of these things right they all happen you know if I saw a then B I know",
    "start": "219680",
    "end": "226700"
  },
  {
    "text": "that you're not going to see B then a and I think it's pretty hard to convince her so that you can make anything that",
    "start": "226700",
    "end": "233239"
  },
  {
    "text": "resembles Locke that's actually useful that doesn't at least meet these characteristics right this is pretty much of a minimum viable persistent chat",
    "start": "233239",
    "end": "240140"
  },
  {
    "text": "product does anybody see any problems with this set of requirements by chance",
    "start": "240140",
    "end": "245200"
  },
  {
    "text": "yeah what's that",
    "start": "245200",
    "end": "251440"
  },
  {
    "text": "well let me okay so let me admit how I actually came up with this right I didn't actually come up with this definition from old slack product",
    "start": "252060",
    "end": "258519"
  },
  {
    "text": "documents this is actually a loose rephrasing of the Wikipedia definition of atomic broadcast so if you never",
    "start": "258519",
    "end": "265180"
  },
  {
    "text": "heard of this atomic broadcast is this long studied problem in Canadian distributed systems and slack aren't the",
    "start": "265180",
    "end": "271840"
  },
  {
    "text": "first people to think of this in fact we you know the first time you've got two computers and you string a wire between",
    "start": "271840",
    "end": "277120"
  },
  {
    "text": "them it occurs to you gosh it sure would be nice if I could share a log between these things and if it had these",
    "start": "277120",
    "end": "282280"
  },
  {
    "text": "properties right and you know computer programmers being the optimists that we",
    "start": "282280",
    "end": "287320"
  },
  {
    "text": "are people go off and try to do this and they find it really really hard and really counter-intuitively hard and in",
    "start": "287320",
    "end": "293890"
  },
  {
    "text": "fact there's there's a reason they find it hard you can't do it atomic broadcast turns out to be",
    "start": "293890",
    "end": "299740"
  },
  {
    "text": "equivalent to another problem in distributed systems called consensus that's even more widely studied and",
    "start": "299740",
    "end": "305560"
  },
  {
    "text": "consensus is the thing you can't do if you're working with systems that fail and network connections that fail and",
    "start": "305560",
    "end": "310690"
  },
  {
    "text": "things that come online and go offline you can't in general solve consensus so",
    "start": "310690",
    "end": "317500"
  },
  {
    "text": "it's actually gonna be a real short talk here you know that's it it turns out slack didn't work all along you know I",
    "start": "317500",
    "end": "324310"
  },
  {
    "text": "know I know C++ if you guys are hiring I guess I'll just see in back later on too",
    "start": "324310",
    "end": "331270"
  },
  {
    "text": "bad we delved into the CS theory here right no of course not yeah we're kidding in practice there are plenty of",
    "start": "331270",
    "end": "339190"
  },
  {
    "text": "useful consensus systems around and the way that you get a real-world useful consensus system is that in some way or",
    "start": "339190",
    "end": "344979"
  },
  {
    "text": "another you jiggler all the constraints so that you're able to slip through a crack in them",
    "start": "344979",
    "end": "349990"
  },
  {
    "text": "right it's a I actually have more than one example of this now thanks the last",
    "start": "349990",
    "end": "355870"
  },
  {
    "text": "couple years cryptocurrencies right which are built on top of block chains they're attempting to sort of solve some",
    "start": "355870",
    "end": "361900"
  },
  {
    "text": "version of consensus they're creating a replicated log that everybody agrees in the contents of the big relaxation they",
    "start": "361900",
    "end": "367600"
  },
  {
    "text": "found arguably is that their notion of receipt of message is probabilistic right it's always possible no matter how",
    "start": "367600",
    "end": "374020"
  },
  {
    "text": "long I've had my blockchain lying around but somewhere out there is a longer blockchain that represents more proof of",
    "start": "374020",
    "end": "379180"
  },
  {
    "text": "work and that makes me go back and rewrite in my history right and that sort of cheats",
    "start": "379180",
    "end": "384310"
  },
  {
    "text": "a little bit on the rules of consensus but in practice who cares there are also",
    "start": "384310",
    "end": "390370"
  },
  {
    "text": "a bunch of systems that are used in large-scale systems there in the paxos family of algorithms so taxes zookeeper",
    "start": "390370",
    "end": "397060"
  },
  {
    "text": "atomic broadcast protocol these days people are in a raft I think of these things as all being relatively similar",
    "start": "397060",
    "end": "402699"
  },
  {
    "text": "there are applicable to similar families of problems and all of them basically relax the constraint that they might",
    "start": "402699",
    "end": "408880"
  },
  {
    "text": "take forever to run and if you had a daemon who is running around cutting network cables trying to make you make",
    "start": "408880",
    "end": "414940"
  },
  {
    "text": "your message send operation take a long time you have no guarantee that it's gonna actually converge but in practice",
    "start": "414940",
    "end": "420010"
  },
  {
    "text": "that's not how things fail things don't fail because you've got some adversary running around creating failures they",
    "start": "420010",
    "end": "425260"
  },
  {
    "text": "fail in a more random way cool so this",
    "start": "425260",
    "end": "431260"
  },
  {
    "text": "process of like deciding what constraint you're going to relax is a great example in my mind of an end-to-end property of",
    "start": "431260",
    "end": "436539"
  },
  {
    "text": "systems if you've never read this paper by Seltzer reading Clarke and and arguments and system design I highly",
    "start": "436539",
    "end": "442660"
  },
  {
    "text": "recommend it it's really old probably older than many of the the folks in the audience here just scanning around and",
    "start": "442660",
    "end": "449919"
  },
  {
    "text": "it observed early on that it's really hard sometimes to provide strong low-level semantic guarantees in a",
    "start": "449919",
    "end": "457360"
  },
  {
    "text": "network layer or a storage layer but you can often provide those semantics that",
    "start": "457360",
    "end": "462789"
  },
  {
    "text": "you want by pushing the heavy duty lifting out to the edges of the application right out to a client and a",
    "start": "462789",
    "end": "468460"
  },
  {
    "text": "server that knows everything about the guarantees they're actually going to give you the set of constraints that",
    "start": "468460",
    "end": "476320"
  },
  {
    "text": "you're gonna relax are going to vary by what you're actually trying to do with this system and what you're trying to do",
    "start": "476320",
    "end": "481900"
  },
  {
    "text": "with this system is always kind of a function of how people actually use it and the technological environment you're",
    "start": "481900",
    "end": "487120"
  },
  {
    "text": "in right how expensive hard disks are how high bandwidth and low latency networks are if you suddenly want to set",
    "start": "487120",
    "end": "493570"
  },
  {
    "text": "up a point of presence on the other side of the world all the latency is change and so on so this is a source of kind of ongoing",
    "start": "493570",
    "end": "499300"
  },
  {
    "text": "work that you never quite completely solve and that's been our experience at slack especially with message delivery",
    "start": "499300",
    "end": "506580"
  },
  {
    "text": "so that all sounds SuperDuper abstract so let's try and ground this in something a little more real-world and",
    "start": "507950",
    "end": "515150"
  },
  {
    "text": "in the case of slack let's make the most concrete basic interaction possible the first workflow that you've got to make",
    "start": "515150",
    "end": "521000"
  },
  {
    "text": "possible which is reading and writing messages to be able to talk about this",
    "start": "521000",
    "end": "527990"
  },
  {
    "text": "I'm going to need to use a highly simplified model of how slack works and so ignoring you know dozens of layers of",
    "start": "527990",
    "end": "536510"
  },
  {
    "text": "load balancers and DNS and other services that aren't relevant to the",
    "start": "536510",
    "end": "541790"
  },
  {
    "text": "thing we're talking about here and so forth you can think of this of the sort of client surface that we touch is",
    "start": "541790",
    "end": "547040"
  },
  {
    "text": "consisting of two big piles of stuff there's a web app which is a restful api around around a classic lamp stack app",
    "start": "547040",
    "end": "555200"
  },
  {
    "text": "basically and the channel server which is the real-time message bus if you're",
    "start": "555200",
    "end": "561920"
  },
  {
    "text": "curious about some of the dynamics here web app is a million line hackling of",
    "start": "561920",
    "end": "567500"
  },
  {
    "text": "monolith right hackling is by the way Facebook's gradual typing system for PHP this is a grown-up lamp stack app and",
    "start": "567500",
    "end": "574610"
  },
  {
    "text": "this is a monolith you know this is you know you're your parents monolith it does authentication it knows where",
    "start": "574610",
    "end": "581270"
  },
  {
    "text": "storage lives it has all the actual logic that governs you know if I'm a user of the third type and I've created",
    "start": "581270",
    "end": "587390"
  },
  {
    "text": "a file of the second type and you're a user of the second type can you do XY and Z to it and so forth it's also",
    "start": "587390",
    "end": "593540"
  },
  {
    "text": "involved in session establishment as we'll see on the other side of things written in Java if you're curious as a",
    "start": "593540",
    "end": "600140"
  },
  {
    "text": "system I'm going to call channel server and this is our real time message bus it",
    "start": "600140",
    "end": "605480"
  },
  {
    "text": "does the the push operations that actually makes Lac feel real-time right so that's not driven by pulling off of",
    "start": "605480",
    "end": "611090"
  },
  {
    "text": "the web app that's driven by actual server pushes over connections to channel server when you think of it you",
    "start": "611090",
    "end": "618050"
  },
  {
    "text": "immediately think of messages but there's a lot of other traffic going on over that bus so things like typing",
    "start": "618050",
    "end": "623270"
  },
  {
    "text": "indicators when you open your laptop in the morning your presence indicator blips on and off it's also the arbiter",
    "start": "623270",
    "end": "631310"
  },
  {
    "text": "of the order of messages the total order property that you pointed out we're going to derive the total order of messages by the order that the channel",
    "start": "631310",
    "end": "637640"
  },
  {
    "text": "server witnesses the message is coming through and has a whole bunch of other stuff that it does so so notice that I'm calling it a",
    "start": "637640",
    "end": "643790"
  },
  {
    "text": "service not a micro service at this time all right cool so we're gonna walk",
    "start": "643790",
    "end": "650120"
  },
  {
    "text": "through a little timeline here this is going we've got the time axis running along the x-axis here as its horizontal",
    "start": "650120",
    "end": "655610"
  },
  {
    "text": "from left to right and we're gonna represent message sends with balls and arrows so we've got client a trying to",
    "start": "655610",
    "end": "663380"
  },
  {
    "text": "send and client B is just a logged in client that's passively sitting there",
    "start": "663380",
    "end": "668770"
  },
  {
    "text": "the sends initiated in the middle of one of these sessions by client a of sending a message to the channel server the",
    "start": "669730",
    "end": "679490"
  },
  {
    "text": "channel server's job is then to cascade that message out to the other connected clients and that looks really simple when there's only one other connected",
    "start": "679490",
    "end": "685520"
  },
  {
    "text": "client but we have customers with hundreds of thousands of connected clients so it actually might be quite complicated there might be a whole tree",
    "start": "685520",
    "end": "692480"
  },
  {
    "text": "if of things making sure that that message gets delivered and then eventually tells client a okay I sent",
    "start": "692480",
    "end": "698870"
  },
  {
    "text": "your message of it to some places and that's from the users point of view",
    "start": "698870",
    "end": "704780"
  },
  {
    "text": "that's all the time that this operation takes right if you and I are users of slack sitting there looking at each",
    "start": "704780",
    "end": "709970"
  },
  {
    "text": "other's at each other's machines I see the black message in channel you see the",
    "start": "709970",
    "end": "715640"
  },
  {
    "text": "black message in channel and all the time consuming stuff I'm about to talk about is hidden from us channel server",
    "start": "715640",
    "end": "724640"
  },
  {
    "text": "behind our back then goes and does a side call to web app I it hits a internal API inside a web app for just",
    "start": "724640",
    "end": "730970"
  },
  {
    "text": "this purpose and that hides all the latency of parsing the message finding",
    "start": "730970",
    "end": "736460"
  },
  {
    "text": "the URLs in it unfurling the urls in it preparing it to be indexed in search actually indexing it in search probably",
    "start": "736460",
    "end": "742850"
  },
  {
    "text": "lots of other things I'm forgetting mentions so under normal conditions this",
    "start": "742850",
    "end": "751340"
  },
  {
    "text": "seems pretty cool a kind of foundational product belief at slack is that we want",
    "start": "751340",
    "end": "756740"
  },
  {
    "text": "the text interaction to be really really smooth we want that to be really low latency that that's one of the things",
    "start": "756740",
    "end": "762080"
  },
  {
    "text": "that makes a session feel good so we've really successfully minimized the",
    "start": "762080",
    "end": "767150"
  },
  {
    "text": "latency here well what if something doesn't go according to plan as will eventually happen",
    "start": "767150",
    "end": "775690"
  },
  {
    "text": "we are humans we write buggy software and sometimes we write those bugs in our channel server so the CS might crash and",
    "start": "775820",
    "end": "782390"
  },
  {
    "text": "for instance it might crash before we've actually persisted the message but after we've told clients yes we've sent this message we also",
    "start": "782390",
    "end": "793220"
  },
  {
    "text": "write buggy code in web app so sometimes web app is down hard for long periods of time or a network partition prevents a",
    "start": "793220",
    "end": "799730"
  },
  {
    "text": "channel server from being able to reach web app or what have you and so it could be the case that we fail therefore in a different set but in a",
    "start": "799730",
    "end": "806900"
  },
  {
    "text": "different part of the system and these are two kind of conceptually different problems but they both stem from this attempt to defer work and the fact that",
    "start": "806900",
    "end": "813770"
  },
  {
    "text": "we're acknowledging the right before we've actually put in stable storage and",
    "start": "813770",
    "end": "819200"
  },
  {
    "text": "so this leads to a bunch of complexity concretely the complexity is that CS has",
    "start": "819200",
    "end": "824750"
  },
  {
    "text": "a persistent buffer of unsent messages messages that it has committed to sending but hasn't put in stable storage",
    "start": "824750",
    "end": "830300"
  },
  {
    "text": "yet so if CS crashes and recovers CS",
    "start": "830300",
    "end": "835940"
  },
  {
    "text": "will come up look at its little on disk buffer and try to do whatever work was still pending if web app is down or dead the Sun",
    "start": "835940",
    "end": "844160"
  },
  {
    "text": "hasn't succeeded yet CS is going to keep retrying those over and over again it's forced to serialize those to keep the",
    "start": "844160",
    "end": "850580"
  },
  {
    "text": "total order by the way so it's not retrying n of them it's retrying one per channel and this state leads to a bunch",
    "start": "850580",
    "end": "859250"
  },
  {
    "text": "of trouble right so state typically is involved it means complexity it does in this case as well all the nice things",
    "start": "859250",
    "end": "866360"
  },
  {
    "text": "that come from having a stateless service aren't available to us right we can't push code anytime we want to it's",
    "start": "866360",
    "end": "871400"
  },
  {
    "text": "tough to rebalance load we have two kind of capacity plan these things fairly carefully we also take operational risks",
    "start": "871400",
    "end": "876980"
  },
  {
    "text": "when we do changes to the channel server and have to push new versions of it but",
    "start": "876980",
    "end": "882140"
  },
  {
    "text": "there's this one great thing about it that actually used to be really important which is if web app is down",
    "start": "882140",
    "end": "887810"
  },
  {
    "text": "and it's down for an hour or something parts of slack still kind of work right",
    "start": "887810",
    "end": "893720"
  },
  {
    "text": "you can still kind of read some messages and sense of messages and read the messages you sent and stuff even though",
    "start": "893720",
    "end": "900320"
  },
  {
    "text": "most of the app logic is entirely unreachable and that's a little kind of",
    "start": "900320",
    "end": "906770"
  },
  {
    "text": "a strange fact you can't do searches you can't login you know you can't react you there's all kinds of things in select that you can't do but some of the",
    "start": "906770",
    "end": "913250"
  },
  {
    "text": "core text interaction is still preserved so it has a nice degredation mode for",
    "start": "913250",
    "end": "919580"
  },
  {
    "text": "these failures so this was you know kind of architected and built in the early",
    "start": "919580",
    "end": "924800"
  },
  {
    "text": "days of slack and in the four years since a bunch of things have changed probably the biggest of which is just",
    "start": "924800",
    "end": "929870"
  },
  {
    "text": "that we don't usually have our web servers unavailable for hours at a time anymore also the web servers have their",
    "start": "929870",
    "end": "937970"
  },
  {
    "text": "own method for deferring work which we you know kind of unimaginative Lee called the job queue it's not really a",
    "start": "937970",
    "end": "944120"
  },
  {
    "text": "queue it's just a pile of jobs but anyway that system is actually much more",
    "start": "944120",
    "end": "949970"
  },
  {
    "text": "reliable and much more high capacity than it used to be we have an engineering blog post up about the story",
    "start": "949970",
    "end": "955010"
  },
  {
    "text": "of kind of migrating from yesterday's dangerous scary job queue to today is much more reliable one if you're curious",
    "start": "955010",
    "end": "961220"
  },
  {
    "text": "about the details of that it involves Kafka people like talking about Kafka these days so that's a little bit of",
    "start": "961220",
    "end": "966350"
  },
  {
    "text": "bait for the engineering blog post if you'd like so all this has enabled us to",
    "start": "966350",
    "end": "973339"
  },
  {
    "text": "have a new send flow the new send flow kicks off with an HTTP POST to the web app to an endpoint called a chat post",
    "start": "973339",
    "end": "980390"
  },
  {
    "text": "message and chat that post message first defers everything right I didn't cues a",
    "start": "980390",
    "end": "987200"
  },
  {
    "text": "job queue job that's going to do the persistence and the parsing of the message and the finding of the URLs and",
    "start": "987200",
    "end": "992360"
  },
  {
    "text": "all the work associated with mentions and indexing for search and so on and so forth it then does or you know invokes",
    "start": "992360",
    "end": "1001570"
  },
  {
    "text": "the channel server to do its job right so it sort of sets off the Cascade of in this diagram too but possibly hundreds",
    "start": "1001570",
    "end": "1008410"
  },
  {
    "text": "of thousands of real-time messages getting pushed out there and once that is done user perceivable",
    "start": "1008410",
    "end": "1016630"
  },
  {
    "text": "latency is is done right all the rest of the work is still deferred in exactly the same way including even returning",
    "start": "1016630",
    "end": "1023620"
  },
  {
    "text": "from that post message endpoint right the client is free to just fork that off in the background once it's actually seen the message come over its WebSocket",
    "start": "1023620",
    "end": "1032910"
  },
  {
    "text": "so this is beyond the scope of this presentation to prove but this is",
    "start": "1033000",
    "end": "1038800"
  },
  {
    "text": "actually naturally crash safe or if you try to kill any of the participants in this at any points in the hand-off",
    "start": "1038800",
    "end": "1044870"
  },
  {
    "text": "either sort of rolls forward into a state where eventually the messages are persisted and the channel messages go",
    "start": "1044870",
    "end": "1050809"
  },
  {
    "text": "out or it rolls backward into a state where the Sen fails and that gets bubbled all the way up to a slack client",
    "start": "1050809",
    "end": "1057110"
  },
  {
    "text": "so if you've ever done a send especially on mobile because people's networks are coming and going on mobile a lot if",
    "start": "1057110",
    "end": "1062929"
  },
  {
    "text": "you've ever done a send where's Locke says oops I couldn't send the message do you want me to delete or retry that's",
    "start": "1062929",
    "end": "1068150"
  },
  {
    "text": "the kind of failure mode that you'd have where you you roll back we've maintained",
    "start": "1068150",
    "end": "1074059"
  },
  {
    "text": "most of a low latency of the previous send because all the hard parts are still deferred and we have the the",
    "start": "1074059",
    "end": "1080000"
  },
  {
    "text": "benefit of making CS stateless now and there's another subtle benefit with this too which is that we do this over a",
    "start": "1080000",
    "end": "1085820"
  },
  {
    "text": "regular HTTP POST we don't actually have to set up a WebSocket connection to be able to send it now and as we'll see in",
    "start": "1085820",
    "end": "1093169"
  },
  {
    "text": "a few slides setting up one of those sessions actually can be pretty complicated so this can be a benefit if",
    "start": "1093169",
    "end": "1099080"
  },
  {
    "text": "you're like in a mobile context and you're replying to notification you could send that message without having to sort of set up a full heavyweight",
    "start": "1099080",
    "end": "1105080"
  },
  {
    "text": "slack session so that's a nice option ality to have so that old way is bad and",
    "start": "1105080",
    "end": "1113150"
  },
  {
    "text": "this new way is right and that's the end of history right it sure looks that way",
    "start": "1113150",
    "end": "1119630"
  },
  {
    "text": "right now this new flow that I'm talking about by the way isn't a hundred percent launched it's out to a large percentage",
    "start": "1119630",
    "end": "1126590"
  },
  {
    "text": "of free teams paid customers are still on the old flow we want to get some more confidence in the new flow before we go",
    "start": "1126590",
    "end": "1133669"
  },
  {
    "text": "to a hundred percent on it but it sure looks like it's the right direction for where things are at right now that",
    "start": "1133669",
    "end": "1139700"
  },
  {
    "text": "doesn't make the flow from before wrong per se right the flow from before still does what it says on the outside of the",
    "start": "1139700",
    "end": "1145520"
  },
  {
    "text": "box in the sense that it gets almost all the messages almost all the places almost all the time we have added an",
    "start": "1145520",
    "end": "1152419"
  },
  {
    "text": "extra hop right if you really are counting Network hops here there is a transition from the web app to the",
    "start": "1152419",
    "end": "1157880"
  },
  {
    "text": "channel server that wasn't there before and also web apps availability was a",
    "start": "1157880",
    "end": "1163039"
  },
  {
    "text": "real problem back then we didn't have as good automated testing on web app we didn't have as good operational",
    "start": "1163039",
    "end": "1168919"
  },
  {
    "text": "experience with running a big scale that website and so there were periods where web app was down and having",
    "start": "1168919",
    "end": "1174350"
  },
  {
    "text": "some degraded mode of operation was really important and I mentioned the job queue needs to work a lot better before",
    "start": "1174350",
    "end": "1180350"
  },
  {
    "text": "you're gonna trust all the functionality on slack on top of it cool unfortunately",
    "start": "1180350",
    "end": "1189049"
  },
  {
    "text": "you need a case study one for this one to make any sense at all so thank you for your patience now I want to talk about how you actually start a session",
    "start": "1189049",
    "end": "1195679"
  },
  {
    "text": "on slack and this gets into sort of some that tends to be different from other",
    "start": "1195679",
    "end": "1201590"
  },
  {
    "text": "applications which is that from a in terms of our actual client-server interaction it's not just a bunch of web",
    "start": "1201590",
    "end": "1207350"
  },
  {
    "text": "requests there's also a connection orientation that's inherent in the problem space so WebSockets the enabling",
    "start": "1207350",
    "end": "1215030"
  },
  {
    "text": "technology for this way use WebSockets as as a server push bus and a lot of",
    "start": "1215030",
    "end": "1222020"
  },
  {
    "text": "what we know as a community about scaling big web services or any kind of service implicitly assumes a connection",
    "start": "1222020",
    "end": "1228770"
  },
  {
    "text": "orientation and instead of talking about about requests per second as a as a load",
    "start": "1228770",
    "end": "1233990"
  },
  {
    "text": "metric a lot of times that's LOC we're talking about number of simultaneous sessions we just released a public set",
    "start": "1233990",
    "end": "1239510"
  },
  {
    "text": "of numbers where we said that that's over 5 million sessions during the weekday peak being peak to trough",
    "start": "1239510",
    "end": "1245000"
  },
  {
    "text": "variations of course so the original session establishment",
    "start": "1245000",
    "end": "1250370"
  },
  {
    "text": "pattern and this still works just fine because we have to support old clients by the way is that you use this API",
    "start": "1250370",
    "end": "1256880"
  },
  {
    "text": "method that we document called our TM start our TM start gives you back a JSON payload part of which is a WebSocket URL",
    "start": "1256880",
    "end": "1263450"
  },
  {
    "text": "and you connect to that WebSocket URL to start your session getting this in the",
    "start": "1263450",
    "end": "1269059"
  },
  {
    "text": "form of the timeline diagrams we were just doing you've got a client that would like to start their slack session they go out to",
    "start": "1269059",
    "end": "1275330"
  },
  {
    "text": "a web app and ask it to do an RT M start web app harvests a bunch of data from a bunch of places including from channel",
    "start": "1275330",
    "end": "1281450"
  },
  {
    "text": "servers by the way because channel servers might have some messages that web app doesn't know about yet remember",
    "start": "1281450",
    "end": "1287770"
  },
  {
    "text": "and then delivers this gigantic payload to you and why is that payload so",
    "start": "1287770",
    "end": "1294710"
  },
  {
    "text": "gigantic well it's because our TM start is",
    "start": "1294710",
    "end": "1300710"
  },
  {
    "text": "conceptually giving you a kind of keyframe of the teeth of the team state right the way that's sort of this flow is supposed to work is a client that has",
    "start": "1300710",
    "end": "1307820"
  },
  {
    "text": "a complete the MT cache can fill that cache just from our TM start an r TM start gives",
    "start": "1307820",
    "end": "1313010"
  },
  {
    "text": "you a snapshot of all the metadata associated with your team it gives you all the user profiles it gives you all",
    "start": "1313010",
    "end": "1318830"
  },
  {
    "text": "the channel names all the channel membership when messages last appeared",
    "start": "1318830",
    "end": "1324020"
  },
  {
    "text": "in all those channels that you can bold out the things that you've got unread messages in and so forth and then the",
    "start": "1324020",
    "end": "1330170"
  },
  {
    "text": "idea is that updates could sort of trickle in over the WebSocket so that you're only doing incremental updates after that and this works totally",
    "start": "1330170",
    "end": "1337970"
  },
  {
    "text": "perfect for the size of teams that kind of slack was initially designed for in the pitch deck first lock that they",
    "start": "1337970",
    "end": "1344570"
  },
  {
    "text": "originally were shopping around to investors they describe it as a tool for teams of up to 100 people if I remember correctly and for up 200 people this",
    "start": "1344570",
    "end": "1351980"
  },
  {
    "text": "works really really well especially if you happen to be in the US but as organizations got to be over a thousand",
    "start": "1351980",
    "end": "1358250"
  },
  {
    "text": "people then over ten thousand people that over a hundred thousand people and they started to be globally distributed this started to show some some chinks in",
    "start": "1358250",
    "end": "1365090"
  },
  {
    "text": "the armor the biggest one is first just the payload size of that RTM start so",
    "start": "1365090",
    "end": "1372490"
  },
  {
    "text": "you might be wondering why it gets so gigantic it turns out that some of the the data that our team start returns is",
    "start": "1372490",
    "end": "1378620"
  },
  {
    "text": "actually implicitly quadratic in team size as people join a slack team one of",
    "start": "1378620",
    "end": "1384740"
  },
  {
    "text": "the things they do is create new channels and as time passes people create new channels and so you have sort",
    "start": "1384740",
    "end": "1390950"
  },
  {
    "text": "of a number of users that's growing like this and a number of channels that's growing like this and the connectivity",
    "start": "1390950",
    "end": "1397100"
  },
  {
    "text": "pattern of who's in what channel grows like the matrix between the two of them so for really big teams this thing was",
    "start": "1397100",
    "end": "1403250"
  },
  {
    "text": "in the tens of megabytes you could measure tens of seconds on some client devices where it was just decoding JSON",
    "start": "1403250",
    "end": "1409580"
  },
  {
    "text": "from the payload or was just getting the payload into some format where Java or or Swift was able to operate on it so",
    "start": "1409580",
    "end": "1417110"
  },
  {
    "text": "that was limiting performance for big teams and making our customers unhappy a slightly a more subtle thing was that a",
    "start": "1417110",
    "end": "1423020"
  },
  {
    "text": "lot of times these connection operations are temporally synchronized this can either be just because everybody starts",
    "start": "1423020",
    "end": "1428780"
  },
  {
    "text": "work around the same time right so it's 9:00 a.m. people get to work they open their laptops up everybody's connecting",
    "start": "1428780",
    "end": "1434200"
  },
  {
    "text": "even more destructive ones are ones where it's some sort of network event or an operational event on SLOC side that's",
    "start": "1434200",
    "end": "1440600"
  },
  {
    "text": "causing the connections so for instance a big network partition comes along takes tens of thousands of",
    "start": "1440600",
    "end": "1446840"
  },
  {
    "text": "users out at once as soon as that partition goes away they all reconnect at once and they're doing gigantic ly",
    "start": "1446840",
    "end": "1453530"
  },
  {
    "text": "redundant work in these web requests right because computing that big matrix I just described is going to be the same",
    "start": "1453530",
    "end": "1458540"
  },
  {
    "text": "for every team and it's not a tendency to make it easy to knock over the back-end also these things were all",
    "start": "1458540",
    "end": "1467360"
  },
  {
    "text": "happening inside of slacks main data center in u.s. East one and for most of the world which was getting to be more",
    "start": "1467360",
    "end": "1473090"
  },
  {
    "text": "and more of our customer base by then that's a long time to wait so our",
    "start": "1473090",
    "end": "1481460"
  },
  {
    "text": "solution that's problem to this set of problems is of a service that we call flannel flannel is a definitely service",
    "start": "1481460",
    "end": "1489800"
  },
  {
    "text": "I'll go so far as micro it's a lot smaller than web app anyway and it is stateful it has an in-memory cache and",
    "start": "1489800",
    "end": "1496700"
  },
  {
    "text": "the idea is that it's a pre hydrated pre-warmed cache of all the stuff that you're going to need when you want to",
    "start": "1496700",
    "end": "1502280"
  },
  {
    "text": "start a slack session it actually sits on the other end of your WebSocket connection it sort of sits astride it",
    "start": "1502280",
    "end": "1508310"
  },
  {
    "text": "right so it is passing as a filter for WebSocket messages it's keeping its own",
    "start": "1508310",
    "end": "1514400"
  },
  {
    "text": "cache up-to-date with those WebSocket messages in a way that's very similar to how a client would and this is also geo",
    "start": "1514400",
    "end": "1521330"
  },
  {
    "text": "distributed we've got lots of final replicas running throughout the world and if you're curious about a way more",
    "start": "1521330",
    "end": "1526370"
  },
  {
    "text": "detailed treatment of this my colleague being way has both a blog post and a talk that she's given about flannel",
    "start": "1526370",
    "end": "1532070"
  },
  {
    "text": "specifically she's kind of updating our cartoon from before we've now got three",
    "start": "1532070",
    "end": "1538040"
  },
  {
    "text": "regions in this one we've actually got flannel in about a dozen regions at the time of this talk and flannel is",
    "start": "1538040",
    "end": "1546080"
  },
  {
    "text": "terminating your WebSocket connection and able to handle such an establishment in a much more efficient manner and",
    "start": "1546080",
    "end": "1552890"
  },
  {
    "text": "without copying data across the surface of the globe so now your workflow won't",
    "start": "1552890",
    "end": "1559550"
  },
  {
    "text": "be bothering with animating this one is just open up your web socket to flannel present some off material say hey",
    "start": "1559550",
    "end": "1565940"
  },
  {
    "text": "flannel I'm this user I'd like to start a slack session flannel will go back to web app which is the authority about",
    "start": "1565940",
    "end": "1571400"
  },
  {
    "text": "matters of authentication to make sure that your token checks out and when that's the case and when",
    "start": "1571400",
    "end": "1576580"
  },
  {
    "text": "flannels cash is already warmed it'll give you a Hello message and you're up and running so again you know I get to",
    "start": "1576580",
    "end": "1585610"
  },
  {
    "text": "my it depends slide here is flannel better is at the end of history yes it's",
    "start": "1585610",
    "end": "1592179"
  },
  {
    "text": "better right that we have a much simpler reason about safety in terms of system in terms of its safety and its performance however even if you are",
    "start": "1592179",
    "end": "1603700"
  },
  {
    "text": "planning the world's most impressive slot killer and that's why you're coming to this talk I wouldn't recommend that",
    "start": "1603700",
    "end": "1610330"
  },
  {
    "text": "you start by cloning flannel first of all trying to do this in 2014 would have",
    "start": "1610330",
    "end": "1616960"
  },
  {
    "text": "added a moving part to the picture without a lot of justification and secondly you've got a million little",
    "start": "1616960",
    "end": "1622090"
  },
  {
    "text": "decisions to make in sizing a service like this you know how many how much memory do you give to these instances",
    "start": "1622090",
    "end": "1627780"
  },
  {
    "text": "all kinds of hyper parameters around just the sizes of data structures and what to tune and what to optimize for",
    "start": "1627780",
    "end": "1633429"
  },
  {
    "text": "what usage patterns actually matter and you just aren't going to have the data for that until you actually have the load that generates that data so",
    "start": "1633429",
    "end": "1641289"
  },
  {
    "text": "contingently here talking to you in summer of 2018 yes final is really great but it could",
    "start": "1641289",
    "end": "1647380"
  },
  {
    "text": "be that the next 10 X or if we should get so lucky further changes that story in ways that make flannel unrecognizable",
    "start": "1647380",
    "end": "1654280"
  },
  {
    "text": "or even not exist cool so I want to",
    "start": "1654280",
    "end": "1659559"
  },
  {
    "text": "leave some time for questions here so if we're trying to wind down very few of you probably work at SLAC currently if",
    "start": "1659559",
    "end": "1667390"
  },
  {
    "text": "you were to think about your problem and in terms of the things that this talk highlights",
    "start": "1667390",
    "end": "1673600"
  },
  {
    "text": "I'd encourage you to find out what part of your problem is end-to-end in a sense that we're talking about here like what the part is that requires that you go",
    "start": "1673600",
    "end": "1681190"
  },
  {
    "text": "above and beyond the semantics that your network transport or your storage system or your platform that you're writing on",
    "start": "1681190",
    "end": "1687130"
  },
  {
    "text": "top of can give you and concentrate your brain effort and complexity there except",
    "start": "1687130",
    "end": "1693940"
  },
  {
    "text": "that you're never going to solve that part of the problem that's not really the kind of problem that stays solved it's something that just is a locus of",
    "start": "1693940",
    "end": "1699669"
  },
  {
    "text": "ongoing work because the world keeps changing and I guess I'd like to offer the idea to that you know people with",
    "start": "1699669",
    "end": "1706299"
  },
  {
    "text": "the title architect or at conferences that are partly about software design are often implicitly",
    "start": "1706299",
    "end": "1714580"
  },
  {
    "text": "sort of priests of simplicity right are people that are sort of saying oh you know coupling is bad interactions are",
    "start": "1714580",
    "end": "1720730"
  },
  {
    "text": "bad and so on and I'd like to point to the fact that there are some places in the software stack specifically these",
    "start": "1720730",
    "end": "1727060"
  },
  {
    "text": "end-to-end parts where you want complexity where that complexity is actually intelligence where that",
    "start": "1727060",
    "end": "1733330"
  },
  {
    "text": "complexity actually delivers user value and it's a tiny percentage of the total work that we do the vast majority of the",
    "start": "1733330",
    "end": "1739630"
  },
  {
    "text": "work we do at slack also is pretty routine and in in all those areas we do want to have things be nice and",
    "start": "1739630",
    "end": "1745780"
  },
  {
    "text": "orthogonal and simple and stateless and tiny and easy to reason about and have small surface areas and so forth but for",
    "start": "1745780",
    "end": "1754510"
  },
  {
    "text": "the part of things where you actually have to swallow a bitter pill and do something really complicated you should",
    "start": "1754510",
    "end": "1761020"
  },
  {
    "text": "do so with pleasure and with that I'd be happy to take any questions",
    "start": "1761020",
    "end": "1767220"
  },
  {
    "text": "all right Thank You Keith there there's a number of questions in the app",
    "start": "1772980",
    "end": "1778060"
  },
  {
    "text": "meanwhile if you have a question that you would like to ask nan anonymously",
    "start": "1778060",
    "end": "1784620"
  },
  {
    "text": "then let me know raise your hand I'll run towards you and please don't play",
    "start": "1784620",
    "end": "1790210"
  },
  {
    "text": "that game of you and then him and then back again and the questions from them",
    "start": "1790210",
    "end": "1795610"
  },
  {
    "text": "so which bus are you using calf calf question mark Oh in terms of so there's",
    "start": "1795610",
    "end": "1800770"
  },
  {
    "text": "two different buses we've kind of talked about here let me get back to both of",
    "start": "1800770",
    "end": "1807400"
  },
  {
    "text": "them here we go so the channel server bus is full custom that's code we wrote",
    "start": "1807400",
    "end": "1812730"
  },
  {
    "text": "so it's you know a web app is some hack line code we wrote channel service and",
    "start": "1812730",
    "end": "1818560"
  },
  {
    "text": "Java code we wrote they talk to each other over tcp/ip and we built that with our bare little hands job queue is is",
    "start": "1818560",
    "end": "1827560"
  },
  {
    "text": "using Kafka for the bulk message storage part of it and then using Redis as sort",
    "start": "1827560",
    "end": "1833080"
  },
  {
    "text": "of a working memory for jobs that have actually been pulled off that queue and are in the middle of being processed so",
    "start": "1833080",
    "end": "1839440"
  },
  {
    "text": "hope that answers your question whoever was asking but several nobody knows except for one person who asked that",
    "start": "1839440",
    "end": "1845980"
  },
  {
    "text": "question so yeah let's let's assume it was it was uncertain if I can justify the sort of apparent NIH of saying like",
    "start": "1845980",
    "end": "1853210"
  },
  {
    "text": "we just rolled our own four channel server if you get anything out of all",
    "start": "1853210",
    "end": "1858370"
  },
  {
    "text": "these interaction diagrams and stuff it's probably not super important that you be able to reproduce you know this one from memory for instance unless you",
    "start": "1858370",
    "end": "1864190"
  },
  {
    "text": "happen to have my job the the whole point of of these sets of interactions",
    "start": "1864190",
    "end": "1871270"
  },
  {
    "text": "is that we wanted there to be very scalable and very latency controlled pieces of a core interaction here which",
    "start": "1871270",
    "end": "1877930"
  },
  {
    "text": "is one human messaging another human and then other human being able to message them back we believe that having that be",
    "start": "1877930",
    "end": "1883780"
  },
  {
    "text": "both scalable and fast is essentially the core of our technical edge so this",
    "start": "1883780",
    "end": "1889810"
  },
  {
    "text": "is a place where we've indulged in some not invented here syndrome in order to be able to control all the knobs I",
    "start": "1889810",
    "end": "1895350"
  },
  {
    "text": "wouldn't advocate that everywhere it's not of defaults but this is close to kind of the core value proposition so",
    "start": "1895350",
    "end": "1900520"
  },
  {
    "text": "that's why we're going full custom there I'm not sure about the Internet",
    "start": "1900520",
    "end": "1905740"
  },
  {
    "text": "I should use for the next question excellent let's take both is most I think most enjoyable why have you chosen",
    "start": "1905740",
    "end": "1913720"
  },
  {
    "text": "hack Lang as a beckoned technology or maybe I should just say why have you",
    "start": "1913720",
    "end": "1919240"
  },
  {
    "text": "chosen backline hack Lang as your back-end technology do you think it was a good choice yeah so there is a more",
    "start": "1919240",
    "end": "1928780"
  },
  {
    "text": "controversial and less controversial version of this answer right the the conservative apologetic way to answer",
    "start": "1928780",
    "end": "1935440"
  },
  {
    "text": "this question is well the founders were very conversant with PHP so they initially started with PHP as the code",
    "start": "1935440",
    "end": "1941230"
  },
  {
    "text": "base got bigger or we wanted to have a type system you know insert fiddly arguments about",
    "start": "1941230",
    "end": "1946809"
  },
  {
    "text": "which gradual type system you want to have for your PHP system here but there's properties of hack lang that",
    "start": "1946809",
    "end": "1951880"
  },
  {
    "text": "make it much more useful than than PHP sevens scalar types if you're looking",
    "start": "1951880",
    "end": "1957220"
  },
  {
    "text": "for a migration path for a big monolith in PHP or those who haven't seen it by",
    "start": "1957220",
    "end": "1963010"
  },
  {
    "text": "the way hack lang is really similar in spirit to like typescript or flow for JavaScript the idea is that you can kind",
    "start": "1963010",
    "end": "1969370"
  },
  {
    "text": "of incrementally add types to the type of all parts of your dynamic program and get some of the benefits of your",
    "start": "1969370",
    "end": "1974950"
  },
  {
    "text": "programming language but still keep your JavaScript or in our case PHP execution",
    "start": "1974950",
    "end": "1980320"
  },
  {
    "text": "engine more controversially I actually am you know this isn't my first time at",
    "start": "1980320",
    "end": "1987370"
  },
  {
    "text": "the rodeo with hack Lang I was at Facebook for seven years before I got started at its lack Facebook also had a",
    "start": "1987370",
    "end": "1994720"
  },
  {
    "text": "really big PHP monolith and you know invented hackling for the PERT for this purpose I think that hack Lang is",
    "start": "1994720",
    "end": "2003570"
  },
  {
    "text": "actually a really really great platform all things to have you know if I was starting a new project tomorrow I would",
    "start": "2003570",
    "end": "2008760"
  },
  {
    "text": "do it in hacklin with a smile being able to have all the benefits of a dynamic",
    "start": "2008760",
    "end": "2013920"
  },
  {
    "text": "language a really quick iteration cycle right having compilers out of the iteration cycle for as a developer but",
    "start": "2013920",
    "end": "2020130"
  },
  {
    "text": "still have where you want it all the safety of of a really rich type system and an expressive type system I think is",
    "start": "2020130",
    "end": "2027390"
  },
  {
    "text": "actually a great combination and I think only you know server-side JavaScript is",
    "start": "2027390",
    "end": "2032400"
  },
  {
    "text": "comparable but you know I've also spent eight thousand hours of my life or something implementing a PHP engine so I would",
    "start": "2032400",
    "end": "2039190"
  },
  {
    "text": "think that all right so from the the",
    "start": "2039190",
    "end": "2044620"
  },
  {
    "text": "inside back to the edge somebody have is wondering have you considered HTTP to",
    "start": "2044620",
    "end": "2051909"
  },
  {
    "text": "versus WebSockets yeah and how does that yeah so uh that's a great question so",
    "start": "2051910",
    "end": "2057100"
  },
  {
    "text": "HTTP two for those who haven't seen it you know even an HTP one one there was this trick of sort of you know leaving",
    "start": "2057100",
    "end": "2062830"
  },
  {
    "text": "the socket open and having a convention with the server about the server incrementally dribbling out new bits of",
    "start": "2062830",
    "end": "2068950"
  },
  {
    "text": "data over that socket and HTTP to formalize that even as I sit here",
    "start": "2068950",
    "end": "2076540"
  },
  {
    "text": "talking to you the market for edge products you know outside of stock right",
    "start": "2076540",
    "end": "2081610"
  },
  {
    "text": "we don't build our own CDN we don't build our own do our own you know DNS some of our TLS termination stuff",
    "start": "2081610",
    "end": "2088179"
  },
  {
    "text": "happens to other SAS providers the market for HTTP to stuff is a little",
    "start": "2088180",
    "end": "2094090"
  },
  {
    "text": "less mature oddly enough and also HTTP 2 was kind of knew when we got started if",
    "start": "2094090",
    "end": "2101320"
  },
  {
    "text": "I were starting this from scratch I think it'd be very tempting to sort of try to merge let's go back to the old",
    "start": "2101320",
    "end": "2109120"
  },
  {
    "text": "slack right so it's 2014 again except it's a 2014 where we've got htv-2",
    "start": "2109120",
    "end": "2117270"
  },
  {
    "text": "you'd be very tempting to start off in a world where web app and channels server are the same box right where there's",
    "start": "2117270",
    "end": "2122740"
  },
  {
    "text": "just sort of one app logic server that handles both connections and requests",
    "start": "2122740",
    "end": "2128190"
  },
  {
    "text": "handling connection long-lived connections and requests on the same machines is tricky but fine you'd make",
    "start": "2128190",
    "end": "2133690"
  },
  {
    "text": "them different pools of traffic and I think that so has everybody heard of discord have you ever seen discord",
    "start": "2133690",
    "end": "2140170"
  },
  {
    "text": "before so discord is is you know a slack clone that that is in the gaming market right they address the needs of gamers",
    "start": "2140170",
    "end": "2146470"
  },
  {
    "text": "more than more than we do my impression is that they've roughly done that in a lick sir I don't know the technical",
    "start": "2146470",
    "end": "2152560"
  },
  {
    "text": "details but they've done it in sort of a they've done that in one box I still",
    "start": "2152560",
    "end": "2159820"
  },
  {
    "text": "think that when you get to the set of problems that we were starting to get to a setup like this that kind of",
    "start": "2159820",
    "end": "2165820"
  },
  {
    "text": "decomposed egg need to remember these numbers set up like this that kind of decomposes your edge in - the stateful part of things that's",
    "start": "2165820",
    "end": "2172540"
  },
  {
    "text": "handling connections and the request oriented flow is going to be useful but",
    "start": "2172540",
    "end": "2178810"
  },
  {
    "text": "that's just kind of a gut feel first lack where slack was at this is sort of partly a path dependent choice",
    "start": "2178810",
    "end": "2184960"
  },
  {
    "text": "actually there's a bunch of I never told this shaggy-dog story about sort of",
    "start": "2184960",
    "end": "2190930"
  },
  {
    "text": "slacks origins but before slack was the company slack it was a company called",
    "start": "2190930",
    "end": "2196420"
  },
  {
    "text": "tiny spec which made a game called glitch and there are pieces of sort of this diagram that correspond to the",
    "start": "2196420",
    "end": "2202690"
  },
  {
    "text": "massively multiplayer online game that was glitched before that company pivoted to be slack so the sort of historical",
    "start": "2202690",
    "end": "2209980"
  },
  {
    "text": "dependency here was just you know there was a game server and the game server was the thing that did all the real-time",
    "start": "2209980",
    "end": "2214990"
  },
  {
    "text": "push updates and there was also an app server that did all the crud stuff and that kind of division of concerns was",
    "start": "2214990",
    "end": "2223180"
  },
  {
    "text": "roughly useful for an online game I have a weird theory about slack that that's actually not an incidental part of its",
    "start": "2223180",
    "end": "2229120"
  },
  {
    "text": "history that the fact that it has the architecture of an online game is also why it felt right when you tried to use",
    "start": "2229120",
    "end": "2235300"
  },
  {
    "text": "it because you're sort of slack is a virtual place its goals are very similar",
    "start": "2235300",
    "end": "2241090"
  },
  {
    "text": "to the goals of a kind of virtual world in a typical game server but it's a",
    "start": "2241090",
    "end": "2247720"
  },
  {
    "text": "textual place instead of a place with pixels and you know 3d images and stuff",
    "start": "2247720",
    "end": "2252840"
  },
  {
    "text": "all right so somebody is trying to to hack you I think but what is the most",
    "start": "2252840",
    "end": "2258220"
  },
  {
    "text": "common source of message duplicates that occasionally pop up in slack most counts",
    "start": "2258220",
    "end": "2264310"
  },
  {
    "text": "are some message duplicates that show up in slack probably retries from clients right so retries in either one of those",
    "start": "2264310",
    "end": "2271180"
  },
  {
    "text": "flows it's possible for a message to appear to fail to a client right the clients are gonna set some kind of",
    "start": "2271180",
    "end": "2276730"
  },
  {
    "text": "timeout and say oh if I didn't hear an act back after this I'll just try again and so they do try again one of the",
    "start": "2276730",
    "end": "2283960"
  },
  {
    "text": "common patterns for how people get around this like impossibility results with about consensus is to make the",
    "start": "2283960",
    "end": "2292090"
  },
  {
    "text": "operations idempotent right make it so that yeah it doesn't matter if the operations happen twice so the way that",
    "start": "2292090",
    "end": "2298270"
  },
  {
    "text": "a client sort of keeps itself from displaying the message twice as often that it will add its own salt to the",
    "start": "2298270",
    "end": "2304010"
  },
  {
    "text": "and recognize its salt when the message comes through recognize that oh this is I guess my original son succeeded I",
    "start": "2304010",
    "end": "2310070"
  },
  {
    "text": "don't need to resend it or if I did resend it I can D dupe them myself and",
    "start": "2310070",
    "end": "2319150"
  },
  {
    "text": "on the server side of things we actually take clients at their word if they try",
    "start": "2319150",
    "end": "2325760"
  },
  {
    "text": "to send the same message twice right now so if a client really does try to double a message the back end takes that",
    "start": "2325760",
    "end": "2333530"
  },
  {
    "text": "seriously and it's kind of a hot topic of debate about whether that's the right thing to do or not I'm sure you can",
    "start": "2333530",
    "end": "2340550"
  },
  {
    "text": "construct an example where that has some surprising behavior but it's true that like 99.9 percent of times that we send",
    "start": "2340550",
    "end": "2347630"
  },
  {
    "text": "this that we have the same user or saying the bitwise same thing in the same channel right one after another",
    "start": "2347630",
    "end": "2352970"
  },
  {
    "text": "that it is some sort of bad interaction between the client and the server that caused it as opposed to that really",
    "start": "2352970",
    "end": "2358880"
  },
  {
    "text": "being the user intent but distributed systems are hard and impossibility results are real impossibility results",
    "start": "2358880",
    "end": "2365119"
  },
  {
    "text": "so all we can hope to do is to kind of marginalize those down to being really rare it's like we've got to prioritize",
    "start": "2365119",
    "end": "2372590"
  },
  {
    "text": "the humans or the app what's the what do we say as always humans first okay thank you",
    "start": "2372590",
    "end": "2382040"
  },
  {
    "text": "for running it's okay to piss off an app but not to piss off for you that's right yeah sorry anonymous person hey how do",
    "start": "2382040",
    "end": "2388310"
  },
  {
    "text": "you test follow those failures so how do we test for all those different kinds of",
    "start": "2388310",
    "end": "2393650"
  },
  {
    "text": "failures yeah well there is the reality",
    "start": "2393650",
    "end": "2401240"
  },
  {
    "text": "is that you can't completely right so the at some level you're going to find things in production that you know that",
    "start": "2401240",
    "end": "2408770"
  },
  {
    "text": "surprise you software is a complex artifact the world's complex a very",
    "start": "2408770",
    "end": "2416750"
  },
  {
    "text": "principled answer to this would be that you model all of these systems in some sort of formal way using like TL a-plus",
    "start": "2416750",
    "end": "2422680"
  },
  {
    "text": "and you write down all the invariants that the system has to satisfy and you think of all the scenarios that you'd",
    "start": "2422680",
    "end": "2427940"
  },
  {
    "text": "like to handle correctly and you feed them to the model checker and let it run for a few days and you know have it find",
    "start": "2427940",
    "end": "2433880"
  },
  {
    "text": "all of your bugs for you people are starting to have success with that kind of thing in industrial",
    "start": "2433880",
    "end": "2439550"
  },
  {
    "text": "contexts to be clearer and I don't want to kind of make it sound like that's entirely impossible but even if you do",
    "start": "2439550",
    "end": "2444890"
  },
  {
    "text": "all that work you still will find real problems in the process of moving to production just because your model is",
    "start": "2444890",
    "end": "2451250"
  },
  {
    "text": "incomplete by definition its model so in terms of how you actually go about",
    "start": "2451250",
    "end": "2457520"
  },
  {
    "text": "moving from system a to system B a lot of that is actually kind of the hard part of rolling out a new system like",
    "start": "2457520",
    "end": "2462770"
  },
  {
    "text": "this is you need to figure out some safe way to decompose the space where you can",
    "start": "2462770",
    "end": "2468460"
  },
  {
    "text": "convince yourself that the new system works in a low enough damaged way so for",
    "start": "2468460",
    "end": "2473600"
  },
  {
    "text": "example let's say it's a new storage system right you decided we don't like my sequel anymore we want to use post",
    "start": "2473600",
    "end": "2478670"
  },
  {
    "text": "gross okay a technique that can work for that is that you double write for a",
    "start": "2478670",
    "end": "2484310"
  },
  {
    "text": "while write that for that once you decide you've got the code working beyond some obvious measure it's passing",
    "start": "2484310",
    "end": "2490460"
  },
  {
    "text": "tests and so on but you don't have confidence in it in production yet you",
    "start": "2490460",
    "end": "2495830"
  },
  {
    "text": "could send writes to both storage destinations and on reads you could make sure that both storage destinations are",
    "start": "2495830",
    "end": "2501800"
  },
  {
    "text": "telling you the same thing but if it's not a storage system right if it's a message bus or something it's more complicated and in those scenarios I",
    "start": "2501800",
    "end": "2510110"
  },
  {
    "text": "don't know anything other than sort of you stand them up side by side and start with a really really small percentage and do lots and lots of tests as you",
    "start": "2510110",
    "end": "2516680"
  },
  {
    "text": "sort of slowly dial up the load on the new system in both cases as kind of a you know operational tip I've always had",
    "start": "2516680",
    "end": "2525470"
  },
  {
    "text": "the experience that the you know as you're kind of cutting over from the old system to the new system you find a lot",
    "start": "2525470",
    "end": "2531980"
  },
  {
    "text": "of bugs in the new system right you final and eventually you get to the bottom of some discrepancy and behavior",
    "start": "2531980",
    "end": "2537530"
  },
  {
    "text": "that really is a bug in the old system and you're kind of excited about that you know cool this new system is",
    "start": "2537530",
    "end": "2543650"
  },
  {
    "text": "actually making things better and in almost every software project I've ever seen that's a phase transition and it's",
    "start": "2543650",
    "end": "2548780"
  },
  {
    "text": "like that it is that first bug it mean but by the time you find a bug in the old system it really does mean that the",
    "start": "2548780",
    "end": "2553910"
  },
  {
    "text": "new system is probably better and once you're in that regime where all the bugs",
    "start": "2553910",
    "end": "2559310"
  },
  {
    "text": "you find or actually in the old system you're harming your users by continuing to use the old system right you need to kind of pick up the pace on on adopting",
    "start": "2559310",
    "end": "2566270"
  },
  {
    "text": "the new system both so that you can make your life less complicated it's that there's only one system instead it's you to think about and so",
    "start": "2566270",
    "end": "2573079"
  },
  {
    "text": "that whatever damage is there in the old system can get eliminated more quickly but unfortunately it's kind of case",
    "start": "2573079",
    "end": "2578510"
  },
  {
    "text": "specific it depends exactly what thing you're doing yeah yes",
    "start": "2578510",
    "end": "2585730"
  },
  {
    "text": "I'm just curious the charting of the users on basically the sessions house",
    "start": "2588140",
    "end": "2593270"
  },
  {
    "text": "organized so basically doesn't mean that all the users from the same organization will end up somewhere on the same node",
    "start": "2593270",
    "end": "2598609"
  },
  {
    "text": "or how basically the routing of the messages be done between different instances yeah that's a great question",
    "start": "2598609",
    "end": "2604819"
  },
  {
    "text": "that is let's go back to our final picture here there there's a version of",
    "start": "2604819",
    "end": "2611089"
  },
  {
    "text": "this which is it's depend it depends and depends on which system and exactly",
    "start": "2611089",
    "end": "2616880"
  },
  {
    "text": "where some knobs are when I'm giving this talk right now so first of all",
    "start": "2616880",
    "end": "2622520"
  },
  {
    "text": "you've got some geo DNS just spreading the connection load across these systems the actual WebSocket connection oriented",
    "start": "2622520",
    "end": "2629869"
  },
  {
    "text": "part of you know in this cloud that I'm hiding there is a tree so there is",
    "start": "2629869",
    "end": "2636530"
  },
  {
    "text": "partly an aggregation tree leading out of the channel servers to the large number of users out there so you don't have some poor Java process somewhere",
    "start": "2636530",
    "end": "2643520"
  },
  {
    "text": "where the hundred-thousand sockets open saying for I equals 0 200,000 sin sin sin sin Sun there is a much more",
    "start": "2643520",
    "end": "2649970"
  },
  {
    "text": "reasonable fan-out from the US East one system out to systems that we call gateway servers in the edge pops there",
    "start": "2649970",
    "end": "2658940"
  },
  {
    "text": "is also a question of sort of where data on the web app side of things lives that's a whole big complicated kettle of",
    "start": "2658940",
    "end": "2665569"
  },
  {
    "text": "fish so the way that storage is is allocated right now is basically wrong",
    "start": "2665569",
    "end": "2670670"
  },
  {
    "text": "given that team size is power law distributed right so when teams were all kind of roughly the same size we used to",
    "start": "2670670",
    "end": "2676640"
  },
  {
    "text": "just shard my teams now that there are gigantic teams that doesn't work anymore and that's a good example of one of",
    "start": "2676640",
    "end": "2683270"
  },
  {
    "text": "these systems that's actually in transition it's the system I'm thinking of when I'm talking about a storage transition we're moving from client",
    "start": "2683270",
    "end": "2688730"
  },
  {
    "text": "sharted my sequel to the tests which is a char dot system for my sequel that",
    "start": "2688730",
    "end": "2695150"
  },
  {
    "text": "we're inheriting from YouTube YouTube built at several years back and made it open source and we're contributing to it",
    "start": "2695150",
    "end": "2701750"
  },
  {
    "text": "for our purposes and then in terms of one of the boxes I'm emitting from this cartoon here is",
    "start": "2701750",
    "end": "2708560"
  },
  {
    "text": "actually you know an each edge popped there are many flannel machines users are sticky to a given flannel machine",
    "start": "2708560",
    "end": "2714589"
  },
  {
    "text": "and teams are lightly sticky to a given final machine so let's say that we've got some colossal team that lives really",
    "start": "2714589",
    "end": "2721490"
  },
  {
    "text": "close to Paris and so there are just 50,000 people coming in they might not all fit on a single flannel host even",
    "start": "2721490",
    "end": "2728660"
  },
  {
    "text": "though there is a flannel host for that team there so there's a bunch of load balancing logic in front of us that",
    "start": "2728660",
    "end": "2733820"
  },
  {
    "text": "actually kind of cracks her token says okay this user claims to have this user ID claims to be on this team and then",
    "start": "2733820",
    "end": "2741980"
  },
  {
    "text": "makes a heuristic decision about which foil box to put you on accordingly is that kind of we were getting up yeah",
    "start": "2741980",
    "end": "2747890"
  },
  {
    "text": "there's a lot of stuff here there are many many more services than kind of or even hinted at here unfortunately but",
    "start": "2747890",
    "end": "2754190"
  },
  {
    "text": "I've got to make it tractable to talk about is there one last live question",
    "start": "2754190",
    "end": "2762140"
  },
  {
    "text": "otherwise I've got one from the app the one I wanted to finish here with what is",
    "start": "2762140",
    "end": "2767300"
  },
  {
    "text": "the one thing you are most scared about about what the future can run it's a",
    "start": "2767300",
    "end": "2772670"
  },
  {
    "text": "great question most about I think I'm most scared about somebody just you know",
    "start": "2772670",
    "end": "2780470"
  },
  {
    "text": "doing it better and growing faster right like just somebody just makes us lock except it's way better and it just beats",
    "start": "2780470",
    "end": "2786950"
  },
  {
    "text": "us so it's kind of a boring answer right but I think that almost all these other",
    "start": "2786950",
    "end": "2793670"
  },
  {
    "text": "things are sort of simple matters of like engineering and programming and operating and so forth and in terms of axes that are that I",
    "start": "2793670",
    "end": "2803270"
  },
  {
    "text": "could imagine somebody beating us on or I could imagine somebody just having a way better take on this space where I",
    "start": "2803270",
    "end": "2808640"
  },
  {
    "text": "just sort of having an even more convincing reinvention of how teams communicate I could imagine somebody",
    "start": "2808640",
    "end": "2814220"
  },
  {
    "text": "making us lock but it performs so much better or it's you know so much more reliable or uses so many fewer resources",
    "start": "2814220",
    "end": "2819859"
  },
  {
    "text": "or something like that and so yeah that's probably you know but honestly by",
    "start": "2819859",
    "end": "2827150"
  },
  {
    "text": "and large like you know I like computer programming and you know that's that's not gonna be the end of the world or whatever you know you'll find another",
    "start": "2827150",
    "end": "2833359"
  },
  {
    "text": "job I'm not going to lose sleep about it like a literal physical biological level obviously right but I think we have a",
    "start": "2833359",
    "end": "2840619"
  },
  {
    "text": "pretty neat thing and somebody else taking this opportunity is okay if that makes any sense right but I do actually",
    "start": "2840619",
    "end": "2846230"
  },
  {
    "text": "want to see this change happen I do actually want to send way way way fewer emails for the rest of my life all right",
    "start": "2846230",
    "end": "2854030"
  },
  {
    "text": "so if you want to compete with slack it's okay but not now that's basically just wait a little bit all right so",
    "start": "2854030",
    "end": "2861340"
  },
  {
    "text": "let's give a big round of applause for our Keith thank you [Applause]",
    "start": "2861340",
    "end": "2873058"
  }
]