[
  {
    "text": "welcome to this new Kix webinar I'm donat koni principal engineer light bands and today I'll talk about",
    "start": "2639",
    "end": "9400"
  },
  {
    "text": "choreography sagas so there are two types of sagas choreography and orchestration sagas",
    "start": "9400",
    "end": "15400"
  },
  {
    "text": "today I will only cover choreography sagas in the upcoming webinar I will",
    "start": "15400",
    "end": "20560"
  },
  {
    "text": "talk about orchestration sagas but in both case it's about Implement a long running process in distributed system we",
    "start": "20560",
    "end": "28320"
  },
  {
    "text": "are talk about a process that's depends over more than one transaction when we think about KX entities they live in",
    "start": "28320",
    "end": "34920"
  },
  {
    "text": "their own transaction boundary you cannot motate two entities at the same",
    "start": "34920",
    "end": "40719"
  },
  {
    "text": "time you motate first one and then you have to move to the second one and they leave isolated in their own transaction",
    "start": "40719",
    "end": "49039"
  },
  {
    "text": "boundary now when we are building choreography the abstractions that we",
    "start": "49039",
    "end": "54520"
  },
  {
    "text": "have in in KX to allow us to build a choreography are the entities in one side you your strict strict consistent",
    "start": "54520",
    "end": "62559"
  },
  {
    "text": "domain model and the other side you can use subscriptions those are actions that",
    "start": "62559",
    "end": "67640"
  },
  {
    "text": "you add a subscription annotation telling Kix that you want to receive the",
    "start": "67640",
    "end": "73159"
  },
  {
    "text": "events if you are subscribing to Event Source entity you want to receive the events from your entity that action in",
    "start": "73159",
    "end": "80079"
  },
  {
    "text": "that method or you want to receive state change from a value entity so in both",
    "start": "80079",
    "end": "87159"
  },
  {
    "text": "case you can use an action you add a subscription and tell Kix I want to receive updates or we can say you want",
    "start": "87159",
    "end": "94759"
  },
  {
    "text": "to to receive new action the facts that happen in your application and you want to do that because you want to connect",
    "start": "94759",
    "end": "102399"
  },
  {
    "text": "you want to react to the facts and connect let let the facts flow through",
    "start": "102399",
    "end": "108680"
  },
  {
    "text": "your system and motate other entities so you can imagine that you modify one entity at at a place and then you listen",
    "start": "108680",
    "end": "115640"
  },
  {
    "text": "to the events from this entity for example and when you see some uh when a event is delivered to your action",
    "start": "115640",
    "end": "122840"
  },
  {
    "text": "you then can send a command to another entity as such you can connect them and",
    "start": "122840",
    "end": "129360"
  },
  {
    "text": "make sure that when one motates the other will be motate as well they are mutated in different transactions but",
    "start": "129360",
    "end": "135480"
  },
  {
    "text": "it's guaranteed because of the subscription that this fact will",
    "start": "135480",
    "end": "140560"
  },
  {
    "text": "Traverse your system so in nutshell we can say that choreograph s is about",
    "start": "140560",
    "end": "146160"
  },
  {
    "text": "building the pipes that will allow facts to Traverse your application let's see a",
    "start": "146160",
    "end": "151760"
  },
  {
    "text": "more graphical example imagine that here we have a kic service and I have three",
    "start": "151760",
    "end": "157599"
  },
  {
    "text": "notes uh in production and I have three kinds of entities that are spread over",
    "start": "157599",
    "end": "162720"
  },
  {
    "text": "my noes I have the a type depicted here with a yellow circle and I have the B",
    "start": "162720",
    "end": "169879"
  },
  {
    "text": "type it's yet another kind of entity that I have uh and the C one so in my",
    "start": "169879",
    "end": "176640"
  },
  {
    "text": "business I need to react whenever something happens to a I need to to",
    "start": "176640",
    "end": "182959"
  },
  {
    "text": "listen to that and generate some comments that will hit entities of type B so for example something happens in A1",
    "start": "182959",
    "end": "191840"
  },
  {
    "text": "then I'm listening to those uh events and I will then generate a command that",
    "start": "191840",
    "end": "197319"
  },
  {
    "text": "I will send to B1 and something happens in B1 I want to generate something C1",
    "start": "197319",
    "end": "203680"
  },
  {
    "text": "and here we can see that those entities they are in different nodes they could be on the same machine doesn't matter",
    "start": "203680",
    "end": "209439"
  },
  {
    "text": "much for us uh this is something that KX will",
    "start": "209439",
    "end": "214519"
  },
  {
    "text": "take care for you to spread the entities but the abstraction that we need here is to have is the subscription that will",
    "start": "214519",
    "end": "221560"
  },
  {
    "text": "allow us give us the guarantee that when something happens I will get notified",
    "start": "221560",
    "end": "227159"
  },
  {
    "text": "and then I can move forward and uh execute another action in the case here",
    "start": "227159",
    "end": "232239"
  },
  {
    "text": "something happens in A1 I'm listening to that using this subscription and then I send a command to B1 B1 is now producing",
    "start": "232239",
    "end": "239360"
  },
  {
    "text": "more events that I'm also listen to them and then I will react and send another",
    "start": "239360",
    "end": "244640"
  },
  {
    "text": "command to C1 so there are different steps here from entities to subscriptions to subscriptions back to",
    "start": "244640",
    "end": "252280"
  },
  {
    "text": "entities let's see another more concrete example I have here shopping cart and",
    "start": "252280",
    "end": "257560"
  },
  {
    "text": "the user added already two items and then it removed an item so that's what I have in my journal item added item added",
    "start": "257560",
    "end": "265240"
  },
  {
    "text": "and item removed the content of the the payload of those events are not important for example here so at some",
    "start": "265240",
    "end": "273199"
  },
  {
    "text": "point the user decide to check out the event uh the shopping cart so check out event it's admitted and I have in my",
    "start": "273199",
    "end": "280479"
  },
  {
    "text": "system a checkout subscriber that is listening to events from shopping cart and taking actions from that and the the",
    "start": "280479",
    "end": "287919"
  },
  {
    "text": "user case here is whenever checkout is emitted I want to create an order so now",
    "start": "287919",
    "end": "293880"
  },
  {
    "text": "I have one individual entity shopping cart that got check out and this event",
    "start": "293880",
    "end": "300680"
  },
  {
    "text": "will trigger an action in my system under the hood the subscriber will",
    "start": "300680",
    "end": "305840"
  },
  {
    "text": "receive this checkout events check checked out event and will create an order of course here the order will also",
    "start": "305840",
    "end": "313680"
  },
  {
    "text": "emit its own events and I have another action here another subscriber receiving",
    "start": "313680",
    "end": "320360"
  },
  {
    "text": "events from other entity and also execute some action in the case here",
    "start": "320360",
    "end": "326440"
  },
  {
    "text": "whenever checkout is done this checkout subscriber get notified it creates an",
    "start": "326440",
    "end": "332240"
  },
  {
    "text": "order whenever an order is created the other subscriber gets notified and it creates initiates a payment so as we can",
    "start": "332240",
    "end": "339680"
  },
  {
    "text": "see here there are three entities but one action that happened in the shopping",
    "start": "339680",
    "end": "345199"
  },
  {
    "text": "cart trigger cascaded a few uh other commands down the road so we start with",
    "start": "345199",
    "end": "353160"
  },
  {
    "text": "checkout we react to that we create an order we react to that we start we",
    "start": "353160",
    "end": "358919"
  },
  {
    "text": "initiate a payments but when we are working with subscriptions it's important to",
    "start": "358919",
    "end": "365160"
  },
  {
    "text": "understand how it works behind the scenes so you are prepared to understand what are the possible errors that we can",
    "start": "365160",
    "end": "371759"
  },
  {
    "text": "uh have when subscribing to events so one one important error is what we call",
    "start": "371759",
    "end": "377240"
  },
  {
    "text": "a head ofline error in that case here I have some events event one 2 three four",
    "start": "377240",
    "end": "383720"
  },
  {
    "text": "and five doesn't matter much what is inside those events they belong from an entity called it user entity and the",
    "start": "383720",
    "end": "391280"
  },
  {
    "text": "letters next to it is are the identifi so I have three different instance here",
    "start": "391280",
    "end": "396960"
  },
  {
    "text": "and the events are all together in the in the journal and um I'm subscribing to",
    "start": "396960",
    "end": "402720"
  },
  {
    "text": "those events so I have an action with an subscribe notation saying I want to",
    "start": "402720",
    "end": "408840"
  },
  {
    "text": "receive events from uh user entity when you deploy that in",
    "start": "408840",
    "end": "414800"
  },
  {
    "text": "production Kix uh so you define your action you have your event hander which",
    "start": "414800",
    "end": "420000"
  },
  {
    "text": "contains your business logic and um you deploy that uh into KX and what KX will",
    "start": "420000",
    "end": "425479"
  },
  {
    "text": "do behind the scenes for you it will start to read the journal and it will pick event one and will deliver to your",
    "start": "425479",
    "end": "432639"
  },
  {
    "text": "event handler and when you finish processing this event KX will save the offset so as such that if something",
    "start": "432639",
    "end": "440039"
  },
  {
    "text": "happens if you restart that machine for some reason if you redeploy it it will rest on the next event because event one",
    "start": "440039",
    "end": "447039"
  },
  {
    "text": "was already processed we saved the off set we save that event one has already",
    "start": "447039",
    "end": "452479"
  },
  {
    "text": "been delivered to your event handler but then this process keeps going it keeps",
    "start": "452479",
    "end": "458160"
  },
  {
    "text": "consuming the events and delivering to you the events in the order that they are found in the in the storage in the",
    "start": "458160",
    "end": "466080"
  },
  {
    "text": "journal but imagine that when Kix tries to read event Tre it fails to deize it",
    "start": "466080",
    "end": "472800"
  },
  {
    "text": "so we have the event persisted in storage but for some reason you change the format you change your code and now",
    "start": "472800",
    "end": "479360"
  },
  {
    "text": "what is in storage cannot be deserialized back to the type to the model that you have in your uh code so",
    "start": "479360",
    "end": "487400"
  },
  {
    "text": "now it fails it fails to deserialize this is a kind of problem that you can only solve by fixing your",
    "start": "487400",
    "end": "494879"
  },
  {
    "text": "serialization fixing bringing back the type that you had before um if you need",
    "start": "494879",
    "end": "500759"
  },
  {
    "text": "to do a a a migration of your format you have to to add it and U because",
    "start": "500759",
    "end": "507560"
  },
  {
    "text": "otherwise KX won't be able to read back this event it will always fail and when",
    "start": "507560",
    "end": "512640"
  },
  {
    "text": "a subscription fails it it crashs and then it waits a little bit and start",
    "start": "512640",
    "end": "517760"
  },
  {
    "text": "over again when it start over again it will go back to event three and and then",
    "start": "517760",
    "end": "522959"
  },
  {
    "text": "it will fail again so you need to fix it if you have a serialization issue when reading events from your Journal you",
    "start": "522959",
    "end": "530480"
  },
  {
    "text": "have to to to fix the serialization in such a situation you",
    "start": "530480",
    "end": "536040"
  },
  {
    "text": "are kind of blocked here KX won't be able able to continue delivering events to your event handler because it's stuck",
    "start": "536040",
    "end": "542959"
  },
  {
    "text": "on event three so you have to fix it another kind of error that you also have to fix is when your event handler has",
    "start": "542959",
    "end": "550279"
  },
  {
    "text": "some Pro programming error that is just failing whenever it sees event three here so KX picks the event from the",
    "start": "550279",
    "end": "557320"
  },
  {
    "text": "journal deize okay we succeed to desize it we deliver that to your vent hander",
    "start": "557320",
    "end": "563959"
  },
  {
    "text": "but then your vent hander has a bug and it fails again here this this",
    "start": "563959",
    "end": "569200"
  },
  {
    "text": "description is failing it will keep failing and Kix will keep trying to deliver this event Tre to you and it",
    "start": "569200",
    "end": "575680"
  },
  {
    "text": "will continue failing so here again you have to fix your code and redeploy the",
    "start": "575680",
    "end": "581519"
  },
  {
    "text": "Third Kind of error is when we read the the event from the journal we",
    "start": "581519",
    "end": "586959"
  },
  {
    "text": "decentralize it we deliver to your event handler the event handler you do your",
    "start": "586959",
    "end": "592079"
  },
  {
    "text": "processing there you return it and then Kix needs to save the offset and for some reason network issues or you just",
    "start": "592079",
    "end": "600440"
  },
  {
    "text": "shut down the application at that moment you undeploy it everything you remove all your nodes something happens that",
    "start": "600440",
    "end": "607320"
  },
  {
    "text": "Kix are not able to persist that offset when this process get back to life it",
    "start": "607320",
    "end": "613480"
  },
  {
    "text": "will try to redeliver event three because For Kix this event was never delivered we missed the chance to save",
    "start": "613480",
    "end": "620279"
  },
  {
    "text": "the offset so for us it's like it never it it was never delivered so we delivered it again to your event handler",
    "start": "620279",
    "end": "628000"
  },
  {
    "text": "and that's why when you building subscriptions you have to make sure that your event handlers",
    "start": "628000",
    "end": "634040"
  },
  {
    "text": "are at a potent whatever you do there inside you need to be protected and be sure that you that you can receive this",
    "start": "634040",
    "end": "640680"
  },
  {
    "text": "event more than once and that you won't impact your data because of that that",
    "start": "640680",
    "end": "645720"
  },
  {
    "text": "your that is protected is either potent um so imagine that you're receiving the event and sending a command to some",
    "start": "645720",
    "end": "652959"
  },
  {
    "text": "other entity that entity must uh be able to to react and detect the disc command",
    "start": "652959",
    "end": "659200"
  },
  {
    "text": "was already sent now in all those three case this",
    "start": "659200",
    "end": "664399"
  },
  {
    "text": "this case here the first case and the second case they are kind of blocking",
    "start": "664399",
    "end": "669639"
  },
  {
    "text": "because it blocks your your flow here the subscriber cannot move forward until",
    "start": "669639",
    "end": "676120"
  },
  {
    "text": "you fix your code the third one it's more intermittent uh error it happen if",
    "start": "676120",
    "end": "681800"
  },
  {
    "text": "it happens it will just recovered but with the consequence that your event hander may see that event number three",
    "start": "681800",
    "end": "688600"
  },
  {
    "text": "more than once so this is an important aspect when you're are building choreography sagas",
    "start": "688600",
    "end": "694600"
  },
  {
    "text": "because subscriptions are an important part of choreography sagas that's how we",
    "start": "694600",
    "end": "699639"
  },
  {
    "text": "buildt choreography sagas so I have a a a a little demo to so we can navigate a",
    "start": "699639",
    "end": "706480"
  },
  {
    "text": "little bit through the codes and you can see um it it work in in a real application and as a",
    "start": "706480",
    "end": "715720"
  },
  {
    "text": "use case I will uh show show you how you can solve one of the major challenges in",
    "start": "715720",
    "end": "721880"
  },
  {
    "text": "Event Source applications and it's called the set based consistency validation and it's like that you have",
    "start": "721880",
    "end": "730440"
  },
  {
    "text": "let's say that we have a user entity that it's uh event sourced entity and in",
    "start": "730440",
    "end": "735959"
  },
  {
    "text": "an Event Source system you don't have a table with columns user ID name and",
    "start": "735959",
    "end": "741079"
  },
  {
    "text": "email what you have is a journal with events so let's say that the user ID",
    "start": "741079",
    "end": "746279"
  },
  {
    "text": "here is the unique identifier for this anti and you have the name okay fine and you",
    "start": "746279",
    "end": "752560"
  },
  {
    "text": "have the email address but you want the email address to be unique across all the user entities you don't want two",
    "start": "752560",
    "end": "758920"
  },
  {
    "text": "users using the same email address so you how can I build this uniqueness how",
    "start": "758920",
    "end": "764920"
  },
  {
    "text": "can I have this uniqueness constraint if what all that I have is a journal with",
    "start": "764920",
    "end": "770440"
  },
  {
    "text": "events I don't have a column email in a table where I can say here there is a",
    "start": "770440",
    "end": "775600"
  },
  {
    "text": "constraint this column needs to be unique uh uh has a unique constraint I cannot have that in an event sourc",
    "start": "775600",
    "end": "782279"
  },
  {
    "text": "system and by the way all the entities they leave their own transaction of boundaries so I cannot go into create an",
    "start": "782279",
    "end": "789240"
  },
  {
    "text": "entity and say before create it have a look on all the other entities in the system and check out if uh any other",
    "start": "789240",
    "end": "797199"
  },
  {
    "text": "user is using this email address so it's not possible to do such a thing so we need to do uh we need to think of our",
    "start": "797199",
    "end": "803880"
  },
  {
    "text": "application in another way we need to to solve this problem using something",
    "start": "803880",
    "end": "810320"
  },
  {
    "text": "quite different than what we usually would do with a relational database so",
    "start": "810320",
    "end": "816120"
  },
  {
    "text": "for this example we're going to use a choreography Saga and how what what are the pieces that we're going to have here",
    "start": "816120",
    "end": "821720"
  },
  {
    "text": "first we're going to have a user that will be an event sourced entity then I will have another entity in that case",
    "start": "821720",
    "end": "828240"
  },
  {
    "text": "will be a simple one a value entity that will be a kind of barrier for me it will",
    "start": "828240",
    "end": "833360"
  },
  {
    "text": "be just a unique email the ID of this value entiti will be the email address",
    "start": "833360",
    "end": "839720"
  },
  {
    "text": "and I use that as a barrier to control the fact if it's already used or not if",
    "start": "839720",
    "end": "845839"
  },
  {
    "text": "it was already created it's in Kix it's in the storage I will detect that and I",
    "start": "845839",
    "end": "850920"
  },
  {
    "text": "will be able to say no I cannot create this user because this email is already",
    "start": "850920",
    "end": "856000"
  },
  {
    "text": "in use otherwise if it was not yet created I would be able to create a value entity for this email address and",
    "start": "856000",
    "end": "863440"
  },
  {
    "text": "then I can move forward and create the user and I will use two I will have two",
    "start": "863440",
    "end": "869680"
  },
  {
    "text": "actions with subscriptions subscribing to the events from the user entity and",
    "start": "869680",
    "end": "874839"
  },
  {
    "text": "to the states chain from the unique email value entity and I also use a",
    "start": "874839",
    "end": "881079"
  },
  {
    "text": "timer because in there is an ER condition there is an ER situation where I will it's it will be possible and we",
    "start": "881079",
    "end": "887920"
  },
  {
    "text": "will simulate that that we reserve an email but we don't create the user so now because some error happens in the",
    "start": "887920",
    "end": "895519"
  },
  {
    "text": "system so now I reserved the mail that's one trans transaction I need to create the user but let's imagine that the user",
    "start": "895519",
    "end": "901600"
  },
  {
    "text": "doesn't uh is not created for some reason now I have a reserved email that I need to free so I use a timer for that",
    "start": "901600",
    "end": "910519"
  },
  {
    "text": "so let's first have a look here we're going to have an application controller that will get income request from the",
    "start": "910519",
    "end": "917160"
  },
  {
    "text": "outside and to a request to create a user but before creating the user it",
    "start": "917160",
    "end": "922680"
  },
  {
    "text": "will try to reserve an email address and for that we're going to have",
    "start": "922680",
    "end": "928399"
  },
  {
    "text": "this unique email entity that we will will first call it and if it doesn't",
    "start": "928399",
    "end": "933680"
  },
  {
    "text": "exist we'll reserve it we'll create it for the first time and uh we reserve it",
    "start": "933680",
    "end": "939600"
  },
  {
    "text": "and then we create the user let's have a look at the code so here is my applic application",
    "start": "939600",
    "end": "947160"
  },
  {
    "text": "controller in which I receive a request to create a user here is the command but",
    "start": "947160",
    "end": "952839"
  },
  {
    "text": "before creating the user I will send the commands to this other entity the unique",
    "start": "952839",
    "end": "958920"
  },
  {
    "text": "email entity I I sent this this command which is reserve email that's the ID",
    "start": "958920",
    "end": "965240"
  },
  {
    "text": "email that's the user ID again here I will use Kix client to",
    "start": "965240",
    "end": "972399"
  },
  {
    "text": "talk to this entity and the the unique identifier for this",
    "start": "972399",
    "end": "978680"
  },
  {
    "text": "entity is the email itself so the that gave us the guarantee that there is only",
    "start": "978680",
    "end": "984000"
  },
  {
    "text": "one entity with this email address one unique email entity in my whole Kix",
    "start": "984000",
    "end": "991480"
  },
  {
    "text": "system there is only one associated with this email address is the unique address",
    "start": "991480",
    "end": "996519"
  },
  {
    "text": "of that let's have a look at Reserve methods so first first let me scroll",
    "start": "996519",
    "end": "1002600"
  },
  {
    "text": "back here so this is my this is my value entity it's not an event sourced entity",
    "start": "1002600",
    "end": "1007720"
  },
  {
    "text": "it's like a key value entity and it holds the state of a unique email the",
    "start": "1007720",
    "end": "1013040"
  },
  {
    "text": "unique mail has an address the unique ID of this uh um email",
    "start": "1013040",
    "end": "1019079"
  },
  {
    "text": "the status and eventually it will have a owner this status can be not used",
    "start": "1019079",
    "end": "1025839"
  },
  {
    "text": "reserved and confirmed when I start it has an address because it's the unique",
    "start": "1025839",
    "end": "1033000"
  },
  {
    "text": "ID it it might not be in use when I started for the first time it's not yet",
    "start": "1033000",
    "end": "1038319"
  },
  {
    "text": "in use and therefore it does not have an owner when I hit the reserve matters I",
    "start": "1038319",
    "end": "1046798"
  },
  {
    "text": "would check okay if it's already newed and it's already assigned to another",
    "start": "1046799",
    "end": "1054200"
  },
  {
    "text": "owner then I will emit this error if it's assigned to another owner",
    "start": "1054200",
    "end": "1062520"
  },
  {
    "text": "okay it means that this email was already created and it's assigned already to this owner so I have nothing",
    "start": "1062520",
    "end": "1069039"
  },
  {
    "text": "to do but the last case is okay uh I'm creating this I'm making this",
    "start": "1069039",
    "end": "1075200"
  },
  {
    "text": "reservation for the first time so I take the email here I updated the state of my",
    "start": "1075200",
    "end": "1080440"
  },
  {
    "text": "value entity saying okay that's the address it's reserved that the state and",
    "start": "1080440",
    "end": "1086600"
  },
  {
    "text": "that's the user that is trying to reserve that is trying to use this email so this user here this owner ID is",
    "start": "1086600",
    "end": "1095000"
  },
  {
    "text": "reserving this email address once that",
    "start": "1095000",
    "end": "1101880"
  },
  {
    "text": "finish I execute this call here and then when it completes I will go folder and",
    "start": "1101880",
    "end": "1109039"
  },
  {
    "text": "we'll create the user and what I want to to to achieve",
    "start": "1109039",
    "end": "1116720"
  },
  {
    "text": "here is I first resered the email I create the user and then I will have a",
    "start": "1116720",
    "end": "1122039"
  },
  {
    "text": "subscription listen to user events and then it will see okay a user was created",
    "start": "1122039",
    "end": "1127400"
  },
  {
    "text": "there is an email that was assigned to this user so now from my subscription",
    "start": "1127400",
    "end": "1132679"
  },
  {
    "text": "from my there are two choreography sagas here the first one is this one that we're seeing now so this is small Saga",
    "start": "1132679",
    "end": "1139400"
  },
  {
    "text": "will say oh I saw that the email was assigned to this user so it's time for",
    "start": "1139400",
    "end": "1144720"
  },
  {
    "text": "me now to go to the unique email address and confirm it let's see the code so",
    "start": "1144720",
    "end": "1151360"
  },
  {
    "text": "here I have a user event subscriber it's an action subscribing to events from",
    "start": "1151360",
    "end": "1157440"
  },
  {
    "text": "user entity and for the moment we will look only to this method here when",
    "start": "1157440",
    "end": "1162520"
  },
  {
    "text": "whenever an email assigned event is emitted by the user entity this code",
    "start": "1162520",
    "end": "1168799"
  },
  {
    "text": "will be calleded and what we'll do here say Okay Anil was assigned to this user so let me hit now the value entity the",
    "start": "1168799",
    "end": "1177000"
  },
  {
    "text": "using this email and let's confirm it let's see what this method does so here",
    "start": "1177000",
    "end": "1184799"
  },
  {
    "text": "I'm back into the unique email entity and I call them I will call this method",
    "start": "1184799",
    "end": "1190919"
  },
  {
    "text": "confirm and if it's reserved no so if it's still in that state oops",
    "start": "1190919",
    "end": "1200240"
  },
  {
    "text": "if my email is on the state of the status of my email is reserved well it's",
    "start": "1200520",
    "end": "1205640"
  },
  {
    "text": "time to confirm I just got the information that in my subscriber here I",
    "start": "1205640",
    "end": "1212159"
  },
  {
    "text": "just got the information that this this email got assigned to a user so I can confirm it so here I Chang the status of",
    "start": "1212159",
    "end": "1220960"
  },
  {
    "text": "my email I saved the the states and I'm I'm done here here I change it to confirm",
    "start": "1220960",
    "end": "1230080"
  },
  {
    "text": "now if for some reason when this method is called it my EMA is not confirmed",
    "start": "1230080",
    "end": "1237880"
  },
  {
    "text": "it's not reserved it's has some other state I just ignore it I just move forward because I don't want this",
    "start": "1237880",
    "end": "1244720"
  },
  {
    "text": "methods to fail remember at the poent that I was talking about whenever this",
    "start": "1244720",
    "end": "1250120"
  },
  {
    "text": "event is delivered it it might be delivered more than once to this method so either I confirm or I do nothing but",
    "start": "1250120",
    "end": "1258120"
  },
  {
    "text": "but I don't fail I don't let it fail now back to the slides this is the sunny day",
    "start": "1258120",
    "end": "1264000"
  },
  {
    "text": "scenario everything worked as expected but of course life is not like that",
    "start": "1264000",
    "end": "1269640"
  },
  {
    "text": "sometimes it will happen that you reserve the email address but you fail to create the user so what can we do",
    "start": "1269640",
    "end": "1276159"
  },
  {
    "text": "here so for that we need to build another small Saga that will make sure",
    "start": "1276159",
    "end": "1283520"
  },
  {
    "text": "that this email get unreserved so what we'll do here is is we create yet",
    "start": "1283520",
    "end": "1289679"
  },
  {
    "text": "another action that but this time this action will subscribe to Unique EMA",
    "start": "1289679",
    "end": "1294840"
  },
  {
    "text": "chains and whenever it sees that email was created or is in status reserved it",
    "start": "1294840",
    "end": "1301760"
  },
  {
    "text": "will schedule a time saying okay if it stays like that I will unreserve it",
    "start": "1301760",
    "end": "1308960"
  },
  {
    "text": "let's have a look to at this code now so here is the the other subscriber",
    "start": "1308960",
    "end": "1316960"
  },
  {
    "text": "I have yet again another action subscribing to Value entity of this type",
    "start": "1316960",
    "end": "1323200"
  },
  {
    "text": "here I won't get events but I will get this the full state of this value entity",
    "start": "1323200",
    "end": "1328400"
  },
  {
    "text": "will be delivered to me so the first thing that I do here is to create a timer ID using the email the",
    "start": "1328400",
    "end": "1336000"
  },
  {
    "text": "email is unique as we know and I'm just prefix it with timer just to make it easier to follow in the logs so if the",
    "start": "1336000",
    "end": "1344520"
  },
  {
    "text": "mail is in status reserved reserved here",
    "start": "1344520",
    "end": "1349679"
  },
  {
    "text": "then I will schedule a timer look here I'm creating a call but I'm not calling",
    "start": "1349679",
    "end": "1355679"
  },
  {
    "text": "that yet it's the third call in KX I'm not executing this this not being called it it's",
    "start": "1355679",
    "end": "1361559"
  },
  {
    "text": "lazy I create this call and I will ask Kix to create a timer now for me using",
    "start": "1361559",
    "end": "1369480"
  },
  {
    "text": "the this ID using this delay and with",
    "start": "1369480",
    "end": "1374760"
  },
  {
    "text": "this call so what will happen here for demo I put it on 10 seconds but you can put like five hours if you want you put",
    "start": "1374760",
    "end": "1382640"
  },
  {
    "text": "can put a very large number and uh just to make sure that the this um email get",
    "start": "1382640",
    "end": "1390840"
  },
  {
    "text": "unreserved far in the time in time you don't want to immediately unreserve it",
    "start": "1390840",
    "end": "1396000"
  },
  {
    "text": "because you want your system to be able to to to process the the request so here what we are saying is we",
    "start": "1396000",
    "end": "1404039"
  },
  {
    "text": "telling Kix look uh this is the timer ID",
    "start": "1404039",
    "end": "1409080"
  },
  {
    "text": "in 10 seconds please come and call this unreserved method let's have a look here",
    "start": "1409080",
    "end": "1414320"
  },
  {
    "text": "on the unreserved method I say okay if the state is reserved I will move it",
    "start": "1414320",
    "end": "1420799"
  },
  {
    "text": "back to not use it the the empty state that I have if the",
    "start": "1420799",
    "end": "1427600"
  },
  {
    "text": "state is confirmed of not in use I don't touch it I just return",
    "start": "1427600",
    "end": "1433200"
  },
  {
    "text": "done because I don't want this method to fail either I'm at result in in reserved",
    "start": "1433200",
    "end": "1438679"
  },
  {
    "text": "State and I want to bring it back to the initial state or I just move on here the",
    "start": "1438679",
    "end": "1445279"
  },
  {
    "text": "empty State it's just I erase the user there is no owner anymore and it's not",
    "start": "1445279",
    "end": "1452960"
  },
  {
    "text": "use",
    "start": "1452960",
    "end": "1455200"
  },
  {
    "text": "it and that covers the situation where the user we fail to create the user so",
    "start": "1458720",
    "end": "1465440"
  },
  {
    "text": "after some time the subscriber here the T the scheder the timer that we schedul",
    "start": "1465440",
    "end": "1471279"
  },
  {
    "text": "will unreserve this email address so it can be used by another user now what we really want is to",
    "start": "1471279",
    "end": "1480279"
  },
  {
    "text": "create the user and then we have the timer in one side and then sorry we",
    "start": "1480279",
    "end": "1485399"
  },
  {
    "text": "created the unique mail and then we created the timer to eventually clean up it but then we created the user and but",
    "start": "1485399",
    "end": "1492360"
  },
  {
    "text": "when we create the user we will have the user event subscriber that will confirm the email address",
    "start": "1492360",
    "end": "1498320"
  },
  {
    "text": "and when the email is confirmed the unique email subscriber will also see",
    "start": "1498320",
    "end": "1503600"
  },
  {
    "text": "this change we'll see that an email was updated and now it's confirmed so what it will do at that point it can say okay",
    "start": "1503600",
    "end": "1510799"
  },
  {
    "text": "I had a timer I had a timer that I scheduled to unreserve this email but it's already confirmed so now I can",
    "start": "1510799",
    "end": "1518039"
  },
  {
    "text": "remove the timer so let's go back here and that's what the second here is when",
    "start": "1518039",
    "end": "1524600"
  },
  {
    "text": "I schedul the timer and here is I I receive yet another update of my unique",
    "start": "1524600",
    "end": "1531279"
  },
  {
    "text": "mail and say oh it's confirmed so okay good I can just now cancel the timer",
    "start": "1531279",
    "end": "1537760"
  },
  {
    "text": "it's important to understand here that imagine that you don't do that imagine that you just return here like that I",
    "start": "1537760",
    "end": "1546200"
  },
  {
    "text": "could eventually even comment out this part and say if it's reserved I create a",
    "start": "1546200",
    "end": "1552080"
  },
  {
    "text": "timer if not I just ignore it and that will also work because what going to happen here is is imagine that you don't",
    "start": "1552080",
    "end": "1561799"
  },
  {
    "text": "cancel the timer and then at some point because you register a timer before KX",
    "start": "1561799",
    "end": "1567559"
  },
  {
    "text": "will run this timer and will call this method your email address is confirmed",
    "start": "1567559",
    "end": "1573720"
  },
  {
    "text": "kex calls this method here and it will say ah it's not reserved it's confirmed",
    "start": "1573720",
    "end": "1579960"
  },
  {
    "text": "so it will move to the else and say okay I have nothing to do your code is say okay if you're confirmed I don't have",
    "start": "1579960",
    "end": "1587200"
  },
  {
    "text": "anything to to do I don't need to change the state of my my my unique mail address so you just move on and so the",
    "start": "1587200",
    "end": "1595840"
  },
  {
    "text": "timer you can leave it there and it will fire and your system will still be in a correct state but it's of good practice",
    "start": "1595840",
    "end": "1603039"
  },
  {
    "text": "to just uh clean up timers that are doesn't are not necessary anymore so if",
    "start": "1603039",
    "end": "1609880"
  },
  {
    "text": "it's obsolete timer just remove it because you are saving resource you are saving calls in your system and all that",
    "start": "1609880",
    "end": "1616440"
  },
  {
    "text": "has cost you know so so it's better to just remove it uh what else that I can show here let",
    "start": "1616440",
    "end": "1623159"
  },
  {
    "text": "me see yeah that's that's the the flow we can see here that I have actually two",
    "start": "1623159",
    "end": "1629399"
  },
  {
    "text": "subscriptions and they are not one I I can say here that we have two sagas two",
    "start": "1629399",
    "end": "1635200"
  },
  {
    "text": "tiny sagas one between that make sure that the interaction that data flows",
    "start": "1635200",
    "end": "1640600"
  },
  {
    "text": "from user back to the unique M entity to confirm it and there is another one",
    "start": "1640600",
    "end": "1645919"
  },
  {
    "text": "based on a timer in which which I listen to something and I take a decision okay",
    "start": "1645919",
    "end": "1651600"
  },
  {
    "text": "I have an email that is reserved and um in a few minutes I will unreserve it and",
    "start": "1651600",
    "end": "1658520"
  },
  {
    "text": "if it's already confirmed the unreserve will be um ignore it and if it's still",
    "start": "1658520",
    "end": "1666679"
  },
  {
    "text": "reserved I will free that email address so let's go back to the cause and I want",
    "start": "1666679",
    "end": "1672919"
  },
  {
    "text": "to run it to show uh what happens in this application I want to I want you to",
    "start": "1672919",
    "end": "1679039"
  },
  {
    "text": "see The Saga being executed in the background so the application is running",
    "start": "1679039",
    "end": "1684640"
  },
  {
    "text": "the first thing that I want to to check out is this call here I want to check what is the status of this email",
    "start": "1684640",
    "end": "1691519"
  },
  {
    "text": "address so basically it's saying I I hit this email address and ask okay give me",
    "start": "1691519",
    "end": "1696919"
  },
  {
    "text": "the status and it's saying okay it's not in use there is no owner not in use this email address is free so let's Reserve",
    "start": "1696919",
    "end": "1704279"
  },
  {
    "text": "let's let's create a user this one 001 John do living in Belgium and it will",
    "start": "1704279",
    "end": "1710519"
  },
  {
    "text": "use this email address if I check here I can see that",
    "start": "1710519",
    "end": "1716600"
  },
  {
    "text": "the Saga didn't complete yet because this is this email address is on status reserved let's go back to the our",
    "start": "1716600",
    "end": "1724720"
  },
  {
    "text": "diagram here and what happens here is that we are at that point here no yeah",
    "start": "1724720",
    "end": "1731000"
  },
  {
    "text": "this one we created the email address I believe that at that point the email",
    "start": "1731000",
    "end": "1736600"
  },
  {
    "text": "subscriber got already uh the notification that a unique email address was created was reserved and it created",
    "start": "1736600",
    "end": "1743640"
  },
  {
    "text": "a scheduler to unreserve it and the user was created but the user event",
    "start": "1743640",
    "end": "1750320"
  },
  {
    "text": "subscriber when I did this call here it it didn't yet received the information",
    "start": "1750320",
    "end": "1756720"
  },
  {
    "text": "that the user got an email assign it so it didn't yet confirm my email address",
    "start": "1756720",
    "end": "1762840"
  },
  {
    "text": "so we are actually in this point in time of course what I talk here everything",
    "start": "1762840",
    "end": "1768840"
  },
  {
    "text": "completed already I can now check this one and as we can see it's confirmed and",
    "start": "1768840",
    "end": "1774159"
  },
  {
    "text": "if you check the logs you'll see that the application controller got an email",
    "start": "1774159",
    "end": "1780000"
  },
  {
    "text": "request to check it then I tried to reserve the email address I hited the",
    "start": "1780000",
    "end": "1786240"
  },
  {
    "text": "unique email entity to reserve it then I move forward to create the user ID the",
    "start": "1786240",
    "end": "1792279"
  },
  {
    "text": "the user I created the user here again it's me here interact with the",
    "start": "1792279",
    "end": "1797760"
  },
  {
    "text": "controller the email subscriber receive the information that an email was",
    "start": "1797760",
    "end": "1803240"
  },
  {
    "text": "reserved and then it will schedule a timer to unreserve",
    "start": "1803240",
    "end": "1810679"
  },
  {
    "text": "it but then in the meantime the user events subscriber receiv received the",
    "start": "1810679",
    "end": "1816919"
  },
  {
    "text": "information that an email was assigned to a new user so it goes back and hit",
    "start": "1816919",
    "end": "1822799"
  },
  {
    "text": "the unique email entity and confirm that is in use",
    "start": "1822799",
    "end": "1828440"
  },
  {
    "text": "further now the unique email subscribe receives the information that this email",
    "start": "1828440",
    "end": "1835039"
  },
  {
    "text": "is confirmed meaning that it doesn't need the timer anymore so you say Okay",
    "start": "1835039",
    "end": "1840880"
  },
  {
    "text": "EMA made the red confirm and deleted the timer and the timer is deleted so the",
    "start": "1840880",
    "end": "1846080"
  },
  {
    "text": "that flow happened and we end up in this situation the May got confirmed we Mark",
    "start": "1846080",
    "end": "1853919"
  },
  {
    "text": "the unique email as confirmed and then we cancel the timer so the two sagas here are working in cooperation with",
    "start": "1853919",
    "end": "1860559"
  },
  {
    "text": "each other now let's simulate an error I have this other email address here it's",
    "start": "1860559",
    "end": "1866639"
  },
  {
    "text": "not in use I call it invalid acme.com not in use and I try to create an",
    "start": "1866639",
    "end": "1872360"
  },
  {
    "text": "invalid user so here I'm using a random ID and as you can see the payload is",
    "start": "1872360",
    "end": "1878519"
  },
  {
    "text": "missing the name here I don't have the name if I do this call if execute this",
    "start": "1878519",
    "end": "1883559"
  },
  {
    "text": "call what will going to happen here is be first Reserve this email",
    "start": "1883559",
    "end": "1889320"
  },
  {
    "text": "address but then when we try to create the user it will fail because I'm",
    "start": "1889320",
    "end": "1895399"
  },
  {
    "text": "missing the username I have a condition here when I create my user that the name",
    "start": "1895399",
    "end": "1902559"
  },
  {
    "text": "needs to be f it I did that on propose so we can simulate an error so if I go back here and I try to",
    "start": "1902559",
    "end": "1911080"
  },
  {
    "text": "create this user let's see what happens let's check it's invalid so it's",
    "start": "1911080",
    "end": "1917200"
  },
  {
    "text": "reserved sorry for this random ID and in the meantime here is the error because I had",
    "start": "1917200",
    "end": "1924760"
  },
  {
    "text": "uh wrong payload from my user in the meantime the timer kicks in kicked in",
    "start": "1924760",
    "end": "1930600"
  },
  {
    "text": "and now the emay is unreserved let's check again the status of the email and",
    "start": "1930600",
    "end": "1936720"
  },
  {
    "text": "now it's back as not use it so what happened here is that uh we we got this",
    "start": "1936720",
    "end": "1943080"
  },
  {
    "text": "situation I reserved the email address I failed to create the user and then that",
    "start": "1943080",
    "end": "1949440"
  },
  {
    "text": "other Saga the unique ma subscriber will unreserve it and I have here another user so we",
    "start": "1949440",
    "end": "1958080"
  },
  {
    "text": "remember that this user was created it email is there it's confirmed so it's",
    "start": "1958080",
    "end": "1963399"
  },
  {
    "text": "picked this email is confirmed to be in use by this user user 001 let me try to",
    "start": "1963399",
    "end": "1971480"
  },
  {
    "text": "create another user using the same email address and that will fail because",
    "start": "1971480",
    "end": "1977080"
  },
  {
    "text": "because if I go back to my controller what happens here is that I try to",
    "start": "1977080",
    "end": "1982120"
  },
  {
    "text": "create the second user I try to reserve the email and this method here will fail",
    "start": "1982120",
    "end": "1988080"
  },
  {
    "text": "because my this email is already used that's what we're going to have here",
    "start": "1988080",
    "end": "1994480"
  },
  {
    "text": "it's in use and it's not for this user that I'm trying to create so I return an",
    "start": "1994480",
    "end": "2000360"
  },
  {
    "text": "error and as such this is this fails and because this this call fails",
    "start": "2000360",
    "end": "2007960"
  },
  {
    "text": "this this block here won't be executed and I will move to the exceptional handling where I will emit a",
    "start": "2007960",
    "end": "2015600"
  },
  {
    "text": "message okay this email is already reserved now there is another call here",
    "start": "2015600",
    "end": "2021200"
  },
  {
    "text": "and I let let that for you to if you want to explore a little bit more how",
    "start": "2021200",
    "end": "2026679"
  },
  {
    "text": "can I change an email address it's a similar situation here I'm trying to",
    "start": "2026679",
    "end": "2031799"
  },
  {
    "text": "modify user 001 by changing its email address and here is the same I will",
    "start": "2031799",
    "end": "2037559"
  },
  {
    "text": "first need to reserve this email address and if it's confirmed and if I can reserve it I can move and change my",
    "start": "2037559",
    "end": "2044960"
  },
  {
    "text": "entity and once I change my entity I need to unreserve the previous email",
    "start": "2044960",
    "end": "2050040"
  },
  {
    "text": "address the John do uh I the previous one is do do uh at Acme and I want to",
    "start": "2050040",
    "end": "2059599"
  },
  {
    "text": "move to this other one so I need to First Reserve this I change the user and",
    "start": "2059599",
    "end": "2064760"
  },
  {
    "text": "then I unreserve the previous email address so it can be used by someone else there is also Saga uh Logic for",
    "start": "2064760",
    "end": "2072760"
  },
  {
    "text": "that here in this project but I won't show I will leave it for you to to",
    "start": "2072760",
    "end": "2077960"
  },
  {
    "text": "explore and uh so let's go back here a small recap of choreograph sagas we",
    "start": "2077960",
    "end": "2084280"
  },
  {
    "text": "built choreograph sagas by composing entities being that Event Source",
    "start": "2084280",
    "end": "2089320"
  },
  {
    "text": "entities or key value entities we listen to events or to State Chang using",
    "start": "2089320",
    "end": "2095158"
  },
  {
    "text": "subscriptions and we let the data to flow through our applications one important characteristic of sagas is",
    "start": "2095159",
    "end": "2102359"
  },
  {
    "text": "that once it triggers it it's a flow that propagates through your system like",
    "start": "2102359",
    "end": "2108240"
  },
  {
    "text": "a wave of actions that and commands and events and subscriptions that got chain",
    "start": "2108240",
    "end": "2114240"
  },
  {
    "text": "it in each other and produce a final result so it's something that runs in the background for you you have to",
    "start": "2114240",
    "end": "2120440"
  },
  {
    "text": "encode everything something happens something triggers the first action and then the First Command let's say say",
    "start": "2120440",
    "end": "2127560"
  },
  {
    "text": "that creates a wave of change in your system it's very important to make sure",
    "start": "2127560",
    "end": "2134280"
  },
  {
    "text": "that each part each interaction is uh well tested and that you have thought",
    "start": "2134280",
    "end": "2140560"
  },
  {
    "text": "about all the possible error conditions because since it's a background process you don't want it to keep fading the",
    "start": "2140560",
    "end": "2146800"
  },
  {
    "text": "background because when fade it it start to phas in the background it will block your Saga but it also May block other",
    "start": "2146800",
    "end": "2154119"
  },
  {
    "text": "sagas as well because the subscriptions if you if you have a head of line errors is not if you have a head ofline error",
    "start": "2154119",
    "end": "2161280"
  },
  {
    "text": "is not the that single event that may be block it all the events that happen",
    "start": "2161280",
    "end": "2167119"
  },
  {
    "text": "after this events will also be on hold because your subscription first needs to",
    "start": "2167119",
    "end": "2172760"
  },
  {
    "text": "finish processing that event where it's stuck now so head ofline errors blocks",
    "start": "2172760",
    "end": "2178359"
  },
  {
    "text": "everything and you have to be aware of that and make sure that you don't let them",
    "start": "2178359",
    "end": "2183880"
  },
  {
    "text": "happen now what are the drawbacks of course SES I think it's already implicit",
    "start": "2183880",
    "end": "2189040"
  },
  {
    "text": "in what I just said there are two things here they are hard to debug background process you don't have a to Total",
    "start": "2189040",
    "end": "2196040"
  },
  {
    "text": "visibility of what is happening there you can have your tracing you can have your logs but you don't have a place",
    "start": "2196040",
    "end": "2202359"
  },
  {
    "text": "where to go where you see okay my Saga is at that point in time and and basically the fact that it's hard to",
    "start": "2202359",
    "end": "2209920"
  },
  {
    "text": "track it's what make it uh difficult to the bug so if you want to have more fine",
    "start": "2209920",
    "end": "2215640"
  },
  {
    "text": "grain control over over uh choreogra of your sagas then it's better to implement",
    "start": "2215640",
    "end": "2221400"
  },
  {
    "text": "it using orchestration and that's what we're going to see on the next webinar",
    "start": "2221400",
    "end": "2226440"
  },
  {
    "text": "in the next webinar I will talk about orchestration sagas and I use exactly the same use case but I will implement",
    "start": "2226440",
    "end": "2233640"
  },
  {
    "text": "it using KX workflows which allows you to build orchestration",
    "start": "2233640",
    "end": "2239560"
  },
  {
    "text": "sagas if you want to check out the source code and explore a little bit more you can go to this Q you can scan",
    "start": "2239560",
    "end": "2245560"
  },
  {
    "text": "this QR code points to a GitHub page GitHub project where you have the source",
    "start": "2245560",
    "end": "2251079"
  },
  {
    "text": "code okay thanks for your time we invite you to to join our select channel uh if",
    "start": "2251079",
    "end": "2256640"
  },
  {
    "text": "you have more questions you can reach out to us there otherwise you can also scan that other um QR codes and discover",
    "start": "2256640",
    "end": "2264240"
  },
  {
    "text": "more about Kix thank very much",
    "start": "2264240",
    "end": "2268480"
  }
]