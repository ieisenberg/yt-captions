[
  {
    "start": "0",
    "end": "96000"
  },
  {
    "text": "all right well thank you for coming in this afternoon if you're here for the",
    "start": "210",
    "end": "6000"
  },
  {
    "text": "brigade deep dive session you're in the right place if you're here because you thought there were free donuts that was",
    "start": "6000",
    "end": "11280"
  },
  {
    "text": "a lie you shouldn't trust Twitter I'm just kidding nobody said anything about free donuts",
    "start": "11280",
    "end": "17150"
  },
  {
    "text": "I'm Matt butcher I'm the principal dev at what we call dais labs at Microsoft",
    "start": "17150",
    "end": "24060"
  },
  {
    "text": "we continue on the work that was done at dais Kent ranked Gordon is standing down here in the friend so I've been doing",
    "start": "24060",
    "end": "30900"
  },
  {
    "text": "the work on helm and on scene a band on Omo a.m. but one of the one of the",
    "start": "30900",
    "end": "36660"
  },
  {
    "text": "projects that I have been working on for a long time that is honestly one of my favorite projects that I've done during",
    "start": "36660",
    "end": "41850"
  },
  {
    "text": "my career is Brigade so I'm really excited to get to talk to you all about it today I'm a big coffee snob so pay no",
    "start": "41850",
    "end": "49289"
  },
  {
    "text": "attention to that Starbucks cup I was in a hurry and this is Kent hi I'm Kent I",
    "start": "49289",
    "end": "58699"
  },
  {
    "text": "work for Matt actually and yeah I work on the brigade project as well as other",
    "start": "58699",
    "end": "65250"
  },
  {
    "text": "random open-source things here and they're really into C ICD and automation",
    "start": "65250",
    "end": "71070"
  },
  {
    "text": "in general and you know in my free time I'm a dad and a martial arts instructor",
    "start": "71070",
    "end": "76590"
  },
  {
    "text": "or comic book nerd love Bar trivia and I think Starbucks is fine coffee and I'm",
    "start": "76590",
    "end": "82619"
  },
  {
    "text": "gonna fight me if you want so yeah it is for the record a pumpkin spice latte",
    "start": "82619",
    "end": "88680"
  },
  {
    "text": "because they discontinued the holiday spice flat white so if you wouldn't mind you know complaining on my behalf so",
    "start": "88680",
    "end": "95460"
  },
  {
    "text": "what we're gonna talk about today is well first of all I should ask people in the room are relatively familiar with",
    "start": "95460",
    "end": "102299"
  },
  {
    "start": "96000",
    "end": "536000"
  },
  {
    "text": "Brigade if you are if you are not at all familiar with it we did a session yesterday covering sort of an",
    "start": "102299",
    "end": "109619"
  },
  {
    "text": "introduction all gloss some of that material during my part of the presentation today but you know the",
    "start": "109619",
    "end": "115500"
  },
  {
    "text": "other video and the slides were posted online so you can you can go watch that if you want to get a kind of like",
    "start": "115500",
    "end": "121159"
  },
  {
    "text": "architectural overview and see some great you know first demonstrations of what you can do with it but we're going",
    "start": "121159",
    "end": "127079"
  },
  {
    "text": "to talk about two specific things in here today I'm gonna talk about building custom gateways for brigade",
    "start": "127079",
    "end": "133500"
  },
  {
    "text": "so this is the way to trigger Brigade events and then Kent is going to talk about building a custom worker basically",
    "start": "133500",
    "end": "140130"
  },
  {
    "text": "replacing the JavaScript worker that comes built into brigades so we're really excited about this is actually the first time we've ever spoken",
    "start": "140130",
    "end": "146010"
  },
  {
    "text": "publicly about doing an alternative worker so there's gonna be a fun one for me",
    "start": "146010",
    "end": "151140"
  },
  {
    "text": "more fun for Kent so a high-level architectural overview of Brigade so the",
    "start": "151140",
    "end": "156330"
  },
  {
    "text": "idea with Brigade was that we wanted to build something that essentially worked",
    "start": "156330",
    "end": "162000"
  },
  {
    "text": "like a the analogy we like to use is if kubernetes is an operating system that",
    "start": "162000",
    "end": "168080"
  },
  {
    "text": "is responsible for managing pods running on a cluster or containers running on a",
    "start": "168080",
    "end": "174720"
  },
  {
    "text": "cluster if kubernetes is an operating system one of the interesting things that we have in our existing operating",
    "start": "174720",
    "end": "181560"
  },
  {
    "text": "systems is shell scripting and a shell script is is essentially a way for us to",
    "start": "181560",
    "end": "186840"
  },
  {
    "text": "take the commands that we have in our operating system and chain them together wrap control structures around them",
    "start": "186840",
    "end": "194040"
  },
  {
    "text": "manage the control of the flow of control manage errors be able to respond to events like that we wanted to build",
    "start": "194040",
    "end": "200549"
  },
  {
    "text": "something for kubernetes that felt approximately like a shell scripting",
    "start": "200549",
    "end": "205890"
  },
  {
    "text": "language so and again if you want the details on this go ahead and watch that",
    "start": "205890",
    "end": "211049"
  },
  {
    "text": "video from yesterday but the short version of it is we did we attempted to write something like that using",
    "start": "211049",
    "end": "217080"
  },
  {
    "text": "JavaScript as the shell script language and using this code this sort of event",
    "start": "217080",
    "end": "222390"
  },
  {
    "text": "metaphor like Apple script if you've ever used Apple script on a Mac device right where we can declare some events",
    "start": "222390",
    "end": "230040"
  },
  {
    "text": "so an apple script it's like window gets maximized window gets moved for us it's like something happens on the cluster",
    "start": "230040",
    "end": "236790"
  },
  {
    "text": "and that triggers the script and the script can run in response to it and what the script can do is just like in",
    "start": "236790",
    "end": "244110"
  },
  {
    "text": "an operating system you fire off commands in the cluster you spin up pods",
    "start": "244110",
    "end": "249269"
  },
  {
    "text": "and you execute some stuff on a pod you pipe that data out to another pod you",
    "start": "249269",
    "end": "254310"
  },
  {
    "text": "you you know fan out fan in do whatever fancy kinds of flow control you can do and that's the way that Brigade",
    "start": "254310",
    "end": "260250"
  },
  {
    "text": "essentially works so here's the architectural diagram for what the system actually looks like under the",
    "start": "260250",
    "end": "265320"
  },
  {
    "text": "hood so the green box in the middle is sort of the important one and this is the",
    "start": "265320",
    "end": "270820"
  },
  {
    "text": "controller for brigade the controllers job is to listen for events and spawn",
    "start": "270820",
    "end": "276670"
  },
  {
    "text": "workers to run the scripts so worker is going to execute the script for you the",
    "start": "276670",
    "end": "282580"
  },
  {
    "text": "workers job is run the JavaScript JavaScript says start a new job passive",
    "start": "282580",
    "end": "288340"
  },
  {
    "text": "this information and it's going to execute that whole scripts workflow so it might be responsible for setting up",
    "start": "288340",
    "end": "294430"
  },
  {
    "text": "and tearing down one container or 100 containers or a thousand containers and then managing their life cycle and",
    "start": "294430",
    "end": "300790"
  },
  {
    "text": "collecting the information and controlling the flow so we'll look at a bunch of scripts later on but the then",
    "start": "300790",
    "end": "307720"
  },
  {
    "text": "there's this part way over on the right side here which is the gateways and that",
    "start": "307720",
    "end": "313900"
  },
  {
    "text": "would be the left side stage right okay",
    "start": "313900",
    "end": "319450"
  },
  {
    "text": "the the gateways are the part that basically translates some kind of",
    "start": "319450",
    "end": "324990"
  },
  {
    "text": "happening in to an event that Brigade understands so you can think of some",
    "start": "324990",
    "end": "332080"
  },
  {
    "text": "very trivial ones like the one we'll see a little bit later that just every five minutes triggers an event and that event",
    "start": "332080",
    "end": "338290"
  },
  {
    "text": "gets fired off and the controller sees it and starts up a script to handle that event but you can do more more advanced",
    "start": "338290",
    "end": "345070"
  },
  {
    "text": "ones like listening on web hooks like a github action or a Trello boards web",
    "start": "345070",
    "end": "352570"
  },
  {
    "text": "hook when you drag an event from one place to another and you can use things like that and trigger off events or you",
    "start": "352570",
    "end": "358090"
  },
  {
    "text": "can listen on the kubernetes api and trigger off events earlier this week we published a quick blog post on the open",
    "start": "358090",
    "end": "365380"
  },
  {
    "text": "source Microsoft blog where we where we have a we released a controller this week called buck the brigade universal",
    "start": "365380",
    "end": "372100"
  },
  {
    "text": "controller for kubernetes got to make sure I spell that right and basically it was a brigade controller that listened",
    "start": "372100",
    "end": "379150"
  },
  {
    "text": "for CRD events and responded to them by spitting up scripts so you can basically in minutes prototype a CRT controller",
    "start": "379150",
    "end": "387150"
  },
  {
    "text": "just by writing a little bit of JavaScript so there the controller or",
    "start": "387150",
    "end": "393010"
  },
  {
    "text": "the Gateway system is designed to be fairly flexible to allow you to pick kind of whether you want an event",
    "start": "393010",
    "end": "399249"
  },
  {
    "text": "whether you want to fire off cron jobs and be able to trigger those kinds of things in gateways now one of the design",
    "start": "399249",
    "end": "406329"
  },
  {
    "text": "goals in brigade was to try and make as much of it pluggable and configurable as",
    "start": "406329",
    "end": "411639"
  },
  {
    "text": "possible now of course the scripting language itself we got to make that as as flexible as you can as you can use it",
    "start": "411639",
    "end": "418149"
  },
  {
    "text": "right it should be a full-fledged scripting language you should be able to pull in dependencies from a package manager or things like that",
    "start": "418149",
    "end": "423999"
  },
  {
    "text": "so that's sort of a foregone conclusion but we also wanted to make sure that things like gateways were easy to build",
    "start": "423999",
    "end": "429969"
  },
  {
    "text": "it things like the worker or at least swappable where you could take one out",
    "start": "429969",
    "end": "435309"
  },
  {
    "text": "and put in an alternate implementation so so basically everything in the in the bluish-gray boxes there are things parts",
    "start": "435309",
    "end": "442149"
  },
  {
    "text": "of brigade that you could create your own customize them swap things in and out and really at the end of the day the",
    "start": "442149",
    "end": "448179"
  },
  {
    "text": "controller is the only thing that an absolute must-have for Brigade to be able to work so today I'm going to talk",
    "start": "448179",
    "end": "454089"
  },
  {
    "text": "about the gateways and then in a few moments kenta is going to come up here and talk about creating custom workers so here's",
    "start": "454089",
    "end": "462339"
  },
  {
    "text": "a kind of quick screenshot of a brigade jazz file so it should read basically",
    "start": "462339",
    "end": "467499"
  },
  {
    "text": "like your your traditional java script right I can require in other modules that",
    "start": "467499",
    "end": "473409"
  },
  {
    "text": "brigadiere module is sort of like the base level module that gives you the base level functionality but you can also declare some other dependencies and",
    "start": "473409",
    "end": "480429"
  },
  {
    "text": "pull stuff off of NPM or whatever then we're then we're gonna add an event handler function aptly named handle and",
    "start": "480429",
    "end": "487179"
  },
  {
    "text": "we're going to tie that we're going to bind that to several different events so this is the one from the brigade",
    "start": "487179",
    "end": "492639"
  },
  {
    "text": "universal controller for buck this is the one for buck basically when a CRT comes in you have three possible States",
    "start": "492639",
    "end": "500199"
  },
  {
    "text": "for a CRT and then our error State write a CRT can be a CR instance can be",
    "start": "500199",
    "end": "505839"
  },
  {
    "text": "created can be modified or it can be deleted so this is a very basic piece of",
    "start": "505839",
    "end": "511360"
  },
  {
    "text": "JavaScript that when the Gateway notifies it hey something was added it",
    "start": "511360",
    "end": "516698"
  },
  {
    "text": "fires off this handle function and the handle logs something parses out some",
    "start": "516699",
    "end": "521888"
  },
  {
    "text": "JSON stuff loops through some things but this is basically what a brigade jeaious file looks like nothing particularly",
    "start": "521889",
    "end": "528519"
  },
  {
    "text": "weird or special about it it's just a JavaScript file that uses event handler",
    "start": "528519",
    "end": "533579"
  },
  {
    "text": "so we want to build a gateway and we want a gateway that's gonna take some",
    "start": "533579",
    "end": "540579"
  },
  {
    "start": "536000",
    "end": "587000"
  },
  {
    "text": "happenstance out there and convert it to one of those events now again I'm gonna go back here the events right we've got",
    "start": "540579",
    "end": "547060"
  },
  {
    "text": "events dot on so we've got four there let's create a new one that's basically what we want to do so the process of",
    "start": "547060",
    "end": "554529"
  },
  {
    "text": "building a gateway goes like this we need to figure out what we want to trigger it then for its output we want",
    "start": "554529",
    "end": "562839"
  },
  {
    "text": "it to create a secret inside of kubernetes because on the current version of brigade the way it communicates to the controller is by",
    "start": "562839",
    "end": "568899"
  },
  {
    "text": "generating a secret with all the data in it about the event it received and the controller watches for secrets of a",
    "start": "568899",
    "end": "574600"
  },
  {
    "text": "particular type on them and then we want to be able to run this typically inside of the cluster technically you can watch",
    "start": "574600",
    "end": "581079"
  },
  {
    "text": "the kubernetes event stream from outside but typically we want to run it inside of the cluster so a custom gateway is",
    "start": "581079",
    "end": "592560"
  },
  {
    "start": "587000",
    "end": "780000"
  },
  {
    "text": "the piece that's going to make it possible for you to trigger your own Brigade events based on really whatever",
    "start": "592560",
    "end": "598839"
  },
  {
    "text": "condition you want so if you take a look in the brigade brigade core repository",
    "start": "598839",
    "end": "604480"
  },
  {
    "text": "github comm / brigade core you'll see things like a Trello gateway you'll see",
    "start": "604480",
    "end": "610630"
  },
  {
    "text": "a bit bucket gateway and written by the person sitting in front row you'll see a",
    "start": "610630",
    "end": "616000"
  },
  {
    "text": "cron job gateway that you can give it a particular timestamp and it'll execute the event every time that happens you'll",
    "start": "616000",
    "end": "622449"
  },
  {
    "text": "see cloud events the o2 where something like that gateway that'll listen on",
    "start": "622449",
    "end": "628389"
  },
  {
    "text": "cloud events emitters and handle them but all of them really just follow that same pattern you create a secret and you",
    "start": "628389",
    "end": "634930"
  },
  {
    "text": "inject that secret into kubernetes and you let the controller pick it up so I'm gonna walk through a little bit of code",
    "start": "634930",
    "end": "640630"
  },
  {
    "text": "here on a couple slides to show you how quickly you can create one of these I believe it's exactly 61 lines of code",
    "start": "640630",
    "end": "647380"
  },
  {
    "text": "but I'm gonna clip off the import statements at the top and this is going to be an arrest how many people are",
    "start": "647380",
    "end": "652779"
  },
  {
    "text": "vaguely familiar with rust how many people are vaguely familiar with at least one programming language okay so",
    "start": "652779",
    "end": "659259"
  },
  {
    "text": "this shouldn't be this shouldn't be a problem I'm not doing anything terribly fancy and this is using the cube library",
    "start": "659259",
    "end": "664630"
  },
  {
    "text": "that is also written by someone else who is in this room this is super exciting today so here's basically what",
    "start": "664630",
    "end": "670679"
  },
  {
    "text": "we're going to do we are going to declare two functions a main function and then a handler a generator function",
    "start": "670679",
    "end": "677970"
  },
  {
    "text": "that's going to generate our secret for us and that's really all there's going to be to this controller so this main",
    "start": "677970",
    "end": "684809"
  },
  {
    "text": "function here is going to load our coop config because we're injecting secrets into kubernetes it's going to create a",
    "start": "684809",
    "end": "692009"
  },
  {
    "text": "new kubernetes client gonna make sure it's got access to a namespace and knows which namespace and then it's going to",
    "start": "692009",
    "end": "697980"
  },
  {
    "text": "use a project in Brigade projects art where you store like word groups specific configuration so team a has a",
    "start": "697980",
    "end": "704160"
  },
  {
    "text": "project team B has a project they can keep their credentials and things like that separate that gets loaded at startup time and then we're gonna say",
    "start": "704160",
    "end": "711360"
  },
  {
    "text": "this gateway is going to run every five minutes so we're gonna declare our little sleep time interval there and",
    "start": "711360",
    "end": "716970"
  },
  {
    "text": "we're gonna run this gateway every five minutes and it's going to trigger an event then we go into the aptly-named loop of block which is gonna sit there",
    "start": "716970",
    "end": "724199"
  },
  {
    "text": "stall for five minutes fire off in a bin sit there stall for five minutes fire off another event and",
    "start": "724199",
    "end": "731429"
  },
  {
    "text": "all we're gonna do there is create that secret so if you'd look down at that line that says match API : : v1 secret",
    "start": "731429",
    "end": "737490"
  },
  {
    "text": "all we're doing right in there is saying hey I want to create a new secret here's the body of that secret and and that's",
    "start": "737490",
    "end": "744360"
  },
  {
    "text": "all that's literally all this gateway does waits five minutes creates a secret waits five minutes creates a secret",
    "start": "744360",
    "end": "749790"
  },
  {
    "text": "until you terminate it and here's that generate secret function this is one of the things I absolutely love about",
    "start": "749790",
    "end": "756240"
  },
  {
    "text": "working in rust is that strongly typed language and yet we can just declare our",
    "start": "756240",
    "end": "761850"
  },
  {
    "text": "data structure just like this so I inline the secret and and can base 64",
    "start": "761850",
    "end": "767670"
  },
  {
    "text": "encode everything which is necessary for the kubernetes api and that's all there is to this function so there we go about",
    "start": "767670",
    "end": "774350"
  },
  {
    "text": "61 lines of code we just loop through and we create a secret like this and now",
    "start": "774350",
    "end": "781470"
  },
  {
    "start": "780000",
    "end": "940000"
  },
  {
    "text": "all we're gonna do is create a small piece of JavaScript it's going to run and actually the demo I'm going to show",
    "start": "781470",
    "end": "787559"
  },
  {
    "text": "you does not execute this exact JavaScript the message is going to say hello world and it's going to fire off in an alpine pod instead of just login",
    "start": "787559",
    "end": "794189"
  },
  {
    "text": "to the console but we've got this tiny little snippet of JavaScript it's going to execute every in",
    "start": "794189",
    "end": "799850"
  },
  {
    "text": "so here's how it goes I install and run my gateway so it's out there running in",
    "start": "799850",
    "end": "806030"
  },
  {
    "text": "my cluster and then I install my project in my brigade JS file upload those into",
    "start": "806030",
    "end": "811430"
  },
  {
    "text": "the cluster and then the the gateway is just going to sit there and every five minutes it's going to fire off an event",
    "start": "811430",
    "end": "817280"
  },
  {
    "text": "named interval brigades controller is going to see that and it's going to say all right I'm gonna fire up the handler",
    "start": "817280",
    "end": "822440"
  },
  {
    "text": "for this project and an execute theof the interval event on that and as you can see here the interval event is",
    "start": "822440",
    "end": "828620"
  },
  {
    "text": "basically just going to log something to the output so of course the JavaScript part we can swap in and out with any",
    "start": "828620",
    "end": "835010"
  },
  {
    "text": "JavaScript we want right this is just the demo piece but the important thing here is that we basically created that",
    "start": "835010",
    "end": "840260"
  },
  {
    "text": "gateway that can trigger this kind of thing however we want so I'm gonna show you the output of this because I've been",
    "start": "840260",
    "end": "848330"
  },
  {
    "text": "have been cluttering up Kent's cluster for a little while now and so this is brig term the brig brig",
    "start": "848330",
    "end": "856280"
  },
  {
    "text": "is the brigade command line and it comes with a little terminal thing that will basically update in real time looks like",
    "start": "856280",
    "end": "863000"
  },
  {
    "text": "we've got one interval event in there oh we've got several interval events in there because they've been firing since",
    "start": "863000",
    "end": "868370"
  },
  {
    "text": "I've been talking and we can go in here and take a look at the logs and we'll see it ran that HelloWorld pod and it",
    "start": "868370",
    "end": "876320"
  },
  {
    "text": "printed out hello world wow I know right but as we can see it every time that we",
    "start": "876320",
    "end": "882770"
  },
  {
    "text": "did this interval event ticks we get another one of these created so that's actually all there really is to creating",
    "start": "882770",
    "end": "890930"
  },
  {
    "text": "a new gateway in Brigade so you can imagine that the you know we can take",
    "start": "890930",
    "end": "896300"
  },
  {
    "text": "this same basic pattern and you can write something that will handle web hooks from whatever platform you want or",
    "start": "896300",
    "end": "901760"
  },
  {
    "text": "we'll read off of a Kafka queue and wait for events and then trigger some kind of script that's basically the kind of",
    "start": "901760",
    "end": "907580"
  },
  {
    "text": "thing that we're after when we write new Brigade gateways so I'm going to hand it over to Kent now and he's going to move",
    "start": "907580",
    "end": "912710"
  },
  {
    "text": "it on and talk about workers",
    "start": "912710",
    "end": "915790"
  },
  {
    "text": "okay thanks so Matt did a pretty good job of explaining the role of a worker",
    "start": "918650",
    "end": "924630"
  },
  {
    "text": "and all of this he had those slides with architecture at the beginning so that actually saves me a little bit of",
    "start": "924630",
    "end": "930300"
  },
  {
    "text": "trouble in terms of explaining the role of the worker so what we're gonna do is we're gonna move right on to talking",
    "start": "930300",
    "end": "936510"
  },
  {
    "text": "about how you can customize that worker and we're gonna take three different",
    "start": "936510",
    "end": "941670"
  },
  {
    "text": "approaches to doing that and we're gonna cover each one very quickly so I apologize this is going to be like a",
    "start": "941670",
    "end": "946860"
  },
  {
    "text": "little bit of a whirlwind but you know the first approach that we're going to",
    "start": "946860",
    "end": "951960"
  },
  {
    "text": "use is we're going to use a little bit of configuration to add additional NPM",
    "start": "951960",
    "end": "957000"
  },
  {
    "text": "packages to the default worker image packages that aren't ordinarily there",
    "start": "957000",
    "end": "962930"
  },
  {
    "text": "and then the second approach is going to be you know not entirely dissimilar from",
    "start": "962930",
    "end": "968610"
  },
  {
    "text": "that but we're going to use a docker file to construct a custom worker image",
    "start": "968610",
    "end": "974160"
  },
  {
    "text": "that extends the the default worker and then the third one is going to be a little bit more interesting and in-depth",
    "start": "974160",
    "end": "980010"
  },
  {
    "text": "because we're going to create a custom worker completely from scratch okay so",
    "start": "980010",
    "end": "986460"
  },
  {
    "start": "985000",
    "end": "1108000"
  },
  {
    "text": "just to kind of level set we're going to be using this very simple hello world",
    "start": "986460",
    "end": "992960"
  },
  {
    "text": "Brigade dot j/s script it responds to an exec event which is the event that the",
    "start": "992960",
    "end": "999840"
  },
  {
    "text": "brigh run command typically generates so we're not doing anything fancy here",
    "start": "999840",
    "end": "1005120"
  },
  {
    "text": "everything's going to be done off of the command line there's going to be no source control involved there's no",
    "start": "1005120",
    "end": "1011240"
  },
  {
    "text": "github involved in this there's no UI there's none of that we're trying to keep things very very simple so this is",
    "start": "1011240",
    "end": "1017600"
  },
  {
    "text": "an event that I can generate from the command line and you know you can see that all it's going to do is fire up a",
    "start": "1017600",
    "end": "1023030"
  },
  {
    "text": "new job based on an alpine container and it's going to echo the words hello world so really no big deal",
    "start": "1023030",
    "end": "1030380"
  },
  {
    "text": "I'm a big fan of what I call the Julia Child approach you know taking the finished turkey out of the oven instead",
    "start": "1030380",
    "end": "1037250"
  },
  {
    "text": "of you know I don't want to fumble around in front of you with this brig project create command which is an",
    "start": "1037250",
    "end": "1043339"
  },
  {
    "text": "interactive like interview kind of process do you want this you want this do you want to do that so",
    "start": "1043339",
    "end": "1049100"
  },
  {
    "text": "rather than do that I've pre created a project called hello world and the the",
    "start": "1049100",
    "end": "1056150"
  },
  {
    "text": "bullet points underneath here just kind of enumerate some of the fields that I",
    "start": "1056150",
    "end": "1062000"
  },
  {
    "text": "filled in as I went through that process so if you wanted to duplicate you know these experiments yourself later on this",
    "start": "1062000",
    "end": "1068840"
  },
  {
    "text": "would be how you would do it so I'm just going to go ahead and we're going to say",
    "start": "1068840",
    "end": "1076610"
  },
  {
    "text": "brig run hello world and very unsurprisingly this is going to run",
    "start": "1076610",
    "end": "1087620"
  },
  {
    "text": "something and we can look at the job and we can see that that it actually echoed",
    "start": "1087620",
    "end": "1093740"
  },
  {
    "text": "hello world so no big deal there but what we're going to do as we move on",
    "start": "1093740",
    "end": "1101950"
  },
  {
    "text": "whoops we're going to start adding some",
    "start": "1101950",
    "end": "1108070"
  },
  {
    "start": "1108000",
    "end": "1262000"
  },
  {
    "text": "embellishments to this so the first thing that we're going to do now I don't know why you would do this in real life",
    "start": "1108070",
    "end": "1113660"
  },
  {
    "text": "but for the purposes of demonstration we want to assign random names to the jobs",
    "start": "1113660",
    "end": "1119800"
  },
  {
    "text": "so I'm going to use an NPM package called unique names generator",
    "start": "1119800",
    "end": "1125780"
  },
  {
    "text": "now this NPM package doesn't exist on the defaults Brigade worker image so",
    "start": "1125780",
    "end": "1132440"
  },
  {
    "text": "we've got to get that on there somehow so that my scripts can take advantage of",
    "start": "1132440",
    "end": "1137960"
  },
  {
    "text": "it and the approach that we're going to use this time around is we supply a",
    "start": "1137960",
    "end": "1144080"
  },
  {
    "text": "brigade dot JSON file and this is a little bit of configuration that we can pass in and one of the things that you",
    "start": "1144080",
    "end": "1152120"
  },
  {
    "text": "can do is you can enumerate dependencies that you want to be installed into the container by a pre start hook before",
    "start": "1152120",
    "end": "1159650"
  },
  {
    "text": "your brigade dot j s executes so right here we've said that we want the unique",
    "start": "1159650",
    "end": "1166130"
  },
  {
    "text": "names generator and PM package installed at version four zero zero and I've once",
    "start": "1166130",
    "end": "1174350"
  },
  {
    "text": "again you know using the Julia Child approach I created a project called hello random",
    "start": "1174350",
    "end": "1179790"
  },
  {
    "text": "and you can see here that we have to pass it this little extra bit of configuration this time and we'll go",
    "start": "1179790",
    "end": "1189930"
  },
  {
    "text": "ahead and run that and it's brig rip run I can't sleep today hello random and I",
    "start": "1189930",
    "end": "1200880"
  },
  {
    "text": "forgot to pass it that extra configuration that would have helps and",
    "start": "1200880",
    "end": "1210560"
  },
  {
    "text": "you can see right now it says pre start and it says installing unique names generator four zero zero that was the",
    "start": "1210560",
    "end": "1217350"
  },
  {
    "text": "NPM package we said we wanted it's installing it right now and I'm completely at the mercy of the network",
    "start": "1217350",
    "end": "1223140"
  },
  {
    "text": "and hopefully this does not take forever",
    "start": "1223140",
    "end": "1228350"
  },
  {
    "text": "okay it finished installing it and it says if you look carefully in the output there it says using job name wrong sloth",
    "start": "1231530",
    "end": "1239730"
  },
  {
    "text": "so we successfully generated a random job name and if we actually looked in",
    "start": "1239730",
    "end": "1245160"
  },
  {
    "text": "here in term at our hello random we see a job in there called wrong sloth so",
    "start": "1245160",
    "end": "1256190"
  },
  {
    "text": "all right so the next embellishment that we're going to add to this we're going",
    "start": "1261790",
    "end": "1266960"
  },
  {
    "start": "1262000",
    "end": "1358000"
  },
  {
    "text": "to add some colored output to our Brigade Jas we're going to do that using",
    "start": "1266960",
    "end": "1272929"
  },
  {
    "text": "an NPM package called colors now once again this is an NPM package that doesn't exist on the default worker but",
    "start": "1272929",
    "end": "1279410"
  },
  {
    "text": "this time we're going to take a different approach to getting it there maybe you don't want to go through what",
    "start": "1279410",
    "end": "1284419"
  },
  {
    "text": "we just went through where you have to pull NPM packages down every single time a build runs so maybe you want to",
    "start": "1284419",
    "end": "1292190"
  },
  {
    "text": "pre-bake that stuff into a custom image and that's what I've done here so you",
    "start": "1292190",
    "end": "1297980"
  },
  {
    "text": "see a little docker file over here and up at the top you see that we're basically extending an existing image",
    "start": "1297980",
    "end": "1305120"
  },
  {
    "text": "now ordinarily you would extend the latest release of the brigade worker which i think is one-to-one the the",
    "start": "1305120",
    "end": "1312470"
  },
  {
    "text": "thing and my from directive there is an image that that is built from the head",
    "start": "1312470",
    "end": "1319850"
  },
  {
    "text": "of the master branch of Brigade just because I wanted to be you know living on the edge when I gave the presentation",
    "start": "1319850",
    "end": "1326929"
  },
  {
    "text": "as one does right but the rest of it is pretty simple and you see that what I'm",
    "start": "1326929",
    "end": "1332540"
  },
  {
    "text": "doing is I'm using the run directive to yarn add some additional packages and PM",
    "start": "1332540",
    "end": "1339020"
  },
  {
    "text": "packages that is and the interesting thing is that you could really do anything you wanted here you could add",
    "start": "1339020",
    "end": "1344960"
  },
  {
    "text": "system level packages if you wanted I actually played around for a little while with trying to get image magic to",
    "start": "1344960",
    "end": "1352100"
  },
  {
    "text": "work in my demo but then I was like why would you ever do this and so much so but you could do it so once again I've",
    "start": "1352100",
    "end": "1360830"
  },
  {
    "start": "1358000",
    "end": "1422000"
  },
  {
    "text": "pre created a project this time I called it hello colors and I did something a little bit different this time around",
    "start": "1360830",
    "end": "1366940"
  },
  {
    "text": "during the interview process it asked me if I wanted to configure some advanced",
    "start": "1366940",
    "end": "1373220"
  },
  {
    "text": "options and I said yes and I pointed it in the direction of the the custom worker image that I created so that",
    "start": "1373220",
    "end": "1379250"
  },
  {
    "text": "docker file we were just looking at I already you know Julia Child approach again I already built it and pushed it",
    "start": "1379250",
    "end": "1385820"
  },
  {
    "text": "somewhere and so we're referencing that right here and we can go ahead and run that",
    "start": "1385820",
    "end": "1394189"
  },
  {
    "text": "and this time we don't even really need to poke around in the terminal it's very obvious right here that we got some",
    "start": "1403419",
    "end": "1409690"
  },
  {
    "text": "green text this time around it says using job organic opossum okay so so for",
    "start": "1409690",
    "end": "1423639"
  },
  {
    "start": "1422000",
    "end": "1485000"
  },
  {
    "text": "our third and final approach we're going to try something completely different",
    "start": "1423639",
    "end": "1429009"
  },
  {
    "text": "really the sky's the limit in terms of what you could do with the custom worker",
    "start": "1429009",
    "end": "1434139"
  },
  {
    "text": "as long as you kind of play by the same rules that the default worker plays by so if you consume your configuration",
    "start": "1434139",
    "end": "1442149"
  },
  {
    "text": "from the same sources which happens to be environment variables and kubernetes secrets and as long as you label any",
    "start": "1442149",
    "end": "1449259"
  },
  {
    "text": "pods that you create the same way that the default worker would have you can",
    "start": "1449259",
    "end": "1454299"
  },
  {
    "text": "fool the rest of brigade the controller the dashboard everything you can fool all of it into thinking that those jobs",
    "start": "1454299",
    "end": "1461379"
  },
  {
    "text": "were created by the normal brigade worker so I don't want to get down into",
    "start": "1461379",
    "end": "1467739"
  },
  {
    "text": "the nitty-gritty of all of this because it's really dry and it's really boring but it's all documented so I'll refer",
    "start": "1467739",
    "end": "1472779"
  },
  {
    "text": "you to the documentation if you want to figure out you know one of the environment variables that I should look like what are they named what do they",
    "start": "1472779",
    "end": "1478839"
  },
  {
    "text": "mean what are the labels that I have to put on the pods but using this approach",
    "start": "1478839",
    "end": "1484769"
  },
  {
    "text": "I tackled a problem that keeps coming up over over and over again so you know I",
    "start": "1484769",
    "end": "1492579"
  },
  {
    "start": "1485000",
    "end": "1548000"
  },
  {
    "text": "mentioned earlier in the in the introduction that I'm kind of a CI CD nerd Brigade is by no means just for CI",
    "start": "1492579",
    "end": "1500440"
  },
  {
    "text": "CD but that's something that a lot of people are doing with it and myself",
    "start": "1500440",
    "end": "1505690"
  },
  {
    "text": "included and a lot of people have asked over the last couple years you know what",
    "start": "1505690",
    "end": "1511239"
  },
  {
    "text": "about some kind of support for declarative pipelines I just you know I like the way that circle or Travis or",
    "start": "1511239",
    "end": "1517989"
  },
  {
    "text": "something like that works and I want the same kind of experience on top of brigade you know maybe I don't like to write JavaScript just let me write some",
    "start": "1517989",
    "end": "1524409"
  },
  {
    "text": "gamal I know there's animal haters too but we all we all have our preferences right so so this is an issue that my",
    "start": "1524409",
    "end": "1531700"
  },
  {
    "text": "friend and co-worker Carolyn opened asking for declarative support and I think maybe about a half-dozen",
    "start": "1531700",
    "end": "1538670"
  },
  {
    "text": "people asked me about it yesterday after Matt and reduce talk so this is",
    "start": "1538670",
    "end": "1544790"
  },
  {
    "text": "something that people have been asking for and as it happens I've been working on it on the side and I've created an",
    "start": "1544790",
    "end": "1553100"
  },
  {
    "start": "1548000",
    "end": "1583000"
  },
  {
    "text": "open specification it's really only a draft at the moment but it's an open specification for what declarative",
    "start": "1553100",
    "end": "1560180"
  },
  {
    "text": "pipelines based on containers might look like so you know you can see where that",
    "start": "1560180",
    "end": "1566300"
  },
  {
    "text": "kind of fits in with what Brigade does so I went ahead and created a reference",
    "start": "1566300",
    "end": "1572000"
  },
  {
    "text": "implementation of that specification so it's a Drake spec compliant pipeline executors that also happens to be a",
    "start": "1572000",
    "end": "1579410"
  },
  {
    "text": "Brigade compatible worker so in my very last example here I've created a project",
    "start": "1579410",
    "end": "1587150"
  },
  {
    "text": "called hello Drake and you know you can see the options here that I went through",
    "start": "1587150",
    "end": "1592580"
  },
  {
    "text": "and much as before I pointed the project configuration at a",
    "start": "1592580",
    "end": "1597620"
  },
  {
    "text": "custom image this time the image is love the Drake Brigade worker version 0 21",
    "start": "1597620",
    "end": "1603650"
  },
  {
    "text": "zero I also had to pass it a custom command I don't want to get into why I did that but suffice it to say that if",
    "start": "1603650",
    "end": "1610460"
  },
  {
    "text": "you're not extending the default worker and you're doing something completely different you have to tell it what",
    "start": "1610460",
    "end": "1616070"
  },
  {
    "text": "command to use we'll fix that and Brigade 2.0 but we can't fix it now because it would be a breaking change so",
    "start": "1616070",
    "end": "1625000"
  },
  {
    "text": "but the really really cool thing on this slide for me at least because I don't",
    "start": "1625000",
    "end": "1630050"
  },
  {
    "text": "like JavaScript is that when it asked me for a brigade dot j/s script the thing",
    "start": "1630050",
    "end": "1636410"
  },
  {
    "text": "that I gave it wasn't even JavaScript it was Gamal and when this fire were when",
    "start": "1636410",
    "end": "1642470"
  },
  {
    "text": "this worker fires up it's going to look for quote brigade Jas and what it's",
    "start": "1642470",
    "end": "1648800"
  },
  {
    "text": "going to find is actually Y Amal that it's going to parse and and it's going to drive the the execution of a pipeline",
    "start": "1648800",
    "end": "1655670"
  },
  {
    "text": "which is just a series of jobs it's going to drive all of that based off what it finds in that gamal",
    "start": "1655670",
    "end": "1661280"
  },
  {
    "text": "configuration file and we're actually not going to look at that Gamal right",
    "start": "1661280",
    "end": "1666860"
  },
  {
    "text": "now because I don't want to bury the lead here I'm not trying to hijack the session and turn this into something that's about",
    "start": "1666860",
    "end": "1672790"
  },
  {
    "text": "declarative pipelines I'm using declarative pipeline support as an example of what you could do with a",
    "start": "1672790",
    "end": "1679580"
  },
  {
    "text": "custom worker so without further ado",
    "start": "1679580",
    "end": "1684909"
  },
  {
    "start": "1682000",
    "end": "1780000"
  },
  {
    "text": "we're going to say brig run hello Drake",
    "start": "1685690",
    "end": "1691400"
  },
  {
    "text": "and I'm going to pass it an event called fubar because that happens to be the",
    "start": "1691400",
    "end": "1697880"
  },
  {
    "text": "trigger for the particular pipeline that I'm trying to execute and we see that's",
    "start": "1697880",
    "end": "1703370"
  },
  {
    "text": "running right now and it has run two",
    "start": "1703370",
    "end": "1710420"
  },
  {
    "text": "different jobs called foo and bar it random in sequence so there is some declarative pipeline support there again",
    "start": "1710420",
    "end": "1718460"
  },
  {
    "text": "I don't want to bury the lead here because that's not what this you know talk is about but don't be surprised if",
    "start": "1718460",
    "end": "1726170"
  },
  {
    "text": "support for this makes it into brigade itself sometime in the relatively near",
    "start": "1726170",
    "end": "1731420"
  },
  {
    "text": "future because it's something that people have asked for and you know again to really",
    "start": "1731420",
    "end": "1739130"
  },
  {
    "text": "just bring the focus back to the customization of workers somebody asked",
    "start": "1739130",
    "end": "1744650"
  },
  {
    "text": "me yesterday you know what about brigades supporting BPCL and to have",
    "start": "1744650",
    "end": "1751370"
  },
  {
    "text": "those letters write B is it B PETA it's a business process language I don't know much about it but I said you know what",
    "start": "1751370",
    "end": "1756860"
  },
  {
    "text": "the the way to approach that would be you know by creating a custom worker so come to come to this talk and find out",
    "start": "1756860",
    "end": "1763400"
  },
  {
    "text": "more about that so really the sky's the limit in terms of what you could accomplish with this so that's really",
    "start": "1763400",
    "end": "1770330"
  },
  {
    "text": "all I've got so I'll have Matt come back up in case anybody has questions for either of us but thank you",
    "start": "1770330",
    "end": "1777580"
  },
  {
    "text": "Oh anybody have any questions",
    "start": "1778620",
    "end": "1788750"
  },
  {
    "text": "yep one more time on that well what will",
    "start": "1788750",
    "end": "1813150"
  },
  {
    "text": "the worker is I mean that that's basically what it is the the question is when would you decide between extending",
    "start": "1813150",
    "end": "1820410"
  },
  {
    "text": "the the docker image or creating a custom worker yeah I mean I mean when",
    "start": "1820410",
    "end": "1826260"
  },
  {
    "text": "you extend the the default image you really are creating a custom worker so I",
    "start": "1826260",
    "end": "1831270"
  },
  {
    "text": "I don't know that I'm clearly different your workers written and go right yeah",
    "start": "1831270",
    "end": "1836880"
  },
  {
    "text": "but that but that that's you know in your earlier example you were just layering additional JavaScript libraries",
    "start": "1836880",
    "end": "1843780"
  },
  {
    "text": "on top of the node.js thing if you want to do something slightly more advanced that's probably when you would replace right oh oh oh oh I assume I see what",
    "start": "1843780",
    "end": "1858720"
  },
  {
    "text": "you're saying the that so the design of Brigade is really that you're supposed to offload most of the heavy lifting to",
    "start": "1858720",
    "end": "1865710"
  },
  {
    "text": "jobs you're you're really not I mean you can correct me if I'm wrong on that but I think you're really not supposed to do",
    "start": "1865710",
    "end": "1871590"
  },
  {
    "text": "a whole lot of complicated stuff inside the worker itself under under normal",
    "start": "1871590",
    "end": "1877380"
  },
  {
    "text": "circumstances which is why I actually tried you know with the little embellishments that I put on my hello",
    "start": "1877380",
    "end": "1884190"
  },
  {
    "text": "world j/s that's why I tried to do you know very simple things that seemed like things you might practically do inside",
    "start": "1884190",
    "end": "1891450"
  },
  {
    "text": "the worker like like a library to help me concoct names for the jobs because",
    "start": "1891450",
    "end": "1897570"
  },
  {
    "text": "you're not going to have a job create the name for itself there's kind of a",
    "start": "1897570",
    "end": "1902880"
  },
  {
    "text": "chicken and egg problem there right so yeah try catch",
    "start": "1902880",
    "end": "1908730"
  },
  {
    "text": "retry logic yeah so worker I think you would in general refrain from creating a",
    "start": "1908730",
    "end": "1914710"
  },
  {
    "text": "worker and tell you had a reason you needed to replace something about the way that workers so if you really really",
    "start": "1914710",
    "end": "1920980"
  },
  {
    "text": "wanted a python-based one instead of a JavaScript one yes or if in this case",
    "start": "1920980",
    "end": "1926010"
  },
  {
    "text": "you want a completely declarative language and don't want to even allow your users to script then you know",
    "start": "1926010",
    "end": "1932230"
  },
  {
    "text": "replacing the workers really the only way to do it but you're right really the the intention is that most of the heavy",
    "start": "1932230",
    "end": "1938530"
  },
  {
    "text": "work is always sent off to a job and the job should do that where we can return it back to the to the worker itself",
    "start": "1938530",
    "end": "1945929"
  },
  {
    "text": "sorry I misunderstood that at first though it was a good question that was a great question it's like you know this",
    "start": "1945929",
    "end": "1952840"
  },
  {
    "text": "system through and through and there are I mean there's so there'd be some really",
    "start": "1952840",
    "end": "1958240"
  },
  {
    "text": "interesting things you could do with custom workers to build up something that could process in different kinds of",
    "start": "1958240",
    "end": "1965799"
  },
  {
    "text": "ways right if you if you really wanted to support some kind of other language",
    "start": "1965799",
    "end": "1970990"
  },
  {
    "text": "you should be able to write that but again that would be that's when you really don't want it to don't want the",
    "start": "1970990",
    "end": "1977230"
  },
  {
    "text": "pipeline processing to work the same way like I know one example is you know in the very early days of Brigade like long",
    "start": "1977230",
    "end": "1983950"
  },
  {
    "text": "before I was involved in it like you had contemplated using Lua as the scripting language instead of JavaScript so let's",
    "start": "1983950",
    "end": "1991330"
  },
  {
    "text": "say that you know you want you wanted your users to be scripting their their",
    "start": "1991330",
    "end": "1997270"
  },
  {
    "text": "pipelines in Lua instead of Java scripts like you could make that happen you I",
    "start": "1997270",
    "end": "2004679"
  },
  {
    "text": "think you should pull up the the mo file and just kind of give a quick high-level view of it so people have a visualization of how that looks compared",
    "start": "2004679",
    "end": "2011039"
  },
  {
    "text": "to the Java Script so when one caveat is it workers are slightly more intense",
    "start": "2011039",
    "end": "2016620"
  },
  {
    "text": "because you do have to write the glue code that says ok this when I interpret",
    "start": "2016620",
    "end": "2022440"
  },
  {
    "text": "this yamo file I'm spinning up a new kubernetes job right so you will need to import kubernetes libraries and do stuff",
    "start": "2022440",
    "end": "2028289"
  },
  {
    "text": "like that they're not quite as trivially easy to use as as say just writing a",
    "start": "2028289",
    "end": "2033600"
  },
  {
    "text": "brigade J's file which should be you know a half a dozen lines or so yeah so it so if you're somebody like me who doesn't",
    "start": "2033600",
    "end": "2039670"
  },
  {
    "text": "enjoy JavaScript you might and and if you've worked with things like Travis or",
    "start": "2039670",
    "end": "2045010"
  },
  {
    "text": "circle in the past you might find something like this more palatable it's it's a bit of yamo based on as I said an",
    "start": "2045010",
    "end": "2052960"
  },
  {
    "text": "open specification version zero four zero of that draft and is it's really",
    "start": "2052960",
    "end": "2060610"
  },
  {
    "text": "just basically broken down into two sections you have jobs and you have pipelines and both jobs and pipelines",
    "start": "2060610",
    "end": "2069310"
  },
  {
    "text": "there they're maps of job names two descriptions of the jobs and you know",
    "start": "2069310",
    "end": "2076780"
  },
  {
    "text": "similarly maps of pipeline names two descriptions of the pipeline's so you",
    "start": "2076780",
    "end": "2083260"
  },
  {
    "text": "know this looks pretty unremarkable you know it's it's you give the container a",
    "start": "2083260",
    "end": "2088419"
  },
  {
    "text": "name you tell it what image it's based on what commands to execute any arguments you want to pass to the",
    "start": "2088419",
    "end": "2093580"
  },
  {
    "text": "command and the and the pipelines are really just references to the jobs so",
    "start": "2093580",
    "end": "2100180"
  },
  {
    "text": "this this here literally says execute foo and execute bar and executing bars",
    "start": "2100180",
    "end": "2107530"
  },
  {
    "text": "dependent on successful execution of foo",
    "start": "2107530",
    "end": "2112770"
  },
  {
    "text": "obviously you can do much more complex things than that but this is this is",
    "start": "2112770",
    "end": "2117970"
  },
  {
    "text": "kind of like the hello world yeah alright I think we go ahead",
    "start": "2117970",
    "end": "2125430"
  },
  {
    "text": "if you are executing it from brig you do",
    "start": "2132640",
    "end": "2138369"
  },
  {
    "text": "yes so for the for the purposes of simplicity we didn't involve any source",
    "start": "2138400",
    "end": "2146360"
  },
  {
    "text": "control system and these examples so everything was driven completely off of the command line but in a real-life",
    "start": "2146360",
    "end": "2154130"
  },
  {
    "text": "scenario where the events that are triggering a build might have been",
    "start": "2154130",
    "end": "2160790"
  },
  {
    "text": "something like a push to github or a pull request or something like that both",
    "start": "2160790",
    "end": "2168500"
  },
  {
    "text": "your Brigade Jas script and the brigade dot JSON configuration can just be",
    "start": "2168500",
    "end": "2175220"
  },
  {
    "text": "pulled right from your source code repository so because we omit all of",
    "start": "2175220",
    "end": "2181460"
  },
  {
    "text": "that for the sake of simplicity I had to pass that flag but ordinarily that's not",
    "start": "2181460",
    "end": "2186800"
  },
  {
    "text": "something that you would have to do so literally you give it to github URL and it pulls that data your github",
    "start": "2186800",
    "end": "2192440"
  },
  {
    "text": "repository and loads the Brigade JSON and that Brigade JS file straight out of your github yeah yeah our story yeah",
    "start": "2192440",
    "end": "2201620"
  },
  {
    "text": "there's there's some there's options here micron that fires not yeah",
    "start": "2201620",
    "end": "2210820"
  },
  {
    "text": "no no so the Gateway itself is can be completely ignorant of where any of that data is coming because it's the",
    "start": "2218120",
    "end": "2224180"
  },
  {
    "text": "controller that'll load the project the project file will say oh and before you",
    "start": "2224180",
    "end": "2229640"
  },
  {
    "text": "start up pull this github repository or grab that data out of this config map that's already stored in my cluster or",
    "start": "2229640",
    "end": "2236360"
  },
  {
    "text": "here's a you know base64 encoded blob I'd dump this somewhere on the filesystem first yeah yeah yeah all",
    "start": "2236360",
    "end": "2247580"
  },
  {
    "text": "right I think we're slightly over time but thank you all very much for coming again if you want to get your feet wet",
    "start": "2247580",
    "end": "2253160"
  },
  {
    "text": "on the very beginnings of this the recording from yesterday covers a lot of the basics and Raju who did that one",
    "start": "2253160",
    "end": "2258280"
  },
  {
    "text": "will go through like seven or eight different quick Brigade J s examples to show cool things that you can do with it",
    "start": "2258280",
    "end": "2264200"
  },
  {
    "text": "thank you very much enjoy your afternoon [Applause]",
    "start": "2264200",
    "end": "2271159"
  }
]