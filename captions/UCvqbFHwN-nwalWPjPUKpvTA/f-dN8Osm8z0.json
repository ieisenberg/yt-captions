[
  {
    "start": "0",
    "end": "81000"
  },
  {
    "text": "hi everyone thank you for coming to my talk today so just to level set how many",
    "start": "240",
    "end": "7859"
  },
  {
    "text": "of you know what I mean when I say cabinet raw okay pretty knowledgeable crowd and ARP spoofing yep pretty good",
    "start": "7859",
    "end": "16800"
  },
  {
    "text": "okay right so what I am going to show you this morning is a an exploit that a",
    "start": "16800",
    "end": "27269"
  },
  {
    "text": "chap called Daniel siggy who was working in my team over the summer he discovered",
    "start": "27269",
    "end": "32308"
  },
  {
    "text": "this and we were sufficiently sort of surprised that this was possible that we reported it to the kubernetes security",
    "start": "32309",
    "end": "38969"
  },
  {
    "text": "team and they said yeah it's kind of working as designed but if you wanted to",
    "start": "38969",
    "end": "45059"
  },
  {
    "text": "raise the profile of like it's a gating against this that might be a very good",
    "start": "45059",
    "end": "50219"
  },
  {
    "text": "idea so what I'm going to show you is on a just regular ordinary kubernetes",
    "start": "50219",
    "end": "57629"
  },
  {
    "text": "cluster with default settings a layer to networking plugin and the one thing I",
    "start": "57629",
    "end": "63690"
  },
  {
    "text": "have changed and this is only to make it more reliable as a demo is that out of",
    "start": "63690",
    "end": "69240"
  },
  {
    "text": "the box you would get two instances of core DNS and I've deleted it so there's only one now before I actually show you",
    "start": "69240",
    "end": "77729"
  },
  {
    "text": "that exploit I want to just talk through what's going to happen so I have a",
    "start": "77729",
    "end": "84479"
  },
  {
    "start": "81000",
    "end": "403000"
  },
  {
    "text": "victim pod and the victim pod wants to make some kind of network request to",
    "start": "84479",
    "end": "90930"
  },
  {
    "text": "well in my case to the outside world and when it does let's say a curl",
    "start": "90930",
    "end": "97079"
  },
  {
    "text": "request to example.com it needs to do a DNS lookup and under normal",
    "start": "97079",
    "end": "102899"
  },
  {
    "text": "circumstances that DNS lookup is going to go to a core DNS and core DNS is going to return the IP address",
    "start": "102899",
    "end": "109770"
  },
  {
    "text": "associated with example.com and the victim is going to be able to make its request that's all well and",
    "start": "109770",
    "end": "116579"
  },
  {
    "text": "good and then when we have the exploit and the same thing is going to happen",
    "start": "116579",
    "end": "124799"
  },
  {
    "text": "the victim is going to be trying to make a network request to example comm it's going to do the DNS lookup but this time",
    "start": "124799",
    "end": "132739"
  },
  {
    "text": "my hacker I'm gonna have a hacker pod that is spoofing DNS queries it's gonna receive",
    "start": "132739",
    "end": "140280"
  },
  {
    "text": "the DNS lookup request and it's gonna redirect that request to another pod",
    "start": "140280",
    "end": "146430"
  },
  {
    "text": "that I'm going to set up this called fake alright let's see this happening",
    "start": "146430",
    "end": "153980"
  },
  {
    "text": "hopefully this is going to be big enough - oh honey - if at any point I forget to",
    "start": "153980",
    "end": "159480"
  },
  {
    "text": "change my screens just shout at me okay and I'm just going to run a little",
    "start": "159480",
    "end": "164490"
  },
  {
    "text": "utility that's going to trace out requests for capable flags I'll come",
    "start": "164490",
    "end": "170010"
  },
  {
    "text": "back and talk about that a little bit later though right I'm gonna start my",
    "start": "170010",
    "end": "178430"
  },
  {
    "text": "three pods which are in its directory so",
    "start": "178580",
    "end": "186690"
  },
  {
    "text": "there's my fake pod my hacker pod and my victim pod created and first of all",
    "start": "186690",
    "end": "193260"
  },
  {
    "text": "let's exec into the victim pods run a",
    "start": "193260",
    "end": "199980"
  },
  {
    "text": "shell in that I'm going to run a shell",
    "start": "199980",
    "end": "205770"
  },
  {
    "text": "into my fake pod I need like word exec",
    "start": "205770",
    "end": "210960"
  },
  {
    "text": "that will help they also run a shell in there and we're going to run a shell in",
    "start": "210960",
    "end": "218490"
  },
  {
    "text": "my hacker pod so inside my Victim I can",
    "start": "218490",
    "end": "228270"
  },
  {
    "text": "curl to example.com I hope and we get back some HTML it's",
    "start": "228270",
    "end": "233760"
  },
  {
    "text": "worked it's done a normal Network request okay so I'm going to find out",
    "start": "233760",
    "end": "239460"
  },
  {
    "text": "what the IP address is of my fake destination okay and I'm also going to",
    "start": "239460",
    "end": "246300"
  },
  {
    "text": "set this up so that it can start responding with like some arbitrary",
    "start": "246300",
    "end": "252620"
  },
  {
    "text": "content why don't I say hello you've gone and it's gonna basically",
    "start": "252620",
    "end": "261690"
  },
  {
    "text": "listen on port 80 and respond to network I don't like the look at that",
    "start": "261690",
    "end": "268080"
  },
  {
    "text": "something's gone wrong with my typing don't think the I'm going to just remove that exclamation mark that's probably",
    "start": "268080",
    "end": "274879"
  },
  {
    "text": "bad idea okay alright so my fake pod is",
    "start": "274879",
    "end": "283560"
  },
  {
    "text": "ready to accept web requests and it's going to respond with hello cube con",
    "start": "283560",
    "end": "288800"
  },
  {
    "text": "right in my hacker pod I have a hosts file and I'm just going to change kind",
    "start": "288800",
    "end": "299189"
  },
  {
    "text": "of like a DNS lookup file and I'm going",
    "start": "299189",
    "end": "304469"
  },
  {
    "text": "to say that examples of groups again my",
    "start": "304469",
    "end": "312090"
  },
  {
    "text": "timing is not good today is it let's do that one more time so I'm saying that",
    "start": "312090",
    "end": "324419"
  },
  {
    "text": "example comm is at the IP address that's actually the IP address of my fake pod",
    "start": "324419",
    "end": "332449"
  },
  {
    "text": "right and now I'm going to run a little exploit script all of this is on github",
    "start": "334069",
    "end": "341099"
  },
  {
    "text": "and I'll give you the URL for that later and after we've seen it I will explain",
    "start": "341099",
    "end": "348900"
  },
  {
    "text": "what's going on it's now ready to take over DNS requests and if I go back into",
    "start": "348900",
    "end": "355770"
  },
  {
    "text": "my victim pod and I curl example.com it's a little bit slower than the",
    "start": "355770",
    "end": "361199"
  },
  {
    "text": "request to the normal network but we start seeing the spoof DNS response and",
    "start": "361199",
    "end": "368580"
  },
  {
    "text": "then we see we've been able to apply fake traffic the victim was perfectly",
    "start": "368580",
    "end": "376800"
  },
  {
    "text": "under the impression that it was communicating with example.com but our fake response has arrived instead she's",
    "start": "376800",
    "end": "387479"
  },
  {
    "text": "pretty scary right that's like kind of DNS takeover without changing any",
    "start": "387479",
    "end": "393120"
  },
  {
    "text": "defaults at all okay so let's have a",
    "start": "393120",
    "end": "398819"
  },
  {
    "text": "talk about what's actually happening and first of all we'll talk a little bit",
    "start": "398819",
    "end": "403860"
  },
  {
    "text": "about address resolution protocol and in order to talk about that let's just briefly remind ourselves about the seven",
    "start": "403860",
    "end": "412199"
  },
  {
    "text": "layers of networking we don't really care about all seven layers for this talk we really only care about three",
    "start": "412199",
    "end": "419639"
  },
  {
    "text": "layers the application layer where we're going to make that HTTP request the",
    "start": "419639",
    "end": "427410"
  },
  {
    "text": "network layer that deals in IP traffic and the data link layer which is dealing with Ethernet packets so when our victim",
    "start": "427410",
    "end": "437610"
  },
  {
    "text": "pod makes that request to an a URL DNS",
    "start": "437610",
    "end": "443220"
  },
  {
    "text": "is what translates the human readable name into an IP address and then address",
    "start": "443220",
    "end": "449220"
  },
  {
    "text": "resolution protocol is what takes that IP address and maps it to a MAC address",
    "start": "449220",
    "end": "456050"
  },
  {
    "text": "say there's a ARP table that gets built",
    "start": "456050",
    "end": "461909"
  },
  {
    "text": "up that has these mappings between IP addresses and MAC addresses that unknown",
    "start": "461909",
    "end": "468630"
  },
  {
    "text": "to the local lots of the node so I could take a look at that if I you know what",
    "start": "468630",
    "end": "477840"
  },
  {
    "text": "I'll do it on a different screen this is the same node but I can look at the ARP table screen night dot arrow displays",
    "start": "477840",
    "end": "495229"
  },
  {
    "text": "yes good okay so if we look at the IP",
    "start": "500490",
    "end": "507040"
  },
  {
    "text": "addresses as well odds wide output from",
    "start": "507040",
    "end": "514419"
  },
  {
    "text": "all the namespaces so it's a little bit",
    "start": "514419",
    "end": "521469"
  },
  {
    "text": "because it's wrapped it's a little bit confusing to see but odds are we're interested in there's our core DNS pod",
    "start": "521470",
    "end": "528940"
  },
  {
    "text": "and that's at 10:32 dot zero dot two which is well the second line second",
    "start": "528940",
    "end": "538060"
  },
  {
    "text": "highlighted line there and it's got the being able to fake in there ARP table",
    "start": "538060",
    "end": "545230"
  },
  {
    "text": "it's got the same MAC address as 10.30 to 0.3 which is yeah no no it's not",
    "start": "545230",
    "end": "555940"
  },
  {
    "text": "that's an old one there it is there we go so that's the hacker pot that's kind",
    "start": "555940",
    "end": "563290"
  },
  {
    "text": "of what we saw that aligns with the the exploit we saw",
    "start": "563290",
    "end": "569820"
  },
  {
    "start": "570000",
    "end": "730000"
  },
  {
    "text": "no just to understand what's happening here and how kind of how big the risk is",
    "start": "570090",
    "end": "576640"
  },
  {
    "text": "here let's just revise a little bit about pod networking we start with a",
    "start": "576640",
    "end": "582750"
  },
  {
    "text": "network namespace on the host the route network namespace and it's got some",
    "start": "582750",
    "end": "588480"
  },
  {
    "text": "Ethernet connection to the outside world and it's also got a bridge and the",
    "start": "588480",
    "end": "593530"
  },
  {
    "text": "bridge is what holds that ARP table now we create a pot and the pod also gets a",
    "start": "593530",
    "end": "602320"
  },
  {
    "text": "network name space it has Ethernet connection it's a virtual connection",
    "start": "602320",
    "end": "609430"
  },
  {
    "text": "it's fake but it looks like we've plugged the net cable in from our pod",
    "start": "609430",
    "end": "615490"
  },
  {
    "text": "into that bridge from a networking perspective it's exactly as if there was an Ethernet cable between the two and on",
    "start": "615490",
    "end": "622660"
  },
  {
    "text": "the bridge side there's this virtual Ethernet connection that has a kind of a",
    "start": "622660",
    "end": "628030"
  },
  {
    "text": "MAC address associated with it we create another part we're going to get a",
    "start": "628030",
    "end": "633610"
  },
  {
    "text": "situation we've got another virtual Ethernet link between the bridge and",
    "start": "633610",
    "end": "639680"
  },
  {
    "text": "that pod so if Padre wants to send traffic to pod B it's got an IP address",
    "start": "639680",
    "end": "648950"
  },
  {
    "text": "for pod B well first of all the packet has nowhere else to go other than out of",
    "start": "648950",
    "end": "654650"
  },
  {
    "text": "f0 and through that virtual Ethernet tunnel to the bridge and the bridge does",
    "start": "654650",
    "end": "662390"
  },
  {
    "text": "the art look up do I have an entry in the art table for the IP address of B and if it does it",
    "start": "662390",
    "end": "671240"
  },
  {
    "text": "maps it to that MAC address in this case it's the virtual Ethernet pair for this",
    "start": "671240",
    "end": "678080"
  },
  {
    "text": "pod B and the packet gets routed through that connection and into the pod if pod",
    "start": "678080",
    "end": "685760"
  },
  {
    "text": "a wants to send a packet to some other destination that isn't on this node then",
    "start": "685760",
    "end": "691880"
  },
  {
    "text": "the packet gets routed out of the pod in exactly the same way but when it arrives",
    "start": "691880",
    "end": "697550"
  },
  {
    "text": "at the bridge there is no ARP table entries because the ARP table only has",
    "start": "697550",
    "end": "702740"
  },
  {
    "text": "entries for connections on that bridge and that's only in this node so we can",
    "start": "702740",
    "end": "709880"
  },
  {
    "text": "only have ARP table lookups for pods that are running on this node if X isn't",
    "start": "709880",
    "end": "717020"
  },
  {
    "text": "on this node by kind of definition it can't have an entry in that bridge and",
    "start": "717020",
    "end": "722470"
  },
  {
    "text": "the packets going to just get routed out it becomes a layer 3 problem and I'm not going to dive into that now so if we",
    "start": "722470",
    "end": "731840"
  },
  {
    "text": "want to do I'm not speaking basically all we need to do is pretend that an IP",
    "start": "731840",
    "end": "738080"
  },
  {
    "text": "address is at the MAC address that we're actually living on so if I was pod B I",
    "start": "738080",
    "end": "744500"
  },
  {
    "text": "could pretend that the MAC address of certain V f1 is an IP address but it",
    "start": "744500",
    "end": "753350"
  },
  {
    "text": "isn't really but I'm going to pretend it is and that's what our briefing is and then because we've told the bridge yeah",
    "start": "753350",
    "end": "760010"
  },
  {
    "text": "I own that IP address it's over here on my MAC address the bridge will quite happily send IP packets",
    "start": "760010",
    "end": "766790"
  },
  {
    "text": "to that MAC address so if you're able to send our packets you can take over any",
    "start": "766790",
    "end": "774920"
  },
  {
    "text": "IP address that's on the same node quite",
    "start": "774920",
    "end": "779930"
  },
  {
    "text": "scary so having achieved the ability to do",
    "start": "779930",
    "end": "785839"
  },
  {
    "text": "arts beefing if you're co-located with the DNS service you can fake the you can",
    "start": "785839",
    "end": "794510"
  },
  {
    "text": "ARP spoof the address of that DNS service then you're going to receive those DNS requests and you can L the",
    "start": "794510",
    "end": "804170"
  },
  {
    "text": "requester that the the domain name exists that's some different IP address",
    "start": "804170",
    "end": "810199"
  },
  {
    "text": "from what it actually exists that so if we're making a DNS request on the victim",
    "start": "810199",
    "end": "818690"
  },
  {
    "text": "pod just like before it gets routed through to the bridge or sent through to",
    "start": "818690",
    "end": "824990"
  },
  {
    "text": "the bridge really I should probably shouldn't say reaches the bridge says do I have an entry in my art table for core",
    "start": "824990",
    "end": "832100"
  },
  {
    "text": "DNS his IP address and the hacker pot is being saying yeah I'm over here with core DNS is an IP address send it to me",
    "start": "832100",
    "end": "839329"
  },
  {
    "text": "bridge believes it sends the DNS request to the hacker pod and the hacker pod and",
    "start": "839329",
    "end": "846260"
  },
  {
    "text": "respond with any kind of result it wants to say DNS requests are looking up the",
    "start": "846260",
    "end": "854870"
  },
  {
    "start": "850000",
    "end": "871000"
  },
  {
    "text": "IP address that corresponds for it to it the main name you send that DNS request to the IP address of a DNS service if",
    "start": "854870",
    "end": "863029"
  },
  {
    "text": "you are co-located on the same node as the DNS service you can take over DNS",
    "start": "863029",
    "end": "869959"
  },
  {
    "text": "the best way of preventing this from",
    "start": "869959",
    "end": "875630"
  },
  {
    "text": "happening is to stop the hacker pod from being able to populate information into",
    "start": "875630",
    "end": "882139"
  },
  {
    "text": "that off table and the way you can stop that is by preventing it from being able",
    "start": "882139",
    "end": "888529"
  },
  {
    "text": "to open raw network sockets essentially that cat net raw capability so most of",
    "start": "888529",
    "end": "896149"
  },
  {
    "text": "you put your hands up when we talk when I mentioned cat net raw but just in case there are a",
    "start": "896149",
    "end": "902659"
  },
  {
    "text": "few people who didn't have their hands up happen it raw but is one of a set of",
    "start": "902659",
    "end": "909199"
  },
  {
    "text": "linux capabilities dozens of these capabilities actually haven't counted I'm gonna guess dozens and they give",
    "start": "909199",
    "end": "918849"
  },
  {
    "text": "quite fine-grained privileges inside the Linux kernel percent normal IP traffic",
    "start": "918849",
    "end": "927789"
  },
  {
    "text": "you don't need any special capabilities but if you want to open what's called a",
    "start": "927789",
    "end": "933049"
  },
  {
    "text": "raw socket and if you want to send packets directly at that Ethernet level",
    "start": "933049",
    "end": "938269"
  },
  {
    "text": "you need the cat network privilege so",
    "start": "938269",
    "end": "943759"
  },
  {
    "start": "942000",
    "end": "1140000"
  },
  {
    "text": "one way we can prevent this from happening is to drop that capability",
    "start": "943759",
    "end": "948789"
  },
  {
    "text": "behind default and kubernetes get all the capabilities have to explicitly drop",
    "start": "948789",
    "end": "956539"
  },
  {
    "text": "them and we could do that with a [Music] security context in the pod definition",
    "start": "956539",
    "end": "963039"
  },
  {
    "text": "so if I can figure out how to change the screen again this is where this is why I",
    "start": "963039",
    "end": "970909"
  },
  {
    "text": "was running this tracer application up in this top window this is a new EBP eff",
    "start": "970909",
    "end": "979519"
  },
  {
    "text": "based open-source project that we've just released a couple of weeks ago it's",
    "start": "979519",
    "end": "984889"
  },
  {
    "text": "still very experimental it's called Tracy and it lets us trace out kernel events and wealth system",
    "start": "984889",
    "end": "992869"
  },
  {
    "text": "calls and some kernel events one of which is capable which is the event that",
    "start": "992869",
    "end": "998419"
  },
  {
    "text": "happens when you're checking whether you've got certain set of capabilities",
    "start": "998419",
    "end": "1004169"
  },
  {
    "text": "so we can see a ton of these checks to see whether or not the process has cat",
    "start": "1004169",
    "end": "1011439"
  },
  {
    "text": "net raw and that's basically happening every time it wants to send one of these art packets it just stop this for from",
    "start": "1011439",
    "end": "1019959"
  },
  {
    "text": "now and I'm going to run a where it is",
    "start": "1019959",
    "end": "1027959"
  },
  {
    "text": "yeah I've got a pod definition just like the one I showed you on the screen which is",
    "start": "1027959",
    "end": "1034069"
  },
  {
    "text": "dropping that net raw capability so if I",
    "start": "1034069",
    "end": "1039490"
  },
  {
    "text": "run that one and in all other respects",
    "start": "1039490",
    "end": "1049190"
  },
  {
    "text": "it's exactly the same as the hacker pada Shoji I need to executor that though",
    "start": "1049190",
    "end": "1061970"
  },
  {
    "text": "this one is going to be called hacker drop cap hey and if I run the exploit",
    "start": "1061970",
    "end": "1070610"
  },
  {
    "text": "this time what we're going to see is it will fail because it's going to make",
    "start": "1070610",
    "end": "1076820"
  },
  {
    "text": "that first cat net rule request and that's going to be failed and basically the exploit code doesn't know how to",
    "start": "1076820",
    "end": "1082639"
  },
  {
    "text": "deal with that so there we go there is the cat net raw check that failed so you",
    "start": "1082639",
    "end": "1094039"
  },
  {
    "text": "might be thinking but I'm not gonna run this crazy like why would I run this crazy hacker pod on my cluster that",
    "start": "1094039",
    "end": "1099169"
  },
  {
    "text": "would be madness of course it would be madness I'm not suggesting you're going to run the hacker pod I'm suggesting",
    "start": "1099169",
    "end": "1104269"
  },
  {
    "text": "that somebody might compromise a pod in your cluster and run something like this",
    "start": "1104269",
    "end": "1111460"
  },
  {
    "text": "without you intending them to you so suppose you have a pod that has some",
    "start": "1111460",
    "end": "1119029"
  },
  {
    "text": "kind of vulnerability and an attacker is able to get into that pod through that",
    "start": "1119029",
    "end": "1126529"
  },
  {
    "text": "vulnerability maybe they're gonna start running code like this hacker pod but if you have removed the cat net or",
    "start": "1126529",
    "end": "1133519"
  },
  {
    "text": "capability they won't be able to do this particular exploit so that would be good",
    "start": "1133519",
    "end": "1140408"
  },
  {
    "start": "1140000",
    "end": "1162000"
  },
  {
    "text": "security context or a you know a bit of a pain to manage you could have a pod",
    "start": "1141039",
    "end": "1147980"
  },
  {
    "text": "security policy that requires making sure that you have dropped the net bra",
    "start": "1147980",
    "end": "1153980"
  },
  {
    "text": "on all your pods or at least on all the pods that you don't explicitly need to be opening raw sockets I also looked",
    "start": "1153980",
    "end": "1164650"
  },
  {
    "start": "1162000",
    "end": "1239000"
  },
  {
    "text": "at the gatekeeper admission controller this is anybody here using gatekeeper",
    "start": "1164650",
    "end": "1170550"
  },
  {
    "text": "okay very small number of hands so gatekeeper is using open policy agent",
    "start": "1170550",
    "end": "1177550"
  },
  {
    "text": "which we heard about in their keynotes this morning and it has a variety of these different reg oh and plates making",
    "start": "1177550",
    "end": "1186430"
  },
  {
    "text": "it easy to use open policy agent basically and they have this get what",
    "start": "1186430",
    "end": "1192610"
  },
  {
    "text": "with this repo called pod security policies it sounds really encouraging it",
    "start": "1192610",
    "end": "1198070"
  },
  {
    "text": "says it contains the common policies needed in pod security policy but implemented as constraints and",
    "start": "1198070",
    "end": "1205030"
  },
  {
    "text": "constraint templates with gatekeeper I thought yeah this would be really cool we could use gatekeeper to make sure",
    "start": "1205030",
    "end": "1212920"
  },
  {
    "text": "pods don't have that cat net rule capability except it does all the things",
    "start": "1212920",
    "end": "1220690"
  },
  {
    "text": "in pod security policy except Linux capabilities which I was bit",
    "start": "1220690",
    "end": "1227020"
  },
  {
    "text": "disappointed about they may be at some point that will be added to gatekeeper",
    "start": "1227020",
    "end": "1233020"
  },
  {
    "text": "but right now that is not a solution that will fix this particular problem for us so you've got this security",
    "start": "1233020",
    "end": "1243940"
  },
  {
    "start": "1239000",
    "end": "1252000"
  },
  {
    "text": "context option there are also a couple of things you can do at the network layer to prevent this exploit from being",
    "start": "1243940",
    "end": "1250990"
  },
  {
    "text": "possible one is that you can use a layer",
    "start": "1250990",
    "end": "1256180"
  },
  {
    "start": "1252000",
    "end": "1357000"
  },
  {
    "text": "3 networking plugin and if again I can figure out how to sort switch screens I",
    "start": "1256180",
    "end": "1264520"
  },
  {
    "text": "have another single node cluster running",
    "start": "1264520",
    "end": "1269740"
  },
  {
    "text": "this one leave as can okay running so",
    "start": "1269740",
    "end": "1278080"
  },
  {
    "text": "let's just look at the cube system namespace yes so this is using Calico",
    "start": "1278080",
    "end": "1285040"
  },
  {
    "text": "which is a layer 3 networking plugin and if I try to I'm running the exact same",
    "start": "1285040",
    "end": "1292300"
  },
  {
    "text": "hacker pod here and if I go into that one and I try running",
    "start": "1292300",
    "end": "1298960"
  },
  {
    "text": "exploits its going to tell us something",
    "start": "1298960",
    "end": "1304510"
  },
  {
    "text": "that isn't exactly true it thinks that it's running on a different node from",
    "start": "1304510",
    "end": "1310179"
  },
  {
    "text": "keep DNS that's not true it says keep DNS it means the DNS service for kube it's actually called",
    "start": "1310179",
    "end": "1316510"
  },
  {
    "text": "ENS and there's a single no cluster so I know for sure they are running on the",
    "start": "1316510",
    "end": "1322990"
  },
  {
    "text": "same node but what it means is from the wallets expectations are it's not on the",
    "start": "1322990",
    "end": "1330789"
  },
  {
    "text": "same it's not on the same bridge say and you can see here there's some yeah this",
    "start": "1330789",
    "end": "1337600"
  },
  {
    "text": "is not a MAC address that you could then packets to so if you were using a layer",
    "start": "1337600",
    "end": "1343690"
  },
  {
    "text": "3 network plug-in you are safe from this exploits how many of you using layer 2",
    "start": "1343690",
    "end": "1351570"
  },
  {
    "text": "how many of you don't know ok all right",
    "start": "1351570",
    "end": "1358480"
  },
  {
    "start": "1357000",
    "end": "1386000"
  },
  {
    "text": "there is another thing that you can do to make this exploit go away which is",
    "start": "1358480",
    "end": "1363880"
  },
  {
    "text": "you can configure core DNS to use TLS that's actually a pretty simple configuration change and that at least",
    "start": "1363880",
    "end": "1372880"
  },
  {
    "text": "when I tried it it prevented the exploits I don't know if it's possible for that exploits or somehow get hold of",
    "start": "1372880",
    "end": "1378340"
  },
  {
    "text": "those certificates but that certainly seemed to prevent prevent the exploit at",
    "start": "1378340",
    "end": "1384850"
  },
  {
    "text": "of the box so in summary if you're using a layer 2",
    "start": "1384850",
    "end": "1392260"
  },
  {
    "start": "1386000",
    "end": "1419000"
  },
  {
    "text": "network plug-in and you have a pod that gets compromised and it happens to be",
    "start": "1392260",
    "end": "1398380"
  },
  {
    "text": "running on the same node as your DNS service if that compromised pod has cat",
    "start": "1398380",
    "end": "1405850"
  },
  {
    "text": "net raw that compromised pod could take over your DNS service and could ruin",
    "start": "1405850",
    "end": "1411640"
  },
  {
    "text": "Internet traffic from other pods on that node and that would be a bad day at the",
    "start": "1411640",
    "end": "1417610"
  },
  {
    "text": "office all right so you might be wondering how can I tell whether my",
    "start": "1417610",
    "end": "1423460"
  },
  {
    "start": "1419000",
    "end": "1575000"
  },
  {
    "text": "cluster is affected apart from whether or not it's you know you might know whether you're running layer 2 or layer",
    "start": "1423460",
    "end": "1429549"
  },
  {
    "text": "3 plug it you could try the exploit for yourself",
    "start": "1429549",
    "end": "1434990"
  },
  {
    "text": "because I'm gonna give you the URL so you can try running it yourself we've",
    "start": "1434990",
    "end": "1440180"
  },
  {
    "text": "also built a test for this in to keep hunter okay can we get a hands up if",
    "start": "1440180",
    "end": "1446570"
  },
  {
    "text": "you've heard of keep hunter okay maybe about half of you so cube Hunter is a project that we built that does",
    "start": "1446570",
    "end": "1453880"
  },
  {
    "text": "penetration testing for kubernetes clusters and it has a whole series of",
    "start": "1453880",
    "end": "1459320"
  },
  {
    "text": "things that it will attempt to do and report back whether it found anything that's maybe misconfigured or that kind",
    "start": "1459320",
    "end": "1468560"
  },
  {
    "text": "of leaks information or is an outright vulnerability and we added a test for",
    "start": "1468560",
    "end": "1476240"
  },
  {
    "text": "this ops well two tests one for the ARP spoofing on one for the DNS spoofing and I hope if I find the right screen I've",
    "start": "1476240",
    "end": "1492230"
  },
  {
    "text": "got some logs I hope yeah so this was a result of me",
    "start": "1492230",
    "end": "1501380"
  },
  {
    "text": "running the keep hunter on that first node with the layer two again say let's",
    "start": "1501380",
    "end": "1509360"
  },
  {
    "text": "just get the logs from that and looks a",
    "start": "1509360",
    "end": "1518720"
  },
  {
    "text": "bit big let's try making this so you can see that it was able to it tested to",
    "start": "1518720",
    "end": "1526820"
  },
  {
    "text": "find out that it could use cap net raw and that there's a possibility of ARP",
    "start": "1526820",
    "end": "1533240"
  },
  {
    "text": "spoofing and a possibility of DNS spoofing so to run keep hunter to bec",
    "start": "1533240",
    "end": "1540770"
  },
  {
    "text": "this effectively you actually run cube hunter as a job inside the cluster you",
    "start": "1540770",
    "end": "1548500"
  },
  {
    "text": "can also run keep hunter external to the cluster and it will do various tests but",
    "start": "1548500",
    "end": "1554960"
  },
  {
    "text": "this is not one of the tests that it can effectively test it has to be inside the cluster but hopefully you will find that",
    "start": "1554960",
    "end": "1562130"
  },
  {
    "text": "useful to establish whether or not for example your default service",
    "start": "1562130",
    "end": "1568730"
  },
  {
    "text": "accounts all the service accounts that you use allow cabinet cabinet raw so",
    "start": "1568730",
    "end": "1577840"
  },
  {
    "text": "I've shown you a whole load of things there which I kind of hope at least some",
    "start": "1577840",
    "end": "1584180"
  },
  {
    "text": "of you will go away and try out for yourselves so the three links there the",
    "start": "1584180",
    "end": "1590600"
  },
  {
    "text": "first one is that exploits itself so that's under Daniel Sagi's repo and it's",
    "start": "1590600",
    "end": "1596630"
  },
  {
    "text": "a well you saw it's a Python exploit and it has all the configuration for the hacker pod and the victim pod there's",
    "start": "1596630",
    "end": "1606380"
  },
  {
    "text": "cube hunter penetration testing and Tracy which is this new tool for tracing",
    "start": "1606380",
    "end": "1612230"
  },
  {
    "text": "out events using EBP F we would love feedback in particular on Tracy because",
    "start": "1612230",
    "end": "1617630"
  },
  {
    "text": "we've only released that a couple of weeks ago just yesterday I had conversations with three different",
    "start": "1617630",
    "end": "1623930"
  },
  {
    "text": "people who had three really interesting ideas about things we could do with Tracy so I'm really really interested to",
    "start": "1623930",
    "end": "1630410"
  },
  {
    "text": "hear what your ideas are around that as well and I've also mentioned that",
    "start": "1630410",
    "end": "1635420"
  },
  {
    "text": "tomorrow morning myself and Michael housing blasts are going to be signing",
    "start": "1635420",
    "end": "1640640"
  },
  {
    "text": "books the book that we wrote about kubernetes security so come and pick up a copy of that tomorrow with that I",
    "start": "1640640",
    "end": "1648740"
  },
  {
    "text": "think we have a few minutes for questions don't make them too hard",
    "start": "1648740",
    "end": "1654880"
  },
  {
    "text": "thanks Liz on the schedule app you can rate this stock so if you enjoyed the",
    "start": "1654880",
    "end": "1660920"
  },
  {
    "text": "stock give it a happy face and provide feedback and that helps that helps speakers with their future events",
    "start": "1660920",
    "end": "1667460"
  },
  {
    "text": "alright first hand that I saw is over here and thank you for coming everyone",
    "start": "1667460",
    "end": "1677789"
  },
  {
    "text": "yeah thanks for the talk any legitimate",
    "start": "1677789",
    "end": "1686609"
  },
  {
    "text": "use of Capra that we might want it's",
    "start": "1686609",
    "end": "1695789"
  },
  {
    "text": "hard to think of why you would want to be low-level networking has an",
    "start": "1695789",
    "end": "1701999"
  },
  {
    "text": "application I could believe there would be things in you know the sort of system infrastructure",
    "start": "1701999",
    "end": "1707580"
  },
  {
    "text": "I don't immediately have an example at the application layer I really don't",
    "start": "1707580",
    "end": "1712679"
  },
  {
    "text": "think so Diagnostics there's a great example hi I",
    "start": "1712679",
    "end": "1723109"
  },
  {
    "text": "was wondering is there any configurations that you had to do with",
    "start": "1723109",
    "end": "1730559"
  },
  {
    "text": "calico in order to mitigate the there no just by installing it so what I'm free",
    "start": "1730559",
    "end": "1736259"
  },
  {
    "text": "of the bug yeah the reason why that works is because the MAC addresses are",
    "start": "1736259",
    "end": "1742739"
  },
  {
    "text": "not it's not like a single lookup from Oh from the root bridge to it from it",
    "start": "1742739",
    "end": "1751710"
  },
  {
    "text": "looks from the perspective of this exploit as if your pods are actually on different nodes they're not but the way",
    "start": "1751710",
    "end": "1757619"
  },
  {
    "text": "it goes up to lay up three and back again in calico I see um I'm happy not",
    "start": "1757619",
    "end": "1763340"
  },
  {
    "text": "thank you yes right with those happy faces and if if you're unhappy come and",
    "start": "1763340",
    "end": "1769289"
  },
  {
    "text": "speak to me so a very much a cube nuba",
    "start": "1769289",
    "end": "1774749"
  },
  {
    "text": "here am i and I'm just wondering like if you know or if anybody knows of why you",
    "start": "1774749",
    "end": "1782129"
  },
  {
    "text": "wouldn't just use layer three networking all the time it seems kind of foolish to even have a broadcast domain inside your",
    "start": "1782129",
    "end": "1788070"
  },
  {
    "text": "cluster is there performance reasons to prefer having layer 2 networking over",
    "start": "1788070",
    "end": "1793080"
  },
  {
    "text": "layer three for some workloads I'm sure there are networking experts who can answer that question better than",
    "start": "1793080",
    "end": "1799769"
  },
  {
    "text": "I can I think there are concerns about whether it's Foreman or not and I'm sure there",
    "start": "1799769",
    "end": "1805139"
  },
  {
    "text": "are a layer 3 people who will tell you it though that's not a concern so find a networking person goes to the CNI",
    "start": "1805139",
    "end": "1813040"
  },
  {
    "text": "Risa great talk thank you I was wondering if",
    "start": "1813040",
    "end": "1820690"
  },
  {
    "text": "you could take the same sort of exploit and use it in layer three by trying to",
    "start": "1820690",
    "end": "1828630"
  },
  {
    "text": "publish a BGP route to the DNS pod I don't know if yeah do you know if that",
    "start": "1828630",
    "end": "1834490"
  },
  {
    "text": "could be done we haven't tried it I've kind of wondered the same question we haven't actually exploded yet but let's",
    "start": "1834490",
    "end": "1842770"
  },
  {
    "text": "hope not because that's how security works right we just cross our fingers and hope yeah all right any more yes one",
    "start": "1842770",
    "end": "1855310"
  },
  {
    "text": "I left is there any drawback of dropping",
    "start": "1855310",
    "end": "1863140"
  },
  {
    "text": "a cap natural capability other than as the empress stuff doesn't work always",
    "start": "1863140",
    "end": "1868420"
  },
  {
    "text": "worth clicking tzitzit dear buyers is there any",
    "start": "1868420",
    "end": "1875280"
  },
  {
    "text": "disadvantage of dropping calculate or oto VD right and so the only thing that",
    "start": "1875280",
    "end": "1882280"
  },
  {
    "text": "you can't do if you drop that privilege is open raw sockets so unless you have a",
    "start": "1882280",
    "end": "1890110"
  },
  {
    "text": "reason to so do that there is no disadvantage some of the",
    "start": "1890110",
    "end": "1895540"
  },
  {
    "text": "capabilities are a bit like kind of tied up into more than one thing but this",
    "start": "1895540",
    "end": "1900910"
  },
  {
    "text": "particular one is very straightforward so unless you have a reason to write Ethernet packets completely fine I",
    "start": "1900910",
    "end": "1910440"
  },
  {
    "text": "actually believe that the sea and ice actually need that kind of capabilities",
    "start": "1912300",
    "end": "1918670"
  },
  {
    "text": "I'm pretty sure they do so you cannot remove completely out of your ecosystem",
    "start": "1918670",
    "end": "1923860"
  },
  {
    "text": "likewise you see and I want well that is a very good point that application pods",
    "start": "1923860",
    "end": "1929110"
  },
  {
    "text": "have no reason to do that the system pods yes",
    "start": "1929110",
    "end": "1933660"
  },
  {
    "text": "I'm also really new to karate so I don't know the networking details and clearly the problem is a shared ARP table that's",
    "start": "1941059",
    "end": "1947610"
  },
  {
    "text": "the exploit but is the ARP table actually in the bridge or is it somewhere else because normally in most",
    "start": "1947610",
    "end": "1954960"
  },
  {
    "text": "network I don't see the ARP tables the bridges are actually associated the interfaces each Universal machine model they're those places is the bridge",
    "start": "1954960",
    "end": "1962519"
  },
  {
    "text": "really where that our table is in the stack my understanding is that it they",
    "start": "1962519",
    "end": "1968190"
  },
  {
    "text": "would stand to be corrected yeah I'm new to this so I don't know either how this looks it stands out all right happy",
    "start": "1968190",
    "end": "1982019"
  },
  {
    "text": "faces everyone right thank you very much",
    "start": "1982019",
    "end": "1988250"
  },
  {
    "text": "[Applause]",
    "start": "1988250",
    "end": "1990859"
  }
]