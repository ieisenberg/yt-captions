[
  {
    "text": "everyone thank you for coming today my name is jameses strong we're going to talk about understanding kubernetes networking in 30 minutes or as I like to",
    "start": "160",
    "end": "5960"
  },
  {
    "text": "call a Mario speedrun through kubernetes networking um my name is James strong",
    "start": "5960",
    "end": "12160"
  },
  {
    "text": "like I said I've already done that I'm a Solutions architect at ISO valent now which is a part of Cisco I am a",
    "start": "12160",
    "end": "18439"
  },
  {
    "text": "maintainer of Ingress and gentic so if you have any questions about that uh ask me in an hour at my next talk um so I",
    "start": "18439",
    "end": "23840"
  },
  {
    "text": "won't be taking those questions I'm also the author of networking kubernetes I have an A CL Guru course on the same",
    "start": "23840",
    "end": "29080"
  },
  {
    "text": "thing and um unfortunately uh I could not bring my gimly cosplay here but I do have a full gimly cosplay",
    "start": "29080",
    "end": "36000"
  },
  {
    "text": "outfit cool my name is Ricardo I am a software engineer at vmb broadcom uh I",
    "start": "36000",
    "end": "41879"
  },
  {
    "text": "have created the cook I don't know if someone still uses that like it's kind of broken those days like Ingress like",
    "start": "41879",
    "end": "47680"
  },
  {
    "text": "Ingress in gyx I'm one of the maintainers of Ingress in gyx so everything that I touch usually breaks sorry and I breaks it I approve it yeah",
    "start": "47680",
    "end": "55320"
  },
  {
    "text": "and I am a Lego Enthusiast so I I love Legos so today we going to talk about",
    "start": "55320",
    "end": "61199"
  },
  {
    "text": "understanding Linux uh kubernetes networking but one of the when I was first learning kubernetes one of the old",
    "start": "61199",
    "end": "66479"
  },
  {
    "text": "adages was that you know kubernetes is just Linux and um sorry for any of the windows folks out there we will not be",
    "start": "66479",
    "end": "72400"
  },
  {
    "text": "talking about that one and when we say this um I like to",
    "start": "72400",
    "end": "77720"
  },
  {
    "text": "bring up this picture I found this is a great one for the talk um for those who don't know this is the data flow of a packet through the kernel so um was",
    "start": "77720",
    "end": "84799"
  },
  {
    "text": "setting the bar really low for us so let's strap in so agenda we're going to talk about",
    "start": "84799",
    "end": "90960"
  },
  {
    "text": "Linux networking we're going to talk about what a pod is what's uh what part of it is and talk about container",
    "start": "90960",
    "end": "96600"
  },
  {
    "text": "networking and how we build those criar abstractions on top of",
    "start": "96600",
    "end": "101840"
  },
  {
    "text": "Linux Ricardo you want to go ahead yeah sure so um we are going to start doing",
    "start": "101840",
    "end": "107200"
  },
  {
    "text": "some Demos in in a minute but I want you you don't need to take pictures we going to put that on the scum promise there's",
    "start": "107200",
    "end": "113079"
  },
  {
    "text": "lots of pictures so yes so uh this is how uh a kubernetes networking actually",
    "start": "113079",
    "end": "118799"
  },
  {
    "text": "looks like and we are going to actually start building our networking over this with demos and",
    "start": "118799",
    "end": "124240"
  },
  {
    "text": "showing like uh how the routing actually works why we have a CNS and what's Cube",
    "start": "124240",
    "end": "129280"
  },
  {
    "text": "proxy and why everyone actually hates Cube proxy I can't say anything sorry yeah so",
    "start": "129280",
    "end": "138000"
  },
  {
    "text": "we'll start by talking about Linux networking and what the N networking stack is so the base of every ku's",
    "start": "138000",
    "end": "144080"
  },
  {
    "text": "workload is working on a node a node has an Ethernet interface for external",
    "start": "144080",
    "end": "149319"
  },
  {
    "text": "connectivity uh we would say has routing rules so we know where to send packets um IP tables",
    "start": "149319",
    "end": "155680"
  },
  {
    "text": "so that we can break things with those packets and maybe black hole some of them and then we have connection",
    "start": "155680",
    "end": "161000"
  },
  {
    "text": "tracking um contract pretty straightforward name it makes you know",
    "start": "161000",
    "end": "166159"
  },
  {
    "text": "it tracks the connections inside of the kernel force and uh at a very simplistic terms this is what we would consider the",
    "start": "166159",
    "end": "172680"
  },
  {
    "text": "Linux networking stack um it's not everything there's lots of other things are involved in this but for Simplicity",
    "start": "172680",
    "end": "177920"
  },
  {
    "text": "and 30 minute stake let's think that this is the Linux networking stack with that we're going to talk",
    "start": "177920",
    "end": "183640"
  },
  {
    "text": "about how that gets replicated in a pod and Ricardo wanted to make sure that we talked about this guy the pause",
    "start": "183640",
    "end": "189799"
  },
  {
    "text": "container okay so uh whoever actually entered into the node and did like a",
    "start": "189799",
    "end": "194879"
  },
  {
    "text": "Docker PS and saw a bunch of pauses and wasn't had no idea what that thing was",
    "start": "194879",
    "end": "200519"
  },
  {
    "text": "about great okay so when you start a pod you need somewhere to have",
    "start": "200519",
    "end": "209239"
  },
  {
    "text": "the network right because a pod is just like uh you know a network that is shared between containers so the PA it's",
    "start": "209239",
    "end": "216000"
  },
  {
    "text": "what we call the infrastructure container it's a container that is created just to be there so you can",
    "start": "216000",
    "end": "221480"
  },
  {
    "text": "start creating the other things it's a container that will be there and won't be on Crash loop back or something like that right so that's what the pause is",
    "start": "221480",
    "end": "227760"
  },
  {
    "text": "it's just a container that should be started and should be there so you can have Network and with that we have containers",
    "start": "227760",
    "end": "234840"
  },
  {
    "text": "so our actual applications are running inside of this pod and it is part of that pod namespace but what is that pod",
    "start": "234840",
    "end": "241360"
  },
  {
    "text": "namespace or network namespace there it is a complete copy of the Linux networking stack this is what is this is",
    "start": "241360",
    "end": "248239"
  },
  {
    "text": "what allows us as app developers to run something on port 8080 multiple",
    "start": "248239",
    "end": "254000"
  },
  {
    "text": "different times so we have multiple applications running on the same port it's because you have a copy of the Linux networking stack so if you ever",
    "start": "254000",
    "end": "260280"
  },
  {
    "text": "see sometimes when you try to run you know several copies of engine x on a host node you'll get Port conflicts",
    "start": "260280",
    "end": "266680"
  },
  {
    "text": "because by default it runs on 80 this is why we can do do this inside of",
    "start": "266680",
    "end": "272080"
  },
  {
    "text": "containers and so container uh pods run on nodes right we need a node until",
    "start": "272080",
    "end": "277479"
  },
  {
    "text": "somebody figures out how to not do that even in ECS you still need a node and on a node you have what is",
    "start": "277479",
    "end": "284560"
  },
  {
    "text": "called the root Network namespace and that's where you know by default all",
    "start": "284560",
    "end": "290360"
  },
  {
    "text": "interfaces go unless you tell it not to so we've created we've got the container we've got the Pod Network namespace",
    "start": "290360",
    "end": "297280"
  },
  {
    "text": "we've also added a an interface in there so that we have again an interface that runs on there but how do these two",
    "start": "297280",
    "end": "303840"
  },
  {
    "text": "communicate again we have um technology called V ethernet a v ethernet is think",
    "start": "303840",
    "end": "310919"
  },
  {
    "text": "of it as uh just a pipe between the two interfaces packet comes in packet goes out packet comes in packet goes out and",
    "start": "310919",
    "end": "319240"
  },
  {
    "text": "these two are connected by another Linux technology called a bridge and then",
    "start": "319240",
    "end": "324560"
  },
  {
    "text": "again we like to reiterate that you know all of these commands here are from the Linux command line you can there was",
    "start": "324560",
    "end": "330080"
  },
  {
    "text": "actually really good talk and I think it was reinvent a couple years ago where someone actually you know recreated a",
    "start": "330080",
    "end": "336080"
  },
  {
    "text": "container with all of these commands so again trying to reiterate all this there it's just Linux underneath the hood and",
    "start": "336080",
    "end": "342520"
  },
  {
    "text": "then we wire those the bridge up so now we have external connectivity between our pod Network namespace and our root",
    "start": "342520",
    "end": "348520"
  },
  {
    "text": "root Network namespace and then we have this beautiful picture here multiple nodes",
    "start": "348520",
    "end": "354600"
  },
  {
    "text": "multiple copies of the network deack and I think I I missing the demo",
    "start": "354600",
    "end": "361680"
  },
  {
    "text": "the demo slide oh you moved it oh see do that this is what I get for working with",
    "start": "361680",
    "end": "367759"
  },
  {
    "text": "you Ricardo so we're going to talk about um how all of this um works together and",
    "start": "367759",
    "end": "373880"
  },
  {
    "text": "how we make those kubernetes um extractions I like to call them the kubernetes networking Fight Club",
    "start": "373880",
    "end": "379000"
  },
  {
    "text": "rules and so we talked about um that um the Pod container the Pod the two",
    "start": "379000",
    "end": "385840"
  },
  {
    "text": "containers talking to each other through that network name space and so we get this first rule highly coupled container",
    "start": "385840",
    "end": "391479"
  },
  {
    "text": "to container communication is solved by Local Host communication so this is a complete copy of the network stack so",
    "start": "391479",
    "end": "397440"
  },
  {
    "text": "these two processes can talk to each other over Local Host pod to pod communication all pods",
    "start": "397440",
    "end": "404319"
  },
  {
    "text": "can communicate with other pods um with their own IP addresses and this is",
    "start": "404319",
    "end": "409840"
  },
  {
    "text": "again worked through with the V ethernet and the bridging",
    "start": "409840",
    "end": "415560"
  },
  {
    "text": "interfaces we haven't talked about Services yet but how to get P to services communication is covered by",
    "start": "415599",
    "end": "421599"
  },
  {
    "text": "kubernetes service so again that's another abstraction um ignore the fact that kubernetes is spelled",
    "start": "421599",
    "end": "426639"
  },
  {
    "text": "wrong exter external to services communication so everything that we've been talking about up till now has been",
    "start": "426639",
    "end": "433639"
  },
  {
    "text": "internal to the cluster so how pods can communicate with each other and how the nose can communicate with each other so",
    "start": "433639",
    "end": "439440"
  },
  {
    "text": "we have to have some way to reach out of the cluster because you know clusters aren't that great if",
    "start": "439440",
    "end": "446240"
  },
  {
    "text": "nobody can actually use them right why are we using them at least secure is it secure a secure container a a secure",
    "start": "446240",
    "end": "453319"
  },
  {
    "text": "cluster has no network okay so we're going to talk about um how those nodes can communicate and we'll",
    "start": "453319",
    "end": "459720"
  },
  {
    "text": "let Ricardo talk about the Pod cider okay so uh I will actually start the demo now okay cool uh and we are going",
    "start": "459720",
    "end": "467720"
  },
  {
    "text": "to understand a bit on this uh Communications and what this means like uh one node using the other as a router",
    "start": "467720",
    "end": "474280"
  },
  {
    "text": "and how uh it works on this pot tot communication being transparent so we are going to start exploring all of",
    "start": "474280",
    "end": "479879"
  },
  {
    "text": "those rules that James did but uh using uh demos right I'll be your mic stand oh",
    "start": "479879",
    "end": "485240"
  },
  {
    "text": "thank you cool so uh we have kind of recorded",
    "start": "485240",
    "end": "490319"
  },
  {
    "text": "before because usually I have problems when I don't record but think that we are actually doing a live demo uh first",
    "start": "490319",
    "end": "498680"
  },
  {
    "text": "of all we are using kind who knows here who is kind oh that's great okay so whatever we",
    "start": "498680",
    "end": "507080"
  },
  {
    "text": "are going to do here and whatever we are going to test here we want to do in kind because the the idea is that you can",
    "start": "507080",
    "end": "512399"
  },
  {
    "text": "actually explore at your home later and you don't need to pay like a huge effort of money for any cloud provider just to",
    "start": "512399",
    "end": "518080"
  },
  {
    "text": "create a kubernetes cluster to say like look those folks they are actually right or wrong feel free to probably wrong",
    "start": "518080",
    "end": "524480"
  },
  {
    "text": "yeah [Music] so well is it fine the size can you guys",
    "start": "524480",
    "end": "531839"
  },
  {
    "text": "see it in the back one more no good it looks good okay",
    "start": "531839",
    "end": "537760"
  },
  {
    "text": "if you need just yell at us like I'm used it to James keeps the okay so the",
    "start": "537760",
    "end": "543200"
  },
  {
    "text": "first one the first demo that we are going to show here is I I want to show you I have some uh kubernetes spts here",
    "start": "543200",
    "end": "550160"
  },
  {
    "text": "each of them they got this uh IP address differently right so this is the PO IP and let's keep playing here I want to do",
    "start": "550160",
    "end": "557760"
  },
  {
    "text": "a curl so I went from this pod that it's running on this note on this worker too calling this pod running on worker 3",
    "start": "557760",
    "end": "564680"
  },
  {
    "text": "right and it work it so we could get hello cucon and if I take a look into the locks here I'm going to see that the same address that was from myod got here",
    "start": "564680",
    "end": "572680"
  },
  {
    "text": "so one of those rules that we got which was like the communication should be flat right it's happening here cool uh",
    "start": "572680",
    "end": "580680"
  },
  {
    "text": "yeah so we can see here the IP addresses that that has been used so let's take a bit I look a bit better on how this uh",
    "start": "580680",
    "end": "588279"
  },
  {
    "text": "let me just see if I'm I have the right demo okay so pot cidr okay how this actually works right uh",
    "start": "588279",
    "end": "597040"
  },
  {
    "text": "so again taking a look into the PO we can see that we have a different sub ranges here of network right so worker 2",
    "start": "597040",
    "end": "604360"
  },
  {
    "text": "has like this 10 244 3 and then worker 3 D 102 441 and so on so those networks",
    "start": "604360",
    "end": "610720"
  },
  {
    "text": "they are kind of SE segmented segregated right and as you can see here when we",
    "start": "610720",
    "end": "616079"
  },
  {
    "text": "configure kubernetes when we create a kubernetes cluster usually when you are not using a kind or when you are doing",
    "start": "616079",
    "end": "621920"
  },
  {
    "text": "by your own you configure a directive which is called po cidr that says this is the range of ips that my pods are",
    "start": "621920",
    "end": "628519"
  },
  {
    "text": "going to get right and that's internally they are just use it for this internal communication uh usually they don't need",
    "start": "628519",
    "end": "634720"
  },
  {
    "text": "to be routable for your network but it would be good that you don't clash with your network as well otherwise imagine one pot trying to call like your service",
    "start": "634720",
    "end": "641279"
  },
  {
    "text": "on the same IP and it's going to actually try to Route internet through the server to the cluster right so we",
    "start": "641279",
    "end": "647720"
  },
  {
    "text": "can see that the PO subnet here it's like this 10244 0016 and if we take a look into the",
    "start": "647720",
    "end": "654200"
  },
  {
    "text": "nodes configuration we are going to see that each node got this PO cidr spec",
    "start": "654200",
    "end": "659880"
  },
  {
    "text": "saying like Okay so my worker uh has this 10 244 244 sorry to Z three and one",
    "start": "659880",
    "end": "667800"
  },
  {
    "text": "which actually matches with the IPS that Theos are getting on on each node right uh and they have those external IPS as",
    "start": "667800",
    "end": "674279"
  },
  {
    "text": "well so those are the IPS that are like the public node IPS uh and as you can see when I do an IP route on one of",
    "start": "674279",
    "end": "680880"
  },
  {
    "text": "those nodes uh it actually what we have is like okay so if this node wants to reach the 104",
    "start": "680880",
    "end": "687519"
  },
  {
    "text": "24410 it should use this IP here this external IP 172 1803 so in fact what we",
    "start": "687519",
    "end": "695360"
  },
  {
    "text": "can see here is that one node can reach each other and they can reach using tunnels it can be they can be on the",
    "start": "695360",
    "end": "701360"
  },
  {
    "text": "same network doesn't matter this is how the C cni is going to implement that right but you use each of those nodes as",
    "start": "701360",
    "end": "707920"
  },
  {
    "text": "routers okay uh so oh you have a c oh",
    "start": "707920",
    "end": "714200"
  },
  {
    "text": "you have a cve here James cool so where is that I've lost the presentation so let's let me just come here to whatever",
    "start": "714200",
    "end": "720760"
  },
  {
    "text": "we had here uh so taking a look here again we can see that every uh node is",
    "start": "720760",
    "end": "727600"
  },
  {
    "text": "been used as a router for each of the pods that are running on those routers right so you we have segregated those on",
    "start": "727600",
    "end": "734600"
  },
  {
    "text": "uh on on subnets and the way that it happens it's with a uh component which",
    "start": "734600",
    "end": "741920"
  },
  {
    "text": "is called it cni so you probably have heard about that right we are going to",
    "start": "741920",
    "end": "748240"
  },
  {
    "text": "speak a bit more on that but the cni it's the container network interface it's the plugin that manages those uh",
    "start": "748240",
    "end": "754800"
  },
  {
    "text": "those uh the networking of the container so it is a thing that does all of those IP allocations it reads the PO C IDR and",
    "start": "754800",
    "end": "761600"
  },
  {
    "text": "so on so that's this configuration that exists on every node and it says and when cuet is running it will read those",
    "start": "761600",
    "end": "768839"
  },
  {
    "text": "configurations and say like Okay cool so when I'm creating this new pod I should actually call uh those scripts here from",
    "start": "768839",
    "end": "774880"
  },
  {
    "text": "those from the cni and then start allocating the IP addresses based on those configurations usually when we",
    "start": "774880",
    "end": "780120"
  },
  {
    "text": "have kind or when you have like a managed uh uh cluster you don't care much about that right unless you are uh",
    "start": "780120",
    "end": "787000"
  },
  {
    "text": "actually you know doing something on premises or you are doing something uh using some different cni that is been",
    "start": "787000",
    "end": "792680"
  },
  {
    "text": "provided by the cloud provider okay so I think we can move yeah there was this P",
    "start": "792680",
    "end": "798120"
  },
  {
    "text": "that I already did so let me yeah you kept using that word um cni so we're going to go ahead and discuss that so as",
    "start": "798120",
    "end": "805360"
  },
  {
    "text": "we're talking about um adding those interfaces you saw all of those commands it can be very cumbersome very uh",
    "start": "805360",
    "end": "811800"
  },
  {
    "text": "burdensome so what this project is the cni project container network interface",
    "start": "811800",
    "end": "817120"
  },
  {
    "text": "it's a separate piece of software so one of the things that especially when you're starting out you have to understand is that kubernetes is a",
    "start": "817120",
    "end": "822560"
  },
  {
    "text": "collection of software that works together right you got the cuet you got the API server all the controllers those",
    "start": "822560",
    "end": "827600"
  },
  {
    "text": "are all separate pieces of software and then with the cni it helps with a standard way to manage network",
    "start": "827600",
    "end": "832959"
  },
  {
    "text": "interfaces these are open source projects there's lots of different options I work for a company that",
    "start": "832959",
    "end": "838040"
  },
  {
    "text": "supports one so ilium is there CU brouter I think is the default and then you know flannel there's lots of other",
    "start": "838040",
    "end": "843800"
  },
  {
    "text": "ones there's the repo you can go check that out so it is a specification for how to define that file and how to",
    "start": "843800",
    "end": "849959"
  },
  {
    "text": "create and add interfaces and manage routes and IP addresses so we talk about this the cni is required to implement",
    "start": "849959",
    "end": "857040"
  },
  {
    "text": "that kubernetes networking model so we've talked about the kubernetes networking model and the cni implements",
    "start": "857040",
    "end": "862720"
  },
  {
    "text": "that for us and so we have see here we have that picture so we continue to build on that",
    "start": "862720",
    "end": "868800"
  },
  {
    "text": "picture so we have the cni that manages the the interfaces the routes and then allocates",
    "start": "868800",
    "end": "874480"
  },
  {
    "text": "the IP address the the IP addresses and the interfaces for us so we did mention Services when we",
    "start": "874480",
    "end": "881800"
  },
  {
    "text": "talked about the fight club rules um there are several different types where again have 30 minutes so we're going to talk about the two big ones uh cluster",
    "start": "881800",
    "end": "889480"
  },
  {
    "text": "IP and node Port so you've one of the key characteristics with Services is",
    "start": "889480",
    "end": "895279"
  },
  {
    "text": "that you know pods are going to change pods are going to die nodes are going to die those IP addresses will change and",
    "start": "895279",
    "end": "900880"
  },
  {
    "text": "that's not really helpful from a client's perspective having to memorize and know all those IP addresses how many of you guys know the IP addresses of",
    "start": "900880",
    "end": "907519"
  },
  {
    "text": "your applications yeah so from a Services perspective that gives us a single IP",
    "start": "907519",
    "end": "914120"
  },
  {
    "text": "address for an entry point so if the orange bot here is trying to communicate to the green service to the green pods",
    "start": "914120",
    "end": "919880"
  },
  {
    "text": "to get information whatever the API is the database whatever is running there it knows that it can use this IP address",
    "start": "919880",
    "end": "926480"
  },
  {
    "text": "to communicate and reach all of those backend services and I think at this point we have oh I also want to show",
    "start": "926480",
    "end": "932839"
  },
  {
    "text": "this again continue to iterate that it's using underlying Network Linux networking technology so here we've got",
    "start": "932839",
    "end": "939160"
  },
  {
    "text": "an IP tables rule that's throwing the natat routing and I think we've got no we've",
    "start": "939160",
    "end": "944680"
  },
  {
    "text": "got another we don't have the demo yet um so this the next one is node Port so from a nodeport perspective right we",
    "start": "944680",
    "end": "951199"
  },
  {
    "text": "talked about um those external IP addresses for the nodes and if we have an application that's running with a",
    "start": "951199",
    "end": "957680"
  },
  {
    "text": "Services of node Port what kubernetes will do for us is it allocates a port on",
    "start": "957680",
    "end": "963839"
  },
  {
    "text": "each one of those so that I can reach 17211 on",
    "start": "963839",
    "end": "968959"
  },
  {
    "text": "32,767 and it will reach my applications Back in Forth so instead of an IP address I can use the noport service",
    "start": "968959",
    "end": "975560"
  },
  {
    "text": "from that one and this will get a little easier when Ricardo demos that for",
    "start": "975560",
    "end": "980880"
  },
  {
    "text": "us okay I was going to say that what whoever knows the IP from the head they",
    "start": "980880",
    "end": "986880"
  },
  {
    "text": "are not using IPv6 probably so let cool so let's see here uh first of all",
    "start": "986880",
    "end": "995160"
  },
  {
    "text": "as James said and I think that we are kind of use it to right so I have the parts here and I have those IPS and uh I",
    "start": "995160",
    "end": "1002199"
  },
  {
    "text": "can actually again do a curl call uh from my IP right so I'm calling this first IP here and I say I get okay hello",
    "start": "1002199",
    "end": "1010040"
  },
  {
    "text": "cuon and actually we have logs right but what will happen when I delete that P",
    "start": "1010040",
    "end": "1016600"
  },
  {
    "text": "right so I went to the P I'm going to delete that P uh I'm kind of you know I keep forgetting my things so that's why I do",
    "start": "1016600",
    "end": "1022279"
  },
  {
    "text": "keep CT get always uh okay so the IP of the Pod actually changed right so actually the node changed so if we see",
    "start": "1022279",
    "end": "1030160"
  },
  {
    "text": "uh the Pod from the back end was running on the on this uh worker node here right so was the node one and then it moved to",
    "start": "1030160",
    "end": "1037400"
  },
  {
    "text": "the node 3 and as we've seen before even the cidr the network of that that that pods on those those notes change it",
    "start": "1037400",
    "end": "1044038"
  },
  {
    "text": "right so if I try to call it I'm going to get some time out cool uh and the way",
    "start": "1044039",
    "end": "1049640"
  },
  {
    "text": "that I can actually uh solve that right for okay it's with a service so the",
    "start": "1049640",
    "end": "1056440"
  },
  {
    "text": "service is an abstraction it will allocate also an IP but that IP won't",
    "start": "1056440",
    "end": "1062679"
  },
  {
    "text": "change if I delete the Pod right so I'm creating a cluster IP here I will take a",
    "start": "1062679",
    "end": "1068559"
  },
  {
    "text": "look into the service IP uh and as we can see I have now this back end which is this 1096 14226 right uh just up",
    "start": "1068559",
    "end": "1077640"
  },
  {
    "text": "house not the container uh if you sorry if you take a look into the second IP",
    "start": "1077640",
    "end": "1082919"
  },
  {
    "text": "here which is kubernetes it ends on one we are going to say uh a bit about that IP specifically IP later right but",
    "start": "1082919",
    "end": "1089559"
  },
  {
    "text": "that's an special service IP uh so now if I go again to my container to my",
    "start": "1089559",
    "end": "1096280"
  },
  {
    "text": "other pod and do a curl I'm going to see that I can C with uh from the service IP right and not from the Pod IP anymore uh",
    "start": "1096280",
    "end": "1104039"
  },
  {
    "text": "but still the IP that I'm getting here at least because the traffic is internal of from the cluster it's the original uh",
    "start": "1104039",
    "end": "1111039"
  },
  {
    "text": "pod IP right and I now I deleted my backend pod again uh the Pod IP changed",
    "start": "1111039",
    "end": "1116760"
  },
  {
    "text": "and it changed the node again and if I did a curl to my service it's still working right uh behind the scenes",
    "start": "1116760",
    "end": "1124559"
  },
  {
    "text": "what's happening here it's uh and we are going to see we have this component which is called Q proxy and it's",
    "start": "1124559",
    "end": "1130480"
  },
  {
    "text": "injecting rules on the nodes saying okay so now I have this service IP and",
    "start": "1130480",
    "end": "1136039"
  },
  {
    "text": "whatever my pods on the on on my node they try to reach the service IP I will select the pods that are serving the",
    "start": "1136039",
    "end": "1143720"
  },
  {
    "text": "service and I will reach them and this is implemented by this concept which is called this resarch which is end point",
    "start": "1143720",
    "end": "1149200"
  },
  {
    "text": "slices right so uh when you create a service you have that yo file and you",
    "start": "1149200",
    "end": "1154240"
  },
  {
    "text": "say like I want to select all of those pods and it will keep reconciling that and saying like Okay so the the Pod IP",
    "start": "1154240",
    "end": "1159360"
  },
  {
    "text": "changed so I change on the endpoint slice and then qu proxy will note that and say like okay so the IP Chang it so",
    "start": "1159360",
    "end": "1164799"
  },
  {
    "text": "I will change on the rule here right cool so so uh just as just another",
    "start": "1164799",
    "end": "1171159"
  },
  {
    "text": "example here so the service IP is also configurable right so as we can see here",
    "start": "1171159",
    "end": "1177120"
  },
  {
    "text": "uh during my Cent configuration I have set this service IP but as opposite to the Pod IP it it's not going to break on",
    "start": "1177120",
    "end": "1184840"
  },
  {
    "text": "on cidrs for the node it's just going to allocate this there are two exceptions ip1 will always be allocated as a",
    "start": "1184840",
    "end": "1192000"
  },
  {
    "text": "service for kubernetes API IP 10 will be always allocated to the DNS and we are",
    "start": "1192000",
    "end": "1197799"
  },
  {
    "text": "going to take a look into the DNS later okay other than that I don't think I've never seen actually happening uh you",
    "start": "1197799",
    "end": "1203240"
  },
  {
    "text": "know allocating from 1 to 10 something in the middle I think it's reserved but uh other than that it would just do",
    "start": "1203240",
    "end": "1209520"
  },
  {
    "text": "random allocations here uh yeah going to talk okay and here",
    "start": "1209520",
    "end": "1216159"
  },
  {
    "text": "uh uh as James say like we have this component CU proxy and I just wanted to",
    "start": "1216159",
    "end": "1221200"
  },
  {
    "text": "show you like CU proxy actually injecting rules on the Node so uh as we can see here I have these NF tables uh",
    "start": "1221200",
    "end": "1228760"
  },
  {
    "text": "had a talk just earlier today of like the maintainers of cube proxy showing that they have replaced IP tables for n",
    "start": "1228760",
    "end": "1235280"
  },
  {
    "text": "tables for uh performance and we can see there is this table here saying like Okay so I I reach part uh 010 on Part 53",
    "start": "1235280",
    "end": "1243919"
  },
  {
    "text": "tcpr RPA I will send to DNS end points or this one to the uh to this back end",
    "start": "1243919",
    "end": "1249240"
  },
  {
    "text": "and and so on okay cool uh let me see what's the six one and if I should because I okay uh if I show note part",
    "start": "1249240",
    "end": "1257919"
  },
  {
    "text": "it's going to break because cuz I forgot to fix do you want to see it breaking shame okay sorry so just showing how",
    "start": "1257919",
    "end": "1264320"
  },
  {
    "text": "note part works I think that we still have time yeah we're good Okay cool so I'm am going to uh change my service",
    "start": "1264320",
    "end": "1271320"
  },
  {
    "text": "here uh and make it as a note part right so now it's a not Port as we can see",
    "start": "1271320",
    "end": "1277120"
  },
  {
    "text": "here I have a an external Port allocated this is random as well and depends on how you configure your API server",
    "start": "1277120",
    "end": "1283360"
  },
  {
    "text": "usually it's from the 30,000 to the 32 something I don't know",
    "start": "1283360",
    "end": "1288640"
  },
  {
    "text": "but you can extend the range it's in the darks yeah and and now I will call",
    "start": "1288640",
    "end": "1295240"
  },
  {
    "text": "instead of calling the my internal IP I'm I'm going to my node or something external right and I'm going to call the",
    "start": "1295240",
    "end": "1300559"
  },
  {
    "text": "external IP and as I can see from any node IP that I call I can now get into my service okay so this again it's Q",
    "start": "1300559",
    "end": "1308080"
  },
  {
    "text": "proxy injecting rules but as the opposite saying like whenever you receive a traffic from the external of",
    "start": "1308080",
    "end": "1314480"
  },
  {
    "text": "the cluster reaching this part you should on any of those notes you should send to any of those pods being backed",
    "start": "1314480",
    "end": "1321480"
  },
  {
    "text": "by uh the service right there are some exceptions like you can control this Behavior say like just send to pods on",
    "start": "1321480",
    "end": "1327159"
  },
  {
    "text": "the same node and so on but we are not going to go that down but it's a I'm happy to discuss about that cool uh okay",
    "start": "1327159",
    "end": "1336799"
  },
  {
    "text": "so you keep doing your slides keep drawing the pretty pictures um so he",
    "start": "1336799",
    "end": "1341919"
  },
  {
    "text": "already did you already um so we're going to talk about Q proxy again so Ricardo is talking over his slides like",
    "start": "1341919",
    "end": "1347039"
  },
  {
    "text": "I do I have that problem it's fine uh so Q proxy again is another piece of software that runs on each a node and it",
    "start": "1347039",
    "end": "1353720"
  },
  {
    "text": "maintains those networking rules that we're talking about so all those NF tables rules when a service change Q",
    "start": "1353720",
    "end": "1359720"
  },
  {
    "text": "proxy is responsible for changing those and it uses like I said the operating system packet filtering so IP tables or",
    "start": "1359720",
    "end": "1365520"
  },
  {
    "text": "NF tables depending on your implementation it routes all of the traffic doesn't EF epbf yeah if",
    "start": "1365520",
    "end": "1372159"
  },
  {
    "text": "you're using celium in Q proxy mode or Q proxy replacement mode um and that's responsible for the services to mapping",
    "start": "1372159",
    "end": "1379120"
  },
  {
    "text": "so again you don't have to be responsible manually for changing all of those node IP node uh pod IPS we have",
    "start": "1379120",
    "end": "1387080"
  },
  {
    "text": "too many different types of IP addresses too many IPS and I don't think you have a specific qy proxy demo you just did that",
    "start": "1387080",
    "end": "1392799"
  },
  {
    "text": "one I just did that okay you doing things out of order for me and we practiced it yesterday so you know too",
    "start": "1392799",
    "end": "1399799"
  },
  {
    "text": "many parts so IP addresses are hard to remember we've got a bunch of different types as I'm already stumbling over them but what about names instead of IP",
    "start": "1399799",
    "end": "1405640"
  },
  {
    "text": "addresses um we'll go ahead and you're going to go talk about services in quns",
    "start": "1405640",
    "end": "1411080"
  },
  {
    "text": "yeah okay so uh again now we we do have the uh service IP right and uh but",
    "start": "1411080",
    "end": "1418640"
  },
  {
    "text": "imagine you have like Nam spaces and on all of those names spaces you want to",
    "start": "1418640",
    "end": "1423679"
  },
  {
    "text": "reproduce an architecture so you want to have your back end and you want to have your front end and you are going to have",
    "start": "1423679",
    "end": "1428760"
  },
  {
    "text": "the database maybe all of them on the same name space right so you have production and you have K and you want",
    "start": "1428760",
    "end": "1434760"
  },
  {
    "text": "to reproduce that but you don't have the IP so you create a service IP right and",
    "start": "1434760",
    "end": "1439919"
  },
  {
    "text": "when you do that you will need to probably make your backend speak with your database and you want to make that",
    "start": "1439919",
    "end": "1445760"
  },
  {
    "text": "reproducible so kubernetes instead of uh uh actually had this concept of the DNS",
    "start": "1445760",
    "end": "1452240"
  },
  {
    "text": "of that we are going to show on the CNS right that you can say okay so instead of calling 1096 whatever I'm going to",
    "start": "1452240",
    "end": "1459080"
  },
  {
    "text": "call backand and when I call backhand CNS will go and say like okay so Ricardo is calling backand the namespace do",
    "start": "1459080",
    "end": "1465440"
  },
  {
    "text": "service. cluster. loal and it's going to trans to us for the same service that is running on my same namespace right okay",
    "start": "1465440",
    "end": "1473840"
  },
  {
    "text": "so I'm going to do you want to the button I can I can pess the button and",
    "start": "1473840",
    "end": "1479200"
  },
  {
    "text": "you can talk yeah cool all we",
    "start": "1479200",
    "end": "1484360"
  },
  {
    "text": "are we are fine in time yeah that was a good",
    "start": "1484360",
    "end": "1490039"
  },
  {
    "text": "promise okay cool so let's take a look into the uh DNS and it working right so",
    "start": "1490039",
    "end": "1497000"
  },
  {
    "text": "uh what's going on can you you broke it hold on okay so I have the pods I",
    "start": "1497000",
    "end": "1506200"
  },
  {
    "text": "have the PO IP is here I'm going to call it I have the services I can still do curl against the service right um I'm",
    "start": "1506200",
    "end": "1513360"
  },
  {
    "text": "just proving you that I didn't change any from my last demo but now what happens if I call uh HTTP and backend",
    "start": "1513360",
    "end": "1520760"
  },
  {
    "text": "which is POS it the service name right so with that if I keep creating the",
    "start": "1520760",
    "end": "1527000"
  },
  {
    "text": "service with the same name on different them spaces I have reproducible uh architectures",
    "start": "1527000",
    "end": "1532360"
  },
  {
    "text": "reproducible blueprints right I don't need to keep doing adding on all of my environment uh uh uh variables or my",
    "start": "1532360",
    "end": "1538640"
  },
  {
    "text": "configuration the service IP instead of the uh uh the name right and the way",
    "start": "1538640",
    "end": "1544440"
  },
  {
    "text": "that it happens um okay so I'm going to get the logs and",
    "start": "1544440",
    "end": "1551399"
  },
  {
    "text": "I'm going to show you and then uh if you take a look we have this",
    "start": "1551399",
    "end": "1556640"
  },
  {
    "text": "CNS pod running here it's installed by default you can replace but I wouldn't do that I I know I don't know why people",
    "start": "1556640",
    "end": "1562520"
  },
  {
    "text": "would do that actually it works pretty fine uh and if I take a look into my DNS configuration of my pod what you're",
    "start": "1562520",
    "end": "1568679"
  },
  {
    "text": "going to see it's that the name server do you remember when I say like the IP",
    "start": "1568679",
    "end": "1573880"
  },
  {
    "text": "do10 is reserved to the DNS server right so all of my pods by default unless you",
    "start": "1573880",
    "end": "1581080"
  },
  {
    "text": "change something on the configuration on the Manifest they will have the ipth and they will have this search PA that says",
    "start": "1581080",
    "end": "1587360"
  },
  {
    "text": "I will try to search do mpace SVC cluster. looc then cluster. looc and and",
    "start": "1587360",
    "end": "1593440"
  },
  {
    "text": "and so on right so this is how DNS Works internally on the Pod so you call just",
    "start": "1593440",
    "end": "1599039"
  },
  {
    "text": "the name the service name it will go to the DNS and say like hey give me this full name here and the card DNS will go",
    "start": "1599039",
    "end": "1605480"
  },
  {
    "text": "to kubernetes API check what's the service AP and return you back that API",
    "start": "1605480",
    "end": "1610960"
  },
  {
    "text": "okay cool it's not and we're back to the beginning all of our pces are there",
    "start": "1610960",
    "end": "1617039"
  },
  {
    "text": "we've got C DNS proxy cni and uh all of our pods",
    "start": "1617039",
    "end": "1623480"
  },
  {
    "text": "connected um other opponents to consider so some of the things so this is again very basic intro to kubernetes",
    "start": "1624799",
    "end": "1631520"
  },
  {
    "text": "networking something to consider is that all of these pods can talk to every other pod um by default so you would",
    "start": "1631520",
    "end": "1637399"
  },
  {
    "text": "need something like a network policy that would deny um connectivity between these pods so from a security",
    "start": "1637399",
    "end": "1643000"
  },
  {
    "text": "perspective please Implement Network policies",
    "start": "1643000",
    "end": "1648080"
  },
  {
    "text": "and then one thing we didn't talk about um is ingress controllers and Gateway API controllers so from a again",
    "start": "1648360",
    "end": "1655320"
  },
  {
    "text": "everything that we talked about just now was internal to the cluster and in 30 minutes we can't really um go through",
    "start": "1655320",
    "end": "1661080"
  },
  {
    "text": "all of the noteboard services and all of the abstractions but this is um how you get traffic into your cluster from that",
    "start": "1661080",
    "end": "1666960"
  },
  {
    "text": "perspective from external um we've got some resources here again we'll put these up there um",
    "start": "1666960",
    "end": "1673120"
  },
  {
    "text": "we've got the networking cinat book where we walk through all of that um in a much more uh detail",
    "start": "1673120",
    "end": "1679320"
  },
  {
    "text": "description um we have the presentation survey here so please give us feedback tell us if we actually accomplished it",
    "start": "1679320",
    "end": "1685640"
  },
  {
    "text": "or if we satisfied your morbid curiosity and the Sig networking Community Gateway",
    "start": "1685640",
    "end": "1690679"
  },
  {
    "text": "API Community would ask if you are using Gateway API please take this survey and let us know how it's going that' be very",
    "start": "1690679",
    "end": "1697799"
  },
  {
    "text": "helpful so we'll leave this up here for a few seconds and on time 30 minutes yay",
    "start": "1697799",
    "end": "1704200"
  },
  {
    "text": "any questions",
    "start": "1704200",
    "end": "1707398"
  },
  {
    "text": "we have six minutes for questions are",
    "start": "1709640",
    "end": "1714880"
  },
  {
    "text": "singing no tell me why okay thanks everyone thank you",
    "start": "1714960",
    "end": "1724320"
  },
  {
    "text": "folks sure okay sure let me we are just going to repeat your question",
    "start": "1724320",
    "end": "1730559"
  },
  {
    "text": "then okay yes",
    "start": "1731720",
    "end": "1738240"
  },
  {
    "text": "okay so the question is like you have several nodes and you have Cube procs and all of them and how they communicate with with each other so they don't right",
    "start": "1738240",
    "end": "1745120"
  },
  {
    "text": "all of the cube proxies they go to the API server and they say like what kind of rule I need to to uh program here",
    "start": "1745120",
    "end": "1753200"
  },
  {
    "text": "right and then uh uh using that internal routing like pod top that you've seen",
    "start": "1753200",
    "end": "1758760"
  },
  {
    "text": "you actually have your node speaking with the other pod on the other node if it's running on on the other node right",
    "start": "1758760",
    "end": "1764120"
  },
  {
    "text": "but that's the same path that's the same R in that that it happens but you you have this extra hope if you get into a",
    "start": "1764120",
    "end": "1770559"
  },
  {
    "text": "note that it's on a different uh uh",
    "start": "1770559",
    "end": "1775039"
  },
  {
    "text": "uh uh the IPS the nodes have their own CER range so you saw that sl24 that's",
    "start": "1779919",
    "end": "1786080"
  },
  {
    "text": "assigned to that node yeah",
    "start": "1786080",
    "end": "1791880"
  },
  {
    "text": "yes yes but because we we do that split of like this SL 24 it will know like I'm calling actually something else on some",
    "start": "1799200",
    "end": "1805519"
  },
  {
    "text": "some different place there's an underlying assumption that all of the nodes are routable to each other so that's when it has that route it knows",
    "start": "1805519",
    "end": "1811480"
  },
  {
    "text": "to go talk to that node does that make that's why we showed the routing rules on the Node",
    "start": "1811480",
    "end": "1820559"
  },
  {
    "text": "uh it actually it actually gets the Endo slices is and understands you mean the IPS that it should program right okay so",
    "start": "1828799",
    "end": "1835320"
  },
  {
    "text": "it go to the API server gets the endpoint slices object and it will know that like hey this service SL inpoint",
    "start": "1835320",
    "end": "1842559"
  },
  {
    "text": "SLI has this IP addresses so those are the IPS that I need to program here yeah and then it Maps those to the",
    "start": "1842559",
    "end": "1849080"
  },
  {
    "text": "IP tables and F tables rules so that's what Q prox is responsible for sorry",
    "start": "1849080",
    "end": "1857000"
  },
  {
    "text": "[Music] it depends so the question is like if the Pod exist on the same service if the",
    "start": "1863340",
    "end": "1870960"
  },
  {
    "text": "Pod exist on the same note that you are calling from an Old Port right or eventually internally so it depends so",
    "start": "1870960",
    "end": "1878039"
  },
  {
    "text": "there is this flag which is like internal uh traffic policy and external traffic policy that you set on the uh",
    "start": "1878039",
    "end": "1884039"
  },
  {
    "text": "service that they will say like when the traffic reaches from the outside to the node I will just try to send to",
    "start": "1884039",
    "end": "1891399"
  },
  {
    "text": "the same to any place on the cluster or just to the same place right what can happen is actually uh first of all I",
    "start": "1891399",
    "end": "1898559"
  },
  {
    "text": "don't know if there is some kind of prioritization for the pod on the same node when you are using the cluster model but if you use the local mode",
    "start": "1898559",
    "end": "1905880"
  },
  {
    "text": "which is this one that we just try to use the local and you try to reach like a host that doesn't have the Pod it will",
    "start": "1905880",
    "end": "1912200"
  },
  {
    "text": "fail in that case it will just break so usually you use that when you have a load balancer in front of them so just",
    "start": "1912200",
    "end": "1917519"
  },
  {
    "text": "one be answering or just the ones that have the yeah we didn't we didn't have time to go into external and internal",
    "start": "1917519",
    "end": "1922639"
  },
  {
    "text": "traffic",
    "start": "1922639",
    "end": "1925000"
  },
  {
    "text": "policies no it stays inside the no yes if it's external traffic equals to local",
    "start": "1929600",
    "end": "1935720"
  },
  {
    "text": "it will stay inside the no okay",
    "start": "1935720",
    "end": "1940919"
  },
  {
    "text": "for same service for different",
    "start": "1949760",
    "end": "1953760"
  },
  {
    "text": "pods yeah yeah so we didn't get a we didn't dive too much into I said like green labels so you can use label",
    "start": "1955480",
    "end": "1961200"
  },
  {
    "text": "selectors with multiple services so you can have two Services going to the same",
    "start": "1961200",
    "end": "1967638"
  },
  {
    "text": "pods if they are the same pod I mean the same pod with different containers with",
    "start": "1974960",
    "end": "1980000"
  },
  {
    "text": "the same port yes if you are trying to change to S different pods like you have back end front end and you want to use",
    "start": "1980000",
    "end": "1986120"
  },
  {
    "text": "the same service then no you can't",
    "start": "1986120",
    "end": "1990600"
  }
]