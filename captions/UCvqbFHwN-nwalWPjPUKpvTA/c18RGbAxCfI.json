[
  {
    "start": "0",
    "end": "107000"
  },
  {
    "text": "so yeah welcome uh this is going to be",
    "start": "280",
    "end": "3480"
  },
  {
    "text": "uh Trevor and I talking about how we",
    "start": "3480",
    "end": "5120"
  },
  {
    "text": "built and uh scaled the Thanos",
    "start": "5120",
    "end": "7279"
  },
  {
    "text": "infrastructure at redit uh for the uh",
    "start": "7279",
    "end": "10200"
  },
  {
    "text": "thousand is Engineers we",
    "start": "10200",
    "end": "13519"
  },
  {
    "text": "have so hi I'm Ben uh I'm a backin",
    "start": "14719",
    "end": "18000"
  },
  {
    "text": "engineer uh in our infrastructure",
    "start": "18000",
    "end": "19760"
  },
  {
    "text": "Department um I been like uh uh was said",
    "start": "19760",
    "end": "25640"
  },
  {
    "text": "uh I've been a longtime Prometheus",
    "start": "25640",
    "end": "27320"
  },
  {
    "text": "maintainer um uh I've been working on",
    "start": "27320",
    "end": "30400"
  },
  {
    "text": "Prometheus since it started at",
    "start": "30400",
    "end": "32040"
  },
  {
    "text": "SoundCloud kind of mostly focused on the",
    "start": "32040",
    "end": "35320"
  },
  {
    "text": "on the",
    "start": "35320",
    "end": "37040"
  },
  {
    "text": "uh uh exporter side of things but I also",
    "start": "37040",
    "end": "39879"
  },
  {
    "text": "do uh kind of the ere of Prometheus",
    "start": "39879",
    "end": "42879"
  },
  {
    "text": "doing uh scaling with Thanos and others",
    "start": "42879",
    "end": "45239"
  },
  {
    "text": "uh things and providing providing is a",
    "start": "45239",
    "end": "47480"
  },
  {
    "text": "platform for internal",
    "start": "47480",
    "end": "49879"
  },
  {
    "text": "developers hi uh my name is Trevor I'm",
    "start": "49879",
    "end": "52640"
  },
  {
    "text": "here from Minneapolis Minnesota uh also",
    "start": "52640",
    "end": "55000"
  },
  {
    "text": "experiencing a little bit of jet lag um",
    "start": "55000",
    "end": "57680"
  },
  {
    "text": "I've been at Reddit for about 4 years",
    "start": "57680",
    "end": "60120"
  },
  {
    "text": "years uh it'll be four years in April uh",
    "start": "60120",
    "end": "62680"
  },
  {
    "text": "primarily in the infra s space uh and",
    "start": "62680",
    "end": "65040"
  },
  {
    "text": "then about two years ago uh Ben and I",
    "start": "65040",
    "end": "67600"
  },
  {
    "text": "spun up the observability",
    "start": "67600",
    "end": "70960"
  },
  {
    "text": "team oh we're fighting over the clicker",
    "start": "70960",
    "end": "74080"
  },
  {
    "text": "yeah I got the clicker",
    "start": "74080",
    "end": "76479"
  },
  {
    "text": "okay so and also yeah shout out to our",
    "start": "76479",
    "end": "79360"
  },
  {
    "text": "team uh without the rest of our uh infer",
    "start": "79360",
    "end": "83200"
  },
  {
    "text": "team we wouldn't be able to be doing",
    "start": "83200",
    "end": "84560"
  },
  {
    "text": "this",
    "start": "84560",
    "end": "85960"
  },
  {
    "text": "um yeah uh like I said Ben and I started",
    "start": "85960",
    "end": "88840"
  },
  {
    "text": "this we're up to about 7 people now um",
    "start": "88840",
    "end": "92000"
  },
  {
    "text": "there are a lot of Engineers that read",
    "start": "92000",
    "end": "93200"
  },
  {
    "text": "it and a lot of services so seven people",
    "start": "93200",
    "end": "94840"
  },
  {
    "text": "feels kind of small sometimes um but we",
    "start": "94840",
    "end": "97040"
  },
  {
    "text": "we've really accomplished a lot um also",
    "start": "97040",
    "end": "99560"
  },
  {
    "text": "our other infr teams n teams have",
    "start": "99560",
    "end": "101720"
  },
  {
    "text": "assisted Us in uh rolling out thos over",
    "start": "101720",
    "end": "104640"
  },
  {
    "text": "the last few",
    "start": "104640",
    "end": "106280"
  },
  {
    "text": "years so uh at Reddit we talk a lot",
    "start": "106280",
    "end": "109960"
  },
  {
    "start": "107000",
    "end": "497000"
  },
  {
    "text": "about Reddit shape and how we try and",
    "start": "109960",
    "end": "112719"
  },
  {
    "text": "make things in a kind of a cookie cutter",
    "start": "112719",
    "end": "114799"
  },
  {
    "text": "way because we have a lot of engineering",
    "start": "114799",
    "end": "116439"
  },
  {
    "text": "teams and a lot uh a lot of internal",
    "start": "116439",
    "end": "118799"
  },
  {
    "text": "services and so we kind of want to make",
    "start": "118799",
    "end": "121439"
  },
  {
    "text": "things a Reddit shape uh uh so that it's",
    "start": "121439",
    "end": "124719"
  },
  {
    "text": "easier for teams to onboard into",
    "start": "124719",
    "end": "126320"
  },
  {
    "text": "different",
    "start": "126320",
    "end": "127879"
  },
  {
    "text": "infrastructure um we uh in our",
    "start": "127879",
    "end": "130759"
  },
  {
    "text": "infrastructure we have about 25",
    "start": "130759",
    "end": "132280"
  },
  {
    "text": "kubernetes clusters uh they vary in size",
    "start": "132280",
    "end": "135000"
  },
  {
    "text": "from a few thousand cores to TW uh tens",
    "start": "135000",
    "end": "137840"
  },
  {
    "text": "of thousands of cores um and over the",
    "start": "137840",
    "end": "141599"
  },
  {
    "text": "overall infrastructure we have uh",
    "start": "141599",
    "end": "144200"
  },
  {
    "text": "hundreds of thousands of kubernetes PODS",
    "start": "144200",
    "end": "146800"
  },
  {
    "text": "uh constantly uh being created and",
    "start": "146800",
    "end": "149239"
  },
  {
    "text": "destroyed so so Prometheus of course",
    "start": "149239",
    "end": "151120"
  },
  {
    "text": "being a dynamic Discovery makes a nice",
    "start": "151120",
    "end": "154040"
  },
  {
    "text": "uh monitoring platform for all those",
    "start": "154040",
    "end": "156360"
  },
  {
    "text": "Dynamic",
    "start": "156360",
    "end": "158200"
  },
  {
    "text": "workloads uh all of the indep all the",
    "start": "158200",
    "end": "160800"
  },
  {
    "text": "different services are all managed by",
    "start": "160800",
    "end": "162360"
  },
  {
    "text": "different teams uh you know like I said",
    "start": "162360",
    "end": "164720"
  },
  {
    "text": "we have over a th Engineers building",
    "start": "164720",
    "end": "167040"
  },
  {
    "text": "different services and so we don't have",
    "start": "167040",
    "end": "169959"
  },
  {
    "text": "one Central application team and we need",
    "start": "169959",
    "end": "173480"
  },
  {
    "text": "to make this observability platform as",
    "start": "173480",
    "end": "175680"
  },
  {
    "text": "self-service as",
    "start": "175680",
    "end": "178519"
  },
  {
    "text": "possible uh and so before we uh uh",
    "start": "178840",
    "end": "184040"
  },
  {
    "text": "before Reddit uh started with Prometheus",
    "start": "184040",
    "end": "186400"
  },
  {
    "text": "and Thanos we used a third party",
    "start": "186400",
    "end": "188319"
  },
  {
    "text": "software of service and",
    "start": "188319",
    "end": "192000"
  },
  {
    "text": "um we had to we uh before we had",
    "start": "192000",
    "end": "195159"
  },
  {
    "text": "Prometheus and Thanos uh we had a lot of",
    "start": "195159",
    "end": "197440"
  },
  {
    "text": "statsd metrics as was classic for the uh",
    "start": "197440",
    "end": "201000"
  },
  {
    "text": "early uh early days of Reddit it was a",
    "start": "201000",
    "end": "204440"
  },
  {
    "text": "python Service uh and it used we used uh",
    "start": "204440",
    "end": "208280"
  },
  {
    "text": "they at apparently at the time used",
    "start": "208280",
    "end": "210080"
  },
  {
    "text": "graphite and then moved to a third party",
    "start": "210080",
    "end": "211640"
  },
  {
    "text": "SAS when managing graphite became too",
    "start": "211640",
    "end": "214360"
  },
  {
    "text": "difficult uh and but they were",
    "start": "214360",
    "end": "217159"
  },
  {
    "text": "bottlenecks uh and this the the typical",
    "start": "217159",
    "end": "220000"
  },
  {
    "text": "problems with statsd started to show uh",
    "start": "220000",
    "end": "222360"
  },
  {
    "text": "too many packets uh Dro samples uh",
    "start": "222360",
    "end": "226120"
  },
  {
    "text": "sampling upon sampling to try and get",
    "start": "226120",
    "end": "228200"
  },
  {
    "text": "the data down to a point where it could",
    "start": "228200",
    "end": "230360"
  },
  {
    "text": "actually be shipped off to the SAS uh",
    "start": "230360",
    "end": "233040"
  },
  {
    "text": "and so um one of the things we built was",
    "start": "233040",
    "end": "237000"
  },
  {
    "text": "we built uh uh each service would have a",
    "start": "237000",
    "end": "240680"
  },
  {
    "text": "telegraph that was kind of an",
    "start": "240680",
    "end": "242480"
  },
  {
    "text": "aggregating proxy that would uh",
    "start": "242480",
    "end": "245480"
  },
  {
    "text": "eliminate most of the normal",
    "start": "245480",
    "end": "247879"
  },
  {
    "text": "cardinality uh by dropping pod and in",
    "start": "247879",
    "end": "250680"
  },
  {
    "text": "you know the typical thing you see in",
    "start": "250680",
    "end": "251920"
  },
  {
    "text": "Prometheus pod and instance those would",
    "start": "251920",
    "end": "253840"
  },
  {
    "text": "all get thrown away and you'd only have",
    "start": "253840",
    "end": "255879"
  },
  {
    "text": "top level metrics for a service and this",
    "start": "255879",
    "end": "259079"
  },
  {
    "text": "all started to show its problems",
    "start": "259079",
    "end": "262079"
  },
  {
    "text": "um uh",
    "start": "262080",
    "end": "264600"
  },
  {
    "text": "and because the we needed the data to",
    "start": "264600",
    "end": "267400"
  },
  {
    "text": "find out are we having problems with one",
    "start": "267400",
    "end": "269880"
  },
  {
    "text": "Service uh across the whole service or",
    "start": "269880",
    "end": "272320"
  },
  {
    "text": "is it one pod that is or one node that",
    "start": "272320",
    "end": "275919"
  },
  {
    "text": "is causing the problem and so we",
    "start": "275919",
    "end": "278199"
  },
  {
    "text": "couldn't get that diagnostic",
    "start": "278199",
    "end": "280160"
  },
  {
    "text": "information um uh also between moving",
    "start": "280160",
    "end": "284560"
  },
  {
    "text": "from graphite uh into the SAS uh they",
    "start": "284560",
    "end": "288440"
  },
  {
    "text": "were also moving into",
    "start": "288440",
    "end": "289840"
  },
  {
    "text": "kubernetes uh at the time because",
    "start": "289840",
    "end": "291720"
  },
  {
    "text": "previously like a normal setup we had",
    "start": "291720",
    "end": "294320"
  },
  {
    "text": "puppet puppet was used to deploy all the",
    "start": "294320",
    "end": "296440"
  },
  {
    "text": "services there weren't as many services",
    "start": "296440",
    "end": "298520"
  },
  {
    "text": "there weren't as many engineers is a",
    "start": "298520",
    "end": "300240"
  },
  {
    "text": "simpler infrastructure",
    "start": "300240",
    "end": "303080"
  },
  {
    "text": "um and so uh in order to improve the",
    "start": "303080",
    "end": "307080"
  },
  {
    "text": "observability we needed an an order of",
    "start": "307080",
    "end": "309720"
  },
  {
    "text": "magnitude leap in capacity uh or or more",
    "start": "309720",
    "end": "313240"
  },
  {
    "text": "than that because there is this large uh",
    "start": "313240",
    "end": "316680"
  },
  {
    "text": "need for more data and more metrics but",
    "start": "316680",
    "end": "319280"
  },
  {
    "text": "we just couldn't afford to send it to a",
    "start": "319280",
    "end": "321520"
  },
  {
    "text": "SAS it was just prohibitively expensive",
    "start": "321520",
    "end": "324479"
  },
  {
    "text": "and so today um uh we had some",
    "start": "324479",
    "end": "328479"
  },
  {
    "text": "experience with Prometheus because we",
    "start": "328479",
    "end": "329880"
  },
  {
    "text": "were in a kubernetes world",
    "start": "329880",
    "end": "333199"
  },
  {
    "text": "uh and so there there was already some",
    "start": "333199",
    "end": "336800"
  },
  {
    "text": "Prometheus in the infrastructure and we",
    "start": "336800",
    "end": "339960"
  },
  {
    "text": "did some design work and came up with",
    "start": "339960",
    "end": "342199"
  },
  {
    "text": "that idea that hey how about we just use",
    "start": "342199",
    "end": "344120"
  },
  {
    "text": "Prometheus for all the monitoring not",
    "start": "344120",
    "end": "346120"
  },
  {
    "text": "just the kubernetes infrastructure and",
    "start": "346120",
    "end": "349759"
  },
  {
    "text": "so uh Trevor and I uh designed and bu uh",
    "start": "349759",
    "end": "353479"
  },
  {
    "text": "built out the initial prototype of a",
    "start": "353479",
    "end": "356919"
  },
  {
    "text": "monitoring SAS for the entire",
    "start": "356919",
    "end": "358479"
  },
  {
    "text": "organization we we follow the kind of",
    "start": "358479",
    "end": "360440"
  },
  {
    "text": "same Telegraph idea uh",
    "start": "360440",
    "end": "363479"
  },
  {
    "text": "and",
    "start": "363479",
    "end": "365479"
  },
  {
    "text": "um uh to give each service its own",
    "start": "365479",
    "end": "369840"
  },
  {
    "text": "Prometheus",
    "start": "369840",
    "end": "371360"
  },
  {
    "text": "um and this allowed us to really scale",
    "start": "371360",
    "end": "375560"
  },
  {
    "text": "out uh Prometheus as an underlying",
    "start": "375560",
    "end": "378560"
  },
  {
    "text": "infrastructure for a large distributed",
    "start": "378560",
    "end": "380919"
  },
  {
    "text": "uh set of",
    "start": "380919",
    "end": "382319"
  },
  {
    "text": "services",
    "start": "382319",
    "end": "385319"
  },
  {
    "text": "um uh one of the bigger challenges for",
    "start": "386919",
    "end": "389599"
  },
  {
    "text": "getting this service out to all these",
    "start": "389599",
    "end": "391080"
  },
  {
    "text": "teams was uh how do we get everybody to",
    "start": "391080",
    "end": "395240"
  },
  {
    "text": "switch from a statsd data model over to",
    "start": "395240",
    "end": "397280"
  },
  {
    "text": "a preus data bottle uh the good news is",
    "start": "397280",
    "end": "400160"
  },
  {
    "text": "is we have a Reddit shape for that uh we",
    "start": "400160",
    "end": "402560"
  },
  {
    "text": "have a series of base base plate",
    "start": "402560",
    "end": "404759"
  },
  {
    "text": "libraries and these are uh basically the",
    "start": "404759",
    "end": "407080"
  },
  {
    "text": "underlying microservice library that all",
    "start": "407080",
    "end": "409440"
  },
  {
    "text": "the services are built on top of and so",
    "start": "409440",
    "end": "411599"
  },
  {
    "text": "we could instrument all of the base",
    "start": "411599",
    "end": "414199"
  },
  {
    "text": "plate code with Prometheus at a pod",
    "start": "414199",
    "end": "418280"
  },
  {
    "text": "monitor uh and then all teams had to do",
    "start": "418280",
    "end": "420840"
  },
  {
    "text": "is upgrade their base plate and they",
    "start": "420840",
    "end": "422639"
  },
  {
    "text": "would instantly get Prometheus",
    "start": "422639",
    "end": "423960"
  },
  {
    "text": "monitoring on their service uh and so we",
    "start": "423960",
    "end": "426479"
  },
  {
    "text": "kind of used uh Prometheus and our base",
    "start": "426479",
    "end": "429759"
  },
  {
    "text": "plate as an APM kind of",
    "start": "429759",
    "end": "433720"
  },
  {
    "text": "plug-in uh we also uh in some cases",
    "start": "434280",
    "end": "437599"
  },
  {
    "text": "there are services that didn't use base",
    "start": "437599",
    "end": "439280"
  },
  {
    "text": "plate or didn't want to upgrade uh or",
    "start": "439280",
    "end": "441400"
  },
  {
    "text": "couldn't upgrade because their code base",
    "start": "441400",
    "end": "442919"
  },
  {
    "text": "was kind of in maintenance mode abandon",
    "start": "442919",
    "end": "445120"
  },
  {
    "text": "mode uh Legacy code and so we uh also",
    "start": "445120",
    "end": "449759"
  },
  {
    "text": "use the kubernetes sidecar model to use",
    "start": "449759",
    "end": "452520"
  },
  {
    "text": "the statsd exporter so instead of",
    "start": "452520",
    "end": "454639"
  },
  {
    "text": "sending the statsd to a telegraph we",
    "start": "454639",
    "end": "456960"
  },
  {
    "text": "would send it to Local Host and then we",
    "start": "456960",
    "end": "459879"
  },
  {
    "text": "could use that to convert the data into",
    "start": "459879",
    "end": "461639"
  },
  {
    "text": "a Prometheus metrics endpoint and that",
    "start": "461639",
    "end": "463919"
  },
  {
    "text": "also worked really well uh we also",
    "start": "463919",
    "end": "466280"
  },
  {
    "text": "started uh needed to pull in data from",
    "start": "466280",
    "end": "469280"
  },
  {
    "text": "our uh Cloud providers so we have things",
    "start": "469280",
    "end": "473000"
  },
  {
    "text": "like ads Cloud watch well what how are",
    "start": "473000",
    "end": "475240"
  },
  {
    "text": "you going to monitor that the old SAS",
    "start": "475240",
    "end": "477520"
  },
  {
    "text": "service would do that for us uh so we",
    "start": "477520",
    "end": "480840"
  },
  {
    "text": "had to implement things like the cloud",
    "start": "480840",
    "end": "482479"
  },
  {
    "text": "watch",
    "start": "482479",
    "end": "484199"
  },
  {
    "text": "exporter um and now today we in just a",
    "start": "484199",
    "end": "487879"
  },
  {
    "text": "boatload of data Maybe not as much as",
    "start": "487879",
    "end": "489680"
  },
  {
    "text": "Cloud flare but uh uh we're we're",
    "start": "489680",
    "end": "492159"
  },
  {
    "text": "getting",
    "start": "492159",
    "end": "494479"
  },
  {
    "text": "there so I'm going to hand it over to",
    "start": "496520",
    "end": "499400"
  },
  {
    "start": "497000",
    "end": "901000"
  },
  {
    "text": "Trevor here to now talk about how uh we",
    "start": "499400",
    "end": "502479"
  },
  {
    "text": "had scale up uh how we scaled things up",
    "start": "502479",
    "end": "505280"
  },
  {
    "text": "yeah thanks Ben um yeah as bartex",
    "start": "505280",
    "end": "508759"
  },
  {
    "text": "alluded to",
    "start": "508759",
    "end": "510000"
  },
  {
    "text": "uh we this talk is going to touch a",
    "start": "510000",
    "end": "512159"
  },
  {
    "text": "little bit on Thanos a little bit on",
    "start": "512159",
    "end": "513560"
  },
  {
    "text": "Prometheus and how we have automated our",
    "start": "513560",
    "end": "516440"
  },
  {
    "text": "Prometheus deployments um ultimately",
    "start": "516440",
    "end": "518760"
  },
  {
    "text": "Thanos is the glue um that holds all of",
    "start": "518760",
    "end": "521039"
  },
  {
    "text": "this",
    "start": "521039",
    "end": "523080"
  },
  {
    "text": "together",
    "start": "523080",
    "end": "524600"
  },
  {
    "text": "um so as Ben was first saying",
    "start": "524600",
    "end": "527959"
  },
  {
    "text": "uh the challenge we were trying to solve",
    "start": "527959",
    "end": "530480"
  },
  {
    "text": "was our lack of detailed metrics with",
    "start": "530480",
    "end": "533240"
  },
  {
    "text": "statd uh we aggregated out a lot of the",
    "start": "533240",
    "end": "536000"
  },
  {
    "text": "useful bits uh sent it up to our third",
    "start": "536000",
    "end": "538279"
  },
  {
    "text": "party provider",
    "start": "538279",
    "end": "540399"
  },
  {
    "text": "um we've had some experience rning",
    "start": "540399",
    "end": "542360"
  },
  {
    "text": "Prometheus in the past um we used it for",
    "start": "542360",
    "end": "544880"
  },
  {
    "text": "SE advisor metrics container metrics",
    "start": "544880",
    "end": "547399"
  },
  {
    "text": "tube State metrics things like that",
    "start": "547399",
    "end": "549040"
  },
  {
    "text": "that's how we got those into the sess um",
    "start": "549040",
    "end": "551880"
  },
  {
    "text": "we had problems with these",
    "start": "551880",
    "end": "553320"
  },
  {
    "text": "preuses uh we would run one Prometheus",
    "start": "553320",
    "end": "556160"
  },
  {
    "text": "per cluster no",
    "start": "556160",
    "end": "558040"
  },
  {
    "text": "ha um the cluster would get larger a",
    "start": "558040",
    "end": "561000"
  },
  {
    "text": "large scale of PODS the Prometheus are",
    "start": "561000",
    "end": "563240"
  },
  {
    "text": "crash uh we'd be stuck waiting on the",
    "start": "563240",
    "end": "565480"
  },
  {
    "text": "wall to load up uh tons and tons of data",
    "start": "565480",
    "end": "568600"
  },
  {
    "text": "we'd be down for an hour um there's a",
    "start": "568600",
    "end": "570760"
  },
  {
    "text": "lot of pain there um and so as part of",
    "start": "570760",
    "end": "573200"
  },
  {
    "text": "this project we wanted to solve that",
    "start": "573200",
    "end": "574640"
  },
  {
    "text": "pain as",
    "start": "574640",
    "end": "577040"
  },
  {
    "text": "well we we've scaled up we've got over",
    "start": "581360",
    "end": "584760"
  },
  {
    "text": "2,000 Nam spaces um essentially we we",
    "start": "584760",
    "end": "588480"
  },
  {
    "text": "ended up writing an operator to solve",
    "start": "588480",
    "end": "590320"
  },
  {
    "text": "this uh we chose namespace as our how we",
    "start": "590320",
    "end": "593079"
  },
  {
    "text": "wanted to distribute or how we wanted to",
    "start": "593079",
    "end": "595040"
  },
  {
    "text": "Shard out our Prometheus deployments um",
    "start": "595040",
    "end": "597760"
  },
  {
    "text": "so each team or service or",
    "start": "597760",
    "end": "599839"
  },
  {
    "text": "namespace um gets a Prometheus or ha",
    "start": "599839",
    "end": "604079"
  },
  {
    "text": "replica",
    "start": "604079",
    "end": "605079"
  },
  {
    "text": "pair um what this means is we wanted to",
    "start": "605079",
    "end": "609040"
  },
  {
    "text": "automate this process so that we don't",
    "start": "609040",
    "end": "611120"
  },
  {
    "text": "have to go set this up for everybody um",
    "start": "611120",
    "end": "613519"
  },
  {
    "text": "so our solution was an operator and",
    "start": "613519",
    "end": "615640"
  },
  {
    "text": "essentially we just watch for new",
    "start": "615640",
    "end": "616720"
  },
  {
    "text": "namespaces to spin up and when we see",
    "start": "616720",
    "end": "619560"
  },
  {
    "text": "new namespace we set up the Prometheus",
    "start": "619560",
    "end": "621320"
  },
  {
    "text": "pair um these",
    "start": "621320",
    "end": "622760"
  },
  {
    "text": "prometheus's have sidec cars ship data",
    "start": "622760",
    "end": "625279"
  },
  {
    "text": "to Thanos uh we gain long-term retention",
    "start": "625279",
    "end": "628120"
  },
  {
    "text": "S3 due to Thanos and we're able to",
    "start": "628120",
    "end": "630480"
  },
  {
    "text": "utilize thos query to query across all",
    "start": "630480",
    "end": "632360"
  },
  {
    "text": "of these various stores whether it's a",
    "start": "632360",
    "end": "633920"
  },
  {
    "text": "thel store pod Prometheus sidecar or a",
    "start": "633920",
    "end": "639839"
  },
  {
    "text": "ruler um so for the next next part um",
    "start": "640720",
    "end": "644079"
  },
  {
    "text": "we'll take a look at this",
    "start": "644079",
    "end": "646880"
  },
  {
    "text": "operator on top of just creating",
    "start": "649880",
    "end": "652800"
  },
  {
    "text": "Prometheus for each namespace uh the",
    "start": "652800",
    "end": "655760"
  },
  {
    "text": "operator will pre-populate Common rules",
    "start": "655760",
    "end": "657600"
  },
  {
    "text": "for our internal service framework based",
    "start": "657600",
    "end": "660560"
  },
  {
    "text": "um this enables teams to move quick um",
    "start": "660560",
    "end": "663079"
  },
  {
    "text": "they get shared dashboards uh they all",
    "start": "663079",
    "end": "666040"
  },
  {
    "text": "utilize the same kind of rule naming uh",
    "start": "666040",
    "end": "668480"
  },
  {
    "text": "n clature um and so we can get teams up",
    "start": "668480",
    "end": "671760"
  },
  {
    "text": "and running",
    "start": "671760",
    "end": "674279"
  },
  {
    "text": "fast for scaling our Prometheus uh we",
    "start": "674360",
    "end": "677519"
  },
  {
    "text": "use the vertical po Auto scaler um we",
    "start": "677519",
    "end": "679760"
  },
  {
    "text": "utilize this to dynamically scale the",
    "start": "679760",
    "end": "681240"
  },
  {
    "text": "Prometheus up and down uh well generally",
    "start": "681240",
    "end": "684360"
  },
  {
    "text": "up",
    "start": "684360",
    "end": "685720"
  },
  {
    "text": "um this is actually proven to be uh",
    "start": "685720",
    "end": "688399"
  },
  {
    "text": "quite a challenge um scaling the",
    "start": "688399",
    "end": "690680"
  },
  {
    "text": "stateful things is hard and um a lot of",
    "start": "690680",
    "end": "695240"
  },
  {
    "text": "the workloads we see is a team",
    "start": "695240",
    "end": "696519"
  },
  {
    "text": "introduces a new metric um which",
    "start": "696519",
    "end": "698399"
  },
  {
    "text": "introduces tons of cardinality sometimes",
    "start": "698399",
    "end": "700440"
  },
  {
    "text": "on purpose sometimes by accident um and",
    "start": "700440",
    "end": "702959"
  },
  {
    "text": "what this results is an out of memory",
    "start": "702959",
    "end": "704760"
  },
  {
    "text": "with Prometheus um sometimes our bial",
    "start": "704760",
    "end": "707519"
  },
  {
    "text": "pot autoscaler um can see the gradual",
    "start": "707519",
    "end": "709720"
  },
  {
    "text": "rise in resources and scale up before we",
    "start": "709720",
    "end": "712360"
  },
  {
    "text": "hit this point uh but many times we hit",
    "start": "712360",
    "end": "714600"
  },
  {
    "text": "it an out of memory error um and we do",
    "start": "714600",
    "end": "716519"
  },
  {
    "text": "have symmetric",
    "start": "716519",
    "end": "718000"
  },
  {
    "text": "downtime uh we we're looking at other",
    "start": "718000",
    "end": "720839"
  },
  {
    "text": "Solutions other than the vpa U",
    "start": "720839",
    "end": "723560"
  },
  {
    "text": "essentially we would love to track other",
    "start": "723560",
    "end": "725760"
  },
  {
    "text": "metrics than just CPU and memory um",
    "start": "725760",
    "end": "728480"
  },
  {
    "text": "potentially samples per second um to try",
    "start": "728480",
    "end": "731320"
  },
  {
    "text": "and like catch these things before um",
    "start": "731320",
    "end": "733880"
  },
  {
    "text": "they C prus to crash uh other things",
    "start": "733880",
    "end": "736240"
  },
  {
    "text": "we've put in for that",
    "start": "736240",
    "end": "738040"
  },
  {
    "text": "are um limits on each job so scrape",
    "start": "738040",
    "end": "741959"
  },
  {
    "text": "limits for Prometheus um at some point",
    "start": "741959",
    "end": "744040"
  },
  {
    "text": "instead of crashing uh it'll just start",
    "start": "744040",
    "end": "746040"
  },
  {
    "text": "dropping",
    "start": "746040",
    "end": "748160"
  },
  {
    "text": "samples",
    "start": "748160",
    "end": "750399"
  },
  {
    "text": "uh finally we do allow configuration per",
    "start": "750399",
    "end": "752360"
  },
  {
    "text": "namespace right now this is just the",
    "start": "752360",
    "end": "754160"
  },
  {
    "text": "annotations um at some point we'd like",
    "start": "754160",
    "end": "756160"
  },
  {
    "text": "to make this our own custom",
    "start": "756160",
    "end": "757880"
  },
  {
    "text": "resource uh this allows us to limit",
    "start": "757880",
    "end": "759880"
  },
  {
    "text": "things like the maximum CPU will scale",
    "start": "759880",
    "end": "762040"
  },
  {
    "text": "up to max memory sample limits",
    "start": "762040",
    "end": "765560"
  },
  {
    "text": "Etc the Min yeah as well as the Min uh",
    "start": "765560",
    "end": "769000"
  },
  {
    "text": "and the Min is uh as B was saying um we",
    "start": "769000",
    "end": "771399"
  },
  {
    "text": "do we are able to set the minimum value",
    "start": "771399",
    "end": "774199"
  },
  {
    "text": "uh this is really useful when spinning",
    "start": "774199",
    "end": "775560"
  },
  {
    "text": "up a new namespace uh if we have to take",
    "start": "775560",
    "end": "778320"
  },
  {
    "text": "into account all allow large service",
    "start": "778320",
    "end": "780000"
  },
  {
    "text": "coming online uh we can kind of set the",
    "start": "780000",
    "end": "782000"
  },
  {
    "text": "minimum so we don't have to like uh",
    "start": "782000",
    "end": "784320"
  },
  {
    "text": "trial and eror our way up to the correct",
    "start": "784320",
    "end": "788240"
  },
  {
    "text": "resources um so much of our initial",
    "start": "792920",
    "end": "796480"
  },
  {
    "text": "tuning was spent on thos store um we",
    "start": "796480",
    "end": "800079"
  },
  {
    "text": "actually haven't tried uh the time",
    "start": "800079",
    "end": "802760"
  },
  {
    "text": "series sharting as T has mentioned uh",
    "start": "802760",
    "end": "804800"
  },
  {
    "text": "we've kind of jumped into the hash based",
    "start": "804800",
    "end": "807160"
  },
  {
    "text": "charting um due to it simp licity um and",
    "start": "807160",
    "end": "811480"
  },
  {
    "text": "actually I when I get back I'm excited",
    "start": "811480",
    "end": "813600"
  },
  {
    "text": "to try out the time based charting based",
    "start": "813600",
    "end": "815399"
  },
  {
    "text": "on Colin's",
    "start": "815399",
    "end": "816680"
  },
  {
    "text": "experience um T talked about Vibe based",
    "start": "816680",
    "end": "820519"
  },
  {
    "text": "uh sizing um I feel like t-shirt sizing",
    "start": "820519",
    "end": "823199"
  },
  {
    "text": "is essentially Vibe based sizing you",
    "start": "823199",
    "end": "824720"
  },
  {
    "text": "pick a few different sizes and it when",
    "start": "824720",
    "end": "826480"
  },
  {
    "text": "it gets slow you uh make it a large um",
    "start": "826480",
    "end": "829240"
  },
  {
    "text": "that's really where we're at right now",
    "start": "829240",
    "end": "830720"
  },
  {
    "text": "uh with our thel stores we have our",
    "start": "830720",
    "end": "832000"
  },
  {
    "text": "large clusters we throw a ton of",
    "start": "832000",
    "end": "833759"
  },
  {
    "text": "resources at them um if a clusters",
    "start": "833759",
    "end": "837360"
  },
  {
    "text": "queries are feeling pain y slow we we",
    "start": "837360",
    "end": "840240"
  },
  {
    "text": "bump it a size um we'd love to continue",
    "start": "840240",
    "end": "843519"
  },
  {
    "text": "kind of iterating on that process and",
    "start": "843519",
    "end": "845240"
  },
  {
    "text": "getting um better metrics in better sets",
    "start": "845240",
    "end": "848560"
  },
  {
    "text": "um one of the uh we'll see a graph for",
    "start": "848560",
    "end": "851040"
  },
  {
    "text": "it in a moment uh one of the metrics we",
    "start": "851040",
    "end": "852720"
  },
  {
    "text": "tracked uh is basically just like the",
    "start": "852720",
    "end": "854800"
  },
  {
    "text": "number of um probe queries that are",
    "start": "854800",
    "end": "858639"
  },
  {
    "text": "greater than 1 second so we wrote some",
    "start": "858639",
    "end": "861040"
  },
  {
    "text": "just like very simple range query",
    "start": "861040",
    "end": "862600"
  },
  {
    "text": "instant query um we kind of utilize",
    "start": "862600",
    "end": "864880"
  },
  {
    "text": "these to just see how quick our response",
    "start": "864880",
    "end": "866399"
  },
  {
    "text": "times were um because it's too hard it",
    "start": "866399",
    "end": "869759"
  },
  {
    "text": "it can be challenging to do that using",
    "start": "869759",
    "end": "871399"
  },
  {
    "text": "user queries uh because we don't know",
    "start": "871399",
    "end": "872839"
  },
  {
    "text": "what they're going to ask",
    "start": "872839",
    "end": "874839"
  },
  {
    "text": "for um generally the difference between",
    "start": "874839",
    "end": "876959"
  },
  {
    "text": "each size is just the number of",
    "start": "876959",
    "end": "879440"
  },
  {
    "text": "shards",
    "start": "879440",
    "end": "881240"
  },
  {
    "text": "um yeah and we're using the hash based",
    "start": "881240",
    "end": "885279"
  },
  {
    "text": "sharting um another piece we kind of we",
    "start": "885360",
    "end": "888560"
  },
  {
    "text": "also sharted uh is Cube State metrics um",
    "start": "888560",
    "end": "891880"
  },
  {
    "text": "this is something that uh we didn't",
    "start": "891880",
    "end": "893959"
  },
  {
    "text": "really run into too many issues with um",
    "start": "893959",
    "end": "896639"
  },
  {
    "text": "but we definitely had to sh it out in",
    "start": "896639",
    "end": "897839"
  },
  {
    "text": "our larger clusters",
    "start": "897839",
    "end": "901040"
  },
  {
    "start": "901000",
    "end": "915000"
  },
  {
    "text": "okay so that was some of the stealing",
    "start": "902079",
    "end": "904040"
  },
  {
    "text": "work we did um kind of up front I think",
    "start": "904040",
    "end": "906120"
  },
  {
    "text": "I touched on a few of the challenges",
    "start": "906120",
    "end": "907600"
  },
  {
    "text": "there um now I'm going to talk about",
    "start": "907600",
    "end": "908959"
  },
  {
    "text": "some more of the challenges we've run",
    "start": "908959",
    "end": "910279"
  },
  {
    "text": "into running both preus and Thanos at",
    "start": "910279",
    "end": "912639"
  },
  {
    "text": "this",
    "start": "912639",
    "end": "914800"
  },
  {
    "start": "915000",
    "end": "1044000"
  },
  {
    "text": "scale um so the graph on the right is",
    "start": "915040",
    "end": "918320"
  },
  {
    "text": "that query probe um that I mentioned so",
    "start": "918320",
    "end": "920680"
  },
  {
    "text": "that's the percentage of queries that",
    "start": "920680",
    "end": "921839"
  },
  {
    "text": "took longer than 1",
    "start": "921839",
    "end": "923399"
  },
  {
    "text": "second um the time frame here is from",
    "start": "923399",
    "end": "925720"
  },
  {
    "text": "like February to June and where it",
    "start": "925720",
    "end": "927680"
  },
  {
    "text": "starts to spike up is right around April",
    "start": "927680",
    "end": "930800"
  },
  {
    "text": "um in April we made the decision to",
    "start": "930800",
    "end": "933000"
  },
  {
    "text": "disable partial response um we were",
    "start": "933000",
    "end": "935440"
  },
  {
    "text": "getting some like uh unexpected results",
    "start": "935440",
    "end": "937800"
  },
  {
    "text": "from some of our rules uh especially",
    "start": "937800",
    "end": "939560"
  },
  {
    "text": "like aggregations um dividing by less",
    "start": "939560",
    "end": "941880"
  },
  {
    "text": "data things like that um because some",
    "start": "941880",
    "end": "944399"
  },
  {
    "text": "piece of our query would",
    "start": "944399",
    "end": "946240"
  },
  {
    "text": "fail uh so we made this decision uh I",
    "start": "946240",
    "end": "949160"
  },
  {
    "text": "think maybe about a week into it we had",
    "start": "949160",
    "end": "952000"
  },
  {
    "text": "uh leadership asking hey can we turn",
    "start": "952000",
    "end": "954240"
  },
  {
    "text": "that back on because it felt really bad",
    "start": "954240",
    "end": "956399"
  },
  {
    "text": "um having so many queries fail or takes",
    "start": "956399",
    "end": "958720"
  },
  {
    "text": "a long um and what we realized is like",
    "start": "958720",
    "end": "962319"
  },
  {
    "text": "we actually had a lot of query problems",
    "start": "962319",
    "end": "963959"
  },
  {
    "text": "we had a lot of queries that failed um",
    "start": "963959",
    "end": "966800"
  },
  {
    "text": "and this this touches on that need for",
    "start": "966800",
    "end": "969240"
  },
  {
    "text": "uh label proxy or uh label enforcer um",
    "start": "969240",
    "end": "972839"
  },
  {
    "text": "because every time a user would run a",
    "start": "972839",
    "end": "974319"
  },
  {
    "text": "query this would fan out to every single",
    "start": "974319",
    "end": "975920"
  },
  {
    "text": "Prometheus in every single cluster uh",
    "start": "975920",
    "end": "978319"
  },
  {
    "text": "including all the stores and if one",
    "start": "978319",
    "end": "980839"
  },
  {
    "text": "Prometheus was having a bad time the",
    "start": "980839",
    "end": "983279"
  },
  {
    "text": "query would fail not just be slow uh as",
    "start": "983279",
    "end": "986240"
  },
  {
    "text": "soon as we turn pral response on it",
    "start": "986240",
    "end": "987600"
  },
  {
    "text": "would Now fail um",
    "start": "987600",
    "end": "989519"
  },
  {
    "text": "and what these a lot of times respon off",
    "start": "989519",
    "end": "992319"
  },
  {
    "text": "or with partial response off yes",
    "start": "992319",
    "end": "997199"
  },
  {
    "text": "um these failures weren't always pretty",
    "start": "997199",
    "end": "999600"
  },
  {
    "text": "either uh grafana renders them as like",
    "start": "999600",
    "end": "1001800"
  },
  {
    "text": "showing every single prometheus's",
    "start": "1001800",
    "end": "1003839"
  },
  {
    "text": "external labels and a giant list um",
    "start": "1003839",
    "end": "1007160"
  },
  {
    "text": "which is really confusing for our users",
    "start": "1007160",
    "end": "1009920"
  },
  {
    "text": "um and so yeah adding the external label",
    "start": "1009920",
    "end": "1014199"
  },
  {
    "text": "forcer um essentially as a proxy between",
    "start": "1014199",
    "end": "1016839"
  },
  {
    "text": "Thanos query front end and Thanos query",
    "start": "1016839",
    "end": "1019360"
  },
  {
    "text": "um enabled us to give nice air messages",
    "start": "1019360",
    "end": "1022040"
  },
  {
    "text": "when a label is missing and enforce that",
    "start": "1022040",
    "end": "1024240"
  },
  {
    "text": "just a few select key external labels",
    "start": "1024240",
    "end": "1026640"
  },
  {
    "text": "that'll at least get us to a cluster or",
    "start": "1026640",
    "end": "1028280"
  },
  {
    "text": "a specific Prometheus um are enforced",
    "start": "1028280",
    "end": "1031558"
  },
  {
    "text": "and uh with the release of that we we",
    "start": "1031559",
    "end": "1033839"
  },
  {
    "text": "saw",
    "start": "1033839",
    "end": "1035480"
  },
  {
    "text": "um the time of our queries and the",
    "start": "1035480",
    "end": "1037880"
  },
  {
    "text": "failures of our queries like Drop",
    "start": "1037880",
    "end": "1041480"
  },
  {
    "start": "1044000",
    "end": "1208000"
  },
  {
    "text": "substantially um another major challenge",
    "start": "1044799",
    "end": "1046959"
  },
  {
    "text": "we have right now is Rule management",
    "start": "1046959",
    "end": "1049840"
  },
  {
    "text": "and some of this is based on the tiered",
    "start": "1049840",
    "end": "1052360"
  },
  {
    "text": "architecture we have um we we encourage",
    "start": "1052360",
    "end": "1055280"
  },
  {
    "text": "teams to run rules locally on their",
    "start": "1055280",
    "end": "1058280"
  },
  {
    "text": "names spaces Prometheus if they fit into",
    "start": "1058280",
    "end": "1060919"
  },
  {
    "text": "that model so if their uh their rule",
    "start": "1060919",
    "end": "1063440"
  },
  {
    "text": "runs over less than 24 hours worth of",
    "start": "1063440",
    "end": "1065480"
  },
  {
    "text": "data and um only need STI query data",
    "start": "1065480",
    "end": "1069080"
  },
  {
    "text": "within their Prometheus we encourage",
    "start": "1069080",
    "end": "1070880"
  },
  {
    "text": "them to run it there uh as soon as they",
    "start": "1070880",
    "end": "1073400"
  },
  {
    "text": "need data outside of that 24-hour period",
    "start": "1073400",
    "end": "1076760"
  },
  {
    "text": "now they need a CH to Thanos store um um",
    "start": "1076760",
    "end": "1079000"
  },
  {
    "text": "so",
    "start": "1079000",
    "end": "1080280"
  },
  {
    "text": "we yeah uh so we have we have cluster",
    "start": "1080280",
    "end": "1083120"
  },
  {
    "text": "level rulers um that run within that",
    "start": "1083120",
    "end": "1085520"
  },
  {
    "text": "cluster uh and then we've since added a",
    "start": "1085520",
    "end": "1087679"
  },
  {
    "text": "global level if you want to aggregate",
    "start": "1087679",
    "end": "1089640"
  },
  {
    "text": "across",
    "start": "1089640",
    "end": "1090600"
  },
  {
    "text": "clusters um part of the challenge with",
    "start": "1090600",
    "end": "1092679"
  },
  {
    "text": "this is uh teaching our users where to",
    "start": "1092679",
    "end": "1095120"
  },
  {
    "text": "run their rules um keeping track of uh",
    "start": "1095120",
    "end": "1099760"
  },
  {
    "text": "where rules are deployed or where they",
    "start": "1099760",
    "end": "1102240"
  },
  {
    "text": "came",
    "start": "1102240",
    "end": "1103039"
  },
  {
    "text": "from",
    "start": "1103039",
    "end": "1104919"
  },
  {
    "text": "um and this is still a problem we have",
    "start": "1104919",
    "end": "1107080"
  },
  {
    "text": "today um especially going through trying",
    "start": "1107080",
    "end": "1108919"
  },
  {
    "text": "to clean up rules that we have some uh",
    "start": "1108919",
    "end": "1111280"
  },
  {
    "text": "origin issues um and so what we'd like",
    "start": "1111280",
    "end": "1114280"
  },
  {
    "text": "to work on coming up uh is some kind of",
    "start": "1114280",
    "end": "1116120"
  },
  {
    "text": "centralized API for this where our users",
    "start": "1116120",
    "end": "1118640"
  },
  {
    "text": "can tell us a rule that they want to run",
    "start": "1118640",
    "end": "1120760"
  },
  {
    "text": "and we will figure out where it needs to",
    "start": "1120760",
    "end": "1122120"
  },
  {
    "text": "be um and then it'll also give us more",
    "start": "1122120",
    "end": "1124480"
  },
  {
    "text": "control over tracking um where they came",
    "start": "1124480",
    "end": "1129000"
  },
  {
    "text": "from uh finally to help with alerting",
    "start": "1129720",
    "end": "1132760"
  },
  {
    "text": "rules we've created a Alert in alert",
    "start": "1132760",
    "end": "1136280"
  },
  {
    "text": "routing service um this service",
    "start": "1136280",
    "end": "1138080"
  },
  {
    "text": "essentially will look at things like",
    "start": "1138080",
    "end": "1139360"
  },
  {
    "text": "npace uh or other labels and figure out",
    "start": "1139360",
    "end": "1143159"
  },
  {
    "text": "which P Duty um Team to route to um this",
    "start": "1143159",
    "end": "1145679"
  },
  {
    "text": "is really useful for things like uh pods",
    "start": "1145679",
    "end": "1148240"
  },
  {
    "text": "are exceeding their CPU limits uh pods",
    "start": "1148240",
    "end": "1150600"
  },
  {
    "text": "are restarting um these are just kind of",
    "start": "1150600",
    "end": "1152600"
  },
  {
    "text": "generic infrastructure alerts um and we",
    "start": "1152600",
    "end": "1155960"
  },
  {
    "text": "don't want to page our infrastructure",
    "start": "1155960",
    "end": "1157200"
  },
  {
    "text": "team we want to page the team that's",
    "start": "1157200",
    "end": "1158720"
  },
  {
    "text": "responsible for the",
    "start": "1158720",
    "end": "1161039"
  },
  {
    "text": "service yeah part part of that uh comes",
    "start": "1161039",
    "end": "1163840"
  },
  {
    "text": "from the fact that even though we",
    "start": "1163840",
    "end": "1165559"
  },
  {
    "text": "monitor each team's name space things",
    "start": "1165559",
    "end": "1168000"
  },
  {
    "text": "like container metrics and Cube State",
    "start": "1168000",
    "end": "1169799"
  },
  {
    "text": "metrics those still need to be",
    "start": "1169799",
    "end": "1171480"
  },
  {
    "text": "centralized in a single Prometheus per",
    "start": "1171480",
    "end": "1173280"
  },
  {
    "text": "cluster because in order to get the",
    "start": "1173280",
    "end": "1175679"
  },
  {
    "text": "combination of labels to monitor both",
    "start": "1175679",
    "end": "1178080"
  },
  {
    "text": "the container and Cube State and you",
    "start": "1178080",
    "end": "1180880"
  },
  {
    "text": "know Cube pod labels and and be able to",
    "start": "1180880",
    "end": "1183400"
  },
  {
    "text": "do those joins uh all that data has to",
    "start": "1183400",
    "end": "1186000"
  },
  {
    "text": "be in one Prometheus anyway and that's",
    "start": "1186000",
    "end": "1188039"
  },
  {
    "text": "not really shable per team and so",
    "start": "1188039",
    "end": "1190679"
  },
  {
    "text": "instead of being able to write their own",
    "start": "1190679",
    "end": "1192520"
  },
  {
    "text": "container uh alerts uh we have to",
    "start": "1192520",
    "end": "1195240"
  },
  {
    "text": "centralize and standardize the container",
    "start": "1195240",
    "end": "1197320"
  },
  {
    "text": "alerts uh so we needed another way to",
    "start": "1197320",
    "end": "1200200"
  },
  {
    "text": "key the routing not just from uh the",
    "start": "1200200",
    "end": "1202880"
  },
  {
    "text": "external labels of the Prometheus that",
    "start": "1202880",
    "end": "1204440"
  },
  {
    "text": "their data was coming",
    "start": "1204440",
    "end": "1207559"
  },
  {
    "start": "1208000",
    "end": "1322000"
  },
  {
    "text": "from all right um and finally",
    "start": "1209400",
    "end": "1212559"
  },
  {
    "text": "cardinality uh is an issue um I hinted",
    "start": "1212559",
    "end": "1216600"
  },
  {
    "text": "at this earlier uh teams will",
    "start": "1216600",
    "end": "1218360"
  },
  {
    "text": "accidentally introduce a label that keys",
    "start": "1218360",
    "end": "1221159"
  },
  {
    "text": "on user data or is a random string um",
    "start": "1221159",
    "end": "1223520"
  },
  {
    "text": "and we'll see Cardell go through the",
    "start": "1223520",
    "end": "1225559"
  },
  {
    "text": "roof we'll see Prometheus is trash we'll",
    "start": "1225559",
    "end": "1227400"
  },
  {
    "text": "see queries get flow um and this is just",
    "start": "1227400",
    "end": "1230320"
  },
  {
    "text": "kind of an ongoing challenge um that we",
    "start": "1230320",
    "end": "1232080"
  },
  {
    "text": "have to deal with um the other case is",
    "start": "1232080",
    "end": "1234440"
  },
  {
    "text": "when is essentially histograms",
    "start": "1234440",
    "end": "1236240"
  },
  {
    "text": "histograms just generate lots of",
    "start": "1236240",
    "end": "1237720"
  },
  {
    "text": "cardinality um and we have teams that",
    "start": "1237720",
    "end": "1239600"
  },
  {
    "text": "want to specifically like services like",
    "start": "1239600",
    "end": "1241600"
  },
  {
    "text": "graphql want to monitor all their",
    "start": "1241600",
    "end": "1243320"
  },
  {
    "text": "operations over a ton of different",
    "start": "1243320",
    "end": "1245200"
  },
  {
    "text": "buckets um and it it just doesn't always",
    "start": "1245200",
    "end": "1248960"
  },
  {
    "text": "feel well and we have to work with them",
    "start": "1248960",
    "end": "1250080"
  },
  {
    "text": "to figure out like what is the important",
    "start": "1250080",
    "end": "1251240"
  },
  {
    "text": "cardinality uh of their services um",
    "start": "1251240",
    "end": "1254679"
  },
  {
    "text": "these cardinality bombs generally result",
    "start": "1254679",
    "end": "1256559"
  },
  {
    "text": "in Prometheus being knocked out and not",
    "start": "1256559",
    "end": "1258200"
  },
  {
    "text": "just like one of the replica pair but",
    "start": "1258200",
    "end": "1260400"
  },
  {
    "text": "both um which uh",
    "start": "1260400",
    "end": "1263600"
  },
  {
    "text": "basically uh makes the last hours of",
    "start": "1263600",
    "end": "1266480"
  },
  {
    "text": "data uh not queryable until they're back",
    "start": "1266480",
    "end": "1268880"
  },
  {
    "text": "up uh as well as like missing all new",
    "start": "1268880",
    "end": "1272480"
  },
  {
    "text": "data um as I mentioned earlier we we've",
    "start": "1272480",
    "end": "1275080"
  },
  {
    "text": "added sample limits which has actually",
    "start": "1275080",
    "end": "1276480"
  },
  {
    "text": "helped reduce the number of",
    "start": "1276480",
    "end": "1279799"
  },
  {
    "text": "trashes uh and then the last piece",
    "start": "1282440",
    "end": "1284760"
  },
  {
    "text": "challenge I want to talk about um is the",
    "start": "1284760",
    "end": "1287520"
  },
  {
    "text": "vpa um I touched on it",
    "start": "1287520",
    "end": "1289960"
  },
  {
    "text": "earlier um stealing by the vpa is hard",
    "start": "1289960",
    "end": "1293520"
  },
  {
    "text": "um memory will balloon really fast with",
    "start": "1293520",
    "end": "1295960"
  },
  {
    "text": "Prometheus um one of the huge uh",
    "start": "1295960",
    "end": "1299200"
  },
  {
    "text": "features that uh Prometheus released uh",
    "start": "1299200",
    "end": "1301880"
  },
  {
    "text": "was the wall snapshots um the ability to",
    "start": "1301880",
    "end": "1305679"
  },
  {
    "text": "uh notice that we need to trigger the",
    "start": "1305679",
    "end": "1307799"
  },
  {
    "text": "vpa to restart the Pod and for that pod",
    "start": "1307799",
    "end": "1309760"
  },
  {
    "text": "to come up significantly faster uh",
    "start": "1309760",
    "end": "1311760"
  },
  {
    "text": "because it didn't actually have to read",
    "start": "1311760",
    "end": "1312760"
  },
  {
    "text": "through the entire wall um that that",
    "start": "1312760",
    "end": "1315440"
  },
  {
    "text": "kind of un unlocked a lot of the issues",
    "start": "1315440",
    "end": "1317720"
  },
  {
    "text": "um we've been seeing with vpa",
    "start": "1317720",
    "end": "1321520"
  },
  {
    "start": "1322000",
    "end": "1405000"
  },
  {
    "text": "dealing and I'll send it back to Ben",
    "start": "1323080",
    "end": "1325600"
  },
  {
    "text": "yeah so uh one of the nice things that",
    "start": "1325600",
    "end": "1328880"
  },
  {
    "text": "uh we have uh at Reddit is we do",
    "start": "1328880",
    "end": "1331440"
  },
  {
    "text": "actually have a good open source culture",
    "start": "1331440",
    "end": "1333360"
  },
  {
    "text": "so we do work with our Upstream so we",
    "start": "1333360",
    "end": "1336559"
  },
  {
    "text": "contribute to Prometheus we we try and",
    "start": "1336559",
    "end": "1338440"
  },
  {
    "text": "contribute to Thanos uh we're trying to",
    "start": "1338440",
    "end": "1340760"
  },
  {
    "text": "do more of that um uh I've been a",
    "start": "1340760",
    "end": "1344520"
  },
  {
    "text": "Prometheus maintainer for a while uh and",
    "start": "1344520",
    "end": "1347159"
  },
  {
    "text": "I'm trying to help onboard some of our",
    "start": "1347159",
    "end": "1348880"
  },
  {
    "text": "internal uh engineers and on our",
    "start": "1348880",
    "end": "1350720"
  },
  {
    "text": "observability team to be more Upstream",
    "start": "1350720",
    "end": "1353520"
  },
  {
    "text": "uh friendly and more do more Upstream",
    "start": "1353520",
    "end": "1356039"
  },
  {
    "text": "contributions um uh a bunch of the",
    "start": "1356039",
    "end": "1359159"
  },
  {
    "text": "functionality we talked about like the",
    "start": "1359159",
    "end": "1360559"
  },
  {
    "text": "label enforcer is stuff that's on our",
    "start": "1360559",
    "end": "1363520"
  },
  {
    "text": "rough plans to open source um and maybe",
    "start": "1363520",
    "end": "1366960"
  },
  {
    "text": "some more of the other internal tooling",
    "start": "1366960",
    "end": "1368360"
  },
  {
    "text": "what we've built uh actually we were",
    "start": "1368360",
    "end": "1370360"
  },
  {
    "text": "just uh I was just chatting with",
    "start": "1370360",
    "end": "1372520"
  },
  {
    "text": "somebody on the team this morning uh we",
    "start": "1372520",
    "end": "1374679"
  },
  {
    "text": "found a thing where we wanted to",
    "start": "1374679",
    "end": "1376799"
  },
  {
    "text": "actually update all all through history",
    "start": "1376799",
    "end": "1379760"
  },
  {
    "text": "into our S3 bucket uh all of the",
    "start": "1379760",
    "end": "1382919"
  },
  {
    "text": "external labels that are stored in the",
    "start": "1382919",
    "end": "1384480"
  },
  {
    "text": "Thanos metadata there's no Thanos tool",
    "start": "1384480",
    "end": "1387039"
  },
  {
    "text": "for this so we had to write our own",
    "start": "1387039",
    "end": "1388720"
  },
  {
    "text": "little internal tool and now I think uh",
    "start": "1388720",
    "end": "1391080"
  },
  {
    "text": "you know it's that's the perfect kind of",
    "start": "1391080",
    "end": "1392520"
  },
  {
    "text": "thing that we should contribute upstream",
    "start": "1392520",
    "end": "1394240"
  },
  {
    "text": "and I'm trying to get more of that uh",
    "start": "1394240",
    "end": "1396320"
  },
  {
    "text": "Upstream work done and I encourage",
    "start": "1396320",
    "end": "1398200"
  },
  {
    "text": "anybody here to uh work Upstream as much",
    "start": "1398200",
    "end": "1400880"
  },
  {
    "text": "as you can because it helps",
    "start": "1400880",
    "end": "1404520"
  },
  {
    "text": "everybody uh more stuff that we're going",
    "start": "1404520",
    "end": "1406760"
  },
  {
    "text": "to be doing uh of course there's still",
    "start": "1406760",
    "end": "1410640"
  },
  {
    "text": "many many many more things that we want",
    "start": "1410640",
    "end": "1412200"
  },
  {
    "text": "to fix uh uh trying to do anything",
    "start": "1412200",
    "end": "1415919"
  },
  {
    "text": "Perfect magic and scalable is kind of",
    "start": "1415919",
    "end": "1418240"
  },
  {
    "text": "disingenuous uh it takes a lot of work",
    "start": "1418240",
    "end": "1420880"
  },
  {
    "text": "to run this stuff at scale",
    "start": "1420880",
    "end": "1423279"
  },
  {
    "text": "um uh one of the things that like uh",
    "start": "1423279",
    "end": "1426440"
  },
  {
    "text": "Trevor said we want to work on the",
    "start": "1426440",
    "end": "1428080"
  },
  {
    "text": "recording rules and alerting and try and",
    "start": "1428080",
    "end": "1430080"
  },
  {
    "text": "make that better the nice thing is we",
    "start": "1430080",
    "end": "1432080"
  },
  {
    "text": "started entirely with inferis code so we",
    "start": "1432080",
    "end": "1434960"
  },
  {
    "text": "just need to work on organizing that",
    "start": "1434960",
    "end": "1437000"
  },
  {
    "text": "code um when whether it's coming from",
    "start": "1437000",
    "end": "1439159"
  },
  {
    "text": "the service repo or a monor repo uh uh",
    "start": "1439159",
    "end": "1443240"
  },
  {
    "text": "or automatically deployed from our",
    "start": "1443240",
    "end": "1446000"
  },
  {
    "text": "instrumentation and centralized managed",
    "start": "1446000",
    "end": "1448960"
  },
  {
    "text": "uh",
    "start": "1448960",
    "end": "1450000"
  },
  {
    "text": "clusters uh we also have been working on",
    "start": "1450000",
    "end": "1453159"
  },
  {
    "text": "tracing uh uh for our internal use uh",
    "start": "1453159",
    "end": "1456960"
  },
  {
    "text": "but that's going to be a whole separate",
    "start": "1456960",
    "end": "1458039"
  },
  {
    "text": "talk that Trevor is probably going to",
    "start": "1458039",
    "end": "1459520"
  },
  {
    "text": "give",
    "start": "1459520",
    "end": "1460200"
  },
  {
    "text": "again",
    "start": "1460200",
    "end": "1462200"
  },
  {
    "text": "um um one of the other fun things that",
    "start": "1462200",
    "end": "1465320"
  },
  {
    "text": "we want to do uh teams manage all of the",
    "start": "1465320",
    "end": "1468520"
  },
  {
    "text": "we have the base plate metrics and that",
    "start": "1468520",
    "end": "1470080"
  },
  {
    "text": "provides uh a good set of like HTTP and",
    "start": "1470080",
    "end": "1473480"
  },
  {
    "text": "grpc and database and client Library",
    "start": "1473480",
    "end": "1476480"
  },
  {
    "text": "code uh but teams can create their own",
    "start": "1476480",
    "end": "1478640"
  },
  {
    "text": "metrics and sometimes they get metric",
    "start": "1478640",
    "end": "1481679"
  },
  {
    "text": "names uh and they put labels into the",
    "start": "1481679",
    "end": "1484600"
  },
  {
    "text": "metric name and you end up with a metric",
    "start": "1484600",
    "end": "1486520"
  },
  {
    "text": "name explosion and that slows down",
    "start": "1486520",
    "end": "1488960"
  },
  {
    "text": "graff's uh uh metadata Json hugely so uh",
    "start": "1488960",
    "end": "1494480"
  },
  {
    "text": "at some points we've had to go and",
    "start": "1494480",
    "end": "1496240"
  },
  {
    "text": "notice that oh hey The Meta uh the",
    "start": "1496240",
    "end": "1498840"
  },
  {
    "text": "metadata Json that is trying to pull",
    "start": "1498840",
    "end": "1500760"
  },
  {
    "text": "down to do metric name autoc completion",
    "start": "1500760",
    "end": "1504080"
  },
  {
    "text": "is 100 megabytes of Json and that just",
    "start": "1504080",
    "end": "1506039"
  },
  {
    "text": "completely destroys every uh uh",
    "start": "1506039",
    "end": "1508919"
  },
  {
    "text": "engineer's browser with too much data um",
    "start": "1508919",
    "end": "1512200"
  },
  {
    "text": "and so we we uh we need to maybe do some",
    "start": "1512200",
    "end": "1515640"
  },
  {
    "text": "Metric name",
    "start": "1515640",
    "end": "1516880"
  },
  {
    "text": "enforcements uh or some other kind of",
    "start": "1516880",
    "end": "1519039"
  },
  {
    "text": "automated auditing of of metric names in",
    "start": "1519039",
    "end": "1522440"
  },
  {
    "text": "in each namespace but at least the nice",
    "start": "1522440",
    "end": "1524559"
  },
  {
    "text": "thing is uh because we've charted by",
    "start": "1524559",
    "end": "1526520"
  },
  {
    "text": "namespace when a team does blow up their",
    "start": "1526520",
    "end": "1529279"
  },
  {
    "text": "Prometheus uh it only blows up their",
    "start": "1529279",
    "end": "1531760"
  },
  {
    "text": "Prometheus and not everybody else's and",
    "start": "1531760",
    "end": "1534240"
  },
  {
    "text": "so it only takes out one team's service",
    "start": "1534240",
    "end": "1536720"
  },
  {
    "text": "and doesn't interrupt any other team so",
    "start": "1536720",
    "end": "1538720"
  },
  {
    "text": "they can only hurt themselves",
    "start": "1538720",
    "end": "1542159"
  },
  {
    "text": "um uh uh We've also been uh testing out",
    "start": "1542159",
    "end": "1546200"
  },
  {
    "text": "the go mem limit features uh I just",
    "start": "1546200",
    "end": "1549320"
  },
  {
    "text": "started doing this to try and soften the",
    "start": "1549320",
    "end": "1552960"
  },
  {
    "text": "uh the out of memory conditions uh we're",
    "start": "1552960",
    "end": "1555640"
  },
  {
    "text": "doing this with the Prometheus right now",
    "start": "1555640",
    "end": "1557720"
  },
  {
    "text": "but I we were just talking about like we",
    "start": "1557720",
    "end": "1559440"
  },
  {
    "text": "need to do this in Thanos in the storees",
    "start": "1559440",
    "end": "1561360"
  },
  {
    "text": "so the stores don't o uh they will just",
    "start": "1561360",
    "end": "1563840"
  },
  {
    "text": "get up to their memory limit and then",
    "start": "1563840",
    "end": "1565240"
  },
  {
    "text": "they'll just start GC uh to try and uh",
    "start": "1565240",
    "end": "1568360"
  },
  {
    "text": "avoid the O uh o problems there um and",
    "start": "1568360",
    "end": "1572399"
  },
  {
    "text": "then uh uh we have two pedabytes of data",
    "start": "1572399",
    "end": "1575600"
  },
  {
    "text": "but I think uh we can cut that in half",
    "start": "1575600",
    "end": "1579000"
  },
  {
    "text": "uh by using the vertical compaction and",
    "start": "1579000",
    "end": "1581679"
  },
  {
    "text": "so that's something that we have we've",
    "start": "1581679",
    "end": "1583640"
  },
  {
    "text": "been wanting to uh test and experiment",
    "start": "1583640",
    "end": "1585360"
  },
  {
    "text": "with I don't know if anybody is using uh",
    "start": "1585360",
    "end": "1587799"
  },
  {
    "text": "the permanent D duplication vertical",
    "start": "1587799",
    "end": "1590120"
  },
  {
    "text": "compaction uh I'd love to talk to you",
    "start": "1590120",
    "end": "1592000"
  },
  {
    "text": "about",
    "start": "1592000",
    "end": "1594279"
  },
  {
    "start": "1594000",
    "end": "1706000"
  },
  {
    "text": "that",
    "start": "1594320",
    "end": "1597000"
  },
  {
    "text": "questions thank you",
    "start": "1597000",
    "end": "1599200"
  },
  {
    "text": "everyone thank you",
    "start": "1599200",
    "end": "1602440"
  },
  {
    "text": "for we have we have maybe time for one",
    "start": "1604360",
    "end": "1607120"
  },
  {
    "text": "or two questions but in meantime you can",
    "start": "1607120",
    "end": "1609520"
  },
  {
    "text": "another speaker can prepare anyone has",
    "start": "1609520",
    "end": "1612120"
  },
  {
    "text": "maybe question",
    "start": "1612120",
    "end": "1615000"
  },
  {
    "text": "amazing when you talk about limiting the",
    "start": "1616200",
    "end": "1619320"
  },
  {
    "text": "number of metrics per name space What",
    "start": "1619320",
    "end": "1622880"
  },
  {
    "text": "mechanism is that is that Prometheus is",
    "start": "1622880",
    "end": "1625320"
  },
  {
    "text": "built-in limits for scrapes or yes uh",
    "start": "1625320",
    "end": "1628120"
  },
  {
    "text": "scrape sample limits uh we set we set a",
    "start": "1628120",
    "end": "1630720"
  },
  {
    "text": "scrape sample limit but teams also uh",
    "start": "1630720",
    "end": "1633320"
  },
  {
    "text": "with our operator can self-service",
    "start": "1633320",
    "end": "1635480"
  },
  {
    "text": "override that with an namespace",
    "start": "1635480",
    "end": "1639240"
  },
  {
    "text": "annotation any other question from the",
    "start": "1644120",
    "end": "1646520"
  },
  {
    "text": "audience amazing",
    "start": "1646520",
    "end": "1650159"
  },
  {
    "text": "okay hi thank you um do you plan you you",
    "start": "1653880",
    "end": "1657559"
  },
  {
    "text": "talked about the alert manager uh",
    "start": "1657559",
    "end": "1659520"
  },
  {
    "text": "routing service which you wrote Hi here",
    "start": "1659520",
    "end": "1663399"
  },
  {
    "text": "hard to see that there do you plan on",
    "start": "1663399",
    "end": "1666000"
  },
  {
    "text": "upstreaming that as well because this",
    "start": "1666000",
    "end": "1668000"
  },
  {
    "text": "sounds really interesting to uh me with",
    "start": "1668000",
    "end": "1671279"
  },
  {
    "text": "many clusters",
    "start": "1671279",
    "end": "1672840"
  },
  {
    "text": "happening uh yeah um that is something",
    "start": "1672840",
    "end": "1676360"
  },
  {
    "text": "we could do uh it's not exactly super",
    "start": "1676360",
    "end": "1679880"
  },
  {
    "text": "portable it's actually a whole separate",
    "start": "1679880",
    "end": "1681399"
  },
  {
    "text": "tool that basically generates alert",
    "start": "1681399",
    "end": "1684120"
  },
  {
    "text": "manager routing trees and puts it into a",
    "start": "1684120",
    "end": "1686000"
  },
  {
    "text": "config map if I remember correctly um",
    "start": "1686000",
    "end": "1689039"
  },
  {
    "text": "it's very keyed around our internal uh",
    "start": "1689039",
    "end": "1692760"
  },
  {
    "text": "uh service database and so it's not",
    "start": "1692760",
    "end": "1695600"
  },
  {
    "text": "quite a portable",
    "start": "1695600",
    "end": "1697720"
  },
  {
    "text": "project amazing okay thank you round of",
    "start": "1697720",
    "end": "1700240"
  },
  {
    "text": "applause",
    "start": "1700240",
    "end": "1702640"
  },
  {
    "text": "again",
    "start": "1705600",
    "end": "1708600"
  }
]