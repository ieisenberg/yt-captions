[
  {
    "start": "0",
    "end": "113000"
  },
  {
    "text": "welcome everyone to this breakout session we are live in Detroit welcome",
    "start": "1140",
    "end": "6779"
  },
  {
    "text": "also to our virtual audience our talk today is one VT org to rule them all",
    "start": "6779",
    "end": "13200"
  },
  {
    "text": "high availability in a distributed system uh distributed database system",
    "start": "13200",
    "end": "18420"
  },
  {
    "text": "and the distributed database we'll be talking about is with us",
    "start": "18420",
    "end": "24500"
  },
  {
    "text": "my name is dipti sigredi I'm a maintainer and Technical lead for wittest which is a graduated cncf",
    "start": "24720",
    "end": "31140"
  },
  {
    "text": "project and I'm a software engineer at Planet scale hello I am Anan I'm also a maintainer at",
    "start": "31140",
    "end": "38219"
  },
  {
    "text": "offer desk and a software engineer at Planet scale we'll start with a witness overview",
    "start": "38219",
    "end": "46860"
  },
  {
    "text": "s is a cloud native database but it originally started as a scaling solution",
    "start": "46860",
    "end": "52559"
  },
  {
    "text": "for MySQL at YouTube and from those Beginnings in 2010 it has evolved to",
    "start": "52559",
    "end": "59160"
  },
  {
    "text": "become a general purpose distributed database that is suitable for many workloads and many use cases",
    "start": "59160",
    "end": "67140"
  },
  {
    "text": "wittus is massively scalable if we look at some of the numbers the largest",
    "start": "67140",
    "end": "72540"
  },
  {
    "text": "instances of wittest run to 20 000 terabytes which is 20 petabytes 22 000",
    "start": "72540",
    "end": "79619"
  },
  {
    "text": "replicas 250 000 simultaneous connections though",
    "start": "79619",
    "end": "84659"
  },
  {
    "text": "that is not a limit you could go higher and so on and one of the ways bitus achieves the",
    "start": "84659",
    "end": "91080"
  },
  {
    "text": "massive scale is through sharding which we will not talk about in this talk but we have",
    "start": "91080",
    "end": "97020"
  },
  {
    "text": "a maintainer talk tomorrow where you can learn more about how we test does sharding wittus is also highly available that is",
    "start": "97020",
    "end": "104820"
  },
  {
    "text": "going to be the focus of this talk and witness is a MySQL compatible both 5.7",
    "start": "104820",
    "end": "110460"
  },
  {
    "text": "and 8.0 versions uh we'll now get a brief overview of the",
    "start": "110460",
    "end": "118020"
  },
  {
    "start": "113000",
    "end": "113000"
  },
  {
    "text": "architecture of wittus so uh",
    "start": "118020",
    "end": "123720"
  },
  {
    "text": "clients talk to with us through a proxy called vtgate and vtgate receives the",
    "start": "123720",
    "end": "131039"
  },
  {
    "text": "client requests which can be either MySQL or grpc those are the two protocols it supports",
    "start": "131039",
    "end": "137099"
  },
  {
    "text": "and routes them appropriately to the backend my sequels so in a sharded Witter system you may",
    "start": "137099",
    "end": "144300"
  },
  {
    "text": "have multiple charts but in each Shard there is a primary MySQL and there are",
    "start": "144300",
    "end": "149459"
  },
  {
    "text": "one or more replicas and vitigate figures out which shot to Route it to and when we run in this primary replica",
    "start": "149459",
    "end": "157080"
  },
  {
    "text": "replicated mode we have to make sure that each Shard is highly available",
    "start": "157080",
    "end": "162720"
  },
  {
    "text": "in addition to this query serving path through which vtgate receives the queries and routes them to the backend",
    "start": "162720",
    "end": "169140"
  },
  {
    "text": "my sequels there is also a control plane and this is where VTR comes in there is",
    "start": "169140",
    "end": "174900"
  },
  {
    "text": "a witness control Daemon which takes management commands from users through",
    "start": "174900",
    "end": "180180"
  },
  {
    "text": "CLI or the web UI and executes them there is VT admin which Powers our web",
    "start": "180180",
    "end": "187560"
  },
  {
    "text": "UI and then there's VT Arc so let's go through a little overview of",
    "start": "187560",
    "end": "194760"
  },
  {
    "text": "VTR and then we will have a demo what is the problem that VTR is trying",
    "start": "194760",
    "end": "201000"
  },
  {
    "start": "198000",
    "end": "198000"
  },
  {
    "text": "to solve the main problem that VTR is trying to solve is resiliency to my SQL failures",
    "start": "201000",
    "end": "206879"
  },
  {
    "text": "so we are running MySQL in a replicated mode but even then if the primary MySQL",
    "start": "206879",
    "end": "213120"
  },
  {
    "text": "goes down we have to deal with that failure mode and",
    "start": "213120",
    "end": "218879"
  },
  {
    "text": "we need to be highly available and that's the problem that PTR is solving however while ensuring High availability",
    "start": "218879",
    "end": "226620"
  },
  {
    "text": "you also want to be able to make sure that the data is durable if a",
    "start": "226620",
    "end": "232200"
  },
  {
    "text": "transaction has been accepted by the system then it shouldn't be lost that data should be persisted somewhere",
    "start": "232200",
    "end": "239580"
  },
  {
    "text": "and during this process of detecting and recovering from failures we want to",
    "start": "239580",
    "end": "244980"
  },
  {
    "text": "minimize the time taken for the recovery so what was the state of the art before",
    "start": "244980",
    "end": "252180"
  },
  {
    "text": "we built VT Arc there was uh open Arc orchestrator which was a different open",
    "start": "252180",
    "end": "258540"
  },
  {
    "text": "source project that a lot of large MySQL deployments used to deal with failures",
    "start": "258540",
    "end": "265080"
  },
  {
    "text": "at the MySQL level and there was an integration with wittus",
    "start": "265080",
    "end": "270600"
  },
  {
    "text": "the integration worked well enough most of the time but not all of the time",
    "start": "270600",
    "end": "276479"
  },
  {
    "text": "in addition to that the way durability was provided by Vitas was through semi-synchronous replication which we",
    "start": "276479",
    "end": "282900"
  },
  {
    "text": "will go through in a minute and uh that that configuration in invitus",
    "start": "282900",
    "end": "289620"
  },
  {
    "text": "didn't really work well all of the time we discovered failure modes where the",
    "start": "289620",
    "end": "296100"
  },
  {
    "text": "semi-synchronous mode setting would be lost whatever the user intended would not get set on the MySQL so over time we",
    "start": "296100",
    "end": "305040"
  },
  {
    "text": "discovered all of these problems with the orchestrator integration and how semi-sync was implemented in bitus and",
    "start": "305040",
    "end": "311100"
  },
  {
    "text": "we decided that this thing needed to be rebuilt from the ground up",
    "start": "311100",
    "end": "317960"
  },
  {
    "text": "so video arc is now GA we announced vitess 15 General availability yesterday",
    "start": "318300",
    "end": "323759"
  },
  {
    "text": "and VTR when GA yesterday but VTR is already in production there are at least",
    "start": "323759",
    "end": "329759"
  },
  {
    "text": "two uh deployments that we know of where meteorc is being used to do uh unplanned",
    "start": "329759",
    "end": "336120"
  },
  {
    "text": "failovers and to deal with primary failures so I'll just give you a minute to read",
    "start": "336120",
    "end": "342180"
  },
  {
    "text": "this quote from a user of wittus who's deploying VTR",
    "start": "342180",
    "end": "349139"
  },
  {
    "text": "with wit us in kubernetes using the wittest kubernetes operator",
    "start": "349139",
    "end": "355820"
  },
  {
    "text": "let's get a little deeper into what VTR is doing we talked about what",
    "start": "358740",
    "end": "364080"
  },
  {
    "text": "functionality it provides but how does it do that so VTR is the agent that is monitoring",
    "start": "364080",
    "end": "370680"
  },
  {
    "text": "the bitters cluster and detecting the failure so it has logic to check for certain conditions at periodic intervals",
    "start": "370680",
    "end": "377460"
  },
  {
    "text": "and flag failures and once it detects a failure it goes through a repair or",
    "start": "377460",
    "end": "383460"
  },
  {
    "text": "recovery mechanism uh the way VTR achieves durability is",
    "start": "383460",
    "end": "389639"
  },
  {
    "text": "through replication or in general the way wittus achieves data durability is through replication so one primary more",
    "start": "389639",
    "end": "397380"
  },
  {
    "text": "than one replica gives us guarantees that any transaction that's accepted by a primary",
    "start": "397380",
    "end": "404280"
  },
  {
    "text": "is replicated to at least one replica so that in case of a disk failure or a node",
    "start": "404280",
    "end": "409560"
  },
  {
    "text": "failure you don't lose the data that a client thinks has been persisted",
    "start": "409560",
    "end": "416160"
  },
  {
    "text": "and the way we achieve High availability is through failover so when a failure is detected",
    "start": "416160",
    "end": "422039"
  },
  {
    "text": "we call it an unplanned leader election but in the normal course of things you",
    "start": "422039",
    "end": "427080"
  },
  {
    "text": "have to upgrade software you have to upgrade Hardware whatever it is in the normal course of things you want to be",
    "start": "427080",
    "end": "433139"
  },
  {
    "text": "able to do planned failovers so that the system remains available through maintenance operations and that's",
    "start": "433139",
    "end": "441120"
  },
  {
    "text": "Witnesses General strategy for high availability and VTR is the agent that enables those things",
    "start": "441120",
    "end": "448880"
  },
  {
    "start": "449000",
    "end": "449000"
  },
  {
    "text": "uh the design principles on which VTR is built came from consensus systems so",
    "start": "450620",
    "end": "459680"
  },
  {
    "text": "consensus in a distributed system is a problem that uh people in Academia and",
    "start": "459680",
    "end": "466740"
  },
  {
    "text": "Industry have been working on for many years now I think 40 plus years and",
    "start": "466740",
    "end": "472380"
  },
  {
    "text": "there are well-known algorithms to solve the consensus problem what we did was that a group of us",
    "start": "472380",
    "end": "480000"
  },
  {
    "text": "studied some of these algorithms and then we came up with an engineering approach so this approach prioritizes uh",
    "start": "480000",
    "end": "490080"
  },
  {
    "text": "performance over theoretical correctness not to say that the system is not going",
    "start": "490280",
    "end": "496740"
  },
  {
    "text": "to be correct but just that we did not prioritize writing a formal specification and validating it we've",
    "start": "496740",
    "end": "504180"
  },
  {
    "text": "taken an engineering approach to solving the consensus problem and we are not",
    "start": "504180",
    "end": "509580"
  },
  {
    "text": "interested in Purity in the sense that we don't have to be the consensus",
    "start": "509580",
    "end": "514860"
  },
  {
    "text": "algorithm so witness has a topology server which can be hcd or zookeeper or",
    "start": "514860",
    "end": "521399"
  },
  {
    "text": "console where we store some State and it is used for Discovery so we actually",
    "start": "521399",
    "end": "527220"
  },
  {
    "text": "lean on the topology server to provide the persistent state that can help us in",
    "start": "527220",
    "end": "532800"
  },
  {
    "text": "recovery wittus is a single leader system and one",
    "start": "532800",
    "end": "538320"
  },
  {
    "text": "of the principles we are trying to maintain is that we need to be able to fulfill requests while respecting the",
    "start": "538320",
    "end": "544620"
  },
  {
    "text": "durability policy that has been chosen by the user and durability versus availability is a trade-off and that's a",
    "start": "544620",
    "end": "551940"
  },
  {
    "text": "configurable trade-off so that people can decide which is more important and",
    "start": "551940",
    "end": "557339"
  },
  {
    "text": "under which situations we have also separated the planned",
    "start": "557339",
    "end": "562500"
  },
  {
    "text": "leader election from the unplanned leader election so during the there is the normal operation of the system which",
    "start": "562500",
    "end": "568800"
  },
  {
    "text": "is very high QPS we will we expect witness systems to get millions of",
    "start": "568800",
    "end": "574019"
  },
  {
    "text": "queries per second for reads or rights versus leader elections are much rarer",
    "start": "574019",
    "end": "580620"
  },
  {
    "text": "so planned leader elections in a kubernetes environment maybe once a day or once a week or in a non-kubernetes",
    "start": "580620",
    "end": "588660"
  },
  {
    "text": "environment maybe even rarer and unplanned leader elections are expected to be relatively rare so we've separated",
    "start": "588660",
    "end": "596700"
  },
  {
    "text": "these things to say that the way you achieve consensus for normal operations",
    "start": "596700",
    "end": "602160"
  },
  {
    "text": "is very different from the way you do it for the leader election process",
    "start": "602160",
    "end": "608279"
  },
  {
    "text": "should be able to make forward progress and we need to be able to deal with race conditions given that PT Arc is an agent",
    "start": "608279",
    "end": "615839"
  },
  {
    "text": "it itself is susceptible to failures which means that you may be running multiple vtrs and they may be running in",
    "start": "615839",
    "end": "622980"
  },
  {
    "text": "multiple regions and we have to deal with failure modes for VT Arc itself",
    "start": "622980",
    "end": "630560"
  },
  {
    "text": "so uh whatever we came up with has been written up in a blog series by one of",
    "start": "631260",
    "end": "638700"
  },
  {
    "text": "the founders of witness Suga sugmaran and we have a link to it towards the end",
    "start": "638700",
    "end": "644339"
  },
  {
    "text": "so what we came up with in terms of leader election is that leader election has three distinct stages there's",
    "start": "644339",
    "end": "650339"
  },
  {
    "text": "revocation revoking the previous leader election choosing a new leader and",
    "start": "650339",
    "end": "655560"
  },
  {
    "text": "propagation which is any requests that were accepted by the previous leader and acknowledged to a client need to be",
    "start": "655560",
    "end": "662399"
  },
  {
    "text": "propagated by the new leader to all of the followers or replicas",
    "start": "662399",
    "end": "667560"
  },
  {
    "start": "667000",
    "end": "667000"
  },
  {
    "text": "so in a planned leader election revocation is actually much simpler than in an unplanned leader election and this",
    "start": "667560",
    "end": "674399"
  },
  {
    "text": "is one of the reasons we've separated those two in a planned leader election because the current leader is still",
    "start": "674399",
    "end": "681240"
  },
  {
    "text": "available you just ask them to step down before selecting a new leader so it's an orderly transition",
    "start": "681240",
    "end": "687660"
  },
  {
    "text": "a new leader is chosen it's possible that there are still some completed requests that have not been propagated",
    "start": "687660",
    "end": "693660"
  },
  {
    "text": "to all of the replicas the system will make sure that they get propagated to all of the replicas so that's what a",
    "start": "693660",
    "end": "699240"
  },
  {
    "text": "planned leader election looks like so as an example the leader changed and the",
    "start": "699240",
    "end": "705660"
  },
  {
    "text": "yellow arrows which represent replication have all moved over to the new leader",
    "start": "705660",
    "end": "712440"
  },
  {
    "text": "an unplanned leader election is a little bit different because in order to revoke the leader in an unplanned leader",
    "start": "712440",
    "end": "718260"
  },
  {
    "text": "election we have to be able to reach a sufficient number of followers so I'm calling that M and what m is we will",
    "start": "718260",
    "end": "725480"
  },
  {
    "text": "find out in a little bit but once revocation is complete things",
    "start": "725480",
    "end": "731480"
  },
  {
    "text": "look the same as for a planned leader election a new leader is chosen and how",
    "start": "731480",
    "end": "737700"
  },
  {
    "text": "the new leader is chosen also depends on the durability policy and completed requests have to be propagated so let's",
    "start": "737700",
    "end": "744480"
  },
  {
    "text": "say that leader became unavailable and a new leader is chosen all of the replicas now replicate from the new leader and",
    "start": "744480",
    "end": "750959"
  },
  {
    "text": "the previous leader is out of the topology",
    "start": "750959",
    "end": "758300"
  },
  {
    "start": "758000",
    "end": "758000"
  },
  {
    "text": "we've talked a fair amount I've said durability policy quite a few times so I",
    "start": "759480",
    "end": "765899"
  },
  {
    "text": "want to talk about what exactly a durability policy is in the wittest context",
    "start": "765899",
    "end": "771779"
  },
  {
    "text": "so the definition of durability that we are working with is that if a client",
    "start": "771779",
    "end": "777420"
  },
  {
    "text": "request has been acknowledged any changes that that client made to the data are persistent and are not lost so",
    "start": "777420",
    "end": "785040"
  },
  {
    "text": "we are talking about not losing data so data loss is what we want to avoid",
    "start": "785040",
    "end": "791420"
  },
  {
    "text": "MySQL has a synchronous replication mode and a semi-synchronous replication mode",
    "start": "791420",
    "end": "797519"
  },
  {
    "text": "and with the right parameters it's you can configure semi-synchronous replication in such a way that any right",
    "start": "797519",
    "end": "805260"
  },
  {
    "text": "to the primary will be blocked unless an acknowledgment is received from at least one replica and the acknowledgment from",
    "start": "805260",
    "end": "812459"
  },
  {
    "text": "the replica doesn't mean that that transaction has been completely applied to the replica it only means that the",
    "start": "812459",
    "end": "819240"
  },
  {
    "text": "replica has received it and persisted it in a way on on disk essentially",
    "start": "819240",
    "end": "826800"
  },
  {
    "text": "so um what the durability policy is defining",
    "start": "826800",
    "end": "834000"
  },
  {
    "text": "is basically how this is configured for with us semi-sync is the foundation but",
    "start": "834000",
    "end": "840300"
  },
  {
    "text": "with the durability policy you can configure which replicas are eligible to be",
    "start": "840300",
    "end": "846839"
  },
  {
    "text": "promoted as a primary for whatever reason some replicas may not be eligible how many semi-sync acknowledgments are",
    "start": "846839",
    "end": "854100"
  },
  {
    "text": "required for each primary most people use one but there may be situations where people want to use two",
    "start": "854100",
    "end": "859860"
  },
  {
    "text": "acknowledgments which replicas are eligible to send those acknowledgments and so on and what",
    "start": "859860",
    "end": "866519"
  },
  {
    "text": "durability policies give operators of witness is increased flexibility in their uh configurations in their",
    "start": "866519",
    "end": "873660"
  },
  {
    "text": "topology in how they lay out their replicas for worldwide replication or",
    "start": "873660",
    "end": "880040"
  },
  {
    "text": "across data centers regions availability zones those kinds of things",
    "start": "880040",
    "end": "886399"
  },
  {
    "text": "so now I'll hand it off to Manon",
    "start": "887220",
    "end": "891199"
  },
  {
    "text": "for that introduction and now that we've looked at what durability policies are",
    "start": "897199",
    "end": "902399"
  },
  {
    "text": "and how a test tries to ensure durability we can go ahead and look at the revocation phase in a little more",
    "start": "902399",
    "end": "907680"
  },
  {
    "text": "detail and look at exactly what m is that deeply alluded to in a few slides ago so how do we know that we have been able",
    "start": "907680",
    "end": "914579"
  },
  {
    "text": "to reach sufficient tablets to guarantee safety to answer that question we first have to look at a different concept",
    "start": "914579",
    "end": "920040"
  },
  {
    "text": "called intersecting quorums we just saw in semi-sync that in order to accept a transaction a primary requires some",
    "start": "920040",
    "end": "926579"
  },
  {
    "text": "amount of semising acts coming from the replicas so a primary along with the set of replicas that are sending the semi sync",
    "start": "926579",
    "end": "933000"
  },
  {
    "text": "acts together form a set of tablets that can accept transactions this set of tablets which is capable of accepting",
    "start": "933000",
    "end": "939240"
  },
  {
    "text": "rights is one Quorum for accepting rights there can be many such possible quorums in order to guarantee safety",
    "start": "939240",
    "end": "946139"
  },
  {
    "text": "during the revocation phase we should be able to reach at least one tablet from each of the possible quorums the intent",
    "start": "946139",
    "end": "953040"
  },
  {
    "text": "is that if there are unreachable tablets which can form a quorum they would accept rights which we don't want them",
    "start": "953040",
    "end": "958680"
  },
  {
    "text": "to do the reason is that an untreachable tablet and a tablet which is down are",
    "start": "958680",
    "end": "964199"
  },
  {
    "text": "virtually indistinguishable from the VTR perspective let's take an example to make this even",
    "start": "964199",
    "end": "969899"
  },
  {
    "text": "clearer let's say that we were in a scenario where we had six tablets in which you",
    "start": "969899",
    "end": "975420"
  },
  {
    "text": "only require three tablets to accept transactions if for example something was Network partitioned like so that you",
    "start": "975420",
    "end": "980820"
  },
  {
    "text": "had two VTR instances running but on two different sides of the network partition with three tablets on either side",
    "start": "980820",
    "end": "986459"
  },
  {
    "text": "in this situation if you do not check for the revocation phase at all each of those VTR instances can actually promote",
    "start": "986459",
    "end": "992279"
  },
  {
    "text": "one primary and that primary will be able to accept rights because you only require two more semi-sync Acts",
    "start": "992279",
    "end": "997800"
  },
  {
    "text": "so we would have one primary elected here one primary elective here and that would not be a correct situation because",
    "start": "997800",
    "end": "1003199"
  },
  {
    "text": "you could very well be in a split brain scenario two of these primaries accepting rights they can diverge because they could have accepted",
    "start": "1003199",
    "end": "1009139"
  },
  {
    "text": "different rights they aren't replicating to each other because they're Network partitioned so in this case it would not",
    "start": "1009139",
    "end": "1014360"
  },
  {
    "text": "be safe for any of the we talk instances to proceed because from this we talk instances perspective there are three",
    "start": "1014360",
    "end": "1019699"
  },
  {
    "text": "tablets which can form a quorum that it can't reach and the same for the other one there are three tablets that it can't reach which can also form a quorum",
    "start": "1019699",
    "end": "1027079"
  },
  {
    "text": "so in this case it's not safe for either of the two-bit organ instances to proceed if for example on the other hand",
    "start": "1027079",
    "end": "1032540"
  },
  {
    "text": "we were Network partitions such that five tablets lie on the same side and one tablet was on the other in this case",
    "start": "1032540",
    "end": "1038120"
  },
  {
    "text": "that we talk instance can make forward progress because it can reach five tablets and it is enough to guarantee",
    "start": "1038120",
    "end": "1043459"
  },
  {
    "text": "revocation because the one tablet which is there on the other side it can't actually accept rights because two",
    "start": "1043459",
    "end": "1048500"
  },
  {
    "text": "semising acts are required and we can reach enough tablets to guarantee that that tablet never gets that many acts",
    "start": "1048500",
    "end": "1054200"
  },
  {
    "text": "I hope this concept is a clear let's take a look at the demo",
    "start": "1054200",
    "end": "1061240"
  },
  {
    "start": "1060000",
    "end": "1060000"
  },
  {
    "text": "so the demo that we're going to look at it's actually going to be in two parts the first part is going to use a semi sync durability",
    "start": "1061820",
    "end": "1068299"
  },
  {
    "text": "for that we're going to use a semi-syncy space and the durability policy that we're going to use is semi-sync the way",
    "start": "1068299",
    "end": "1073640"
  },
  {
    "text": "that it works is that any replica can be the primary tablet the primary tablet only requires one",
    "start": "1073640",
    "end": "1079760"
  },
  {
    "text": "semi-sync act to accept transactions and any other replica can send those acts in our example we're going to have four",
    "start": "1079760",
    "end": "1085880"
  },
  {
    "text": "replicas so 100 101 102 103. so if you take a look at the VT admin",
    "start": "1085880",
    "end": "1092600"
  },
  {
    "text": "page for this here is a free space the semi-sync key space and it's running with the semi sync",
    "start": "1092600",
    "end": "1099320"
  },
  {
    "text": "durability policy and if you take a look here we have four replicas one of which has been promoted",
    "start": "1099320",
    "end": "1104780"
  },
  {
    "text": "as a primary",
    "start": "1104780",
    "end": "1107320"
  },
  {
    "text": "so if you take a look at the quorums that can accept transactions because any tablet can be the primary and any other",
    "start": "1111320",
    "end": "1116840"
  },
  {
    "text": "tablet can send a semi sync act essentially any two tablets together can accept the right because one of them can",
    "start": "1116840",
    "end": "1122480"
  },
  {
    "text": "be the primary and the other can send the act for example in this case 100 can be the primary and 101 can send the act",
    "start": "1122480",
    "end": "1128299"
  },
  {
    "text": "and that is enough to accept the right so overall this this is what the Quorum said for accepting rights would look",
    "start": "1128299",
    "end": "1133520"
  },
  {
    "text": "like any two tablets can accept a right so if you take a look for quorums that can that are therefore revocation",
    "start": "1133520",
    "end": "1140120"
  },
  {
    "text": "if you're able to only reach tablet 100 103 that is not enough to guarantee safety because you would have tablet 101",
    "start": "1140120",
    "end": "1146840"
  },
  {
    "text": "and 102 which can accept rights with 101 being the primary but if you're able to reach three",
    "start": "1146840",
    "end": "1153080"
  },
  {
    "text": "tablets 100 100 to 103 that is enough because there's only one tablet which is unreachable the 101 tablet and it can't",
    "start": "1153080",
    "end": "1160039"
  },
  {
    "text": "accept rights on its own if you're able to reach all the tablets that is enough two and one is not",
    "start": "1160039",
    "end": "1166820"
  },
  {
    "text": "so in our example we have four tablets one of which is the primary if you go ahead and shut that primary",
    "start": "1166820",
    "end": "1172820"
  },
  {
    "text": "down we expect that VTR will be able to make",
    "start": "1172820",
    "end": "1178580"
  },
  {
    "text": "forward progress promote someone else because it is safe to do so",
    "start": "1178580",
    "end": "1183400"
  },
  {
    "text": "there in that much time VTR promotes a different tablet which is Zone 102 as",
    "start": "1189020",
    "end": "1194480"
  },
  {
    "text": "the primary and the previous one get demotes itself to a replica which is no longer in a serving state but in this case if we go ahead and",
    "start": "1194480",
    "end": "1201260"
  },
  {
    "text": "delete one more primary failure let's say in this case our cluster had",
    "start": "1201260",
    "end": "1206660"
  },
  {
    "text": "another primary failure this time VTR won't be able to make any progress the reason is that there are two failures",
    "start": "1206660",
    "end": "1212480"
  },
  {
    "text": "now and these two tablets had they be Network partition they could have accepted rights so VTR can't reach them",
    "start": "1212480",
    "end": "1217760"
  },
  {
    "text": "it's not going to be able to make forward progress which is what the flexibility is what PTR provides because",
    "start": "1217760",
    "end": "1223160"
  },
  {
    "text": "you're able to configure the amount amount of semi-sync ax you require it is up to you to Define how much of a",
    "start": "1223160",
    "end": "1228260"
  },
  {
    "text": "durability you want if you send if you set the number of semising Acts requirement to something higher let's say five semi saying X and you have 10",
    "start": "1228260",
    "end": "1234320"
  },
  {
    "text": "tablets running you can handle three failures four failures so it's up to the operators to configure the policy such",
    "start": "1234320",
    "end": "1239539"
  },
  {
    "text": "that they Define the performance that they want and the durability trade-offs that they're willing to make",
    "start": "1239539",
    "end": "1245179"
  },
  {
    "text": "the next example that we're going to look at is a crosstalk durability policy this policy is similar to the semising",
    "start": "1245179",
    "end": "1251059"
  },
  {
    "start": "1246000",
    "end": "1246000"
  },
  {
    "text": "policy apart from one's one difference so the way that we Define a cell is a failure domain it could be a Amazon",
    "start": "1251059",
    "end": "1257299"
  },
  {
    "text": "region it could even be your confidence in different providers you could say that AWS is one zone and gcp is the",
    "start": "1257299",
    "end": "1262700"
  },
  {
    "text": "other Zone uh however you decide to do that so once we have a cell uh the Crosshair durability policy all is",
    "start": "1262700",
    "end": "1268520"
  },
  {
    "text": "different in the semising one is that the replica acts have to come from a tablet which is in a different cell so",
    "start": "1268520",
    "end": "1274880"
  },
  {
    "text": "essentially when a primary accepts a right the semi sync Act is coming from a different cell so you are guaranteed",
    "start": "1274880",
    "end": "1280220"
  },
  {
    "text": "that your right is persisted in two cells so in this example we're going to have three we're going to have four tablets",
    "start": "1280220",
    "end": "1285919"
  },
  {
    "text": "three of which are going to be in zone two and one is going to be in zone one and if you take a look at the yellow",
    "start": "1285919",
    "end": "1291860"
  },
  {
    "text": "lines those yellow lines signify who can send some icing acts to the other tablet the tablet in zone one can send some",
    "start": "1291860",
    "end": "1298280"
  },
  {
    "text": "icing acts to all the other three and can receive semi-sing acts from all the other three because it lives in a different Zone",
    "start": "1298280",
    "end": "1303799"
  },
  {
    "text": "but not the other because Zone one or two hundred and Zone 2201 both are in the same cell which is zone two so they",
    "start": "1303799",
    "end": "1310820"
  },
  {
    "text": "can't send some icing acts to each other which is what the white line signifies there",
    "start": "1310820",
    "end": "1315880"
  },
  {
    "text": "so if you take a look at the quorums for accepting transactions this time the quorums are much less than the previous example because if 300 is the primary it",
    "start": "1316520",
    "end": "1324020"
  },
  {
    "text": "can get rights from it can get access from any of the three tablets but if anyone else is the primary they",
    "start": "1324020",
    "end": "1329419"
  },
  {
    "text": "always require access from 300 because that's the only tablet available in a different cell",
    "start": "1329419",
    "end": "1335059"
  },
  {
    "text": "if you take a look for the quorums of verification reaching 200 and 201 is not enough because you have tablet 202 which can",
    "start": "1335059",
    "end": "1342380"
  },
  {
    "text": "accept rights with 300. 300 202 201 that is enough because",
    "start": "1342380",
    "end": "1347539"
  },
  {
    "text": "there's only one replica that's left 300 and 201 is also enough because if",
    "start": "1347539",
    "end": "1353120"
  },
  {
    "text": "you reach 300 you're able to guarantee that none of them are actually able to make forward progress because 300 is part of all of those Quorum sets",
    "start": "1353120",
    "end": "1361360"
  },
  {
    "text": "let's take a look at this key space now so we have the crosstalk key space and",
    "start": "1361820",
    "end": "1367520"
  },
  {
    "text": "it's going to use the durability policy called Cross Hill over here",
    "start": "1367520",
    "end": "1374320"
  },
  {
    "text": "initially one of the tablets in the second Zone has been promoted as a primary Zone to 202 if you take that tablet down",
    "start": "1376340",
    "end": "1385240"
  },
  {
    "text": "okay so VTR is able to promote someone else as the primary Zone one 300 gets",
    "start": "1399020",
    "end": "1404419"
  },
  {
    "text": "promoted as a primary in this case from the BT admin page we can also go",
    "start": "1404419",
    "end": "1410179"
  },
  {
    "text": "ahead and re-parent our cluster to a different primary tablet so example if we go over here",
    "start": "1410179",
    "end": "1418059"
  },
  {
    "text": "okay so now Zone 2 200 is the primary if we go ahead and take this primary down as",
    "start": "1431600",
    "end": "1438080"
  },
  {
    "text": "well this time too VTR will be able to fix this failure and the reasoning is again",
    "start": "1438080",
    "end": "1444620"
  },
  {
    "text": "in the durability policies because 300 and 201 are enough 200 and 202 even though there are two",
    "start": "1444620",
    "end": "1451400"
  },
  {
    "text": "tablets they can't send some icing acts to each other so they can't accept rights between themselves and this is where the difference between the",
    "start": "1451400",
    "end": "1456980"
  },
  {
    "text": "semi-sync policy and the CrossFit policy comes in because the failures are in the same cell cross-sell policy can make",
    "start": "1456980",
    "end": "1462260"
  },
  {
    "text": "further progress even though semi-sync could not so in the case of semising policy two failures was enough that we",
    "start": "1462260",
    "end": "1468020"
  },
  {
    "text": "talk was not able to make forward progress in this case it can it has promoted someone else as the primary Zone to 201 and the things are things",
    "start": "1468020",
    "end": "1475340"
  },
  {
    "text": "are resumed but any more failures than this even 201 tablet going down that would again",
    "start": "1475340",
    "end": "1480380"
  },
  {
    "text": "result in a scenario where VTR can't make progress because it won't be able to make forward progress there's only one tablet available and you need one",
    "start": "1480380",
    "end": "1486500"
  },
  {
    "text": "semising act to even get it to even accept any rights",
    "start": "1486500",
    "end": "1491320"
  },
  {
    "text": "and that concludes the demo for both of those key spaces I would like to talk a little bit more about the custom",
    "start": "1491600",
    "end": "1496940"
  },
  {
    "start": "1492000",
    "end": "1492000"
  },
  {
    "text": "durability policies so the way that the durability policy works is that you only need to answer three questions when you",
    "start": "1496940",
    "end": "1503120"
  },
  {
    "text": "implement your own custom durability policy this is encoded as an interface so first thing you need to answer is who",
    "start": "1503120",
    "end": "1508820"
  },
  {
    "text": "all can be the primary so you can say that of the tablets that you have only some tablets are allowed to be the",
    "start": "1508820",
    "end": "1514159"
  },
  {
    "text": "primaries others aren't they could be read-only tablets that you've only customed for uh maybe olap olap",
    "start": "1514159",
    "end": "1519799"
  },
  {
    "text": "transactions and you don't want them to become primaries at all the second question is how many",
    "start": "1519799",
    "end": "1525020"
  },
  {
    "text": "semi-sync acts does each primary require and this can be customized for each tablet that can be the primary you could",
    "start": "1525020",
    "end": "1530900"
  },
  {
    "text": "say that you have too much confidence in one of the primaries let's say primary tablet a it requires threesome icing",
    "start": "1530900",
    "end": "1536419"
  },
  {
    "text": "acts but you you want tablet B to only require one semi sync act that is also possible and the final question is the",
    "start": "1536419",
    "end": "1543020"
  },
  {
    "text": "number of surmising Acts that are defined who all tablets can send these acts based on who the primary is",
    "start": "1543020",
    "end": "1549020"
  },
  {
    "text": "with all of these three questions you can actually Implement your own custom durability policy based on the",
    "start": "1549020",
    "end": "1554179"
  },
  {
    "text": "constraints that you have and the trade-offs that you're willing to make apart from the primary failures BTR also",
    "start": "1554179",
    "end": "1560360"
  },
  {
    "start": "1557000",
    "end": "1557000"
  },
  {
    "text": "handles many other failure scenarios that MySQL instances generally run into so it maintains the cluster's desired",
    "start": "1560360",
    "end": "1566240"
  },
  {
    "text": "state if the primary goes into a read-only state or the replicas replication is stopped and so on the list of failures are listed here and",
    "start": "1566240",
    "end": "1572419"
  },
  {
    "text": "many more these are all the things that we talk is able to handle so if you have VTR running it's kind of an automated",
    "start": "1572419",
    "end": "1577700"
  },
  {
    "text": "scenario where you just you don't need to look at anything until something drastic happens something that you did not prepare for or you're not expecting",
    "start": "1577700",
    "end": "1584059"
  },
  {
    "text": "according to your durability policies to handle if that happens then manual intervention is required otherwise we",
    "start": "1584059",
    "end": "1589340"
  },
  {
    "text": "talk is an automated process that will take take care of your cluster and keep it healthy all the time thank you and we're going to move on to",
    "start": "1589340",
    "end": "1596000"
  },
  {
    "text": "the question and answer round uh before we do that there are some resources that we have uh tomorrow there is another bit",
    "start": "1596000",
    "end": "1601460"
  },
  {
    "start": "1597000",
    "end": "1597000"
  },
  {
    "text": "test talk which is going to talk about sharding and new features in vitess at 11 55 and the blog post series is linked",
    "start": "1601460",
    "end": "1609200"
  },
  {
    "text": "here and the video documentation please leave feedback you can use the QR code for",
    "start": "1609200",
    "end": "1614299"
  },
  {
    "text": "that we would love to hear from you as to how the talk was and how we could improve thank you any questions",
    "start": "1614299",
    "end": "1620900"
  },
  {
    "text": "we also have a booth in the solution showcase for with us please feel free to",
    "start": "1620900",
    "end": "1626059"
  },
  {
    "text": "stop by to talk to us",
    "start": "1626059",
    "end": "1629320"
  },
  {
    "text": "any questions from the audience",
    "start": "1633140",
    "end": "1636820"
  },
  {
    "text": "yes",
    "start": "1640700",
    "end": "1643419"
  },
  {
    "text": "and the second question is uh I noticed you were careful not to say m stands for majority of the",
    "start": "1655279",
    "end": "1662720"
  },
  {
    "text": "I I noticed that you said like M the parameter M doesn't stand for majority",
    "start": "1662720",
    "end": "1667940"
  },
  {
    "text": "you know for uh tablets right but for scenarios where you know m is let's say only two replicas",
    "start": "1667940",
    "end": "1674720"
  },
  {
    "text": "and we can have a potentially a split brain scenario like when it's less than majority how can one you know recover",
    "start": "1674720",
    "end": "1681799"
  },
  {
    "text": "from those scenarios or how how can we reconcile University scenarios where split brain can happen when m is less",
    "start": "1681799",
    "end": "1687919"
  },
  {
    "text": "than majority",
    "start": "1687919",
    "end": "1691158"
  },
  {
    "text": "we'll take the second question first and then I'll answer the first question so the second question was about uh",
    "start": "1694520",
    "end": "1701179"
  },
  {
    "text": "majority the number of required replicas M does not have to be a majority",
    "start": "1701179",
    "end": "1707779"
  },
  {
    "text": "yes so the way that m is written is that it can actually even be variable based on the failures that you have in the",
    "start": "1707779",
    "end": "1714080"
  },
  {
    "text": "cross sale policy if you actually have a failure of the Zone one zone 300 tablet the one which is in the other Zone the",
    "start": "1714080",
    "end": "1719480"
  },
  {
    "text": "only tablet there that is enough because you only have one tablet running in that zone in that case none of the other",
    "start": "1719480",
    "end": "1724520"
  },
  {
    "text": "tablets can make progress so if we go back to that slide in this case if this tablet goes down",
    "start": "1724520",
    "end": "1731299"
  },
  {
    "text": "there's actually enough to bring down the entire cluster because you have only one tablet in a different Zone but that also means that you can handle multiple",
    "start": "1731299",
    "end": "1737659"
  },
  {
    "text": "failures from this zone two tablets going down from here is what we saw in the example that's the m is even it's",
    "start": "1737659",
    "end": "1742700"
  },
  {
    "text": "not even a constant based on the durability policy it could be one it could be two it's all dependent on the kind of failures you have and the end of",
    "start": "1742700",
    "end": "1748700"
  },
  {
    "text": "the question that you had as part of the second question was what happens and how you reconcile if you end up in a split brain scenario the way that VTR works is",
    "start": "1748700",
    "end": "1756320"
  },
  {
    "text": "that it will not allow you to get into a split drain scenario it will stop rights at that point so for example",
    "start": "1756320",
    "end": "1761600"
  },
  {
    "text": "in the situation that I described over here that if you were Network partition like so and you had one of the primaries",
    "start": "1761600",
    "end": "1767600"
  },
  {
    "text": "running in this cluster bit went down in this case VTR won't promote anything else because it's not safe to proceed",
    "start": "1767600",
    "end": "1773539"
  },
  {
    "text": "it'll actually wait for manual intervention to come in in which case the operator can decide how he wants to proceed in this scenario he can actually",
    "start": "1773539",
    "end": "1779480"
  },
  {
    "text": "take down all of these three tablets and just promote one from here so it's up to the operator to decide how they want to",
    "start": "1779480",
    "end": "1784940"
  },
  {
    "text": "take take things forward so the way that PTR works it will not let the cluster go into a split brain scenario",
    "start": "1784940",
    "end": "1790700"
  },
  {
    "text": "I hope that answers the question so in a semi scenario where you only require",
    "start": "1790700",
    "end": "1795980"
  },
  {
    "text": "like acts from two other participants why can't we have a split range scenario",
    "start": "1795980",
    "end": "1803059"
  },
  {
    "text": "let me answer that question so uh the basic principle that is preventing that",
    "start": "1803059",
    "end": "1808640"
  },
  {
    "text": "from happening is Quorum intersection so what we are saying is that if you have",
    "start": "1808640",
    "end": "1815179"
  },
  {
    "text": "let's say five tablets all together and you require two acknowledgments for for",
    "start": "1815179",
    "end": "1822200"
  },
  {
    "text": "the primary to accept a right then when you uh try to revoke the leadership from",
    "start": "1822200",
    "end": "1828980"
  },
  {
    "text": "the current primary you need to form a quorum that includes at least one of",
    "start": "1828980",
    "end": "1834380"
  },
  {
    "text": "those replicas that is able to acknowledge so in that example of five tablets with two acts you need at least",
    "start": "1834380",
    "end": "1842360"
  },
  {
    "text": "three replicas other than the primary to agree that this current primary is going",
    "start": "1842360",
    "end": "1848720"
  },
  {
    "text": "to step down so the Quorum for normal operation is different from the Quorum",
    "start": "1848720",
    "end": "1855620"
  },
  {
    "text": "for leadership election and they have to intersect and that's the same Principle as has",
    "start": "1855620",
    "end": "1861799"
  },
  {
    "text": "been published in the literature Quorum intersection thank you and the first question which",
    "start": "1861799",
    "end": "1868100"
  },
  {
    "text": "was about yes yes so uh the question was about what happens if the kubernetes API server is",
    "start": "1868100",
    "end": "1875659"
  },
  {
    "text": "unavailable uh so VT Arc needs to be able to communicate",
    "start": "1875659",
    "end": "1883399"
  },
  {
    "text": "with the topology server that we where we store state that doesn't necessarily depend on the kubernetes API server so",
    "start": "1883399",
    "end": "1891020"
  },
  {
    "text": "as long as the networking in the kubernetes cluster is functional and the topology server is reachable we will",
    "start": "1891020",
    "end": "1897260"
  },
  {
    "text": "still be able to perform an election",
    "start": "1897260",
    "end": "1901899"
  },
  {
    "text": "[Music]",
    "start": "1907170",
    "end": "1910339"
  },
  {
    "text": "any other questions",
    "start": "1913580",
    "end": "1916658"
  },
  {
    "text": "all right if there are no other questions we will end here thank you all for coming out",
    "start": "1922279",
    "end": "1929200"
  }
]