[
  {
    "text": "hello everyone uh let's start uh thanks for joining my talk and on this last day",
    "start": "240",
    "end": "7080"
  },
  {
    "text": "of cucon uh my name is Magna Logan and I'll talk about kubernetes post",
    "start": "7080",
    "end": "12960"
  },
  {
    "text": "exploitation also thank you for the organizers uh for having me and for everyone to stay till the last day so",
    "start": "12960",
    "end": "20680"
  },
  {
    "text": "let's start okay okay so just a little bit about",
    "start": "20680",
    "end": "27760"
  },
  {
    "text": "myself uh my name is magnol Logan I'm originally from Brazil uh I've been in Canada for over 5 years now um I'm part",
    "start": "27760",
    "end": "35840"
  },
  {
    "text": "of the cloud and container security research team at Tren micro uh where we",
    "start": "35840",
    "end": "41559"
  },
  {
    "text": "focus on cloud kubernetes Docker and container research this is the QR code",
    "start": "41559",
    "end": "47680"
  },
  {
    "text": "for my LinkedIn the best way to reach out to me um I'm also uh instructor at",
    "start": "47680",
    "end": "53559"
  },
  {
    "text": "go hacking where we provide cyber security trainings um secure coding",
    "start": "53559",
    "end": "58760"
  },
  {
    "text": "devops p testing um and things like that I have a background as a developer",
    "start": "58760",
    "end": "66280"
  },
  {
    "text": "uh and I've been doing upack for the past 12 years so that's that",
    "start": "66280",
    "end": "73000"
  },
  {
    "text": "okay so this is the agenda that I have for this talk for today uh first I'm",
    "start": "73000",
    "end": "79080"
  },
  {
    "text": "going to give you an a little bit of introduction about the miter attack for containers and also the Microsoft threat",
    "start": "79080",
    "end": "85320"
  },
  {
    "text": "Matrix for kubernetes um then we're going to go and do an overview of a kubernetes attack",
    "start": "85320",
    "end": "92840"
  },
  {
    "text": "one that we uh posted we blogged about uh one year two years ago uh of",
    "start": "92840",
    "end": "100360"
  },
  {
    "text": "attackers compromising kubernetes through the cubet API then we're going to talk about the",
    "start": "100360",
    "end": "106640"
  },
  {
    "text": "side car pattern and and kind of a a technique to compromise kubernetes uh",
    "start": "106640",
    "end": "114600"
  },
  {
    "text": "clusters through the sidecar container injection which is not very uh well",
    "start": "114600",
    "end": "119640"
  },
  {
    "text": "known known uh I I think so and also at the end we're going to cover some",
    "start": "119640",
    "end": "126320"
  },
  {
    "text": "mitigations and some tools that you can leverage to detect these scenarios or even prevent them from happening uh in",
    "start": "126320",
    "end": "133520"
  },
  {
    "text": "in the future or in your own",
    "start": "133520",
    "end": "137879"
  },
  {
    "text": "environment okay okay uh before I start uh the kind of I always like to share",
    "start": "141000",
    "end": "148959"
  },
  {
    "text": "some of the projects or tools that I've uh or blogs that I've created this one for example I",
    "start": "148959",
    "end": "156319"
  },
  {
    "text": "started back in 2020 when I started doing some kubernetes research and I",
    "start": "156319",
    "end": "161760"
  },
  {
    "text": "kind of was saving all the links and reference materials in a text file and I",
    "start": "161760",
    "end": "168080"
  },
  {
    "text": "decided to then create this GitHub uh project like the awesome kubernetes security list you probably seen uh",
    "start": "168080",
    "end": "175280"
  },
  {
    "text": "similar projects already uh for different topics so this one has has um",
    "start": "175280",
    "end": "181239"
  },
  {
    "text": "a bunch of content uh links for blogs videos PDFs and all that stuff not just",
    "start": "181239",
    "end": "188080"
  },
  {
    "text": "for kubernetes security but also from the basics right there's no way for you to understand kubernetes security",
    "start": "188080",
    "end": "194440"
  },
  {
    "text": "without understanding how kubernetes works so it talks about the basic stuff as",
    "start": "194440",
    "end": "200920"
  },
  {
    "text": "well and this last one just the last thing here um this is the latest article",
    "start": "202239",
    "end": "208000"
  },
  {
    "text": "that i' we've published around kuber threat modeling as well we do a deep dive on the components and analyze um",
    "start": "208000",
    "end": "215200"
  },
  {
    "text": "how uh someone would kind of uh evaluate the components of a tra uh of a",
    "start": "215200",
    "end": "221480"
  },
  {
    "text": "kubernetes cluster and and be able to either like prevent those issues or and",
    "start": "221480",
    "end": "227159"
  },
  {
    "text": "attacks from happening okay so if you haven't heard",
    "start": "227159",
    "end": "234959"
  },
  {
    "text": "about the miner attack framework if you are in cyber security you probably uh have heard about it but it's like a it's",
    "start": "234959",
    "end": "242360"
  },
  {
    "text": "like a framework of techniques that attackers leverage in the wild so how TR",
    "start": "242360",
    "end": "248599"
  },
  {
    "text": "actors are compromising uh different environments and we have like a a series",
    "start": "248599",
    "end": "253920"
  },
  {
    "text": "of matrices for different environments such as uh Enterprise cloud and and now",
    "start": "253920",
    "end": "261919"
  },
  {
    "text": "we also have one for containers so I'm going to give you uh a little bit of uh",
    "start": "261919",
    "end": "268120"
  },
  {
    "text": "timeline overview of how how this this uh miter framework for containers was",
    "start": "268120",
    "end": "274560"
  },
  {
    "text": "created The Miner attack framework is also used as a foundation right for the",
    "start": "274560",
    "end": "279639"
  },
  {
    "text": "development of specific threat models and it's open and available for any organization and it's",
    "start": "279639",
    "end": "287400"
  },
  {
    "text": "free so back at the end of uh 2020 merer had had reached out to the community",
    "start": "287400",
    "end": "294000"
  },
  {
    "text": "they posted a Blog uh reaching out and asking for help saying that we want to",
    "start": "294000",
    "end": "299120"
  },
  {
    "text": "create this MIT attack for containers and uh we're looking for information for",
    "start": "299120",
    "end": "305400"
  },
  {
    "text": "contribution from the community from other organizations on how can we uh",
    "start": "305400",
    "end": "311160"
  },
  {
    "text": "what are the main tactics and techniques that attackers are leveraging in the wild right and at this time we already",
    "start": "311160",
    "end": "318919"
  },
  {
    "text": "had some uh data and information and blogs that we publish based on our honey",
    "start": "318919",
    "end": "324080"
  },
  {
    "text": "pots that we deployed so Docker and kubernetes honey Poots so we responded to them",
    "start": "324080",
    "end": "330319"
  },
  {
    "text": "um and then there was the first draft review in early 2021 uh discussing the",
    "start": "330319",
    "end": "336199"
  },
  {
    "text": "techniques and kind of which uh where would each technique fit into the Matrix",
    "start": "336199",
    "end": "342639"
  },
  {
    "text": "and at at the end right in April 2021 the first version of the miter attack",
    "start": "342639",
    "end": "348000"
  },
  {
    "text": "for containers was released and uh we contributed to 25% of the first uh the",
    "start": "348000",
    "end": "354080"
  },
  {
    "text": "techniques from the first edition and we had evidence of the attacks in contain",
    "start": "354080",
    "end": "359800"
  },
  {
    "text": "environments as early as uh 2018 so this is the the latest Matrix",
    "start": "359800",
    "end": "366599"
  },
  {
    "text": "now the latest version of the Meer attack for containers and I add the parenthesis there for and kubernetes as",
    "start": "366599",
    "end": "372800"
  },
  {
    "text": "well because it does involve some sort of orchestration uh tools as well so um",
    "start": "372800",
    "end": "380080"
  },
  {
    "text": "some of the techniques here are are related to orchestration environments such as",
    "start": "380080",
    "end": "385800"
  },
  {
    "text": "kubernetes this Matrix was based on on the Microsoft threat Matrix that was",
    "start": "385800",
    "end": "392000"
  },
  {
    "text": "published earlier and um what they do is they focus here on the main uh attacks",
    "start": "392000",
    "end": "400199"
  },
  {
    "text": "techniques that are used in the wild that they're seeing trat actors compromising uh environments and",
    "start": "400199",
    "end": "406000"
  },
  {
    "text": "leveraging those techniques in the wild but if we look at the Microsoft",
    "start": "406000",
    "end": "412440"
  },
  {
    "text": "threat Matrix there is one technique there that it's not present in the uh in",
    "start": "412440",
    "end": "419440"
  },
  {
    "text": "the miter attack framework which is side car injection right at the bottom there for execution and uh we'll cover that",
    "start": "419440",
    "end": "427919"
  },
  {
    "text": "technique very soon but first let's analyze how a TR actor group was",
    "start": "427919",
    "end": "433199"
  },
  {
    "text": "compromising kubernetes clusters in the wild this is team TNT uh it's a TR actor",
    "start": "433199",
    "end": "441919"
  },
  {
    "text": "group uh based out of uh Europe probably out of Germany from what we uh were able",
    "start": "441919",
    "end": "447879"
  },
  {
    "text": "to identify and they were leveraging different techniques and abusing the",
    "start": "447879",
    "end": "453240"
  },
  {
    "text": "cuet API to execute commands inside the containers and at the end Ming",
    "start": "453240",
    "end": "459440"
  },
  {
    "text": "cryptocurrencies right what we've seen from our um honeypots that most of the",
    "start": "459440",
    "end": "466560"
  },
  {
    "text": "attacks in containerized environments and kubernetes environments at the end goal is usually resource rack hijacking",
    "start": "466560",
    "end": "474319"
  },
  {
    "text": "right which means basically m cryptocurrencies um and this attack was",
    "start": "474319",
    "end": "480800"
  },
  {
    "text": "carried out after they got internal access to the victim's Network and um it",
    "start": "480800",
    "end": "486599"
  },
  {
    "text": "can be either on premises or in the cloud so first they get access to the network and then they start looking for",
    "start": "486599",
    "end": "493440"
  },
  {
    "text": "uh vulnerable uh nodes that have the cubet API exposed so now we we're going to see",
    "start": "493440",
    "end": "500560"
  },
  {
    "text": "uh part of the scripts that we were able to collect from their command and control server and that we analyzed and",
    "start": "500560",
    "end": "507479"
  },
  {
    "text": "and kind of to understand what they were doing so this is the the script here",
    "start": "507479",
    "end": "515279"
  },
  {
    "text": "it's a it's a very it's what it's a piece of the script here the cube pound function that they created I have more",
    "start": "515279",
    "end": "521599"
  },
  {
    "text": "slides uh breaking it down uh at each step so we're going to do that here and",
    "start": "521599",
    "end": "527760"
  },
  {
    "text": "but basically what they're in in general what they're looking is they're looking for they're scanning the network for um",
    "start": "527760",
    "end": "536480"
  },
  {
    "text": "using a a open source tool called Mass scan and they are looking for any uh",
    "start": "536480",
    "end": "544040"
  },
  {
    "text": "anything that it's open on Port 10 2050 right uh 20 20 20 10 25 250 sorry and um",
    "start": "544040",
    "end": "555320"
  },
  {
    "text": "which is the cuet API by default right so they were looking for that and",
    "start": "555320",
    "end": "560440"
  },
  {
    "text": "weirdly enough is that the end points that they're trying to Target here uh",
    "start": "560440",
    "end": "566240"
  },
  {
    "text": "We've we're going to see uh running pods end points and run endpoint the CU API",
    "start": "566240",
    "end": "571519"
  },
  {
    "text": "is not very well documented so to know these endpoints they would probably have",
    "start": "571519",
    "end": "576920"
  },
  {
    "text": "to go into the kubernetes code to find out more about what it does because it's",
    "start": "576920",
    "end": "582279"
  },
  {
    "text": "it's not very well documented so let's analyze let's break",
    "start": "582279",
    "end": "587680"
  },
  {
    "text": "it down um first here on the first uh steps",
    "start": "587680",
    "end": "594800"
  },
  {
    "text": "you see that there is a MTH scan uh that the command that you're using using",
    "start": "594800",
    "end": "599880"
  },
  {
    "text": "which is this kind of scanning IP scanning tool Network scanning tool that",
    "start": "599880",
    "end": "605680"
  },
  {
    "text": "it's available on GitHub and it's uh they're specifically targeting only open",
    "start": "605680",
    "end": "611720"
  },
  {
    "text": "ports on 10250 and you can see the ranges there",
    "start": "611720",
    "end": "618600"
  },
  {
    "text": "the the Lan ranges there these these are private uh Network ranges so it means",
    "start": "618600",
    "end": "623640"
  },
  {
    "text": "that they already have access to your network and now they're trying to uh do like a l movement or escalate privileges",
    "start": "623640",
    "end": "631880"
  },
  {
    "text": "inside your your cluster after that if they found",
    "start": "631880",
    "end": "639079"
  },
  {
    "text": "something there is also they send like how how we were able to count the number",
    "start": "639079",
    "end": "645680"
  },
  {
    "text": "of um IP addresses compromised right so each node uh that was compromised it",
    "start": "645680",
    "end": "653600"
  },
  {
    "text": "sent the IP address of the node to their command and control server the there's a",
    "start": "653600",
    "end": "659360"
  },
  {
    "text": "function there there's a curl uh a function that sends the IP address of that node to the command and control",
    "start": "659360",
    "end": "666240"
  },
  {
    "text": "server also all these uh curve requests here at the end it's they they're",
    "start": "666240",
    "end": "673200"
  },
  {
    "text": "finding they're looping through each container that it's running on the Node",
    "start": "673200",
    "end": "678480"
  },
  {
    "text": "so it's not just the Pod but every container running on the Node and they're executing these commands which",
    "start": "678480",
    "end": "684399"
  },
  {
    "text": "is basically updating packages installing some tools like bash curl W",
    "start": "684399",
    "end": "689440"
  },
  {
    "text": "get and then at the end uh running their crypto Miner so there's two binaries that they install they deploy there to",
    "start": "689440",
    "end": "696399"
  },
  {
    "text": "run their Crypt",
    "start": "696399",
    "end": "699240"
  },
  {
    "text": "miners um here is just a previous uh script from from the same file that we",
    "start": "701440",
    "end": "707079"
  },
  {
    "text": "collected where they're installing theas SC to prior to using the coupon",
    "start": "707079",
    "end": "714000"
  },
  {
    "text": "function and the next tool that they leverage here as well is the a tool",
    "start": "714079",
    "end": "719440"
  },
  {
    "text": "called zg grab which is a banner grabbing tool to find out which services are running in that port and uh",
    "start": "719440",
    "end": "727320"
  },
  {
    "text": "interestingly enough this tool is deprecated so it's out an outdated",
    "start": "727320",
    "end": "732480"
  },
  {
    "text": "version uh there is a new version called zg grab 2 but the attackers were using the outdated version so it's not just us",
    "start": "732480",
    "end": "740000"
  },
  {
    "text": "that use outdated versions The attackers sometimes they do too okay but this attack is very noisy",
    "start": "740000",
    "end": "749279"
  },
  {
    "text": "right it's it's going through each node of your cluster and updating packages",
    "start": "749279",
    "end": "754920"
  },
  {
    "text": "and installing the crypto miners so of course they're looking for free money",
    "start": "754920",
    "end": "760680"
  },
  {
    "text": "through through uh this exploitation of of cryptocurrency but they soon will be",
    "start": "760680",
    "end": "767440"
  },
  {
    "text": "detected you're going to notice that something's going on with your cluster because all the pods all the containers",
    "start": "767440",
    "end": "773000"
  },
  {
    "text": "are are running uh this process and running crypto miners so one of my kind of uh thoughts",
    "start": "773000",
    "end": "781480"
  },
  {
    "text": "or ideas that I had earlier this year was okay how if I'm an attacker myself",
    "start": "781480",
    "end": "788360"
  },
  {
    "text": "how can I try to stay hidden inside the cluster and still you know compromise",
    "start": "788360",
    "end": "795240"
  },
  {
    "text": "and and leave uh maybe a back door or install a malicious uh payload inside",
    "start": "795240",
    "end": "800720"
  },
  {
    "text": "the cluster and still avoid some detection",
    "start": "800720",
    "end": "806920"
  },
  {
    "text": "so before before before I talk about that I need to kind of cover the kind of",
    "start": "806920",
    "end": "812040"
  },
  {
    "text": "the side car pattern the side car pattern is is basically a design pattern in kubernetes",
    "start": "812040",
    "end": "819440"
  },
  {
    "text": "where you add a new container to the same uh pod to add like new features for",
    "start": "819440",
    "end": "826920"
  },
  {
    "text": "uh for your application like for example for collecting logs for service smash",
    "start": "826920",
    "end": "832519"
  },
  {
    "text": "things like that it's it's hand it's handy right when you don't want one container uh uh running multiple",
    "start": "832519",
    "end": "839800"
  },
  {
    "text": "processes multiple applications and you going to deploy a side car here here is just an example of a login",
    "start": "839800",
    "end": "847160"
  },
  {
    "text": "agent uh for sidecar as well the you have the app container and the login",
    "start": "847160",
    "end": "852560"
  },
  {
    "text": "agent is the one collecting the logs and sending to a back end for example like a Sim",
    "start": "852560",
    "end": "859440"
  },
  {
    "text": "solution and and yeah just to sum up here you can see that the inside the Pod",
    "start": "860079",
    "end": "866680"
  },
  {
    "text": "I can have one container or many containers running right so I have here",
    "start": "866680",
    "end": "871959"
  },
  {
    "text": "as an example uh I can have more and it's more it can even have more than one",
    "start": "871959",
    "end": "877320"
  },
  {
    "text": "side car container running so just in a",
    "start": "877320",
    "end": "882839"
  },
  {
    "text": "nutshell this side car pattern right it's going to operate these uh",
    "start": "882839",
    "end": "888639"
  },
  {
    "text": "supplement containers next to the primary one within the same pod uh they",
    "start": "888639",
    "end": "894320"
  },
  {
    "text": "can transfer data right from external source to a local storage for example or",
    "start": "894320",
    "end": "899399"
  },
  {
    "text": "and and they maintain uh common life cycle uh resources and network environment I know that in",
    "start": "899399",
    "end": "906040"
  },
  {
    "text": "the uh version 128 for kubernetes there is some changes now going on with with",
    "start": "906040",
    "end": "911959"
  },
  {
    "text": "sidecar containers there so they're kind of uh butin and and and things like that but",
    "start": "911959",
    "end": "918199"
  },
  {
    "text": "yeah so what are the pros or what are the benefits of using a side car right",
    "start": "918199",
    "end": "923800"
  },
  {
    "text": "so first you have isolation right you you separate your application from other",
    "start": "923800",
    "end": "929279"
  },
  {
    "text": "uh side tasks that you you have that you can use for for logging for service",
    "start": "929279",
    "end": "934600"
  },
  {
    "text": "Smash and things like that it's easy like you can quickly deploy uh a side",
    "start": "934600",
    "end": "940480"
  },
  {
    "text": "car because you just need to add a new container next to your uh main application container and it's it's",
    "start": "940480",
    "end": "947079"
  },
  {
    "text": "scalable right so you can use as I said you can have more than one side cars inside the same pod or and you can do",
    "start": "947079",
    "end": "953920"
  },
  {
    "text": "that for uh your whole cluster but there are some cons as well",
    "start": "953920",
    "end": "959600"
  },
  {
    "text": "there are some uh disadvantages first if you have like U",
    "start": "959600",
    "end": "965720"
  },
  {
    "text": "uh a lot of side cars that's going to add uh increase the resource utilization",
    "start": "965720",
    "end": "971360"
  },
  {
    "text": "of your cluster it can also add uh a lot of operational complexity because you can",
    "start": "971360",
    "end": "978319"
  },
  {
    "text": "double or triple the amount of containers that you now need to Monitor and maintain and make sure that they are",
    "start": "978319",
    "end": "984800"
  },
  {
    "text": "uh protected as well and synchron a challenges you know",
    "start": "984800",
    "end": "990240"
  },
  {
    "text": "uh between the main application container and the side car so this this is a a a pattern that",
    "start": "990240",
    "end": "998639"
  },
  {
    "text": "you can use but you need to understand the problems before you use",
    "start": "998639",
    "end": "1003959"
  },
  {
    "text": "them okay so sidecar injection as I said this is a",
    "start": "1005199",
    "end": "1013279"
  },
  {
    "text": "technique that was covered on the M Microsoft threat Matrix um and I thought okay this is a",
    "start": "1013279",
    "end": "1020399"
  },
  {
    "text": "possibility here what happens if like one of the ways that usually when you",
    "start": "1020399",
    "end": "1025480"
  },
  {
    "text": "compromise a kubernetes cluster is you want to deploy a a a privilege pod or",
    "start": "1025480",
    "end": "1031079"
  },
  {
    "text": "take over a privilege pod but what happens right and that can generate uh",
    "start": "1031079",
    "end": "1036120"
  },
  {
    "text": "alerts that can generate some uh notifications there but what happens if I compromise the side car only and I",
    "start": "1036120",
    "end": "1043120"
  },
  {
    "text": "don't compromise the main application can I try can I uh avoid or at least",
    "start": "1043120",
    "end": "1049160"
  },
  {
    "text": "uh uh delay the detection of my attack from from you know the the cluster",
    "start": "1049160",
    "end": "1055880"
  },
  {
    "text": "admins so the sidecar injection basically I can either inject a new",
    "start": "1055880",
    "end": "1061679"
  },
  {
    "text": "container inside the same uh pod or I can leverage the ones that are already",
    "start": "1061679",
    "end": "1068520"
  },
  {
    "text": "running to execute commands for myself just like what the team TNT did for for",
    "start": "1068520",
    "end": "1074880"
  },
  {
    "text": "uh the previous attack where they they attack they executed commands on all the",
    "start": "1074880",
    "end": "1080120"
  },
  {
    "text": "containers inside the node I can use specifically one the one that I know this is a side car and and might be uh",
    "start": "1080120",
    "end": "1089159"
  },
  {
    "text": "like harder to detect my attack here and and yeah attackers can use this",
    "start": "1089159",
    "end": "1095240"
  },
  {
    "text": "to hide their activity and the problem with side cars is that they are",
    "start": "1095240",
    "end": "1100320"
  },
  {
    "text": "considered kind of second class citizens in the cluster because they usually come from third party tools they're pre-made",
    "start": "1100320",
    "end": "1107679"
  },
  {
    "text": "it's not something that you developed in house in your organization for example if you're using like fluent bit for your",
    "start": "1107679",
    "end": "1114240"
  },
  {
    "text": "logging purposes for shipping your logs so um and sometimes also you might",
    "start": "1114240",
    "end": "1119799"
  },
  {
    "text": "download them from public Registries such as dockerhub",
    "start": "1119799",
    "end": "1125000"
  },
  {
    "text": "um so yeah this is just kind of the the description there from the Microsoft threat Matrix and some of the",
    "start": "1126679",
    "end": "1132919"
  },
  {
    "text": "mitigations that we're going to cover in a second so just to demonstrate this this",
    "start": "1132919",
    "end": "1138600"
  },
  {
    "text": "issue here um I'm using uh in in this example I'm using a cluster that that I",
    "start": "1138600",
    "end": "1145039"
  },
  {
    "text": "created on AKs so it has a bunch of uh pods running",
    "start": "1145039",
    "end": "1150679"
  },
  {
    "text": "and you can see there uh some of these these pods have uh have more than one",
    "start": "1150679",
    "end": "1155960"
  },
  {
    "text": "container running have some side cars I'm going to perform I'm going to",
    "start": "1155960",
    "end": "1162480"
  },
  {
    "text": "show two scripts that uh of course it really depends on the permissions that",
    "start": "1162480",
    "end": "1168400"
  },
  {
    "text": "have on the cluster but since we're assuming here this is a post exploitation scenario so I'm I'm",
    "start": "1168400",
    "end": "1174240"
  },
  {
    "text": "assuming that the conditions are met to perform this attack so on the first one uh I'm using",
    "start": "1174240",
    "end": "1181600"
  },
  {
    "text": "Cube CTL let's say I compromised the Pod inside the inside the cluster and uh I",
    "start": "1181600",
    "end": "1187360"
  },
  {
    "text": "have the permissions to install Cube CT inside the Pod itself so now just an",
    "start": "1187360",
    "end": "1192720"
  },
  {
    "text": "example here uh I'm using Cube CTL to go through the containers all the the all",
    "start": "1192720",
    "end": "1199640"
  },
  {
    "text": "the pods sorry that have more than one container running and then I'm executing",
    "start": "1199640",
    "end": "1205280"
  },
  {
    "text": "this command in this case is just an echo command uh to okay executing Crypt",
    "start": "1205280",
    "end": "1210520"
  },
  {
    "text": "Miner in the last container so the last one that I have so if I have like three",
    "start": "1210520",
    "end": "1216400"
  },
  {
    "text": "I'm only executing the the command on the third one um and and this script assume",
    "start": "1216400",
    "end": "1224440"
  },
  {
    "text": "assumes two things right Cube C was installed and configured correctly so I was able to do that and the container",
    "start": "1224440",
    "end": "1231200"
  },
  {
    "text": "has to have the sh binary otherwise the command won't work and we'll see here uh",
    "start": "1231200",
    "end": "1236799"
  },
  {
    "text": "by the output some of the pods some of the pods didn't have uh some of the",
    "start": "1236799",
    "end": "1242679"
  },
  {
    "text": "containers inside the pods didn't have the sh binary so yeah uh every time I run that",
    "start": "1242679",
    "end": "1250799"
  },
  {
    "text": "script it's going to go through all the pods that have more than one and execute the echo Commander as we can see",
    "start": "1250799",
    "end": "1259679"
  },
  {
    "text": "okay but what happens if I don't have this Cube CTL installed and I don't have",
    "start": "1259679",
    "end": "1264880"
  },
  {
    "text": "this can I still leverage this kind of approach this technique to compromise",
    "start": "1264880",
    "end": "1270080"
  },
  {
    "text": "one of the side cars uh and uh in stay try to stay hidden yes you",
    "start": "1270080",
    "end": "1276919"
  },
  {
    "text": "can if the attacker is unable to install Cube CTL right to perform the side car",
    "start": "1276919",
    "end": "1282520"
  },
  {
    "text": "injection they can still Leverage The API server uh Cur commands and other",
    "start": "1282520",
    "end": "1287679"
  },
  {
    "text": "commands as long as they have access to the necessary files so things like you need to know the API server URL the",
    "start": "1287679",
    "end": "1295080"
  },
  {
    "text": "better token and the CI certificate the ca certificate file path but if you have compromised the Pod you should have that",
    "start": "1295080",
    "end": "1301559"
  },
  {
    "text": "information already so that shouldn't be a problem so I think this is a a lwh",
    "start": "1301559",
    "end": "1309000"
  },
  {
    "text": "hanging fruit for uh attackers to try to stay uh hidden it and it's important to",
    "start": "1309000",
    "end": "1314880"
  },
  {
    "text": "consider that uh that scenario especially when you're track modeling your kubernetes cluster because you need",
    "start": "1314880",
    "end": "1321200"
  },
  {
    "text": "to have visibility not just on your main application but on your sidecar containers as well to make sure that",
    "start": "1321200",
    "end": "1327400"
  },
  {
    "text": "they're not uh compromised",
    "start": "1327400",
    "end": "1332640"
  },
  {
    "text": "so what are some of the kind of mitigations that you can uh Implement",
    "start": "1332640",
    "end": "1338159"
  },
  {
    "text": "here for uh preventing uh sidecar injection in your",
    "start": "1338159",
    "end": "1344720"
  },
  {
    "text": "cluster the first one is applying the list privilege principle I know it's easier said than done everybody that",
    "start": "1344919",
    "end": "1352240"
  },
  {
    "text": "probably works in cyber security they say oh yeah apply list privilege principle right only giving the",
    "start": "1352240",
    "end": "1357880"
  },
  {
    "text": "necessary permissions uh for that application or for the user for the time",
    "start": "1357880",
    "end": "1363159"
  },
  {
    "text": "that they require those and we know that in kubernetes our back can be very",
    "start": "1363159",
    "end": "1368360"
  },
  {
    "text": "tricky right Road based Access Control it's very hard to get it right so uh I I know that this is a recommendation but",
    "start": "1368360",
    "end": "1375640"
  },
  {
    "text": "it's hard to get it right other things that you can do uh is restrict over",
    "start": "1375640",
    "end": "1381919"
  },
  {
    "text": "permissive containers like running as privilege or rout for example you shouldn't do that shouldn't have that",
    "start": "1381919",
    "end": "1387080"
  },
  {
    "text": "those containers run especially in production clusters and the third thing is gating",
    "start": "1387080",
    "end": "1392960"
  },
  {
    "text": "images to the kubernetes cluster right this is usually done via admission controllers admission controllers are",
    "start": "1392960",
    "end": "1399360"
  },
  {
    "text": "like the bouncers of a nightclub right they they check who can go inside uh the",
    "start": "1399360",
    "end": "1404919"
  },
  {
    "text": "cluster and start running your containers so you can specify if um if the containers are",
    "start": "1404919",
    "end": "1412240"
  },
  {
    "text": "coming from a public registry or if those containers have a known vulnerability or they haven't been",
    "start": "1412240",
    "end": "1418600"
  },
  {
    "text": "scanned for vulnerability you can prevent uh through the admission controller as",
    "start": "1418600",
    "end": "1425320"
  },
  {
    "text": "well and um other things that you can leverage here I I always like to talk",
    "start": "1425360",
    "end": "1430559"
  },
  {
    "text": "about this kind of kubernetes security Triad uh from my perspective of some of",
    "start": "1430559",
    "end": "1436039"
  },
  {
    "text": "the main tools that you should have uh in your cluster you should have image scanning right to scan your images for",
    "start": "1436039",
    "end": "1442440"
  },
  {
    "text": "vulnerabilities before you deploy them the admission controller as I said the gatekeeper uh uh the bouncer there to",
    "start": "1442440",
    "end": "1449919"
  },
  {
    "text": "prevent uh unknown uh containers for running your cluster and runtime protection as",
    "start": "1449919",
    "end": "1456200"
  },
  {
    "text": "well but the uh the admission controller for",
    "start": "1456200",
    "end": "1461760"
  },
  {
    "text": "example in this case it will only prevent new containers from running the",
    "start": "1461760",
    "end": "1467440"
  },
  {
    "text": "cluster right if you're affecting the sidecar containers that are already running the admission controller will",
    "start": "1467440",
    "end": "1473679"
  },
  {
    "text": "probably won't won't be able to help you here so that's why that's why you need",
    "start": "1473679",
    "end": "1480320"
  },
  {
    "text": "uh some uh some sort of tool that monitors the runtime of your containers",
    "start": "1480320",
    "end": "1486200"
  },
  {
    "text": "and these are called runtime security or runtime protection tools and the cncf",
    "start": "1486200",
    "end": "1491720"
  },
  {
    "text": "has a great tool here uh that it's called Uh Falco it's a tool that does",
    "start": "1491720",
    "end": "1497520"
  },
  {
    "text": "the runtime security detection for kubernetes and it's a root based engine right you can create your rules for",
    "start": "1497520",
    "end": "1504520"
  },
  {
    "text": "Falco to detect different attacks it also has a bunch of preset uh rules that",
    "start": "1504520",
    "end": "1510440"
  },
  {
    "text": "you can leverage as well so you don't need to be able to create your own rules if you don't want to and by specifying",
    "start": "1510440",
    "end": "1517919"
  },
  {
    "text": "this simple rule here uh this next one and just to detect sh binaries right",
    "start": "1517919",
    "end": "1526120"
  },
  {
    "text": "so the way that I was using there the uh side car injection commands I was",
    "start": "1526120",
    "end": "1531480"
  },
  {
    "text": "using the Shell so just by detecting this but just having this simple rule you would be able to detect this attack",
    "start": "1531480",
    "end": "1538399"
  },
  {
    "text": "as well but you need to be monitoring of course uh uh Falco looks at all the containers in the cluster so it would be",
    "start": "1538399",
    "end": "1545039"
  },
  {
    "text": "able to detect this uh the previous scenarios even if the attacker only",
    "start": "1545039",
    "end": "1550120"
  },
  {
    "text": "injects the process inside the side car without creating a new",
    "start": "1550120",
    "end": "1555760"
  },
  {
    "text": "one um if you want to learn more about Falco I'm not going to cover that in in",
    "start": "1555760",
    "end": "1560880"
  },
  {
    "text": "in depth here and uh but there are some trainings and some a lot of documentation available for Falco online",
    "start": "1560880",
    "end": "1567320"
  },
  {
    "text": "and the C the uh the Linux Foundation even have uh a training available for",
    "start": "1567320",
    "end": "1573320"
  },
  {
    "text": "for Falco as well so um yeah this is all I had to",
    "start": "1573320",
    "end": "1579520"
  },
  {
    "text": "share today about side car injection uh I hope you enjoyed the session and uh",
    "start": "1579520",
    "end": "1585279"
  },
  {
    "text": "there's going to be a blog post with more detail uh we're still working some of the uh",
    "start": "1585279",
    "end": "1591159"
  },
  {
    "text": "some of the things for the blog so in the next coming weeks I'll publish a Blog and yeah stay tuned and and thank",
    "start": "1591159",
    "end": "1597520"
  },
  {
    "text": "you very much for listening if if you have questions",
    "start": "1597520",
    "end": "1605039"
  },
  {
    "text": "please uh speak on the mic there thank",
    "start": "1605039",
    "end": "1609759"
  },
  {
    "text": "you",
    "start": "1616600",
    "end": "1619600"
  },
  {
    "text": "hi are uh sidecar injections some of the most popular ones that you're seeing today or is it superseded by something",
    "start": "1626039",
    "end": "1633159"
  },
  {
    "text": "else so I I haven't seen that splited in the wild so that's an idea that I from",
    "start": "1633159",
    "end": "1639919"
  },
  {
    "text": "The trat Matrix that I came up uh but from our honey pots we haven't seen that",
    "start": "1639919",
    "end": "1645080"
  },
  {
    "text": "using it yet in the wild most of the time 90 to 95% of the attacks in the end",
    "start": "1645080",
    "end": "1651600"
  },
  {
    "text": "is crypto mining right it's it's cryptocurrency mining yeah is that through some other method",
    "start": "1651600",
    "end": "1658559"
  },
  {
    "text": "other than sidecar injection or is it mostly sidecar injection so the cryptocurrency mining yeah it's can be",
    "start": "1658559",
    "end": "1664679"
  },
  {
    "text": "through the cuet API or to some sort of privilege pod it really depends on how the cluster is configured the way that",
    "start": "1664679",
    "end": "1671919"
  },
  {
    "text": "we deploy our our honey pods for example we have clusters that that have all sorts of Mis configuration",
    "start": "1671919",
    "end": "1678039"
  },
  {
    "text": "so it's really depend on how the the cluster is set",
    "start": "1678039",
    "end": "1682320"
  },
  {
    "text": "up um so you spoke about side car injection and admission controller as a",
    "start": "1683159",
    "end": "1691000"
  },
  {
    "text": "way to mitigate this have you seen attacks when the admission controller was compromised and essentially injects",
    "start": "1691000",
    "end": "1697679"
  },
  {
    "text": "the side cars not knowing to you no I haven't no",
    "start": "1697679",
    "end": "1702720"
  },
  {
    "text": "I haven't seen that attacks yet from the admission controller no yeah like ju",
    "start": "1702720",
    "end": "1707840"
  },
  {
    "text": "just in general idea if you have access to the Poes on the level you described in your presentation you're likely to be",
    "start": "1707840",
    "end": "1713679"
  },
  {
    "text": "able to compromise admission control as well and just register your own web hook and redirect the traffic sure sure yeah",
    "start": "1713679",
    "end": "1721399"
  },
  {
    "text": "Mak sense thank you anyone",
    "start": "1721399",
    "end": "1729518"
  },
  {
    "text": "else how come the cuet API isn't protected in any way like no",
    "start": "1730120",
    "end": "1736200"
  },
  {
    "text": "authentication or anything anything yeah so in this scenario the the CU API",
    "start": "1736200",
    "end": "1741760"
  },
  {
    "text": "didn't have any authentication so the cluster was misconfigured right that's why the the attackers there the tmtt",
    "start": "1741760",
    "end": "1747840"
  },
  {
    "text": "they were able to compromise that so they were they were inside the network and then scanning for the CU API uh",
    "start": "1747840",
    "end": "1754720"
  },
  {
    "text": "which is an API that shouldn't be exposed and should have authentication there so on that blog post I talk about",
    "start": "1754720",
    "end": "1761320"
  },
  {
    "text": "uh let me go back just real quick on that blog post I talk about this one I",
    "start": "1761320",
    "end": "1766559"
  },
  {
    "text": "talk about the AU ation that it's it's recommendation for for having that right if you don't have it then it could cause",
    "start": "1766559",
    "end": "1772919"
  },
  {
    "text": "this problem hello hello uh my name is emmer",
    "start": "1772919",
    "end": "1778360"
  },
  {
    "text": "and I'm from Ser team in Microsoft so I used to work on this like pretty much so but just my question you were mentioning",
    "start": "1778360",
    "end": "1785480"
  },
  {
    "text": "if it's like the cube API is misconfigured but they still can access",
    "start": "1785480",
    "end": "1790840"
  },
  {
    "text": "let's say they can do the side car injection whenever you have one of the privileged let's say bots so my question",
    "start": "1790840",
    "end": "1797799"
  },
  {
    "text": "on your rule how do you mitigate that sorry can you repeat the question please",
    "start": "1797799",
    "end": "1803159"
  },
  {
    "text": "like you have the rule the Falco rule that you just shared but they still can",
    "start": "1803159",
    "end": "1808480"
  },
  {
    "text": "um let's say inject it using their any of your privileged pods actually yeah",
    "start": "1808480",
    "end": "1814519"
  },
  {
    "text": "yeah it's not only about the misconfiguration of your CET API no no it's not it's not just the CU API so the",
    "start": "1814519",
    "end": "1820799"
  },
  {
    "text": "CU API was an example from the previous attacker that I was showing here but the side car injection can be done at other",
    "start": "1820799",
    "end": "1827760"
  },
  {
    "text": "ways as well and regarding the fal rule can you just maybe like explain to me",
    "start": "1827760",
    "end": "1833440"
  },
  {
    "text": "what you are trying here to do with the Falco rule that you just sure yeah the this Falco rule is just detecting the sh",
    "start": "1833440",
    "end": "1840720"
  },
  {
    "text": "binaries right so this one here it's just a shell binaries that is",
    "start": "1840720",
    "end": "1846000"
  },
  {
    "text": "running on the container there so if you detect that you can get get an alert so FAL will alert for that yeah okay thank",
    "start": "1846000",
    "end": "1853519"
  },
  {
    "text": "you okay",
    "start": "1853519",
    "end": "1859240"
  },
  {
    "text": "thank you for the good talk uh so we we got the alert now right like the fal it",
    "start": "1860639",
    "end": "1867240"
  },
  {
    "text": "could be Falco it could be any other Cloud native tool that notifies the",
    "start": "1867240",
    "end": "1873000"
  },
  {
    "text": "security analyst that okay this has been noticed what kind of actions could the",
    "start": "1873000",
    "end": "1879720"
  },
  {
    "text": "the uh security analyst The Blue Team can take to kind of uh not only",
    "start": "1879720",
    "end": "1886639"
  },
  {
    "text": "quarantine that container or that host but kind of root you out of the the",
    "start": "1886639",
    "end": "1891679"
  },
  {
    "text": "cluster sure sure yeah that's that's going to depend on the incident response process of each organization but of",
    "start": "1891679",
    "end": "1898760"
  },
  {
    "text": "course you probably should maybe isolate the node of that container of that uh",
    "start": "1898760",
    "end": "1903840"
  },
  {
    "text": "kubernetes cluster right and then investigate what's going on if it's it's could be a legitimate uh uh alert like a",
    "start": "1903840",
    "end": "1911720"
  },
  {
    "text": "false positive for example but it could be a vulnerability as well or someone that has access to your CL cluster so",
    "start": "1911720",
    "end": "1917919"
  },
  {
    "text": "you need to analyze that you might need to investigate other logs and try to uh correlate those logs and see what's",
    "start": "1917919",
    "end": "1923960"
  },
  {
    "text": "going on to take the appropriate actions okay thank you um just to add to",
    "start": "1923960",
    "end": "1931000"
  },
  {
    "text": "this to this question what exactly do you mean by isolating this node you mean",
    "start": "1931000",
    "end": "1936360"
  },
  {
    "text": "just uh cut it off from the communication with the API yeah you can you can re remove it",
    "start": "1936360",
    "end": "1943279"
  },
  {
    "text": "from the cluster itself right yeah but in joural Concepts kubernetes is resilient application meaning that it",
    "start": "1943279",
    "end": "1949480"
  },
  {
    "text": "will try to restart the exactly the same thing and if the image is compromised",
    "start": "1949480",
    "end": "1954720"
  },
  {
    "text": "then the Gen in general this won't work yeah yeah that's that's true yeah there",
    "start": "1954720",
    "end": "1960639"
  },
  {
    "text": "could be other options there but I think analyzing the the logs and and messing with the understanding what's going on I",
    "start": "1960639",
    "end": "1968039"
  },
  {
    "text": "think that would be a good idea yeah okay okay thank you",
    "start": "1968039",
    "end": "1976039"
  },
  {
    "text": "everyone",
    "start": "1976039",
    "end": "1979039"
  }
]