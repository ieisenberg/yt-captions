[
  {
    "text": "for coming my name is naven nain Mula I'm a tech lead with Tik Tok and I'm",
    "start": "120",
    "end": "5319"
  },
  {
    "text": "here to present bridging clouds Tik tok's blueprint for unified oadc access",
    "start": "5319",
    "end": "11160"
  },
  {
    "text": "management on multicloud kubernetes clusters let me let me introduce my team",
    "start": "11160",
    "end": "17760"
  },
  {
    "text": "first I'm part of the edge platform team and we are responsible for all the infrastructure for Edge use cases that",
    "start": "17760",
    "end": "25039"
  },
  {
    "text": "includes you know Tik Tok CDM live streaming realtime Communications Tik Tok FL Etc and we have a global presence",
    "start": "25039",
    "end": "33360"
  },
  {
    "text": "with multiple different regions we have a uh region in US EU as well as the rest",
    "start": "33360",
    "end": "38600"
  },
  {
    "text": "of the world and we have around 250 plus uh cuberes clusters across the globe and",
    "start": "38600",
    "end": "46360"
  },
  {
    "text": "as a platform team we provide features uh on top of kubernetes like you know access management secret management logs",
    "start": "46360",
    "end": "54039"
  },
  {
    "text": "metrics traffic management and metadata management Etc um predominantly",
    "start": "54039",
    "end": "60440"
  },
  {
    "text": "we are on Prem kubernetes clusters we start our journey with on Prem because of the sheer volume of data and network",
    "start": "60440",
    "end": "67280"
  },
  {
    "text": "bandwidth we deal with uh otherwise it's going to be too expensive if you go 100% Cloud so that being said um I just said",
    "start": "67280",
    "end": "76040"
  },
  {
    "text": "on Prem and how did we end it up multicloud correct so first I let me",
    "start": "76040",
    "end": "81159"
  },
  {
    "text": "talk a little bit about how did we even end it up in cloud first and then we go into the multic cloud so the cloud um I",
    "start": "81159",
    "end": "89079"
  },
  {
    "text": "think it's pretty standard reasons before the cloud um you know when everyone is doing on on Prem anytime you",
    "start": "89079",
    "end": "96600"
  },
  {
    "text": "want to add um you know new service to your site or you were building a new site new uh data center it could take",
    "start": "96600",
    "end": "104200"
  },
  {
    "text": "weeks months years sometimes based on the logistics you know or whatever uh",
    "start": "104200",
    "end": "109280"
  },
  {
    "text": "which is not in your control but on the other side application teams are",
    "start": "109280",
    "end": "114600"
  },
  {
    "text": "expecting faster ramp of times because you know Tik Tok is going exponentially",
    "start": "114600",
    "end": "119920"
  },
  {
    "text": "people want to test some features in a specific countries in a specific regions and uh they want it in a faster ramp of",
    "start": "119920",
    "end": "127360"
  },
  {
    "text": "times so as a platform team we started looking into obviously in Cloud but on",
    "start": "127360",
    "end": "133680"
  },
  {
    "text": "day Zero itself we realized that it's not like we're going to go into Cloud",
    "start": "133680",
    "end": "138800"
  },
  {
    "text": "into one single cloud provider but rather we're going to go into on day",
    "start": "138800",
    "end": "144200"
  },
  {
    "text": "Zero itself as a multicloud that reason being a couple of reasons obviously mean",
    "start": "144200",
    "end": "149879"
  },
  {
    "text": "easily it's because of the business decisions or business requirements for example some of you may know you know",
    "start": "149879",
    "end": "155680"
  },
  {
    "text": "Tik Tok and Oracle has some uh you know relationship and anything in us it's all",
    "start": "155680",
    "end": "161519"
  },
  {
    "text": "in oci uh data center so that basically means that any us data you know uh",
    "start": "161519",
    "end": "167120"
  },
  {
    "text": "kubernetes clusters it's going to be in oci but we also have similar um you know",
    "start": "167120",
    "end": "172800"
  },
  {
    "text": "uh relationships with uh gcp and AWS for you know AWS as well sorry for EU and",
    "start": "172800",
    "end": "179840"
  },
  {
    "text": "rest of the world region but more than that you know obviously you know the",
    "start": "179840",
    "end": "185120"
  },
  {
    "text": "standard regions right why people going to multic Cloud you know we we want to go you know because of the winter",
    "start": "185120",
    "end": "190480"
  },
  {
    "text": "Independence as well as the geographical redundency um um you know um those are",
    "start": "190480",
    "end": "196000"
  },
  {
    "text": "very standard reasons but majorly it's because we have to do this on the day Zero itself because of you know our",
    "start": "196000",
    "end": "201840"
  },
  {
    "text": "relationships uh a geopolitical uh stuff um there might be a question where hey",
    "start": "201840",
    "end": "208280"
  },
  {
    "text": "how did you guys handle this multicloud migration right so I've been in this you know kubernetes ecosystem even in my",
    "start": "208280",
    "end": "215599"
  },
  {
    "text": "with my previous company as well anytime any outage happens in one of the cloud provider everybody starts talking about",
    "start": "215599",
    "end": "221599"
  },
  {
    "text": "multicloud correct but it's not that easy if you started doing it in in a",
    "start": "221599",
    "end": "226640"
  },
  {
    "text": "cloud provider where lot of the time your applications is very much tied to",
    "start": "226640",
    "end": "231760"
  },
  {
    "text": "those uh cloud provider services for example S3 Lambda you know whatever you're using it but for us that's not",
    "start": "231760",
    "end": "239319"
  },
  {
    "text": "the case because we started our journey with on Prime that basically means that",
    "start": "239319",
    "end": "244480"
  },
  {
    "text": "all of our application teams whatever they want everything they containerize",
    "start": "244480",
    "end": "249519"
  },
  {
    "text": "they put everything into a pure native kubernetes R whether it's a postest mongodb CFA redes you name it whatever",
    "start": "249519",
    "end": "257040"
  },
  {
    "text": "they need it they basically built it as part of the container so for them it's easy to switch between on Prem to a",
    "start": "257040",
    "end": "263199"
  },
  {
    "text": "different cloud provider or one cloud provider the other cloud provider all right so challenges so",
    "start": "263199",
    "end": "270720"
  },
  {
    "text": "obviously it's not going to be you know a simple Journey easy Journey but um when we started it U majorly we have",
    "start": "270720",
    "end": "280440"
  },
  {
    "text": "four different kubernetes environments so we we already had on Prem but we also",
    "start": "280440",
    "end": "286360"
  },
  {
    "text": "have GK eks and OK clusters uh with on Prem you know the platform",
    "start": "286360",
    "end": "292240"
  },
  {
    "text": "administrators has this luxury in terms of you configure however you want to configure your API server and all of the",
    "start": "292240",
    "end": "298840"
  },
  {
    "text": "stuff because that's in your control but when you go to the cloud providers especially manage services you don't",
    "start": "298840",
    "end": "305600"
  },
  {
    "text": "have that in your control right so and also there couple of slight",
    "start": "305600",
    "end": "311400"
  },
  {
    "text": "implementation changes uh cloud provider to the cloud provider for example you",
    "start": "311400",
    "end": "316759"
  },
  {
    "text": "know for kubernetes service if you create a kubernetes service in gke you probably get you know IP address whereas",
    "start": "316759",
    "end": "323479"
  },
  {
    "text": "if you do it in AWS eks you probably get uh something like example. Amazon a.com",
    "start": "323479",
    "end": "329960"
  },
  {
    "text": "some fqdn obvious you know the other changes as well challenges as well",
    "start": "329960",
    "end": "335280"
  },
  {
    "text": "underlying cni implementation secret management etc etc but we are here to",
    "start": "335280",
    "end": "341120"
  },
  {
    "text": "talk about access management support so um when we started looking into the",
    "start": "341120",
    "end": "346560"
  },
  {
    "text": "access management right where application teams are accessing these clusters uh we found that there's",
    "start": "346560",
    "end": "353160"
  },
  {
    "text": "inconsistent oadc support across different Cloud providers and some of the cloud providers was not even",
    "start": "353160",
    "end": "358960"
  },
  {
    "text": "supporting uh at the at that time but let's let's zoom in on this access",
    "start": "358960",
    "end": "365319"
  },
  {
    "text": "management support So before we started our on you know Cloud Journey correct so",
    "start": "365319",
    "end": "372520"
  },
  {
    "text": "this was our previous setup on Prem setup so if you look at um you know on",
    "start": "372520",
    "end": "377720"
  },
  {
    "text": "the left side it's it's pretty much whenever user runs Cube CTL get parts on their laptop you know it goes to some",
    "start": "377720",
    "end": "385199"
  },
  {
    "text": "kind of identity provider in our case it's a key clock so it and user gets user session token and then Cube CTL",
    "start": "385199",
    "end": "393240"
  },
  {
    "text": "basically you know passes that user session token to uh you know respective",
    "start": "393240",
    "end": "398599"
  },
  {
    "text": "clusters in this case API server so and then if you look at it um API server",
    "start": "398599",
    "end": "404080"
  },
  {
    "text": "actually talks to keycloak to verify that user session token and decode that ID token gets you know user information",
    "start": "404080",
    "end": "412120"
  },
  {
    "text": "group information and based that that information it takes the Deion to",
    "start": "412120",
    "end": "417199"
  },
  {
    "text": "whether to you know respond to the a specific request or not if you look at",
    "start": "417199",
    "end": "422720"
  },
  {
    "text": "um you know from the namespace point of view there's two main things correct there's one role and then there's a role",
    "start": "422720",
    "end": "428720"
  },
  {
    "text": "binding in our case we have a developer viewer and uh you know admin you know",
    "start": "428720",
    "end": "435080"
  },
  {
    "text": "owner role so if you look at this role binding that's the last line is the one",
    "start": "435080",
    "end": "441160"
  },
  {
    "text": "which is dictating like it's basically telling that if a user is part of this",
    "start": "441160",
    "end": "446360"
  },
  {
    "text": "particular group then give give him or her the",
    "start": "446360",
    "end": "452280"
  },
  {
    "text": "access to that particular role which is in this case ns1 owner so from the",
    "start": "452280",
    "end": "457520"
  },
  {
    "text": "configuration point of view just from the you know platform uh configuration point of view correct so any changes we",
    "start": "457520",
    "end": "465120"
  },
  {
    "text": "want to do on the API server it's pretty much the configuration changes you put it in the API server. you know API",
    "start": "465120",
    "end": "471919"
  },
  {
    "text": "server config file and it takes care of you know all of this user SST validation",
    "start": "471919",
    "end": "477039"
  },
  {
    "text": "out of box from the kubernetes from the namespace point of view we basically Ma",
    "start": "477039",
    "end": "482440"
  },
  {
    "text": "you know do that as part of the namespace management whenever someone create a namespace as a platform team we",
    "start": "482440",
    "end": "487919"
  },
  {
    "text": "created role and role binding um so uh yeah so this is the previous setup",
    "start": "487919",
    "end": "494960"
  },
  {
    "text": "before we started our journey with the cloud but now when you mix Cloud",
    "start": "494960",
    "end": "500479"
  },
  {
    "text": "providers into it so gke has their own identity service and you have to enable",
    "start": "500479",
    "end": "507800"
  },
  {
    "text": "that feature and once you enable it whatever I was talking about uh you know",
    "start": "507800",
    "end": "512839"
  },
  {
    "text": "oadc configuration in this API server correct that they created it an operator",
    "start": "512839",
    "end": "519399"
  },
  {
    "text": "and you have to uh provide that oidc metadata the for example oidc endpoint",
    "start": "519399",
    "end": "525160"
  },
  {
    "text": "user groups you know what is the claim and client ID and client secret Etc all",
    "start": "525160",
    "end": "530279"
  },
  {
    "text": "of that information needs to be passed it as a crd um the good thing with gke is uh as",
    "start": "530279",
    "end": "538839"
  },
  {
    "text": "soon as you provide the CD then you'll see that you know the identity Service Parts are running uh in your work and",
    "start": "538839",
    "end": "545519"
  },
  {
    "text": "notes so you can see you know log into the you know parts and you can see the logs Etc all all all good things there",
    "start": "545519",
    "end": "553079"
  },
  {
    "text": "but when you start when you want to do the same thing with the eks eks also has",
    "start": "553079",
    "end": "559079"
  },
  {
    "text": "their own identity service but it's different than gke and the only",
    "start": "559079",
    "end": "564360"
  },
  {
    "text": "difference what we found at that time is their identity service runs in the",
    "start": "564360",
    "end": "569720"
  },
  {
    "text": "control plane which basically means that your endpoint this oadc endpoint",
    "start": "569720",
    "end": "576200"
  },
  {
    "text": "must be accessible from the control plane and you don't have any access to the logs so what not out of box it's",
    "start": "576200",
    "end": "583680"
  },
  {
    "text": "more like a block box uh in eks and OK uh obviously this is you know last year",
    "start": "583680",
    "end": "590880"
  },
  {
    "text": "when we were researching about it ok did not even support any oadc support but if",
    "start": "590880",
    "end": "598200"
  },
  {
    "text": "you look at from the config ation point of view again from the platform administrator point of view previously",
    "start": "598200",
    "end": "603360"
  },
  {
    "text": "it was pretty simple just go and add you know oidc metadata into your favorite tool you know Cube uh ADM or cube spray",
    "start": "603360",
    "end": "610760"
  },
  {
    "text": "or whatnot but now if it is GK eks you know if equal to gke submit CT if equal",
    "start": "610760",
    "end": "619079"
  },
  {
    "text": "to eks do something else you know lot of these things uh basically we felt that",
    "start": "619079",
    "end": "624720"
  },
  {
    "text": "it's a problematic you know it's you're going to have to deal with in a lot of if and else condition but also from the",
    "start": "624720",
    "end": "630760"
  },
  {
    "text": "user experience point of view on Prem they were running Cube CDL gate parts in",
    "start": "630760",
    "end": "635800"
  },
  {
    "text": "one way but in gke you need to have you know G console or some kind of different user experience we're getting so we",
    "start": "635800",
    "end": "642959"
  },
  {
    "text": "wanted to make a unified oadc access across all these and users doesn't need",
    "start": "642959",
    "end": "650200"
  },
  {
    "text": "to know whether the you know underlying cluster is from GK or eks or on Prime",
    "start": "650200",
    "end": "656560"
  },
  {
    "text": "so um the first first thing what we tried to do is whenever we we tried to",
    "start": "656560",
    "end": "663240"
  },
  {
    "text": "solve this problem the first thing we found you know we tried to research open source projects and we didn't find",
    "start": "663240",
    "end": "669760"
  },
  {
    "text": "anything active projects we found one from jet stack but the last commit was",
    "start": "669760",
    "end": "675040"
  },
  {
    "text": "like 5 years ago uh and it was written in a b letters like hey do not use this",
    "start": "675040",
    "end": "680399"
  },
  {
    "text": "in production so we did not even uh you know evaluate that solution but the fun",
    "start": "680399",
    "end": "686440"
  },
  {
    "text": "fact is I this this was the time the last Cube con time where I was in the",
    "start": "686440",
    "end": "693160"
  },
  {
    "text": "situation where we were trying to solve this problem so luckily I you know I",
    "start": "693160",
    "end": "698880"
  },
  {
    "text": "came to cubec con so I started walking to all the cloud provider boots uh you",
    "start": "698880",
    "end": "704000"
  },
  {
    "text": "know okay uh okaya gcp guys as well as AWS everybody has their own road map uh",
    "start": "704000",
    "end": "711399"
  },
  {
    "text": "but that road map is not merging anywhere and we realize that um even if",
    "start": "711399",
    "end": "717560"
  },
  {
    "text": "you wait 2 years or 3 years the problem what we think is the problem is not going to be solved so um I spoke to",
    "start": "717560",
    "end": "725760"
  },
  {
    "text": "couple of other uh folks as well and that's when I realized that it's getting too complicated whenever we want to",
    "start": "725760",
    "end": "732160"
  },
  {
    "text": "build this solution so whenever it gets too complicated my gut feeling is like go back to fundamentals go back to",
    "start": "732160",
    "end": "739440"
  },
  {
    "text": "fundamentals what we basically did is we started looking at the kubernets authenticating the documentation the I",
    "start": "739440",
    "end": "745920"
  },
  {
    "text": "am documentation and figure trying to figure out how many ways kubernetes actually supports this you know access",
    "start": "745920",
    "end": "753279"
  },
  {
    "text": "management right you know there's a certificate there's a service account there's oidc and then there is something",
    "start": "753279",
    "end": "758880"
  },
  {
    "text": "called user impersonation so user impersonation is something where you basically talking to Cluster with a",
    "start": "758880",
    "end": "766480"
  },
  {
    "text": "cluster admin account but in that specific request context you can tell",
    "start": "766480",
    "end": "772040"
  },
  {
    "text": "kubernetes that hey scope it down to specific user and specific user groups",
    "start": "772040",
    "end": "778519"
  },
  {
    "text": "so I'll talk a little bit more about it but in high level that's not a one on one toone",
    "start": "778519",
    "end": "785440"
  },
  {
    "text": "solution what we implemented but that was more of a starting point for us and when you combine with bunch of other",
    "start": "785440",
    "end": "792160"
  },
  {
    "text": "stuff like you know ony ODC identity provider we could see that the new solution could work for us across all",
    "start": "792160",
    "end": "800000"
  },
  {
    "text": "the cloud providers so in terms of the new architecture if you look at from the",
    "start": "800000",
    "end": "806120"
  },
  {
    "text": "right side these are the Clusters it doesn't matter whether it's on Prem cluster the gke cluster or eks cluster",
    "start": "806120",
    "end": "813160"
  },
  {
    "text": "but also there's no changes from the names space as well so we don't have to do lot more stuff on our existing thing",
    "start": "813160",
    "end": "820120"
  },
  {
    "text": "so it's the same uh you know role and role binding as well but if you closely observe API server this is not the one",
    "start": "820120",
    "end": "828560"
  },
  {
    "text": "which is talking to keylock anymore to validate that user session token rather",
    "start": "828560",
    "end": "833880"
  },
  {
    "text": "we delegated that functionality to One Step upfront in our case this is eno and",
    "start": "833880",
    "end": "841399"
  },
  {
    "text": "Eno has something called you know external authorization where you this",
    "start": "841399",
    "end": "847199"
  },
  {
    "text": "particular authorization server takes the responsibility of user session token validation and it it is talking it's",
    "start": "847199",
    "end": "854199"
  },
  {
    "text": "going to talk to keylock and it's going to do that magic of user impersonation",
    "start": "854199",
    "end": "859440"
  },
  {
    "text": "whatever we're talking about so in a newer flow user basically still runs the",
    "start": "859440",
    "end": "865399"
  },
  {
    "text": "cube CTL get parts and it goes to key clock gets the user session token now in",
    "start": "865399",
    "end": "872279"
  },
  {
    "text": "user Cube config we don't have any details of the target clusters but",
    "start": "872279",
    "end": "878240"
  },
  {
    "text": "rather they're pointing pointed to eny so in this case it presents to ony ony",
    "start": "878240",
    "end": "885120"
  },
  {
    "text": "basically you know uh uh forwards the request to authorization server authorization",
    "start": "885120",
    "end": "891920"
  },
  {
    "text": "server validates the user session token decodes that I you know user idid groups",
    "start": "891920",
    "end": "898560"
  },
  {
    "text": "and overrides it with that you know user impersonation whatever is kubernetes expecting and responds back to Envoy and",
    "start": "898560",
    "end": "906480"
  },
  {
    "text": "now on has to go and connect to whatever your target clusters in this case on",
    "start": "906480",
    "end": "912920"
  },
  {
    "text": "pram or gke or eks so in high level the flow whatever I",
    "start": "912920",
    "end": "918440"
  },
  {
    "text": "just talked about runs the cube CTL uh command initiation and then it goes to reverse proxy and then there is",
    "start": "918440",
    "end": "925480"
  },
  {
    "text": "impersonation and request forwarding is happening at the on y level so in terms",
    "start": "925480",
    "end": "931880"
  },
  {
    "text": "of the core components if you closely look at this diagram once again so you",
    "start": "931880",
    "end": "937680"
  },
  {
    "text": "have there's ony and then there's the authorization server but in both the",
    "start": "937680",
    "end": "943120"
  },
  {
    "text": "cases uh ony needs cluster information because this is no longer coming from",
    "start": "943120",
    "end": "948480"
  },
  {
    "text": "the cube config authorization server also needs cluster barer token service",
    "start": "948480",
    "end": "954839"
  },
  {
    "text": "account barer token which has access to the entire cluster so in terms of the core components here it's one of the you",
    "start": "954839",
    "end": "962079"
  },
  {
    "text": "know one is onise the second one is authorization server and third one is uh",
    "start": "962079",
    "end": "967360"
  },
  {
    "text": "cluster metadata so reverse proxy authorization server and cluster",
    "start": "967360",
    "end": "972959"
  },
  {
    "text": "metadata let's go step by step uh into each and every component so by no means",
    "start": "972959",
    "end": "979040"
  },
  {
    "text": "this is ony presentation but I just wanted to show you guys in terms of um",
    "start": "979040",
    "end": "984079"
  },
  {
    "text": "you know visualizing the blog diagram how does a request flows through on on",
    "start": "984079",
    "end": "989440"
  },
  {
    "text": "reverse proxy if you look at the bottom ony has some constructs something called",
    "start": "989440",
    "end": "994519"
  },
  {
    "text": "listeners routes HTTP filters clusters this is not kubernetes cluster but it's",
    "start": "994519",
    "end": "1000839"
  },
  {
    "text": "rather you know back end they you know it uses the same terminology as the cluster so you can expose the ports on",
    "start": "1000839",
    "end": "1009079"
  },
  {
    "text": "listener in our case it could be you know 8080 and 8443 and then there is a",
    "start": "1009079",
    "end": "1014199"
  },
  {
    "text": "route section route section is where you define incoming routes you know the",
    "start": "1014199",
    "end": "1019360"
  },
  {
    "text": "matches so in our case you know every cluster has its own route we went",
    "start": "1019360",
    "end": "1024400"
  },
  {
    "text": "cluster cluster one if it's cluster two cluster three so whenever request comes here and it gets matched with this",
    "start": "1024400",
    "end": "1031038"
  },
  {
    "text": "particular block it it basically what this is telling us Hey whenever the",
    "start": "1031039",
    "end": "1037000"
  },
  {
    "text": "request comes with this prefix forward it to Cluster one backend if it comes",
    "start": "1037000",
    "end": "1042520"
  },
  {
    "text": "with cluster two forward it to Cluster two backend if it comes with cluster three forward to Cluster three backend",
    "start": "1042520",
    "end": "1049080"
  },
  {
    "text": "but before forwarding it to the back end onway also allows you to configure",
    "start": "1049080",
    "end": "1055200"
  },
  {
    "text": "something called HTTP filters you can pass that request through multiple filters and in this specific case there",
    "start": "1055200",
    "end": "1063679"
  },
  {
    "text": "is a filter called external OD Z which basically means that you're configuring",
    "start": "1063679",
    "end": "1068840"
  },
  {
    "text": "ony to hey this is my authorization server external every time any request",
    "start": "1068840",
    "end": "1074799"
  },
  {
    "text": "comes in you forward it to me and I take the dation of authorization so so in",
    "start": "1074799",
    "end": "1080120"
  },
  {
    "text": "high level there's pretty much the route section HTTP filter section and cluster section and we can go one by one in this",
    "start": "1080120",
    "end": "1087280"
  },
  {
    "text": "specific you know oidc use case so route section like I said every cluster will",
    "start": "1087280",
    "end": "1094120"
  },
  {
    "text": "have its own routes but when I started doing the POC correct so I realized that",
    "start": "1094120",
    "end": "1101240"
  },
  {
    "text": "Cube CTL commands there two different types of command one of them is you know",
    "start": "1101240",
    "end": "1106360"
  },
  {
    "text": "special needs special handling for examp example EXC Cube CTL XC Cube CTL logs",
    "start": "1106360",
    "end": "1112120"
  },
  {
    "text": "minus F or P forward because it needs a different protocol you know web socket or spdy but everything else is just an",
    "start": "1112120",
    "end": "1120280"
  },
  {
    "text": "HTTP um request so for us we created two route if you look at closely on the left",
    "start": "1120280",
    "end": "1127320"
  },
  {
    "text": "side it's basically says that hey anytime any request comes with this",
    "start": "1127320",
    "end": "1132360"
  },
  {
    "text": "prefix cluster one prefix but with the upgrade connection type is equals to web",
    "start": "1132360",
    "end": "1137919"
  },
  {
    "text": "socket then forward it to this back end you know kubernetes upgrade cluster one",
    "start": "1137919",
    "end": "1143799"
  },
  {
    "text": "but on the right side if you look at you know everything else like all the HTTP end points can point to you know this",
    "start": "1143799",
    "end": "1149760"
  },
  {
    "text": "particular route so this is more of a route so now think about whenever request comes to this it looks at it and",
    "start": "1149760",
    "end": "1157200"
  },
  {
    "text": "okay it found the match and then the next step next step is before we forwarding it to the back and we",
    "start": "1157200",
    "end": "1163440"
  },
  {
    "text": "basically saying that hey um you know pass this request through EXT",
    "start": "1163440",
    "end": "1169679"
  },
  {
    "text": "authorization uh um in know plugin if you closely look at it again this is not",
    "start": "1169679",
    "end": "1175600"
  },
  {
    "text": "inside ony but this is more like your outside but in you can configure ony",
    "start": "1175600",
    "end": "1181400"
  },
  {
    "text": "that hey anytime a request comes in forward it to this external authorization server so if you look at",
    "start": "1181400",
    "end": "1188440"
  },
  {
    "text": "this the plug-in name called HTTP do extor RZ and it needs three information",
    "start": "1188440",
    "end": "1195120"
  },
  {
    "text": "one of them is hey what is the end point anytime a request comes to where do you want me to forward it to two what are",
    "start": "1195120",
    "end": "1201880"
  },
  {
    "text": "the incoming requests I'm expecting at that external server in in this case I'm",
    "start": "1201880",
    "end": "1207720"
  },
  {
    "text": "telling like hey this is authorization header you pass that authorization header to you know uh uh external",
    "start": "1207720",
    "end": "1214200"
  },
  {
    "text": "authorization server but also on the response hey I'm going to add some manipulate some things on the",
    "start": "1214200",
    "end": "1219280"
  },
  {
    "text": "authorization header server so and these are the ones which I'm going to manipulate in this case impersonate and",
    "start": "1219280",
    "end": "1226120"
  },
  {
    "text": "uh this is important because that's basically what kubernetes is expecting so there are two things authorization",
    "start": "1226120",
    "end": "1232039"
  },
  {
    "text": "and impersonation those things are coming back from the authorization server and on the right side you it's a",
    "start": "1232039",
    "end": "1238159"
  },
  {
    "text": "pretty standard back end for that you know wherever you deployed it you basically go provide that information",
    "start": "1238159",
    "end": "1243720"
  },
  {
    "text": "for that external authorization so so now the request came in to Route then go",
    "start": "1243720",
    "end": "1249200"
  },
  {
    "text": "to the external r z and external RZ did its magic and came back with this",
    "start": "1249200",
    "end": "1254559"
  },
  {
    "text": "headers and now we're going to have to forward that request to to the back",
    "start": "1254559",
    "end": "1260120"
  },
  {
    "text": "end remember that you know uh user Cube config doesn't have cluster information",
    "start": "1260120",
    "end": "1266679"
  },
  {
    "text": "but ony needs to have that information so in this case you know if you look at",
    "start": "1266679",
    "end": "1272000"
  },
  {
    "text": "these things that needs two informations one of them is what is the cluster API",
    "start": "1272000",
    "end": "1277760"
  },
  {
    "text": "endpoint whatever your cluster API server endpoint and kubernetes supports only https that means you need to",
    "start": "1277760",
    "end": "1285279"
  },
  {
    "text": "provide that CA config you know your certificate authority to the uh you know",
    "start": "1285279",
    "end": "1291000"
  },
  {
    "text": "eny as well if you don't use these things you know before that it used to be as part of your Cube config so",
    "start": "1291000",
    "end": "1297520"
  },
  {
    "text": "whatever is was there in Cube config it goes into this you know this is the API server endpoint and this is the um you",
    "start": "1297520",
    "end": "1305240"
  },
  {
    "text": "know caert for that particular specific cluster uh we have two specific you know",
    "start": "1305240",
    "end": "1310720"
  },
  {
    "text": "two different back uh back ends because of the same reason whatever I talked about in the routing section so we",
    "start": "1310720",
    "end": "1316919"
  },
  {
    "text": "separated them into you know special command backend and as well as the regular command so these are the cluster",
    "start": "1316919",
    "end": "1325440"
  },
  {
    "text": "configuration um that's more of enway and now the second core component is",
    "start": "1325440",
    "end": "1333120"
  },
  {
    "text": "about authorization server so this is where you basically build a logic you",
    "start": "1333120",
    "end": "1338480"
  },
  {
    "text": "know of validating user session token decode that you know open ID token and",
    "start": "1338480",
    "end": "1344600"
  },
  {
    "text": "retrieve the user ID groups and whatever you want to retrieve that from that uh",
    "start": "1344600",
    "end": "1350440"
  },
  {
    "text": "you know ID token then do this magic this is where you have to uh you know",
    "start": "1350440",
    "end": "1357559"
  },
  {
    "text": "provide that impersonation so kubernetes expects the documentation tells you that",
    "start": "1357559",
    "end": "1363600"
  },
  {
    "text": "hey if you are using user impersonation this is how you can tell",
    "start": "1363600",
    "end": "1368679"
  },
  {
    "text": "me that you want to use user impersonation in this case there's some you know three headers you know two",
    "start": "1368679",
    "end": "1374360"
  },
  {
    "text": "headers there's something called impersonate user in my in case that could be n.m Tik tok.com and then the",
    "start": "1374360",
    "end": "1381880"
  },
  {
    "text": "groups impersonate Group whatever user is part you know part of the groups um the couple of um gas uh which we found",
    "start": "1381880",
    "end": "1391200"
  },
  {
    "text": "during our PC which we you know hard way where we took a lot of time to you know",
    "start": "1391200",
    "end": "1396600"
  },
  {
    "text": "find out this find this out um that external authorization server you can",
    "start": "1396600",
    "end": "1402039"
  },
  {
    "text": "build it in grpc or you can build it in HTTP so when we built it in grpc the",
    "start": "1402039",
    "end": "1408799"
  },
  {
    "text": "problem was if user is part of 10 groups the GPC metadata basically gets",
    "start": "1408799",
    "end": "1414039"
  },
  {
    "text": "overwritten by one single group so if you have 10 groups all the first nine groups gets over overwritten by the 10th",
    "start": "1414039",
    "end": "1421159"
  },
  {
    "text": "group so you can see the ony uh open source uh issues as well you'll see lot",
    "start": "1421159",
    "end": "1427480"
  },
  {
    "text": "of the issues related to that uh but if you switch to http then all of these headers whatever",
    "start": "1427480",
    "end": "1435360"
  },
  {
    "text": "10 user uh group membership you can append all of those groups uh according",
    "start": "1435360",
    "end": "1441880"
  },
  {
    "text": "to what cuet is expecting so it's important that you know you have to switch to http service implementation on",
    "start": "1441880",
    "end": "1449320"
  },
  {
    "text": "authorization server uh compared to you know grpc so that's about authorization",
    "start": "1449320",
    "end": "1455760"
  },
  {
    "text": "server and then the cluster metadata right so cluster metadata like we talked",
    "start": "1455760",
    "end": "1462039"
  },
  {
    "text": "about if you look at authorization server this is where we're going to have",
    "start": "1462039",
    "end": "1467720"
  },
  {
    "text": "to the authorization server basically overrides user session token after",
    "start": "1467720",
    "end": "1473000"
  },
  {
    "text": "successful validation with cluster Administration barer token so somehow",
    "start": "1473000",
    "end": "1478080"
  },
  {
    "text": "you have to present you know authorization server with this clusters barer token and the second one is in the",
    "start": "1478080",
    "end": "1485760"
  },
  {
    "text": "cluster details if you look at it you need to have this cluster API server",
    "start": "1485760",
    "end": "1490919"
  },
  {
    "text": "details as well as the ca config so the cluster metadata it depends on your",
    "start": "1490919",
    "end": "1496399"
  },
  {
    "text": "config uh I'm just going to provide an idea here how we did it so we basically",
    "start": "1496399",
    "end": "1501600"
  },
  {
    "text": "have all of this information as a kubernetes secret and uh made it",
    "start": "1501600",
    "end": "1507120"
  },
  {
    "text": "available to Eno as well as authorization header so it picks up that information whenever it needs to",
    "start": "1507120",
    "end": "1513520"
  },
  {
    "text": "override user session token it could be manual or it could be automated um but",
    "start": "1513520",
    "end": "1519159"
  },
  {
    "text": "in our case we kind of automated in a way that anytime a data plane kubernetes",
    "start": "1519159",
    "end": "1524840"
  },
  {
    "text": "cluster comes up uh it uh gets onboarded on to the control plane cluster but also",
    "start": "1524840",
    "end": "1531440"
  },
  {
    "text": "along with it we have an automation for ago CD cluster registration or um you",
    "start": "1531440",
    "end": "1537840"
  },
  {
    "text": "know hash wal registration Etc so we onboarded this oadc service as well so",
    "start": "1537840",
    "end": "1544279"
  },
  {
    "text": "it's every time a new cluster comes in and that kubernetes Secrets gets created",
    "start": "1544279",
    "end": "1549480"
  },
  {
    "text": "in that particular uh namespace so that on and uh author server can pick up that",
    "start": "1549480",
    "end": "1556840"
  },
  {
    "text": "information all right so that's the basic idea you can use to build the",
    "start": "1556840",
    "end": "1563480"
  },
  {
    "text": "solution um but if you look at you know all of this this is bunch of AML files",
    "start": "1563480",
    "end": "1568919"
  },
  {
    "text": "in eny so you can always build um eny using static AML file but also ony",
    "start": "1568919",
    "end": "1576559"
  },
  {
    "text": "provides something called Dynamic configuration loading using an ony XDS",
    "start": "1576559",
    "end": "1581880"
  },
  {
    "text": "so we switch to XDS because of the number of clusters we deal with you know",
    "start": "1581880",
    "end": "1587200"
  },
  {
    "text": "and the frequency of cluster life cycle events so we switched it to on XDS where",
    "start": "1587200",
    "end": "1593760"
  },
  {
    "text": "everything is written inside the goang code anytime a new cluster comes in we basically picks that up and updates the",
    "start": "1593760",
    "end": "1601360"
  },
  {
    "text": "ony without needs without ony needs to be restarted or anything so everything",
    "start": "1601360",
    "end": "1607240"
  },
  {
    "text": "is automated in our case uh but also on the other hand there is service account",
    "start": "1607240",
    "end": "1615240"
  },
  {
    "text": "you know there's probably if you're a security person there's probably Rings you know uh bells ringing because hey",
    "start": "1615240",
    "end": "1622799"
  },
  {
    "text": "that service account has access to the entire cluster and you need to have you",
    "start": "1622799",
    "end": "1628120"
  },
  {
    "text": "know uh you need to secure that service account yes we have you know our back",
    "start": "1628120",
    "end": "1633760"
  },
  {
    "text": "control everything no one else can access that namespace other than the you know few of the pl platform",
    "start": "1633760",
    "end": "1639200"
  },
  {
    "text": "administrators but we also went a little bit further and uh we we also",
    "start": "1639200",
    "end": "1647159"
  },
  {
    "text": "enabled rotating those service account tokens so we have a hashiko vault and",
    "start": "1647159",
    "end": "1652880"
  },
  {
    "text": "there's a kubernetes secret engine and we use the kubernetes secret engine to rotate these cluster admin barrier",
    "start": "1652880",
    "end": "1659640"
  },
  {
    "text": "tokens every 1 hour every 1 hour it gets rotated so that even if someone gets",
    "start": "1659640",
    "end": "1665880"
  },
  {
    "text": "hold of the particular token uh within an hour it gets you know uh",
    "start": "1665880",
    "end": "1671480"
  },
  {
    "text": "invalidated yeah so in high level this is more of a you know idea uh the blue",
    "start": "1671480",
    "end": "1678200"
  },
  {
    "text": "print where you guys could take it and you know start implementing it if you are in the same boat but um yeah this",
    "start": "1678200",
    "end": "1685760"
  },
  {
    "text": "helped does uh basically it doesn't matter whether it's a uh a you know",
    "start": "1685760",
    "end": "1692159"
  },
  {
    "text": "Cloud providers or on Prem pretty much it's the same thing but also we removed",
    "start": "1692159",
    "end": "1700000"
  },
  {
    "text": "that uh user session validation from the cluster side and put it in the in know",
    "start": "1700000",
    "end": "1705960"
  },
  {
    "text": "one front uh one step further uh one One Step front that helped us to you know",
    "start": "1705960",
    "end": "1711600"
  },
  {
    "text": "users not needing to deal with VPN or whatnot if you put that in the DMZ zone",
    "start": "1711600",
    "end": "1717039"
  },
  {
    "text": "or Etc um yeah I think that's pretty much what I have um thank you and if you guys",
    "start": "1717039",
    "end": "1724600"
  },
  {
    "text": "have any questions I would love to answer it but if not I can yeah thank",
    "start": "1724600",
    "end": "1731440"
  },
  {
    "text": "you all right",
    "start": "1735360",
    "end": "1739720"
  },
  {
    "text": "can you hear me um thank you for the presentation um curiously what did he use for the authorization server itself",
    "start": "1742399",
    "end": "1749880"
  },
  {
    "text": "um like when we were planning we were testing this out we were testing it with",
    "start": "1749880",
    "end": "1755360"
  },
  {
    "text": "o 2 proxy and at that time like Ono did not have support for HTTP um like the",
    "start": "1755360",
    "end": "1762880"
  },
  {
    "text": "Excel NY filter did not work over HTTP and it was only doing grpc and or R to",
    "start": "1762880",
    "end": "1768720"
  },
  {
    "text": "proxy was only doing HTTP so we had to like build like a um layer um and it was",
    "start": "1768720",
    "end": "1775320"
  },
  {
    "text": "just getting too complicated so we decided to go against it but I'm curious how what what server you are us using",
    "start": "1775320",
    "end": "1782559"
  },
  {
    "text": "it's a pretty standard um in a goang server right if we just built a goang application and exposed an API just you",
    "start": "1782559",
    "end": "1791519"
  },
  {
    "text": "I need to follow what anwa is telling us to follow like hey you this this is the",
    "start": "1791519",
    "end": "1796799"
  },
  {
    "text": "request and this is the resp response and you just need to implement that request and response and that's pretty",
    "start": "1796799",
    "end": "1801919"
  },
  {
    "text": "much what we have to do it there's no specific uh things we need just a pretty",
    "start": "1801919",
    "end": "1807120"
  },
  {
    "text": "standard goang application uh but what we have done in our case is because we",
    "start": "1807120",
    "end": "1814159"
  },
  {
    "text": "have eny XDS and then this the authorized server we just m both of them",
    "start": "1814159",
    "end": "1820159"
  },
  {
    "text": "together so it serves as Ono XDS where it's basically updating cluster metadata",
    "start": "1820159",
    "end": "1826480"
  },
  {
    "text": "but also serving it as a server for authorization but it could be completely two different uh you know goang",
    "start": "1826480",
    "end": "1833640"
  },
  {
    "text": "applications yeah got it thank you can you hear me hey uh thank you for",
    "start": "1833640",
    "end": "1841519"
  },
  {
    "text": "the presentation you mentioned you look at the available open source project and didn't find uh the one that was uh",
    "start": "1841519",
    "end": "1849720"
  },
  {
    "text": "suited for you I don't know did you look at the open source project called teleport it basically can do like",
    "start": "1849720",
    "end": "1857240"
  },
  {
    "text": "exactly what it described but it's already like packaged neatly packaged then you don't have to do a lot of",
    "start": "1857240",
    "end": "1862960"
  },
  {
    "text": "manual stuff and it has like additional nice features like auditing and stuff like that great so um unfortunately yeah",
    "start": "1862960",
    "end": "1870120"
  },
  {
    "text": "so at least it did not probably it's not you know in the Google search anywhere so I we spent",
    "start": "1870120",
    "end": "1877760"
  },
  {
    "text": "like almost a week or two weeks on searching you know related to this particular project nothing found and",
    "start": "1877760",
    "end": "1884200"
  },
  {
    "text": "even during Cube con we talked to a bunch of people no one actually you know referencing you know whatever",
    "start": "1884200",
    "end": "1890639"
  },
  {
    "text": "the project you're talking about but rather everybody's giving more you know newer ideas so yeah unfortunately I",
    "start": "1890639",
    "end": "1897120"
  },
  {
    "text": "didn't find it um but I'm glad you know it's already there so yeah I think",
    "start": "1897120",
    "end": "1902840"
  },
  {
    "text": "that's uh I we didn't find it during the our research at that time yeah but I mean you can check it out like yeah see",
    "start": "1902840",
    "end": "1909200"
  },
  {
    "text": "so I would definitely talk to you after this um what's the name of it again uh teleport teleport okay all right yeah",
    "start": "1909200",
    "end": "1916679"
  },
  {
    "text": "teleport probably works a little bit different but yeah we can talk about it and see if",
    "start": "1916679",
    "end": "1922320"
  },
  {
    "text": "that's exactly how you know teleport is also doing it thank you um I was curious about the choice to",
    "start": "1922320",
    "end": "1928919"
  },
  {
    "text": "use uh keycloak rather than something like a um identity backend like Google",
    "start": "1928919",
    "end": "1934080"
  },
  {
    "text": "uh for your employees um can you talk through that decision uh sorry one I say one more",
    "start": "1934080",
    "end": "1940360"
  },
  {
    "text": "time please uh you used uh keycloak as your identity back end um and I'm curious because I I assume that you also",
    "start": "1940360",
    "end": "1947440"
  },
  {
    "text": "have some some sort of employee registry uh that already has identity and I was curious about that decision yeah so in",
    "start": "1947440",
    "end": "1955039"
  },
  {
    "text": "our system it's more like you have a centralized SSO system which basically",
    "start": "1955039",
    "end": "1961519"
  },
  {
    "text": "authenticates the user but specific to kubernetes platform we have our own key",
    "start": "1961519",
    "end": "1967480"
  },
  {
    "text": "clock as identity provider so whenever someone um in a platform creates a",
    "start": "1967480",
    "end": "1973080"
  },
  {
    "text": "project or creates a namespace etc we create the groups in our own key clock",
    "start": "1973080",
    "end": "1979600"
  },
  {
    "text": "you know identity provider so anytime user wants to access it user goes",
    "start": "1979600",
    "end": "1984679"
  },
  {
    "text": "through Central SSV and then Federate to the identity provide you know key clock",
    "start": "1984679",
    "end": "1990200"
  },
  {
    "text": "in our case and then key clock basically verifies that and generates ID token and",
    "start": "1990200",
    "end": "1996600"
  },
  {
    "text": "presents it back to us and we use that as a session token moving forward to our own",
    "start": "1996600",
    "end": "2002600"
  },
  {
    "text": "application thank you all right thanks hey hi sir so in terms of um how you",
    "start": "2002600",
    "end": "2010039"
  },
  {
    "text": "deploy the envoy proxy so I know something like keycloak it sounds like if you just have like one Central",
    "start": "2010039",
    "end": "2016000"
  },
  {
    "text": "keycloak that's not really a problem because there's not a whole lot of traffic going back and forth to it so if You' have a developer geolocated",
    "start": "2016000",
    "end": "2022120"
  },
  {
    "text": "somewhere inconvenient to access keycloak it's not really a problem but it sounds like that wouldn't be the case for Envoy necessarily because if your",
    "start": "2022120",
    "end": "2029279"
  },
  {
    "text": "traffic to the API server has to keep being proxy halfway across the world that would be a lot of latency so do you",
    "start": "2029279",
    "end": "2035840"
  },
  {
    "text": "have the envoy proxy like distri Ed across like geolocated or how does that work yeah that's a very valid question",
    "start": "2035840",
    "end": "2043320"
  },
  {
    "text": "so at least based on test so you know majority of the team sits in you know um",
    "start": "2043320",
    "end": "2049760"
  },
  {
    "text": "us but Tik toac is Big we are Global we have lot of developers in Singapore",
    "start": "2049760",
    "end": "2055638"
  },
  {
    "text": "London Etc so far the response time delay is somewhere around less than 10",
    "start": "2055639",
    "end": "2062919"
  },
  {
    "text": "millisecond so it's definitely not impactful in terms of the per performance degradation so far um but",
    "start": "2062919",
    "end": "2070919"
  },
  {
    "text": "eventually if it you know we had some instances where someone complained from Singapore that hey it's taking more than",
    "start": "2070919",
    "end": "2077520"
  },
  {
    "text": "what it used to be but at that time we're going to have to figure out if if we going to have to distribute the on",
    "start": "2077520",
    "end": "2084040"
  },
  {
    "text": "into a different region but at the moment it's it's a you know it's not a big problem but you're right it could be",
    "start": "2084040",
    "end": "2090280"
  },
  {
    "text": "a problem at some point of time thank you no thank",
    "start": "2090280",
    "end": "2094878"
  },
  {
    "text": "you I'm kind of curious if you had a any issues with exd policy maybe you had a",
    "start": "2096040",
    "end": "2102240"
  },
  {
    "text": "lot more that you weren't showing but one of the issues I've seen is if you if",
    "start": "2102240",
    "end": "2107359"
  },
  {
    "text": "you named specific headers to inspect and then you use like the headers to append which it looks like you were uh",
    "start": "2107359",
    "end": "2113160"
  },
  {
    "text": "did you do anything to make sure that were not impersonation headers in the incoming request before uh cuz I think",
    "start": "2113160",
    "end": "2120160"
  },
  {
    "text": "the filter you showed would not have uh actually captured them and they and it",
    "start": "2120160",
    "end": "2125560"
  },
  {
    "text": "gets merged just the problem so incoming request yeah yeah that's where the authorization server we basically look",
    "start": "2125560",
    "end": "2132320"
  },
  {
    "text": "at validate hey nobody is actually including their own you know impersonation headers so if there's",
    "start": "2132320",
    "end": "2138680"
  },
  {
    "text": "anything we nullify everything as part of the authorization server itself before we add the actual valid so even",
    "start": "2138680",
    "end": "2145400"
  },
  {
    "text": "if someone adds it we overwrite it with the the know system impersonate where was that uh implemented Because unless",
    "start": "2145400",
    "end": "2151960"
  },
  {
    "text": "it was more of the policy than you should was that before the exz or is it as part of the authorization ation",
    "start": "2151960",
    "end": "2158000"
  },
  {
    "text": "server it's after HTTP filter configuration where it basically makes a",
    "start": "2158000",
    "end": "2163040"
  },
  {
    "text": "call to authorization server I think the configuration you showed wouldn't capture those headers uh would maybe it",
    "start": "2163040",
    "end": "2170440"
  },
  {
    "text": "does yeah yeah so it's it's very simplified verion yes it's a simplified version but yes you can configure that",
    "start": "2170440",
    "end": "2176920"
  },
  {
    "text": "in Eno itself like hey do not you know accept any of the other headers uh you",
    "start": "2176920",
    "end": "2182160"
  },
  {
    "text": "can you know we have the other headers where course we specifically have to Whit list the headers before even goes",
    "start": "2182160",
    "end": "2188319"
  },
  {
    "text": "to the HTTP filter yeah any and I'll mention for one of the previous people",
    "start": "2188319",
    "end": "2194040"
  },
  {
    "text": "who asked a question I've usedo uh off service a bit more than in a slightly",
    "start": "2194040",
    "end": "2199200"
  },
  {
    "text": "different situation but it's a another Choice with like a l to Pro got it got it thank you got it thank you",
    "start": "2199200",
    "end": "2206560"
  },
  {
    "text": "guys all right",
    "start": "2206560",
    "end": "2210920"
  }
]