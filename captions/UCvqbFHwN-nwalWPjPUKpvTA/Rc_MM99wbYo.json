[
  {
    "start": "0",
    "end": "22000"
  },
  {
    "text": "it's cool and we want to make things even better I'm gonna add a little bit of security the net ops team have said this is great but every service can talk",
    "start": "0",
    "end": "6089"
  },
  {
    "text": "to every service and that shouldn't be necessary so I just want you to turn on the our back system do a bit of do a few",
    "start": "6089",
    "end": "11309"
  },
  {
    "text": "ACLs a bit of service to service security so this is where the demos and",
    "start": "11309",
    "end": "17670"
  },
  {
    "text": "I have to work out on my like so we're",
    "start": "17670",
    "end": "23490"
  },
  {
    "start": "22000",
    "end": "182000"
  },
  {
    "text": "gonna go turn on our back I have another",
    "start": "23490",
    "end": "28920"
  },
  {
    "text": "tea mug session attached on this screen so I think this is gonna work okay so",
    "start": "28920",
    "end": "35450"
  },
  {
    "text": "I'm gonna turn our back on no magic here right we apply a config that says like",
    "start": "35450",
    "end": "41610"
  },
  {
    "text": "there are no like tricks in this demo honestly so we're turning the our back system um my script was designed for a",
    "start": "41610",
    "end": "47520"
  },
  {
    "text": "steel 1.4 it's using a new command that waits for the propagation of resources",
    "start": "47520",
    "end": "52620"
  },
  {
    "text": "across the mesh because the the our back system is a little bit eventually consistent you'll see if I start hitting",
    "start": "52620",
    "end": "57960"
  },
  {
    "text": "f5 that things are gonna stop there we",
    "start": "57960",
    "end": "66330"
  },
  {
    "text": "go so we good we've got a 403 on on the CSS right and the our backs on so the only arrow we saw on the on the terminal",
    "start": "66330",
    "end": "72869"
  },
  {
    "text": "oh you can't say I'm highlighting things on this and it's not coming through but the Evalia character is just at one point it's just a sto CTL command that",
    "start": "72869",
    "end": "79590"
  },
  {
    "text": "relies on a 1.4 sto mesh to watch for this propagation and to sort of let you",
    "start": "79590",
    "end": "85350"
  },
  {
    "text": "block on it but I'm running a 1.3 mesh because there were some other issues but don't worry about that there are no",
    "start": "85350",
    "end": "91140"
  },
  {
    "text": "tricks so everything's blocked great cuz we turn our back on sensible security stance is to block everything by default",
    "start": "91140",
    "end": "97500"
  },
  {
    "text": "so that's exactly what it's done so now I'm going to go and add my rules to allow the are back again this is just",
    "start": "97500",
    "end": "103409"
  },
  {
    "text": "the standard booking for a demo that I'm using here so we're adding three service roles and three service roles bindings",
    "start": "103409",
    "end": "108540"
  },
  {
    "text": "to allow the communication that we want from service a service to open things back up and make the application work",
    "start": "108540",
    "end": "114119"
  },
  {
    "text": "again",
    "start": "114119",
    "end": "116600"
  },
  {
    "text": "and it takes a while and kinda February",
    "start": "119320",
    "end": "125270"
  },
  {
    "text": "members are booking for works we've got the product page micro service gives you this overall view but it calls details",
    "start": "125270",
    "end": "131090"
  },
  {
    "text": "to get the top or the left panel and it calls reviews to get the bottom of the right panel and we can see product page",
    "start": "131090",
    "end": "137000"
  },
  {
    "text": "but we can't see details and reviews it's just erroring out rights product pages is Gotham code that says well if",
    "start": "137000",
    "end": "144590"
  },
  {
    "text": "you can't reach that service show a default value in this case like I'm sorry I can't get you that information we're trying to gracefully degrade but",
    "start": "144590",
    "end": "151280"
  },
  {
    "text": "we're running an integrated State so what's going on why can't we get there and this is this is analogous to the",
    "start": "151280",
    "end": "158959"
  },
  {
    "text": "problem that I had",
    "start": "158959",
    "end": "161709"
  },
  {
    "text": "I've got another meme yeah somebody",
    "start": "169920",
    "end": "176130"
  },
  {
    "text": "somebody posted that in slag like after about three hours of my swearing I was like I'm going on lunch and I came back",
    "start": "176130",
    "end": "181560"
  },
  {
    "text": "to find that so we're in the bad place it ain't working I was gonna run this",
    "start": "181560",
    "end": "189150"
  },
  {
    "start": "182000",
    "end": "270000"
  },
  {
    "text": "like a sort of on-call session I was gonna pretend we had this 30-minute SLO to get things back up and have like a countdown timer in a red light and a",
    "start": "189150",
    "end": "194760"
  },
  {
    "text": "klaxon but you can't take that in hand-luggage so just like I'm gonna keep looking at my watch in my gym we're under imagine",
    "start": "194760",
    "end": "201060"
  },
  {
    "text": "we're under ranch pressure I also said I kind of talked about debugging principles more generally as I say the",
    "start": "201060",
    "end": "207780"
  },
  {
    "text": "time is a bit tight but I know not everybody has a software engineering background or you know people who have",
    "start": "207780",
    "end": "214950"
  },
  {
    "text": "assistants background maybe aren't used to distributed systems like this and if you know this isn't typical software",
    "start": "214950",
    "end": "220980"
  },
  {
    "text": "anyway so I'm gonna try and like a few things about debugging number one is like this this phrase that was told to",
    "start": "220980",
    "end": "229650"
  },
  {
    "text": "me by an old manager that I really liked which is in order to debug something you've got to be able to be observe it and you've got to be able to control it",
    "start": "229650",
    "end": "235590"
  },
  {
    "text": "so that observability right is the ability to sort of work out the internal",
    "start": "235590",
    "end": "242190"
  },
  {
    "text": "state of the system only by looking at it from the outside right so what we know at the moment is we're putting traffic in and we're getting an error",
    "start": "242190",
    "end": "248700"
  },
  {
    "text": "out so we notice we can observe that we know something about it but that's not enough to work out what's going on in",
    "start": "248700",
    "end": "254370"
  },
  {
    "text": "this box so we can actually go fix it so what we're gonna do is we're gonna get some more outputs from this basically we're gonna turn logging up right it's",
    "start": "254370",
    "end": "260669"
  },
  {
    "text": "not rocket science but if you think of it in more abstract sense like I need to see into this system to work out what's",
    "start": "260669",
    "end": "265740"
  },
  {
    "text": "going wrong product page is telling me it's had to degrade what on earth so the",
    "start": "265740",
    "end": "270900"
  },
  {
    "start": "270000",
    "end": "429000"
  },
  {
    "text": "first thing I know you didn't do is this is probably an Arabic problem right it's probably responding to a 403 but hey",
    "start": "270900",
    "end": "277530"
  },
  {
    "text": "maybe the details and review just crashed or something like maybe a sequence and who knows first of all I",
    "start": "277530",
    "end": "282810"
  },
  {
    "text": "want to check that this really is like a 403 an hour back problem so let's just go look at the traffic",
    "start": "282810",
    "end": "290720"
  },
  {
    "text": "so I can and run this command it's a bit of complicated helm wrangling but it basically rewrites the master config map",
    "start": "296000",
    "end": "303000"
  },
  {
    "text": "that this teo uses to look at everything so it config my flashes do and we're turning on access logs in envoy we're",
    "start": "303000",
    "end": "308910"
  },
  {
    "text": "riding some config that gets propagated through a complicated series of mechanisms to the Envoy like ours and tells them to just start dumping the",
    "start": "308910",
    "end": "315120"
  },
  {
    "text": "access logs because they they don't normally write at a thousand QPS that's gonna be super noisy so it's turned off",
    "start": "315120",
    "end": "320460"
  },
  {
    "text": "by default so we turn that on and we sort of let it think about it for a bit and then we can go get the logs so these",
    "start": "320460",
    "end": "327300"
  },
  {
    "text": "are the logs for the I want to focus on its details so product page calls details and reviews I'm going to we're",
    "start": "327300",
    "end": "333539"
  },
  {
    "text": "just going to look at details that top service for the for the whole thing because it's it's not giving product",
    "start": "333539",
    "end": "338550"
  },
  {
    "text": "page what it wants so we'll just dive into details so we've got a bunch of noise in here again no tricks like",
    "start": "338550",
    "end": "345750"
  },
  {
    "text": "there's nothing really sitting there but if I start generating some traffic there",
    "start": "345750",
    "end": "352099"
  },
  {
    "text": "we go there's an access log a lot of these systems are you know they they log",
    "start": "352280",
    "end": "357509"
  },
  {
    "text": "on a background thread they get off the hot path they these butter things on a background thread they batch them a lot of these systems",
    "start": "357509",
    "end": "364110"
  },
  {
    "text": "is going to be very high performance and very latency aware which means that actually getting the logs out involved",
    "start": "364110",
    "end": "369630"
  },
  {
    "text": "often involves me just pressing f5 a lot of waiting right to fill a buffer or something but as you can see you can",
    "start": "369630",
    "end": "375719"
  },
  {
    "text": "kind of read this if you've ever seen nginx access log there's there's a 403 in there so this is this is the envoy",
    "start": "375719",
    "end": "380820"
  },
  {
    "text": "side carboy details saying yep I saw your request but no you asked a bid it go away",
    "start": "380820",
    "end": "386090"
  },
  {
    "text": "debugging tool number one you can turn on envoy access logs and you can just read the logs of the sidecar container",
    "start": "386090",
    "end": "392219"
  },
  {
    "text": "in that pod and you can get them that's a bit hard to read I think this is some",
    "start": "392219",
    "end": "397259"
  },
  {
    "text": "like text format it's not a structured log it doesn't have any field annotations I do actually have a picture",
    "start": "397259",
    "end": "404659"
  },
  {
    "text": "somebody on the internet helpfully put this together I mean he's pretty fairly",
    "start": "404659",
    "end": "410849"
  },
  {
    "text": "helpful right I mean oh girl I'd the production values are fairly high so so we can see the I didn't draw it like I",
    "start": "410849",
    "end": "417449"
  },
  {
    "text": "got joy that well but the response code should be at 200 it's a 4 a 3 right we've got a problem",
    "start": "417449",
    "end": "424070"
  },
  {
    "text": "first tool on God",
    "start": "428949",
    "end": "433269"
  },
  {
    "start": "429000",
    "end": "504000"
  },
  {
    "text": "there is little tool it's called on guard and it's basically an envoy access log parser so you cut the command squad",
    "start": "441180",
    "end": "447850"
  },
  {
    "text": "off the top I can probably go find it [Music]",
    "start": "447850",
    "end": "454439"
  },
  {
    "text": "yeah so keep CTR logs the details polled the history of proxies sidecar and then",
    "start": "455580",
    "end": "460660"
  },
  {
    "text": "pipe to pipe to this on guard thing so on God basically passes it and dumps out",
    "start": "460660",
    "end": "466600"
  },
  {
    "text": "Jason and then I'm piping that into Jake Jake you to get some nice to get some nice pretty printing obviously because",
    "start": "466600",
    "end": "472210"
  },
  {
    "text": "it's JQ you can you can query this thing you can extract certain fields you can take aggregates blah blah blah anything",
    "start": "472210",
    "end": "477670"
  },
  {
    "text": "you can do now you've got this structure Jason and we've got a schema for it because we know all the fields that are in an envoy access log so they're again",
    "start": "477670",
    "end": "483580"
  },
  {
    "text": "same same information but with more colors status code for a3 so okay what",
    "start": "483580",
    "end": "493930"
  },
  {
    "text": "next I'm gonna do the same thing but I'm",
    "start": "493930",
    "end": "500260"
  },
  {
    "text": "going to do it more gratuitously cause I want to show you another another cool tool that's so cool told is called",
    "start": "500260",
    "end": "505600"
  },
  {
    "text": "casein it so this it's not quite the same thing that was an access log let's",
    "start": "505600",
    "end": "511960"
  },
  {
    "text": "really dig into own voice saying 403 I mean there's a slight possibility that details has started to respond with a",
    "start": "511960",
    "end": "517510"
  },
  {
    "text": "403 itself and on voice just forwarding it right I mean it's unlikely but it could be a thing and there's a bunch of",
    "start": "517510",
    "end": "524080"
  },
  {
    "text": "other reasons you might wanna do you might want to actually look inside the whole property so remember a pod is a",
    "start": "524080",
    "end": "529900"
  },
  {
    "text": "order containers share in network namespace of this sort of one set of routes and iptables rules in there all",
    "start": "529900",
    "end": "535600"
  },
  {
    "text": "the traffic flies around freely between all the different containers so if only we could tap into that it would like if this were a Linux machine in the 90s I'd",
    "start": "535600",
    "end": "542110"
  },
  {
    "text": "shut into it and I'd run TCP dump right to find out what's really going on turns out you can do that there's a tool",
    "start": "542110",
    "end": "547450"
  },
  {
    "text": "called pay sniff which is a cube CTL plugin so things get a little bit interesting because you use crew which",
    "start": "547450",
    "end": "554380"
  },
  {
    "text": "is the cube CTL package manager which is itself a cube CTL plugin so install the QC TR plug-in court case NIT which does",
    "start": "554380",
    "end": "561040"
  },
  {
    "text": "a whole bunch of just come up on the wrong screen basically it shells",
    "start": "561040",
    "end": "570280"
  },
  {
    "text": "into your sidecar it runs TCP dump it sets up a port for words and it the pcap output a TCP dump into",
    "start": "570280",
    "end": "577500"
  },
  {
    "text": "Wireshark on your local machine so this is a live traffic capture of everything",
    "start": "577500",
    "end": "583990"
  },
  {
    "text": "that's going through that pod I can't see it so I'm gonna have to bring it back and I'll point out things like",
    "start": "583990",
    "end": "592259"
  },
  {
    "text": "right something is getting slashed at slash Prometheus right so fine thing scraping the Prometheus endpoint is",
    "start": "593459",
    "end": "598509"
  },
  {
    "text": "getting a 200 fantastic all the traffic going through the pod I can apply a",
    "start": "598509",
    "end": "608649"
  },
  {
    "text": "filter generate some more traffic and",
    "start": "608649",
    "end": "617139"
  },
  {
    "text": "there we go I won't dig into that it's",
    "start": "617139",
    "end": "622360"
  },
  {
    "text": "honestly it's too hard but those are your four threes and you can dig it off see and get all the layer two layer three layer seven information",
    "start": "622360",
    "end": "628060"
  },
  {
    "text": "your full Wireshark you can write these very expressive filters you can do all kinds of stuff it's super cool it's saw",
    "start": "628060",
    "end": "633699"
  },
  {
    "text": "this slightly shinier version of what we did before but it's awesome so I wanted to show you it",
    "start": "633699",
    "end": "640170"
  },
  {
    "text": "I am gonna start swearing honestly right",
    "start": "646730",
    "end": "653690"
  },
  {
    "text": "um so it's all messed up we're getting for our trees what the hell do I",
    "start": "653690",
    "end": "660440"
  },
  {
    "text": "understand need to find out why so what about the controllability side of this",
    "start": "660440",
    "end": "665960"
  },
  {
    "start": "663000",
    "end": "680000"
  },
  {
    "text": "thing right can we go into the system and effect what it does because we want to start running experiments like we kind of know what's wrong we want to",
    "start": "665960",
    "end": "672350"
  },
  {
    "text": "start tweaking dials we want to see if we can control it and get it closer to the right thing or if we can break it in a different way or whatever so it's a",
    "start": "672350",
    "end": "682820"
  },
  {
    "start": "680000",
    "end": "885000"
  },
  {
    "text": "403 we think its own voicing it not the app it's a reasonable hypothesis to",
    "start": "682820",
    "end": "689720"
  },
  {
    "text": "think that that was because we just turned our back on right and it's starting to deny a traffic so what could",
    "start": "689720",
    "end": "696140"
  },
  {
    "text": "we do to test that well we can turn our back back off and see if it works it sounds stupid but that's basically what we're going to do you can actually do a",
    "start": "696140",
    "end": "702380"
  },
  {
    "text": "little bit better there's a permissive our back mode so it's like a scene in expressive mode if anybody's seen that",
    "start": "702380",
    "end": "707390"
  },
  {
    "text": "we can basically say to the our back system I want you to still look at the traffic still ingest all the rules still",
    "start": "707390",
    "end": "712910"
  },
  {
    "text": "understand the rules but not enforce them so I want you to log what you would have done and why but don't actually",
    "start": "712910",
    "end": "718220"
  },
  {
    "text": "enforce them so that'll kind of kill two birds with one stone but I've I can",
    "start": "718220",
    "end": "730130"
  },
  {
    "text": "spend missive with some logging again there's there's a bunch of esoteric config for this the book info sample",
    "start": "730130",
    "end": "737000"
  },
  {
    "text": "even comes to and this is why I'm using booking photo cuz I had to work all this out myself the book info sample comes with a couple",
    "start": "737000",
    "end": "742940"
  },
  {
    "text": "Yama's ones one that puts our back into permissive mode and one that turns on all of the like permissive modal logging",
    "start": "742940",
    "end": "749530"
  },
  {
    "text": "having turned it on we can read it this",
    "start": "749530",
    "end": "756950"
  },
  {
    "text": "is where you sit there and I press f5 because mixer like aggressively batches",
    "start": "756950",
    "end": "762160"
  },
  {
    "text": "so you can see it started to work again right traffic's come through so pretty much 99.9 percent that was an hour back",
    "start": "762160",
    "end": "768590"
  },
  {
    "text": "issue traffic's going through again but we're now in permissive mode so if we can finally fill that buffer there we go",
    "start": "768590",
    "end": "776690"
  },
  {
    "text": "and it will come through at once because we're in a big batch I've added some highlight so these are mix along STIs are",
    "start": "776690",
    "end": "781819"
  },
  {
    "text": "structured these are these are Jason so at a warning level we've got it says well any response code is 200",
    "start": "781819",
    "end": "787040"
  },
  {
    "text": "but the permissive response code as in what I would have done is is denied so this absolutely is an are back deny",
    "start": "787040",
    "end": "793879"
  },
  {
    "text": "coming from the site car but this is about that that kind of controllability",
    "start": "793879",
    "end": "801620"
  },
  {
    "text": "right I can take the our bike IQ I think it's the R max this time I could turn it on I can turn it off I can put it into a into a verbose mode our back decisions",
    "start": "801620",
    "end": "809089"
  },
  {
    "text": "are enforced at well our back policy is enforceable sidecar but the decision is",
    "start": "809089",
    "end": "814430"
  },
  {
    "text": "ultimately made by by mixer currently for anybody who kind of knows the sto architecture so it's the history of POD",
    "start": "814430",
    "end": "820819"
  },
  {
    "text": "logs that we go and look at",
    "start": "820819",
    "end": "823870"
  },
  {
    "text": "I turn just asked me if I won our grade because you should never do live demos",
    "start": "828920",
    "end": "834520"
  },
  {
    "text": "right so this is reminder because I always forgot to do this in the run-through I need to turn the hour",
    "start": "836440",
    "end": "842210"
  },
  {
    "text": "back back on so I need to actually make it fail again if we can carry on debugging but this is this is under the broader spectrum of only change one",
    "start": "842210",
    "end": "849200"
  },
  {
    "text": "thing at a time right this is the scientific method really you know you change where you have a hypothesis you change one variable you go and see what",
    "start": "849200",
    "end": "854690"
  },
  {
    "text": "it's what it's kind of done so I thought I only change one thing when I turned our back on and everything stopped",
    "start": "854690",
    "end": "860240"
  },
  {
    "text": "working so it was a reasonable reasonable hypothesis that it was our back that did it we've now definitely only changed one",
    "start": "860240",
    "end": "865730"
  },
  {
    "text": "thinks I'm like right I'm in debugging mode let's just turn our bike off and not touch anything else oh yeah that fixed it right so what we will do is",
    "start": "865730",
    "end": "874730"
  },
  {
    "text": "just go and turn our back I'm just gonna use that original script and just dump the are back on config over the top so",
    "start": "874730",
    "end": "886400"
  },
  {
    "start": "885000",
    "end": "1171000"
  },
  {
    "text": "it's our back let's look at how that subsystem works right we need a mental",
    "start": "886400",
    "end": "893270"
  },
  {
    "text": "model for this system and we just need to follow it through logically so Howard is the our back system work while well",
    "start": "893270",
    "end": "899450"
  },
  {
    "text": "from what I know of sto know there's some rules we apply the rules pilot reads them pilot sort of interprets them",
    "start": "899450",
    "end": "905780"
  },
  {
    "text": "and compiles them into own void config pilot pushes that config to envoy the envoys receive it and ingest it and",
    "start": "905780",
    "end": "911420"
  },
  {
    "text": "understand it and then they enforce it something's going wrong at that stage because I have given Envoy instructions",
    "start": "911420",
    "end": "917300"
  },
  {
    "text": "to let this traffic through Envoy is not doing that so one of these stages has gone wrong that's what I should have joined a picture of it but that's my my",
    "start": "917300",
    "end": "923750"
  },
  {
    "text": "mental model of my pipeline left to right so we can start at a left and we can just go check each one of these components",
    "start": "923750",
    "end": "929350"
  },
  {
    "text": "that's exactly",
    "start": "929350",
    "end": "932829"
  },
  {
    "text": "so the first thing we can do there is a another magic sto debugging command to learn there all of the control plan",
    "start": "944400",
    "end": "951960"
  },
  {
    "text": "components are built friend like the same micro-services library they all listen at supply that makes a citadel I",
    "start": "951960",
    "end": "957360"
  },
  {
    "text": "think and gali they all have a web admin import they all have this Hyneman port",
    "start": "957360",
    "end": "962670"
  },
  {
    "text": "where they expose away that main interface see you can configure them obviously would come online are given syn config files but they have they have",
    "start": "962670",
    "end": "969420"
  },
  {
    "text": "an online admin interface as well sto CTL dashboard is a nice shortcut that",
    "start": "969420",
    "end": "974910"
  },
  {
    "text": "basically sets up a port forward to that admin port right so it's all kind of nice and easy to be operational remember you're probably gonna be doing this at 3",
    "start": "974910",
    "end": "980970"
  },
  {
    "text": "a.m. right so these are just tools there's no this there's automation really rather than abstraction but all",
    "start": "980970",
    "end": "986370"
  },
  {
    "text": "this is doing is setting up a a port forward to the AB important so we've got the pilot admin port it's a fairly nice",
    "start": "986370",
    "end": "993420"
  },
  {
    "text": "web interface like it even updates in real time and there I can't see it but",
    "start": "993420",
    "end": "999300"
  },
  {
    "text": "there's a bunch of stuff we can do bunch of stuff we can read and I think it's",
    "start": "999300",
    "end": "1004310"
  },
  {
    "text": "that one one of the things I can do is turn logging levels up in various places",
    "start": "1004310",
    "end": "1010190"
  },
  {
    "text": "and I want our back so I could change",
    "start": "1010190",
    "end": "1018410"
  },
  {
    "text": "that from info to debug it's very web 2.0 there isn't even a Save button so that's that's done now so I've now",
    "start": "1018410",
    "end": "1025069"
  },
  {
    "text": "turned the are back logging off because I know that I'm ingesting my are back and fig and it's trying to compile it and it's it's going wrong so let's let's",
    "start": "1025069",
    "end": "1030980"
  },
  {
    "text": "look at what it's thinking when it does that so what I'll do is just to kick the",
    "start": "1030980",
    "end": "1039050"
  },
  {
    "text": "compiler I'll remove those are back rules are the ones that say allow the traffic and I'll kind of weigh a bit",
    "start": "1039050",
    "end": "1044290"
  },
  {
    "text": "then up at the back now that the logging is turned up",
    "start": "1044290",
    "end": "1049959"
  },
  {
    "text": "and then we can dump the pilot logs and again I put a little bit of great magic",
    "start": "1052350",
    "end": "1057400"
  },
  {
    "text": "in there so you can see listener discovery service so this is the thing that sets up the front end of envoy and",
    "start": "1057400",
    "end": "1063730"
  },
  {
    "text": "tells it to listen he's indeed pushing some config to the side carboy details",
    "start": "1063730",
    "end": "1070830"
  },
  {
    "text": "and that's not the problem I don't mean just go that way I'm surprised that's",
    "start": "1073560",
    "end": "1078730"
  },
  {
    "text": "all the logs we've got that's let's do it again",
    "start": "1078730",
    "end": "1085680"
  },
  {
    "text": "oh there we go that is more like it",
    "start": "1092210",
    "end": "1095890"
  },
  {
    "text": "okay we might not get exactly what we're looking for cause it's a little bit oh no there we go so the are back",
    "start": "1099110",
    "end": "1105860"
  },
  {
    "text": "subsystem says right I'm gonna go I'm compiling all your are back walls I'm",
    "start": "1105860",
    "end": "1111590"
  },
  {
    "text": "going to go build a policy this is this is for details so I'm going to check the",
    "start": "1111590",
    "end": "1117440"
  },
  {
    "text": "the service role called ratings viewer so that's the one that gives you permission to view ratings and details",
    "start": "1117440",
    "end": "1123159"
  },
  {
    "text": "and oh yes I've added something to the Envoy policy for that the Envoy our back",
    "start": "1123159",
    "end": "1128870"
  },
  {
    "text": "policy because this ratings viewer sto policy had something to say about it so we've definitely picked up the sto",
    "start": "1128870",
    "end": "1135470"
  },
  {
    "text": "config that we want and we've added it to this other this Envoy our back that we're building and then it looks at the one that lets you view product page and",
    "start": "1135470",
    "end": "1141500"
  },
  {
    "text": "says well that's not relevant to this details sidecar and then you know skips it but eventually we build the HTTP",
    "start": "1141500",
    "end": "1147590"
  },
  {
    "text": "listener and these are all multiplex so that we can't really see the though you know push the details on this page but",
    "start": "1147590",
    "end": "1153320"
  },
  {
    "text": "but that's how it's working so we can reason about this kind of compilation process for these are back rules so that",
    "start": "1153320",
    "end": "1161000"
  },
  {
    "text": "seems to be working",
    "start": "1161000",
    "end": "1163929"
  },
  {
    "start": "1171000",
    "end": "1410000"
  },
  {
    "text": "so let's go further down that pipeline right we've started with something seems to be working let's follow it through",
    "start": "1171370",
    "end": "1177270"
  },
  {
    "text": "and I'm going to speed up a bit but I think I'm doing that kind of okay so",
    "start": "1177270",
    "end": "1183750"
  },
  {
    "text": "proxy status STR CTL proxy status very useful command did pilot managed to push",
    "start": "1187500",
    "end": "1193600"
  },
  {
    "text": "and sync the config into all of these pots it says yes it did for therefore they're sidecar on details which is the",
    "start": "1193600",
    "end": "1199090"
  },
  {
    "text": "top of the list cluster discovery service which is basically but the back ends the things you might want to talk",
    "start": "1199090",
    "end": "1205120"
  },
  {
    "text": "to listener discovery which is for like thing on the front end end point which is also backend stuff anyway all of the",
    "start": "1205120",
    "end": "1211120"
  },
  {
    "text": "different in all the different parts of the Envoy config service the only one config space are all synchronized so",
    "start": "1211120",
    "end": "1216580"
  },
  {
    "text": "okay we built a policy that we assume is correct we pushed it to the envoys what",
    "start": "1216580",
    "end": "1224440"
  },
  {
    "text": "we do next well let's look at envoy envoy also has its own web interface it's more web 1.0 to be honest it's a",
    "start": "1224440",
    "end": "1232390"
  },
  {
    "text": "bunch of links there just to get requests but it is there and again there's this TOC TL dashboard command",
    "start": "1232390",
    "end": "1238450"
  },
  {
    "text": "that will that will open it up for you I won't show you around this because we're",
    "start": "1238450",
    "end": "1243910"
  },
  {
    "text": "running a bit short on time if you ever want to know how complicated Envoy is press the config Dom button and like count the liens honestly count the lines",
    "start": "1243910",
    "end": "1251970"
  },
  {
    "text": "but because it's a bit dumb unfortunately to turn to turn the logging up you have to do a post request and you can't do a post through this web",
    "start": "1251970",
    "end": "1258040"
  },
  {
    "text": "interface so we actually have to close it and then kill that poor forwards and",
    "start": "1258040",
    "end": "1270070"
  },
  {
    "text": "actually just do a set up the port for with ourselves we have to we have to based exactly and use curl we have to",
    "start": "1270070",
    "end": "1275830"
  },
  {
    "text": "hit that endpoint ourselves we have to do a post which we can't do with a browser very easily and the the output",
    "start": "1275830",
    "end": "1280960"
  },
  {
    "text": "the body that it respond that returns in response to that post is the current state of all the debug or the tracing",
    "start": "1280960",
    "end": "1287410"
  },
  {
    "text": "areas including you can see it though if you can find it just below pool just above Redis our Mac is now on debug",
    "start": "1287410",
    "end": "1292630"
  },
  {
    "text": "everything else is warning which means",
    "start": "1292630",
    "end": "1297640"
  },
  {
    "text": "again I can read them with a nice sto CTL sorry keep CTR logs come on for that",
    "start": "1297640",
    "end": "1304150"
  },
  {
    "text": "details like our you can see all the stuff it was printing a warning level before the access logs that we were talking around but now if I generate",
    "start": "1304150",
    "end": "1310720"
  },
  {
    "text": "some more traffic it should be really verbose about what it's doing with our back",
    "start": "1310720",
    "end": "1317670"
  },
  {
    "text": "it's easy to read on my screen so all that comes in request comes in you know",
    "start": "1319040",
    "end": "1325320"
  },
  {
    "text": "path is details zero the details of the zeros book your standard HTTP headers so",
    "start": "1325320",
    "end": "1330420"
  },
  {
    "text": "this is the set of metadata that envoy has about this request and you can make policy decisions based on any of that",
    "start": "1330420",
    "end": "1336320"
  },
  {
    "text": "right what we're looking at is there's the service that's calling it so we're not blocking things based on user agent",
    "start": "1336320",
    "end": "1342480"
  },
  {
    "text": "we're not blocking things based on port but blocking things based on who's trying to talk to you because this is service to service ACLs right we're",
    "start": "1342480",
    "end": "1348300"
  },
  {
    "text": "saying that product page can actually make any request to me but it's only product page that's allowed to talk to",
    "start": "1348300",
    "end": "1353640"
  },
  {
    "text": "me so you can see the one of the the",
    "start": "1353640",
    "end": "1358830"
  },
  {
    "text": "metadata includes all the HTTP headers it also includes a few pieces of dynamic metadata a few things that aren't from",
    "start": "1358830",
    "end": "1365280"
  },
  {
    "text": "the request that have been like injected by the environment so he still has a bunch of plumbing to give it more information about the request one of",
    "start": "1365280",
    "end": "1372000"
  },
  {
    "text": "those things is it's Joe or them as in authentication the the name so we have",
    "start": "1372000",
    "end": "1377700"
  },
  {
    "text": "this key issue or thing who's talking to me but the value is empty and then it says enforce denied so that's a bit",
    "start": "1377700",
    "end": "1385620"
  },
  {
    "text": "weird right how do we know that it's product page talking to us this this seems like the kind of information we",
    "start": "1385620",
    "end": "1390750"
  },
  {
    "text": "should have to handle because we know if we'd had time to open the service role binding we know that we've said well its",
    "start": "1390750",
    "end": "1396060"
  },
  {
    "text": "product page that can talk to me so there we go enforce denied and then the access log for three",
    "start": "1396060",
    "end": "1403550"
  },
  {
    "start": "1410000",
    "end": "1743000"
  },
  {
    "text": "get one last piece of debugging advice guess and check right you have a mental model all bottles are wrong some models",
    "start": "1411950",
    "end": "1419279"
  },
  {
    "text": "are useful take a plausible hypothesis right that fits within that model and this is a creative step this is why",
    "start": "1419279",
    "end": "1424649"
  },
  {
    "text": "debugging is it's draining and you can't estimate how long it's going to take but you take a you take a creative step to a",
    "start": "1424649",
    "end": "1430230"
  },
  {
    "text": "plausible hypothesis that makes sense in that model you design an experiment that's going to check that and check",
    "start": "1430230",
    "end": "1435450"
  },
  {
    "text": "only that and ideally your experiment wants to only change one thing about the system at a time right in standard scientific method stuff it gets super",
    "start": "1435450",
    "end": "1443159"
  },
  {
    "text": "hard when your model is wrong right or when you have to run multiple experiments you have to change multiple",
    "start": "1443159",
    "end": "1449039"
  },
  {
    "text": "things and you're trying to infer one aren't so like it can get super super hard but guessing and checking in general is it's a good idea so we don't",
    "start": "1449039",
    "end": "1456690"
  },
  {
    "text": "have this user account we don't have this like name for who's trying to call",
    "start": "1456690",
    "end": "1462659"
  },
  {
    "text": "me well where's that going to come from if you think about how you bind a service role you give it a certainly you give it a service account name it's not",
    "start": "1462659",
    "end": "1469169"
  },
  {
    "text": "the the name of the calling service or pod cuz you can't really do that the only select strong identity you can",
    "start": "1469169",
    "end": "1474990"
  },
  {
    "text": "trust is the service account token because the product page pod has the product page service account token on",
    "start": "1474990",
    "end": "1480450"
  },
  {
    "text": "the file system so it's envoy can lift that off the file system send it across the wire and this thing is cryptographically signed you",
    "start": "1480450",
    "end": "1486450"
  },
  {
    "text": "know you can send that off to the kubernetes api server and say hey does this job check out is this signed in the correct way can I trust the claims of",
    "start": "1486450",
    "end": "1493769"
  },
  {
    "text": "identity that in it so we seem to be missing that I found a word this next",
    "start": "1493769",
    "end": "1499830"
  },
  {
    "text": "because if I say too much I'll give it away and I want a big reveal cuz we like a big reveal but you know",
    "start": "1499830",
    "end": "1508830"
  },
  {
    "text": "maybe it's something to do with the way to services talk to each other what's on the wire well let's check let's analyze",
    "start": "1508830",
    "end": "1515249"
  },
  {
    "text": "that config mysterious ETL experimental analyze - k-means go look in the cluster you can point it at a bunch of gamal",
    "start": "1515249",
    "end": "1520980"
  },
  {
    "text": "it'll check whether it's consistent this reads everything out of the cluster no validation error is found",
    "start": "1520980",
    "end": "1526519"
  },
  {
    "text": "let's say debugging gets really hard when your model your tools are wrong this tool is wrong it's told it's",
    "start": "1526519",
    "end": "1532590"
  },
  {
    "text": "experimental I'm wrong it's not wrong it's just not completely right it's not lying",
    "start": "1532590",
    "end": "1541270"
  },
  {
    "text": "anyway it so so let's look at the",
    "start": "1541270",
    "end": "1547490"
  },
  {
    "text": "two sides it's the product page pod it's calling the details service so east your",
    "start": "1547490",
    "end": "1553220"
  },
  {
    "text": "CTL experimental describe the product page pod while okay it listens on port 90 80 and then out the back it's",
    "start": "1553220",
    "end": "1563020"
  },
  {
    "text": "actually that doesn't really tell us anything useful at all but the detailed service listens on ninety eighty HTTP",
    "start": "1563020",
    "end": "1569150"
  },
  {
    "text": "it's permissive insofar as it'll accept HTTP RM TLS and the clients will speak",
    "start": "1569150",
    "end": "1574220"
  },
  {
    "text": "to it over HTTP and though and it's found that our back policy there is an our back policy that applies that's that",
    "start": "1574220",
    "end": "1580550"
  },
  {
    "text": "reviews viewer that we saw being compiled so like hmm clients talk HTTP",
    "start": "1580550",
    "end": "1592660"
  },
  {
    "text": "so details is a server that will accept NLCS or HTTP and its clients are talking",
    "start": "1592660",
    "end": "1598940"
  },
  {
    "text": "HTTP so M TLS is turned off in this cluster there's secretly fix things find",
    "start": "1598940",
    "end": "1611930"
  },
  {
    "text": "a mouse pointer said that wait timing works look",
    "start": "1611930",
    "end": "1618340"
  },
  {
    "text": "I turned ng alehsalaam because the way",
    "start": "1620160",
    "end": "1627300"
  },
  {
    "text": "it gets that identity is it fix the service counter I can hop off the file system and it uses it as the common name",
    "start": "1627300",
    "end": "1633240"
  },
  {
    "text": "for the MTS certificate that it presents that's the only thing you can really",
    "start": "1633240",
    "end": "1638280"
  },
  {
    "text": "trust you can't just look at the source IP because that can be spoofed there's no way to get the name so you don't know",
    "start": "1638280",
    "end": "1643500"
  },
  {
    "text": "which pods talking to you there are there's an EM TLS certificate on every side and the the identity of that the",
    "start": "1643500",
    "end": "1649350"
  },
  {
    "text": "common name is the name of the pod and that is verified by the sto agent you know taking that service account token",
    "start": "1649350",
    "end": "1655590"
  },
  {
    "text": "talking to the the sto control plane to Citadel and saying right I have this if",
    "start": "1655590",
    "end": "1660930"
  },
  {
    "text": "you trust that this really is the identity of my pod can you please meet me a TLS certificate that's got that name in the CN and then those things are",
    "start": "1660930",
    "end": "1668130"
  },
  {
    "text": "used for NLCS so it not only gives you encryption on the wire it gives you a strong claim of identity on both sides but it's tied all the way back to the",
    "start": "1668130",
    "end": "1674700"
  },
  {
    "text": "workload and its identity which is the kubernetes service account so what we were doing was comparing as we saw",
    "start": "1674700",
    "end": "1681780"
  },
  {
    "text": "comparing an empty string against product page because there's no MCLs so",
    "start": "1681780",
    "end": "1686970"
  },
  {
    "text": "there's no common name on the wire and that is I basically misconfigured listed I put it into a configuration state",
    "start": "1686970",
    "end": "1692850"
  },
  {
    "text": "that's inconsistent and therefore it was trying to enforce our back and it was just failing safe and saying well",
    "start": "1692850",
    "end": "1697980"
  },
  {
    "text": "there'd be these names didn't match denied so now it's working and we can go back and look at",
    "start": "1697980",
    "end": "1705110"
  },
  {
    "text": "so it's your war then suddenly a bunch of values in there right it's not empty we've got an author couple of source",
    "start": "1720549",
    "end": "1726830"
  },
  {
    "text": "principles authentication principle cluster that local default namespace product page service account imagine Lee",
    "start": "1726830",
    "end": "1733759"
  },
  {
    "text": "it works so now that was the problem",
    "start": "1733759",
    "end": "1737559"
  },
  {
    "start": "1743000",
    "end": "1850000"
  },
  {
    "text": "like why do it like why why are we allowed to get into this seemingly inconsistent state well you can actually",
    "start": "1743350",
    "end": "1749539"
  },
  {
    "text": "enforce policy based on end-user identity you can enforce policy just based on other metadata like the port or",
    "start": "1749539",
    "end": "1754700"
  },
  {
    "text": "the user agent or something so it is",
    "start": "1754700",
    "end": "1760039"
  },
  {
    "text": "okay to try to enforce are back with em TLS turned off but if you want to look at if you actually want to do by far the",
    "start": "1760039",
    "end": "1765320"
  },
  {
    "text": "most common case which is service to service or then you're gonna need any less on to get that identity across the wire fine so and it's not the great",
    "start": "1765320",
    "end": "1772789"
  },
  {
    "text": "Diskin fixed service ever but they doing that it's just as flexible as it can be it doesn't allow you to do those other things as I say yo it's doing CTL",
    "start": "1772789",
    "end": "1780080"
  },
  {
    "text": "analyze says well there's nothing wrong with your config and besides service role and service role binding are a little bit clunky to work with and",
    "start": "1780080",
    "end": "1787369"
  },
  {
    "text": "they're going in 1.6 anyway they've been replaced by by authorization policy so that was it I just lost a day to it but",
    "start": "1787369",
    "end": "1793519"
  },
  {
    "text": "I went through that whole set of tools of turning lonely like learning where all the logs are learning how to turn",
    "start": "1793519",
    "end": "1799460"
  },
  {
    "text": "them up those two web interface dashboards and all of the super cool traffic dumping stuff so hopefully that",
    "start": "1799460",
    "end": "1806210"
  },
  {
    "text": "was interesting one more debugging tip",
    "start": "1806210",
    "end": "1812479"
  },
  {
    "text": "is basically not panic I just have a klaxon but I mean seriously stress",
    "start": "1812479",
    "end": "1817639"
  },
  {
    "text": "doesn't help shortcuts don't help you've got to be methodical you've got to be scientific like you don't speed yourself up by panicking you don't speed your",
    "start": "1817639",
    "end": "1823999"
  },
  {
    "text": "team up by shouting at them you speed it up by reducing cognitive load like having those scripts that I used those",
    "start": "1823999",
    "end": "1830029"
  },
  {
    "text": "should be scripts that you have or they should be in your wrong book so you can copy/paste them and you can reduce typing time in error by just having that",
    "start": "1830029",
    "end": "1836119"
  },
  {
    "text": "like don't abstract things to oblivion and just automate them Keep Calm have ROM books have practiced",
    "start": "1836119",
    "end": "1842109"
  },
  {
    "text": "and use shiny tools Thanks [Applause]",
    "start": "1842109",
    "end": "1852460"
  }
]