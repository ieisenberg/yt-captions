[
  {
    "start": "0",
    "end": "45000"
  },
  {
    "text": "we're ready right good morning everyone thanks very much for coming so I'm here",
    "start": "210",
    "end": "6870"
  },
  {
    "text": "money and I've got Dave Shepard with me today so we posed platform engineer at",
    "start": "6870",
    "end": "12179"
  },
  {
    "text": "once wizard today we here to talk to you about how we use this to your traffic",
    "start": "12179",
    "end": "17190"
  },
  {
    "text": "management into our release pipeline so we'll go through a bit of a background",
    "start": "17190",
    "end": "22230"
  },
  {
    "text": "of who we are what what we do we look at the problem we were facing a little bit",
    "start": "22230",
    "end": "28560"
  },
  {
    "text": "less than a year ago with our release pipeline the solution we came with some",
    "start": "28560",
    "end": "33690"
  },
  {
    "text": "of the tools we wrote to support that solution and the gains and the pains of going through the process of introducing",
    "start": "33690",
    "end": "40379"
  },
  {
    "text": "this deal and a quick summary at the end and hopefully some questions as well so",
    "start": "40379",
    "end": "46500"
  },
  {
    "text": "we are once with it we are little FinTech in Leamington Spa in the centre",
    "start": "46500",
    "end": "51539"
  },
  {
    "text": "of England in the UK we are regulating robe advises robe advice just means that",
    "start": "51539",
    "end": "58050"
  },
  {
    "text": "we use technology an algorithm to automate the generation of financial",
    "start": "58050",
    "end": "63270"
  },
  {
    "text": "advice we focus primarily on on pensions and retirement advice we also have some",
    "start": "63270",
    "end": "69439"
  },
  {
    "text": "financial well-being products available direct to consumer or through employee benefits our vision is financial advice",
    "start": "69439",
    "end": "77430"
  },
  {
    "text": "for everyone we want to make it affordable and accessible to everyone",
    "start": "77430",
    "end": "82759"
  },
  {
    "text": "we're not just an engineering company we do have practicing financial advisers",
    "start": "82759",
    "end": "88579"
  },
  {
    "text": "the AdWords wizard as well which helped greatly when we when we come to write our product a key element is that we are",
    "start": "88579",
    "end": "97409"
  },
  {
    "text": "FCA regulated FCA is the financial conduct authority that's the UK body",
    "start": "97409",
    "end": "103259"
  },
  {
    "text": "that controls everything related to financial services so it means that we are in a regulated industry it means",
    "start": "103259",
    "end": "109530"
  },
  {
    "text": "that there's a lot of rules and regulation and we need to make sure that we give accurate advice and we need to",
    "start": "109530",
    "end": "115200"
  },
  {
    "text": "make sure that we follow the rules and we'll see a bit later how this has impacted us we use the micro services",
    "start": "115200",
    "end": "123899"
  },
  {
    "text": "architecture we've got a of services we deploy them for multiple",
    "start": "123899",
    "end": "130740"
  },
  {
    "text": "tenants so it does mean that sometimes some services are duplicated in between those tenants we also have a common",
    "start": "130740",
    "end": "137460"
  },
  {
    "text": "namespace which services shared across all those tenants wiki bamako service is",
    "start": "137460",
    "end": "144750"
  },
  {
    "text": "small we want them to solve just a single purpose or a single concern",
    "start": "144750",
    "end": "149780"
  },
  {
    "text": "whether it's a business functionality or technical functionality like generating",
    "start": "149780",
    "end": "155370"
  },
  {
    "text": "a PDF or a docx file suit so size varies but we try to keep them as simple as",
    "start": "155370",
    "end": "161340"
  },
  {
    "text": "possible and we want to avoid duplication of code between services and instead we have services talking to each",
    "start": "161340",
    "end": "168150"
  },
  {
    "text": "other some of the cross-cutting concerns",
    "start": "168150",
    "end": "173610"
  },
  {
    "start": "170000",
    "end": "187000"
  },
  {
    "text": "like security and logging we don't want our engineer tree to have to worry about those so we try to push them down into",
    "start": "173610",
    "end": "180959"
  },
  {
    "text": "the platform as much as we can and we are hosted on kubernetes so we choice",
    "start": "180959",
    "end": "189239"
  },
  {
    "text": "key ladies probably the same reasons everyone else it gives us a lot of flexibility whilst providing us with a",
    "start": "189239",
    "end": "195360"
  },
  {
    "text": "way of running would have much services reliably and we started probably over",
    "start": "195360",
    "end": "200580"
  },
  {
    "text": "three years ago we use the good old cube up script set up two clusters one for",
    "start": "200580",
    "end": "206070"
  },
  {
    "text": "our production systems and one for our non production systems and we kind of",
    "start": "206070",
    "end": "211620"
  },
  {
    "text": "went and upgraded from there from about version 1.2 we just kept going up and up",
    "start": "211620",
    "end": "217560"
  },
  {
    "text": "to the later versions we're really keen on having all our infrastructure as code so we built our starting with terraform",
    "start": "217560",
    "end": "225959"
  },
  {
    "text": "to define our sort of networking bits and pieces in AWS and also anything",
    "start": "225959",
    "end": "232080"
  },
  {
    "text": "that's not keyed related and then we use cops to manage to deploy and manage our clusters on top of that we keep all the",
    "start": "232080",
    "end": "240269"
  },
  {
    "text": "cluster configuration and namespace configuration and our source repositories so we can reapply them",
    "start": "240269",
    "end": "247440"
  },
  {
    "text": "easily and then we've got some custom tooling for deploying our applications and in a consistent way because we want them our engineering teams our",
    "start": "247440",
    "end": "254250"
  },
  {
    "text": "development teams I only worry about the bits they need to worry about whilst deploying everything in a very consistent manner and most of",
    "start": "254250",
    "end": "260859"
  },
  {
    "text": "our applications are very similar in terms of their requirements for running on Cuban ATS and this was back in the",
    "start": "260859",
    "end": "266620"
  },
  {
    "text": "day we introduced this before how long kind of came about so we haven't really moved away from it yet and we wanted to",
    "start": "266620",
    "end": "273490"
  },
  {
    "text": "keep that automation in place and all that infrastructure zko because it gives",
    "start": "273490",
    "end": "278500"
  },
  {
    "text": "us confidence gives us a really like the ability to repeatedly bring up clustered if we need to and that kind of worst",
    "start": "278500",
    "end": "284440"
  },
  {
    "text": "case scenario if we've really had and we lost a kubernetes cluster we could just rebuild it within a couple of hours",
    "start": "284440",
    "end": "290110"
  },
  {
    "text": "luckily we've only ever done that as an exercise rather than because our production system went down so our",
    "start": "290110",
    "end": "298690"
  },
  {
    "start": "297000",
    "end": "418000"
  },
  {
    "text": "platform has evolved over time as as Dave said there are a lot of new tools",
    "start": "298690",
    "end": "304150"
  },
  {
    "text": "coming out so a lot of the time with with kubernetes and some of the tools",
    "start": "304150",
    "end": "310210"
  },
  {
    "text": "that some of the tools sorry that are available now one of available them so we have to write some of those ourselves",
    "start": "310210",
    "end": "317410"
  },
  {
    "text": "we still use some of them now our deployment processes is pretty much a",
    "start": "317410",
    "end": "322930"
  },
  {
    "text": "mix of bash script console vault and some JSON configuration and it still works quite well so we're quite happy",
    "start": "322930",
    "end": "328360"
  },
  {
    "text": "with that we have a fairly standard CIC D pipeline so any all the commits are",
    "start": "328360",
    "end": "335110"
  },
  {
    "text": "built tested unit tested component tested we do some security checks as well and when we build onto master we",
    "start": "335110",
    "end": "342130"
  },
  {
    "text": "also create a docker image and we push the automatically to our dev service for",
    "start": "342130",
    "end": "347229"
  },
  {
    "text": "our staging and production Lac environment we still have a push of a button and we were quite happy with with",
    "start": "347229",
    "end": "353590"
  },
  {
    "text": "that process self-service is also something that's called important for us",
    "start": "353590",
    "end": "359110"
  },
  {
    "text": "we don't want to have a engineer to have to rely on us to do some deployment or",
    "start": "359110",
    "end": "364720"
  },
  {
    "text": "anything ready to production environment so instead we try to provide them the tool so that they can do the all their",
    "start": "364720",
    "end": "371530"
  },
  {
    "text": "work without having to require on on our time so if you example we've got one",
    "start": "371530",
    "end": "377560"
  },
  {
    "text": "there so we created a chat bot for them that we've we've we called Conan the",
    "start": "377560",
    "end": "383050"
  },
  {
    "text": "deployer so a little just a little example there at Conan deploy you choose",
    "start": "383050",
    "end": "388659"
  },
  {
    "text": "your service your environment and a reason which is often a ticket number and that lets the engineer deploy any",
    "start": "388659",
    "end": "395649"
  },
  {
    "text": "services to any environment including production we have also the",
    "start": "395649",
    "end": "401800"
  },
  {
    "text": "configuration is like a a bunch of JSON files and engineer can can control the",
    "start": "401800",
    "end": "407589"
  },
  {
    "text": "versions of the service that goes to different environments can control the configuration of those services and",
    "start": "407589",
    "end": "414279"
  },
  {
    "text": "where to find the secrets for the services as well but we are in a",
    "start": "414279",
    "end": "420849"
  },
  {
    "start": "418000",
    "end": "491000"
  },
  {
    "text": "slow-moving industry that's one of the reason why we got into into this in the first place we want to make it a lot",
    "start": "420849",
    "end": "427899"
  },
  {
    "text": "quicker and it means that sometimes we can't push the production as often as we",
    "start": "427899",
    "end": "433539"
  },
  {
    "text": "like and often is due to compliance jack and regulation checks to give you a",
    "start": "433539",
    "end": "438759"
  },
  {
    "text": "simple example just to drive the point is if you take the simplest change that",
    "start": "438759",
    "end": "444069"
  },
  {
    "text": "you can think of so say just changing a bit of text in a document that you're going to send your customer from an",
    "start": "444069",
    "end": "450699"
  },
  {
    "text": "engineering point of view it is very simple you change some text it goes through your pipeline you have some test",
    "start": "450699",
    "end": "455979"
  },
  {
    "text": "it goes to production typically within hours maybe less you can get that on to",
    "start": "455979",
    "end": "461080"
  },
  {
    "text": "your production but from the compliant compliance side of things changing a",
    "start": "461080",
    "end": "466449"
  },
  {
    "text": "sentence might mean that you will change the advice that you're giving to your come to your consumer and point in",
    "start": "466449",
    "end": "472899"
  },
  {
    "text": "potentially we know we might break some regulations so there's a lot of testing",
    "start": "472899",
    "end": "478330"
  },
  {
    "text": "that needs to happen on that side of the business so we want to deploy quickly but at the same times we have to to",
    "start": "478330",
    "end": "485889"
  },
  {
    "text": "comply with regulation and there's a bit of a friction there",
    "start": "485889",
    "end": "490768"
  },
  {
    "start": "491000",
    "end": "524000"
  },
  {
    "text": "so as I just say we we must comply with regulations so our pipeline looks like",
    "start": "492470",
    "end": "498449"
  },
  {
    "text": "this when a feature is they've completed we have a standard code review process",
    "start": "498449",
    "end": "503940"
  },
  {
    "text": "which is just put request system really like as much into map master we've got automated bill that go to our dev",
    "start": "503940",
    "end": "510840"
  },
  {
    "text": "environment and then we've got a pretty standard QA review some automated test that runs on top of that we then have",
    "start": "510840",
    "end": "517710"
  },
  {
    "text": "the very important important compliance check and then we can push down into our production environment so it's a very",
    "start": "517710",
    "end": "525510"
  },
  {
    "start": "524000",
    "end": "564000"
  },
  {
    "text": "linear process and when everything is fine just a tick in the box and it's in",
    "start": "525510",
    "end": "530520"
  },
  {
    "text": "production however if we have any problem with any of those steps",
    "start": "530520",
    "end": "535980"
  },
  {
    "text": "especially the compliance check then we we now we're not blocking all all the",
    "start": "535980",
    "end": "542700"
  },
  {
    "text": "release that are coming to our production environment we now have a master build that is corrupted and we",
    "start": "542700",
    "end": "549839"
  },
  {
    "text": "find sometimes that compliance check could mean that we needed a couple of days to fix those so it's a very risky",
    "start": "549839",
    "end": "556380"
  },
  {
    "text": "position we kind of of breaking the continuous that are really principled as well as this so we started to look at",
    "start": "556380",
    "end": "562230"
  },
  {
    "text": "options for the first way around the",
    "start": "562230",
    "end": "568410"
  },
  {
    "start": "564000",
    "end": "675000"
  },
  {
    "text": "problem was 20 G's the idea of feature flags we did experiment with this little bit and the problem we mainly found was",
    "start": "568410",
    "end": "576029"
  },
  {
    "text": "that the over hadn't doing this introducing code like this into each of the Micra service a change potentially",
    "start": "576029",
    "end": "582240"
  },
  {
    "text": "effects started to become more work than the change so the example that Pierre just said a one-line change which to an",
    "start": "582240",
    "end": "589200"
  },
  {
    "text": "engineering team is very simple to check to do but adding the feature flag on top of that makes it more complicated and",
    "start": "589200",
    "end": "595890"
  },
  {
    "text": "but it's that sort of change that is most likely to to cause a problem in terms of compliance and therefore things",
    "start": "595890",
    "end": "603180"
  },
  {
    "text": "would start not getting the feature flags around them and then we still end up with the same problem with the other",
    "start": "603180",
    "end": "608910"
  },
  {
    "text": "another option is around or BT users where it's a very similar argument that the application itself needs to know",
    "start": "608910",
    "end": "615060"
  },
  {
    "text": "about whether a user or a feature flag is enabled or a user's allowed to use that and",
    "start": "615060",
    "end": "620550"
  },
  {
    "text": "and then the code has to kind of deal with that and when you're introducing these variables you don't have to test every combination of these flags or",
    "start": "620550",
    "end": "627360"
  },
  {
    "text": "these variables in order to to make sure that you're not breaking existing code so one of one of the things we do anyway",
    "start": "627360",
    "end": "634920"
  },
  {
    "text": "our engineering team will have the ability to spin up parts of our system locally and they'll either interact with",
    "start": "634920",
    "end": "640430"
  },
  {
    "text": "mock end point or they'll interact with some of our development clusters and",
    "start": "640430",
    "end": "645510"
  },
  {
    "text": "that kind of works well for the small small iterations the engineering of doing that once you start handing stuff",
    "start": "645510",
    "end": "651210"
  },
  {
    "text": "over to our compliance teams to check they don't really want something that's very tech heavy to to deal with",
    "start": "651210",
    "end": "657800"
  },
  {
    "text": "so we start being asked to spin up environments because we want to test a feature on top of that we might get",
    "start": "657800",
    "end": "664890"
  },
  {
    "text": "asked to environments all kinds of different reasons maybe demonstrations or just for playgrounds for people to explore it or",
    "start": "664890",
    "end": "670950"
  },
  {
    "text": "just because they like to annoy the platform to a little bit so in a",
    "start": "670950",
    "end": "677130"
  },
  {
    "start": "675000",
    "end": "697000"
  },
  {
    "text": "monolithic world when you want one you get asked to get your environment you tend to have like a a single being big",
    "start": "677130",
    "end": "683310"
  },
  {
    "text": "artifact so if you want you to duplicate it is fairly easy you just spin up a new instance whether it's on the laptop on",
    "start": "683310",
    "end": "689220"
  },
  {
    "text": "the server somewhere it doesn't really matter and if you ask for some more you just add more and you ask for some more",
    "start": "689220",
    "end": "695520"
  },
  {
    "text": "you are you are known in our microservices world while we could do",
    "start": "695520",
    "end": "702240"
  },
  {
    "start": "697000",
    "end": "733000"
  },
  {
    "text": "the same really we know that is very simple to deploy services with with kubernetes and if we ask for some more",
    "start": "702240",
    "end": "709740"
  },
  {
    "text": "environment we could also duplicate them there is however cost into infrastructure obviously it get it gets",
    "start": "709740",
    "end": "718830"
  },
  {
    "text": "a little bit more complex as well but we also find that there was a cost in time",
    "start": "718830",
    "end": "723870"
  },
  {
    "text": "in managing all the configurations for those environments and also there was a lot of duplications between rope all of",
    "start": "723870",
    "end": "729990"
  },
  {
    "text": "those so that wasn't really quite the right way to fix that so instead we",
    "start": "729990",
    "end": "735060"
  },
  {
    "start": "733000",
    "end": "759000"
  },
  {
    "text": "thought why not just spin up the bits that have changed so I've got my macro services world and if I've changed only",
    "start": "735060",
    "end": "741990"
  },
  {
    "text": "a couple of services why could I just not run alternative versions of those of",
    "start": "741990",
    "end": "747810"
  },
  {
    "text": "those services alongside the master version and find a nice way to route traffic to",
    "start": "747810",
    "end": "754330"
  },
  {
    "text": "the services and that's where we started to look into Ecco so we've been to quite",
    "start": "754330",
    "end": "761530"
  },
  {
    "text": "a few toxicity has come up an awful lot this week it's just one of a number of service meshes they're very much higher",
    "start": "761530",
    "end": "768010"
  },
  {
    "text": "on the radio out on the radar and we've been aware of SDO for probably a couple",
    "start": "768010",
    "end": "773680"
  },
  {
    "text": "of years in fact we played around with it a few years ago and just found it it had so much potential and a lot of",
    "start": "773680",
    "end": "779920"
  },
  {
    "text": "features but we didn't really have a problem to solve at that time that we",
    "start": "779920",
    "end": "785320"
  },
  {
    "text": "wanted to introduce the complexity in learning it and running it and then this",
    "start": "785320",
    "end": "790450"
  },
  {
    "text": "problem came along and we thought we'd give it a go and we're going to use the",
    "start": "790450",
    "end": "795850"
  },
  {
    "text": "traffic management sort of features of sto to solve our problem so you've probably",
    "start": "795850",
    "end": "803440"
  },
  {
    "start": "801000",
    "end": "837000"
  },
  {
    "text": "all aware if you've been to any of the other talks this is how SEO works so we have service a talking-to service fee",
    "start": "803440",
    "end": "809560"
  },
  {
    "text": "you get a proxy sidecar injected into the pod which is m'boy and that handles",
    "start": "809560",
    "end": "815410"
  },
  {
    "text": "the communication so service a goes via the proxies to service B and that those two services don't know anything about",
    "start": "815410",
    "end": "821770"
  },
  {
    "text": "it and that'll add allows you to add various rules for that traffic either that's or encryption or traffic routing",
    "start": "821770",
    "end": "829750"
  },
  {
    "text": "rules and then all this is managed by the control plane at the bottom there which made sure that the M avoid proxies",
    "start": "829750",
    "end": "835360"
  },
  {
    "text": "know what's going on so in the traffic management world without sto which servers a tox or service P it just gets",
    "start": "835360",
    "end": "841630"
  },
  {
    "start": "837000",
    "end": "992000"
  },
  {
    "text": "routed to any of the pods within that service when you're introduced this do you can start doing some rules and we're",
    "start": "841630",
    "end": "848650"
  },
  {
    "text": "going to talk about the HTTP headers so in this example we might we would look at user agent set to Android which would",
    "start": "848650",
    "end": "854860"
  },
  {
    "text": "get route to the current version of service B and then an user agent of iPhone would get to so routed to the",
    "start": "854860",
    "end": "861520"
  },
  {
    "text": "Canaria version of service B all the while there those services running don't know anything about it",
    "start": "861520",
    "end": "867310"
  },
  {
    "text": "so I'm going to run for a little demonstration of how how we've implemented this how this works from a",
    "start": "867310",
    "end": "872320"
  },
  {
    "text": "developer's point of view so this is our Robo power planner application this is what our smooth financial advisors will",
    "start": "872320",
    "end": "878200"
  },
  {
    "text": "use for general financial advice and with going to",
    "start": "878200",
    "end": "883490"
  },
  {
    "text": "imagine that we've picked up a piece of work to rebrand our application so this",
    "start": "883490",
    "end": "889550"
  },
  {
    "text": "is running in a development environment we called it green and that's the name of the brand of the application we're",
    "start": "889550",
    "end": "895610"
  },
  {
    "text": "going to rename it as part of our a new brand and as a good fun bit of code that we're going to change it's just there",
    "start": "895610",
    "end": "901940"
  },
  {
    "text": "we're gonna rename it and we're going to use Dave because all good engineers use their name when doing demonstrations so",
    "start": "901940",
    "end": "908000"
  },
  {
    "text": "I'm going to commit that to our source repository we're gonna use the ticket",
    "start": "908000",
    "end": "913130"
  },
  {
    "text": "number that we're doing this work on which is going to be ops one two three four in the name of the feature branch that we were committing this to and then",
    "start": "913130",
    "end": "920060"
  },
  {
    "text": "when we push this to our remote repository our CI system kicks in and does its usual build testing linting etc",
    "start": "920060",
    "end": "927920"
  },
  {
    "text": "but the last step it does is actually deploying this to our Q&A TS cluster so this I'm just gonna bring up a new",
    "start": "927920",
    "end": "933620"
  },
  {
    "text": "window and Annie's little plugin for Chrome and this plug-in will allow us to attach HTTP headers for the browser",
    "start": "933620",
    "end": "940459"
  },
  {
    "text": "requests so I'm setting X variant ID to the ticket number we used in the branch name which is ops one two three four so",
    "start": "940459",
    "end": "948560"
  },
  {
    "text": "if I enable that and i refresh this page we'll see that my change has now been deployed and I'm being routed to it so",
    "start": "948560",
    "end": "955010"
  },
  {
    "text": "you can see my my name's there in the middle and we thought this is great our engineers thought this was great but one",
    "start": "955010",
    "end": "960920"
  },
  {
    "text": "of the things that was missing was being able to give this to our compliance teams who are not necessarily technical",
    "start": "960920",
    "end": "966160"
  },
  {
    "text": "so rather than getting them to install a plug-in we introduced the ability to do this through the hostname so we also",
    "start": "966160",
    "end": "972230"
  },
  {
    "text": "allow prefixing the host thing there with the same ticket number and you can see that comes up with the same variant",
    "start": "972230",
    "end": "979130"
  },
  {
    "text": "we even with the headers disabled and just improve our mainline version I'm a",
    "start": "979130",
    "end": "985970"
  },
  {
    "text": "master version still running I've refreshed that page and we still got the existing application running in parallel",
    "start": "985970",
    "end": "991930"
  },
  {
    "text": "I'm gonna talk a little bit about the sto configuration that makes that possible the first one is a destination",
    "start": "991930",
    "end": "998899"
  },
  {
    "start": "992000",
    "end": "1030000"
  },
  {
    "text": "rule the destination rule is basically defining subsets of a Cuban 80 service",
    "start": "998899",
    "end": "1004389"
  },
  {
    "text": "that we we want to be out of really traffic to so in this case our our service is fact phone UI and we've got",
    "start": "1004389",
    "end": "1010990"
  },
  {
    "text": "two subsets to find one cool ops one two three four which is looking for labels on the pods",
    "start": "1010990",
    "end": "1017440"
  },
  {
    "text": "for that service cooled version with the value of ops one two three four and then we have a second destination rule which",
    "start": "1017440",
    "end": "1024760"
  },
  {
    "text": "is looking for the label version set to master and it's just called master the",
    "start": "1024760",
    "end": "1030910"
  },
  {
    "start": "1030000",
    "end": "1119000"
  },
  {
    "text": "actual logic for routing traffic then comes to virtual service in Sto and there's we've actually defined two",
    "start": "1030910",
    "end": "1036819"
  },
  {
    "text": "virtual service one for ingress which is deferred determining how external traffic to keep an ATS is routed and we",
    "start": "1036820",
    "end": "1044980"
  },
  {
    "text": "can do hostname routing and then we also do virtual service for the match for",
    "start": "1044980",
    "end": "1050860"
  },
  {
    "text": "service to service communication within our our cluster so the first one I'll show you is yes is the ingress and this",
    "start": "1050860",
    "end": "1057940"
  },
  {
    "text": "is telling at risk during rest gateway how to route traffic and we're going to add a rule to match on Authority which",
    "start": "1057940",
    "end": "1064840"
  },
  {
    "text": "is effectively the hostname so I'm looking for ops one two three four dot and then the rest of our domain name and",
    "start": "1064840",
    "end": "1071400"
  },
  {
    "text": "if that matches first thing we do as an appendix parent ID header with the same",
    "start": "1071400",
    "end": "1077080"
  },
  {
    "text": "ticket number which I'll talk about in a second and then we route it to the destination service giving it the subset",
    "start": "1077080",
    "end": "1083920"
  },
  {
    "text": "that we defined on the previous slide of ops one two three four now a second rule",
    "start": "1083920",
    "end": "1089020"
  },
  {
    "text": "which is basically doing the same thing but only matching the HTTP header so we can use both options and the header",
    "start": "1089020",
    "end": "1095890"
  },
  {
    "text": "becomes more important when we're talking downstream within within like even a disgusto and again reaching that",
    "start": "1095890",
    "end": "1102340"
  },
  {
    "text": "X variant ID header to the same subset and then the final one is a route",
    "start": "1102340",
    "end": "1107350"
  },
  {
    "text": "default routes and no matching rules anything else is sent to our master version and with the destination rules",
    "start": "1107350",
    "end": "1113500"
  },
  {
    "text": "and this you can have as many subsets and veteran routing rules as you need and then the internal traffic so",
    "start": "1113500",
    "end": "1121570"
  },
  {
    "start": "1119000",
    "end": "1143000"
  },
  {
    "text": "anything going from service to service within Kuban ATS is defined in this mesh virtual service and this is only",
    "start": "1121570",
    "end": "1128260"
  },
  {
    "text": "matching on the variant ID because when you're talking internal to the cluster we're using internal service names so",
    "start": "1128260",
    "end": "1133810"
  },
  {
    "text": "there's no no easy way of to inject that without our application starting to know",
    "start": "1133810",
    "end": "1139900"
  },
  {
    "text": "a bit more about it how was this managed we wanted to",
    "start": "1139900",
    "end": "1146749"
  },
  {
    "start": "1143000",
    "end": "1184000"
  },
  {
    "text": "basically make this feature available to our engineering teams without them really having an overhead in doing this",
    "start": "1146749",
    "end": "1152249"
  },
  {
    "text": "so we wanted to automate this make it happen for all last microservices on all",
    "start": "1152249",
    "end": "1158639"
  },
  {
    "text": "our feature branches so we had to introduce automation to to manage this so the first one is how they're deployed",
    "start": "1158639",
    "end": "1165029"
  },
  {
    "text": "and this was quite a simple change for us because we already had CI on on our branches anyway we just had as a step to",
    "start": "1165029",
    "end": "1172979"
  },
  {
    "text": "the end to deploy that variant all that branch to a Cuban 80s development cluster and worldly deploying on",
    "start": "1172979",
    "end": "1179609"
  },
  {
    "text": "whenever we build master anyway so this was a small variation on that at the",
    "start": "1179609",
    "end": "1184739"
  },
  {
    "start": "1184000",
    "end": "1206000"
  },
  {
    "text": "other end of the process we wanted to tidy stuff up because we didn't want these branch deployments or variant",
    "start": "1184739",
    "end": "1190499"
  },
  {
    "text": "deployments being left lying around so we just introduced something we called cube housekeeper which is a effectively just a cube cron job that goes and",
    "start": "1190499",
    "end": "1198299"
  },
  {
    "text": "cleans up branches that have been left lying around for a few days so that we don't don't use too much resource the",
    "start": "1198299",
    "end": "1207210"
  },
  {
    "start": "1206000",
    "end": "1251000"
  },
  {
    "text": "big piece we added was something we call Auto cube and we had we one of the problems we had with this queue in the",
    "start": "1207210",
    "end": "1212970"
  },
  {
    "text": "declarative way it works is that we needed to now get about all the subsets or all the deployed versions of a",
    "start": "1212970",
    "end": "1219119"
  },
  {
    "text": "particular service in order to generate that that destination willam or the virtual service Djamel so we we wrote a",
    "start": "1219119",
    "end": "1226950"
  },
  {
    "text": "little tool which is kind of based on console template and primarily because we already stored a lot of information about what's running on Kievan ATS",
    "start": "1226950",
    "end": "1233820"
  },
  {
    "text": "within console to generate those yeah more file for every variant that's currently deployed so every time a new",
    "start": "1233820",
    "end": "1239460"
  },
  {
    "text": "deployment happens it gets added and when a deployment gets removed then that also tidies it up as well and so we",
    "start": "1239460",
    "end": "1247619"
  },
  {
    "text": "introduced that oh that's correct constantly monitoring a a cluster so the",
    "start": "1247619",
    "end": "1252869"
  },
  {
    "start": "1251000",
    "end": "1383000"
  },
  {
    "text": "next one is edge propagate h propagate is actually a node.js module that we had to write most of our services run",
    "start": "1252869",
    "end": "1259529"
  },
  {
    "text": "running in node.js and fairly early on we recognized that we we would have a requirement to propagate headers through",
    "start": "1259529",
    "end": "1266279"
  },
  {
    "text": "our services so if you got services a B and C it talks to b and b talks",
    "start": "1266279",
    "end": "1271840"
  },
  {
    "text": "you see we do new features and you have changes in a and C when we send requests",
    "start": "1271840",
    "end": "1276909"
  },
  {
    "text": "with our x value ID from from to service a sorry we now need service a to propagate the",
    "start": "1276909",
    "end": "1282850"
  },
  {
    "text": "header to B and we need B to propagate the header to C as well so a simple change would be to go through all our",
    "start": "1282850",
    "end": "1289090"
  },
  {
    "text": "services all our endpoints and start to handle that manually but the obviously that didn't feel like the right way to",
    "start": "1289090",
    "end": "1294970"
  },
  {
    "text": "use to solve this and then we thought of how like library like new relic and",
    "start": "1294970",
    "end": "1301120"
  },
  {
    "text": "elastic APM managed to do that stuff so I'm not sure if any of you have used",
    "start": "1301120",
    "end": "1306130"
  },
  {
    "text": "neuron ik before in the node.js world you import or require the neuron ik module in it instruments your code and",
    "start": "1306130",
    "end": "1313899"
  },
  {
    "text": "then you start to receive data in new relic so we thought that's quite a nice way to solve that sort of problem so",
    "start": "1313899",
    "end": "1319690"
  },
  {
    "text": "we're actually looking in in the code a bit more it turns out that it's a bit messy and quite difficult to get right",
    "start": "1319690",
    "end": "1324870"
  },
  {
    "text": "we look a bit further and I think some of the committees in the elastic APM",
    "start": "1324870",
    "end": "1330460"
  },
  {
    "text": "project have released some nice videos and presentation about how to do this and it turns out with no J's night so",
    "start": "1330460",
    "end": "1337899"
  },
  {
    "text": "it'll be easier to to do they've got a core library called a acing hoops and that lets you get get notification into",
    "start": "1337899",
    "end": "1345520"
  },
  {
    "text": "a synchronous event so what that lets us do is effectively in our service when an HTTP request comes in we get a little",
    "start": "1345520",
    "end": "1352720"
  },
  {
    "text": "notification we can go and look at the headers to grab the value of the X variant ID similarly when we have",
    "start": "1352720",
    "end": "1359260"
  },
  {
    "text": "outbound HTTP requests going out we get we also get a notification and we can",
    "start": "1359260",
    "end": "1364480"
  },
  {
    "text": "inject a header into it another cool stuff with that library is that you can link the outbound requests",
    "start": "1364480",
    "end": "1371890"
  },
  {
    "text": "to the incoming requests so you can map which headers needs to go to which requests and then with that we started",
    "start": "1371890",
    "end": "1378850"
  },
  {
    "text": "to have so our service propagate the header automatically it does need a",
    "start": "1378850",
    "end": "1384820"
  },
  {
    "text": "little change in your code so that's the first line there so you just require edge propagate and then you start to",
    "start": "1384820",
    "end": "1390460"
  },
  {
    "text": "have your headers being propagated we also added a decoration idea which we",
    "start": "1390460",
    "end": "1398010"
  },
  {
    "text": "to do debugging across multiple services and now that we used SEO we also looked",
    "start": "1398010",
    "end": "1406440"
  },
  {
    "start": "1403000",
    "end": "1435000"
  },
  {
    "text": "into the East your observability and yoga you've got Jaeger and request",
    "start": "1406440",
    "end": "1411480"
  },
  {
    "text": "tracing and East he'll handle some of those headers for you already",
    "start": "1411480",
    "end": "1417750"
  },
  {
    "text": "but there is one requirement in your service is to propagate some headers so we just we just wrote edge propagate at",
    "start": "1417750",
    "end": "1424290"
  },
  {
    "text": "the time so we we added the six letters I think that you need to have your tracing and we started to receive",
    "start": "1424290",
    "end": "1431180"
  },
  {
    "text": "Tracy's almost for free so that was quite cool okay so let's look at the",
    "start": "1431180",
    "end": "1438210"
  },
  {
    "start": "1435000",
    "end": "1524000"
  },
  {
    "text": "gains so six months later and that feature has become really indispensable",
    "start": "1438210",
    "end": "1443450"
  },
  {
    "text": "especially for one of our team who works a lot with regulation and compliance so",
    "start": "1443450",
    "end": "1449340"
  },
  {
    "text": "they don't have to worry about dependencies between their features anymore they can just have a feature deployed in",
    "start": "1449340",
    "end": "1456150"
  },
  {
    "text": "the branch and they can queue a test in isolation they can compliance test in",
    "start": "1456150",
    "end": "1462840"
  },
  {
    "text": "isolation as well so we also brought the QA team and the compliance team a bit earlier in AI pipeline which i think is",
    "start": "1462840",
    "end": "1469410"
  },
  {
    "text": "actually an improvement and a nice added bonus as well nice because we do so much",
    "start": "1469410",
    "end": "1476370"
  },
  {
    "text": "testing on the branches that once we decide to merge the merging is really",
    "start": "1476370",
    "end": "1481710"
  },
  {
    "text": "smooth now and we just go through a few regression tests and compliance tests",
    "start": "1481710",
    "end": "1487740"
  },
  {
    "text": "again obviously but we we are now able to release to production a lot quicker than we used to as a another example",
    "start": "1487740",
    "end": "1495900"
  },
  {
    "text": "very recently we introduced a new user authentication mechanism into that",
    "start": "1495900",
    "end": "1501210"
  },
  {
    "text": "project and that was there was qualitative work involved and we managed to isolate that in the branch we were",
    "start": "1501210",
    "end": "1508410"
  },
  {
    "text": "able to evaluate the product we were using quite well without affecting any other features going into production and",
    "start": "1508410",
    "end": "1515460"
  },
  {
    "text": "again it was well tested and once we were ready to use it we merge and very quickly within a day we had that through to our customers so",
    "start": "1515460",
    "end": "1523280"
  },
  {
    "text": "very successful for us but it's not it's not been easy to say the",
    "start": "1523280",
    "end": "1530809"
  },
  {
    "start": "1524000",
    "end": "1636000"
  },
  {
    "text": "least su is a great product but it's quite complex there's a lot of moving parts on",
    "start": "1530809",
    "end": "1538519"
  },
  {
    "text": "top of kubernetes that also has a lot of moving parts the traffic management effect the",
    "start": "1538519",
    "end": "1544940"
  },
  {
    "text": "networking so the core thing into your infrastructure so when something goes",
    "start": "1544940",
    "end": "1550070"
  },
  {
    "text": "wrong you can have some quite important impact there was a steep learning curve",
    "start": "1550070",
    "end": "1557149"
  },
  {
    "text": "we we have struggled to find out how to configure the pilot and the control",
    "start": "1557149",
    "end": "1562519"
  },
  {
    "text": "plane properly to support our configuration and we had we had quality",
    "start": "1562519",
    "end": "1569600"
  },
  {
    "text": "of stability issues in high insight I think we were under provision for what",
    "start": "1569600",
    "end": "1575149"
  },
  {
    "text": "we are trying to do number of services that we were trying to support and when",
    "start": "1575149",
    "end": "1580970"
  },
  {
    "text": "the control plane was under load we started to receive at some point Corot of five or three errors and that was",
    "start": "1580970",
    "end": "1588049"
  },
  {
    "text": "only impacting our dev environment but we did impact our engineer at the time and we were not very popular at that",
    "start": "1588049",
    "end": "1595250"
  },
  {
    "text": "time and we almost backed out of obvious to you at that point but the the",
    "start": "1595250",
    "end": "1603049"
  },
  {
    "text": "deploying into a branch was was so powerful for one our team that we stuck",
    "start": "1603049",
    "end": "1608330"
  },
  {
    "text": "with it we we got to know SEO a little",
    "start": "1608330",
    "end": "1613580"
  },
  {
    "text": "bit more and a little bit better we we've also upgraded as they were caught of bug fixes committed by the SEO team",
    "start": "1613580",
    "end": "1620440"
  },
  {
    "text": "to the point now that for the last six months has been very stable and we were really happy with it and we actually are",
    "start": "1620440",
    "end": "1627649"
  },
  {
    "text": "thinking of pushing missed you into staging and production and start solving different problem with it",
    "start": "1627649",
    "end": "1634658"
  },
  {
    "text": "so if sto has been a you know huge improvement in terms of unblocking our",
    "start": "1637850",
    "end": "1643649"
  },
  {
    "text": "release train which we think our engineering teams that find it indispensable and and they're using it",
    "start": "1643649",
    "end": "1650370"
  },
  {
    "text": "an awful lot because it means we can do all the stuff that would previously be in our pipeline after we committed or",
    "start": "1650370",
    "end": "1655919"
  },
  {
    "text": "merge to our changes into our mainline we can do that before that and now we can release into mass into production",
    "start": "1655919",
    "end": "1664070"
  },
  {
    "text": "within a couple of hours of doing massacres all we do is a few regression testing at that point whereas in the",
    "start": "1664070",
    "end": "1670230"
  },
  {
    "text": "past we do a change and then any impact any problems would block any other changes potentially and the really",
    "start": "1670230",
    "end": "1677039"
  },
  {
    "text": "fantastic thing about it is the micro services themselves don't know anything about this we other than the edge propagate stuff we haven't had to",
    "start": "1677039",
    "end": "1683549"
  },
  {
    "text": "introduce anything at all into our micro services so they they are nice and simple still so we think it's chairs got",
    "start": "1683549",
    "end": "1689669"
  },
  {
    "text": "an awful lot potential and as I said we're gonna extend its usage now I think we're much more comfortable with it and",
    "start": "1689669",
    "end": "1696000"
  },
  {
    "text": "it's a little bit more stable but it does come with a complexity particularly when it doesn't do what you're thinking it's it should do so I'd like to thank",
    "start": "1696000",
    "end": "1704190"
  },
  {
    "start": "1702000",
    "end": "1723000"
  },
  {
    "text": "you very much the some of the projects we've been doing are on github so if you wanna have a look some of them you can",
    "start": "1704190",
    "end": "1710399"
  },
  {
    "text": "maybe use out the box others you might just want to see what we're doing and but thank you very much thank you",
    "start": "1710399",
    "end": "1717710"
  },
  {
    "text": "[Applause] yeah we do have time for a few questions",
    "start": "1718760",
    "end": "1725320"
  },
  {
    "start": "1723000",
    "end": "2122000"
  },
  {
    "text": "and I already see first one [Applause]",
    "start": "1725320",
    "end": "1734210"
  },
  {
    "text": "hi thanks for the talk I considering to add an API gateways please everyone well",
    "start": "1734550",
    "end": "1743340"
  },
  {
    "text": "either live quietly or don't leave at all when the questions are being",
    "start": "1743340",
    "end": "1748650"
  },
  {
    "text": "answered or asked like ambassador Kongo an hour in front of your eyes just as",
    "start": "1748650",
    "end": "1756630"
  },
  {
    "text": "much sorry would you want to pay to nodding watch it are you considering to add an API",
    "start": "1756630",
    "end": "1764160"
  },
  {
    "text": "gateways like ambassador or an hour like conch in front to manipulate with",
    "start": "1764160",
    "end": "1771150"
  },
  {
    "text": "headers rates and other things this that these features and service measures are",
    "start": "1771150",
    "end": "1777570"
  },
  {
    "text": "not usually happening so that's why you are workaround in cabot yeah April are",
    "start": "1777570",
    "end": "1784890"
  },
  {
    "text": "gateways on a radar it's something that our engineering team are exploring and probably implementing something in the",
    "start": "1784890",
    "end": "1790620"
  },
  {
    "text": "near future but they're having the real power with the SEO is the in service within the mesh kind of reaching a",
    "start": "1790620",
    "end": "1798420"
  },
  {
    "text": "portable kind of traffic hi thanks for the talk how do you handle state do you have",
    "start": "1798420",
    "end": "1805830"
  },
  {
    "text": "state that you know you need to isolate this so the stuff we deploy is is almost",
    "start": "1805830",
    "end": "1813240"
  },
  {
    "text": "exclusively stateless or our persistence is in among among a clusters outside to",
    "start": "1813240",
    "end": "1818670"
  },
  {
    "text": "keep it a tease primarily hi",
    "start": "1818670",
    "end": "1825440"
  },
  {
    "text": "are there any firewalls or already's custom DNS all publicly accessible or is",
    "start": "1828710",
    "end": "1834200"
  },
  {
    "text": "it only internally there internal so we we use whitelisting within ingress",
    "start": "1834200",
    "end": "1839900"
  },
  {
    "text": "gateways to prevent access to our development environments some of them are accessible to our customers so they",
    "start": "1839900",
    "end": "1847340"
  },
  {
    "text": "they are allowed access but only from their IP addresses so we do do block access to these test environments I",
    "start": "1847340",
    "end": "1855549"
  },
  {
    "text": "think I would maybe be backing a bit on the state question even with or",
    "start": "1855880",
    "end": "1862490"
  },
  {
    "text": "with our database that you have how do you handle when your the feature you're testing right might require TV migration",
    "start": "1862490",
    "end": "1867950"
  },
  {
    "text": "which is non-breaking but still affects the state of the current database so this is a problem we're currently",
    "start": "1867950",
    "end": "1874100"
  },
  {
    "text": "tackling where we introduce this it wasn't long before someone wanted to do a change for the make the schemas",
    "start": "1874100",
    "end": "1881360"
  },
  {
    "text": "that we're using and that started causing his headaches we've got a couple of ideas one of them involves Sto in",
    "start": "1881360",
    "end": "1887810"
  },
  {
    "text": "terms of migrating through to production and running multiple versions of the same service with different schemas but",
    "start": "1887810",
    "end": "1895280"
  },
  {
    "text": "within our development environment we're looking at actually just pushing to",
    "start": "1895280",
    "end": "1901280"
  },
  {
    "text": "collections or databases that have a different ticket number or something the",
    "start": "1901280",
    "end": "1906440"
  },
  {
    "text": "branch variant ID in it so we can we can split up effectively a database quite easily because a database is just",
    "start": "1906440",
    "end": "1912830"
  },
  {
    "text": "when you persister it it exists so we can just do that quite quite straightforward in terms of your",
    "start": "1912830",
    "end": "1919130"
  },
  {
    "text": "components testing is it manual result automated we automate too much testing",
    "start": "1919130",
    "end": "1925310"
  },
  {
    "text": "as we can we do some exploratory testing which is manual and but we we have a quite a good a QA team that will work",
    "start": "1925310",
    "end": "1933230"
  },
  {
    "text": "with our engineers to come up with with the test Suites to make sure that we're meeting the Quartier because we're a",
    "start": "1933230",
    "end": "1938300"
  },
  {
    "text": "regulated industry we need to be very sure that that the test results reflect",
    "start": "1938300",
    "end": "1943460"
  },
  {
    "text": "what the requirements are what the compliance requirements are",
    "start": "1943460",
    "end": "1948760"
  },
  {
    "text": "recomendation on tools I don't know what is a little happy we can find out though",
    "start": "1949919",
    "end": "1956500"
  },
  {
    "text": "if you want to we can ask of you a team thank you",
    "start": "1956500",
    "end": "1963070"
  },
  {
    "text": "have you had the chance to do some performance analysis on this approach of",
    "start": "1963070",
    "end": "1968500"
  },
  {
    "text": "using sto and spit in the truck not",
    "start": "1968500",
    "end": "1974080"
  },
  {
    "text": "explicitly so the issues we had but we first started trying to get this to work was around the control plane and",
    "start": "1974080",
    "end": "1981250"
  },
  {
    "text": "actually it was a lot more in resource intensive given the number of pods and services we were running in terms of the",
    "start": "1981250",
    "end": "1988630"
  },
  {
    "text": "traffic we're not seeing that particular slowdown but we're not a performant",
    "start": "1988630",
    "end": "1993820"
  },
  {
    "text": "we're not performances in their highest requirement at the moment particularly in our engineering environment there was",
    "start": "1993820",
    "end": "1999250"
  },
  {
    "text": "some talks that I've been to over the width over this week that talked about comparing and although this does seem to",
    "start": "1999250",
    "end": "2006870"
  },
  {
    "text": "be a little bit slow in many cases there it's like comparing apples and oranges because this Dao is doing different",
    "start": "2006870",
    "end": "2012840"
  },
  {
    "text": "stuff potentially to other serious measures thank you for your presentation",
    "start": "2012840",
    "end": "2018840"
  },
  {
    "text": "about the ingress that you're using are you using any kind of ingress or how you",
    "start": "2018840",
    "end": "2024539"
  },
  {
    "text": "using the East you Gateway so we nginx ingress initially that was we had that",
    "start": "2024539",
    "end": "2031919"
  },
  {
    "text": "pride for our terrestrial then anything we won the user share with gets routed to the sto gateway which",
    "start": "2031919",
    "end": "2038220"
  },
  {
    "text": "handles at the booting the reason we've kept the nginx ingress there is because it provides a lot more functionality we",
    "start": "2038220",
    "end": "2044549"
  },
  {
    "text": "had a lot of rules you know we talked about white listing a second ago we've got rules around allowing our monitoring",
    "start": "2044549",
    "end": "2051690"
  },
  {
    "text": "tools into our network things like that and a lot of the security requirements that we've introduced like cross-site",
    "start": "2051690",
    "end": "2058050"
  },
  {
    "text": "scripting headers and stuff like that we've done a lot of work in the nginx to to do that and it's very customizable so it sits there still",
    "start": "2058050",
    "end": "2065960"
  },
  {
    "text": "thanks for a very nice talk and what you described here looks like it works very",
    "start": "2072980",
    "end": "2080608"
  },
  {
    "text": "nice for HTTP communication between micro services and do you maybe have any",
    "start": "2080609",
    "end": "2088490"
  },
  {
    "text": "like a messaging to communication as well and to have a solution for that as well",
    "start": "2088490",
    "end": "2094310"
  },
  {
    "text": "we're primarily HTTP we have a couple of messaging services but that is an area",
    "start": "2094310",
    "end": "2100109"
  },
  {
    "text": "that we want to expand so we haven't really solved any problem any of this sort of requirements on in a messaging",
    "start": "2100109",
    "end": "2107430"
  },
  {
    "text": "area okay thank you again for the talk thank you",
    "start": "2107430",
    "end": "2114630"
  },
  {
    "text": "very much [Applause] and it's a large breakdown",
    "start": "2114630",
    "end": "2122500"
  }
]