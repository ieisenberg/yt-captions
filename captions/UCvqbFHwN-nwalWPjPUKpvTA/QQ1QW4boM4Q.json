[
  {
    "start": "0",
    "end": "53000"
  },
  {
    "text": "so yeah I'm Melanie I'm here to talk about performing infrastructure migrations scale particularly like",
    "start": "390",
    "end": "8040"
  },
  {
    "text": "everybody's kind of scale so like a pretty large company and so I'm really happy to be here at keep Kron China oh",
    "start": "8040",
    "end": "16580"
  },
  {
    "text": "it's my cooker working yes okay so I'm only I work as a software engineer on the service orchestration team at Airbnb",
    "start": "16580",
    "end": "23070"
  },
  {
    "text": "and our goal is to empower our own engineers to create maintain operate their own services and we use kubernetes",
    "start": "23070",
    "end": "30630"
  },
  {
    "text": "as like the orchestration layer for our services and I want to demonstrate best",
    "start": "30630",
    "end": "36510"
  },
  {
    "text": "practices for migrations yes all right yeah there's like not that many seats in",
    "start": "36510",
    "end": "43829"
  },
  {
    "text": "here but I wanted to demonstrate the best practices for migrations based off my first-hand experience of migrations",
    "start": "43829",
    "end": "51000"
  },
  {
    "text": "Airbnb so I think one of our best migration is case studies discriminatees",
    "start": "51000",
    "end": "56940"
  },
  {
    "start": "53000",
    "end": "53000"
  },
  {
    "text": "itself but also talked about a few more lated migrations that we worked on and like I demonstrate the best practices",
    "start": "56940",
    "end": "63090"
  },
  {
    "text": "from there so today about 70% of our sources are in kubernetes mostly",
    "start": "63090",
    "end": "69420"
  },
  {
    "text": "business facing services versus the legacy system and we have about 300",
    "start": "69420",
    "end": "75330"
  },
  {
    "text": "critical services and kubernetes running in production so what exactly is a",
    "start": "75330",
    "end": "83700"
  },
  {
    "text": "migration because I found that for a lot of people they have different ideas so like you can think about if you use",
    "start": "83700",
    "end": "90720"
  },
  {
    "text": "on-premise versus cloud yeah no sir",
    "start": "90720",
    "end": "97460"
  },
  {
    "text": "[Music] can you hear me now yeah ok cool so yeah",
    "start": "98590",
    "end": "106799"
  },
  {
    "text": "non cloud to cloud VMs to containers configuration management orchestration",
    "start": "106799",
    "end": "112369"
  },
  {
    "text": "API framework changes like if you want to introduce circuit breaking or request",
    "start": "112369",
    "end": "117540"
  },
  {
    "text": "bottling replacing entire systems like we've replaced CI systems build systems",
    "start": "117540",
    "end": "123719"
  },
  {
    "text": "to play systems having a new service process proxy or service mesh new",
    "start": "123719",
    "end": "129810"
  },
  {
    "text": "language framework version so like add a VM upgrade security patches and more so that's like example",
    "start": "129810",
    "end": "139530"
  },
  {
    "text": "list of migrations it kind of goes on and on and for me I like think it's helpful to you to reference migrations",
    "start": "139530",
    "end": "148680"
  },
  {
    "text": "in different dimensions so like when you think about migrations and what a migration is there's like low effort and",
    "start": "148680",
    "end": "156480"
  },
  {
    "text": "high effort migrations so like a security patch technically it's fairly a low effort because you're just bumping",
    "start": "156480",
    "end": "163560"
  },
  {
    "text": "you know like you're a bunch of version or something like that whereas like a very high effort migration would be like going from non",
    "start": "163560",
    "end": "170280"
  },
  {
    "text": "cloud to cloud because you have to somehow like we write everything to work in a cloud environment or",
    "start": "170280",
    "end": "175820"
  },
  {
    "text": "containerization so like now everything has to run in containers and so like the difference here is like are you just",
    "start": "175820",
    "end": "181230"
  },
  {
    "text": "pumping a number I mean we might be more effort than bumping a number but like that slower effort then like something",
    "start": "181230",
    "end": "187320"
  },
  {
    "text": "that involves system design and a retarget xar and like really rethinking how you build things another dimension I",
    "start": "187320",
    "end": "194100"
  },
  {
    "text": "like to think of for migrations is whether it's virgin or discretionary so again like a security patch is fairly",
    "start": "194100",
    "end": "199350"
  },
  {
    "text": "urgent because you want to be more secure immediately as soon as the vulnerability is found and a more",
    "start": "199350",
    "end": "206670"
  },
  {
    "text": "discretionary migration it tends to be things that can take months or years to",
    "start": "206670",
    "end": "212040"
  },
  {
    "text": "unfold and you can't really have a lot of time to do them and so like a very urgent migration the way that you",
    "start": "212040",
    "end": "217560"
  },
  {
    "text": "resource and plan that and the risk you're willing to take on is very different than a discretionary migration",
    "start": "217560",
    "end": "222890"
  },
  {
    "text": "and then the other dimension I like to think about for migrations is like what you need at any scale versus what you",
    "start": "222890",
    "end": "229110"
  },
  {
    "text": "need at a very high scale so there's reassurance you need regardless of scale like upgrading your language or",
    "start": "229110",
    "end": "234450"
  },
  {
    "text": "framework version and then there's migrations that you don't really need to do until you hit a certain scale and then once you get that skill you like we",
    "start": "234450",
    "end": "240269"
  },
  {
    "text": "really need to do that migration and so like some examples of things you need to do at a high scale is like update your",
    "start": "240269",
    "end": "245910"
  },
  {
    "text": "storage layer or your orchestration or your service smash these are things that like when you already have a lot of load",
    "start": "245910",
    "end": "252720"
  },
  {
    "text": "a lot of traffic you'll start to realize that you need these migrations so these",
    "start": "252720",
    "end": "258269"
  },
  {
    "text": "are the three interventions I think of it so different dimensions and you'll kind of realize that all of these dimensions are a little bit related so",
    "start": "258269",
    "end": "265620"
  },
  {
    "text": "for example the higher scale your it's more common that the migration becomes more urgent and also more common",
    "start": "265620",
    "end": "271080"
  },
  {
    "text": "that the migration becomes higher effort so they're kind of all multi-dimensional",
    "start": "271080",
    "end": "276860"
  },
  {
    "text": "so that's kind of how I think of migrations or what they are different dimensions but why are they important",
    "start": "276860",
    "end": "283199"
  },
  {
    "text": "because they're kind of a bit of an effort to do so when you're a very new company and there's actually probably",
    "start": "283199",
    "end": "288780"
  },
  {
    "start": "286000",
    "end": "286000"
  },
  {
    "text": "quite a few new tech companies here in Shanghai you don't really have to worry that much about migration but as our",
    "start": "288780",
    "end": "294210"
  },
  {
    "text": "company matures my patients can become a fact of life so everybody is ten years old now so",
    "start": "294210",
    "end": "299639"
  },
  {
    "text": "that's like a lot of things that I mean like a decade of technology it's really out of date so you're you're sort of",
    "start": "299639",
    "end": "304650"
  },
  {
    "text": "replacing all of the pieces as you go and so you find that as your company grows you accumulate a lot of tech debt",
    "start": "304650",
    "end": "310889"
  },
  {
    "text": "it becomes important to reduce that tech debt to maintain your velocity and your competitive edge so migrations are a way",
    "start": "310889",
    "end": "318360"
  },
  {
    "text": "to reduce this tech debt so like the biggest tech debt for large companies is",
    "start": "318360",
    "end": "324360"
  },
  {
    "text": "low developer velocity or like low developer productivity developers are less productive and less efficient",
    "start": "324360",
    "end": "331110"
  },
  {
    "text": "because of the amount of tech debt but there are more kinds of tech debt that's a little bit more subtle so like when",
    "start": "331110",
    "end": "337349"
  },
  {
    "text": "you're scaling exponentially it's like a hyper growth company you accumulate tech that much faster and so you need to keep",
    "start": "337349",
    "end": "343530"
  },
  {
    "text": "up with the tech debt so here's a few other examples of tech debt that you will run into I'm just like a few you",
    "start": "343530",
    "end": "349830"
  },
  {
    "text": "know scaling limits networking issues systems that have now been end-of-life excetera see how migrations are but",
    "start": "349830",
    "end": "358919"
  },
  {
    "text": "where they're important they're basically the sole lever to systematically create technical leverage",
    "start": "358919",
    "end": "363960"
  },
  {
    "text": "at scale so now that we know what",
    "start": "363960",
    "end": "369570"
  },
  {
    "text": "migrations are and why they're important I want to kind of spend most of the time talking about how do you do migrations",
    "start": "369570",
    "end": "374820"
  },
  {
    "text": "well and like what are the strategies you need to succeed at doing migrations and also think like I'd like some",
    "start": "374820",
    "end": "380070"
  },
  {
    "text": "examples of things that don't go that well so the first thing I think is it's helpful to break vibrations down into",
    "start": "380070",
    "end": "386789"
  },
  {
    "text": "categories or what I call migration types and so I have this nice graph",
    "start": "386789",
    "end": "392720"
  },
  {
    "start": "391000",
    "end": "391000"
  },
  {
    "text": "basically there's three categories like a component update which is what you can think of as an upgrade or a patch a",
    "start": "392720",
    "end": "399390"
  },
  {
    "text": "system which is moving from one system to another and an infrastructure kind of",
    "start": "399390",
    "end": "404880"
  },
  {
    "text": "migration which usually involves rewriting or replacing an entire infrastructure or architecture",
    "start": "404880",
    "end": "411470"
  },
  {
    "text": "so yeah components upgrades such as we factors a system is a move from one",
    "start": "411470",
    "end": "417000"
  },
  {
    "text": "system to another and an infrastructure is really like a huge change and I think",
    "start": "417000",
    "end": "422220"
  },
  {
    "text": "it's very helpful to start here because when people talk about migrations they mean all of these but the strategy is",
    "start": "422220",
    "end": "427710"
  },
  {
    "text": "very different depending on like what kind of migration you're doing so here's",
    "start": "427710",
    "end": "432720"
  },
  {
    "text": "an example for us like we do all these kinds of migrations components like",
    "start": "432720",
    "end": "437940"
  },
  {
    "text": "upgrading systems upgrading Oh operating systems languages deprecating things",
    "start": "437940",
    "end": "444500"
  },
  {
    "text": "yeah as I said replacing like CI CD system or like new service mesh",
    "start": "444500",
    "end": "449880"
  },
  {
    "text": "networking is kind of a system level migration and then infrastructure for a lot of companies is like moving to the",
    "start": "449880",
    "end": "456300"
  },
  {
    "text": "cloud or containerization or capes or like serverless any of those kinds of",
    "start": "456300",
    "end": "461310"
  },
  {
    "text": "things is really like a big infrastructure change and so the",
    "start": "461310",
    "end": "467430"
  },
  {
    "text": "strategies here is to know which type you're working with and like that's really the first step and and also know",
    "start": "467430",
    "end": "474060"
  },
  {
    "text": "that for each you know as you go up in this hierarchy you have exponentially",
    "start": "474060",
    "end": "480240"
  },
  {
    "text": "increasing complexity for each type like it's really more complex to do in a structure we write than a system move and it's more complex than a component",
    "start": "480240",
    "end": "486960"
  },
  {
    "text": "update and so that you should also know that for each of these you're dealing with a lot more complexity a lot more",
    "start": "486960",
    "end": "494520"
  },
  {
    "text": "overhead and therefore it's a lot riskier so it's a bit more dangerous to do a bigger change so for me one of the",
    "start": "494520",
    "end": "505770"
  },
  {
    "text": "most important migration strategies other than just identifying the type of the migration is how are you going to sequence this migration and so I'm gonna",
    "start": "505770",
    "end": "512729"
  },
  {
    "text": "spend a lot of time talking about this because I think what is really complex about migrations at scale is that",
    "start": "512729",
    "end": "519539"
  },
  {
    "text": "they're all interacting with each other and so they're not in isolation they're basically all affecting each other so",
    "start": "519539",
    "end": "527640"
  },
  {
    "text": "basically how do you think about sequencing migrations basically a",
    "start": "527640",
    "end": "533820"
  },
  {
    "text": "complex migration tends to have a lot of dependent migrations that you may have not identified yet and this requires a",
    "start": "533820",
    "end": "540920"
  },
  {
    "text": "sequencing basically planning the migrations one by one and so if you have",
    "start": "540920",
    "end": "546560"
  },
  {
    "text": "a lot of if you don't do migrations very often so if you infrequently run your migrations you actually have a kind of",
    "start": "546560",
    "end": "553400"
  },
  {
    "text": "cascading migration problem and similarly if you are not good at about finishing migrations if your migrations",
    "start": "553400",
    "end": "560120"
  },
  {
    "text": "are inefficient then you have a lot of simultaneous migrations that are all running at the same time and so I like",
    "start": "560120",
    "end": "568700"
  },
  {
    "start": "567000",
    "end": "567000"
  },
  {
    "text": "the term cascading migrations where basically if you really decide oh I",
    "start": "568700",
    "end": "574130"
  },
  {
    "text": "don't want to do a migration today I don't want to do a migration a year from now and then finally you start doing your migration you'll realize that",
    "start": "574130",
    "end": "579350"
  },
  {
    "text": "there's a lot of things you need to do to reach the what I call the ideal migration state like I want to run you",
    "start": "579350",
    "end": "585710"
  },
  {
    "text": "know in kubernetes it's like what are all the things I need to do to get there and if you don't really like plan it and",
    "start": "585710",
    "end": "590900"
  },
  {
    "text": "think about it you'll have a lot of dependent things you need to do first and so like one way to think about it is",
    "start": "590900",
    "end": "597380"
  },
  {
    "text": "if you're if you're very good and careful about planning you don't have to do a rewrite but most people like if",
    "start": "597380",
    "end": "603350"
  },
  {
    "text": "they'd wait too long they kind of have to do that and so there's a lot of complexity involved and so one of the",
    "start": "603350",
    "end": "609260"
  },
  {
    "text": "reasons I like to call it cascading migrations is because it kind of reminds me of like cascading failures which is like a bad state to be in and so it's",
    "start": "609260",
    "end": "616700"
  },
  {
    "text": "kind of like a funny way to talk about it so you don't really want this to happen",
    "start": "616700",
    "end": "621980"
  },
  {
    "text": "and I was also kind of what happened at Airbnb so like we were running a very old configuration management system you",
    "start": "621980",
    "end": "629630"
  },
  {
    "text": "know at this point it's probably five to nine years old so in order to get to kubernetes we really had to make a lot",
    "start": "629630",
    "end": "635210"
  },
  {
    "text": "of changes very quickly so we were already in cloud so it wasn't as big of",
    "start": "635210",
    "end": "640280"
  },
  {
    "text": "a jump but you can imagine that like if you want to go to kubernetes and you don't you're not containerized yet",
    "start": "640280",
    "end": "645950"
  },
  {
    "text": "you're not in the cloud yet these are sort of dependent migrations you have to do first and so if you try to do all",
    "start": "645950",
    "end": "652070"
  },
  {
    "text": "these at once it's just it's a lot riskier so you want to consider doing them incrementally first",
    "start": "652070",
    "end": "659530"
  },
  {
    "start": "662000",
    "end": "662000"
  },
  {
    "text": "okay so simultaneous migrations basically if you're inefficient and",
    "start": "662149",
    "end": "668339"
  },
  {
    "text": "migrations you'll likely be performing a lot of them at the same time so inefficient migrations can cause your",
    "start": "668339",
    "end": "674610"
  },
  {
    "text": "overall velocity to slow down because you're doing all of them at the same time and they don't necessarily depend",
    "start": "674610",
    "end": "682379"
  },
  {
    "text": "on each other so unlike cascading migrations were like you have to do this one and this one to get to the ideal migration state of all these migrations",
    "start": "682379",
    "end": "689160"
  },
  {
    "text": "don't necessarily have to do each other but they still kind of add to the overall complexity of the system and",
    "start": "689160",
    "end": "694230"
  },
  {
    "text": "then juice introduces additional risks",
    "start": "694230",
    "end": "698389"
  },
  {
    "text": "so here's one example basically moving and this is like a real everyb example",
    "start": "700939",
    "end": "707790"
  },
  {
    "text": "except we do way more migrations at the same time but here's three we're doing at the same time right so I'm working on",
    "start": "707790",
    "end": "713309"
  },
  {
    "text": "our kubernetes migration similarly our CI team is trying to replace our CI system because the old one doesn't scale",
    "start": "713309",
    "end": "719670"
  },
  {
    "text": "anymore and our CD team is trying to introduce deployment pipelines so that",
    "start": "719670",
    "end": "724829"
  },
  {
    "text": "developers can like have a canary environment and tester changes better so the first thing you want to ask is are",
    "start": "724829",
    "end": "731759"
  },
  {
    "text": "these migrations really independent like how you like what CI system you use and",
    "start": "731759",
    "end": "738929"
  },
  {
    "text": "what CD system you use actually kind of depends on kubernetes so for example like if you want to use spinnaker or",
    "start": "738929",
    "end": "745259"
  },
  {
    "text": "something like it like that then that's like having any specific to put a CD system and see I also you probably want",
    "start": "745259",
    "end": "752100"
  },
  {
    "text": "something that's containerized so actually these migrations are somewhat related and is each migration making",
    "start": "752100",
    "end": "760019"
  },
  {
    "text": "assumptions about your system so if you start the kate's migration you know at time a and then start your deployment",
    "start": "760019",
    "end": "767100"
  },
  {
    "text": "pipelines migration slightly after are you assuming that you're still in that previous state like will it work once",
    "start": "767100",
    "end": "773399"
  },
  {
    "text": "the other migration is done and so if you have really slow and fast migrations all happening at the same time you may",
    "start": "773399",
    "end": "779670"
  },
  {
    "text": "realize that you didn't account for the finished state of another migration and",
    "start": "779670",
    "end": "785970"
  },
  {
    "text": "so does your migration actually support a mixed state from another migration so this is a really common mistake that",
    "start": "785970",
    "end": "791819"
  },
  {
    "text": "we've had here which is like how can we make sure that in a sense your migration works with all",
    "start": "791819",
    "end": "797940"
  },
  {
    "text": "other states that the system could be in you know this migration is finished this one's not so it's very complex having",
    "start": "797940",
    "end": "803670"
  },
  {
    "text": "all these happen at the same time so what's the strategy here those are kind",
    "start": "803670",
    "end": "809009"
  },
  {
    "start": "807000",
    "end": "807000"
  },
  {
    "text": "of things that can kind of go wrong so like for me I call it sequencing migrations like let's plan and think",
    "start": "809009",
    "end": "814500"
  },
  {
    "text": "about how we're going to do this and so you want to avoid the infrastructure",
    "start": "814500",
    "end": "819720"
  },
  {
    "text": "rewrite so let's let's do a lot of minor migrations early on so we want to make",
    "start": "819720",
    "end": "825209"
  },
  {
    "text": "migrations themselves happen a lot of the times for frequent and very efficient so that we can kind of like",
    "start": "825209",
    "end": "831480"
  },
  {
    "text": "production line do them really quickly and then finally like when you're when",
    "start": "831480",
    "end": "837600"
  },
  {
    "text": "you're doing the migration and try to keep it not too open end it so like let's talk about very specifically what",
    "start": "837600",
    "end": "842670"
  },
  {
    "text": "we're going to build and and not like sort of like you know so very large like let's move to the cloud like can we",
    "start": "842670",
    "end": "848970"
  },
  {
    "text": "break it down into small sequential steps and then finally sequence",
    "start": "848970",
    "end": "856620"
  },
  {
    "text": "migrations are a lot safer so like if you have all these migrations running at the same time that's kind of there's a",
    "start": "856620",
    "end": "862470"
  },
  {
    "text": "lot more risk and different edge cases",
    "start": "862470",
    "end": "866870"
  },
  {
    "text": "so yes strategies lower risk migrations and it requires more planning in time to",
    "start": "868430",
    "end": "875310"
  },
  {
    "text": "get to the states and so one other thing you can do is paralyze migrations that don't have dependencies kind of similar",
    "start": "875310",
    "end": "881790"
  },
  {
    "text": "to a topological sort so one example I have with our communities migration is",
    "start": "881790",
    "end": "887310"
  },
  {
    "text": "like we have several things we need to do first one is we were running a really old version of Java this version of Java",
    "start": "887310",
    "end": "894449"
  },
  {
    "text": "was not container aware so you know if you try to run containers or kubernetes",
    "start": "894449",
    "end": "899699"
  },
  {
    "text": "using this old Java version you know we had problems where the JVM was allocating more resources because it was",
    "start": "899699",
    "end": "906420"
  },
  {
    "text": "allocating resources based on the host and not the container running on the host so all of these containers were",
    "start": "906420",
    "end": "911939"
  },
  {
    "text": "trying to use more memory and more CPU than the machine had the another thing",
    "start": "911939",
    "end": "917610"
  },
  {
    "text": "we had to do is upgrade our service discovery layer so we're only using an old version of service discovery that",
    "start": "917610",
    "end": "923490"
  },
  {
    "text": "works really well when your your hardware doesn't change that often so you have like ec2",
    "start": "923490",
    "end": "929020"
  },
  {
    "text": "yeah Amazon ec2 instances that stay there kind of stick around and they",
    "start": "929020",
    "end": "935440"
  },
  {
    "text": "don't move that often and so the service discoveries layer like can handle that though when you're using kubernetes and you have these pods they're constantly",
    "start": "935440",
    "end": "942190"
  },
  {
    "text": "being rescheduled the service discovery layer kind of breaks down so we had these two upgrades they don't have any",
    "start": "942190",
    "end": "947500"
  },
  {
    "text": "dependencies on each other but they both need to happen before you use containers so like you could start those first then",
    "start": "947500",
    "end": "953620"
  },
  {
    "text": "did a continuation effort and then then do cornice migration so yeah then the",
    "start": "953620",
    "end": "961360"
  },
  {
    "text": "continuation effort and one other thing I want to talk about here is prioritizing migrations so let's say you",
    "start": "961360",
    "end": "968290"
  },
  {
    "start": "962000",
    "end": "962000"
  },
  {
    "text": "have a bunch of migrations that you want to complete what can you do to decide which ones to do first and one way I",
    "start": "968290",
    "end": "976120"
  },
  {
    "text": "like to think about this is you should part i's migrations that make the other migrations easier so one example is we",
    "start": "976120",
    "end": "983500"
  },
  {
    "text": "migrated to infrastructure as code first so we had a lot of infrastructure settings that were not in code like",
    "start": "983500",
    "end": "990310"
  },
  {
    "text": "things like just like a basic Amazon web console so like you didn't you had no",
    "start": "990310",
    "end": "995470"
  },
  {
    "text": "way of really storing that information in a way that developers could edit it so like emphasis codes could be",
    "start": "995470",
    "end": "1001829"
  },
  {
    "text": "kubernetes could be terraform puppet chef anything like this it's better than not storing it as code and once you do",
    "start": "1001829",
    "end": "1008730"
  },
  {
    "text": "that you can actually your migrations could be code refactor once you have Cobie factors you can actually build",
    "start": "1008730",
    "end": "1013920"
  },
  {
    "text": "tooling to automate it so that's really useful if you decide to migrate a bunch of infrastructure before doing this one",
    "start": "1013920",
    "end": "1019860"
  },
  {
    "text": "a lot of that's gonna be very manual migrations and you can't really automate them as easily so this is one of the the",
    "start": "1019860",
    "end": "1025470"
  },
  {
    "text": "biggest things you can do is try to prioritize them cool so that's some",
    "start": "1025470",
    "end": "1033720"
  },
  {
    "text": "basic migration strategies one other thing I want to talk about is like what makes migrating at scale so especially",
    "start": "1033720",
    "end": "1039089"
  },
  {
    "text": "difficult like even if I know to do all these things why do we still have some trouble so I kind of want to come back",
    "start": "1039089",
    "end": "1046949"
  },
  {
    "start": "1046000",
    "end": "1046000"
  },
  {
    "text": "to this graph so like let's say you're thinking about replacing your service mesh and you sort of like forecast that",
    "start": "1046949",
    "end": "1053220"
  },
  {
    "text": "you probably have you know a few months or a year to replace it so you kind of want to do it right you kind of want to",
    "start": "1053220",
    "end": "1058530"
  },
  {
    "text": "like blend out and slowly start migrating your edges and then kind of sort of suddenly you",
    "start": "1058530",
    "end": "1064110"
  },
  {
    "text": "realize that you have like a lot of failures that are unacceptable that",
    "start": "1064110",
    "end": "1069120"
  },
  {
    "text": "suddenly start happening and now like this migration is very urgent whereas before it was not urgent and so this is",
    "start": "1069120",
    "end": "1076320"
  },
  {
    "start": "1075000",
    "end": "1075000"
  },
  {
    "text": "kind of why migration at scale is tough which is like because you have increased scale and you're experiencing peak",
    "start": "1076320",
    "end": "1082169"
  },
  {
    "text": "traffic and peak load your systems may suddenly like hit their limits and not scale anymore and that kind of causes it",
    "start": "1082169",
    "end": "1089610"
  },
  {
    "text": "to be urgent so like because it wasn't urgent before",
    "start": "1089610",
    "end": "1094860"
  },
  {
    "text": "but now that you're at the scale it is urgent and like what I'd like to call that is sort of forced urgency where is",
    "start": "1094860",
    "end": "1101490"
  },
  {
    "text": "if you are able to properly forecast or plan for this then and like and finish",
    "start": "1101490",
    "end": "1107520"
  },
  {
    "text": "the migration before it becomes urgent then you kind of have all this time but if you don't really foresee it then like",
    "start": "1107520",
    "end": "1114240"
  },
  {
    "text": "once you're there you suddenly have to do the migration and now it is urgent and so this is actually really common",
    "start": "1114240",
    "end": "1119790"
  },
  {
    "text": "when you're like when you're working for a company you know that's out of scale that not that many other companies are at where you sort of have to do a bit",
    "start": "1119790",
    "end": "1126660"
  },
  {
    "text": "more due diligence on like planning for these events and then finally the other",
    "start": "1126660",
    "end": "1132120"
  },
  {
    "text": "thing that makes it difficult when you're at scale is just like the sheer effort involved so like for us the COO",
    "start": "1132120",
    "end": "1137400"
  },
  {
    "text": "Benes migration has been you know at least a one to two year effort and we're",
    "start": "1137400",
    "end": "1142440"
  },
  {
    "text": "not done yet like right over at 70% so why does it take so long to migrate and the part of that is because of just the",
    "start": "1142440",
    "end": "1148500"
  },
  {
    "text": "surface area so imagine if you only have one service or like one database or",
    "start": "1148500",
    "end": "1153510"
  },
  {
    "text": "whatever it is that you need to migrate so you do spend some amount of time making it possible to do the migration",
    "start": "1153510",
    "end": "1158700"
  },
  {
    "text": "and then you do that flip switch and then you've migrated so but for us it's",
    "start": "1158700",
    "end": "1163830"
  },
  {
    "text": "like well what if you have ten services or a hundred services or a thousand services and then you really start",
    "start": "1163830",
    "end": "1169020"
  },
  {
    "text": "getting into like you can't just manually be switching these things over because it's just going to take too long",
    "start": "1169020",
    "end": "1174049"
  },
  {
    "text": "and it's just there's more effort in migrating and then the other thing is it's sort of like when you have that",
    "start": "1174049",
    "end": "1180690"
  },
  {
    "text": "many cases you're more likely to have weird services or special services and",
    "start": "1180690",
    "end": "1185880"
  },
  {
    "text": "like you start getting into sort of edge cases oh sorry I forgot to click so yeah",
    "start": "1185880",
    "end": "1192090"
  },
  {
    "text": "basically you have to migrate more services and a zinc increased effort because this there's more complex services involved",
    "start": "1192090",
    "end": "1200919"
  },
  {
    "text": "so like for example here's one other migration we've been working on which is we want to split your epoxy it's from H",
    "start": "1201820",
    "end": "1209000"
  },
  {
    "text": "epoxy to envoy epoxy this works for maybe any proxy change you have to do anything to do with service discovery",
    "start": "1209000",
    "end": "1216110"
  },
  {
    "text": "you basically have way more services all of those services talk to each other MC have this very complex like graph of",
    "start": "1216110",
    "end": "1223700"
  },
  {
    "text": "services all like all these edges talking to each other and now like",
    "start": "1223700",
    "end": "1229270"
  },
  {
    "text": "because you're having problems with your permit like you're replacing your proxy because you're having problems with your",
    "start": "1229270",
    "end": "1234890"
  },
  {
    "text": "previous proxy but this means that like as long as you haven't migrated to the new proxy whatever problems you have are",
    "start": "1234890",
    "end": "1242260"
  },
  {
    "text": "exponentially getting worse as like more and more sources are added and more edges are added so it's sort of",
    "start": "1242260",
    "end": "1248300"
  },
  {
    "text": "compounding with the number of edges so for me the biggest thing here is to try",
    "start": "1248300",
    "end": "1255530"
  },
  {
    "text": "to forecast expected load and do like load testing and chaos testing to try to",
    "start": "1255530",
    "end": "1260600"
  },
  {
    "text": "catch these things before you're there and the other thing is to try to do a stress test your system for actual load",
    "start": "1260600",
    "end": "1267550"
  },
  {
    "text": "and so try to get ahead of this problem with long term planning and forecasting",
    "start": "1267550",
    "end": "1272770"
  },
  {
    "text": "and like realize that if you sort of fail to do that you're in a different state so you're either you're either",
    "start": "1272770",
    "end": "1278930"
  },
  {
    "text": "doing it long term planning and you're doing it well but as soon as you realize that you're like have a short term time",
    "start": "1278930",
    "end": "1286160"
  },
  {
    "text": "to do it then realize you're on fire fighting and now you need to move very quickly and so there's like ideally",
    "start": "1286160",
    "end": "1291380"
  },
  {
    "text": "you're doing the forecasting in the stress testing but once once you realize you're having problems you might need to have a very aggressive timeline so one",
    "start": "1291380",
    "end": "1302930"
  },
  {
    "text": "other strategy I have here actually this is even more important which is make time work for you so basically try to",
    "start": "1302930",
    "end": "1309740"
  },
  {
    "text": "deprecate the old thing first so I talked about how you have like exponentially more edges right how can",
    "start": "1309740",
    "end": "1316250"
  },
  {
    "text": "we how can we make it so you don't have this exponential problem so make the new approach the default as soon as you can",
    "start": "1316250",
    "end": "1323120"
  },
  {
    "text": "and then what instead of instead of like sort of racing against trying to migrate things as they're sort of popping up you",
    "start": "1323120",
    "end": "1329810"
  },
  {
    "text": "actually have like all the new things are already migrated because they're using the new thing and so now you just",
    "start": "1329810",
    "end": "1335240"
  },
  {
    "text": "need to migrate all of the legacy things so one example here is our this is our",
    "start": "1335240",
    "end": "1342590"
  },
  {
    "text": "infrastructure is code so I have like a bunk service and it has an underscore info directory and this directory",
    "start": "1342590",
    "end": "1348920"
  },
  {
    "text": "actually has all of our service configuration so we basically wanted to",
    "start": "1348920",
    "end": "1354620"
  },
  {
    "text": "move source configuration to each service so this is in my bunk service and since we have exponentially more",
    "start": "1354620",
    "end": "1361640"
  },
  {
    "text": "services being created we actually created a generator that generates the new services using the approach and so",
    "start": "1361640",
    "end": "1369080"
  },
  {
    "text": "when we had new service is being created they're already using this thing and then now all we have to do is we can",
    "start": "1369080",
    "end": "1374660"
  },
  {
    "text": "kind of like like take a sigh and just migrate all of the old things if you",
    "start": "1374660",
    "end": "1380090"
  },
  {
    "text": "don't do this you're gonna constantly be trying to catch up to this new source is being created and then trying to migrate",
    "start": "1380090",
    "end": "1386900"
  },
  {
    "text": "them as they're being created so this is a really really good strategy one other",
    "start": "1386900",
    "end": "1394220"
  },
  {
    "text": "thing I want talking about was migration overhead so basically when you do a migration I talked about how it reduces",
    "start": "1394220",
    "end": "1400520"
  },
  {
    "text": "tech debt how it creates technical leverage but while you're doing the migration itself it actually introduces",
    "start": "1400520",
    "end": "1408280"
  },
  {
    "text": "complexity to your system because you're dealing with a mixed state so migrating",
    "start": "1408280",
    "end": "1413390"
  },
  {
    "text": "is actually an explicit trade-off between taking on overhead now to reduce the worst overhead later so it creates",
    "start": "1413390",
    "end": "1422330"
  },
  {
    "text": "overhead for those who are running the migration effort for those who are actually migrating and as well as for",
    "start": "1422330",
    "end": "1428480"
  },
  {
    "text": "those who are maintaining the old thing and the new thing so talking about our",
    "start": "1428480",
    "end": "1434360"
  },
  {
    "text": "proxy change you basically have exponentially more sources and edges and you have a bunch",
    "start": "1434360",
    "end": "1439760"
  },
  {
    "text": "of different ways to use some I don't know if you've ever looked at like all of envoys documentation but it's like",
    "start": "1439760",
    "end": "1446000"
  },
  {
    "text": "it's a lot so like you know imagine if you're trying to use all of these features and so you're basically trying",
    "start": "1446000",
    "end": "1452480"
  },
  {
    "text": "to for us we're trying to patch how we use H epoxy while building out the new",
    "start": "1452480",
    "end": "1458270"
  },
  {
    "text": "thing so there's a lot of overhead and maintain the next state and so this overhead kind",
    "start": "1458270",
    "end": "1465980"
  },
  {
    "start": "1463000",
    "end": "1463000"
  },
  {
    "text": "of looks like this where you want to reduce the tech debt via migration so developers want this they basically",
    "start": "1465980",
    "end": "1472220"
  },
  {
    "text": "wants to spend some time reducing tech debt and the rest of the time actually working on what they work on and what",
    "start": "1472220",
    "end": "1479630"
  },
  {
    "text": "developers actually get if you're not careful is making progress on their thing and then us saying oh can you",
    "start": "1479630",
    "end": "1485509"
  },
  {
    "text": "migrate all these things and like actually at Airbnb we counted how many migration tasks we were asking",
    "start": "1485509",
    "end": "1491419"
  },
  {
    "text": "developers to do and it was over 40 migrations so like developers were like freaking",
    "start": "1491419",
    "end": "1497629"
  },
  {
    "start": "1494000",
    "end": "1494000"
  },
  {
    "text": "out because they're trying to make progress on the product and we're asking them to migrate all these things even if",
    "start": "1497629",
    "end": "1503480"
  },
  {
    "text": "each migration is like fairly simple there's no way they can do all of these things so we basically have this problem",
    "start": "1503480",
    "end": "1511580"
  },
  {
    "start": "1510000",
    "end": "1510000"
  },
  {
    "text": "where if you have worsening tech debt and you start a new migration and then",
    "start": "1511580",
    "end": "1516620"
  },
  {
    "text": "you don't really finish the migration you actually just get worse tech debt again because you have this super complex system and so this is something",
    "start": "1516620",
    "end": "1525110"
  },
  {
    "text": "you really want to be careful of because basically I kind of also think of it",
    "start": "1525110",
    "end": "1530539"
  },
  {
    "text": "like bingo so like each of these is a different state in your system so maybe you know you're using this system is",
    "start": "1530539",
    "end": "1537289"
  },
  {
    "text": "using the old CI but you know kubernetes and the old CD or the new CD or you know like whatever it's like using all these",
    "start": "1537289",
    "end": "1543139"
  },
  {
    "text": "different things and so you have a bunch of problems where future migrations are",
    "start": "1543139",
    "end": "1548210"
  },
  {
    "text": "now harder because you're trying to support all these different NIC States tech debt was worse because developers",
    "start": "1548210",
    "end": "1553730"
  },
  {
    "text": "aren't really sure what they're using and like how to fix certain problems and and mainly there's a bunch of edge cases",
    "start": "1553730",
    "end": "1559429"
  },
  {
    "text": "that you just don't account for and so I kind of call that like the bingo which is you hit an edge case that's like so",
    "start": "1559429",
    "end": "1565090"
  },
  {
    "text": "subtle and so like so few services are running into it but like because of all",
    "start": "1565090",
    "end": "1571220"
  },
  {
    "text": "of the mixtape that's like why they're hitting it so you don't want your infrastructure to look like this so",
    "start": "1571220",
    "end": "1579799"
  },
  {
    "text": "basically for me the biggest thing here is unfinished migrations actually make teched-out worse so you really need to",
    "start": "1579799",
    "end": "1586669"
  },
  {
    "text": "finish each migration and I have a few strategies to end on with that which is",
    "start": "1586669",
    "end": "1592820"
  },
  {
    "text": "basically how we make it so migrations are finished so developing abstractions over the intra",
    "start": "1592820",
    "end": "1599690"
  },
  {
    "text": "infrastructure is very important so you want to make the current migration easier but you also want to avoid leaky",
    "start": "1599690",
    "end": "1606440"
  },
  {
    "text": "abstractions so that the future migrations are also easier so like one",
    "start": "1606440",
    "end": "1612110"
  },
  {
    "text": "example I have here is like the kubernetes files so we have all these",
    "start": "1612110",
    "end": "1617660"
  },
  {
    "text": "kubernetes configuration files and we built an internal abstraction over them because we know that in the future you",
    "start": "1617660",
    "end": "1625250"
  },
  {
    "text": "know five years from now we won't be using kubernetes will be using the next technology so how can we make it a",
    "start": "1625250",
    "end": "1630500"
  },
  {
    "text": "little bit better now so these are all concepts on the left that Airbnb engineers are mostly familiar with and",
    "start": "1630500",
    "end": "1636950"
  },
  {
    "text": "so we're telling them like you know we're trying to make them not think too much about whether they're using kubernetes or not and so this is our",
    "start": "1636950",
    "end": "1643100"
  },
  {
    "text": "abstraction but one thing I realize is like actually this abstraction still leaks several things like the containers",
    "start": "1643100",
    "end": "1650150"
  },
  {
    "text": "and like some some of the kubernetes settings actually we didn't fully abstract them away so like what's the",
    "start": "1650150",
    "end": "1655790"
  },
  {
    "text": "better abstraction and so this is actually what we're working on now which is like what if we have like a manifest",
    "start": "1655790",
    "end": "1661820"
  },
  {
    "text": "that just says you know this is my service it uses a lot of resources or a few resources you know it's a web",
    "start": "1661820",
    "end": "1668060"
  },
  {
    "text": "service or a cron job or like a workload and like these are the services it calls",
    "start": "1668060",
    "end": "1674210"
  },
  {
    "text": "these are the other services it calls and like can we just limit it down to that so that like when we might get to",
    "start": "1674210",
    "end": "1679580"
  },
  {
    "text": "the next thing there's actually no effort at all on the service developer side and like actually we migrate the",
    "start": "1679580",
    "end": "1686030"
  },
  {
    "text": "whole thing in service developers don't know that they're using kubernetes and they don't know that they're using the next thing so we're kind of talking",
    "start": "1686030",
    "end": "1691160"
  },
  {
    "text": "about building a like a whole platform on top of this and so this is this is like something I kind of want to build",
    "start": "1691160",
    "end": "1697790"
  },
  {
    "text": "internally and we also want to do this for our for our service discovery layer so like as we migrate to envoy and as we",
    "start": "1697790",
    "end": "1705110"
  },
  {
    "text": "migrate to this thing after envoy we want to make it as easy as possible and so this is this is a strategy for from",
    "start": "1705110",
    "end": "1711980"
  },
  {
    "text": "me for Airbnb but I think actually this is a strategy where the old the whole industry is going so today when you're",
    "start": "1711980",
    "end": "1718610"
  },
  {
    "text": "configuring kubernetes you probably get frustrated by just the amount of configuration that you're doing so like",
    "start": "1718610",
    "end": "1723980"
  },
  {
    "text": "I think in the future this will become a lot easier but we're still working on building platform and so that's sort of like how",
    "start": "1723980",
    "end": "1729930"
  },
  {
    "text": "can we make migrations that are as like a kubernetes you know community and so",
    "start": "1729930",
    "end": "1735150"
  },
  {
    "text": "that's something I've been thinking about a lot and so here's some other strategies basically when you're",
    "start": "1735150",
    "end": "1742620"
  },
  {
    "text": "thinking about migrating can you standardize on something that 90% it's like 90% correct for most cases and can",
    "start": "1742620",
    "end": "1749790"
  },
  {
    "text": "we automatically migrate that case and so then like can we migrate under an",
    "start": "1749790",
    "end": "1754800"
  },
  {
    "text": "abstraction layer so developers aren't aware that we're migrating and then finally can we migrate programmatically",
    "start": "1754800",
    "end": "1760890"
  },
  {
    "text": "so can we do code we factors to migrate people so we have something called a",
    "start": "1760890",
    "end": "1767610"
  },
  {
    "start": "1766000",
    "end": "1766000"
  },
  {
    "text": "factor rater to perform three factors it's basically because we have infrastructure as code",
    "start": "1767610",
    "end": "1774090"
  },
  {
    "text": "now we've unlocked it automated automatically factors and basically this",
    "start": "1774090",
    "end": "1780390"
  },
  {
    "text": "process is a bunch of scripts that kind of cover the whole refactor itself so if",
    "start": "1780390",
    "end": "1786630"
  },
  {
    "text": "you think of like how every factor should look basically we have kubernetes",
    "start": "1786630",
    "end": "1791700"
  },
  {
    "start": "1789000",
    "end": "1789000"
  },
  {
    "text": "cron job that runs and it can look at a look at a code base and know what stated",
    "start": "1791700",
    "end": "1797430"
  },
  {
    "text": "is in and what state we want it to get into like run the V factor so it has this logic where it basically can check",
    "start": "1797430",
    "end": "1803340"
  },
  {
    "text": "out the repo find the project in the repo run the V factor job that gets it to state B and then tags the owners of",
    "start": "1803340",
    "end": "1811380"
  },
  {
    "text": "the service and creates the PR so no developer does this the developer writes",
    "start": "1811380",
    "end": "1816390"
  },
  {
    "text": "the refactor job so it has you need to be able to add input say go from state a to state B but the rest of this is",
    "start": "1816390",
    "end": "1822600"
  },
  {
    "text": "automatic so the refactor job will run and create the PR and then the refactor",
    "start": "1822600",
    "end": "1827760"
  },
  {
    "text": "job also can like comment on the PR telling hey like can you please look at this owners can you please edit or merge",
    "start": "1827760",
    "end": "1834810"
  },
  {
    "text": "the PR and then as well we have the V factory job it can just merge the PR so",
    "start": "1834810",
    "end": "1841980"
  },
  {
    "text": "we actually have some many factors with no developer involvement at all we just run it create the PR merge the PR so",
    "start": "1841980",
    "end": "1848640"
  },
  {
    "text": "like you can imagine so a lot of our services use stonker files they inherit",
    "start": "1848640",
    "end": "1854790"
  },
  {
    "text": "from some base image if we realize the base image needs to pick up a security fix so we can run our refactor and like",
    "start": "1854790",
    "end": "1860790"
  },
  {
    "text": "I'm immediately give everyone the new security fix without them being involved um so that's really powerful we're not",
    "start": "1860790",
    "end": "1868090"
  },
  {
    "start": "1866000",
    "end": "1866000"
  },
  {
    "text": "asking the developers to do it we're just doing it automatically and so what",
    "start": "1868090",
    "end": "1873190"
  },
  {
    "text": "can we do automatically so that like what communities version you're using that can be automated based image",
    "start": "1873190",
    "end": "1879190"
  },
  {
    "text": "upgrades like for security patches we can do that programmatically security patches changing the CI CD system is a",
    "start": "1879190",
    "end": "1885850"
  },
  {
    "text": "little bit tricky but we've done that we did that about like 90 percent automatically for our CI immigration",
    "start": "1885850",
    "end": "1891789"
  },
  {
    "text": "like two or three weeks ago so we basically ran a V factor that created a new created the new CI job and",
    "start": "1891789",
    "end": "1898899"
  },
  {
    "text": "then if the new CI job passed then we would merge it and if it failed that means that developers had to kind of",
    "start": "1898899",
    "end": "1904450"
  },
  {
    "text": "like look into why the new CI was failing some other things also and I",
    "start": "1904450",
    "end": "1910059"
  },
  {
    "text": "wanted to end on the migration program so basically when you think about your",
    "start": "1910059",
    "end": "1916059"
  },
  {
    "start": "1914000",
    "end": "1914000"
  },
  {
    "text": "migration strategy what are what is your migration strategy do you make one person do all of it and I think maybe if",
    "start": "1916059",
    "end": "1923200"
  },
  {
    "text": "you're a very small company you can make one person do all of it and what's nice about that is it's a very tight feedback",
    "start": "1923200",
    "end": "1929230"
  },
  {
    "text": "loop because they're doing the whole thing but what doesn't work is that if you have a huge company you can't do the",
    "start": "1929230",
    "end": "1934960"
  },
  {
    "text": "whole thing one other thing we do is make devs do all of it so we basically ask them hey so I asked developers can",
    "start": "1934960",
    "end": "1943059"
  },
  {
    "start": "1935000",
    "end": "1935000"
  },
  {
    "text": "you migrate this problem with this approach is that everyone's always asking developers to migrate are they",
    "start": "1943059",
    "end": "1949029"
  },
  {
    "text": "actually going to do the migration how do we make sure that we finish the migrations because I just talked about how bad it is if migrations are left",
    "start": "1949029",
    "end": "1955629"
  },
  {
    "text": "unfinished so if we want to actually finish the migrations we need a migration team that owns the migration",
    "start": "1955629",
    "end": "1962590"
  },
  {
    "start": "1958000",
    "end": "1958000"
  },
  {
    "text": "end-to-end and figures out how to make it as efficient and frequent as possible",
    "start": "1962590",
    "end": "1968850"
  },
  {
    "text": "so in our case like we have a kubernetes migration team that actually is running",
    "start": "1968850",
    "end": "1975070"
  },
  {
    "text": "this effort and you know I'm part of that team oh sorry there's one other",
    "start": "1975070",
    "end": "1980440"
  },
  {
    "text": "thing I wanna talk about which is the life cycle how do you know whether you actually want to do a migration or like how do you do it so you start with a",
    "start": "1980440",
    "end": "1987039"
  },
  {
    "text": "design document and a prototype and you stress test but one thing you should make careful here is that you need to",
    "start": "1987039",
    "end": "1993700"
  },
  {
    "text": "make sure that the technology are using really works for your hardest cases so like high load",
    "start": "1993700",
    "end": "1998980"
  },
  {
    "text": "high traffic don't start with the easiest case and assume that you have validated your migration so make sure",
    "start": "1998980",
    "end": "2004650"
  },
  {
    "text": "that it works with like low throughput high latency you know all these requirements that you have so really",
    "start": "2004650",
    "end": "2010320"
  },
  {
    "text": "make sure that it works don't don't just like you have a simple prototype and assume it'll work when you get to really complex cases so we did that and then an",
    "start": "2010320",
    "end": "2018900"
  },
  {
    "text": "enable phase is basically building that abstraction layer and writing the documentation and code labs and then",
    "start": "2018900",
    "end": "2025230"
  },
  {
    "text": "programmatically migrating everything so once you really think the migrations ready to go you have all of this tooling",
    "start": "2025230",
    "end": "2031500"
  },
  {
    "text": "like this is the phase where you really want to spend your time building good documentation and tooling and a good",
    "start": "2031500",
    "end": "2036510"
  },
  {
    "text": "abstraction layer because this is what's gonna make future migrations better and then the finish phase is the things",
    "start": "2036510",
    "end": "2043350"
  },
  {
    "text": "we're still in but basically you want to iterate until you fully migrate the system so we're so we've we've program I",
    "start": "2043350",
    "end": "2050398"
  },
  {
    "text": "grated you know 70% of our services but we still have 30% services that is very complex so we're working with the",
    "start": "2050399",
    "end": "2056220"
  },
  {
    "text": "service owners to migrate those last ones so we out we just we have like 10 years of services so it's a lot so yeah",
    "start": "2056220",
    "end": "2064138"
  },
  {
    "text": "the finish phase and I wanted to leave time for the 10 takeaways basically you",
    "start": "2064139",
    "end": "2070980"
  },
  {
    "text": "want to identify a migration type you want to run frequent efficient and tightly scoped migrations you want to do",
    "start": "2070980",
    "end": "2078570"
  },
  {
    "text": "migrations sequencing like prioritization and planning them and you want to actually stress tests in forecast migrations before they become",
    "start": "2078570",
    "end": "2085470"
  },
  {
    "text": "urgent you want to make the new approach the default so that time is working for you not against you and you want to",
    "start": "2085470",
    "end": "2091950"
  },
  {
    "text": "fully finish the migrations to reduce tech debt you want to develop abstractions over the infrastructure and",
    "start": "2091950",
    "end": "2098310"
  },
  {
    "text": "run migrations as code be factors and then when you actually think about the migration we need to run a migration",
    "start": "2098310",
    "end": "2103770"
  },
  {
    "text": "program with a life cycle and then you need to iterate on the migration until it's fully vetted enabled and finished",
    "start": "2103770",
    "end": "2109640"
  },
  {
    "text": "and I'm out of time ok thank you",
    "start": "2109640",
    "end": "2115070"
  },
  {
    "text": "[Applause]",
    "start": "2115070",
    "end": "2118760"
  }
]