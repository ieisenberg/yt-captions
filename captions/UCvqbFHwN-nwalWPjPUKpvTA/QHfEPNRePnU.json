[
  {
    "text": "everyone uh welcome to our workshop this is the",
    "start": "80",
    "end": "5200"
  },
  {
    "text": "almost like a part two of the previous workshop that linden lin's workshop was more on how to",
    "start": "5200",
    "end": "10880"
  },
  {
    "text": "install sdo and how to use istio whereas this one is going to slightly to take a different angle and and focus more on",
    "start": "10880",
    "end": "18160"
  },
  {
    "text": "like the sre role of how to deploy istio for production how to use production components not",
    "start": "18160",
    "end": "24480"
  },
  {
    "text": "just the stuff that comes out of the box as samples and then some debugging tools so that as an sre",
    "start": "24480",
    "end": "31760"
  },
  {
    "text": "or like in your production environment when something goes wrong how can you debug exactly what's happening without",
    "start": "31760",
    "end": "37520"
  },
  {
    "text": "knowing too much about the application itself but just being able to introspect the network",
    "start": "37520",
    "end": "42719"
  },
  {
    "text": "um you i think everyone here has been in the previous lab if you haven't you know go to play.instruct.com and make an account",
    "start": "42719",
    "end": "51039"
  },
  {
    "text": "and then a little bit about me i'm also a field engineer at solo",
    "start": "51039",
    "end": "56559"
  },
  {
    "text": "i work with our customers to make sure that they're happy in their adoption of",
    "start": "56559",
    "end": "62160"
  },
  {
    "text": "kubernetes envoy istio service mesh you know whatever the technologies so we're kind of solution architects developer",
    "start": "62160",
    "end": "68479"
  },
  {
    "text": "advocates customer support engineers we kind of do it all and we're hiring",
    "start": "68479",
    "end": "74799"
  },
  {
    "text": "i think you've heard a pitch about solo a couple of times already so i'm going to skip over that",
    "start": "74799",
    "end": "80720"
  },
  {
    "text": "the two main products that we have are glue mesh which is our enterprise istio and then glue edge which is our",
    "start": "80720",
    "end": "86080"
  },
  {
    "text": "enterprise envoy that sits at the edge and then with glue mesh we also have a gateway solution that brings in all of",
    "start": "86080",
    "end": "92880"
  },
  {
    "text": "the api gateway functionality to the istio ingress gateway",
    "start": "92880",
    "end": "98479"
  },
  {
    "text": "we have various other sessions in the day i think we're like halfway through the day so",
    "start": "98479",
    "end": "104399"
  },
  {
    "text": "the the other session that we have is multi-cluster service mesh later on in the day at 3 30 p.m that another field",
    "start": "104399",
    "end": "110720"
  },
  {
    "text": "engineer from solo will be running and it'll be in here i'll be moderating in here like like i did this morning",
    "start": "110720",
    "end": "118159"
  },
  {
    "text": "okay again we're going to be using the instruct platform the the link to this workshop is at the bottom of my",
    "start": "118320",
    "end": "125200"
  },
  {
    "text": "screen um eric will also share this in service meshcon slack channel",
    "start": "125200",
    "end": "131920"
  },
  {
    "text": "it should also be available on the main cncf",
    "start": "131920",
    "end": "137840"
  },
  {
    "text": "the session page can i get like you know a thumbs up that most people are able to access this",
    "start": "138160",
    "end": "146480"
  },
  {
    "text": "cool i'm still going to wait probably a minute or so so that the people on",
    "start": "146720",
    "end": "152720"
  },
  {
    "text": "uh that are joining in virtually are able to access this",
    "start": "152720",
    "end": "157840"
  },
  {
    "text": "cool so once you once you click this link",
    "start": "157840",
    "end": "163440"
  },
  {
    "text": "you'll see the track you basically add it to your study room and then you start it and then once you",
    "start": "163440",
    "end": "169519"
  },
  {
    "text": "start it it sets up the environment it sets up your kubernetes cluster so that process takes about a couple minutes so",
    "start": "169519",
    "end": "176160"
  },
  {
    "text": "while that's running i'm going to kind of move forward",
    "start": "176160",
    "end": "181640"
  },
  {
    "text": "so the people in the room are experts and struck now so this should go much more smoothly",
    "start": "184640",
    "end": "190720"
  },
  {
    "text": "the first portion of our lab we're going to put a steel aside for a while and understand envoy a little bit better",
    "start": "190720",
    "end": "199440"
  },
  {
    "text": "and this is important so that when things are not working well you're able to see",
    "start": "199440",
    "end": "204480"
  },
  {
    "text": "what istio did to envoy to achieve the the functionality whether it's you",
    "start": "204480",
    "end": "209920"
  },
  {
    "text": "know traffic routing or mtls or request transformation",
    "start": "209920",
    "end": "215200"
  },
  {
    "text": "the istios api all it's doing is it's converting",
    "start": "215200",
    "end": "220640"
  },
  {
    "text": "your simple istu api to thousands of lines of envoy configuration and then pushing it to all",
    "start": "220640",
    "end": "226799"
  },
  {
    "text": "the various pods and then it can scope it down um it can export it to the right name",
    "start": "226799",
    "end": "232640"
  },
  {
    "text": "spaces et cetera so it knows what pods need to talk to what pods so it's able to program each envoy intelligently it's",
    "start": "232640",
    "end": "238799"
  },
  {
    "text": "a control plane so let's do that so so this lab all we're going to do",
    "start": "238799",
    "end": "244480"
  },
  {
    "text": "we're going to deploy the sleep sample an http bin sample so two different apps",
    "start": "244480",
    "end": "250239"
  },
  {
    "text": "we're going to go to http bin directly and then we're going to install on install envoy and then go through envoy",
    "start": "250239",
    "end": "257759"
  },
  {
    "text": "to reach http bin to kind of see the difference",
    "start": "257759",
    "end": "262560"
  },
  {
    "text": "okay so with that um everybody should be like on a page like this right i'm",
    "start": "262800",
    "end": "269040"
  },
  {
    "text": "running a non-voice server then i'll click start",
    "start": "269040",
    "end": "274400"
  },
  {
    "text": "okay so let's see if you're able to see the screen",
    "start": "276240",
    "end": "281840"
  },
  {
    "text": "i'm gonna go full screen and then zoom in can i get a thumbs up that everything",
    "start": "281840",
    "end": "288240"
  },
  {
    "text": "looks good on the screen okay cool first part we're just gonna install the http bin and sleep yaml",
    "start": "288240",
    "end": "296000"
  },
  {
    "text": "you can just click in this box and it does the copy for you just a quick shortcut so",
    "start": "296000",
    "end": "302000"
  },
  {
    "text": "um you know if you click in this the code box then it'll copy it and then you paste it in the terminal window so it",
    "start": "302000",
    "end": "308560"
  },
  {
    "text": "deploys the http bin app and then it deploys the sleep app so once that's done give it a couple of",
    "start": "308560",
    "end": "314800"
  },
  {
    "text": "seconds and then the next command will exec into the sleep container",
    "start": "314800",
    "end": "321840"
  },
  {
    "text": "and then call your http bin container and it's going to call slash headers so then http bin",
    "start": "321840",
    "end": "329520"
  },
  {
    "text": "will respond back basically whatever headers that you passed it and anything else that it adds so you",
    "start": "329520",
    "end": "335440"
  },
  {
    "text": "know pretty straightforward there's really nothing there it's saying that you called me from carl this is the host that you called me on and nothing else",
    "start": "335440",
    "end": "344800"
  },
  {
    "text": "so next let's deploy envoy envoy reads its configuration from",
    "start": "345520",
    "end": "351360"
  },
  {
    "text": "multiple ways you can statically declare it using this envoy conf yaml that we're",
    "start": "351360",
    "end": "356560"
  },
  {
    "text": "going to show or you can also program it dynamically using its xds api but for now let's just look at you know a static",
    "start": "356560",
    "end": "362880"
  },
  {
    "text": "definition so this is so if i open up",
    "start": "362880",
    "end": "368560"
  },
  {
    "text": "if i do a cat on envoy comp.yaml that already exists in this in this",
    "start": "368560",
    "end": "373600"
  },
  {
    "text": "environment uh we can see some admin configuration it's showing that you know",
    "start": "373600",
    "end": "379600"
  },
  {
    "text": "you know where to save the access log what port the admin port is listening on and then the static resources is the",
    "start": "379600",
    "end": "387120"
  },
  {
    "text": "config is all the config that you need to tell envoy if you receive traffic on this",
    "start": "387120",
    "end": "392560"
  },
  {
    "text": "port i want you to to direct you know do whatever envoy things you have to do and then direct",
    "start": "392560",
    "end": "398960"
  },
  {
    "text": "traffic to your the http bin app so what we're trying to do is use envoy as a proxy so this is just saying that i want",
    "start": "398960",
    "end": "406000"
  },
  {
    "text": "to create an http filter and then this is my route config",
    "start": "406000",
    "end": "411280"
  },
  {
    "text": "over here i want to listen on all domains all prefix for for your route matching and then i",
    "start": "411280",
    "end": "418400"
  },
  {
    "text": "want to send it to this http bin service cluster cluster and envoy terminology is",
    "start": "418400",
    "end": "423599"
  },
  {
    "text": "basically like a set of endpoints these are your destinations that that envoy will direct traffic to and then that",
    "start": "423599",
    "end": "430000"
  },
  {
    "text": "clusters is defined on the bottom so it's going to define that http bin service that you see up here down here",
    "start": "430000",
    "end": "437440"
  },
  {
    "text": "okay so that's my very simple envoy config that's about you know as simple as it gets",
    "start": "437440",
    "end": "444080"
  },
  {
    "text": "so then let's create a config map out of that configuration apply that",
    "start": "444080",
    "end": "449759"
  },
  {
    "text": "config map to my kubernetes cluster and then deploy envoy proxy",
    "start": "449759",
    "end": "456080"
  },
  {
    "text": "so it's going to be another pod another container so now you have three containers http bin sleep and envoy",
    "start": "456080",
    "end": "465840"
  },
  {
    "text": "when you ran your exact command before we exact and to sleep and went directly to http bin but now we're going to exec",
    "start": "468800",
    "end": "475120"
  },
  {
    "text": "into sleep but instead of going to http bin we're going to call envoy and then we're going to do slash",
    "start": "475120",
    "end": "480879"
  },
  {
    "text": "headers but we've configured envoy to direct all traffic to http bin so let's do that",
    "start": "480879",
    "end": "488000"
  },
  {
    "text": "so now we have a couple of additional headers you can see the host envoy so",
    "start": "489039",
    "end": "494240"
  },
  {
    "text": "that means that you know envoys is your proxy that accept that request that received this curl command and then",
    "start": "494240",
    "end": "500319"
  },
  {
    "text": "forward it on to the http bin service uh you can also see this x envoy",
    "start": "500319",
    "end": "506960"
  },
  {
    "text": "expected timeout um so the timeout configuration that we defined in our envoy config you",
    "start": "506960",
    "end": "512479"
  },
  {
    "text": "can kind of also see here for the clients to use",
    "start": "512479",
    "end": "516800"
  },
  {
    "text": "everybody good cool so now let's change the envoy",
    "start": "517599",
    "end": "522719"
  },
  {
    "text": "configuration and change the call timeout",
    "start": "522719",
    "end": "528000"
  },
  {
    "text": "so if i look at this config again before we didn't specify a timeout but over here now we're going to specify a",
    "start": "528080",
    "end": "534480"
  },
  {
    "text": "one second timeout so again let's create that config map or you know update that",
    "start": "534480",
    "end": "542080"
  },
  {
    "text": "config map and then we're going to restart envoy",
    "start": "542080",
    "end": "547519"
  },
  {
    "text": "to pick up these changes and the change being the timeout of one second",
    "start": "547519",
    "end": "553760"
  },
  {
    "text": "give that a couple of seconds for it to restart and now you can always run like cube cut or get",
    "start": "555760",
    "end": "562080"
  },
  {
    "text": "pods and and then see the three pods you can see envoy started",
    "start": "562080",
    "end": "568080"
  },
  {
    "text": "so now if we do the exec command again",
    "start": "570800",
    "end": "576160"
  },
  {
    "text": "to do the curl to envoy you can see that the timeout's updated to one second 1000",
    "start": "576160",
    "end": "581680"
  },
  {
    "text": "milliseconds http bin app has an end point",
    "start": "581680",
    "end": "587680"
  },
  {
    "text": "where you can tell it to have a delay before responding so if you",
    "start": "587680",
    "end": "595120"
  },
  {
    "text": "go to slash delay five then it's going to wait five seconds before responding",
    "start": "595120",
    "end": "600320"
  },
  {
    "text": "well we've configured envoy to timeout after one second so as you would expect the connection should fail so you can",
    "start": "600320",
    "end": "606959"
  },
  {
    "text": "see now we have a h504 gateway timeout",
    "start": "606959",
    "end": "612079"
  },
  {
    "text": "pretty straightforward when things are not working well envoy",
    "start": "613440",
    "end": "619200"
  },
  {
    "text": "exposes uh the stats endpoint as well as other endpoints that we'll get to but for now we're going to look at the stats",
    "start": "619200",
    "end": "626079"
  },
  {
    "text": "endpoint where you can get statistics about you know what what's going on in the um what's going",
    "start": "626079",
    "end": "632560"
  },
  {
    "text": "on with all the requests so let's exec again from sleep but now we're going to",
    "start": "632560",
    "end": "639839"
  },
  {
    "text": "call envoy's admin port admin port that 15 000",
    "start": "639839",
    "end": "645360"
  },
  {
    "text": "and then slash stats so now we're not going to http bin we're just going to the admin port of envoy and then went to",
    "start": "645360",
    "end": "652560"
  },
  {
    "text": "the slash stats endpoint then we see a lot of good information",
    "start": "652560",
    "end": "657920"
  },
  {
    "text": "right so this all kinds of stuff in here you know",
    "start": "657920",
    "end": "663519"
  },
  {
    "text": "the the way it's it's configured all of its various clusters that it that envoy knows about and you know all the 500s",
    "start": "663519",
    "end": "670720"
  },
  {
    "text": "all the retries all kinds of goodies are in here so let's run that same command again except this",
    "start": "670720",
    "end": "677279"
  },
  {
    "text": "time we'll just grep for the retry word so that we get a smaller list so you can see that all the",
    "start": "677279",
    "end": "683600"
  },
  {
    "text": "retries are set to zero so that means envoy's not really we try haven't hasn't",
    "start": "683600",
    "end": "688720"
  },
  {
    "text": "really retried any request",
    "start": "688720",
    "end": "692639"
  },
  {
    "text": "next thing we'll do is we'll configure envoy to retry a request on",
    "start": "696800",
    "end": "702640"
  },
  {
    "text": "say five hundreds so again we have an envoy config yemo",
    "start": "702640",
    "end": "708959"
  },
  {
    "text": "we will upload we will take a look at that and this one is saying here i'm going to add the retry policy",
    "start": "708959",
    "end": "715600"
  },
  {
    "text": "retry on on any type of five hundreds like five one five one five or two five three five x's and retry it three times",
    "start": "715600",
    "end": "724079"
  },
  {
    "text": "okay again like just like before apply the config map",
    "start": "724079",
    "end": "729600"
  },
  {
    "text": "and then restart envoy give it a couple of seconds",
    "start": "729600",
    "end": "736720"
  },
  {
    "text": "and that http bin app also has a slash",
    "start": "736720",
    "end": "742320"
  },
  {
    "text": "status slash 500 and point if you if you call slash status 500 it's",
    "start": "742320",
    "end": "747920"
  },
  {
    "text": "going to reply back with the 500 if you call 502 it replies back so it's just like a basically like an echo so you can do",
    "start": "747920",
    "end": "754399"
  },
  {
    "text": "various tests so if you do the slash 500 it comes back with a 500",
    "start": "754399",
    "end": "759760"
  },
  {
    "text": "okay that's that's as expected you can see http 101 500 internal server error",
    "start": "759760",
    "end": "766800"
  },
  {
    "text": "but we want to see more details about about this 500 right so",
    "start": "766800",
    "end": "773200"
  },
  {
    "text": "let's use the stats endpoint with the grep for retry and see what's",
    "start": "773200",
    "end": "778320"
  },
  {
    "text": "going on so now we see if you look closely that this cluster",
    "start": "778320",
    "end": "784000"
  },
  {
    "text": "http bin service has a retry label with the value set to three that means",
    "start": "784000",
    "end": "790720"
  },
  {
    "text": "that envoy tried to hit this endpoint three times and it failed so good stuff there",
    "start": "790720",
    "end": "797200"
  },
  {
    "text": "that's very useful you know in production when you're you're seeing if your retry policies are",
    "start": "797200",
    "end": "802399"
  },
  {
    "text": "applying so you can see if that if your app is really down or if it's just you know taking you know a couple of times",
    "start": "802399",
    "end": "808480"
  },
  {
    "text": "to respond if everything is working well and you periodically check the stats endpoint",
    "start": "808480",
    "end": "813519"
  },
  {
    "text": "and you see various retries that might be a sign for you to figure out like hey what's going on why am i getting retries",
    "start": "813519",
    "end": "818800"
  },
  {
    "text": "once in a while it's good that istio is able to mask this by applying this retry policies but",
    "start": "818800",
    "end": "824399"
  },
  {
    "text": "you still want to kind of know that this is happening once in a while so",
    "start": "824399",
    "end": "829519"
  },
  {
    "text": "that's envoy for you um very simple basic configuration if you were to program envoy yourself",
    "start": "829519",
    "end": "837360"
  },
  {
    "text": "cool all right so once you're done with that lab click on",
    "start": "837360",
    "end": "842639"
  },
  {
    "text": "check at the bottom and just you know just does a quick check to make sure that you've done all the required pieces",
    "start": "842639",
    "end": "847920"
  },
  {
    "text": "before you move on can i get a thumbs up in the room that",
    "start": "847920",
    "end": "853680"
  },
  {
    "text": "everything's good cool eric everything's going good online awesome",
    "start": "853680",
    "end": "859920"
  },
  {
    "text": "the next the next lab we're actually going to install sto",
    "start": "861760",
    "end": "867920"
  },
  {
    "text": "we're going to install istio using revisions revisions let you",
    "start": "867920",
    "end": "874160"
  },
  {
    "text": "specify a version of istio to deploy into your cluster that helps you",
    "start": "874160",
    "end": "880880"
  },
  {
    "text": "when you want to do upgrades so that you can have istio 183 installed into your cluster and then you",
    "start": "880880",
    "end": "886959"
  },
  {
    "text": "can have istio 195 also installed in the same cluster and you can tell your pods",
    "start": "886959",
    "end": "892560"
  },
  {
    "text": "you know which istio do you want to use and you can do slowly incremental upgrades so for that reason revisions",
    "start": "892560",
    "end": "898720"
  },
  {
    "text": "are extremely important especially in production where you don't want to impact any traffic",
    "start": "898720",
    "end": "904079"
  },
  {
    "text": "and you want to do gradual rollouts of any changes so we have uh the namespaces at the top",
    "start": "904079",
    "end": "909360"
  },
  {
    "text": "are default istio and system sorry default istio and action namespace",
    "start": "909360",
    "end": "915360"
  },
  {
    "text": "as well as the istio system namespace in the default namespace we have the http bin app that should",
    "start": "915360",
    "end": "921760"
  },
  {
    "text": "already be there we're going to create this new namespace stone action and deploy this um",
    "start": "921760",
    "end": "927440"
  },
  {
    "text": "the same app you ran in the previous lab it's got four microservices web recommend purchase and sleep and then in",
    "start": "927440",
    "end": "933360"
  },
  {
    "text": "the istio system namespace this is where we're going to deploy our istio question",
    "start": "933360",
    "end": "940440"
  },
  {
    "text": "uh we're not using the operator here uh yes the number one recommended way of",
    "start": "940480",
    "end": "947839"
  },
  {
    "text": "installing istio is to use istio cuddle um so istio cuttle manifest",
    "start": "947839",
    "end": "952959"
  },
  {
    "text": "apply or you know manifest generate look at the ammo and apply i would say",
    "start": "952959",
    "end": "958480"
  },
  {
    "text": "the the second best approach if you're installing brand new",
    "start": "958480",
    "end": "963759"
  },
  {
    "text": "istios moving forward the helm support is getting better and better right now it's it's an alpha but",
    "start": "963759",
    "end": "969920"
  },
  {
    "text": "i believe in the next version where the alpha label is going to go away and helm 3 will be will be supported and then the",
    "start": "969920",
    "end": "976480"
  },
  {
    "text": "istio operator it it works well i mean it's been a supported way of installing istio for",
    "start": "976480",
    "end": "982720"
  },
  {
    "text": "a while but the community is moving slightly away from it",
    "start": "982720",
    "end": "989600"
  },
  {
    "text": "because the value of the istio operator is not as",
    "start": "989600",
    "end": "994720"
  },
  {
    "text": "as big as it once was before uh like last year you know istio came with like multiple components but",
    "start": "994720",
    "end": "1001680"
  },
  {
    "text": "now you know istio is kind of shrinking down into just the single monolithic sdod and then the gateway portion of",
    "start": "1001680",
    "end": "1007759"
  },
  {
    "text": "istio is becoming more of a user user's responsibility because they're",
    "start": "1007759",
    "end": "1012880"
  },
  {
    "text": "installing the gateways into their own namespaces for for better delineation of",
    "start": "1012880",
    "end": "1018800"
  },
  {
    "text": "security traffic and administrative domains so for that reason because there's kind of only one pod or like you",
    "start": "1018800",
    "end": "1024640"
  },
  {
    "text": "know one deployment is dod the there's really like not that much use of having",
    "start": "1024640",
    "end": "1030640"
  },
  {
    "text": "this overhead of an in-cluster operator running you're still going to use the istio operator api you just give it to",
    "start": "1030640",
    "end": "1036959"
  },
  {
    "text": "istio cuddle and then istio cuddle will take that istio operator api convert it to all your kubernetes cmo and deploy it",
    "start": "1036959",
    "end": "1043600"
  },
  {
    "text": "to your to your cluster okay",
    "start": "1043600",
    "end": "1049520"
  },
  {
    "text": "back to our lab",
    "start": "1049520",
    "end": "1053240"
  },
  {
    "text": "like i said let's first start with deploying our sample application first create the istio in action",
    "start": "1059280",
    "end": "1065520"
  },
  {
    "text": "namespace and then deploy those microservices the",
    "start": "1065520",
    "end": "1071440"
  },
  {
    "text": "sample application microservices this installs the deployments the services service accounts etc",
    "start": "1071440",
    "end": "1078240"
  },
  {
    "text": "and then do a get pods so that you can kind of",
    "start": "1078240",
    "end": "1083679"
  },
  {
    "text": "see it come up",
    "start": "1083679",
    "end": "1086480"
  },
  {
    "text": "this might take a 30 seconds or so for these containers to pop up",
    "start": "1088960",
    "end": "1095840"
  },
  {
    "text": "so those my my pods are up and now let's download istio",
    "start": "1096000",
    "end": "1102559"
  },
  {
    "text": "this lab uses istio-183 the concepts are the same for",
    "start": "1102559",
    "end": "1108400"
  },
  {
    "text": "one nine one ten one eleven",
    "start": "1108400",
    "end": "1111760"
  },
  {
    "text": "yeah this carl command just sets this to your version and then goes and downloads the binaries for istio cuddle",
    "start": "1119200",
    "end": "1126799"
  },
  {
    "text": "once it's downloaded we'll set the path so that we can type histocuddle and have",
    "start": "1135280",
    "end": "1140320"
  },
  {
    "text": "it point it to the right istio and then once that's done",
    "start": "1140320",
    "end": "1145360"
  },
  {
    "text": "you should be able to run this geocado version and then see the version output",
    "start": "1145360",
    "end": "1152320"
  },
  {
    "text": "normally when you run this istio cuddle version and it's and you your cube config is pointed at a cluster that has",
    "start": "1162160",
    "end": "1167360"
  },
  {
    "text": "a steel installed then it's able to go query that cluster to see what version you have installed um because we don't",
    "start": "1167360",
    "end": "1173600"
  },
  {
    "text": "have sto installed yet that's why it says no istio pods in istio system system namespace but then the 183 on the",
    "start": "1173600",
    "end": "1179280"
  },
  {
    "text": "bottom is the version of the cli",
    "start": "1179280",
    "end": "1183039"
  },
  {
    "text": "like like we talked about there's three ways of installing istio istio cuddle cli",
    "start": "1185520",
    "end": "1191520"
  },
  {
    "text": "istio operator and helm with the with the current support i would say that this is a good",
    "start": "1191520",
    "end": "1198400"
  },
  {
    "text": "ordered list and but in the future i think what the helm is going to take over is your",
    "start": "1198400",
    "end": "1203840"
  },
  {
    "text": "operator",
    "start": "1203840",
    "end": "1206840"
  },
  {
    "text": "great and then [Music] let's kind of proceed we're kind of",
    "start": "1209280",
    "end": "1214720"
  },
  {
    "text": "running short on time we're slow going a little slower than i expected but you know we're going to create the istio system namespace we're going to create",
    "start": "1214720",
    "end": "1221919"
  },
  {
    "text": "this um istiod service this is kind of a workaround for a bug that's been there",
    "start": "1221919",
    "end": "1228159"
  },
  {
    "text": "in istio for a while where if you want to do is to your revisions but you're starting on a fresh cluster then you",
    "start": "1228159",
    "end": "1234000"
  },
  {
    "text": "need the sdod service created for the gateways to communicate with so this is",
    "start": "1234000",
    "end": "1239039"
  },
  {
    "text": "a this section where you're applying the sdod service as a workaround but this is also documented on the istio",
    "start": "1239039",
    "end": "1245520"
  },
  {
    "text": "installation revision installation page and then finally",
    "start": "1245520",
    "end": "1251520"
  },
  {
    "text": "the the istio profile that we're going to install is minimal meaning the only",
    "start": "1251520",
    "end": "1256799"
  },
  {
    "text": "thing you'll get is sdod so that's what's defined here in this istio operator in production",
    "start": "1256799",
    "end": "1263840"
  },
  {
    "text": "you should always have an istio operator file have multiple istio operator files one",
    "start": "1263840",
    "end": "1269360"
  },
  {
    "text": "for your sdod and then you know one for each one of the gateways you have defined so take advantage of multiple",
    "start": "1269360",
    "end": "1275840"
  },
  {
    "text": "istio operator files save these operator files in your source control and then when you install istio",
    "start": "1275840",
    "end": "1282480"
  },
  {
    "text": "you would do istio cuddle install and then point it at that that istio operator file and",
    "start": "1282480",
    "end": "1289200"
  },
  {
    "text": "then you would specify your revision label being 1-8-3",
    "start": "1289200",
    "end": "1294880"
  },
  {
    "text": "many users also do like istio cuto install and then you can pass it every single flag that you want to overwrite",
    "start": "1294880",
    "end": "1301200"
  },
  {
    "text": "directly with that with that cli but um that's more error prone so take",
    "start": "1301200",
    "end": "1307280"
  },
  {
    "text": "advantage of actually storing your config in this istio operator um",
    "start": "1307280",
    "end": "1312880"
  },
  {
    "text": "resource with the istio cuddle method you're not applying the file to your kubernetes",
    "start": "1312880",
    "end": "1318960"
  },
  {
    "text": "cluster you're just passing it to your cli your cli does all the magic and installs it",
    "start": "1318960",
    "end": "1325200"
  },
  {
    "text": "let's take a look at the pods that we have set up and you can see the only thing that got installed is this dod and but it's",
    "start": "1326960",
    "end": "1333520"
  },
  {
    "text": "actually named with the revision that you passed it so now you can kind of get hints at you",
    "start": "1333520",
    "end": "1339360"
  },
  {
    "text": "know how you how you can have multiple stods running because they would all have a different name they would all",
    "start": "1339360",
    "end": "1344480"
  },
  {
    "text": "have a different service to make sure that sdod is working okay",
    "start": "1344480",
    "end": "1351679"
  },
  {
    "text": "you can exec into sdod itself and then it has this pilot discovery binary",
    "start": "1351679",
    "end": "1357280"
  },
  {
    "text": "inside of it and that pilot that binary exposes all kinds of various sub commands that you can use to like figure",
    "start": "1357280",
    "end": "1363840"
  },
  {
    "text": "out what services that your istiod has discovered so this one um is just",
    "start": "1363840",
    "end": "1370320"
  },
  {
    "text": "calling the the registry endpoint so this is you're basically asking istio's",
    "start": "1370320",
    "end": "1375360"
  },
  {
    "text": "d service registry to list all the services that it knows about this one will have both services that",
    "start": "1375360",
    "end": "1381760"
  },
  {
    "text": "are part of the mesh as well as not part of the mesh it knows all this all the services because it talks to the",
    "start": "1381760",
    "end": "1387280"
  },
  {
    "text": "kubernetes api the output is pretty verbose but you",
    "start": "1387280",
    "end": "1392400"
  },
  {
    "text": "know you can take a look at it in your own time next thing we'll do is",
    "start": "1392400",
    "end": "1398159"
  },
  {
    "text": "we're going to add a sidecar to the http bin service so you might be familiar with just",
    "start": "1398159",
    "end": "1404960"
  },
  {
    "text": "labeling your istio system names you're labeling your workload namespace and then restarting your workloads and then",
    "start": "1404960",
    "end": "1411280"
  },
  {
    "text": "using the the web hook to to inject the car for you automatically but if you're trying",
    "start": "1411280",
    "end": "1417600"
  },
  {
    "text": "to do a more methodical step-by-step approach of injecting one part at a time",
    "start": "1417600",
    "end": "1423120"
  },
  {
    "text": "to make sure things are working properly and you want to take advantage of revisions to point it at the injector",
    "start": "1423120",
    "end": "1429279"
  },
  {
    "text": "that is version 1.8.3 then you can use this method of of specifying",
    "start": "1429279",
    "end": "1435760"
  },
  {
    "text": "you're using istio cuddle to specify the your config map that you want to use so i want to use the mesh config map 183",
    "start": "1435760",
    "end": "1443360"
  },
  {
    "text": "and you can specify the injector that you want to use so this allows you to be very specific in this and what sidecar",
    "start": "1443360",
    "end": "1450960"
  },
  {
    "text": "you're getting if you have 10 versions of istio running in your cluster you can say that i want to deploy this pod and",
    "start": "1450960",
    "end": "1456640"
  },
  {
    "text": "this part i want to have the 183 side car",
    "start": "1456640",
    "end": "1460880"
  },
  {
    "text": "okay that's the end of that lab so now we have the http bin service so",
    "start": "1464240",
    "end": "1470880"
  },
  {
    "text": "if you do get pods you can see that http bin has two of two",
    "start": "1470880",
    "end": "1480159"
  },
  {
    "text": "the two obviously meaning one is your http bin container and then",
    "start": "1480240",
    "end": "1485279"
  },
  {
    "text": "the second container is the istioproxy container",
    "start": "1485279",
    "end": "1490158"
  },
  {
    "text": "all good cool",
    "start": "1490320",
    "end": "1495278"
  },
  {
    "text": "all right moving right along now the third portion we want to cover is",
    "start": "1496640",
    "end": "1503760"
  },
  {
    "text": "observability out of the box istio comes with actually how am i doing",
    "start": "1503760",
    "end": "1510480"
  },
  {
    "text": "on time do you know when this um hey will or eric do you know when",
    "start": "1510480",
    "end": "1516480"
  },
  {
    "text": "this part 1 ends",
    "start": "1516480",
    "end": "1521120"
  },
  {
    "text": "how much 15. cool yup we'll be able to get through this the observability lab",
    "start": "1522000",
    "end": "1528640"
  },
  {
    "text": "focuses on not using the sample observability add-ons that come with",
    "start": "1528640",
    "end": "1534000"
  },
  {
    "text": "istio the the prometheus deployment the kiali there that come with istio like you know",
    "start": "1534000",
    "end": "1540799"
  },
  {
    "text": "if you if you follow the they used to come with istio itself but now we've broken it apart in the",
    "start": "1540799",
    "end": "1546799"
  },
  {
    "text": "documentation there's a separate section for observability and and that lets you",
    "start": "1546799",
    "end": "1552640"
  },
  {
    "text": "get up to speed quickly by using basically just shortcuts to to deploy prometheus and apply the config maps and",
    "start": "1552640",
    "end": "1558960"
  },
  {
    "text": "everything but in a more production environment you might have a full-fledged prometheus installed",
    "start": "1558960",
    "end": "1565279"
  },
  {
    "text": "using like the prometheus operator and then using resources like pod monitors and service",
    "start": "1565279",
    "end": "1571039"
  },
  {
    "text": "monitors to discrete metrics so that's what we're going to do here is we're going to set up a more enterprise",
    "start": "1571039",
    "end": "1577039"
  },
  {
    "text": "prometheus we're going to use the prometheus operator we're going to use the kiali operator and then making sure",
    "start": "1577039",
    "end": "1582880"
  },
  {
    "text": "that they're secured properly and they're configured properly",
    "start": "1582880",
    "end": "1587919"
  },
  {
    "text": "so skipping or moving on to lab three",
    "start": "1592320",
    "end": "1597880"
  },
  {
    "text": "okay first we're gonna install prometheus step one create the prometheus namespace",
    "start": "1611120",
    "end": "1617919"
  },
  {
    "text": "then we're gonna download the prometheus helm charts",
    "start": "1617919",
    "end": "1623279"
  },
  {
    "text": "then we're going to use helm to install prometheus",
    "start": "1624480",
    "end": "1630480"
  },
  {
    "text": "when you're copying pasting these commands remember you have to hit enter after you do the paste",
    "start": "1630480",
    "end": "1636640"
  },
  {
    "text": "sometimes if it's multiple lines then you know everything except the last",
    "start": "1638000",
    "end": "1643440"
  },
  {
    "text": "one gets entered so then so be just be careful with that",
    "start": "1643440",
    "end": "1649039"
  },
  {
    "text": "so now we're running the helm installer we've configured this so that it works",
    "start": "1651440",
    "end": "1657440"
  },
  {
    "text": "well with istio",
    "start": "1657440",
    "end": "1660960"
  },
  {
    "text": "and then once that's done do the cubecut will get pods in the prometheus namespace",
    "start": "1664000",
    "end": "1670480"
  },
  {
    "text": "so you can see these various components starting up",
    "start": "1670480",
    "end": "1675120"
  },
  {
    "text": "cool so run that getpods a couple of times until everything is running and then we should be able to port forward to",
    "start": "1678799",
    "end": "1686240"
  },
  {
    "text": "your your prometheus service",
    "start": "1686240",
    "end": "1690640"
  },
  {
    "text": "and then the way the port forwarding works in this instruct environments is that we already have these tabs",
    "start": "1692000",
    "end": "1698000"
  },
  {
    "text": "configured to to to listen to that port that localhost 9090 port",
    "start": "1698000",
    "end": "1704399"
  },
  {
    "text": "so if you click on this prometheus tab you can see that it now loads if you were to click this before doing a port",
    "start": "1704399",
    "end": "1709600"
  },
  {
    "text": "forward you would have a blank screen",
    "start": "1709600",
    "end": "1713200"
  },
  {
    "text": "actually one step that i missed is that there are multiple terminals there's terminal tab one and then terminal tab",
    "start": "1719840",
    "end": "1726240"
  },
  {
    "text": "two uh we want you to do the the port forwarding in tab two so that",
    "start": "1726240",
    "end": "1731360"
  },
  {
    "text": "you're not blocked and you can continue on with in your tab one so if you if you did the port forward in terminal 1 do a",
    "start": "1731360",
    "end": "1738159"
  },
  {
    "text": "control c break out of it go to terminal 2 and run the port forward and then if you should still be able to",
    "start": "1738159",
    "end": "1744080"
  },
  {
    "text": "get to this prometheus page you can you know start typing in",
    "start": "1744080",
    "end": "1750080"
  },
  {
    "text": "expressions in here but it doesn't have any stats yet so prometheus is not configured to scrape any control plane",
    "start": "1750080",
    "end": "1757120"
  },
  {
    "text": "or a steel plane pod so so you know executing any queries won't give you anything",
    "start": "1757120",
    "end": "1765398"
  },
  {
    "text": "next go back to terminal 2 exit out of it and then also",
    "start": "1766399",
    "end": "1772720"
  },
  {
    "text": "pour forward to the grafana service and then if you go to",
    "start": "1772720",
    "end": "1778840"
  },
  {
    "text": "grafana you should see this page load and then the use the credentials are",
    "start": "1778840",
    "end": "1784799"
  },
  {
    "text": "are in the chat sorry the credentials are in the workshop",
    "start": "1784799",
    "end": "1790640"
  },
  {
    "text": "so you should see something like this if i go to",
    "start": "1791360",
    "end": "1796720"
  },
  {
    "text": "go to home in the dashboards you can see i don't have any dashboards yet",
    "start": "1796960",
    "end": "1802320"
  },
  {
    "text": "so let's fix that let's add the istio dashboards to to grafana the the istio",
    "start": "1803840",
    "end": "1809679"
  },
  {
    "text": "sample grafana deployment comes with grafana as well as a bunch of pre-configured dashboards so we can take",
    "start": "1809679",
    "end": "1816799"
  },
  {
    "text": "that and apply those grad dashboards to our our our grafana instance",
    "start": "1816799",
    "end": "1822960"
  },
  {
    "text": "we've already downloaded all those dashboards to the local file system so you should be",
    "start": "1822960",
    "end": "1828640"
  },
  {
    "text": "able to just create a config map out of it by specifying all of the",
    "start": "1828640",
    "end": "1834720"
  },
  {
    "text": "files i don't think it matters which terminal you run these in",
    "start": "1834840",
    "end": "1840399"
  },
  {
    "text": "but so we've created a config map using all of the dashboards that are on file",
    "start": "1848840",
    "end": "1855039"
  },
  {
    "text": "next we're going to label the config map so that grafana will pick it up",
    "start": "1855039",
    "end": "1862278"
  },
  {
    "text": "and then do a port forward to prometheus again",
    "start": "1864559",
    "end": "1871279"
  },
  {
    "text": "sorry port forward to grafana again and now if you go back to grafana",
    "start": "1872320",
    "end": "1879200"
  },
  {
    "text": "and then there should be a refresh on the top right",
    "start": "1879200",
    "end": "1886000"
  },
  {
    "text": "so i'm going to hit read him and hit that refresh just to make sure it picks and reloads properly and then if i now",
    "start": "1886000",
    "end": "1892720"
  },
  {
    "text": "go to home you can see i have all my istio dashboards loaded",
    "start": "1892720",
    "end": "1899840"
  },
  {
    "text": "so if you click on let's say the istio control plane dashboard you can see that the dashboard is configured we just don't have any stats",
    "start": "1904000",
    "end": "1910640"
  },
  {
    "text": "yet and that's because we need to tell",
    "start": "1910640",
    "end": "1916799"
  },
  {
    "text": "we need to configure prometheus scraping to scrape our control plane as well as the data plane metrics",
    "start": "1916799",
    "end": "1924799"
  },
  {
    "text": "so we'll leave that port forwarding on terminal two so let that so you know let that port forward for grafana run in",
    "start": "1926399",
    "end": "1932720"
  },
  {
    "text": "terminal 2 but then move over to terminal 1 and then start",
    "start": "1932720",
    "end": "1939440"
  },
  {
    "text": "looking at the prometheus service monitor resource so you can take",
    "start": "1939440",
    "end": "1946320"
  },
  {
    "text": "a look to see you know how it's configured to to read the control plane metrics",
    "start": "1946320",
    "end": "1952320"
  },
  {
    "text": "now once you take a look at those metrics or you know how it's using how it's determining you know what service it's",
    "start": "1955840",
    "end": "1962720"
  },
  {
    "text": "trying to scrape and any you know modifications it wants to do it looks like for this one there's",
    "start": "1962720",
    "end": "1968799"
  },
  {
    "text": "none and then apply that",
    "start": "1968799",
    "end": "1973799"
  },
  {
    "text": "it says you should be able to go to grafana ui and start seeing data but um in my experience it usually takes a",
    "start": "1978720",
    "end": "1985200"
  },
  {
    "text": "couple of minutes for for the scraping to start picking up new metrics so while that's happening let's",
    "start": "1985200",
    "end": "1991279"
  },
  {
    "text": "just keep going down and then apply the the pod monitor the pod scraping your",
    "start": "1991279",
    "end": "1997440"
  },
  {
    "text": "workload metrics as well",
    "start": "1997440",
    "end": "2003080"
  },
  {
    "text": "so once you applied both the service monitor and the pod monitor yamls",
    "start": "2005919",
    "end": "2011600"
  },
  {
    "text": "go down and then simulate some load by running this for loop",
    "start": "2012880",
    "end": "2019360"
  },
  {
    "text": "so for 10 times it's going to do it's going to exec into the sleep container and then it's going to call the http bin",
    "start": "2019360",
    "end": "2026640"
  },
  {
    "text": "container remember that your http bin container is",
    "start": "2026640",
    "end": "2032159"
  },
  {
    "text": "now part of the mesh but sleep is not",
    "start": "2032159",
    "end": "2037640"
  },
  {
    "text": "looks like my control plane dashboard is now picking up metrics",
    "start": "2058000",
    "end": "2063358"
  },
  {
    "text": "see there's some you know a few lines here and there and if i go back here",
    "start": "2065119",
    "end": "2071358"
  },
  {
    "text": "and where am i and then go to the istio",
    "start": "2071359",
    "end": "2077919"
  },
  {
    "text": "let's say service dashboard",
    "start": "2077919",
    "end": "2081878"
  },
  {
    "text": "in a couple of seconds i should be able to see metrics for my http bin app as well",
    "start": "2091839",
    "end": "2100680"
  },
  {
    "text": "not yet like i said before this usually like takes a few minutes",
    "start": "2102560",
    "end": "2110440"
  },
  {
    "text": "we'll come back to this probably in a in a later section so that you can you can see better metrics but you can",
    "start": "2116240",
    "end": "2121839"
  },
  {
    "text": "see that the the control plane metrics are picked up the service metrics are taking a little",
    "start": "2121839",
    "end": "2126880"
  },
  {
    "text": "while longer so with that um hit check on the bottom",
    "start": "2126880",
    "end": "2133839"
  },
  {
    "text": "and well we're not quite done yet",
    "start": "2135839",
    "end": "2141640"
  },
  {
    "text": "ah keali i forgot about installing cali",
    "start": "2145040",
    "end": "2150480"
  },
  {
    "text": "so grafana and prometheus are good for for you to see how every single",
    "start": "2155040",
    "end": "2160640"
  },
  {
    "text": "service is doing the health of every single service you know the number of 500s that they're getting their response",
    "start": "2160640",
    "end": "2165760"
  },
  {
    "text": "times etcetera and kiali on the other hand is a service craft so it's good for",
    "start": "2165760",
    "end": "2171119"
  },
  {
    "text": "observing traffic as it's flowing through the system so it knows about all the various",
    "start": "2171119",
    "end": "2176480"
  },
  {
    "text": "services and how they're connecting together and it determines that based on the prometheus metrics",
    "start": "2176480",
    "end": "2181839"
  },
  {
    "text": "so let's go ahead and install kiali",
    "start": "2181839",
    "end": "2186119"
  },
  {
    "text": "first we'll create the kiali operator namespace and then do a helm install",
    "start": "2187119",
    "end": "2194320"
  },
  {
    "text": "if you check the pods and wait for the kiali operator part to start up",
    "start": "2195839",
    "end": "2201839"
  },
  {
    "text": "and then you know just like with istio you're defining the config in the istio operator yaml",
    "start": "2202800",
    "end": "2209359"
  },
  {
    "text": "kiali you can define kiali configuration using this this kiali",
    "start": "2209359",
    "end": "2214400"
  },
  {
    "text": "resource so let's apply",
    "start": "2214400",
    "end": "2219839"
  },
  {
    "text": "let's create that as well",
    "start": "2219839",
    "end": "2223280"
  },
  {
    "text": "and then if you list the pods",
    "start": "2227119",
    "end": "2231279"
  },
  {
    "text": "in the istio system namespace in a couple of seconds we should see the kiali pot come up as well",
    "start": "2232240",
    "end": "2239480"
  },
  {
    "text": "and this zoom stopped",
    "start": "2253440",
    "end": "2257560"
  },
  {
    "text": "okay that's cali running",
    "start": "2264560",
    "end": "2269880"
  },
  {
    "text": "looks like kelly's taking a little while to start up",
    "start": "2271040",
    "end": "2275200"
  },
  {
    "text": "but basically you know same thing as prometheus and in grafana you know you install the components and",
    "start": "2276800",
    "end": "2282400"
  },
  {
    "text": "then you pour forward to it this is taking a little while so what i'm going to do is",
    "start": "2282400",
    "end": "2288640"
  },
  {
    "text": "just apply all the kiali commands",
    "start": "2288640",
    "end": "2292799"
  },
  {
    "text": "so that we can move to the next section we have a lot of things to cover and i don't want to spend all of our time on observability",
    "start": "2294160",
    "end": "2302359"
  }
]