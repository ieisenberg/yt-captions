[
  {
    "text": "hey can everyone hear me okay does anyone first off does anyone not have a piece of paper like this if you",
    "start": "299",
    "end": "6660"
  },
  {
    "text": "don't put your hand up and my colleague will come and give you one of these",
    "start": "6660",
    "end": "12679"
  },
  {
    "text": "so whilst he's doing that what we're going to try and achieve in the next 70 minutes is to perform an audit of a",
    "start": "13679",
    "end": "20820"
  },
  {
    "text": "cluster right it's almost impossible to be able to secure a kubernetes cluster in 70 minutes",
    "start": "20820",
    "end": "27180"
  },
  {
    "text": "so what we're going to do is we're going to I'm going to take you on a journey of where you should look",
    "start": "27180",
    "end": "34980"
  },
  {
    "text": "what you should be thinking about when you're performing said audit and then finally what defense mechanisms can we",
    "start": "34980",
    "end": "41280"
  },
  {
    "text": "put in so that once we have a good understanding of how secure and secure our cluster is when new workloads and new resources",
    "start": "41280",
    "end": "49200"
  },
  {
    "text": "are trying to be deployed to our cluster we want to be able to stop the bad ones from getting in right you don't have to",
    "start": "49200",
    "end": "54960"
  },
  {
    "text": "keep repeating this order over and over again so to start with my name's Steve Wade",
    "start": "54960",
    "end": "60840"
  },
  {
    "text": "I'm head of engineering at uh ksoc and I have my assistant boss uh Jimmy with me",
    "start": "60840",
    "end": "68760"
  },
  {
    "text": "you were mostly here before so hey everyone yeah",
    "start": "68760",
    "end": "74040"
  },
  {
    "text": "so a brief agenda what's the mission we're trying to complete so the first 10",
    "start": "74040",
    "end": "79680"
  },
  {
    "text": "minutes is going to be a cluster set up so everyone's going to set up their own cluster and they'll be performing an audit of",
    "start": "79680",
    "end": "85680"
  },
  {
    "text": "that cluster then we're going to perform an asset inventory so we're going to look at what's running on the cluster",
    "start": "85680",
    "end": "92720"
  },
  {
    "text": "what are the things that are important to us when we're performing in audit then we're going to talk about workload",
    "start": "92720",
    "end": "98820"
  },
  {
    "text": "hardening so how can we how can we make the workloads that are currently deployed more secure what are",
    "start": "98820",
    "end": "105000"
  },
  {
    "text": "the things that we should look out for then we're going to move on to our back so everybody knows you know our back",
    "start": "105000",
    "end": "111180"
  },
  {
    "text": "anywhere is a is a bit of a mess so what are some of the easy attack vectors",
    "start": "111180",
    "end": "117540"
  },
  {
    "text": "from an rbac standpoint that allow you to elevate your privileges see things you shouldn't be able to see and do",
    "start": "117540",
    "end": "122640"
  },
  {
    "text": "things you shouldn't be able to do and then finally we're going to finish up with some defensive guard rails so",
    "start": "122640",
    "end": "127799"
  },
  {
    "text": "we're going to try and deploy some workloads and some of them are going to get in and",
    "start": "127799",
    "end": "132959"
  },
  {
    "text": "some of them are not going to get in so let's get started",
    "start": "132959",
    "end": "138420"
  },
  {
    "text": "in on your laptop in a Incognito or private browser if you will browse to",
    "start": "138420",
    "end": "144360"
  },
  {
    "text": "this link it should take you to something that",
    "start": "144360",
    "end": "149640"
  },
  {
    "text": "looks a little bit like this do a quick zoom in",
    "start": "149640",
    "end": "154640"
  },
  {
    "text": "sure it's the internet behaving right now I guess we're about to find out we're",
    "start": "154680",
    "end": "160620"
  },
  {
    "text": "about to find out yes",
    "start": "160620",
    "end": "163879"
  },
  {
    "text": "everyone successfully on the site",
    "start": "175080",
    "end": "179120"
  },
  {
    "text": "okay so if you click on the getting started link on the left hand side there",
    "start": "181019",
    "end": "187400"
  },
  {
    "text": "don't double click on this link open it in a new tab because we're going to flick back and forward between",
    "start": "188700",
    "end": "195860"
  },
  {
    "text": "the URL one more time okay sure",
    "start": "197220",
    "end": "201560"
  },
  {
    "text": "no problem so when you get to this uh blue button",
    "start": "208739",
    "end": "215340"
  },
  {
    "text": "if you right click and open in new tab because we're going to use this website to drive the workshop that we're about",
    "start": "215340",
    "end": "221099"
  },
  {
    "text": "to go through",
    "start": "221099",
    "end": "223519"
  },
  {
    "text": "you should receive a login prompt if you log in using the credentials on your piece of paper",
    "start": "227159",
    "end": "233299"
  },
  {
    "text": "using Incognito is really important here so you don't get mixed up with your corporate G Suite accounts or your",
    "start": "242280",
    "end": "249360"
  },
  {
    "text": "personal G Suite oh Adam's Adam will bring whatever to you",
    "start": "249360",
    "end": "255680"
  },
  {
    "text": "when you get here just click I understand",
    "start": "263520",
    "end": "267138"
  },
  {
    "text": "any paper if anyone needs any help just please put your hands up and add them where Jimmy will come and assist do we",
    "start": "280139",
    "end": "286199"
  },
  {
    "text": "have one more no I don't know what do we have one we hit our 60 okay",
    "start": "286199",
    "end": "292320"
  },
  {
    "text": "is anybody following along playing along you can you can do this in your own",
    "start": "292320",
    "end": "300680"
  },
  {
    "text": "click through when you ask when it's asking about the cloud show click Start Cloud show",
    "start": "313100",
    "end": "319860"
  },
  {
    "text": "when you get to this section down here this is the important piece so there is a repository that we're going to clone",
    "start": "319860",
    "end": "325740"
  },
  {
    "text": "into Cloud shell that's going to make things a lot easier so don't just hit confirm you need to",
    "start": "325740",
    "end": "331979"
  },
  {
    "text": "scroll down click trust repo hopefully you'll trust me that I'm not going to go and do something Road for",
    "start": "331979",
    "end": "338160"
  },
  {
    "text": "you um hit trust repo and then finally hit confirm",
    "start": "338160",
    "end": "344300"
  },
  {
    "text": "I'm going to stop at this point and make sure that everybody gets to this point where they have a cloud shell running",
    "start": "348900",
    "end": "354060"
  },
  {
    "text": "before I move on",
    "start": "354060",
    "end": "357139"
  },
  {
    "text": "anybody not got to this stage yet",
    "start": "375840",
    "end": "379820"
  },
  {
    "text": "Adam can you come and assist this gentleman at the back here he's struggling to sure",
    "start": "387600",
    "end": "393900"
  },
  {
    "text": "or Andre",
    "start": "393900",
    "end": "396500"
  },
  {
    "text": "Shout",
    "start": "401400",
    "end": "404060"
  },
  {
    "text": "to let people use their G Suite why you're lucky because we hit oh 16.",
    "start": "416660",
    "end": "424280"
  },
  {
    "text": "no problem",
    "start": "424280",
    "end": "427460"
  },
  {
    "text": "okay so the first thing we're going to do is we are going to run make in it so what",
    "start": "437479",
    "end": "444240"
  },
  {
    "text": "make in it is going to do is it's going to ask us to authenticate when it asks you to authenticate we're going to go",
    "start": "444240",
    "end": "449520"
  },
  {
    "text": "through the the flow use the same credentials that are on your piece of paper then we're going to install some default",
    "start": "449520",
    "end": "457500"
  },
  {
    "text": "workloads and a couple of uh binaries and packages that we're going to leverage throughout this workshop and",
    "start": "457500",
    "end": "463259"
  },
  {
    "text": "then we'll get started with uh the workload and asset configuration",
    "start": "463259",
    "end": "468599"
  },
  {
    "text": "so what you're going to want to do is flick between these two tabs so this uh",
    "start": "468599",
    "end": "474660"
  },
  {
    "text": "little button here allows you to be able to copy and paste into your clipboard so firstly copy and paste this one",
    "start": "474660",
    "end": "483259"
  },
  {
    "text": "sure um it will ask you for an authentication",
    "start": "489419",
    "end": "495840"
  },
  {
    "text": "code you simply need to take this URL here",
    "start": "495840",
    "end": "499940"
  },
  {
    "text": "open in a new window log in again with your credentials",
    "start": "504660",
    "end": "512659"
  },
  {
    "text": "copy this token at the bottom",
    "start": "523020",
    "end": "526820"
  },
  {
    "text": "enter the token here click authorize",
    "start": "532620",
    "end": "539959"
  },
  {
    "text": "we need to pause to make sure everyone's",
    "start": "581279",
    "end": "585320"
  },
  {
    "text": "and then reconnect you can also do this",
    "start": "588899",
    "end": "594980"
  },
  {
    "text": "should have it right here",
    "start": "597959",
    "end": "601279"
  },
  {
    "text": "how do I do that",
    "start": "629339",
    "end": "632779"
  },
  {
    "text": "all right did you give it the project ID this one",
    "start": "643980",
    "end": "649160"
  },
  {
    "text": "all right",
    "start": "658860",
    "end": "661519"
  },
  {
    "text": "once this has worked once you've gone through the flow you should be able to see this little prompt down the bottom the key Point here is that you see this",
    "start": "665040",
    "end": "671220"
  },
  {
    "text": "in yellow this should be your project ID if this is not your project ID put your",
    "start": "671220",
    "end": "677700"
  },
  {
    "text": "hand up and I'll go through the flow again so we can make it work okay so at the top here",
    "start": "677700",
    "end": "683519"
  },
  {
    "text": "you want to select the organization",
    "start": "683519",
    "end": "687680"
  },
  {
    "text": "select securecubernetes.com click through on here",
    "start": "688560",
    "end": "695300"
  },
  {
    "text": "once you've clicked through on there run gcloud auth login again",
    "start": "698940",
    "end": "705980"
  },
  {
    "text": "and you should repeat the flow so It'll ask you to authorize you'll get",
    "start": "714720",
    "end": "721500"
  },
  {
    "text": "the token copy the token back in",
    "start": "721500",
    "end": "725899"
  },
  {
    "text": "sure so from the top here select the organization select securecubernetes.com select your",
    "start": "734519",
    "end": "741120"
  },
  {
    "text": "project once you've selected your project come",
    "start": "741120",
    "end": "746579"
  },
  {
    "text": "back to the terminal do a gcloud auth login",
    "start": "746579",
    "end": "752360"
  },
  {
    "text": "you'll go through the flow token should pop up copy and paste the token into the terminal",
    "start": "764040",
    "end": "770760"
  },
  {
    "text": "complete the prompts and then you should see this little",
    "start": "770760",
    "end": "776579"
  },
  {
    "text": "yellow section at the bottom",
    "start": "776579",
    "end": "780199"
  },
  {
    "text": "okay anyone not at this section",
    "start": "787680",
    "end": "791180"
  },
  {
    "text": "there you go can you zoom in yeah current project",
    "start": "793920",
    "end": "800760"
  },
  {
    "text": "all right let me come home",
    "start": "800760",
    "end": "804320"
  },
  {
    "text": "foreign foreign",
    "start": "882779",
    "end": "888440"
  },
  {
    "text": "all right are we good to continue cool okay so",
    "start": "954540",
    "end": "961459"
  },
  {
    "text": "once you perform this if you do a cube CTL get pods",
    "start": "963959",
    "end": "968959"
  },
  {
    "text": "oh hold on",
    "start": "969420",
    "end": "972320"
  },
  {
    "text": "if you rerun in it it's gonna because we need to go and get a cube config and I think now we've finally authenticated",
    "start": "983279",
    "end": "989760"
  },
  {
    "text": "we should be able to do this so run dot slash init.sh again",
    "start": "989760",
    "end": "996079"
  },
  {
    "text": "okay so what I did there I run dot slash init.sh you'll go through the loop again now you're authenticated",
    "start": "1014000",
    "end": "1021259"
  },
  {
    "text": "we will obtain a cubeconfig for this cluster and then we should be able to start",
    "start": "1021259",
    "end": "1027760"
  },
  {
    "text": "to validate that your keep config is working if we run Cube CTL get nodes you should get an output like this just a",
    "start": "1046459",
    "end": "1051799"
  },
  {
    "text": "single node",
    "start": "1051799",
    "end": "1054399"
  },
  {
    "text": "anybody not at this point stuck on selling the project still",
    "start": "1067340",
    "end": "1074140"
  },
  {
    "text": "okay where did you where did you get to okay so did you so",
    "start": "1076160",
    "end": "1082880"
  },
  {
    "text": "no problem if you if you got this link okay so go to tinyurl.com Workshop",
    "start": "1082880",
    "end": "1092179"
  },
  {
    "text": "no problem",
    "start": "1095660",
    "end": "1098200"
  },
  {
    "text": "then what you're going to want to do is make sure you open that in an incognito browser then on this button when you",
    "start": "1111740",
    "end": "1119660"
  },
  {
    "text": "open it open it in a new tab because we're going to flick between the website and the cluster",
    "start": "1119660",
    "end": "1127720"
  },
  {
    "text": "once you're in there you want to select the project so at the",
    "start": "1128480",
    "end": "1136220"
  },
  {
    "text": "top here go to the top like so I went",
    "start": "1136220",
    "end": "1141980"
  },
  {
    "text": "right at the top here okay",
    "start": "1141980",
    "end": "1147460"
  },
  {
    "text": "can you help the guy in the purple yeah just get get set up no problem",
    "start": "1153980",
    "end": "1159260"
  },
  {
    "text": "okay so the first thing that we are going to",
    "start": "1159260",
    "end": "1164900"
  },
  {
    "text": "perform is an asset inventory so we want to know what's running what are we",
    "start": "1164900",
    "end": "1171799"
  },
  {
    "text": "dealing with what are the things that we need to start looking at from an audit perspective",
    "start": "1171799",
    "end": "1177320"
  },
  {
    "text": "so I'm not going to go down this list extensively of the things that you should be looking for however some",
    "start": "1177320",
    "end": "1183559"
  },
  {
    "text": "things that are useful and I would recommend you look for is the version of kubernetes that's",
    "start": "1183559",
    "end": "1188960"
  },
  {
    "text": "currently running reasons why this is important there are cves in some kubernetes versions",
    "start": "1188960",
    "end": "1195760"
  },
  {
    "text": "there are also deprecations as well in some of the API specifications so",
    "start": "1195760",
    "end": "1202400"
  },
  {
    "text": "not necessarily a security thing to be aware of but when it comes to upgrading your kubernetes clusters it can be an",
    "start": "1202400",
    "end": "1208940"
  },
  {
    "text": "important thing to know right so if there's a deprecated API you're still",
    "start": "1208940",
    "end": "1214880"
  },
  {
    "text": "using that API you upgrade your kubernetes cluster and that API doesn't exist",
    "start": "1214880",
    "end": "1219919"
  },
  {
    "text": "the first time you deploy your resource it will work when you try and upgrade that resource so you upgrade a",
    "start": "1219919",
    "end": "1225559"
  },
  {
    "text": "deployment or you upgrade a replica set it will not work so one of the things you really want to focus on specifically if you're",
    "start": "1225559",
    "end": "1232340"
  },
  {
    "text": "a platform engineer and responsible for you for the kubernetes Clusters that you're running at your organization is",
    "start": "1232340",
    "end": "1237919"
  },
  {
    "text": "to try and be ahead of the curve of the application developers right because what you don't",
    "start": "1237919",
    "end": "1243200"
  },
  {
    "text": "want to do is upgrade your kubernetes cluster and then the application developers can't deploy their applications that's not a that's not a",
    "start": "1243200",
    "end": "1248720"
  },
  {
    "text": "good look so there are some links here to some",
    "start": "1248720",
    "end": "1254660"
  },
  {
    "text": "official kubernetes cve streams so you can see all of the cves",
    "start": "1254660",
    "end": "1259880"
  },
  {
    "text": "kubernetes does have cves that you can go through the versions",
    "start": "1259880",
    "end": "1265400"
  },
  {
    "text": "that they were fixed in I'm not going to go through these in detail but feel free to to take a look",
    "start": "1265400",
    "end": "1271820"
  },
  {
    "text": "at these in your own time then from a uh from a managed provider",
    "start": "1271820",
    "end": "1279140"
  },
  {
    "text": "perspective there are also a number of things to note here so they're like eks and gke and an AKs on Azure they they",
    "start": "1279140",
    "end": "1286520"
  },
  {
    "text": "all have limits right there's there's edges and boundaries that you can't go outside of",
    "start": "1286520",
    "end": "1291980"
  },
  {
    "text": "um I've left the links here they are important things to note specifically",
    "start": "1291980",
    "end": "1298120"
  },
  {
    "text": "um when when you're dealing with security groups and you know your applications need to talk outbound to",
    "start": "1298159",
    "end": "1303740"
  },
  {
    "text": "something is running in those Cloud providers so hands off of people that are running eks",
    "start": "1303740",
    "end": "1309320"
  },
  {
    "text": "or running in AWS Google Cloud",
    "start": "1309320",
    "end": "1315700"
  },
  {
    "text": "azure none of these because you're running on premise",
    "start": "1316159",
    "end": "1321620"
  },
  {
    "text": "all right or no kubernetes at all okay",
    "start": "1321620",
    "end": "1327440"
  },
  {
    "text": "so again some other things to note from a from a networking perspective there are also limitations there as well",
    "start": "1327440",
    "end": "1335059"
  },
  {
    "text": "uh to be to be aware of the subnets that you're running in uh some of the plugins the the uh specifically the AWS eks uh",
    "start": "1335059",
    "end": "1343280"
  },
  {
    "text": "cni plugin that allows you to have an extension to actually leverage the",
    "start": "1343280",
    "end": "1348740"
  },
  {
    "text": "amazon security groups um but they can they can sometimes get a",
    "start": "1348740",
    "end": "1353840"
  },
  {
    "text": "little bit uh mangled so I would recommend that specifically if you're running AWS to to read through",
    "start": "1353840",
    "end": "1360320"
  },
  {
    "text": "these plug-in configurations so the first thing we're going to want to do is when we perform an audit is we",
    "start": "1360320",
    "end": "1367280"
  },
  {
    "text": "want to know what are all of the different API resources that are currently running so the First Command",
    "start": "1367280",
    "end": "1372440"
  },
  {
    "text": "that we're going to run is Cube CTO API resources Dash o wide",
    "start": "1372440",
    "end": "1378880"
  },
  {
    "text": "what that's going to do is print out a load of noise and it is essentially every API version",
    "start": "1382580",
    "end": "1389840"
  },
  {
    "text": "that is available in your kubernetes cluster and the resources that that API",
    "start": "1389840",
    "end": "1395000"
  },
  {
    "text": "version provides you so this gives us a good initial understanding of what's currently what's",
    "start": "1395000",
    "end": "1401360"
  },
  {
    "text": "currently possible to run this is not what's running right these are the options that are available to us to",
    "start": "1401360",
    "end": "1406640"
  },
  {
    "text": "deploy so we can see here that we're able to deploy some uh some roles or some pod security policies or some pod",
    "start": "1406640",
    "end": "1413419"
  },
  {
    "text": "disruption budgets so when we go deeper into doing our audit",
    "start": "1413419",
    "end": "1420380"
  },
  {
    "text": "we should be looking at these types of resources and trying to find the result the number of resources that are",
    "start": "1420380",
    "end": "1427220"
  },
  {
    "text": "currently running for each of these API groups from there we can go further and look from a security standpoint at the",
    "start": "1427220",
    "end": "1433159"
  },
  {
    "text": "configuration of each of those resources so essentially it's a it's a layered approach we're going to start right at",
    "start": "1433159",
    "end": "1438260"
  },
  {
    "text": "the top going to get a good overview and understanding of what possible resources can run",
    "start": "1438260",
    "end": "1443659"
  },
  {
    "text": "then we go to the resources themselves and then finally we go to the configuration of those resources",
    "start": "1443659",
    "end": "1448880"
  },
  {
    "text": "so this is our initial starting point so again this was API resources Dash o wide",
    "start": "1448880",
    "end": "1456400"
  },
  {
    "text": "the second thing we want to run we want to know what containers do we currently have",
    "start": "1463400",
    "end": "1468620"
  },
  {
    "text": "available what containers are currently running so again I'm flicking between the asset inventory page and the",
    "start": "1468620",
    "end": "1476240"
  },
  {
    "text": "terminal itself so I'm now down here on list all Container images",
    "start": "1476240",
    "end": "1481840"
  },
  {
    "text": "when we print this out we can see the number of containers that are currently running and what type",
    "start": "1482900",
    "end": "1490280"
  },
  {
    "text": "of things are currently running so we can see here for example we have",
    "start": "1490280",
    "end": "1495760"
  },
  {
    "text": "nginx1193 we have an unprivileged nginx we have a couple of things that are running sudo as well",
    "start": "1495760",
    "end": "1504639"
  },
  {
    "text": "so again from a security standpoint we could think about scanning these images what kind of",
    "start": "1505760",
    "end": "1512539"
  },
  {
    "text": "vulnerabilities do these individual images have right as as an application developer myself sometimes",
    "start": "1512539",
    "end": "1519320"
  },
  {
    "text": "security isn't always top of mind right releasing that feature to production is more top of Mind potentially than the",
    "start": "1519320",
    "end": "1525140"
  },
  {
    "text": "security of the underlying container the application yes that's top of mind but",
    "start": "1525140",
    "end": "1530419"
  },
  {
    "text": "the artifact that's currently running in in the production cluster or you know even your development clusters maybe not",
    "start": "1530419",
    "end": "1536779"
  },
  {
    "text": "top of mind maybe you've got uh you know a a generic configuration you use",
    "start": "1536779",
    "end": "1542659"
  },
  {
    "text": "something like Helm or customize and your SRE team or your platform team are",
    "start": "1542659",
    "end": "1547820"
  },
  {
    "text": "providing you with this configuration and they just say all you need to do is add your image in here and set a few",
    "start": "1547820",
    "end": "1553159"
  },
  {
    "text": "variables and Away you go right but that whole configuration that they have could be completely insecure right and you're",
    "start": "1553159",
    "end": "1559159"
  },
  {
    "text": "you're replicating this over tens or hundreds of workloads where you've got tens or hundreds of insecure",
    "start": "1559159",
    "end": "1564679"
  },
  {
    "text": "configurable workloads right and there can be many reasons for that and we're going to dig into some of them",
    "start": "1564679",
    "end": "1570260"
  },
  {
    "text": "hand up people who are doing container image scanning",
    "start": "1570260",
    "end": "1575200"
  },
  {
    "text": "a handful of you",
    "start": "1575659",
    "end": "1578559"
  },
  {
    "text": "tools that you may want to use things like gripe things like trivia clear",
    "start": "1581059",
    "end": "1586279"
  },
  {
    "text": "um make sure you're running them in CI make sure you're running them before you push",
    "start": "1586279",
    "end": "1592039"
  },
  {
    "text": "them to the registry some people that I know push them to the registry and then scan them well if you",
    "start": "1592039",
    "end": "1597080"
  },
  {
    "text": "push them to the registry and then scan them they're available um so they could be on your kubernetes cluster before you even get a chance to",
    "start": "1597080",
    "end": "1603320"
  },
  {
    "text": "scan it the other thing I'd recommend doing as well is",
    "start": "1603320",
    "end": "1608659"
  },
  {
    "text": "um using the image digest and not the tag itself so often people familiar with uh",
    "start": "1608659",
    "end": "1616159"
  },
  {
    "text": "time of change time of use what that means so",
    "start": "1616159",
    "end": "1621260"
  },
  {
    "text": "imagine I tag an image 1.2",
    "start": "1621260",
    "end": "1626659"
  },
  {
    "text": "and I configure that in my kubernetes deployment and I'm about to deploy it",
    "start": "1626659",
    "end": "1632179"
  },
  {
    "text": "I tagged the images 1.2 remember then someone else because all of these",
    "start": "1632179",
    "end": "1637700"
  },
  {
    "text": "tags are you know that you can override them someone else pushes an image 1.2",
    "start": "1637700",
    "end": "1643400"
  },
  {
    "text": "so now I'm ready to deploy my application well I'm deploying theirs and not mine so",
    "start": "1643400",
    "end": "1649700"
  },
  {
    "text": "when I'm using it it's now different from the time I actually changed it right because it tags can be overwritten",
    "start": "1649700",
    "end": "1655100"
  },
  {
    "text": "however an image digest is a specific point in time if you use the image digest when it when",
    "start": "1655100",
    "end": "1660980"
  },
  {
    "text": "we deploy that workload to kubernetes it's going to use that digest configuration right which is a the",
    "start": "1660980",
    "end": "1667039"
  },
  {
    "text": "makeup of the image itself and not the tag right so from a from a security",
    "start": "1667039",
    "end": "1672559"
  },
  {
    "text": "standpoint I'm not really happy with the images that I'm seeing here right I'd much prefer digests",
    "start": "1672559",
    "end": "1679039"
  },
  {
    "text": "something that is you something that is unique and I can validate right I can easily come in here not with the nginx",
    "start": "1679039",
    "end": "1684799"
  },
  {
    "text": "ones but if I had my own registry I was running at my own company or I was a rogue employee I could easily",
    "start": "1684799",
    "end": "1690620"
  },
  {
    "text": "come and override someone else's tag they could be doing all kinds of nonsense Bitcoin mining uh",
    "start": "1690620",
    "end": "1697580"
  },
  {
    "text": "um it could be browsing and trying to work out and plot the landscape of the kubernetes cluster it could be doing anything and that application developer",
    "start": "1697580",
    "end": "1704720"
  },
  {
    "text": "has no idea right they just see the tag and they've deployed it and maybe it's working maybe it's not maybe I've added another process in there that they don't",
    "start": "1704720",
    "end": "1710900"
  },
  {
    "text": "even know existed and then from an application standpoint it's working they can hit an endpoint they see the website and I'm over here",
    "start": "1710900",
    "end": "1717320"
  },
  {
    "text": "doing Bitcoin mining on the side so",
    "start": "1717320",
    "end": "1723799"
  },
  {
    "text": "the next one we're going to do is we're going to look at all of the resources that are currently running in our cluster so",
    "start": "1723799",
    "end": "1730580"
  },
  {
    "text": "again here we can do Cube CL Cube CTL Cube cuddle depending upon how you uh",
    "start": "1730580",
    "end": "1736340"
  },
  {
    "text": "how you say it uh get all and then we're going to pass the dash dash all namespaces so what",
    "start": "1736340",
    "end": "1742400"
  },
  {
    "text": "this is going to do is it's going to give us a good understanding of everything that's running in every namespace in your kubernetes cluster",
    "start": "1742400",
    "end": "1748700"
  },
  {
    "text": "granted from an arbark perspective we need the ability to be able to see everything in our cluster but because",
    "start": "1748700",
    "end": "1754400"
  },
  {
    "text": "we're talking about security I decided to give everybody cluster admin because that's incredibly secure and we are now",
    "start": "1754400",
    "end": "1760399"
  },
  {
    "text": "going to be able to see everything so if we run this you'll see",
    "start": "1760399",
    "end": "1766419"
  },
  {
    "text": "kubernetes displays it quite nicely for us we have the replica sets that are currently running we have the the deployments that are currently there",
    "start": "1766520",
    "end": "1774200"
  },
  {
    "text": "demon set Services all of the pods etc etc however",
    "start": "1774200",
    "end": "1779659"
  },
  {
    "text": "one of the things to note is this is not giving you absolutely everything right it's giving you everything from a cube",
    "start": "1779659",
    "end": "1785960"
  },
  {
    "text": "CTL standpoint so there is a tool uh called",
    "start": "1785960",
    "end": "1792440"
  },
  {
    "text": "um get all",
    "start": "1792440",
    "end": "1795460"
  },
  {
    "text": "which kind of actually provides you all of the resources right and what we're",
    "start": "1798020",
    "end": "1803059"
  },
  {
    "text": "going to do is we're going to run this now and what you'll see is it prints out a lot more than what the default Cube",
    "start": "1803059",
    "end": "1808340"
  },
  {
    "text": "CTL get all this so when you're doing a cluster audit don't just take what Cube CTL tells you",
    "start": "1808340",
    "end": "1814100"
  },
  {
    "text": "as gospel right there's other tools that are around that actually give you a much deeper and richer response",
    "start": "1814100",
    "end": "1822260"
  },
  {
    "text": "so now in our terminal if we just run kettle",
    "start": "1822260",
    "end": "1828639"
  },
  {
    "text": "it takes a little bit of time",
    "start": "1828919",
    "end": "1832299"
  },
  {
    "text": "and now you can see there's a lot more printed out right we've now got storage classes we've got things about our back",
    "start": "1837559",
    "end": "1843380"
  },
  {
    "text": "we've got priority classes so there's a lot more richer understanding now of what's going on",
    "start": "1843380",
    "end": "1848539"
  },
  {
    "text": "from a kubernetes perspective so I use this tool more extensively than I",
    "start": "1848539",
    "end": "1853820"
  },
  {
    "text": "do the cube CTL get all because this is the real girl Cube CTO get all just you",
    "start": "1853820",
    "end": "1860779"
  },
  {
    "text": "know the bare minimum",
    "start": "1860779",
    "end": "1863860"
  },
  {
    "text": "so now we have an understanding of the images that are currently running the",
    "start": "1867200",
    "end": "1872539"
  },
  {
    "text": "resources that are currently there we've talked about images and why tags",
    "start": "1872539",
    "end": "1877700"
  },
  {
    "text": "are not not great and we should be using image digest so that's something from an audit perspective that we should be going back to our application developers",
    "start": "1877700",
    "end": "1883700"
  },
  {
    "text": "and saying and proposing to them move to image digests don't use image tags",
    "start": "1883700",
    "end": "1889279"
  },
  {
    "text": "we've got a good understanding now of of what's running so we've got some deployments in there we've got some Demon sets we've got some pods",
    "start": "1889279",
    "end": "1895820"
  },
  {
    "text": "so now what we're going to do is start to look at some workload configuration",
    "start": "1895820",
    "end": "1901820"
  },
  {
    "text": "so now if we copy this link here so now I'm on the second number two workload configurations",
    "start": "1901820",
    "end": "1909260"
  },
  {
    "text": "I'm copying and pasting the uh the command",
    "start": "1909260",
    "end": "1916720"
  },
  {
    "text": "click yes and now we're going to go through an",
    "start": "1917899",
    "end": "1923299"
  },
  {
    "text": "interactive flow so what I want to talk about is some of the ways that",
    "start": "1923299",
    "end": "1930380"
  },
  {
    "text": "applications and workloads can be insecure right and there's there's many different ways that they can be insecure",
    "start": "1930380",
    "end": "1937100"
  },
  {
    "text": "we're going to talk about how they become insecure and we're also going to talk about from a defense mechanism what are the things that we can do to be able",
    "start": "1937100",
    "end": "1943820"
  },
  {
    "text": "to secure them so the the classic one pods running is",
    "start": "1943820",
    "end": "1949100"
  },
  {
    "text": "everybody has at least one of these uh pods running in the kubernetes cluster running as root",
    "start": "1949100",
    "end": "1955880"
  },
  {
    "text": "so if you hit enter we're going to deploy we're going to create a deployment called nginx and we're going",
    "start": "1955880",
    "end": "1961820"
  },
  {
    "text": "to use the well-known nginx container",
    "start": "1961820",
    "end": "1966940"
  },
  {
    "text": "if we just keep hitting enter",
    "start": "1971419",
    "end": "1974679"
  },
  {
    "text": "so we think nginx probably may be secure well",
    "start": "1976520",
    "end": "1982700"
  },
  {
    "text": "the standard nginx container runs as root so if I can get in that container I'm going to have all kinds of fun",
    "start": "1982700",
    "end": "1988700"
  },
  {
    "text": "all right I could do do whatever I wanted so the default nginx container is now",
    "start": "1988700",
    "end": "1995539"
  },
  {
    "text": "running as root so what what options do we have available to us to make sure that that can't happen right from a from",
    "start": "1995539",
    "end": "2001659"
  },
  {
    "text": "a cluster audit perspective containers running as root especially if I'm a rogue employer I managed to get into a",
    "start": "2001659",
    "end": "2007299"
  },
  {
    "text": "kubernetes cluster or you've you've given me too much access I uh you know I can I can go Rogue so",
    "start": "2007299",
    "end": "2015700"
  },
  {
    "text": "we we have the ability to use security contexts so we can set uh",
    "start": "2015700",
    "end": "2022840"
  },
  {
    "text": "Runners non-root to true so what does that look like from a deployment perspective now we are down",
    "start": "2022840",
    "end": "2028899"
  },
  {
    "text": "at the bottom in the security contact Section and we we're saying that for this image",
    "start": "2028899",
    "end": "2034419"
  },
  {
    "text": "we want to force you to not be able to run this as root",
    "start": "2034419",
    "end": "2039720"
  },
  {
    "text": "so if we click enter here",
    "start": "2040120",
    "end": "2043980"
  },
  {
    "text": "now what we'll see is the con the Pod can't run right so the Pod actually runs as root but we've set the security",
    "start": "2053379",
    "end": "2059320"
  },
  {
    "text": "context to not run as uh to run as non-root therefore kubernetes is not going to deploy it",
    "start": "2059320",
    "end": "2065940"
  },
  {
    "text": "so we can see that's the case we do a describe of that pod",
    "start": "2068020",
    "end": "2074500"
  },
  {
    "text": "and we look for the error and kubernetes is telling us that you know we're trying to run it we have a container that's",
    "start": "2074500",
    "end": "2080378"
  },
  {
    "text": "running as root and we've specifically told it that it can't run as root so security context is going to be a key",
    "start": "2080379",
    "end": "2086260"
  },
  {
    "text": "thing that we're going to be wanting to look for when we are looking at workload configurations right what a lot of",
    "start": "2086260",
    "end": "2091480"
  },
  {
    "text": "people are what a lot of people may or may not be doing is getting their deployment configuration",
    "start": "2091480",
    "end": "2097180"
  },
  {
    "text": "set up not knowing or not worrying about the security context because there's there's some things you have to think",
    "start": "2097180",
    "end": "2103060"
  },
  {
    "text": "about right not everything some things are going to have to run as root right potentially like or",
    "start": "2103060",
    "end": "2110320"
  },
  {
    "text": "you could have public images like the nginx1 that runs as roots so there's a lot of work from an application development perspective to get that",
    "start": "2110320",
    "end": "2118599"
  },
  {
    "text": "application to not run as root so what I would recommend from an application developer",
    "start": "2118599",
    "end": "2124180"
  },
  {
    "text": "perspective is this concept of having base images so if you're running Java or",
    "start": "2124180",
    "end": "2129220"
  },
  {
    "text": "you're running go or whatever language you're running to construct base images that meet and",
    "start": "2129220",
    "end": "2136119"
  },
  {
    "text": "comply to a specific set of standards in your organization right one of the obvious ones don't run it as root but",
    "start": "2136119",
    "end": "2141820"
  },
  {
    "text": "run it as a specific type of user put the binary in a specific location put the config for the application in a",
    "start": "2141820",
    "end": "2148480"
  },
  {
    "text": "specific location set the units at the the user and group IDs right all of these things allow you",
    "start": "2148480",
    "end": "2154720"
  },
  {
    "text": "to be able to Define workload configurations that are standardized across your organization and then we can",
    "start": "2154720",
    "end": "2161380"
  },
  {
    "text": "start to look for anomalies because anything that doesn't have a urid a user ID or a group ID of a specific number we",
    "start": "2161380",
    "end": "2168700"
  },
  {
    "text": "know that that doesn't conform to your company's standards and we can start to alert on that right with a with the ever-changing kubernetes",
    "start": "2168700",
    "end": "2176020"
  },
  {
    "text": "landscape and the ability and ease for you to be able to deploy hundreds of applications in your uh for your company",
    "start": "2176020",
    "end": "2181619"
  },
  {
    "text": "consistency is going to be key right you don't want to have to go",
    "start": "2181619",
    "end": "2187060"
  },
  {
    "text": "on a long root cause analysis for you to try and figure out what's going on with your application right if there's sets",
    "start": "2187060",
    "end": "2193180"
  },
  {
    "text": "of standards that your applications must have conform to it's better that the workload cannot be deployed than it gets",
    "start": "2193180",
    "end": "2199119"
  },
  {
    "text": "deployed and is vulnerable right a little bit of friction with the application developer to make sure that we have secure workloads running in our",
    "start": "2199119",
    "end": "2205660"
  },
  {
    "text": "platform is a lot better than being audited and being and you know having to tell everybody that all",
    "start": "2205660",
    "end": "2211480"
  },
  {
    "text": "of your containers run as root and everyone's just copying and pasting configuration around",
    "start": "2211480",
    "end": "2217200"
  },
  {
    "text": "so now what we have we've seen sorry is",
    "start": "2217900",
    "end": "2223839"
  },
  {
    "text": "that we have a Public Image that is running as root and now what we want to do is stop it from running as root right and",
    "start": "2223839",
    "end": "2229540"
  },
  {
    "text": "there's a number of options for us to be able to do that so nginx Inc actually launched or created a",
    "start": "2229540",
    "end": "2237820"
  },
  {
    "text": "unprivileged container image so newsflash this is the one if you're running nginx that I would recommend",
    "start": "2237820",
    "end": "2243940"
  },
  {
    "text": "that you you use you don't use the Normal Public nginx Image right highly insecure",
    "start": "2243940",
    "end": "2249160"
  },
  {
    "text": "so it's the same deployment different image we're going to set runner's non-root to",
    "start": "2249160",
    "end": "2255820"
  },
  {
    "text": "true we're going to deploy this",
    "start": "2255820",
    "end": "2261400"
  },
  {
    "text": "now we see that this pod is actually running right so this means that this container",
    "start": "2261400",
    "end": "2266859"
  },
  {
    "text": "this container obviously is not uh running its root",
    "start": "2266859",
    "end": "2271960"
  },
  {
    "text": "so if we keep clicking through we can now see that from an ID perspective that",
    "start": "2271960",
    "end": "2277839"
  },
  {
    "text": "we are now running as the nginx user right so this is a more secure image than the well-known nginx image",
    "start": "2277839",
    "end": "2285700"
  },
  {
    "text": "so there are sometimes images that are available to you that are more secure",
    "start": "2285700",
    "end": "2290980"
  },
  {
    "text": "than the ones that you know and love right so don't just go on Docker Hub and type in the thing that you you uh you",
    "start": "2290980",
    "end": "2296440"
  },
  {
    "text": "want to leverage like nginx as an example and just take it verbatim right do some due diligence into how secure",
    "start": "2296440",
    "end": "2302200"
  },
  {
    "text": "the the uh the container is that you're actually deploying or maybe have some",
    "start": "2302200",
    "end": "2307540"
  },
  {
    "text": "standards and pro processes in place so that you can't even deploy certain certain workloads with a certain tag or",
    "start": "2307540",
    "end": "2314619"
  },
  {
    "text": "sometimes from a specific registry so",
    "start": "2314619",
    "end": "2320980"
  },
  {
    "text": "okay sure",
    "start": "2320980",
    "end": "2325200"
  },
  {
    "text": "so yeah at a per resource basis so what I would recommend again is is to try and",
    "start": "2329440",
    "end": "2336099"
  },
  {
    "text": "create application templates so if you're using something like hellmore customized the more standardized you can make the",
    "start": "2336099",
    "end": "2342579"
  },
  {
    "text": "application from its from its configuration standpoint the easier this is going to become to manage",
    "start": "2342579",
    "end": "2348838"
  },
  {
    "text": "so we can force workloads in kubernetes to to not to not run as root right",
    "start": "2348940",
    "end": "2355740"
  },
  {
    "text": "that's that's great but we can also set the user ID and group ID as well in that",
    "start": "2355740",
    "end": "2361960"
  },
  {
    "text": "configuration so again same thing same security context now but we're going to force the",
    "start": "2361960",
    "end": "2368500"
  },
  {
    "text": "user and group that we run this application to run as",
    "start": "2368500",
    "end": "2374579"
  },
  {
    "text": "why do we want to do this why why is this useful to us so",
    "start": "2374800",
    "end": "2379900"
  },
  {
    "text": "imagine I broke out of this container and I got to the underlying host imagine I was running as a root",
    "start": "2379900",
    "end": "2385660"
  },
  {
    "text": "I can do whatever I want now on the underlying host if I set an IED a user ID or a group ID",
    "start": "2385660",
    "end": "2392560"
  },
  {
    "text": "that is not going to be on the host even if I break out it's highly unlikely I'm going to be able to do something that's",
    "start": "2392560",
    "end": "2398200"
  },
  {
    "text": "why these these uids and goods are so high I deliberately set them high because they're unlikely to clash if anyone",
    "start": "2398200",
    "end": "2404859"
  },
  {
    "text": "manages to get out of the container onto the uh to the physical node itself",
    "start": "2404859",
    "end": "2411119"
  },
  {
    "text": "so we can set these again with security contacts you had endured if we hit enter here",
    "start": "2411280",
    "end": "2418300"
  },
  {
    "text": "we are going to see again that that application is able to run",
    "start": "2418300",
    "end": "2424140"
  },
  {
    "text": "and we can see that we have set successfully the user ID and the group ID to what we specified again from a",
    "start": "2426280",
    "end": "2435880"
  },
  {
    "text": "standards perspective these things are really important build up a standard within your organization of what you want to set these to and roll it out",
    "start": "2435880",
    "end": "2442540"
  },
  {
    "text": "across the board consistency is key when it comes to kubernetes it's far too easy to deploy a load of rubbish that's",
    "start": "2442540",
    "end": "2448300"
  },
  {
    "text": "insecure right and then if you're the the poor person that is in the platform team or you have to perform an audit you",
    "start": "2448300",
    "end": "2454780"
  },
  {
    "text": "have to go and you know dump all of this onto all the application Developers and then they'll all do something",
    "start": "2454780",
    "end": "2460900"
  },
  {
    "text": "completely different and you'll be back to square one right and it's just rinse and repeat over and over and over again",
    "start": "2460900",
    "end": "2466740"
  },
  {
    "text": "so again images must be designed to work with Runners user and Runners group",
    "start": "2469420",
    "end": "2475480"
  },
  {
    "text": "right we can't just set them to anything and they're just gonna they're just going to work",
    "start": "2475480",
    "end": "2481420"
  },
  {
    "text": "so let's try deploying the Public nginx Image",
    "start": "2481420",
    "end": "2488079"
  },
  {
    "text": "and setting the user and group configuration so all we've done here is",
    "start": "2488079",
    "end": "2493240"
  },
  {
    "text": "on the image specification we've switched back to that well-known nginx image",
    "start": "2493240",
    "end": "2499140"
  },
  {
    "text": "we're in a crash Loop right we cut we can't run this image with this specific",
    "start": "2504280",
    "end": "2509320"
  },
  {
    "text": "configuration this is a much safer option this is the",
    "start": "2509320",
    "end": "2514599"
  },
  {
    "text": "position that we want to be in we want workloads to not run that don't meet our standards",
    "start": "2514599",
    "end": "2521520"
  },
  {
    "text": "again we can see it needs some privileges because it's you know it's it's owning files it's writing files all",
    "start": "2521920",
    "end": "2527440"
  },
  {
    "text": "over the place we've set the user and group and the user and group is unable to be able to achieve that",
    "start": "2527440",
    "end": "2532660"
  },
  {
    "text": "so this is where you from an audit perspective you're going to start having conversations with your application developers and saying look",
    "start": "2532660",
    "end": "2539079"
  },
  {
    "text": "I've I've reviewed I'm trying to trying to set some standards here and your application's not not working let's have",
    "start": "2539079",
    "end": "2545560"
  },
  {
    "text": "that back and forward and you know move your application configuration to the standard that we want to set",
    "start": "2545560",
    "end": "2552480"
  },
  {
    "text": "so important things to note here are it's gonna the reason why we're",
    "start": "2554680",
    "end": "2560859"
  },
  {
    "text": "taking such a high user in group is it reduces the risk to run",
    "start": "2560859",
    "end": "2566740"
  },
  {
    "text": "uh or sorry the the user to exist on the underlying hosts um it's",
    "start": "2566740",
    "end": "2573460"
  },
  {
    "text": "it's important that these configuration options are are set",
    "start": "2573460",
    "end": "2579480"
  },
  {
    "text": "because we we don't want to have to keep repeating the same set of audit all over",
    "start": "2579480",
    "end": "2586420"
  },
  {
    "text": "again right we have to keep going back to the application Developers and uh and telling them that they have",
    "start": "2586420",
    "end": "2592720"
  },
  {
    "text": "to keep changing some things again do do have to run as root and if you want if",
    "start": "2592720",
    "end": "2597760"
  },
  {
    "text": "you need them to run as root you can set the group ID to zero there are a couple of links there",
    "start": "2597760",
    "end": "2602980"
  },
  {
    "text": "um all of these material is going to become available afterwards so don't worry about trying to write those URLs down",
    "start": "2602980",
    "end": "2608260"
  },
  {
    "text": "um for reasons why these configurations are important",
    "start": "2608260",
    "end": "2613500"
  },
  {
    "text": "anyone have any questions so far are we good to keep going",
    "start": "2618579",
    "end": "2623700"
  },
  {
    "text": "okay so the next one is privilege privilege escalation right so if I can elevate my",
    "start": "2624880",
    "end": "2631780"
  },
  {
    "text": "privileges I can switch to pseudo I can do all kinds of things right I can do an app to get update for example and",
    "start": "2631780",
    "end": "2638200"
  },
  {
    "text": "start installing all kinds of packages and just go Rogue on them on the container start curling endpoints",
    "start": "2638200",
    "end": "2644319"
  },
  {
    "text": "etc etc so again we're going to create a deployment",
    "start": "2644319",
    "end": "2649720"
  },
  {
    "text": "that's going to use this highly secure Docker pseudo image um",
    "start": "2649720",
    "end": "2655240"
  },
  {
    "text": "and when we look at it it's got a user and",
    "start": "2655240",
    "end": "2660880"
  },
  {
    "text": "group set right so from an initial investigation perspective this can this container image is looking a heck of a",
    "start": "2660880",
    "end": "2667900"
  },
  {
    "text": "lot better than the nginx one right some user and group stuff set maybe maybe we're good right this is",
    "start": "2667900",
    "end": "2673780"
  },
  {
    "text": "looking pretty good if we were thinking about what we were just looking for on our audit",
    "start": "2673780",
    "end": "2679560"
  },
  {
    "text": "however now I run pseudo ID and I actually have the ability to better elevate my privileges",
    "start": "2679660",
    "end": "2684880"
  },
  {
    "text": "to to the root user now I can do all kinds of things right so from an audit perspective when you go into the",
    "start": "2684880",
    "end": "2691480"
  },
  {
    "text": "container and you get access try and switch try and elevate your privileges see what you have available",
    "start": "2691480",
    "end": "2697359"
  },
  {
    "text": "you know what what do you have available availability to be able to do just because they've set those initial things",
    "start": "2697359",
    "end": "2703000"
  },
  {
    "text": "and from the from the offset it looks like you're in a good position always try and test the boundaries",
    "start": "2703000",
    "end": "2709140"
  },
  {
    "text": "so now what we'll do is we'll set the allow privilege escalation configuration to to",
    "start": "2709900",
    "end": "2716560"
  },
  {
    "text": "false and we should not be able to elevate our privileges so again exactly the same deployment we're again under",
    "start": "2716560",
    "end": "2723400"
  },
  {
    "text": "that security context we're going to set allow a privilege escalation to false",
    "start": "2723400",
    "end": "2729400"
  },
  {
    "text": "and now if we deploy this and we try and perform a pseudo we",
    "start": "2729400",
    "end": "2734980"
  },
  {
    "text": "do not have the ability to be able to do that so again from a security standpoint",
    "start": "2734980",
    "end": "2740079"
  },
  {
    "text": "stop people from being able to switch to sudo right maybe some of your applications require",
    "start": "2740079",
    "end": "2745119"
  },
  {
    "text": "sudo to be able to see certain directories this is again another conversation with",
    "start": "2745119",
    "end": "2750700"
  },
  {
    "text": "your application developers start to put your configuration that your application needs in specific",
    "start": "2750700",
    "end": "2756460"
  },
  {
    "text": "directories allow the user that that container is running as to be able to",
    "start": "2756460",
    "end": "2762220"
  },
  {
    "text": "read and maybe write to that directory so one of the things that I would recommend from a container perspective",
    "start": "2762220",
    "end": "2768220"
  },
  {
    "text": "is having a you know a slash app directory which is where your application binary runs slash config for",
    "start": "2768220",
    "end": "2774940"
  },
  {
    "text": "where your config files live and then slash data for where your data lives make",
    "start": "2774940",
    "end": "2780700"
  },
  {
    "text": "now we start to have a standard right we can allow the user whatever we've whatever you would uh user ID and group",
    "start": "2780700",
    "end": "2788319"
  },
  {
    "text": "ID that we've specified we allow them to be able to use those specific three directories and nothing else",
    "start": "2788319",
    "end": "2794440"
  },
  {
    "text": "we're now starting to get to get some secure standards",
    "start": "2794440",
    "end": "2799318"
  },
  {
    "text": "so enable service links this is an interesting one um",
    "start": "2800920",
    "end": "2806140"
  },
  {
    "text": "this is a very convenient way if I get inside your container to be able to",
    "start": "2806140",
    "end": "2811900"
  },
  {
    "text": "start to plot your kubernetes landscape from a kubernetes landscape what I'm talking about is the services that are",
    "start": "2811900",
    "end": "2818740"
  },
  {
    "text": "currently running Within kubernetes so by default",
    "start": "2818740",
    "end": "2825119"
  },
  {
    "text": "kubernetes will add in environment variables into your pod to make it",
    "start": "2825119",
    "end": "2831460"
  },
  {
    "text": "convenient in inverted in air quotes for you to be able to discover other Q other",
    "start": "2831460",
    "end": "2837400"
  },
  {
    "text": "kubernetes services so what we're going to do here is we're going to run a busy box uh pod",
    "start": "2837400",
    "end": "2843700"
  },
  {
    "text": "and if we go inside that pod and we do an end you'll see that the service that",
    "start": "2843700",
    "end": "2848859"
  },
  {
    "text": "I just created I know everything about it I know where it is I know the IP address I know the port that it's",
    "start": "2848859",
    "end": "2854200"
  },
  {
    "text": "currently running on from a hacker's perspective this is a dream right imagine you've got hundreds",
    "start": "2854200",
    "end": "2859420"
  },
  {
    "text": "of hundreds of these Services all I have to do is get into one I do an end I get all of your services I know all the",
    "start": "2859420",
    "end": "2865420"
  },
  {
    "text": "endpoints I know all the ports I just start running attacks against them and I figure out and I can plot",
    "start": "2865420",
    "end": "2870520"
  },
  {
    "text": "your kubernetes landscape from the inside so it only takes one one pod that",
    "start": "2870520",
    "end": "2876819"
  },
  {
    "text": "allows this or has this configuration by default for me to start being able to plot my whole entire kubernetes",
    "start": "2876819",
    "end": "2882099"
  },
  {
    "text": "landscape luckily for us kubernetes has a way of being able to stop this from being",
    "start": "2882099",
    "end": "2887980"
  },
  {
    "text": "displayed not a well-known uh configuration option so under the spec",
    "start": "2887980",
    "end": "2893619"
  },
  {
    "text": "here you can set enable service links to false and what that will do now",
    "start": "2893619",
    "end": "2899440"
  },
  {
    "text": "is when we run the same container image but we have this set when we do nth we only get the",
    "start": "2899440",
    "end": "2905319"
  },
  {
    "text": "kubernetes one right we have to get the kubernetes one to be able to talk to the kubernetes API if we need to be able to interact with kubernetes however the",
    "start": "2905319",
    "end": "2912460"
  },
  {
    "text": "service that we previously deployed we cannot see anymore so from an Auditor's perspective think",
    "start": "2912460",
    "end": "2918099"
  },
  {
    "text": "about you know what that what someone could do with the information by default right so",
    "start": "2918099",
    "end": "2924280"
  },
  {
    "text": "kubernetes by default is giving me everything the application developers should know",
    "start": "2924280",
    "end": "2929440"
  },
  {
    "text": "the endpoints right they should know the services talking about consistency there's no need for us to be able to",
    "start": "2929440",
    "end": "2935380"
  },
  {
    "text": "display all this information in you know inside the container",
    "start": "2935380",
    "end": "2940260"
  },
  {
    "text": "setcom profiles so by default workloads that get deployed into",
    "start": "2944560",
    "end": "2950140"
  },
  {
    "text": "kubernetes do not have set com profiles provided to you",
    "start": "2950140",
    "end": "2955660"
  },
  {
    "text": "um pretty insecure probably want to set",
    "start": "2955660",
    "end": "2961060"
  },
  {
    "text": "some setcom profiles luckily kubernetes provides us with the ability to be able to set set",
    "start": "2961060",
    "end": "2968319"
  },
  {
    "text": "comp profiles so what I've done here is deployed an nginx image and just looked at the techcom profiles that it has",
    "start": "2968319",
    "end": "2974560"
  },
  {
    "text": "available and we can see there that there are there are none however",
    "start": "2974560",
    "end": "2981960"
  },
  {
    "text": "let's keep going we can set centcom profiles by",
    "start": "2984099",
    "end": "2991480"
  },
  {
    "text": "configuring an annotation on the workload to set a specific type so kubernetes",
    "start": "2991480",
    "end": "2997599"
  },
  {
    "text": "actually provides you with a couple of defaults out of the box that you you may",
    "start": "2997599",
    "end": "3002640"
  },
  {
    "text": "want to use or you can create your own they are a specific type of resource in kubernetes and then you at your workload",
    "start": "3002640",
    "end": "3009420"
  },
  {
    "text": "level set an annotation and then specify the setcom profile that you want to Leverage",
    "start": "3009420",
    "end": "3016640"
  },
  {
    "text": "dropping capabilities right we don't every container and every workload that's currently running in the kubernetes cluster does not need all the",
    "start": "3019800",
    "end": "3026280"
  },
  {
    "text": "capabilities that it could possibly have right applications barely need any",
    "start": "3026280",
    "end": "3031680"
  },
  {
    "text": "some some uh public images will require more so again we have the ability to be able",
    "start": "3031680",
    "end": "3039119"
  },
  {
    "text": "to set this with within our security context",
    "start": "3039119",
    "end": "3044940"
  },
  {
    "text": "or you could use Upstream images like we were using before this nginx I'm privileged which",
    "start": "3044940",
    "end": "3051720"
  },
  {
    "text": "set some of these for you by default and and reduces what capabilities you have available to you",
    "start": "3051720",
    "end": "3059119"
  },
  {
    "text": "so here again we're back to our normal nginx image",
    "start": "3060420",
    "end": "3066180"
  },
  {
    "text": "and we are going to drop all of the capabilities within nginx right we're not going to allow any of them",
    "start": "3066180",
    "end": "3072359"
  },
  {
    "text": "this is the default position that I would go with drop all of the capabilities and slowly but surely add",
    "start": "3072359",
    "end": "3077880"
  },
  {
    "text": "the ones that you need right don't allow all of them and then work backwards so this is an iterative process excuse",
    "start": "3077880",
    "end": "3084540"
  },
  {
    "text": "me that you'd have to go on with your application developers to understand what capabilities they need within their",
    "start": "3084540",
    "end": "3090059"
  },
  {
    "text": "application so if we deploy this and drop all the",
    "start": "3090059",
    "end": "3095160"
  },
  {
    "text": "capabilities we can see that nginx is unable to be able to run",
    "start": "3095160",
    "end": "3100760"
  },
  {
    "text": "and then we look at the logs we can start to understand what it needs right it's it's churning some files here",
    "start": "3102599",
    "end": "3109260"
  },
  {
    "text": "so we need to allow it to be able to have the capability to be able to tone things",
    "start": "3109260",
    "end": "3115400"
  },
  {
    "text": "again this is an iterative process right you're going to have to keep trying and trying to run the application dropping",
    "start": "3117059",
    "end": "3123059"
  },
  {
    "text": "and allowing each type of capability until you get the holy grail and it actually runs",
    "start": "3123059",
    "end": "3128819"
  },
  {
    "text": "your application developers are going to love you because this is probably going to be like a 10 15 30 minute exercise for every single application",
    "start": "3128819",
    "end": "3136700"
  },
  {
    "text": "so how do we reproduce this locally so we run the docker container itself and",
    "start": "3137880",
    "end": "3144300"
  },
  {
    "text": "we use this cap drop flag and we set them to all so this is going to drop all of the capabilities",
    "start": "3144300",
    "end": "3150300"
  },
  {
    "text": "we again are in the same position so we can see that it needs a tone so now what we can do",
    "start": "3150300",
    "end": "3156960"
  },
  {
    "text": "is we can still keep the drop all but now add the",
    "start": "3156960",
    "end": "3162720"
  },
  {
    "text": "capability of cap tone run it again see what happens I'm not going to go through this iterative process like there's four",
    "start": "3162720",
    "end": "3168960"
  },
  {
    "text": "or five of them it actually needs um and then finally you'll get to a configuration standpoint where you'll",
    "start": "3168960",
    "end": "3175980"
  },
  {
    "text": "know the exact number of capabilities that your application needs to be able to run again it's time consuming however",
    "start": "3175980",
    "end": "3182040"
  },
  {
    "text": "it makes sure that the the container configuration is as secure as it possibly can be",
    "start": "3182040",
    "end": "3189440"
  },
  {
    "text": "yeah continue dropping them and adding them until you until you reach the holy grail and the application actually runs",
    "start": "3193319",
    "end": "3200540"
  },
  {
    "text": "so this is the actual nginx configuration with the very insecure running as root image with the",
    "start": "3201240",
    "end": "3208260"
  },
  {
    "text": "capabilities that need to be added so again to reiterate when you're performing the audit one of the things",
    "start": "3208260",
    "end": "3214619"
  },
  {
    "text": "that we should be looking for is them dropping all of the capabilities and only adding the ones that they need to",
    "start": "3214619",
    "end": "3220500"
  },
  {
    "text": "add if this configuration is not set at all they have all the capabilities by default",
    "start": "3220500",
    "end": "3227000"
  },
  {
    "text": "we can see the nginx image successfully running now with those capabilities finally added",
    "start": "3231720",
    "end": "3238099"
  },
  {
    "text": "now we also have images available to us whereby we can drop all of the capabilities because it doesn't need any",
    "start": "3241500",
    "end": "3247380"
  },
  {
    "text": "right this is the this is the ideal end State I don't want to necessarily have to add all of the capabilities line by",
    "start": "3247380",
    "end": "3253800"
  },
  {
    "text": "line in my kubernetes configuration so by default the nginx unprivileged container doesn't require any new",
    "start": "3253800",
    "end": "3261359"
  },
  {
    "text": "capabilities to be added therefore we can drop all this is the ideal uh configuration",
    "start": "3261359",
    "end": "3267780"
  },
  {
    "text": "to be able to get to the standpoint so again we can deploy that workload",
    "start": "3267780",
    "end": "3274319"
  },
  {
    "text": "and now we can see that that workload is successfully running",
    "start": "3274319",
    "end": "3278540"
  },
  {
    "text": "so one of the things to to bear in mind now",
    "start": "3280559",
    "end": "3286200"
  },
  {
    "text": "is what is the application actually doing what does it need to do inside the",
    "start": "3286200",
    "end": "3291540"
  },
  {
    "text": "container maybe it's just running a binary right and it just provides an API endpoint or maybe it actually needs to",
    "start": "3291540",
    "end": "3298380"
  },
  {
    "text": "write some configuration at startup for it to be able to know where the database connection is or where a third-party",
    "start": "3298380",
    "end": "3304619"
  },
  {
    "text": "application is so by default",
    "start": "3304619",
    "end": "3309660"
  },
  {
    "text": "all of your uh pods have a writable root",
    "start": "3309660",
    "end": "3315240"
  },
  {
    "text": "file system right I can go in there and write whatever I want obviously we don't want to be able to do",
    "start": "3315240",
    "end": "3320880"
  },
  {
    "text": "that again same thing again when I was talking about having that common directory structure within your application configuration this is why we",
    "start": "3320880",
    "end": "3328319"
  },
  {
    "text": "want to start to be able to do this right we want to make the root file system by default read only and then",
    "start": "3328319",
    "end": "3333540"
  },
  {
    "text": "have directories where the application can perform its work doesn't need to be able to write to all of the directories",
    "start": "3333540",
    "end": "3338760"
  },
  {
    "text": "that are possible on the root file system so",
    "start": "3338760",
    "end": "3345000"
  },
  {
    "text": "what I'm doing here is I'm running our nice Docker pseudo image that we run earlier and I'm running a sudo apt",
    "start": "3345000",
    "end": "3350579"
  },
  {
    "text": "update right and now because the root file system is writable I can install",
    "start": "3350579",
    "end": "3356579"
  },
  {
    "text": "all the packages that I want I can run anything that I want to be able to run right from a hacker's perspective this",
    "start": "3356579",
    "end": "3361619"
  },
  {
    "text": "is a dream I can install all kinds of tools I can work out what's going on in your",
    "start": "3361619",
    "end": "3367140"
  },
  {
    "text": "cluster start to sniff traffic between services like the list is endless what I can do here all right we don't want to",
    "start": "3367140",
    "end": "3372839"
  },
  {
    "text": "allow every application to be able to have a writable read-only file system",
    "start": "3372839",
    "end": "3380599"
  },
  {
    "text": "so luckily enough for us kubernetes provides us with a security context to where we can set this",
    "start": "3382440",
    "end": "3388140"
  },
  {
    "text": "to True right so we can set the default position to have a read-only file system",
    "start": "3388140",
    "end": "3394160"
  },
  {
    "text": "again we're going to run the same image we're going to use the security context and set the read-only root file system",
    "start": "3394500",
    "end": "3400140"
  },
  {
    "text": "to true",
    "start": "3400140",
    "end": "3402680"
  },
  {
    "text": "and when we try and do a pseudo update it's not possible right we don't have the ability for us to be able to do that",
    "start": "3410520",
    "end": "3417260"
  },
  {
    "text": "again we can also have and try and use this with our with our Public Image that we have available to us set the",
    "start": "3422700",
    "end": "3429180"
  },
  {
    "text": "read-only file system to uh to True container is unable to run right because",
    "start": "3429180",
    "end": "3434760"
  },
  {
    "text": "it if you remember before it needed to be able to write to the to the underlying file system",
    "start": "3434760",
    "end": "3440480"
  },
  {
    "text": "I'm going to skip through this",
    "start": "3443220",
    "end": "3446540"
  },
  {
    "text": "so what we can do is we need to be able to find and locate the directories where this application needs to be able to run",
    "start": "3448319",
    "end": "3455760"
  },
  {
    "text": "and then once we have those we can mount those uh Mount empty directories inside",
    "start": "3455760",
    "end": "3463559"
  },
  {
    "text": "of our container at the specific uh directory location that the application actually needs",
    "start": "3463559",
    "end": "3469740"
  },
  {
    "text": "right so if we have application configurations where we have a standardized directory structure",
    "start": "3469740",
    "end": "3475440"
  },
  {
    "text": "this becomes very easy right we have the same directory structure we create some empty volumes they are able to write and",
    "start": "3475440",
    "end": "3481020"
  },
  {
    "text": "read files from those",
    "start": "3481020",
    "end": "3484040"
  },
  {
    "text": "okay that's cancel out of here let's go to uh rbac",
    "start": "3488940",
    "end": "3496339"
  },
  {
    "text": "so we've talked about some workload configuration and how we can secure our workloads but",
    "start": "3506520",
    "end": "3514280"
  },
  {
    "text": "arbuck allows users and workloads to be able to",
    "start": "3514280",
    "end": "3520020"
  },
  {
    "text": "access resources that are currently running in the kubernetes API so what I'm going to demonstrate here is the",
    "start": "3520020",
    "end": "3526799"
  },
  {
    "text": "unnecessary use of a list permission so kubernetes by default allows you to be able to get list and watch things what",
    "start": "3526799",
    "end": "3533579"
  },
  {
    "text": "we are going to do is we're going to create a service account inside of kubernetes",
    "start": "3533579",
    "end": "3538920"
  },
  {
    "text": "we are going to provide a role whereby the only thing",
    "start": "3538920",
    "end": "3545220"
  },
  {
    "text": "that we can do is we can list secrets in that specific namespace",
    "start": "3545220",
    "end": "3552500"
  },
  {
    "text": "we create a role binding whereby we're going to bind that service account to that cluster role",
    "start": "3554460",
    "end": "3561619"
  },
  {
    "text": "we're going to create a secret running inside of that namespace",
    "start": "3563760",
    "end": "3569059"
  },
  {
    "text": "we're going to create a deployment we're going to use the service account as the service account that we just created so",
    "start": "3575220",
    "end": "3580260"
  },
  {
    "text": "remember it can only list secrets",
    "start": "3580260",
    "end": "3584400"
  },
  {
    "text": "oh",
    "start": "3597119",
    "end": "3599660"
  },
  {
    "text": "so now I'm inside this running container",
    "start": "3609240",
    "end": "3613339"
  },
  {
    "text": "I'm going to run this command here this command is going to try and get that specific secret that we've just deployed",
    "start": "3616020",
    "end": "3621299"
  },
  {
    "text": "what you'll notice is that I can't get the data from that secret I'm getting forbidden",
    "start": "3621299",
    "end": "3627619"
  },
  {
    "text": "however if I use the kubernetes API to now do a list",
    "start": "3628500",
    "end": "3634680"
  },
  {
    "text": "right list all of the secrets that I currently have available to us I now have the ability to see every Secret",
    "start": "3634680",
    "end": "3639900"
  },
  {
    "text": "inside that namespace and the data within that secret",
    "start": "3639900",
    "end": "3644540"
  },
  {
    "text": "so be very careful from an audit perspective of when you're using that list watch also has the same problem so",
    "start": "3645359",
    "end": "3652200"
  },
  {
    "text": "you really want to make sure that the user uses uh or your application uses gets",
    "start": "3652200",
    "end": "3658440"
  },
  {
    "text": "more than it does list list is giving you way too many permissions right I can see every single Secret inside of my",
    "start": "3658440",
    "end": "3665040"
  },
  {
    "text": "whole entire namespace I may only want to be able to get a specific Secret",
    "start": "3665040",
    "end": "3670338"
  },
  {
    "text": "foreign the next thing we want to be able to do",
    "start": "3683220",
    "end": "3689700"
  },
  {
    "text": "now is after we've gone and and looked at some of the arbuck that we have available to us we've looked at some of",
    "start": "3689700",
    "end": "3695760"
  },
  {
    "text": "the workload configuration we now actually want to be able to perform an audit so things that we want to look for is",
    "start": "3695760",
    "end": "3702299"
  },
  {
    "text": "things that we've discussed and wanted to be able to stop before so some high level ones containers running as",
    "start": "3702299",
    "end": "3707819"
  },
  {
    "text": "privileged containers that are allowed to perform privilege escalation containers that can run as roots and",
    "start": "3707819",
    "end": "3713400"
  },
  {
    "text": "containers that do not have a read-only file system so what we're doing here is honing into workloads more than we are",
    "start": "3713400",
    "end": "3719339"
  },
  {
    "text": "our back our back is a is a from an audit perspective is still very important but we're focusing here on the",
    "start": "3719339",
    "end": "3725280"
  },
  {
    "text": "workloads that are currently running so there is a tool called uh Cube audit",
    "start": "3725280",
    "end": "3732000"
  },
  {
    "text": "by Shopify I don't know if you guys are familiar with that that will allow you to be able to run",
    "start": "3732000",
    "end": "3738180"
  },
  {
    "text": "this and start to look at the configuration of your the workloads that are running in your kubernetes cluster",
    "start": "3738180",
    "end": "3744000"
  },
  {
    "text": "and see where the insecurities or vulnerabilities are so we are going to we've deployed",
    "start": "3744000",
    "end": "3750960"
  },
  {
    "text": "keyboard it and we're now going to run keyboard it privileged in our namespace that we've currently provided so what",
    "start": "3750960",
    "end": "3756359"
  },
  {
    "text": "privilege is doing is it's looking for any privileged containers that have the ability to be able to run",
    "start": "3756359",
    "end": "3762059"
  },
  {
    "text": "and what we can see here if we scroll up is it lists out each individual deployment and provides you warnings",
    "start": "3762059",
    "end": "3769619"
  },
  {
    "text": "around your configuration so we can see here that it's recommending that we",
    "start": "3769619",
    "end": "3776940"
  },
  {
    "text": "we set the we set privilege to focus on all of these applications that we've previously deployed",
    "start": "3776940",
    "end": "3783140"
  },
  {
    "text": "there are there are a load of um Cube audit Flags available to you you",
    "start": "3783720",
    "end": "3789660"
  },
  {
    "text": "can run keyboard in cluster mode which essentially runs it inside the cluster and constantly runs uh an audit for you",
    "start": "3789660",
    "end": "3796020"
  },
  {
    "text": "gets a good understanding of your kubernetes landscape and provides you a report out the back of that you can",
    "start": "3796020",
    "end": "3801299"
  },
  {
    "text": "download that as a CSV or Json file and you can use that to really dig into um",
    "start": "3801299",
    "end": "3807000"
  },
  {
    "text": "to your your audit",
    "start": "3807000",
    "end": "3811520"
  },
  {
    "text": "I wanted to show guardrails but I'm I'm conscious of time so",
    "start": "3815160",
    "end": "3822200"
  },
  {
    "text": "I'm going to leave it there and I'm going to open the floor for questions um thanks very much uh again Jimmy I",
    "start": "3823559",
    "end": "3829200"
  },
  {
    "text": "myself Adam and Andrew will be at the expo hall uh boo G 32 uh come along to",
    "start": "3829200",
    "end": "3837599"
  },
  {
    "text": "the booth see what we're doing um yeah thank you very much [Applause]",
    "start": "3837599",
    "end": "3849540"
  },
  {
    "text": "anyone have any questions",
    "start": "3849540",
    "end": "3852500"
  },
  {
    "text": "yeah so the the URL that I provided um",
    "start": "3858200",
    "end": "3864680"
  },
  {
    "text": "this URL here is going to maintain online it's the whole Workshop end to end it will go",
    "start": "3865559",
    "end": "3871559"
  },
  {
    "text": "through with you you can clone uh the Repository all of the demos all of the scripts that",
    "start": "3871559",
    "end": "3879000"
  },
  {
    "text": "we've currently run are are in that repository you can create a gke cluster and run through this whole thing",
    "start": "3879000",
    "end": "3884700"
  },
  {
    "text": "yourself uh this one here yeah",
    "start": "3884700",
    "end": "3891680"
  },
  {
    "text": "yeah it's all in there the workshop all of the workshop configuration is is in here",
    "start": "3897059",
    "end": "3903500"
  },
  {
    "text": "the step by step is also yeah step by step is also in there do you need to use these not for me",
    "start": "3904040",
    "end": "3912180"
  },
  {
    "text": "so if you if you want to be able to run the repository locally uh there is a",
    "start": "3912180",
    "end": "3917400"
  },
  {
    "text": "make file task just run make run from that directory that will spin up the website for you locally if you want to",
    "start": "3917400",
    "end": "3923579"
  },
  {
    "text": "run it locally um and if you don't you can use this URL here this URL is going to be up for the",
    "start": "3923579",
    "end": "3929640"
  },
  {
    "text": "whole of coupon and further on",
    "start": "3929640",
    "end": "3933558"
  },
  {
    "text": "anyone else have any questions",
    "start": "3935460",
    "end": "3938599"
  },
  {
    "text": "perfect thank you very much yeah let's thank our speaker once again yes thanks Jeff thanks Jimmy",
    "start": "3941160",
    "end": "3948070"
  },
  {
    "text": "[Applause]",
    "start": "3948070",
    "end": "3952699"
  }
]