[
  {
    "text": "hello I'm Stefan pran I'm a flux C maintainer for a long time now very",
    "start": "599",
    "end": "7879"
  },
  {
    "text": "happy to be here with you and I'm super excited about Alec and",
    "start": "7879",
    "end": "13280"
  },
  {
    "text": "what he will share with us he will tell us how um Cisco uses FL X",
    "start": "13280",
    "end": "19480"
  },
  {
    "text": "scale and after he's doing his presentation showing us how he's using",
    "start": "19480",
    "end": "25920"
  },
  {
    "text": "his flux with Helm with customized with Advanced Kido setups I will um come up",
    "start": "25920",
    "end": "32320"
  },
  {
    "text": "with some crazy ideas on how to optimize the current setup and yeah hopefully",
    "start": "32320",
    "end": "39360"
  },
  {
    "text": "some of you will try these crazy ideas and you'll tell me afterwards if they work okay thank you go thanks stepan",
    "start": "39360",
    "end": "48520"
  },
  {
    "text": "yeah good afternoon my name is Alec hon and I'm principal engineer in the Cisco",
    "start": "48520",
    "end": "53760"
  },
  {
    "text": "iot group and uh two years ago I I had to come up with a plan to deploy",
    "start": "53760",
    "end": "61079"
  },
  {
    "text": "a lot of workload on kubernetes and uh in our case we",
    "start": "61079",
    "end": "66119"
  },
  {
    "text": "have um a lot of data centers to cover um probably around a few hundred",
    "start": "66119",
    "end": "73119"
  },
  {
    "text": "clusters and we have not different very wide variations of type of workloads to",
    "start": "73119",
    "end": "78560"
  },
  {
    "text": "deploy right so pretty tough problem but two years ago there was not much documentation how to do this with drugs",
    "start": "78560",
    "end": "85280"
  },
  {
    "text": "and uh I'm going to do today is I kind of show you uh how how we did it and uh",
    "start": "85280",
    "end": "90439"
  },
  {
    "text": "how it works and um in our case we we have a a big team right we have about",
    "start": "90439",
    "end": "97200"
  },
  {
    "text": "over 200 people working on this uh platform uh going from developers to",
    "start": "97200",
    "end": "104159"
  },
  {
    "text": "testers uh people who release code uh People Who develops some Sr",
    "start": "104159",
    "end": "109920"
  },
  {
    "text": "teams and it was really challenged to to see how to build something around",
    "start": "109920",
    "end": "115520"
  },
  {
    "text": "flux um that allows all these different teams to work together without",
    "start": "115520",
    "end": "120799"
  },
  {
    "text": "uh with as little friction as possible right and and um in terms of um of what",
    "start": "120799",
    "end": "128200"
  },
  {
    "text": "we're deploying we deploy a mix of Open Source H charts and a lot of H charts",
    "start": "128200",
    "end": "134160"
  },
  {
    "text": "developed internally like around a few hundred right and um on every clusters",
    "start": "134160",
    "end": "140040"
  },
  {
    "text": "that we have to deploy to uh they can be different types a different size some",
    "start": "140040",
    "end": "145200"
  },
  {
    "text": "data centers have different loads and um in our case we we had to",
    "start": "145200",
    "end": "150480"
  },
  {
    "text": "deal with know this variety of targets and all of these data centers",
    "start": "150480",
    "end": "155920"
  },
  {
    "text": "currently are running across the world uh we have some in Europe Asia uh North",
    "start": "155920",
    "end": "162840"
  },
  {
    "text": "America uh Middle East and um we also are trying to have a common model to",
    "start": "162840",
    "end": "169120"
  },
  {
    "text": "deploy on pram and on public Cloud as well so um the other concern we had is",
    "start": "169120",
    "end": "176000"
  },
  {
    "text": "uh know when you define production you have to make sure that uh um um not everybody can touch these",
    "start": "176000",
    "end": "184159"
  },
  {
    "text": "deployments right so the way to organize uh the the G repositories right when you",
    "start": "184159",
    "end": "189560"
  },
  {
    "text": "use flux is very uh critical in in ensuring that uh you can control exactly",
    "start": "189560",
    "end": "195239"
  },
  {
    "text": "what goes into production right so we're going to cover all of these different um uh aspects right so if you new to get um",
    "start": "195239",
    "end": "203799"
  },
  {
    "text": "the first thing that you'll have to do is uh kind of decide uh what kind of git",
    "start": "203799",
    "end": "209040"
  },
  {
    "text": "repositories and what layout you're going to use right so if you start there's a no single repo that's very",
    "start": "209040",
    "end": "215360"
  },
  {
    "text": "easy to use uh to start with so a lot of people use single refos and then they",
    "start": "215360",
    "end": "221360"
  },
  {
    "text": "start adding more H charts uh more clusters and they they start to run into",
    "start": "221360",
    "end": "226760"
  },
  {
    "text": "issues like like for example U as as your team grows uh you'll have single refos will have a lot of comets on it",
    "start": "226760",
    "end": "233799"
  },
  {
    "text": "and you have a mix of comets uh coming from developers from um your release",
    "start": "233799",
    "end": "238879"
  },
  {
    "text": "teams so and so and the problem is there it's very hard to to enforce that know",
    "start": "238879",
    "end": "244599"
  },
  {
    "text": "only certain like only certain people can commit to Productions versus a",
    "start": "244599",
    "end": "249879"
  },
  {
    "text": "tester right and and if you look at the git log it becomes a mess because you have a maybe 90% of your history will be",
    "start": "249879",
    "end": "258479"
  },
  {
    "text": "uh developers know testing deployments and then maybe 5% is just the production clusters um so um not pretty much uh the",
    "start": "258479",
    "end": "266680"
  },
  {
    "text": "only way for large scale is to have multiple G repons right and most good",
    "start": "266680",
    "end": "271880"
  },
  {
    "text": "people can address most of these issues uh the challenge is uh how how do",
    "start": "271880",
    "end": "277199"
  },
  {
    "text": "you keep these uh um g triplers in sync right so um and um the other challenge",
    "start": "277199",
    "end": "284960"
  },
  {
    "text": "we had is um how do you link a flux um departments to the way that you build",
    "start": "284960",
    "end": "290440"
  },
  {
    "text": "software right um you can have a lot of users developing no changing code in h",
    "start": "290440",
    "end": "296039"
  },
  {
    "text": "charts so how do you tie all of these together um the the the way that we do in terms of Kit",
    "start": "296039",
    "end": "302240"
  },
  {
    "text": "repositories we use u a two level U model right to two levels of git",
    "start": "302240",
    "end": "308400"
  },
  {
    "text": "repositories and um what you see here is on the left side you see um all the",
    "start": "308400",
    "end": "314520"
  },
  {
    "text": "source code of your applications right that's where you know 99% of your code resides right uh in our case we have one",
    "start": "314520",
    "end": "321479"
  },
  {
    "text": "git repo per application or per H chart right and and there you see a mix of",
    "start": "321479",
    "end": "326759"
  },
  {
    "text": "Open Source Time charts and uh internally developed charts right and um",
    "start": "326759",
    "end": "332199"
  },
  {
    "text": "and we have a CI system that builds this uh this chart so every time somebody commits something there um the CI kicks",
    "start": "332199",
    "end": "339520"
  },
  {
    "text": "in and builds the H charts the container images and go into uh container registry",
    "start": "339520",
    "end": "345479"
  },
  {
    "text": "and Helm repository right so that's the lower side of it right on the right side you see a lot of clusters and um we have",
    "start": "345479",
    "end": "354080"
  },
  {
    "text": "two types of uh two groups of clusters let's say one that's only production clusters right",
    "start": "354080",
    "end": "360520"
  },
  {
    "text": "and then another group that are all the testers that we use for testing and U and for that uh we're going to see a",
    "start": "360520",
    "end": "367000"
  },
  {
    "text": "little bit how these git repos work together and and let's start with the uh",
    "start": "367000",
    "end": "372400"
  },
  {
    "text": "level two right uh this this is cluster we call it blueprints uh G repository",
    "start": "372400",
    "end": "378560"
  },
  {
    "text": "right and uh this report contains uh deployment instructions on typical",
    "start": "378560",
    "end": "384319"
  },
  {
    "text": "workloads that you want to deploy on every type of cluster like for example you have two examples of uh blueprints",
    "start": "384319",
    "end": "392039"
  },
  {
    "text": "one that deploys um Vault server and another one that deploys an application right that is comprised of uh several H",
    "start": "392039",
    "end": "400080"
  },
  {
    "text": "charts right and um and you see in this example we we deploy the the VA uh",
    "start": "400080",
    "end": "406199"
  },
  {
    "text": "blueprint in one cluster in production and then the the application blueprint we deployed in three uh three different",
    "start": "406199",
    "end": "412560"
  },
  {
    "text": "clusters right um so the role of this um uh blueprint repository is really to",
    "start": "412560",
    "end": "418160"
  },
  {
    "text": "contain uh instructions of uh how to deploy a certain type of workload like",
    "start": "418160",
    "end": "423199"
  },
  {
    "text": "know which H charts to deploy uh what are their dependencies um and uh this uh",
    "start": "423199",
    "end": "430360"
  },
  {
    "text": "repositories is not very big in size maybe a few thousand lines of code right it contains mostly uh flux um Custom",
    "start": "430360",
    "end": "438840"
  },
  {
    "text": "Custom resources like Helm relas Helm repositories right and and dependencies",
    "start": "438840",
    "end": "445400"
  },
  {
    "text": "between them right so and and what um the owners of these G repositories are",
    "start": "445400",
    "end": "451000"
  },
  {
    "text": "really applic people who develop applications right so developers own it and every time they add a new her chart",
    "start": "451000",
    "end": "458440"
  },
  {
    "text": "um they usually create a new Helmer release on that g repo uh and then they attach it to hel repos Z3 right and and",
    "start": "458440",
    "end": "466680"
  },
  {
    "text": "from there it's already to deploy to any cluster right so and on this content",
    "start": "466680",
    "end": "471800"
  },
  {
    "text": "there is also agnostic of the target cluster right so uh because we don't we want to reuse the same blueprint right",
    "start": "471800",
    "end": "478319"
  },
  {
    "text": "on to run on Multi all type of targets um so this refer also we don't",
    "start": "478319",
    "end": "485080"
  },
  {
    "text": "want uh um release teams or Sr team to touch it right they all they know is",
    "start": "485080",
    "end": "490520"
  },
  {
    "text": "that uh there's a blueprint to deploy and we use intensively uh get uh branches and tags to to version our our",
    "start": "490520",
    "end": "498240"
  },
  {
    "text": "blueprints right um next level is the level one of G repo so this is really uh",
    "start": "498240",
    "end": "506080"
  },
  {
    "text": "uh a place to to link together a a cluster and then a blueprint right so um",
    "start": "506080",
    "end": "512760"
  },
  {
    "text": "this um um so we have one git repo per per group of clusters right so we have",
    "start": "512760",
    "end": "518880"
  },
  {
    "text": "one good Trio for all the production clusters and one for all the um test clusters right and cly the production uh",
    "start": "518880",
    "end": "527040"
  },
  {
    "text": "get repo only the release team Sr team can can make comments there right so",
    "start": "527040",
    "end": "533279"
  },
  {
    "text": "it's much easier to enforce uh roles based access trans for and then the cluster the test one is uh developers",
    "start": "533279",
    "end": "540959"
  },
  {
    "text": "and test they can access it and uh they can make changes there right so so in",
    "start": "540959",
    "end": "546519"
  },
  {
    "text": "addition to for each cluster you have one folder in that uh G repository and",
    "start": "546519",
    "end": "551920"
  },
  {
    "text": "that folder contains basically a link to which blueprint to use uh which version",
    "start": "551920",
    "end": "557399"
  },
  {
    "text": "of that blueprint to use and it also contains the configuration parameters uh specific to that particular cluster",
    "start": "557399",
    "end": "564240"
  },
  {
    "text": "right so that's how you kind of uh distinguish uh what goes into each uh git Repository",
    "start": "564240",
    "end": "570880"
  },
  {
    "text": "and so we're going to see on the next slides um how we manage to control all these different configuration parameters",
    "start": "570880",
    "end": "577040"
  },
  {
    "text": "right and then the second part is also how we attach our release how do we release our versions of H charts to our",
    "start": "577040",
    "end": "585560"
  },
  {
    "text": "deployments and uh as you can see there's also two different models of deployments we support U for test uh",
    "start": "585560",
    "end": "592200"
  },
  {
    "text": "testers what they would want is that uh whenever they commit something in the Herm chart right they want their test",
    "start": "592200",
    "end": "598640"
  },
  {
    "text": "cluster to update automatically to the version that they just build right so this is kind of a live updates right and",
    "start": "598640",
    "end": "606399"
  },
  {
    "text": "that's something that we will use mostly on the on the test cluster side right on production clusters uh that's something",
    "start": "606399",
    "end": "612959"
  },
  {
    "text": "you don't want to use right U because there you really want to um to make sure that whatever you deploy uh is is really",
    "start": "612959",
    "end": "620680"
  },
  {
    "text": "pinned to certain versions of H chart right and you don't want your developers to be able to know commit something that",
    "start": "620680",
    "end": "627839"
  },
  {
    "text": "would impact your production cust",
    "start": "627839",
    "end": "631320"
  },
  {
    "text": "um so um in terms of um how how do you",
    "start": "633000",
    "end": "638120"
  },
  {
    "text": "um differentiate your your deartment per clusters for for that we're using a feature in in F which is called",
    "start": "638120",
    "end": "645279"
  },
  {
    "text": "substitution variables right so it's a very nice feature that allows us to to",
    "start": "645279",
    "end": "650399"
  },
  {
    "text": "control exactly what we run and how we run on each blueprint in each cluster",
    "start": "650399",
    "end": "655560"
  },
  {
    "text": "right so you see here so um on the left side we we example of one Helm chart called the F info right and this Helm",
    "start": "655560",
    "end": "663000"
  },
  {
    "text": "chart has it a list of values right the default values with the helm chart right so and typically what you do is you want",
    "start": "663000",
    "end": "669839"
  },
  {
    "text": "to deploy this somewhere you have to create the helm release file and that file will point to the the helm chap to",
    "start": "669839",
    "end": "676360"
  },
  {
    "text": "use and then it also contains a section called spec. values that allows you to",
    "start": "676360",
    "end": "681720"
  },
  {
    "text": "override the the different values uh in your values in your H chart right so here are examples of two different uh",
    "start": "681720",
    "end": "688240"
  },
  {
    "text": "fields and values that we want to uh to be able to customize per Target right and there",
    "start": "688240",
    "end": "694440"
  },
  {
    "text": "instead of putting the the value we use for each cluster we use a variable right fux variable and then optionally we can",
    "start": "694440",
    "end": "701920"
  },
  {
    "text": "also put a default value right so so you see that there the default blueprint you",
    "start": "701920",
    "end": "707200"
  },
  {
    "text": "can end up with a number of different variables right and then in general when you have a blueprint blueprint is",
    "start": "707200",
    "end": "713200"
  },
  {
    "text": "comprised of U possibly dozens of hundreds of Helm releases right and that",
    "start": "713200",
    "end": "718680"
  },
  {
    "text": "gives you a l list of uh of uh flux variables right that you can use to",
    "start": "718680",
    "end": "723760"
  },
  {
    "text": "customize each uh each Target deployment right uh so that's on the blueprint side",
    "start": "723760",
    "end": "729480"
  },
  {
    "text": "on the cluster uh G repo side uh we have that's where you define the value to use",
    "start": "729480",
    "end": "735279"
  },
  {
    "text": "for each cluster right on on each of these variables right and so they this come as form of a config map uh and and",
    "start": "735279",
    "end": "742720"
  },
  {
    "text": "you see here an example of a production cluster we we want to override the number of replicas from default to three right and",
    "start": "742720",
    "end": "750160"
  },
  {
    "text": "then in the test cluster uh we want to do something else we want to change the color of one of the attributes of the H",
    "start": "750160",
    "end": "757240"
  },
  {
    "text": "chart right and what happens there is when you wood strap flux on these uh",
    "start": "757240",
    "end": "762720"
  },
  {
    "text": "clusters um flux is going to pick up the the H chart the H release and config",
    "start": "762720",
    "end": "768120"
  },
  {
    "text": "maps and it's going to merge everything together and then form the final set of",
    "start": "768120",
    "end": "773440"
  },
  {
    "text": "values for that particular H chart so see pretty a simple uh way to to control",
    "start": "773440",
    "end": "779680"
  },
  {
    "text": "right all of the values that can use for all of your ham charts per blueprint",
    "start": "779680",
    "end": "786199"
  },
  {
    "text": "right um so in terms of controlling this uh config variables um um a lot of",
    "start": "787040",
    "end": "793480"
  },
  {
    "text": "people use certain way to organize their clusters uh in this case example uh you",
    "start": "793480",
    "end": "799959"
  },
  {
    "text": "have um clusters organized by data centers right and then in each of Center",
    "start": "799959",
    "end": "805839"
  },
  {
    "text": "you can have multiple clusters right and here what what's nice with plux variables is that you can have overlays",
    "start": "805839",
    "end": "812160"
  },
  {
    "text": "of config Maps right so here for example you can have one config map containing Global variables that you want to apply",
    "start": "812160",
    "end": "819519"
  },
  {
    "text": "to all clusters in all data centers right and then for certain data centers",
    "start": "819519",
    "end": "824760"
  },
  {
    "text": "you also can specify uh variables for each data center like for example if you use a common uh secret uh store right if",
    "start": "824760",
    "end": "833079"
  },
  {
    "text": "you put URL of that secret sore and then all of the Clusters you deploy there will be using that value right and at",
    "start": "833079",
    "end": "840480"
  },
  {
    "text": "the bottom you'll have the the cluster level config map where you can really",
    "start": "840480",
    "end": "845600"
  },
  {
    "text": "say for this specific cluster I want to use this uh the speciic values right so",
    "start": "845600",
    "end": "851160"
  },
  {
    "text": "so this this way to over overlay U multiple config Maps is really um very convenient right and that allows you to",
    "start": "851160",
    "end": "858160"
  },
  {
    "text": "also repeat avoid repeating the same values for different",
    "start": "858160",
    "end": "863839"
  },
  {
    "text": "clusters um so um the the other side of uh all this Deo is really how do you how",
    "start": "864480",
    "end": "871320"
  },
  {
    "text": "do you link a a version of your applications like all the the har charts to certain blueprint right and uh so",
    "start": "871320",
    "end": "879480"
  },
  {
    "text": "when you point to a blueprint you can specify either a branch or a tag right and um and when you point in our case",
    "start": "879480",
    "end": "886399"
  },
  {
    "text": "when you point to a branch right uh that means every every time we change something in the branch that gets uh",
    "start": "886399",
    "end": "893680"
  },
  {
    "text": "know reconcile into your cluster right while if you if you point to a tag uh then uh it it's really fixed that tack",
    "start": "893680",
    "end": "900880"
  },
  {
    "text": "right so um let's see an example of know typical workflow when when you build",
    "start": "900880",
    "end": "906600"
  },
  {
    "text": "Helm charts right so so you can have like a lot of hel charts um when the developer",
    "start": "906600",
    "end": "912720"
  },
  {
    "text": "um commit something a new version new stable version what happens is that uh that Helm chart is built right and uh it",
    "start": "912720",
    "end": "920519"
  },
  {
    "text": "goes into a Helm repo that contains a lot of H charts right and for each H chart it will also contain a lot of",
    "start": "920519",
    "end": "926920"
  },
  {
    "text": "versions of it right so and the main branch on new blueprint um you have a h",
    "start": "926920",
    "end": "932480"
  },
  {
    "text": "repository that points to that live H report right so that means and uh that means that uh when you want to deploy",
    "start": "932480",
    "end": "939000"
  },
  {
    "text": "these Helm charts on the main branch whatever is not is on that Helm repo is going to get deployed on your customer",
    "start": "939000",
    "end": "945399"
  },
  {
    "text": "right and in the helm release um you also specify which version of Helm chart you want to deploy that level you can",
    "start": "945399",
    "end": "952399"
  },
  {
    "text": "use a range right like uh greater than certain version and that allows you to",
    "start": "952399",
    "end": "958000"
  },
  {
    "text": "uh kind of automat atically deployed know when you have new versions of hel charts coming in your live hel repo they",
    "start": "958000",
    "end": "964079"
  },
  {
    "text": "will get automatically reconciled and deployed on your clusters right so so that's um the mode that we use for all",
    "start": "964079",
    "end": "970680"
  },
  {
    "text": "the test clusters right and for production clusters we use uh a different way um and um there are",
    "start": "970680",
    "end": "978360"
  },
  {
    "text": "actually two ways to to pin the version of H charts to your production deployments the first one is to go",
    "start": "978360",
    "end": "984959"
  },
  {
    "text": "through each hes um and then uh each of them you change the the range version you put the",
    "start": "984959",
    "end": "992319"
  },
  {
    "text": "exact version to use right and so that's a very uh inconvenient because as you",
    "start": "992319",
    "end": "997759"
  },
  {
    "text": "get more H charts right you can have hundreds of them right it's really hard to go and make sure that all Android of",
    "start": "997759",
    "end": "1004120"
  },
  {
    "text": "them have the right version right so instead what we do is that we version the her repositories right so which",
    "start": "1004120",
    "end": "1010519"
  },
  {
    "text": "means that uh when we cut or release uh we we take a snapshot of the live H rep",
    "start": "1010519",
    "end": "1016440"
  },
  {
    "text": "and taking a snapshot means that for each h in that time report we take the latest version right and then we create",
    "start": "1016440",
    "end": "1022720"
  },
  {
    "text": "a new report for it and that at that point the only thing you have to do when",
    "start": "1022720",
    "end": "1027760"
  },
  {
    "text": "you create a release is you create a new branch in the blueprint directory the repository right and in that Branch uh",
    "start": "1027760",
    "end": "1034959"
  },
  {
    "text": "you just change one file which is the H repository so that file instead of pointing to your live H report you just",
    "start": "1034959",
    "end": "1040798"
  },
  {
    "text": "point to the new uh repository that you just created right so and you don't have to touch all these release files because",
    "start": "1040799",
    "end": "1048280"
  },
  {
    "text": "because there's still a range but um no using that repository there there's only a choice",
    "start": "1048280",
    "end": "1055039"
  },
  {
    "text": "of one right so so that's why um you can be sure that uh that's going to be uh",
    "start": "1055039",
    "end": "1061039"
  },
  {
    "text": "pinned to certain version and that's not going to change right so and and the next time you cut a new release or same",
    "start": "1061039",
    "end": "1067679"
  },
  {
    "text": "thing right you you create another snapshot and you just change the ham repository right so it's pretty simple",
    "start": "1067679",
    "end": "1073880"
  },
  {
    "text": "way to kind of make sure that uh you know whatever happens in development",
    "start": "1073880",
    "end": "1078960"
  },
  {
    "text": "right uh that impacts only a different hel repository right and and when you do updates in production right you go from",
    "start": "1078960",
    "end": "1086120"
  },
  {
    "text": "know relas one to two right between these two you might have maybe one Helm chart that changes or 50 right it",
    "start": "1086120",
    "end": "1092480"
  },
  {
    "text": "doesn't matter because FX is going to uh just reconcile and then update those T",
    "start": "1092480",
    "end": "1097559"
  },
  {
    "text": "change right um so the challenges with this",
    "start": "1097559",
    "end": "1105280"
  },
  {
    "text": "approach uh is that know when you have like two levels of Kit report um um it sometimes it gets difficult to get",
    "start": "1105280",
    "end": "1112200"
  },
  {
    "text": "them in sync right initially when we deploy this we had a lot of uh update",
    "start": "1112200",
    "end": "1117440"
  },
  {
    "text": "failures because for example you can have developers add add a new Helm chart",
    "start": "1117440",
    "end": "1122600"
  },
  {
    "text": "and then add a new variable right and then in the production G Trio we forget",
    "start": "1122600",
    "end": "1128200"
  },
  {
    "text": "to to add that value right so that happens so sometimes you add the wrong",
    "start": "1128200",
    "end": "1133240"
  },
  {
    "text": "type right and in our case we use also variables to specify a path in Secret",
    "start": "1133240",
    "end": "1139520"
  },
  {
    "text": "store and those those kind of mistakes or know they can cause update perers so",
    "start": "1139520",
    "end": "1146440"
  },
  {
    "text": "what we had to do there is uh really um try to fill that Gap and U what we did",
    "start": "1146440",
    "end": "1152919"
  },
  {
    "text": "there is really develop a small Tool uh that uh will be in charge of kind of",
    "start": "1152919",
    "end": "1158000"
  },
  {
    "text": "validating your your config Maps right and this tool just pointed to uh a",
    "start": "1158000",
    "end": "1163080"
  },
  {
    "text": "cluster repository and we pass to it the the cluster we want to test right",
    "start": "1163080",
    "end": "1169400"
  },
  {
    "text": "and then another option is to pass out which blueprint you use and which tag to update to so you do this before you",
    "start": "1169400",
    "end": "1176039"
  },
  {
    "text": "update right and that tool is going to scrub all the config maps all the the variables and then it will also um",
    "start": "1176039",
    "end": "1183360"
  },
  {
    "text": "connect to the blueprint and then look at the tag that's used uh it will extract all the variables that are used",
    "start": "1183360",
    "end": "1189159"
  },
  {
    "text": "there and then it will make sure that uh all the variables that are missing are",
    "start": "1189159",
    "end": "1194360"
  },
  {
    "text": "pointed out and uh we also added some validations in terms of making sure that",
    "start": "1194360",
    "end": "1200159"
  },
  {
    "text": "the right type of is applied to each value right and for example here you see the part info replicas there's a default",
    "start": "1200159",
    "end": "1207200"
  },
  {
    "text": "value of one so to is smart enough to Guess that uh you know if you put a value to that variable it has to be an",
    "start": "1207200",
    "end": "1213640"
  },
  {
    "text": "integer the string right and and those um those that don't have like complex types like uh like a callor code right",
    "start": "1213640",
    "end": "1221600"
  },
  {
    "text": "we can we can specify um a syntax of that variable right so we use a q um",
    "start": "1221600",
    "end": "1227880"
  },
  {
    "text": "language for that and uh so stepan's going to talk about a q um the next slides and and with that Tool uh that",
    "start": "1227880",
    "end": "1235640"
  },
  {
    "text": "cut down quite a bit number of updates we have uh mistakes we have in the",
    "start": "1235640",
    "end": "1242360"
  },
  {
    "text": "updates uh to summarize um T right is um so with that kind of oranization we we",
    "start": "1242880",
    "end": "1250600"
  },
  {
    "text": "deploy to currently a few hundred of clusters and we have maybe a dozen blueprints right about 200 h charts and",
    "start": "1250600",
    "end": "1258720"
  },
  {
    "text": "and uh we have over 200 people working on it uh without too much issues and uh",
    "start": "1258720",
    "end": "1263960"
  },
  {
    "text": "that's really uh no uh I don't think that was possible not using any other method right so because we use",
    "start": "1263960",
    "end": "1270320"
  },
  {
    "text": "intensively G uh G branches uh to control all these different uh",
    "start": "1270320",
    "end": "1275679"
  },
  {
    "text": "evolutions of Helm charts that we have so the limitations of this approach is",
    "start": "1275679",
    "end": "1281200"
  },
  {
    "text": "that um you still have to write a lot of boil plate code like for example the ham release right probably 1002 200 kind of",
    "start": "1281200",
    "end": "1289200"
  },
  {
    "text": "code um so there we could use some some tools to make this uh less veros right",
    "start": "1289200",
    "end": "1296159"
  },
  {
    "text": "and uh the other limitation is the flux variables are really very simple in",
    "start": "1296159",
    "end": "1301200"
  },
  {
    "text": "terms of uh of values right only the only support uh integer Boolean and",
    "start": "1301200",
    "end": "1306919"
  },
  {
    "text": "string right and when you want to do things like list or Maps uh then you're",
    "start": "1306919",
    "end": "1312960"
  },
  {
    "text": "kind of on your own right so that's a big issue for us for complex deployments",
    "start": "1312960",
    "end": "1318919"
  },
  {
    "text": "and as we said you need some additional tooling to make sure that your G repos are in sync right and and some of the",
    "start": "1318919",
    "end": "1326360"
  },
  {
    "text": "complex deployments we have are also require some big variations of Helm chart like for example for certain data",
    "start": "1326360",
    "end": "1333840"
  },
  {
    "text": "centers you only want certain combination of Helm charts to deploy and from that point of view uh the only",
    "start": "1333840",
    "end": "1340679"
  },
  {
    "text": "option is really either to patch your ham release or or or",
    "start": "1340679",
    "end": "1346240"
  },
  {
    "text": "to um there not very uh very good options there right or or to add more",
    "start": "1346240",
    "end": "1351360"
  },
  {
    "text": "blueprints so and and lastly uh the the Clusters they still access to git repos",
    "start": "1351360",
    "end": "1357520"
  },
  {
    "text": "right so you have a lot of uh hits on your git repos git servers so so that sometimes can be a problem if you have a",
    "start": "1357520",
    "end": "1364480"
  },
  {
    "text": "lot of uh a lot of clusters especially when you use uh know like um Enterprise",
    "start": "1364480",
    "end": "1370440"
  },
  {
    "text": "uh know git server that are used for other purposes right and sometimes you can have no they can be down for",
    "start": "1370440",
    "end": "1377600"
  },
  {
    "text": "maintenance and then you cannot do certain things when they are down yep so uh that's all for me and um",
    "start": "1377600",
    "end": "1387120"
  },
  {
    "text": "yeah Stefan you want to yeah see thanks Alec so we we saw that is quite",
    "start": "1387120",
    "end": "1393720"
  },
  {
    "text": "complicated right deploying to hundreds of clusters mixing all these apps",
    "start": "1393720",
    "end": "1400120"
  },
  {
    "text": "bundling Helm charts it works but it's it's hard to comprehend how to",
    "start": "1400120",
    "end": "1407679"
  },
  {
    "text": "separate you need to iterate and create your own structure of G",
    "start": "1407679",
    "end": "1413480"
  },
  {
    "text": "repos that's one second have this problem of Helm which and yaml of course",
    "start": "1413480",
    "end": "1419559"
  },
  {
    "text": "nothing is type safe so when you have separate uh constructs but on the",
    "start": "1419559",
    "end": "1426120"
  },
  {
    "text": "cluster they have to be bundled together to to be applied you get this unsync uh future",
    "start": "1426120",
    "end": "1433559"
  },
  {
    "text": "right so my opinion we can improve this kind",
    "start": "1433559",
    "end": "1439240"
  },
  {
    "text": "of complex setup and I don't think it applies only here for Cisco but for many other uh flux setups which know",
    "start": "1439240",
    "end": "1447840"
  },
  {
    "text": "imply having a base app configuration then deploying that to hundreds of",
    "start": "1447840",
    "end": "1453240"
  },
  {
    "text": "clusters or hundreds of name spaces in many clusters all that type of you know",
    "start": "1453240",
    "end": "1459159"
  },
  {
    "text": "hard multi tency when you have one cluster per tenant or soft multi tency when you have one tenant per Nam space",
    "start": "1459159",
    "end": "1466320"
  },
  {
    "text": "and you always have some kind of app that needs to you know be slightly modified depending on where",
    "start": "1466320",
    "end": "1473720"
  },
  {
    "text": "it lands so one one Evolution Improvement would be",
    "start": "1473720",
    "end": "1479919"
  },
  {
    "text": "desire State consolidation I'm going to talk two minutes about",
    "start": "1479919",
    "end": "1485278"
  },
  {
    "text": "it so we see that with with giops and what Alex said you usually use git in",
    "start": "1486520",
    "end": "1494120"
  },
  {
    "text": "your Dev pipelines right your developers push code there then you have some CI",
    "start": "1494120",
    "end": "1501080"
  },
  {
    "text": "process and that CI process produces an artifact and that's the thing that you are using in production in most cases",
    "start": "1501080",
    "end": "1508840"
  },
  {
    "text": "that's a container image in kubernetes space right so cuet does not go to your",
    "start": "1508840",
    "end": "1514360"
  },
  {
    "text": "git repo it does not purchas the code from there to run your app it goes to the container",
    "start": "1514360",
    "end": "1520480"
  },
  {
    "text": "registry in the gitops approach you run something in your cluster that's flux",
    "start": "1520480",
    "end": "1526600"
  },
  {
    "text": "and flux goes back to that G repo what that means is that the git server now",
    "start": "1526600",
    "end": "1533039"
  },
  {
    "text": "becomes a hard dependency of your production system while for the",
    "start": "1533039",
    "end": "1539440"
  },
  {
    "text": "development process is not a dependency of your production system so there are couple of challenges here you have to",
    "start": "1539440",
    "end": "1546360"
  },
  {
    "text": "make sure you can scale out git the more clusters you have the more connections",
    "start": "1546360",
    "end": "1551520"
  },
  {
    "text": "will go there you need to ensure ha you need to do upgrades if the upgrades fail",
    "start": "1551520",
    "end": "1557600"
  },
  {
    "text": "everything fails right so how can we keep using git for configuration as",
    "start": "1557600",
    "end": "1564480"
  },
  {
    "text": "we use it for code we have the same advantages we can",
    "start": "1564480",
    "end": "1571159"
  },
  {
    "text": "collaborate on it but we don't have to have the git thing the git server as a",
    "start": "1571159",
    "end": "1576279"
  },
  {
    "text": "dependency in production and we could use the container registry most",
    "start": "1576279",
    "end": "1582799"
  },
  {
    "text": "container Registries out there right now are compatible with the OC I standard",
    "start": "1582799",
    "end": "1590000"
  },
  {
    "text": "and that means we can store there more than just container images in our case",
    "start": "1590000",
    "end": "1595640"
  },
  {
    "text": "we can store there the helm charts Helm version 3 has great support for uh",
    "start": "1595640",
    "end": "1600919"
  },
  {
    "text": "container registries you can do a Helm push and instead of using HTTP repos you can use the container registry and push",
    "start": "1600919",
    "end": "1607640"
  },
  {
    "text": "there your charts but for the flux configuration there is also this option we have um uh",
    "start": "1607640",
    "end": "1614679"
  },
  {
    "text": "an extension in the flux CLI which allows you to bundle your",
    "start": "1614679",
    "end": "1620240"
  },
  {
    "text": "um one or more directories or a whole repository or more repositor it's up to",
    "start": "1622360",
    "end": "1627440"
  },
  {
    "text": "you how you mix all these things together and you can produce uh no effect for flux and uh then flux only",
    "start": "1627440",
    "end": "1635559"
  },
  {
    "text": "goes to the container registry and usually those container Registries RHA",
    "start": "1635559",
    "end": "1641760"
  },
  {
    "text": "you already have sorted how you upgrading upgrading them because they are already part of your production",
    "start": "1641760",
    "end": "1647880"
  },
  {
    "text": "system what it means to migrate from from git",
    "start": "1647880",
    "end": "1653399"
  },
  {
    "text": "to OC artifacts for Helm is simple you do a Helm push but the target is the registry",
    "start": "1653399",
    "end": "1660679"
  },
  {
    "text": "and for your Helm releases and H repositories you will do a flux push",
    "start": "1660679",
    "end": "1668399"
  },
  {
    "text": "it's not that complicated um there are also some API changes that you need to",
    "start": "1668399",
    "end": "1673600"
  },
  {
    "text": "do in uh uh in the flux configuration the major one is changing switching from G repository API To Oi repository API",
    "start": "1673600",
    "end": "1681960"
  },
  {
    "text": "but luckily we we created the ocii repository to be a mirror of the of the",
    "start": "1681960",
    "end": "1687120"
  },
  {
    "text": "G repo so it's very easy to switch from one API to another and back and forth the the difference is in a g repo you",
    "start": "1687120",
    "end": "1693840"
  },
  {
    "text": "have branches that flux follows how you can do that with o",
    "start": "1693840",
    "end": "1699760"
  },
  {
    "text": "poories you have uh mutable tags like let's say the main branch becomes the",
    "start": "1699760",
    "end": "1706440"
  },
  {
    "text": "main tag every time you do a commit to main you override the the latest main uh",
    "start": "1706440",
    "end": "1713840"
  },
  {
    "text": "tag and flux resolves the digest of that so like with Git when you go have a you",
    "start": "1713840",
    "end": "1719960"
  },
  {
    "text": "follow a branch you resolve the commit and in the same way flux for for oci",
    "start": "1719960",
    "end": "1725159"
  },
  {
    "text": "repository uses the latest thing which is what's immutable is the oci digest so",
    "start": "1725159",
    "end": "1731760"
  },
  {
    "text": "ocii digest inside the flux system is the same as a git comit sha so it's a",
    "start": "1731760",
    "end": "1737080"
  },
  {
    "text": "oneon-one uh mapping of those okay so we we figure out the first",
    "start": "1737080",
    "end": "1743880"
  },
  {
    "text": "Improvement um second one is about",
    "start": "1743880",
    "end": "1750600"
  },
  {
    "text": "simplifying the whole whole way of how you define variables you merge them and you need to",
    "start": "1750600",
    "end": "1758720"
  },
  {
    "text": "do some changes which are only for data center then only for some clusters in the data center and so on right and we",
    "start": "1758720",
    "end": "1765559"
  },
  {
    "text": "we we saw how we can do that with um with variable substitution and lots",
    "start": "1765559",
    "end": "1771480"
  },
  {
    "text": "of lots of yaml uh my proposal is instead of using Q to validate some",
    "start": "1771480",
    "end": "1779039"
  },
  {
    "text": "part of the yaml what what Alec was showing we can use the the Q language",
    "start": "1779039",
    "end": "1784720"
  },
  {
    "text": "which is great for for validation you can also use the Q language for generating the final",
    "start": "1784720",
    "end": "1791600"
  },
  {
    "text": "yamal and Q is a super set of Json it has a steep learning curve you'll need",
    "start": "1791600",
    "end": "1799880"
  },
  {
    "text": "to invest some time into learning queue but once you do that you have this",
    "start": "1799880",
    "end": "1806000"
  },
  {
    "text": "powerful language where you can have complex types you can express logic and",
    "start": "1806000",
    "end": "1811799"
  },
  {
    "text": "you can have all these Varian of a particular application very well defined",
    "start": "1811799",
    "end": "1817519"
  },
  {
    "text": "type save in a compact",
    "start": "1817519",
    "end": "1822679"
  },
  {
    "text": "form so why would you use Q for kubernetes one of the things that I",
    "start": "1825360",
    "end": "1830640"
  },
  {
    "text": "really want to highlight here is the fact that Q can the Q language can",
    "start": "1830640",
    "end": "1837480"
  },
  {
    "text": "import a kubernetes API spec being a deployment or a custom",
    "start": "1837480",
    "end": "1843200"
  },
  {
    "text": "resource definition you it can import that then when you want to write a",
    "start": "1843200",
    "end": "1848760"
  },
  {
    "text": "template for let's say a kubernetes service or a kubernetes deployment or any flux custom",
    "start": "1848760",
    "end": "1854919"
  },
  {
    "text": "resources it can value Val dat every single field in there as it was the",
    "start": "1854919",
    "end": "1861480"
  },
  {
    "text": "kuber as you would have the kubernetes API as your disposal but is client side",
    "start": "1861480",
    "end": "1866639"
  },
  {
    "text": "you don't need to do any kind of apply to itself when you when you build",
    "start": "1866639",
    "end": "1872200"
  },
  {
    "text": "it then you'll uh you'll get the same validation as You' get when you apply it",
    "start": "1872200",
    "end": "1878720"
  },
  {
    "text": "on the cluster which is very powerful you can basically validate everything way way before it gets deployed right so",
    "start": "1878720",
    "end": "1885600"
  },
  {
    "text": "we want to catch all these errors early on in our uh in our Pipeline and and Q",
    "start": "1885600",
    "end": "1890760"
  },
  {
    "text": "can do that because um it it it really integrates with open API and can and can",
    "start": "1890760",
    "end": "1896519"
  },
  {
    "text": "generate these schemas for you okay so we we have the Q language that looks appealing to",
    "start": "1896519",
    "end": "1904480"
  },
  {
    "text": "kubernetes but now how are we going to generate all these things right um so",
    "start": "1904480",
    "end": "1911159"
  },
  {
    "text": "for this I've I'm working on a tool called teony uh he's been in development",
    "start": "1911159",
    "end": "1916840"
  },
  {
    "text": "for over a year now um my goal with timony was I was so frustrated with",
    "start": "1916840",
    "end": "1923840"
  },
  {
    "text": "writing Helm charts all day so I said okay needs to be a better way uh I",
    "start": "1923840",
    "end": "1929639"
  },
  {
    "text": "discovered q and Timon is in in nature feels like hell but it's completely",
    "start": "1929639",
    "end": "1935600"
  },
  {
    "text": "different uh uh but it has the the templates directory in there we don't",
    "start": "1935600",
    "end": "1941399"
  },
  {
    "text": "call it Helm charts we call it modules and so on the idea with with timony is",
    "start": "1941399",
    "end": "1946919"
  },
  {
    "text": "that it can bring the Q type safety to kubernetes templates and can make this a",
    "start": "1946919",
    "end": "1953240"
  },
  {
    "text": "more sane Pleasant way of you know defining all these kubernetes",
    "start": "1953240",
    "end": "1961080"
  },
  {
    "text": "objects uh it comes with a couple of Concepts modules which are like Helm",
    "start": "1961080",
    "end": "1966720"
  },
  {
    "text": "charts instances which are like Helm releases in the",
    "start": "1966720",
    "end": "1972600"
  },
  {
    "text": "cluster a bundle which is like a Helm file if you want",
    "start": "1972600",
    "end": "1978720"
  },
  {
    "text": "uh or a umbrella Helm chart and a run time which is something you you tell",
    "start": "1978720",
    "end": "1985960"
  },
  {
    "text": "timony hey I don't want to give you Secrets or give you you know all all the",
    "start": "1985960",
    "end": "1992000"
  },
  {
    "text": "configuration up ahead you should look up in your cluster and fetch from there",
    "start": "1992000",
    "end": "1997039"
  },
  {
    "text": "the configuration at apply time so instead of having to pull a secret down and you know store it in your G repo",
    "start": "1997039",
    "end": "2003720"
  },
  {
    "text": "with with with teon you say this variable comes from this secret in the CL CL at this field and using Q you",
    "start": "2003720",
    "end": "2010960"
  },
  {
    "text": "express that query and Timon runs it and that's how it deals with with with",
    "start": "2010960",
    "end": "2017158"
  },
  {
    "text": "Secrets uh I made a bunch of modules to be able to generate flux object so it's",
    "start": "2018240",
    "end": "2025679"
  },
  {
    "text": "release you don't have to learn much of timony or que and you can use for example the flux hand release module to",
    "start": "2025679",
    "end": "2033559"
  },
  {
    "text": "generate hand releases you can generate tenants you can generate oci in all the",
    "start": "2033559",
    "end": "2039960"
  },
  {
    "text": "almost all the flux apis there will be at some point available at this URL and",
    "start": "2039960",
    "end": "2045360"
  },
  {
    "text": "you'll have abstractions Builds on top of it and you can generate all these complex flux objects easily through ton",
    "start": "2045360",
    "end": "2054240"
  },
  {
    "text": "modules um okay so we have we've learned Q it's a big step then we've learned ton",
    "start": "2054240",
    "end": "2061960"
  },
  {
    "text": "it's even a bigger step uh how we migrate now so",
    "start": "2061960",
    "end": "2069720"
  },
  {
    "text": "so it will be a hard proposal here right we we actually delete all the Amal from git which",
    "start": "2070800",
    "end": "2076878"
  },
  {
    "text": "is okay we don't store yal into git there will be only Q definitions your",
    "start": "2076879",
    "end": "2082638"
  },
  {
    "text": "developers will have to understand a little bit of Q and what's happening",
    "start": "2082639",
    "end": "2088679"
  },
  {
    "text": "there um then but you don't you in this step",
    "start": "2088679",
    "end": "2093878"
  },
  {
    "text": "you don't get rid of Helm charts so they can still do Helm charts right for now",
    "start": "2093879",
    "end": "2102480"
  },
  {
    "text": "uh so in the in the blueprint repo where you have the H release definitions there",
    "start": "2102839",
    "end": "2109640"
  },
  {
    "text": "you'll be having only Q code that generates H releases H repositories",
    "start": "2109640",
    "end": "2115079"
  },
  {
    "text": "customizations OC all the things that you need and then how you put them all",
    "start": "2115079",
    "end": "2121160"
  },
  {
    "text": "together and how you change their tiny bits for each cluster is with this",
    "start": "2121160",
    "end": "2126680"
  },
  {
    "text": "bundle concept where you can refer to all the modules and say oh if it's this target I'm going",
    "start": "2126680",
    "end": "2132839"
  },
  {
    "text": "to change this little thing here what uh what Al was was uh was showing with flux",
    "start": "2132839",
    "end": "2139320"
  },
  {
    "text": "variables now how you distribute all this stuff of course to the occi repo",
    "start": "2139320",
    "end": "2145800"
  },
  {
    "text": "and timony has all these build commands so I can do a timony bundle build of all",
    "start": "2145800",
    "end": "2151400"
  },
  {
    "text": "my variables and you pipe that to the flux push artifact command you push to the",
    "start": "2151400",
    "end": "2158359"
  },
  {
    "text": "container registry flux on all these clusters see the new configuration and starts and reconcile",
    "start": "2158359",
    "end": "2166160"
  },
  {
    "text": "it um next step for timony there are a couple of things that are not there yet",
    "start": "2166520",
    "end": "2173160"
  },
  {
    "text": "the API is not quite stable there are alpha apis so I may break",
    "start": "2173160",
    "end": "2178280"
  },
  {
    "text": "them uh there is a flux IOD uh",
    "start": "2178280",
    "end": "2184920"
  },
  {
    "text": "distribution for flux where you where timony can deploy flux in a single pod",
    "start": "2184920",
    "end": "2190680"
  },
  {
    "text": "it works on the edge it doesn't need a cni and I'm trying to promote this",
    "start": "2190680",
    "end": "2195880"
  },
  {
    "text": "distribution as an alternative to the official uh flux distribution it will not replace it will be just another",
    "start": "2195880",
    "end": "2201760"
  },
  {
    "text": "option and finally what most people are asking for is a Tony controller so you don't have to build the yamal and push",
    "start": "2201760",
    "end": "2208359"
  },
  {
    "text": "them to the O push the whole Q uh definition there so I don't know when",
    "start": "2208359",
    "end": "2215920"
  },
  {
    "text": "when the t-on control happen it all depends on adoption what I'm asking you is like give it a try try to migrate the",
    "start": "2215920",
    "end": "2223880"
  },
  {
    "text": "easiest Helm chart that you have to a teon module see how that goes let me",
    "start": "2223880",
    "end": "2230200"
  },
  {
    "text": "know uh there are lots of people who love it but they love it because they actually are into Q right I I still",
    "start": "2230200",
    "end": "2237839"
  },
  {
    "text": "think there is a major Gap switching from from hel templates to uh ton and Q",
    "start": "2237839",
    "end": "2244960"
  },
  {
    "text": "I I think it's worth it maybe maybe spend a day or two uh and yeah let me know I'm I would",
    "start": "2244960",
    "end": "2252480"
  },
  {
    "text": "really love to know thank you very much",
    "start": "2252480",
    "end": "2257520"
  }
]