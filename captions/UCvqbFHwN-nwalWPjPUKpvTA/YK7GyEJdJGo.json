[
  {
    "text": "hello everyone",
    "start": "0",
    "end": "1439"
  },
  {
    "text": "Welcome to our talk uh it's great to be",
    "start": "1439",
    "end": "4020"
  },
  {
    "text": "here in Amsterdam today and today we'll",
    "start": "4020",
    "end": "7200"
  },
  {
    "text": "be talking about Tales from an evpf",
    "start": "7200",
    "end": "9780"
  },
  {
    "text": "programs murder mystery",
    "start": "9780",
    "end": "11700"
  },
  {
    "text": "so I call it a murder mystery because",
    "start": "11700",
    "end": "13500"
  },
  {
    "text": "it's really catchy but there might be a",
    "start": "13500",
    "end": "16020"
  },
  {
    "text": "liar or two in there we'll figure it out",
    "start": "16020",
    "end": "18300"
  },
  {
    "text": "soon",
    "start": "18300",
    "end": "19740"
  },
  {
    "text": "um so this is basically a story about",
    "start": "19740",
    "end": "21539"
  },
  {
    "text": "how probably one of the most important",
    "start": "21539",
    "end": "23880"
  },
  {
    "text": "tbpf programs in our kubernetes clusters",
    "start": "23880",
    "end": "26660"
  },
  {
    "text": "randomly vanished and this is a story",
    "start": "26660",
    "end": "30119"
  },
  {
    "text": "really about how we investigated the",
    "start": "30119",
    "end": "32040"
  },
  {
    "text": "issue and how we got at the bottom of it",
    "start": "32040",
    "end": "34800"
  },
  {
    "text": "so a quick introduction about ourselves",
    "start": "34800",
    "end": "36600"
  },
  {
    "text": "I'm hemanth I work on the compute data",
    "start": "36600",
    "end": "39239"
  },
  {
    "text": "plane team at datadog and I'm joined by",
    "start": "39239",
    "end": "41219"
  },
  {
    "text": "Will who works as a security engineer on",
    "start": "41219",
    "end": "43980"
  },
  {
    "text": "the cloud work load security team and if",
    "start": "43980",
    "end": "46680"
  },
  {
    "text": "you haven't heard of datadog we are a",
    "start": "46680",
    "end": "48480"
  },
  {
    "text": "cloud monitoring and observability",
    "start": "48480",
    "end": "49860"
  },
  {
    "text": "Company and here are here are a few",
    "start": "49860",
    "end": "52320"
  },
  {
    "text": "quick facts about us but the most",
    "start": "52320",
    "end": "54000"
  },
  {
    "text": "important one here really is we run",
    "start": "54000",
    "end": "56340"
  },
  {
    "text": "hundreds of kubernetes clusters with",
    "start": "56340",
    "end": "58379"
  },
  {
    "text": "thousands of nodes in them and all of",
    "start": "58379",
    "end": "60840"
  },
  {
    "text": "them run celium and we run on all major",
    "start": "60840",
    "end": "63239"
  },
  {
    "text": "Cloud providers",
    "start": "63239",
    "end": "66000"
  },
  {
    "text": "so datadoc does a lot of things but the",
    "start": "66000",
    "end": "68640"
  },
  {
    "text": "most important ones for this talk are a",
    "start": "68640",
    "end": "70920"
  },
  {
    "text": "couple of things so datadoc has a",
    "start": "70920",
    "end": "72720"
  },
  {
    "text": "component Called datadog Agent which",
    "start": "72720",
    "end": "74939"
  },
  {
    "text": "runs as a Daemon set in kubernetes",
    "start": "74939",
    "end": "77040"
  },
  {
    "text": "clusters and datadog agent allows for",
    "start": "77040",
    "end": "79439"
  },
  {
    "text": "collecting things like logs metrics",
    "start": "79439",
    "end": "81479"
  },
  {
    "text": "traces and some other Telemetry to power",
    "start": "81479",
    "end": "84720"
  },
  {
    "text": "many other products and within the",
    "start": "84720",
    "end": "87360"
  },
  {
    "text": "datadog agent we also have a product",
    "start": "87360",
    "end": "89100"
  },
  {
    "text": "called Cloud workload security that",
    "start": "89100",
    "end": "91320"
  },
  {
    "text": "allows us to detect threats in runtime",
    "start": "91320",
    "end": "93479"
  },
  {
    "text": "using evpf",
    "start": "93479",
    "end": "96119"
  },
  {
    "text": "and here's a quick outline of what I'm",
    "start": "96119",
    "end": "98340"
  },
  {
    "text": "going to talk what we're going to talk",
    "start": "98340",
    "end": "99780"
  },
  {
    "text": "about today so we're first going to talk",
    "start": "99780",
    "end": "101700"
  },
  {
    "text": "about how our users notice this issue to",
    "start": "101700",
    "end": "104640"
  },
  {
    "text": "start with and we'll cover some quick",
    "start": "104640",
    "end": "106799"
  },
  {
    "text": "background on Linux traffic control and",
    "start": "106799",
    "end": "109619"
  },
  {
    "text": "how celium and datadog agent uses",
    "start": "109619",
    "end": "111899"
  },
  {
    "text": "traffic control and then we'll get in",
    "start": "111899",
    "end": "114000"
  },
  {
    "text": "get into the core of the investigation",
    "start": "114000",
    "end": "115560"
  },
  {
    "text": "and some of the lessons we learned",
    "start": "115560",
    "end": "117479"
  },
  {
    "text": "during the process",
    "start": "117479",
    "end": "120119"
  },
  {
    "text": "so it all started with an investigation",
    "start": "120119",
    "end": "122700"
  },
  {
    "text": "with an incident of course and we manage",
    "start": "122700",
    "end": "126960"
  },
  {
    "text": "a compute platform internally for",
    "start": "126960",
    "end": "128520"
  },
  {
    "text": "datadog on top of which all the datadog",
    "start": "128520",
    "end": "130979"
  },
  {
    "text": "applications run and one of our internal",
    "start": "130979",
    "end": "133140"
  },
  {
    "text": "users started reporting connectivity",
    "start": "133140",
    "end": "135060"
  },
  {
    "text": "issues to us and our crime scene looked",
    "start": "135060",
    "end": "138120"
  },
  {
    "text": "a little more complicated than this",
    "start": "138120",
    "end": "139379"
  },
  {
    "text": "because the in the issues they were",
    "start": "139379",
    "end": "141959"
  },
  {
    "text": "reporting to us were super short-lived",
    "start": "141959",
    "end": "143940"
  },
  {
    "text": "and by the time we could get there and",
    "start": "143940",
    "end": "145620"
  },
  {
    "text": "collect some evidence the issue would",
    "start": "145620",
    "end": "147300"
  },
  {
    "text": "totally vanish away",
    "start": "147300",
    "end": "149580"
  },
  {
    "text": "so our internal compute platform users",
    "start": "149580",
    "end": "152400"
  },
  {
    "text": "were reporting connectivity issues for",
    "start": "152400",
    "end": "154260"
  },
  {
    "text": "some pods and the init containers seem",
    "start": "154260",
    "end": "156599"
  },
  {
    "text": "to be constantly crashing and the",
    "start": "156599",
    "end": "158520"
  },
  {
    "text": "Readiness probes were failing and there",
    "start": "158520",
    "end": "160560"
  },
  {
    "text": "are also some unexpected Network policy",
    "start": "160560",
    "end": "162300"
  },
  {
    "text": "denials and the whole issue was really",
    "start": "162300",
    "end": "164220"
  },
  {
    "text": "hard to reproduce because it was",
    "start": "164220",
    "end": "166019"
  },
  {
    "text": "constantly being resolved automatically",
    "start": "166019",
    "end": "169440"
  },
  {
    "text": "so the first thing we do with psyllium",
    "start": "169440",
    "end": "171360"
  },
  {
    "text": "generally Whenever there is a",
    "start": "171360",
    "end": "172739"
  },
  {
    "text": "connectivity issue is we do sealer",
    "start": "172739",
    "end": "175560"
  },
  {
    "text": "monitor logs and Celia monitor logs is",
    "start": "175560",
    "end": "178019"
  },
  {
    "text": "like looking at a real-time CCTV camera",
    "start": "178019",
    "end": "180120"
  },
  {
    "text": "footage into your network into your",
    "start": "180120",
    "end": "182340"
  },
  {
    "text": "kubernetes clusters and you could also",
    "start": "182340",
    "end": "184260"
  },
  {
    "text": "use Hubble for a similar use case",
    "start": "184260",
    "end": "186900"
  },
  {
    "text": "so when we started taking a closer look",
    "start": "186900",
    "end": "189959"
  },
  {
    "text": "at the sealer monitor drop logs we",
    "start": "189959",
    "end": "192840"
  },
  {
    "text": "noticed that we were seeing packet drops",
    "start": "192840",
    "end": "195000"
  },
  {
    "text": "for",
    "start": "195000",
    "end": "196260"
  },
  {
    "text": "traffic that was going from an identity",
    "start": "196260",
    "end": "198420"
  },
  {
    "text": "called 93739 to Identity number one and",
    "start": "198420",
    "end": "202260"
  },
  {
    "text": "identity one is actually a reserved host",
    "start": "202260",
    "end": "204480"
  },
  {
    "text": "identity and 93739 is just one of our",
    "start": "204480",
    "end": "207480"
  },
  {
    "text": "endpoints and these packets look like",
    "start": "207480",
    "end": "209819"
  },
  {
    "text": "they're sin act packets so they're",
    "start": "209819",
    "end": "211680"
  },
  {
    "text": "actually response packets to some other",
    "start": "211680",
    "end": "213659"
  },
  {
    "text": "requests so because it's the destination",
    "start": "213659",
    "end": "217800"
  },
  {
    "text": "is reserved Host this is actually a",
    "start": "217800",
    "end": "220620"
  },
  {
    "text": "response packet to health checks from",
    "start": "220620",
    "end": "223379"
  },
  {
    "text": "cubelet",
    "start": "223379",
    "end": "224400"
  },
  {
    "text": "so this is the reason why our health",
    "start": "224400",
    "end": "226620"
  },
  {
    "text": "checks are failing and our pods were",
    "start": "226620",
    "end": "228299"
  },
  {
    "text": "constantly crashing",
    "start": "228299",
    "end": "231060"
  },
  {
    "text": "so a quick background on how",
    "start": "231060",
    "end": "234019"
  },
  {
    "text": "this particular flow works so in order",
    "start": "234019",
    "end": "236819"
  },
  {
    "text": "to allow traffic from cubelet to",
    "start": "236819",
    "end": "239220"
  },
  {
    "text": "endpoints on the same host every",
    "start": "239220",
    "end": "242040"
  },
  {
    "text": "endpoint has a default policy in place",
    "start": "242040",
    "end": "244200"
  },
  {
    "text": "which allows packets to go from cubelet",
    "start": "244200",
    "end": "247319"
  },
  {
    "text": "to the endpoint itself so that pods can",
    "start": "247319",
    "end": "249840"
  },
  {
    "text": "respond for health checks and",
    "start": "249840",
    "end": "252659"
  },
  {
    "text": "when whenever celium sees this Ingress",
    "start": "252659",
    "end": "254760"
  },
  {
    "text": "connection CLM also updates connection",
    "start": "254760",
    "end": "256500"
  },
  {
    "text": "tracking entry so that when the response",
    "start": "256500",
    "end": "258840"
  },
  {
    "text": "packet is ready to be sent from the",
    "start": "258840",
    "end": "260760"
  },
  {
    "text": "endpoint to the cubelet the response",
    "start": "260760",
    "end": "263880"
  },
  {
    "text": "would automatically be allowed based on",
    "start": "263880",
    "end": "265380"
  },
  {
    "text": "the connection tracking and it looks",
    "start": "265380",
    "end": "267360"
  },
  {
    "text": "like for this case we were not seeing an",
    "start": "267360",
    "end": "269460"
  },
  {
    "text": "entries being updated in connection",
    "start": "269460",
    "end": "270840"
  },
  {
    "text": "tracking",
    "start": "270840",
    "end": "272940"
  },
  {
    "text": "and a quick background of how celium in",
    "start": "272940",
    "end": "275100"
  },
  {
    "text": "our clusters is set up so every part",
    "start": "275100",
    "end": "277680"
  },
  {
    "text": "that is being created on a node gets its",
    "start": "277680",
    "end": "279840"
  },
  {
    "text": "own virtual ethernet pair and every part",
    "start": "279840",
    "end": "281880"
  },
  {
    "text": "gets its own network namespace so this",
    "start": "281880",
    "end": "284340"
  },
  {
    "text": "pods network name space is connected to",
    "start": "284340",
    "end": "286139"
  },
  {
    "text": "the host network namespace using this",
    "start": "286139",
    "end": "288000"
  },
  {
    "text": "width pair and by the nature of a width",
    "start": "288000",
    "end": "291180"
  },
  {
    "text": "pair every packet that is sent on one",
    "start": "291180",
    "end": "292860"
  },
  {
    "text": "end of a v pair gets transmitted",
    "start": "292860",
    "end": "294720"
  },
  {
    "text": "immediately to the other end and celium",
    "start": "294720",
    "end": "297720"
  },
  {
    "text": "also installs a few route table entries",
    "start": "297720",
    "end": "299580"
  },
  {
    "text": "and IP rules to make sure that the",
    "start": "299580",
    "end": "301259"
  },
  {
    "text": "packets can go in and out of the hose or",
    "start": "301259",
    "end": "303180"
  },
  {
    "text": "out of the pod",
    "start": "303180",
    "end": "304380"
  },
  {
    "text": "and psyllium also implements a lot of",
    "start": "304380",
    "end": "307740"
  },
  {
    "text": "features using evpf and one of the most",
    "start": "307740",
    "end": "309900"
  },
  {
    "text": "important vpf programs is a program",
    "start": "309900",
    "end": "312180"
  },
  {
    "text": "called BPF lxc and it has two sections",
    "start": "312180",
    "end": "314880"
  },
  {
    "text": "one is for Ingress and one is for egress",
    "start": "314880",
    "end": "317340"
  },
  {
    "text": "and psyllium uses traffic control to",
    "start": "317340",
    "end": "320280"
  },
  {
    "text": "invoke these BPF programs on those",
    "start": "320280",
    "end": "321960"
  },
  {
    "text": "interfaces",
    "start": "321960",
    "end": "323460"
  },
  {
    "text": "and I'll hand it over to will to talk",
    "start": "323460",
    "end": "325680"
  },
  {
    "text": "more about traffic control",
    "start": "325680",
    "end": "327780"
  },
  {
    "text": "thanks Simmons yeah so we've been saying",
    "start": "327780",
    "end": "330600"
  },
  {
    "text": "a lot today that CDM uses ebpf to",
    "start": "330600",
    "end": "333060"
  },
  {
    "text": "monitor traffic",
    "start": "333060",
    "end": "334620"
  },
  {
    "text": "um technically speaking they hire dozens",
    "start": "334620",
    "end": "336720"
  },
  {
    "text": "of ways um to actually use ebpf to",
    "start": "336720",
    "end": "338880"
  },
  {
    "text": "monitor traffic and potentially modify",
    "start": "338880",
    "end": "340860"
  },
  {
    "text": "and mangle with network packets and",
    "start": "340860",
    "end": "343139"
  },
  {
    "text": "traffic control is one of them and the",
    "start": "343139",
    "end": "345600"
  },
  {
    "text": "reason why we need to Deep dive into it",
    "start": "345600",
    "end": "347940"
  },
  {
    "text": "is because you need to understand basic",
    "start": "347940",
    "end": "349919"
  },
  {
    "text": "concepts about traffic control in order",
    "start": "349919",
    "end": "352020"
  },
  {
    "text": "to understand the murder mystery",
    "start": "352020",
    "end": "355020"
  },
  {
    "text": "see Traffic Control in general is a",
    "start": "355020",
    "end": "357419"
  },
  {
    "text": "pretty complex subsystem of the new",
    "start": "357419",
    "end": "358979"
  },
  {
    "text": "Linux kernel that is used usually to",
    "start": "358979",
    "end": "361139"
  },
  {
    "text": "shape the network traffic on Ingress and",
    "start": "361139",
    "end": "363419"
  },
  {
    "text": "egress in other words this means that",
    "start": "363419",
    "end": "366060"
  },
  {
    "text": "given a specific interface you can",
    "start": "366060",
    "end": "367919"
  },
  {
    "text": "actually monitor all at each and every",
    "start": "367919",
    "end": "369720"
  },
  {
    "text": "single packets that coming and out of",
    "start": "369720",
    "end": "371759"
  },
  {
    "text": "this specific interface",
    "start": "371759",
    "end": "373259"
  },
  {
    "text": "it usually works with something we call",
    "start": "373259",
    "end": "375479"
  },
  {
    "text": "eqing discipline",
    "start": "375479",
    "end": "377220"
  },
  {
    "text": "um so there are a lot of different you",
    "start": "377220",
    "end": "378660"
  },
  {
    "text": "know queuing disciplines but the one we",
    "start": "378660",
    "end": "380460"
  },
  {
    "text": "care about here is the Seattle sect one",
    "start": "380460",
    "end": "382620"
  },
  {
    "text": "so this one is specifically what is well",
    "start": "382620",
    "end": "385199"
  },
  {
    "text": "specifically introduced for abpf use",
    "start": "385199",
    "end": "387479"
  },
  {
    "text": "cases and has two main hope points",
    "start": "387479",
    "end": "389940"
  },
  {
    "text": "Ingress and egress hook points this",
    "start": "389940",
    "end": "392699"
  },
  {
    "text": "means that on these hook points you can",
    "start": "392699",
    "end": "394500"
  },
  {
    "text": "attach ebpf programs that we call direct",
    "start": "394500",
    "end": "396900"
  },
  {
    "text": "action TC filters they're called direct",
    "start": "396900",
    "end": "399419"
  },
  {
    "text": "actions because whatever the output of",
    "start": "399419",
    "end": "401520"
  },
  {
    "text": "this program is is going to decide the",
    "start": "401520",
    "end": "403680"
  },
  {
    "text": "fate of each and every single packet so",
    "start": "403680",
    "end": "406139"
  },
  {
    "text": "you have three different output out of",
    "start": "406139",
    "end": "408300"
  },
  {
    "text": "others but the main ones are those three",
    "start": "408300",
    "end": "410039"
  },
  {
    "text": "ones TC act okay which means that the",
    "start": "410039",
    "end": "412800"
  },
  {
    "text": "packet is allowed and go through CCX",
    "start": "412800",
    "end": "415560"
  },
  {
    "text": "shot which means that the packet is",
    "start": "415560",
    "end": "417000"
  },
  {
    "text": "dropped no matter where it was going and",
    "start": "417000",
    "end": "419160"
  },
  {
    "text": "intersect and spec which means that the",
    "start": "419160",
    "end": "420840"
  },
  {
    "text": "filter doesn't really want to make any",
    "start": "420840",
    "end": "422580"
  },
  {
    "text": "decision yet and allows the next filter",
    "start": "422580",
    "end": "424560"
  },
  {
    "text": "to make the decision for you",
    "start": "424560",
    "end": "427440"
  },
  {
    "text": "filters are identified by handzels so",
    "start": "427440",
    "end": "430440"
  },
  {
    "text": "these are either hard-coded or you know",
    "start": "430440",
    "end": "433800"
  },
  {
    "text": "numbers decided by the kernels and",
    "start": "433800",
    "end": "435600"
  },
  {
    "text": "allocated at runtime and you can also",
    "start": "435600",
    "end": "438060"
  },
  {
    "text": "specify priority levels for your filters",
    "start": "438060",
    "end": "441660"
  },
  {
    "text": "so the priority is actually used to",
    "start": "441660",
    "end": "443520"
  },
  {
    "text": "define the order of execution of those",
    "start": "443520",
    "end": "445620"
  },
  {
    "text": "different filters the lowest priority is",
    "start": "445620",
    "end": "448259"
  },
  {
    "text": "actually going to be executed first and",
    "start": "448259",
    "end": "450240"
  },
  {
    "text": "at a given priority level the program",
    "start": "450240",
    "end": "452580"
  },
  {
    "text": "that was loaded last is the first one to",
    "start": "452580",
    "end": "454680"
  },
  {
    "text": "be triggered",
    "start": "454680",
    "end": "456419"
  },
  {
    "text": "so with this background let's see how",
    "start": "456419",
    "end": "459720"
  },
  {
    "text": "psyllium uses and configures its own TC",
    "start": "459720",
    "end": "462599"
  },
  {
    "text": "programs",
    "start": "462599",
    "end": "464280"
  },
  {
    "text": "there are three main things that you",
    "start": "464280",
    "end": "466440"
  },
  {
    "text": "need to know about how celium uses TC",
    "start": "466440",
    "end": "468599"
  },
  {
    "text": "the first one is that the TC filters",
    "start": "468599",
    "end": "470819"
  },
  {
    "text": "always answer either TC act okay or tcx",
    "start": "470819",
    "end": "474479"
  },
  {
    "text": "shot in other words this is one way to",
    "start": "474479",
    "end": "476699"
  },
  {
    "text": "draw packets and this is another also a",
    "start": "476699",
    "end": "478800"
  },
  {
    "text": "way to make sure that the packet is",
    "start": "478800",
    "end": "480180"
  },
  {
    "text": "allowed to go through to either a",
    "start": "480180",
    "end": "482160"
  },
  {
    "text": "workload or to go out",
    "start": "482160",
    "end": "484560"
  },
  {
    "text": "the point here is because of this and",
    "start": "484560",
    "end": "487319"
  },
  {
    "text": "also because psyllium hardcodes the",
    "start": "487319",
    "end": "489479"
  },
  {
    "text": "handle and the priority to one",
    "start": "489479",
    "end": "491880"
  },
  {
    "text": "um also side note this is expected",
    "start": "491880",
    "end": "493759"
  },
  {
    "text": "psyllium you know owns the network data",
    "start": "493759",
    "end": "496199"
  },
  {
    "text": "path so it was expected for them to use",
    "start": "496199",
    "end": "498780"
  },
  {
    "text": "you know a priority level and a handle",
    "start": "498780",
    "end": "501120"
  },
  {
    "text": "that is high enough so that they know",
    "start": "501120",
    "end": "503460"
  },
  {
    "text": "that they are going to be to be the",
    "start": "503460",
    "end": "504960"
  },
  {
    "text": "first one to be called while the packet",
    "start": "504960",
    "end": "507060"
  },
  {
    "text": "comes to an interface",
    "start": "507060",
    "end": "508620"
  },
  {
    "text": "but because of this and because we we",
    "start": "508620",
    "end": "510900"
  },
  {
    "text": "wanted to use TC as well to implement",
    "start": "510900",
    "end": "512940"
  },
  {
    "text": "our own network policy use case",
    "start": "512940",
    "end": "515459"
  },
  {
    "text": "um we had to work around these",
    "start": "515459",
    "end": "516779"
  },
  {
    "text": "parameters and figure out a way to still",
    "start": "516779",
    "end": "518760"
  },
  {
    "text": "introduce TC filters while making sure",
    "start": "518760",
    "end": "521159"
  },
  {
    "text": "they would be triggered and this is why",
    "start": "521159",
    "end": "523740"
  },
  {
    "text": "we used",
    "start": "523740",
    "end": "525120"
  },
  {
    "text": "um so first of all we decided to hard",
    "start": "525120",
    "end": "527459"
  },
  {
    "text": "code again the priority one as well",
    "start": "527459",
    "end": "529019"
  },
  {
    "text": "because we wanted to use you know the",
    "start": "529019",
    "end": "530820"
  },
  {
    "text": "execution ordering rule that says that",
    "start": "530820",
    "end": "532980"
  },
  {
    "text": "the latest inserted program is going to",
    "start": "532980",
    "end": "534660"
  },
  {
    "text": "be the first one triggered and again",
    "start": "534660",
    "end": "536580"
  },
  {
    "text": "this is uh you know the the ration law",
    "start": "536580",
    "end": "538980"
  },
  {
    "text": "behind this was that psyllium would set",
    "start": "538980",
    "end": "541260"
  },
  {
    "text": "up the code set up the networking and",
    "start": "541260",
    "end": "543360"
  },
  {
    "text": "then we would load our own",
    "start": "543360",
    "end": "544680"
  },
  {
    "text": "instrumentation of the different",
    "start": "544680",
    "end": "546120"
  },
  {
    "text": "interfaces we care about so we didn't",
    "start": "546120",
    "end": "548339"
  },
  {
    "text": "hard code any handles because we didn't",
    "start": "548339",
    "end": "550980"
  },
  {
    "text": "want um to Mendel or to choose one",
    "start": "550980",
    "end": "554640"
  },
  {
    "text": "specific number because you know",
    "start": "554640",
    "end": "555899"
  },
  {
    "text": "psyllium is only one cni out there out",
    "start": "555899",
    "end": "558000"
  },
  {
    "text": "there and other people could be using",
    "start": "558000",
    "end": "559860"
  },
  {
    "text": "all their handles as well and yeah we",
    "start": "559860",
    "end": "562800"
  },
  {
    "text": "made sure to always insert TC act and",
    "start": "562800",
    "end": "564660"
  },
  {
    "text": "spec to be sure that cilium would make",
    "start": "564660",
    "end": "567000"
  },
  {
    "text": "the ultimate decision when it comes to",
    "start": "567000",
    "end": "568680"
  },
  {
    "text": "network packets and that would be you",
    "start": "568680",
    "end": "571080"
  },
  {
    "text": "know pretty much it in theory we also",
    "start": "571080",
    "end": "573420"
  },
  {
    "text": "added a periodical check to make sure",
    "start": "573420",
    "end": "574920"
  },
  {
    "text": "that our filters were still loaded again",
    "start": "574920",
    "end": "577019"
  },
  {
    "text": "we knew that other people might be using",
    "start": "577019",
    "end": "578820"
  },
  {
    "text": "TC so we had to make sure that once we",
    "start": "578820",
    "end": "581580"
  },
  {
    "text": "say that we instrument interface we are",
    "start": "581580",
    "end": "584100"
  },
  {
    "text": "still here after a certain period of",
    "start": "584100",
    "end": "586200"
  },
  {
    "text": "time",
    "start": "586200",
    "end": "586920"
  },
  {
    "text": "and yeah again that's pretty much it on",
    "start": "586920",
    "end": "589500"
  },
  {
    "text": "paper everything should work fine",
    "start": "589500",
    "end": "593300"
  },
  {
    "text": "except that it wasn't but yeah",
    "start": "594839",
    "end": "598760"
  },
  {
    "text": "so at this point we've been to a lot of",
    "start": "600839",
    "end": "604320"
  },
  {
    "text": "crime scenes and we started to see some",
    "start": "604320",
    "end": "606600"
  },
  {
    "text": "patterns over time and what we realized",
    "start": "606600",
    "end": "609420"
  },
  {
    "text": "is that the murderer whoever that was",
    "start": "609420",
    "end": "611880"
  },
  {
    "text": "was only interested in new parts they",
    "start": "611880",
    "end": "614640"
  },
  {
    "text": "were not interested in pods that were",
    "start": "614640",
    "end": "616260"
  },
  {
    "text": "already running at all so all the",
    "start": "616260",
    "end": "618240"
  },
  {
    "text": "reports that we were getting from our",
    "start": "618240",
    "end": "619560"
  },
  {
    "text": "users were only talking about new pods",
    "start": "619560",
    "end": "622620"
  },
  {
    "text": "and as I mentioned before these pods",
    "start": "622620",
    "end": "625320"
  },
  {
    "text": "were completely Vanishing Away by the",
    "start": "625320",
    "end": "627120"
  },
  {
    "text": "time we could get to them so we really",
    "start": "627120",
    "end": "628740"
  },
  {
    "text": "needed a reproducer so at this point",
    "start": "628740",
    "end": "631260"
  },
  {
    "text": "because we understand that this is only",
    "start": "631260",
    "end": "633060"
  },
  {
    "text": "happening for new parts we created a",
    "start": "633060",
    "end": "635160"
  },
  {
    "text": "test workload and removed the Readiness",
    "start": "635160",
    "end": "636899"
  },
  {
    "text": "checks on them and just ran it in a loop",
    "start": "636899",
    "end": "639600"
  },
  {
    "text": "until we could hit the reproducer and",
    "start": "639600",
    "end": "642000"
  },
  {
    "text": "soon enough we had one",
    "start": "642000",
    "end": "644700"
  },
  {
    "text": "so and once we had that pod and the host",
    "start": "644700",
    "end": "646740"
  },
  {
    "text": "ready to investigate we wanted to answer",
    "start": "646740",
    "end": "649320"
  },
  {
    "text": "the question is psyllium actually",
    "start": "649320",
    "end": "650880"
  },
  {
    "text": "setting up the Pod Network correctly",
    "start": "650880",
    "end": "652740"
  },
  {
    "text": "right",
    "start": "652740",
    "end": "654480"
  },
  {
    "text": "so we could do this in few ways but uh",
    "start": "654480",
    "end": "657360"
  },
  {
    "text": "the celium version that we were using at",
    "start": "657360",
    "end": "659100"
  },
  {
    "text": "this point in time was actually using",
    "start": "659100",
    "end": "660959"
  },
  {
    "text": "the TC binary that's part of the helium",
    "start": "660959",
    "end": "663720"
  },
  {
    "text": "agent image itself to install BPF",
    "start": "663720",
    "end": "666180"
  },
  {
    "text": "programs through the TC subsystem",
    "start": "666180",
    "end": "668579"
  },
  {
    "text": "and we could use the same TC command to",
    "start": "668579",
    "end": "671160"
  },
  {
    "text": "actually inspect of the interface of the",
    "start": "671160",
    "end": "673140"
  },
  {
    "text": "pods interface has the necessary ebpf",
    "start": "673140",
    "end": "675720"
  },
  {
    "text": "programs or not so TC filter show Dev",
    "start": "675720",
    "end": "678540"
  },
  {
    "text": "and the Pod network interface would",
    "start": "678540",
    "end": "680940"
  },
  {
    "text": "actually tell you whether the vpf",
    "start": "680940",
    "end": "682740"
  },
  {
    "text": "programs are installed or not and here",
    "start": "682740",
    "end": "684660"
  },
  {
    "text": "we could see that the egress programs",
    "start": "684660",
    "end": "686880"
  },
  {
    "text": "were completely missing for this for",
    "start": "686880",
    "end": "688800"
  },
  {
    "text": "this specific part and the Ingress",
    "start": "688800",
    "end": "690720"
  },
  {
    "text": "programs were totally fine right so we",
    "start": "690720",
    "end": "693360"
  },
  {
    "text": "were totally confused at this point and",
    "start": "693360",
    "end": "695459"
  },
  {
    "text": "we wanted to understand why",
    "start": "695459",
    "end": "698399"
  },
  {
    "text": "so BPF has a rich ecosystem of tools",
    "start": "698399",
    "end": "702180"
  },
  {
    "text": "available at disposal so we decided to",
    "start": "702180",
    "end": "704279"
  },
  {
    "text": "use BBF Trace to try and understand",
    "start": "704279",
    "end": "706140"
  },
  {
    "text": "exactly what is happening and vpf Trace",
    "start": "706140",
    "end": "709200"
  },
  {
    "text": "comes out of the box with a lot of tools",
    "start": "709200",
    "end": "711660"
  },
  {
    "text": "that you can use immediately right",
    "start": "711660",
    "end": "714720"
  },
  {
    "text": "so we decided to use exec Snoop and exit",
    "start": "714720",
    "end": "717420"
  },
  {
    "text": "Snoop as I said before selem is using",
    "start": "717420",
    "end": "719700"
  },
  {
    "text": "the TC binary to install the BPF",
    "start": "719700",
    "end": "721560"
  },
  {
    "text": "programs so exec Snoop will basically",
    "start": "721560",
    "end": "724079"
  },
  {
    "text": "allow us to trace all the programs that",
    "start": "724079",
    "end": "726000"
  },
  {
    "text": "are being started up on the host so we",
    "start": "726000",
    "end": "728760"
  },
  {
    "text": "ran exec Snoop with a filter of with a",
    "start": "728760",
    "end": "731399"
  },
  {
    "text": "grep of TC filter and we saw that TC",
    "start": "731399",
    "end": "734399"
  },
  {
    "text": "filter replace commands were actually",
    "start": "734399",
    "end": "735959"
  },
  {
    "text": "being executed for both from container",
    "start": "735959",
    "end": "738660"
  },
  {
    "text": "and to container this corresponds to",
    "start": "738660",
    "end": "740459"
  },
  {
    "text": "egress and Ingress sections and we also",
    "start": "740459",
    "end": "743040"
  },
  {
    "text": "ran exit Snoop which basically tells us",
    "start": "743040",
    "end": "745200"
  },
  {
    "text": "the exit code of these commands and we",
    "start": "745200",
    "end": "747660"
  },
  {
    "text": "saw that they were all completing",
    "start": "747660",
    "end": "748920"
  },
  {
    "text": "successfully no issues at all",
    "start": "748920",
    "end": "751320"
  },
  {
    "text": "so this totally confused us again so we",
    "start": "751320",
    "end": "755040"
  },
  {
    "text": "reached out to the community and created",
    "start": "755040",
    "end": "756660"
  },
  {
    "text": "an issue Upstream because we were",
    "start": "756660",
    "end": "758579"
  },
  {
    "text": "thinking that maybe this the TC binary",
    "start": "758579",
    "end": "761279"
  },
  {
    "text": "image that was baked into the clim agent",
    "start": "761279",
    "end": "763560"
  },
  {
    "text": "and whatever was running on the host was",
    "start": "763560",
    "end": "765899"
  },
  {
    "text": "different and maybe it's some weird",
    "start": "765899",
    "end": "767760"
  },
  {
    "text": "kernel thing so we reached out to the",
    "start": "767760",
    "end": "769920"
  },
  {
    "text": "community and asked for help and within",
    "start": "769920",
    "end": "772019"
  },
  {
    "text": "a day we got some response from Paul and",
    "start": "772019",
    "end": "774899"
  },
  {
    "text": "Daniel and they seem to think that the",
    "start": "774899",
    "end": "777300"
  },
  {
    "text": "presence of another ebpf program called",
    "start": "777300",
    "end": "779880"
  },
  {
    "text": "classifier Ingress Security on the host",
    "start": "779880",
    "end": "782300"
  },
  {
    "text": "was what was correlated to this uh",
    "start": "782300",
    "end": "785820"
  },
  {
    "text": "connectivity issues in the past and they",
    "start": "785820",
    "end": "787740"
  },
  {
    "text": "asked us to look into it",
    "start": "787740",
    "end": "790760"
  },
  {
    "text": "but we still needed proof to understand",
    "start": "790800",
    "end": "793500"
  },
  {
    "text": "why this was happening and why exactly",
    "start": "793500",
    "end": "795360"
  },
  {
    "text": "this is happening so the answer to that",
    "start": "795360",
    "end": "797459"
  },
  {
    "text": "is writing a little bit more BBF through",
    "start": "797459",
    "end": "800279"
  },
  {
    "text": "BPF Trace again but this time we had a",
    "start": "800279",
    "end": "802740"
  },
  {
    "text": "custom BBF Trace program and we had we",
    "start": "802740",
    "end": "805440"
  },
  {
    "text": "were monitoring we we had some hook",
    "start": "805440",
    "end": "807480"
  },
  {
    "text": "points k-probes and Trace points on both",
    "start": "807480",
    "end": "810420"
  },
  {
    "text": "TC replace add destroy and also on Q",
    "start": "810420",
    "end": "814260"
  },
  {
    "text": "disc destroy and create and we made sure",
    "start": "814260",
    "end": "816540"
  },
  {
    "text": "to log the PID and the probe name and",
    "start": "816540",
    "end": "819300"
  },
  {
    "text": "also the user stack at the point where",
    "start": "819300",
    "end": "821880"
  },
  {
    "text": "we hit this Trace",
    "start": "821880",
    "end": "824639"
  },
  {
    "text": "and once we ran this we started to get",
    "start": "824639",
    "end": "827100"
  },
  {
    "text": "some really really interesting answers",
    "start": "827100",
    "end": "828899"
  },
  {
    "text": "and at the beginning here you can see",
    "start": "828899",
    "end": "831540"
  },
  {
    "text": "that the from container and two",
    "start": "831540",
    "end": "833700"
  },
  {
    "text": "container are being successfully",
    "start": "833700",
    "end": "835200"
  },
  {
    "text": "installed by a PID ending with three",
    "start": "835200",
    "end": "837720"
  },
  {
    "text": "nine five three nine five and three nine",
    "start": "837720",
    "end": "839760"
  },
  {
    "text": "eight",
    "start": "839760",
    "end": "841320"
  },
  {
    "text": "and there were classified Ingress",
    "start": "841320",
    "end": "844019"
  },
  {
    "text": "security BPF programs that were being",
    "start": "844019",
    "end": "846060"
  },
  {
    "text": "installed by a PID call 2659 and the",
    "start": "846060",
    "end": "849120"
  },
  {
    "text": "same PID was actually destroying bpflxc2",
    "start": "849120",
    "end": "852600"
  },
  {
    "text": "container and even sometimes from",
    "start": "852600",
    "end": "854279"
  },
  {
    "text": "container right so what is 2659 it's",
    "start": "854279",
    "end": "858060"
  },
  {
    "text": "data occasion",
    "start": "858060",
    "end": "859639"
  },
  {
    "text": "so was it really us all along deleting",
    "start": "859639",
    "end": "862740"
  },
  {
    "text": "this and here when we looked at the",
    "start": "862740",
    "end": "865380"
  },
  {
    "text": "stack trace it actually told us that we",
    "start": "865380",
    "end": "867540"
  },
  {
    "text": "were calling something called flush",
    "start": "867540",
    "end": "868800"
  },
  {
    "text": "inactive probes so for some reason data",
    "start": "868800",
    "end": "871079"
  },
  {
    "text": "dog agent was thinking this is inactive",
    "start": "871079",
    "end": "873720"
  },
  {
    "text": "and at the same time we also realized",
    "start": "873720",
    "end": "875820"
  },
  {
    "text": "that datadogs on CWS Network policy",
    "start": "875820",
    "end": "878700"
  },
  {
    "text": "coverage was also missing and",
    "start": "878700",
    "end": "880680"
  },
  {
    "text": "something's broken there too so if only",
    "start": "880680",
    "end": "883500"
  },
  {
    "text": "celium agents programs are being deleted",
    "start": "883500",
    "end": "885600"
  },
  {
    "text": "why was Data engagement also being",
    "start": "885600",
    "end": "887459"
  },
  {
    "text": "impacted so to learn more about that",
    "start": "887459",
    "end": "889620"
  },
  {
    "text": "I'll like we'll talk about it",
    "start": "889620",
    "end": "893180"
  },
  {
    "text": "um",
    "start": "894959",
    "end": "895680"
  },
  {
    "text": "so at this point uh",
    "start": "895680",
    "end": "898680"
  },
  {
    "text": "we also wanted to understand what other",
    "start": "898680",
    "end": "901199"
  },
  {
    "text": "net link messages were being sent",
    "start": "901199",
    "end": "902760"
  },
  {
    "text": "because the TC binary does not use the",
    "start": "902760",
    "end": "905699"
  },
  {
    "text": "netlink library directly but the cloud",
    "start": "905699",
    "end": "908040"
  },
  {
    "text": "workload Securities uh data log agent",
    "start": "908040",
    "end": "910440"
  },
  {
    "text": "was using net link binary to interact",
    "start": "910440",
    "end": "913019"
  },
  {
    "text": "with the kernel so we wanted to capture",
    "start": "913019",
    "end": "915060"
  },
  {
    "text": "all the net link messages that were",
    "start": "915060",
    "end": "916680"
  },
  {
    "text": "being sent to the kernel and we realized",
    "start": "916680",
    "end": "919019"
  },
  {
    "text": "that there was a kernel module called",
    "start": "919019",
    "end": "920459"
  },
  {
    "text": "analmon that allows us to monitor all",
    "start": "920459",
    "end": "922680"
  },
  {
    "text": "the netlink messages so we built the",
    "start": "922680",
    "end": "924600"
  },
  {
    "text": "kernel module loaded it and you could",
    "start": "924600",
    "end": "927180"
  },
  {
    "text": "actually run TCP dump on the virtual",
    "start": "927180",
    "end": "929399"
  },
  {
    "text": "interface and you could get all the",
    "start": "929399",
    "end": "931019"
  },
  {
    "text": "netlink messages but what we realized is",
    "start": "931019",
    "end": "933420"
  },
  {
    "text": "that the protocol that was parsing this",
    "start": "933420",
    "end": "936360"
  },
  {
    "text": "netling messages did not have all the",
    "start": "936360",
    "end": "938160"
  },
  {
    "text": "information that we wanted so we wrote a",
    "start": "938160",
    "end": "940800"
  },
  {
    "text": "custom one that captures all these",
    "start": "940800",
    "end": "942480"
  },
  {
    "text": "messages and we'll we'll talk about that",
    "start": "942480",
    "end": "945600"
  },
  {
    "text": "yeah exactly so we were still not really",
    "start": "945600",
    "end": "948240"
  },
  {
    "text": "confident about what was going on",
    "start": "948240",
    "end": "949860"
  },
  {
    "text": "because it was clear that datadag was",
    "start": "949860",
    "end": "952019"
  },
  {
    "text": "deleting the program but with all the",
    "start": "952019",
    "end": "954360"
  },
  {
    "text": "gods you know the god whales that we put",
    "start": "954360",
    "end": "956339"
  },
  {
    "text": "in place and you know the perfect plan",
    "start": "956339",
    "end": "958440"
  },
  {
    "text": "that we had in mind",
    "start": "958440",
    "end": "960180"
  },
  {
    "text": "um you know everything should be working",
    "start": "960180",
    "end": "961500"
  },
  {
    "text": "fine so what's going on why did we end",
    "start": "961500",
    "end": "963360"
  },
  {
    "text": "up deleting silion's filter",
    "start": "963360",
    "end": "965699"
  },
  {
    "text": "um so we built another tool to get a bit",
    "start": "965699",
    "end": "967860"
  },
  {
    "text": "more context about what exactly was",
    "start": "967860",
    "end": "969600"
  },
  {
    "text": "going on because you know the the",
    "start": "969600",
    "end": "971220"
  },
  {
    "text": "scripts that him was talking about were",
    "start": "971220",
    "end": "973740"
  },
  {
    "text": "great to identify you know the faulty",
    "start": "973740",
    "end": "975720"
  },
  {
    "text": "program but didn't like really provide",
    "start": "975720",
    "end": "977820"
  },
  {
    "text": "the context of the different events that",
    "start": "977820",
    "end": "980279"
  },
  {
    "text": "it eventually led to the deletion so we",
    "start": "980279",
    "end": "982980"
  },
  {
    "text": "wrote CC probe uh it's an open source",
    "start": "982980",
    "end": "984839"
  },
  {
    "text": "project you can have it on GitHub uh it",
    "start": "984839",
    "end": "987060"
  },
  {
    "text": "will you know output more context about",
    "start": "987060",
    "end": "989160"
  },
  {
    "text": "the different TC operations that happen",
    "start": "989160",
    "end": "990899"
  },
  {
    "text": "on a host",
    "start": "990899",
    "end": "992279"
  },
  {
    "text": "see on the right you're going to have",
    "start": "992279",
    "end": "993720"
  },
  {
    "text": "the output of the program and on the",
    "start": "993720",
    "end": "995339"
  },
  {
    "text": "left you have some kind of a graphical",
    "start": "995339",
    "end": "996839"
  },
  {
    "text": "representation of what's going on so the",
    "start": "996839",
    "end": "999959"
  },
  {
    "text": "race condition happens unstuttered when",
    "start": "999959",
    "end": "1002300"
  },
  {
    "text": "a new pod starts and when a new",
    "start": "1002300",
    "end": "1003980"
  },
  {
    "text": "interface is set up by both the celium",
    "start": "1003980",
    "end": "1006079"
  },
  {
    "text": "and datadag so let's see events by even",
    "start": "1006079",
    "end": "1008540"
  },
  {
    "text": "what's happening and how things unfold",
    "start": "1008540",
    "end": "1010940"
  },
  {
    "text": "to uh you know a murder basically",
    "start": "1010940",
    "end": "1013579"
  },
  {
    "text": "so first a new interface Commons line",
    "start": "1013579",
    "end": "1015920"
  },
  {
    "text": "and then you know CDM creates a new CLS",
    "start": "1015920",
    "end": "1018440"
  },
  {
    "text": "activate disk to instrument this",
    "start": "1018440",
    "end": "1020120"
  },
  {
    "text": "specific interface so far so good this",
    "start": "1020120",
    "end": "1022100"
  },
  {
    "text": "is expected",
    "start": "1022100",
    "end": "1023420"
  },
  {
    "text": "then CDM moves on to installing its own",
    "start": "1023420",
    "end": "1026240"
  },
  {
    "text": "TC programs so this one specifically is",
    "start": "1026240",
    "end": "1028699"
  },
  {
    "text": "an Ingress and as expected it has prior",
    "start": "1028699",
    "end": "1031520"
  },
  {
    "text": "one handle one so far so good as well",
    "start": "1031520",
    "end": "1034640"
  },
  {
    "text": "and then CWS picks some picks up on the",
    "start": "1034640",
    "end": "1037220"
  },
  {
    "text": "new interface so we have EPF programs to",
    "start": "1037220",
    "end": "1039620"
  },
  {
    "text": "register I mean to detect when new vet",
    "start": "1039620",
    "end": "1042260"
  },
  {
    "text": "pair interfaces are registered so we",
    "start": "1042260",
    "end": "1044418"
  },
  {
    "text": "actually get you know notifications from",
    "start": "1044419",
    "end": "1046160"
  },
  {
    "text": "the kernel when a new interface is ready",
    "start": "1046160",
    "end": "1048020"
  },
  {
    "text": "to be instrumented and this is how we",
    "start": "1048020",
    "end": "1050360"
  },
  {
    "text": "detect the new interface and decide to",
    "start": "1050360",
    "end": "1052100"
  },
  {
    "text": "add our own DC programs as well so here",
    "start": "1052100",
    "end": "1055160"
  },
  {
    "text": "you can see that we have our own",
    "start": "1055160",
    "end": "1056960"
  },
  {
    "text": "classifier Ingress security program and",
    "start": "1056960",
    "end": "1059360"
  },
  {
    "text": "it's using handle 2. again we didn't",
    "start": "1059360",
    "end": "1061220"
  },
  {
    "text": "hard code any handles so this handle is",
    "start": "1061220",
    "end": "1063620"
  },
  {
    "text": "actually provided by the kernel and the",
    "start": "1063620",
    "end": "1065900"
  },
  {
    "text": "race actually occurs when we end up",
    "start": "1065900",
    "end": "1068900"
  },
  {
    "text": "being faster than CDN to instrument the",
    "start": "1068900",
    "end": "1071299"
  },
  {
    "text": "interface that CDM created and the bad",
    "start": "1071299",
    "end": "1073580"
  },
  {
    "text": "news is because we did not hand part",
    "start": "1073580",
    "end": "1075919"
  },
  {
    "text": "code any handles we end up getting",
    "start": "1075919",
    "end": "1078080"
  },
  {
    "text": "handle one because this is you know the",
    "start": "1078080",
    "end": "1080240"
  },
  {
    "text": "first filter on this priority level",
    "start": "1080240",
    "end": "1081880"
  },
  {
    "text": "endocrinologist grants ask handle one",
    "start": "1081880",
    "end": "1085400"
  },
  {
    "text": "the issue here is that CDM didn't",
    "start": "1085400",
    "end": "1087380"
  },
  {
    "text": "prepare for this because they did use",
    "start": "1087380",
    "end": "1090260"
  },
  {
    "text": "handle one as well but hard coded and",
    "start": "1090260",
    "end": "1092059"
  },
  {
    "text": "because one of the use cases is to",
    "start": "1092059",
    "end": "1093740"
  },
  {
    "text": "atomically swap the filters they're used",
    "start": "1093740",
    "end": "1096020"
  },
  {
    "text": "by default you know the flag to swap the",
    "start": "1096020",
    "end": "1098000"
  },
  {
    "text": "filter at handle one which means that",
    "start": "1098000",
    "end": "1100580"
  },
  {
    "text": "they automatically swap our filter",
    "start": "1100580",
    "end": "1103280"
  },
  {
    "text": "and well to their to their point uh we",
    "start": "1103280",
    "end": "1106700"
  },
  {
    "text": "didn't prepare for this as well because",
    "start": "1106700",
    "end": "1108140"
  },
  {
    "text": "uh we have a periodical check to make",
    "start": "1108140",
    "end": "1110360"
  },
  {
    "text": "sure that our programs are still loaded",
    "start": "1110360",
    "end": "1112220"
  },
  {
    "text": "and by default if they're not then we",
    "start": "1112220",
    "end": "1114380"
  },
  {
    "text": "clean up everything that the kernel gave",
    "start": "1114380",
    "end": "1115940"
  },
  {
    "text": "us in this specific case we still",
    "start": "1115940",
    "end": "1117860"
  },
  {
    "text": "believe that handle one is ours and we",
    "start": "1117860",
    "end": "1120140"
  },
  {
    "text": "cannot be behind ourselves which means",
    "start": "1120140",
    "end": "1122059"
  },
  {
    "text": "that we end up deleting filter so that's",
    "start": "1122059",
    "end": "1125120"
  },
  {
    "text": "pretty much you know the the gist of the",
    "start": "1125120",
    "end": "1126980"
  },
  {
    "text": "race and the race condition is really",
    "start": "1126980",
    "end": "1128720"
  },
  {
    "text": "that on some case in some cases we ended",
    "start": "1128720",
    "end": "1131539"
  },
  {
    "text": "up being faster than CDM to instrument",
    "start": "1131539",
    "end": "1133539"
  },
  {
    "text": "interfaces and this is what explains uh",
    "start": "1133539",
    "end": "1136700"
  },
  {
    "text": "you know the fact that it was not always",
    "start": "1136700",
    "end": "1138200"
  },
  {
    "text": "happening and was pretty hard to debug",
    "start": "1138200",
    "end": "1140900"
  },
  {
    "text": "all right Hammond take it away",
    "start": "1140900",
    "end": "1144160"
  },
  {
    "text": "thank you",
    "start": "1147280",
    "end": "1150400"
  },
  {
    "text": "so how do we fix this issue today uh",
    "start": "1150500",
    "end": "1154280"
  },
  {
    "text": "sicilium as of 112 started supporting Uh",
    "start": "1154280",
    "end": "1157820"
  },
  {
    "text": "custom priorities for TC filters and CWS",
    "start": "1157820",
    "end": "1161059"
  },
  {
    "text": "also rolled out an update that bumped",
    "start": "1161059",
    "end": "1163340"
  },
  {
    "text": "the default priority from 1 to 10 so",
    "start": "1163340",
    "end": "1165799"
  },
  {
    "text": "that people using data dog agent and",
    "start": "1165799",
    "end": "1167720"
  },
  {
    "text": "celium things wouldn't break for them",
    "start": "1167720",
    "end": "1169720"
  },
  {
    "text": "and if today if you want to use both of",
    "start": "1169720",
    "end": "1173000"
  },
  {
    "text": "them together you'd have to redeploy",
    "start": "1173000",
    "end": "1174799"
  },
  {
    "text": "psyllium with a higher priority with a",
    "start": "1174799",
    "end": "1177260"
  },
  {
    "text": "priority that's greater than 10.",
    "start": "1177260",
    "end": "1180760"
  },
  {
    "text": "so what did we learn from this incident",
    "start": "1180919",
    "end": "1183679"
  },
  {
    "text": "right so we learned that TC filter",
    "start": "1183679",
    "end": "1186020"
  },
  {
    "text": "ownership is very racy by Design and a",
    "start": "1186020",
    "end": "1189620"
  },
  {
    "text": "growing number of products are",
    "start": "1189620",
    "end": "1191240"
  },
  {
    "text": "leveraging ubpf these days so over time",
    "start": "1191240",
    "end": "1194179"
  },
  {
    "text": "this issue is only going to get worse",
    "start": "1194179",
    "end": "1196400"
  },
  {
    "text": "without explicit coordination so every",
    "start": "1196400",
    "end": "1199100"
  },
  {
    "text": "player that's using TC ebpf needs to",
    "start": "1199100",
    "end": "1202520"
  },
  {
    "text": "follow the same kind of rules so folks",
    "start": "1202520",
    "end": "1205760"
  },
  {
    "text": "should always use DC act and spec or TC",
    "start": "1205760",
    "end": "1208160"
  },
  {
    "text": "act chart but never TC act okay because",
    "start": "1208160",
    "end": "1210679"
  },
  {
    "text": "if you use TC act okay the packet would",
    "start": "1210679",
    "end": "1212960"
  },
  {
    "text": "be scheduled immediately to the network",
    "start": "1212960",
    "end": "1214580"
  },
  {
    "text": "card and especially monitoring products",
    "start": "1214580",
    "end": "1217280"
  },
  {
    "text": "should not do this and do not ever hard",
    "start": "1217280",
    "end": "1220220"
  },
  {
    "text": "code the handle of one because you would",
    "start": "1220220",
    "end": "1222020"
  },
  {
    "text": "not know what other",
    "start": "1222020",
    "end": "1224059"
  },
  {
    "text": "products are using",
    "start": "1224059",
    "end": "1226100"
  },
  {
    "text": "and for power users make sure the",
    "start": "1226100",
    "end": "1228440"
  },
  {
    "text": "priority and handle can be configurable",
    "start": "1228440",
    "end": "1230179"
  },
  {
    "text": "so then they can mix and match different",
    "start": "1230179",
    "end": "1232520"
  },
  {
    "text": "components and deleting CLS at qdisc is",
    "start": "1232520",
    "end": "1236480"
  },
  {
    "text": "also very racy so you cannot do it and",
    "start": "1236480",
    "end": "1238280"
  },
  {
    "text": "you cannot delete it in a safe way",
    "start": "1238280",
    "end": "1241900"
  },
  {
    "text": "so that's for right now but how do we",
    "start": "1242179",
    "end": "1244700"
  },
  {
    "text": "fix it the right way so the right way to",
    "start": "1244700",
    "end": "1246980"
  },
  {
    "text": "fix it is with BPF links and uh the",
    "start": "1246980",
    "end": "1249799"
  },
  {
    "text": "kernel had support for BPF links for a",
    "start": "1249799",
    "end": "1252080"
  },
  {
    "text": "long time but the traffic control",
    "start": "1252080",
    "end": "1253340"
  },
  {
    "text": "subsystem does not have support for it",
    "start": "1253340",
    "end": "1255620"
  },
  {
    "text": "so there's some work happening Upstream",
    "start": "1255620",
    "end": "1257539"
  },
  {
    "text": "to add the support for the traffic",
    "start": "1257539",
    "end": "1259220"
  },
  {
    "text": "control subsystem and I think it'll be",
    "start": "1259220",
    "end": "1261980"
  },
  {
    "text": "merged sometime around May 2023 and",
    "start": "1261980",
    "end": "1265100"
  },
  {
    "text": "there's also a great talk by Daniel",
    "start": "1265100",
    "end": "1266840"
  },
  {
    "text": "Bachmann talking that gets into a lot",
    "start": "1266840",
    "end": "1269179"
  },
  {
    "text": "more details about",
    "start": "1269179",
    "end": "1270940"
  },
  {
    "text": "BPF links and",
    "start": "1270940",
    "end": "1273440"
  },
  {
    "text": "traffic control BPF links and how we",
    "start": "1273440",
    "end": "1275539"
  },
  {
    "text": "could use them and do check that out",
    "start": "1275539",
    "end": "1278419"
  },
  {
    "text": "so in conclusion",
    "start": "1278419",
    "end": "1280700"
  },
  {
    "text": "this was actually not a murder this is",
    "start": "1280700",
    "end": "1283039"
  },
  {
    "text": "just an accident because there were no",
    "start": "1283039",
    "end": "1285080"
  },
  {
    "text": "clear guidelines established on how",
    "start": "1285080",
    "end": "1286700"
  },
  {
    "text": "different people should use them",
    "start": "1286700",
    "end": "1287840"
  },
  {
    "text": "together",
    "start": "1287840",
    "end": "1288919"
  },
  {
    "text": "and this was a complex incident that",
    "start": "1288919",
    "end": "1292280"
  },
  {
    "text": "actually took us several weeks to get to",
    "start": "1292280",
    "end": "1294320"
  },
  {
    "text": "the bottom of and we're really thankful",
    "start": "1294320",
    "end": "1296059"
  },
  {
    "text": "for the community for all the help and I",
    "start": "1296059",
    "end": "1298640"
  },
  {
    "text": "would also like to thank some of my team",
    "start": "1298640",
    "end": "1300080"
  },
  {
    "text": "members Jared Eric Laurent and Maxim for",
    "start": "1300080",
    "end": "1303200"
  },
  {
    "text": "all the help and if you're interested in",
    "start": "1303200",
    "end": "1305480"
  },
  {
    "text": "working on weird and fun networking",
    "start": "1305480",
    "end": "1307039"
  },
  {
    "text": "issues like this we're always hiring you",
    "start": "1307039",
    "end": "1309140"
  },
  {
    "text": "can reach out to either of us on email",
    "start": "1309140",
    "end": "1310580"
  },
  {
    "text": "or Twitter",
    "start": "1310580",
    "end": "1311600"
  },
  {
    "text": "thank you",
    "start": "1311600",
    "end": "1313740"
  },
  {
    "text": "[Applause]",
    "start": "1313740",
    "end": "1320059"
  }
]