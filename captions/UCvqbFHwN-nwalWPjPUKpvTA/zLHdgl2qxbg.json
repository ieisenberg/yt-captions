[
  {
    "text": "all right welcome everyone Thank you for",
    "start": "480",
    "end": "2879"
  },
  {
    "text": "joining Marty talk So today we are going",
    "start": "2879",
    "end": "5040"
  },
  {
    "text": "to talk about memory and with uh where",
    "start": "5040",
    "end": "8160"
  },
  {
    "text": "all my memory is gone So today we are",
    "start": "8160",
    "end": "12160"
  },
  {
    "text": "trying to map the Kubernetes memory",
    "start": "12160",
    "end": "14240"
  },
  {
    "text": "matrix to actual physical resource I",
    "start": "14240",
    "end": "17520"
  },
  {
    "text": "hope you you will learn",
    "start": "17520",
    "end": "19400"
  },
  {
    "text": "something So um I'm I'm May I'm working",
    "start": "19400",
    "end": "23600"
  },
  {
    "text": "as a software engineer at isalent at",
    "start": "23600",
    "end": "25840"
  },
  {
    "text": "Cisco Um I'm working on tetragonon which",
    "start": "25840",
    "end": "28880"
  },
  {
    "text": "is an ebpf based runtime security",
    "start": "28880",
    "end": "30960"
  },
  {
    "text": "project It's and it's part of selium and",
    "start": "30960",
    "end": "33280"
  },
  {
    "text": "this is not a picture of",
    "start": "33280",
    "end": "35239"
  },
  {
    "text": "me So it it it all started with",
    "start": "35239",
    "end": "38160"
  },
  {
    "text": "something like that for me So um a",
    "start": "38160",
    "end": "40480"
  },
  {
    "text": "memory dashboard So uh you might end up",
    "start": "40480",
    "end": "42800"
  },
  {
    "text": "in the same situation and um I was quite",
    "start": "42800",
    "end": "45920"
  },
  {
    "text": "confused that like uh what was the",
    "start": "45920",
    "end": "47920"
  },
  {
    "text": "number I was actually looking at So here",
    "start": "47920",
    "end": "50160"
  },
  {
    "text": "you have like an application running a",
    "start": "50160",
    "end": "52160"
  },
  {
    "text": "bunch of pods of this application in",
    "start": "52160",
    "end": "54079"
  },
  {
    "text": "your cluster and they are like consuming",
    "start": "54079",
    "end": "55760"
  },
  {
    "text": "an amount of memory but what is this",
    "start": "55760",
    "end": "57680"
  },
  {
    "text": "memory about and how can I actually",
    "start": "57680",
    "end": "59760"
  },
  {
    "text": "understand what is this about so if you",
    "start": "59760",
    "end": "62719"
  },
  {
    "text": "are checking the",
    "start": "62719",
    "end": "65198"
  },
  {
    "text": "uh this this dashboard in particular you",
    "start": "65199",
    "end": "67520"
  },
  {
    "text": "might see something like this and in",
    "start": "67520",
    "end": "68880"
  },
  {
    "text": "your case it might be the same So the",
    "start": "68880",
    "end": "71360"
  },
  {
    "text": "memory metric that is actually used",
    "start": "71360",
    "end": "73200"
  },
  {
    "text": "behind the scene is this thing called uh",
    "start": "73200",
    "end": "75680"
  },
  {
    "text": "container memory working set bite So",
    "start": "75680",
    "end": "77600"
  },
  {
    "text": "it's it's a pretty long name and um for",
    "start": "77600",
    "end": "80560"
  },
  {
    "text": "me it wasn't very clear what it was",
    "start": "80560",
    "end": "82920"
  },
  {
    "text": "about So let's try to understand where",
    "start": "82920",
    "end": "86080"
  },
  {
    "text": "this metrics come from and how it's it's",
    "start": "86080",
    "end": "88840"
  },
  {
    "text": "built So this is the first conclusion",
    "start": "88840",
    "end": "91920"
  },
  {
    "text": "very early conclusion I I I think I",
    "start": "91920",
    "end": "94400"
  },
  {
    "text": "could be uh fairly right to say that the",
    "start": "94400",
    "end": "96880"
  },
  {
    "text": "main memory metrics that is tracked in",
    "start": "96880",
    "end": "98560"
  },
  {
    "text": "the communities world for pods is",
    "start": "98560",
    "end": "100640"
  },
  {
    "text": "container memory working set byes",
    "start": "100640",
    "end": "104000"
  },
  {
    "text": "So uh the thing I wanted to do next is",
    "start": "104000",
    "end": "106240"
  },
  {
    "text": "trying to understand where it comes from",
    "start": "106240",
    "end": "108079"
  },
  {
    "text": "So um the one one idea was just to read",
    "start": "108079",
    "end": "111200"
  },
  {
    "text": "the documentation In the documentation",
    "start": "111200",
    "end": "113280"
  },
  {
    "text": "on the website you can see a bunch of uh",
    "start": "113280",
    "end": "116560"
  },
  {
    "text": "um descript description of like the",
    "start": "116560",
    "end": "118479"
  },
  {
    "text": "resource metrics pipeline and these kind",
    "start": "118479",
    "end": "120159"
  },
  {
    "text": "of things But one uh good idea is was to",
    "start": "120159",
    "end": "123840"
  },
  {
    "text": "look at the Prometheus dashboard itself",
    "start": "123840",
    "end": "125759"
  },
  {
    "text": "So I just wanted to show you how it",
    "start": "125759",
    "end": "128160"
  },
  {
    "text": "works",
    "start": "128160",
    "end": "129720"
  },
  {
    "text": "um because primitives might be running",
    "start": "129720",
    "end": "132720"
  },
  {
    "text": "uh as part of your cluster you can just",
    "start": "132720",
    "end": "134239"
  },
  {
    "text": "like port forward the service the",
    "start": "134239",
    "end": "136000"
  },
  {
    "text": "primitive server and then you will have",
    "start": "136000",
    "end": "137760"
  },
  {
    "text": "access to the dashboard so I'll try to",
    "start": "137760",
    "end": "139440"
  },
  {
    "text": "zoom in and from the dashboard you can",
    "start": "139440",
    "end": "142080"
  },
  {
    "text": "see uh a bunch of information and among",
    "start": "142080",
    "end": "145680"
  },
  {
    "text": "is like the target elf and uh here you",
    "start": "145680",
    "end": "149440"
  },
  {
    "text": "can see that promeuse is scrapping a",
    "start": "149440",
    "end": "152319"
  },
  {
    "text": "various number of endpoints uh here you",
    "start": "152319",
    "end": "154560"
  },
  {
    "text": "have like the API server the nodes and a",
    "start": "154560",
    "end": "156879"
  },
  {
    "text": "bunch of uh service endpoints",
    "start": "156879",
    "end": "160040"
  },
  {
    "text": "So by gathering all this information",
    "start": "160040",
    "end": "163360"
  },
  {
    "text": "plus uh a very nice blog post written by",
    "start": "163360",
    "end": "167440"
  },
  {
    "text": "a guy named Mia Halbert uh I could kind",
    "start": "167440",
    "end": "170319"
  },
  {
    "text": "of create this uh little diagram of uh",
    "start": "170319",
    "end": "173920"
  },
  {
    "text": "the Kubernetes metrics flow So I will",
    "start": "173920",
    "end": "176319"
  },
  {
    "text": "try to explain the different part in",
    "start": "176319",
    "end": "178000"
  },
  {
    "text": "this graph So on the on the left side",
    "start": "178000",
    "end": "181120"
  },
  {
    "text": "you have this uh green boxes So those",
    "start": "181120",
    "end": "183920"
  },
  {
    "text": "are just service that might be running",
    "start": "183920",
    "end": "185680"
  },
  {
    "text": "as part of your cluster of outside but",
    "start": "185680",
    "end": "187760"
  },
  {
    "text": "this is just what we are fetching for",
    "start": "187760",
    "end": "190159"
  },
  {
    "text": "graphana or cubectl top and you have",
    "start": "190159",
    "end": "193280"
  },
  {
    "text": "like this ble this big blue box which is",
    "start": "193280",
    "end": "195920"
  },
  {
    "text": "the abstraction of your nodes and on",
    "start": "195920",
    "end": "198480"
  },
  {
    "text": "this node you have like a bunch of",
    "start": "198480",
    "end": "199840"
  },
  {
    "text": "process running uh those are the purple",
    "start": "199840",
    "end": "202280"
  },
  {
    "text": "boxes you have cublet so this is the one",
    "start": "202280",
    "end": "205599"
  },
  {
    "text": "responsible for starting the containers",
    "start": "205599",
    "end": "207120"
  },
  {
    "text": "and managing the containers on your node",
    "start": "207120",
    "end": "209040"
  },
  {
    "text": "you have the container runtime the",
    "start": "209040",
    "end": "210640"
  },
  {
    "text": "promeus node not exporter so this thing",
    "start": "210640",
    "end": "212400"
  },
  {
    "text": "is running as part of demon set in the",
    "start": "212400",
    "end": "214879"
  },
  {
    "text": "cluster but it's running on the node and",
    "start": "214879",
    "end": "216720"
  },
  {
    "text": "exposing matrix and as part of the uh",
    "start": "216720",
    "end": "220720"
  },
  {
    "text": "cublet you can see you have like a bunch",
    "start": "220720",
    "end": "222400"
  },
  {
    "text": "of endpoints so uh those are http",
    "start": "222400",
    "end": "225120"
  },
  {
    "text": "endpoints exposed uh via cublet exposing",
    "start": "225120",
    "end": "229280"
  },
  {
    "text": "various metrics so in our case uh we",
    "start": "229280",
    "end": "232959"
  },
  {
    "text": "were looking at this graphana dashboard",
    "start": "232959",
    "end": "234480"
  },
  {
    "text": "for memory so we are directly reading uh",
    "start": "234480",
    "end": "236879"
  },
  {
    "text": "information from the primitive server",
    "start": "236879",
    "end": "238959"
  },
  {
    "text": "you can even like see when you are on",
    "start": "238959",
    "end": "241640"
  },
  {
    "text": "your Prometheus instance you can query",
    "start": "241640",
    "end": "244480"
  },
  {
    "text": "the container memory working set by",
    "start": "244480",
    "end": "246640"
  },
  {
    "text": "directly from here and you can like",
    "start": "246640",
    "end": "249920"
  },
  {
    "text": "graph it and then like see uh this",
    "start": "249920",
    "end": "252239"
  },
  {
    "text": "metrics right so this is coming from",
    "start": "252239",
    "end": "254480"
  },
  {
    "text": "Prometheus of course and uh the next",
    "start": "254480",
    "end": "258000"
  },
  {
    "text": "thing was like where does Prometheus",
    "start": "258000",
    "end": "260560"
  },
  {
    "text": "scraps this metrics from so there there",
    "start": "260560",
    "end": "263520"
  },
  {
    "text": "are like two main culprits here the",
    "start": "263520",
    "end": "265759"
  },
  {
    "text": "primitives not exporter and the C",
    "start": "265759",
    "end": "267680"
  },
  {
    "text": "advisor endpoint so let's start with the",
    "start": "267680",
    "end": "270960"
  },
  {
    "text": "prom primitive node exporter So this",
    "start": "270960",
    "end": "272960"
  },
  {
    "text": "thing is a demon set as I said it's",
    "start": "272960",
    "end": "274560"
  },
  {
    "text": "running as part of your cluster and it's",
    "start": "274560",
    "end": "276080"
  },
  {
    "text": "running on each nodes and because it's",
    "start": "276080",
    "end": "278639"
  },
  {
    "text": "running as part of the of a pod it is",
    "start": "278639",
    "end": "280720"
  },
  {
    "text": "exposed as a service",
    "start": "280720",
    "end": "283080"
  },
  {
    "text": "So if you want to take a look at this",
    "start": "283080",
    "end": "285520"
  },
  {
    "text": "thing you can port forward the service",
    "start": "285520",
    "end": "289360"
  },
  {
    "text": "uh this one and with curl for example",
    "start": "289360",
    "end": "292720"
  },
  {
    "text": "you can query the",
    "start": "292720",
    "end": "295639"
  },
  {
    "text": "matrix path and put it into less So if",
    "start": "295639",
    "end": "299040"
  },
  {
    "text": "we do that we will see a bunch of",
    "start": "299040",
    "end": "300639"
  },
  {
    "text": "metrics exposed here like a bunch of go",
    "start": "300639",
    "end": "303840"
  },
  {
    "text": "related metrics but the vast majority of",
    "start": "303840",
    "end": "306240"
  },
  {
    "text": "the metrics will start with this node",
    "start": "306240",
    "end": "307880"
  },
  {
    "text": "prefix So this is not really what we are",
    "start": "307880",
    "end": "310400"
  },
  {
    "text": "looking for and if we check for anything",
    "start": "310400",
    "end": "312320"
  },
  {
    "text": "starting with container it won't be",
    "start": "312320",
    "end": "314560"
  },
  {
    "text": "there So this one is mostly about",
    "start": "314560",
    "end": "316720"
  },
  {
    "text": "exposing u data about the node elf So",
    "start": "316720",
    "end": "320720"
  },
  {
    "text": "it's not really about the workloads",
    "start": "320720",
    "end": "323720"
  },
  {
    "text": "themselves Let's get back to the",
    "start": "323720",
    "end": "326039"
  },
  {
    "text": "presentation All right So the next",
    "start": "326039",
    "end": "328720"
  },
  {
    "text": "culprit is the C advisor endpoint So um",
    "start": "328720",
    "end": "332400"
  },
  {
    "text": "the C advisor endpoint it's something",
    "start": "332400",
    "end": "334639"
  },
  {
    "text": "that is running as part of the cublet",
    "start": "334639",
    "end": "336639"
  },
  {
    "text": "right is exposed part via the cublet So",
    "start": "336639",
    "end": "339919"
  },
  {
    "text": "the nice thing is that we can actually",
    "start": "339919",
    "end": "342080"
  },
  {
    "text": "read this directly by quering the",
    "start": "342080",
    "end": "344080"
  },
  {
    "text": "cubernetes API Um we can use this",
    "start": "344080",
    "end": "347320"
  },
  {
    "text": "command So we can cube get and use this",
    "start": "347320",
    "end": "351280"
  },
  {
    "text": "very nice proxy feature in in the API",
    "start": "351280",
    "end": "354080"
  },
  {
    "text": "server So we can use like SL API/v1",
    "start": "354080",
    "end": "356560"
  },
  {
    "text": "nodes In my case I have only one node",
    "start": "356560",
    "end": "358800"
  },
  {
    "text": "It's like a locally running cluster It's",
    "start": "358800",
    "end": "360800"
  },
  {
    "text": "mini cube And then you have like this",
    "start": "360800",
    "end": "362960"
  },
  {
    "text": "proxy thingy and and you can pass any",
    "start": "362960",
    "end": "365840"
  },
  {
    "text": "endpoint you want to retrieve directly",
    "start": "365840",
    "end": "367520"
  },
  {
    "text": "on that nodes on the cublet node via",
    "start": "367520",
    "end": "369840"
  },
  {
    "text": "this proxy uh thing And if we check like",
    "start": "369840",
    "end": "372680"
  },
  {
    "text": "the the thing from the the metrics from",
    "start": "372680",
    "end": "375520"
  },
  {
    "text": "this endpoint uh we can see that now",
    "start": "375520",
    "end": "378080"
  },
  {
    "text": "most of those are starting with the",
    "start": "378080",
    "end": "380240"
  },
  {
    "text": "container prefix which is actually what",
    "start": "380240",
    "end": "382319"
  },
  {
    "text": "we want and what we are looking for",
    "start": "382319",
    "end": "384960"
  },
  {
    "text": "So let's get back to",
    "start": "384960",
    "end": "386520"
  },
  {
    "text": "this So now we have like one more",
    "start": "386520",
    "end": "388880"
  },
  {
    "text": "conclusion Um the container memory",
    "start": "388880",
    "end": "391360"
  },
  {
    "text": "working set bytes it it it comes from C",
    "start": "391360",
    "end": "393680"
  },
  {
    "text": "advisor inside cublet But",
    "start": "393680",
    "end": "395880"
  },
  {
    "text": "um most of you in the room might",
    "start": "395880",
    "end": "398160"
  },
  {
    "text": "actually wonder like what what is C",
    "start": "398160",
    "end": "399600"
  },
  {
    "text": "advisor what is it running inside of",
    "start": "399600",
    "end": "401199"
  },
  {
    "text": "cublet so let's let's try to understand",
    "start": "401199",
    "end": "404000"
  },
  {
    "text": "that further",
    "start": "404000",
    "end": "406039"
  },
  {
    "text": "Um so uh C advisor it's the project on",
    "start": "406039",
    "end": "409759"
  },
  {
    "text": "the left Um this is basically uh a",
    "start": "409759",
    "end": "414160"
  },
  {
    "text": "utility for you to analyze and",
    "start": "414160",
    "end": "416080"
  },
  {
    "text": "understand the resource usage of your",
    "start": "416080",
    "end": "418080"
  },
  {
    "text": "containers in a cluster or in a cluster",
    "start": "418080",
    "end": "420240"
  },
  {
    "text": "on just like the on the node sorry and",
    "start": "420240",
    "end": "423440"
  },
  {
    "text": "uh I wanted to mention runc here because",
    "start": "423440",
    "end": "426080"
  },
  {
    "text": "pretty much all the underlying technical",
    "start": "426080",
    "end": "428560"
  },
  {
    "text": "implementation of C advisor is relying",
    "start": "428560",
    "end": "430560"
  },
  {
    "text": "on run lips container which is the go",
    "start": "430560",
    "end": "434400"
  },
  {
    "text": "pure uh pure go implementation uh for",
    "start": "434400",
    "end": "437440"
  },
  {
    "text": "interacting with containers on um uh in",
    "start": "437440",
    "end": "440960"
  },
  {
    "text": "the cubernetes world it's used by",
    "start": "440960",
    "end": "442560"
  },
  {
    "text": "containerd it's used by cryo etc etc so",
    "start": "442560",
    "end": "446199"
  },
  {
    "text": "yeah and uh how how how does this work",
    "start": "446199",
    "end": "449599"
  },
  {
    "text": "now like how is my uh container memory",
    "start": "449599",
    "end": "452400"
  },
  {
    "text": "working set bytes computed by the C",
    "start": "452400",
    "end": "454240"
  },
  {
    "text": "advisor thingy so uh let's try to make",
    "start": "454240",
    "end": "457520"
  },
  {
    "text": "sense of this diagram um it's a pretty",
    "start": "457520",
    "end": "460800"
  },
  {
    "text": "big diagram I will try to walk you",
    "start": "460800",
    "end": "462319"
  },
  {
    "text": "through it so it it all starts with this",
    "start": "462319",
    "end": "464960"
  },
  {
    "text": "get stat method that is called inside of",
    "start": "464960",
    "end": "467280"
  },
  {
    "text": "the C advisor code right and Just after",
    "start": "467280",
    "end": "470880"
  },
  {
    "text": "this thing it calls this croup manager",
    "start": "470880",
    "end": "473199"
  },
  {
    "text": "get stats and it it calls this get stats",
    "start": "473199",
    "end": "475599"
  },
  {
    "text": "that is on the right So now we are like",
    "start": "475599",
    "end": "477599"
  },
  {
    "text": "jumping into run cip containers code and",
    "start": "477599",
    "end": "480720"
  },
  {
    "text": "uh we are executing in the package that",
    "start": "480720",
    "end": "483360"
  },
  {
    "text": "is called croup and you can see here",
    "start": "483360",
    "end": "486080"
  },
  {
    "text": "that we are trying to retrieve stats",
    "start": "486080",
    "end": "488639"
  },
  {
    "text": "from this thing called croups uh",
    "start": "488639",
    "end": "491280"
  },
  {
    "text": "apparently they come in two flavors",
    "start": "491280",
    "end": "492800"
  },
  {
    "text": "right they have like croups v1 and",
    "start": "492800",
    "end": "494319"
  },
  {
    "text": "croups v2 and depending on the version",
    "start": "494319",
    "end": "497199"
  },
  {
    "text": "uh lip container is doing like slightly",
    "start": "497199",
    "end": "499039"
  },
  {
    "text": "different things and you can see at the",
    "start": "499039",
    "end": "501120"
  },
  {
    "text": "bottom that we have uh for",
    "start": "501120",
    "end": "503080"
  },
  {
    "text": "example different name for similar",
    "start": "503080",
    "end": "506240"
  },
  {
    "text": "metrics uh it's reading memory usage in",
    "start": "506240",
    "end": "509520"
  },
  {
    "text": "bytes for croup v1 on one side and on",
    "start": "509520",
    "end": "511919"
  },
  {
    "text": "the other side it's reading memory",
    "start": "511919",
    "end": "513360"
  },
  {
    "text": "current and other statistics so all",
    "start": "513360",
    "end": "515760"
  },
  {
    "text": "these stats are collected thanks to the",
    "start": "515760",
    "end": "518560"
  },
  {
    "text": "uh lib container croup package and",
    "start": "518560",
    "end": "520640"
  },
  {
    "text": "return to the uh C advisor code and then",
    "start": "520640",
    "end": "524399"
  },
  {
    "text": "eventually they reach this uh set memory",
    "start": "524399",
    "end": "528320"
  },
  {
    "text": "stats",
    "start": "528320",
    "end": "529880"
  },
  {
    "text": "function and uh this is the actual",
    "start": "529880",
    "end": "532480"
  },
  {
    "text": "function that will produce the metrics",
    "start": "532480",
    "end": "534000"
  },
  {
    "text": "we have been looking for since the",
    "start": "534000",
    "end": "535600"
  },
  {
    "text": "beginning So let's let's take a look at",
    "start": "535600",
    "end": "537600"
  },
  {
    "text": "the code Um the the code like the",
    "start": "537600",
    "end": "540880"
  },
  {
    "text": "simplification looks like that Uh it's",
    "start": "540880",
    "end": "543680"
  },
  {
    "text": "it's fairly straightforward in some",
    "start": "543680",
    "end": "545600"
  },
  {
    "text": "sense It's retrieving the usage we've",
    "start": "545600",
    "end": "547920"
  },
  {
    "text": "been seeing in the slide before So usage",
    "start": "547920",
    "end": "549920"
  },
  {
    "text": "invite for V1 and current for V2 And",
    "start": "549920",
    "end": "553279"
  },
  {
    "text": "then it's retrieving something else",
    "start": "553279",
    "end": "554640"
  },
  {
    "text": "which is called total inactive file in",
    "start": "554640",
    "end": "557519"
  },
  {
    "text": "the case of V1 and inactive files in the",
    "start": "557519",
    "end": "559600"
  },
  {
    "text": "case of V2 And then it just does like",
    "start": "559600",
    "end": "562240"
  },
  {
    "text": "this substraction Very simple code like",
    "start": "562240",
    "end": "564320"
  },
  {
    "text": "the working set is basically the usage",
    "start": "564320",
    "end": "566880"
  },
  {
    "text": "minus the inactive file thingy And we",
    "start": "566880",
    "end": "570800"
  },
  {
    "text": "can recap this with that So it's like",
    "start": "570800",
    "end": "572560"
  },
  {
    "text": "kind of the max between zero and this It",
    "start": "572560",
    "end": "574800"
  },
  {
    "text": "can be negative of course like we can",
    "start": "574800",
    "end": "576160"
  },
  {
    "text": "have like negative memory usage",
    "start": "576160",
    "end": "577600"
  },
  {
    "text": "unfortunately and and for V1 we have",
    "start": "577600",
    "end": "580480"
  },
  {
    "text": "like memory usage in bytes minus this",
    "start": "580480",
    "end": "582480"
  },
  {
    "text": "total inactive file and for V2 we have",
    "start": "582480",
    "end": "585120"
  },
  {
    "text": "current minus inactive file So right",
    "start": "585120",
    "end": "589080"
  },
  {
    "text": "great now we know that but um we know",
    "start": "589080",
    "end": "593040"
  },
  {
    "text": "that say advisor computes this uh metric",
    "start": "593040",
    "end": "595920"
  },
  {
    "text": "from this stat from this croup using",
    "start": "595920",
    "end": "598720"
  },
  {
    "text": "this current minus inactive file but",
    "start": "598720",
    "end": "600880"
  },
  {
    "text": "what is these things about like what is",
    "start": "600880",
    "end": "602560"
  },
  {
    "text": "this uh current stat about what is this",
    "start": "602560",
    "end": "605600"
  },
  {
    "text": "inactive file about and what is a croup",
    "start": "605600",
    "end": "608160"
  },
  {
    "text": "right",
    "start": "608160",
    "end": "609680"
  },
  {
    "text": "uh so here is a wall of",
    "start": "609680",
    "end": "612040"
  },
  {
    "text": "text please don't read that's just like",
    "start": "612040",
    "end": "614320"
  },
  {
    "text": "as an illustration purpose it's the",
    "start": "614320",
    "end": "616959"
  },
  {
    "text": "Linux man page for croups But what I",
    "start": "616959",
    "end": "620399"
  },
  {
    "text": "wanted to uh explain here is that",
    "start": "620399",
    "end": "623680"
  },
  {
    "text": "containers are not like a C group Linux",
    "start": "623680",
    "end": "626480"
  },
  {
    "text": "uh concept right they are not like the",
    "start": "626480",
    "end": "628079"
  },
  {
    "text": "OS concept And for creating containers",
    "start": "628079",
    "end": "630800"
  },
  {
    "text": "on the OS we used various systems like",
    "start": "630800",
    "end": "633519"
  },
  {
    "text": "uh namespaces C groupoups and other",
    "start": "633519",
    "end": "636880"
  },
  {
    "text": "systems Actually name spaces on one side",
    "start": "636880",
    "end": "639760"
  },
  {
    "text": "are for like isolating the process with",
    "start": "639760",
    "end": "642240"
  },
  {
    "text": "the the rest of the computer like uh you",
    "start": "642240",
    "end": "644959"
  },
  {
    "text": "can create like a network C groupoup and",
    "start": "644959",
    "end": "646640"
  },
  {
    "text": "the process will have its own vision of",
    "start": "646640",
    "end": "648800"
  },
  {
    "text": "the networking or you can create like a",
    "start": "648800",
    "end": "651120"
  },
  {
    "text": "process croup and the process will think",
    "start": "651120",
    "end": "653200"
  },
  {
    "text": "it's the only one running plus the other",
    "start": "653200",
    "end": "655279"
  },
  {
    "text": "process running inside its container",
    "start": "655279",
    "end": "657760"
  },
  {
    "text": "Well it's not true But on the other side",
    "start": "657760",
    "end": "660399"
  },
  {
    "text": "you have like croups and cgroups are",
    "start": "660399",
    "end": "662399"
  },
  {
    "text": "mostly to restrict the usage of",
    "start": "662399",
    "end": "665600"
  },
  {
    "text": "resources on the system So you can have",
    "start": "665600",
    "end": "668000"
  },
  {
    "text": "like CPU CRPS so to restrict the CPU",
    "start": "668000",
    "end": "672800"
  },
  {
    "text": "usage So basically the idea is you you",
    "start": "672800",
    "end": "675200"
  },
  {
    "text": "want to see how much CPU you're using",
    "start": "675200",
    "end": "677040"
  },
  {
    "text": "and maybe you want to restrict like say",
    "start": "677040",
    "end": "679440"
  },
  {
    "text": "I don't want this process to consume",
    "start": "679440",
    "end": "680800"
  },
  {
    "text": "100% of my CPU and then you have like",
    "start": "680800",
    "end": "683760"
  },
  {
    "text": "the memory uh croup So this is the one",
    "start": "683760",
    "end": "686240"
  },
  {
    "text": "we are going to be interested uh now and",
    "start": "686240",
    "end": "690079"
  },
  {
    "text": "the idea here is to retrieve a number of",
    "start": "690079",
    "end": "692880"
  },
  {
    "text": "information from the the memory usage on",
    "start": "692880",
    "end": "695440"
  },
  {
    "text": "the OS from this croup and also like",
    "start": "695440",
    "end": "698480"
  },
  {
    "text": "enforce uh memory limits uh maximum and",
    "start": "698480",
    "end": "704000"
  },
  {
    "text": "minimum All right Um so Kubernetes they",
    "start": "704920",
    "end": "709600"
  },
  {
    "text": "they use Cgroups uh basically when it's",
    "start": "709600",
    "end": "712000"
  },
  {
    "text": "starting a container is talking with the",
    "start": "712000",
    "end": "713600"
  },
  {
    "text": "cublet which is talking to the container",
    "start": "713600",
    "end": "715640"
  },
  {
    "text": "runtime which is creating uh some",
    "start": "715640",
    "end": "718160"
  },
  {
    "text": "cluster",
    "start": "718160",
    "end": "719160"
  },
  {
    "text": "and they have this abstraction of",
    "start": "719160",
    "end": "721680"
  },
  {
    "text": "quality of service classes So you you",
    "start": "721680",
    "end": "723600"
  },
  {
    "text": "may have never seen this kind of quality",
    "start": "723600",
    "end": "726320"
  },
  {
    "text": "of service thing but you uh may have",
    "start": "726320",
    "end": "728720"
  },
  {
    "text": "interacted with them without knowing",
    "start": "728720",
    "end": "730240"
  },
  {
    "text": "because you have like three main service",
    "start": "730240",
    "end": "732480"
  },
  {
    "text": "classes guaranteed bustable and best",
    "start": "732480",
    "end": "734560"
  },
  {
    "text": "effort and those are actually related to",
    "start": "734560",
    "end": "737200"
  },
  {
    "text": "the way you set limits and requests on",
    "start": "737200",
    "end": "740000"
  },
  {
    "text": "your workloads So when you don't set",
    "start": "740000",
    "end": "742240"
  },
  {
    "text": "anything like like most most of the time",
    "start": "742240",
    "end": "746160"
  },
  {
    "text": "it's it's just like best effort It's",
    "start": "746160",
    "end": "748000"
  },
  {
    "text": "going to be like in this category uh",
    "start": "748000",
    "end": "750079"
  },
  {
    "text": "when you set like uh one request and a",
    "start": "750079",
    "end": "752240"
  },
  {
    "text": "limit that is above the request or no",
    "start": "752240",
    "end": "754560"
  },
  {
    "text": "limits it it's going to be in bustable",
    "start": "754560",
    "end": "757120"
  },
  {
    "text": "and if you set a limit that is equal to",
    "start": "757120",
    "end": "759200"
  },
  {
    "text": "the request it will be warranted So",
    "start": "759200",
    "end": "761519"
  },
  {
    "text": "Kubernetes uses this concept using the",
    "start": "761519",
    "end": "764240"
  },
  {
    "text": "memory limit and request to kind of",
    "start": "764240",
    "end": "766000"
  },
  {
    "text": "classify the different",
    "start": "766000",
    "end": "768519"
  },
  {
    "text": "workloads and this uh will make sense",
    "start": "768519",
    "end": "772240"
  },
  {
    "text": "because it will uh Kubernetes will use",
    "start": "772240",
    "end": "775040"
  },
  {
    "text": "this concept of quality of service",
    "start": "775040",
    "end": "776720"
  },
  {
    "text": "classes to um tune certain settings uh",
    "start": "776720",
    "end": "780240"
  },
  {
    "text": "in inside of the croups So this is",
    "start": "780240",
    "end": "783920"
  },
  {
    "text": "another concept So the out of memory",
    "start": "783920",
    "end": "786639"
  },
  {
    "text": "killer you may be familiar with this one",
    "start": "786639",
    "end": "789120"
  },
  {
    "text": "because it may have killed your",
    "start": "789120",
    "end": "790720"
  },
  {
    "text": "containers in the past Uh again this is",
    "start": "790720",
    "end": "793920"
  },
  {
    "text": "like a Linux concept This is like an OS",
    "start": "793920",
    "end": "795760"
  },
  {
    "text": "concept It's not aware of containers in",
    "start": "795760",
    "end": "797600"
  },
  {
    "text": "this case And uh what what happens on",
    "start": "797600",
    "end": "800959"
  },
  {
    "text": "the system when it cannot reclaim any",
    "start": "800959",
    "end": "803040"
  },
  {
    "text": "more memory it needs to pick uh one of",
    "start": "803040",
    "end": "806480"
  },
  {
    "text": "the process to actually terminate that",
    "start": "806480",
    "end": "809120"
  },
  {
    "text": "process and get back some memory So the",
    "start": "809120",
    "end": "812320"
  },
  {
    "text": "whole uh challenge here is to actually",
    "start": "812320",
    "end": "814320"
  },
  {
    "text": "pick the right uh process So Kubernetes",
    "start": "814320",
    "end": "818480"
  },
  {
    "text": "Kubernetes uses like this quality of",
    "start": "818480",
    "end": "820480"
  },
  {
    "text": "service to choose like the score it's",
    "start": "820480",
    "end": "822560"
  },
  {
    "text": "going to assign on each um of the",
    "start": "822560",
    "end": "825920"
  },
  {
    "text": "containers So the idea being here is",
    "start": "825920",
    "end": "828800"
  },
  {
    "text": "that like guaranteed will be a lower",
    "start": "828800",
    "end": "830880"
  },
  {
    "text": "score than best effort and in between",
    "start": "830880",
    "end": "833279"
  },
  {
    "text": "will be burstable and um uh the idea",
    "start": "833279",
    "end": "836639"
  },
  {
    "text": "being is that the out of memory killer",
    "start": "836639",
    "end": "838480"
  },
  {
    "text": "will target a best effort port before a",
    "start": "838480",
    "end": "841040"
  },
  {
    "text": "burstable port and before a guaranteed",
    "start": "841040",
    "end": "842920"
  },
  {
    "text": "port Um yeah I just wanted to make a",
    "start": "842920",
    "end": "846320"
  },
  {
    "text": "notes aside as well to show you like the",
    "start": "846320",
    "end": "848399"
  },
  {
    "text": "kind of quirks that can happen between",
    "start": "848399",
    "end": "849920"
  },
  {
    "text": "the Kubernetes world and the OS world",
    "start": "849920",
    "end": "852320"
  },
  {
    "text": "like like for example again the out of",
    "start": "852320",
    "end": "854160"
  },
  {
    "text": "memory killer is not really aware of the",
    "start": "854160",
    "end": "856240"
  },
  {
    "text": "containers concept So when it's picking",
    "start": "856240",
    "end": "858320"
  },
  {
    "text": "a process to kill it doesn't know if",
    "start": "858320",
    "end": "860320"
  },
  {
    "text": "it's like uh the main process of a",
    "start": "860320",
    "end": "862959"
  },
  {
    "text": "container or not So you can end up in",
    "start": "862959",
    "end": "864480"
  },
  {
    "text": "this weird situation where like the out",
    "start": "864480",
    "end": "866079"
  },
  {
    "text": "of memory killer is like killing process",
    "start": "866079",
    "end": "868480"
  },
  {
    "text": "two in your container and Kubernetes",
    "start": "868480",
    "end": "871279"
  },
  {
    "text": "still sees that or cublet still sees",
    "start": "871279",
    "end": "873680"
  },
  {
    "text": "that the process one is running and ly",
    "start": "873680",
    "end": "876000"
  },
  {
    "text": "so it doesn't do anything So you can end",
    "start": "876000",
    "end": "877839"
  },
  {
    "text": "up in this kind of weird situation So",
    "start": "877839",
    "end": "880519"
  },
  {
    "text": "yeah anyway what we had here is that uh",
    "start": "880519",
    "end": "884160"
  },
  {
    "text": "we use these croups to kind of classify",
    "start": "884160",
    "end": "886480"
  },
  {
    "text": "our containers and to like tune these",
    "start": "886480",
    "end": "890000"
  },
  {
    "text": "kind of settings and how it's actually",
    "start": "890000",
    "end": "892320"
  },
  {
    "text": "done in in reality the interface between",
    "start": "892320",
    "end": "896000"
  },
  {
    "text": "uh the OS and uh uh the Kel and the user",
    "start": "896000",
    "end": "899760"
  },
  {
    "text": "space for C groupoups is using uh a file",
    "start": "899760",
    "end": "902639"
  },
  {
    "text": "system and all the C groupoups they can",
    "start": "902639",
    "end": "905120"
  },
  {
    "text": "be represented in this uh file system",
    "start": "905120",
    "end": "907199"
  },
  {
    "text": "thingy here we'll use like the systemd",
    "start": "907199",
    "end": "908880"
  },
  {
    "text": "terminology with the slice and the scope",
    "start": "908880",
    "end": "911320"
  },
  {
    "text": "thingy and and what you see here is that",
    "start": "911320",
    "end": "914000"
  },
  {
    "text": "you have like at the very top you have",
    "start": "914000",
    "end": "915519"
  },
  {
    "text": "the root um cgroups So these croups uh",
    "start": "915519",
    "end": "919519"
  },
  {
    "text": "contains all the process on your",
    "start": "919519",
    "end": "921600"
  },
  {
    "text": "computer So you will see the statistics",
    "start": "921600",
    "end": "923600"
  },
  {
    "text": "about memory from all the process",
    "start": "923600",
    "end": "925120"
  },
  {
    "text": "running on your computer and you can",
    "start": "925120",
    "end": "926720"
  },
  {
    "text": "adjust uh settings on all the process",
    "start": "926720",
    "end": "930320"
  },
  {
    "text": "and then uh for in the case of",
    "start": "930320",
    "end": "931839"
  },
  {
    "text": "Kubernetes you will have like this cube",
    "start": "931839",
    "end": "933279"
  },
  {
    "text": "pods thingy and and here you can see why",
    "start": "933279",
    "end": "936000"
  },
  {
    "text": "I try to explain this quality of service",
    "start": "936000",
    "end": "938160"
  },
  {
    "text": "classes is because like they will",
    "start": "938160",
    "end": "940000"
  },
  {
    "text": "manifest themselves as categories in the",
    "start": "940000",
    "end": "942720"
  },
  {
    "text": "cubeot slice So you will have like this",
    "start": "942720",
    "end": "944480"
  },
  {
    "text": "guaranteed best effort and bustable",
    "start": "944480",
    "end": "946639"
  },
  {
    "text": "slice and in each of these slice you",
    "start": "946639",
    "end": "949600"
  },
  {
    "text": "will retrieve all your uh pods So I I I",
    "start": "949600",
    "end": "953120"
  },
  {
    "text": "picked the best effort in my case and I",
    "start": "953120",
    "end": "955040"
  },
  {
    "text": "I put like two pods and you have like",
    "start": "955040",
    "end": "957279"
  },
  {
    "text": "pod on the left uh and pod on the right",
    "start": "957279",
    "end": "960079"
  },
  {
    "text": "and the pod on the left I added like",
    "start": "960079",
    "end": "962480"
  },
  {
    "text": "much more details and you can see the",
    "start": "962480",
    "end": "964959"
  },
  {
    "text": "container like the the scope that is",
    "start": "964959",
    "end": "966800"
  },
  {
    "text": "representing the container which is at",
    "start": "966800",
    "end": "968320"
  },
  {
    "text": "the the very end of this graph So it's",
    "start": "968320",
    "end": "970399"
  },
  {
    "text": "like a leaf on this graph Uh I put",
    "start": "970399",
    "end": "974079"
  },
  {
    "text": "container ID or docker It depends on the",
    "start": "974079",
    "end": "976480"
  },
  {
    "text": "uh container runtime that you use The",
    "start": "976480",
    "end": "978959"
  },
  {
    "text": "name will change but uh anyway if we",
    "start": "978959",
    "end": "982560"
  },
  {
    "text": "zoom in this thing because we are",
    "start": "982560",
    "end": "984480"
  },
  {
    "text": "interested about memory",
    "start": "984480",
    "end": "987199"
  },
  {
    "text": "uh we will see that for memory So a",
    "start": "987199",
    "end": "989759"
  },
  {
    "text": "bunch of files um some of them are read",
    "start": "989759",
    "end": "993120"
  },
  {
    "text": "only some of them are write and read and",
    "start": "993120",
    "end": "996000"
  },
  {
    "text": "only write So the idea again is that uh",
    "start": "996000",
    "end": "999360"
  },
  {
    "text": "the kernel will expose uh some",
    "start": "999360",
    "end": "1001759"
  },
  {
    "text": "statistics through these read only files",
    "start": "1001759",
    "end": "1004639"
  },
  {
    "text": "and uh you can also again set a memory",
    "start": "1004639",
    "end": "1007600"
  },
  {
    "text": "max a memory mean some kind of",
    "start": "1007600",
    "end": "1009440"
  },
  {
    "text": "boundaries to ask for the kernel to",
    "start": "1009440",
    "end": "1012240"
  },
  {
    "text": "enforce those things for you and um the",
    "start": "1012240",
    "end": "1014959"
  },
  {
    "text": "thing we are interested about is the",
    "start": "1014959",
    "end": "1016800"
  },
  {
    "text": "memory current So this is like the thing",
    "start": "1016800",
    "end": "1018639"
  },
  {
    "text": "you've been seeing in the code like just",
    "start": "1018639",
    "end": "1020480"
  },
  {
    "text": "before uh it's just a number So this is",
    "start": "1020480",
    "end": "1023440"
  },
  {
    "text": "pretty much uh the total of memory that",
    "start": "1023440",
    "end": "1025839"
  },
  {
    "text": "is used by these uh croups So all the",
    "start": "1025839",
    "end": "1029280"
  },
  {
    "text": "process belonging to these croups and",
    "start": "1029280",
    "end": "1032480"
  },
  {
    "text": "you have this thing called memory stats",
    "start": "1032480",
    "end": "1034160"
  },
  {
    "text": "which contains a much more details",
    "start": "1034160",
    "end": "1036160"
  },
  {
    "text": "breakdown of all the memory usage So you",
    "start": "1036160",
    "end": "1038319"
  },
  {
    "text": "have the anonymous file kernel which",
    "start": "1038319",
    "end": "1040240"
  },
  {
    "text": "should like um uh addition to this kind",
    "start": "1040240",
    "end": "1043600"
  },
  {
    "text": "of total and then you have like a lot of",
    "start": "1043600",
    "end": "1046160"
  },
  {
    "text": "uh different statistics that you can",
    "start": "1046160",
    "end": "1048439"
  },
  {
    "text": "use Um so this is croup v2 by the way uh",
    "start": "1048440",
    "end": "1052559"
  },
  {
    "text": "they have two versions but I I I try to",
    "start": "1052559",
    "end": "1054799"
  },
  {
    "text": "focus on cigar v2 in the in the next",
    "start": "1054799",
    "end": "1057840"
  },
  {
    "text": "slides",
    "start": "1057840",
    "end": "1059880"
  },
  {
    "text": "um and yeah trying to make sense of the",
    "start": "1059880",
    "end": "1063039"
  },
  {
    "text": "statistics you've been seeing before is",
    "start": "1063039",
    "end": "1065200"
  },
  {
    "text": "actually a bit complicated because",
    "start": "1065200",
    "end": "1066559"
  },
  {
    "text": "memory is is is a bit complicated like",
    "start": "1066559",
    "end": "1068720"
  },
  {
    "text": "it has a lot of terminology it is like a",
    "start": "1068720",
    "end": "1071760"
  },
  {
    "text": "very complex uh subsystem into the Linux",
    "start": "1071760",
    "end": "1073919"
  },
  {
    "text": "kernel so today we are going to try to",
    "start": "1073919",
    "end": "1076080"
  },
  {
    "text": "focus on just like a few uh words so",
    "start": "1076080",
    "end": "1080720"
  },
  {
    "text": "just trying to explain a little bit",
    "start": "1080720",
    "end": "1082640"
  },
  {
    "text": "about like main memory virtual memory",
    "start": "1082640",
    "end": "1084240"
  },
  {
    "text": "and overcoming So main memory is could",
    "start": "1084240",
    "end": "1086160"
  },
  {
    "text": "be referred as like your physical memory",
    "start": "1086160",
    "end": "1088640"
  },
  {
    "text": "So the actually fast data storage memory",
    "start": "1088640",
    "end": "1091840"
  },
  {
    "text": "inside of your computer or the random",
    "start": "1091840",
    "end": "1094240"
  },
  {
    "text": "access memory uh um device on your",
    "start": "1094240",
    "end": "1097679"
  },
  {
    "text": "computer and then you have like the",
    "start": "1097679",
    "end": "1099440"
  },
  {
    "text": "virtual memory So virtual memory is this",
    "start": "1099440",
    "end": "1101760"
  },
  {
    "text": "kind of abstraction that we built on top",
    "start": "1101760",
    "end": "1103520"
  },
  {
    "text": "of the main memory the physical memory",
    "start": "1103520",
    "end": "1106600"
  },
  {
    "text": "Um it is",
    "start": "1106600",
    "end": "1109000"
  },
  {
    "text": "uh theoretically it's like an infinite",
    "start": "1109000",
    "end": "1111840"
  },
  {
    "text": "amount of memory possibly it doesn't",
    "start": "1111840",
    "end": "1113760"
  },
  {
    "text": "need to pair with the main memory and uh",
    "start": "1113760",
    "end": "1117039"
  },
  {
    "text": "yeah again keep in mind that like",
    "start": "1117039",
    "end": "1118559"
  },
  {
    "text": "virtual memory is not real memory and",
    "start": "1118559",
    "end": "1120960"
  },
  {
    "text": "that that will explain like the",
    "start": "1120960",
    "end": "1122400"
  },
  {
    "text": "difficulty to map to the physical memory",
    "start": "1122400",
    "end": "1125120"
  },
  {
    "text": "and the overcomit concept So Linux like",
    "start": "1125120",
    "end": "1129360"
  },
  {
    "text": "the the kernel is uh overcommitting",
    "start": "1129360",
    "end": "1131760"
  },
  {
    "text": "memory uh which means that basically uh",
    "start": "1131760",
    "end": "1135600"
  },
  {
    "text": "it will be able to accommodate for as",
    "start": "1135600",
    "end": "1137520"
  },
  {
    "text": "much memory that you want to allocate So",
    "start": "1137520",
    "end": "1140160"
  },
  {
    "text": "if you want to allocate like 1 TB of",
    "start": "1140160",
    "end": "1142000"
  },
  {
    "text": "memory and you only have like uh 8 GB of",
    "start": "1142000",
    "end": "1145200"
  },
  {
    "text": "physical memory in your computer you can",
    "start": "1145200",
    "end": "1146960"
  },
  {
    "text": "allocate that because Linux will",
    "start": "1146960",
    "end": "1149160"
  },
  {
    "text": "overcommit So how does that work let's",
    "start": "1149160",
    "end": "1152000"
  },
  {
    "text": "try to see",
    "start": "1152000",
    "end": "1155400"
  },
  {
    "text": "So I borrowed this diagram from",
    "start": "1157200",
    "end": "1158880"
  },
  {
    "text": "Brendan's Greg systems performance book",
    "start": "1158880",
    "end": "1161600"
  },
  {
    "text": "Very nice book Um and I will try to",
    "start": "1161600",
    "end": "1164480"
  },
  {
    "text": "explain uh a little bit further this",
    "start": "1164480",
    "end": "1166640"
  },
  {
    "text": "concept of virtual and main memory Um",
    "start": "1166640",
    "end": "1169520"
  },
  {
    "text": "try to bear with me So uh when you are",
    "start": "1169520",
    "end": "1172799"
  },
  {
    "text": "writing programs and like running",
    "start": "1172799",
    "end": "1174480"
  },
  {
    "text": "programs you want to allocate uh objects",
    "start": "1174480",
    "end": "1177440"
  },
  {
    "text": "right So if you are using C it could be",
    "start": "1177440",
    "end": "1179600"
  },
  {
    "text": "very explicit like you just use maloc",
    "start": "1179600",
    "end": "1181760"
  },
  {
    "text": "and you allocate like a new object or if",
    "start": "1181760",
    "end": "1183760"
  },
  {
    "text": "you are using like a more modern um",
    "start": "1183760",
    "end": "1187840"
  },
  {
    "text": "language like I don't know like go or I",
    "start": "1187840",
    "end": "1189760"
  },
  {
    "text": "don't like python maybe you will not",
    "start": "1189760",
    "end": "1192000"
  },
  {
    "text": "even realize that you are allocating",
    "start": "1192000",
    "end": "1193760"
  },
  {
    "text": "memory you will just like create new",
    "start": "1193760",
    "end": "1195440"
  },
  {
    "text": "objects and they will be there they will",
    "start": "1195440",
    "end": "1197360"
  },
  {
    "text": "be allocated on the e for you by the",
    "start": "1197360",
    "end": "1199200"
  },
  {
    "text": "runtime but you you might not even",
    "start": "1199200",
    "end": "1200880"
  },
  {
    "text": "realize but anyway when you once you",
    "start": "1200880",
    "end": "1203440"
  },
  {
    "text": "allocate that memory",
    "start": "1203440",
    "end": "1205520"
  },
  {
    "text": "uh it's actually taking uh",
    "start": "1205520",
    "end": "1208080"
  },
  {
    "text": "um it's actually taking no space in the",
    "start": "1208080",
    "end": "1210400"
  },
  {
    "text": "main memory initially when it's",
    "start": "1210400",
    "end": "1212080"
  },
  {
    "text": "completely empty So you can allocate",
    "start": "1212080",
    "end": "1214080"
  },
  {
    "text": "like terabytes and terabytes of object",
    "start": "1214080",
    "end": "1216080"
  },
  {
    "text": "but as soon as you will start to store",
    "start": "1216080",
    "end": "1218559"
  },
  {
    "text": "in this memory So as soon as you will",
    "start": "1218559",
    "end": "1220320"
  },
  {
    "text": "start to use this memory behind your",
    "start": "1220320",
    "end": "1222559"
  },
  {
    "text": "back the OS what it will do is that it",
    "start": "1222559",
    "end": "1224799"
  },
  {
    "text": "will perform a lookup on this uh memory",
    "start": "1224799",
    "end": "1228159"
  },
  {
    "text": "l virtual memory it will talk to this",
    "start": "1228159",
    "end": "1230159"
  },
  {
    "text": "MMU thingy which is the memory",
    "start": "1230159",
    "end": "1232480"
  },
  {
    "text": "management unit and if the memory is not",
    "start": "1232480",
    "end": "1235280"
  },
  {
    "text": "actually backed by some physical memory",
    "start": "1235280",
    "end": "1237520"
  },
  {
    "text": "it will do something that will call the",
    "start": "1237520",
    "end": "1239120"
  },
  {
    "text": "page fault and it will ask like the MMU",
    "start": "1239120",
    "end": "1242320"
  },
  {
    "text": "to map this uh virtual memory into some",
    "start": "1242320",
    "end": "1245440"
  },
  {
    "text": "actual uh physical",
    "start": "1245440",
    "end": "1247240"
  },
  {
    "text": "memory So at this stage like the fifth",
    "start": "1247240",
    "end": "1250559"
  },
  {
    "text": "uh point your memory will be like",
    "start": "1250559",
    "end": "1252559"
  },
  {
    "text": "allocated and mapped So it will actually",
    "start": "1252559",
    "end": "1254640"
  },
  {
    "text": "at this moment it will like take some",
    "start": "1254640",
    "end": "1256400"
  },
  {
    "text": "space on the physical memory But just to",
    "start": "1256400",
    "end": "1259600"
  },
  {
    "text": "show you like the complexity of this",
    "start": "1259600",
    "end": "1261120"
  },
  {
    "text": "like",
    "start": "1261120",
    "end": "1262200"
  },
  {
    "text": "um uh I mean your your object initially",
    "start": "1262200",
    "end": "1266480"
  },
  {
    "text": "it doesn't mean that your full object",
    "start": "1266480",
    "end": "1268000"
  },
  {
    "text": "has been allocating allocated in the",
    "start": "1268000",
    "end": "1270000"
  },
  {
    "text": "physical memory If your object is huge",
    "start": "1270000",
    "end": "1272159"
  },
  {
    "text": "and the page size so the the minimum",
    "start": "1272159",
    "end": "1274720"
  },
  {
    "text": "units of memory that Linux handle is is",
    "start": "1274720",
    "end": "1277919"
  },
  {
    "text": "smaller you could have just like try to",
    "start": "1277919",
    "end": "1280480"
  },
  {
    "text": "rewrite on like some part of your object",
    "start": "1280480",
    "end": "1282640"
  },
  {
    "text": "and only like a part of your object",
    "start": "1282640",
    "end": "1284159"
  },
  {
    "text": "could reside in actual physical memory",
    "start": "1284159",
    "end": "1286400"
  },
  {
    "text": "So even even there it's actually tricky",
    "start": "1286400",
    "end": "1288080"
  },
  {
    "text": "you you've written to some object you",
    "start": "1288080",
    "end": "1289760"
  },
  {
    "text": "don't know if like everything has",
    "start": "1289760",
    "end": "1291120"
  },
  {
    "text": "impacted your memor memory usage and",
    "start": "1291120",
    "end": "1294320"
  },
  {
    "text": "eventually um if the object that you are",
    "start": "1294320",
    "end": "1298240"
  },
  {
    "text": "using um like the OS thinks that maybe",
    "start": "1298240",
    "end": "1301520"
  },
  {
    "text": "this memory has not been accessed for a",
    "start": "1301520",
    "end": "1303280"
  },
  {
    "text": "while and it's like under memory",
    "start": "1303280",
    "end": "1304640"
  },
  {
    "text": "pressure it might even decide to swap",
    "start": "1304640",
    "end": "1306960"
  },
  {
    "text": "this memory so to take the memory from",
    "start": "1306960",
    "end": "1309280"
  },
  {
    "text": "the random access memory parts like the",
    "start": "1309280",
    "end": "1311840"
  },
  {
    "text": "physical memory and put it on some other",
    "start": "1311840",
    "end": "1313840"
  },
  {
    "text": "device like a slower device like a swap",
    "start": "1313840",
    "end": "1316159"
  },
  {
    "text": "device like a",
    "start": "1316159",
    "end": "1317760"
  },
  {
    "text": "you know so from all the lifetime you",
    "start": "1317760",
    "end": "1321840"
  },
  {
    "text": "you don't really know when it's like",
    "start": "1321840",
    "end": "1323200"
  },
  {
    "text": "impacting the phys the physical memory",
    "start": "1323200",
    "end": "1325360"
  },
  {
    "text": "It's like it's always like an",
    "start": "1325360",
    "end": "1326720"
  },
  {
    "text": "approximation And just to add on top of",
    "start": "1326720",
    "end": "1328880"
  },
  {
    "text": "that um on like accounting memory to",
    "start": "1328880",
    "end": "1332080"
  },
  {
    "text": "process memory can be shared between",
    "start": "1332080",
    "end": "1333919"
  },
  {
    "text": "process If you are using like shared",
    "start": "1333919",
    "end": "1335440"
  },
  {
    "text": "libraries uh memory can be compressed So",
    "start": "1335440",
    "end": "1339520"
  },
  {
    "text": "what it means is that you will need at",
    "start": "1339520",
    "end": "1341360"
  },
  {
    "text": "some point to kind of create some kind",
    "start": "1341360",
    "end": "1343200"
  },
  {
    "text": "of uristic around your memory and and",
    "start": "1343200",
    "end": "1345039"
  },
  {
    "text": "and try to to stick with it",
    "start": "1345039",
    "end": "1347720"
  },
  {
    "text": "Right so this is what we ended up with",
    "start": "1347720",
    "end": "1350159"
  },
  {
    "text": "the C advisor thingy Uh it was using",
    "start": "1350159",
    "end": "1353200"
  },
  {
    "text": "this memory current thingy or usage in",
    "start": "1353200",
    "end": "1355360"
  },
  {
    "text": "bite for v1 and it was substracting this",
    "start": "1355360",
    "end": "1358320"
  },
  {
    "text": "inactive file thing So as I say just",
    "start": "1358320",
    "end": "1361200"
  },
  {
    "text": "before the total memory is like",
    "start": "1361200",
    "end": "1362880"
  },
  {
    "text": "separated into like anonymous memory So",
    "start": "1362880",
    "end": "1364960"
  },
  {
    "text": "typically a heap memory use in your",
    "start": "1364960",
    "end": "1368159"
  },
  {
    "text": "program like allocating objects uh on",
    "start": "1368159",
    "end": "1370799"
  },
  {
    "text": "the heap some files uh it could be files",
    "start": "1370799",
    "end": "1374320"
  },
  {
    "text": "that you used for IO like you've been",
    "start": "1374320",
    "end": "1376240"
  },
  {
    "text": "like uh opening a file at some point and",
    "start": "1376240",
    "end": "1378320"
  },
  {
    "text": "reading from it and kernel which could",
    "start": "1378320",
    "end": "1380400"
  },
  {
    "text": "be like um object related to your",
    "start": "1380400",
    "end": "1383760"
  },
  {
    "text": "process running on the OS like like",
    "start": "1383760",
    "end": "1385520"
  },
  {
    "text": "kernel stack or other things But the",
    "start": "1385520",
    "end": "1388000"
  },
  {
    "text": "thing is like some parts of for example",
    "start": "1388000",
    "end": "1389840"
  },
  {
    "text": "the file uh breakdown of this memory it",
    "start": "1389840",
    "end": "1393840"
  },
  {
    "text": "it could be inactive So if for example",
    "start": "1393840",
    "end": "1396240"
  },
  {
    "text": "your process opens some file at the at",
    "start": "1396240",
    "end": "1398080"
  },
  {
    "text": "the beginning of its lifetime it reads",
    "start": "1398080",
    "end": "1400000"
  },
  {
    "text": "from it and never touches that that file",
    "start": "1400000",
    "end": "1402840"
  },
  {
    "text": "again you might not need that that that",
    "start": "1402840",
    "end": "1406320"
  },
  {
    "text": "like file to be in cache forever Right",
    "start": "1406320",
    "end": "1408480"
  },
  {
    "text": "so you could just like reclaim that",
    "start": "1408480",
    "end": "1410640"
  },
  {
    "text": "memory later on And this is kind of the",
    "start": "1410640",
    "end": "1413120"
  },
  {
    "text": "idea of this number like trying to um um",
    "start": "1413120",
    "end": "1417600"
  },
  {
    "text": "take into account this memory that can",
    "start": "1417600",
    "end": "1419440"
  },
  {
    "text": "be reclaimed before it's actually",
    "start": "1419440",
    "end": "1421600"
  },
  {
    "text": "reclaimed because eventually what will",
    "start": "1421600",
    "end": "1423600"
  },
  {
    "text": "happen is that when the out of memory",
    "start": "1423600",
    "end": "1425520"
  },
  {
    "text": "killer will try",
    "start": "1425520",
    "end": "1427080"
  },
  {
    "text": "to find more memory or before it's",
    "start": "1427080",
    "end": "1429919"
  },
  {
    "text": "actually called it will try to reclaim",
    "start": "1429919",
    "end": "1432159"
  },
  {
    "text": "as much as memory as it can So it will",
    "start": "1432159",
    "end": "1434000"
  },
  {
    "text": "try to reclaim all the memory from the",
    "start": "1434000",
    "end": "1435600"
  },
  {
    "text": "cached file that are no longer used",
    "start": "1435600",
    "end": "1438880"
  },
  {
    "text": "So this is kind of the key key takeaway",
    "start": "1438880",
    "end": "1440960"
  },
  {
    "text": "four Uh so this container memory working",
    "start": "1440960",
    "end": "1443919"
  },
  {
    "text": "set bytes we have been looking since the",
    "start": "1443919",
    "end": "1446280"
  },
  {
    "text": "beginning It's actually the current",
    "start": "1446280",
    "end": "1448480"
  },
  {
    "text": "memory use like the main memory metric",
    "start": "1448480",
    "end": "1450240"
  },
  {
    "text": "from the croup minus the inactive file",
    "start": "1450240",
    "end": "1452159"
  },
  {
    "text": "And it's like a kind of a good enough uh",
    "start": "1452159",
    "end": "1454080"
  },
  {
    "text": "uristic for the actual memory use and",
    "start": "1454080",
    "end": "1455840"
  },
  {
    "text": "what the killer is after And I I hope",
    "start": "1455840",
    "end": "1458400"
  },
  {
    "text": "now you kind of understand why we need",
    "start": "1458400",
    "end": "1460080"
  },
  {
    "text": "like this kind of good enough",
    "start": "1460080",
    "end": "1462520"
  },
  {
    "text": "uristic Um so this is kind of the",
    "start": "1462520",
    "end": "1465440"
  },
  {
    "text": "conclusion like going from the physical",
    "start": "1465440",
    "end": "1467919"
  },
  {
    "text": "to Prometheus again So we have like this",
    "start": "1467919",
    "end": "1470480"
  },
  {
    "text": "main memory it's impacted by the objects",
    "start": "1470480",
    "end": "1474080"
  },
  {
    "text": "that have been like um allocated on the",
    "start": "1474080",
    "end": "1476400"
  },
  {
    "text": "E the files that have been cached the",
    "start": "1476400",
    "end": "1478320"
  },
  {
    "text": "kernel files the kernel uh structures",
    "start": "1478320",
    "end": "1480960"
  },
  {
    "text": "that have been allocated or even like",
    "start": "1480960",
    "end": "1483320"
  },
  {
    "text": "um or even more Yeah you have like this",
    "start": "1483320",
    "end": "1486000"
  },
  {
    "text": "physical memory on the side and the best",
    "start": "1486000",
    "end": "1488559"
  },
  {
    "text": "you can do is using like this memory",
    "start": "1488559",
    "end": "1490480"
  },
  {
    "text": "current uh um stat from the croup So",
    "start": "1490480",
    "end": "1495440"
  },
  {
    "text": "this is like an accounting of this thing",
    "start": "1495440",
    "end": "1498080"
  },
  {
    "text": "So again anonymous memory it can be",
    "start": "1498080",
    "end": "1500159"
  },
  {
    "text": "things on the heap depending on your",
    "start": "1500159",
    "end": "1501919"
  },
  {
    "text": "language you might want to use uh",
    "start": "1501919",
    "end": "1503600"
  },
  {
    "text": "different tooling to understand like how",
    "start": "1503600",
    "end": "1505440"
  },
  {
    "text": "can I reduce like the heap usage on my",
    "start": "1505440",
    "end": "1507760"
  },
  {
    "text": "thing For go for example you can like uh",
    "start": "1507760",
    "end": "1510960"
  },
  {
    "text": "use like go the go me start thingy or",
    "start": "1510960",
    "end": "1513679"
  },
  {
    "text": "you can use like the you can trust like",
    "start": "1513679",
    "end": "1515760"
  },
  {
    "text": "flame graphs on how the memory is used",
    "start": "1515760",
    "end": "1518799"
  },
  {
    "text": "Uh the file uh it will be like the file",
    "start": "1518799",
    "end": "1520960"
  },
  {
    "text": "that you interacted with So the IO",
    "start": "1520960",
    "end": "1522559"
  },
  {
    "text": "you've been doing or just like the",
    "start": "1522559",
    "end": "1524080"
  },
  {
    "text": "binary that has been started as a",
    "start": "1524080",
    "end": "1525600"
  },
  {
    "text": "process that needs to be mapped in",
    "start": "1525600",
    "end": "1526880"
  },
  {
    "text": "memory before starting and the kernel it",
    "start": "1526880",
    "end": "1529760"
  },
  {
    "text": "will be um like as I said kernel",
    "start": "1529760",
    "end": "1531840"
  },
  {
    "text": "structure related to the execution of",
    "start": "1531840",
    "end": "1533200"
  },
  {
    "text": "your process or in the case of",
    "start": "1533200",
    "end": "1534640"
  },
  {
    "text": "tetragonon it could because we are using",
    "start": "1534640",
    "end": "1536880"
  },
  {
    "text": "like this BPF thing So BPF like is a",
    "start": "1536880",
    "end": "1539279"
  },
  {
    "text": "kernel technology and BPF progs they use",
    "start": "1539279",
    "end": "1542480"
  },
  {
    "text": "this thing called BPF maps and the BPF",
    "start": "1542480",
    "end": "1544799"
  },
  {
    "text": "maps for c V2 are accounted like the",
    "start": "1544799",
    "end": "1546960"
  },
  {
    "text": "memory impact of those are accounted in",
    "start": "1546960",
    "end": "1548559"
  },
  {
    "text": "the kernel box here So all of these like",
    "start": "1548559",
    "end": "1552320"
  },
  {
    "text": "compose your container then it's read by",
    "start": "1552320",
    "end": "1554880"
  },
  {
    "text": "it's read by uh C advisor like lib",
    "start": "1554880",
    "end": "1558159"
  },
  {
    "text": "container then C advisor that that",
    "start": "1558159",
    "end": "1559679"
  },
  {
    "text": "comput thing and it's exposed by cublet",
    "start": "1559679",
    "end": "1562320"
  },
  {
    "text": "and then you retrieve that from",
    "start": "1562320",
    "end": "1564440"
  },
  {
    "text": "primitives So yeah in kind of a",
    "start": "1564440",
    "end": "1566799"
  },
  {
    "text": "conclusion um again it's tracked by this",
    "start": "1566799",
    "end": "1569919"
  },
  {
    "text": "thing C advisor again this is a uristic",
    "start": "1569919",
    "end": "1572880"
  },
  {
    "text": "and this is what you you're looking for",
    "start": "1572880",
    "end": "1574960"
  },
  {
    "text": "Uh I just wanted to mention a bunch more",
    "start": "1574960",
    "end": "1577679"
  },
  {
    "text": "things here Uh I found on the",
    "start": "1577679",
    "end": "1579600"
  },
  {
    "text": "communities documentation uh some nice",
    "start": "1579600",
    "end": "1581679"
  },
  {
    "text": "scripts So if you are in a situation",
    "start": "1581679",
    "end": "1584159"
  },
  {
    "text": "where you can't really like dive into",
    "start": "1584159",
    "end": "1585679"
  },
  {
    "text": "the croups and read everything by",
    "start": "1585679",
    "end": "1587200"
  },
  {
    "text": "yourself and do the math by yourself you",
    "start": "1587200",
    "end": "1589279"
  },
  {
    "text": "can use this little scripts that they",
    "start": "1589279",
    "end": "1590640"
  },
  {
    "text": "made uh to check like the main uh C",
    "start": "1590640",
    "end": "1594159"
  },
  {
    "text": "groups and see like the working set byes",
    "start": "1594159",
    "end": "1596240"
  },
  {
    "text": "the inactive files and",
    "start": "1596240",
    "end": "1597880"
  },
  {
    "text": "everything And uh yeah shameless plug I",
    "start": "1597880",
    "end": "1601919"
  },
  {
    "text": "I did like a very small tool So this is",
    "start": "1601919",
    "end": "1603840"
  },
  {
    "text": "very limited It's using lip container",
    "start": "1603840",
    "end": "1605760"
  },
  {
    "text": "like from Reny again And the the goal",
    "start": "1605760",
    "end": "1608799"
  },
  {
    "text": "here was just um to kind of analyze my",
    "start": "1608799",
    "end": "1612720"
  },
  {
    "text": "memory usage without having to start my",
    "start": "1612720",
    "end": "1614960"
  },
  {
    "text": "full stack of like a cubernetes cluster",
    "start": "1614960",
    "end": "1617200"
  },
  {
    "text": "and everything So this little utility",
    "start": "1617200",
    "end": "1619760"
  },
  {
    "text": "what it does is that you can give it uh",
    "start": "1619760",
    "end": "1621919"
  },
  {
    "text": "your program its argument and it will",
    "start": "1621919",
    "end": "1625039"
  },
  {
    "text": "start your process uh as a child put it",
    "start": "1625039",
    "end": "1628400"
  },
  {
    "text": "into like a croup and uh monitor like",
    "start": "1628400",
    "end": "1632480"
  },
  {
    "text": "the the little the little the stats that",
    "start": "1632480",
    "end": "1635840"
  },
  {
    "text": "come from this croup's memory stats and",
    "start": "1635840",
    "end": "1638080"
  },
  {
    "text": "the idea is to print it like regularly a",
    "start": "1638080",
    "end": "1640320"
  },
  {
    "text": "bit like like simulating what we could",
    "start": "1640320",
    "end": "1642480"
  },
  {
    "text": "do with Prometheus and Graphfana trying",
    "start": "1642480",
    "end": "1644559"
  },
  {
    "text": "to see the evolution So this is just",
    "start": "1644559",
    "end": "1646559"
  },
  {
    "text": "like a very small utility but can be",
    "start": "1646559",
    "end": "1648559"
  },
  {
    "text": "helpful if you don't need to like spawn",
    "start": "1648559",
    "end": "1650559"
  },
  {
    "text": "your own entire like cumatus",
    "start": "1650559",
    "end": "1653640"
  },
  {
    "text": "cluster So that's pretty much it for me",
    "start": "1653640",
    "end": "1656320"
  },
  {
    "text": "Uh thank you for joining",
    "start": "1656320",
    "end": "1659480"
  },
  {
    "text": "Um sorry uh I I I put some QR code on",
    "start": "1659480",
    "end": "1663840"
  },
  {
    "text": "the on the thing You can like uh go to",
    "start": "1663840",
    "end": "1666720"
  },
  {
    "text": "see like the the slides I puted the",
    "start": "1666720",
    "end": "1668400"
  },
  {
    "text": "slides online and uh and yeah thank you",
    "start": "1668400",
    "end": "1670799"
  },
  {
    "text": "Thank you for joining",
    "start": "1670799",
    "end": "1674158"
  }
]