[
  {
    "text": "um yeah morning everyone my name is Harry Lee and today I'll be talking about kubernetes on the edge with k3s",
    "start": "780",
    "end": "7980"
  },
  {
    "text": "for a smart metering use case so just a quick introduction about myself I'm the co-founder and CTO at",
    "start": "7980",
    "end": "13980"
  },
  {
    "text": "media AI I've been a devops Enthusiast since I can remember nowadays I help",
    "start": "13980",
    "end": "19260"
  },
  {
    "text": "organizations adopt devops practices and Implement Cloud native Technologies by helping them navigate the cloud native",
    "start": "19260",
    "end": "25260"
  },
  {
    "text": "landscape I've been working with kubernetes for more than five years now I'm also a",
    "start": "25260",
    "end": "30300"
  },
  {
    "text": "certified kubernetes administrator as well as certified kubernetes security specialist",
    "start": "30300",
    "end": "36239"
  },
  {
    "text": "I've been on the cncf Ambassador based in South Africa for three years now I've",
    "start": "36239",
    "end": "42420"
  },
  {
    "text": "also founded the cloud native Computing Meetup in Johannesburg South Africa since four years ago I currently we're",
    "start": "42420",
    "end": "49140"
  },
  {
    "text": "980 members strong still growing you can find us on the cncf community group",
    "start": "49140",
    "end": "54840"
  },
  {
    "text": "I love connecting with Cloud native enthusiasts so yeah if you would like to connect with me yeah follow me on",
    "start": "54840",
    "end": "61559"
  },
  {
    "text": "Twitter as well as LinkedIn so quick two words on Miele Ai and what we do we are an mlops consultancy we",
    "start": "61559",
    "end": "69479"
  },
  {
    "text": "specialize in ml and devops practices helping data science teams build and deploy machine learning Solutions",
    "start": "69479",
    "end": "75900"
  },
  {
    "text": "reliably and efficiently effectively helping them deliver business value as fast as possible and of course we do",
    "start": "75900",
    "end": "83220"
  },
  {
    "text": "everything in a cloud native way if you're interested in finding out more about us check us out at milner.ai and",
    "start": "83220",
    "end": "89820"
  },
  {
    "text": "we do regular posts on our LinkedIn page so if you want to know more about email Ops please follow us on LinkedIn",
    "start": "89820",
    "end": "98579"
  },
  {
    "text": "cool so for this talk I would like to take you on a journey on how we have helped one of our clients build out a",
    "start": "98579",
    "end": "105540"
  },
  {
    "text": "smart metering solution so I'll be focusing on three crucial aspects the product that we're trying to",
    "start": "105540",
    "end": "111180"
  },
  {
    "text": "build the challenges that we faced while we're building this product and the design that ultimately results in our final",
    "start": "111180",
    "end": "117740"
  },
  {
    "text": "delivered solution I'll start off by giving you some context and provide some background into",
    "start": "117740",
    "end": "123540"
  },
  {
    "text": "what our client is trying to build and then I'll go into some of the considerations and",
    "start": "123540",
    "end": "129060"
  },
  {
    "text": "limitations with what they're trying to build and this that becomes requirements",
    "start": "129060",
    "end": "134940"
  },
  {
    "text": "of course and naturally requirements always have a way to become challenges so I'll highlight the four main",
    "start": "134940",
    "end": "140700"
  },
  {
    "text": "challenges that we faced while we're building this product provisioning networking High availability certificate",
    "start": "140700",
    "end": "146340"
  },
  {
    "text": "management these may seem trivial in the cloud environment but on an on-premise",
    "start": "146340",
    "end": "151440"
  },
  {
    "text": "edge setting it's actually proved to be a little bit more involved",
    "start": "151440",
    "end": "156959"
  },
  {
    "text": "the design aspect of the talk will be continuously updated as I go through the challenges and then I'll end off by",
    "start": "156959",
    "end": "163080"
  },
  {
    "text": "showing you the final design that we have implemented so why are we building this",
    "start": "163080",
    "end": "168959"
  },
  {
    "text": "in South Africa we have been facing an energy crisis for the past 15 years where our demand for electricity is far",
    "start": "168959",
    "end": "177000"
  },
  {
    "text": "greater than the supply so our national power generator yescom to tackle this problem Implement",
    "start": "177000",
    "end": "183300"
  },
  {
    "text": "something that we endearingly called load shedding so basically it is just scheduled",
    "start": "183300",
    "end": "189180"
  },
  {
    "text": "rolling blackouts to the National Grid when the load increases",
    "start": "189180",
    "end": "194459"
  },
  {
    "text": "so um we actually sometimes only get like a few days worth of notice before they routinely switch off your power to your",
    "start": "194459",
    "end": "201659"
  },
  {
    "text": "house and recently we actually only get a few hours of notice before they switch it out",
    "start": "201659",
    "end": "207180"
  },
  {
    "text": "so you can imagine the economic impact this has on businesses within South Africa the output of these businesses",
    "start": "207180",
    "end": "213480"
  },
  {
    "text": "decreases right so businesses they rely heavily on electricity such as your",
    "start": "213480",
    "end": "219480"
  },
  {
    "text": "manufacturers as well as the mining industry gets impacted a lot and with a limited supply of electricity drives up",
    "start": "219480",
    "end": "226260"
  },
  {
    "text": "the electricity cost to a point where small businesses actually go out of business",
    "start": "226260",
    "end": "231959"
  },
  {
    "text": "so our client sees this as an opportunity for a smart energy management system",
    "start": "231959",
    "end": "237060"
  },
  {
    "text": "so the aim is to Target big energy consumers such as your office blocks as",
    "start": "237060",
    "end": "243000"
  },
  {
    "text": "well as industrial factories as I mentioned mining industry specifically and the aim is to use iot devices to",
    "start": "243000",
    "end": "250019"
  },
  {
    "text": "measure energy usage from that do some calculation to estimate the costs and then from that optimize electricity",
    "start": "250019",
    "end": "256680"
  },
  {
    "text": "usage with some form of automation and a very good use case of this is to switch off appliances at night when no",
    "start": "256680",
    "end": "263820"
  },
  {
    "text": "one is using them or recommend the best time such as off peak to run various heavy machinery",
    "start": "263820",
    "end": "271259"
  },
  {
    "text": "so why does our client decide to build this and not just buy something off the shelf because iot is really something",
    "start": "271259",
    "end": "277860"
  },
  {
    "text": "that's been trying to tested so one thing to note is that our clients is actually in the hardware manufacturing business their expertise",
    "start": "277860",
    "end": "285120"
  },
  {
    "text": "is in building low-cost Energy Measurement devices so therefore see this as an additional",
    "start": "285120",
    "end": "291120"
  },
  {
    "text": "service offering that they can provide to their existing customers to reduce their energy spending",
    "start": "291120",
    "end": "296580"
  },
  {
    "text": "and from doing this they envisioned that they can capture the inside value chain",
    "start": "296580",
    "end": "301740"
  },
  {
    "text": "so how does it actually work let's say our client's customer could be an office block with multiple offices",
    "start": "301740",
    "end": "309180"
  },
  {
    "text": "there's appliances in each office such as the air conditioner or water heaters maybe there's a lab full of murders the",
    "start": "309180",
    "end": "316259"
  },
  {
    "text": "idea here is to attach iot devices the designed and built by our clients to be",
    "start": "316259",
    "end": "321960"
  },
  {
    "text": "installed on site and on the power supplies of these appliances so the energy consumption can be measured",
    "start": "321960",
    "end": "328020"
  },
  {
    "text": "the data from these RT devices can then be sent to an on-premise Gateway which is also designed to build our clients",
    "start": "328020",
    "end": "334380"
  },
  {
    "text": "the Gateway provides a secure six low-pad Network so for secure communication between iot devices then",
    "start": "334380",
    "end": "341280"
  },
  {
    "text": "the data is then transmitted from the iot devices through the gateway to a central data aggregation platform via",
    "start": "341280",
    "end": "348240"
  },
  {
    "text": "the mqtt protocol the sensor the RT devices provide sense",
    "start": "348240",
    "end": "353400"
  },
  {
    "text": "of data so Telemetry data consisting of measurements such as voltage currents and power and the Gateway just provides",
    "start": "353400",
    "end": "359699"
  },
  {
    "text": "this consistent way to communicate that with the central data aggregation platform",
    "start": "359699",
    "end": "364740"
  },
  {
    "text": "so the data the central data aggregation platform is a way to provide compute that hosts several custom Services built",
    "start": "364740",
    "end": "371759"
  },
  {
    "text": "by separate development teams written in different languages and these Services perform various tasks",
    "start": "371759",
    "end": "377160"
  },
  {
    "text": "ranging from data aggregation and compression to data analysis as well as to as an iot platform to provide web",
    "start": "377160",
    "end": "385080"
  },
  {
    "text": "services that allows end user to control these iot devices",
    "start": "385080",
    "end": "390259"
  },
  {
    "text": "and through the central data aggregation platform the customer is then able to monitor the iot devices on site and",
    "start": "390720",
    "end": "396840"
  },
  {
    "text": "perform some operational tasks such as switching on and off the iot devices as well as generate detailed usage reports",
    "start": "396840",
    "end": "404639"
  },
  {
    "text": "as part of the service offering the central data aggregation platform is also able to be connected to the cloud",
    "start": "404639",
    "end": "410460"
  },
  {
    "text": "to provide Advanced data analytics such as forecasting the energy costs for the current month and long-term data storage",
    "start": "410460",
    "end": "417419"
  },
  {
    "text": "but this is not a requirement for the solution to work since some customers may not want their data to be shared with the cloud as they Envision this",
    "start": "417419",
    "end": "424500"
  },
  {
    "text": "could be some sort of a security and government concern recover this concern",
    "start": "424500",
    "end": "429840"
  },
  {
    "text": "so as you can see there are quite a few components that require different expertise and because of this multiple",
    "start": "429840",
    "end": "435720"
  },
  {
    "text": "teams were brought into this project there's a team focusing on building the iot devices team that's building the",
    "start": "435720",
    "end": "441479"
  },
  {
    "text": "Gateway team that's building the iot platform and a team that's doing their Advanced Data analysis in data analytics",
    "start": "441479",
    "end": "448919"
  },
  {
    "text": "in the cloud so for this talk I will be focusing on the design and implementation details of",
    "start": "448919",
    "end": "454800"
  },
  {
    "text": "the central data aggregation platform so what are some considerations since",
    "start": "454800",
    "end": "460199"
  },
  {
    "text": "we're building a solution that is primarily for companies and Industrial plants it's common for these industrial",
    "start": "460199",
    "end": "466080"
  },
  {
    "text": "plants to be located in rural areas so there are several considerations around infrastructure limitations",
    "start": "466080",
    "end": "473280"
  },
  {
    "text": "first of all instruments and network connectivity between the sites and the public internet is to be expected since",
    "start": "473280",
    "end": "479940"
  },
  {
    "text": "these plants and factories are out in the rural areas they may rely on something like GSM 3G 4G mobile cellular",
    "start": "479940",
    "end": "487620"
  },
  {
    "text": "towers for internet connectivity and we know that it's not the most reliable so this means our solution still needs",
    "start": "487620",
    "end": "494220"
  },
  {
    "text": "to work even when we're offline since we're dependent on mobile networks the data transfer costs must be",
    "start": "494220",
    "end": "501000"
  },
  {
    "text": "considered so you'll become quite expensive if you don't keep it under check this means they wouldn't this means that",
    "start": "501000",
    "end": "507360"
  },
  {
    "text": "we wouldn't be able to continuously stream data into the cloud so our client also wants the flexibility",
    "start": "507360",
    "end": "514140"
  },
  {
    "text": "of moving to another cloud provider in the future with minimal friction so they don't want the solution to be",
    "start": "514140",
    "end": "521399"
  },
  {
    "text": "too coupled with the cloud providers managed services on top of this they also want us to use as many open source",
    "start": "521399",
    "end": "527700"
  },
  {
    "text": "Technologies as possible and this is music to our ears because the screams Cloud native yay",
    "start": "527700",
    "end": "533399"
  },
  {
    "text": "so we perceive that there may be customers who don't really want to be connected to the cloud so they only want",
    "start": "533399",
    "end": "539880"
  },
  {
    "text": "operational components of the solution so in these cases we were treated as an a-gapped installation",
    "start": "539880",
    "end": "546180"
  },
  {
    "text": "so let's zoom in a bit into the site and talk about some considerations there",
    "start": "546180",
    "end": "551519"
  },
  {
    "text": "so similarly inside the customers premises there may be intermittent error",
    "start": "551519",
    "end": "557820"
  },
  {
    "text": "connectivity so our solution needs to ensure that the RT devices and applications are able to",
    "start": "557820",
    "end": "563580"
  },
  {
    "text": "buffer messages when connections is lost so that they can continue to transmit when connection is installed and to",
    "start": "563580",
    "end": "570300"
  },
  {
    "text": "reduce setup costs we would leverage the customer's existing Network infrastructure",
    "start": "570300",
    "end": "575760"
  },
  {
    "text": "which means we wouldn't have full control over it and during power outages due to load",
    "start": "575760",
    "end": "582180"
  },
  {
    "text": "shedding our solution needs to be resilient and continue to work when the power does come back",
    "start": "582180",
    "end": "588300"
  },
  {
    "text": "and since this is an on-premise solution and the customer may not have a server",
    "start": "588300",
    "end": "593519"
  },
  {
    "text": "room let's say the servers are prone to things like Hardware failures due to environmental factors and this could be",
    "start": "593519",
    "end": "599519"
  },
  {
    "text": "dust damage water damage Etc human errors is also quite common such as someone just accidentally unplugging the",
    "start": "599519",
    "end": "605880"
  },
  {
    "text": "power so by adding multiple servers scattered around the premises we reduce the risk",
    "start": "605880",
    "end": "611339"
  },
  {
    "text": "of a single point of failure and this ensures that the iot devices can continuously send data to the central",
    "start": "611339",
    "end": "617160"
  },
  {
    "text": "data aggregation platform of course for customers that have a high risk appetite and don't mind the",
    "start": "617160",
    "end": "623700"
  },
  {
    "text": "downtime in when to save costs we should still provide them with the ability just to install a single server",
    "start": "623700",
    "end": "630000"
  },
  {
    "text": "cool so why kubernetes once we have some clarity about the requirements the first thing that comes",
    "start": "630000",
    "end": "635700"
  },
  {
    "text": "to mind is let's use kubernetes for this of course this is not a hammer and everything is a nail type of situation",
    "start": "635700",
    "end": "642000"
  },
  {
    "text": "kubernetes does bring a lot of benefits to what we're trying to build and here are a few main reasons why we've decided",
    "start": "642000",
    "end": "647940"
  },
  {
    "text": "to go with kubernetes when the power does come back from these power outages kubernetes pods will",
    "start": "647940",
    "end": "654600"
  },
  {
    "text": "continue to run from the previous state since kubernetes is built for resilience",
    "start": "654600",
    "end": "659880"
  },
  {
    "text": "High availability and this needs no introduction we just need to make sure that the kubernetes control plane has a",
    "start": "659880",
    "end": "665399"
  },
  {
    "text": "quorum and kubernetes will do its thing even if we lose another two",
    "start": "665399",
    "end": "670620"
  },
  {
    "text": "since there are multiple development teams working on this product that's using different languages we needed",
    "start": "670620",
    "end": "677160"
  },
  {
    "text": "interoperability and isolation and of course this means containers and what better way to orchestrate containers",
    "start": "677160",
    "end": "683579"
  },
  {
    "text": "than using kubernetes what's also worth mentioning is that the advanced data analytics platform that is",
    "start": "683579",
    "end": "689640"
  },
  {
    "text": "happening in the cloud is also built using kubernetes so we ensure that we have kubernetes in the cloud and",
    "start": "689640",
    "end": "694860"
  },
  {
    "text": "kubernetes on the edge last but not least the ecosystem and cncf is our friend here with the vast",
    "start": "694860",
    "end": "702000"
  },
  {
    "text": "landscape of projects surrounding kubernetes we can incorporate a lot of cncf projects that we know will",
    "start": "702000",
    "end": "707579"
  },
  {
    "text": "naturally support kubernetes and we wouldn't have to worry about compatibility",
    "start": "707579",
    "end": "713100"
  },
  {
    "text": "so now we've decided that we're going to use kubernetes with the vast amount of kubernetes distributions out there which",
    "start": "713100",
    "end": "719519"
  },
  {
    "text": "one should we choose so let's take a step back and look at what we have",
    "start": "719519",
    "end": "725040"
  },
  {
    "text": "um to work with here so the server that our clients has procured is actually Intel Nook Mini PC which has four CPU",
    "start": "725040",
    "end": "732660"
  },
  {
    "text": "cores and eight gigabytes of RAM and 500 gigabytes of SD Storage",
    "start": "732660",
    "end": "738120"
  },
  {
    "text": "so as you can see we're running unlimited resources here so we need a kubernetes distribution that's small",
    "start": "738120",
    "end": "744240"
  },
  {
    "text": "input print and can run on-premise and on the edge so after extensive research AKA Googling",
    "start": "744240",
    "end": "751740"
  },
  {
    "text": "and testing we came down to two options Cube Edge and k3s so both are great projects backed by",
    "start": "751740",
    "end": "758640"
  },
  {
    "text": "cncf with great community support and both are built for Edge use cases so it",
    "start": "758640",
    "end": "763680"
  },
  {
    "text": "was a difficult choice but we ended up choosing k3s so why didn't we go with qbage",
    "start": "763680",
    "end": "770220"
  },
  {
    "text": "the most compelling reason for actually shortlisting Cube Edge was that the architecture diagram that was on the",
    "start": "770220",
    "end": "775620"
  },
  {
    "text": "front page of the GitHub repository was nearly identical to the architectural diagram that we're trying to build",
    "start": "775620",
    "end": "781560"
  },
  {
    "text": "it's got both the cloud and Edge components it's got a built-in mqtt broker which uses Eclipse mosquito and",
    "start": "781560",
    "end": "789120"
  },
  {
    "text": "it's got out of the box ability to sync iot device statuses to the cloud so why don't we choose Cube age",
    "start": "789120",
    "end": "796800"
  },
  {
    "text": "so if you recall that one of the requirements is to actually allow the customers to have an on-premise only",
    "start": "796800",
    "end": "802260"
  },
  {
    "text": "installation so having a cloud counterpart doesn't actually work so Cuba has a way to actually do away",
    "start": "802260",
    "end": "808740"
  },
  {
    "text": "with the cloud console but it proved to be a lot difficult than what it's worth",
    "start": "808740",
    "end": "813779"
  },
  {
    "text": "and since we're not the only team that's working on this project we have to consider other teams that are also involved and because of this we're not",
    "start": "813779",
    "end": "821279"
  },
  {
    "text": "in a position to to dictate how other teams build their solution so the built-in mqtt which uses Eclipse",
    "start": "821279",
    "end": "828600"
  },
  {
    "text": "mosquito um is actually not something that our core messaging team wants they've",
    "start": "828600",
    "end": "834000"
  },
  {
    "text": "already decided that they're going to use rabbit in Q for this and the ability to sync iot device statuses to the cloud our iot platform",
    "start": "834000",
    "end": "841560"
  },
  {
    "text": "team have already decided that they're going to build themselves in the Java application",
    "start": "841560",
    "end": "846779"
  },
  {
    "text": "so this opinionated architecture on how to actually set up an IRC platform isn't",
    "start": "846779",
    "end": "852480"
  },
  {
    "text": "really something that we're looking for since we have so many custom layers so",
    "start": "852480",
    "end": "857519"
  },
  {
    "text": "we needed a kubernetes distribution that is flexible enough so that we can customize it to our needs",
    "start": "857519",
    "end": "863040"
  },
  {
    "text": "so we ended up choosing k3s because it doesn't have an opinionated architecture for an iot use case",
    "start": "863040",
    "end": "869880"
  },
  {
    "text": "what we also like about k3s is that it supports something like a static pod but",
    "start": "869880",
    "end": "874980"
  },
  {
    "text": "with Helm charts so it's got a home chart operator that automatically install Helm transfer you and Helm chart",
    "start": "874980",
    "end": "880019"
  },
  {
    "text": "is the the factor of standard that we're going to use to install applications Within kubernetes and it also supports a single node out",
    "start": "880019",
    "end": "886620"
  },
  {
    "text": "of the box so it gives you the ability to install the control plane as well as the worker node together which is great",
    "start": "886620",
    "end": "892199"
  },
  {
    "text": "for the use case where our customer only wants a single server great so now we have decided that we",
    "start": "892199",
    "end": "897480"
  },
  {
    "text": "want to use k3s what's next we have to install it on the server",
    "start": "897480",
    "end": "902760"
  },
  {
    "text": "so how do we actually install kubernetes on bare metal this comes to our first Challenge provisioning kubernetes and you would",
    "start": "902760",
    "end": "910199"
  },
  {
    "text": "think that it's actually not that difficult right I mean from k3's homepage you just run a single line and the k3s will be installed the real",
    "start": "910199",
    "end": "916680"
  },
  {
    "text": "challenge here is actually to get it installed on the fleet of these Baymeadow servers so first we need an operating system",
    "start": "916680",
    "end": "923519"
  },
  {
    "text": "we've chosen Ubuntu 20.04 and it's just because our clients Engineers are more comfortable with Ubuntu as a",
    "start": "923519",
    "end": "929639"
  },
  {
    "text": "distribution that's any distribution that supports k3s will work here and now it's time to get this operating",
    "start": "929639",
    "end": "935339"
  },
  {
    "text": "system installed on the feet of bare metal servers and we didn't really reinvent the wheel here we've decided to",
    "start": "935339",
    "end": "940980"
  },
  {
    "text": "just go with the normal pixie near booting approach so this is a way to just automatically install operating systems on servers",
    "start": "940980",
    "end": "947880"
  },
  {
    "text": "over a private Network so we set up a private network with a switch and plug in an extra server which",
    "start": "947880",
    "end": "954959"
  },
  {
    "text": "we've named it a provisioner to provide the Pixi net boosting functionality and all figure",
    "start": "954959",
    "end": "960480"
  },
  {
    "text": "next we need to do some configuration management right because now we have to install k3s",
    "start": "960480",
    "end": "965760"
  },
  {
    "text": "for this we've chosen ansible as our configuration management tool it's just because our team is more familiar with",
    "start": "965760",
    "end": "971459"
  },
  {
    "text": "it but any tool such as Chef or puppet will work so we've installed ansible onto the provisional server which",
    "start": "971459",
    "end": "977339"
  },
  {
    "text": "already is configured and attached to the bare mental service and yeah we just ran the table from there",
    "start": "977339",
    "end": "983880"
  },
  {
    "text": "so the tasks that we ran listed here updating and installing operating system packages such as",
    "start": "983880",
    "end": "990420"
  },
  {
    "text": "enabling app armor doing some security settings installing extra packages such as CA certificates",
    "start": "990420",
    "end": "996720"
  },
  {
    "text": "of course installing k3s itself for this we're actually leveraging very popular",
    "start": "996720",
    "end": "1001940"
  },
  {
    "text": "open source projects by pirate Labs it's fantastic it's got sensible out of the box defaults and you can actually get a",
    "start": "1001940",
    "end": "1009440"
  },
  {
    "text": "k3s up and running with minimal configuration so once we have installed k3s we also",
    "start": "1009440",
    "end": "1015620"
  },
  {
    "text": "installed some platform services and this includes services that will support logging and monitoring such as",
    "start": "1015620",
    "end": "1021019"
  },
  {
    "text": "Prometheus grafana as well as fluent bits and then last but not least we",
    "start": "1021019",
    "end": "1026178"
  },
  {
    "text": "needed to generate clients as well as customer specific configurations such as",
    "start": "1026179",
    "end": "1032058"
  },
  {
    "text": "the you know the device list for the iot devices as well as some IP addresses",
    "start": "1032059",
    "end": "1037880"
  },
  {
    "text": "that we need to pre-configure and then we copy them onto these bare metal servers great",
    "start": "1037880",
    "end": "1043520"
  },
  {
    "text": "so let's look at what is at the end of the stage so we've got a kubernetes cluster we've installed some Services we",
    "start": "1043520",
    "end": "1050540"
  },
  {
    "text": "broadly categorize all of the application and services into two categories so the workload services and",
    "start": "1050540",
    "end": "1056780"
  },
  {
    "text": "the platform services the workload Services consist of custom applications that our team has built",
    "start": "1056780",
    "end": "1063020"
  },
  {
    "text": "that serves specific functionalities so over there we've got the iot platform and the RT platform is the brain of the",
    "start": "1063020",
    "end": "1069860"
  },
  {
    "text": "entire operation it allows end users to interact with iot devices view the",
    "start": "1069860",
    "end": "1075020"
  },
  {
    "text": "current energy usage Etc the message service is responsible for data scrubbing compression aggregation",
    "start": "1075020",
    "end": "1082220"
  },
  {
    "text": "and routing the automation service is actually just a group of cron jobs and jobs that is triggered by the other",
    "start": "1082220",
    "end": "1088520"
  },
  {
    "text": "services and last we've got the manager service which is used to bootstrap the entire cluster as well as to ensure that the",
    "start": "1088520",
    "end": "1095539"
  },
  {
    "text": "server is actually in healthy States so the platform Services includes peripheral services such as Prometheus",
    "start": "1095539",
    "end": "1102679"
  },
  {
    "text": "and some of the operators that we have built the operator's job is just to make sure that the services inside the",
    "start": "1102679",
    "end": "1109220"
  },
  {
    "text": "workload category is running in healthy States they're also optional platform services",
    "start": "1109220",
    "end": "1116240"
  },
  {
    "text": "such as the efk stack which is a elasticsearch fluent bid and Cabana as well as other dashboards such as grafana",
    "start": "1116240",
    "end": "1122660"
  },
  {
    "text": "and the kubernetes dashboard the reason these are optional is because of the limited Computing resource we have on",
    "start": "1122660",
    "end": "1130460"
  },
  {
    "text": "our hands so for customers that are willing to purchase a much bigger server so if you recall we are using eight",
    "start": "1130460",
    "end": "1135620"
  },
  {
    "text": "gigabytes of RAM but if they offer the 16 gigabytes of RAM we would then optionally install these for them",
    "start": "1135620",
    "end": "1141140"
  },
  {
    "text": "great now we have all of the components let's see how we should deal with the Ingress traffic coming into our cluster",
    "start": "1141140",
    "end": "1148280"
  },
  {
    "text": "so this comes to our Second Challenge networking so let's revisit how we intend the data",
    "start": "1148280",
    "end": "1154820"
  },
  {
    "text": "to flow from the iot devices into our kubernetes cluster the iot devices send",
    "start": "1154820",
    "end": "1160520"
  },
  {
    "text": "data to the Gateway by the six low-pad Network the Gateway which is connected to the internal Network then Aggregates",
    "start": "1160520",
    "end": "1167299"
  },
  {
    "text": "and sends the data to the rapidmq message broker within our cluster",
    "start": "1167299",
    "end": "1172820"
  },
  {
    "text": "similarly the customer wants to be able to log into the iot platform dashboard to interact with the iot devices",
    "start": "1172820",
    "end": "1179120"
  },
  {
    "text": "but the first challenging the first challenge comes where how do we actually find out where the",
    "start": "1179120",
    "end": "1184760"
  },
  {
    "text": "cluster is and this seems like a problem for service discovery so let's talk about how we would do",
    "start": "1184760",
    "end": "1190640"
  },
  {
    "text": "service Discovery the straightforward answer here is let's just assign a static IP to this Bay middle server",
    "start": "1190640",
    "end": "1196160"
  },
  {
    "text": "right so we'll go to the router we'll find an IP address that's not part of",
    "start": "1196160",
    "end": "1201679"
  },
  {
    "text": "the DHCP server and then we'll reserve it by its Mac address so that's great and all but what if we",
    "start": "1201679",
    "end": "1208340"
  },
  {
    "text": "have a cluster that has multiple nodes now do we do the same thing on the router do we go into router and then configure a static IP address for each",
    "start": "1208340",
    "end": "1215299"
  },
  {
    "text": "node so it's fine for a three node cluster but what if we have a five minute cluster or a seven node cluster",
    "start": "1215299",
    "end": "1221120"
  },
  {
    "text": "so that becomes quite hectic as now you have to send this list back to the Gateway or the end user to make sure",
    "start": "1221120",
    "end": "1228020"
  },
  {
    "text": "that they can do the service discovery and this also begs another question how would failover work in this case",
    "start": "1228020",
    "end": "1234140"
  },
  {
    "text": "all right what if we add a load balancer in front of the cluster because this is what we're doing Cloud right you add a",
    "start": "1234140",
    "end": "1240860"
  },
  {
    "text": "load balancer that the cloud provider provides open up some node ports point the load balance to those node ports and",
    "start": "1240860",
    "end": "1246200"
  },
  {
    "text": "off you go but because we're working on on-premise edge this actually doesn't really work",
    "start": "1246200",
    "end": "1251900"
  },
  {
    "text": "that well because now we have to add an extra server which we can't guarantee High availability and this is actually a",
    "start": "1251900",
    "end": "1258559"
  },
  {
    "text": "single point of failure and now we also have to implement custom Logic for service discovery on this load balancer",
    "start": "1258559",
    "end": "1264500"
  },
  {
    "text": "it's just too much work so we came across something called the metal lb",
    "start": "1264500",
    "end": "1270440"
  },
  {
    "text": "so in order for me to lb to work we basically bringing the external load",
    "start": "1270440",
    "end": "1275539"
  },
  {
    "text": "balances logic into our cluster so first of all we need to make sure that meter RP has an IP address pool so",
    "start": "1275539",
    "end": "1283220"
  },
  {
    "text": "we need to find an IP address range that is not part of the DHCP server can be handed out to the services that",
    "start": "1283220",
    "end": "1289340"
  },
  {
    "text": "require a load balancer type service and metal RB actually allows you to operate in two modes the bgp mode as",
    "start": "1289340",
    "end": "1295640"
  },
  {
    "text": "well as layer 2 mode which is the ARP which is the ARP mode and we've opted for the layer 2 mode because ARP is kind",
    "start": "1295640",
    "end": "1302539"
  },
  {
    "text": "of like a the factor standard for any ethernet Network and remember one of the requirements was that we couldn't make",
    "start": "1302539",
    "end": "1308120"
  },
  {
    "text": "any assumptions on the customers on-premise infrastructure so",
    "start": "1308120",
    "end": "1314600"
  },
  {
    "text": "this may seem like a lot of jargon right let's see how it actually works so",
    "start": "1314600",
    "end": "1319640"
  },
  {
    "text": "imagine we have a three node k3s cluster all right node one node to node three",
    "start": "1319640",
    "end": "1324980"
  },
  {
    "text": "and we've got a router that's running a DHCP server within the range of",
    "start": "1324980",
    "end": "1330220"
  },
  {
    "text": "102.168.1.10 all the way to Dot 200. great and we know this DHCP range",
    "start": "1330220",
    "end": "1336320"
  },
  {
    "text": "beforehand and we decided to find an IP address that's outside of this range let's say we use 0.201",
    "start": "1336320",
    "end": "1342500"
  },
  {
    "text": "so we now configure meta RB by ansible to use.201 as an IP address it's going",
    "start": "1342500",
    "end": "1348559"
  },
  {
    "text": "to grab so when the nodes are connected each of the nodes gets automatically assigned an",
    "start": "1348559",
    "end": "1354679"
  },
  {
    "text": "IP address as part of the CCP range let's say Node 1 gets.11 no 2.12 node 3",
    "start": "1354679",
    "end": "1360039"
  },
  {
    "text": "gets.13 upon starting up metal RB since we've configured it to grab 201 it's",
    "start": "1360039",
    "end": "1366559"
  },
  {
    "text": "going to do so it's going to grab.201 to be the IP address and assign it to node 1. so now we can let all of the",
    "start": "1366559",
    "end": "1374000"
  },
  {
    "text": "other external Services know that you can use 192.168.1.201 to access our cluster",
    "start": "1374000",
    "end": "1381440"
  },
  {
    "text": "cool so when excellent request comes into the router the router sees it sends it to no one",
    "start": "1381440",
    "end": "1386780"
  },
  {
    "text": "so what happens when no one fails right because metal lb is actually installed",
    "start": "1386780",
    "end": "1392059"
  },
  {
    "text": "as a demon sets on all of the nodes it see that no one has failed and then it will actually move that IP address to",
    "start": "1392059",
    "end": "1398600"
  },
  {
    "text": "node two so now we're still going to stick with that 201 we don't have to worry about telling the external",
    "start": "1398600",
    "end": "1404299"
  },
  {
    "text": "Services about this changing IP address great",
    "start": "1404299",
    "end": "1409460"
  },
  {
    "text": "now we've decided to use meter lb as something to control all of our Ingress",
    "start": "1409460",
    "end": "1414620"
  },
  {
    "text": "traffic k3s by default actually comes with its own service load balancer which is",
    "start": "1414620",
    "end": "1420559"
  },
  {
    "text": "called the cclb that's something that we have to disable as well as the Ingress controller that comes defaults with it",
    "start": "1420559",
    "end": "1426679"
  },
  {
    "text": "which is the traffic Ingress controller we also have the disable it in order for meta RV to work",
    "start": "1426679",
    "end": "1432140"
  },
  {
    "text": "cool so now we've addressed installing k3s onto this Bay Mental server we've",
    "start": "1432140",
    "end": "1438200"
  },
  {
    "text": "also addressed how we manage traffic coming into our server so this actually works if we have",
    "start": "1438200",
    "end": "1444980"
  },
  {
    "text": "stateless applications right because when no one fails we move the Pod to node two life goes on everything is",
    "start": "1444980",
    "end": "1451340"
  },
  {
    "text": "great but with this work if we're failing over stateful applications",
    "start": "1451340",
    "end": "1456860"
  },
  {
    "text": "so for Safer applications with k3s by",
    "start": "1456860",
    "end": "1462140"
  },
  {
    "text": "default it comes with raunch's own local path provisioner but this only gives you",
    "start": "1462140",
    "end": "1467240"
  },
  {
    "text": "the ability to create persistent volumes on the current node that the part is provisioned so what happens if that node dies right",
    "start": "1467240",
    "end": "1474620"
  },
  {
    "text": "the Pod can move but the persistent volume wouldn't because personal volume is actually allocated onto the first",
    "start": "1474620",
    "end": "1480440"
  },
  {
    "text": "node so we need a way to also replicate or move that persistent volume to the",
    "start": "1480440",
    "end": "1486200"
  },
  {
    "text": "second node and this is something that we need distributed persistent storage solution for",
    "start": "1486200",
    "end": "1492500"
  },
  {
    "text": "so we started looking for a distributed persistent storage solution the first thing that we came across was",
    "start": "1492500",
    "end": "1498679"
  },
  {
    "text": "Rook just because we've used Rook a few years back it's great it's based on SEF",
    "start": "1498679",
    "end": "1504559"
  },
  {
    "text": "which is a highly scalable distributed storage solution for Block storage object storage and a shared file system",
    "start": "1504559",
    "end": "1509900"
  },
  {
    "text": "it's feature Rich and built for resilience and scale but it's actually a little bit too",
    "start": "1509900",
    "end": "1515720"
  },
  {
    "text": "complex for our current use case because especially for a single node setup you actually have a lot of overhead just to",
    "start": "1515720",
    "end": "1522559"
  },
  {
    "text": "run Rook so we set out so also look for an alternative persistent storage",
    "start": "1522559",
    "end": "1528620"
  },
  {
    "text": "solution Optus um more Googling research and testing we shortlisted yet another true",
    "start": "1528620",
    "end": "1534860"
  },
  {
    "text": "CNC of project Longhorn and open EBS again both are great projects with",
    "start": "1534860",
    "end": "1540679"
  },
  {
    "text": "grades community support and a very good fit for our use case because both are easy to install both supports PB",
    "start": "1540679",
    "end": "1548059"
  },
  {
    "text": "replication which is what we want we wanted to make sure that the PV actually is replicated to another node when the",
    "start": "1548059",
    "end": "1553940"
  },
  {
    "text": "failover happens both supports incremental snapshots great for backup and restoration",
    "start": "1553940",
    "end": "1559520"
  },
  {
    "text": "but in the end through our comparison we still select a long horn why it's just because the only",
    "start": "1559520",
    "end": "1567200"
  },
  {
    "text": "most compelling reason for that is because it's under the Rancher umbrella so K3 is also a Rancher backed project",
    "start": "1567200",
    "end": "1575000"
  },
  {
    "text": "officially supported so we perceive that future upgrades and compatibility will be a lot smoother if we go with Longhorn",
    "start": "1575000",
    "end": "1583400"
  },
  {
    "text": "great so now we have a way to solve our state for application available so now",
    "start": "1583400",
    "end": "1589039"
  },
  {
    "text": "we've added Longhorn into our platform services so now we've installed k3s we've managed",
    "start": "1589039",
    "end": "1595520"
  },
  {
    "text": "traffic coming into our cluster we've managed storage in a distributed and persistent manner how do we actually",
    "start": "1595520",
    "end": "1602299"
  },
  {
    "text": "access these Services securely and this we use something called search",
    "start": "1602299",
    "end": "1608960"
  },
  {
    "text": "manager but before we get into that let's talk about um how the traffic flows through our",
    "start": "1608960",
    "end": "1615620"
  },
  {
    "text": "cluster again so we know that our cluster currently hosts a few web services such as",
    "start": "1615620",
    "end": "1621620"
  },
  {
    "text": "dashboards and the iot platform itself as well as the message broker which uses rabbit in queue so the RC devices when",
    "start": "1621620",
    "end": "1628880"
  },
  {
    "text": "communicating with the Gateway uses the six load pair Network that's fine the Gateway and rot team they've got their",
    "start": "1628880",
    "end": "1635059"
  },
  {
    "text": "own solution to deal with secure communication so that's outside of our jurisdiction what we need to worry about",
    "start": "1635059",
    "end": "1640279"
  },
  {
    "text": "is the communication between the Gateway and our server as well as the user and the server so we have to ensure that we",
    "start": "1640279",
    "end": "1647360"
  },
  {
    "text": "use mqtts which is a secure version of mqtt as well as https secure version of",
    "start": "1647360",
    "end": "1653539"
  },
  {
    "text": "http so the reason why we decided to go with cert manager it's actually there's no",
    "start": "1653539",
    "end": "1659720"
  },
  {
    "text": "other tools out there that's comparable with cert manager inside the cncf landscape so it's kind of de facto tool",
    "start": "1659720",
    "end": "1666740"
  },
  {
    "text": "for any sort of certificate management within kubernetes and we have great successes with it in the past so we",
    "start": "1666740",
    "end": "1672020"
  },
  {
    "text": "didn't look too deep into other alternatives so",
    "start": "1672020",
    "end": "1678080"
  },
  {
    "text": "how do you manage the certificate management sorry how do we manage this issuing of certificates first of all we",
    "start": "1678080",
    "end": "1684440"
  },
  {
    "text": "needed to self-sign a root CA so we created and then we make sure that we store it in a very secure and secret",
    "start": "1684440",
    "end": "1690860"
  },
  {
    "text": "location then from that we create an intermediate CA per customer",
    "start": "1690860",
    "end": "1696200"
  },
  {
    "text": "from that we created another intermediate CA but on a per site or per Factory level",
    "start": "1696200",
    "end": "1701659"
  },
  {
    "text": "and then we move that into media CA into our cluster for sort manager to use as a",
    "start": "1701659",
    "end": "1708620"
  },
  {
    "text": "cluster issue or custom resource great one thing to note is that the creation",
    "start": "1708620",
    "end": "1714140"
  },
  {
    "text": "of the root CA as well as the issuing of the intermediate Cas are handled outside of the cluster handle on organization",
    "start": "1714140",
    "end": "1720380"
  },
  {
    "text": "level and the tool we use for that is hashico bolts but we don't have to get into that the most important thing is",
    "start": "1720380",
    "end": "1725779"
  },
  {
    "text": "the final intermediate CA gets into our cluster and being used by the certificate manager",
    "start": "1725779",
    "end": "1732620"
  },
  {
    "text": "so the certificate manager upon receiving the intermediate CA will do its thing and start issuing leaflet",
    "start": "1732620",
    "end": "1739100"
  },
  {
    "text": "certificates so for https the ones that we need is for example the rabbit mq management portal there needs to be on",
    "start": "1739100",
    "end": "1745460"
  },
  {
    "text": "https because that's how the portal that's how the end user will access rambling Cube kubernetes dashboard",
    "start": "1745460",
    "end": "1751520"
  },
  {
    "text": "Prometheus dashboards grafona dashboards Etc will all use leaflet certificates that's issued by search manager of",
    "start": "1751520",
    "end": "1758240"
  },
  {
    "text": "course our custom workloads also needs to be protected by https on the mqtts friends we use something",
    "start": "1758240",
    "end": "1765380"
  },
  {
    "text": "called Mutual TLS so all of the clients that's actually communicating with rabbitmq including the gateways needs to",
    "start": "1765380",
    "end": "1773000"
  },
  {
    "text": "have a client certificate and soap manager actually allows you to do that so we have a part of the automation",
    "start": "1773000",
    "end": "1778100"
  },
  {
    "text": "process actually tell cert manager to issue client certificates whenever we",
    "start": "1778100",
    "end": "1783320"
  },
  {
    "text": "add an iot device so this comes to our final implementation",
    "start": "1783320",
    "end": "1788600"
  },
  {
    "text": "which is just adding student manager into our platform Services category so now we've got Mr lb managing our",
    "start": "1788600",
    "end": "1795940"
  },
  {
    "text": "services coming into sorry manage traffic coming into our cluster server",
    "start": "1795940",
    "end": "1801200"
  },
  {
    "text": "manager protects the traffic and Longhorn protects the stateful applications that we have",
    "start": "1801200",
    "end": "1807380"
  },
  {
    "text": "and this is a slide of all of the versions that that we're talking about",
    "start": "1807380",
    "end": "1812480"
  },
  {
    "text": "in this talk if you're interested you can have a look at them so in conclusion we've just talked about",
    "start": "1812480",
    "end": "1819380"
  },
  {
    "text": "the product what we actually try to build and the considerations for an on-premise and Edge use case is what",
    "start": "1819380",
    "end": "1826340"
  },
  {
    "text": "we've highlighted we've also talked about how we've implemented the central data aggregation platform using kubernetes and a few cncf projects k3s",
    "start": "1826340",
    "end": "1834440"
  },
  {
    "text": "Longhorn and serve manager metal RB is not a cncf project yet we've also outlined some of the design",
    "start": "1834440",
    "end": "1840620"
  },
  {
    "text": "challenges along the way which is the four main challenges on provisioning networking High availability and",
    "start": "1840620",
    "end": "1846080"
  },
  {
    "text": "certificate Management in a on-premise edge use case so yeah so that's the end of my talk",
    "start": "1846080",
    "end": "1852380"
  },
  {
    "text": "thanks everyone [Applause]",
    "start": "1852380",
    "end": "1860079"
  },
  {
    "text": "awesome um so yeah so if you can please please leave some feedback for me it'll help me",
    "start": "1861140",
    "end": "1866659"
  },
  {
    "text": "a lot in my next talk um that'd be great and yeah happy to take any questions if anyone has any",
    "start": "1866659",
    "end": "1872600"
  },
  {
    "text": "all right there sorry",
    "start": "1872600",
    "end": "1876760"
  },
  {
    "text": "um sorry I can't hear you thank you uh great talk by the way one",
    "start": "1881779",
    "end": "1887419"
  },
  {
    "text": "of the best um how did you deal with Distributing dependencies to the iot",
    "start": "1887419",
    "end": "1892640"
  },
  {
    "text": "devices like when you needed to update Prometheus or something else were you caching them on the provisioning Node or",
    "start": "1892640",
    "end": "1898220"
  },
  {
    "text": "were you just pulling them down from from a network call yeah yeah so because",
    "start": "1898220",
    "end": "1903500"
  },
  {
    "text": "um some customers will have a gapped insulation so over the updates is kind of like not possible so what we do is we",
    "start": "1903500",
    "end": "1910640"
  },
  {
    "text": "actually dispatch a technician who brings the ansible script to the site and they run ansible script to updates",
    "start": "1910640",
    "end": "1916340"
  },
  {
    "text": "or provisioned as iot devices and this includes updates as well as adding and removing devices yeah",
    "start": "1916340",
    "end": "1923299"
  },
  {
    "text": "cool thank you since you disabled traffic what did you use for Ingress yeah so we didn't so",
    "start": "1923299",
    "end": "1929419"
  },
  {
    "text": "basically all the services just have a load balancer type and then that just automatically uh messed up you will see",
    "start": "1929419",
    "end": "1935360"
  },
  {
    "text": "it and automatically assigns the same IP address to all the load balances so the thing is we just have to make sure that",
    "start": "1935360",
    "end": "1941059"
  },
  {
    "text": "the ports don't conflict yeah because we're operating on a sort of like a lower layer not non-layer 7 or anything",
    "start": "1941059",
    "end": "1946820"
  },
  {
    "text": "so we have to just make sure that the ports are in Conflict yeah",
    "start": "1946820",
    "end": "1951700"
  },
  {
    "text": "cool any other questions",
    "start": "1952580",
    "end": "1956559"
  },
  {
    "text": "uh yeah just sort of curiosity really um when you sort of mentioned cncf projects or other cncf projects and uh was a",
    "start": "1965419",
    "end": "1972799"
  },
  {
    "text": "reason why you sort of went down the kubernetes road and not something like Nats um which is a sort of high performance",
    "start": "1972799",
    "end": "1978559"
  },
  {
    "text": "sort of messaging system that's sort of quite suited for something like this so",
    "start": "1978559",
    "end": "1984080"
  },
  {
    "text": "just just curious so the reason why we're going for with kubernetes um is actually because we have a lot of",
    "start": "1984080",
    "end": "1990380"
  },
  {
    "text": "teams that's working on those projects right and then one thing that we said upfronts is that everyone should just",
    "start": "1990380",
    "end": "1996320"
  },
  {
    "text": "use containers just because it's a lot more portable the people who's actually provisioning and installing it don't",
    "start": "1996320",
    "end": "2001840"
  },
  {
    "text": "have to understand like dependencies because you just wrap it up in a Docker image you can deploy it so we just wanted to say something",
    "start": "2001840",
    "end": "2007419"
  },
  {
    "text": "um such as containers and we need something to orchestrate it and that was the only reason why we use kubernetes that's the most compelling reason and",
    "start": "2007419",
    "end": "2013720"
  },
  {
    "text": "then of course there's also other bells and whistles that comes with it such as high availability resiliency Etc yeah",
    "start": "2013720",
    "end": "2019120"
  },
  {
    "text": "but the main reason was the standardization that we needed yeah",
    "start": "2019120",
    "end": "2024120"
  },
  {
    "text": "how much of data you are dealing with the PVS and replications and everything",
    "start": "2031059",
    "end": "2036480"
  },
  {
    "text": "I'm sorry can you please how much of data are you dealing with uh while replicating the volumes and then",
    "start": "2036480",
    "end": "2042519"
  },
  {
    "text": "creating um so it's actually not a lot of data um just because we didn't need a high resolution data from those IC devices so",
    "start": "2042519",
    "end": "2050138"
  },
  {
    "text": "they only transmit once per minute so we're talking about like 23 kilobytes like in a few hours or something so it's",
    "start": "2050139",
    "end": "2056858"
  },
  {
    "text": "like very very small um just because we didn't need like you know per second transmission of it just",
    "start": "2056859",
    "end": "2062320"
  },
  {
    "text": "because that resolution doesn't really mean anything from a controlling perspective as well as a tariff for",
    "start": "2062320",
    "end": "2068200"
  },
  {
    "text": "example when you're actually looking at how energy is measured and costed they do it per hour even sometimes not even",
    "start": "2068200",
    "end": "2074500"
  },
  {
    "text": "that on a per day basis so you don't need a high resolution so we yeah that was it thank you cool thanks",
    "start": "2074500",
    "end": "2083098"
  },
  {
    "text": "like this one",
    "start": "2084879",
    "end": "2087658"
  },
  {
    "text": "hey thanks I don't know if you mentioned this but what about multi-site aggregation of data is that sorry",
    "start": "2091300",
    "end": "2097200"
  },
  {
    "text": "multi-site aggregation so you have customers that may have had multiple physical locations or multiple clusters",
    "start": "2097200",
    "end": "2102880"
  },
  {
    "text": "do you ever did you aggregate that data at a certain level yes yes okay so um there's actually only a single",
    "start": "2102880",
    "end": "2108880"
  },
  {
    "text": "kubernetes cluster in the cloud that all of the customers as well as the sites",
    "start": "2108880",
    "end": "2114700"
  },
  {
    "text": "connect to so it's kind of like a hub and spoke sort of setup so just one big cluster in the cloud and a multiple",
    "start": "2114700",
    "end": "2120460"
  },
  {
    "text": "small cluster all over the place on edge and the reason just for doing that is because we just we didn't want to have a",
    "start": "2120460",
    "end": "2127780"
  },
  {
    "text": "maintenance overhead of maintaining a lot of kubernetes clusters in the cloud so we just have one team that's managing that and that's a setup yeah I don't",
    "start": "2127780",
    "end": "2134920"
  },
  {
    "text": "want to talk about Cloud because this is The Edge talk but yeah",
    "start": "2134920",
    "end": "2138960"
  },
  {
    "text": "okay that's it great thanks everyone [Applause]",
    "start": "2145480",
    "end": "2152350"
  }
]