[
  {
    "text": "awesome thanks everyone for coming um i'm kingdom",
    "start": "80",
    "end": "6720"
  },
  {
    "text": "this is my first time at kubecon in person uh really glad to be here",
    "start": "6720",
    "end": "12160"
  },
  {
    "text": "uh so welcome everyone to the jenkins and git ops talk this is",
    "start": "12160",
    "end": "17920"
  },
  {
    "text": "my first talk at kubecon obviously well in person i've presented a couple of times before",
    "start": "18640",
    "end": "25119"
  },
  {
    "text": "i'm kingdom as i said as taylor introduced me i'm an open source support engineer at weaveworks",
    "start": "25119",
    "end": "31920"
  },
  {
    "text": "i'm also a flux maintainer and i'm the cow on twitter if you want to follow me that would be cool",
    "start": "31920",
    "end": "38640"
  },
  {
    "text": "um so gitops that's what you're all here for i think",
    "start": "38640",
    "end": "44399"
  },
  {
    "text": "first uh we're going to talk really briefly about what is get ops",
    "start": "44399",
    "end": "50399"
  },
  {
    "text": "get ops is an operational model for cloud native operations it's a modern model i think",
    "start": "51680",
    "end": "60000"
  },
  {
    "text": "i meant to say so get ops is",
    "start": "60000",
    "end": "65518"
  },
  {
    "text": "formally defined at this point this should give you an idea of its",
    "start": "65519",
    "end": "70640"
  },
  {
    "text": "maturity we've gone through lots of rounds in a vendor-neutral setting",
    "start": "70640",
    "end": "76640"
  },
  {
    "text": "aws i believe red hat microsoft",
    "start": "76640",
    "end": "82799"
  },
  {
    "text": "a number of companies have participated weave works code fresh to come up with this",
    "start": "82799",
    "end": "89600"
  },
  {
    "text": "definition for get ops and",
    "start": "89600",
    "end": "95439"
  },
  {
    "text": "we think it's pretty solid at this point so it's been made 1.0.0 um that's that's awesome so the",
    "start": "95439",
    "end": "101840"
  },
  {
    "text": "get ops definition is a set of principles um and i want to preface this by saying that this is not",
    "start": "101840",
    "end": "108240"
  },
  {
    "text": "prescriptive or requirements of git ops git ops is uh",
    "start": "108240",
    "end": "114560"
  },
  {
    "text": "a progressive progress you have to process you have to [Music]",
    "start": "114560",
    "end": "120079"
  },
  {
    "text": "take one step before you can uh get all the way there so step one",
    "start": "120079",
    "end": "127600"
  },
  {
    "text": "is understanding uh declarative artifacts you have you already have declarative artifacts if you're like",
    "start": "127600",
    "end": "132959"
  },
  {
    "text": "kubecon great step one out of the way step two is they should be in a",
    "start": "132959",
    "end": "138959"
  },
  {
    "text": "versioned store which is uh holds immutable artifacts so version store",
    "start": "138959",
    "end": "144560"
  },
  {
    "text": "um in this case could be git could be something else uh this is the vendor-neutral definition",
    "start": "144560",
    "end": "151200"
  },
  {
    "text": "so try to be as inclusive as possible and another",
    "start": "151200",
    "end": "157120"
  },
  {
    "text": "guideline of of the gitops principles is that they should be automatically pulled",
    "start": "157120",
    "end": "162239"
  },
  {
    "text": "from your source oops",
    "start": "162239",
    "end": "166160"
  },
  {
    "text": "and it's a continuous reconciling process so so continuous delivery continuous",
    "start": "167360",
    "end": "172959"
  },
  {
    "text": "reconciling you have reconcilers that sit inside of the cluster they pull artifacts and they apply them",
    "start": "172959",
    "end": "179519"
  },
  {
    "text": "to the cluster from a version store in a continuous process and the artifacts are declarative",
    "start": "179519",
    "end": "185680"
  },
  {
    "text": "the git repository should completely describe the state of your system",
    "start": "185680",
    "end": "191120"
  },
  {
    "text": "so that it can be reproduced so okay",
    "start": "191120",
    "end": "197040"
  },
  {
    "text": "back to this talk and why you're here um i i have an idea of who my intended audience is but i",
    "start": "197040",
    "end": "204159"
  },
  {
    "text": "don't know every one of you so i'm not sure if you're all current jenkins users",
    "start": "204159",
    "end": "210000"
  },
  {
    "text": "can we get a show of hands lots of current jenkins users okay great",
    "start": "210000",
    "end": "215120"
  },
  {
    "text": "you're you're my main audience uh so the disclaimer is i've shown i will show in this talk a way to",
    "start": "215120",
    "end": "222319"
  },
  {
    "text": "deploy jenkins um and and this might be better than what you have now um but i cannot take",
    "start": "222319",
    "end": "228480"
  },
  {
    "text": "responsibility for your jenkins infrastructure it's very big we do cd this is i'm here representing",
    "start": "228480",
    "end": "235040"
  },
  {
    "text": "flux i'm here to show you a good way to deploy jenkins and also to",
    "start": "235040",
    "end": "241120"
  },
  {
    "text": "give you a good introduction to git ups and how you can use jenkins with flux",
    "start": "241120",
    "end": "247599"
  },
  {
    "text": "so i'm going to start with uh i don't know how you have jenkins deployed now",
    "start": "247599",
    "end": "253120"
  },
  {
    "text": "but the common use of jenkins is not especially declarative",
    "start": "253120",
    "end": "260479"
  },
  {
    "text": "you have lots of these things their dialogue boxes you gotta click on them and",
    "start": "264000",
    "end": "270080"
  },
  {
    "text": "that's what we're doing away with that's the point of this talk so let's make jenkins install declaratively",
    "start": "270080",
    "end": "276320"
  },
  {
    "text": "with flux",
    "start": "276320",
    "end": "279479"
  },
  {
    "text": "so i have this git repository um i should probably pull the repository up",
    "start": "286400",
    "end": "292639"
  },
  {
    "text": "so you know where to go uh we'll save that for later okay",
    "start": "292639",
    "end": "298160"
  },
  {
    "text": "now we got here we go",
    "start": "298880",
    "end": "302000"
  },
  {
    "text": "so this is the jenkins infrarepo in the kingdom ci org that's my org",
    "start": "305199",
    "end": "310880"
  },
  {
    "text": "and the way that i have this set up is with flux it's going to take a little while to",
    "start": "310880",
    "end": "316479"
  },
  {
    "text": "load apparently because the network is having issues so let's just go right to it",
    "start": "316479",
    "end": "324880"
  },
  {
    "text": "this is running on my pet cluster it's called the move cluster",
    "start": "324880",
    "end": "330639"
  },
  {
    "text": "and i'm looking for the jenkins folder this is a flux customization",
    "start": "330800",
    "end": "338960"
  },
  {
    "text": "so if you've never used flux or flux for getups this might be unfamiliar to you",
    "start": "338960",
    "end": "345600"
  },
  {
    "text": "i will draw your attention to the specs section there's lots of stuff in here",
    "start": "345600",
    "end": "350800"
  },
  {
    "text": "we're gonna go find this patch down here there's a patch um so so i've already installed jenkins",
    "start": "350800",
    "end": "356800"
  },
  {
    "text": "because this takes a while what we're actually gonna do is to scale jenkins up so um what i just",
    "start": "356800",
    "end": "363360"
  },
  {
    "text": "did there sorry that was a little too fast uh i incremented the replicas count to one",
    "start": "363360",
    "end": "369360"
  },
  {
    "text": "from zero and i've had to use a patch here because the jenkins helm chart does not include",
    "start": "369360",
    "end": "375199"
  },
  {
    "text": "a replicas count it's not meant to be more than one replica so so uh",
    "start": "375199",
    "end": "381120"
  },
  {
    "text": "let's get commit that",
    "start": "381120",
    "end": "385360"
  },
  {
    "text": "and push and this is what git ops is i'm going to skip a step two because this is a fast fast-paced demo",
    "start": "386800",
    "end": "394240"
  },
  {
    "text": "normally i would open a pull request i'm just going to push straight to master",
    "start": "394240",
    "end": "399280"
  },
  {
    "text": "yeah yeah yellow okay oh no oh",
    "start": "400960",
    "end": "406840"
  },
  {
    "text": "no that's going to make it not a fun demo if we can't push to master",
    "start": "406840",
    "end": "414520"
  },
  {
    "text": "so",
    "start": "426880",
    "end": "429880"
  },
  {
    "text": "hmm maybe we'll have better luck outside of",
    "start": "439440",
    "end": "446000"
  },
  {
    "text": "the vm",
    "start": "446000",
    "end": "449080"
  },
  {
    "text": "so some things are bound to go wrong as we do this and",
    "start": "457840",
    "end": "462479"
  },
  {
    "text": "like i said this is my first time presenting at kubecon i'm gonna laugh i hope you all laugh too",
    "start": "462960",
    "end": "469280"
  },
  {
    "text": "oh no okay so i have to first pull and make sure i have the latest revision because",
    "start": "472960",
    "end": "478800"
  },
  {
    "text": "it's a git repository [Music]",
    "start": "478800",
    "end": "482889"
  },
  {
    "text": "here we go we'll put that one in",
    "start": "486000",
    "end": "490360"
  },
  {
    "text": "and push all right we got to get push",
    "start": "495039",
    "end": "500400"
  },
  {
    "text": "and the next thing i'm going to do is go to slack and as you see things are happening already",
    "start": "501680",
    "end": "507840"
  },
  {
    "text": "so let's see uh if we can see",
    "start": "508240",
    "end": "513839"
  },
  {
    "text": "what is happening",
    "start": "513839",
    "end": "517240"
  },
  {
    "text": "we should get some pods this is an alias here for cube control in the jenkins namespace",
    "start": "521599",
    "end": "529120"
  },
  {
    "text": "oh yes of course",
    "start": "530399",
    "end": "534200"
  },
  {
    "text": "and the reason we can't is because i disconnected from the vpn to try and make that work uh so i have a vpn here i",
    "start": "535839",
    "end": "542080"
  },
  {
    "text": "have this set up to be a little bit paranoid because like i said i can't take responsibility",
    "start": "542080",
    "end": "548160"
  },
  {
    "text": "for your jenkins infrastructure and i don't want to put a jenkins server on the internet uh i don't know about you",
    "start": "548160",
    "end": "554399"
  },
  {
    "text": "but i imagine many of you who have jenkins have it deployed in a private sort of setting",
    "start": "554399",
    "end": "561900"
  },
  {
    "text": "[Music] well we're going to move on if this doesn't go right away we're going to",
    "start": "561900",
    "end": "567760"
  },
  {
    "text": "need jenkins in a minute though so i hope it does work",
    "start": "567760",
    "end": "571920"
  },
  {
    "text": "and i'm going to try to catch up with that guy at the bottom there as we go this is progress indicator to help us",
    "start": "573279",
    "end": "579360"
  },
  {
    "text": "keep the pace so we're going to outline what we're going to show exactly here we have",
    "start": "579360",
    "end": "585600"
  },
  {
    "text": "we're going to do a helm update and actually we're going to do it in a mostly automated way",
    "start": "585600",
    "end": "591600"
  },
  {
    "text": "and then we're going to do an image update and when we do the image update the first time we're just going to do an",
    "start": "591600",
    "end": "598240"
  },
  {
    "text": "image update it'll be quick and the second time we're going to use flagger so we can see the image update",
    "start": "598240",
    "end": "606160"
  },
  {
    "text": "go in a progressive delivery style so first we said we're going to do an",
    "start": "606160",
    "end": "611519"
  },
  {
    "text": "automatic upgrade with jenkins and the helm controller so let's do that ah good we are getting",
    "start": "611519",
    "end": "619200"
  },
  {
    "text": "jenkins to come online so that's good so it's in the helm release file which",
    "start": "619200",
    "end": "626480"
  },
  {
    "text": "is another crd like i said there's a lot of new concepts if you haven't used flux i'm just going to blast right through",
    "start": "626480",
    "end": "632560"
  },
  {
    "text": "all of them and there will be an opportunity for questions later",
    "start": "632560",
    "end": "638279"
  },
  {
    "text": "okay so what we have here is our helm release this describes our jenkins installation declaratively",
    "start": "646959",
    "end": "652800"
  },
  {
    "text": "this is really i think what you came here to see and this is very long",
    "start": "652800",
    "end": "658320"
  },
  {
    "text": "once you get to the values section these are actually things that we're passing into",
    "start": "658320",
    "end": "663600"
  },
  {
    "text": "the uh helm install command so we've got uh",
    "start": "663600",
    "end": "670160"
  },
  {
    "text": "persistence so that the jenkins server when it comes online knows whether it's run jobs before or not but we're not",
    "start": "670560",
    "end": "676640"
  },
  {
    "text": "using it for anything else and we've got a place that we can set",
    "start": "676640",
    "end": "681680"
  },
  {
    "text": "the image if we want jenkins helm chart tells you that you should probably bake the plugins into the image",
    "start": "681680",
    "end": "689440"
  },
  {
    "text": "you don't have to there's an option in the helm chart the helm chart is great i'm just going to plug it right now you should if you haven't checked out the",
    "start": "689440",
    "end": "695839"
  },
  {
    "text": "helm chart to install jenkins you should definitely check it out it's kind of a prerequisite of this demo so",
    "start": "695839",
    "end": "704160"
  },
  {
    "text": "okay so before we go into detail about that we're just gonna upgrade jenkins",
    "start": "705680",
    "end": "712240"
  },
  {
    "text": "and that's what it takes that carrot there says we would like the latest",
    "start": "712240",
    "end": "718880"
  },
  {
    "text": "uh release in the same major version you can also put",
    "start": "718880",
    "end": "724079"
  },
  {
    "text": "tilde there if you would like the latest patch release in the same miner version",
    "start": "724079",
    "end": "730000"
  },
  {
    "text": "but we're going to get the latest version here we'd like it's actually an upgrade to the next minor version so",
    "start": "730000",
    "end": "736320"
  },
  {
    "text": "so like before we're just going to do a commit and push",
    "start": "737279",
    "end": "745839"
  },
  {
    "text": "and we're gonna go back to our notifications channel to see if that did anything and it did helm upgrade has",
    "start": "751200",
    "end": "756880"
  },
  {
    "text": "started great",
    "start": "756880",
    "end": "760639"
  },
  {
    "text": "we can watch it progress if we want we've got to move on to something else so we got lots of stuff to show",
    "start": "764160",
    "end": "771120"
  },
  {
    "text": "so this is the live demo part as we said um okay we've installed jenkins and we",
    "start": "771440",
    "end": "776800"
  },
  {
    "text": "took okay we did that already helm controller we've seen the semver automation to upgrade jenkins",
    "start": "776800",
    "end": "784160"
  },
  {
    "text": "hopefully that wasn't too fast um i'm i'm showing that first because it's the easy way",
    "start": "784160",
    "end": "790320"
  },
  {
    "text": "there's an easy way and a hard way to do automation influx and",
    "start": "790320",
    "end": "795360"
  },
  {
    "text": "we establish many of you already have jenkins maybe you don't",
    "start": "795360",
    "end": "800880"
  },
  {
    "text": "but now we're going to move on to the app hopefully jenkins is ready so we can actually do a build",
    "start": "800880",
    "end": "808000"
  },
  {
    "text": "and the build will also automatically be deployed and then i'll show you the artifacts that",
    "start": "808000",
    "end": "813600"
  },
  {
    "text": "make that possible",
    "start": "813600",
    "end": "816560"
  },
  {
    "text": "so i imagine that you have some kind of app or apps maybe a bundle of micro services",
    "start": "818800",
    "end": "825279"
  },
  {
    "text": "pod info is our app today",
    "start": "825279",
    "end": "830240"
  },
  {
    "text": "yes i'm in the right place",
    "start": "837120",
    "end": "841079"
  },
  {
    "text": "so what we're going to see here in our our deployment patch so there is a deployment beneath this",
    "start": "844079",
    "end": "849360"
  },
  {
    "text": "that has all the details but this is the easy thing to look at it's the easiest thing that i can show at least and this",
    "start": "849360",
    "end": "856320"
  },
  {
    "text": "over here is called a k yaml setter",
    "start": "856320",
    "end": "860160"
  },
  {
    "text": "that is a customized thing i think and that tells us which namespace to look in",
    "start": "861600",
    "end": "868399"
  },
  {
    "text": "for our image policy so we have an image policy defined that expresses how to find the latest",
    "start": "868399",
    "end": "877199"
  },
  {
    "text": "the latest build for pod info dev so let's kick it off before",
    "start": "877519",
    "end": "884560"
  },
  {
    "text": "we're too late",
    "start": "884560",
    "end": "887360"
  },
  {
    "text": "and i suppose i should make a change here uh rather than just do a build but",
    "start": "896560",
    "end": "902160"
  },
  {
    "text": "um this is quicker and we are actually short on time at this point if you are watching the tracker so",
    "start": "902160",
    "end": "908639"
  },
  {
    "text": "let's do it this way the build will take a minute we're not going to watch we'll just move on but when we come back we'll see",
    "start": "908639",
    "end": "916240"
  },
  {
    "text": "so there's our build that fired off jenkins is running on kubernetes and it's using kubernetes agent",
    "start": "916240",
    "end": "922480"
  },
  {
    "text": "so when a build happens it creates a pod and it pushes instructions to the pod through a side",
    "start": "922480",
    "end": "929360"
  },
  {
    "text": "channel and many of you probably are doing this in your jenkins installs already",
    "start": "929360",
    "end": "936480"
  },
  {
    "text": "but what i i hope that you'll take away from this is that when you create the new image and the",
    "start": "936480",
    "end": "942480"
  },
  {
    "text": "structure of this is a little bit uh arcane so this is the branch name and this is a",
    "start": "942480",
    "end": "948079"
  },
  {
    "text": "commit hash those are not super important depending on how you define your policy i suppose",
    "start": "948079",
    "end": "953920"
  },
  {
    "text": "we should look at the policy",
    "start": "953920",
    "end": "957120"
  },
  {
    "text": "so where does it come from well this is a customization overlay",
    "start": "961920",
    "end": "967279"
  },
  {
    "text": "that's one of the confusing things in flux is we have customized customization and we have",
    "start": "967279",
    "end": "972639"
  },
  {
    "text": "flux customization i don't know how we got here but have to",
    "start": "972639",
    "end": "978480"
  },
  {
    "text": "have to get over it it's okay",
    "start": "978480",
    "end": "982440"
  },
  {
    "text": "i believe i've defined",
    "start": "983600",
    "end": "986959"
  },
  {
    "text": "the policy here okay in a pod info folder",
    "start": "990399",
    "end": "997639"
  },
  {
    "text": "and that's what it looks like so it's got the literal string master in",
    "start": "1002639",
    "end": "1007839"
  },
  {
    "text": "it and it has a space for the commit hash and this part says we're looking for a",
    "start": "1007839",
    "end": "1013759"
  },
  {
    "text": "time stamp now if you're familiar with flux's v1 automation this is a little bit",
    "start": "1013759",
    "end": "1019600"
  },
  {
    "text": "different there's a technical reason for it i can explain later and the opportunity that",
    "start": "1019600",
    "end": "1026160"
  },
  {
    "text": "i'll have later i hope that you all will join me later at the flux booth at four",
    "start": "1026160",
    "end": "1031600"
  },
  {
    "text": "o'clock i think 4 30 maybe for um the it's four o'clock uh the",
    "start": "1031600",
    "end": "1038880"
  },
  {
    "text": "office hours where i'll be um going into detail about the things that",
    "start": "1038880",
    "end": "1044079"
  },
  {
    "text": "we had to gloss over here so you will have an opportunity to kneel me with questions",
    "start": "1044079",
    "end": "1049760"
  },
  {
    "text": "um anyway this part says the group named timestamp",
    "start": "1049760",
    "end": "1055120"
  },
  {
    "text": "is the part that we're extracting and that's the sortable part of the image so we're using sortable image tags and if you",
    "start": "1055120",
    "end": "1061760"
  },
  {
    "text": "google flux sortable image tags you'll find documentation about this with this very example",
    "start": "1061760",
    "end": "1069360"
  },
  {
    "text": "so we see our job is finished we're in the pod info dev namespace now",
    "start": "1069440",
    "end": "1078960"
  },
  {
    "text": "and we see",
    "start": "1079120",
    "end": "1081840"
  },
  {
    "text": "two pods that are two minutes old that's awesome",
    "start": "1084400",
    "end": "1089919"
  },
  {
    "text": "and for anyone who hasn't seen pod info before that's this is what it looks like so this is what we're upgrading",
    "start": "1091440",
    "end": "1098559"
  },
  {
    "text": "so let's move on",
    "start": "1098559",
    "end": "1101440"
  },
  {
    "text": "okay so there is a helm chart for pot info it does work with jenkins we're not going to use it today like i said",
    "start": "1105120",
    "end": "1111039"
  },
  {
    "text": "there's a lot of stuff in the abstract for this and it's all in the demo repo we're not going to have time to look at",
    "start": "1111039",
    "end": "1116880"
  },
  {
    "text": "everything today but we can at the office hours so we've added jenkins support to pod",
    "start": "1116880",
    "end": "1123679"
  },
  {
    "text": "info pod info does not natively have a jenkins file and we've done this using the flux guide",
    "start": "1123679",
    "end": "1129600"
  },
  {
    "text": "to jenkins which i will show you it is on our lovely docs site",
    "start": "1129600",
    "end": "1137840"
  },
  {
    "text": "and you can find it in the menu under use cases",
    "start": "1139679",
    "end": "1145520"
  },
  {
    "text": "jenkins and flux so there's a lot of text in here go ahead and read it if you like",
    "start": "1145520",
    "end": "1152000"
  },
  {
    "text": "or just come down here and snag this example and this is a jenkins file and you may",
    "start": "1152000",
    "end": "1157039"
  },
  {
    "text": "or may not have a lot of these but this is part of declarative jenkins so we've installed jenkins declaratively",
    "start": "1157039",
    "end": "1163280"
  },
  {
    "text": "and now we're configuring our jobs declaratively great",
    "start": "1163280",
    "end": "1169919"
  },
  {
    "text": "and how does this work we have some variables defined at the top you're meant to change these for your own",
    "start": "1170080",
    "end": "1176320"
  },
  {
    "text": "versions so you're not kingdom b put your own docker hub username there or",
    "start": "1176320",
    "end": "1181919"
  },
  {
    "text": "wherever your registry is and give it a secret so it can push this is a jenkins",
    "start": "1181919",
    "end": "1187760"
  },
  {
    "text": "secret in the helm release there's a section where you can add credentials uh declaratively also",
    "start": "1187760",
    "end": "1196880"
  },
  {
    "text": "and then it takes this docker pod definition we're actually using docker and jenkins to build images",
    "start": "1197120",
    "end": "1203679"
  },
  {
    "text": "so we do build here's how we get the git commit hash",
    "start": "1203679",
    "end": "1209360"
  },
  {
    "text": "in jenkins this is groovy code and if you've built any jenkins files or used jenkins for",
    "start": "1209360",
    "end": "1214799"
  },
  {
    "text": "any length of time before you've seen stuff like this and that's also how we get our timestamp",
    "start": "1214799",
    "end": "1222720"
  },
  {
    "text": "and uh what happens next is probably better",
    "start": "1222720",
    "end": "1227840"
  },
  {
    "text": "explained over here so here's our pipeline stages oh i didn't install the blue ocean pipe",
    "start": "1227840",
    "end": "1234640"
  },
  {
    "text": "that would be really nice we could look at it how many of you have seen blue ocean before okay all right so that's not a big loss",
    "start": "1234640",
    "end": "1242000"
  },
  {
    "text": "lots of people have seen it anyway what you would see if you haven't seen it is",
    "start": "1242000",
    "end": "1247280"
  },
  {
    "text": "a fork so so when we get to the build when we build is done",
    "start": "1247280",
    "end": "1253120"
  },
  {
    "text": "what we'd really like to do is for that image to be deployed immediately in dev and also",
    "start": "1253120",
    "end": "1260320"
  },
  {
    "text": "should be tested in parallel so that's what's happening here and we have a different definition",
    "start": "1260320",
    "end": "1266640"
  },
  {
    "text": "um if we look at the actual jenkins file in my pod info",
    "start": "1266640",
    "end": "1272640"
  },
  {
    "text": "fork",
    "start": "1272640",
    "end": "1275640"
  },
  {
    "text": "uh that tells it what to do",
    "start": "1278159",
    "end": "1282960"
  },
  {
    "text": "when a tag is pushed so this is a little bit more elaborated",
    "start": "1283600",
    "end": "1288640"
  },
  {
    "text": "but we would like for uh when a commit is pushed to a dev branch we like for",
    "start": "1288640",
    "end": "1294720"
  },
  {
    "text": "that to be built and pushed and then when we push tag we would like for that to be built and pushed",
    "start": "1294720",
    "end": "1300400"
  },
  {
    "text": "but instead of with the crazy three-part tag now we're going to use",
    "start": "1300400",
    "end": "1306159"
  },
  {
    "text": "the actual git tag as the image tag great",
    "start": "1306159",
    "end": "1312240"
  },
  {
    "text": "so we'll do that in a second",
    "start": "1312400",
    "end": "1316280"
  },
  {
    "text": "all right so so um i think we've gone backwards",
    "start": "1319840",
    "end": "1327440"
  },
  {
    "text": "so there are some helm test examples in the docs um that you should all check out we're not going to have time to go",
    "start": "1329919",
    "end": "1335440"
  },
  {
    "text": "through helm test today you see we're getting further and further behind here on the clock we're going to catch up though it's okay",
    "start": "1335440",
    "end": "1342240"
  },
  {
    "text": "let's go to the linker d demos pod info and this is going to show us flagger oops",
    "start": "1342240",
    "end": "1348720"
  },
  {
    "text": "spoiled thing",
    "start": "1348720",
    "end": "1351520"
  },
  {
    "text": "i've borrowed this example from jason morgan at buoyant they're the makers of linker d",
    "start": "1354880",
    "end": "1363039"
  },
  {
    "text": "which is another cncf graduated project",
    "start": "1363200",
    "end": "1367760"
  },
  {
    "text": "so i've just cloned it inside of my repo here i'm not using any sub modules or anything",
    "start": "1370960",
    "end": "1377120"
  },
  {
    "text": "am i in the right place i think so yes okay so there's a canary defined",
    "start": "1387440",
    "end": "1394159"
  },
  {
    "text": "here and the canary is the moving part that does",
    "start": "1394159",
    "end": "1399840"
  },
  {
    "text": "the progressive delivery so this is going to take longer so we're",
    "start": "1399840",
    "end": "1404960"
  },
  {
    "text": "actually going to start it right away before we explain anything",
    "start": "1404960",
    "end": "1409440"
  },
  {
    "text": "and uh okay we've got a pot info",
    "start": "1410400",
    "end": "1418559"
  },
  {
    "text": "so this is our production pod info it has a patch to change the background color",
    "start": "1419200",
    "end": "1424400"
  },
  {
    "text": "and do some other things so we're going to change the background color",
    "start": "1424400",
    "end": "1430200"
  },
  {
    "text": "i'm not sure what this color is but i'm sure it's good and we're going to do something else",
    "start": "1430240",
    "end": "1438360"
  },
  {
    "text": "i'm going to check our channel real quick to make sure something happens it did okay",
    "start": "1448640",
    "end": "1454880"
  },
  {
    "text": "let's go back to the browser and i think i'll have a minute to explain",
    "start": "1454880",
    "end": "1460400"
  },
  {
    "text": "what we're gonna see exactly so first",
    "start": "1460400",
    "end": "1465039"
  },
  {
    "text": "if i can find the canary we will see that it has a status",
    "start": "1469039",
    "end": "1474159"
  },
  {
    "text": "initialized if we watch the status",
    "start": "1474159",
    "end": "1479679"
  },
  {
    "text": "we should see momentarily that it changes to progressing and what that means is",
    "start": "1479679",
    "end": "1486320"
  },
  {
    "text": "flagger has detected that there's a new release and it's time to roll it out",
    "start": "1486320",
    "end": "1492799"
  },
  {
    "text": "and what it does to roll it out is first if you've defined any helm tests or",
    "start": "1492880",
    "end": "1498000"
  },
  {
    "text": "other kind of tests it'll run them before it routes any traffic at all to",
    "start": "1498000",
    "end": "1504159"
  },
  {
    "text": "it i hope it is actually moving",
    "start": "1504159",
    "end": "1509279"
  },
  {
    "text": "and then once it started routing traffic to it it's going to progressively increase the amount of traffic from five percent",
    "start": "1509360",
    "end": "1515840"
  },
  {
    "text": "great here we go it is moving wow",
    "start": "1515840",
    "end": "1521840"
  },
  {
    "text": "this might actually work",
    "start": "1522480",
    "end": "1526200"
  },
  {
    "text": "okay so in a moment what we should see is our change but just a little bit",
    "start": "1528159",
    "end": "1535440"
  },
  {
    "text": "and so what's happening pod info is actually refreshing the page for us",
    "start": "1535440",
    "end": "1541360"
  },
  {
    "text": "if you run pod info in your progressive delivery demos it's really nice",
    "start": "1541360",
    "end": "1547840"
  },
  {
    "text": "it kind of pokes the page over and over",
    "start": "1547840",
    "end": "1553600"
  },
  {
    "text": "again until something happens so that you can see the thing happen and and you can just",
    "start": "1553600",
    "end": "1559520"
  },
  {
    "text": "keep talking you don't have to press refresh so",
    "start": "1559520",
    "end": "1564799"
  },
  {
    "text": "we should probably go back to the slides advance as fast as we can okay so i hope that so far this is nice we",
    "start": "1567600",
    "end": "1574960"
  },
  {
    "text": "should see some progress over here soon um but i want to talk for a minute about",
    "start": "1574960",
    "end": "1581279"
  },
  {
    "text": "if you've seen some flux demos before or maybe you've tried it yourself and it didn't turn out like this",
    "start": "1581279",
    "end": "1587919"
  },
  {
    "text": "why is that why is that um so you probably should take a look at the web hook guide there's a guide",
    "start": "1587919",
    "end": "1594480"
  },
  {
    "text": "in flux docs called the uh notification guide and then there's another one called the receiver's guide",
    "start": "1594480",
    "end": "1602000"
  },
  {
    "text": "and a webhook receiver is um taking notice from github or from an image",
    "start": "1602000",
    "end": "1608720"
  },
  {
    "text": "repository when something happens to tell flux it's time to reconcile something otherwise what flux is doing",
    "start": "1608720",
    "end": "1615200"
  },
  {
    "text": "is it's continuously reconciling on an interval and that's very expensive if you want to do it on a tight interval",
    "start": "1615200",
    "end": "1622240"
  },
  {
    "text": "okay so you have to have some um",
    "start": "1622240",
    "end": "1627840"
  },
  {
    "text": "you'd like to see any part of this here supposedly serving 50 of traffic from",
    "start": "1630559",
    "end": "1636960"
  },
  {
    "text": "we still haven't seen anything am i looking at the right one",
    "start": "1636960",
    "end": "1641840"
  },
  {
    "text": "i'm afraid i did something wrong in the setup one of the things that can go wrong at this point is your",
    "start": "1646960",
    "end": "1653200"
  },
  {
    "text": "pods are not meshed i bet that's what we'll find",
    "start": "1653200",
    "end": "1657919"
  },
  {
    "text": "when you create uh yeah that's it so",
    "start": "1659120",
    "end": "1665760"
  },
  {
    "text": "so i've been tearing this down and standing it back up repeatedly and i have",
    "start": "1665760",
    "end": "1670960"
  },
  {
    "text": "depends on statement which is another feature of flux to make sure that things come up in the right order",
    "start": "1670960",
    "end": "1676799"
  },
  {
    "text": "but sometimes when my cluster goes down because it's a home lab cluster and things go wrong all the time",
    "start": "1676799",
    "end": "1682480"
  },
  {
    "text": "like literally every 24 hours at this point it's practically chaos engineering",
    "start": "1682480",
    "end": "1687919"
  },
  {
    "text": "the thing that goes wrong is you have things come up before linker d",
    "start": "1689279",
    "end": "1695200"
  },
  {
    "text": "and and so they don't get a sidecar injected that sidecar is a proxy that all traffic goes through",
    "start": "1695200",
    "end": "1702720"
  },
  {
    "text": "so uh so that linker d can collect metrics and do things like um revert the",
    "start": "1702720",
    "end": "1708000"
  },
  {
    "text": "deployment if if you see an elevated rate of errors or if",
    "start": "1708000",
    "end": "1714240"
  },
  {
    "text": "you see your latency numbers going up your request latency",
    "start": "1714240",
    "end": "1719840"
  },
  {
    "text": "you you can take a look in that canary and see how that's defined so that's all",
    "start": "1719840",
    "end": "1726480"
  },
  {
    "text": "customizable like everything else about flagger and it's progressing every five seconds",
    "start": "1726480",
    "end": "1733120"
  },
  {
    "text": "until it's done and we'll see that it finishes at some point and we'll",
    "start": "1733120",
    "end": "1739520"
  },
  {
    "text": "see a transition all at once unfortunately because i i flubbed that part but uh",
    "start": "1739520",
    "end": "1745679"
  },
  {
    "text": "so it's still pull-based um and yes uh the reason that it's actually pull-based",
    "start": "1746159",
    "end": "1751520"
  },
  {
    "text": "even though we're using a web hook is because flux only pulls",
    "start": "1751520",
    "end": "1758000"
  },
  {
    "text": "it's not receiving instructions through the web book it's just receiving a notice it's time to pull again",
    "start": "1758000",
    "end": "1763840"
  },
  {
    "text": "and this is to shorten the loop so development is an iterative process and the fast inner loop is super",
    "start": "1763840",
    "end": "1769360"
  },
  {
    "text": "important and this cannot be understated and i'm sure you've heard that a million times before but this is like one of the",
    "start": "1769360",
    "end": "1774480"
  },
  {
    "text": "important principles of devops and also it makes a better demo",
    "start": "1774480",
    "end": "1781600"
  },
  {
    "text": "um so five minutes is i think the guideline in the devops guide five minutes is not too",
    "start": "1781600",
    "end": "1788159"
  },
  {
    "text": "long but any longer is probably too long and it should be shorter if possible the shortest possible is",
    "start": "1788159",
    "end": "1795039"
  },
  {
    "text": "the best so all right you can use any ci it does not have to",
    "start": "1795039",
    "end": "1801039"
  },
  {
    "text": "be jenkins and flux gives you this great boundary between ci and cd now they're separate",
    "start": "1801039",
    "end": "1808960"
  },
  {
    "text": "jobs ci's job is to build test and push an image",
    "start": "1808960",
    "end": "1814399"
  },
  {
    "text": "flex's job is to deploy it in the cluster flagger makes this even",
    "start": "1814399",
    "end": "1819960"
  },
  {
    "text": "safer um you can do this without helm or with",
    "start": "1819960",
    "end": "1826640"
  },
  {
    "text": "helm test or in any combination there's lots of features to explore in the flux docs",
    "start": "1826640",
    "end": "1833679"
  },
  {
    "text": "and image automation that we saw in the earlier step is",
    "start": "1833679",
    "end": "1838960"
  },
  {
    "text": "probably the feature that made flux 1 popular in my in my opinion so",
    "start": "1838960",
    "end": "1845360"
  },
  {
    "text": "get ops is great but what we really wanted was it should be easy everything should just happen we don't want to",
    "start": "1845760",
    "end": "1852000"
  },
  {
    "text": "really think about it and cd if it gets out of the way that's great that's what we wanted we don't",
    "start": "1852000",
    "end": "1858159"
  },
  {
    "text": "have to look at it super infrastructure is unfortunately not easy",
    "start": "1858159",
    "end": "1863919"
  },
  {
    "text": "all the time and so this is a little harder than it was in the past because we're building",
    "start": "1863919",
    "end": "1870000"
  },
  {
    "text": "infrastructure we're not just building um cd right these are composable units of",
    "start": "1870000",
    "end": "1877279"
  },
  {
    "text": "abstraction that you can use for any purpose that you can imagine",
    "start": "1877279",
    "end": "1883518"
  },
  {
    "text": "so image policy image repository",
    "start": "1885679",
    "end": "1890720"
  },
  {
    "text": "flux will go out and look at the images that are there and reflect them into the control into the cluster so that it has",
    "start": "1890720",
    "end": "1896480"
  },
  {
    "text": "a record of what image tags exist filtered through your image policy and image update automation takes that",
    "start": "1896480",
    "end": "1902880"
  },
  {
    "text": "information and writes it back into the git repository and that's cool these are the crds to know",
    "start": "1902880",
    "end": "1910880"
  },
  {
    "text": "these are the controllers git repository is also part of this",
    "start": "1912000",
    "end": "1918559"
  },
  {
    "text": "it's used for its secret so you pass a git repository ref to",
    "start": "1918559",
    "end": "1924080"
  },
  {
    "text": "uh image update automation it harvests the secret out of it for this reason they have to be in the same name space",
    "start": "1924080",
    "end": "1929440"
  },
  {
    "text": "and because these secrets are used for writing into your git repositories they're super important to protect",
    "start": "1929440",
    "end": "1936159"
  },
  {
    "text": "oops so these are all advanced topics",
    "start": "1936159",
    "end": "1941360"
  },
  {
    "text": "you can template and scaffold around them so that your team members can use them if you understand them and they do not",
    "start": "1941440",
    "end": "1949320"
  },
  {
    "text": "okay so we've got our flux and jenkins guide please go read it it took me a long time to write it and get the pr",
    "start": "1951679",
    "end": "1957440"
  },
  {
    "text": "approved it explains how to use jsonnet together with flux",
    "start": "1957440",
    "end": "1963039"
  },
  {
    "text": "and if you read the abstract i mentioned porter why is porter in involved in this",
    "start": "1963039",
    "end": "1969200"
  },
  {
    "text": "so if you're if you're using docker to build images",
    "start": "1969200",
    "end": "1975679"
  },
  {
    "text": "porter does that too but the interface is smaller",
    "start": "1975679",
    "end": "1980158"
  },
  {
    "text": "and unfortunately we don't have time to show porter but what jobs does ci do",
    "start": "1980960",
    "end": "1986159"
  },
  {
    "text": "and should i use jenkins for this those are questions that i cannot answer i am not here to talk you out of it",
    "start": "1986159",
    "end": "1993279"
  },
  {
    "text": "um but jenkins has made me extremely paranoid if you go and look in this repo and see all the things that i've done to",
    "start": "1993279",
    "end": "1999600"
  },
  {
    "text": "protect it from random strangers on the internet while i give this demo uh you will be impressed",
    "start": "1999600",
    "end": "2005919"
  },
  {
    "text": "are you prepared uh for doomsday i i hope so so um there is a 45 minute session later",
    "start": "2005919",
    "end": "2012880"
  },
  {
    "text": "on uh please visit the flux booth you can do that from wherever you are you don't have to visit in person we",
    "start": "2012880",
    "end": "2019360"
  },
  {
    "text": "have a hybrid booth it's really cool also the get ops one stop shop is our",
    "start": "2019360",
    "end": "2025440"
  },
  {
    "text": "milestone event coming up next week and we're having microsoft aws",
    "start": "2025440",
    "end": "2031600"
  },
  {
    "text": "vmware d2iq and speakers from weaveworks all to show us",
    "start": "2031600",
    "end": "2037360"
  },
  {
    "text": "their products that they're building on flux that you can go out and buy",
    "start": "2037360",
    "end": "2042799"
  },
  {
    "text": "so so please check it out we're gonna have some really fantastic speakers",
    "start": "2043760",
    "end": "2050240"
  },
  {
    "text": "flux is great for disaster recovery uh 35 minutes is not enough time to show disaster recovery but 45 minutes",
    "start": "2050240",
    "end": "2056560"
  },
  {
    "text": "we're going to tear the whole cluster down and i will show you how it all comes up and it'll actually only take about 10 minutes",
    "start": "2056560",
    "end": "2064158"
  },
  {
    "text": "um it's my home lab so uh there's lots of stuff that we don't actually have time to talk",
    "start": "2064159",
    "end": "2070960"
  },
  {
    "text": "about but it will be easy uh maybe",
    "start": "2070960",
    "end": "2076878"
  },
  {
    "text": "parts of it at least and uh there's there's a strategy here that i really want to show you and i",
    "start": "2076879",
    "end": "2083280"
  },
  {
    "text": "really want to explain but um we don't have time unfortunately right here but it's super important so",
    "start": "2083280",
    "end": "2091200"
  },
  {
    "text": "um remember this part at least so this was the easy thing that i showed",
    "start": "2091200",
    "end": "2096638"
  },
  {
    "text": "i'm going to show a hard thing at the flux booth that actually solves a problem that you're probably",
    "start": "2096639",
    "end": "2102240"
  },
  {
    "text": "thinking in the back of your mind when you think about how image update automation works okay",
    "start": "2102240",
    "end": "2107839"
  },
  {
    "text": "we have chicken and egg problem we'd really like to use the git tag so that we can take the manifest that",
    "start": "2107839",
    "end": "2114320"
  },
  {
    "text": "are in the git tag of the application and apply it to the cluster with our new image but",
    "start": "2114320",
    "end": "2120240"
  },
  {
    "text": "that's not how image update automation works um so so tags",
    "start": "2120240",
    "end": "2126480"
  },
  {
    "text": "you know that's what you're using for you you want to mark a release and then things should happen and uh",
    "start": "2126480",
    "end": "2134320"
  },
  {
    "text": "when the image build starts is when you push the tag so that's not the time for flux to deploy the manifests right",
    "start": "2134320",
    "end": "2140880"
  },
  {
    "text": "because your build could fail and uh it may fail for surprising",
    "start": "2140880",
    "end": "2146640"
  },
  {
    "text": "reasons like you run out of disk or anything else happens like",
    "start": "2146640",
    "end": "2152720"
  },
  {
    "text": "i don't know pods came up in the wrong order so uh",
    "start": "2152880",
    "end": "2158640"
  },
  {
    "text": "the solution that i will allude to is that a new semver image tag actually implies",
    "start": "2158640",
    "end": "2164160"
  },
  {
    "text": "that there is a matching git tag and if you're really thinking right now about how to use this and if you know",
    "start": "2164160",
    "end": "2169599"
  },
  {
    "text": "about a feature that i haven't shown yet then the solution might be obvious to",
    "start": "2169599",
    "end": "2175040"
  },
  {
    "text": "you already you can use that git tag you can use that image tag",
    "start": "2175040",
    "end": "2181280"
  },
  {
    "text": "as git tag anyway i think we're completely out of time no yes",
    "start": "2181280",
    "end": "2187839"
  },
  {
    "text": "um please join me at the flux booth are we out of time",
    "start": "2187920",
    "end": "2193119"
  },
  {
    "text": "yeah we're actually out of time okay great i hope you enjoy",
    "start": "2193119",
    "end": "2199400"
  }
]