[
  {
    "text": "go cool um well so we're going to do a workshop on no mess rollouts with API",
    "start": "359",
    "end": "5520"
  },
  {
    "text": "Gateway so if you're interested in Argo and uh API Gateway you're in the right place um I'm Nina uh I work at solo as a",
    "start": "5520",
    "end": "14080"
  },
  {
    "text": "software engineer um we do primarily ISO and uh our API uh gate Envoy based API",
    "start": "14080",
    "end": "21320"
  },
  {
    "text": "Gateway so I've been on kind of both teams so very familiar with ISO and Envoy um I'm Lawrence yeah I'm Lawrence",
    "start": "21320",
    "end": "28960"
  },
  {
    "text": "uh I also work at solo working on the same things as well cool well so before",
    "start": "28960",
    "end": "34840"
  },
  {
    "text": "uh like we get into more slides um our lab takes a while to boot up um and this",
    "start": "34840",
    "end": "40160"
  },
  {
    "text": "is like a Hands-On Workshop so if you don't have a laptop find a buddy uh scan the QR code or go to the link um and",
    "start": "40160",
    "end": "46600"
  },
  {
    "text": "this is all an instruct so you don't have to run anything locally it's you know in the like the internet should be",
    "start": "46600",
    "end": "52000"
  },
  {
    "text": "okay since it's running on on their VMS um so yeah so scan the QR code it'll",
    "start": "52000",
    "end": "57559"
  },
  {
    "text": "take a couple minutes maybe to boot up um so if you start now we'll like have the slide throughout the presentation so",
    "start": "57559",
    "end": "64119"
  },
  {
    "text": "if you come late and need to scan like it'll return um but if you want to do",
    "start": "64119",
    "end": "69400"
  },
  {
    "text": "that now and get started that would be great um and uh the next thing we're going to do is actually take um some",
    "start": "69400",
    "end": "76320"
  },
  {
    "text": "warm-up questions so um the first warm-up question is uh if you are using",
    "start": "76320",
    "end": "81400"
  },
  {
    "text": "a Gateway controller which one are you using are you using you know AWS um ISO um what other",
    "start": "81400",
    "end": "91920"
  },
  {
    "text": "yeah psyllium Kong glue uh Envoy Gateway um",
    "start": "93399",
    "end": "100960"
  },
  {
    "text": "so yeah but yeah if you slide if or if you swipe yeah there you go so some",
    "start": "100960",
    "end": "106479"
  },
  {
    "text": "answers for AWS some answers for esto more ISO engine X we'll actually see",
    "start": "106479",
    "end": "111680"
  },
  {
    "text": "that maybe later Envoy Gateway we'll also see",
    "start": "111680",
    "end": "117398"
  },
  {
    "text": "that cool Ambassador very good more",
    "start": "117880",
    "end": "127000"
  },
  {
    "text": "AWS AWS yeah a good number of engine X too which is good this one of our examples",
    "start": "129800",
    "end": "136040"
  },
  {
    "text": "uh might might use that",
    "start": "136040",
    "end": "139280"
  },
  {
    "text": "so all right give people another couple seconds to to keep typing",
    "start": "145319",
    "end": "151840"
  },
  {
    "text": "it's a pretty good yeah I think might be the winner",
    "start": "166959",
    "end": "171920"
  },
  {
    "text": "yeah all right well um all good answers um we have another question too so if you finish typing I'll move on to the",
    "start": "177360",
    "end": "184239"
  },
  {
    "text": "second question um so my second question is how familiar are you with Progressive delivery techniques so this is mostly to",
    "start": "184239",
    "end": "191120"
  },
  {
    "text": "help us like you know speed the like you know understand what speed to go at um",
    "start": "191120",
    "end": "196200"
  },
  {
    "text": "in the early sections because we're going to assume um like no knowledge um of arar roll outs to begin with and kind",
    "start": "196200",
    "end": "201920"
  },
  {
    "text": "of introduce it gradually um so yeah so somewhat familiar good to hear",
    "start": "201920",
    "end": "209799"
  },
  {
    "text": "great so it seems like people have some familiarity with like what Argo is or what Progressive delivery is um so with",
    "start": "216120",
    "end": "223799"
  },
  {
    "text": "that I'm going to put up the the lab link again if you have a chance uh again scan the QR code or go to the the tiny",
    "start": "223799",
    "end": "230480"
  },
  {
    "text": "URL um and that should bring up the instruct page um I'll be walking around to help people like loading up instruct",
    "start": "230480",
    "end": "237519"
  },
  {
    "text": "and um you know any issues you run into and I think Lawrence is going to take the first section so Progressive",
    "start": "237519",
    "end": "244400"
  },
  {
    "text": "delivery yeah thank you um and also when you pull up the lab make sure to click",
    "start": "244400",
    "end": "249480"
  },
  {
    "text": "the start button in the bottom right uh so that that that actually will kick off the the VM start so that that way you",
    "start": "249480",
    "end": "256799"
  },
  {
    "text": "can get it going while we go through some quick slides um okay so kind of the whole premise here we've touched on is",
    "start": "256799",
    "end": "263240"
  },
  {
    "text": "Progressive delivery and Progressive delivery is a software delivery technique where your your goal goal is",
    "start": "263240",
    "end": "270080"
  },
  {
    "text": "to gradually introduce new versions of software to your users but you do it in a gradual fashion and in a controlled",
    "start": "270080",
    "end": "276400"
  },
  {
    "text": "fashion so whether that's uh some subset of users or a specific environment the",
    "start": "276400",
    "end": "281479"
  },
  {
    "text": "goal is that you reduce the blast radius and the risk that comes with making a change so ideally you have that coupled",
    "start": "281479",
    "end": "288720"
  },
  {
    "text": "with some automation so you spin up a new version and you gradually send some traffic to that new version um if things",
    "start": "288720",
    "end": "294479"
  },
  {
    "text": "go wrong you can catch that and roll back as quickly as you can before you have you know full production",
    "start": "294479",
    "end": "300639"
  },
  {
    "text": "outage um but to get to Progressive delivery we have to start at the basic level so kubernetes deployments is kind",
    "start": "300639",
    "end": "306600"
  },
  {
    "text": "of the the standard way to do this in the kubernetes world um it's a you know",
    "start": "306600",
    "end": "311960"
  },
  {
    "text": "it's a resource that's provided as the def with default kubernetes it's in the apps API Group and it's kind of you know",
    "start": "311960",
    "end": "318360"
  },
  {
    "text": "the standard way of managing your workloads in kubernetes it's not the only one um for example open shift had a",
    "start": "318360",
    "end": "323919"
  },
  {
    "text": "deployment config um but for the most part deployments is how you get your applications deployed",
    "start": "323919",
    "end": "330199"
  },
  {
    "text": "um there's two basic strategies that come with a deployment for rolling out upgrades one is recreate uh and one is",
    "start": "330199",
    "end": "336440"
  },
  {
    "text": "rolling update recreate I actually haven't seen too much usage in the in in the wild um basically that kills all of",
    "start": "336440",
    "end": "344039"
  },
  {
    "text": "your existing pods and Spins up a whole new set of PODS every time you do a deployment um whereas a rolling update",
    "start": "344039",
    "end": "349840"
  },
  {
    "text": "does a gradual roll out where you spin up a new pod According to some ratio and then you spin down the old pods um under",
    "start": "349840",
    "end": "357199"
  },
  {
    "text": "the covers the deployments work by creating another kubernetes resource the replica set so you create a deployment",
    "start": "357199",
    "end": "362840"
  },
  {
    "text": "and you say I want to create some PODS of this specification with this amount of replicas and then under the covers of",
    "start": "362840",
    "end": "368680"
  },
  {
    "text": "the deployment is going to create a replica set that ex that um defines that single that single revision of your",
    "start": "368680",
    "end": "375759"
  },
  {
    "text": "deployment and then ultimately that replica set will then turn into however many pods you need and those will get",
    "start": "375759",
    "end": "381840"
  },
  {
    "text": "scheduled and your workload is actually running um so at a super basic level",
    "start": "381840",
    "end": "386919"
  },
  {
    "text": "right you have your deployment created you have a deployment controller in the control plan in the kuini control plane",
    "start": "386919",
    "end": "392520"
  },
  {
    "text": "that's watching for that so it sees that there's a deployment and we want to create revision one so now we're going",
    "start": "392520",
    "end": "399039"
  },
  {
    "text": "to spin up a replica set and then the replica set controller is watching for replica sets and it says okay I need to",
    "start": "399039",
    "end": "404840"
  },
  {
    "text": "create revision one spin up a bunch of PODS so with that now let's actually go",
    "start": "404840",
    "end": "410440"
  },
  {
    "text": "to our lab and we're going to get our hands dirty with the deployments",
    "start": "410440",
    "end": "417120"
  },
  {
    "text": "so you should be uh screen hopefully that says using kubernetes deployments",
    "start": "417120",
    "end": "423879"
  },
  {
    "text": "um if not raise your hand and Nina will help you get there oh yeah sure okay um so with the",
    "start": "423879",
    "end": "433560"
  },
  {
    "text": "lab so actually let's go to the first step and we can kind of talk about instruct um so this is the UI of the",
    "start": "433560",
    "end": "441879"
  },
  {
    "text": "actual lab itself on the left is the terminal where you'll actually be putting in commands to interact with the",
    "start": "441879",
    "end": "449039"
  },
  {
    "text": "VM that's provision um behind the scenes in instruct everyone that has signed up and is using this you have your own VM",
    "start": "449039",
    "end": "455759"
  },
  {
    "text": "in the cloud um and so you can interact with it directly uh on the right are the",
    "start": "455759",
    "end": "461360"
  },
  {
    "text": "directions the text is actually pretty self-contained so if you want to just read along yourself and do the lab you",
    "start": "461360",
    "end": "466759"
  },
  {
    "text": "can do that as well I'll be going through it up here and going through it and kind of summarizing the text I don't",
    "start": "466759",
    "end": "472240"
  },
  {
    "text": "want to you know read it word for word um so you can just watch as I do it as well um but yeah so let's go and get",
    "start": "472240",
    "end": "479800"
  },
  {
    "text": "started so we're talking about kubernetes deployments and how they work um the first thing we're going to do is",
    "start": "479800",
    "end": "485360"
  },
  {
    "text": "actually go ahead and create a deployment um the VMS that are running have a kind cluster provisioned uh that",
    "start": "485360",
    "end": "492280"
  },
  {
    "text": "we can interact with using cctl um right now there's nothing on the cluster we can go ahead and kind of",
    "start": "492280",
    "end": "497639"
  },
  {
    "text": "prove that we'll do a cctl get all um you can copy and paste if you want with",
    "start": "497639",
    "end": "503599"
  },
  {
    "text": "the these little buttons above the kind of the text blocks so you could copy and paste if you wanted to",
    "start": "503599",
    "end": "510720"
  },
  {
    "text": "um what you can also do is click the Run button which will just directly run it for you so you don't have to copy and paste every command um so in this case",
    "start": "510720",
    "end": "518039"
  },
  {
    "text": "though we just did a qctl get all and we can see that at least in the default namespace the only thing running is the",
    "start": "518039",
    "end": "523479"
  },
  {
    "text": "default or the only thing there is the default kubernetes service um so as we",
    "start": "523479",
    "end": "529279"
  },
  {
    "text": "go through all of these steps we're going to be using this Argo rollout demo app um which is a pretty awesome little",
    "start": "529279",
    "end": "535279"
  },
  {
    "text": "tool that will help us visualize um how how roll outs progress",
    "start": "535279",
    "end": "541360"
  },
  {
    "text": "so this is a screenshot we'll be working with us directly in some of the later Labs but uh basically what it does is it",
    "start": "541360",
    "end": "547640"
  },
  {
    "text": "it's a front end it's a UI that also has a back end and the back end has a SLC color endpoint and so the the squares in",
    "start": "547640",
    "end": "554920"
  },
  {
    "text": "the app will randomly make a request to slash color and depending on the response from that from the depending on",
    "start": "554920",
    "end": "560519"
  },
  {
    "text": "the color that it gets as a response will color in with the color that it got so in this case you can see that there's",
    "start": "560519",
    "end": "567440"
  },
  {
    "text": "a majority blue and then it's you know in the in in the process of doing a roll out to yellow and it kind of helps you",
    "start": "567440",
    "end": "572760"
  },
  {
    "text": "see as time progresses of the deployment the various um shift in",
    "start": "572760",
    "end": "577800"
  },
  {
    "text": "versions um so for going back to the lab for the first for the first lab we're not actually going to use that app from",
    "start": "577800",
    "end": "583760"
  },
  {
    "text": "like a UI perspective but that's the app that we'll be using throughout the whole Workshop so we're going to go ahead and",
    "start": "583760",
    "end": "591079"
  },
  {
    "text": "create a deployment that represents that application that we were just looking at and the first thing we'll do is just",
    "start": "591079",
    "end": "596519"
  },
  {
    "text": "take a quick peek at the Manifest itself so we've got kind of a standard um",
    "start": "596519",
    "end": "602600"
  },
  {
    "text": "deployment manifest here and that is um you know apps V1 deployment as basic as",
    "start": "602600",
    "end": "608519"
  },
  {
    "text": "it gets and we have a pretty simple setup here um we want 10 replicas of our",
    "start": "608519",
    "end": "614640"
  },
  {
    "text": "roll outs to demo app and we're using here this roll outs demo Blue version",
    "start": "614640",
    "end": "621040"
  },
  {
    "text": "the tag is blue that corresponds to the color that we saw on the UI so basically",
    "start": "621040",
    "end": "627959"
  },
  {
    "text": "every time that the request went to to this version of the back end it would respond with blue resulting in a blue",
    "start": "627959",
    "end": "633399"
  },
  {
    "text": "square um and down at the bottom you can see the strategy of the deployment in",
    "start": "633399",
    "end": "638639"
  },
  {
    "text": "this case we're using the rolling update and then we have just a couple of configuration options on the rolling update which is the max Surge and Max",
    "start": "638639",
    "end": "645680"
  },
  {
    "text": "unavailable we're not going to go into too many details of that but basically you do have a bit of control over how",
    "start": "645680",
    "end": "651279"
  },
  {
    "text": "you want the the roll out to progress when you make a change to the deployment um let's go ahead and actually apply it",
    "start": "651279",
    "end": "658160"
  },
  {
    "text": "and see it run so we we've applied the Manifest to our cluster and then we can do a get all and",
    "start": "658160",
    "end": "666000"
  },
  {
    "text": "we're going to include the labels while we do that so what we'll see is at the",
    "start": "666000",
    "end": "671360"
  },
  {
    "text": "top we'll see a bunch of PODS spinning up some of them are already running some of them are still in the creating phase",
    "start": "671360",
    "end": "676880"
  },
  {
    "text": "but we should have 10 of these pods that correspond to at the bottom we have a replica set that wants 10 pods and this",
    "start": "676880",
    "end": "684880"
  },
  {
    "text": "replica set again was created by the deployment so we applied the deployment the deployment control saw that and",
    "start": "684880",
    "end": "690279"
  },
  {
    "text": "realized that we want to kick in a replica set or create a replica set in order to spin up our actual pods um the",
    "start": "690279",
    "end": "696240"
  },
  {
    "text": "other interesting thing that we'll talk about with this is you can see that the replica set has a suffix uh of these",
    "start": "696240",
    "end": "703959"
  },
  {
    "text": "characters this is the hash um this is the hash of the Pod template that we put",
    "start": "703959",
    "end": "709760"
  },
  {
    "text": "in our deployment and so this hash is also present on the labels of the",
    "start": "709760",
    "end": "715639"
  },
  {
    "text": "replica set that has a pod template hash of that that that string the pods themselves also have a",
    "start": "715639",
    "end": "724240"
  },
  {
    "text": "label that's pod template hash of that hash and that's how the the pods and the",
    "start": "724240",
    "end": "730000"
  },
  {
    "text": "replica set stay in sync and the deployment tracks its revisions based off of the hash of the replica set as",
    "start": "730000",
    "end": "736320"
  },
  {
    "text": "well so we have our pods running we have 10 of them our initial deployment is is",
    "start": "736320",
    "end": "741959"
  },
  {
    "text": "running great now we need to update it so we make a change to our app in our case we're going to change the the color",
    "start": "741959",
    "end": "748519"
  },
  {
    "text": "of the application and the way we'll do that I'm going to copy this one so we can see it kind of",
    "start": "748519",
    "end": "754279"
  },
  {
    "text": "full what we're doing is we're going",
    "start": "754279",
    "end": "759160"
  },
  {
    "text": "to e",
    "start": "778120",
    "end": "782160"
  },
  {
    "text": "check I think we're back",
    "start": "816880",
    "end": "821040"
  },
  {
    "text": "okay all right so we just had a canary deployment of",
    "start": "825320",
    "end": "831360"
  },
  {
    "text": "our of our microphone um okay so where are we at we are going to update this",
    "start": "831360",
    "end": "837800"
  },
  {
    "text": "deployment to do a roll out of this deployment and so this you know again",
    "start": "837800",
    "end": "843160"
  },
  {
    "text": "we're going to use the QBC set command to actually update the deployment in this case we're going to set the image",
    "start": "843160",
    "end": "848920"
  },
  {
    "text": "on the podspec of this deployment to what it previously was of blue we're going to set it to the rollouts demo",
    "start": "848920",
    "end": "854959"
  },
  {
    "text": "with an orange version um and then we're going to immediately after that one run",
    "start": "854959",
    "end": "860880"
  },
  {
    "text": "the cubc tail rollout status command uh with the D- watch flag so we can actually see it progress as it",
    "start": "860880",
    "end": "867120"
  },
  {
    "text": "progresses so let's go ahead and roll that run that and so what we've done is",
    "start": "867120",
    "end": "873240"
  },
  {
    "text": "we've changed the deployment spec or the podp spec of the deployment by changing the version of that image and that",
    "start": "873240",
    "end": "879120"
  },
  {
    "text": "signaled to the deployment controller that's watching the deployment that something has changed I need to spin up a new version I'm going to roll out all",
    "start": "879120",
    "end": "885560"
  },
  {
    "text": "these new pods and now I have my new set of PODS deployed um and we can see that you know it progresses from 1 to 10",
    "start": "885560",
    "end": "892560"
  },
  {
    "text": "basically of those replicas so what we can do is now let's",
    "start": "892560",
    "end": "898480"
  },
  {
    "text": "check what we have running so now we have the 10 pods that are created you",
    "start": "898480",
    "end": "904680"
  },
  {
    "text": "know about 20 seconds ago to correspond to our update and then we have um the",
    "start": "904680",
    "end": "910120"
  },
  {
    "text": "same deployment but at the bottom now we have two replica sets one which is scaled to zero and one which is scaled",
    "start": "910120",
    "end": "916839"
  },
  {
    "text": "to 10 so the the new replica set that corresponds to the new version of our app is now running according to this",
    "start": "916839",
    "end": "923519"
  },
  {
    "text": "replica set with a new hash and you can see that the hashes also match up as they did before",
    "start": "923519",
    "end": "929639"
  },
  {
    "text": "four so let's do another roll out and this time we're going to watch on the",
    "start": "929639",
    "end": "934839"
  },
  {
    "text": "replica sets because there's a lot more change happening there um so let's go and run this command to we're going to",
    "start": "934839",
    "end": "940199"
  },
  {
    "text": "set the image to a different color in this case it's going to be red and then we're going to watch the replica sets as",
    "start": "940199",
    "end": "948120"
  },
  {
    "text": "they progress through their deployment so you can see that at the",
    "start": "948120",
    "end": "954600"
  },
  {
    "text": "beginning um I'm sure I'm going to scroll back up you can at the beginning that we had this new replica set created",
    "start": "954600",
    "end": "961199"
  },
  {
    "text": "0 seconds ago immediately and we wanted two replicas at that point um we want we",
    "start": "961199",
    "end": "967079"
  },
  {
    "text": "didn't have two of them ready so it's still in the process of creating but then we also see one of the replica sets",
    "start": "967079",
    "end": "972839"
  },
  {
    "text": "go down to nine so that corresponds to the previous one and so what happens is it will progress through right and then",
    "start": "972839",
    "end": "979240"
  },
  {
    "text": "we end up with one replica set at 10 and one at zero and so again that",
    "start": "979240",
    "end": "984440"
  },
  {
    "text": "corresponds to our new version",
    "start": "984440",
    "end": "988560"
  },
  {
    "text": "okay so we can check the pods again and see the labels and we'll now see that we have um 10 of these pods and this this",
    "start": "993079",
    "end": "1000839"
  },
  {
    "text": "hash corresponds to the new replica set that has the 10 desired so okay that's",
    "start": "1000839",
    "end": "1006240"
  },
  {
    "text": "great we rolled out a new version what if something is wrong with this version and we need to roll back in our case um",
    "start": "1006240",
    "end": "1012440"
  },
  {
    "text": "we have to do it manually because there's nothing in the deployment that helps us automate that unless you build a bunch of custom tooling on top of it",
    "start": "1012440",
    "end": "1018600"
  },
  {
    "text": "so so what we want to do is we we would ideally like to automate that away but we get we're getting reports from you",
    "start": "1018600",
    "end": "1024558"
  },
  {
    "text": "know our testers or users that something is wrong in this new version we need to roll back so with a deployment what we",
    "start": "1024559",
    "end": "1031720"
  },
  {
    "text": "can do is we can check the history as a certain number of of the historical revisions are kept",
    "start": "1031720",
    "end": "1037918"
  },
  {
    "text": "around um in this case we'll run the rollout history command and we can see that there are three revisions the",
    "start": "1037919",
    "end": "1044798"
  },
  {
    "text": "change cause uh column is empty that's cor that corresponds to an annotation on the deployment we haven't done anything",
    "start": "1044799",
    "end": "1051280"
  },
  {
    "text": "special with that so it's empty if you were building some tooling on top of deployments you could build that into",
    "start": "1051280",
    "end": "1056440"
  },
  {
    "text": "say your pipeline to say you know as you've like maybe a hash if you have it checked into to get a commit hash that",
    "start": "1056440",
    "end": "1062679"
  },
  {
    "text": "says this commit was applied that's why this change happened um but we don't have any of that fanciness right now so",
    "start": "1062679",
    "end": "1068360"
  },
  {
    "text": "we just have an empty change but what we know is that we want to go back to revision one in this case the last two versions reports we're getting they're",
    "start": "1068360",
    "end": "1075120"
  },
  {
    "text": "they're not working right so we need to go back so let's get a bit more detail on revision one so we're going to run",
    "start": "1075120",
    "end": "1081520"
  },
  {
    "text": "the command to get the history specifically of revision revision one",
    "start": "1081520",
    "end": "1088840"
  },
  {
    "text": "and we're also going to get the replica sets and see what's still in our cluster so the First Command gave us the",
    "start": "1088840",
    "end": "1096159"
  },
  {
    "text": "history of revision one and that was when we were on the Blue version and we also had this hash associated with that",
    "start": "1096159",
    "end": "1103280"
  },
  {
    "text": "revision and then when we got the replica sets we see that we have three of them still in the cluster the one at",
    "start": "1103280",
    "end": "1109320"
  },
  {
    "text": "the top is at 10 because that represents our current state but we have these two still around that are at zero um because",
    "start": "1109320",
    "end": "1116440"
  },
  {
    "text": "those were the first and second version that we have already um progressed Beyond but they still exist in the",
    "start": "1116440",
    "end": "1121960"
  },
  {
    "text": "cluster um in the case in case we need to roll back to them um and you can see that this one that was created seven",
    "start": "1121960",
    "end": "1127480"
  },
  {
    "text": "minutes ago has this hash of 745 and that corresponds to revision one",
    "start": "1127480",
    "end": "1133679"
  },
  {
    "text": "um at stored in the history of our deployment so okay so we what we want to do is we want to roll back to that",
    "start": "1133679",
    "end": "1139000"
  },
  {
    "text": "version so what we'll do is we'll use the roll out undo command and in this",
    "start": "1139000",
    "end": "1144520"
  },
  {
    "text": "case we're going to say we want to go specifically to revision one and then we're going to watch as that roll out",
    "start": "1144520",
    "end": "1152520"
  },
  {
    "text": "happens so now we're going to scale up from 0 to 10 of our new replica set or",
    "start": "1152520",
    "end": "1158679"
  },
  {
    "text": "actually our old replica set um and we scale down the new version and then we can see what happened by we're going to",
    "start": "1158679",
    "end": "1166520"
  },
  {
    "text": "check the events on the deployment in that Casa in that's another way that we can see what has happened with our",
    "start": "1166520",
    "end": "1172080"
  },
  {
    "text": "deployment um and then we'll also get the pods and their labels so if we",
    "start": "1172080",
    "end": "1177320"
  },
  {
    "text": "scroll back up we can see that some events happen where we're scaling the replica set and it kind of tracks you",
    "start": "1177320",
    "end": "1182840"
  },
  {
    "text": "know what happened um over the process of that roll back and then now we have",
    "start": "1182840",
    "end": "1188120"
  },
  {
    "text": "our 10 pods that were created again 20 seconds ago that correspond to revision one um and that's the hash that's",
    "start": "1188120",
    "end": "1195520"
  },
  {
    "text": "associated with um revision one okay so let's go ahead and clean up",
    "start": "1195520",
    "end": "1202679"
  },
  {
    "text": "that's that's it for deployments you know we we see how they work we know how they work under the covers pretty basic",
    "start": "1202679",
    "end": "1208200"
  },
  {
    "text": "but you know it's pretty standard for kubernetes as we want to start progressing through these Progressive",
    "start": "1208200",
    "end": "1213280"
  },
  {
    "text": "delivery uh components we need to build on top of that or we need to look for other options so we'll go ahead and do",
    "start": "1213280",
    "end": "1219799"
  },
  {
    "text": "the cleanup step delete our deployment and then you can click check in the bottom right to go to the next Lab",
    "start": "1219799",
    "end": "1230000"
  },
  {
    "text": "and now we're going to talk about Argo",
    "start": "1230000",
    "end": "1233679"
  },
  {
    "text": "rollouts okay so we saw what we have available to us",
    "start": "1236760",
    "end": "1243559"
  },
  {
    "text": "with deployments but again for a progressive delivery perspective there's not a whole lot there we have to build a",
    "start": "1243559",
    "end": "1250400"
  },
  {
    "text": "bunch of stuff on top of it or into Argo rollouts we can use a tool that's built specifically for this uh Argo rollouts",
    "start": "1250400",
    "end": "1258600"
  },
  {
    "text": "basically gives you kubernetes native tooling for Progressive delivery um Argo",
    "start": "1258600",
    "end": "1263679"
  },
  {
    "text": "rolls is a sub project of the cncf graduated Argo project um and it's worth calling out that Argo rollouts doesn't",
    "start": "1263679",
    "end": "1269640"
  },
  {
    "text": "actually require the use of the other projects like Argo CD I know there I personally seen some misconceptions",
    "start": "1269640",
    "end": "1275919"
  },
  {
    "text": "where you have to use Argo CD to use Argo rollouts there is integration between them but you there it's not required at all um in fact in this",
    "start": "1275919",
    "end": "1282760"
  },
  {
    "text": "Workshop we're going to use only Argo rollouts and none of the other tooling um so don't let that kind of take you",
    "start": "1282760",
    "end": "1289240"
  },
  {
    "text": "away from using it if you think you have to use one or the other or one and the other um the way that it works is it's",
    "start": "1289240",
    "end": "1296000"
  },
  {
    "text": "basically a kubernetes controller or kind of a set of controllers that that also have a set of crds that allow you",
    "start": "1296000",
    "end": "1302480"
  },
  {
    "text": "to express some of the progressive delivery Concepts that we want um with with their own custom resource uh the",
    "start": "1302480",
    "end": "1308960"
  },
  {
    "text": "core the core object that we're going to talk about is the rollout um and you can think of the roll out as basically an enhanced deployment that that provides",
    "start": "1308960",
    "end": "1316360"
  },
  {
    "text": "some of the base features of the deployment but addition Concepts on top of that um for example we have some",
    "start": "1316360",
    "end": "1321600"
  },
  {
    "text": "additional deployment strategies we talked about the recreate strategy in the deployment we also saw the rolling",
    "start": "1321600",
    "end": "1327159"
  },
  {
    "text": "update in action rollouts from Argo rollouts also give you blue green and Canary uh strategies blue green we're",
    "start": "1327159",
    "end": "1334120"
  },
  {
    "text": "not going to talk about as much in this Workshop um but just know that it exists we're mainly going to be focusing on",
    "start": "1334120",
    "end": "1340360"
  },
  {
    "text": "Canary and so a canary deployment um basically comes from the term you know",
    "start": "1340360",
    "end": "1345600"
  },
  {
    "text": "the canary and the coal mine uh which is a pretty brutal thing that you know coal",
    "start": "1345600",
    "end": "1350960"
  },
  {
    "text": "miners used to take a canary in a cage down into the coal mines and that would alert them if there were harmful gases",
    "start": "1350960",
    "end": "1356880"
  },
  {
    "text": "because the canary would die and they know that they would have to get out of the mine before they died um in software",
    "start": "1356880",
    "end": "1362840"
  },
  {
    "text": "it's not as brutal but the concept is the same where you have a a component that you're designated to be this is",
    "start": "1362840",
    "end": "1369279"
  },
  {
    "text": "going to signal if something is is wrong and so for example in the diagram you can see that we have a stable app and",
    "start": "1369279",
    "end": "1376240"
  },
  {
    "text": "that's getting 80% of the traffic and then we have a Canary app that's getting 20% of the traffic and again this goes",
    "start": "1376240",
    "end": "1381799"
  },
  {
    "text": "back to the the whole thing where you reduce the the risk or the blast radius where if something is wrong in your",
    "start": "1381799",
    "end": "1387440"
  },
  {
    "text": "Canary at the most only 20% of your users are impacted that's not great but",
    "start": "1387440",
    "end": "1392600"
  },
  {
    "text": "it's better than 100% um and so we can use Argo rollouts to say achieve this",
    "start": "1392600",
    "end": "1397919"
  },
  {
    "text": "Canary deployment so at a high level before we go into the labs what what actually happens is we have we we create",
    "start": "1397919",
    "end": "1405919"
  },
  {
    "text": "a rollout object uh instead of a deployment object the Argo rollouts controller is what's watching for that",
    "start": "1405919",
    "end": "1412039"
  },
  {
    "text": "and similar to the deployment ultimately it's going to create a replica set as well um and then as we saw with the",
    "start": "1412039",
    "end": "1417919"
  },
  {
    "text": "deployment that is going to result in some pods being created by the replica set controller what's different is that",
    "start": "1417919",
    "end": "1423559"
  },
  {
    "text": "we have this stable kind of designation on this replica set so Argo rollets is",
    "start": "1423559",
    "end": "1429679"
  },
  {
    "text": "tracking what is stable on initial creation stable is immediately applied",
    "start": "1429679",
    "end": "1434799"
  },
  {
    "text": "to the first revision and we scale up all the pods and we're in a healthy State we're stable but when we make a",
    "start": "1434799",
    "end": "1441039"
  },
  {
    "text": "change if we're using a canary what ends up happening is we now create a new replica set that corespond to the canary",
    "start": "1441039",
    "end": "1447240"
  },
  {
    "text": "in this case it's revision two and revision one still stays around it's still stable but we also want to start",
    "start": "1447240",
    "end": "1453679"
  },
  {
    "text": "deploying our Canary app so that we can start testing that in addition to keeping the majority of the traffic on",
    "start": "1453679",
    "end": "1459520"
  },
  {
    "text": "the stable so in our example let's say we had four pods initially and our Canary",
    "start": "1459520",
    "end": "1465760"
  },
  {
    "text": "is going to be a 50/50 Canary 50% canary 50% stable so in the case of the four pods we're going to spin up two new pods",
    "start": "1465760",
    "end": "1473000"
  },
  {
    "text": "and that's going to correspond to revision two Canary so now we have two PODS of revision one four PODS of",
    "start": "1473000",
    "end": "1478760"
  },
  {
    "text": "revision two PODS of revision two four PODS of revision one but we don't want that we only want two of stable so we're",
    "start": "1478760",
    "end": "1485919"
  },
  {
    "text": "going to spin down two of them and so we end up in a position where we have our 50/50 split we're 50% rolled out Canary",
    "start": "1485919",
    "end": "1492559"
  },
  {
    "text": "50% rolled out stable and then we can do testing or whatever to determine whether or not this revision to is healthy and",
    "start": "1492559",
    "end": "1499880"
  },
  {
    "text": "it's good and it turns out our users love it so we're ready to go to the next state we're going to promote that and so",
    "start": "1499880",
    "end": "1506559"
  },
  {
    "text": "when we promote it now revision two becomes stable revision one gets scaled down and it's kept around but we're",
    "start": "1506559",
    "end": "1512399"
  },
  {
    "text": "we're done with it for now so now revision two we're going to spin that up to 100% so we're going to add two more",
    "start": "1512399",
    "end": "1518520"
  },
  {
    "text": "pods so we have our full four pods on revision two and then revision one goes away and now we're in a position where",
    "start": "1518520",
    "end": "1524600"
  },
  {
    "text": "we have all four pods uh on canary on version two to and now that's stable that's not a canary",
    "start": "1524600",
    "end": "1530440"
  },
  {
    "text": "anymore it's working great so let's go ahead and actually see that in action and go back to the labs and do",
    "start": "1530440",
    "end": "1537960"
  },
  {
    "text": "that okay so we're going to learn about Argo",
    "start": "1538760",
    "end": "1544159"
  },
  {
    "text": "rollouts by actually using it so the first thing we need to do is install it",
    "start": "1544159",
    "end": "1549960"
  },
  {
    "text": "um we're going to use the helm command to do that pretty basic nothing special here just installing the roll the the",
    "start": "1549960",
    "end": "1555679"
  },
  {
    "text": "default roll out chart using helm so we're going to go ah and run",
    "start": "1555679",
    "end": "1561279"
  },
  {
    "text": "that",
    "start": "1573520",
    "end": "1576520"
  },
  {
    "text": "and it's taking longer than I would",
    "start": "1579000",
    "end": "1584840"
  },
  {
    "text": "like okay and then we'll check what's in the Argo rollouts",
    "start": "1586039",
    "end": "1591480"
  },
  {
    "text": "namespace we see two pods Argo rollouts pods this is this is the Argo rollouts controller by default you're going to",
    "start": "1591480",
    "end": "1597399"
  },
  {
    "text": "get a couple replicas of it but this is this is the brains of Argo rollouts and",
    "start": "1597399",
    "end": "1602640"
  },
  {
    "text": "so now similar to the deployment right we have to create our object to to manage all this stuff in this case we're",
    "start": "1602640",
    "end": "1608360"
  },
  {
    "text": "going to create the roll out itself but before we do that we'll take a look at the actual",
    "start": "1608360",
    "end": "1613679"
  },
  {
    "text": "manifest um so we have a roll out the Argo project uh V1 alpha 1 API version",
    "start": "1613679",
    "end": "1621320"
  },
  {
    "text": "and for in a lot of ways it's similar to deployment at the bottom right you have a pod template you have a selector which",
    "start": "1621320",
    "end": "1628440"
  },
  {
    "text": "matches the the replica Set uh hash to the pods and so on um and for the most",
    "start": "1628440",
    "end": "1635679"
  },
  {
    "text": "part it's the same what's different is the strategy section here so again if",
    "start": "1635679",
    "end": "1643039"
  },
  {
    "text": "you remember in the deployment we B we had just kind of rolling update strategy and a couple of knobs that that kind of",
    "start": "1643039",
    "end": "1648399"
  },
  {
    "text": "helped with how we want to control that but with Argo rollouts we get much more sophisticated Tooling in this case we're",
    "start": "1648399",
    "end": "1654399"
  },
  {
    "text": "saying we want to do a canary strategy for our roll out and we Define a set of steps that are taken in order to",
    "start": "1654399",
    "end": "1660240"
  },
  {
    "text": "progress through the canary until you can fully promote it to where you know that you're you're ready to promote what",
    "start": "1660240",
    "end": "1665799"
  },
  {
    "text": "was the canary now to stable and so in this example we have the first step is",
    "start": "1665799",
    "end": "1671559"
  },
  {
    "text": "we have a set weight to 25 so that's saying 25% goes to the to the canary and",
    "start": "1671559",
    "end": "1677000"
  },
  {
    "text": "then we have a pause in this case it's an empty pause which means an indefinite pause so you need some manual",
    "start": "1677000",
    "end": "1682919"
  },
  {
    "text": "interaction to promote it Beyond this pause step uh in in most real use cases",
    "start": "1682919",
    "end": "1688919"
  },
  {
    "text": "you probably don't want to use a manual pause but for things like this it's great and maybe there is a case that you",
    "start": "1688919",
    "end": "1695279"
  },
  {
    "text": "want to have manual um interaction to move beyond your Canary while you're still getting used to uh argor rollets",
    "start": "1695279",
    "end": "1701399"
  },
  {
    "text": "and so on but in our case it's an indefinite pause we're going to have to perform a step manually to promote it",
    "start": "1701399",
    "end": "1706919"
  },
  {
    "text": "beyond that then the next step we go to 50% weight another indefinite pause then",
    "start": "1706919",
    "end": "1712200"
  },
  {
    "text": "75% weight and then lastly we pause for 10 seconds before we finish and we're",
    "start": "1712200",
    "end": "1717679"
  },
  {
    "text": "promoting the the canary now to stable that's the full completion of the canary um okay so nothing too crazy",
    "start": "1717679",
    "end": "1726440"
  },
  {
    "text": "there let's go ahead and apply it and we should see it in action so I'm going to go ahead and apply it",
    "start": "1726440",
    "end": "1733919"
  },
  {
    "text": "okay and then we'll do a get on the rollouts specific resource and all to see what else was",
    "start": "1738240",
    "end": "1744600"
  },
  {
    "text": "spun up so we get the roll out at the top similar to the deployment we have",
    "start": "1744600",
    "end": "1750080"
  },
  {
    "text": "Columns of you know the desired count and the current count and so on then we have the pods themselves they also have",
    "start": "1750080",
    "end": "1756640"
  },
  {
    "text": "the suffix of a hash and then we have the replica set as well similarly with that suffix of the",
    "start": "1756640",
    "end": "1763600"
  },
  {
    "text": "hash and so nothing too different here again on remember how in the deployment",
    "start": "1763600",
    "end": "1769159"
  },
  {
    "text": "the initial step it scaled all the way to the Full Count same thing with a roll out there's no Canary done on the",
    "start": "1769159",
    "end": "1774440"
  },
  {
    "text": "initial creation if we modify this though then we'll do a canary step or then we'll kick off our Canary and go",
    "start": "1774440",
    "end": "1780399"
  },
  {
    "text": "through the steps that are defined in our uh Canary strategy so in order to get a little bit",
    "start": "1780399",
    "end": "1787240"
  },
  {
    "text": "more detail on this roll out um again this is custom resource we could look at the yaml but",
    "start": "1787240",
    "end": "1793399"
  },
  {
    "text": "what we really want is a little bit more richer information on the status of this roll out there is a cube CTL plugin uh",
    "start": "1793399",
    "end": "1800360"
  },
  {
    "text": "that's part of Argo rollouts um we have it downloaded on the VM to save some time it's available as from their GitHub",
    "start": "1800360",
    "end": "1807279"
  },
  {
    "text": "and so on um but just to kind of prove that it's available we'll do some commands that show that so we did a",
    "start": "1807279",
    "end": "1814360"
  },
  {
    "text": "witch on the cubec Argo rollouts which is kind of the standard convention for cube CTL plugins we have it in our path",
    "start": "1814360",
    "end": "1820880"
  },
  {
    "text": "which means that it's available to cctl and then we ran the version command on it to kind of show that yes it exists",
    "start": "1820880",
    "end": "1826760"
  },
  {
    "text": "and it's working um so what we'll do is we're going to use that the so the",
    "start": "1826760",
    "end": "1833080"
  },
  {
    "text": "command that we're going to run is Cube C Argo rollouts get roll out and then",
    "start": "1833080",
    "end": "1838360"
  },
  {
    "text": "the roll out name and so this is using the plugin to give us some rich data on the roll out so if we run",
    "start": "1838360",
    "end": "1844519"
  },
  {
    "text": "that we can see something that has a little more context on the roll out specific stuff so we see that we're",
    "start": "1844519",
    "end": "1851440"
  },
  {
    "text": "healthy we're using a canary that has six steps we're currently at 100% weight",
    "start": "1851440",
    "end": "1856639"
  },
  {
    "text": "because we're we're at the first part and then we have one revision that has",
    "start": "1856639",
    "end": "1861760"
  },
  {
    "text": "you know this replica set and these pods associated with it so now that we can now that we can kind of visualize some",
    "start": "1861760",
    "end": "1868519"
  },
  {
    "text": "of the details of the canary let's goad and promote it or let's go ahead and make a change so that we can see the canary actually kick off in this case",
    "start": "1868519",
    "end": "1875159"
  },
  {
    "text": "we're going to use that same plugin to um set the image similar to how we did with the deployments but because qctl",
    "start": "1875159",
    "end": "1882080"
  },
  {
    "text": "doesn't understand the roll outs uh resource we have to use something that understands it in this case the rollouts",
    "start": "1882080",
    "end": "1887679"
  },
  {
    "text": "pluged so if we run this command to set the image we're going to set that version to Yellow um and we're going to kick off a",
    "start": "1887679",
    "end": "1894399"
  },
  {
    "text": "canary so we've updated it and now we can check the status what we're going to",
    "start": "1894399",
    "end": "1900000"
  },
  {
    "text": "do is the very simple get the roll out and now we can see some more interesting",
    "start": "1900000",
    "end": "1906080"
  },
  {
    "text": "stuff so the status is that it's progressing and we're still waiting for some replicas to be updated we have two",
    "start": "1906080",
    "end": "1912639"
  },
  {
    "text": "versions or two images we have the stable at Blue and the change that we just made yellow is now a canary",
    "start": "1912639",
    "end": "1918760"
  },
  {
    "text": "and then when we look at kind of the the tree view we have our roll outs one had two pods terminating because this is the",
    "start": "1918760",
    "end": "1925120"
  },
  {
    "text": "25% step and then we have two pods spinning up for the new rollout um this",
    "start": "1925120",
    "end": "1931159"
  },
  {
    "text": "was in the progression state so if we run it one more time we've probably given enough time to where now we're in",
    "start": "1931159",
    "end": "1937120"
  },
  {
    "text": "a pause state so we've officially got to the pause state where we have 25% in other words two pods in Canary and then",
    "start": "1937120",
    "end": "1944440"
  },
  {
    "text": "we have six pods the stable state of the old version um so yeah so this is what it should",
    "start": "1944440",
    "end": "1951320"
  },
  {
    "text": "look like and then what we can do is just take another look at what was created similar to how we've been doing",
    "start": "1951320",
    "end": "1956399"
  },
  {
    "text": "it before we have our two replica sets that correspond to the two versions and the pods that are existing",
    "start": "1956399",
    "end": "1962600"
  },
  {
    "text": "today so now we're in a state where we're paused and again this is a manual pause this is an indefinite pause that",
    "start": "1962600",
    "end": "1969639"
  },
  {
    "text": "requires some manual interaction um so what we can do again is use that that qctl plugin to promote it um so we're",
    "start": "1969639",
    "end": "1977200"
  },
  {
    "text": "going to do two Comm commands here we're going to use the qctl plugin to do an",
    "start": "1977200",
    "end": "1982440"
  },
  {
    "text": "actual roll out promote of the roll out that we care about and then we're going to watch for how that Pro how that",
    "start": "1982440",
    "end": "1991080"
  },
  {
    "text": "progresses okay yeah so what's happening is we we made",
    "start": "1991080",
    "end": "1998039"
  },
  {
    "text": "it progress ourself and now we're getting to the 50% state where we have",
    "start": "1998039",
    "end": "2003760"
  },
  {
    "text": "and as you can see I have the dash dash watch on this so it's constantly updating so we have four now of the",
    "start": "2003760",
    "end": "2010279"
  },
  {
    "text": "canary and four of the stable and so we're now paused again if I get out of",
    "start": "2010279",
    "end": "2017320"
  },
  {
    "text": "this now we're paused again because we're at the pause step again so we're going to go ahead and promote it again",
    "start": "2017320",
    "end": "2022399"
  },
  {
    "text": "but this time we're going to use the roll outs dashboard to do that um so we'll switch to Terminal Two so at the",
    "start": "2022399",
    "end": "2028799"
  },
  {
    "text": "top there's a couple of tabs that we're going to be using throughout the lab this time we're going to switch to Terminal Two you can also click this",
    "start": "2028799",
    "end": "2034240"
  },
  {
    "text": "link here to take you there um and then we're going to use that plug in again to run the dashboard command really this is",
    "start": "2034240",
    "end": "2041000"
  },
  {
    "text": "doing a port forward to the control plane pod um so we're going to run that",
    "start": "2041000",
    "end": "2046200"
  },
  {
    "text": "you can ignore this error and then this other tab here Argo rollets dashboard if",
    "start": "2046200",
    "end": "2051800"
  },
  {
    "text": "you click on that what should happen is that we see the rollouts dashboard now",
    "start": "2051800",
    "end": "2058679"
  },
  {
    "text": "and so we only have one roll out but we can click into this to get some more detail um you can see that for example",
    "start": "2058679",
    "end": "2064240"
  },
  {
    "text": "it has the list of steps right now we're currently in the pause step after the 50% weit um and it's waiting for",
    "start": "2064240",
    "end": "2070720"
  },
  {
    "text": "promotion so we can actually use the UI to do it this time we're going to hit promote and then yes we're",
    "start": "2070720",
    "end": "2076040"
  },
  {
    "text": "sure and so you can see it's now on the 75% um step two new pods just spun up",
    "start": "2076040",
    "end": "2082240"
  },
  {
    "text": "two pods are spinning down so now we're going to have six PODS of yellow two PODS of blue and then once these",
    "start": "2082240",
    "end": "2088040"
  },
  {
    "text": "terminate now we're in the pause step this time it's a 10-second pause so we're you know 10 seconds are going to",
    "start": "2088040",
    "end": "2093480"
  },
  {
    "text": "go by and then this is actually going to finish promote we're going to be at now what is the canary is going to be",
    "start": "2093480",
    "end": "2100560"
  },
  {
    "text": "stable the old version is going to spin down and then we're going to be at kind of our our standard healthy um state for",
    "start": "2100560",
    "end": "2107520"
  },
  {
    "text": "our roll out okay so we're",
    "start": "2107520",
    "end": "2114359"
  },
  {
    "text": "good so let's go back to terminal one and then what we'll do is get the status",
    "start": "2114760",
    "end": "2121240"
  },
  {
    "text": "uh see the events you know we don't have to go through every single one right but this is similar to how we did with our",
    "start": "2121240",
    "end": "2126520"
  },
  {
    "text": "deployment the events on resource will track what is happening um okay so what happens if things don't go wrong how can",
    "start": "2126520",
    "end": "2133440"
  },
  {
    "text": "the canary help us with that so what we're going to do now is do another promotion or another change that will",
    "start": "2133440",
    "end": "2140160"
  },
  {
    "text": "this time set it to an image that says uh bad- purple the demo app has images",
    "start": "2140160",
    "end": "2148040"
  },
  {
    "text": "with the bad prefix that will randomly return errors and so we're not going to",
    "start": "2148040",
    "end": "2153160"
  },
  {
    "text": "actually see too much of that here but this is kind of we're going to use it later in the later Labs but basically no know that this is representing a bad",
    "start": "2153160",
    "end": "2159880"
  },
  {
    "text": "version where some bug was introduced and so errors are going to be returned when it should be returning a healthy response so we're going to make this",
    "start": "2159880",
    "end": "2166160"
  },
  {
    "text": "update and we're going to watch it as it updates and so we see our new canaries",
    "start": "2166160",
    "end": "2171440"
  },
  {
    "text": "kicking off for the new version it's running and the old versions are are terminating um but again this one has",
    "start": "2171440",
    "end": "2177400"
  },
  {
    "text": "failures we're not going to see them just yet but we'll see in this next Lab um so what we need to do is we need to",
    "start": "2177400",
    "end": "2183480"
  },
  {
    "text": "roll back so we can do that",
    "start": "2183480",
    "end": "2188480"
  },
  {
    "text": "by using the abort the abort command roll outs abort so again that's built",
    "start": "2189560",
    "end": "2195119"
  },
  {
    "text": "into the the plugin and so this time we're going to say we need to abort it's not great we're going to roll back and",
    "start": "2195119",
    "end": "2201599"
  },
  {
    "text": "then we're also going to watch what happens as we do that so we're in this degraded status",
    "start": "2201599",
    "end": "2207440"
  },
  {
    "text": "now where this this replica set was not great um and so the new stuff rather",
    "start": "2207440",
    "end": "2213400"
  },
  {
    "text": "than promoting and going for beyond that is terminating we're scaling down the new version um so we're now on back to",
    "start": "2213400",
    "end": "2219640"
  },
  {
    "text": "the division to the stable but we're in this degraded state so what we want to do now is fix",
    "start": "2219640",
    "end": "2226839"
  },
  {
    "text": "that degraded state where we're going to roll back to",
    "start": "2226839",
    "end": "2232800"
  },
  {
    "text": "a version that we know is good and so what we're going to do is run the command to do that we're going to set",
    "start": "2232800",
    "end": "2237920"
  },
  {
    "text": "the image this time to purple we made we fixed the the problem and now we're deploying the new version and we we",
    "start": "2237920",
    "end": "2244680"
  },
  {
    "text": "caught the fact that it was bad when only 25 % of the users were exposed to it so we we we built this new image and",
    "start": "2244680",
    "end": "2252160"
  },
  {
    "text": "it's working great that we think in development so let's go ahead and push it out with the",
    "start": "2252160",
    "end": "2257400"
  },
  {
    "text": "canary and so we'll watch it again so revision three was scaled down but now revision four comes in with our fixed",
    "start": "2257400",
    "end": "2264040"
  },
  {
    "text": "version and we can see it progress and run so we we fixed it and now we're",
    "start": "2264040",
    "end": "2270960"
  },
  {
    "text": "super confident that this new version's good we don't want to go through every single step so we're going to go ahead",
    "start": "2270960",
    "end": "2276040"
  },
  {
    "text": "and do a full promotion to get it all the way to stable because we're that confident in it and we can do that with",
    "start": "2276040",
    "end": "2281480"
  },
  {
    "text": "another command which will do um the argor rollets promote command that we've been using but then we're adding this uh",
    "start": "2281480",
    "end": "2288000"
  },
  {
    "text": "full flag that didn't look right this full flag at the end which is saying",
    "start": "2288000",
    "end": "2293599"
  },
  {
    "text": "basically skip all of the steps in the canary and go directly to uh promote it completely um I'm going to not run that",
    "start": "2293599",
    "end": "2300440"
  },
  {
    "text": "because it doesn't look right but yeah so you run that command and then now we're watching",
    "start": "2300440",
    "end": "2306160"
  },
  {
    "text": "where we immediately went um from the we're we're merely jumping",
    "start": "2306160",
    "end": "2311280"
  },
  {
    "text": "to the end of the roll out and so you can see that as as the",
    "start": "2311280",
    "end": "2317599"
  },
  {
    "text": "canary got to healthy for all of the pods now the pods from the the stable",
    "start": "2317599",
    "end": "2322720"
  },
  {
    "text": "are are being terminated okay so that's it for this",
    "start": "2322720",
    "end": "2331560"
  },
  {
    "text": "lab we let's go and clean up our roll out before we move on and then we're",
    "start": "2331560",
    "end": "2337560"
  },
  {
    "text": "going to do check and go to the next Lab so we saw a bunch of cool stuff with",
    "start": "2337560",
    "end": "2347040"
  },
  {
    "text": "actual deployments or the actual pods right the actual workload management where we spun up new pods we were able",
    "start": "2347040",
    "end": "2352440"
  },
  {
    "text": "to rever uh revert that do it in a progressive manner but we actually didn't see any traffic flow so Argo",
    "start": "2352440",
    "end": "2359359"
  },
  {
    "text": "rollouts integrates with traffic providers um and we're going to go to the slides and kind of talk about this a little bit so aside from the the the",
    "start": "2359359",
    "end": "2368520"
  },
  {
    "text": "workloads themselves roll outs can integrate with various mechanisms of traffic control um it can it integrates",
    "start": "2368520",
    "end": "2374880"
  },
  {
    "text": "with directly with kuber Services where you have services that select you say you have a canary service and a stable",
    "start": "2374880",
    "end": "2380319"
  },
  {
    "text": "service those services will be updated with their selectors so that your Canary service always points to the canary pods",
    "start": "2380319",
    "end": "2386640"
  },
  {
    "text": "and the canary pods only and stable points to stable only um but it also integrates with service mesh and Ingress",
    "start": "2386640",
    "end": "2393560"
  },
  {
    "text": "components that allow you to basically integrate with the data plane of those providers to where rather than relying",
    "start": "2393560",
    "end": "2398920"
  },
  {
    "text": "on something like just replica count you can use the proxy of the of the service mes or of Ingress to control you know",
    "start": "2398920",
    "end": "2406520"
  },
  {
    "text": "weighted routing without relying on replica count you're basically telling Envoy or whatever I want 75% to go here",
    "start": "2406520",
    "end": "2412880"
  },
  {
    "text": "you don't have to say I need 10 pods if I want to go in 10% increments you can directly configure the the data plane to",
    "start": "2412880",
    "end": "2418480"
  },
  {
    "text": "do that and with that you also get some more advanced layer 7 control so for example you can have header based",
    "start": "2418480",
    "end": "2424760"
  },
  {
    "text": "routing for a canary and so on so so this is a screenshot directly from the docs of the Native providers for Traffic",
    "start": "2424760",
    "end": "2432079"
  },
  {
    "text": "Control you see there's a pretty good list um for this lab we picked sto we're",
    "start": "2432079",
    "end": "2437520"
  },
  {
    "text": "familiar with it it has native integration with Argo rollouts all of the traffic control control features in",
    "start": "2437520",
    "end": "2442720"
  },
  {
    "text": "Argo rollouts work with ISO it's also cncf graduated the other nice thing about it",
    "start": "2442720",
    "end": "2448079"
  },
  {
    "text": "is it has its own API which is part of the Native integration it also has support for the Gateway API um which",
    "start": "2448079",
    "end": "2453599"
  },
  {
    "text": "we're going to talk about later so that comes in handy and then there's also a rich set of metrics in iio out of the",
    "start": "2453599",
    "end": "2458800"
  },
  {
    "text": "box um that we're going to explore later as well so kind of just quickly showing how that work how the service uh stuff",
    "start": "2458800",
    "end": "2465160"
  },
  {
    "text": "works again we have our two stable service and can Canary service at the bottom the Hat the selector is not going",
    "start": "2465160",
    "end": "2471480"
  },
  {
    "text": "to be great because again the the PODS of the rollouts have that hash that",
    "start": "2471480",
    "end": "2476680"
  },
  {
    "text": "corresponds to the revision in the case of Argo rollouts we need a stable and a canary selector and what Argo rollets",
    "start": "2476680",
    "end": "2484000"
  },
  {
    "text": "can do is when you define which your what your services are for tra trff management the Argo rollouts controller",
    "start": "2484000",
    "end": "2489920"
  },
  {
    "text": "itself will modify your services to update the selector to include those hashes as their as they're needed um so",
    "start": "2489920",
    "end": "2497599"
  },
  {
    "text": "in this example right before we were on revision one and so we're at our stable",
    "start": "2497599",
    "end": "2502760"
  },
  {
    "text": "place now the roets controller is going to say now for stable here are all the revision here is only revision one so",
    "start": "2502760",
    "end": "2508960"
  },
  {
    "text": "that's the stable and the canary then when we're in a state where we're doing a canary and we're say we're at the 50/50 split now the stable service only",
    "start": "2508960",
    "end": "2516640"
  },
  {
    "text": "points to the the pods that have the hash for the stable and the canary service only points to the pods",
    "start": "2516640",
    "end": "2522200"
  },
  {
    "text": "corresponding to the canary and then when you do the promotion now revision two is stable now you're back where the",
    "start": "2522200",
    "end": "2527880"
  },
  {
    "text": "stable and Canary service select the PODS of stable which is all that's there then we again we can go a layer",
    "start": "2527880",
    "end": "2534960"
  },
  {
    "text": "beyond that which is integration with the traffic provider in this case ISO um so right now we're in the state where we're 50/50 what Argo rollets can do is",
    "start": "2534960",
    "end": "2542880"
  },
  {
    "text": "at least with IO the virtual service is kind of the core routing Concept in iio the implementation is not super",
    "start": "2542880",
    "end": "2548480"
  },
  {
    "text": "important for what we're trying to to show but basically Argo rollouts will integrate with sto configure the virtual",
    "start": "2548480",
    "end": "2554359"
  },
  {
    "text": "service directly to control the route the weighted routing and then by doing that now the stod the control plane ofo",
    "start": "2554359",
    "end": "2562680"
  },
  {
    "text": "will see that and it will program its data plane to reflect that so even though we're in a position where we have",
    "start": "2562680",
    "end": "2568319"
  },
  {
    "text": "two pods stable two pods um Canary what we did is we modified the virtual",
    "start": "2568319",
    "end": "2573960"
  },
  {
    "text": "service to to update weighted routing we can do something like where the stable is still getting 75% but the canary is",
    "start": "2573960",
    "end": "2580520"
  },
  {
    "text": "getting 25% even though there's two pods each so if you wanted to you could do like 1% right um but it kind of the the",
    "start": "2580520",
    "end": "2588480"
  },
  {
    "text": "power is that it allows you to use the the features of your underlying traffic provider still integrated with your",
    "start": "2588480",
    "end": "2595359"
  },
  {
    "text": "Canary okay so let's actually see that in action so argor of traffic",
    "start": "2595359",
    "end": "2602319"
  },
  {
    "text": "control you should be at a screen like this and so as as I said we're going to",
    "start": "2602319",
    "end": "2607599"
  },
  {
    "text": "use ISO the first thing we need to do is install it um ioctl is the tool for that it's already on the VM you can just go",
    "start": "2607599",
    "end": "2614599"
  },
  {
    "text": "and run this command to install it again the specifics of s are not super important um so you know it's not it's",
    "start": "2614599",
    "end": "2621160"
  },
  {
    "text": "not super relevant um because what we're trying to show is that the integration is what what provides the",
    "start": "2621160",
    "end": "2627200"
  },
  {
    "text": "power um so we're going to wait for that to",
    "start": "2627200",
    "end": "2631440"
  },
  {
    "text": "install Okay and then we'll just do a quick check in the iso system namespace we now have isod again that's the",
    "start": "2635359",
    "end": "2641480"
  },
  {
    "text": "control plane and our inis Gateway that's how we get traffic into wherever",
    "start": "2641480",
    "end": "2647359"
  },
  {
    "text": "we need it to go in our case our demo app so then this is going to a little bit of infrastructure stuff uh we're",
    "start": "2647359",
    "end": "2654319"
  },
  {
    "text": "using metal lb on the VMS or on the kind cluster to give us load balance or service IPS um this is just grabbing",
    "start": "2654319",
    "end": "2661400"
  },
  {
    "text": "that IP so we can make requests to it um so go ahead and run that and then you have you'll have that in the gateway address environment",
    "start": "2661400",
    "end": "2668000"
  },
  {
    "text": "variable um okay so let's actually do some routing so the first thing we're going to do is create our services that",
    "start": "2668000",
    "end": "2675440"
  },
  {
    "text": "correspond to our application um we also output them so we have a canary service",
    "start": "2675440",
    "end": "2680520"
  },
  {
    "text": "and a stable service and you'll see the selector has the basic app rollout demo",
    "start": "2680520",
    "end": "2686400"
  },
  {
    "text": "but the hash that corresponds to different revisions is not present it's commented out because we we don't know",
    "start": "2686400",
    "end": "2692760"
  },
  {
    "text": "that Argo rollouts knows that and Argo roll outs is going to directly modify this selector to have the correct hash",
    "start": "2692760",
    "end": "2698680"
  },
  {
    "text": "as we proceed through the canary um so we have our services created then we're",
    "start": "2698680",
    "end": "2704000"
  },
  {
    "text": "going to create our basic ISO routing again the details aren't super important but we'll quickly look at them um we",
    "start": "2704000",
    "end": "2710680"
  },
  {
    "text": "have a virtual service which is that kind of core routing Concept in ISO um and what we have is a single route",
    "start": "2710680",
    "end": "2717760"
  },
  {
    "text": "that's called primary and there's two destinations 100% go to the stable app",
    "start": "2717760",
    "end": "2723520"
  },
  {
    "text": "and 0% go to the canary app and then we have a gateway it's not really relevant uh it's basically just exposing it at",
    "start": "2723520",
    "end": "2729800"
  },
  {
    "text": "the Gateway um okay so if we were to access the app now we would always go to the the canary or always go to the",
    "start": "2729800",
    "end": "2736240"
  },
  {
    "text": "stable app because that's getting 100% of the traffic um but to actually get some traffic let's actually go ahead and",
    "start": "2736240",
    "end": "2741839"
  },
  {
    "text": "apply a roll out spin up our pods and then we can use that as our back end um so what we're going to do is apply a new",
    "start": "2741839",
    "end": "2747760"
  },
  {
    "text": "manifest but there's slight differences from what we did in the previous lab so we're going to take a look at that um one thing that you'll notice is",
    "start": "2747760",
    "end": "2755720"
  },
  {
    "text": "that I just made it much simpler of a roll out because we don't care so much we saw the steps and all that this case",
    "start": "2755720",
    "end": "2761160"
  },
  {
    "text": "we're only going to do a 25% wait and then an indefinite pause the really interesting thing is that now in the",
    "start": "2761160",
    "end": "2767359"
  },
  {
    "text": "canary strategy we have a canary service defined which corresponds to that service and a stable Service as well and",
    "start": "2767359",
    "end": "2774160"
  },
  {
    "text": "then we have our traffic routing section where we specify ISO and then we're actually putting the virtual service and",
    "start": "2774160",
    "end": "2780480"
  },
  {
    "text": "Route name that we care about and this is basically so these lines are saying I want Argo rollouts to when you're doing",
    "start": "2780480",
    "end": "2787839"
  },
  {
    "text": "the canary I want you to modify the canary service name this the stable service name this and I'm going to use",
    "start": "2787839",
    "end": "2793880"
  },
  {
    "text": "the isio provider and I want you to actually modify my virtual service that has this name and this specific route",
    "start": "2793880",
    "end": "2801640"
  },
  {
    "text": "the other thing is that now since we're using a a uh what do you call it a traffic provider we're using ISO to",
    "start": "2801640",
    "end": "2807480"
  },
  {
    "text": "manage our weighted routing we actually don't need eight replicas to show it we can even use one and we can still do",
    "start": "2807480",
    "end": "2814400"
  },
  {
    "text": "fine grain control okay so let's go ahead and just make sure that everything was created yes but",
    "start": "2814400",
    "end": "2823520"
  },
  {
    "text": "yes okay so what I'm showing here is that in the virtual service if we look back at the strategy we said virtual",
    "start": "2823520",
    "end": "2829200"
  },
  {
    "text": "service named roll outs demo routes primary and then this is a subset of the virtual service that was applied to the",
    "start": "2829200",
    "end": "2834920"
  },
  {
    "text": "cluster where this this route is named primary so Argo rollout is directly going to modify this section to control",
    "start": "2834920",
    "end": "2842160"
  },
  {
    "text": "the weight as we proceed through the the canary so let's apply our role",
    "start": "2842160",
    "end": "2848000"
  },
  {
    "text": "out and let's get the resources and everything so we have our single pod",
    "start": "2848000",
    "end": "2855000"
  },
  {
    "text": "again single replica we have our replica set and we have some ISO resources",
    "start": "2855000",
    "end": "2860480"
  },
  {
    "text": "working or created and hopefully working so now that we've created that",
    "start": "2860480",
    "end": "2866920"
  },
  {
    "text": "what will happen is the service selector should already have been updated so what we just did let me actually copy and",
    "start": "2866920",
    "end": "2873079"
  },
  {
    "text": "paste that one so what we're getting is the stable",
    "start": "2873079",
    "end": "2879240"
  },
  {
    "text": "service from the cluster and we're going to take a look at it and if if you look there are a couple",
    "start": "2879240",
    "end": "2885000"
  },
  {
    "text": "of things that have happened so there's now this annotation that says managed by Argo rollouts this signifies that this",
    "start": "2885000",
    "end": "2890559"
  },
  {
    "text": "service has been modified and is now being controlled by Argo rollouts and then the selector itself has this roll",
    "start": "2890559",
    "end": "2896640"
  },
  {
    "text": "outs pod template hash with the hash that corresponds to the stable version and we can kind of prove that by doing",
    "start": "2896640",
    "end": "2904440"
  },
  {
    "text": "this command where we are going to get the roll out and we see that this",
    "start": "2904440",
    "end": "2909839"
  },
  {
    "text": "this revision is the 687 and we can see that our our service selector was",
    "start": "2909839",
    "end": "2915079"
  },
  {
    "text": "updated to have that as well and then because this is the",
    "start": "2915079",
    "end": "2920359"
  },
  {
    "text": "initial creation both the canary and the stable are the same thing we can kind of prove that that service selection was",
    "start": "2920359",
    "end": "2926440"
  },
  {
    "text": "done so both the canary and the stable have the same hash okay so let's go ahead and actually",
    "start": "2926440",
    "end": "2932559"
  },
  {
    "text": "send some traffic to it um we're making a request to that gateway address SLC color and we can see that it's",
    "start": "2932559",
    "end": "2938520"
  },
  {
    "text": "responding with blue so our endpoint is being routed to and we're getting blue as our um",
    "start": "2938520",
    "end": "2946079"
  },
  {
    "text": "response and then now what we're going to do is actually port forward so we're going to actually try and access this",
    "start": "2946280",
    "end": "2952160"
  },
  {
    "text": "application in the UI so we can actually see the colors and everything so we're going to switch to Terminal 2 and run a port forward this is NE like the way",
    "start": "2952160",
    "end": "2958920"
  },
  {
    "text": "that instruct is set up we have to do this so we can access it like we're basically going to be accessing into the",
    "start": "2958920",
    "end": "2964119"
  },
  {
    "text": "VM directly from an external uh CL client which is our browser so we're running this port forward so that we can",
    "start": "2964119",
    "end": "2970240"
  },
  {
    "text": "route to it and then you can switch this demo app tab um either by clicking on it or by using this link and it's going to",
    "start": "2970240",
    "end": "2977280"
  },
  {
    "text": "actually open up in a new window and you should see something like",
    "start": "2977280",
    "end": "2982440"
  },
  {
    "text": "this and so since we're at Blue we only have one version everything is blue so if we go back to our",
    "start": "2982440",
    "end": "2990160"
  },
  {
    "text": "lab we'll go back to terminal one and now let's actually make some changes and see what happens so now let's make a change and",
    "start": "2990160",
    "end": "2998559"
  },
  {
    "text": "we're going to do this by applying the Manifest rather than doing a imperative command to change the the version we're",
    "start": "2998559",
    "end": "3003960"
  },
  {
    "text": "going to apply a version that the only difference is from Blue to Yellow so we'll apply",
    "start": "3003960",
    "end": "3009119"
  },
  {
    "text": "it and now there's a change and so if you remember our step the first step was",
    "start": "3009119",
    "end": "3014319"
  },
  {
    "text": "go 25% to the new version so if we go back to our demo app what we should see is 20 roughly 25% is going to be yellow",
    "start": "3014319",
    "end": "3023040"
  },
  {
    "text": "so the roll out has progressed it's a canary we're 25% and now we're at a place where we're manually paused",
    "start": "3023040",
    "end": "3028200"
  },
  {
    "text": "waiting for interaction but you can see that the you know there's 25% actually going to Yellow the rest of it 75% going",
    "start": "3028200",
    "end": "3034760"
  },
  {
    "text": "to Blue um and we're doing that with one replica count so we can look a little bit deeper",
    "start": "3034760",
    "end": "3041680"
  },
  {
    "text": "we can see the virtual service and we can see that now that that route that we were talking about actually has the 7525",
    "start": "3041680",
    "end": "3048920"
  },
  {
    "text": "split that was made by the argor worlds controller directly modifying the virtual service to do",
    "start": "3048920",
    "end": "3054079"
  },
  {
    "text": "that um and then if we check the services is now we see that there are different hashes the stable has the old",
    "start": "3054079",
    "end": "3060559"
  },
  {
    "text": "one and Canary has the new one and then lastly we can we can",
    "start": "3060559",
    "end": "3065839"
  },
  {
    "text": "compare that from the roll out itself and see that the the canary has this hash which matches our service uh our",
    "start": "3065839",
    "end": "3072280"
  },
  {
    "text": "service selector here and then the stable has this hatch which matches matches here um so it's paused so let's",
    "start": "3072280",
    "end": "3078960"
  },
  {
    "text": "go ahead and promote that to 100% by running the kind of commands that we've been seen um actually I'm going to go",
    "start": "3078960",
    "end": "3085319"
  },
  {
    "text": "ahead and kill the watch and run that just run that First",
    "start": "3085319",
    "end": "3091520"
  },
  {
    "text": "Command um so we promoted it we promoted it so now we can go back",
    "start": "3092520",
    "end": "3098640"
  },
  {
    "text": "to our UI and we promoted it to our new stable is yellow and so now blue goes",
    "start": "3098640",
    "end": "3104599"
  },
  {
    "text": "away it's all yellow and so we've done our Canary we we did our testing or whatever we confirmed that it looks good",
    "start": "3104599",
    "end": "3110720"
  },
  {
    "text": "and now we're we're purely rioting to the new the new stuff okay and then one last Advanced",
    "start": "3110720",
    "end": "3117599"
  },
  {
    "text": "feature um again with with the traffic providers we get extra stuff one of them is header-based routing so in this",
    "start": "3117599",
    "end": "3123960"
  },
  {
    "text": "example we're going to do is we're going to apply a new change to our uh roll out",
    "start": "3123960",
    "end": "3130079"
  },
  {
    "text": "and now we're going to have this manage routes section where we we're defining a",
    "start": "3130079",
    "end": "3135559"
  },
  {
    "text": "another route name which is Canary Das header and then we have a step now after",
    "start": "3135559",
    "end": "3140920"
  },
  {
    "text": "the 25% step to where what we want to do is set the header route to for this",
    "start": "3140920",
    "end": "3146799"
  },
  {
    "text": "Canary header using that using that name that we have up here the managed route what we want to do is we want to match",
    "start": "3146799",
    "end": "3152280"
  },
  {
    "text": "based on a header of X rollout Canary and if the if the value is true of that",
    "start": "3152280",
    "end": "3158200"
  },
  {
    "text": "header on the request that will route 100% to the canary and so what we saw on",
    "start": "3158200",
    "end": "3163640"
  },
  {
    "text": "the demo app is that it's completely weighted it's completely weight based where 75% traffic regardless is going to",
    "start": "3163640",
    "end": "3169720"
  },
  {
    "text": "go to the stable version 25% to the canary with this feature we can know that 100% with that header will go to to",
    "start": "3169720",
    "end": "3176599"
  },
  {
    "text": "the canary which allows us to do things like user testing or or whatever we want to do without having to worry about you",
    "start": "3176599",
    "end": "3182640"
  },
  {
    "text": "know 75% of the time I'm not going to hit the new the new version so if we apply",
    "start": "3182640",
    "end": "3188798"
  },
  {
    "text": "that and then we make sure that that is running yep so we're at revision",
    "start": "3188839",
    "end": "3195200"
  },
  {
    "text": "two um we didn't actually make a change to the spec so nothing actually kicked off so we're going to make an actual",
    "start": "3195200",
    "end": "3202119"
  },
  {
    "text": "change that changes it to Orange and now what we can do is let's",
    "start": "3202119",
    "end": "3207280"
  },
  {
    "text": "just make sure that we're paused on step two of three so we set the weight we set the header route and now we're paused if",
    "start": "3207280",
    "end": "3213720"
  },
  {
    "text": "we go back to the demo app we'll see yellow and orange and we'll also be able",
    "start": "3213720",
    "end": "3220119"
  },
  {
    "text": "to hit the canary 100% of the time with our header so to prove that let's first",
    "start": "3220119",
    "end": "3225359"
  },
  {
    "text": "check the virtual service and we'll see that the actual virtual service was modified to have this um header match we",
    "start": "3225359",
    "end": "3232480"
  },
  {
    "text": "now ex roll out Canary with the True Value if that's if that is present you",
    "start": "3232480",
    "end": "3237760"
  },
  {
    "text": "go 100% of the time to the rollouts demo Canary destination otherwise you do the standard 75 25 uh split and we can we",
    "start": "3237760",
    "end": "3246520"
  },
  {
    "text": "can try that by doing a 10 we're going",
    "start": "3246520",
    "end": "3251839"
  },
  {
    "text": "to do 10 curls with the header present and we're going to see orange every time regardless of the waiting and then what",
    "start": "3251839",
    "end": "3258480"
  },
  {
    "text": "we can do is run the same command without the header and we should see a split of yellow and orange so with the",
    "start": "3258480",
    "end": "3264520"
  },
  {
    "text": "header present 100% that'll allows us to do whatever testing we need um and then otherwise you're going to go through",
    "start": "3264520",
    "end": "3270000"
  },
  {
    "text": "your standard weighted routing okay so we know we're good let's go ahead and promote it to its final",
    "start": "3270000",
    "end": "3277280"
  },
  {
    "text": "State and then we can check the app again and now we're all orange okay",
    "start": "3277280",
    "end": "3283599"
  },
  {
    "text": "so let's go ahead and do some cleanup and then we're ready to go to the next",
    "start": "3283599",
    "end": "3289558"
  },
  {
    "text": "Lab okay so now we're going to talk about Gateway pi I'm G to hand it to Nina when she is",
    "start": "3293680",
    "end": "3301039"
  },
  {
    "text": "available and we're going to go back to the",
    "start": "3303440",
    "end": "3307318"
  },
  {
    "text": "slides okay is this working cool okay so now we've uh seen how it used used to work",
    "start": "3322400",
    "end": "3330520"
  },
  {
    "text": "right so um every provider like ISO all the other gateways would be uh you have",
    "start": "3330520",
    "end": "3336440"
  },
  {
    "text": "to like write all that code to natively integrate it with Argo rollouts um now with Gateway pii I guess",
    "start": "3336440",
    "end": "3342960"
  },
  {
    "text": "like first like what is Gateway API um in uh a couple years ago uh Gateway API",
    "start": "3342960",
    "end": "3348240"
  },
  {
    "text": "was started as an official kubernetes project in order to um have one API for L4 and L7 routing across a lot of",
    "start": "3348240",
    "end": "3355640"
  },
  {
    "text": "different uh Gateway providers so this projects kind of represents the next generation of the kubernetes Ingress um",
    "start": "3355640",
    "end": "3362680"
  },
  {
    "text": "and it it also um works for um you know service meshes as part of the gamma project um so what it is is you have a",
    "start": "3362680",
    "end": "3370880"
  },
  {
    "text": "new set of custom resources um that users use to define the Gateway uh functionality so this is straight from",
    "start": "3370880",
    "end": "3377440"
  },
  {
    "text": "the Gateway API uh docs they have a great little diagram here that kind of highlights like the different um",
    "start": "3377440",
    "end": "3383119"
  },
  {
    "text": "components that make up the API so the first one we're going to look at is the Gateway class which defines a set of",
    "start": "3383119",
    "end": "3389720"
  },
  {
    "text": "gateways with common configuration behavior um so that's like what controller you're using to actually um",
    "start": "3389720",
    "end": "3396640"
  },
  {
    "text": "uh set up your gateway and then the Gateway itself is the point where traffic can be translated um to services",
    "start": "3396640",
    "end": "3403200"
  },
  {
    "text": "so that's like your Ingress Gateway the actual um service and deployment that that gets configured based on how the",
    "start": "3403200",
    "end": "3408400"
  },
  {
    "text": "controller is configuring it and then the routes so the routes uh there's multiple routes that are supported HTTP",
    "start": "3408400",
    "end": "3413799"
  },
  {
    "text": "routes TLS route grpc route um in this lab we're only going to focus on the HTP",
    "start": "3413799",
    "end": "3419039"
  },
  {
    "text": "routes but others exist so it's good to call out okay so we're going to jump into the",
    "start": "3419039",
    "end": "3425039"
  },
  {
    "text": "next Lab um so in this lab um we're the first step we have to do is install the",
    "start": "3425039",
    "end": "3431440"
  },
  {
    "text": "Gateway API crds because they don't come installed default in cendes um so I have",
    "start": "3431440",
    "end": "3437799"
  },
  {
    "text": "a little command to apply um the installation script from the um gateways",
    "start": "3437799",
    "end": "3443319"
  },
  {
    "text": "uh kubernetes Sig um so this is just going to apply all the CRS that we just talked about so the Gateway class the",
    "start": "3443319",
    "end": "3449720"
  },
  {
    "text": "gateways the HTP route and uh reference grants which we're not really going to use in this uh",
    "start": "3449720",
    "end": "3455200"
  },
  {
    "text": "example and then we're going to go back to ISO so Lawrence mentioned a while back that ISO supports both like the",
    "start": "3455200",
    "end": "3461559"
  },
  {
    "text": "native ISO virtual service apis but it also supports Gateway API so um just to",
    "start": "3461559",
    "end": "3467720"
  },
  {
    "text": "sanity check we still have ISO installed we still have our old Ingress Gateway and we still have the iso control plane",
    "start": "3467720",
    "end": "3474839"
  },
  {
    "text": "um but now we're going to create a new Gateway with this new API um so uh when we applied the crds",
    "start": "3474839",
    "end": "3483400"
  },
  {
    "text": "something also happened magically under the hood um ISO created these uh gayway",
    "start": "3483400",
    "end": "3489119"
  },
  {
    "text": "classes for us which is very nice um 30 s second s seconds ago so before the",
    "start": "3489119",
    "end": "3494799"
  },
  {
    "text": "crds were applied we didn't have any Gateway classes but um ISO actually like once those um CRS are present will",
    "start": "3494799",
    "end": "3502240"
  },
  {
    "text": "create the Gateway class for you and there's two um Gateway classes that we have have we're actually just going to use the sto one uh thetio remote is for",
    "start": "3502240",
    "end": "3509799"
  },
  {
    "text": "things that the iso control plane doesn't manage the Gateway we're going to use is going to be managed by the iso control plane so we'll use",
    "start": "3509799",
    "end": "3516319"
  },
  {
    "text": "that um cool and then now for the actual Gateway so this is uh again a Gateway",
    "start": "3516319",
    "end": "3523160"
  },
  {
    "text": "that's not specific to ISO it's coming from the Gateway um API and what we're",
    "start": "3523160",
    "end": "3528440"
  },
  {
    "text": "doing is we're selecting the Gateway class ISO which we saw ISO created for us um naming this gateway gateway in the",
    "start": "3528440",
    "end": "3536280"
  },
  {
    "text": "default namespace and creating a listener for it so our Gateway is going to listen on Port 80 and that's what",
    "start": "3536280",
    "end": "3541799"
  },
  {
    "text": "we're going to use from now on to Des send traffic um to instead of the the old Ingress Gateway so let's apply that",
    "start": "3541799",
    "end": "3550920"
  },
  {
    "text": "config and let's see if we actually got one so yeah so when we look at the",
    "start": "3550920",
    "end": "3556520"
  },
  {
    "text": "deployments we get um our Gateway sto deployment um is is in a ready state so",
    "start": "3556520",
    "end": "3562280"
  },
  {
    "text": "we can start using it so now we're going to set up some environment variables just to make it",
    "start": "3562280",
    "end": "3567960"
  },
  {
    "text": "easy to send requests um like we did before um so we're going to make like our uh as we looked I saw in from the",
    "start": "3567960",
    "end": "3576240"
  },
  {
    "text": "deployment um we have our Gateway in the default namespace so we're going to set our Gateway namespace as default and",
    "start": "3576240",
    "end": "3582280"
  },
  {
    "text": "then get the address from the the load balancer um that our uh sto control",
    "start": "3582280",
    "end": "3587440"
  },
  {
    "text": "plane created for us cool okay so now let's actually do",
    "start": "3587440",
    "end": "3593480"
  },
  {
    "text": "some routing so before when we had our virtual service um the iso control plane",
    "start": "3593480",
    "end": "3598880"
  },
  {
    "text": "would take that virtual service and configure the Gateway now we will see that it can actually do the same thing",
    "start": "3598880",
    "end": "3604520"
  },
  {
    "text": "with uh gayway API resources so the HTP route so this is um an equivalent",
    "start": "3604520",
    "end": "3609760"
  },
  {
    "text": "version of the virtual service we saw just written in the Gateway API format so um we're selecting the Gateway that",
    "start": "3609760",
    "end": "3615920"
  },
  {
    "text": "we just created it's named Gateway um this HTP route is also in the default namespace so it's going to be able to",
    "start": "3615920",
    "end": "3621559"
  },
  {
    "text": "pick that up um and then um we have our backend ref um to uh select the two kuet",
    "start": "3621559",
    "end": "3628680"
  },
  {
    "text": "services that we we''ve been using throughout the labs so our demo stable",
    "start": "3628680",
    "end": "3634240"
  },
  {
    "text": "and our demo Canary are both U two backend refs that we have so we're like we're going to see that Argo is going to",
    "start": "3634240",
    "end": "3639440"
  },
  {
    "text": "configure the weights for both of these later on cool okay so let's uh I think I",
    "start": "3639440",
    "end": "3646039"
  },
  {
    "text": "didn't apply it let's run that and then let's send some traffic so",
    "start": "3646039",
    "end": "3651079"
  },
  {
    "text": "using the gateway address that we set earlier we're going to send a request oh did I",
    "start": "3651079",
    "end": "3656799"
  },
  {
    "text": "I miss this St let's see oh I didn't configure it",
    "start": "3656799",
    "end": "3664559"
  },
  {
    "text": "um let's see what did I miss oh I didn't create the services ah right so in the",
    "start": "3664559",
    "end": "3669960"
  },
  {
    "text": "previous lab we cleaned everything up so in order to actually you know hit the services we we have to recreate them so",
    "start": "3669960",
    "end": "3675559"
  },
  {
    "text": "now my uh my config should work sorry that this one cool so when I",
    "start": "3675559",
    "end": "3683960"
  },
  {
    "text": "send the request um I can send it again again I get a nice response blue so we're going through our new Ingress",
    "start": "3683960",
    "end": "3689559"
  },
  {
    "text": "Gateway and hitting our our service um let's take a look at what",
    "start": "3689559",
    "end": "3695440"
  },
  {
    "text": "that looks like in the demo app one more time so it should look identical to what we saw before",
    "start": "3695440",
    "end": "3702359"
  },
  {
    "text": "um sorry the demo app yeah so we can see that all the colors we're getting back",
    "start": "3702359",
    "end": "3707599"
  },
  {
    "text": "are blue and we're routing again through that that new Gateway",
    "start": "3707599",
    "end": "3712799"
  },
  {
    "text": "um cool so so next um we're going to kill",
    "start": "3712799",
    "end": "3718760"
  },
  {
    "text": "that port forward and we're going to look at some of the other features that Gateway API provides so um one thing",
    "start": "3718760",
    "end": "3725520"
  },
  {
    "text": "that you can do with Gateway API is URL rewrites so this is just like a silly example to play around with uh to get",
    "start": "3725520",
    "end": "3731240"
  },
  {
    "text": "familiar with the Gateway API so what we're going to do is replace our color",
    "start": "3731240",
    "end": "3736480"
  },
  {
    "text": "um prefix with our favorite color so um every time we're going to use the favorite color uh um path we're going to",
    "start": "3736480",
    "end": "3744240"
  },
  {
    "text": "actually hit the color path so um our Ingress Gateway is going to replace favorite color with color and then we're",
    "start": "3744240",
    "end": "3750200"
  },
  {
    "text": "going to still get the the same response that we were seeing before so let's apply",
    "start": "3750200",
    "end": "3756039"
  },
  {
    "text": "that and then when we take uh send the request again you can see that even though I'm using the favor color it's",
    "start": "3756039",
    "end": "3762599"
  },
  {
    "text": "actually getting back the the color response we're seeing so it did do that that flip um cool and then um the next task",
    "start": "3762599",
    "end": "3773319"
  },
  {
    "text": "is actually an advanced Tas so we don't have the the Sol solution for you um you'll have to uh how are we on time um",
    "start": "3773319",
    "end": "3780880"
  },
  {
    "text": "actually I might just run through it uh just because I think we we want to get through a couple more Labs um but our",
    "start": "3780880",
    "end": "3786599"
  },
  {
    "text": "next task is we're going to create an HTTP header with the Gateway API so similar to how we did the URL um rewrite",
    "start": "3786599",
    "end": "3793680"
  },
  {
    "text": "we're going to add another filter to do um a uh response header so when we get",
    "start": "3793680",
    "end": "3798880"
  },
  {
    "text": "our response back on like our Ingress Gateway will add a um response header with X location Salt Lake City so the",
    "start": "3798880",
    "end": "3806559"
  },
  {
    "text": "way we're going to do that is I actually have um the lab preset so uh yeah Argo",
    "start": "3806559",
    "end": "3817079"
  },
  {
    "text": "header so let's take a look um so very similar to what we had before let me",
    "start": "3817079",
    "end": "3822240"
  },
  {
    "text": "make this a little bigger um we have the URL WR uh rewrite as one of the filters",
    "start": "3822240",
    "end": "3827400"
  },
  {
    "text": "and we have this new filter um called the response header so um the response",
    "start": "3827400",
    "end": "3832720"
  },
  {
    "text": "header modifier is going to add a um header on the response that adds the",
    "start": "3832720",
    "end": "3837799"
  },
  {
    "text": "name X location and value C Lake City so when I apply this",
    "start": "3837799",
    "end": "3844400"
  },
  {
    "text": "config uh header and then send the same request as",
    "start": "3851240",
    "end": "3857319"
  },
  {
    "text": "before um where's the um now I should see that I",
    "start": "3857319",
    "end": "3864520"
  },
  {
    "text": "uh got got yes my location is now um I have an additional header on the",
    "start": "3864520",
    "end": "3869960"
  },
  {
    "text": "response for Salt Lake City cool Okay so we've played around with the Gateway API a little so we're",
    "start": "3869960",
    "end": "3875720"
  },
  {
    "text": "going to clean everything up and then move on to the next step so now um we're",
    "start": "3875720",
    "end": "3881319"
  },
  {
    "text": "going to look at how Argo works with Gateway API so um before we do that I",
    "start": "3881319",
    "end": "3886400"
  },
  {
    "text": "have a couple slides to to go through um so first of all um unlike the is of",
    "start": "3886400",
    "end": "3892920"
  },
  {
    "text": "virtual service which was natively integrated with Argo um Gateway API support today is a plugin so you'll have",
    "start": "3892920",
    "end": "3899400"
  },
  {
    "text": "to define a config map um that Argo rollouts will um reference and then U be",
    "start": "3899400",
    "end": "3904799"
  },
  {
    "text": "able to get that plugin and uh you you'll have to restart our gorilla to actually pick it up um but once you",
    "start": "3904799",
    "end": "3912319"
  },
  {
    "text": "actually do that all providers that support Gateway API will work with Argo",
    "start": "3912319",
    "end": "3918079"
  },
  {
    "text": "so um ISO um we'll look at engine X we'll look at Envoy Gateway we'll look at glue Gateway all of those will work",
    "start": "3918079",
    "end": "3924720"
  },
  {
    "text": "without any changes um there is a issue to um add inur support um for gway apis but um it's",
    "start": "3924720",
    "end": "3933000"
  },
  {
    "text": "still a working progress um one of our co-workers actually opened it so um if",
    "start": "3933000",
    "end": "3938039"
  },
  {
    "text": "you want you can take a look um at that on the Argo GitHub page but another thing we'll have to do",
    "start": "3938039",
    "end": "3944400"
  },
  {
    "text": "is also Define the cluster role so um before when the virtual service was natively integrated uh the rbac was",
    "start": "3944400",
    "end": "3951480"
  },
  {
    "text": "defined for you um here we'll have to define a cluster role um to give Argo permissions to edit the HTP",
    "start": "3951480",
    "end": "3959240"
  },
  {
    "text": "routes cool and then this is kind of the the setup that we had before so we had our virtual service the only thing",
    "start": "3959240",
    "end": "3964920"
  },
  {
    "text": "that's going to change is we're going to use an HTP route",
    "start": "3964920",
    "end": "3969720"
  },
  {
    "text": "instead okay so back to the",
    "start": "3970760",
    "end": "3974960"
  },
  {
    "text": "lab Al um okay so uh like I mentioned the",
    "start": "3976400",
    "end": "3982680"
  },
  {
    "text": "first thing we have to do is um uh upgrade uh Argo with Helm um to actually",
    "start": "3982680",
    "end": "3990400"
  },
  {
    "text": "um add the the new plugin that that we're going to use so um we uh we do a",
    "start": "3990400",
    "end": "3996720"
  },
  {
    "text": "Helm upgrade with um Helm upgrade install and add this new controller for the traffic router",
    "start": "3996720",
    "end": "4002960"
  },
  {
    "text": "plugins the second thing we need to do is add uh the config map so um we have",
    "start": "4002960",
    "end": "4008039"
  },
  {
    "text": "to um add this new config map that is going to uh reference the traffic router",
    "start": "4008039",
    "end": "4013359"
  },
  {
    "text": "plugins and then have a location to to um the the actual plugin so we're going to apply that and",
    "start": "4013359",
    "end": "4020319"
  },
  {
    "text": "replace the the existing config map and then now in order to have the changes take effect we're going to restart uh",
    "start": "4020319",
    "end": "4026920"
  },
  {
    "text": "Argo so we restarted Argo rollouts and now um last a little bit we have to",
    "start": "4026920",
    "end": "4032760"
  },
  {
    "text": "create the cluster roll and the cluster R binding to be able to edit our HTP uh uh route so um the the this is the same",
    "start": "4032760",
    "end": "4041160"
  },
  {
    "text": "cluster role that we looked at on the slides we're going to give Argo permissions to edit HTP routes um and",
    "start": "4041160",
    "end": "4047279"
  },
  {
    "text": "you know update and Patch so so we're going to apply that and then",
    "start": "4047279",
    "end": "4053480"
  },
  {
    "text": "finally we need the cluster role binding so this is going to um associate our cluster role with um you know our our",
    "start": "4053480",
    "end": "4060039"
  },
  {
    "text": "subject so in this case uh the Argo service account so um this is the the",
    "start": "4060039",
    "end": "4065720"
  },
  {
    "text": "cluster Ro we just defined and then this is the Argo service account we're using so we're going to apply that",
    "start": "4065720",
    "end": "4071640"
  },
  {
    "text": "config and then uh now we're actually ready to to the the roll out for",
    "start": "4071640",
    "end": "4077119"
  },
  {
    "text": "real so um uh where we yeah so um again we're",
    "start": "4077119",
    "end": "4083599"
  },
  {
    "text": "going to have to reapply the services and HTP route that we were using before for the the basic routing um and then",
    "start": "4083599",
    "end": "4089200"
  },
  {
    "text": "let's look at the HTTP route that was created so um you can notice that the",
    "start": "4089200",
    "end": "4094279"
  },
  {
    "text": "status has been updated by esto so the route is valid it resolved all the the references and the controller that's um",
    "start": "4094279",
    "end": "4100880"
  },
  {
    "text": "configuring it is ISO and then uh currently we just have two back refs um",
    "start": "4100880",
    "end": "4106560"
  },
  {
    "text": "like in the example we were using before one for the demo stable and one for the demo",
    "start": "4106560",
    "end": "4112120"
  },
  {
    "text": "Canary cool so um next uh we're going to create the actual roll out resource so",
    "start": "4112120",
    "end": "4119278"
  },
  {
    "text": "let's take a look at what that looks like so um what's a little different here is in the uh traffic routing",
    "start": "4119279",
    "end": "4126000"
  },
  {
    "text": "plugins we're now using the Gateway API instead of iso and this is going to be a very simple uh roll out similar to what",
    "start": "4126000",
    "end": "4132318"
  },
  {
    "text": "we did before um where we're the pauses are just going to be be 30 seconds um no",
    "start": "4132319",
    "end": "4137920"
  },
  {
    "text": "like manual intervention to to get it out cool so let's apply that and then",
    "start": "4137920",
    "end": "4145560"
  },
  {
    "text": "now let's uh monitor what's happening so um we again like if you",
    "start": "4145560",
    "end": "4151238"
  },
  {
    "text": "look at the uh selector under the service you'll see that um the uh",
    "start": "4151239",
    "end": "4156920"
  },
  {
    "text": "selector has that um app uh template hash updated like we were looking at",
    "start": "4156920",
    "end": "4163000"
  },
  {
    "text": "before so it's working exactly the same the only thing that changed is the the routing resource we're using is no",
    "start": "4163000",
    "end": "4168838"
  },
  {
    "text": "longer a virtual service it's that HTP route um and then if we look at the status um we you know because this is",
    "start": "4168839",
    "end": "4177080"
  },
  {
    "text": "the first roll out we're doing um we uh already are at step 66 and everything's",
    "start": "4177080",
    "end": "4182278"
  },
  {
    "text": "in a healthy State cool so um now the last thing",
    "start": "4182279",
    "end": "4187600"
  },
  {
    "text": "we're going to do is send some traffic so uh I'm just going to run this command to send a bunch of curl requests uh",
    "start": "4187600",
    "end": "4193960"
  },
  {
    "text": "through the Ingress Gateway that that we select um and you should only see green responses cuz that's the only image we",
    "start": "4193960",
    "end": "4200320"
  },
  {
    "text": "currently have and then if you want to take a look at the um the demo UI we can go to",
    "start": "4200320",
    "end": "4206360"
  },
  {
    "text": "Terminal 2 and then again port forward our um our sto uh Gateway and take a",
    "start": "4206360",
    "end": "4212560"
  },
  {
    "text": "look at what it looks like so again we see a bunch of only green um uh versions",
    "start": "4212560",
    "end": "4218880"
  },
  {
    "text": "uh on the the demo UI as well cool so now we're going to go do a",
    "start": "4218880",
    "end": "4225960"
  },
  {
    "text": "canary upgrade this time with HTP routes so um we're uh the only difference that",
    "start": "4225960",
    "end": "4231840"
  },
  {
    "text": "we're going to do is um instead of having green we're going to switch to Orange so um when we uh apply",
    "start": "4231840",
    "end": "4240520"
  },
  {
    "text": "this um we should see uh the the status um here have both the",
    "start": "4240520",
    "end": "4249120"
  },
  {
    "text": "green and the orange version and um as you update it it should uh um update the",
    "start": "4249120",
    "end": "4255440"
  },
  {
    "text": "steps as well so um now if we take a look at our HTP",
    "start": "4255440",
    "end": "4261360"
  },
  {
    "text": "route we can see what stage we're on so we are on um the 7030 stage so 70% of",
    "start": "4261360",
    "end": "4267719"
  },
  {
    "text": "our traffic is going to the stable app and then 30% of our traffic is going to the",
    "start": "4267719",
    "end": "4273360"
  },
  {
    "text": "canary and this is again like similar to how we saw the virtual service get updated Argo is doing the same exact",
    "start": "4273360",
    "end": "4279080"
  },
  {
    "text": "thing it's just updating a different resource the HTP rep",
    "start": "4279080",
    "end": "4284719"
  },
  {
    "text": "cool so um now let's keep going um Sophie send some uh traffic we",
    "start": "4285360",
    "end": "4292040"
  },
  {
    "text": "can see a mix of green and orange responses um so before when we only saw green now we're seeing green and",
    "start": "4292040",
    "end": "4297600"
  },
  {
    "text": "orange and um when we promote this uh a couple times you can see that the it's",
    "start": "4297600",
    "end": "4304239"
  },
  {
    "text": "actually better to visualize in the UI um you can see that the percentage is",
    "start": "4304239",
    "end": "4309800"
  },
  {
    "text": "going to uh change over time so before it was 3070 now um I think it's what uh",
    "start": "4309800",
    "end": "4317320"
  },
  {
    "text": "the next stage and then if we promote it one more time um we will see uh it",
    "start": "4317320",
    "end": "4323840"
  },
  {
    "text": "upgrade again so we are yeah so we're still on stage three out of six um if we",
    "start": "4323840",
    "end": "4329560"
  },
  {
    "text": "promote it uh one more time we're going to see it be all orange so where's the the promote so I run promote",
    "start": "4329560",
    "end": "4337880"
  },
  {
    "text": "again I'm in stage",
    "start": "4337880",
    "end": "4342960"
  },
  {
    "text": "uh where is it at oh it's not oh this is the wrong",
    "start": "4342960",
    "end": "4348760"
  },
  {
    "text": "uh so if I reload it so now everything is Orange um I can run the state again to",
    "start": "4350960",
    "end": "4358920"
  },
  {
    "text": "check what state we're in so now we are in uh the last state so",
    "start": "4358920",
    "end": "4366840"
  },
  {
    "text": "the only uh thing we have is orange in the stable State and if we promote it one more time um only orange will be",
    "start": "4366840",
    "end": "4373440"
  },
  {
    "text": "here as uh or only orange will be in the the status so we can see that we only",
    "start": "4373440",
    "end": "4378960"
  },
  {
    "text": "have orange here cool um so at the very end our HTP",
    "start": "4378960",
    "end": "4384719"
  },
  {
    "text": "route all of the traffic is going to the new stable the new",
    "start": "4384719",
    "end": "4389159"
  },
  {
    "text": "orange all right so now let's take a look at what happens when uh things go",
    "start": "4391239",
    "end": "4396280"
  },
  {
    "text": "oh actually let's take a look at the um the Aro rollouts UI just to confirm that",
    "start": "4396280",
    "end": "4401320"
  },
  {
    "text": "it's identical to what we were looking at before um sorry not this one the this",
    "start": "4401320",
    "end": "4407159"
  },
  {
    "text": "one so when we port forward the dashboard oh it's very hard to see here",
    "start": "4407159",
    "end": "4412199"
  },
  {
    "text": "um we can see that this is again the same um like even though the HTP route the virtual service switch to the HTP",
    "start": "4412199",
    "end": "4418560"
  },
  {
    "text": "route the dashboard looks the same um so everything works as before cool and then the last task that",
    "start": "4418560",
    "end": "4425840"
  },
  {
    "text": "we have is defining uh a route for early adopted uh adoption traffic so it's similar to what we did before um we're",
    "start": "4425840",
    "end": "4432440"
  },
  {
    "text": "going to have uh an extra header on our HTP out that's going to send um if you",
    "start": "4432440",
    "end": "4437679"
  },
  {
    "text": "have this header all the traffic to the newer version um and um again just",
    "start": "4437679",
    "end": "4443280"
  },
  {
    "text": "because of time I'm going to do this um for you but um if you you know want to",
    "start": "4443280",
    "end": "4449560"
  },
  {
    "text": "um uh try it out on your own feel free I I'll keep the config up and you can uh follow along so um in our Labs I have",
    "start": "4449560",
    "end": "4458000"
  },
  {
    "text": "the config already set so uh Canary roll out with Eder",
    "start": "4458000",
    "end": "4465599"
  },
  {
    "text": "okay so um the thing that we have to change in order to get this to work is very similar to what we did before with",
    "start": "4467159",
    "end": "4472639"
  },
  {
    "text": "the virtual service um now under traffic manage uh under traffic routing we have",
    "start": "4472639",
    "end": "4478239"
  },
  {
    "text": "managed routes where we Define our uh Canary header name and then under the steps we say what we're matching on so",
    "start": "4478239",
    "end": "4485280"
  },
  {
    "text": "if the um X rollout Canary header equals true um it's going to send all the",
    "start": "4485280",
    "end": "4490440"
  },
  {
    "text": "traffic to the the canary so let's Supply that",
    "start": "4490440",
    "end": "4497440"
  },
  {
    "text": "config and then um let's send some traffic so I'm going to send the traffic",
    "start": "4504040",
    "end": "4509120"
  },
  {
    "text": "with the X roll out Canary header and then see what color I get oh uh sorry wrong wrong terminal um",
    "start": "4509120",
    "end": "4517480"
  },
  {
    "text": "so again because we didn't set our end this is why we're not uh being able to uh to hit the Gateway if we go back to",
    "start": "4517480",
    "end": "4523840"
  },
  {
    "text": "terminal one uh the end of is correctly set and you can see 100% of the traffic is going to",
    "start": "4523840",
    "end": "4529280"
  },
  {
    "text": "Green cool so the last thing we're going to do is do a little bit of cleanup and",
    "start": "4529280",
    "end": "4534600"
  },
  {
    "text": "then um we're going to move on to the next section on metrics so ISU um is",
    "start": "4534600",
    "end": "4540600"
  },
  {
    "text": "nice because it it uh provides metrics for you so if we're sending traffic through the Ingress Gateway um it'll",
    "start": "4540600",
    "end": "4546520"
  },
  {
    "text": "collect the total number of requests and we'll be able to use that to see if our our gorilla out um Can automatically",
    "start": "4546520",
    "end": "4552679"
  },
  {
    "text": "proceed um cool so I'm going to go through this",
    "start": "4552679",
    "end": "4559000"
  },
  {
    "text": "next section uh now so we're going to install Prometheus um because we're going to use Prometheus as our metrics",
    "start": "4559000",
    "end": "4565679"
  },
  {
    "text": "uh collection to um uh to be able to to run queries and",
    "start": "4565679",
    "end": "4571639"
  },
  {
    "text": "see um what our metrics are reporting um actually I think I have a slide to to",
    "start": "4571639",
    "end": "4577080"
  },
  {
    "text": "demonstrate this so um again there's like we're going to use Prometheus but there's other um metrics Integrations",
    "start": "4577080",
    "end": "4584120"
  },
  {
    "text": "that are go roll out provides so you can use like data dog you can use New Relic",
    "start": "4584120",
    "end": "4589600"
  },
  {
    "text": "um you can use kubernetes jobs which again foreshadowing we might later in the in the labs um and in order to get",
    "start": "4589600",
    "end": "4596520"
  },
  {
    "text": "the metrics integration to work to automatically do that roll back um we'll need to create an analysis template so",
    "start": "4596520",
    "end": "4602560"
  },
  {
    "text": "this is another custom resource that Argo has um that's going to Define what metrics are our success",
    "start": "4602560",
    "end": "4609600"
  },
  {
    "text": "criteria um so the analysis template is going to create an analysis run and that analysis run is going to query our",
    "start": "4609600",
    "end": "4615920"
  },
  {
    "text": "metrics provider um to to get metrics on on the state of our Canary",
    "start": "4615920",
    "end": "4621920"
  },
  {
    "text": "deployment um in our specific case again we have ISO with the HTTP route and then",
    "start": "4621920",
    "end": "4627280"
  },
  {
    "text": "our metrics provider is going to be uh Prometheus um and then when we do when",
    "start": "4627280",
    "end": "4634440"
  },
  {
    "text": "the metrics aren't happy so when we get um you know the iso request total uh response codes um you know are we're not",
    "start": "4634440",
    "end": "4641920"
  },
  {
    "text": "getting 200s back um we can automatically roll back without manual intervention so before when we had to",
    "start": "4641920",
    "end": "4647440"
  },
  {
    "text": "like see the um the state and like automatically roll back or manually roll back now uh based on our metrics",
    "start": "4647440",
    "end": "4654239"
  },
  {
    "text": "criteria we can do that automatically cool so then I'll I'll go back to the lab um so um now uh",
    "start": "4654239",
    "end": "4663320"
  },
  {
    "text": "promethus should be installed so if I check uh the status of the deployment it has been uh installed and I can run the",
    "start": "4663320",
    "end": "4671880"
  },
  {
    "text": "iso dashboard Prometheus command to port forward prome and see the UI just to run some some simple",
    "start": "4671880",
    "end": "4679599"
  },
  {
    "text": "queries it seems to be slow well we can talk about the GES",
    "start": "4685960",
    "end": "4691600"
  },
  {
    "text": "because I I do want to get to the next section so um so uh I'm going to apply",
    "start": "4691600",
    "end": "4696679"
  },
  {
    "text": "the services and roll outs um that that we had that we've been using for the the last previous Labs um and then um is",
    "start": "4696679",
    "end": "4705199"
  },
  {
    "text": "Prometheus up",
    "start": "4705199",
    "end": "4707920"
  },
  {
    "text": "yet time out",
    "start": "4711280",
    "end": "4714638"
  },
  {
    "text": "occurred okay well yeah we we'll talk about the the queries briefly but um if it",
    "start": "4718159",
    "end": "4724120"
  },
  {
    "text": "like uh it it like basically looks like a nice version of this where you can type in the query and like see it",
    "start": "4724120",
    "end": "4730600"
  },
  {
    "text": "execute um but the two queries we're going to run are um um the first one is",
    "start": "4730600",
    "end": "4736400"
  },
  {
    "text": "just to get the request total so um ISO the Ingress Gateway is reporting on all",
    "start": "4736400",
    "end": "4741440"
  },
  {
    "text": "their requests going through it so um we have a lot of useful information we can use to do in our uh to to build our",
    "start": "4741440",
    "end": "4748600"
  },
  {
    "text": "analysis template with um so um in our",
    "start": "4748600",
    "end": "4754199"
  },
  {
    "text": "case we're going to look at the response code and see what percentage of the response code is um you know healthy",
    "start": "4754199",
    "end": "4759560"
  },
  {
    "text": "versus 500 requests responses um so um",
    "start": "4759560",
    "end": "4765840"
  },
  {
    "text": "unfortunately yeah it looks like Prometheus isn't working for me um so I'm going to skip those sections that at",
    "start": "4765840",
    "end": "4772400"
  },
  {
    "text": "least the dashboard isn't um but it is installed so it should be",
    "start": "4772400",
    "end": "4779760"
  },
  {
    "text": "in a running State um so uh I'm going to skip the the error",
    "start": "4779760",
    "end": "4785520"
  },
  {
    "text": "rate um and then move on to analysis template also for timing um so in the",
    "start": "4785520",
    "end": "4791239"
  },
  {
    "text": "analysis template um this is again the the resource that we're going to use to write our query um to determine",
    "start": "4791239",
    "end": "4797320"
  },
  {
    "text": "automatically when um we're good to you know progress versus when we should roll",
    "start": "4797320",
    "end": "4803560"
  },
  {
    "text": "back um so in this case the query we're doing is the percentage of um uh non 500",
    "start": "4803560",
    "end": "4810400"
  },
  {
    "text": "responses versus total responses and we want that percentage to be higher than 95 so when I apply uh that template um",
    "start": "4810400",
    "end": "4819199"
  },
  {
    "text": "I've created the analysis template but now I need a roll out that is going to select that analysis template so um in",
    "start": "4819199",
    "end": "4825239"
  },
  {
    "text": "our roll out um we're going to uh this again very similar to the roll outs that",
    "start": "4825239",
    "end": "4831239"
  },
  {
    "text": "we were using before but um we're going to have a new analysis section where we",
    "start": "4831239",
    "end": "4836840"
  },
  {
    "text": "Define uh we select our analysis template and uh provide the arguments we're going to use for it so in this",
    "start": "4836840",
    "end": "4842960"
  },
  {
    "text": "case our template was called ISO success rate and the args we're going to provide are our demo Canary service so that's",
    "start": "4842960",
    "end": "4849440"
  },
  {
    "text": "the the metric it's going to look for how many um requests going to the demo Canary service are are in a good",
    "start": "4849440",
    "end": "4856360"
  },
  {
    "text": "state so um I'm going to go to Terminal 2 and send a bunch of traffic so I get",
    "start": "4856360",
    "end": "4861840"
  },
  {
    "text": "some metrics and then um uh I'm going to deploy my roll out so um when I deploy",
    "start": "4861840",
    "end": "4870400"
  },
  {
    "text": "my roll out an analysis run will automatically get created so my analysis run is now running and um when I look at",
    "start": "4870400",
    "end": "4877840"
  },
  {
    "text": "the rollouts themselves I can see that the roll out is in progress so there's a new section in",
    "start": "4877840",
    "end": "4884719"
  },
  {
    "text": "this report that says analysis run which uh corresponds to the analysis run that we looked at",
    "start": "4884719",
    "end": "4891880"
  },
  {
    "text": "earlier cool okay so then uh the next thing we're going to do is uh check if",
    "start": "4891880",
    "end": "4897360"
  },
  {
    "text": "our analysis run was successful so it's uh still in a running State um I think it usually takes a little bit to to get",
    "start": "4897360",
    "end": "4905800"
  },
  {
    "text": "done um so we'll give it some time we can describe the analysis run R we waiting so it's still in the running",
    "start": "4905800",
    "end": "4912040"
  },
  {
    "text": "State it's still there's been um uh run summary one so we've had one successful",
    "start": "4912040",
    "end": "4917159"
  },
  {
    "text": "run um but we're still waiting for the the other run um actually in the meantime I'm",
    "start": "4917159",
    "end": "4922639"
  },
  {
    "text": "going to pull up the um yeah well",
    "start": "4922639",
    "end": "4928679"
  },
  {
    "text": "let's let's check it's still",
    "start": "4928679",
    "end": "4932400"
  },
  {
    "text": "running [Music] so we'll actually we'll look at it in",
    "start": "4937840",
    "end": "4942880"
  },
  {
    "text": "the UI to um well while it's still running so um uh do I",
    "start": "4942880",
    "end": "4950520"
  },
  {
    "text": "have actually I yeah I don't think I have okay hopefully it's done now nope still",
    "start": "4950520",
    "end": "4957639"
  },
  {
    "text": "running so okay successful finally um so now uh our like we didn't have to do",
    "start": "4959840",
    "end": "4965960"
  },
  {
    "text": "anything our analysis template kind of confirmed that everything looked good automatically um by using that query and",
    "start": "4965960",
    "end": "4973159"
  },
  {
    "text": "now when we send our traffic oh again sorry wrong URL uh Missing I",
    "start": "4973159",
    "end": "4978520"
  },
  {
    "text": "forgot this set the end um now when I set send the UR uh the",
    "start": "4978520",
    "end": "4983840"
  },
  {
    "text": "request all of our traffic is going to the new uh uh version the the purple version and 100% of our traffic is is",
    "start": "4983840",
    "end": "4989920"
  },
  {
    "text": "coming back like that cool so the next thing we're going to do is um actually we're short on time",
    "start": "4989920",
    "end": "4997440"
  },
  {
    "text": "so the I'm going to just briefly talk about the um the bad version so similar to um like if the metric was wasn't",
    "start": "4997440",
    "end": "5004880"
  },
  {
    "text": "correct right so it would automatically roll back so similar to how we did the roll back manually um the bad metric",
    "start": "5004880",
    "end": "5011840"
  },
  {
    "text": "would um like return the analysis run to to have failed and then um we uh like",
    "start": "5011840",
    "end": "5018760"
  },
  {
    "text": "would see the version roll back to the original stable but um I want to move on to the",
    "start": "5018760",
    "end": "5025440"
  },
  {
    "text": "next section for picking uh Gateway API providers because we've been using sto",
    "start": "5025440",
    "end": "5031000"
  },
  {
    "text": "this whole time but there are other providers so um um in uh like the next",
    "start": "5031000",
    "end": "5038480"
  },
  {
    "text": "Lab um which feel free to to do also like after the session um and explore",
    "start": "5038480",
    "end": "5043600"
  },
  {
    "text": "more um the like sto is one of the many providers that um Implement Gateway API",
    "start": "5043600",
    "end": "5050679"
  },
  {
    "text": "um so Gateway API lets you pick whatever provider you want and use the same apis",
    "start": "5050679",
    "end": "5056560"
  },
  {
    "text": "so we'll be able to switch our gateway to another Gateway without having to um change the underlying like routing uh",
    "start": "5056560",
    "end": "5064520"
  },
  {
    "text": "resources um which is really cool because it also integrates with Argo so you kind of get both the routing and the",
    "start": "5064520",
    "end": "5070600"
  },
  {
    "text": "the Argo integration for free um great okay so there's three providers",
    "start": "5070600",
    "end": "5077360"
  },
  {
    "text": "that we have um if you're interested in learning more like testing out other providers I've included a link um to the",
    "start": "5077360",
    "end": "5083360"
  },
  {
    "text": "full list um so feel free to to explore that as well um I'm going to go with",
    "start": "5083360",
    "end": "5088760"
  },
  {
    "text": "glue Gateway because that's the Gateway I've worked on um so I'm going to install it now",
    "start": "5088760",
    "end": "5094920"
  },
  {
    "text": "um so in order to install glue Gateway um you need to First add the helm chart and then uh run the the helm install",
    "start": "5094920",
    "end": "5101880"
  },
  {
    "text": "command so we're going to run that might take a second and in this Helm command um",
    "start": "5101880",
    "end": "5108320"
  },
  {
    "text": "there's a couple uh value set by by like uh manually um just to make it like a",
    "start": "5108320",
    "end": "5113679"
  },
  {
    "text": "simpler installation so um we support Discovery um of not just kubernetes",
    "start": "5113679",
    "end": "5118920"
  },
  {
    "text": "services but other services as well like open API and Swagger um but for this",
    "start": "5118920",
    "end": "5124040"
  },
  {
    "text": "example we're only using kubernetes services so we're going to turn that off um we're also disabling the the default",
    "start": "5124040",
    "end": "5130040"
  },
  {
    "text": "proxy just to only like show that we're manually creating the the Gateway and uh we're disabling leader election again",
    "start": "5130040",
    "end": "5136239"
  },
  {
    "text": "just for a simpler installation cool so our Helm installation worked um we can",
    "start": "5136239",
    "end": "5141840"
  },
  {
    "text": "view the um the Gateway class so similar to like sto uh glue creates the Gateway",
    "start": "5141840",
    "end": "5147880"
  },
  {
    "text": "class for you so you can see that we have a controller for the glute Gateway already installed and then",
    "start": "5147880",
    "end": "5154760"
  },
  {
    "text": "um if uh the next thing we have to do is similar to is to apply a Gateway resource so um we're the only thing",
    "start": "5154760",
    "end": "5162679"
  },
  {
    "text": "we're going to change like it's very similar to what we were using before um but the Gateway class name is now going",
    "start": "5162679",
    "end": "5168639"
  },
  {
    "text": "to match our new Gateway controller and this is again the same for like engine X and Envoy Gateway like um this Gateway",
    "start": "5168639",
    "end": "5175480"
  },
  {
    "text": "is going to be identical except the controller so let's apply that so",
    "start": "5175480",
    "end": "5180880"
  },
  {
    "text": "actually we're going to replace the the existing is one and then once we replace it let's take a",
    "start": "5180880",
    "end": "5186239"
  },
  {
    "text": "look at the state of the world so it's going to take a second to get up so our",
    "start": "5186239",
    "end": "5191679"
  },
  {
    "text": "our new glue gateway gateway is up and ready um cool so now let's set the",
    "start": "5191679",
    "end": "5199000"
  },
  {
    "text": "environment variables for that Gateway and then um switch to Terminal 2",
    "start": "5199000",
    "end": "5206239"
  },
  {
    "text": "and port forward uh our Gateway and take a look at the the UI and we can see that our uh",
    "start": "5206239",
    "end": "5212719"
  },
  {
    "text": "traffic is now going through the new Gateway way that we just kind of swap in and uh still",
    "start": "5212719",
    "end": "5218760"
  },
  {
    "text": "working all right I think we're we're short on time so I'm just going to briefly talk about the next section um",
    "start": "5218760",
    "end": "5224880"
  },
  {
    "text": "and again feel free to do it uh on on your own um so in like the problem with",
    "start": "5224880",
    "end": "5231600"
  },
  {
    "text": "having a lot of providers is although the routing API is the same the metrics they provide aren't so um in the next",
    "start": "5231600",
    "end": "5238560"
  },
  {
    "text": "section uh this lets you walk through uh an automatic roll out with a kubernetes job so um it uses the work um uh HTTP uh",
    "start": "5238560",
    "end": "5249159"
  },
  {
    "text": "Benchmark um li like um project to uh just send a bunch of requests to the",
    "start": "5249159",
    "end": "5254440"
  },
  {
    "text": "canary service and see what the responses are um and this is generic across um all of the providers because",
    "start": "5254440",
    "end": "5260639"
  },
  {
    "text": "it's hitting the like it's running you know metrics on the canary service directly instead of the Gateway um you",
    "start": "5260639",
    "end": "5267320"
  },
  {
    "text": "can use the the metrics that the Gateway offers it just they're not generic for any solution and this approach was um so",
    "start": "5267320",
    "end": "5275560"
  },
  {
    "text": "that's the reason we decided to go for ku's um job um the only thing that changes in this setup is the analysis",
    "start": "5275560",
    "end": "5282000"
  },
  {
    "text": "template so the analysis template we're going to use and now uses a provider job instead um but the um the result is very",
    "start": "5282000",
    "end": "5290320"
  },
  {
    "text": "similar so once you apply the analysis template it's going to create analysis run um with your roll out and then based",
    "start": "5290320",
    "end": "5296679"
  },
  {
    "text": "on that analysis run it'll either um you know promote the canary or roll back to the the older version",
    "start": "5296679",
    "end": "5304480"
  },
  {
    "text": "cool so I know we're almost at time um I guess uh in I want to make sure that",
    "start": "5304480",
    "end": "5312080"
  },
  {
    "text": "we have some time for uh a recap so uh in today's lab we kind of touched on a lot of things starting from griet's",
    "start": "5312080",
    "end": "5318920"
  },
  {
    "text": "deployments to basic Argo rollouts to um",
    "start": "5318920",
    "end": "5324119"
  },
  {
    "text": "you know ISO with virtual services and doing Argo rollouts with that to Gateway",
    "start": "5324119",
    "end": "5329679"
  },
  {
    "text": "API with esto to Gateway API with any provider you want um and uh I know there",
    "start": "5329679",
    "end": "5338000"
  },
  {
    "text": "was a lot of stuff to cover um I think the lab will be available for a little while longer if you want to keep going",
    "start": "5338000",
    "end": "5345440"
  },
  {
    "text": "um or you know try it out later um but yeah did I you want to add anything",
    "start": "5345440",
    "end": "5351719"
  },
  {
    "text": "Lawrence uh no it was a great job cool yeah so we we have our our QR code um if",
    "start": "5351719",
    "end": "5357600"
  },
  {
    "text": "you give us feedback um and you like the lab um we might also make it available like through our website or like you",
    "start": "5357600",
    "end": "5364880"
  },
  {
    "text": "know our our run workshops um and yeah thanks we'll be around for any questions",
    "start": "5364880",
    "end": "5371080"
  },
  {
    "text": "to um if you have anything you want to ask and the the lab will will still be up so if you're still working through it",
    "start": "5371080",
    "end": "5376520"
  },
  {
    "text": "we'll walk around and and uh do that",
    "start": "5376520",
    "end": "5382239"
  }
]