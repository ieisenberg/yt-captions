[
  {
    "start": "0",
    "end": "35000"
  },
  {
    "text": "however one thank you for coming to my",
    "start": "30",
    "end": "5520"
  },
  {
    "text": "talk I'm told I'm actually a local Shanghainese here I work for Google I'm",
    "start": "5520",
    "end": "20279"
  },
  {
    "text": "a software engineer and I've been working on kubernetes for open for years",
    "start": "20279",
    "end": "27289"
  },
  {
    "text": "this is my second Q control again thank",
    "start": "27289",
    "end": "32940"
  },
  {
    "text": "you for coming to my talk I'm going to talk about storage migrator today before",
    "start": "32940",
    "end": "39469"
  },
  {
    "start": "35000",
    "end": "35000"
  },
  {
    "text": "we go into today's agenda I want to first share with you a story of mine it",
    "start": "39469",
    "end": "46920"
  },
  {
    "text": "was the first year when I joined Google I was freshly from graduated from",
    "start": "46920",
    "end": "51960"
  },
  {
    "text": "graduate school and it was my first her uncle shift and it's late in the night",
    "start": "51960",
    "end": "57570"
  },
  {
    "text": "my pager suddenly ran customers cluster was crushed looking I was a little",
    "start": "57570",
    "end": "64439"
  },
  {
    "text": "nervous but I just the procedure with Peter I opened my laptop I logged into",
    "start": "64439",
    "end": "70920"
  },
  {
    "text": "my account logged into the API service log I easily fund culprit in the log the",
    "start": "70920",
    "end": "80580"
  },
  {
    "text": "culprit to the error message is there's no job API there's no job kind",
    "start": "80580",
    "end": "86360"
  },
  {
    "text": "registered in extensions B 1 beta 1 I agree I think this this error message is",
    "start": "86360",
    "end": "93479"
  },
  {
    "text": "a little baked but it gives me some clue so I looked into the code a little more",
    "start": "93479",
    "end": "99600"
  },
  {
    "text": "I found out that Jobs is not available in this API version anymore gulps has",
    "start": "99600",
    "end": "105390"
  },
  {
    "text": "graduated so I think my next step is either try to fix the objects or try to",
    "start": "105390",
    "end": "112770"
  },
  {
    "text": "delete the object I got into contact with the customer the customer told me",
    "start": "112770",
    "end": "118020"
  },
  {
    "text": "those jobs are just deprecated objects I have their permission we they delete all",
    "start": "118020",
    "end": "125310"
  },
  {
    "text": "those jobs I was very happy I thought that's it all I need to do is just run a",
    "start": "125310",
    "end": "130410"
  },
  {
    "text": "cue card elite command to delete all those doors they are the culprits of much looping",
    "start": "130410",
    "end": "136950"
  },
  {
    "text": "API servers but when I try to do the cube color developed I found out that",
    "start": "136950",
    "end": "142530"
  },
  {
    "text": "the API server cannot handle the delete operation either the reason is the jobs",
    "start": "142530",
    "end": "151140"
  },
  {
    "text": "is not but HSL just doesn't to recognize the jobs because they are in and stale",
    "start": "151140",
    "end": "157290"
  },
  {
    "text": "version the API server cannot interpret the object anymore so I cannot do any",
    "start": "157290",
    "end": "164100"
  },
  {
    "text": "operation on them but my last results I really want to use it had to directly",
    "start": "164100",
    "end": "170460"
  },
  {
    "text": "talk to SED this really wasn't to the situation I want to be in right it's my",
    "start": "170460",
    "end": "176400"
  },
  {
    "text": "first year at Google I don't want to yo SSE DFP API because I've never touched",
    "start": "176400",
    "end": "183000"
  },
  {
    "text": "that those API oh I know it is kubernetes api also i don't want to",
    "start": "183000",
    "end": "188120"
  },
  {
    "text": "accidentally delete a customer's other data so i was really nervous but what",
    "start": "188120",
    "end": "194280"
  },
  {
    "text": "can I do that's my only option API server does not cannot do anything at this point I had to spend like half an",
    "start": "194280",
    "end": "201810"
  },
  {
    "text": "hour search as the sed control the sed control their binder document and try to",
    "start": "201810",
    "end": "210060"
  },
  {
    "text": "assemble the command to delete those stale jobs and I had to experiment it on",
    "start": "210060",
    "end": "215400"
  },
  {
    "text": "my local environment to make sure those command actually works after half an",
    "start": "215400",
    "end": "220830"
  },
  {
    "text": "hour it I got the job done I am smart but that's really that's really not a",
    "start": "220830",
    "end": "227670"
  },
  {
    "text": "situation I want to be and I don't want any of you to be in this kind of situation either that's why I come I",
    "start": "227670",
    "end": "235200"
  },
  {
    "text": "come to work on the storage migrator and that's why I want to share with you how",
    "start": "235200",
    "end": "240690"
  },
  {
    "text": "to use the storage migrator though so that hopefully this never happens to you",
    "start": "240690",
    "end": "248360"
  },
  {
    "text": "so that's my story and now let's going to go to the actual agenda so first I",
    "start": "253990",
    "end": "260900"
  },
  {
    "text": "want to share with you some background knowledge of how kubernetes tours API",
    "start": "260900",
    "end": "266120"
  },
  {
    "text": "objects I think this this is necessary",
    "start": "266120",
    "end": "271220"
  },
  {
    "text": "for me to talk about storage migrated and I just like to talk about API",
    "start": "271220",
    "end": "276860"
  },
  {
    "text": "machinery stuff it's fun then after the background I'll I'll talk about how come",
    "start": "276860",
    "end": "283780"
  },
  {
    "text": "we will ever have stale objects in a CD and how come I went I how come that bug",
    "start": "283780",
    "end": "291620"
  },
  {
    "text": "happened to me at last I'll talk about a solution that storage migrated so let's",
    "start": "291620",
    "end": "300200"
  },
  {
    "text": "begin was the background how kubernetes those objects in a CD this will be a",
    "start": "300200",
    "end": "306800"
  },
  {
    "text": "little long actually did so if you go to if you have an running API server and if",
    "start": "306800",
    "end": "313040"
  },
  {
    "start": "309000",
    "end": "309000"
  },
  {
    "text": "you go to the root path of the API server it will return you the discovery",
    "start": "313040",
    "end": "318860"
  },
  {
    "text": "document which will tell you all the API versions all the API is are supported",
    "start": "318860",
    "end": "324890"
  },
  {
    "text": "and as you can notice for a specific API",
    "start": "324890",
    "end": "331280"
  },
  {
    "start": "327000",
    "end": "327000"
  },
  {
    "text": "groups like batch usually there will be multiple API versions available and",
    "start": "331280",
    "end": "337360"
  },
  {
    "text": "those API versions adjusted are the evolution paths of the API but for",
    "start": "337360",
    "end": "344630"
  },
  {
    "text": "example here we have the batch view on beta 1 which was the pre GA version of",
    "start": "344630",
    "end": "349940"
  },
  {
    "text": "the batch API and we also have to be one which is ga-ga version of the batch API",
    "start": "349940",
    "end": "355340"
  },
  {
    "text": "and we also have to be two alpha one which is an experimental version of the",
    "start": "355340",
    "end": "360770"
  },
  {
    "text": "bad shape yeah usually the difference between those different versions are",
    "start": "360770",
    "end": "367040"
  },
  {
    "text": "very subtle you might they might system they might have different to field names they might",
    "start": "367040",
    "end": "372979"
  },
  {
    "text": "have different to validation rules or default values and for those v2 alpha",
    "start": "372979",
    "end": "378710"
  },
  {
    "text": "one API because it's alpha it might contain experimental API",
    "start": "378710",
    "end": "386050"
  },
  {
    "text": "and one thing to notice is all those",
    "start": "386440",
    "end": "395690"
  },
  {
    "text": "api's matter it's B 1 or B 1 beta 1 as long as they as long as you are talking",
    "start": "395690",
    "end": "401509"
  },
  {
    "start": "400000",
    "end": "400000"
  },
  {
    "text": "to the as long as than the in space and the name of the object is the same then",
    "start": "401509",
    "end": "406909"
  },
  {
    "text": "the the URL actually lead to the same object so what I mean is if you have if",
    "start": "406909",
    "end": "413120"
  },
  {
    "text": "you bid it to all these three different URL paths although they have different",
    "start": "413120",
    "end": "418280"
  },
  {
    "text": "versions in the URL but because their name space or the namespace here is",
    "start": "418280",
    "end": "423590"
  },
  {
    "text": "default and all the object name here is PI they were actually they're actually referring to the same object in the",
    "start": "423590",
    "end": "431030"
  },
  {
    "text": "backend which is the job in the name space support and in there with the name",
    "start": "431030",
    "end": "436729"
  },
  {
    "text": "pipe so those versions are just different you can you can think the thing tomorrow",
    "start": "436729",
    "end": "441860"
  },
  {
    "text": "think of them as a el√≠as our first",
    "start": "441860",
    "end": "448490"
  },
  {
    "text": "adjuster state how the things are today and then later I will explain why they are they are designed it like this so",
    "start": "448490",
    "end": "460460"
  },
  {
    "start": "459000",
    "end": "459000"
  },
  {
    "text": "now let's look at these api path dynamically let's see how how things",
    "start": "460460",
    "end": "467000"
  },
  {
    "text": "work when you're actually when the api server is actually taking and request so first let's look at when the user is",
    "start": "467000",
    "end": "474349"
  },
  {
    "text": "creating an app object so the user might",
    "start": "474349",
    "end": "479449"
  },
  {
    "text": "choose to post to their object to the be 1 beta 1 jobs URL and what happens is",
    "start": "479449",
    "end": "486199"
  },
  {
    "text": "the the user the user will well just to provide a a job object at this URL path",
    "start": "486199",
    "end": "494569"
  },
  {
    "text": "and this object in the request must be encoded in the b 1 beta 1 version that's",
    "start": "494569",
    "end": "501259"
  },
  {
    "text": "a requirement of the api server because the URL says what i accepted is the",
    "start": "501259",
    "end": "506960"
  },
  {
    "text": "batchview 1 beta 1 are jobs so you must as a the user must who must encode the",
    "start": "506960",
    "end": "513529"
  },
  {
    "text": "object in the B 1 beta 1 version otherwise they just eval reject reject a request",
    "start": "513529",
    "end": "519890"
  },
  {
    "text": "however after the master had after the API server has processed the job and",
    "start": "519890",
    "end": "526170"
  },
  {
    "text": "they want to pay for it stores it into the backend the sed the API server will actually",
    "start": "526170",
    "end": "533790"
  },
  {
    "text": "convert to the object from B 1 beta 1 to the storage version which is actually",
    "start": "533790",
    "end": "539850"
  },
  {
    "text": "the badge be one storage version the",
    "start": "539850",
    "end": "544890"
  },
  {
    "text": "little committed to the storage version it will change the encoding and then it was stow it into the back end the sed so",
    "start": "544890",
    "end": "552570"
  },
  {
    "text": "here the storage version is is an important concept we will use we will",
    "start": "552570",
    "end": "558060"
  },
  {
    "text": "mention a few times later in the talk as well the storage version it's it's so",
    "start": "558060",
    "end": "566700"
  },
  {
    "text": "literally it means literally it's the version the API server will convert to the object two before the API server can",
    "start": "566700",
    "end": "574860"
  },
  {
    "text": "stow it into a CD and for butene resources a storage version it's already",
    "start": "574860",
    "end": "582300"
  },
  {
    "text": "it's pre-configured it's it's coded it's hard-coded that's tighter to the API",
    "start": "582300",
    "end": "588660"
  },
  {
    "text": "servers version the for example if you use 119 where we are we now we add one",
    "start": "588660",
    "end": "596030"
  },
  {
    "text": "115 right if we if you have a 115 coconut ease API server all those",
    "start": "596030",
    "end": "601950"
  },
  {
    "text": "storage versions for different a PAPR associates are already hard-coded and",
    "start": "601950",
    "end": "607470"
  },
  {
    "text": "for the CRTs the storage version are dynamically configured a bigger of all",
    "start": "607470",
    "end": "613170"
  },
  {
    "text": "you can configure them via the CR DS spec ok now let's go back to the main",
    "start": "613170",
    "end": "621150"
  },
  {
    "start": "621000",
    "end": "621000"
  },
  {
    "text": "topic so previously we talked about how a create heart what happens when you",
    "start": "621150",
    "end": "627150"
  },
  {
    "text": "create an object now let's look at what happens when you're reading an object so",
    "start": "627150",
    "end": "632790"
  },
  {
    "text": "I use the user can choose to get to the object from a different URL path at a",
    "start": "632790",
    "end": "638700"
  },
  {
    "text": "different version so if you remember we created it via the v1 beta one pass and",
    "start": "638700",
    "end": "644580"
  },
  {
    "text": "now the user tries to get it from the V to alpha one pass now what happens is",
    "start": "644580",
    "end": "650160"
  },
  {
    "text": "the API server will read the data from the SED which has encoded as v1 and",
    "start": "650160",
    "end": "656489"
  },
  {
    "text": "it were converted to the version that user requested so it took here that the read packet or",
    "start": "656489",
    "end": "664290"
  },
  {
    "text": "caste is hitting HB 2 alpha 1 the API server will convert to the object to be 2 alpha 1 and then give it to the user",
    "start": "664290",
    "end": "671459"
  },
  {
    "text": "the API server here is like a version hub of all the versions as well to order",
    "start": "671459",
    "end": "677879"
  },
  {
    "text": "translation for users right so all",
    "start": "677879",
    "end": "685519"
  },
  {
    "text": "mention that how things work today and let's I want to give some insights on",
    "start": "685519",
    "end": "692639"
  },
  {
    "text": "why things are designed there like this at first is why does the API server have",
    "start": "692639",
    "end": "699839"
  },
  {
    "text": "to support the multiple versions of an API that's because we want to make sure",
    "start": "699839",
    "end": "708269"
  },
  {
    "text": "this the data for the server and the client a compatibility that's for that",
    "start": "708269",
    "end": "713670"
  },
  {
    "text": "that's the best to enable different to lifecycle management for uphold a",
    "start": "713670",
    "end": "719579"
  },
  {
    "text": "lifecycle of server from the lifecycle of client let's look at an example so",
    "start": "719579",
    "end": "726660"
  },
  {
    "text": "let's suppose the API server only supports one version at a time and the",
    "start": "726660",
    "end": "732540"
  },
  {
    "start": "727000",
    "end": "727000"
  },
  {
    "text": "CPI server is active version one point X and you have a client and you have a",
    "start": "732540",
    "end": "737910"
  },
  {
    "text": "client which is talking to the batchview and beta one endpoint and once you",
    "start": "737910",
    "end": "743879"
  },
  {
    "text": "upgrade your IPS over to the next two version and suppose that only supports one version and the batch API has",
    "start": "743879",
    "end": "752160"
  },
  {
    "text": "graduated from you and beta 1 to V 1 then suddenly your clients will stop to",
    "start": "752160",
    "end": "758249"
  },
  {
    "text": "working it gets all the fall for responses right because the V 1 beta 1",
    "start": "758249",
    "end": "763619"
  },
  {
    "text": "isn't available anymore so that's why we but but but yes but as things work today",
    "start": "763619",
    "end": "771029"
  },
  {
    "text": "the API server will support multiple versions at the same time then you can",
    "start": "771029",
    "end": "777600"
  },
  {
    "text": "upgrade your API server first and your clients will still keep working so and you can upgrade your client afterwards",
    "start": "777600",
    "end": "784910"
  },
  {
    "text": "wait before you do next upgrade of API so that's why the API server has to support the multiple",
    "start": "784910",
    "end": "791550"
  },
  {
    "text": "version it's for the compatibility between the server and their clients a",
    "start": "791550",
    "end": "798170"
  },
  {
    "text": "second Oh y-yes why does the API server have to convert objects to the storage",
    "start": "798200",
    "end": "803910"
  },
  {
    "text": "version why can't API server adjuster store things as they are passed parsing by",
    "start": "803910",
    "end": "809490"
  },
  {
    "text": "their clients like yes if the user create again let's look at an example so",
    "start": "809490",
    "end": "817620"
  },
  {
    "text": "the reason is it's for old serve a new server compatibility but I'll explain it to it an example so let's say let's",
    "start": "817620",
    "end": "827220"
  },
  {
    "text": "suppose they PA server store the objects as it is as its passing and the user is",
    "start": "827220",
    "end": "833670"
  },
  {
    "text": "creating the job via the new on beta one endpoint let's say that if your service",
    "start": "833670",
    "end": "839970"
  },
  {
    "text": "to learn to any conversion it just stores the test batch view on beta one",
    "start": "839970",
    "end": "846110"
  },
  {
    "text": "but you will upgrade your API server some time and something else and at some",
    "start": "846110",
    "end": "852660"
  },
  {
    "text": "point the V 1 beta 1 will be removed from the API server and at this time if",
    "start": "852660",
    "end": "859440"
  },
  {
    "text": "your user try to read the reader things from the API server it's not going to",
    "start": "859440",
    "end": "865020"
  },
  {
    "text": "work because the API server doesn't understand the V 1 beta 1 anymore on the",
    "start": "865020",
    "end": "870750"
  },
  {
    "text": "other hand if the if things are stored in the storage version which usually is",
    "start": "870750",
    "end": "875760"
  },
  {
    "start": "872000",
    "end": "872000"
  },
  {
    "text": "the the most recent version available most of stable version most a recent",
    "start": "875760",
    "end": "881040"
  },
  {
    "text": "stable version available then even if even if the previous the B 1 beta 1",
    "start": "881040",
    "end": "886860"
  },
  {
    "text": "version is deleted because the objects store the MCD is in the storage version",
    "start": "886860",
    "end": "893610"
  },
  {
    "text": "then this object is still interpretable of course this for things to work this",
    "start": "893610",
    "end": "901410"
  },
  {
    "text": "relies on the kubernetes upstream maintainers to pick the storage version",
    "start": "901410",
    "end": "906630"
  },
  {
    "text": "carefully so they need to pick the most stable version has the storage version",
    "start": "906630",
    "end": "912110"
  },
  {
    "text": "for every release of kubernetes",
    "start": "912110",
    "end": "916550"
  },
  {
    "start": "918000",
    "end": "918000"
  },
  {
    "text": "so we highlight to what we just said",
    "start": "920930",
    "end": "927140"
  },
  {
    "text": "the important part that the important bit is you need to make sure your",
    "start": "927140",
    "end": "932279"
  },
  {
    "text": "objects are encoded in the storage version then you can upgrade your API server otherwise you might have stale",
    "start": "932279",
    "end": "940079"
  },
  {
    "text": "objects that cannot be interpreted anymore so previously is the background",
    "start": "940079",
    "end": "948630"
  },
  {
    "text": "knowledge and now let's look at why how I ended up in that story why would there",
    "start": "948630",
    "end": "955140"
  },
  {
    "text": "ever be stale objects in customers clusters but you might have already noticed there's a loophole in all the",
    "start": "955140",
    "end": "962610"
  },
  {
    "text": "designs I've mentioned before that is if you if if as a user if you create an",
    "start": "962610",
    "end": "969510"
  },
  {
    "start": "966000",
    "end": "966000"
  },
  {
    "text": "object at one at some point let's say you created when your API server is at V",
    "start": "969510",
    "end": "975740"
  },
  {
    "text": "115 and your everything is working as designed the object is converted to the",
    "start": "975740",
    "end": "981720"
  },
  {
    "text": "storage version which is patch v1 and that is storing a CD however suppose you",
    "start": "981720",
    "end": "987899"
  },
  {
    "text": "let's say you forgot about this job you never you never you never touched the job anymore and one year later your API",
    "start": "987899",
    "end": "995880"
  },
  {
    "text": "server has been upgraded there multiple times to that's a $1.99 it's a it's an",
    "start": "995880",
    "end": "1001430"
  },
  {
    "text": "imaginary version at this time the bad shot but the batch API can already be at",
    "start": "1001430",
    "end": "1009440"
  },
  {
    "text": "v8 no one understand the API server doesn't understand the b1 anymore so",
    "start": "1009440",
    "end": "1015290"
  },
  {
    "text": "although everything works as designed the thing the object is thought as the storage version but the question that",
    "start": "1015290",
    "end": "1022130"
  },
  {
    "text": "you forgot it you forgot about its existence you'd never read the right yet you never updated the thing that all the job yes",
    "start": "1022130",
    "end": "1030890"
  },
  {
    "text": "they just become stale and at this point you never this thing is not",
    "start": "1030890",
    "end": "1036380"
  },
  {
    "text": "interpretable anymore this is actually what happened backing the story the",
    "start": "1036380",
    "end": "1042319"
  },
  {
    "text": "users the clients they created those jobs I think in one one three so at that",
    "start": "1042319",
    "end": "1049610"
  },
  {
    "text": "at that time the job the storage version of jobs extensions beyond beta-1 and because they don't they actually don't need",
    "start": "1049610",
    "end": "1055760"
  },
  {
    "text": "those jobs they are deprecated they never they never delete those things or update those things and when when we",
    "start": "1055760",
    "end": "1064010"
  },
  {
    "text": "upgraded HS / to one one one five extensions be one beta one job is",
    "start": "1064010",
    "end": "1070070"
  },
  {
    "text": "already removed that's why or the API server starts crash looking starts complaining about",
    "start": "1070070",
    "end": "1075950"
  },
  {
    "text": "those fail objects so this can't happen",
    "start": "1075950",
    "end": "1084590"
  },
  {
    "text": "to any cluster Bakula here comes our savior the storage migrator one i want",
    "start": "1084590",
    "end": "1096530"
  },
  {
    "start": "1095000",
    "end": "1095000"
  },
  {
    "text": "to summarize the job of the storage migrated in one sentence so it's basically it's just a control loop that",
    "start": "1096530",
    "end": "1104240"
  },
  {
    "text": "makes sure all the persisted API objects in sed are encoded in their respective",
    "start": "1104240",
    "end": "1109970"
  },
  {
    "text": "storage version though so that when you",
    "start": "1109970",
    "end": "1117080"
  },
  {
    "text": "upgrade your API server those objects will still be readable I want to first",
    "start": "1117080",
    "end": "1125060"
  },
  {
    "start": "1124000",
    "end": "1124000"
  },
  {
    "text": "highlight the features of the storage migrated from the users perspective so it's some very nice feature of the",
    "start": "1125060",
    "end": "1133070"
  },
  {
    "text": "storage migrator first it's deployable by the cue cuddle all you need to do is to download some",
    "start": "1133070",
    "end": "1139580"
  },
  {
    "text": "demo files and deploy it you know support the the API that migrator uses",
    "start": "1139580",
    "end": "1146420"
  },
  {
    "text": "yes kubernetes style it's very its component to that generic kakugane are these api so it's the learning curve",
    "start": "1146420",
    "end": "1153620"
  },
  {
    "text": "will be very low also this thing is fully automated once you deploy it you don't need to worry about just they",
    "start": "1153620",
    "end": "1160310"
  },
  {
    "text": "object anymore migrator will do the job for you also it's resilient to failures",
    "start": "1160310",
    "end": "1166460"
  },
  {
    "text": "like if your API server crashes if the migrator self crashes it will recover",
    "start": "1166460",
    "end": "1172280"
  },
  {
    "text": "from the fail as long once it recovers from the failure it will continue the migration job as when",
    "start": "1172280",
    "end": "1178640"
  },
  {
    "text": "it when it's as before also it's vendor specific so you can deploy or changing",
    "start": "1178640",
    "end": "1184160"
  },
  {
    "text": "any cluster and environment you like let's look into some details so this is how you can",
    "start": "1184160",
    "end": "1192290"
  },
  {
    "start": "1189000",
    "end": "1189000"
  },
  {
    "text": "deploy the storage migrator in your cluster all you need to do is to",
    "start": "1192290",
    "end": "1197600"
  },
  {
    "text": "download the yellow files from the repository which is open completely open",
    "start": "1197600",
    "end": "1203210"
  },
  {
    "text": "source and then you just apply all the manifests and it will just created that",
    "start": "1203210",
    "end": "1208490"
  },
  {
    "text": "it's migrated here start to the migrator in your cluster and let's look at the",
    "start": "1208490",
    "end": "1218650"
  },
  {
    "start": "1216000",
    "end": "1216000"
  },
  {
    "text": "migration API so this is the this is a",
    "start": "1218650",
    "end": "1224270"
  },
  {
    "text": "simple migration so I highlighted the important of field so let's first look",
    "start": "1224270",
    "end": "1231350"
  },
  {
    "text": "at this back odorous resource so here says batch jobs v1 what it means is this",
    "start": "1231350",
    "end": "1237590"
  },
  {
    "text": "is migration request for batch objects so it requests the migrator to migrate",
    "start": "1237590",
    "end": "1244910"
  },
  {
    "text": "all the jobs in your sed to make sure they are in the latest a storage version and the name here it's just a",
    "start": "1244910",
    "end": "1254060"
  },
  {
    "text": "combination of the resource name and the group name next important bit is the",
    "start": "1254060",
    "end": "1264170"
  },
  {
    "text": "continual token so this is just a checkpoint of the migration progress so",
    "start": "1264170",
    "end": "1269900"
  },
  {
    "text": "this field is updated by the migrator automatically so that's well even if the",
    "start": "1269900",
    "end": "1276920"
  },
  {
    "text": "migrator if the migrated crashes and when it comes back it will just continue from where where it left it will",
    "start": "1276920",
    "end": "1284420"
  },
  {
    "text": "continue from this continue this checkpoint the next important bit is the",
    "start": "1284420",
    "end": "1291590"
  },
  {
    "text": "conditions so this is also a regular kubernetes api it says so here the",
    "start": "1291590",
    "end": "1298700"
  },
  {
    "text": "condition is it's running I means the migration is still ongoing and because",
    "start": "1298700",
    "end": "1304130"
  },
  {
    "text": "this migration thanks to this migration API to be fully kubernetes component you",
    "start": "1304130",
    "end": "1310730"
  },
  {
    "start": "1310000",
    "end": "1310000"
  },
  {
    "text": "can use some very generic Ricardo command to talk through the API the for",
    "start": "1310730",
    "end": "1317480"
  },
  {
    "text": "example why you want to upgrade or downgrade your API server you need to make sure all the",
    "start": "1317480",
    "end": "1323570"
  },
  {
    "text": "migrations have completed and you can do this with a one-liner you think that you",
    "start": "1323570",
    "end": "1328580"
  },
  {
    "text": "cut a weight because this is because the migration API used the conditions in",
    "start": "1328580",
    "end": "1334340"
  },
  {
    "text": "their API so you can just a cube for the weights for all the storage migration requests to be successful all right so",
    "start": "1334340",
    "end": "1347770"
  },
  {
    "text": "now let's talk about I want to dive into the my greatest tell you how it works",
    "start": "1347770",
    "end": "1356450"
  },
  {
    "text": "internally so that's I want to demystify it so when you ever have to debug it it",
    "start": "1356450",
    "end": "1362420"
  },
  {
    "text": "will be a little easier so basically the migrator is to loosely cupholder",
    "start": "1362420",
    "end": "1369620"
  },
  {
    "start": "1365000",
    "end": "1365000"
  },
  {
    "text": "controllers on the left side of the graph is the migration trigger",
    "start": "1369620",
    "end": "1375110"
  },
  {
    "text": "controller it's just that it will just",
    "start": "1375110",
    "end": "1380300"
  },
  {
    "text": "affect the discovery document from the API server continuously actually every",
    "start": "1380300",
    "end": "1385880"
  },
  {
    "text": "periodically and it was attacked when it was attacked when the storage",
    "start": "1385880",
    "end": "1392510"
  },
  {
    "text": "version has changed so for example if your API server has upgraded to the next",
    "start": "1392510",
    "end": "1397910"
  },
  {
    "text": "version the storage version might change but at this point the migration the",
    "start": "1397910",
    "end": "1403070"
  },
  {
    "text": "trigger controller will detect the storage version changes and it will",
    "start": "1403070",
    "end": "1408740"
  },
  {
    "text": "posted a migration requests once it detects the changes and on the right",
    "start": "1408740",
    "end": "1413870"
  },
  {
    "text": "side of the graph is the actual migrator controller what hit what just to watch",
    "start": "1413870",
    "end": "1420470"
  },
  {
    "text": "us for all the migration requests so once it attacked once the trigger",
    "start": "1420470",
    "end": "1425630"
  },
  {
    "text": "controller posted the migration law requests the migrator controller it will",
    "start": "1425630",
    "end": "1432160"
  },
  {
    "text": "actually migrated a resource for you so for example if the storage version of",
    "start": "1432160",
    "end": "1438500"
  },
  {
    "text": "the job has changed after your server upgrade the migration trigger controller will post a great oops",
    "start": "1438500",
    "end": "1447170"
  },
  {
    "text": "and the migrator controller it notice the new migration request and",
    "start": "1447170",
    "end": "1452820"
  },
  {
    "text": "actually migrates all the jobs for you not zooming to how the migrator",
    "start": "1452820",
    "end": "1459750"
  },
  {
    "text": "controller actually migrated a resource",
    "start": "1459750",
    "end": "1464600"
  },
  {
    "text": "so here the migrator controller is on the left have a PR survey and the CDR",
    "start": "1465380",
    "end": "1471510"
  },
  {
    "text": "and sed on the right so to actually migrate a resource",
    "start": "1471510",
    "end": "1477750"
  },
  {
    "text": "the migrated controller will first it will use the chunking list API to list",
    "start": "1477750",
    "end": "1483210"
  },
  {
    "text": "the first 500 objects of the resource so in our example it will just list the 550",
    "start": "1483210",
    "end": "1491400"
  },
  {
    "text": "500 jobs and then it will you get the",
    "start": "1491400",
    "end": "1496590"
  },
  {
    "text": "name or the name the list of of the names of the jobs then it will get the first job from the API server and",
    "start": "1496590",
    "end": "1503360"
  },
  {
    "text": "without making any change without to do any conversion that you were just to write to the job back in today API",
    "start": "1503360",
    "end": "1510960"
  },
  {
    "text": "server it actually the so the migrated control itself is actually done it",
    "start": "1510960",
    "end": "1516750"
  },
  {
    "text": "doesn't know all those API versions oh it does it's just to read the object and then write it back to the API server and",
    "start": "1516750",
    "end": "1523110"
  },
  {
    "text": "the API server once set to receive the object its were actually converted to",
    "start": "1523110",
    "end": "1529560"
  },
  {
    "text": "the storage version and the writer to their CD and if the object is already in",
    "start": "1529560",
    "end": "1535170"
  },
  {
    "text": "the storage version then the API server will not will not do anything it will",
    "start": "1535170",
    "end": "1540300"
  },
  {
    "text": "just do it will just the return present nowak so this is the actual migration",
    "start": "1540300",
    "end": "1547650"
  },
  {
    "text": "how the migration has done it actually relies on the API server to do the conversion and the migration migrator",
    "start": "1547650",
    "end": "1556830"
  },
  {
    "text": "controller will do this thing 500 times and here it finished one chunk after one",
    "start": "1556830",
    "end": "1562770"
  },
  {
    "text": "chunk of the object is done it will record the progress in the migration goes back that's where the continue to",
    "start": "1562770",
    "end": "1570330"
  },
  {
    "text": "continual token comes from so basically it will say I have already upgraded",
    "start": "1570330",
    "end": "1575520"
  },
  {
    "text": "these 500 jobs if I crash it's a checkpoint when I crash when I come back",
    "start": "1575520",
    "end": "1582270"
  },
  {
    "text": "I we'll continue from this continual token so the migrator controller will do this",
    "start": "1582270",
    "end": "1589720"
  },
  {
    "text": "repeatedly until it has finished and - it has iterated through all the",
    "start": "1589720",
    "end": "1595240"
  },
  {
    "text": "instances of this resource then it will mark the migration status has succeeded",
    "start": "1595240",
    "end": "1603090"
  },
  {
    "text": "so this is the life this is the life cycle of one migration request so in",
    "start": "1603090",
    "end": "1609820"
  },
  {
    "text": "your system there might be multiple migration requests for different two resources they are just multiple",
    "start": "1609820",
    "end": "1617380"
  },
  {
    "text": "instances running migrate those resources yeah that's how that's how",
    "start": "1617380",
    "end": "1625840"
  },
  {
    "text": "that my greater works and at last I want to talk about the timeline that's my",
    "start": "1625840",
    "end": "1632860"
  },
  {
    "start": "1627000",
    "end": "1627000"
  },
  {
    "text": "greater self is it seeing the coconutty is hosted in the coconut is six the repository currently it's still alpha",
    "start": "1632860",
    "end": "1641470"
  },
  {
    "text": "but it has met all the beta requirements we listed in their cap so we plan to",
    "start": "1641470",
    "end": "1648780"
  },
  {
    "text": "graduate it to beta in this month and then we will we plan to make it GA in q3",
    "start": "1648780",
    "end": "1658270"
  },
  {
    "text": "of 1019 and so at this point I want your",
    "start": "1658270",
    "end": "1663700"
  },
  {
    "text": "support I hope you can try the migrator in your own cluster and report any",
    "start": "1663700",
    "end": "1669850"
  },
  {
    "text": "issues you found so that we can make it to stay in the next quarter yep that's",
    "start": "1669850",
    "end": "1681100"
  },
  {
    "text": "it thank you [Applause]",
    "start": "1681100",
    "end": "1689429"
  },
  {
    "text": "have any questions",
    "start": "1690480",
    "end": "1693960"
  },
  {
    "text": "what happens when you're doing the migration there are added or deleted jobs seen the list yeah that's a very",
    "start": "1708530",
    "end": "1716930"
  },
  {
    "text": "good question the interesting thing is I don't care",
    "start": "1716930",
    "end": "1722240"
  },
  {
    "text": "about those newly created their jobs but that's because after you start your",
    "start": "1722240",
    "end": "1729620"
  },
  {
    "text": "migration and if someone comes to create a new job those new jobs are there they",
    "start": "1729620",
    "end": "1735620"
  },
  {
    "text": "must be extorting the latest a storage work because it's the latest API server",
    "start": "1735620",
    "end": "1741560"
  },
  {
    "text": "handling the request but all we actually need to migrate is the jobs that's",
    "start": "1741560",
    "end": "1746660"
  },
  {
    "text": "created in was the previous API server so I don't actually care about those",
    "start": "1746660",
    "end": "1752510"
  },
  {
    "text": "things and if you delete the job of course that's if it's gone then the",
    "start": "1752510",
    "end": "1757580"
  },
  {
    "text": "migrator will just because the migrated Oh get migrator will just get it and",
    "start": "1757580",
    "end": "1763040"
  },
  {
    "text": "then your party right I if that's deleted and the puts will fail so",
    "start": "1763040",
    "end": "1768580"
  },
  {
    "text": "migrator will just ignore it I think near is a potential issue for example",
    "start": "1768580",
    "end": "1775040"
  },
  {
    "text": "you have migrated 500 objects and and",
    "start": "1775040",
    "end": "1781150"
  },
  {
    "text": "the during the next batch some objects are deleted so when you're",
    "start": "1781150",
    "end": "1786530"
  },
  {
    "text": "going to this to the next 500 objects maybe some some objects are skipped",
    "start": "1786530",
    "end": "1791990"
  },
  {
    "text": "because they are in the first 500 but",
    "start": "1791990",
    "end": "1798950"
  },
  {
    "text": "this continua token it's not based on the index of the things alright so you're saying we already listed 500",
    "start": "1798950",
    "end": "1805970"
  },
  {
    "text": "things we should start from the 500 501",
    "start": "1805970",
    "end": "1811400"
  },
  {
    "text": "thing and because it deleted something the 501 thing has actually become the 400 MB but that's not how the chunking",
    "start": "1811400",
    "end": "1817820"
  },
  {
    "text": "API works so all the chunk the chunking API is actually based on the the name",
    "start": "1817820",
    "end": "1824270"
  },
  {
    "text": "the name of the object so I say so when they say I listed the first 500 thing",
    "start": "1824270",
    "end": "1830420"
  },
  {
    "text": "and the last job name is say a so then it will just when you when you",
    "start": "1830420",
    "end": "1837140"
  },
  {
    "text": "send the continue token to the API servers or just to continue from the next thing in the alphabetical order",
    "start": "1837140",
    "end": "1845030"
  },
  {
    "text": "it's not so based on the index of the things it's not so the remember okay",
    "start": "1845030",
    "end": "1851390"
  },
  {
    "text": "thank you ah this is very tricky I asked",
    "start": "1851390",
    "end": "1860450"
  },
  {
    "text": "how fast it is or give me some numbers on how fast it is on a small medium and",
    "start": "1860450",
    "end": "1866090"
  },
  {
    "text": "large so we did some mess yes you are",
    "start": "1866090",
    "end": "1872539"
  },
  {
    "text": "actually migrating things like config maps let's say you have 1 million compact maps and suppose R QP s is like",
    "start": "1872539",
    "end": "1879770"
  },
  {
    "text": "only 5 then it can take place and is this likely to have some influence on",
    "start": "1879770",
    "end": "1886100"
  },
  {
    "text": "triggering API call limiting or anything because of what's going on with this tool because it's because we have to if",
    "start": "1886100",
    "end": "1895970"
  },
  {
    "text": "we have the QP s limit right the client has a QP s limit if we set it to 5 in",
    "start": "1895970",
    "end": "1902750"
  },
  {
    "text": "default so your student to cause too much havoc on it as it is there a way to",
    "start": "1902750",
    "end": "1909650"
  },
  {
    "text": "filter this of the you only upgrade one namespace or some portion that you",
    "start": "1909650",
    "end": "1915679"
  },
  {
    "text": "control now I don't see why that can be",
    "start": "1915679",
    "end": "1922100"
  },
  {
    "text": "helpful because even if you only upgrade one namespace and then you upgrade your",
    "start": "1922100",
    "end": "1928159"
  },
  {
    "text": "API server then things in the in other namespaces are still still right there's some backup and restore scenarios where",
    "start": "1928159",
    "end": "1935480"
  },
  {
    "text": "you've there are things like the Bolero project that backup kubernetes not threw",
    "start": "1935480",
    "end": "1941840"
  },
  {
    "text": "in a full at CD backup but through API calls and then have a restore process",
    "start": "1941840",
    "end": "1947390"
  },
  {
    "text": "now it could be that since the recovery would be writing they they trigger an",
    "start": "1947390",
    "end": "1952610"
  },
  {
    "text": "auto update anyway but I was just wondering about politics so you're",
    "start": "1952610",
    "end": "1958370"
  },
  {
    "text": "saying there are other process that can actually trigger the well a velaro",
    "start": "1958370",
    "end": "1963820"
  },
  {
    "text": "backup could back up an entire cluster through API calls then you could selectively restore",
    "start": "1963820",
    "end": "1971220"
  },
  {
    "text": "just one namespace right okay",
    "start": "1971220",
    "end": "1982410"
  },
  {
    "text": "effectively it's doing what this is just because you rewrote it so you wouldn't even need to worry about it okay thanks",
    "start": "1982410",
    "end": "1990409"
  },
  {
    "text": "this ticker short if I am trying to",
    "start": "2004570",
    "end": "2010240"
  },
  {
    "text": "recreate some some workload that can generate child o clock like let's say",
    "start": "2010240",
    "end": "2016850"
  },
  {
    "text": "deployment and it generates replica set",
    "start": "2016850",
    "end": "2021890"
  },
  {
    "text": "and I when I upgrade this deployment is",
    "start": "2021890",
    "end": "2027500"
  },
  {
    "text": "that means those replicas set will immediately be destroyed so so this",
    "start": "2027500",
    "end": "2037040"
  },
  {
    "text": "migration it doesn't change the semantics of your object the spec of the",
    "start": "2037040",
    "end": "2044420"
  },
  {
    "text": "object it's a no op right oh it does this is forced the API server to rewrite",
    "start": "2044420",
    "end": "2049639"
  },
  {
    "text": "the object in sed to the latest version so if I I upgrade ApS or and the",
    "start": "2049640",
    "end": "2058700"
  },
  {
    "text": "deployment and replica set their storage words in both upgraded all I need to do",
    "start": "2058700",
    "end": "2066500"
  },
  {
    "text": "is first mini great the deployment and meet with how the replica set and that's",
    "start": "2066500",
    "end": "2072710"
  },
  {
    "text": "it right yeah that's true this is automated the the triggering controller it was attacked that storage",
    "start": "2072710",
    "end": "2080690"
  },
  {
    "text": "version of the deployment and the storage version of the replica set has changed so it will coasted to migration",
    "start": "2080690",
    "end": "2086870"
  },
  {
    "text": "requests for you thank you",
    "start": "2086870",
    "end": "2094600"
  }
]