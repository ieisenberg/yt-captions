[
  {
    "start": "0",
    "end": "242000"
  },
  {
    "text": "good morning everyone it's 11:10 so let's get started I'm gonna talk to you",
    "start": "30",
    "end": "7500"
  },
  {
    "text": "today about custom resource definitions one of my favorite parts of kubernetes and I'm James Bo's I'm the technical",
    "start": "7500",
    "end": "15990"
  },
  {
    "text": "lead at manifold I'm gonna get my promotion out of the way up front we're a marketplace for cloud services and my",
    "start": "15990",
    "end": "25140"
  },
  {
    "text": "clicker is not working it is it'll go so summer months ago we migrated to",
    "start": "25140",
    "end": "32148"
  },
  {
    "text": "kubernetes and I want to tell you a bit about the process that we went through",
    "start": "32149",
    "end": "37700"
  },
  {
    "text": "the pain points we hit how we sort of got around them and hopefully it's",
    "start": "37700",
    "end": "43079"
  },
  {
    "text": "something that you might be interested in and you can use as well you know if you're going through migrations or just",
    "start": "43079",
    "end": "49050"
  },
  {
    "text": "sort of experiencing these things yourself so we started with a you know",
    "start": "49050",
    "end": "54510"
  },
  {
    "text": "fairly typical setup right we had a monolithic application and we had an",
    "start": "54510",
    "end": "59609"
  },
  {
    "text": "infrastructure that matched it you know single auto scaling group that ran multiple instances of this application",
    "start": "59609",
    "end": "66020"
  },
  {
    "text": "one load balancer in front so we started off at least in a better place because",
    "start": "66020",
    "end": "71760"
  },
  {
    "text": "we had already began was containerized to applications right so it was you know we had an a on ami that we built and",
    "start": "71760",
    "end": "78810"
  },
  {
    "text": "then we used cloud on it to sort of inject whatever instance of the container image was sort of the latest",
    "start": "78810",
    "end": "85650"
  },
  {
    "text": "build and then we had sort of some secondary containers that were like a pre-configured to always be a part of",
    "start": "85650",
    "end": "91650"
  },
  {
    "text": "the of the deployment so like for logging and monitoring of course we",
    "start": "91650",
    "end": "97530"
  },
  {
    "text": "start building more and you know we get a more complicated architecture for our",
    "start": "97530",
    "end": "104009"
  },
  {
    "text": "system right so we've got more features we add in as as new services right and",
    "start": "104009",
    "end": "110189"
  },
  {
    "text": "take some of the existing architecture and sort of features and pull it out into different services and this was",
    "start": "110189",
    "end": "119070"
  },
  {
    "text": "great for the application level but you know I guess we heard sort of earlier",
    "start": "119070",
    "end": "124259"
  },
  {
    "text": "today having a service where you've got like one container per VM and then we've got you know",
    "start": "124259",
    "end": "130220"
  },
  {
    "text": "like tens of load balancers it's just not great right it was expensive",
    "start": "130220",
    "end": "136910"
  },
  {
    "text": "it was slow to deploy and we sort of had this large mess of configuration",
    "start": "136910",
    "end": "144620"
  },
  {
    "text": "management for the infrastructure level so we began like I said with some a",
    "start": "144620",
    "end": "150730"
  },
  {
    "text": "pretty simple setup where we had Packer building our ami is to start with and",
    "start": "150730",
    "end": "156680"
  },
  {
    "text": "then we use terraform for like everything from you know setting up DNS to setting up the auto scaling groups",
    "start": "156680",
    "end": "163910"
  },
  {
    "text": "and actually running the deploys as well so we could do you can just do like blue green deploys with terraform when you're",
    "start": "163910",
    "end": "170150"
  },
  {
    "text": "using auto scale groups and then some good old shell script for sort of gluing",
    "start": "170150",
    "end": "176600"
  },
  {
    "text": "together a bit of the the ami layer well we've got a like you know runs some some commands on one sort of one startup of",
    "start": "176600",
    "end": "182780"
  },
  {
    "text": "the machine and so we moved over to a set up that was just terraforming",
    "start": "182780",
    "end": "189530"
  },
  {
    "text": "kubernetes with using cops to sort of you know set up this generate all this",
    "start": "189530",
    "end": "194570"
  },
  {
    "text": "terraform for us so we had kind of like",
    "start": "194570",
    "end": "201470"
  },
  {
    "text": "reduced the number of moving parts we had to use even though you know there was not much bash but you look at like a",
    "start": "201470",
    "end": "210709"
  },
  {
    "text": "lot of the examples and everything for kubernetes and you see the the manifest files and and it looks a lot like",
    "start": "210709",
    "end": "218000"
  },
  {
    "text": "configuration management right so you're thinking like this this is what I want to use right I can and especially with",
    "start": "218000",
    "end": "224180"
  },
  {
    "text": "all of these sort of secondary projects in the larger ecosystem you can control a lot more than just sort of your",
    "start": "224180",
    "end": "230900"
  },
  {
    "text": "application code in your cluster right you can configure SSL Certificates in",
    "start": "230900",
    "end": "235970"
  },
  {
    "text": "DNS and so you've you're doing all of this through kubernetes manifests so we",
    "start": "235970",
    "end": "243530"
  },
  {
    "start": "242000",
    "end": "798000"
  },
  {
    "text": "had this all set up and we had what I thought was a pretty good architecture right now we've got this separation where I've got a layer just sort of for",
    "start": "243530",
    "end": "250730"
  },
  {
    "text": "the cloud provider which is mainly terraform and then arguably sort of",
    "start": "250730",
    "end": "256760"
  },
  {
    "text": "some-some manifests that we deploy it with queue control right where things like DNS and like SSL Certificates you'd",
    "start": "256760",
    "end": "263180"
  },
  {
    "text": "say okay this is the base layer and then we had our kubernetes layer right again sort of a",
    "start": "263180",
    "end": "269419"
  },
  {
    "text": "mixture of both and arguably like the way I see its are our names faces are",
    "start": "269419",
    "end": "274669"
  },
  {
    "text": "sort of cluster level and then the application level which was just",
    "start": "274669",
    "end": "281210"
  },
  {
    "text": "manifest right so no more having to do terraform apply and sort of rolling out",
    "start": "281210",
    "end": "286639"
  },
  {
    "text": "new auto scaling groups when we did a deploy and this is awesome because we",
    "start": "286639",
    "end": "291919"
  },
  {
    "text": "you know it's a lot faster since we don't have to wait for these machines to",
    "start": "291919",
    "end": "297110"
  },
  {
    "text": "boot but what we started to see was that",
    "start": "297110",
    "end": "302360"
  },
  {
    "text": "you know if you look at all these services that we have that are very similar in structure everything has a",
    "start": "302360",
    "end": "308979"
  },
  {
    "text": "well an actual service right it has a deployment and most of them have ingress",
    "start": "308979",
    "end": "315409"
  },
  {
    "text": "is since they're publicly facing and the only thing that varies would like we have also got we've also got similar",
    "start": "315409",
    "end": "322940"
  },
  {
    "text": "environment variables right sort of base setups since we've written all this code and we've written it using the same",
    "start": "322940",
    "end": "329300"
  },
  {
    "text": "language and frameworks it's sort of they all sort of expect the same inputs when they start up so they're all very",
    "start": "329300",
    "end": "335720"
  },
  {
    "text": "similar with just slight differences maybe one or two different environment variables this one's talking to a different database than this one you",
    "start": "335720",
    "end": "342440"
  },
  {
    "text": "know obviously sort of the actual container image is different between them and then we had them repeated",
    "start": "342440",
    "end": "350090"
  },
  {
    "text": "across come on Bluetooth repeated across a lot of environments right so we had",
    "start": "350090",
    "end": "357139"
  },
  {
    "text": "our stage in our fraud in vironment and we have a devil of a so we've got like three different directories that all",
    "start": "357139",
    "end": "363139"
  },
  {
    "text": "have the same yamo for the for all these applications that also sort of have",
    "start": "363139",
    "end": "370070"
  },
  {
    "text": "similar groupings of llam√≥ and it's a lot of coffee paste and it's a lot of",
    "start": "370070",
    "end": "380360"
  },
  {
    "text": "coffee taste but just with slight differences right so it's a great place to make a mistake right copy over this one and forget to actually bump the",
    "start": "380360",
    "end": "387139"
  },
  {
    "text": "version on your container image when you get a Prada whatever so we had taken our complexity like from the from the",
    "start": "387139",
    "end": "394490"
  },
  {
    "text": "infrastructure level and just moved it up into our applique chin level same kind of repetition and",
    "start": "394490",
    "end": "400240"
  },
  {
    "text": "sort of places to make mistakes and I think the the sort of the first mistake",
    "start": "400240",
    "end": "406870"
  },
  {
    "text": "we made in this is that assuming that these manifests are you know configuration management when really",
    "start": "406870",
    "end": "413410"
  },
  {
    "text": "this is a this is you know what you pass in to keep control but it's a direct mapping to an API object that exists in",
    "start": "413410",
    "end": "421150"
  },
  {
    "text": "kubernetes right this is a deployment object and essentially what you have and",
    "start": "421150",
    "end": "426610"
  },
  {
    "text": "this is sort of the good part right is that what you have in a manifest file is then what exists in cluster obviously",
    "start": "426610",
    "end": "435340"
  },
  {
    "text": "there's some differences about sort of the actual status and everything but the the intention is that you want to synchronize these files into the actual",
    "start": "435340",
    "end": "443260"
  },
  {
    "text": "state but that doesn't sort of work well for you know for templating and for",
    "start": "443260",
    "end": "448810"
  },
  {
    "text": "having laws of repetition so we wanted",
    "start": "448810",
    "end": "455919"
  },
  {
    "text": "to get away from this sort of vast expanse of llam√≥ that we had and we sort",
    "start": "455919",
    "end": "466030"
  },
  {
    "text": "of looked at you know all your traditional options right like are we gonna bring these things back in are we gonna am I gonna have to write ansible",
    "start": "466030",
    "end": "472630"
  },
  {
    "text": "playbooks or you know again and I didn't really want to and we looked at sort of some of",
    "start": "472630",
    "end": "480130"
  },
  {
    "text": "the you know the the more sort of kubernetes native things right helm",
    "start": "480130",
    "end": "485530"
  },
  {
    "text": "wasn't really working for me right because I'm not looking at at having a",
    "start": "485530",
    "end": "492520"
  },
  {
    "text": "sort of simplified sort of general-purpose application deployment for other people I'm looking at having",
    "start": "492520",
    "end": "498820"
  },
  {
    "text": "all these applications that are similar and coming like just you know just to me just to us and case on it is appealing",
    "start": "498820",
    "end": "508410"
  },
  {
    "text": "but it's you know fits like a similar model to some of the some of the",
    "start": "508919",
    "end": "514120"
  },
  {
    "text": "existing tools so we started looking around that you know looking at kubernetes itself right sort of this is",
    "start": "514120",
    "end": "520900"
  },
  {
    "text": "a base thing you have is your pod and you have multiple pods and they form a",
    "start": "520900",
    "end": "526450"
  },
  {
    "text": "replica set right you have multiple multiple replica sets form a deployment",
    "start": "526450",
    "end": "532900"
  },
  {
    "text": "right as you as you do your deployment you bring up the new replica set and you scale up and down the old and new",
    "start": "532900",
    "end": "540670"
  },
  {
    "text": "and so this depart is then this sort of base unit that these other parts build",
    "start": "540670",
    "end": "546190"
  },
  {
    "text": "on and the pod is existed for a long time sort of you know different versions",
    "start": "546190",
    "end": "552100"
  },
  {
    "text": "of of these concepts have sort of been built and replaced on top of it additional ones are there too right like",
    "start": "552100",
    "end": "557110"
  },
  {
    "text": "Damon's had some staple sets and then sort of looking out wider you know you",
    "start": "557110",
    "end": "564910"
  },
  {
    "text": "look at sorry docker for Mac and Windows when they added kubernetes support and",
    "start": "564910",
    "end": "571860"
  },
  {
    "text": "one of the sort of you know neat features of this was hey you can use a compose file with kubernetes and it's",
    "start": "571860",
    "end": "581560"
  },
  {
    "text": "really just taking this compose file and sort of putting your your sort of",
    "start": "581560",
    "end": "586780"
  },
  {
    "text": "standard kubernetes like header on top of it getting your metadata in there and then pushing it up through ivett like so",
    "start": "586780",
    "end": "594670"
  },
  {
    "text": "you could take this your compose file and sort of hand add these these fields or use docker stack and the dr. stack",
    "start": "594670",
    "end": "602590"
  },
  {
    "text": "command and run it as well and it'll just go right to a kubernetes api server and then through api server aggregation",
    "start": "602590",
    "end": "609850"
  },
  {
    "text": "you know this bounces over to these darker specific compose api server which",
    "start": "609850",
    "end": "617830"
  },
  {
    "text": "sees us and says okay cool i'm going to make a this compose object that now lives within kubernetes the",
    "start": "617830",
    "end": "625840"
  },
  {
    "text": "controller sees this and then just speaks again to the API server",
    "start": "625840",
    "end": "631650"
  },
  {
    "text": "and says hey you know I know how to understand the contents of the compose file so I'm going to go ahead and I'm",
    "start": "631650",
    "end": "639010"
  },
  {
    "text": "going to make all of the components that are necessary to sort of reflect this",
    "start": "639010",
    "end": "644940"
  },
  {
    "text": "into the cluster so this is all happening within the cluster right and",
    "start": "644940",
    "end": "650970"
  },
  {
    "text": "you could either use docker stack or you could use cube control to actually have",
    "start": "650970",
    "end": "656890"
  },
  {
    "text": "this happen and then another recent example",
    "start": "656890",
    "end": "662710"
  },
  {
    "text": "is a gonna is which I'm sure I'm mispronouncing but it's a project to",
    "start": "662710",
    "end": "669530"
  },
  {
    "text": "sort of build this general purpose tool for doing Game Servers by Google and",
    "start": "669530",
    "end": "675110"
  },
  {
    "text": "Ubisoft and so there's sort of your application specific like Lobby or and",
    "start": "675110",
    "end": "681350"
  },
  {
    "text": "you know in a client connects this you have multiple clients connect to this Lobby or like matchmaking server and",
    "start": "681350",
    "end": "687460"
  },
  {
    "text": "this specific logic then says ok cool I've got enough people to start a game I've sort of paired them all up and I'm",
    "start": "687460",
    "end": "694400"
  },
  {
    "text": "just gonna speak to the kubernetes api server and i'm gonna say make a game server this makes a new kubernetes",
    "start": "694400",
    "end": "701270"
  },
  {
    "text": "resource that's a custom resource definition and and the echo known as",
    "start": "701270",
    "end": "707540"
  },
  {
    "text": "controller comes along and looks at this and sort of does the the specific logic",
    "start": "707540",
    "end": "713150"
  },
  {
    "text": "needed to then make this into an actual pod right and the purpose here is that they have these sort of somewhat",
    "start": "713150",
    "end": "721820"
  },
  {
    "text": "ephemeral pods that are specific for the the players in this in this game and",
    "start": "721820",
    "end": "729020"
  },
  {
    "text": "there's a direct connection to the outside world like instead of going through a service or ingress or anything",
    "start": "729020",
    "end": "736300"
  },
  {
    "text": "because they want to maintain this sort of low latency of a direct connection so",
    "start": "736300",
    "end": "742340"
  },
  {
    "text": "look at all these things and then sort of some points kind of struck for us",
    "start": "742340",
    "end": "747440"
  },
  {
    "text": "right is that kubernetes is all about composition right so taking these base components and sort of building",
    "start": "747440",
    "end": "753830"
  },
  {
    "text": "abstractions and additional features on top of them and the other kind of weird",
    "start": "753830",
    "end": "760130"
  },
  {
    "text": "thing is that in some ways kubernetes is a database as well right you have the API server with custom",
    "start": "760130",
    "end": "766550"
  },
  {
    "text": "resource definitions or even the API server aggregation and it's responsible just for taking in objects and",
    "start": "766550",
    "end": "772430"
  },
  {
    "text": "persisting them and then there's other components that like controllers that",
    "start": "772430",
    "end": "777560"
  },
  {
    "text": "run that sort of do something with this information either they you know add more into the API server or eventually",
    "start": "777560",
    "end": "784370"
  },
  {
    "text": "you get down to like actually scheduling pods or you get down to creating DNS",
    "start": "784370",
    "end": "791570"
  },
  {
    "text": "entries and like a you know completely different cloud service",
    "start": "791570",
    "end": "797950"
  },
  {
    "text": "so what we did was we said a we're gonna make our own custom resource definitions and we're going to build a controller to",
    "start": "797950",
    "end": "804920"
  },
  {
    "start": "798000",
    "end": "945000"
  },
  {
    "text": "handle this so we're going to model our sort of specific logic around these are",
    "start": "804920",
    "end": "813560"
  },
  {
    "text": "around our services as Sierra T's and we're going to handle that",
    "start": "813560",
    "end": "819050"
  },
  {
    "text": "you know template expansion in kubernetes itself and so the recipe for",
    "start": "819050",
    "end": "826220"
  },
  {
    "text": "this is you need a custom resource definition you need a controller and then you can add admission controllers",
    "start": "826220",
    "end": "833420"
  },
  {
    "text": "to taste so let's step through these so",
    "start": "833420",
    "end": "838579"
  },
  {
    "text": "some more llamo a basic CRT like so in",
    "start": "838579",
    "end": "843890"
  },
  {
    "text": "our case right we've got this application that is sort of you know what we call our micro service or",
    "start": "843890",
    "end": "850040"
  },
  {
    "text": "whatever and all you're doing is reserving a namespace you're you're saying this is what this thing is called",
    "start": "850040",
    "end": "855769"
  },
  {
    "text": "and it's going to sort of live under my my API group and there's nothing here",
    "start": "855769",
    "end": "862130"
  },
  {
    "text": "about about schema or the actual shape of what these look like right and this",
    "start": "862130",
    "end": "867380"
  },
  {
    "text": "is how we're on ours and I think it's a matter of sort of the the support for",
    "start": "867380",
    "end": "873890"
  },
  {
    "text": "that which Hilton next slide um is a little bit newer but also maybe not",
    "start": "873890",
    "end": "879770"
  },
  {
    "text": "necessary depending on who your audience is so if you're working on a small team like I am it's enough just to sort of",
    "start": "879770",
    "end": "887029"
  },
  {
    "text": "tell each other like hey you know this is what things look like so don't worry about validating on a server but you are",
    "start": "887029",
    "end": "895459"
  },
  {
    "text": "able to use open ABI a schema validation to sort of enforce some of these things",
    "start": "895459",
    "end": "903260"
  },
  {
    "text": "and uh word of warning though is that open API v3 schema validation is a subset of JSON schema and the flavor",
    "start": "903260",
    "end": "911810"
  },
  {
    "text": "used in kubernetes doesn't support all parts of open API v3 schema so sometimes",
    "start": "911810",
    "end": "917449"
  },
  {
    "text": "there can be some gotchas specifically sort of references to other objects",
    "start": "917449",
    "end": "925370"
  },
  {
    "text": "isn't going to work - Oh but defaults as well don't sort of fit in here and we'll come back to defaults",
    "start": "925370",
    "end": "931920"
  },
  {
    "text": "anyways it is a good place like if you wanted to say that a policy of your organization is now we have to have at",
    "start": "931920",
    "end": "939269"
  },
  {
    "text": "least two of these things running then you can you know enforce that there's going to be two replicas and then the",
    "start": "939269",
    "end": "946470"
  },
  {
    "start": "945000",
    "end": "1023000"
  },
  {
    "text": "next part of course is the controller and if I was going to have a bunch of code on my own in my slides it would all",
    "start": "946470",
    "end": "954089"
  },
  {
    "text": "be around this because this is where we spend most of our time but the idea here",
    "start": "954089",
    "end": "959610"
  },
  {
    "text": "is that you take your application you know our application definition which we're where we would basically say",
    "start": "959610",
    "end": "965120"
  },
  {
    "text": "this is the container image that you're going to use and these are some additional environment variables and the",
    "start": "965120",
    "end": "973050"
  },
  {
    "text": "controller knows that I'm going to need to make a deploy out of this to actually you know run the code have a service map",
    "start": "973050",
    "end": "980850"
  },
  {
    "text": "to this and then include an ingress with it and our logic here is unable to sort",
    "start": "980850",
    "end": "987149"
  },
  {
    "text": "of take our our default a default config map we have that sort of contains a base environment variables and inject this in",
    "start": "987149",
    "end": "993720"
  },
  {
    "text": "as well for everything but what the",
    "start": "993720",
    "end": "1000290"
  },
  {
    "text": "controller does is it says okay I know that I need these parts what exists in the system right now and I'll",
    "start": "1000290",
    "end": "1008240"
  },
  {
    "text": "just create everything that's missing right so this is sort of where your template expansion happens again I said",
    "start": "1008240",
    "end": "1014660"
  },
  {
    "text": "you know this is where all the code would be and this is the takeaway myself",
    "start": "1014660",
    "end": "1020720"
  },
  {
    "text": "for this if we were gonna go back and do it again I would say to just start with meta controller so if you're not",
    "start": "1020720",
    "end": "1028280"
  },
  {
    "start": "1023000",
    "end": "1123000"
  },
  {
    "text": "familiar with it meta controller is a quite nice project that sort of wraps a",
    "start": "1028280",
    "end": "1033770"
  },
  {
    "text": "lot of the controller logic and uses sort of lambda functions or web hooks",
    "start": "1033770",
    "end": "1040010"
  },
  {
    "text": "that you provide to to actually give like your you know specific logic for so",
    "start": "1040010",
    "end": "1047390"
  },
  {
    "text": "one of the sort of flavors of controller that you can do with this is a component",
    "start": "1047390",
    "end": "1053900"
  },
  {
    "text": "controller where you are you know you're given like in this sort of web book you're given a pair",
    "start": "1053900",
    "end": "1060850"
  },
  {
    "text": "and children and so this models like that you know the way of taking this application object and expanding it out",
    "start": "1060850",
    "end": "1067419"
  },
  {
    "text": "into the other resources so your code is able to just say like look at the the",
    "start": "1067419",
    "end": "1073299"
  },
  {
    "text": "parent that's passed in and return like always just return the the children that",
    "start": "1073299",
    "end": "1079929"
  },
  {
    "text": "you expect to come out of that and if they exists already and you know someone's tampered with one but you see",
    "start": "1079929",
    "end": "1086770"
  },
  {
    "text": "you always just sort of look at the parent and return the expected children and then everything will sort of get",
    "start": "1086770",
    "end": "1092200"
  },
  {
    "text": "fixed up to the expected state so for us we had to worry about actually like you",
    "start": "1092200",
    "end": "1098980"
  },
  {
    "text": "know registering listeners for all these different objects and making API calls to actually like reflect them back into",
    "start": "1098980",
    "end": "1104409"
  },
  {
    "text": "the API server versus just returning you know a single sort of result out of some",
    "start": "1104409",
    "end": "1110169"
  },
  {
    "text": "JavaScript or Python or whatever so yeah I would definitely like as a first place",
    "start": "1110169",
    "end": "1118000"
  },
  {
    "text": "to start you know prototyping if you want to look at doing this kind of thing this is the place to begin for sure so moving right",
    "start": "1118000",
    "end": "1125350"
  },
  {
    "start": "1123000",
    "end": "1267000"
  },
  {
    "text": "along to the optional pieces the web",
    "start": "1125350",
    "end": "1132070"
  },
  {
    "text": "hooks for the admission web hooks so there's two flavors that we haven't felt",
    "start": "1132070",
    "end": "1137710"
  },
  {
    "text": "the need to use yet and I think a lot of this comes down to again sort of team size and where you need to socialize",
    "start": "1137710",
    "end": "1143020"
  },
  {
    "text": "these values but if we start with you",
    "start": "1143020",
    "end": "1148090"
  },
  {
    "text": "know our app coming in to the API server we can sort of you know pass along to",
    "start": "1148090",
    "end": "1155350"
  },
  {
    "text": "about one of the types of validating admission might poke so we can say like is this an OK request and this is where",
    "start": "1155350",
    "end": "1164020"
  },
  {
    "text": "you can implement logic that sort of doesn't fit into schema validation so",
    "start": "1164020",
    "end": "1169539"
  },
  {
    "text": "you know the contrived example you could say you're not allowed to set the debug environment variable for production",
    "start": "1169539",
    "end": "1176260"
  },
  {
    "text": "deploys so we can check the you know check to what's passed in and if it's yes and you know return a nice result",
    "start": "1176260",
    "end": "1182919"
  },
  {
    "text": "with a sort of readable error it says no and the API server will then return this result to whoever called the",
    "start": "1182919",
    "end": "1189520"
  },
  {
    "text": "API so you can see if you're running like cube control directly you can see oh this this wasn't permitted",
    "start": "1189520",
    "end": "1195880"
  },
  {
    "text": "as an aside this is sort of another place where you could implement some",
    "start": "1195880",
    "end": "1201150"
  },
  {
    "text": "interesting you know policies because you are able to see who made that",
    "start": "1201150",
    "end": "1206590"
  },
  {
    "text": "request so you could say something like you know on weekends only this person is",
    "start": "1206590",
    "end": "1213280"
  },
  {
    "text": "allowed to deploy and they can only deploy if it's like we're using semper and it's just a patch version bumper or",
    "start": "1213280",
    "end": "1219460"
  },
  {
    "text": "something like that so you can start to do sort of some more advanced you know",
    "start": "1219460",
    "end": "1225100"
  },
  {
    "text": "policy enforcement the other type is a mutating admission web book where you're",
    "start": "1225100",
    "end": "1230200"
  },
  {
    "text": "actually sort of able to take the the full object that's come in and modify it",
    "start": "1230200",
    "end": "1235929"
  },
  {
    "text": "so if you did want to use defaults this is a place to to implement that for us",
    "start": "1235929",
    "end": "1243429"
  },
  {
    "text": "we just did it in the in the controller because we're only expecting our",
    "start": "1243429",
    "end": "1249370"
  },
  {
    "text": "controller to actually read these objects but if you implement it sort of as part of a web hook then once it hits",
    "start": "1249370",
    "end": "1255160"
  },
  {
    "text": "the API server it already has these values like in the resource itself so",
    "start": "1255160",
    "end": "1260170"
  },
  {
    "text": "other controllers that may be doing different things can actually read them as well",
    "start": "1260170",
    "end": "1266400"
  },
  {
    "text": "so why why would you want to go down",
    "start": "1266400",
    "end": "1271929"
  },
  {
    "start": "1267000",
    "end": "1388000"
  },
  {
    "text": "this path instead of using you know ansible or pop out or chef four or",
    "start": "1271929",
    "end": "1277660"
  },
  {
    "text": "anything else for us it was because you know we didn't want to use bring in an",
    "start": "1277660",
    "end": "1283000"
  },
  {
    "text": "additional tool but well but we did want to get rid of all this duplication and",
    "start": "1283000",
    "end": "1290790"
  },
  {
    "text": "the CR DS exists already right this is something that we were able to build on",
    "start": "1290790",
    "end": "1295840"
  },
  {
    "text": "top of so some other points so if we",
    "start": "1295840",
    "end": "1301870"
  },
  {
    "text": "look at like how ansible an ansible deploy would work you know like you",
    "start": "1301870",
    "end": "1307270"
  },
  {
    "text": "start with sort of the template or the playbook on your system and then you expand it out there into these objects",
    "start": "1307270",
    "end": "1314290"
  },
  {
    "text": "and then you store all of those into kubernetes all right and then if we look",
    "start": "1314290",
    "end": "1320200"
  },
  {
    "text": "at what we do was with these CR DS and controllers you start with this template and you push that into kubernetes",
    "start": "1320200",
    "end": "1327250"
  },
  {
    "text": "through the API and then the expansion happens over there and the piece of the critical sort",
    "start": "1327250",
    "end": "1334570"
  },
  {
    "text": "of piece of that is you know the famous kubernetes reconciliation loop right which you could get with something like",
    "start": "1334570",
    "end": "1340960"
  },
  {
    "text": "running you know if you ran a puppet master or whatever you would have the same kind of periodic reconciliation but",
    "start": "1340960",
    "end": "1348370"
  },
  {
    "text": "this is running within your cluster and using a loop that sort of exists in this",
    "start": "1348370",
    "end": "1354789"
  },
  {
    "text": "cluster already instead of bringing in an additional component so this sort of",
    "start": "1354789",
    "end": "1360220"
  },
  {
    "text": "prevents you know some some mistakes that can be made if you if you delete a",
    "start": "1360220",
    "end": "1366370"
  },
  {
    "text": "service by accident the reconciliation live you know in your controller is going to see that this service is",
    "start": "1366370",
    "end": "1373750"
  },
  {
    "text": "missing whereas your sort of application CRD expects expects it to exist so it's",
    "start": "1373750",
    "end": "1381129"
  },
  {
    "text": "going to compare let's see that it's not there and then it's going to reconcile through by recreating it and the other",
    "start": "1381129",
    "end": "1388960"
  },
  {
    "start": "1388000",
    "end": "1443000"
  },
  {
    "text": "thing is sort of this composability part so this is a an ansible playbook just to",
    "start": "1388960",
    "end": "1399399"
  },
  {
    "text": "snip it right and running a deployment using Kate's 4ha module but it's really",
    "start": "1399399",
    "end": "1405730"
  },
  {
    "text": "simple to just switch this over to using your own custom resource definition so you can take these sort of built within",
    "start": "1405730",
    "end": "1412240"
  },
  {
    "text": "the cluster and then have other consumers use them right so if there's another part of your team that wants use",
    "start": "1412240",
    "end": "1418360"
  },
  {
    "text": "ansible or they want to build a slack bot or whatever they can speak to the kubernetes api and they can do this you",
    "start": "1418360",
    "end": "1425830"
  },
  {
    "text": "can also build on top of it within the cluster so there's there's nothing preventing you from building a you know",
    "start": "1425830",
    "end": "1432549"
  },
  {
    "text": "a CR D that is composed of other CRTs",
    "start": "1432549",
    "end": "1436950"
  },
  {
    "start": "1443000",
    "end": "1637000"
  },
  {
    "text": "so I'm you know we heard a bit about operators this morning and I think that we should all sort of consider building",
    "start": "1443130",
    "end": "1448840"
  },
  {
    "text": "our own operators for our own specific needs and it's not necessarily about",
    "start": "1448840",
    "end": "1455430"
  },
  {
    "text": "encoding complex logic in your controller but just about sort of",
    "start": "1455430",
    "end": "1460600"
  },
  {
    "text": "codifying the the shape of your architecture so a few sort of points of",
    "start": "1460600",
    "end": "1468610"
  },
  {
    "text": "caution is that CRTs are still relatively new and you know the big",
    "start": "1468610",
    "end": "1474730"
  },
  {
    "text": "potential pain point here is no multi versions support I think four and then",
    "start": "1474730",
    "end": "1480460"
  },
  {
    "text": "this is why the the docker example from earlier is done with API server",
    "start": "1480460",
    "end": "1486730"
  },
  {
    "text": "aggregation because you know there's sort of a need for being able to advance",
    "start": "1486730",
    "end": "1492460"
  },
  {
    "text": "versions and do it right now but for like internal company use I",
    "start": "1492460",
    "end": "1500410"
  },
  {
    "text": "think it's it's okay to especially with something that's not sort of super",
    "start": "1500410",
    "end": "1505420"
  },
  {
    "text": "complex to just say you know this this isn't an issue for us if we need to have",
    "start": "1505420",
    "end": "1511930"
  },
  {
    "text": "a new version of this resource well we'll just give it a different name you know and then people can use that we",
    "start": "1511930",
    "end": "1517450"
  },
  {
    "text": "don't need to sort of worry about the migration especially because if it's in your own cluster then you can sort of",
    "start": "1517450",
    "end": "1523210"
  },
  {
    "text": "see what exists that sort of the the old versions there's a lot of moving parts",
    "start": "1523210",
    "end": "1531250"
  },
  {
    "text": "to this see right so talking about the actual CRD definition the controller",
    "start": "1531250",
    "end": "1536890"
  },
  {
    "text": "code and then the optional webhooks even if you get into meta-chem troller",
    "start": "1536890",
    "end": "1542020"
  },
  {
    "text": "like you've got to deploy medic controller then you have to deploy your code that will actually receive this",
    "start": "1542020",
    "end": "1547180"
  },
  {
    "text": "webhook for that a controller and then you have to deploy the configuration",
    "start": "1547180",
    "end": "1552300"
  },
  {
    "text": "resource that will actually handle sort of firing this now in our case where we",
    "start": "1552300",
    "end": "1559120"
  },
  {
    "text": "did write everything in go and we use client go you know custom resource",
    "start": "1559120",
    "end": "1564340"
  },
  {
    "text": "definitions are just another type of API object in kubernetes so what we did was",
    "start": "1564340",
    "end": "1570790"
  },
  {
    "text": "we packaged that up in the code and when the controller starts it just ensures that it's",
    "start": "1570790",
    "end": "1576220"
  },
  {
    "text": "see our DS exists and if they don't it creates them so it was just sort of like one less thing to have to do but you",
    "start": "1576220",
    "end": "1581680"
  },
  {
    "text": "could also just you know deploy em file",
    "start": "1581680",
    "end": "1586020"
  },
  {
    "text": "and you know I the temps to sort of make",
    "start": "1588810",
    "end": "1594460"
  },
  {
    "text": "this a little easier to do or still early got Mehta controller a cubic it is",
    "start": "1594460",
    "end": "1601120"
  },
  {
    "text": "something that appear mine is working on just sort of taking some of our logic and then extracting it and then of",
    "start": "1601120",
    "end": "1606820"
  },
  {
    "text": "course operate our sdk you know announced this week which is looking quite promising for for any kind of",
    "start": "1606820",
    "end": "1613750"
  },
  {
    "text": "operator or sort of higher level sort of sort of resource dealing the abstraction",
    "start": "1613750",
    "end": "1621370"
  },
  {
    "text": "in the controller so anyways i'm i'm pretty excited about all this like i",
    "start": "1621370",
    "end": "1627490"
  },
  {
    "text": "think that the extensibility story in kubernetes is my favorite part of it i",
    "start": "1627490",
    "end": "1632500"
  },
  {
    "text": "think it has been quite useful for us and I'm excited to see where it goes oh",
    "start": "1632500",
    "end": "1640110"
  },
  {
    "start": "1637000",
    "end": "1964000"
  },
  {
    "text": "thank you and we've got a bit of time if",
    "start": "1640110",
    "end": "1649630"
  },
  {
    "text": "there's any questions yeah pardon me the",
    "start": "1649630",
    "end": "1657250"
  },
  {
    "text": "presentation or the the presentations up on the on the on sched and for code",
    "start": "1657250",
    "end": "1665920"
  },
  {
    "text": "there's a there's so there's links in them so for code you can go and take a look at cube kit for our actual like a",
    "start": "1665920",
    "end": "1672430"
  },
  {
    "text": "for our organization specific stuff I would look at examples of existing",
    "start": "1672430",
    "end": "1678810"
  },
  {
    "text": "existing sort of controllers because the the specific parts there are sort of you",
    "start": "1678810",
    "end": "1685390"
  },
  {
    "text": "know specific to us and not super interesting",
    "start": "1685390",
    "end": "1690420"
  },
  {
    "text": "yeah so why wasn't how a good fit so",
    "start": "1715870",
    "end": "1721270"
  },
  {
    "text": "having a standard template right with helm hell makes it simpler to sort of modify your single application right but",
    "start": "1721270",
    "end": "1731330"
  },
  {
    "text": "we're talking about many applications so it's really like kind of a trivial",
    "start": "1731330",
    "end": "1738140"
  },
  {
    "text": "difference and I think that you could even begin with helm actually I think they do complement each other quite well",
    "start": "1738140",
    "end": "1743929"
  },
  {
    "text": "is to start with helm and say things that I'm manipulating sort of on my laptop I make those simpler and then",
    "start": "1743929",
    "end": "1751010"
  },
  {
    "text": "have more of this logic in my cluster for performing reconciliation thank you",
    "start": "1751010",
    "end": "1756559"
  },
  {
    "text": "you're welcome oh yeah one more question yes like push",
    "start": "1756559",
    "end": "1788690"
  },
  {
    "text": "to a registry then you have to start with a lot of",
    "start": "1788690",
    "end": "1796120"
  },
  {
    "text": "kubernetes doesn't have a good watcher architecture and and implementing this",
    "start": "1802540",
    "end": "1808370"
  },
  {
    "text": "sort of with some CIT CD parts to build a pipeline I think that for internal",
    "start": "1808370",
    "end": "1814220"
  },
  {
    "text": "uses of kubernetes the walk watcher architecture is actually really great but that's for listening to you know",
    "start": "1814220",
    "end": "1821150"
  },
  {
    "text": "internal changes to the API server for receiving events brigades like some of",
    "start": "1821150",
    "end": "1830360"
  },
  {
    "text": "these sort of workflow driven things I think are are good options for that but I've not done anything with some cool",
    "start": "1830360",
    "end": "1838840"
  },
  {
    "text": "yes--you when we started working on the",
    "start": "1839270",
    "end": "1852980"
  },
  {
    "text": "controllers did we use meta controller no we started with client go so we're yeah yeah and that I mean it has a lot",
    "start": "1852980",
    "end": "1861110"
  },
  {
    "text": "of nice primitives for building controllers right that's sort of its purpose along with being a client of the",
    "start": "1861110",
    "end": "1867860"
  },
  {
    "text": "kubernetes api but it's um it is relatively low-level so we had to write",
    "start": "1867860",
    "end": "1874310"
  },
  {
    "text": "you know several thousand lines of code that was you know if we had written it",
    "start": "1874310",
    "end": "1879650"
  },
  {
    "text": "with meta controller to start with it would have been on the order of tens of lines of code",
    "start": "1879650",
    "end": "1886450"
  },
  {
    "text": "if you want to start from scratch yeah go to mannequin trailer for sure you",
    "start": "1889950",
    "end": "1913750"
  },
  {
    "text": "found that there's a lot of code generation yeah yeah yeah yeah so it can",
    "start": "1913750",
    "end": "1920890"
  },
  {
    "text": "be it can be a bit daunting to get into the yeah a lot of the meta controller",
    "start": "1920890",
    "end": "1927790"
  },
  {
    "text": "examples are just sort of you know single JavaScript files and the the logic the sort of the workhorse of it is",
    "start": "1927790",
    "end": "1934929"
  },
  {
    "text": "happening within medic and trailer itself and you're just able to say yeah",
    "start": "1934929",
    "end": "1939940"
  },
  {
    "text": "you know I want to create a deployment and just go ahead and take care of that for me Matt a controller it's and that",
    "start": "1939940",
    "end": "1947169"
  },
  {
    "text": "begins to feel more like you know templating versus writing code cool okay",
    "start": "1947169",
    "end": "1954490"
  },
  {
    "text": "I think we're out of time so any more questions let's take them offline here",
    "start": "1954490",
    "end": "1959760"
  },
  {
    "text": "all right thanks everyone [Applause]",
    "start": "1959760",
    "end": "1966079"
  }
]