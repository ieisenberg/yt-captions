[
  {
    "text": "thanks everyone um it's actually hundreds of clusters sitting in a tree with a r g o c d you",
    "start": "0",
    "end": "6600"
  },
  {
    "text": "know just like the the poem goes um just real quick who am I uh I'm Mike",
    "start": "6600",
    "end": "12360"
  },
  {
    "text": "tujron I'm a lead Cloud engineer at Adobe I'm on the their or ethos platform",
    "start": "12360",
    "end": "17880"
  },
  {
    "text": "that's adobe's uh kind of bespoke bespoke uh kubernetes install it's very",
    "start": "17880",
    "end": "24060"
  },
  {
    "text": "similar to a cube ADM install just with adobe's business Logic on top we're a",
    "start": "24060",
    "end": "30480"
  },
  {
    "text": "fairly good size installation it's around 230 clusters 22 different regions",
    "start": "30480",
    "end": "35640"
  },
  {
    "text": "AWS Azure private data center 18 000 compute nodes one of the interesting",
    "start": "35640",
    "end": "42719"
  },
  {
    "text": "stats I came across was it was 1.8 petabytes of memory that kind of caught me off guards that was kind of a cool",
    "start": "42719",
    "end": "49440"
  },
  {
    "text": "stats but you can read the rest on there I don't need to repeat it all so that was kind of cool",
    "start": "49440",
    "end": "56280"
  },
  {
    "text": "so I thought it'd be good to start off with some of the problems we're facing um traditional Dev clusters can be",
    "start": "56280",
    "end": "63000"
  },
  {
    "text": "expensive and if you deal in the cloud cost controls are difficult to manage I",
    "start": "63000",
    "end": "68400"
  },
  {
    "text": "don't know if you've ever tried to set up quotas in AWS but they're very easy for people to just expand",
    "start": "68400",
    "end": "74119"
  },
  {
    "text": "sometimes they're Auto expanded and sometimes when you pass a quota they",
    "start": "74119",
    "end": "79320"
  },
  {
    "text": "just let you go past them or they go ahead and bill you for them and retroactively say Hey you pass up your",
    "start": "79320",
    "end": "84960"
  },
  {
    "text": "quota so it gets very expensive very quick and sometimes they're kind of worthless",
    "start": "84960",
    "end": "90479"
  },
  {
    "text": "other times with testing environments you need them in an isolated environment",
    "start": "90479",
    "end": "95720"
  },
  {
    "text": "testing custom operators that's very difficult we're in a multi-tenant environment so we have multiple tenants",
    "start": "95720",
    "end": "101880"
  },
  {
    "text": "on the same clusters we have some dedicated clusters but most of our environment is multi-tenant so if you're",
    "start": "101880",
    "end": "107880"
  },
  {
    "text": "working on a custom operator like let's say Prometheus in that sort of situation",
    "start": "107880",
    "end": "113159"
  },
  {
    "text": "if you're updating the crd and let's say for some reason it's not backwards compatible what's going to happen is you",
    "start": "113159",
    "end": "118799"
  },
  {
    "text": "could break other developers on the same cluster so those changes need to be isolated clean environments for integration",
    "start": "118799",
    "end": "125100"
  },
  {
    "text": "testing can be very difficult to do in a micro service environment perhaps you need to spin up services are in multiple",
    "start": "125100",
    "end": "132239"
  },
  {
    "text": "name spaces test it all together in one thing it's very difficult to do if you just have access to a single namespace",
    "start": "132239",
    "end": "138720"
  },
  {
    "text": "inside of a cluster so and like I said multi-tenancy makes that a whole heck of a lot different so",
    "start": "138720",
    "end": "145319"
  },
  {
    "text": "these are kind of some of the problems that we're facing and why we're starting to look at this whole idea of multiple",
    "start": "145319",
    "end": "151860"
  },
  {
    "text": "clusters per pull request so that kind of testing can be done so there's a few tools that we're going",
    "start": "151860",
    "end": "158280"
  },
  {
    "text": "to discuss today that helps us address these problems and we're going to go through those three tools now",
    "start": "158280",
    "end": "165540"
  },
  {
    "text": "so the first is a tool called v-cluster this allows you to build virtual clusters inside of a single namespace",
    "start": "165540",
    "end": "172140"
  },
  {
    "text": "these virtual clusters are pretty cool they give you full API access with inside the confines and the Scopes of",
    "start": "172140",
    "end": "178500"
  },
  {
    "text": "that virtual cluster so I don't know if any of you have looked at these virtual clusters before",
    "start": "178500",
    "end": "183959"
  },
  {
    "text": "but you can create namespaces you can give our back controls however you want",
    "start": "183959",
    "end": "189319"
  },
  {
    "text": "you can basically do whatever you want with inside that confines as it creates",
    "start": "189319",
    "end": "196019"
  },
  {
    "text": "pods those pods though are still synced to the host cluster so that they run on the nodes inside of the host cluster",
    "start": "196019",
    "end": "202379"
  },
  {
    "text": "that means security controls like Network policies admission web hooks Opa",
    "start": "202379",
    "end": "207480"
  },
  {
    "text": "that kind of stuff are still applied if you try to create a pod with a host map",
    "start": "207480",
    "end": "212580"
  },
  {
    "text": "or elevated permissions those can still be blocked so that makes it so that some",
    "start": "212580",
    "end": "217980"
  },
  {
    "text": "developer Junior developer who you don't want admitting your host cluster can still admin that virtual cluster but",
    "start": "217980",
    "end": "225720"
  },
  {
    "text": "still have the restricted access on that development cluster where we were talking about cost before",
    "start": "225720",
    "end": "231019"
  },
  {
    "text": "quarters can be applied on the host cluster that apply into this virtual cluster so as the virtual clusters are",
    "start": "231019",
    "end": "237360"
  },
  {
    "text": "created they're still pods on the host cluster so quotas can be applied how",
    "start": "237360",
    "end": "243120"
  },
  {
    "text": "many pods are you creating how many virtual clusters are you creating these pods get applied to the quotas of the",
    "start": "243120",
    "end": "249360"
  },
  {
    "text": "host namespace so your cost controls can be kept under control but developers can still create as many",
    "start": "249360",
    "end": "255239"
  },
  {
    "text": "of them as they want with inside those cost controls that you set there also",
    "start": "255239",
    "end": "260459"
  },
  {
    "text": "because they're just pods they're cheaper to run than the full VM infrastructure if your API server only",
    "start": "260459",
    "end": "266820"
  },
  {
    "text": "needs two gigs of memory one CPU that's a heck of a lot cheaper than launching",
    "start": "266820",
    "end": "272880"
  },
  {
    "text": "up a full VM a VPC a load balancer all that infrastructure that you may need",
    "start": "272880",
    "end": "277919"
  },
  {
    "text": "inside of some sort of cloud provider it also makes it a lot easier and faster to provision this resource than having to",
    "start": "277919",
    "end": "284580"
  },
  {
    "text": "wait for those Cloud providers to come up you get it inside of a minute or two instead of inside 10 or 15 minutes I",
    "start": "284580",
    "end": "291600"
  },
  {
    "text": "don't know who likes to wait 10 or 15 minutes for their PR to start their CI testing I know I don't",
    "start": "291600",
    "end": "300740"
  },
  {
    "text": "the other tool that leverages this is the cluster API by the kubernetes Sig",
    "start": "301860",
    "end": "307259"
  },
  {
    "text": "cluster lifecycle group this is one you probably haven't heard of but it is up and coming there's been a lot of work on",
    "start": "307259",
    "end": "314160"
  },
  {
    "text": "it you're going to hear a lot more about it this week at kubecon but it allows you to do declarative API",
    "start": "314160",
    "end": "319320"
  },
  {
    "text": "provisioning and managing of kubernetes clusters it's essentially a crd operator",
    "start": "319320",
    "end": "324720"
  },
  {
    "text": "you define your cluster definitions via yaml manifest The Operators inside of",
    "start": "324720",
    "end": "330479"
  },
  {
    "text": "the management cluster takes that yaml it's a series of operators it builds",
    "start": "330479",
    "end": "335699"
  },
  {
    "text": "your kubernetes clusters builds your surrounding infrastructure based upon that like we were talking about earlier",
    "start": "335699",
    "end": "341820"
  },
  {
    "text": "with cross-plane during the Keynotes you know all that surrounding stuff is built in a git Ops style fashion works with",
    "start": "341820",
    "end": "349560"
  },
  {
    "text": "multiple Cloud providers which is really nice and most importantly it's extensible via custom providers so it's",
    "start": "349560",
    "end": "355800"
  },
  {
    "text": "not just built for what the cluster API working group says if some third party wants to create providers for it if you",
    "start": "355800",
    "end": "362280"
  },
  {
    "text": "want to create your own you can and most importantly as it relates to what we're talking about today there's a v-cluster",
    "start": "362280",
    "end": "369180"
  },
  {
    "text": "provider that's going to really relate you're going to see here in a little bit how this helps us create a cluster per",
    "start": "369180",
    "end": "374520"
  },
  {
    "text": "PR so that's really cool but basically the tldr this is a really",
    "start": "374520",
    "end": "380580"
  },
  {
    "text": "cool tool I started using it I don't know three four months ago and I",
    "start": "380580",
    "end": "386940"
  },
  {
    "text": "just found a lot of really useful things with it I've become really involved in this community and I cannot recommend it highly enough uh both from from a git",
    "start": "386940",
    "end": "394319"
  },
  {
    "text": "Ops perspective and from a core infrastructure perspective so really highly recommend checking it out",
    "start": "394319",
    "end": "400620"
  },
  {
    "text": "and lastly the glue is Argo CD you've probably heard of this tool along with",
    "start": "400620",
    "end": "405660"
  },
  {
    "text": "the other ones that are very similar I'm not going to dive too much into it but the key callouts are the pre and",
    "start": "405660",
    "end": "412740"
  },
  {
    "text": "post sink hooks those are really powerful features um I've noticed some people who are not",
    "start": "412740",
    "end": "419280"
  },
  {
    "text": "used to git Ops may not be aware of those sort of things it's got that powerful ecosystem around",
    "start": "419280",
    "end": "425520"
  },
  {
    "text": "it we're going to be using some workflows and events with this demo that's going to be coming up here in a few minutes",
    "start": "425520",
    "end": "431720"
  },
  {
    "text": "the application sets are really powerful especially the pr generator that's",
    "start": "431720",
    "end": "437699"
  },
  {
    "text": "possible with it that allows us to create applications per PR that's generated inside of a GitHub or any sort",
    "start": "437699",
    "end": "444780"
  },
  {
    "text": "of git or SCM repo there's also Other Ones based upon cluster lists that are",
    "start": "444780",
    "end": "450060"
  },
  {
    "text": "generated already inside of your Argo servers and there's a bunch of other",
    "start": "450060",
    "end": "455340"
  },
  {
    "text": "generators that are there as well so this is going to glue everything we're doing together",
    "start": "455340",
    "end": "463139"
  },
  {
    "text": "so why would I want a cluster per PR well we've already talked about a lot of",
    "start": "463139",
    "end": "468180"
  },
  {
    "text": "these things but I kind of wanted to highlight them specifically as these are",
    "start": "468180",
    "end": "474539"
  },
  {
    "text": "the answers to some of the problems that we were talking about earlier I'm not going to Deep dive into them because",
    "start": "474539",
    "end": "480060"
  },
  {
    "text": "like I said we talked about them but those pieces that that solve of",
    "start": "480060",
    "end": "485539"
  },
  {
    "text": "microservice developers needing to have multiple namespaces deployed for those applications that can be solved by this",
    "start": "485539",
    "end": "492419"
  },
  {
    "text": "cluster because they have cluster admin access that crd if they're a cluster admin on a",
    "start": "492419",
    "end": "498240"
  },
  {
    "text": "cluster they can install that and not impact other developers one of the really cool things that I didn't mention",
    "start": "498240",
    "end": "504240"
  },
  {
    "text": "earlier is kubernetes upgrades let's say you're up you're currently running kubernetes 124 there's a deprecation",
    "start": "504240",
    "end": "511259"
  },
  {
    "text": "that happens in kubernetes 125. you want to test that your code works with kubernetes 125 launch a virtual cluster",
    "start": "511259",
    "end": "518640"
  },
  {
    "text": "as part of your PR that's running kubernetes 125 test your application",
    "start": "518640",
    "end": "523680"
  },
  {
    "text": "code against that you can do that you can't Test new features that the older version doesn't support but you can test",
    "start": "523680",
    "end": "530339"
  },
  {
    "text": "your deprecations to make sure that your application code will work with that new version that's really cool",
    "start": "530339",
    "end": "537420"
  },
  {
    "text": "um excuse me uh we have some applications that hammer the heck out of the API tens of thousands of Secrets",
    "start": "537420",
    "end": "544920"
  },
  {
    "text": "tens of thousands of config Maps watches those and can frequently bring down the",
    "start": "544920",
    "end": "550200"
  },
  {
    "text": "API server or FCD in the dev environments especially as multiple developers run those applications in the",
    "start": "550200",
    "end": "556740"
  },
  {
    "text": "same Dev cluster it also allows us to isolate and create basically a Federation of API servers so as each PR",
    "start": "556740",
    "end": "565440"
  },
  {
    "text": "can come in they'll have their own API server and FCD server that they run their code against so if they have a bug",
    "start": "565440",
    "end": "571800"
  },
  {
    "text": "in the application they would bring down just themselves not the entire set of",
    "start": "571800",
    "end": "576959"
  },
  {
    "text": "potentially hundreds or thousands of developers at the size of adobe so some really powerful reasons why we",
    "start": "576959",
    "end": "584519"
  },
  {
    "text": "would want to Cluster per PR so what we're talking about here is a flow",
    "start": "584519",
    "end": "590160"
  },
  {
    "text": "that looks something like this a PR is generated and at that point rocd detects it it",
    "start": "590160",
    "end": "596640"
  },
  {
    "text": "then creates an app because we're running the application set with the pr generator it launches a Helm chart that",
    "start": "596640",
    "end": "603720"
  },
  {
    "text": "builds a cluster because that Helm chart is using the cluster API to build",
    "start": "603720",
    "end": "609120"
  },
  {
    "text": "kubernetes clusters so that gets applied to kubernetes it builds it it then uses",
    "start": "609120",
    "end": "615060"
  },
  {
    "text": "Argo events to trigger a workflow that workflow again inside of Argo takes it",
    "start": "615060",
    "end": "621240"
  },
  {
    "text": "runs registers that cluster when it's ready back into Argo CD as a cluster",
    "start": "621240",
    "end": "628080"
  },
  {
    "text": "and at that point since it's now registered as a cluster inside of Argo CD it can sync any new Helm charts",
    "start": "628080",
    "end": "634920"
  },
  {
    "text": "customize whatever you happen to be using onto this new virtual cluster that had been created and now you have this",
    "start": "634920",
    "end": "641640"
  },
  {
    "text": "new environment that has either application code or is bootstrapped with whatever operators you want to have on",
    "start": "641640",
    "end": "648180"
  },
  {
    "text": "there let's see what this actually looks like you know that's and more interesting",
    "start": "648180",
    "end": "655260"
  },
  {
    "text": "stuff than me talking so",
    "start": "655260",
    "end": "661620"
  },
  {
    "text": "come on what I have here is this hundreds of clusters demo",
    "start": "661620",
    "end": "667459"
  },
  {
    "text": "so I have this repo and let's create a branch",
    "start": "668100",
    "end": "673320"
  },
  {
    "text": "minor edit of readme",
    "start": "673320",
    "end": "677720"
  },
  {
    "text": "okay I tried that earlier I guess I didn't do it enough is it not going any bigger",
    "start": "680100",
    "end": "686040"
  },
  {
    "text": "okay I'm in a Vim readme.md",
    "start": "686040",
    "end": "693440"
  },
  {
    "text": "and you know I'm going to be one of those people I want this in caps because",
    "start": "693440",
    "end": "699300"
  },
  {
    "text": "warnings you know people don't read it unless it's encapsed right you know that's how it works",
    "start": "699300",
    "end": "704880"
  },
  {
    "text": "so yeah commit am",
    "start": "704880",
    "end": "710279"
  },
  {
    "text": "put warning in caps before I push this I want to show you",
    "start": "710399",
    "end": "715620"
  },
  {
    "text": "what it looks what's currently running in Argo so right now the only thing I have up",
    "start": "715620",
    "end": "721980"
  },
  {
    "text": "here is this cluster workflows application we're gonna don't worry about what's in there right now we're",
    "start": "721980",
    "end": "727260"
  },
  {
    "text": "going to talk about what's in that in just a moment but this is where the meat or the logic is happening we're going to",
    "start": "727260",
    "end": "733920"
  },
  {
    "text": "dive through each part that's in there ignore it for the moment so I'm going to get",
    "start": "733920",
    "end": "740339"
  },
  {
    "text": "push I can type I really can type just because you're",
    "start": "740339",
    "end": "745680"
  },
  {
    "text": "all watching me minor edit oh come on I'll complete read me",
    "start": "745680",
    "end": "755300"
  },
  {
    "text": "all right",
    "start": "756480",
    "end": "759380"
  },
  {
    "text": "so now that I've created this pull request what we're going to see here within 30 seconds there we go pulls up",
    "start": "765180",
    "end": "770579"
  },
  {
    "text": "and we now have a new application being synced but you see here it's syncing a v",
    "start": "770579",
    "end": "775980"
  },
  {
    "text": "cluster and the cluster from the cluster API now in a real world situation you're",
    "start": "775980",
    "end": "781980"
  },
  {
    "text": "going to use a web Hook from git to trigger that sync it'll do its polling I'm only doing polling because you'll",
    "start": "781980",
    "end": "788279"
  },
  {
    "text": "see that it's running on localhost so let's get",
    "start": "788279",
    "end": "794459"
  },
  {
    "text": "pods dash n Argo pipe grep ah go away",
    "start": "794459",
    "end": "801120"
  },
  {
    "text": "add and let's find our workflow that's",
    "start": "801120",
    "end": "806519"
  },
  {
    "text": "running and the one that is running is this one right here",
    "start": "806519",
    "end": "812700"
  },
  {
    "text": "so we're going to say Cube CTL logs of that and Argo c main",
    "start": "812700",
    "end": "821660"
  },
  {
    "text": "whoops forgot the dash f and what this is doing is it's now",
    "start": "822300",
    "end": "829320"
  },
  {
    "text": "watching looking for that cluster to be provisioned uh this is actually taking a little bit longer than a v-cluster would",
    "start": "829320",
    "end": "836040"
  },
  {
    "text": "normally take to provision because it's provisioning a cluster or a cloud load balancer if you are using say a b",
    "start": "836040",
    "end": "842399"
  },
  {
    "text": "cluster just to do a v-cluster create it just takes a few seconds for the time a",
    "start": "842399",
    "end": "847620"
  },
  {
    "text": "pod comes up if you're waiting for cloud resources like a load balancer it can take a few seconds more because you're",
    "start": "847620",
    "end": "852720"
  },
  {
    "text": "waiting on cloud resources Cloud resources 45 to 90 seconds V",
    "start": "852720",
    "end": "858060"
  },
  {
    "text": "clusters 30 seconds and",
    "start": "858060",
    "end": "863279"
  },
  {
    "text": "we wait a moment",
    "start": "863279",
    "end": "866420"
  },
  {
    "text": "come on demo gods",
    "start": "868560",
    "end": "872120"
  },
  {
    "text": "demo gods fingers crossed",
    "start": "879420",
    "end": "884060"
  },
  {
    "text": "um I did a cloud load balancer uh because it was faster and easier for the demo [Laughter]",
    "start": "889380",
    "end": "897180"
  },
  {
    "text": "it it's just being here not on my corporate network connectivity local laptop",
    "start": "897180",
    "end": "902519"
  },
  {
    "text": "that kind of thing the question was why did I use a cloud load balancer instead of just using the local connection I",
    "start": "902519",
    "end": "909839"
  },
  {
    "text": "didn't want to put that complexity so there you go it got to provision State created the Argo ad",
    "start": "909839",
    "end": "917459"
  },
  {
    "text": "we checked back over to Argo itself and we can see now there's the pr",
    "start": "917459",
    "end": "923160"
  },
  {
    "text": "and we can see that all of a sudden now or here's the cluster that it built and we can see here there's also two more",
    "start": "923160",
    "end": "929399"
  },
  {
    "text": "tiles it's synced in um a Prometheus stack",
    "start": "929399",
    "end": "934740"
  },
  {
    "text": "so that's in there now it's synced into an Argo rollout stack so that's in there now and also we have",
    "start": "934740",
    "end": "941699"
  },
  {
    "text": "this kind of environment that's been bootstrapped for this cluster so if we say Cube CTL get cluster and I",
    "start": "941699",
    "end": "951060"
  },
  {
    "text": "put this in a v-cluster environment we can see that we have a cluster named demo pr11 that's been",
    "start": "951060",
    "end": "958019"
  },
  {
    "text": "provisioned so I can say cluster CTL get cubeconfig",
    "start": "958019",
    "end": "965100"
  },
  {
    "text": "that redirect to yaml",
    "start": "965100",
    "end": "970519"
  },
  {
    "text": "and I can say export Cube config equals Dot yaml",
    "start": "972420",
    "end": "979139"
  },
  {
    "text": "Cube CTL get pods Dash a",
    "start": "979139",
    "end": "983660"
  },
  {
    "text": "okay and here's all the pods that are running inside of that virtual cluster so it's",
    "start": "988320",
    "end": "993660"
  },
  {
    "text": "kind of been bootstrapped I didn't have actual application code that's running but you can kind of get the concept that",
    "start": "993660",
    "end": "999300"
  },
  {
    "text": "PR has application code it does the same sort of thing applies it moves on does",
    "start": "999300",
    "end": "1004459"
  },
  {
    "text": "its thing and but the cluster has been bootstrapped with those generic resources as well that that application",
    "start": "1004459",
    "end": "1010459"
  },
  {
    "text": "may need to use so because every application is going to need some sort of crd it's going to need",
    "start": "1010459",
    "end": "1015620"
  },
  {
    "text": "monitoring that it's not manipulating itself",
    "start": "1015620",
    "end": "1020319"
  },
  {
    "text": "so let's go back to this",
    "start": "1021139",
    "end": "1026678"
  },
  {
    "text": "and shoot I lost my timer so where am I on time okay so",
    "start": "1027140",
    "end": "1032240"
  },
  {
    "text": "everybody's got pencil and paper right you can write down all of this works I hope",
    "start": "1032240",
    "end": "1038480"
  },
  {
    "text": "I have a friend who does it that way that's how I know he's paying attention uh but don't worry all this code is on",
    "start": "1038480",
    "end": "1044959"
  },
  {
    "text": "that repo so if you want to see how this works this is the screen to take a screenshot of or a picture of",
    "start": "1044959",
    "end": "1050540"
  },
  {
    "text": "so I'll give you a few seconds to do that it's at the end as well but the repo has building a cluster to",
    "start": "1050540",
    "end": "1057740"
  },
  {
    "text": "do it using cluster API it has building virtual clusters with it the pr generator the whole shebang",
    "start": "1057740",
    "end": "1064400"
  },
  {
    "text": "so this is the one you're going to want a picture of if you get a picture of anything this talk",
    "start": "1064400",
    "end": "1070360"
  },
  {
    "text": "cameras down so uh the pr generator application set I",
    "start": "1070700",
    "end": "1079220"
  },
  {
    "text": "don't know who's seen this or not but the top bit of code here that you see I don't you see my mouse around the pull",
    "start": "1079220",
    "end": "1086120"
  },
  {
    "text": "request area okay good uh what that's telling you there is go to GitHub look to this repo for every",
    "start": "1086120",
    "end": "1093500"
  },
  {
    "text": "pull request that's there generate an application tile name it with this name",
    "start": "1093500",
    "end": "1100280"
  },
  {
    "text": "then look to this location here for a Helm chart or for whatever it is in this case it happens to be a Helm chart could",
    "start": "1100280",
    "end": "1106520"
  },
  {
    "text": "be customized whatever you want with v cluster ignore this control plane endpoint we",
    "start": "1106520",
    "end": "1114260"
  },
  {
    "text": "don't want Argo to constantly be syncing it because cluster API will automatically populate that control",
    "start": "1114260",
    "end": "1120620"
  },
  {
    "text": "plane endpoint as the Clusters created so not much to this one but it's",
    "start": "1120620",
    "end": "1126799"
  },
  {
    "text": "important to point that out how the pr application set works",
    "start": "1126799",
    "end": "1131919"
  },
  {
    "text": "we then have the cluster API spec for creating a v cluster there's a lot more",
    "start": "1132140",
    "end": "1137179"
  },
  {
    "text": "to this that we can set but this is the key parts to it this control plane",
    "start": "1137179",
    "end": "1142460"
  },
  {
    "text": "endpoint is dynamically populated if not set but this is where you control",
    "start": "1142460",
    "end": "1148760"
  },
  {
    "text": "um services like I have set in here that I'm using a load balancer if you don't specify load balancer you use a local",
    "start": "1148760",
    "end": "1155919"
  },
  {
    "text": "you can use port forwarding to get to it or a local Ingress to get to it or",
    "start": "1155919",
    "end": "1161419"
  },
  {
    "text": "there's a couple different options of how you can connect into this cluster security is important I like calling",
    "start": "1161419",
    "end": "1167000"
  },
  {
    "text": "this out on slides even though it's not there he said in you know who can",
    "start": "1167000",
    "end": "1172820"
  },
  {
    "text": "connect into this cluster people scan ports everywhere you don't want people connecting into this virtual cluster",
    "start": "1172820",
    "end": "1178100"
  },
  {
    "text": "having admin access running bit currency on your clusters please don't do that",
    "start": "1178100",
    "end": "1184820"
  },
  {
    "text": "um you can Define what kubernetes version you want to run and there's a whole bunch of other Helm values you can",
    "start": "1184820",
    "end": "1190580"
  },
  {
    "text": "run on there basically a v cluster applies a Helm chart as part of its bootstrapping",
    "start": "1190580",
    "end": "1197360"
  },
  {
    "text": "and so that's where all those values come from uh you can see the API version up here",
    "start": "1197360",
    "end": "1204200"
  },
  {
    "text": "is a that's the one for a cluster API",
    "start": "1204200",
    "end": "1209260"
  },
  {
    "text": "so did actually get this into Argo CD we saw it happen but what's kind of the",
    "start": "1210260",
    "end": "1216799"
  },
  {
    "text": "more depth on that flow so what happens is you have the Argo Event Source what that does is that",
    "start": "1216799",
    "end": "1223580"
  },
  {
    "text": "watches for cluster API resource to be added the Argo sensor watches for that picks",
    "start": "1223580",
    "end": "1230660"
  },
  {
    "text": "up that event and then triggers an Argo workflow that Argo workflow sits there it pulls",
    "start": "1230660",
    "end": "1236660"
  },
  {
    "text": "for that v-cluster to be fully created to that provision state that we saw once that's there it gets the cube",
    "start": "1236660",
    "end": "1243380"
  },
  {
    "text": "config once it has the cube config it's able to then connect to that cluster and",
    "start": "1243380",
    "end": "1249559"
  },
  {
    "text": "then it's able to connect to that cluster and to the Argo CD cluster or sorry the Argo CD server",
    "start": "1249559",
    "end": "1256520"
  },
  {
    "text": "add the cluster to that rocd it's then able to sync those resources like we saw",
    "start": "1256520",
    "end": "1262160"
  },
  {
    "text": "and now that cluster has been bootstrapped when you close the pr the reverse happens so let's take a look at",
    "start": "1262160",
    "end": "1269600"
  },
  {
    "text": "that real quick we go back to that PR and let's merge it",
    "start": "1269600",
    "end": "1276880"
  },
  {
    "text": "what we're going to see happen here first within a few seconds is that tile went away",
    "start": "1279140",
    "end": "1284480"
  },
  {
    "text": "so there and then also boom everything else went away and that's because an",
    "start": "1284480",
    "end": "1289640"
  },
  {
    "text": "Argo workflow triggered again that went through and cleared you cannot see that that's because",
    "start": "1289640",
    "end": "1296980"
  },
  {
    "text": "PowerPoint doesn't switch the stuff while it's running well you'll see the end result that",
    "start": "1296980",
    "end": "1305059"
  },
  {
    "text": "there's nothing there yay [Laughter]",
    "start": "1305059",
    "end": "1311780"
  },
  {
    "text": "I forgot that little trick with PowerPoint uh apologies uh but basically what happens is again",
    "start": "1313159",
    "end": "1320299"
  },
  {
    "text": "an Argo event happens triggers a workflow the workflow does in the reverse it gets uh connects to Argo CD",
    "start": "1320299",
    "end": "1328280"
  },
  {
    "text": "runs Argo CD delete and at that point the cluster is removed it does you know",
    "start": "1328280",
    "end": "1335240"
  },
  {
    "text": "try to remove the the permissions from that V cluster but the V cluster has",
    "start": "1335240",
    "end": "1341000"
  },
  {
    "text": "already gone away so at that point you know it's just basically an or true so that it doesn't",
    "start": "1341000",
    "end": "1346700"
  },
  {
    "text": "actually fail that command the workflow completes successfully so",
    "start": "1346700",
    "end": "1353980"
  },
  {
    "text": "so coming back to this how are we doing on time 10 35 okay",
    "start": "1355100",
    "end": "1360679"
  },
  {
    "text": "so does anybody have a time check because I've lost it because of the PowerPoint switch",
    "start": "1360679",
    "end": "1366200"
  },
  {
    "text": "10.58 all right so we talked about the Event Source here's what it looks like here",
    "start": "1366200",
    "end": "1373760"
  },
  {
    "text": "um the ad on the right you can see the resources it looks for the Clusters the",
    "start": "1373760",
    "end": "1380840"
  },
  {
    "text": "ad names the event bus that it's going to be going through so when the ads happen for the cluster",
    "start": "1380840",
    "end": "1386900"
  },
  {
    "text": "API we get that event happening this is really hard to see because",
    "start": "1386900",
    "end": "1392000"
  },
  {
    "text": "there's a lot there so I highly recommend checking this out in the actual code on the site but essentially",
    "start": "1392000",
    "end": "1398900"
  },
  {
    "text": "what happens is you can kind of see it over here uh but what happens is is when",
    "start": "1398900",
    "end": "1404539"
  },
  {
    "text": "that event gets triggered it creates a workflow and I really don't know how well you can see that because I",
    "start": "1404539",
    "end": "1410960"
  },
  {
    "text": "can't see it from here it comes over to a workflow takes a",
    "start": "1410960",
    "end": "1416059"
  },
  {
    "text": "parameter called cluster runs a script and that script's mounted from a config",
    "start": "1416059",
    "end": "1421880"
  },
  {
    "text": "map I see squiggly eyes so I'm assuming you can't really see it",
    "start": "1421880",
    "end": "1428000"
  },
  {
    "text": "um you can see pretty well okay",
    "start": "1428000",
    "end": "1432580"
  },
  {
    "text": "yeah so what it does is it passes in the parameter coming from the resource that",
    "start": "1433360",
    "end": "1438559"
  },
  {
    "text": "was found to be created in kubernetes passes grabs the name of that resource",
    "start": "1438559",
    "end": "1444380"
  },
  {
    "text": "passes it in as the first parameter to that script so the script can take in",
    "start": "1444380",
    "end": "1449900"
  },
  {
    "text": "the cluster name that was created so it knows what to act upon and at that point",
    "start": "1449900",
    "end": "1455659"
  },
  {
    "text": "it's just running a workflow so whatever you want to do in that workflow inside your container inside your script that",
    "start": "1455659",
    "end": "1462559"
  },
  {
    "text": "the container runs however you want that workflow to execute in this case it's a very simple script all right simple",
    "start": "1462559",
    "end": "1470059"
  },
  {
    "text": "script so I don't do much this container image here there's no magic in it all",
    "start": "1470059",
    "end": "1475400"
  },
  {
    "text": "that is is it has Cube CTL cluster CTL and the Argo CLI so nothing special",
    "start": "1475400",
    "end": "1482240"
  },
  {
    "text": "inside of that the script itself as we mentioned is simple from the perspective of it",
    "start": "1482240",
    "end": "1490460"
  },
  {
    "text": "doesn't do very much does an Argo CD login it look Loops looks for the",
    "start": "1490460",
    "end": "1496280"
  },
  {
    "text": "cluster being to a provisioned state right here once it has it cluster CTL get the cube",
    "start": "1496280",
    "end": "1502039"
  },
  {
    "text": "config set up the cube config set the right context Argo CD cluster ad",
    "start": "1502039",
    "end": "1509419"
  },
  {
    "text": "Boom the magic happens and that's how it gets in there bootstraps a cluster applies things into it and all of a",
    "start": "1509419",
    "end": "1516440"
  },
  {
    "text": "sudden now every PR has a dynamic full-featured API server",
    "start": "1516440",
    "end": "1522380"
  },
  {
    "text": "to go along with that PR and developers can do whatever they want against it and",
    "start": "1522380",
    "end": "1528260"
  },
  {
    "text": "has that full power of a kubernetes cluster without having to go through an Ops",
    "start": "1528260",
    "end": "1533360"
  },
  {
    "text": "person devops person have to deal with some other team to update a feature you know and feature",
    "start": "1533360",
    "end": "1540260"
  },
  {
    "text": "development becomes really easy in an isolated environment so thank you very much for your time",
    "start": "1540260",
    "end": "1548320"
  },
  {
    "text": "all the code everything found at that repo if you didn't get a picture",
    "start": "1548320",
    "end": "1553340"
  },
  {
    "text": "earlier now's your opportunity here's the links of the tools that we used there's all my contact information",
    "start": "1553340",
    "end": "1561279"
  },
  {
    "text": "if you don't have questions now some come up later as you look at the code don't hesitate to reach out I will be",
    "start": "1561279",
    "end": "1567440"
  },
  {
    "text": "taking questions in a moment some other talks that we have are up there",
    "start": "1567440",
    "end": "1573100"
  },
  {
    "text": "Friday Dan from code fresh and another colleague of mine Joseph Sandoval will",
    "start": "1573100",
    "end": "1578480"
  },
  {
    "text": "be diving into some performance testing and some scaling stuff that we're doing",
    "start": "1578480",
    "end": "1583940"
  },
  {
    "text": "as we move along this journey with stuff you want to learn a little bit more",
    "start": "1583940",
    "end": "1589039"
  },
  {
    "text": "about the pr generator and doing more about application environments per PR",
    "start": "1589039",
    "end": "1595700"
  },
  {
    "text": "Brandon from code fresh will be doing a talk later this afternoon as well so there's a lot more that can be done with",
    "start": "1595700",
    "end": "1601760"
  },
  {
    "text": "this sort of process the sort of philosophy of doing things on a per PR basis any questions I saw lots of hands",
    "start": "1601760",
    "end": "1610159"
  },
  {
    "text": "I saw yours first",
    "start": "1610159",
    "end": "1613240"
  },
  {
    "text": "so the question is is when using a virtual cluster do you use Daemon sets or do you Scope that down like you would",
    "start": "1621559",
    "end": "1627020"
  },
  {
    "text": "in the host cluster um that's really up to you the way V cluster works is that it you can sync in",
    "start": "1627020",
    "end": "1634460"
  },
  {
    "text": "all of the host clusters nodes or you can only or you could sync in just the",
    "start": "1634460",
    "end": "1640279"
  },
  {
    "text": "ones that have pods running on them in our environment because we're multi-tenancy we only sync in the nodes",
    "start": "1640279",
    "end": "1646100"
  },
  {
    "text": "that have pods running on them so once a pod is launched it's assigned to a node at that point it syncs that particular",
    "start": "1646100",
    "end": "1652460"
  },
  {
    "text": "note into the virtual cluster it does it as a fake node so it doesn't pull in all",
    "start": "1652460",
    "end": "1657980"
  },
  {
    "text": "the other running pods so it doesn't break that multi-tenancy boundary",
    "start": "1657980",
    "end": "1663400"
  },
  {
    "text": "um you could theoretically run a Daemon set and it would show up on just those ones instead of everywhere but",
    "start": "1663559",
    "end": "1671299"
  },
  {
    "text": "you know I I haven't had a use case to run a game and set inside of that virtual cluster while kind of like",
    "start": "1671299",
    "end": "1676820"
  },
  {
    "text": "you're describing so yeah can you talk a little bit about the",
    "start": "1676820",
    "end": "1682400"
  },
  {
    "text": "process of coming up with the idea of doing this um the idea and also uh two minutes left",
    "start": "1682400",
    "end": "1688760"
  },
  {
    "text": "okay uh the idea behind this uh came up from we were talking about the femoral",
    "start": "1688760",
    "end": "1694220"
  },
  {
    "text": "clusters developers wanted a fresh environment to test their application code we added previous business unit",
    "start": "1694220",
    "end": "1702200"
  },
  {
    "text": "that I was in before I was on the ethos team spent a lot of time coming up with fresh environments to do testing we did",
    "start": "1702200",
    "end": "1709940"
  },
  {
    "text": "you know hashes on name spaces and that kind of stuff and it was a huge pain in the ass",
    "start": "1709940",
    "end": "1715520"
  },
  {
    "text": "um I uh it just was expensive and a hassle to build up full clusters that do crd testing yeah you could do it with",
    "start": "1715520",
    "end": "1722120"
  },
  {
    "text": "kind locally but a lot of times you need to interact with cloud provider credentials that kind of stuff so",
    "start": "1722120",
    "end": "1727279"
  },
  {
    "text": "there's just a lot of different factors that came into this a lot of it was with the cluster API building real clusters",
    "start": "1727279",
    "end": "1733600"
  },
  {
    "text": "because this process of adding and syncing we're going to be doing this with real clusters on real Cloud",
    "start": "1733600",
    "end": "1740059"
  },
  {
    "text": "infrastructure not just virtual clusters got about a minute less left yeah I",
    "start": "1740059",
    "end": "1745760"
  },
  {
    "text": "think I think we can go one more",
    "start": "1745760",
    "end": "1748900"
  },
  {
    "text": "yeah sir are you testing like only sort of kubernetes operators or that with this",
    "start": "1752779",
    "end": "1758299"
  },
  {
    "text": "or like we have a bunch of micro services and we would like to be able to like deploy",
    "start": "1758299",
    "end": "1764000"
  },
  {
    "text": "some portion of our stack in a virtual cluster for like a PR how do you define like how much of your",
    "start": "1764000",
    "end": "1771380"
  },
  {
    "text": "whole application is getting deployed or which parts of it you need or whatever",
    "start": "1771380",
    "end": "1777020"
  },
  {
    "text": "um that's the part we're still working out that's the approach we're going for um that's what we want to do this whole",
    "start": "1777020",
    "end": "1783200"
  },
  {
    "text": "ephemeral cluster concept is still we have some teams that want to deploy",
    "start": "1783200",
    "end": "1788360"
  },
  {
    "text": "everything some teams that want to deploy just a little some teams are still saying they want no I want to",
    "start": "1788360",
    "end": "1794840"
  },
  {
    "text": "Brand everything new VPC you know new VMS and we're like",
    "start": "1794840",
    "end": "1800000"
  },
  {
    "text": "do you really need all of that um so we haven't quite come to a consensus as to what people really need",
    "start": "1800000",
    "end": "1808039"
  },
  {
    "text": "versus what they're saying they want um but yes I I do want to be able to do",
    "start": "1808039",
    "end": "1813919"
  },
  {
    "text": "what you're describing and how to find that balance I want to leave it up to the Developers for their spec and and",
    "start": "1813919",
    "end": "1820279"
  },
  {
    "text": "want to be able to say okay this project will sync these ones this project inside Argo will sync these ones or give that",
    "start": "1820279",
    "end": "1827419"
  },
  {
    "text": "option within a config inside of their repo to say run this Argo workflow that",
    "start": "1827419",
    "end": "1832760"
  },
  {
    "text": "will register them in this way with you know with these labels and that label will then sync that way",
    "start": "1832760",
    "end": "1839059"
  },
  {
    "text": "so I will be here all day hit me up in the hallway hit me up over lunch hit me up on Twitter my email I am on cncf and",
    "start": "1839059",
    "end": "1846799"
  },
  {
    "text": "kubernetes slack I am open for questions I saw lots of other hands so don't hesitate to hit me up if you have",
    "start": "1846799",
    "end": "1853279"
  },
  {
    "text": "questions thank you [Applause]",
    "start": "1853279",
    "end": "1860819"
  }
]