[
  {
    "text": "welcome everybody to cryo the runtime control room i'm sasha one of the maintainers of cryo",
    "start": "399",
    "end": "6080"
  },
  {
    "text": "and today i have the pleasure to be here with obashi hello everyone my name is rishi munami",
    "start": "6080",
    "end": "11679"
  },
  {
    "text": "i'm a software engineer at red hat working in the container one time space and i'm a maintainer of cryo and i'm here today with peter hey there",
    "start": "11679",
    "end": "19680"
  },
  {
    "text": "my name is peter hunt i'm a software engineer at red hat primarily working on cryo podman and con mon and i'm also here",
    "start": "19680",
    "end": "27519"
  },
  {
    "text": "with renault hi everyone i'm renault patel i'm also a software engineer at red hat",
    "start": "27519",
    "end": "33440"
  },
  {
    "text": "and i'm a crime maintainer welcome everyone so what is cryo cryo is a container",
    "start": "33440",
    "end": "39440"
  },
  {
    "text": "runtime that implements the kubernetes container runtime interface using open container initiative images and runtimes",
    "start": "39440",
    "end": "46480"
  },
  {
    "text": "it means that cryo supports pulling oci compatible images and running them with oci",
    "start": "46480",
    "end": "52239"
  },
  {
    "text": "compatible runtimes such as run c or c run the projects that make up cryo such as",
    "start": "52239",
    "end": "57280"
  },
  {
    "text": "containers image storage podman and run c are continually pushing the envelope",
    "start": "57280",
    "end": "63359"
  },
  {
    "text": "of container technology and linux as they keep integrating new features added to the cone",
    "start": "63359",
    "end": "68640"
  },
  {
    "text": "cryo balances stability for the core cri features that kubernetes needs while adding knobs to improve security",
    "start": "68640",
    "end": "75920"
  },
  {
    "text": "as well as incubate new features this talk is uh about how a cryo admin",
    "start": "75920",
    "end": "81360"
  },
  {
    "text": "sitting in the control room so to speak is able to configure cryo feature to",
    "start": "81360",
    "end": "86560"
  },
  {
    "text": "make your clusters more secure out of the box as well as provide knobs for you to try out new features such as",
    "start": "86560",
    "end": "92240"
  },
  {
    "text": "user name spaces we will cover all the different ways that cryo and the workloads running on",
    "start": "92240",
    "end": "97280"
  },
  {
    "text": "cryo can be configured so without any more delay let's begin",
    "start": "97280",
    "end": "102320"
  },
  {
    "text": "all right i would like to talk to you about the basic configurations of cryo so most people will look at etc cryo",
    "start": "102320",
    "end": "110960"
  },
  {
    "text": "cryo.com which is the main configuration file and it's written in tomlin so every configurable part of cryo can",
    "start": "110960",
    "end": "117680"
  },
  {
    "text": "be set there everything we can adjust also via the command line interface can be done",
    "start": "117680",
    "end": "123119"
  },
  {
    "text": "in this configuration file so for example we can specify the storage driver and the storage route we",
    "start": "123119",
    "end": "129520"
  },
  {
    "text": "can also set which underlying oci run time should be chosen for example we can switch from run c to",
    "start": "129520",
    "end": "136000"
  },
  {
    "text": "c run we can also adapt some security related configurations like",
    "start": "136000",
    "end": "141120"
  },
  {
    "text": "setting the default second profile and the default app armor profile or the default capabilities which should apply",
    "start": "141120",
    "end": "146879"
  },
  {
    "text": "to all workloads and we also have the possibility to have some more debugging",
    "start": "146879",
    "end": "152879"
  },
  {
    "text": "helpers like setting the lock level or the log level filter right now we are working on making those",
    "start": "152879",
    "end": "158959"
  },
  {
    "text": "configurations dynamically reloadable and we are we're introducing a modulo",
    "start": "158959",
    "end": "164800"
  },
  {
    "text": "configuration approach which allows us to separate one the single configuration file into multiple",
    "start": "164800",
    "end": "170480"
  },
  {
    "text": "ones so how does this work so cryo supports dynamic configuration",
    "start": "170480",
    "end": "176800"
  },
  {
    "text": "which works that we just have to send a sick hang up to the server and then the server will reload the options",
    "start": "176800",
    "end": "183680"
  },
  {
    "text": "so this works for features like the default app armor profile or the second profile",
    "start": "183680",
    "end": "189920"
  },
  {
    "text": "and it also works for the lock level and the lock level filter if we configure system d to",
    "start": "189920",
    "end": "195440"
  },
  {
    "text": "automatically send sync hang up on reload then we can just run yeah system",
    "start": "195440",
    "end": "201599"
  },
  {
    "text": "ctl system ctl cryo reload so",
    "start": "201599",
    "end": "208239"
  },
  {
    "text": "for the drop-in configurations and per default we defined a new directory which is an etc",
    "start": "208239",
    "end": "214480"
  },
  {
    "text": "cryo cryo.conf.d and for example if we specify the tunnel table like cryo.runtime",
    "start": "214480",
    "end": "220799"
  },
  {
    "text": "then we can set the log level and overwrite it to debug so those configuration files are",
    "start": "220799",
    "end": "227599"
  },
  {
    "text": "in alphabetically order processed so it makes them easy to use if you prefix them with a",
    "start": "227599",
    "end": "233120"
  },
  {
    "text": "number for example and they also work with the dynamic configuration reload feature",
    "start": "233120",
    "end": "239519"
  },
  {
    "text": "and those drop-in configurations have a higher priority than the etc cryocryo.conf which gives",
    "start": "239519",
    "end": "247040"
  },
  {
    "text": "administrators the possibility to deploy a default configuration and users can",
    "start": "247040",
    "end": "252319"
  },
  {
    "text": "override those configurations by just having their drop-in configurations and now i would like to demo that to you",
    "start": "252319",
    "end": "260160"
  },
  {
    "text": "so what we can see here i will now start cryo with a configuration file in my local",
    "start": "260160",
    "end": "266080"
  },
  {
    "text": "directory and i will unset the configuration directory because i on my local machine",
    "start": "266080",
    "end": "271199"
  },
  {
    "text": "i already have etc cryo cryo.conf.d",
    "start": "271199",
    "end": "276320"
  },
  {
    "text": "available and to not have any effect on my demonstration i will just put it to an empty string so here we are",
    "start": "276320",
    "end": "284479"
  },
  {
    "text": "cryo is loaded and seems to work so we can now run something like cry ctlps and",
    "start": "284479",
    "end": "291280"
  },
  {
    "text": "yeah we get an empty response because nothing is running and cryo per default does not lock that",
    "start": "291280",
    "end": "297520"
  },
  {
    "text": "verbose so the info verbosity uh does not look at all does not look that much at all",
    "start": "297520",
    "end": "303039"
  },
  {
    "text": "um we can see we are probably more or less bound to warnings or info messages which are related to the cni network",
    "start": "303039",
    "end": "309600"
  },
  {
    "text": "so to change that we can go into our cryo configuration",
    "start": "309600",
    "end": "314800"
  },
  {
    "text": "and go to the lock level and set it to debug then we save it and my demo i will now",
    "start": "314800",
    "end": "322000"
  },
  {
    "text": "restart cryo and here we can see that we are now in debugging mode and if we now",
    "start": "322000",
    "end": "328400"
  },
  {
    "text": "run any rpc request then we can see that everyone every request is locked",
    "start": "328400",
    "end": "333600"
  },
  {
    "text": "so and those log files can be pretty huge in the end because",
    "start": "333600",
    "end": "339039"
  },
  {
    "text": "the verbosity is now really really high and to have a better debugging possibility we added something",
    "start": "339039",
    "end": "345120"
  },
  {
    "text": "like a lock level filter so for example we now can go into",
    "start": "345120",
    "end": "352400"
  },
  {
    "text": "our cryo configuration and change the log level this is a regular expression it works",
    "start": "352400",
    "end": "358160"
  },
  {
    "text": "for example we can change it as case insert insensitive regular expression and go",
    "start": "358160",
    "end": "363280"
  },
  {
    "text": "for request and now let's just",
    "start": "363280",
    "end": "370240"
  },
  {
    "text": "we don't have to restart cryo at all we can just [Music] reload cryo we are sending zig hang up",
    "start": "370240",
    "end": "380400"
  },
  {
    "text": "like this cryo also gives us the indicator that we reloaded the configuration so it reloads the",
    "start": "380400",
    "end": "385520"
  },
  {
    "text": "configuration it updates the configuration file and we can also see okay the log filter is now",
    "start": "385520",
    "end": "392080"
  },
  {
    "text": "set to request and if we now run cryctl",
    "start": "392080",
    "end": "398639"
  },
  {
    "text": "then we can see that we only really lock the requests and this way administrators can for",
    "start": "398639",
    "end": "407520"
  },
  {
    "text": "example really good filter on those log messages",
    "start": "407520",
    "end": "412960"
  },
  {
    "text": "what do we what can we do for the drop-in configuration files we can also start cryo by",
    "start": "412960",
    "end": "420080"
  },
  {
    "text": "changing the configuration file directory to my local directory and then cryo.com.d",
    "start": "420080",
    "end": "427759"
  },
  {
    "text": "and if we do that then we can see that in this directory for example is a log file a log modification file which uh",
    "start": "427759",
    "end": "436240"
  },
  {
    "text": "resets the log filter so in the configuration file we change the log level filter to log",
    "start": "436240",
    "end": "442560"
  },
  {
    "text": "only the requests and in this overwrite file we just unzip it again",
    "start": "442560",
    "end": "448319"
  },
  {
    "text": "and if we now run crycto then we can see that we get all data not only the requests we also",
    "start": "448319",
    "end": "454639"
  },
  {
    "text": "get the responses for example here we have the list image response which lists all the images available on my local",
    "start": "454639",
    "end": "460000"
  },
  {
    "text": "machine and that's",
    "start": "460000",
    "end": "465840"
  },
  {
    "text": "it for my little demo and now i would like to hand over back to rashi",
    "start": "465840",
    "end": "473360"
  },
  {
    "text": "so cryo uses the container storage library to manage copy and write file systems",
    "start": "473360",
    "end": "479360"
  },
  {
    "text": "for containers and the containers image library for pulling images from container registries",
    "start": "479360",
    "end": "484960"
  },
  {
    "text": "these libraries are also shared across our other container tools like bond build up and scorpio so having a shared",
    "start": "484960",
    "end": "492240"
  },
  {
    "text": "backend means that we can also share configuration files uh so to give an example let's say i want to block",
    "start": "492240",
    "end": "499280"
  },
  {
    "text": "image pools from a specific registry so instead of having to configure this for each container tool that i use i can",
    "start": "499280",
    "end": "505280"
  },
  {
    "text": "just put it in a shared file that all the container tools can access so we have three shared files like this",
    "start": "505280",
    "end": "511680"
  },
  {
    "text": "the first one is the registries.conf file which is used to configure anything related to your registries",
    "start": "511680",
    "end": "517599"
  },
  {
    "text": "so users can go there to configure the insecure registries block registries their list of unqualified search",
    "start": "517599",
    "end": "523680"
  },
  {
    "text": "registries as well as mirror setup the second file is the policy.json file this file holds",
    "start": "523680",
    "end": "530800"
  },
  {
    "text": "policy requirements for a container image specifically around where you're pulling the image from",
    "start": "530800",
    "end": "537120"
  },
  {
    "text": "so you can have policy requirements for various transports including trusted keys and input signatures the third file is the",
    "start": "537120",
    "end": "544160"
  },
  {
    "text": "storage.com file this is used for configuring options for your container storage so stuff as",
    "start": "544160",
    "end": "549600"
  },
  {
    "text": "stuff like your driver your rundown your graph route etc and now now we'll talk about",
    "start": "549600",
    "end": "555360"
  },
  {
    "text": "container the networking configuration so cryo uses cni for configuring networking for",
    "start": "555360",
    "end": "561360"
  },
  {
    "text": "kubernetes parts cni is widely adopted as a networking solution in kubernetes so cni configuration",
    "start": "561360",
    "end": "568959"
  },
  {
    "text": "mainly consists of two settings one is the part to the directory in which the configuration is stored",
    "start": "568959",
    "end": "575600"
  },
  {
    "text": "and the second is where the plug-in binaries are stored so you can see in the example on the slide we have a network",
    "start": "575600",
    "end": "581600"
  },
  {
    "text": "door and a plug-in doors option for both of these settings in addition we also",
    "start": "581600",
    "end": "587120"
  },
  {
    "text": "support setting a default network if you intend to do so and then cry also",
    "start": "587120",
    "end": "593040"
  },
  {
    "text": "supports bootstrapping networking through daemon sets so you can have a daemon set that copies",
    "start": "593040",
    "end": "598320"
  },
  {
    "text": "over the configuration and the binaries to these directories and cryo will pick up the configuration so any parts that",
    "start": "598320",
    "end": "604079"
  },
  {
    "text": "start up after that configuration will pick up the cns settings",
    "start": "604079",
    "end": "609680"
  },
  {
    "text": "in addition to all of these options that uh you know in the crowd trial also has",
    "start": "609680",
    "end": "616160"
  },
  {
    "text": "the ability to edit the runtime classes and handlers so in kubernetes uh you know differing",
    "start": "616160",
    "end": "623600"
  },
  {
    "text": "workloads have differing needs of performance and security and",
    "start": "623600",
    "end": "629200"
  },
  {
    "text": "their users need a way to toggle between different runtimes so in uh so kubernetes has this uh",
    "start": "629200",
    "end": "636880"
  },
  {
    "text": "has this feature runtime classes which is slated to be ga and 1.20 which asks the cri implementation to use",
    "start": "636880",
    "end": "643680"
  },
  {
    "text": "a different runtime or users can also make it use runtimes differently",
    "start": "643680",
    "end": "649839"
  },
  {
    "text": "admins then have the ability to create runtime classes and optionally add",
    "start": "649839",
    "end": "657440"
  },
  {
    "text": "admission controllers or policies to gate them for different uses this gives a lot of verbosity for the amount of uh ways that",
    "start": "657440",
    "end": "665040"
  },
  {
    "text": "admins can configure the way that their users can use differing",
    "start": "665040",
    "end": "670880"
  },
  {
    "text": "runtimes or differing workloads so in the bottom left here you can see that this is a basic runtime",
    "start": "670880",
    "end": "677920"
  },
  {
    "text": "class example and the",
    "start": "677920",
    "end": "683120"
  },
  {
    "text": "runtime class name is correspond with one of the runtimes in the run times table",
    "start": "683120",
    "end": "688399"
  },
  {
    "text": "so perhaps the runtime class name would be run c high performance and then a pod would uh",
    "start": "688399",
    "end": "695920"
  },
  {
    "text": "and then so and we'll go into a little bit more in detail on the right we have an example of a",
    "start": "695920",
    "end": "700959"
  },
  {
    "text": "couple of different ways that you can configure cryo to have different runtimes and we'll go into a bit more in detail",
    "start": "700959",
    "end": "707279"
  },
  {
    "text": "we have the generic run c we have a run c that configures high performance for cpu",
    "start": "707279",
    "end": "713200"
  },
  {
    "text": "balancing we have run c that allows uh userness annotations and then we have uh kata which uh",
    "start": "713200",
    "end": "720880"
  },
  {
    "text": "provides a bit more security as the kernel separated container in addition",
    "start": "720880",
    "end": "725920"
  },
  {
    "text": "to uh all of the ways that you can create your crowd there's also the pod annotations which",
    "start": "725920",
    "end": "732560"
  },
  {
    "text": "is a pretty generic feature uh generally known in kubernetes but i'm just going to real quick over it uh",
    "start": "732560",
    "end": "738880"
  },
  {
    "text": "it's you know a generic key value map in the pod metadata and it allows for",
    "start": "738880",
    "end": "745360"
  },
  {
    "text": "passing through of unstructured data varying levels of the stack what this allows us to do is",
    "start": "745360",
    "end": "750399"
  },
  {
    "text": "uh cryo has some specific annotations uh userness mode annotation and synthesize annotation and these",
    "start": "750399",
    "end": "757760"
  },
  {
    "text": "annotations allow um admins to our users to request differing uh",
    "start": "757760",
    "end": "764560"
  },
  {
    "text": "configurations of the runtime and then cryo can use those annotations",
    "start": "764560",
    "end": "769920"
  },
  {
    "text": "uh to uh to configure the runtime as long as that user is allowed to do",
    "start": "769920",
    "end": "776160"
  },
  {
    "text": "that and we'll go into a username uh mode annotation example a little bit",
    "start": "776160",
    "end": "781360"
  },
  {
    "text": "but first in summary admins have the ability to configure cryo",
    "start": "781360",
    "end": "786800"
  },
  {
    "text": "in a varying number of ways storage image networking uh all of these varying options in",
    "start": "786800",
    "end": "792800"
  },
  {
    "text": "addition to that they have the ability to add runtime classes to restrict varying",
    "start": "792800",
    "end": "798839"
  },
  {
    "text": "behavior uh that through that cryo configures the runtime to do and in addition to that they have the",
    "start": "798839",
    "end": "805200"
  },
  {
    "text": "ability to make different uh controllers date runtime classes or annotations before they reach cryo which",
    "start": "805200",
    "end": "811120"
  },
  {
    "text": "uh gives the ability for admins to have a lot of power in configuring",
    "start": "811120",
    "end": "817440"
  },
  {
    "text": "their uh kubernetes nodes for all their varying use cases and workloads so now we're",
    "start": "817440",
    "end": "823839"
  },
  {
    "text": "going to have the first example of that we're going to have burgers you talked about a long time class topology",
    "start": "823839",
    "end": "830079"
  },
  {
    "text": "yeah um thanks so we can use the runtime class topology as well as spot annotations to",
    "start": "830079",
    "end": "836959"
  },
  {
    "text": "disable cpu load balancing for certain containers that are using high performance runtimes",
    "start": "836959",
    "end": "842320"
  },
  {
    "text": "the way this is done is that a pre-start hook is run to disable load balancing on the cpu specified in the pod spec",
    "start": "842320",
    "end": "849839"
  },
  {
    "text": "and then a pre-stock hook is run to enable load balancing on those cpus once the part is about to be stopped",
    "start": "849839",
    "end": "856959"
  },
  {
    "text": "so this is helpful in workloads where the expanse of context switching cannot be tolerated",
    "start": "856959",
    "end": "862160"
  },
  {
    "text": "so the user the admin of the user gets the privilege to disable cpu load balancing",
    "start": "862160",
    "end": "867600"
  },
  {
    "text": "and certain cpus so i have a quick demo on how this is done",
    "start": "867600",
    "end": "872959"
  },
  {
    "text": "okay so in this demo here i have an openshift cluster um so the first thing that i did with my",
    "start": "872959",
    "end": "879440"
  },
  {
    "text": "cluster was i created a machine config object that drops in",
    "start": "879440",
    "end": "884720"
  },
  {
    "text": "a config file at cryo.com.d called 99 onetimes.config.com",
    "start": "884720",
    "end": "891839"
  },
  {
    "text": "so in this config file i am configuring my runtime class my high performance runtime class so",
    "start": "891839",
    "end": "899360"
  },
  {
    "text": "that was just the base64 content so we can go on the node now to see what the file actually looks like um",
    "start": "899360",
    "end": "907600"
  },
  {
    "text": "under the crowd of confident folder and we can see here that i have created a",
    "start": "907600",
    "end": "912800"
  },
  {
    "text": "runtime called high performance here this is important because we will be creating a one-time class using",
    "start": "912800",
    "end": "918880"
  },
  {
    "text": "oc and cryo needs to know uh that there is a high performance runtime",
    "start": "918880",
    "end": "924000"
  },
  {
    "text": "that exists so it knows to run the pre-start and free stock books so since we're already on the node we",
    "start": "924000",
    "end": "929920"
  },
  {
    "text": "can check the value of the flags for the various cpus that i have on this node",
    "start": "929920",
    "end": "935759"
  },
  {
    "text": "this is important to keep in mind uh what the value here is so four seven eight three and four six five five",
    "start": "935759",
    "end": "942079"
  },
  {
    "text": "because once we disable load balancing um on the cpu uh the value will drop by one",
    "start": "942079",
    "end": "949519"
  },
  {
    "text": "um the other thing that i did was uh i created a cubelet config cr",
    "start": "949519",
    "end": "955759"
  },
  {
    "text": "to update the cpu manager policy to static so this allows me to request whole",
    "start": "955759",
    "end": "962880"
  },
  {
    "text": "cpus on certain nodes exclusively so if you can see in the cube.com file",
    "start": "962880",
    "end": "969199"
  },
  {
    "text": "here um let me scroll down right here i don't even see my cursor but it was set to",
    "start": "969199",
    "end": "974800"
  },
  {
    "text": "static um so now the next thing is",
    "start": "974800",
    "end": "980240"
  },
  {
    "text": "i created a runtime class a high performance runtime class the handler name was high performance",
    "start": "980240",
    "end": "985360"
  },
  {
    "text": "and i called it hyperf test uh this is just a quick description of what the runtime class",
    "start": "985360",
    "end": "991680"
  },
  {
    "text": "looks like so now we are ready to create our pod where we would like to disable",
    "start": "991680",
    "end": "998560"
  },
  {
    "text": "cpu load balancing so here for the part i have the set the cpu load balancing",
    "start": "998560",
    "end": "1004160"
  },
  {
    "text": "cryo io annotation to true i have set the runtime class name to the hypertest",
    "start": "1004160",
    "end": "1009360"
  },
  {
    "text": "runtime class that i created and i have requested two cpus under my resources um so",
    "start": "1009360",
    "end": "1017199"
  },
  {
    "text": "the spot is up and running now let's figure out which node it's running on so",
    "start": "1017199",
    "end": "1022320"
  },
  {
    "text": "we can go on the node to verify that uh cpu load balancing was",
    "start": "1022320",
    "end": "1027520"
  },
  {
    "text": "actually disabled on the two cpus that the container got so first thing we have",
    "start": "1027520",
    "end": "1033839"
  },
  {
    "text": "to find is the c group slice for that container so we can figure out the cpus that",
    "start": "1033839",
    "end": "1039438"
  },
  {
    "text": "it is using so i'm just getting my container id uh and then finding the cpu set uh",
    "start": "1039439",
    "end": "1048240"
  },
  {
    "text": "okay and we got the slice and we can see here that the cpu set",
    "start": "1048240",
    "end": "1055039"
  },
  {
    "text": "are cpus one and three those are the cpus i got um so we can check the value of the flag",
    "start": "1055039",
    "end": "1062720"
  },
  {
    "text": "for these two cpus now",
    "start": "1062720",
    "end": "1067840"
  },
  {
    "text": "and here we can see that the values dropped down by one it is four seven",
    "start": "1068000",
    "end": "1074080"
  },
  {
    "text": "eight two and four six five four now for both cpu one and cpu three",
    "start": "1074080",
    "end": "1079360"
  },
  {
    "text": "we can just take a look at cpu 2 for example um just see what the to double check the",
    "start": "1079360",
    "end": "1086880"
  },
  {
    "text": "values that that one is still enabled and we didn't accidentally disable that so as you can see the values are greater",
    "start": "1086880",
    "end": "1094640"
  },
  {
    "text": "than the disabled one so we we successfully disable c fuel load balancing on the two cpus that the pod",
    "start": "1094640",
    "end": "1101280"
  },
  {
    "text": "got um so now once the pod is done running we",
    "start": "1101280",
    "end": "1106559"
  },
  {
    "text": "don't leave the cpu load balancing disabled we re-enable it with the free stuff hook as i mentioned before",
    "start": "1106559",
    "end": "1113520"
  },
  {
    "text": "so let's quickly delete the pod here and we'll go back on the node and",
    "start": "1113520",
    "end": "1120480"
  },
  {
    "text": "check the same flag value again so yep and then we're going to catch",
    "start": "1120480",
    "end": "1126160"
  },
  {
    "text": "that value for cpu one and three and yep as you can see it went back up",
    "start": "1126160",
    "end": "1132640"
  },
  {
    "text": "as those load balancing on these two cpus are enabled again and that's all i have for my demo",
    "start": "1132640",
    "end": "1139280"
  },
  {
    "text": "all right let's talk a bit about security related configurations so usually the container runtime interface defines the main behavior",
    "start": "1139280",
    "end": "1146640"
  },
  {
    "text": "how a container runtime which implements the kubernetes api should behave but this behavior is probably not always",
    "start": "1146640",
    "end": "1153200"
  },
  {
    "text": "the most secure one so for example if we specify a second",
    "start": "1153200",
    "end": "1158240"
  },
  {
    "text": "profile and put it and put it into an empty string then this will be considered as",
    "start": "1158240",
    "end": "1163919"
  },
  {
    "text": "unconfined and this applies to basically all workloads in the cluster who do not use the runtime default",
    "start": "1163919",
    "end": "1169679"
  },
  {
    "text": "second profile or a localhost profile so therefore we decided to add a new configuration",
    "start": "1169679",
    "end": "1175919"
  },
  {
    "text": "option which is called sec compute's default when empty and this should help us to increase the security defaults",
    "start": "1175919",
    "end": "1181760"
  },
  {
    "text": "um running on container runtimes so turning this option on will by default use the",
    "start": "1181760",
    "end": "1187760"
  },
  {
    "text": "runtime default second profile which ships with cryo to all workloads who do not really specify something like unconfined",
    "start": "1187760",
    "end": "1195039"
  },
  {
    "text": "or localhost profile and i prepared a demo for you to show it",
    "start": "1195039",
    "end": "1200320"
  },
  {
    "text": "to you so first of all let's have a look at this new configuration option",
    "start": "1200320",
    "end": "1205520"
  },
  {
    "text": "so it's part of cryo.conf and we can just have a look into the",
    "start": "1205520",
    "end": "1211120"
  },
  {
    "text": "description of the option and by default it it's set to false so if we now",
    "start": "1211120",
    "end": "1217280"
  },
  {
    "text": "run cryo and for our demonstration purposes we will unset the configuration directory",
    "start": "1217280",
    "end": "1223840"
  },
  {
    "text": "and then create a kubernetes workload",
    "start": "1223840",
    "end": "1229120"
  },
  {
    "text": "and then we can see that zaccom is not enabled on this workload so we can just verify",
    "start": "1229120",
    "end": "1236400"
  },
  {
    "text": "it by using proxy status and second points to zero so it's not enabled at all",
    "start": "1236400",
    "end": "1243200"
  },
  {
    "text": "so if we now create a drop-in configuration which enables the features for us then",
    "start": "1243200",
    "end": "1249280"
  },
  {
    "text": "this would look like that that we just have cryo.d and we just override the compute's",
    "start": "1249280",
    "end": "1256080"
  },
  {
    "text": "default one empty to true if we now run cryo with that configuration directory",
    "start": "1256080",
    "end": "1262640"
  },
  {
    "text": "and create a new kubernetes workload then we can verify now in the same way",
    "start": "1262640",
    "end": "1268880"
  },
  {
    "text": "that seccomp is enabled for that workload and this is a great enhancement to",
    "start": "1268880",
    "end": "1275120"
  },
  {
    "text": "default security and is a good example of strong security defaults from my perspective",
    "start": "1275120",
    "end": "1281280"
  },
  {
    "text": "that's it for my demo thanks sasha um so next we're going to talk a little",
    "start": "1281280",
    "end": "1287200"
  },
  {
    "text": "bit about username spaces in kubernetes and cryo so real quick i'm just going to do a quick overview of your name spaces for",
    "start": "1287200",
    "end": "1293679"
  },
  {
    "text": "people who aren't aware uh you can think of of users and groups as people and the",
    "start": "1293679",
    "end": "1298720"
  },
  {
    "text": "available range of ids all of them on the host is like a house the username space is people",
    "start": "1298720",
    "end": "1304799"
  },
  {
    "text": "living not in the full house but in a little dollhouse within the house as in a subset of the",
    "start": "1304799",
    "end": "1309919"
  },
  {
    "text": "range of ids without going too far into it the there",
    "start": "1309919",
    "end": "1315760"
  },
  {
    "text": "are quite a few security advantages to username spaces while inside the container the process can think it's",
    "start": "1315760",
    "end": "1321840"
  },
  {
    "text": "privileged and be given privileges from the perspective of the host like a process and a container can mount",
    "start": "1321840",
    "end": "1330240"
  },
  {
    "text": "because it thinks that it's uid 0 or root but on the outside it's actually an unpurposed process",
    "start": "1330240",
    "end": "1336640"
  },
  {
    "text": "and if if a container was able to break out",
    "start": "1336640",
    "end": "1342159"
  },
  {
    "text": "then the then it wouldn't actually be able to do anything on the host um so it's much",
    "start": "1342159",
    "end": "1348320"
  },
  {
    "text": "more secure to be able to run any pause any any kind of privilege inside of a username space",
    "start": "1348320",
    "end": "1355440"
  },
  {
    "text": "so username spaces in kubernetes has been a really long time issue an original enhancement request in 2016",
    "start": "1355440",
    "end": "1364240"
  },
  {
    "text": "was brought up about it and it's been attempted to be implemented varying times throughout the",
    "start": "1364240",
    "end": "1370000"
  },
  {
    "text": "last four years and yet still again we have a another cap in 2020 that describes how uh",
    "start": "1370000",
    "end": "1377520"
  },
  {
    "text": "we may be able to implement username spaces again so uh that's the sad news",
    "start": "1377520",
    "end": "1384720"
  },
  {
    "text": "the happy news is that much like a pig's limit which was an option that cryo introduced way at the beginning of",
    "start": "1384720",
    "end": "1391280"
  },
  {
    "text": "cryo to prevent fork bombs from dosing a system um and that wasn't supported in kubernetes",
    "start": "1391280",
    "end": "1397600"
  },
  {
    "text": "until 119 i believe or 118 somewhere around then um",
    "start": "1397600",
    "end": "1403440"
  },
  {
    "text": "cryo has added uh support for username spaces before upstream cube has solidified on the implementation",
    "start": "1403440",
    "end": "1410159"
  },
  {
    "text": "and this allows uh admins to play around with username spaces and use it",
    "start": "1410159",
    "end": "1416400"
  },
  {
    "text": "but we make sure to implement it in a way that's secure so um by what we did is we",
    "start": "1416400",
    "end": "1423760"
  },
  {
    "text": "um configure allowed so there's a username space um",
    "start": "1423760",
    "end": "1430720"
  },
  {
    "text": "annotation io kubernetes cryo user and s mode and only uh pods that run",
    "start": "1430720",
    "end": "1438559"
  },
  {
    "text": "in certain runtime classes are allowed to interpret that annotation to actually be able to create",
    "start": "1438559",
    "end": "1444559"
  },
  {
    "text": "a username space for the pod and uh that allows admins to",
    "start": "1444559",
    "end": "1450799"
  },
  {
    "text": "uh stop anyone from creating username space if they don't specify a runtime handler with the username space",
    "start": "1450799",
    "end": "1456559"
  },
  {
    "text": "or only allow some people to use username spaces through admission controllers policy or runtime",
    "start": "1456559",
    "end": "1461840"
  },
  {
    "text": "classes and then give anyone access to username spaces if they have",
    "start": "1461840",
    "end": "1466960"
  },
  {
    "text": "they allow annotations in all of their runtime classes so i'm going to do a quick demo",
    "start": "1466960",
    "end": "1473600"
  },
  {
    "text": "on that all right so so we're going to start off by just",
    "start": "1473600",
    "end": "1479360"
  },
  {
    "text": "creating a vanilla kubernetes cluster running cryo in it and while this",
    "start": "1479360",
    "end": "1485360"
  },
  {
    "text": "bootstraps i'm going to show a little bit more about what we're going to be working with so we're going to start off",
    "start": "1485360",
    "end": "1490799"
  },
  {
    "text": "with our uh this is our runtime class for the user ns so notice um we have the name run to userness",
    "start": "1490799",
    "end": "1498559"
  },
  {
    "text": "and our allowed annotations is io grenades cryogenic mode so that means that this username space",
    "start": "1498559",
    "end": "1504640"
  },
  {
    "text": "is allowed to interpret the i o kubernetes cryo userness mode to",
    "start": "1504640",
    "end": "1509679"
  },
  {
    "text": "configure username space for a newly created pod moving forward a little bit then we're going to look at",
    "start": "1509679",
    "end": "1516080"
  },
  {
    "text": "our three queries objects that we're going to create so first we're going to create a runtime class and that's going to use",
    "start": "1516080",
    "end": "1521760"
  },
  {
    "text": "the handler to run to userness it's going to be called run userness class and any pod that wants to be able to",
    "start": "1521760",
    "end": "1527600"
  },
  {
    "text": "have the userness mode interpreted needs to use that class we're going to then create a pod um",
    "start": "1527600",
    "end": "1533840"
  },
  {
    "text": "usernesspod and that is going to have the auto annotation for userness mode",
    "start": "1533840",
    "end": "1541440"
  },
  {
    "text": "auto just means um ask the cryo to create a 65k",
    "start": "1541440",
    "end": "1548320"
  },
  {
    "text": "um sized user namespace nothing super fancy but it's sufficient",
    "start": "1548320",
    "end": "1554880"
  },
  {
    "text": "for the majority of use cases and it allows crowded executive delegation there are finer grain controls but",
    "start": "1554880",
    "end": "1560880"
  },
  {
    "text": "we're not going to go over that in this demo um and this container is just going to sleep for a day um and run a concert or a container and",
    "start": "1560880",
    "end": "1568640"
  },
  {
    "text": "it's going to use the runtime class userness class so it'll actually be allowed to do that um then we're going to create also a not",
    "start": "1568640",
    "end": "1575440"
  },
  {
    "text": "username pod this one is going to attempt to get the annotation auto but it's actually not going to work because",
    "start": "1575440",
    "end": "1582080"
  },
  {
    "text": "uh cryo um because it isn't configured with the correct runtime class name so cryo will refuse to interpret the",
    "start": "1582080",
    "end": "1588880"
  },
  {
    "text": "um annotation so it'll just be given the default username space this allows the admins to have finer",
    "start": "1588880",
    "end": "1595200"
  },
  {
    "text": "green control it's going to sleep for two days and that'll allow us to differentiate the two uh in a ps3",
    "start": "1595200",
    "end": "1602960"
  },
  {
    "text": "so now we're going to wait for this cluster to come up all right and so now we're going to",
    "start": "1602960",
    "end": "1610159"
  },
  {
    "text": "create our three pod objects and we're we'll check that they're",
    "start": "1610159",
    "end": "1615679"
  },
  {
    "text": "running which they are so now we're going to look at the the way to check that a username space is",
    "start": "1615679",
    "end": "1621679"
  },
  {
    "text": "running is check the uid map of the um of the",
    "start": "1621679",
    "end": "1626880"
  },
  {
    "text": "pid so we're going to find the pit of each of them so remember one day is our user ns pod and two days is our",
    "start": "1626880",
    "end": "1633520"
  },
  {
    "text": "not user on the spot so we're first going to look at our user nspot",
    "start": "1633520",
    "end": "1638559"
  },
  {
    "text": "and we're going to tap the uh uid map of that pod now note here we have so",
    "start": "1638559",
    "end": "1646399"
  },
  {
    "text": "the way that this file is structured is it has so this is the beginning of the uid range and that's",
    "start": "1646399",
    "end": "1652399"
  },
  {
    "text": "the end of the uh your day range all right the beginning of uid range with respect to the",
    "start": "1652399",
    "end": "1658320"
  },
  {
    "text": "um containers username space and this is the beginning of the uid range from the respect of the host username space",
    "start": "1658320",
    "end": "1664480"
  },
  {
    "text": "so the container thinks that it's running in uid0 but actually it's running in uid uh 20 000 and that",
    "start": "1664480",
    "end": "1670960"
  },
  {
    "text": "allows and then there are 65 k allocated ids which should be enough",
    "start": "1670960",
    "end": "1676640"
  },
  {
    "text": "for our two pid pods so this means that any pod",
    "start": "1676640",
    "end": "1682559"
  },
  {
    "text": "um any uh any process may think that it's root",
    "start": "1682559",
    "end": "1687600"
  },
  {
    "text": "inside of the container and be able to do uh things with elevated privileges from in inside the confines of the",
    "start": "1687600",
    "end": "1693679"
  },
  {
    "text": "container but from the perspective of the host it's just some rando uid and it can't do",
    "start": "1693679",
    "end": "1699039"
  },
  {
    "text": "anything fun so if it uh happens to break out goodness for good then um it won't really be able to do",
    "start": "1699039",
    "end": "1705600"
  },
  {
    "text": "anything uh that from its elevated capabilities from within the username space",
    "start": "1705600",
    "end": "1710880"
  },
  {
    "text": "and here just to demonstrate that it's gated on the runtime class we're going to show the not userness",
    "start": "1710880",
    "end": "1716240"
  },
  {
    "text": "pod so here we see from the perspective of the username space it's running as root or it's uid map because it's root",
    "start": "1716240",
    "end": "1724000"
  },
  {
    "text": "and from the host begins with root and this is just all of the available uids so basically what's happening is um",
    "start": "1724000",
    "end": "1730000"
  },
  {
    "text": "this pod is running in the host username space so if it uh is specified to run as a if if uh the",
    "start": "1730000",
    "end": "1736960"
  },
  {
    "text": "pid one in the container is running as root then it's actual root on the host and any privileges it has is are the",
    "start": "1736960",
    "end": "1743600"
  },
  {
    "text": "privileges from the perspective of the house and notice how even though we attempted",
    "start": "1743600",
    "end": "1749679"
  },
  {
    "text": "to give the annotation to the pod it didn't work it wasn't given the annotation",
    "start": "1749679",
    "end": "1755520"
  },
  {
    "text": "or it was the annotation wasn't interpreted so um the username space wasn't created and",
    "start": "1755520",
    "end": "1762000"
  },
  {
    "text": "that meant an admin uh stopped um you know some user from creating username space when they weren't",
    "start": "1762000",
    "end": "1767360"
  },
  {
    "text": "supposed to which uh demonstrates fine grain control",
    "start": "1767360",
    "end": "1772399"
  },
  {
    "text": "and that is it for the demo oh thank you for that awesome demo peter",
    "start": "1772399",
    "end": "1777520"
  },
  {
    "text": "so cryo currently is an incubating project in the cncf the most recent version of cryo is 119",
    "start": "1777520",
    "end": "1784159"
  },
  {
    "text": "and we continue to walk in lockstep with the kubernetes version cryo is stable and it is the container",
    "start": "1784159",
    "end": "1791200"
  },
  {
    "text": "runtime that is being used by susicaps and openshift4x clusters and production",
    "start": "1791200",
    "end": "1797120"
  },
  {
    "text": "so what's in the future of cryo as mentioned before cry already has support for user name spaces as well as c",
    "start": "1797120",
    "end": "1803600"
  },
  {
    "text": "groups v2 and we are working on pushing these features in option kubernetes as well so the clusters can take advantage",
    "start": "1803600",
    "end": "1809919"
  },
  {
    "text": "of it we are also moving some of cryo components over to rust to improve",
    "start": "1809919",
    "end": "1815200"
  },
  {
    "text": "performance and we see cryo graduating in the near future",
    "start": "1815200",
    "end": "1821440"
  },
  {
    "text": "if you want to find out more about cryo um here are some resources for you uh we are available on slack and irc",
    "start": "1821440",
    "end": "1829039"
  },
  {
    "text": "and we have this awesome.md dock on our repo which has links to past talks as well as any articles and",
    "start": "1829039",
    "end": "1835679"
  },
  {
    "text": "resources around cryo and we also have a pretty cool coloring book that talks about the different",
    "start": "1835679",
    "end": "1841279"
  },
  {
    "text": "container tools and how they work together i think now we can open the floor to questions thank you",
    "start": "1841279",
    "end": "1849278"
  }
]