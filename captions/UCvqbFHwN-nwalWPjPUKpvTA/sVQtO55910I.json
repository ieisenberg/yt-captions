[
  {
    "text": "okay uh hello everyone uh Welcome to our",
    "start": "1040",
    "end": "4240"
  },
  {
    "text": "talk uh we'll tell you our story uh of",
    "start": "4240",
    "end": "7799"
  },
  {
    "text": "our journey migrating in three volumes",
    "start": "7799",
    "end": "9679"
  },
  {
    "text": "to proper CSI ons so uh we'll start by a",
    "start": "9679",
    "end": "13040"
  },
  {
    "text": "quick reminder about how storage work in",
    "start": "13040",
    "end": "15560"
  },
  {
    "text": "communities uh then what's the CSI",
    "start": "15560",
    "end": "17880"
  },
  {
    "text": "migration and how we made it work for us",
    "start": "17880",
    "end": "21119"
  },
  {
    "text": "um so uh I'm antoan I'm a senior",
    "start": "21119",
    "end": "23720"
  },
  {
    "text": "software engineer datadog I joined the",
    "start": "23720",
    "end": "25519"
  },
  {
    "text": "company six years ago and uh it's been",
    "start": "25519",
    "end": "27760"
  },
  {
    "text": "two years now that I work on our kuber",
    "start": "27760",
    "end": "29759"
  },
  {
    "text": "stack and today I'm with hi I'm batist",
    "start": "29759",
    "end": "33480"
  },
  {
    "text": "software engineer at data dog where I do",
    "start": "33480",
    "end": "36440"
  },
  {
    "text": "everything related to storage inside",
    "start": "36440",
    "end": "39079"
  },
  {
    "text": "kues and first let me give you a brief",
    "start": "39079",
    "end": "42280"
  },
  {
    "text": "int introduction of how storage Works",
    "start": "42280",
    "end": "44239"
  },
  {
    "text": "inside",
    "start": "44239",
    "end": "45280"
  },
  {
    "text": "kues um well in if you want to have",
    "start": "45280",
    "end": "48559"
  },
  {
    "text": "access to some kind of persistent data",
    "start": "48559",
    "end": "50559"
  },
  {
    "text": "inside communities the most basic way is",
    "start": "50559",
    "end": "53039"
  },
  {
    "text": "to use um what's called like the nod per",
    "start": "53039",
    "end": "56680"
  },
  {
    "text": "local dis through for instance an MTD or",
    "start": "56680",
    "end": "59719"
  },
  {
    "text": "um",
    "start": "59719",
    "end": "61680"
  },
  {
    "text": "an host pass but if you want access to",
    "start": "61680",
    "end": "65680"
  },
  {
    "text": "more advanced storage uh a p can create",
    "start": "65680",
    "end": "69360"
  },
  {
    "text": "what's called a PVC persistent volume",
    "start": "69360",
    "end": "71880"
  },
  {
    "text": "claim which is the way for the P to ask",
    "start": "71880",
    "end": "75560"
  },
  {
    "text": "access to some kind of volume with a",
    "start": "75560",
    "end": "78520"
  },
  {
    "text": "certain",
    "start": "78520",
    "end": "80079"
  },
  {
    "text": "size and the storage class which is the",
    "start": "80079",
    "end": "83360"
  },
  {
    "text": "the way of the for the P to Define what",
    "start": "83360",
    "end": "86840"
  },
  {
    "text": "kind of uh volume it wants for instance",
    "start": "86840",
    "end": "90680"
  },
  {
    "text": "here the P can ask for gp3 volumes in",
    "start": "90680",
    "end": "94040"
  },
  {
    "text": "AWS",
    "start": "94040",
    "end": "95280"
  },
  {
    "text": "EBS and the cruster will try to satisfy",
    "start": "95280",
    "end": "100200"
  },
  {
    "text": "this claim using a persistent volume",
    "start": "100200",
    "end": "103680"
  },
  {
    "text": "which is the wave of for KU to represent",
    "start": "103680",
    "end": "108000"
  },
  {
    "text": "the backing disk used by a pod which can",
    "start": "108000",
    "end": "112960"
  },
  {
    "text": "be a multiple which can use multiple",
    "start": "112960",
    "end": "115040"
  },
  {
    "text": "kind of volume providers like AWS EBS or",
    "start": "115040",
    "end": "118320"
  },
  {
    "text": "gcp persistant discs",
    "start": "118320",
    "end": "120920"
  },
  {
    "text": "and once we have a PV and a PVC they can",
    "start": "120920",
    "end": "123479"
  },
  {
    "text": "be bound together and the PO can have",
    "start": "123479",
    "end": "126039"
  },
  {
    "text": "access to the underlying",
    "start": "126039",
    "end": "129160"
  },
  {
    "text": "data initially in kubernetes the the way",
    "start": "129160",
    "end": "132680"
  },
  {
    "text": "to get persistent volumes was through in",
    "start": "132680",
    "end": "135200"
  },
  {
    "text": "three volumes in three because the code",
    "start": "135200",
    "end": "139200"
  },
  {
    "text": "responsible for creating those volumes",
    "start": "139200",
    "end": "141319"
  },
  {
    "text": "inside kubernetes was part of the inry",
    "start": "141319",
    "end": "144560"
  },
  {
    "text": "kubernetes source code so it was a",
    "start": "144560",
    "end": "147840"
  },
  {
    "text": "historical way of getting volumes inside",
    "start": "147840",
    "end": "150480"
  },
  {
    "text": "communities but it had several drawbacks",
    "start": "150480",
    "end": "153239"
  },
  {
    "text": "because the of the fact that it's inside",
    "start": "153239",
    "end": "155440"
  },
  {
    "text": "of the kuun source code mainly um",
    "start": "155440",
    "end": "159640"
  },
  {
    "text": "storage drivers would have to open",
    "start": "159640",
    "end": "161599"
  },
  {
    "text": "source their code inside communities and",
    "start": "161599",
    "end": "164360"
  },
  {
    "text": "follow the release cycle of kubernetes",
    "start": "164360",
    "end": "167000"
  },
  {
    "text": "which is a bit cumbersome when you just",
    "start": "167000",
    "end": "169080"
  },
  {
    "text": "want to make some small changes to your",
    "start": "169080",
    "end": "172280"
  },
  {
    "text": "driver and how in three volumes worked",
    "start": "172280",
    "end": "175239"
  },
  {
    "text": "where well you have a a pod that can ask",
    "start": "175239",
    "end": "178280"
  },
  {
    "text": "for a PVC",
    "start": "178280",
    "end": "181159"
  },
  {
    "text": "and the controller manager in particular",
    "start": "181159",
    "end": "183760"
  },
  {
    "text": "the volume controller will watch for",
    "start": "183760",
    "end": "186400"
  },
  {
    "text": "those PVCs and what it no is one it will",
    "start": "186400",
    "end": "190360"
  },
  {
    "text": "invoke like it will call the volume",
    "start": "190360",
    "end": "192959"
  },
  {
    "text": "provider to create a disk inside the",
    "start": "192959",
    "end": "196280"
  },
  {
    "text": "volume provider once the dis is created",
    "start": "196280",
    "end": "199440"
  },
  {
    "text": "the volume controller can create an",
    "start": "199440",
    "end": "202440"
  },
  {
    "text": "entry PV and Link it to the volume",
    "start": "202440",
    "end": "205640"
  },
  {
    "text": "provider",
    "start": "205640",
    "end": "207480"
  },
  {
    "text": "disk and after that it will buy",
    "start": "207480",
    "end": "210400"
  },
  {
    "text": "the PVC created by the Pod to the entry",
    "start": "210400",
    "end": "215560"
  },
  {
    "text": "PV finally the cubet present on on the",
    "start": "215560",
    "end": "219560"
  },
  {
    "text": "Node where the Pod is running will Mount",
    "start": "219560",
    "end": "222720"
  },
  {
    "text": "the volume inside the Pod so that the",
    "start": "222720",
    "end": "226519"
  },
  {
    "text": "the Pod can access",
    "start": "226519",
    "end": "229120"
  },
  {
    "text": "it and after entry there was a need to",
    "start": "229120",
    "end": "235079"
  },
  {
    "text": "actually create a more versatile way to",
    "start": "235079",
    "end": "237799"
  },
  {
    "text": "get bant volumes inside kubes and so uh",
    "start": "237799",
    "end": "241360"
  },
  {
    "text": "CSI was created CSI stands for container",
    "start": "241360",
    "end": "244640"
  },
  {
    "text": "storage interface which was introduced",
    "start": "244640",
    "end": "247040"
  },
  {
    "text": "in 1.9 in communities and has been GA",
    "start": "247040",
    "end": "250200"
  },
  {
    "text": "since",
    "start": "250200",
    "end": "251680"
  },
  {
    "text": "113 and CSI creates a way to for volume",
    "start": "251680",
    "end": "256880"
  },
  {
    "text": "providers to have a a common interface",
    "start": "256880",
    "end": "260479"
  },
  {
    "text": "to create volumes inside",
    "start": "260479",
    "end": "263080"
  },
  {
    "text": "communities and it gets rid of the main",
    "start": "263080",
    "end": "265600"
  },
  {
    "text": "drawback of uh entry volumes meaning",
    "start": "265600",
    "end": "268080"
  },
  {
    "text": "that the CSI is Main maintained out of",
    "start": "268080",
    "end": "270400"
  },
  {
    "text": "three from communities so each volume",
    "start": "270400",
    "end": "272960"
  },
  {
    "text": "provider can have their own driver and",
    "start": "272960",
    "end": "276479"
  },
  {
    "text": "maintain it at their own",
    "start": "276479",
    "end": "279080"
  },
  {
    "text": "pace also CSI brings a bunch of new",
    "start": "279080",
    "end": "282240"
  },
  {
    "text": "features to the volume management te",
    "start": "282240",
    "end": "285440"
  },
  {
    "text": "communties mainly uh you can have access",
    "start": "285440",
    "end": "288000"
  },
  {
    "text": "to volume snapshotting volume cloning or",
    "start": "288000",
    "end": "290840"
  },
  {
    "text": "volume",
    "start": "290840",
    "end": "292880"
  },
  {
    "text": "resizing and CSI Works in a very similar",
    "start": "292880",
    "end": "295600"
  },
  {
    "text": "way compared to inry except that you",
    "start": "295600",
    "end": "298880"
  },
  {
    "text": "have CSI components deployed in your",
    "start": "298880",
    "end": "300720"
  },
  {
    "text": "cluster so the CSI node or CSI driver",
    "start": "300720",
    "end": "304199"
  },
  {
    "text": "and those components will take care of",
    "start": "304199",
    "end": "306759"
  },
  {
    "text": "managing the volumes in place of the",
    "start": "306759",
    "end": "308840"
  },
  {
    "text": "cubet and control manager so the core",
    "start": "308840",
    "end": "312039"
  },
  {
    "text": "Cub components just become some kind of",
    "start": "312039",
    "end": "314759"
  },
  {
    "text": "path through for the CSI",
    "start": "314759",
    "end": "318960"
  },
  {
    "text": "components and now we with two kinds of",
    "start": "319039",
    "end": "321880"
  },
  {
    "text": "volumes available inside the Clusters",
    "start": "321880",
    "end": "324240"
  },
  {
    "text": "inry and CSI there was a need to get rid",
    "start": "324240",
    "end": "328319"
  },
  {
    "text": "of the old inry",
    "start": "328319",
    "end": "331039"
  },
  {
    "text": "volumes and so uh here comes the CSI",
    "start": "331039",
    "end": "334120"
  },
  {
    "text": "migration which is um a migration",
    "start": "334120",
    "end": "337759"
  },
  {
    "text": "activated using a feature flag inside",
    "start": "337759",
    "end": "339840"
  },
  {
    "text": "the API server and the cuet which has",
    "start": "339840",
    "end": "342520"
  },
  {
    "text": "been G8 since",
    "start": "342520",
    "end": "344319"
  },
  {
    "text": "125 and when you activate this migration",
    "start": "344319",
    "end": "348280"
  },
  {
    "text": "the entry volumes are now are now",
    "start": "348280",
    "end": "351960"
  },
  {
    "text": "managed by CSI the same way as the CSI",
    "start": "351960",
    "end": "354319"
  },
  {
    "text": "volumes",
    "start": "354319",
    "end": "355759"
  },
  {
    "text": "are so initially you have entry PV",
    "start": "355759",
    "end": "359880"
  },
  {
    "text": "managed by the controll manager in the",
    "start": "359880",
    "end": "361319"
  },
  {
    "text": "cuet and once you activate the feure",
    "start": "361319",
    "end": "363840"
  },
  {
    "text": "flag you get still entry PVS but there",
    "start": "363840",
    "end": "367319"
  },
  {
    "text": "are no managed by CSI node and CSI",
    "start": "367319",
    "end": "370599"
  },
  {
    "text": "driver so it's it looks like a great",
    "start": "370599",
    "end": "373560"
  },
  {
    "text": "migration",
    "start": "373560",
    "end": "375160"
  },
  {
    "text": "right so yeah uh this far it looked easy",
    "start": "375160",
    "end": "378280"
  },
  {
    "text": "uh you have official migration just a",
    "start": "378280",
    "end": "379960"
  },
  {
    "text": "couple of flags to to switch on but uh",
    "start": "379960",
    "end": "383080"
  },
  {
    "text": "after going through the process uh we",
    "start": "383080",
    "end": "385000"
  },
  {
    "text": "looked at our",
    "start": "385000",
    "end": "386240"
  },
  {
    "text": "cluster and uh we think that maybe we",
    "start": "386240",
    "end": "389160"
  },
  {
    "text": "might have misunderstood uh the",
    "start": "389160",
    "end": "391240"
  },
  {
    "text": "migration term here uh we were still",
    "start": "391240",
    "end": "394400"
  },
  {
    "text": "left with uh volumes that were still",
    "start": "394400",
    "end": "397120"
  },
  {
    "text": "entry uh so they had extra annotation",
    "start": "397120",
    "end": "399880"
  },
  {
    "text": "indicating that uh migration happened",
    "start": "399880",
    "end": "401919"
  },
  {
    "text": "but they were still referencing the",
    "start": "401919",
    "end": "403680"
  },
  {
    "text": "entry driver in the spec and still uh",
    "start": "403680",
    "end": "406599"
  },
  {
    "text": "refer using the All Storage classes so",
    "start": "406599",
    "end": "409199"
  },
  {
    "text": "was it a big deal well maybe uh it could",
    "start": "409199",
    "end": "413240"
  },
  {
    "text": "it could have been fine but uh we wanted",
    "start": "413240",
    "end": "415680"
  },
  {
    "text": "to use the new CSI",
    "start": "415680",
    "end": "417960"
  },
  {
    "text": "features and uh the new CSI features",
    "start": "417960",
    "end": "420960"
  },
  {
    "text": "were working fine with the CSI volumes",
    "start": "420960",
    "end": "422840"
  },
  {
    "text": "but with the migrated ones it was fading",
    "start": "422840",
    "end": "424960"
  },
  {
    "text": "so we looked at GitHub issues and uh we",
    "start": "424960",
    "end": "428360"
  },
  {
    "text": "found that it was not a bug it was a",
    "start": "428360",
    "end": "430400"
  },
  {
    "text": "deliberate Choice uh CSI migration was",
    "start": "430400",
    "end": "433599"
  },
  {
    "text": "never intended to support uh new",
    "start": "433599",
    "end": "435759"
  },
  {
    "text": "features for inry",
    "start": "435759",
    "end": "438000"
  },
  {
    "text": "drivers so uh this also meant that any",
    "start": "438000",
    "end": "441360"
  },
  {
    "text": "uh new feature in the future wouldn't be",
    "start": "441360",
    "end": "443639"
  },
  {
    "text": "supported by those",
    "start": "443639",
    "end": "445479"
  },
  {
    "text": "volumes so uh it was a problem for us",
    "start": "445479",
    "end": "448160"
  },
  {
    "text": "because we had a bunch of volumes",
    "start": "448160",
    "end": "450080"
  },
  {
    "text": "already provisioned so it would turn our",
    "start": "450080",
    "end": "452319"
  },
  {
    "text": "platform into a very heterogeneous State",
    "start": "452319",
    "end": "455479"
  },
  {
    "text": "and we would have to deal differently",
    "start": "455479",
    "end": "457240"
  },
  {
    "text": "with Legacy volumes and the and the new",
    "start": "457240",
    "end": "460120"
  },
  {
    "text": "ones so we could uh imagine recreating",
    "start": "460120",
    "end": "462960"
  },
  {
    "text": "all the volumes by hand but we couldn't",
    "start": "462960",
    "end": "466159"
  },
  {
    "text": "afford to have this kind of disruptive",
    "start": "466159",
    "end": "468639"
  },
  {
    "text": "operations uh involving application",
    "start": "468639",
    "end": "470879"
  },
  {
    "text": "teams especially Aros scale",
    "start": "470879",
    "end": "473560"
  },
  {
    "text": "so we needed to uh to have a a true",
    "start": "473560",
    "end": "476520"
  },
  {
    "text": "migration fitting our scale so I",
    "start": "476520",
    "end": "478199"
  },
  {
    "text": "mentioned our scale what is our scale",
    "start": "478199",
    "end": "479680"
  },
  {
    "text": "exactly so uh at datalog uh we have self",
    "start": "479680",
    "end": "482560"
  },
  {
    "text": "manag clusters running on three",
    "start": "482560",
    "end": "484479"
  },
  {
    "text": "different Cloud providers uh we run",
    "start": "484479",
    "end": "488319"
  },
  {
    "text": "uh hundreds of different clusters it's",
    "start": "488319",
    "end": "491240"
  },
  {
    "text": "uh it represent 10 of thousand of nodes",
    "start": "491240",
    "end": "493879"
  },
  {
    "text": "and our biggest cluster can have uh up",
    "start": "493879",
    "end": "496199"
  },
  {
    "text": "to 4,000 nodes uh for the state food",
    "start": "496199",
    "end": "499240"
  },
  {
    "text": "part uh we have thousands of state food",
    "start": "499240",
    "end": "501319"
  },
  {
    "text": "s running and they are owned by dozen of",
    "start": "501319",
    "end": "504280"
  },
  {
    "text": "different teams it represents hundreds",
    "start": "504280",
    "end": "506759"
  },
  {
    "text": "of different services and the 10 of",
    "start": "506759",
    "end": "509520"
  },
  {
    "text": "thousand of persistent",
    "start": "509520",
    "end": "512080"
  },
  {
    "text": "volumes uh so we started looking into uh",
    "start": "512080",
    "end": "515560"
  },
  {
    "text": "how to make this uh an actual migration",
    "start": "515560",
    "end": "518640"
  },
  {
    "text": "and uh of course we need this toh to be",
    "start": "518640",
    "end": "520880"
  },
  {
    "text": "done in place without any done time and",
    "start": "520880",
    "end": "523560"
  },
  {
    "text": "uh if possible we didn't want the",
    "start": "523560",
    "end": "525680"
  },
  {
    "text": "application team to even notice",
    "start": "525680",
    "end": "527040"
  },
  {
    "text": "something was going on so uh first",
    "start": "527040",
    "end": "530120"
  },
  {
    "text": "obvious step was to make sure that we",
    "start": "530120",
    "end": "531720"
  },
  {
    "text": "were not provisioning uh Legacy volumes",
    "start": "531720",
    "end": "534240"
  },
  {
    "text": "anymore so we uh we made sure that the",
    "start": "534240",
    "end": "536440"
  },
  {
    "text": "CSI storage classes were the default",
    "start": "536440",
    "end": "538279"
  },
  {
    "text": "ones and and uh then after some testing",
    "start": "538279",
    "end": "541680"
  },
  {
    "text": "uh we realized that it was not an issue",
    "start": "541680",
    "end": "543920"
  },
  {
    "text": "to have mixed St full sets so meaning",
    "start": "543920",
    "end": "546200"
  },
  {
    "text": "that we could have state full sets both",
    "start": "546200",
    "end": "549399"
  },
  {
    "text": "with uh entry volumes and CSI ones so we",
    "start": "549399",
    "end": "553040"
  },
  {
    "text": "decided uh to replace our storage",
    "start": "553040",
    "end": "555240"
  },
  {
    "text": "classes in place so taking the the inry",
    "start": "555240",
    "end": "558480"
  },
  {
    "text": "storage classes and uh turning them into",
    "start": "558480",
    "end": "560920"
  },
  {
    "text": "their CSI",
    "start": "560920",
    "end": "563279"
  },
  {
    "text": "equivalent uh then we had to take care",
    "start": "563279",
    "end": "565640"
  },
  {
    "text": "of the volumes object themselves so uh",
    "start": "565640",
    "end": "568079"
  },
  {
    "text": "we wanted to go from the what you can",
    "start": "568079",
    "end": "569760"
  },
  {
    "text": "see on the left to the one on the right",
    "start": "569760",
    "end": "572640"
  },
  {
    "text": "uh so actually there was already code",
    "start": "572640",
    "end": "574360"
  },
  {
    "text": "written for that the code that was uh",
    "start": "574360",
    "end": "576600"
  },
  {
    "text": "used by the CSI migration process uh in",
    "start": "576600",
    "end": "579519"
  },
  {
    "text": "a CSI translation",
    "start": "579519",
    "end": "581600"
  },
  {
    "text": "lib the problem was that you can't",
    "start": "581600",
    "end": "584560"
  },
  {
    "text": "change the the volume specs uh it's an",
    "start": "584560",
    "end": "587600"
  },
  {
    "text": "immutable object so the API server will",
    "start": "587600",
    "end": "590240"
  },
  {
    "text": "reject your changes so we thought how",
    "start": "590240",
    "end": "592600"
  },
  {
    "text": "how can we uh work around that so uh",
    "start": "592600",
    "end": "594959"
  },
  {
    "text": "first idea was to uh uh patch the the",
    "start": "594959",
    "end": "598000"
  },
  {
    "text": "objects themselves into hcd backing",
    "start": "598000",
    "end": "600720"
  },
  {
    "text": "store um so we thought that maybe uh it",
    "start": "600720",
    "end": "603880"
  },
  {
    "text": "was uh very hacky and also we were not",
    "start": "603880",
    "end": "607079"
  },
  {
    "text": "sure about possible race conditions uh",
    "start": "607079",
    "end": "609760"
  },
  {
    "text": "the interactions with the different",
    "start": "609760",
    "end": "611480"
  },
  {
    "text": "caches of all the kuties components so",
    "start": "611480",
    "end": "614240"
  },
  {
    "text": "uh we thought that maybe uh it's better",
    "start": "614240",
    "end": "616480"
  },
  {
    "text": "to just patch the API server to allow",
    "start": "616480",
    "end": "618640"
  },
  {
    "text": "the modification at the API server level",
    "start": "618640",
    "end": "621240"
  },
  {
    "text": "and that way uh this operation will be",
    "start": "621240",
    "end": "623480"
  },
  {
    "text": "just like any other uh update operation",
    "start": "623480",
    "end": "625800"
  },
  {
    "text": "on an object uh and it will like do all",
    "start": "625800",
    "end": "628839"
  },
  {
    "text": "the necessary check to avoid the race",
    "start": "628839",
    "end": "630560"
  },
  {
    "text": "condition",
    "start": "630560",
    "end": "632000"
  },
  {
    "text": "so the patch itself uh yeah it's very uh",
    "start": "632000",
    "end": "636200"
  },
  {
    "text": "very small actually it's just like",
    "start": "636200",
    "end": "637519"
  },
  {
    "text": "commenting out seven lines of code so",
    "start": "637519",
    "end": "639680"
  },
  {
    "text": "just like basically uh removing the the",
    "start": "639680",
    "end": "642279"
  },
  {
    "text": "equality check in the API server and so",
    "start": "642279",
    "end": "645279"
  },
  {
    "text": "now we have to integrate this properly",
    "start": "645279",
    "end": "647040"
  },
  {
    "text": "to to run the the migration safely on",
    "start": "647040",
    "end": "648959"
  },
  {
    "text": "our on our Fleet so the migration tool",
    "start": "648959",
    "end": "652279"
  },
  {
    "text": "implementation uh very straightforward",
    "start": "652279",
    "end": "654760"
  },
  {
    "text": "uh we had to connect to a patch API",
    "start": "654760",
    "end": "656720"
  },
  {
    "text": "server loop on all the entry volumes we",
    "start": "656720",
    "end": "659399"
  },
  {
    "text": "had use a transition lib uh turn them",
    "start": "659399",
    "end": "661639"
  },
  {
    "text": "into CSI volumes and then puras the",
    "start": "661639",
    "end": "663959"
  },
  {
    "text": "changes uh so how does it look like so",
    "start": "663959",
    "end": "666240"
  },
  {
    "text": "you have the AP server uh connected to",
    "start": "666240",
    "end": "668279"
  },
  {
    "text": "the your hcd backing store uh we deploy",
    "start": "668279",
    "end": "671399"
  },
  {
    "text": "a patch API server pod uh we make sure",
    "start": "671399",
    "end": "674800"
  },
  {
    "text": "that it's not part of the of the regular",
    "start": "674800",
    "end": "676720"
  },
  {
    "text": "API server pool uh to U make sure that",
    "start": "676720",
    "end": "679760"
  },
  {
    "text": "the the only client is our migration",
    "start": "679760",
    "end": "681360"
  },
  {
    "text": "tool and the migration tool will Loop uh",
    "start": "681360",
    "end": "684360"
  },
  {
    "text": "through loop on all the inry volumes uh",
    "start": "684360",
    "end": "687320"
  },
  {
    "text": "translate them into CSI ones",
    "start": "687320",
    "end": "689839"
  },
  {
    "text": "and then proc the changes and now you",
    "start": "689839",
    "end": "691839"
  },
  {
    "text": "can tear down everything and the",
    "start": "691839",
    "end": "694079"
  },
  {
    "text": "migration is done well uh not so fast uh",
    "start": "694079",
    "end": "698120"
  },
  {
    "text": "we wanted to use a new snapshot feature",
    "start": "698120",
    "end": "700360"
  },
  {
    "text": "then uh but it was still failing on gcp",
    "start": "700360",
    "end": "703560"
  },
  {
    "text": "but",
    "start": "703560",
    "end": "705519"
  },
  {
    "text": "why uh when we had a closer look uh at",
    "start": "705519",
    "end": "709240"
  },
  {
    "text": "uh the results of R station uh you can",
    "start": "709240",
    "end": "711839"
  },
  {
    "text": "see that there was a small difference uh",
    "start": "711839",
    "end": "714360"
  },
  {
    "text": "in the volume handle uh instead of",
    "start": "714360",
    "end": "716560"
  },
  {
    "text": "having the correct project we had an",
    "start": "716560",
    "end": "718200"
  },
  {
    "text": "unspecified like basically a placeholder",
    "start": "718200",
    "end": "721000"
  },
  {
    "text": "and uh so it was making the the volume",
    "start": "721000",
    "end": "722959"
  },
  {
    "text": "handle invalid and uh it was preventing",
    "start": "722959",
    "end": "725399"
  },
  {
    "text": "any operation to be successful uh",
    "start": "725399",
    "end": "728920"
  },
  {
    "text": "including the snapshot ones so we were",
    "start": "728920",
    "end": "730760"
  },
  {
    "text": "kind of back to square",
    "start": "730760",
    "end": "732560"
  },
  {
    "text": "one so looking uh at the entry plug-in",
    "start": "732560",
    "end": "736639"
  },
  {
    "text": "interface in the translation lib uh we",
    "start": "736639",
    "end": "739440"
  },
  {
    "text": "saw this uh this method called repair",
    "start": "739440",
    "end": "741760"
  },
  {
    "text": "volume handle uh it was only implemented",
    "start": "741760",
    "end": "744199"
  },
  {
    "text": "for GC persisten so didn't look very uh",
    "start": "744199",
    "end": "747079"
  },
  {
    "text": "nice but uh we had broken a volume mle",
    "start": "747079",
    "end": "749519"
  },
  {
    "text": "so why not repair it so we added this",
    "start": "749519",
    "end": "752160"
  },
  {
    "text": "step in a modify script and uh wrun it",
    "start": "752160",
    "end": "755079"
  },
  {
    "text": "on an experiment cluster and then boom",
    "start": "755079",
    "end": "758040"
  },
  {
    "text": "uh we got an avalanche of detach events",
    "start": "758040",
    "end": "760839"
  },
  {
    "text": "uh while the pods were running so it was",
    "start": "760839",
    "end": "762639"
  },
  {
    "text": "a catastrophe like all the pods couldn't",
    "start": "762639",
    "end": "764800"
  },
  {
    "text": "access their dis anymore so turned out",
    "start": "764800",
    "end": "767040"
  },
  {
    "text": "there was a small side effect calling",
    "start": "767040",
    "end": "768560"
  },
  {
    "text": "that method so uh if you look at uh the",
    "start": "768560",
    "end": "772199"
  },
  {
    "text": "volumes uh we had attached now uh to a",
    "start": "772199",
    "end": "775040"
  },
  {
    "text": "node we had actually duplicates uh there",
    "start": "775040",
    "end": "777639"
  },
  {
    "text": "was the unspecified one and the one with",
    "start": "777639",
    "end": "779720"
  },
  {
    "text": "a correct project so it had two",
    "start": "779720",
    "end": "782079"
  },
  {
    "text": "consequences uh when a pod was",
    "start": "782079",
    "end": "783800"
  },
  {
    "text": "rescheduled uh and mounting the volume",
    "start": "783800",
    "end": "786160"
  },
  {
    "text": "twice was causing errors and the the P",
    "start": "786160",
    "end": "788279"
  },
  {
    "text": "was stuck inter terminating and on a",
    "start": "788279",
    "end": "790760"
  },
  {
    "text": "kubernetes control manager restart uh",
    "start": "790760",
    "end": "793600"
  },
  {
    "text": "while trying to reconciliate the states",
    "start": "793600",
    "end": "796399"
  },
  {
    "text": "uh it was detaching all the",
    "start": "796399",
    "end": "799880"
  },
  {
    "text": "volumes so we have the repair volume",
    "start": "801199",
    "end": "804480"
  },
  {
    "text": "handle fixed that allow us to create",
    "start": "804480",
    "end": "807839"
  },
  {
    "text": "snapshots how however it doesn't work as",
    "start": "807839",
    "end": "810519"
  },
  {
    "text": "we expect uh so let's embark on a New",
    "start": "810519",
    "end": "813839"
  },
  {
    "text": "Journey to fix the",
    "start": "813839",
    "end": "815560"
  },
  {
    "text": "fix so first let me get back to how CSI",
    "start": "815560",
    "end": "818760"
  },
  {
    "text": "Works um well I lied earlier it's just a",
    "start": "818760",
    "end": "822760"
  },
  {
    "text": "bit more complicated than what I",
    "start": "822760",
    "end": "824199"
  },
  {
    "text": "explained here so let me get back to",
    "start": "824199",
    "end": "826639"
  },
  {
    "text": "square one um we have the cont manager",
    "start": "826639",
    "end": "830000"
  },
  {
    "text": "inside the the cluster that will create",
    "start": "830000",
    "end": "832360"
  },
  {
    "text": "a pod and a PVC in",
    "start": "832360",
    "end": "835120"
  },
  {
    "text": "itcd once it's created there is a CSI",
    "start": "835120",
    "end": "838240"
  },
  {
    "text": "component called CSI provisioner that",
    "start": "838240",
    "end": "840600"
  },
  {
    "text": "watches for those PVCs and what once it",
    "start": "840600",
    "end": "843160"
  },
  {
    "text": "notices one it will call the CSI driver",
    "start": "843160",
    "end": "846560"
  },
  {
    "text": "which in turn will call the cloud",
    "start": "846560",
    "end": "849040"
  },
  {
    "text": "provider to create uh a volume inside",
    "start": "849040",
    "end": "852600"
  },
  {
    "text": "the cloud",
    "start": "852600",
    "end": "853839"
  },
  {
    "text": "provider once the volume is created the",
    "start": "853839",
    "end": "856320"
  },
  {
    "text": "C CSI provisioner will create the CSI PV",
    "start": "856320",
    "end": "859440"
  },
  {
    "text": "inside H CD and we link it to the cloud",
    "start": "859440",
    "end": "862120"
  },
  {
    "text": "provider",
    "start": "862120",
    "end": "863880"
  },
  {
    "text": "volume then the Pod can get scheduled on",
    "start": "863880",
    "end": "866600"
  },
  {
    "text": "a node by the scheduler and on the Node",
    "start": "866600",
    "end": "870160"
  },
  {
    "text": "where the Pod is scheduled there is a",
    "start": "870160",
    "end": "871959"
  },
  {
    "text": "cuet that know that there is a pod that",
    "start": "871959",
    "end": "875519"
  },
  {
    "text": "needs to be here and we since the Pod",
    "start": "875519",
    "end": "878199"
  },
  {
    "text": "need access to a volume the cuet will",
    "start": "878199",
    "end": "881240"
  },
  {
    "text": "create a volume attachment object inside",
    "start": "881240",
    "end": "883600"
  },
  {
    "text": "LCD this volume attachment is just a way",
    "start": "883600",
    "end": "886560"
  },
  {
    "text": "for the cuade to ask for one volume to",
    "start": "886560",
    "end": "889199"
  },
  {
    "text": "be attached to one particular",
    "start": "889199",
    "end": "891199"
  },
  {
    "text": "node and there is another CSI component",
    "start": "891199",
    "end": "894040"
  },
  {
    "text": "called the CSI attacher that watches for",
    "start": "894040",
    "end": "896279"
  },
  {
    "text": "those those volume attachments objects",
    "start": "896279",
    "end": "899160"
  },
  {
    "text": "and on once it notices one it call the",
    "start": "899160",
    "end": "901440"
  },
  {
    "text": "CI driver which call the cloud provider",
    "start": "901440",
    "end": "904160"
  },
  {
    "text": "to attach the volume to the",
    "start": "904160",
    "end": "906880"
  },
  {
    "text": "node when the volume is there the cubet",
    "start": "906880",
    "end": "909560"
  },
  {
    "text": "creates a pod and calls the CSI node",
    "start": "909560",
    "end": "912880"
  },
  {
    "text": "component present on every node to mount",
    "start": "912880",
    "end": "916800"
  },
  {
    "text": "the volume inside the Pod and there we",
    "start": "916800",
    "end": "919959"
  },
  {
    "text": "have it like a more comp compete",
    "start": "919959",
    "end": "923079"
  },
  {
    "text": "complete working of",
    "start": "923079",
    "end": "925079"
  },
  {
    "text": "CSI but what is the role of the",
    "start": "925079",
    "end": "928440"
  },
  {
    "text": "unspecific side that we saw earlier in",
    "start": "928440",
    "end": "930560"
  },
  {
    "text": "all this walking well uh when a PV gets",
    "start": "930560",
    "end": "935759"
  },
  {
    "text": "processed by some of the components in",
    "start": "935759",
    "end": "938839"
  },
  {
    "text": "the cluster namely the cuade or",
    "start": "938839",
    "end": "940720"
  },
  {
    "text": "controller manager the those components",
    "start": "940720",
    "end": "943759"
  },
  {
    "text": "have an a local cach where they store",
    "start": "943759",
    "end": "946680"
  },
  {
    "text": "like the the state of the cluster and",
    "start": "946680",
    "end": "949639"
  },
  {
    "text": "the key they use to store the volumes",
    "start": "949639",
    "end": "952319"
  },
  {
    "text": "inside the the the",
    "start": "952319",
    "end": "954079"
  },
  {
    "text": "cluster is called the unique volume name",
    "start": "954079",
    "end": "957079"
  },
  {
    "text": "and it's it is just a cation of the",
    "start": "957079",
    "end": "959959"
  },
  {
    "text": "driver name and the volume handle",
    "start": "959959",
    "end": "962880"
  },
  {
    "text": "name so in a CSI PV we have a CSI driver",
    "start": "962880",
    "end": "969279"
  },
  {
    "text": "with CSI volume handle and so it gets",
    "start": "969279",
    "end": "972600"
  },
  {
    "text": "stored inside the cache everything is",
    "start": "972600",
    "end": "975319"
  },
  {
    "text": "fine but then we have an entry PV an",
    "start": "975319",
    "end": "978480"
  },
  {
    "text": "inry PV does not have uh a driver or a",
    "start": "978480",
    "end": "981440"
  },
  {
    "text": "volume handle in their spec so the cuet",
    "start": "981440",
    "end": "985600"
  },
  {
    "text": "and controller manager need to call the",
    "start": "985600",
    "end": "988440"
  },
  {
    "text": "same C transl translation lib that we",
    "start": "988440",
    "end": "990759"
  },
  {
    "text": "used to translate in memory the spec",
    "start": "990759",
    "end": "995480"
  },
  {
    "text": "from entry to CSI but they don't use the",
    "start": "995480",
    "end": "998240"
  },
  {
    "text": "repair volume handle that we",
    "start": "998240",
    "end": "1000199"
  },
  {
    "text": "did in that case we store the in the",
    "start": "1000199",
    "end": "1004639"
  },
  {
    "text": "cache with the",
    "start": "1004639",
    "end": "1007199"
  },
  {
    "text": "unspecified and when we run our own",
    "start": "1007199",
    "end": "1010319"
  },
  {
    "text": "migration script so we we change the",
    "start": "1010319",
    "end": "1012959"
  },
  {
    "text": "inry PV to be CSI we now have a proper",
    "start": "1012959",
    "end": "1016600"
  },
  {
    "text": "CSI spec and it means that we have",
    "start": "1016600",
    "end": "1019839"
  },
  {
    "text": "another volumes that appear inside the",
    "start": "1019839",
    "end": "1021680"
  },
  {
    "text": "cache because the key is different so",
    "start": "1021680",
    "end": "1024918"
  },
  {
    "text": "from the point of view of the cubet and",
    "start": "1024919",
    "end": "1026640"
  },
  {
    "text": "every and the other component we have",
    "start": "1026640",
    "end": "1029319"
  },
  {
    "text": "two unique volumes which are actually",
    "start": "1029319",
    "end": "1032360"
  },
  {
    "text": "the same PV behind the scene and this is",
    "start": "1032360",
    "end": "1036280"
  },
  {
    "text": "our",
    "start": "1036280",
    "end": "1037760"
  },
  {
    "text": "issue so do we have a solution for this",
    "start": "1037760",
    "end": "1040760"
  },
  {
    "text": "uh well we thought maybe we could try to",
    "start": "1040760",
    "end": "1042880"
  },
  {
    "text": "hack some stuff somewhere and fix it so",
    "start": "1042880",
    "end": "1047280"
  },
  {
    "text": "if we take a look at the all the compon",
    "start": "1047280",
    "end": "1048880"
  },
  {
    "text": "compents present inside the workings of",
    "start": "1048880",
    "end": "1051799"
  },
  {
    "text": "the SI and get rid of all the components",
    "start": "1051799",
    "end": "1054760"
  },
  {
    "text": "that don't we don't really care about",
    "start": "1054760",
    "end": "1057280"
  },
  {
    "text": "right now or we cannot act on well we",
    "start": "1057280",
    "end": "1060600"
  },
  {
    "text": "are left with the three CSI components",
    "start": "1060600",
    "end": "1063679"
  },
  {
    "text": "as well as the cuet and controller",
    "start": "1063679",
    "end": "1066320"
  },
  {
    "text": "manager ideally we'd like to avoid",
    "start": "1066320",
    "end": "1068960"
  },
  {
    "text": "patching uh the cuet and controller",
    "start": "1068960",
    "end": "1071200"
  },
  {
    "text": "manager because it will take a long time",
    "start": "1071200",
    "end": "1074000"
  },
  {
    "text": "to roll out remember we have like",
    "start": "1074000",
    "end": "1076000"
  },
  {
    "text": "hundreds of thousands of nodes we have",
    "start": "1076000",
    "end": "1078960"
  },
  {
    "text": "multiple versions of kubernetes in our",
    "start": "1078960",
    "end": "1080440"
  },
  {
    "text": "cluster so we would need to backport the",
    "start": "1080440",
    "end": "1083480"
  },
  {
    "text": "fix in every",
    "start": "1083480",
    "end": "1085120"
  },
  {
    "text": "version and we had already patched the",
    "start": "1085120",
    "end": "1088240"
  },
  {
    "text": "API server so we were like okay maybe if",
    "start": "1088240",
    "end": "1091559"
  },
  {
    "text": "we can try to avoid patching another",
    "start": "1091559",
    "end": "1093880"
  },
  {
    "text": "kubernetes scoree component just to",
    "start": "1093880",
    "end": "1096120"
  },
  {
    "text": "avoid some unintended side effects could",
    "start": "1096120",
    "end": "1098880"
  },
  {
    "text": "be a good",
    "start": "1098880",
    "end": "1100000"
  },
  {
    "text": "idea so we embarked on trying to patch",
    "start": "1100000",
    "end": "1104200"
  },
  {
    "text": "the CSI",
    "start": "1104200",
    "end": "1105440"
  },
  {
    "text": "components and it didn't work and",
    "start": "1105440",
    "end": "1109159"
  },
  {
    "text": "fortunately but why well uh we took a a",
    "start": "1109159",
    "end": "1113400"
  },
  {
    "text": "deeper dive into how uh a volume is",
    "start": "1113400",
    "end": "1117720"
  },
  {
    "text": "managed on a node by the cubet when",
    "start": "1117720",
    "end": "1119840"
  },
  {
    "text": "there is a pod that that need one and",
    "start": "1119840",
    "end": "1122280"
  },
  {
    "text": "I'm not going to go too in depth here",
    "start": "1122280",
    "end": "1124559"
  },
  {
    "text": "because uh it will take a long time but",
    "start": "1124559",
    "end": "1127919"
  },
  {
    "text": "what is important is this part it's like",
    "start": "1127919",
    "end": "1131240"
  },
  {
    "text": "what happens when a PO gets terminated",
    "start": "1131240",
    "end": "1134080"
  },
  {
    "text": "and what does the the cubet do to get",
    "start": "1134080",
    "end": "1136640"
  },
  {
    "text": "rid of the volumes and this part is done",
    "start": "1136640",
    "end": "1139679"
  },
  {
    "text": "once for every volume present inside the",
    "start": "1139679",
    "end": "1142480"
  },
  {
    "text": "cache of the",
    "start": "1142480",
    "end": "1143720"
  },
  {
    "text": "cubet so in our situation we have two",
    "start": "1143720",
    "end": "1147080"
  },
  {
    "text": "volumes in the cache and we have this",
    "start": "1147080",
    "end": "1149679"
  },
  {
    "text": "host file system on the on the host and",
    "start": "1149679",
    "end": "1153720"
  },
  {
    "text": "so the the cubet will try to read the",
    "start": "1153720",
    "end": "1156240"
  },
  {
    "text": "Pod volume data file to get rid of the",
    "start": "1156240",
    "end": "1157960"
  },
  {
    "text": "first volume which is called The Vault",
    "start": "1157960",
    "end": "1160240"
  },
  {
    "text": "data. Json and it's just like some",
    "start": "1160240",
    "end": "1162440"
  },
  {
    "text": "metadata on the",
    "start": "1162440",
    "end": "1164400"
  },
  {
    "text": "volume then the not plugin will ad Mount",
    "start": "1164400",
    "end": "1169000"
  },
  {
    "text": "the volume removing the volume content",
    "start": "1169000",
    "end": "1171200"
  },
  {
    "text": "do some basic cleanup on the mount",
    "start": "1171200",
    "end": "1174880"
  },
  {
    "text": "directory and finally the CET can get",
    "start": "1174880",
    "end": "1177960"
  },
  {
    "text": "rid of the Vault data. Json and the",
    "start": "1177960",
    "end": "1180280"
  },
  {
    "text": "volume",
    "start": "1180280",
    "end": "1181480"
  },
  {
    "text": "directory and we can get rid of one of",
    "start": "1181480",
    "end": "1183480"
  },
  {
    "text": "the volume in the cache nice but then we",
    "start": "1183480",
    "end": "1186840"
  },
  {
    "text": "move on to the second volume and try to",
    "start": "1186840",
    "end": "1189360"
  },
  {
    "text": "read the Pod volume data file which does",
    "start": "1189360",
    "end": "1192159"
  },
  {
    "text": "not exist anymore so at this point the",
    "start": "1192159",
    "end": "1195200"
  },
  {
    "text": "cube goes into like an infinite error",
    "start": "1195200",
    "end": "1197799"
  },
  {
    "text": "Loop trying read the file but it cannot",
    "start": "1197799",
    "end": "1201000"
  },
  {
    "text": "and the Pod gets stuck in",
    "start": "1201000",
    "end": "1204320"
  },
  {
    "text": "terminating so at this point we were",
    "start": "1204440",
    "end": "1206400"
  },
  {
    "text": "kind of stuck because we don't want to",
    "start": "1206400",
    "end": "1208919"
  },
  {
    "text": "patch the Q in control manager or we'",
    "start": "1208919",
    "end": "1211400"
  },
  {
    "text": "like to try and avoid it and the other",
    "start": "1211400",
    "end": "1214600"
  },
  {
    "text": "components patching the other components",
    "start": "1214600",
    "end": "1216840"
  },
  {
    "text": "don't doesn't work because they don't",
    "start": "1216840",
    "end": "1219240"
  },
  {
    "text": "act at the right moment in the C stack",
    "start": "1219240",
    "end": "1221240"
  },
  {
    "text": "when trying to unmount a",
    "start": "1221240",
    "end": "1223559"
  },
  {
    "text": "volume so at this point we were like",
    "start": "1223559",
    "end": "1226240"
  },
  {
    "text": "okay maybe we could ask some folks at",
    "start": "1226240",
    "end": "1228240"
  },
  {
    "text": "gcp because you know it's a gcp only",
    "start": "1228240",
    "end": "1231080"
  },
  {
    "text": "issue maybe they have an idea on how we",
    "start": "1231080",
    "end": "1233679"
  },
  {
    "text": "can fix it",
    "start": "1233679",
    "end": "1235760"
  },
  {
    "text": "easily Unfortunately they had the same",
    "start": "1235760",
    "end": "1238320"
  },
  {
    "text": "issue as us so they we like Ah that's",
    "start": "1238320",
    "end": "1242000"
  },
  {
    "text": "annoying but one interesting thing that",
    "start": "1242000",
    "end": "1245240"
  },
  {
    "text": "came out of the meetings with gcp is",
    "start": "1245240",
    "end": "1247720"
  },
  {
    "text": "that maybe maybe we can do something if",
    "start": "1247720",
    "end": "1251400"
  },
  {
    "text": "we migrate the volume while the pods are",
    "start": "1251400",
    "end": "1253840"
  },
  {
    "text": "not present on",
    "start": "1253840",
    "end": "1255200"
  },
  {
    "text": "nodes",
    "start": "1255200",
    "end": "1256799"
  },
  {
    "text": "because if we are not on node it means",
    "start": "1256799",
    "end": "1259559"
  },
  {
    "text": "that the cuet cache does not matter",
    "start": "1259559",
    "end": "1261200"
  },
  {
    "text": "anymore because well no node no",
    "start": "1261200",
    "end": "1264640"
  },
  {
    "text": "cuet and the controller manager cache is",
    "start": "1264640",
    "end": "1267120"
  },
  {
    "text": "not an issue because the our issue with",
    "start": "1267120",
    "end": "1270400"
  },
  {
    "text": "the controller manager was that it was",
    "start": "1270400",
    "end": "1271919"
  },
  {
    "text": "trying to detach volume from nodes where",
    "start": "1271919",
    "end": "1273760"
  },
  {
    "text": "the Pod were running on them so if we're",
    "start": "1273760",
    "end": "1276200"
  },
  {
    "text": "not on a no anymore it does not",
    "start": "1276200",
    "end": "1278720"
  },
  {
    "text": "matter but then how we can we not have",
    "start": "1278720",
    "end": "1281880"
  },
  {
    "text": "pods present on nodes Well turns out it",
    "start": "1281880",
    "end": "1284520"
  },
  {
    "text": "happens naturally when we roll out a pod",
    "start": "1284520",
    "end": "1287960"
  },
  {
    "text": "and it's fairly easy to catch this",
    "start": "1287960",
    "end": "1289720"
  },
  {
    "text": "situation using an admission",
    "start": "1289720",
    "end": "1292679"
  },
  {
    "text": "webook so we came up with this solution",
    "start": "1292679",
    "end": "1296000"
  },
  {
    "text": "where we have um a usual working of our",
    "start": "1296000",
    "end": "1299600"
  },
  {
    "text": "cluster with an API server and",
    "start": "1299600",
    "end": "1301240"
  },
  {
    "text": "everything and we deploy in this cluster",
    "start": "1301240",
    "end": "1304039"
  },
  {
    "text": "an admission web hook with the patched",
    "start": "1304039",
    "end": "1306559"
  },
  {
    "text": "API server the admission web hook will",
    "start": "1306559",
    "end": "1311120"
  },
  {
    "text": "watch for p creation events which",
    "start": "1311120",
    "end": "1313360"
  },
  {
    "text": "happens when we start a roll out then we",
    "start": "1313360",
    "end": "1317279"
  },
  {
    "text": "uh roll out a a p using like a stateful",
    "start": "1317279",
    "end": "1320520"
  },
  {
    "text": "set or",
    "start": "1320520",
    "end": "1322080"
  },
  {
    "text": "deployment and it's important here to",
    "start": "1322080",
    "end": "1325400"
  },
  {
    "text": "deny the recreation of the Pod while the",
    "start": "1325400",
    "end": "1329679"
  },
  {
    "text": "volume is still present on the Node",
    "start": "1329679",
    "end": "1332480"
  },
  {
    "text": "otherwise you could have like some kind",
    "start": "1332480",
    "end": "1333919"
  },
  {
    "text": "of race condition where the Pod gets",
    "start": "1333919",
    "end": "1336279"
  },
  {
    "text": "recreated gets rescheduled on the same",
    "start": "1336279",
    "end": "1338520"
  },
  {
    "text": "node and then you have a race condition",
    "start": "1338520",
    "end": "1340320"
  },
  {
    "text": "with the cuate trying to detach the",
    "start": "1340320",
    "end": "1341840"
  },
  {
    "text": "volume from the previous pod and trying",
    "start": "1341840",
    "end": "1343919"
  },
  {
    "text": "to reattach the volume of the new pod",
    "start": "1343919",
    "end": "1346440"
  },
  {
    "text": "and it breaks",
    "start": "1346440",
    "end": "1349880"
  },
  {
    "text": "so then you wait for the CSI components",
    "start": "1349880",
    "end": "1352080"
  },
  {
    "text": "to get rid of the",
    "start": "1352080",
    "end": "1353960"
  },
  {
    "text": "volume and once it's done the control",
    "start": "1353960",
    "end": "1356919"
  },
  {
    "text": "manager can recreate the Pod it go",
    "start": "1356919",
    "end": "1359880"
  },
  {
    "text": "through the admission web hook where we",
    "start": "1359880",
    "end": "1361960"
  },
  {
    "text": "call our patch API server to migrate in",
    "start": "1361960",
    "end": "1365480"
  },
  {
    "text": "place the entry PV to",
    "start": "1365480",
    "end": "1369000"
  },
  {
    "text": "CSI and then the Pod get gets recreated",
    "start": "1369000",
    "end": "1372720"
  },
  {
    "text": "and scheduled on the Node with its",
    "start": "1372720",
    "end": "1374320"
  },
  {
    "text": "volume and everything is fine our",
    "start": "1374320",
    "end": "1376279"
  },
  {
    "text": "migration is",
    "start": "1376279",
    "end": "1377440"
  },
  {
    "text": "done",
    "start": "1377440",
    "end": "1380440"
  },
  {
    "text": "so yeah to put in nure so we went from",
    "start": "1380480",
    "end": "1383080"
  },
  {
    "text": "uh uh starting with having no CSI",
    "start": "1383080",
    "end": "1385720"
  },
  {
    "text": "support at all so we uh deployed all the",
    "start": "1385720",
    "end": "1388039"
  },
  {
    "text": "various CSI drivers and then we went",
    "start": "1388039",
    "end": "1390080"
  },
  {
    "text": "through this official CSI migration uh",
    "start": "1390080",
    "end": "1393039"
  },
  {
    "text": "quickly realizing that it was not going",
    "start": "1393039",
    "end": "1394799"
  },
  {
    "text": "to do it for us so we evaluated",
    "start": "1394799",
    "end": "1397279"
  },
  {
    "text": "different solutions and uh eventually",
    "start": "1397279",
    "end": "1399720"
  },
  {
    "text": "came up with this uh this",
    "start": "1399720",
    "end": "1401520"
  },
  {
    "text": "migration along the way we had to work",
    "start": "1401520",
    "end": "1403600"
  },
  {
    "text": "around a couple of issues and uh so in",
    "start": "1403600",
    "end": "1406559"
  },
  {
    "text": "the end our custom migration process",
    "start": "1406559",
    "end": "1409279"
  },
  {
    "text": "took us 6 months and it didn't cause any",
    "start": "1409279",
    "end": "1411600"
  },
  {
    "text": "incidents so if you need to to go down",
    "start": "1411600",
    "end": "1413960"
  },
  {
    "text": "that road uh or just curious uh we made",
    "start": "1413960",
    "end": "1416480"
  },
  {
    "text": "the the code available on GitHub so what",
    "start": "1416480",
    "end": "1418880"
  },
  {
    "text": "did we learn uh it's okay sometimes to",
    "start": "1418880",
    "end": "1421600"
  },
  {
    "text": "take an orthodox path as long as you",
    "start": "1421600",
    "end": "1424080"
  },
  {
    "text": "make sure you mitigate the risk as much",
    "start": "1424080",
    "end": "1425919"
  },
  {
    "text": "as you can and also make sure you",
    "start": "1425919",
    "end": "1427960"
  },
  {
    "text": "discuss with your team and uh everyone",
    "start": "1427960",
    "end": "1430080"
  },
  {
    "text": "is on board uh you don't want people to",
    "start": "1430080",
    "end": "1432400"
  },
  {
    "text": "uh learn about your Innovative approach",
    "start": "1432400",
    "end": "1435039"
  },
  {
    "text": "during an outage that was caused by it",
    "start": "1435039",
    "end": "1437840"
  },
  {
    "text": "uh also uh the more you go down on the",
    "start": "1437840",
    "end": "1440400"
  },
  {
    "text": "stack uh the more you're going to have",
    "start": "1440400",
    "end": "1442200"
  },
  {
    "text": "to deal with some cloud provider",
    "start": "1442200",
    "end": "1444080"
  },
  {
    "text": "specifics or implementation details the",
    "start": "1444080",
    "end": "1446120"
  },
  {
    "text": "repair volume endal is a a pretty good",
    "start": "1446120",
    "end": "1448200"
  },
  {
    "text": "example of this and also there is a lot",
    "start": "1448200",
    "end": "1450679"
  },
  {
    "text": "of value uh in talking to other people",
    "start": "1450679",
    "end": "1452840"
  },
  {
    "text": "in the community uh when we started this",
    "start": "1452840",
    "end": "1455400"
  },
  {
    "text": "uh we saw that maybe we're the only",
    "start": "1455400",
    "end": "1456799"
  },
  {
    "text": "fools trying to to do that and talking",
    "start": "1456799",
    "end": "1459480"
  },
  {
    "text": "to Folks at Google we realized they had",
    "start": "1459480",
    "end": "1461679"
  },
  {
    "text": "same kind of issues and by presenting uh",
    "start": "1461679",
    "end": "1465279"
  },
  {
    "text": "our problem it was a a good way to take",
    "start": "1465279",
    "end": "1467960"
  },
  {
    "text": "a few step step backs and uh it led us",
    "start": "1467960",
    "end": "1470120"
  },
  {
    "text": "to find a working",
    "start": "1470120",
    "end": "1472960"
  },
  {
    "text": "solution uh thank you for your attention",
    "start": "1472960",
    "end": "1475799"
  },
  {
    "text": "uh if you have uh any feedback or",
    "start": "1475799",
    "end": "1478720"
  },
  {
    "text": "question no is the",
    "start": "1478720",
    "end": "1481559"
  },
  {
    "text": "[Applause]",
    "start": "1482800",
    "end": "1492160"
  },
  {
    "text": "time",
    "start": "1497320",
    "end": "1500000"
  },
  {
    "text": "thank you for the presentation I think",
    "start": "1500000",
    "end": "1501799"
  },
  {
    "text": "this is like hackery at its",
    "start": "1501799",
    "end": "1504240"
  },
  {
    "text": "finest uh so would you think like this",
    "start": "1504240",
    "end": "1507000"
  },
  {
    "text": "would be easier for example in the with",
    "start": "1507000",
    "end": "1509600"
  },
  {
    "text": "the AWS and EBS in general because I",
    "start": "1509600",
    "end": "1512159"
  },
  {
    "text": "think you can like",
    "start": "1512159",
    "end": "1514399"
  },
  {
    "text": "create uh CSI",
    "start": "1514399",
    "end": "1517039"
  },
  {
    "text": "volume but from the snapshots so from",
    "start": "1517039",
    "end": "1520159"
  },
  {
    "text": "the actual like snapshot in the cloud",
    "start": "1520159",
    "end": "1523120"
  },
  {
    "text": "provider and would it be like an easier",
    "start": "1523120",
    "end": "1526000"
  },
  {
    "text": "approach to just like have like",
    "start": "1526000",
    "end": "1529520"
  },
  {
    "text": "unmount the poort like have like u a new",
    "start": "1529520",
    "end": "1533320"
  },
  {
    "text": "well not not not even unmount but",
    "start": "1533320",
    "end": "1534960"
  },
  {
    "text": "basically create from create a new",
    "start": "1534960",
    "end": "1538080"
  },
  {
    "text": "volume from the snapshot but it's going",
    "start": "1538080",
    "end": "1540720"
  },
  {
    "text": "to be like a native CSI CSI volume yeah",
    "start": "1540720",
    "end": "1543399"
  },
  {
    "text": "I think it's the recommended way of",
    "start": "1543399",
    "end": "1544840"
  },
  {
    "text": "doing it but uh Aros scale is just not",
    "start": "1544840",
    "end": "1547120"
  },
  {
    "text": "possible I mean uh if you do that you",
    "start": "1547120",
    "end": "1549720"
  },
  {
    "text": "have to involve the the application",
    "start": "1549720",
    "end": "1551200"
  },
  {
    "text": "teams and they have to do the the",
    "start": "1551200",
    "end": "1553200"
  },
  {
    "text": "process or you have to do do it for them",
    "start": "1553200",
    "end": "1555080"
  },
  {
    "text": "but I mean it's going to uh you're going",
    "start": "1555080",
    "end": "1558559"
  },
  {
    "text": "to have to have some kind of uh yeah",
    "start": "1558559",
    "end": "1561399"
  },
  {
    "text": "meeting with them and uh coordination",
    "start": "1561399",
    "end": "1564279"
  },
  {
    "text": "and uh and in the end we just want to",
    "start": "1564279",
    "end": "1567000"
  },
  {
    "text": "change some metadata I mean there is no",
    "start": "1567000",
    "end": "1569320"
  },
  {
    "text": "no real reason to uh snapshot the data",
    "start": "1569320",
    "end": "1572039"
  },
  {
    "text": "to put the same data uh in another",
    "start": "1572039",
    "end": "1574120"
  },
  {
    "text": "object uh yeah okay thank",
    "start": "1574120",
    "end": "1579600"
  },
  {
    "text": "you thank you for the",
    "start": "1584000",
    "end": "1586919"
  },
  {
    "text": "presentation uh I have one question uh",
    "start": "1586919",
    "end": "1589640"
  },
  {
    "text": "regarding the process that you went",
    "start": "1589640",
    "end": "1591440"
  },
  {
    "text": "through so did you like uh what",
    "start": "1591440",
    "end": "1595080"
  },
  {
    "text": "guarantee that you have like resolved",
    "start": "1595080",
    "end": "1597559"
  },
  {
    "text": "all the issues what the process that you",
    "start": "1597559",
    "end": "1600600"
  },
  {
    "text": "went through uh for the",
    "start": "1600600",
    "end": "1602880"
  },
  {
    "text": "testing um that's",
    "start": "1602880",
    "end": "1607279"
  },
  {
    "text": "it well so um honestly it was fairly",
    "start": "1608720",
    "end": "1613640"
  },
  {
    "text": "manual process for us because we well",
    "start": "1613640",
    "end": "1618520"
  },
  {
    "text": "what we did test was like trying to",
    "start": "1618520",
    "end": "1621240"
  },
  {
    "text": "migrate a few volumes in experimental",
    "start": "1621240",
    "end": "1623000"
  },
  {
    "text": "clusters trying to check that the",
    "start": "1623000",
    "end": "1624840"
  },
  {
    "text": "features were were working and obviously",
    "start": "1624840",
    "end": "1627480"
  },
  {
    "text": "that the after weeks there was no there",
    "start": "1627480",
    "end": "1631559"
  },
  {
    "text": "was no issue with the volume and that's",
    "start": "1631559",
    "end": "1634039"
  },
  {
    "text": "how we notic is the Avalanche of detach",
    "start": "1634039",
    "end": "1636840"
  },
  {
    "text": "events that we had uh so we are not sure",
    "start": "1636840",
    "end": "1640600"
  },
  {
    "text": "that it will never be any issue but like",
    "start": "1640600",
    "end": "1643600"
  },
  {
    "text": "now the migration has been done",
    "start": "1643600",
    "end": "1645720"
  },
  {
    "text": "for 4 months in our",
    "start": "1645720",
    "end": "1648720"
  },
  {
    "text": "and in our production clusters and we",
    "start": "1648720",
    "end": "1650480"
  },
  {
    "text": "did not see anything so we are fairly",
    "start": "1650480",
    "end": "1653320"
  },
  {
    "text": "confident that it's okay right",
    "start": "1653320",
    "end": "1656919"
  },
  {
    "text": "now",
    "start": "1661960",
    "end": "1664960"
  }
]