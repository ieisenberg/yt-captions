[
  {
    "text": "my name is Rob Scott I work at Google I've been working on kubernetes networking for a little over five years",
    "start": "399",
    "end": "8440"
  },
  {
    "text": "uh most recently I've been doing a lot of Gateway API things and so I'll be using some Gateway API examples in here",
    "start": "8440",
    "end": "15160"
  },
  {
    "text": "um but really before I worked uh on kubernetes I spent a lot of time as an",
    "start": "15160",
    "end": "21279"
  },
  {
    "text": "end user of kubernetes actually trying to run the thing and so I'm very familiar with some of the painful things",
    "start": "21279",
    "end": "27119"
  },
  {
    "text": "that can happen when things don't go quite as expect and so today I'm going to be talking about how you can upgrade",
    "start": "27119",
    "end": "33640"
  },
  {
    "text": "safely and avoid the many pitfalls of kubernetes versioning and maybe hopefully also understand what's",
    "start": "33640",
    "end": "40079"
  },
  {
    "text": "happening behind the scenes because there's a lot of confusing terms in",
    "start": "40079",
    "end": "45200"
  },
  {
    "text": "kubernetes versioning so to start off how many people here have been burned by some",
    "start": "45200",
    "end": "51520"
  },
  {
    "text": "kind of kubernetes upgrade gone wrong okay I definitely myself and it seems",
    "start": "51520",
    "end": "56879"
  },
  {
    "text": "like most of you I'm hoping this talk will help many of us avoid future pain",
    "start": "56879",
    "end": "63399"
  },
  {
    "text": "that's the goal hopefully we can we can get there and to do that I want to walk through three distinct painful upgrades",
    "start": "63399",
    "end": "70759"
  },
  {
    "text": "and I'm going to focus on painful upgrades that I'm at least partially responsible for myself so I'm going to",
    "start": "70759",
    "end": "76240"
  },
  {
    "text": "be making fun of myself here a lot uh but we're going to start with Ingress API so how many people here were around",
    "start": "76240",
    "end": "85320"
  },
  {
    "text": "for kubernetes 122 okay that's great that's great if you are around for kubernetes 122 this",
    "start": "85320",
    "end": "92759"
  },
  {
    "text": "story may sound familiar to you I hope it doesn't but we'll just say so you upgrade your kubernetes cluster to 122",
    "start": "92759",
    "end": "100799"
  },
  {
    "text": "you're feeling good you finally got your upgrade process down you're feeling confident about how you can do kubernetes upgrades and then your pager",
    "start": "100799",
    "end": "108240"
  },
  {
    "text": "starts going off prod is down your boss is calling everything is not going right",
    "start": "108240",
    "end": "114719"
  },
  {
    "text": "right after you've upgraded and you have no idea what to do but you remember reading well I can't go back words I",
    "start": "114719",
    "end": "120240"
  },
  {
    "text": "can't roll back a kubernetes upgrade what am I supposed to do and after a bunch of digging you start noticing look",
    "start": "120240",
    "end": "127200"
  },
  {
    "text": "my Ingress controller it's in a crash loop back off for anyone at Family Feud in the Keynotes crash loop back off top",
    "start": "127200",
    "end": "133640"
  },
  {
    "text": "kubernetes error so yeah we've we've all seen that I imagine and so it's about",
    "start": "133640",
    "end": "139239"
  },
  {
    "text": "time to panic because well what else do you do um so what on Earth went wrong",
    "start": "139239",
    "end": "147319"
  },
  {
    "text": "here well you probably know this is really related to Ingress so to understand let's let's take a few steps",
    "start": "147319",
    "end": "153760"
  },
  {
    "text": "back and understand the terminology we're going to use throughout this talk so first off we've got API Group and",
    "start": "153760",
    "end": "160560"
  },
  {
    "text": "version so in your kubernetes yaml manifest you've probably seen something like this the actual field name is API",
    "start": "160560",
    "end": "167239"
  },
  {
    "text": "version that's actually a little not quite correct uh there's API version",
    "start": "167239",
    "end": "172400"
  },
  {
    "text": "includes API Group that's networking. Kates iio and API version which is V1 beta 1 and that's what we use for",
    "start": "172400",
    "end": "178680"
  },
  {
    "text": "Ingress up and until kubernetes 122 when all the things changed and in this case",
    "start": "178680",
    "end": "185280"
  },
  {
    "text": "downtime resulted so there's another aspect here and that's the kubernetes version itself",
    "start": "185280",
    "end": "191239"
  },
  {
    "text": "so the current kubernetes version I believe is 1311 uh so the major version is one here",
    "start": "191239",
    "end": "199120"
  },
  {
    "text": "uh and that is basically something that we don't expect to ever change I certainly don't expect to ever see a",
    "start": "199120",
    "end": "204720"
  },
  {
    "text": "kubernetes V2 but if it did that would be when breaking changes happened and",
    "start": "204720",
    "end": "209840"
  },
  {
    "text": "obviously everyone's definition of a braking change is different as we just saw there was a breaking change in a",
    "start": "209840",
    "end": "215000"
  },
  {
    "text": "minor version upgrade and things went wrong so just keep that in mind minor",
    "start": "215000",
    "end": "220319"
  },
  {
    "text": "versions are released three times a year and include new features and apis and",
    "start": "220319",
    "end": "226120"
  },
  {
    "text": "new API versions which is what happened here and then patch versions that's that very last number and that's just for uh",
    "start": "226120",
    "end": "233239"
  },
  {
    "text": "new patch patches and Bug fixes because as much as I'd love to say we never have bugs and kubernetes there's always",
    "start": "233239",
    "end": "240079"
  },
  {
    "text": "enough content to go into a patch release so what happened here was in",
    "start": "240079",
    "end": "246360"
  },
  {
    "text": "kubernetes one9 we finally graduated Ingress to V1",
    "start": "246360",
    "end": "254040"
  },
  {
    "text": "now Ingress had existed at V1 beta 1 for",
    "start": "254040",
    "end": "259120"
  },
  {
    "text": "nearly 5 years which at that point in kubernetes history was basically forever",
    "start": "259120",
    "end": "264199"
  },
  {
    "text": "right so it had been this Perma beta API and there was this push to hey we should finally take these apis that have stuck",
    "start": "264199",
    "end": "271240"
  },
  {
    "text": "as beta forever and bump them up to V1 and what do you know I was one of the",
    "start": "271240",
    "end": "276600"
  },
  {
    "text": "people responsible for doing that so sorry um Ingress V1 was announced in",
    "start": "276600",
    "end": "282000"
  },
  {
    "text": "kubernetes 119 and we followed all the all the correct processes and at the same time you're supposed to deprecate",
    "start": "282000",
    "end": "287759"
  },
  {
    "text": "the previous version so that meant in kubernetes 119 we had a deprecation warning that V1 beta 1 is deprecated and",
    "start": "287759",
    "end": "295600"
  },
  {
    "text": "going away then one year later in kubernetes 122 Ingress V1 beta 1 was",
    "start": "295600",
    "end": "303680"
  },
  {
    "text": "removed so there's some problems here now the vast majority of kubernetes",
    "start": "303680",
    "end": "310160"
  },
  {
    "text": "controllers use a single API version so that sounds sensible because that's just",
    "start": "310160",
    "end": "316919"
  },
  {
    "text": "the most straightforward thing to do but most Ingress controllers in particular try try to support a very wide range of",
    "start": "316919",
    "end": "323479"
  },
  {
    "text": "kubernetes versions so you don't have to look at every you know support Matrix to see okay I need this version of Ingress",
    "start": "323479",
    "end": "330080"
  },
  {
    "text": "engine X or sto or whatever or Contour to run in this version of kubernetes so",
    "start": "330080",
    "end": "335919"
  },
  {
    "text": "for a long time you just didn't have to think about that but this upgrade gave those Ingress controller authors two",
    "start": "335919",
    "end": "342840"
  },
  {
    "text": "very bad options the first option was rearchitecturing",
    "start": "342840",
    "end": "348639"
  },
  {
    "text": "a huge re architecture re architecture in controllers and I don't know of any controller that actually did that so",
    "start": "359720",
    "end": "366280"
  },
  {
    "text": "most controllers went the other op way and they just said we're only going to we're going to issue one release that",
    "start": "366280",
    "end": "371599"
  },
  {
    "text": "supports kubernetes uh 121 and older and one release that supports 122 and newer",
    "start": "371599",
    "end": "378599"
  },
  {
    "text": "or something roughly like that but there was no way to support 119 and 122 in the",
    "start": "378599",
    "end": "384639"
  },
  {
    "text": "same controller so what this means this is an example of in engine X supported",
    "start": "384639",
    "end": "390520"
  },
  {
    "text": "versions they support the trailing five versions roughly right now you can see",
    "start": "390520",
    "end": "395919"
  },
  {
    "text": "not exactly precise but that's a rough idea and then if you look at ISO supported versions it's also roughly",
    "start": "395919",
    "end": "402639"
  },
  {
    "text": "trailing five kubernetes versions and then you see they actually test another four or five versions beyond that so you",
    "start": "402639",
    "end": "410639"
  },
  {
    "text": "you can imagine that ISO in this case they're basically supporting three years of kubernetes upgrades uh and this is",
    "start": "410639",
    "end": "417960"
  },
  {
    "text": "really challenging if you only have one year where between a deprecation and an API removal and that was the huge pain",
    "start": "417960",
    "end": "426120"
  },
  {
    "text": "point with this upgrade so how on Earth could you even avoid this this was",
    "start": "426120",
    "end": "432080"
  },
  {
    "text": "admittedly very painful uh and you may say well okay but hold on I fixed",
    "start": "432080",
    "end": "437479"
  },
  {
    "text": "everything I switched all my manifests to be V1 instead of V1 beta 1 I remember",
    "start": "437479",
    "end": "442560"
  },
  {
    "text": "this is exactly what I thought at the time that okay well if I just switch V1",
    "start": "442560",
    "end": "447840"
  },
  {
    "text": "and all my manifests I'm going to be great and so you you've made this change",
    "start": "447840",
    "end": "453400"
  },
  {
    "text": "and you think okay well I know V1 beta 1 is going away I switched all my manifest I'm great the problem is this is only",
    "start": "453400",
    "end": "460639"
  },
  {
    "text": "the API version that you use when you're communicating with API server it has nothing to do with how the data is",
    "start": "460639",
    "end": "467440"
  },
  {
    "text": "actually stored and it has nothing to do with what your controller is actually using and the problem here is what your",
    "start": "467440",
    "end": "472639"
  },
  {
    "text": "controller is actually using so let's go one step further we",
    "start": "472639",
    "end": "477919"
  },
  {
    "text": "have all these cool deprecation warning right so if you were using a V1 beta 1 Ingress you probably remember seeing",
    "start": "477919",
    "end": "483360"
  },
  {
    "text": "some kind of deprecation warning like this but if you fix your manifest you never saw it again and so depre",
    "start": "483360",
    "end": "490919"
  },
  {
    "text": "deprecation warnings are only visible to the client that has the deprecation right so if your controller is using V1",
    "start": "490919",
    "end": "497759"
  },
  {
    "text": "beta 1 you're not going to see those deprecation warnings because you're not seeing the warnings your controller is seeing it's a big",
    "start": "497759",
    "end": "504960"
  },
  {
    "text": "problem so why would we remove V1 beta 1 so soon I was uncomfortable with this at",
    "start": "504960",
    "end": "511599"
  },
  {
    "text": "the time but the argument was that there would never have been a completely safe point to remove V1 beta 1 so if you look",
    "start": "511599",
    "end": "520399"
  },
  {
    "text": "at ISO for example they support basically three years of kubernetes versions and that that's just what they",
    "start": "520399",
    "end": "527640"
  },
  {
    "text": "support in their most recent version there's a long tale of users that are using old Ingress controllers so imagine",
    "start": "527640",
    "end": "534160"
  },
  {
    "text": "you're using an Ingress controller from two three years ago and you just haven't upgraded that makes that trailing that",
    "start": "534160",
    "end": "540959"
  },
  {
    "text": "long tail even longer so it's really challenging to know when is it actually",
    "start": "540959",
    "end": "546120"
  },
  {
    "text": "safe you can gradually increase this number but it's never perfectly safe to remove V1 beta 1 in this case so the",
    "start": "546120",
    "end": "553839"
  },
  {
    "text": "argument was it's better just to rip the Band-Aid off than to drag this out",
    "start": "553839",
    "end": "559000"
  },
  {
    "text": "forever and ever and ever you can agree or disagree with that but that is the official kubernetes deprecation policy",
    "start": "559000",
    "end": "566200"
  },
  {
    "text": "for those curious here's a link uh but the expectation is that as soon as you",
    "start": "566200",
    "end": "573440"
  },
  {
    "text": "deprecate an API which is when you're releasing a new API version if it's beta",
    "start": "573440",
    "end": "579160"
  },
  {
    "text": "you're going to have that beta API version removed in nine months or three minor versions so in this case three",
    "start": "579160",
    "end": "586040"
  },
  {
    "text": "minor versions is roughly around a year right now so that is the policy uh it's",
    "start": "586040",
    "end": "591240"
  },
  {
    "text": "worth discussing if this policy is correct or not but that is the policy and what it is today um and that is what",
    "start": "591240",
    "end": "598040"
  },
  {
    "text": "it was also during this upgrade and I'll also mention that g API versions uh",
    "start": "598040",
    "end": "603640"
  },
  {
    "text": "could be marked as deprecated but they're never going to be removed unless we get to kubernetes V2 which I just",
    "start": "603640",
    "end": "609680"
  },
  {
    "text": "don't see happening and then Alpha API versions for anyone using that just keep in mind it could be gone at any point so",
    "start": "609680",
    "end": "617120"
  },
  {
    "text": "Alpha means no stability at all just keep that in mind so what could have helped here at",
    "start": "617120",
    "end": "623839"
  },
  {
    "text": "least you know we maybe couldn't have prevented this but what are some things that could have helped us out here so",
    "start": "623839",
    "end": "629480"
  },
  {
    "text": "increasing the time between deprecation and removal could have helped to a point we talked about that but there's no way",
    "start": "629480",
    "end": "635399"
  },
  {
    "text": "to ever cover every possible person uh controllers could work to find a way to",
    "start": "635399",
    "end": "640800"
  },
  {
    "text": "surface deprecation warnings to users I think that would be very helpful but ultimately that's still very difficult",
    "start": "640800",
    "end": "647480"
  },
  {
    "text": "because there's not a really natural place to put it do you put it in your controller logs who looks at your controller logs do you put do you just",
    "start": "647480",
    "end": "654240"
  },
  {
    "text": "Spam a bunch of kubernetes events well that gets very noisy very quickly it's",
    "start": "654240",
    "end": "659440"
  },
  {
    "text": "there's not a natural place to put this uh a Shameless plug that some managed providers like GK would just prevent",
    "start": "659440",
    "end": "665880"
  },
  {
    "text": "upgrades altogether like this so they'll in this case they'll show you uh you know the API version that's deprecated",
    "start": "665880",
    "end": "673399"
  },
  {
    "text": "when it was last used so whether that's by a controller or by you uh and prevent you from upgrading if you're still using",
    "start": "673399",
    "end": "679839"
  },
  {
    "text": "a deprecated API there's also a lot of Open Source projects that can help here and I'll do",
    "start": "679839",
    "end": "687240"
  },
  {
    "text": "a shout out to Fairwinds pleas PL which we've got some of Fairwinds right here I used to work at Fairwinds I didn't work",
    "start": "687240",
    "end": "693480"
  },
  {
    "text": "on that project but it's a great one uh these are great projects that can help you you understand before an upgrade if",
    "start": "693480",
    "end": "700440"
  },
  {
    "text": "it's actually safe to move forward so they'll help highlight apis that are deprecated before you",
    "start": "700440",
    "end": "707440"
  },
  {
    "text": "upgrade okay so let's take one more look at well we've got two more painful",
    "start": "708519",
    "end": "714480"
  },
  {
    "text": "upgrades to go through let's take a look into Gateway API and this is one that I very recently responsible for and this",
    "start": "714480",
    "end": "721800"
  },
  {
    "text": "is grpc Route so to understand a little bit about Gateway API and I'll spend some",
    "start": "721800",
    "end": "728560"
  },
  {
    "text": "time talking about Gateway API because as much as entry apis have their challenges crds are maybe another level",
    "start": "728560",
    "end": "735399"
  },
  {
    "text": "of challenging because they're a little bit of wild west without the same level of guard rails that we have in tree uh",
    "start": "735399",
    "end": "742639"
  },
  {
    "text": "you know where inry you can't really move backwards you can do whatever you want with crds you can go from crd",
    "start": "742639",
    "end": "748519"
  },
  {
    "text": "version 10 to one and back and forth and all kinds of things so you have to it shifts a lot of the responsibility onto",
    "start": "748519",
    "end": "755120"
  },
  {
    "text": "users and so we need to understand if we're using crds what this actually means so in Gateway API we have two",
    "start": "755120",
    "end": "763040"
  },
  {
    "text": "concepts we have an experimental Channel and a standard Channel and the experimental channel is really the the",
    "start": "763040",
    "end": "769920"
  },
  {
    "text": "dangerous place uh where there's experimental resources and experimental fields and what that means in practice",
    "start": "769920",
    "end": "776519"
  },
  {
    "text": "is don't expect any form of stability there will be breaking changes here uh we try to minimize them but there will",
    "start": "776519",
    "end": "782760"
  },
  {
    "text": "be breaking changes there and then standard channel has nothing but GA resources and Fields and we've gone to a",
    "start": "782760",
    "end": "789360"
  },
  {
    "text": "huge amount of effort over the three or so years that standard channel has existed to never have any",
    "start": "789360",
    "end": "794920"
  },
  {
    "text": "deprecations uh and make sure that you could always safely upgrade from standard channel to standard channel to",
    "start": "794920",
    "end": "800000"
  },
  {
    "text": "standard Channel without any of these issues so for example there is a V1 beta 1 in standard Channel and it will never",
    "start": "800000",
    "end": "807160"
  },
  {
    "text": "be removed so there's V1 beta 1 and V1 any API version that makes it in a standard channel is never ever going",
    "start": "807160",
    "end": "813519"
  },
  {
    "text": "away so if you stay in that path you never have to worry but there is an",
    "start": "813519",
    "end": "818920"
  },
  {
    "text": "asterisk so let's say uh that I just go ahead and install Gateway API standard",
    "start": "818920",
    "end": "824600"
  },
  {
    "text": "channel so this is the latest release of Gateway API v1.2 and I want to install grpc route and I know I just said that",
    "start": "824600",
    "end": "832639"
  },
  {
    "text": "installing standard channel should always be safe but you're seeing this really confusing error message and don't",
    "start": "832639",
    "end": "838480"
  },
  {
    "text": "worry because I know this is really tiny so I blew it up a little bit um but I",
    "start": "838480",
    "end": "843959"
  },
  {
    "text": "don't know that making it bigger really helps you understand it at least it didn't for me so what this is saying is",
    "start": "843959",
    "end": "850959"
  },
  {
    "text": "status. stored versions there's some kind of invalid value in there V1 Alpha 2 must appear in Spec dot versions and",
    "start": "850959",
    "end": "858560"
  },
  {
    "text": "if you're like me the first time you saw this you're like what on Earth does this even mean right like this is the most confusing error message I've seen so",
    "start": "858560",
    "end": "867639"
  },
  {
    "text": "fortunately thanks to Jordan it there is a better error message on the way I'm not going to pretend that this is just",
    "start": "867639",
    "end": "874320"
  },
  {
    "text": "going to make you understand everything perfectly because this is still an incredibly complicated topic but maybe",
    "start": "874320",
    "end": "880079"
  },
  {
    "text": "if we can walk through it and understand it a little bit more and at least you have the right things to Google uh or",
    "start": "880079",
    "end": "886120"
  },
  {
    "text": "search so in this case uh we've got grpc routes and we're saying upgrading this",
    "start": "886120",
    "end": "892880"
  },
  {
    "text": "crd is invalid and what it's saying is the stat the stored versions in status",
    "start": "892880",
    "end": "899079"
  },
  {
    "text": "have an invalid value we've got V1 Alpha 2 somewhere in as a stored version for",
    "start": "899079",
    "end": "904399"
  },
  {
    "text": "that crd but we don't have any API schema any corresponding API schema to",
    "start": "904399",
    "end": "910000"
  },
  {
    "text": "tell us what V1 Alpha 2 even means so what this means behind the scenes is somehow we're storing this old API",
    "start": "910000",
    "end": "916600"
  },
  {
    "text": "version but we have no idea what to do with it if we accepted this upgrade so",
    "start": "916600",
    "end": "921720"
  },
  {
    "text": "without ruining the suspense too much this means that sometime probably we forgot about it somewhere we installed",
    "start": "921720",
    "end": "928639"
  },
  {
    "text": "an experimental version version of grpc route and just forgot about it and then we went to upgrade to Gateway API",
    "start": "928639",
    "end": "935360"
  },
  {
    "text": "standard Channel when grpc route went GA and the upgrade just failed because",
    "start": "935360",
    "end": "940440"
  },
  {
    "text": "there's no Alpha versions ever in standard Channel and so you get this very confusing",
    "start": "940440",
    "end": "945759"
  },
  {
    "text": "message so let's jump into what actually a storage version is so every kuber's",
    "start": "945759",
    "end": "953240"
  },
  {
    "text": "API has spec a specified storage version this is the API version that is used to",
    "start": "953240",
    "end": "958600"
  },
  {
    "text": "persist the data in etcd so you remember how uh we were talking about how you have that API version in your yaml",
    "start": "958600",
    "end": "964959"
  },
  {
    "text": "manifest and it's very easy to think whatever you put there is what's going to be stored completely disconnected",
    "start": "964959",
    "end": "971440"
  },
  {
    "text": "instead you that is what's configured at the API level so this is the API version",
    "start": "971440",
    "end": "978079"
  },
  {
    "text": "used to store that data in ETD and crds have a stored version status field that",
    "start": "978079",
    "end": "983880"
  },
  {
    "text": "looks something like this so you have status. stored versions and what crpc",
    "start": "983880",
    "end": "989360"
  },
  {
    "text": "route would have looked like as V1 Alpha 2 and V1 and kubernetes is not going to let",
    "start": "989360",
    "end": "995560"
  },
  {
    "text": "you upgrade to a crd that doesn't include some definition of the versions",
    "start": "995560",
    "end": "1000600"
  },
  {
    "text": "it has stored somewhere so if it says I have something stored in ETD for V1 Alpha 2 and V1 or more correctly that I",
    "start": "1000600",
    "end": "1008000"
  },
  {
    "text": "at some point had something stored for V1 Alpha 2 and V1 if you try and upgrade to a c crd that doesn't tell me what one",
    "start": "1008000",
    "end": "1014240"
  },
  {
    "text": "of those is so in this case V1 Alpha 2 I'm going to just not let you do that because I need a way to know how to get",
    "start": "1014240",
    "end": "1020720"
  },
  {
    "text": "this out of at CD storage but you're going to say well all my manifests say V1 and again just",
    "start": "1020720",
    "end": "1029120"
  },
  {
    "text": "reminder this is just how you're communicating between you and the API server nothing to do with API server to",
    "start": "1029120",
    "end": "1036199"
  },
  {
    "text": "etcd nothing to do with storage version so where on Earth is storage version actually defined if you dig into",
    "start": "1036199",
    "end": "1043079"
  },
  {
    "text": "crds I know crds are really massive and hard to look at but if you just uh command F control F for storage you'll",
    "start": "1043079",
    "end": "1050520"
  },
  {
    "text": "find it and there's two field well there's a field for each API version and so in this case you can say okay there",
    "start": "1050520",
    "end": "1057320"
  },
  {
    "text": "was a a version definition for V1 Alpha 2 and that set storage to true and then",
    "start": "1057320",
    "end": "1063520"
  },
  {
    "text": "for V1 you see the same thing but storage is set to false because only one",
    "start": "1063520",
    "end": "1069000"
  },
  {
    "text": "API version can be set as a storage version at a time so if a version has ever been used",
    "start": "1069000",
    "end": "1077360"
  },
  {
    "text": "as a storage version it will be added to status. stored versions on that crd and",
    "start": "1077360",
    "end": "1083039"
  },
  {
    "text": "prevent you from upgrading to a crd that doesn't have that in the version definitions inside",
    "start": "1083039",
    "end": "1088440"
  },
  {
    "text": "spec now what's maybe the most frustrating part of all of this this is never automatically pruned so even if",
    "start": "1088440",
    "end": "1096520"
  },
  {
    "text": "you've upgraded all your storage versions and we'll talk about that shortly that list is never pruned in",
    "start": "1096520",
    "end": "1101720"
  },
  {
    "text": "status so you have to do that yourself uh so just keep that in mind as you're",
    "start": "1101720",
    "end": "1106760"
  },
  {
    "text": "going that even this is really just the crd saying I know at some point this was",
    "start": "1106760",
    "end": "1111840"
  },
  {
    "text": "a stored version and you have to tell me that you're no longer using it anymore as a stored",
    "start": "1111840",
    "end": "1118320"
  },
  {
    "text": "version so let's take a step back to that error message that you know even",
    "start": "1118320",
    "end": "1123440"
  },
  {
    "text": "the improved error message is confusing but let's see if we it can make sense so",
    "start": "1123440",
    "end": "1129679"
  },
  {
    "text": "what's happening here is we're saying inside stored versions there's an invalid value Alpha 2 because I don't",
    "start": "1129679",
    "end": "1136480"
  },
  {
    "text": "see that in Spec dot versions and the reason don't see that in Spec dot versions is the version of the crd you",
    "start": "1136480",
    "end": "1142120"
  },
  {
    "text": "just installed is completely missing that V1 Alpha 2 definition so I have no",
    "start": "1142120",
    "end": "1148240"
  },
  {
    "text": "idea what to do with it so I'm just not going to let you install that so this really is trying to prevent you from",
    "start": "1148240",
    "end": "1153440"
  },
  {
    "text": "losing data or from any kind of painful upgrade but it is sure awfully annoying to see and you know this is trying to",
    "start": "1153440",
    "end": "1160520"
  },
  {
    "text": "help help you save you from yourself because this is you know a good guard rail but it is still very annoying and",
    "start": "1160520",
    "end": "1167360"
  },
  {
    "text": "confusing to have to deal with all right so how do you get out of this",
    "start": "1167360",
    "end": "1172760"
  },
  {
    "text": "how do you actually migrate away from this there are a few things first you need to ensure your crd has the desired",
    "start": "1172760",
    "end": "1178840"
  },
  {
    "text": "storage version so we're going to switch the storage version to uh V1 in this",
    "start": "1178840",
    "end": "1183919"
  },
  {
    "text": "case and you know this is something that the crd author would do for you and they would update this in the release notes",
    "start": "1183919",
    "end": "1189799"
  },
  {
    "text": "that's what Gateway API does or any other what anyone who's managing crds for you and then there's the Second Step",
    "start": "1189799",
    "end": "1197919"
  },
  {
    "text": "that can be autom and we'll get to that but the the naive way to do it is you just update all your resources somehow",
    "start": "1197919",
    "end": "1204679"
  },
  {
    "text": "so anytime your data is saved anytime you update a CR so in this case grpc",
    "start": "1204679",
    "end": "1209919"
  },
  {
    "text": "route it uses the storage version that is configured at that point in time so any right to grpc Route is going to",
    "start": "1209919",
    "end": "1217240"
  },
  {
    "text": "update that storage version for that specific resource so one of the ways to do this one of the most common ways is",
    "start": "1217240",
    "end": "1222400"
  },
  {
    "text": "just do some kind of noop update like an empty patch to all the grpc routes in your cluster and that's going to update",
    "start": "1222400",
    "end": "1228440"
  },
  {
    "text": "the storage version there's some ways to automate that but it's helpful to understand what's happening behind the scenes because it's really not that much",
    "start": "1228440",
    "end": "1235960"
  },
  {
    "text": "and then finally as I mentioned you kind of have to remove that old version from status. stored versions and then finally",
    "start": "1235960",
    "end": "1243280"
  },
  {
    "text": "you can do that upgrade and just get rid of V1 Alpha 2 now I I should say this is I'm walking",
    "start": "1243280",
    "end": "1250480"
  },
  {
    "text": "through all the manual steps projects like Gateway API will tell you in hopefully less steps how to do this but",
    "start": "1250480",
    "end": "1256799"
  },
  {
    "text": "I just want you to understand what's actually happening behind the scenes so there's one very cool thing that's",
    "start": "1256799",
    "end": "1263039"
  },
  {
    "text": "coming in kubernetes and that's storage version migration this is coming built into kubernetes it used to be part of",
    "start": "1263039",
    "end": "1270120"
  },
  {
    "text": "cube storage version migrator I think that was the name of the project but now it's a built-in API and kubernetes it",
    "start": "1270120",
    "end": "1275960"
  },
  {
    "text": "was Alpha in in 1.30 but in this case if you wanted to move your your storage VI",
    "start": "1275960",
    "end": "1281760"
  },
  {
    "text": "your storage version automatically this can do that for you you just say hey this grpc routes resource set it to V1",
    "start": "1281760",
    "end": "1289880"
  },
  {
    "text": "you apply this and it's going to migrate the storage version for you so this is Alpha in kubernetes 130 and hopefully",
    "start": "1289880",
    "end": "1296440"
  },
  {
    "text": "beta sometime soon so just reminder the only thing that's replacing from that step is",
    "start": "1296440",
    "end": "1304200"
  },
  {
    "text": "version two is step two here so this storage version migration this doesn't remove all the steps it removes step",
    "start": "1304200",
    "end": "1312919"
  },
  {
    "text": "two now you say why on Earth is this all so complicated uh because it is comp",
    "start": "1312919",
    "end": "1318559"
  },
  {
    "text": "compated I can't I can't sugarcoat that but removing an API version is inherently dangerous there's a risk of",
    "start": "1318559",
    "end": "1325720"
  },
  {
    "text": "data loss if you don't follow these steps in Gateway API we go to very extreme lengths to ensure that if you",
    "start": "1325720",
    "end": "1331679"
  },
  {
    "text": "just stay on standard Channel you never have to deal about deal with any of this you just you just have a happy path and",
    "start": "1331679",
    "end": "1337440"
  },
  {
    "text": "you never have to think about all these storage version migrations if you don't use Alpha apis generally you just don't",
    "start": "1337440",
    "end": "1342919"
  },
  {
    "text": "have to think about this um but in some cases migrating from experimental to",
    "start": "1342919",
    "end": "1348279"
  },
  {
    "text": "standard is going to require you to take these extra steps because using an alpha API",
    "start": "1348279",
    "end": "1354159"
  },
  {
    "text": "and then going to a ga API is a challenging process I will say there's also a lot of work going on to make this",
    "start": "1354159",
    "end": "1361440"
  },
  {
    "text": "less painful this is open source right we're trying to make this slightly less",
    "start": "1361440",
    "end": "1366480"
  },
  {
    "text": "painful as we go so one thing I want to call out is I focused a lot on all the",
    "start": "1366480",
    "end": "1373120"
  },
  {
    "text": "storage version migration stuff one kind of cheat code to all of this if is if you just don't care about that data so",
    "start": "1373120",
    "end": "1379600"
  },
  {
    "text": "my example is I had an old grpc Route crd I didn't care about you can just delete and recreate it and you don't",
    "start": "1379600",
    "end": "1386039"
  },
  {
    "text": "have to deal with any of this it's just gone uh but that means you've lost any of your grpc routes that were using",
    "start": "1386039",
    "end": "1392000"
  },
  {
    "text": "Alpha API if you want to keep that data and and keep everything running then you need to go through the storage version",
    "start": "1392000",
    "end": "1397880"
  },
  {
    "text": "migration process um in Gateway API there's been a lot of discussion about using different",
    "start": "1397880",
    "end": "1403440"
  },
  {
    "text": "API groups for standard any experimental channel that basically also removes this problem but at the expense of just",
    "start": "1403440",
    "end": "1409279"
  },
  {
    "text": "saying you can never have a smooth upgrade path from experimental to standard they're just different worlds",
    "start": "1409279",
    "end": "1415240"
  },
  {
    "text": "so you can have your experimental world you can have your standard world but you can't move between them and so that's if",
    "start": "1415240",
    "end": "1421760"
  },
  {
    "text": "you're interested in that discussion uh that's a discussion on Gateway I've got a link there but definitely interested",
    "start": "1421760",
    "end": "1428039"
  },
  {
    "text": "in feedback is that a good idea is that a terrible idea I would love to hear what people",
    "start": "1428039",
    "end": "1433360"
  },
  {
    "text": "think okay so the last painful upgrade here is one of drop fields and I'll be",
    "start": "1433360",
    "end": "1438480"
  },
  {
    "text": "be honest this is at least somewhat theoretical but only barely because this is talking about things we're talking",
    "start": "1438480",
    "end": "1444440"
  },
  {
    "text": "about doing very soon in Gateway API so this is really only barely",
    "start": "1444440",
    "end": "1450240"
  },
  {
    "text": "theoretical so in kubernetes Upstream we have these things called feature Gates anyone toggled a feature gate before in",
    "start": "1450240",
    "end": "1457520"
  },
  {
    "text": "kubernetes okay okay that's more than I expected actually but feature gates are kind of hidden they're they're really if",
    "start": "1457520",
    "end": "1463159"
  },
  {
    "text": "you are setting up a cluster yourself is generally the only way that you can toggle feature Gates because most Cloud",
    "start": "1463159",
    "end": "1469320"
  },
  {
    "text": "providers most cluster providers don't really expose that to you but what that means is when you're adding a new field",
    "start": "1469320",
    "end": "1475480"
  },
  {
    "text": "to a stable API so in this case Service uh you we hide that behind a feature",
    "start": "1475480",
    "end": "1481399"
  },
  {
    "text": "gate we can't just add a new field and send it directly to GA right we need to have some kind of graduation process",
    "start": "1481399",
    "end": "1487880"
  },
  {
    "text": "where we ensure it's working well and it's stable so we hide it behind an alpha feature gate and then once it's",
    "start": "1487880",
    "end": "1496120"
  },
  {
    "text": "then it gradually graduates once it meets uh graduation criteria from beta to",
    "start": "1496120",
    "end": "1501960"
  },
  {
    "text": "GA in gay API we don't have that because crds in general just don't have feature Gates that's a huge problem and so what",
    "start": "1501960",
    "end": "1509880"
  },
  {
    "text": "we've done is we just said okay we're going to have an experimental channel that just has the equivalent of all Alpha feature Gates on so just",
    "start": "1509880",
    "end": "1517360"
  },
  {
    "text": "everything uh and then we have standard Channel which is just GA only so only the safe things so experimental is every",
    "start": "1517360",
    "end": "1523919"
  },
  {
    "text": "new thing that you could possibly want and standard channel is nothing but the stable thing things and so let's talk about how this",
    "start": "1523919",
    "end": "1532279"
  },
  {
    "text": "could go poorly so let's say we have Joe and Joe",
    "start": "1532279",
    "end": "1537320"
  },
  {
    "text": "installs Gateway API 1.2 standard Channel that's great that's safe that's",
    "start": "1537320",
    "end": "1542559"
  },
  {
    "text": "everything you'd expect to happen and then sue you know unbeknown to Joe says",
    "start": "1542559",
    "end": "1547880"
  },
  {
    "text": "I really want to use this cool new authorization feature in HP route this is something we are actually talking",
    "start": "1547880",
    "end": "1553559"
  },
  {
    "text": "about right now uh so she installs an experimental HP route crd",
    "start": "1553559",
    "end": "1558799"
  },
  {
    "text": "uh and she uses that experimental authorization for her application then Joe goes ahead and he",
    "start": "1558799",
    "end": "1564360"
  },
  {
    "text": "upgrades to Gateway 1.3 standard Channel and what do you know 1.3 standard",
    "start": "1564360",
    "end": "1570240"
  },
  {
    "text": "Channel still doesn't have that experimental authorization feature and so that just completely disappears and",
    "start": "1570240",
    "end": "1576279"
  },
  {
    "text": "everything's getting through to Sue's app and that's just not a good",
    "start": "1576279",
    "end": "1582640"
  },
  {
    "text": "scenario I I will say this is not a unique problem to Gateway API uh this is really you know if you were toggling",
    "start": "1582640",
    "end": "1589399"
  },
  {
    "text": "feature Gates if you're uh enabling disabling features if you're going between different versions of",
    "start": "1589399",
    "end": "1595399"
  },
  {
    "text": "crds this same problem could happen but crds are cluster scope resources and",
    "start": "1595399",
    "end": "1602039"
  },
  {
    "text": "they really need to be managed centrally or at least with some level of communication and that's what I would",
    "start": "1602039",
    "end": "1607480"
  },
  {
    "text": "say here the real problem here is a lack of communication like so many technical",
    "start": "1607480",
    "end": "1612559"
  },
  {
    "text": "problems it could be solved if we could just communicate with each other and make sure we're on the same page when",
    "start": "1612559",
    "end": "1617960"
  },
  {
    "text": "we're upgrading or changing API versions or you could also just use a",
    "start": "1617960",
    "end": "1623000"
  },
  {
    "text": "cluster provider that manages the crds for you uh for example GK manages Gateway API but there I'm sure there are",
    "start": "1623000",
    "end": "1629720"
  },
  {
    "text": "other cluster providers that will do something similar all right so let's there's a lot",
    "start": "1629720",
    "end": "1635039"
  },
  {
    "text": "in that uh so let's do a very quick recap of all the terms here so one each",
    "start": "1635039",
    "end": "1642200"
  },
  {
    "text": "kubernetes API can expose multiple API versions so for example V1 Alpha 1 or V1",
    "start": "1642200",
    "end": "1648360"
  },
  {
    "text": "and when a resource is saved it's persisted with the storage version that's configured at that very point in time it's completely disconnected from",
    "start": "1648360",
    "end": "1655399"
  },
  {
    "text": "the API version you set in your manifest crd versions provide infinite",
    "start": "1655399",
    "end": "1660880"
  },
  {
    "text": "flexibility which is incredible you can do so many things with crds but they also have some sharp Corners there's",
    "start": "1660880",
    "end": "1666919"
  },
  {
    "text": "nothing to prevent you from going backwards and installing an older version of a crd or and also as we just",
    "start": "1666919",
    "end": "1672360"
  },
  {
    "text": "found out migrating storage versions can be incredibly painful so although crds",
    "start": "1672360",
    "end": "1677399"
  },
  {
    "text": "are very very powerful we have to recognize that they do have some sharp Corners still and",
    "start": "1677399",
    "end": "1683080"
  },
  {
    "text": "we're working to smooth those over and I want to call out what we're",
    "start": "1683080",
    "end": "1688440"
  },
  {
    "text": "doing with Gateway API so uh one of the things you're going to see as a pattern",
    "start": "1688440",
    "end": "1693919"
  },
  {
    "text": "throughout any of any controllers that are implementing Ingress Gateway anything of that nature is they're going",
    "start": "1693919",
    "end": "1699960"
  },
  {
    "text": "to try and choose the API version that has the widest possible range of version support So in this case if you're",
    "start": "1699960",
    "end": "1706640"
  },
  {
    "text": "writing a Gateway AP AP controller and you see the API versions that are available for HP route it's pretty clear",
    "start": "1706640",
    "end": "1712919"
  },
  {
    "text": "which API version you're going to use you're going to use V1 beta one because that support that's available in the",
    "start": "1712919",
    "end": "1718559"
  },
  {
    "text": "last I can't do math what seven releases of Gateway API uh and that's basically",
    "start": "1718559",
    "end": "1724519"
  },
  {
    "text": "three years worth of releases for Gateway API so you're going to use that because One controller can then support",
    "start": "1724519",
    "end": "1729960"
  },
  {
    "text": "basically three years of crds you could also use V1 but that's only going to be in the most recent Gateway crds and the",
    "start": "1729960",
    "end": "1737279"
  },
  {
    "text": "API versions are identical so why not just use the one that is used more broadly it's worth understanding if you",
    "start": "1737279",
    "end": "1743559"
  },
  {
    "text": "ever see a deprecated API version check with your Ingress Gateway whatever controller docs to understand what",
    "start": "1743559",
    "end": "1749960"
  },
  {
    "text": "version they're using but this is generally A good rule of thumb for what version they'll probably be",
    "start": "1749960",
    "end": "1755840"
  },
  {
    "text": "using now this is going to come as a bit of a surprise but after all the bad",
    "start": "1755840",
    "end": "1760880"
  },
  {
    "text": "things I said about using Alpha API versions I actually want to request that you please use Alpha API versions uh I",
    "start": "1760880",
    "end": "1768279"
  },
  {
    "text": "wear the the Hat of an API maintainer for Gateway API and some some other things and oh my goodness we need",
    "start": "1768279",
    "end": "1775880"
  },
  {
    "text": "feedback you know if we have a huge problem in kubernetes where if we don't get feedback for Alpha apis we have a",
    "start": "1775880",
    "end": "1783200"
  },
  {
    "text": "very hard time having any confidence in what's going to get to GA so if you see a ga API at some point you're like man",
    "start": "1783200",
    "end": "1789360"
  },
  {
    "text": "how did this get to GA it's awful well part of the reason is we probably didn't get very much feedback before it got",
    "start": "1789360",
    "end": "1795279"
  },
  {
    "text": "there right so we're we're trying to we have soaked time we have all these things to try and ensure that we're",
    "start": "1795279",
    "end": "1801000"
  },
  {
    "text": "getting good feedback on Alpha API versions but that only works if people try it out and use it with that said",
    "start": "1801000",
    "end": "1807080"
  },
  {
    "text": "please only use Alpha API versions if you're okay with breaking changes and",
    "start": "1807080",
    "end": "1812360"
  },
  {
    "text": "you're using them in a non-prod environment just never touch Alpha and production they they just shouldn't",
    "start": "1812360",
    "end": "1818080"
  },
  {
    "text": "coexist right um then keep some kind of inventory of each controller that's",
    "start": "1818080",
    "end": "1823120"
  },
  {
    "text": "relying on an API and keep track of which API version or API versions they're using",
    "start": "1823120",
    "end": "1828840"
  },
  {
    "text": "and then finally crd management ideally should be centralized but if not centralized there should be some strong",
    "start": "1828840",
    "end": "1834000"
  },
  {
    "text": "communication across the board now real quickly I want to talk about some things that are in progress",
    "start": "1834000",
    "end": "1840640"
  },
  {
    "text": "uh there's a lot of work on the Gateway side to help smooth over crd management in general a lot of these things are",
    "start": "1840640",
    "end": "1847399"
  },
  {
    "text": "deceptively more complex than they seem such as improving crd management with the helm chart you say oh well that",
    "start": "1847399",
    "end": "1852799"
  },
  {
    "text": "should just be really simple I'll just spin up a Helm chart this actually may require changes to helm itself so",
    "start": "1852799",
    "end": "1858080"
  },
  {
    "text": "there's there there's a lot of complexity to actually managing crds then there's a lot of stuff going",
    "start": "1858080",
    "end": "1865080"
  },
  {
    "text": "on outside of kubernetes I want to call out the cap that's Moving storage version migration into kubernetes that's",
    "start": "1865080",
    "end": "1871639"
  },
  {
    "text": "a really helpful API and if you want to help that move along there's a link to the cap uh and then second I want to",
    "start": "1871639",
    "end": "1878559"
  },
  {
    "text": "call out cluster API because they have a really cool storage version migrator that automates more than just step two",
    "start": "1878559",
    "end": "1884159"
  },
  {
    "text": "and so we've been thinking about using something like that for a Gateway API so it can do even more than the built-in",
    "start": "1884159",
    "end": "1889399"
  },
  {
    "text": "tooling can and then finally I I always have to shout shout out I know this was not a",
    "start": "1889399",
    "end": "1895240"
  },
  {
    "text": "Gateway API talk but if you're interested in getting involved in Gateway API we we're doing a lot of things with crds and a lot of things to",
    "start": "1895240",
    "end": "1901120"
  },
  {
    "text": "try and smooth over this experience and we'd love uh to get more people involved",
    "start": "1901120",
    "end": "1906679"
  },
  {
    "text": "um in the front row we've got Nick Young and he's doing a talk if you're an API author uh I definitely recommend this",
    "start": "1906679",
    "end": "1914320"
  },
  {
    "text": "it's 251 ad it's not too far away anyways I'll be headed there after this talk uh if you're an API author and",
    "start": "1914320",
    "end": "1920760"
  },
  {
    "text": "you're trying to understand how I can make this better for for end users definitely recommend this there's a lot",
    "start": "1920760",
    "end": "1927080"
  },
  {
    "text": "of pitfalls when you're developing an API that you want to watch out for so recommend heading to that talk after and",
    "start": "1927080",
    "end": "1933679"
  },
  {
    "text": "then Shameless plug if you want to work on GK Gateway we're currently hiring a PM so definitely would love to work with",
    "start": "1933679",
    "end": "1940639"
  },
  {
    "text": "more people uh and with that any questions",
    "start": "1940639",
    "end": "1946679"
  },
  {
    "text": "Mike I think yeah there's no mic so we'll just have",
    "start": "1954120",
    "end": "1958799"
  },
  {
    "text": "to [Music]",
    "start": "1962480",
    "end": "1966690"
  },
  {
    "text": "yeah yes oh I yeah okay Mike called out a huge so Mike was asking if it's possible to mark an API version as",
    "start": "1969480",
    "end": "1976120"
  },
  {
    "text": "unserved that's a huge huge and very good point if you mark an API version as",
    "start": "1976120",
    "end": "1981360"
  },
  {
    "text": "unserved it means it's inaccessible to end users so you can't actually use that API version so your controller might",
    "start": "1981360",
    "end": "1987519"
  },
  {
    "text": "still break but what it means in practice is that second example I showed where it wouldn't let you upgrade the",
    "start": "1987519",
    "end": "1993799"
  },
  {
    "text": "grpc route it solves that specific problem because the the API schema is",
    "start": "1993799",
    "end": "2000360"
  },
  {
    "text": "still in the crd so it knows how to handle it it just won't let anyone actually use it other than the API",
    "start": "2000360",
    "end": "2006440"
  },
  {
    "text": "server for conversion so good Point",
    "start": "2006440",
    "end": "2010720"
  },
  {
    "text": "yeah yeah no I yeah I think we're basically completely lost if there's a breaking changes so the question was is",
    "start": "2018159",
    "end": "2024559"
  },
  {
    "text": "there any storage version migrating tool that can help with breaking changes between Alpha if there is I sure don't",
    "start": "2024559",
    "end": "2029679"
  },
  {
    "text": "know about it uh I think you're basically in a bad place if breaking changes happen in Alpha so good",
    "start": "2029679",
    "end": "2036440"
  },
  {
    "text": "questions thank you",
    "start": "2036440",
    "end": "2039679"
  }
]