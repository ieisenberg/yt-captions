[
  {
    "text": "all right everyone uh welcome to the talk so today uh we're gonna talk about migrating vms to kubernetes",
    "start": "160",
    "end": "7279"
  },
  {
    "text": "uh my name is luke kaiso i'm an engineer at hashicorp and i work on console and our kubernetes integration",
    "start": "7279",
    "end": "13920"
  },
  {
    "text": "hi everyone my name is irina shistava i also work as an engineer at hashicorp",
    "start": "13920",
    "end": "19279"
  },
  {
    "text": "working on our console kubernetes integration yeah so uh let's just uh share screen",
    "start": "19279",
    "end": "25840"
  },
  {
    "text": "here and i'm going to get into the slides and we can intro the talk here so um",
    "start": "25840",
    "end": "31199"
  },
  {
    "text": "i'm going to present here so yeah this talk today is migration 101 from vms to kubernetes so",
    "start": "31199",
    "end": "38960"
  },
  {
    "text": "what we're going to do in today's talk is we're going to have our two applications over here we're",
    "start": "38960",
    "end": "44399"
  },
  {
    "text": "going to have the web application and the iepi application and they're both going to be running on vms",
    "start": "44399",
    "end": "50320"
  },
  {
    "text": "and then what we're going to do is we're going to deploy the api application onto kubernetes so we're going to go",
    "start": "50320",
    "end": "55600"
  },
  {
    "text": "through everything you need to know about how to get these applications from what it would be like to deploy on a vm to deploy onto kubernetes",
    "start": "55600",
    "end": "62239"
  },
  {
    "text": "and then what we're going to do is we're going to deal with the routing so that the web can actually route to api and we're going to swap the routing over",
    "start": "62239",
    "end": "68560"
  },
  {
    "text": "in a no downtime migration so that the api service is now running on kubernetes so that's like the the",
    "start": "68560",
    "end": "74000"
  },
  {
    "text": "overview of the whole talk that's our goal so uh to get there",
    "start": "74000",
    "end": "79600"
  },
  {
    "text": "uh we're gonna start with like an introduction uh a little bit of the setup and how we're gonna do everything and the interesting thing about our",
    "start": "79600",
    "end": "85600"
  },
  {
    "text": "workshop here is we're actually going to be able to run everything uh on our laptops uh we have a full set of instructions for folks to either follow along so they",
    "start": "85600",
    "end": "92320"
  },
  {
    "text": "can run the commands themselves on their laptops or if you don't have a laptop that you have access to uh",
    "start": "92320",
    "end": "97840"
  },
  {
    "text": "or it doesn't have enough like a ram or something like that you're having some issues you can just follow along with us because we're going to be running the same steps",
    "start": "97840",
    "end": "103520"
  },
  {
    "text": "at the same time so yeah so to get to that point where we migrate from vms over to kubernetes",
    "start": "103520",
    "end": "109439"
  },
  {
    "text": "what we're going to do is we're going to uh first build a docker image so in order to deploy anything on kubernetes you need a docker image",
    "start": "109439",
    "end": "116640"
  },
  {
    "text": "then we're going to actually deploy into kubernetes so this is going to be talking about like the kubernetes resources",
    "start": "116640",
    "end": "121759"
  },
  {
    "text": "the difference between vms and kubernetes and also of course it wouldn't be a kubernetes talk without yaml so we're going to talk",
    "start": "121759",
    "end": "127600"
  },
  {
    "text": "about what your yaml needs to look like once your app is deployed onto kubernetes obviously we now need to",
    "start": "127600",
    "end": "132879"
  },
  {
    "text": "route to it so then uh i'm going to be doing the first part here and then we're going to switch over to irena and she's going to be talking about the next parts and so",
    "start": "132879",
    "end": "139440"
  },
  {
    "text": "the first thing she's going to talk about is the routing so how do we actually route from like on our vms all the way over into the",
    "start": "139440",
    "end": "146080"
  },
  {
    "text": "into kubernetes we're also gonna talk about logging and metrics um often you're gonna be using",
    "start": "146080",
    "end": "151120"
  },
  {
    "text": "your own log in metrics like whatever systems you had before you moved to kubernetes but we wanted to show you some of the cool cloud native",
    "start": "151120",
    "end": "157200"
  },
  {
    "text": "tooling that is available out there and how to run it and you'll actually be able to run it on your cluster and play around with it yourself",
    "start": "157200",
    "end": "163519"
  },
  {
    "text": "once we have all our metrics in place we're able to know whether our app is working as expected we're",
    "start": "163519",
    "end": "168879"
  },
  {
    "text": "going to perform a no downtime migration um and then basically what that means is",
    "start": "168879",
    "end": "174160"
  },
  {
    "text": "we're going to have both the app running on vms and kubernetes and then we're going to swap over in a safe way that allows us to swap back",
    "start": "174160",
    "end": "180080"
  },
  {
    "text": "without missing any traffic and then finally at the end uh we're gonna do a quick demo of console service mesh",
    "start": "180080",
    "end": "186720"
  },
  {
    "text": "so we don't recommend uh depending on on your use case it doesn't make sense necessarily to go into service mesh and",
    "start": "186720",
    "end": "192000"
  },
  {
    "text": "one of the things we actually talk about at the end of the talk is about how like you got to keep it simple and don't try to boil the ocean and use all the new",
    "start": "192000",
    "end": "197680"
  },
  {
    "text": "cool technology however there are some like use cases and problems that the service mesh does",
    "start": "197680",
    "end": "203040"
  },
  {
    "text": "solve and so we're going to give you a quick demo of what that would look like if you did go down that road",
    "start": "203040",
    "end": "208959"
  },
  {
    "text": "so um before we do anything we want you folks to start getting",
    "start": "208959",
    "end": "214640"
  },
  {
    "text": "downloading the prerequisites if you haven't already so uh this url is going to be available",
    "start": "214640",
    "end": "220000"
  },
  {
    "text": "in the chat right now uh wherever that chat is um so i'm gonna switch over and just show you what you need to do to get",
    "start": "220000",
    "end": "225280"
  },
  {
    "text": "started and then you can come back to us and we can we can start with the workshop so we're going to go to this url here",
    "start": "225280",
    "end": "231519"
  },
  {
    "text": "and we want to click into the prerequisites here so what you need is you need docker desktop so you see here i have docker",
    "start": "231519",
    "end": "238400"
  },
  {
    "text": "running you need to install kind which is a kubernetes and docker that's going to allow us to run kubernetes locally",
    "start": "238400",
    "end": "244640"
  },
  {
    "text": "and you need to install cube ctl and help so get started downloading those things maybe you want to pause the video until",
    "start": "244640",
    "end": "250799"
  },
  {
    "text": "you have them all downloaded some of them will take a little bit of time to download and also one thing worth noting is that you need to have",
    "start": "250799",
    "end": "255840"
  },
  {
    "text": "four gigs of memory 16 gigs of ram and 6 cpu or 60 16 gigs of disk and 6",
    "start": "255840",
    "end": "261280"
  },
  {
    "text": "cpus so when you get docker running you can go into preferences here",
    "start": "261280",
    "end": "268240"
  },
  {
    "text": "uh resources and so like uh we say there so four gigs of memory and six cpus so",
    "start": "268240",
    "end": "274240"
  },
  {
    "text": "six and i have six gigs of memory um and then you don't need this much disk but uh you do need uh",
    "start": "274240",
    "end": "280080"
  },
  {
    "text": "what do i say 16 gigs of disk um and so that'll make because we're going to be running so many things on your laptop here uh that'll make it",
    "start": "280080",
    "end": "286400"
  },
  {
    "text": "things a lot easier so uh get started downloading those things and so i'm going to continue here",
    "start": "286400",
    "end": "292720"
  },
  {
    "text": "with uh with the talk so when we talk about like migrating to",
    "start": "292720",
    "end": "299520"
  },
  {
    "text": "kubernetes adopting kubernetes uh there's a there's a couple different ways to do it one common way to do it is instead of",
    "start": "299520",
    "end": "306560"
  },
  {
    "text": "migrating an existing application to kubernetes what we do is we actually we're building a new application and",
    "start": "306560",
    "end": "312160"
  },
  {
    "text": "we're going to deploy into kubernetes for the first time so in this diagram here we have our old web and api applications and what we're doing is we",
    "start": "312160",
    "end": "318880"
  },
  {
    "text": "have a new application coming the food application and we're going to deploy that onto kubernetes and one of the benefits of this patterns",
    "start": "318880",
    "end": "324639"
  },
  {
    "text": "or this pattern is that um foo isn't being called by any production traffic it's not being used many users",
    "start": "324639",
    "end": "330000"
  },
  {
    "text": "uh it's not dependent on by the web service and so we can deploy to kubernetes and if it breaks or there's some issues with it it's not a big deal",
    "start": "330000",
    "end": "336400"
  },
  {
    "text": "right there's no downtime when you're talking about what we're doing today which is when we're moving an existing application that's actually",
    "start": "336400",
    "end": "342560"
  },
  {
    "text": "getting full traffic over your kubernetes you got to be a little bit more careful um once you're deploying this into",
    "start": "342560",
    "end": "347680"
  },
  {
    "text": "production uh you know there's actual legit users going through your web and talking to api right and so if this breaks you know",
    "start": "347680",
    "end": "353600"
  },
  {
    "text": "there's going to be some trouble and so that's why we need to be a little bit careful here we would be doing a no downtime migration",
    "start": "353600",
    "end": "359600"
  },
  {
    "text": "we might want to you know build in some even more complicated things around here around like automatically failing over if something breaks um so yeah that's that's what",
    "start": "359600",
    "end": "367120"
  },
  {
    "text": "we're going to cover today but just note like there's different ways to adopt kubernetes um often like if you don't have a new application to coming down the pipeline",
    "start": "367120",
    "end": "373360"
  },
  {
    "text": "this is going to this is going to be how you adopt kubernetes and even if you are adopting it this way eventually you're probably going to want",
    "start": "373360",
    "end": "379360"
  },
  {
    "text": "to move some of these applications over into kubernetes and so you'll need to tackle this kind of thing",
    "start": "379360",
    "end": "384639"
  },
  {
    "text": "so let's get into the initial setup here so what we want to do is we're actually",
    "start": "384639",
    "end": "389919"
  },
  {
    "text": "going to deploy our our services here the web and api on our local machine and uh what we're going to do is we're",
    "start": "389919",
    "end": "396880"
  },
  {
    "text": "going to have the web service it's going to be running on localhost oops logo host 8080",
    "start": "396880",
    "end": "402240"
  },
  {
    "text": "and then our api service is going to be running on localhost 80 and we're going to be able to access it using this hostname http colon slash",
    "start": "402240",
    "end": "408720"
  },
  {
    "text": "class api and the way we're going to be doing that is etsy hosts so i know what you're thinking you know this is supposed to talk about",
    "start": "408720",
    "end": "414880"
  },
  {
    "text": "vms and now you're running everything on your macbook like what the heck i'm getting out of here okay hold on a",
    "start": "414880",
    "end": "420160"
  },
  {
    "text": "second so what we're going to learn today a lot of the things we're learning we can teach them in this",
    "start": "420160",
    "end": "425520"
  },
  {
    "text": "environment here which allows us to play around a lot easier we don't have to get you to spin up vms and spin up a brand new kubernetes cluster and start paying",
    "start": "425520",
    "end": "431120"
  },
  {
    "text": "cloud providers for it and so if we look at what vms look like you can kind of see that they're actually quite similar to the setup here",
    "start": "431120",
    "end": "437520"
  },
  {
    "text": "and basically we can we can mimic almost everything on our laptops here so if we look at what a normal vm setup",
    "start": "437520",
    "end": "443440"
  },
  {
    "text": "looks like we're gonna have something like this where we have a set of vms and the web service would",
    "start": "443440",
    "end": "449039"
  },
  {
    "text": "be deployed to maybe three of them and the api service would deploy to another three of them",
    "start": "449039",
    "end": "454720"
  },
  {
    "text": "and then we're gonna have a load balancer somewhere out on the internet that our users come into and the load balancer is gonna the",
    "start": "454720",
    "end": "460479"
  },
  {
    "text": "request is gonna come and it's gonna have to find a way to split them between like three different web service vms right so maybe you do",
    "start": "460479",
    "end": "466800"
  },
  {
    "text": "something you have like a dns entry and then each vm here has an ip address that gets added to this dns entry",
    "start": "466800",
    "end": "473039"
  },
  {
    "text": "and so you're doing kind of like splitting based on dns they're around dns and the same thing for like the web",
    "start": "473039",
    "end": "478800"
  },
  {
    "text": "service that needs to talk to its own api service uh you might have a dns entry for like api and then these vms have their ip",
    "start": "478800",
    "end": "485039"
  },
  {
    "text": "addresses registered and so you're calling over here like this and so this is very similar to what",
    "start": "485039",
    "end": "490080"
  },
  {
    "text": "we set up over here where we have our browser coming instead of load balancer and it's coming",
    "start": "490080",
    "end": "495919"
  },
  {
    "text": "directly into this web uh via localhost 880 but you know there's not a big difference there with that",
    "start": "495919",
    "end": "501759"
  },
  {
    "text": "and then api we're using a hostname here api but it's not dns there's no dns behind",
    "start": "501759",
    "end": "507360"
  },
  {
    "text": "it but behind the scenes we're actually using etsy hosts but that's basically just mimicking dns and again because we're running on the",
    "start": "507360",
    "end": "513120"
  },
  {
    "text": "same laptop we do need to use different ports but that's not a big difference between these two setups here",
    "start": "513120",
    "end": "519039"
  },
  {
    "text": "so take our word for it we're still going to learn a lot today with the how to do the vms and you're going to be able to do it all locally on your laptop which i",
    "start": "519039",
    "end": "524800"
  },
  {
    "text": "think is really really nice so speaking of on your laptop uh like i said",
    "start": "524800",
    "end": "530240"
  },
  {
    "text": "uh you can do all this on your on your own too or you can follow along with us or kind of do the same thing at the same time as of right now this workshop only",
    "start": "530240",
    "end": "537360"
  },
  {
    "text": "works on mac but uh depending on what we're saying in the chat right right now when you're when you're actually watching this at",
    "start": "537360",
    "end": "542880"
  },
  {
    "text": "kubecon we may have got it working on windows too so just check the chat there and see if it works",
    "start": "542880",
    "end": "548800"
  },
  {
    "text": "so what we're going to do here is hopefully you've got all the prerequisites set up and so we're going to go to this first step here uh if you if you're coming",
    "start": "548800",
    "end": "555200"
  },
  {
    "text": "from the root of the repo just go to click one dash setup okay cool so in this in this uh step",
    "start": "555200",
    "end": "562000"
  },
  {
    "text": "here the setup step we're going to start the web and api services running on our laptops and then we're going to let the web servers talk to the api service so",
    "start": "562000",
    "end": "569200"
  },
  {
    "text": "hopefully you've cloned this vehicle here and so i have it over here",
    "start": "569200",
    "end": "574640"
  },
  {
    "text": "so that's the repo there and so what it says in one term it'll start web so i'm just going to copy this",
    "start": "574880",
    "end": "581120"
  },
  {
    "text": "okay we see now we have web running so if you remember our diagram web is running on localhost 8080 here so",
    "start": "581120",
    "end": "586959"
  },
  {
    "text": "if i go to host 80. we'll see that we have the web service",
    "start": "586959",
    "end": "593120"
  },
  {
    "text": "running it returns web here but and it's upstream calls it's dependencies it's saying like hey i",
    "start": "593120",
    "end": "598560"
  },
  {
    "text": "can't talk to api service well we haven't even started it yet so we kind of expect this not to work",
    "start": "598560",
    "end": "603680"
  },
  {
    "text": "so like it says that's what you should be getting so then we're going to go over here and start the api service",
    "start": "603680",
    "end": "609680"
  },
  {
    "text": "so i'm going to open up a new terminal tab here and i'm going to start the api service",
    "start": "609680",
    "end": "614720"
  },
  {
    "text": "now here i'm using sudo that's because api is binding to port 80 so i'll type my password in there which",
    "start": "614720",
    "end": "620560"
  },
  {
    "text": "is a hundred two um and so now this is up and running here it's running on a localhost 80.",
    "start": "620560",
    "end": "626959"
  },
  {
    "text": "so let's see if the web service can now talk to its api service",
    "start": "626959",
    "end": "632399"
  },
  {
    "text": "ah so there's still something wrong so the issue here is that this api this hostname it doesn't exist",
    "start": "632399",
    "end": "639120"
  },
  {
    "text": "right um there's no website out there that says api and so what i need to do is actually need to kind of hack dns by editing my local etsy hosts",
    "start": "639120",
    "end": "647040"
  },
  {
    "text": "file and create and create an entry that says hey when you get this api hostname actually i want you to route it to localhost so we have the instructions",
    "start": "647040",
    "end": "654160"
  },
  {
    "text": "here like that um so we need to edit etsy hosts",
    "start": "654160",
    "end": "660480"
  },
  {
    "text": "so i'm going to open up a whole new set of terminals here oh and i gotta make it a little bit bigger for everybody",
    "start": "660480",
    "end": "666320"
  },
  {
    "text": "okay so edit etsy hosts again enter my password hunter 2. oh my gosh poorly",
    "start": "666320",
    "end": "675839"
  },
  {
    "text": "okay and at the end here i'm gonna go back into my docs here it says add this line to the bottom",
    "start": "676079",
    "end": "681120"
  },
  {
    "text": "so let's copy that make sure you don't add it with a comment so what this says is when",
    "start": "681120",
    "end": "687279"
  },
  {
    "text": "someone goes to http api actually route them to 127 which is just localhost right",
    "start": "687279",
    "end": "693600"
  },
  {
    "text": "so we save that and we go back to our web service we should now be hitting our api service and i'm going to switch over here just",
    "start": "693600",
    "end": "701200"
  },
  {
    "text": "click enter a couple times on these logs so we should see a request coming here",
    "start": "701200",
    "end": "706399"
  },
  {
    "text": "okay awesome so we saw that the response changed here a little bit so here we can see that it's correctly calling it's upstream which is its",
    "start": "707040",
    "end": "712959"
  },
  {
    "text": "dependency and then the name of it is api dash or vm and obviously indeed this is going to change when we",
    "start": "712959",
    "end": "718000"
  },
  {
    "text": "deploy indicates onto kubernetes but everything's working as we expect here and we go over to our logs we see",
    "start": "718000",
    "end": "723360"
  },
  {
    "text": "that you know that's where i pressed enter way up here and now we get like getting requests in here so",
    "start": "723360",
    "end": "728560"
  },
  {
    "text": "what have we just done well when we go back to our diagram here all we've done is we've got our browser",
    "start": "728560",
    "end": "734000"
  },
  {
    "text": "it's logos 8080 is talking the web service which is then calling the api service which is exactly",
    "start": "734000",
    "end": "740079"
  },
  {
    "text": "what we wanted to do for this stage okay so let's go back to our slides here",
    "start": "740079",
    "end": "747279"
  },
  {
    "text": "okay so we've got everything set up for uh for our our migration here and so now what we",
    "start": "748560",
    "end": "753680"
  },
  {
    "text": "want to do is we want to start deploying onto kubernetes but before we can deploy to kubernetes we actually need to build a docker image",
    "start": "753680",
    "end": "760720"
  },
  {
    "text": "so this is dockerizing and it's not a real word but that's what i like to call it when you try to stick your app into a docker image so",
    "start": "760720",
    "end": "767760"
  },
  {
    "text": "if we look at what we had with vms like i kind of want to motivate why docker right so we look at what we have with the vms",
    "start": "767760",
    "end": "773040"
  },
  {
    "text": "you're usually running one app per vm now when you run a docker image or a",
    "start": "773040",
    "end": "778800"
  },
  {
    "text": "docker container what this allows you to do is actually allows you to run multiple apps in a single vm so i mean i'm only",
    "start": "778800",
    "end": "784240"
  },
  {
    "text": "showing two here but you can run literally like 30 pods or they're called pause credits but you can run like literally 30 containers",
    "start": "784240",
    "end": "789519"
  },
  {
    "text": "on on a single vm if you have a really big van you can run even more than that um and so what this allows you to do obviously is have",
    "start": "789519",
    "end": "795440"
  },
  {
    "text": "a lot less vms and also what it allows you to do is you can treat your vms um like uh there's this",
    "start": "795440",
    "end": "802000"
  },
  {
    "text": "cattle versus pets analogy which i really don't like um but basically the idea is if you lose a vm",
    "start": "802000",
    "end": "807839"
  },
  {
    "text": "then it's not a special vm it can run anything so all you need to do is bring up another vm of the same type and then you",
    "start": "807839",
    "end": "813360"
  },
  {
    "text": "can run any docker containers on it right so this is kind of like what kubernetes uh it does it's the whole it's a whole",
    "start": "813360",
    "end": "819519"
  },
  {
    "text": "mechanism of kubernetes it's a container orchestration but before we can orchestrate containers what do we need we need containers so what exactly is a",
    "start": "819519",
    "end": "827279"
  },
  {
    "text": "container well let's compare it to vms and and and docker so over here we have vms and then over",
    "start": "827279",
    "end": "833600"
  },
  {
    "text": "here we have docker so a vm consists of your app so you know the binary or its dependencies it's going to have it's",
    "start": "833600",
    "end": "840240"
  },
  {
    "text": "it's libraries so if you're running like a node.js you're gonna have like a bunch of like javascript files you know your known modules",
    "start": "840240",
    "end": "846399"
  },
  {
    "text": "and then it's operating systems ubuntu or red hat or whatever you're running and that's your bm and then under the hood it's actually sitting on",
    "start": "846399",
    "end": "852079"
  },
  {
    "text": "a hypervisor and this eventually there's actual like real server with real cpu underneath but this is pretty big right and um one",
    "start": "852079",
    "end": "858399"
  },
  {
    "text": "of the things with this is that if you wanted to run app a on the same vm at that b well what if they're using",
    "start": "858399",
    "end": "864880"
  },
  {
    "text": "different versions of node.js for example then you're going to run to these issues right because the apps aren't contained",
    "start": "864880",
    "end": "870320"
  },
  {
    "text": "within like the app themselves they're actually like they have they kind of spread out over the whole vm when we look at a docker container what",
    "start": "870320",
    "end": "877040"
  },
  {
    "text": "we do is we actually contain the app and its uh binaries and libraries within a container so with is within its",
    "start": "877040",
    "end": "883760"
  },
  {
    "text": "own like namespace it doesn't even know what's going over here on app a it doesn't know about its files or anything like that it doesn't even know about",
    "start": "883760",
    "end": "889680"
  },
  {
    "text": "this processes or even its network and so what this allows us to do is because it's now contained it's a container right this allows us to stick a ton of them",
    "start": "889680",
    "end": "896639"
  },
  {
    "text": "all on the same vms they don't even know about each other until they get cpu throttle because i was using a lot of cpu but for the most part you don't really",
    "start": "896639",
    "end": "903440"
  },
  {
    "text": "notice it so that's what we're gonna do in the step two here is we're gonna uh package our application",
    "start": "903440",
    "end": "909440"
  },
  {
    "text": "which is currently running our vm on our laptop into a docker image so i'm over here in step two if you're",
    "start": "909440",
    "end": "916160"
  },
  {
    "text": "coming with a route there just click on step two dockerize okay so in this step we're",
    "start": "916160",
    "end": "921920"
  },
  {
    "text": "gonna build a docker image for the api service because we're only migrating let's go back to our premise here",
    "start": "921920",
    "end": "927199"
  },
  {
    "text": "we're only migrating api onto cube we're going to leave web over here on the vms we only need to build a docker image for api right now at least",
    "start": "927199",
    "end": "934320"
  },
  {
    "text": "so let's do that so in order to build a docker image you",
    "start": "934320",
    "end": "939360"
  },
  {
    "text": "need to write what's called a docker file which is literally just like a build script for for your docker image",
    "start": "939360",
    "end": "945120"
  },
  {
    "text": "so the first thing you need to start on is you need to think about what's your base for this image so just like in order to run your app",
    "start": "945120",
    "end": "951680"
  },
  {
    "text": "you might need to be running on like an operating system like ubudu or something like that uh with docker images you",
    "start": "951680",
    "end": "957120"
  },
  {
    "text": "still need like a base now technically you could actually start with nothing so you could just like stick your binary",
    "start": "957120",
    "end": "962720"
  },
  {
    "text": "into this image and all that would be there is your is your binary but say you want to like run a command",
    "start": "962720",
    "end": "968240"
  },
  {
    "text": "in your container because remember this is like isolated so you wanted to like maybe like ls or look at the files there well you don't have ls in your container",
    "start": "968240",
    "end": "975839"
  },
  {
    "text": "right you might not have cd you might want to like curl something but you don't have curl in that container",
    "start": "975839",
    "end": "980880"
  },
  {
    "text": "it's not going to work right so uh there are some a lot of benefits for starting from scratch it's called where",
    "start": "980880",
    "end": "986000"
  },
  {
    "text": "basically you have nothing in the image but your binary but for this example where we're kind of messing around with the demo and i think also for when",
    "start": "986000",
    "end": "991440"
  },
  {
    "text": "you're first starting out when you actually might want to run commands inside a container i recommend starting out with like a base image with the haslamic utilities",
    "start": "991440",
    "end": "997279"
  },
  {
    "text": "and things in it already in this case we're going to use alpine this is like a really really lightweight",
    "start": "997279",
    "end": "1002399"
  },
  {
    "text": "linux distribution um and it contains like a bunch of likes really small kind of utilities that you'll need",
    "start": "1002399",
    "end": "1007920"
  },
  {
    "text": "but it's only like five megabytes so it doesn't really add much to your docker image size so i'm going to copy that and then what",
    "start": "1007920",
    "end": "1013279"
  },
  {
    "text": "we need to do here is i'm going to do this in my editor so i'm going to create a new file called dockerfile",
    "start": "1013279",
    "end": "1020079"
  },
  {
    "text": "i can make this a little bigger we're going to copy that first line in there so let's go",
    "start": "1020639",
    "end": "1026160"
  },
  {
    "text": "back to our instructions here so now that you have your base image you got to think about something specific to",
    "start": "1026160",
    "end": "1031280"
  },
  {
    "text": "your application right so a good place to start to know what you need to put in your docker image is just look at the startup script for the",
    "start": "1031280",
    "end": "1036959"
  },
  {
    "text": "thing you're you're actually uh dockerizing so in this case our startup script here is a start api darwin and if we look at it it's",
    "start": "1036959",
    "end": "1044000"
  },
  {
    "text": "that's like you know username bath bash it says uh these like bash like uh command so that like the command wax",
    "start": "1044000",
    "end": "1050640"
  },
  {
    "text": "if it fails so we don't really need that and then it exports two environment variables and then it runs",
    "start": "1050640",
    "end": "1057039"
  },
  {
    "text": "our binary which is like the api service so if we first start with these export",
    "start": "1057039",
    "end": "1062720"
  },
  {
    "text": "instructions well in a docker file you can basically do the same thing using the m command so what we're going to do is",
    "start": "1062720",
    "end": "1069200"
  },
  {
    "text": "we're going to copy these into our docker file and we're going to change export to env",
    "start": "1069200",
    "end": "1076399"
  },
  {
    "text": "now let's closely look at these uh in this case we're actually going to change this from vm to case because we're going",
    "start": "1078880",
    "end": "1084240"
  },
  {
    "text": "to be pulling this docker image onto kubernetes and so we we're kind of like we wanted to have a different name so we know we're hitting it",
    "start": "1084240",
    "end": "1089440"
  },
  {
    "text": "in your case you're not going to want to do that obviously um you're going to want to keep like your app the same",
    "start": "1089440",
    "end": "1094559"
  },
  {
    "text": "and then the second thing here is this listen address so if we kept this as 127 what would happen is when we",
    "start": "1094559",
    "end": "1099679"
  },
  {
    "text": "deployed into kubernetes the application the container wouldn't actually be listening on any inter any um interfaces network interfaces",
    "start": "1099679",
    "end": "1106160"
  },
  {
    "text": "that you could hit from the outside you actually have to be in the container to actually curl it um this is because uh docker containers",
    "start": "1106160",
    "end": "1112160"
  },
  {
    "text": "have like their own networking so we actually want this to be 0 and this to be zero so that we're",
    "start": "1112160",
    "end": "1118160"
  },
  {
    "text": "listening outside of us because we're remember we're trying to route into this container here um most like most most like most of your",
    "start": "1118160",
    "end": "1125280"
  },
  {
    "text": "apps they're going to be listing on all interfaces anyways because like if you're in running in a vm you would need to be listening on all interfaces so you wouldn't really have to make this change",
    "start": "1125280",
    "end": "1131280"
  },
  {
    "text": "but because we're doing this down what we do okay the final thing here is this uh binary here so the first thing we do is",
    "start": "1131280",
    "end": "1136480"
  },
  {
    "text": "you actually need to get this binary into the app you would probably do this in your build script where you'd actually be building these binaries up",
    "start": "1136480",
    "end": "1142000"
  },
  {
    "text": "now maybe you have like if it's like a node or python or something like that you're gonna have like literally files so you need copies files from wherever",
    "start": "1142000",
    "end": "1148000"
  },
  {
    "text": "you're building it into the docker image so we can do it like this",
    "start": "1148000",
    "end": "1153200"
  },
  {
    "text": "so this dot slash bin is basically where i'm running my command from so i'm gonna be running it from like",
    "start": "1153440",
    "end": "1158640"
  },
  {
    "text": "uh the root and you see over here it's a little bit small here but we have bin so this is where the app lives so we want to copy the bin over into",
    "start": "1158640",
    "end": "1165280"
  },
  {
    "text": "slash a app slash api notice we're using the linux one not like the darwin or the windows one",
    "start": "1165280",
    "end": "1171039"
  },
  {
    "text": "that's because uh we're gonna be running our kubernetes cluster on linux and so we need like a linux docker",
    "start": "1171039",
    "end": "1176840"
  },
  {
    "text": "images but you might notice here like slash app that doesn't exist yet probably that's not really",
    "start": "1176840",
    "end": "1182000"
  },
  {
    "text": "a well-known directory so what we can do is we can actually run commands so we want to run make deer slash app",
    "start": "1182000",
    "end": "1188080"
  },
  {
    "text": "um that looks good the final thing here is we actually need to execute um a command",
    "start": "1188080",
    "end": "1194400"
  },
  {
    "text": "so this is basically kind of like you can think of it as like just a single process that we're building here so like what does that process actually",
    "start": "1194400",
    "end": "1199600"
  },
  {
    "text": "execute well obviously we wanted to run our app so this is where you set up the entry point here so we have slash app api",
    "start": "1199600",
    "end": "1205600"
  },
  {
    "text": "and hopefully this should all work so let's go back to our instructions this is what your docker file should",
    "start": "1205600",
    "end": "1210880"
  },
  {
    "text": "look like and all you need to do is run docker build and then the current directory so i'm going to switch over here to this tab",
    "start": "1210880",
    "end": "1216480"
  },
  {
    "text": "here so here we see that we have this docker file now so i should be able to drill a docker build",
    "start": "1216480",
    "end": "1222000"
  },
  {
    "text": "dot it's going to send the current context of this uh directory over to the docker daemon",
    "start": "1222000",
    "end": "1228799"
  },
  {
    "text": "and then it's going to run all our commands so that's really fast so this might take a little bit longer for you because you might actually have to be downloading uh alpine",
    "start": "1228799",
    "end": "1235360"
  },
  {
    "text": "um but you can see here our steps here so we've got the from alpine we set up our environment variables everything looks good we built this",
    "start": "1235360",
    "end": "1241600"
  },
  {
    "text": "docker mission so the very first thing we want to do is we want to run this docker image before we load into kubernetes and get all the way down that",
    "start": "1241600",
    "end": "1246799"
  },
  {
    "text": "road we can actually run this uh to see if it actually works so we can go docker on",
    "start": "1246799",
    "end": "1253280"
  },
  {
    "text": "this image and what we want to do is because on on a mac like docker is actually running in a vm it looks like a hypervisor kind",
    "start": "1253280",
    "end": "1260720"
  },
  {
    "text": "of little mini vm i'm not even sure what the technology they're using nowadays is um we actually want to publish our our",
    "start": "1260720",
    "end": "1266080"
  },
  {
    "text": "port from our mac over to wherever this container is running whatever magic they have running so we're just going to use 80 or 888 and",
    "start": "1266080",
    "end": "1272720"
  },
  {
    "text": "then we're going to publish to 80 because remember that's where the docker image is listed okay so there's some good news here um",
    "start": "1272720",
    "end": "1279600"
  },
  {
    "text": "first of all we have uh uh we we can see the log so that means it's working",
    "start": "1279600",
    "end": "1286080"
  },
  {
    "text": "and we should be able to go over here 888 i believe and we can see cool we're hitting our docker image and",
    "start": "1286080",
    "end": "1292320"
  },
  {
    "text": "it's api dash case uh this actually has like a nice ui too i believe not slash you",
    "start": "1292320",
    "end": "1298879"
  },
  {
    "text": "so we have our api here as well um but the important thing here is our document is working as expected",
    "start": "1299520",
    "end": "1304559"
  },
  {
    "text": "so that's that docker build section here we've done docker run here",
    "start": "1304559",
    "end": "1309919"
  },
  {
    "text": "all right so we're really close here we have our docker image build but it only exists on our laptops so what we need to do now",
    "start": "1309919",
    "end": "1316559"
  },
  {
    "text": "is in order to run kubernetes or have this run at kubernetes kubernetes needs to be able to pull this image from somewhere right",
    "start": "1316559",
    "end": "1322159"
  },
  {
    "text": "so that's where this docker the idea of a docker registry comes in so what we can do is we can tag our",
    "start": "1322159",
    "end": "1327520"
  },
  {
    "text": "image id with like a proper name and in this case i have i i have a docker hub registry under elk iso",
    "start": "1327520",
    "end": "1334000"
  },
  {
    "text": "and then i'm going to be able to push this up here now if you don't have a docker hub registry you're actually in luck here um because we're running kind which is",
    "start": "1334000",
    "end": "1341440"
  },
  {
    "text": "like kubernetes in docker we're actually running that on our vm on our on our macbooks right now there's a way to actually load the image",
    "start": "1341440",
    "end": "1347039"
  },
  {
    "text": "directly into kubernetes um so it's kind of a little bit cheap here if we don't actually have a docker hub account um but for those that do",
    "start": "1347039",
    "end": "1353280"
  },
  {
    "text": "that is definitely a little bit easier to push that image up there so what i'm going to do first is i'm going to do this where i'm going to tag",
    "start": "1353280",
    "end": "1358799"
  },
  {
    "text": "and push into my docker hub and then i'm also going to show what you can do with with kind if you don't have a docker out",
    "start": "1358799",
    "end": "1364559"
  },
  {
    "text": "so i'm going to control c here because this is the docker container we were running",
    "start": "1364559",
    "end": "1370080"
  },
  {
    "text": "all right so that's all done there so what i want to do is oh i did control okay what was i okay",
    "start": "1370080",
    "end": "1375280"
  },
  {
    "text": "this is the remember this image id you need to you need this to be able to tag it so docker tag",
    "start": "1375280",
    "end": "1382640"
  },
  {
    "text": "and then uh docker dot io slash alkaiso or but this will be whatever yours is and then api and then v0.1.0",
    "start": "1383200",
    "end": "1391120"
  },
  {
    "text": "it's the the 1.0 of the app uh so i should be able to take that there and this doesn't push it anywhere it",
    "start": "1391120",
    "end": "1397039"
  },
  {
    "text": "just exists now if i do docker images",
    "start": "1397039",
    "end": "1402080"
  },
  {
    "text": "okay a couple more lines uh you can see here we've just tagged this image so now what i'm gonna do is i'm gonna do",
    "start": "1402080",
    "end": "1407360"
  },
  {
    "text": "docker push i'm gonna push this image up",
    "start": "1407360",
    "end": "1411919"
  },
  {
    "text": "here all right so that's now pushed um and if you folks don't have a docker uh a docker hub account what we can do",
    "start": "1414840",
    "end": "1421360"
  },
  {
    "text": "is we can actually uh load this directly into kind so kind is our kubernetes and docker system",
    "start": "1421360",
    "end": "1427279"
  },
  {
    "text": "so what we wanna do is we have a script here that's going to start that up so just run that",
    "start": "1427279",
    "end": "1433120"
  },
  {
    "text": "oh so what happened here so we've got this error here and this binded address is already in use so because of the way we're doing this",
    "start": "1438000",
    "end": "1444080"
  },
  {
    "text": "migration we're actually binding to port 80 with both our our kubernetes cluster and",
    "start": "1444080",
    "end": "1449679"
  },
  {
    "text": "our vm api so you need to do this kind of funny dance here we actually need to stop both our web and api services so ctrl c",
    "start": "1449679",
    "end": "1456840"
  },
  {
    "text": "those start kind again this will work this time",
    "start": "1456840",
    "end": "1462720"
  },
  {
    "text": "and then we're going to go back over and restart those uh those image those uh those vm uh",
    "start": "1462720",
    "end": "1468799"
  },
  {
    "text": "processes so that's i know that's actually right now so i can start our web and",
    "start": "1468799",
    "end": "1474799"
  },
  {
    "text": "start api here again after typing the password",
    "start": "1474799",
    "end": "1479519"
  },
  {
    "text": "go back over here to kind we see the control point here is starting and then when this comes up what we're",
    "start": "1481919",
    "end": "1488000"
  },
  {
    "text": "going to do is we're going to load our docker image directly into kind and you can use any name you want because you're not actually like like",
    "start": "1488000",
    "end": "1493279"
  },
  {
    "text": "you you folks won't be able to push to elk so because that's like my my registry right but you could actually",
    "start": "1493279",
    "end": "1498400"
  },
  {
    "text": "tag your docker image like this tag command will work you can put anything in here it's when you push that the authorization comes in there where it",
    "start": "1498400",
    "end": "1503760"
  },
  {
    "text": "says oh you can actually push there but what we can do is we can actually use this command called um",
    "start": "1503760",
    "end": "1510000"
  },
  {
    "text": "here this kind load so what we can do is we can load our docker image directly",
    "start": "1510000",
    "end": "1515279"
  },
  {
    "text": "into kind here this is going to bypass the docker registry",
    "start": "1515279",
    "end": "1521278"
  },
  {
    "text": "all right so that's been added there now awesome so success we we built a docker image uh we now have a",
    "start": "1522000",
    "end": "1527679"
  },
  {
    "text": "docker image up under kubernetes yeah and uh now we're ready to kubernetes so let's just quickly jump back into the",
    "start": "1527679",
    "end": "1533520"
  },
  {
    "text": "slides here so what we've done so far is we've built this docker image now we're ready to",
    "start": "1533520",
    "end": "1539919"
  },
  {
    "text": "deploy kubernetes and just like it was dockerizing now it's kubernetes",
    "start": "1539919",
    "end": "1546320"
  },
  {
    "text": "so let's just do a really quick overview of what things are going to look like into kubernetes we don't have a lot of time with this workshop so we can't go",
    "start": "1546320",
    "end": "1552000"
  },
  {
    "text": "into like everything about kubernetes but kind of one of the primitive building blocks of kubernetes is this idea of a pod",
    "start": "1552000",
    "end": "1558720"
  },
  {
    "text": "a pod is actually a collection of containers so you can actually have multiple docker containers running in one pod but for a lot of the use cases",
    "start": "1558720",
    "end": "1565520"
  },
  {
    "text": "especially when you're first starting out you're only going to have one docker container running inside that pod um and it's going to be your app so that",
    "start": "1565520",
    "end": "1570880"
  },
  {
    "text": "one we just built so for instance that's what we'll be running in the pod so these pods can be running on on all",
    "start": "1570880",
    "end": "1576720"
  },
  {
    "text": "of your nodes here um and you can be running like multiple pods on multiple nodes uh just like we were talking about before that's kind of",
    "start": "1576720",
    "end": "1582559"
  },
  {
    "text": "the benefits of docker containers right um but you need more than just pods because the problem with pods is",
    "start": "1582559",
    "end": "1588240"
  },
  {
    "text": "if i delete this this node right here that pods gone forever and kubernetes isn't going to automatically restart it so we need a",
    "start": "1588240",
    "end": "1595279"
  },
  {
    "text": "higher level constant construct it's going to be something it's going to manage like looking like okay i need three replicas and if",
    "start": "1595279",
    "end": "1602000"
  },
  {
    "text": "one node dies and my replica was on it then i need you to spin up that replica and schedule it somewhere else so that",
    "start": "1602000",
    "end": "1608480"
  },
  {
    "text": "higher level construct is called a deployment so in this case we have deployment here and for instance it's managing two",
    "start": "1608480",
    "end": "1614640"
  },
  {
    "text": "web pods now if this node here dies it crashes the deployment is going to",
    "start": "1614640",
    "end": "1620480"
  },
  {
    "text": "notice that it's running in a loop it says oh i'm supposed to have two replicas running i only have one i'm gonna try to schedule it somewhere",
    "start": "1620480",
    "end": "1626880"
  },
  {
    "text": "else it's gonna schedule over here so those are the two resources like the core resources we're gonna we're gonna look at next is the deployment and a pod",
    "start": "1626880",
    "end": "1635360"
  },
  {
    "text": "so let's look over here to step three here",
    "start": "1635360",
    "end": "1641039"
  },
  {
    "text": "so at the end of this we're gonna have api is gonna be deployed on kubernetes so we go back way at the end of this what we're gonna",
    "start": "1641039",
    "end": "1647039"
  },
  {
    "text": "have is we're gonna have api running over here in kubernetes we're also gonna have it running on vms",
    "start": "1647039",
    "end": "1652080"
  },
  {
    "text": "so if you haven't already started kind make sure you do that and make sure you do that little dance with like the ports so that you have",
    "start": "1652080",
    "end": "1658000"
  },
  {
    "text": "everything running and you can verify it's working by running qtl get node",
    "start": "1658000",
    "end": "1664000"
  },
  {
    "text": "okay cool so it's up and running as expected so let's first start with a pod i know",
    "start": "1667200",
    "end": "1672559"
  },
  {
    "text": "we're going to get to replicas next but i want to talk a little bit about first so it's a single replica of this of the application um",
    "start": "1672559",
    "end": "1679039"
  },
  {
    "text": "it has like an api version here that almost every kubernetes resource kind of starts with an api version and a kind so what kind of resource is it",
    "start": "1679039",
    "end": "1685520"
  },
  {
    "text": "it has some metadata like a name and then it has a spec and then inside the spec this is going to be different depending on which",
    "start": "1685520",
    "end": "1691200"
  },
  {
    "text": "resource um your your your scheduling but everything's going to have this like",
    "start": "1691200",
    "end": "1696880"
  },
  {
    "text": "this first same kind of part here so the spec for a pod is the list of containers like we talked about in this case we're only going to have one",
    "start": "1696880",
    "end": "1703440"
  },
  {
    "text": "we have a name for the container here's the image so whatever image you had you're pushing previously this is what",
    "start": "1703440",
    "end": "1708559"
  },
  {
    "text": "you want to have in here and then we specify the port so in this case we're going to be using 480. so if i create this file here",
    "start": "1708559",
    "end": "1716240"
  },
  {
    "text": "i can then use cubectl apply so this is takes it into yaml file and",
    "start": "1718960",
    "end": "1724960"
  },
  {
    "text": "it's gonna um apply this to the cluster it's gonna post it to kubernetes and say hey this is what i want to exist",
    "start": "1724960",
    "end": "1731279"
  },
  {
    "text": "here it says pod api created so i should be able to go cube ctl get pods all right we see this listing here we",
    "start": "1731279",
    "end": "1737679"
  },
  {
    "text": "have api running that's pretty awesome um we can get us logs by running qctl",
    "start": "1737679",
    "end": "1743840"
  },
  {
    "text": "logs api we see it's running as expected that's pretty great",
    "start": "1743840",
    "end": "1749039"
  },
  {
    "text": "um and we can also uh port forward to it uh we're gonna do that in a bit when we get to the deployment but remember how i was saying like i",
    "start": "1749039",
    "end": "1754799"
  },
  {
    "text": "think it's paused it's not enough so what happens if i do qtl delete pod api",
    "start": "1754799",
    "end": "1762320"
  },
  {
    "text": "i go get pods again it's gone there's nothing like managing it there's nothing restarting it it's just literally gone",
    "start": "1763520",
    "end": "1769039"
  },
  {
    "text": "if i were to delete that kind nobody would never come back up so we need more in the pods and what we need is that deployment right",
    "start": "1769039",
    "end": "1775679"
  },
  {
    "text": "so if we look at a deployment file it's kind of the same thing right we have our api version and our kind",
    "start": "1775679",
    "end": "1780799"
  },
  {
    "text": "we got our metadata now we're adding some labels with a little bit different then we have our spec and then you know",
    "start": "1780799",
    "end": "1786159"
  },
  {
    "text": "then the deployment set stuff the specific is that is that's what comes next so here we can only have",
    "start": "1786159",
    "end": "1791279"
  },
  {
    "text": "one replica obviously you'd want to set this to more in your production clusters um but in this case we're running locally so we",
    "start": "1791279",
    "end": "1796320"
  },
  {
    "text": "only want to have one uh this is a bunch of metadata and then inside here",
    "start": "1796320",
    "end": "1801760"
  },
  {
    "text": "you'll notice that this this section here looks pretty familiar if we look that we have here right",
    "start": "1801760",
    "end": "1808240"
  },
  {
    "text": "so all this is is like saying okay well what do my pods look like that are being managed under this deployment",
    "start": "1808240",
    "end": "1813360"
  },
  {
    "text": "so you can you can see how these concepts are being mapped here so this is the exact same thing as i had for my pod",
    "start": "1813360",
    "end": "1818799"
  },
  {
    "text": "so let's create this deployment.yaml file",
    "start": "1818799",
    "end": "1823840"
  },
  {
    "text": "paste that in there and then i'm going to refute ctl apply dash f deployment",
    "start": "1824720",
    "end": "1831679"
  },
  {
    "text": "boom our deployment is created so i should be able to go qctl get and then the get command at this the",
    "start": "1831760",
    "end": "1837440"
  },
  {
    "text": "third argument here is going to be the resource type so whatever resource type you've learned about you can use it do that uh type it in here so in this",
    "start": "1837440",
    "end": "1843039"
  },
  {
    "text": "case we're gonna do get deployment you see we have our api deployment and it's got one pod available it says",
    "start": "1843039",
    "end": "1849520"
  },
  {
    "text": "so i should be able to go get pause or pod here we say we have our api pod running",
    "start": "1849520",
    "end": "1854880"
  },
  {
    "text": "but it's got this kind of crazy prefix or suffix here this is because the deployment's actually managing that and it's giving it like a",
    "start": "1854880",
    "end": "1860880"
  },
  {
    "text": "random id here so we should be able to do qtl",
    "start": "1860880",
    "end": "1866159"
  },
  {
    "text": "logs and get the logs there that looks good and then the thing we were talking about before what if what if the this gets",
    "start": "1866159",
    "end": "1872799"
  },
  {
    "text": "deleted so if you delete pod",
    "start": "1872799",
    "end": "1879840"
  },
  {
    "text": "should be deleted here but when we do i'm going to control c that is it's hanging but it's actually",
    "start": "1880240",
    "end": "1886480"
  },
  {
    "text": "deleting in the back end if we do get plots here you see like what how i thought it was deleted well if you look at the id",
    "start": "1886480",
    "end": "1892640"
  },
  {
    "text": "we deleted this tc774 this is a new pod that's been spun up 12 seconds ago",
    "start": "1892640",
    "end": "1897679"
  },
  {
    "text": "so the deployment's not watching that it's like oh that pod got deleted ah i gotta have another replica it brings it back up okay so we're",
    "start": "1897679",
    "end": "1903919"
  },
  {
    "text": "running kubernetes this is awesome the final thing we want to check is like can we curl this app right so we haven't set up the routing that's",
    "start": "1903919",
    "end": "1909919"
  },
  {
    "text": "what irene is going to do with us next but there's one way to kind of directly route directly to a pod and not without having like all the routing work from",
    "start": "1909919",
    "end": "1915840"
  },
  {
    "text": "the outside and that's called port forward so we can do ctl port forward",
    "start": "1915840",
    "end": "1921039"
  },
  {
    "text": "the pod id and then just like we were doing with docker we were publishing ports over",
    "start": "1921039",
    "end": "1926320"
  },
  {
    "text": "we're going to publish our 888 over up into that pod 80.",
    "start": "1926320",
    "end": "1931760"
  },
  {
    "text": "all right it says it's forwarding over there so let's see",
    "start": "1932159",
    "end": "1936960"
  },
  {
    "text": "awesome so it's working as expected we're talking to api kate's here um and remember that's the",
    "start": "1937919",
    "end": "1943840"
  },
  {
    "text": "docker which we just built uh and it's got like the body hello world and everything so everything's working just as expected",
    "start": "1943840",
    "end": "1950000"
  },
  {
    "text": "so go back into our slides here this is what we've got so far we have",
    "start": "1950000",
    "end": "1955120"
  },
  {
    "text": "web running it's talking api on our vm macbook and now we have api deployed",
    "start": "1955120",
    "end": "1960159"
  },
  {
    "text": "over into kubernetes we put it into the docker image we've kubernetized it we have our yaml and everything",
    "start": "1960159",
    "end": "1965200"
  },
  {
    "text": "and so if we look at like what it would look like if you're doing this in vms you would have kind of your your setup",
    "start": "1965200",
    "end": "1971039"
  },
  {
    "text": "here nothing's changed right but now you have api deployed into your kubernetes cluster so obviously you're thinking like okay great",
    "start": "1971039",
    "end": "1977120"
  },
  {
    "text": "now what how do i actually route requests over to that and so that's what we're gonna talk about next and i'm gonna swap over to",
    "start": "1977120",
    "end": "1983120"
  },
  {
    "text": "irena who's gonna take it from here",
    "start": "1983120",
    "end": "1987440"
  },
  {
    "text": "all right hey everyone um so yeah i'm taking over from luke let me go ahead and share my screen",
    "start": "1989279",
    "end": "1996159"
  },
  {
    "text": "i'm still here though thank you luke for running us through those uh all these steps uh we're gonna start",
    "start": "1996159",
    "end": "2003039"
  },
  {
    "text": "with routing and just as a reminder as luke has mentioned you still should have all your vm",
    "start": "2003039",
    "end": "2010799"
  },
  {
    "text": "quote-unquote vm services running on your laptop at this point in time and you should",
    "start": "2010799",
    "end": "2016880"
  },
  {
    "text": "have your kubernetes deployment running so i'm just going to make sure just for my own sake that i do",
    "start": "2016880",
    "end": "2022640"
  },
  {
    "text": "have all of that and i'm in the same state as all of you all right so um let's um let's",
    "start": "2022640",
    "end": "2030159"
  },
  {
    "text": "talk about routing",
    "start": "2030159",
    "end": "2033840"
  },
  {
    "text": "and really when we're talking about exposing your service externally in vms what i imagine is",
    "start": "2035919",
    "end": "2042240"
  },
  {
    "text": "having a load balancer and just as we've shown before you look went over this like you can have your uh web",
    "start": "2042240",
    "end": "2048480"
  },
  {
    "text": "uh vms maybe in some sort of auto scaling group as you would in aws and it's all fronted by a load",
    "start": "2048480",
    "end": "2054560"
  },
  {
    "text": "balancer and you can have the same thing with api and so for example if your web service needs",
    "start": "2054560",
    "end": "2059679"
  },
  {
    "text": "to reach your api service they'll like typically do it through a load balancer",
    "start": "2059679",
    "end": "2065040"
  },
  {
    "text": "now let's talk about how would you expose a service externally in kubernetes and kubernetes really has this",
    "start": "2065040",
    "end": "2073280"
  },
  {
    "text": "a concept of a service and there's three types of services the first one is a cluster ip",
    "start": "2073280",
    "end": "2079358"
  },
  {
    "text": "and a cluster ip service is meant to be used only for things that need to talk to each other within the same cluster",
    "start": "2079359",
    "end": "2085679"
  },
  {
    "text": "each service gets assigned an ip but that ip is kind of a virtual ip it doesn't work outside the cluster only",
    "start": "2085679",
    "end": "2091440"
  },
  {
    "text": "kubernetes knows about that ip it's not resolvable in any way then there is a node board service and",
    "start": "2091440",
    "end": "2098160"
  },
  {
    "text": "that would work great if for example you have your nodes that you can reach externally the one",
    "start": "2098160",
    "end": "2105200"
  },
  {
    "text": "limitation with that is that there's a specific port range which doesn't really work for our case because we have a service that runs on",
    "start": "2105200",
    "end": "2112240"
  },
  {
    "text": "port 80 and our web service calls the api service on port 80 and if we want to do",
    "start": "2112240",
    "end": "2118000"
  },
  {
    "text": "that zero downtime migration without restarting our web service the node port service really will not work for us because we don't want to",
    "start": "2118000",
    "end": "2124079"
  },
  {
    "text": "change anything we just want the web to automatically switch to the new api service",
    "start": "2124079",
    "end": "2130000"
  },
  {
    "text": "and the last and the third type of service is the load balancer service that one really depends on your cloud",
    "start": "2130000",
    "end": "2135440"
  },
  {
    "text": "provider most cloud providers have load balancer service it would definitely work for our use case",
    "start": "2135440",
    "end": "2141200"
  },
  {
    "text": "however on kind load balancer service is not supported and for that reason we're not we're",
    "start": "2141200",
    "end": "2146720"
  },
  {
    "text": "going to use something different called an ingress and so an ingress is another abstraction",
    "start": "2146720",
    "end": "2151760"
  },
  {
    "text": "in kubernetes and it's really building on top of the surface abstraction and what it allows you to do is you can",
    "start": "2151760",
    "end": "2158560"
  },
  {
    "text": "it's mainly for http services you can expose your http routes externally outside the cluster the one",
    "start": "2158560",
    "end": "2165440"
  },
  {
    "text": "benefit to ingress over a load balancer service is that you can have your ingress",
    "start": "2165440",
    "end": "2171839"
  },
  {
    "text": "have only basically you can have only a single load balancer fronting only the ingress controller",
    "start": "2171839",
    "end": "2176880"
  },
  {
    "text": "instead of having a load balancer per service and that is really great because if you're trying to save on like say",
    "start": "2176880",
    "end": "2182640"
  },
  {
    "text": "infrastructure cost for load balancer using an ingress could really be a better option there so we're going to",
    "start": "2182640",
    "end": "2187680"
  },
  {
    "text": "show you how to use ingress for two reasons is that it may be beneficial for you in the future but also",
    "start": "2187680",
    "end": "2193920"
  },
  {
    "text": "our infrastructure doesn't happen to support load balancers",
    "start": "2193920",
    "end": "2199040"
  },
  {
    "text": "so at this point again to recap we have our web running evms calling our api in vms on",
    "start": "2199200",
    "end": "2206000"
  },
  {
    "text": "our local machine and we have an api um deployment which",
    "start": "2206000",
    "end": "2211040"
  },
  {
    "text": "is just a single pod with a single replica and we're going to end up with a service",
    "start": "2211040",
    "end": "2219280"
  },
  {
    "text": "an engine an nginx ingress that we will be able to reach locally",
    "start": "2219280",
    "end": "2225920"
  },
  {
    "text": "all right and with that uh let's dive in into workshop step four",
    "start": "2225920",
    "end": "2231200"
  },
  {
    "text": "so right now you're probably on step three i'm going to go ahead and click next to the step four",
    "start": "2231200",
    "end": "2239440"
  },
  {
    "text": "so the first thing we're going to do as i said ingress builds on top of kubernetes service so we need to create",
    "start": "2239440",
    "end": "2245119"
  },
  {
    "text": "a service first and since i we don't need any other kind of special kind of service we're just",
    "start": "2245119",
    "end": "2250880"
  },
  {
    "text": "going to use the cluster ip which is the default type of service and as you can see the",
    "start": "2250880",
    "end": "2256800"
  },
  {
    "text": "weight structure is you have a selector which in our case is just using labels",
    "start": "2256800",
    "end": "2262320"
  },
  {
    "text": "that is how our api deployment is labeled and that is how kubernetes will pick",
    "start": "2262320",
    "end": "2267440"
  },
  {
    "text": "pods for for the service to front and then we're going to choose our ports",
    "start": "2267440",
    "end": "2273119"
  },
  {
    "text": "uh the first port is our kind of like a quote-unquote front-end port this is our service port um and then the target port",
    "start": "2273119",
    "end": "2280320"
  },
  {
    "text": "is the backend port this is the port that the container is listening on so let's go ahead and grab that and",
    "start": "2280320",
    "end": "2287599"
  },
  {
    "text": "create our service.yaml file",
    "start": "2287599",
    "end": "2292000"
  },
  {
    "text": "in our workshop and let's go ahead and apply that",
    "start": "2293440",
    "end": "2299839"
  },
  {
    "text": "all right so our service is created now let's make sure that we can actually talk to our api through that service so",
    "start": "2300720",
    "end": "2307520"
  },
  {
    "text": "first a couple of basic checks let's go ahead and check that we do have that service in fact there",
    "start": "2307520",
    "end": "2312800"
  },
  {
    "text": "and let's also check that we have endpoints for that service and really endpoints uh",
    "start": "2312800",
    "end": "2319119"
  },
  {
    "text": "will show us that there is a pod that it was able to select with that selector that we've",
    "start": "2319119",
    "end": "2324320"
  },
  {
    "text": "specified for the service another last step since we've created a cluster ip service",
    "start": "2324320",
    "end": "2331119"
  },
  {
    "text": "we want to make sure that we can actually talk to that service from within the cluster and for that we're going to create a pod",
    "start": "2331119",
    "end": "2337440"
  },
  {
    "text": "running inside the cluster that will just curl our service at uh api port 9090 and remember that",
    "start": "2337440",
    "end": "2344880"
  },
  {
    "text": "our front-end port for this kubernetes service is 1990 not 80. uh and the dns that we're using in this",
    "start": "2344880",
    "end": "2351359"
  },
  {
    "text": "case is just the cube dns cube dns by default will resolve to that ip that will",
    "start": "2351359",
    "end": "2356560"
  },
  {
    "text": "work from within the cluster so let's uh let's go ahead and run that",
    "start": "2356560",
    "end": "2362960"
  },
  {
    "text": "so this will take a few seconds to for the pod to be created but once it's",
    "start": "2365359",
    "end": "2370880"
  },
  {
    "text": "there hopefully we can actually reach our service and talk to doctor",
    "start": "2370880",
    "end": "2376320"
  },
  {
    "text": "service all right so this is our response we",
    "start": "2376320",
    "end": "2382240"
  },
  {
    "text": "have an api case this is our uh kate's deployment within uh kubernetes the api deployment within",
    "start": "2382240",
    "end": "2389280"
  },
  {
    "text": "kubernetes um and so it works great now we're in a good shape to add an ingress on top of that let's",
    "start": "2389280",
    "end": "2396400"
  },
  {
    "text": "go ahead and delete that test pod that we just created called test api we will not need it anymore",
    "start": "2396400",
    "end": "2404480"
  },
  {
    "text": "all right and for ingress we're going to be using an nginx ingress controller",
    "start": "2404960",
    "end": "2411599"
  },
  {
    "text": "where we have provided the file for you to install all the nginx crds the custom resource",
    "start": "2411599",
    "end": "2418240"
  },
  {
    "text": "definitions as well as the ingress controller so just go ahead and cd into that folder",
    "start": "2418240",
    "end": "2425599"
  },
  {
    "text": "and run a keep ctl apply that nginx ingress.yaml",
    "start": "2425599",
    "end": "2432318"
  },
  {
    "text": "with with hopefully the correct command all right um we want to make sure that",
    "start": "2432800",
    "end": "2440000"
  },
  {
    "text": "we have everything running so um since there is a controller um the nginx controller that's running",
    "start": "2440000",
    "end": "2446720"
  },
  {
    "text": "so let's go and check that we have all the pods there",
    "start": "2446720",
    "end": "2453838"
  },
  {
    "text": "and once that ingress controller is running we should be able to create an ingress",
    "start": "2455280",
    "end": "2460720"
  },
  {
    "text": "object so let's take a look at what it's going to look like so here",
    "start": "2460720",
    "end": "2466240"
  },
  {
    "text": "again we're just going to say kind ingress and in the spec where like i said this",
    "start": "2466240",
    "end": "2471760"
  },
  {
    "text": "is really used mostly for exposing http routes in our case we only have kind of like one main route which",
    "start": "2471760",
    "end": "2478480"
  },
  {
    "text": "is just a slash and for the back end we're going to specify our service that we have just",
    "start": "2478480",
    "end": "2483680"
  },
  {
    "text": "created and tested and then our service port which is like the front end port for the service now turns into the",
    "start": "2483680",
    "end": "2490480"
  },
  {
    "text": "back end port for the ingress so let's go ahead and grab that",
    "start": "2490480",
    "end": "2496720"
  },
  {
    "text": "check that our ingress is now running and let's create our ingress object here",
    "start": "2496720",
    "end": "2504160"
  },
  {
    "text": "let me see d out of this because we already have an ingress object here but i'm just gonna do it in the main one",
    "start": "2504560",
    "end": "2512160"
  },
  {
    "text": "here we go let's apply that",
    "start": "2512160",
    "end": "2517760"
  },
  {
    "text": "all right so now we should be good to go we can oops we can uh double check",
    "start": "2520240",
    "end": "2527280"
  },
  {
    "text": "uh that we do have an ingress uh controller there we can we now should be able to just",
    "start": "2527280",
    "end": "2534160"
  },
  {
    "text": "curl a local host and yeah be able to reach it from our local",
    "start": "2534160",
    "end": "2540079"
  },
  {
    "text": "machine so at this point we are ready from the routing perspective to",
    "start": "2540079",
    "end": "2546319"
  },
  {
    "text": "route make sure our web service can talk to our api service on cades",
    "start": "2546319",
    "end": "2551520"
  },
  {
    "text": "so that is all good but as our next step we want to make sure",
    "start": "2551520",
    "end": "2557920"
  },
  {
    "text": "that our migration will actually go smoothly and for that we are going to add logging",
    "start": "2557920",
    "end": "2564160"
  },
  {
    "text": "and routing so i'm going to switch over to configuring logging and routing and really we want to do that",
    "start": "2564160",
    "end": "2570960"
  },
  {
    "text": "so that you know like kubernetes already has logs like luke has shown",
    "start": "2570960",
    "end": "2576160"
  },
  {
    "text": "but those logs are going to be gone as soon as you restart those instances so you're really not uh like accumulating logs so you you",
    "start": "2576160",
    "end": "2582720"
  },
  {
    "text": "want to uh kind of set up on your platform so that you're in a good place and you have",
    "start": "2582720",
    "end": "2588720"
  },
  {
    "text": "your equipment with all the knowledge that you could possibly have so that your migration goes smoothly",
    "start": "2588720",
    "end": "2595680"
  },
  {
    "text": "all right so for our next step let's go ahead and",
    "start": "2597200",
    "end": "2604800"
  },
  {
    "text": "dive right in actually and continue uh working on our logging",
    "start": "2604800",
    "end": "2611359"
  },
  {
    "text": "i'm gonna go ahead and hit next here",
    "start": "2612640",
    "end": "2616880"
  },
  {
    "text": "cool um and uh for for the logging infrastructure we're using elastic uh kibana and",
    "start": "2618160",
    "end": "2625359"
  },
  {
    "text": "fluentd and i'm gonna go over these tools and explain exactly what each of them does because uh some of them take a bit of time to",
    "start": "2625359",
    "end": "2632000"
  },
  {
    "text": "install and i'm going to use that time to talk a little bit more about each of those tools",
    "start": "2632000",
    "end": "2637680"
  },
  {
    "text": "to get started let's first create our separate namespace because we want to have or",
    "start": "2637680",
    "end": "2643119"
  },
  {
    "text": "all of our logging infrastructure be running separately from our applications so let's create our login namespace our",
    "start": "2643119",
    "end": "2651280"
  },
  {
    "text": "next step is to create a kubernetes operator for elastic this is something that elastic provides",
    "start": "2651280",
    "end": "2657599"
  },
  {
    "text": "basically it just allows you to have special custom resources for deploying and managing elastic and",
    "start": "2657599",
    "end": "2664079"
  },
  {
    "text": "kibana clusters so let's go ahead and do that install the operator",
    "start": "2664079",
    "end": "2671440"
  },
  {
    "text": "cool and now we're ready to create our elastic cluster so this will be an elastic",
    "start": "2673520",
    "end": "2680160"
  },
  {
    "text": "server uh running um running in case",
    "start": "2680160",
    "end": "2685920"
  },
  {
    "text": "for this uh we have modified this slightly here from the example that they have in their docs because we're running on kind and",
    "start": "2685920",
    "end": "2692480"
  },
  {
    "text": "we don't have that much memory so we're adjusting resources to only run with one gigabyte",
    "start": "2692480",
    "end": "2698079"
  },
  {
    "text": "let's go ahead and copy this and create our elastic diameter here",
    "start": "2698079",
    "end": "2705838"
  },
  {
    "text": "and let's go ahead and apply that",
    "start": "2709200",
    "end": "2712640"
  },
  {
    "text": "all right um you can you can actually pretty nicely",
    "start": "2715760",
    "end": "2721760"
  },
  {
    "text": "check the health of the elasticsearch cluster again this is because of the how elastic is managing their custom",
    "start": "2721760",
    "end": "2729839"
  },
  {
    "text": "resource definitions but we can just watch that and wait for the changes to be applied",
    "start": "2729839",
    "end": "2736560"
  },
  {
    "text": "in the meantime i'm just going to go over and talk about some of the logging infrastructure and",
    "start": "2736560",
    "end": "2742079"
  },
  {
    "text": "how that works in case so when you're thinking about logging",
    "start": "2742079",
    "end": "2747760"
  },
  {
    "text": "uh oh one second oh i'll just talk like this",
    "start": "2747760",
    "end": "2754880"
  },
  {
    "text": "when you're thinking about logging in vms and logging in kubernetes is really not that much different",
    "start": "2754880",
    "end": "2760240"
  },
  {
    "text": "in vms you probably have some agents running together with your application and they're",
    "start": "2760240",
    "end": "2766079"
  },
  {
    "text": "forwarding your um logging directly to some sort of login platform in this case it's really not",
    "start": "2766079",
    "end": "2771839"
  },
  {
    "text": "that different except that everything is running in kubernetes pods so here you have your three kubernetes",
    "start": "2771839",
    "end": "2778000"
  },
  {
    "text": "hosts and you have some pods running on there and what you add is a lock forwarder",
    "start": "2778000",
    "end": "2783040"
  },
  {
    "text": "to each host and that log forwarder will look at all the pods on that particular",
    "start": "2783040",
    "end": "2788319"
  },
  {
    "text": "host and you can configure that to to forward logs to your specified log",
    "start": "2788319",
    "end": "2794400"
  },
  {
    "text": "storage and then that log storage in our case actually also is running on kubernetes but it doesn't have to be it could be",
    "start": "2794400",
    "end": "2799920"
  },
  {
    "text": "external it could be running in the cluster it really doesn't matter all right so that's kind of the basics",
    "start": "2799920",
    "end": "2806160"
  },
  {
    "text": "it's very similar to vms um and i'm going to explain a little bit more about like",
    "start": "2806160",
    "end": "2811520"
  },
  {
    "text": "what each piece does as we're continuing to install our logging stuff all right so",
    "start": "2811520",
    "end": "2820160"
  },
  {
    "text": "it looks like our elastic server has come up and it's green the next thing we're going to do is",
    "start": "2820160",
    "end": "2826400"
  },
  {
    "text": "deploy kibana and kibana is really just the ui that's kind of fronting the elastic",
    "start": "2826400",
    "end": "2834960"
  },
  {
    "text": "cluster so let's go ahead and create kibana digamol and then apply that",
    "start": "2834960",
    "end": "2844720"
  },
  {
    "text": "we can check the health of the cabana instance in a very similar way",
    "start": "2844720",
    "end": "2851200"
  },
  {
    "text": "we can watch that and these are probably i want to say the most memory intensive things we're installing",
    "start": "2851680",
    "end": "2858400"
  },
  {
    "text": "because all of them are like packaging a lot of things and their images could be quite",
    "start": "2858400",
    "end": "2863680"
  },
  {
    "text": "large so watch out for that docker memory that you've allocated and just if",
    "start": "2863680",
    "end": "2869920"
  },
  {
    "text": "you're running into any issues or pending containers or docker image pool errors just make",
    "start": "2869920",
    "end": "2876400"
  },
  {
    "text": "sure that you have that enough memory you go back to the prerequisites here",
    "start": "2876400",
    "end": "2882160"
  },
  {
    "text": "that look has covered in the beginning and just make sure you have enough memory",
    "start": "2882160",
    "end": "2887760"
  },
  {
    "text": "um so yeah so the what we have so far is the elastic cluster which is",
    "start": "2887760",
    "end": "2893119"
  },
  {
    "text": "our log storage right here additionally we're installing a ui in",
    "start": "2893119",
    "end": "2898720"
  },
  {
    "text": "front of it because really elastic server isn't great for visualizing and searching vlogs uh",
    "start": "2898720",
    "end": "2904079"
  },
  {
    "text": "just on its own so kibana will help us with that um let's",
    "start": "2904079",
    "end": "2912079"
  },
  {
    "text": "all right looks like we have our kibana uh running we can double check the health it's all green",
    "start": "2912079",
    "end": "2920000"
  },
  {
    "text": "and it's all good so our next step we're going to log in into our kibana instance and just make sure",
    "start": "2920000",
    "end": "2925760"
  },
  {
    "text": "that we can access things that we're allowed to access so far",
    "start": "2925760",
    "end": "2930800"
  },
  {
    "text": "let's grab our password first i'm going to copy that",
    "start": "2930800",
    "end": "2936240"
  },
  {
    "text": "and let's uh port forward the kibana service this will be running on port",
    "start": "2936240",
    "end": "2943880"
  },
  {
    "text": "5601 i'm gonna go ahead and start that you",
    "start": "2943880",
    "end": "2950559"
  },
  {
    "text": "have to say uh um accept the risk because we're using a custom ca so we really know what we're doing here",
    "start": "2950559",
    "end": "2959359"
  },
  {
    "text": "and once the ui loads just use the elastic username and then the password that we've copied",
    "start": "2959359",
    "end": "2968240"
  },
  {
    "text": "cool um and really when we go to the kibbanis",
    "start": "2969440",
    "end": "2977200"
  },
  {
    "text": "discover thing like we should be able to before we can start using kibana we have to",
    "start": "2977200",
    "end": "2982720"
  },
  {
    "text": "create an index so it can index the data that's stored in elasticsearch server",
    "start": "2982720",
    "end": "2990800"
  },
  {
    "text": "when we try to create an index we're seeing that there is no data yet and this is something that",
    "start": "2990800",
    "end": "2996160"
  },
  {
    "text": "we would expect because we haven't configured that forwarding part so far we just have the storage and the ui so let's go ahead and do that",
    "start": "2996160",
    "end": "3004559"
  },
  {
    "text": "uh for the forwarder we're going to use this tool called fluency and this tool is really uh kind of",
    "start": "3004559",
    "end": "3010319"
  },
  {
    "text": "standard in the for kubernetes and in general the cloud native space because it allows you to uh like",
    "start": "3010319",
    "end": "3018000"
  },
  {
    "text": "first of all parse and uh forward logs of any kind of format and then on the back end when it",
    "start": "3018000",
    "end": "3024240"
  },
  {
    "text": "forwards logs to some system it really is pluggable in many ways as well where you can configure it to",
    "start": "3024240",
    "end": "3032319"
  },
  {
    "text": "to send logs to any common log storage lock solution in our case we're using",
    "start": "3032319",
    "end": "3037520"
  },
  {
    "text": "elastic and it supports that as well so uh let's let's kind of take a look at",
    "start": "3037520",
    "end": "3044319"
  },
  {
    "text": "this fluency daemon set and really this damon said it's just",
    "start": "3044319",
    "end": "3051359"
  },
  {
    "text": "something that is a standard you can look at you can go to fluentd docs and take a look at that but i just",
    "start": "3051520",
    "end": "3058240"
  },
  {
    "text": "wanted to show you all these environment variables that we're setting here and those are really the only things you",
    "start": "3058240",
    "end": "3063680"
  },
  {
    "text": "have to modify to provide your elastic host a password potentially",
    "start": "3063680",
    "end": "3069599"
  },
  {
    "text": "like various ssl configuration and and that's pretty much it and i also",
    "start": "3069599",
    "end": "3076240"
  },
  {
    "text": "have to note that this is a daemon set and the daemon set in kubernetes is something that runs on every host",
    "start": "3076240",
    "end": "3082160"
  },
  {
    "text": "and as i mentioned before this is the architecture that we're looking at for you know we're looking for something",
    "start": "3082160",
    "end": "3088880"
  },
  {
    "text": "that can run on every host and then look at the logs so let's go ahead and apply that um",
    "start": "3088880",
    "end": "3096640"
  },
  {
    "text": "damon said i'm going to keep kibana running i want to interrupt that i'm just going to go to another terminal",
    "start": "3096640",
    "end": "3103119"
  },
  {
    "text": "window and go to i need to go into logging and then",
    "start": "3103119",
    "end": "3110240"
  },
  {
    "text": "run keep ctl apply fluentd",
    "start": "3110240",
    "end": "3115440"
  },
  {
    "text": "once applied we want to make sure that it's all good and running",
    "start": "3119680",
    "end": "3126160"
  },
  {
    "text": "it's not available yet but we can check the pods",
    "start": "3127119",
    "end": "3133040"
  },
  {
    "text": "so that should be pretty fast all right it's uh already running so we're good to go um now that saloon d is running it",
    "start": "3137440",
    "end": "3145119"
  },
  {
    "text": "should as soon as it starts running it should start forwarding logs immediately um so here we can just go to",
    "start": "3145119",
    "end": "3150559"
  },
  {
    "text": "our cabana ui and check for new data and we can see that it now detects that we have some data",
    "start": "3150559",
    "end": "3156480"
  },
  {
    "text": "so we're going to define our index called logs dash this is just the default name you can",
    "start": "3156480",
    "end": "3162640"
  },
  {
    "text": "change that if you wish but in our case that's what we're using go to next step for the time field we're just going to",
    "start": "3162640",
    "end": "3169119"
  },
  {
    "text": "use the defaults and then create our index pattern",
    "start": "3169119",
    "end": "3174880"
  },
  {
    "text": "next if we go to kind of the main ui we're seeing all the",
    "start": "3174880",
    "end": "3180319"
  },
  {
    "text": "logs are coming in from all kinds of various kubernetes system components",
    "start": "3180319",
    "end": "3185440"
  },
  {
    "text": "but we want to make sure that we're seeing our logs so let's go ahead and check for logs",
    "start": "3185440",
    "end": "3191280"
  },
  {
    "text": "that have our api label",
    "start": "3191280",
    "end": "3195839"
  },
  {
    "text": "all right let's run our query and great so we've seen our app logs in",
    "start": "3199200",
    "end": "3204240"
  },
  {
    "text": "kibana we're good to go",
    "start": "3204240",
    "end": "3209680"
  },
  {
    "text": "let's move over to the next step where we're going to configure metrics and with the metrics we kind of",
    "start": "3209680",
    "end": "3216480"
  },
  {
    "text": "have a similar sentiment where we have we want to make sure everything is running and everything is working",
    "start": "3216480",
    "end": "3223359"
  },
  {
    "text": "while we're trying to migrate our service to kubernetes especially that we want to make sure it's zero downtime",
    "start": "3223359",
    "end": "3229760"
  },
  {
    "text": "so that's why we need to instrument uh the metrics and in kubernetes",
    "start": "3229760",
    "end": "3236400"
  },
  {
    "text": "so without further ado i'm also going to dive right in and then i'm going to cover some of the metric infrastructure",
    "start": "3236400",
    "end": "3242079"
  },
  {
    "text": "in a little bit afterwards let's create our metrics namespace first",
    "start": "3242079",
    "end": "3249200"
  },
  {
    "text": "it'll be very similar to how we did logging i'm going to interrupt my kibana ui we",
    "start": "3249200",
    "end": "3255440"
  },
  {
    "text": "don't need that for now and uh for metrics we're going to be",
    "start": "3255440",
    "end": "3262240"
  },
  {
    "text": "using prometheus and grafana prometheus is a metric server and then grafana is the ui",
    "start": "3262240",
    "end": "3268960"
  },
  {
    "text": "similarly how elastic server is the server and then kibana is the ui and to install",
    "start": "3268960",
    "end": "3275680"
  },
  {
    "text": "these things we're just going to use the prometheus home chart and the grafina help chart",
    "start": "3275680",
    "end": "3280960"
  },
  {
    "text": "so let's go ahead and copy these lines to install the primitius helm chart we're not changing anything there we're",
    "start": "3280960",
    "end": "3288480"
  },
  {
    "text": "just using all the default configuration",
    "start": "3288480",
    "end": "3293839"
  },
  {
    "text": "all right so that should have kicked off the install",
    "start": "3293839",
    "end": "3300079"
  },
  {
    "text": "let's go ahead and do grafana right away as well we refunded this need to depend on",
    "start": "3300079",
    "end": "3305280"
  },
  {
    "text": "prometheus so it can be running kind of in parallel even if prometheus isn't ready",
    "start": "3305280",
    "end": "3310640"
  },
  {
    "text": "so let's go ahead and do that",
    "start": "3310640",
    "end": "3313920"
  },
  {
    "text": "and let's make sure that things are running",
    "start": "3316400",
    "end": "3321838"
  },
  {
    "text": "all right while these things are creating and getting ready i'm going to switch over to our slides and talk a",
    "start": "3324240",
    "end": "3329599"
  },
  {
    "text": "little bit about the matrix infrastructure here so first of all in",
    "start": "3329599",
    "end": "3338000"
  },
  {
    "text": "the model that prometheus is using for metrics this is called the pool model where the server is pulling the app for",
    "start": "3338000",
    "end": "3344559"
  },
  {
    "text": "the metrics data every zone so seconds for that the application itself needs to expose",
    "start": "3344559",
    "end": "3350319"
  },
  {
    "text": "uh slash metrics endpoint and then the prometheus will um query that endpoint every x",
    "start": "3350319",
    "end": "3358079"
  },
  {
    "text": "seconds which is a configurable amount in our case we're using whatever is the default on the helm chart but you can",
    "start": "3358079",
    "end": "3363920"
  },
  {
    "text": "look at the hum values to see how you can change that and tweak that for your use case",
    "start": "3363920",
    "end": "3369839"
  },
  {
    "text": "and then furthermore we have a grafana instance which is fronting the prometheus server that grafana instance will help us",
    "start": "3369839",
    "end": "3376960"
  },
  {
    "text": "display the logs and graph things in the beautiful way hopefully",
    "start": "3376960",
    "end": "3384160"
  },
  {
    "text": "all right so let's let's check if things are running looks like all the things are ready",
    "start": "3384160",
    "end": "3390480"
  },
  {
    "text": "as our next step we are going to note that in the output of your helm install for",
    "start": "3390480",
    "end": "3396559"
  },
  {
    "text": "griffin i'm just going to scroll back a little bit it tells you kind of how to log in so we're just going to follow",
    "start": "3396559",
    "end": "3402960"
  },
  {
    "text": "this first step where we will grab the user",
    "start": "3402960",
    "end": "3408400"
  },
  {
    "text": "password and copy that and then the next",
    "start": "3408400",
    "end": "3416480"
  },
  {
    "text": "in the next step we'll just port forward the grafina ui so we can access that locally",
    "start": "3416480",
    "end": "3423359"
  },
  {
    "text": "we will go to localhost port 3000",
    "start": "3425839",
    "end": "3433839"
  },
  {
    "text": "the username is admin and the password is the thing that we copy",
    "start": "3433920",
    "end": "3439839"
  },
  {
    "text": "so this is our grafana ui but it doesn't know about prometheus yet so our next step is to configure that prometheus",
    "start": "3439839",
    "end": "3445680"
  },
  {
    "text": "data source so go to configuration and add data source from bts is the first",
    "start": "3445680",
    "end": "3451760"
  },
  {
    "text": "suggestion conveniently and really the only thing we need here is the http url",
    "start": "3451760",
    "end": "3457280"
  },
  {
    "text": "which is by default http colon slash slash prometheus server",
    "start": "3457280",
    "end": "3464240"
  },
  {
    "text": "if you're using the home chart it really won't change for you as well cool so it's now working we should see",
    "start": "3464480",
    "end": "3473280"
  },
  {
    "text": "just kind of the default kubernetes metrics and i'm just going to show you",
    "start": "3473280",
    "end": "3478720"
  },
  {
    "text": "something just to make sure that it's working for example we can look",
    "start": "3478720",
    "end": "3484319"
  },
  {
    "text": "at response times of kubernetes rest client just to get a sense and looks like",
    "start": "3484319",
    "end": "3493359"
  },
  {
    "text": "it works and the response times are looking great as well so our next type step for metrics",
    "start": "3493359",
    "end": "3502079"
  },
  {
    "text": "is to change our application so we can our application is going to start to send metrics right now our application",
    "start": "3502079",
    "end": "3509040"
  },
  {
    "text": "isn't configured to expose that metrics endpoint that i've talked about and we need to make a few changes to it",
    "start": "3509040",
    "end": "3515440"
  },
  {
    "text": "to allow that so i'm going to go to our",
    "start": "3515440",
    "end": "3524960"
  },
  {
    "text": "oh apologies so i'm going to open our deployment.yml",
    "start": "3524960",
    "end": "3531839"
  },
  {
    "text": "okay one second where there we go so in our deployment then",
    "start": "3534559",
    "end": "3542240"
  },
  {
    "text": "yaml we have to do a few things first of all we have to enable our",
    "start": "3542240",
    "end": "3547520"
  },
  {
    "text": "application to expose the metrics endpoint and in our case all it's doing and it's",
    "start": "3547520",
    "end": "3555760"
  },
  {
    "text": "it's just taking an environment variable so we have to add it under the containers stanza here",
    "start": "3555760",
    "end": "3563520"
  },
  {
    "text": "oh okay there we go hopefully this will work",
    "start": "3565680",
    "end": "3570960"
  },
  {
    "text": "um and then next we will need to add annotations to our pod and as luke was talking about",
    "start": "3570960",
    "end": "3579359"
  },
  {
    "text": "how deployment and pod are kind of nested within each other we have to make sure that those annotations",
    "start": "3579359",
    "end": "3584880"
  },
  {
    "text": "are on the pod metadata not on the deployment metadata so",
    "start": "3584880",
    "end": "3591200"
  },
  {
    "text": "let's go ahead and do that as well this is our pod metadata",
    "start": "3591200",
    "end": "3600079"
  },
  {
    "text": "so okay um so that should enable the",
    "start": "3600079",
    "end": "3606559"
  },
  {
    "text": "prometheus server to look for this app's uh metrics endpoint and scrape them",
    "start": "3606559",
    "end": "3612319"
  },
  {
    "text": "so let's go ahead and apply that",
    "start": "3612319",
    "end": "3616319"
  },
  {
    "text": "i had a feeling this will happen if this is happening to you as well you can just grab this radio",
    "start": "3617599",
    "end": "3625359"
  },
  {
    "text": "deployment.yml and use that instead",
    "start": "3626839",
    "end": "3635119"
  },
  {
    "text": "all right",
    "start": "3637119",
    "end": "3643760"
  },
  {
    "text": "and that is all because yaml is hard so as you can see we have our old pod",
    "start": "3643760",
    "end": "3651119"
  },
  {
    "text": "terminating and the new pod starting up with this new configuration",
    "start": "3651119",
    "end": "3656960"
  },
  {
    "text": "we should also go to our app and just kind of try to",
    "start": "3656960",
    "end": "3662400"
  },
  {
    "text": "generate some metrics by just going to localhost",
    "start": "3662400",
    "end": "3668839"
  },
  {
    "text": "oh maybe not this local host",
    "start": "3668839",
    "end": "3673440"
  },
  {
    "text": "but the one that's running in kids let's just kind of do that a few times so we generate some new metrics",
    "start": "3676640",
    "end": "3683119"
  },
  {
    "text": "and now when we go to grafana we should be able to see our app specific metrics",
    "start": "3683119",
    "end": "3689040"
  },
  {
    "text": "so i'm going to refresh that page and one of the metrics that we have is",
    "start": "3689040",
    "end": "3694400"
  },
  {
    "text": "how many times has the server service started so let's take a look at that and we have",
    "start": "3694400",
    "end": "3699680"
  },
  {
    "text": "that metrics that metric has come in it's called a service service started total we should see that",
    "start": "3699680",
    "end": "3706559"
  },
  {
    "text": "it has started a total of one times which is true and the last thing which i'm not quite",
    "start": "3706559",
    "end": "3713359"
  },
  {
    "text": "sure that this will work quite yet but we can look at the response times that this app",
    "start": "3713359",
    "end": "3719039"
  },
  {
    "text": "will have currently has",
    "start": "3719039",
    "end": "3722960"
  },
  {
    "text": "it doesn't look like we have that quite yet let me try another query",
    "start": "3725520",
    "end": "3732400"
  },
  {
    "text": "it's possible that we'll just need to generate a little bit more",
    "start": "3733440",
    "end": "3739200"
  },
  {
    "text": "metrics but that's okay because we know that the metrics are coming in because we've seen that other counter that has",
    "start": "3739520",
    "end": "3745359"
  },
  {
    "text": "started all right so at this point you have the logs and you have the metrics configured",
    "start": "3745359",
    "end": "3752480"
  },
  {
    "text": "and we're ready to migrate",
    "start": "3752480",
    "end": "3756400"
  },
  {
    "text": "all right so remember how um luke has mentioned that we're just going",
    "start": "3758480",
    "end": "3764000"
  },
  {
    "text": "to switch our dns right now just to recap we still have",
    "start": "3764000",
    "end": "3769920"
  },
  {
    "text": "our web running and we still have our",
    "start": "3769920",
    "end": "3777119"
  },
  {
    "text": "api running locally so if i go to localhost",
    "start": "3777359",
    "end": "3783839"
  },
  {
    "text": "port 8080 i feel like",
    "start": "3785119",
    "end": "3791119"
  },
  {
    "text": "we should see that we're still pointing at vms",
    "start": "3792480",
    "end": "3797838"
  },
  {
    "text": "and if i go to the ui part you can see that it's still running in vms",
    "start": "3798480",
    "end": "3807599"
  },
  {
    "text": "so now to migrate uh we want to make sure that um basically we just want to point that",
    "start": "3808160",
    "end": "3814319"
  },
  {
    "text": "dns at the new ip and in our case we're using this ipv6 because",
    "start": "3814319",
    "end": "3822880"
  },
  {
    "text": "any ip that is not a one two seven zero zero one will default to that um basically",
    "start": "3822880",
    "end": "3829520"
  },
  {
    "text": "uh the one that's listening on all interfaces because remember we have uh one uh that's listening",
    "start": "3829520",
    "end": "3837200"
  },
  {
    "text": "on ip127001 and then we have another one which is the kind ingress that's running on all interfaces",
    "start": "3837200",
    "end": "3844720"
  },
  {
    "text": "so basically we just want to choose an ip that our machine understands but the one that is not going to route",
    "start": "3844720",
    "end": "3850880"
  },
  {
    "text": "to this vm one this is not really of course something you're going to do in real vms",
    "start": "3850880",
    "end": "3858160"
  },
  {
    "text": "but this is these are the constraints that we're operating so let's go ahead and change",
    "start": "3858160",
    "end": "3865200"
  },
  {
    "text": "our etsy hosts",
    "start": "3865200",
    "end": "3868558"
  },
  {
    "text": "so you should have this line that's pointing at api i'm going to",
    "start": "3874559",
    "end": "3883039"
  },
  {
    "text": "change that to use the ipv6 localhost and save that",
    "start": "3883039",
    "end": "3889440"
  },
  {
    "text": "and now if i go to my",
    "start": "3891039",
    "end": "3895839"
  },
  {
    "text": "web i'm seeing that it's now pointing at api case which is great awesome we've switched",
    "start": "3896319",
    "end": "3902559"
  },
  {
    "text": "over we're now we haven't restarted our web at all it's just pointing to our new kubernetes",
    "start": "3902559",
    "end": "3908480"
  },
  {
    "text": "service which is great um and the last part",
    "start": "3908480",
    "end": "3913680"
  },
  {
    "text": "is um let's just double check that our metrics are coming in for um from web going to api",
    "start": "3913680",
    "end": "3922319"
  },
  {
    "text": "so again here i'm going to um kind of refresh this a few times because",
    "start": "3922319",
    "end": "3927839"
  },
  {
    "text": "to mimic kind of a real back-end service that is probably calling the api",
    "start": "3927839",
    "end": "3933000"
  },
  {
    "text": "continuously um and as the last step",
    "start": "3933000",
    "end": "3940480"
  },
  {
    "text": "i'm going to check that these metrics are in grafana i do not know if they will appear",
    "start": "3940480",
    "end": "3945520"
  },
  {
    "text": "hopefully they will",
    "start": "3945520",
    "end": "3950799"
  },
  {
    "text": "cool so um what this is doing is uh checking the um request",
    "start": "3950799",
    "end": "3957760"
  },
  {
    "text": "the rate at which the requests are coming in in the last five minutes and we can see that all of a sudden this",
    "start": "3957760",
    "end": "3963839"
  },
  {
    "text": "has picked up to a new value of 0.06 so yay this is",
    "start": "3963839",
    "end": "3969440"
  },
  {
    "text": "how we know that it's running our metrics are showing up great we're all healthy and we have migrated",
    "start": "3969440",
    "end": "3975280"
  },
  {
    "text": "to gates um",
    "start": "3975280",
    "end": "3981440"
  },
  {
    "text": "so at this point i uh let's just kind of go over what we have",
    "start": "3982160",
    "end": "3987520"
  },
  {
    "text": "just accomplished we had our api and",
    "start": "3987520",
    "end": "3993440"
  },
  {
    "text": "our web and our api pointing to this one two seven zero zero one port and then we switched it over to the",
    "start": "3993440",
    "end": "3999200"
  },
  {
    "text": "one that's pointing to nginx and in the vmworld you would do",
    "start": "3999200",
    "end": "4004799"
  },
  {
    "text": "something similar where you'll take your dns entry for api.company.com and you",
    "start": "4004799",
    "end": "4010880"
  },
  {
    "text": "will switch it over to let's say your nginx load bouncer",
    "start": "4010880",
    "end": "4016160"
  },
  {
    "text": "as as shown here um and i i think we've already",
    "start": "4016640",
    "end": "4024720"
  },
  {
    "text": "covered step seven so where we are right now and what we did",
    "start": "4024720",
    "end": "4029839"
  },
  {
    "text": "let's recap that we have built a docker image we",
    "start": "4029839",
    "end": "4035039"
  },
  {
    "text": "deployed that to kubernetes using a kubernetes deployment we've added a kubernetes service and a",
    "start": "4035039",
    "end": "4040960"
  },
  {
    "text": "kubernetes ingress so that we can reach it locally we've added logging and metrics to our",
    "start": "4040960",
    "end": "4046240"
  },
  {
    "text": "app and then finally perform that zero no zero downtime migration where we",
    "start": "4046240",
    "end": "4051680"
  },
  {
    "text": "switched over our one of our services and pointed it at the one running in queue and as our last step",
    "start": "4051680",
    "end": "4060799"
  },
  {
    "text": "we're we're gonna cover the console service mesh uh luke do you do you wanna talk about",
    "start": "4060799",
    "end": "4066079"
  },
  {
    "text": "that yeah uh before we get into that let's just go to the next slide there and chat a little bit about what we did",
    "start": "4066079",
    "end": "4072400"
  },
  {
    "text": "let's do that there's a couple things uh to think about here i know this was kind of like",
    "start": "4072400",
    "end": "4077440"
  },
  {
    "text": "a constrained example um and so let's kind of talk about like at a higher level kind of general",
    "start": "4077440",
    "end": "4083680"
  },
  {
    "text": "lessons and things about adopting kubernetes and that might be useful to new folks to the to the ecosystem",
    "start": "4083680",
    "end": "4088960"
  },
  {
    "text": "so uh i've personally done like a kubernetes migration at two different companies and i think i just want to like give",
    "start": "4088960",
    "end": "4096640"
  },
  {
    "text": "some advice to folks who are doing it for the first time um so keep it simple the",
    "start": "4096640",
    "end": "4102159"
  },
  {
    "text": "the second you start using new tooling you get really excited and you want to use all the new tools that exist in the",
    "start": "4102159",
    "end": "4107920"
  },
  {
    "text": "ecosystem so like the stuff we just showed you like you know your elasticsearch and your fluency you want to use prometheus and grafana",
    "start": "4107920",
    "end": "4114318"
  },
  {
    "text": "you want to use a service mesh you want to use all those new things right and so what i what i what i caution folks is",
    "start": "4114319",
    "end": "4120159"
  },
  {
    "text": "keep it simple don't try to set up this brand new beautiful platform in the sky focus on",
    "start": "4120159",
    "end": "4126960"
  },
  {
    "text": "what you really want to do which is get your app onto kubernetes and i would encourage you to use the",
    "start": "4126960",
    "end": "4132798"
  },
  {
    "text": "existing tooling so if you already have something you're using for metrics don't switch to a new metrics provider",
    "start": "4132799",
    "end": "4137920"
  },
  {
    "text": "use um use whatever tooling existing kubernetes to get your metrics into your existing metrics provider okay",
    "start": "4137920",
    "end": "4144238"
  },
  {
    "text": "if you already have existing logging system use fluid d but then get it into your existing logging system don't switch to any",
    "start": "4144239",
    "end": "4150080"
  },
  {
    "text": "logging system and and the reason i recommend that is because you really want to be focused on like what provides the most value to",
    "start": "4150080",
    "end": "4155120"
  },
  {
    "text": "your organization and that's going to be having your app running kubernetes once you've got that process",
    "start": "4155120",
    "end": "4160480"
  },
  {
    "text": "smooth and oiled out you have your build pipelines and everything set up you can deploy over there you know your migration is good because you're looking at metrics and everything it's a",
    "start": "4160480",
    "end": "4166960"
  },
  {
    "text": "lot easier to start moving things over and kind of picking that up and eventually you can switch to that that new",
    "start": "4166960",
    "end": "4172880"
  },
  {
    "text": "tool that you really wanted to use but if you start jumping and trying all these using these things at once when something goes wrong it's going to be",
    "start": "4172880",
    "end": "4178560"
  },
  {
    "text": "like there's like 100 things that could have gone wrong you're not 100 percent certain like what part of it went wrong and so i think like i really",
    "start": "4178560",
    "end": "4184400"
  },
  {
    "text": "want to caution folks like keep it simple uh to start kind of focus on providing value getting your app into communities",
    "start": "4184400",
    "end": "4190080"
  },
  {
    "text": "getting that first migration piece done that in and of itself is gonna be a ton of work uh don't don't don't get me wrong",
    "start": "4190080",
    "end": "4195679"
  },
  {
    "text": "because like if you're moving from vms to kubernetes this is a whole new set of things you have to deal with especially around builds and security",
    "start": "4195679",
    "end": "4201840"
  },
  {
    "text": "and access we did make it look pretty easy here but there's a lot of things that we didn't kind of show you what you need to figure",
    "start": "4201840",
    "end": "4207679"
  },
  {
    "text": "out so keep it simple don't try to use all the new shiny new tools unless it actually really makes sense for your use case",
    "start": "4207679",
    "end": "4213679"
  },
  {
    "text": "um irena do you want to cover the next two um yeah and um definitely one two plus one uh things",
    "start": "4213679",
    "end": "4219679"
  },
  {
    "text": "that you've just said like the tooling that we've shown um is is not necessary is just showing an example and",
    "start": "4219679",
    "end": "4226719"
  },
  {
    "text": "definitely keep your existing tools um one thing i wanted to highlight is just the",
    "start": "4226719",
    "end": "4232000"
  },
  {
    "text": "kubernetes ecosystem is a really rich ecosystem that has a lot of tools and if you're using something",
    "start": "4232000",
    "end": "4237600"
  },
  {
    "text": "um out that it was different from what we've shown like the likelihood is that that tool",
    "start": "4237600",
    "end": "4242800"
  },
  {
    "text": "or an integration with that tool already exists in the ecosystem so i would definitely encourage you to look",
    "start": "4242800",
    "end": "4248000"
  },
  {
    "text": "uh and find things that are already implemented and then the last piece that i wanted to",
    "start": "4248000",
    "end": "4253520"
  },
  {
    "text": "highlight is security and we kind of i've alluded to that where we have our last step where we're",
    "start": "4253520",
    "end": "4259520"
  },
  {
    "text": "talking about a service mesh and really a kubernetes is a service mesh in in some ways",
    "start": "4259520",
    "end": "4265120"
  },
  {
    "text": "but it doesn't have any of the security features of a service mesh right now everything within our cluster",
    "start": "4265120",
    "end": "4270159"
  },
  {
    "text": "our nginx ingress that's talking to our api service all of that is in plain text",
    "start": "4270159",
    "end": "4276159"
  },
  {
    "text": "and if you want to increase like to step up the security especially the security and the",
    "start": "4276159",
    "end": "4281760"
  },
  {
    "text": "networking within the cluster then i would highly encourage you to look into something like a service mesh",
    "start": "4281760",
    "end": "4288000"
  },
  {
    "text": "because it can add um like this kind of mutual tls encryption by default",
    "start": "4288000",
    "end": "4293520"
  },
  {
    "text": "um and this is you know like definitely don't do it as the first step but as the",
    "start": "4293520",
    "end": "4298719"
  },
  {
    "text": "next step in your migration you might want to consider uh you know thinking about things like",
    "start": "4298719",
    "end": "4304080"
  },
  {
    "text": "security and zero trust networking to just kind of increase and harden your cluster and the services that are",
    "start": "4304080",
    "end": "4309600"
  },
  {
    "text": "running in that cluster yeah absolutely and that's that's a great segue uh i'm",
    "start": "4309600",
    "end": "4316000"
  },
  {
    "text": "going to talk about that quickly just going to go through the console service mesh next i'm actually going to pause here uh so i",
    "start": "4316000",
    "end": "4321199"
  },
  {
    "text": "can get caught up with all the work irina's done and then when i resume the recording i'll be all caught up and we can just uh try out console",
    "start": "4321199",
    "end": "4326560"
  },
  {
    "text": "server smash all right and we're back uh i've got everything caught up now with all the work i read ended",
    "start": "4326560",
    "end": "4331840"
  },
  {
    "text": "and so we're just gonna do a really quick demo of console service mesh um and how it might be useful if you have like a larger deployment you have a",
    "start": "4331840",
    "end": "4337840"
  },
  {
    "text": "little bit more complexity involved so let me just share my screen here",
    "start": "4337840",
    "end": "4343520"
  },
  {
    "text": "so i gotta catch up to here okay so what we have uh is we have our browser",
    "start": "4343520",
    "end": "4349120"
  },
  {
    "text": "talking to web he's talking over to nginx and it's talking over to api so like irene said there isn't uh right",
    "start": "4349120",
    "end": "4355120"
  },
  {
    "text": "now like it's all done in plain text so web's talking to engine x so we're playing text and nginx talks to api or playtex",
    "start": "4355120",
    "end": "4360400"
  },
  {
    "text": "and so one of the benefits of the service mess that it can bring is a mutual tls so the idea we have tls that",
    "start": "4360400",
    "end": "4366320"
  },
  {
    "text": "goes across the whole connection here and the other thing that a service mesh can bring is what basically it does is",
    "start": "4366320",
    "end": "4372000"
  },
  {
    "text": "it sets up proxies in front of everything and so these proxies are now programmable you can",
    "start": "4372000",
    "end": "4377679"
  },
  {
    "text": "you can change the requests to to do whatever you want with them and so what i want to do is a really",
    "start": "4377679",
    "end": "4382880"
  },
  {
    "text": "quick demo here of uh we're going to swap out nginx for uh console ingress gateway we're",
    "start": "4382880",
    "end": "4389040"
  },
  {
    "text": "going to put a proxy in front of the api service here so it's going to be part of the mesh and then we're going to show you some of",
    "start": "4389040",
    "end": "4394960"
  },
  {
    "text": "the cool like routing capabilities we have uh when this api service is now part of the mesh what we're gonna do is we're gonna have api like",
    "start": "4394960",
    "end": "4400960"
  },
  {
    "text": "be really buggy service have lots of errors then we're gonna use our routing rules to say okay well if there's an error just retry it so",
    "start": "4400960",
    "end": "4408320"
  },
  {
    "text": "this might be something useful in your migration if you if you were finding like obviously you should look into why there's lots of errors but uh in this case you",
    "start": "4408320",
    "end": "4414640"
  },
  {
    "text": "might might be something useful to like kind of the stopgap measure and we have all this documented here in workshop uh workshop step eight",
    "start": "4414640",
    "end": "4421760"
  },
  {
    "text": "so let's go over here into step eight here so in this section what we're going to do is we're going to install console on",
    "start": "4421760",
    "end": "4427679"
  },
  {
    "text": "our kubernetes cluster and then we're going to configure it so the first thing we need to do is actually need to uninstall nginx um",
    "start": "4427679",
    "end": "4433440"
  },
  {
    "text": "that's because nginx is kind of listing in place there on port 80. uh we could do this and we could have our skate we listed on a",
    "start": "4433440",
    "end": "4438960"
  },
  {
    "text": "different port but then our nice routing where the web the web service doesn't know it always talking 480 that wouldn't work",
    "start": "4438960",
    "end": "4444320"
  },
  {
    "text": "so in this case we're just going to take the the quick road here is delete nginx here",
    "start": "4444320",
    "end": "4450080"
  },
  {
    "text": "so let's uninstall nginx here and now like we can't we're free to install console so the first thing we want to do is we",
    "start": "4450080",
    "end": "4456239"
  },
  {
    "text": "need to add our helm repo so a console is installed by a helm",
    "start": "4456239",
    "end": "4461520"
  },
  {
    "text": "and then we're going to create a values.yaml file for our installation so this is what's used to configure your",
    "start": "4462080",
    "end": "4468640"
  },
  {
    "text": "your helm installation so so a couple things to note here um one we're using one replica for the",
    "start": "4468640",
    "end": "4475600"
  },
  {
    "text": "console servers now usually you want to use three but uh you want them spread across three different nodes so if node one",
    "start": "4475600",
    "end": "4481600"
  },
  {
    "text": "node goes down the other two are up they still have quorum everything works fine uh in kind there's only one node so",
    "start": "4481600",
    "end": "4486640"
  },
  {
    "text": "we're gonna set this to one for this example here this is a connect inject what this",
    "start": "4486640",
    "end": "4491840"
  },
  {
    "text": "does is it says i want you to inject a sidecar so a sidecar is just another container remember how way back when we talked",
    "start": "4491840",
    "end": "4498080"
  },
  {
    "text": "about how pods can have multiple containers this is where this is really useful so we can actually inject a proxy",
    "start": "4498080",
    "end": "4503440"
  },
  {
    "text": "as a sidecar container so it's just a container that runs in the pod and what this is doing is it's going to automatically inject it so you don't",
    "start": "4503440",
    "end": "4509360"
  },
  {
    "text": "have to like set it up in your deployment.yaml but it's going to when it sees that podcast it's actually going to automatically inject",
    "start": "4509360",
    "end": "4514719"
  },
  {
    "text": "our proxy into there this controller here is allowing us to use our custom",
    "start": "4514719",
    "end": "4519840"
  },
  {
    "text": "resource definitions which is newly out in the beta on console beta and then here we're setting up our ingress gateways so this",
    "start": "4519840",
    "end": "4525840"
  },
  {
    "text": "is going to replace our nginx ingress controller uh so we're setting up our gateway here and it's going to be running on 480.",
    "start": "4525840",
    "end": "4532000"
  },
  {
    "text": "so let's save that file and then we're going to run a helm install and don't try to keep ctl apply that",
    "start": "4532000",
    "end": "4537120"
  },
  {
    "text": "because that's not going to work so we're going to run a helmet stall here and we're going to point to that",
    "start": "4537120",
    "end": "4542320"
  },
  {
    "text": "so i'm going to open up another tab over here just so we can just watch that so watch keep ctl",
    "start": "4542480",
    "end": "4549280"
  },
  {
    "text": "and it's a bit ugly so i'll make it a little smaller but basically uh we have our console",
    "start": "4551040",
    "end": "4556960"
  },
  {
    "text": "services coming up here so this is going to take about two to three minutes what is happening it's a",
    "start": "4556960",
    "end": "4563120"
  },
  {
    "text": "little bit sometimes a little bit slow because we're running on kind but what we're getting if we look at the components here let's open this up a",
    "start": "4563120",
    "end": "4568400"
  },
  {
    "text": "little bit wider okay this okay there we go so let's look at the components we get so here's api",
    "start": "4568400",
    "end": "4574239"
  },
  {
    "text": "it's running it's you know doing its thing we haven't made any changes to it then we have our console server so this",
    "start": "4574239",
    "end": "4581199"
  },
  {
    "text": "is the where all our data is stored and this is what we we said we only want one replica of um then we have our",
    "start": "4581199",
    "end": "4587760"
  },
  {
    "text": "angular gateway this is a currently in an error state because the rest of the cluster is kind of up and coming so you can see here like this console here",
    "start": "4587760",
    "end": "4594000"
  },
  {
    "text": "this is a what's called a console agent and the ingress gateway relies on that console agent so this needs to be running for the gateway",
    "start": "4594000",
    "end": "4600560"
  },
  {
    "text": "to actually work you can see here now that the console agent is ready that this is coming up",
    "start": "4600560",
    "end": "4606719"
  },
  {
    "text": "so this is what we're actually going to be it's actually going to be listing on 480 this is what we're going to hit to get it all working",
    "start": "4606719",
    "end": "4612080"
  },
  {
    "text": "so i'm going to make this smaller here this should soon uh be market itself as ready but i'm immediately going to make some changes",
    "start": "4612080",
    "end": "4617920"
  },
  {
    "text": "to it so well we don't really have support right now for listening on a host port for the ingress gateway because it's",
    "start": "4617920",
    "end": "4623199"
  },
  {
    "text": "made more for like running a cloud so we're just going to do a little bit of a cube ctl patch here to actually patch that deployment so it",
    "start": "4623199",
    "end": "4629440"
  },
  {
    "text": "listens on the right port so um i'm going to run this command here",
    "start": "4629440",
    "end": "4635199"
  },
  {
    "text": "qctl patch and it's going to patch that deployment so it's running on the the expected port",
    "start": "4635199",
    "end": "4641199"
  },
  {
    "text": "which is port 80. so then it's going to be bound to the same port as nginx and so we'll actually be able to come through it",
    "start": "4641199",
    "end": "4647520"
  },
  {
    "text": "and so we can run this rollout status command and we can watch to make sure that that rollout is actually complete um",
    "start": "4648800",
    "end": "4655920"
  },
  {
    "text": "but what i'm going to do is kind of fast forward here so i don't want to take too long here so uh while that's all coming up we can",
    "start": "4655920",
    "end": "4661920"
  },
  {
    "text": "actually look at the console ui so we're going to do a port forward here and it's going to port forward a local",
    "start": "4661920",
    "end": "4667199"
  },
  {
    "text": "8500 so if we go over here to the vocal host 8500 ui we should be able to see our console",
    "start": "4667199",
    "end": "4673120"
  },
  {
    "text": "ui so this is a list of all the services that are in our service mesh right now there isn't any we can see our console",
    "start": "4673120",
    "end": "4680080"
  },
  {
    "text": "instance which is running as we expected and then our english gateway here is starting to come up we have like one instance coming up and then there was",
    "start": "4680080",
    "end": "4686080"
  },
  {
    "text": "that that new one coming up on port 80 that we're kind of waiting uh for it to be running",
    "start": "4686080",
    "end": "4692000"
  },
  {
    "text": "um yeah so it should come up soon and then we'll be good to go",
    "start": "4692000",
    "end": "4697760"
  },
  {
    "text": "so now we look over here we see that you know we have our list of services but there",
    "start": "4697760",
    "end": "4702880"
  },
  {
    "text": "is no api running so we go back to our notes here what we want is we want api to be part of the service",
    "start": "4702880",
    "end": "4708640"
  },
  {
    "text": "mesh now it's not going to get automatically injected with that sidecar we wouldn't want uh constant service messages injecting everything really",
    "start": "4708640",
    "end": "4714640"
  },
  {
    "text": "nearly so you actually have to annotate that service that says hey please and please inject me with a sidecar so to do that what we're going",
    "start": "4714640",
    "end": "4720640"
  },
  {
    "text": "to do is we're going to use that patch command again and we're going to add an annotation that says hey inject me with a sidecar",
    "start": "4720640",
    "end": "4728000"
  },
  {
    "text": "so let's run that patch command here and we can see here that api is now starting to",
    "start": "4728880",
    "end": "4734000"
  },
  {
    "text": "come up and you can see here it has a zero three so this is actually the number of containers so previously we had one now we have",
    "start": "4734000",
    "end": "4739920"
  },
  {
    "text": "three so what's going on there so this is the injection right so we're getting our sidecar which is running our proxy and we're also getting another",
    "start": "4739920",
    "end": "4745520"
  },
  {
    "text": "sidecar that's like a helper container it helps with dealing with the life cycle of these pods so if we go back now",
    "start": "4745520",
    "end": "4751920"
  },
  {
    "text": "over to our console ui we should see api and here we do we see an api and it's",
    "start": "4751920",
    "end": "4758320"
  },
  {
    "text": "connected with proxy so it's all up and running as we expect it's now part of the service mesh it's got its proxy running next to it uh",
    "start": "4758320",
    "end": "4764960"
  },
  {
    "text": "but we're not done yet we need to just like we had to configure nginx um to to route to a service via the",
    "start": "4764960",
    "end": "4770719"
  },
  {
    "text": "ingress object we need to uh configure our ingress gateway console to route to the api service we don't want to just expose any service",
    "start": "4770719",
    "end": "4776880"
  },
  {
    "text": "you know we have to actually explicitly um say that we want it so the first thing we're going to do",
    "start": "4776880",
    "end": "4782159"
  },
  {
    "text": "is we're going to uh set the protocol for our api service to http and this is so we we know what",
    "start": "4782159",
    "end": "4788880"
  },
  {
    "text": "protocol it's using and we can actually provide better metrics that way because we know that it's using http and not",
    "start": "4788880",
    "end": "4793920"
  },
  {
    "text": "tcp so we're going to apply that okay and then we do qtl",
    "start": "4793920",
    "end": "4801840"
  },
  {
    "text": "service defaults just to make sure that's working as effective and it says it's sync true so that means that worked",
    "start": "4801840",
    "end": "4808560"
  },
  {
    "text": "then we're going to configure an ingress gateway um i'm going to i can show you what this json is in a second so let's see this",
    "start": "4808560",
    "end": "4817199"
  },
  {
    "text": "this youtube oh we're just gonna wrap it",
    "start": "4817199",
    "end": "4824880"
  },
  {
    "text": "so here we're saying hey ingress gateway listen on port 80 and you're using http protocol and we",
    "start": "4825280",
    "end": "4831520"
  },
  {
    "text": "say okay we want you to route to api when you get a request in uh for api make sure you're out to avi",
    "start": "4831520",
    "end": "4838639"
  },
  {
    "text": "so this is going to configure the interstate ready to render our api service that's running so if you look over here you should see",
    "start": "4838639",
    "end": "4843760"
  },
  {
    "text": "in this gateway here we should see that it's configured throughout the api so that's all that's",
    "start": "4843760",
    "end": "4849199"
  },
  {
    "text": "needed so we've set this all up here we have our ingress gateway routing to api with this proxy",
    "start": "4849199",
    "end": "4854480"
  },
  {
    "text": "so we should be able to go to this here actually see that working",
    "start": "4854480",
    "end": "4861840"
  },
  {
    "text": "and we do we see now that we're running through the interstate we've placed the nginx gateway okay so you're thinking like hey well so",
    "start": "4862000",
    "end": "4867920"
  },
  {
    "text": "what what's the point of replacing in the ingress gateway you know that was already working for me",
    "start": "4867920",
    "end": "4873280"
  },
  {
    "text": "and i'll just show here we're hitting our web service and you can see here that we're actually getting this new uh header added here so this is actually",
    "start": "4873280",
    "end": "4879280"
  },
  {
    "text": "the proxy that's adding these headers so you can see that it's actually going fully through so one big benefit we have already is that we now have tls",
    "start": "4879280",
    "end": "4885760"
  },
  {
    "text": "going in between the ingress gateway and our application here and this certificate for this is totally provisioned like",
    "start": "4885760",
    "end": "4890960"
  },
  {
    "text": "uh by consoles so you don't have to deal with like provisioning certificates and everything like that it all happens automatically and if anyone is listening in your",
    "start": "4890960",
    "end": "4896639"
  },
  {
    "text": "cluster to um traffic then now it's encrypted so they can't actually like sweep that traffic but i also want to do",
    "start": "4896639",
    "end": "4902960"
  },
  {
    "text": "a really quick demo of kind of the power that you have now you have these proxies in front of everything so what we're going to do is we're",
    "start": "4902960",
    "end": "4908480"
  },
  {
    "text": "actually going to cause our service to to have failures so luckily the service has support something where you can",
    "start": "4908480",
    "end": "4914239"
  },
  {
    "text": "actually set an error rate and uh this is our api service i'm talking about and you know what it'll do is you set to",
    "start": "4914239",
    "end": "4919679"
  },
  {
    "text": "0.5 50 requests of the service are just going to fail it's going to fail out right so let's do that so we should see",
    "start": "4919679",
    "end": "4928080"
  },
  {
    "text": "api start to come up here with the new oh excuse me for the rollout",
    "start": "4928080",
    "end": "4934880"
  },
  {
    "text": "we have the new one coming up here and now we make requests to it we're actually going to see half of them fail so this is probably not ideal right so",
    "start": "4936800",
    "end": "4944719"
  },
  {
    "text": "if we do this curl again we see it's not healthy",
    "start": "4944719",
    "end": "4950480"
  },
  {
    "text": "if we look over here uh okay i think",
    "start": "4950719",
    "end": "4958159"
  },
  {
    "text": "yeah i think i know what's happening here okay so if we curl here okay so this is what",
    "start": "4958159",
    "end": "4965199"
  },
  {
    "text": "i wanted to show you so if we curl here and we can see that this this request succeeded with 200 but then this request failed",
    "start": "4965199",
    "end": "4971199"
  },
  {
    "text": "with 500 i curled again you can see here again it's getting 200 curl again it's failing to the 500",
    "start": "4971199",
    "end": "4978000"
  },
  {
    "text": "so this is really not ideal right and so this is where kind of we have the power",
    "start": "4978000",
    "end": "4983120"
  },
  {
    "text": "of the service mesh so why don't we just tell the proxy that's running over here this",
    "start": "4983120",
    "end": "4988320"
  },
  {
    "text": "the ingress gate is it's also a proxy right let's just tell it to retry requests uh to have a 500.",
    "start": "4988320",
    "end": "4993679"
  },
  {
    "text": "i mean it's a bit of a band-aid text you should probably look into why your services 500 but this could be really something that's valuable for a short-term fix or",
    "start": "4993679",
    "end": "4999840"
  },
  {
    "text": "something like that so all we need to do is create a new crd called a service router",
    "start": "4999840",
    "end": "5005920"
  },
  {
    "text": "and we look into it spec here it's saying i want you to retry up to three times whenever you see a 500. so let's apply",
    "start": "5005920",
    "end": "5012840"
  },
  {
    "text": "that",
    "start": "5012840",
    "end": "5015840"
  },
  {
    "text": "and we'll do cube ctl get service router to make sure that apply properly so it",
    "start": "5018320",
    "end": "5024080"
  },
  {
    "text": "says it's synced true so now let's go back to this curl",
    "start": "5024080",
    "end": "5029840"
  },
  {
    "text": "we're not seeing any errors so this is uh pretty cool you can see that the duration is actually changing",
    "start": "5030800",
    "end": "5037280"
  },
  {
    "text": "um that's because like so that one you know that one took a while that's probably because that one we tried three times right",
    "start": "5037280",
    "end": "5043040"
  },
  {
    "text": "so that's just a really really quick demo of kind of the power of the service mesh um there's a lot of other things you can get out of it and it's one of those",
    "start": "5043040",
    "end": "5049520"
  },
  {
    "text": "things where it depending on the complexity and what you're what you're getting at we did talk about keeping it simple",
    "start": "5049520",
    "end": "5054960"
  },
  {
    "text": "but if you find yourself having to like manually provision a bunch of tls certificates because you will rule your organization that l the all",
    "start": "5054960",
    "end": "5061199"
  },
  {
    "text": "the requests have to be mtls then the service mesh can actually it's complex to add it but then it's actually",
    "start": "5061199",
    "end": "5066400"
  },
  {
    "text": "solving you saving you from a lot of complexity so depending on the trade-offs there it might make a lot of sense for your organization cool so",
    "start": "5066400",
    "end": "5073840"
  },
  {
    "text": "um that's the end of it there uh you can find us on twitter at ashustava and at el caiso",
    "start": "5073840",
    "end": "5081600"
  },
  {
    "text": "um did you have any final words i reno yeah thank you so much uh that was awesome",
    "start": "5081600",
    "end": "5087199"
  },
  {
    "text": "and thank you all for coming to this workshop yeah feel free to talk to us on twitter if you want afterwards and",
    "start": "5087199",
    "end": "5093440"
  },
  {
    "text": "we'll probably be in the chat right now talking to you yeah absolutely all right all right everyone thanks for listening and uh",
    "start": "5093440",
    "end": "5100159"
  },
  {
    "text": "have good luck with your kubernetes",
    "start": "5100159",
    "end": "5103360"
  }
]