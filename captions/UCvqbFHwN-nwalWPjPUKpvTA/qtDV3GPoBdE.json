[
  {
    "text": "okay I think I I'm going to start so I will gain five minutes more for me and",
    "start": "240",
    "end": "9120"
  },
  {
    "text": "uh have you ever heard about ETD sure you know what is",
    "start": "9120",
    "end": "15320"
  },
  {
    "text": "etcd yes yes yes okay perfect so okay first",
    "start": "15400",
    "end": "21760"
  },
  {
    "text": "of all good afternoon everyone uh I would like to thank the organizers for accepting this talk and today we're",
    "start": "21760",
    "end": "28519"
  },
  {
    "text": "going to talk about how to post exploit a compromis ATD uh but first let me introduce myself",
    "start": "28519",
    "end": "36320"
  },
  {
    "text": "I'm Lu tooro and I start on the offensive side of security in",
    "start": "36320",
    "end": "42079"
  },
  {
    "text": "2019 and for the past two years I've been working as a security consultant at",
    "start": "42079",
    "end": "47600"
  },
  {
    "text": "NCC group and here you have uh some details about me and some",
    "start": "47600",
    "end": "55000"
  },
  {
    "text": "budges and the thing is the core concept behind this technique is not completely",
    "start": "55000",
    "end": "61359"
  },
  {
    "text": "shiny new yep and there have been other talks",
    "start": "61359",
    "end": "66680"
  },
  {
    "text": "in past editions of cucon that have already discussed the importance of hcd",
    "start": "66680",
    "end": "72320"
  },
  {
    "text": "within the cluster and you have here just a couple of examples in the first",
    "start": "72320",
    "end": "77799"
  },
  {
    "text": "talk Joe bets released a tool that has been the central Focus for developing",
    "start": "77799",
    "end": "83720"
  },
  {
    "text": "this technique and I will talk you about this tool later on and and for those you may not be",
    "start": "83720",
    "end": "92159"
  },
  {
    "text": "familiar with cyber security terms it's um important to Define what a post",
    "start": "92159",
    "end": "97680"
  },
  {
    "text": "exploitation means and it refers to the techniques that an attacker employs",
    "start": "97680",
    "end": "102799"
  },
  {
    "text": "after gaining authorized access to to a system so consequently post exploration",
    "start": "102799",
    "end": "108640"
  },
  {
    "text": "techniques always come at the end of the of the workflow of the security excises",
    "start": "108640",
    "end": "115000"
  },
  {
    "text": "because it implies that at this stage we have already compromised uh one one",
    "start": "115000",
    "end": "120079"
  },
  {
    "text": "asset and we want to establish maybe persistence or we try to jump to another",
    "start": "120079",
    "end": "126000"
  },
  {
    "text": "asset in the same network but before diving in into",
    "start": "126000",
    "end": "132000"
  },
  {
    "text": "details I would like to highlight these points as we already said this is a post exploitation technique which means that",
    "start": "132000",
    "end": "139040"
  },
  {
    "text": "we should already have a compromised asset and it should provides us the the",
    "start": "139040",
    "end": "145080"
  },
  {
    "text": "following requirements so first we need to have the certificates of obiously to",
    "start": "145080",
    "end": "151319"
  },
  {
    "text": "to get authenticated in hcd and the second requirement is the hcd service",
    "start": "151319",
    "end": "158239"
  },
  {
    "text": "must be reachable it could be locally or or remotely and it's worth noting that",
    "start": "158239",
    "end": "164640"
  },
  {
    "text": "this technique only works in self-managed environments and also it works in in environments where atcd is",
    "start": "164640",
    "end": "170879"
  },
  {
    "text": "implemented as a cluster we just need to compromise one of the ATD nodes and",
    "start": "170879",
    "end": "177319"
  },
  {
    "text": "however we won't be able to apply this technique in manage environments because you already know at CD is not reachable",
    "start": "177319",
    "end": "184080"
  },
  {
    "text": "in in control planes that are configured by the cloud",
    "start": "184080",
    "end": "189280"
  },
  {
    "text": "providers and here's a brief reminder about what is what is hcd and as you",
    "start": "189280",
    "end": "195080"
  },
  {
    "text": "know it's a ke key value store and it's usually located uh in in a control plane note or",
    "start": "195080",
    "end": "201840"
  },
  {
    "text": "bound to the control plane note in another host and kubernetes it uses HD",
    "start": "201840",
    "end": "207959"
  },
  {
    "text": "for baking up all the a data so we can consider H CD as a kind of leing backup",
    "start": "207959",
    "end": "215120"
  },
  {
    "text": "and it's constantly updating the state of the cluster",
    "start": "215120",
    "end": "220239"
  },
  {
    "text": "components and talking about backups we what what should happen What would",
    "start": "220239",
    "end": "226360"
  },
  {
    "text": "happen if we have a legacy system on which we have backups or dams that are",
    "start": "226360",
    "end": "233519"
  },
  {
    "text": "not encrypted or are not encode or not serialized we have just backups in in",
    "start": "233519",
    "end": "241079"
  },
  {
    "text": "row data so what would happen if someone had access to these backup files well",
    "start": "241079",
    "end": "246400"
  },
  {
    "text": "most likely an attacker could use these files to obtain of course sensitive information let's say hardcode passwords",
    "start": "246400",
    "end": "253920"
  },
  {
    "text": "in configuration files or maybe could retrieve private keys for uh SSH or even",
    "start": "253920",
    "end": "261560"
  },
  {
    "text": "worse it could modify or inject malicious files waiting for this backup to be restored and gain a compromised",
    "start": "261560",
    "end": "268800"
  },
  {
    "text": "asset within the networ work so based on this principle I was obsessed kind of into finding a way to um reproduce this",
    "start": "268800",
    "end": "278639"
  },
  {
    "text": "this same principle in in etcd but first things first uh how does",
    "start": "278639",
    "end": "285600"
  },
  {
    "text": "HD work and as we mentioned is a key value store which is a simple concept",
    "start": "285600",
    "end": "291400"
  },
  {
    "text": "you can add keys and values which are associated to to those keys and you can",
    "start": "291400",
    "end": "298479"
  },
  {
    "text": "if you know a key path you can retrieve its value or delete the key and basically that's all it's quite",
    "start": "298479",
    "end": "306599"
  },
  {
    "text": "simple then what happens when for example we create a pot well the API server will take our request and will",
    "start": "307720",
    "end": "314880"
  },
  {
    "text": "instruct the LCD to store this value in in a specific key in this case it will",
    "start": "314880",
    "end": "320840"
  },
  {
    "text": "use all the information of the PO manifest as a value and the key will be located usually at uh SL registry slps",
    "start": "320840",
    "end": "330440"
  },
  {
    "text": "SL defaults slash jins in this example and this is just an example you know",
    "start": "330440",
    "end": "336680"
  },
  {
    "text": "that not all resources in kubernetes are Nam spaced so not all resources will",
    "start": "336680",
    "end": "342280"
  },
  {
    "text": "follow this path uh structure however most of the Nam spaces objects like",
    "start": "342280",
    "end": "348319"
  },
  {
    "text": "deployments or stateful sets or service accounts will be safe following this this",
    "start": "348319",
    "end": "355199"
  },
  {
    "text": "structure but that was uh just a high level overview of of of the entire process it's actually more complex and",
    "start": "355199",
    "end": "362720"
  },
  {
    "text": "this workflow is much more detailed I I won't detail every single step here I just want to highlight that the API",
    "start": "362720",
    "end": "368880"
  },
  {
    "text": "server is in constant communication with the SD at every single step and when the",
    "start": "368880",
    "end": "375440"
  },
  {
    "text": "API communicates with the Schuler for example it updates the state in",
    "start": "375440",
    "end": "380599"
  },
  {
    "text": "ATD when the API have a communicate with the cuet it try to update uh the",
    "start": "380599",
    "end": "387960"
  },
  {
    "text": "information in ET C even when the cubet receives uh some updated information in",
    "start": "387960",
    "end": "396560"
  },
  {
    "text": "sorry I lost my okay Mouse okay right here even when the qapi server receive information from",
    "start": "396560",
    "end": "404520"
  },
  {
    "text": "the cuet it also tries again to update this information in incd so as you can see etcd is in the",
    "start": "404520",
    "end": "412479"
  },
  {
    "text": "middle of every single communication managed by the API server so we can agree that it's a key component in in",
    "start": "412479",
    "end": "418520"
  },
  {
    "text": "the cluster right now we can retrieve this information",
    "start": "418520",
    "end": "423960"
  },
  {
    "text": "about the newly created part from ETD and it's quite simple with this command",
    "start": "423960",
    "end": "429319"
  },
  {
    "text": "we specify where the service is is located in this case it's in Expos just",
    "start": "429319",
    "end": "434479"
  },
  {
    "text": "in in the Local Host but if we have the hcd in in a remote cluster we should",
    "start": "434479",
    "end": "440720"
  },
  {
    "text": "just change the the end point [Music] and and we also have to specify the",
    "start": "440720",
    "end": "448319"
  },
  {
    "text": "files that we use for uh for the authentication against hcd and finally",
    "start": "448319",
    "end": "454560"
  },
  {
    "text": "we indicate with uh with the command get that we want to obtain the value of the",
    "start": "454560",
    "end": "459800"
  },
  {
    "text": "following key this case it's our pot called and",
    "start": "459800",
    "end": "465879"
  },
  {
    "text": "Jinx and we have this if we take all the information from hcd we get this string",
    "start": "465879",
    "end": "474039"
  },
  {
    "text": "and it appears to be something like a Json but it also contains a special non",
    "start": "474039",
    "end": "479879"
  },
  {
    "text": "readable characters it's strange but this is actually the PO data serialized",
    "start": "479879",
    "end": "485879"
  },
  {
    "text": "with Proto format and you may wonder what is protuff and and how does it",
    "start": "485879",
    "end": "492800"
  },
  {
    "text": "works well it's just to put simple here is just an example on how to use Proto",
    "start": "492800",
    "end": "498360"
  },
  {
    "text": "how to serialize data from a from a person in this case",
    "start": "498360",
    "end": "504350"
  },
  {
    "text": "[Music] and first first of all um",
    "start": "504350",
    "end": "510159"
  },
  {
    "text": "we'll need a Proto file that will Define the structure of the data that we want to serialize in this case we want for",
    "start": "510159",
    "end": "517159"
  },
  {
    "text": "example to include the name age and an email and then with the common below you",
    "start": "517159",
    "end": "524360"
  },
  {
    "text": "can create a module that can be imported into your python script and there we can create the serialized object and here at",
    "start": "524360",
    "end": "532320"
  },
  {
    "text": "the right you have the output in bite format but what happens if we want to",
    "start": "532320",
    "end": "538200"
  },
  {
    "text": "serialize another thing not a person what if we want to cize a book or a car",
    "start": "538200",
    "end": "546000"
  },
  {
    "text": "then this objects do not have the same parameters as a person so we should create uh",
    "start": "546000",
    "end": "552600"
  },
  {
    "text": "additional uh Proto files and and more structures and this is the problem that",
    "start": "552600",
    "end": "559560"
  },
  {
    "text": "we have in in kubernetes we have several objects and all of them are defined in a",
    "start": "559560",
    "end": "565800"
  },
  {
    "text": "different ways as you know a service account is not defined with the same parameters as a network policy and a pod",
    "start": "565800",
    "end": "572760"
  },
  {
    "text": "is not defined with the same parameters as a role binding so what happens if we want to cize these different",
    "start": "572760",
    "end": "579360"
  },
  {
    "text": "objects because we will need to know the the structure of",
    "start": "579360",
    "end": "584839"
  },
  {
    "text": "everyone and fortunately for me there is already a tool available that allows us",
    "start": "584839",
    "end": "590120"
  },
  {
    "text": "to serialize and dilize entries in HD and it's the tool that I mentioned in in",
    "start": "590120",
    "end": "596000"
  },
  {
    "text": "the beginning and was presented by Joe B at cucon North America in 2018 and this tool basically enables us",
    "start": "596000",
    "end": "604480"
  },
  {
    "text": "to pass a ceriz object through a pipe and it converts uh into a jaml or or a",
    "start": "604480",
    "end": "610920"
  },
  {
    "text": "Json and similarly we can manually modify this jaml file and then we can",
    "start": "610920",
    "end": "616320"
  },
  {
    "text": "try to serialize it again and put it back into atcd it's quite simple",
    "start": "616320",
    "end": "622000"
  },
  {
    "text": "basically this is what we start from ETD and the previous tool AER will return as",
    "start": "622000",
    "end": "628839"
  },
  {
    "text": "the this beautiful yaml crazy so I start playing with this tool",
    "start": "628839",
    "end": "635240"
  },
  {
    "text": "testing some changes in those extract GMA files and then put it back into HD",
    "start": "635240",
    "end": "641639"
  },
  {
    "text": "just to see how the cluster reacts and I found some interesting results so I",
    "start": "641639",
    "end": "647760"
  },
  {
    "text": "thought that it would be a good idea to create a wrapper for this tool that automates the the entire process and you",
    "start": "647760",
    "end": "656079"
  },
  {
    "text": "can see here in the middle let's say tricks and I'm going to explain and detail what are those",
    "start": "656079",
    "end": "662040"
  },
  {
    "text": "tricks so here I detailed the entire workflow of this wrapper called cubet CD",
    "start": "662040",
    "end": "669160"
  },
  {
    "text": "along with some of the tricks involved and first we need to select our resource",
    "start": "669160",
    "end": "674240"
  },
  {
    "text": "that is already in the cluster and we'll use this Resource as a template uh this",
    "start": "674240",
    "end": "679880"
  },
  {
    "text": "tool does not work with row yaml and at the moment I only Implement",
    "start": "679880",
    "end": "685800"
  },
  {
    "text": "pots but this could be done with any other Source in in the cluster then first we desize this spot",
    "start": "685800",
    "end": "693839"
  },
  {
    "text": "temp plate we take the yaml and the first trick is that we need to create a",
    "start": "693839",
    "end": "699000"
  },
  {
    "text": "new uid which can be randomized and if we do not change this",
    "start": "699000",
    "end": "705320"
  },
  {
    "text": "uid it may create some cross reference between objects and may result in inconsistencies and malfunctions of the",
    "start": "705320",
    "end": "714240"
  },
  {
    "text": "API logic yeah API server logic and there is an interesting aspect here uh",
    "start": "714240",
    "end": "722000"
  },
  {
    "text": "when the pots reach the running State a new H will be created and link to this",
    "start": "722000",
    "end": "727360"
  },
  {
    "text": "spot and also it Ser as the container ID as well and we can simply remove this",
    "start": "727360",
    "end": "733440"
  },
  {
    "text": "hash and everything will go fine perfect and now we have modified the template we",
    "start": "733440",
    "end": "740120"
  },
  {
    "text": "have changed the uid we have uh removed the has now we have the bare minimum the",
    "start": "740120",
    "end": "745600"
  },
  {
    "text": "basis to create a a new Po and make some some changes for example let's say we",
    "start": "745600",
    "end": "751920"
  },
  {
    "text": "could modify the creation timestamp could be or we",
    "start": "751920",
    "end": "757839"
  },
  {
    "text": "can turning a regular Port into a privilege one and we can also experiment",
    "start": "757839",
    "end": "763399"
  },
  {
    "text": "with some creating creating some inconsistencies which I will show you shortly and after",
    "start": "763399",
    "end": "770920"
  },
  {
    "text": "making these changes we can serialize this modify object and we try to put it",
    "start": "770920",
    "end": "776320"
  },
  {
    "text": "back into hcd so here we so here we have the first",
    "start": "776320",
    "end": "783240"
  },
  {
    "text": "example it's nothing really harmful and we have our pot and Jinx running and",
    "start": "783240",
    "end": "791120"
  },
  {
    "text": "with the wrapper qcd we can simply modify the creation time stamp and suddenly as you can see here the pot",
    "start": "791120",
    "end": "799160"
  },
  {
    "text": "appears to be running for 23 years without a restart and it's a remarkable",
    "start": "799160",
    "end": "806040"
  },
  {
    "text": "achievement because it has been running even before the kubernetes was was",
    "start": "806040",
    "end": "812920"
  },
  {
    "text": "created and you want to take a picture of this",
    "start": "813040",
    "end": "818560"
  },
  {
    "text": "yeah a second scenario and I was thinking about what would happen if if",
    "start": "818560",
    "end": "824880"
  },
  {
    "text": "the name in the pot uh in the pot manifest does not match with the name in",
    "start": "824880",
    "end": "830399"
  },
  {
    "text": "the ATD path look here we create a new pot called Jinx per system and then I",
    "start": "830399",
    "end": "837959"
  },
  {
    "text": "implement the dasp argument to create a custom path in this case the path will",
    "start": "837959",
    "end": "843839"
  },
  {
    "text": "be called random entry but could be any any name so if we list the the pods we",
    "start": "843839",
    "end": "851079"
  },
  {
    "text": "can see the engine's persistent pot running however if we try to delete this",
    "start": "851079",
    "end": "858040"
  },
  {
    "text": "pot we'll get an error telling that this pot is not found and that's normal because from the",
    "start": "858040",
    "end": "866920"
  },
  {
    "text": "API Logics pers perspective this spot does not exist because the real name in hcd is random entry and it doesn't match",
    "start": "866920",
    "end": "876160"
  },
  {
    "text": "with the name in in the Manifest so in this case we won't be",
    "start": "876160",
    "end": "881360"
  },
  {
    "text": "able to remove the using the API server through Cube CTL or any other client",
    "start": "881360",
    "end": "888079"
  },
  {
    "text": "instead of we must delete this spot uh directly from atcd it's the only way to",
    "start": "888079",
    "end": "893160"
  },
  {
    "text": "remove this spot from from the cluster and I found this previous a",
    "start": "893160",
    "end": "898800"
  },
  {
    "text": "scenario funny so I thought hey what happen if I change the name",
    "start": "898800",
    "end": "904560"
  },
  {
    "text": "space uh so here I create a new pot called and Jinx hidden and now you can",
    "start": "904560",
    "end": "910639"
  },
  {
    "text": "guess what will happen let's going to try to find this pot so we have just created our pot in a",
    "start": "910639",
    "end": "917079"
  },
  {
    "text": "non-existent nam space so if we check the default name space we cannot see our pot it's not here it's not in the",
    "start": "917079",
    "end": "923800"
  },
  {
    "text": "default name space apparently and if we trying to find our new invisible name",
    "start": "923800",
    "end": "931040"
  },
  {
    "text": "space that we defined in the previous slide right here and it doesn't exist either so",
    "start": "931040",
    "end": "939639"
  },
  {
    "text": "where is our pot any guess any guesses you know where is the",
    "start": "939639",
    "end": "947279"
  },
  {
    "text": "pot it's in the in the heaven of the pots no it's in the default name",
    "start": "947279",
    "end": "954160"
  },
  {
    "text": "space our pot has been always in the default name space uh um because we",
    "start": "954160",
    "end": "959720"
  },
  {
    "text": "didn't change this value in the in the Manifest it just changed the ETD path so",
    "start": "959720",
    "end": "965639"
  },
  {
    "text": "when we run Cube C get pods the API server iterates over the default name",
    "start": "965639",
    "end": "972199"
  },
  {
    "text": "space path in atcd and this pot is not under this path however if we list all",
    "start": "972199",
    "end": "979600"
  },
  {
    "text": "the pots in all name spaces it will iterates over the the pots path and",
    "start": "979600",
    "end": "987360"
  },
  {
    "text": "that's how we can find our pot",
    "start": "987360",
    "end": "992639"
  },
  {
    "text": "here well as a security consultant when a customer seeks um a kubernetes",
    "start": "993040",
    "end": "998880"
  },
  {
    "text": "assessment one of my main concerns is deploying secure workloads and you",
    "start": "998880",
    "end": "1003920"
  },
  {
    "text": "already know that kubernetes has some built-in features for deploying secure World lows such as you know security",
    "start": "1003920",
    "end": "1010079"
  },
  {
    "text": "context and all its parameters and we can also apply seom",
    "start": "1010079",
    "end": "1016560"
  },
  {
    "text": "app armor C Linux and for more we have also cool thirdparty solutions to protect our",
    "start": "1016560",
    "end": "1022720"
  },
  {
    "text": "cluster but for now we'll focus on on on building features but you know nobody's perfect",
    "start": "1022720",
    "end": "1030600"
  },
  {
    "text": "and we could miss setting these configurations in accordance with our",
    "start": "1030600",
    "end": "1036038"
  },
  {
    "text": "security standards of our organization so we need to implement some policies to",
    "start": "1036039",
    "end": "1042000"
  },
  {
    "text": "to ensure and to enforce that our design configuration uh will be applied and",
    "start": "1042000",
    "end": "1048000"
  },
  {
    "text": "this is where the admission controllers come into play you already know that uh about the",
    "start": "1048000",
    "end": "1055600"
  },
  {
    "text": "deprecation of poort security policies now we have the poort security admissions which Define three poort",
    "start": "1055600",
    "end": "1062039"
  },
  {
    "text": "security standards and as in names indicates the most restrictive is the",
    "start": "1062039",
    "end": "1068320"
  },
  {
    "text": "restricted standard and it requires many",
    "start": "1068320",
    "end": "1073480"
  },
  {
    "text": "security parameters and as a validation ad Mission controller we must comply",
    "start": "1073480",
    "end": "1078640"
  },
  {
    "text": "every single of its directives if we want our warl to be to be",
    "start": "1078640",
    "end": "1085400"
  },
  {
    "text": "deployed as you already know po security admissions apply only to name spaces so",
    "start": "1085400",
    "end": "1090799"
  },
  {
    "text": "let's create the most restrictive name space ever called restricted Nam space",
    "start": "1090799",
    "end": "1096960"
  },
  {
    "text": "restricted NS and here you have the definition and what happens if we try to",
    "start": "1096960",
    "end": "1103799"
  },
  {
    "text": "deploy just a single pot uh it's not even a a privileged pot well the policy",
    "start": "1103799",
    "end": "1109120"
  },
  {
    "text": "admission will not validate this insecure configuration and this spot won't be deployed in this uh restricted",
    "start": "1109120",
    "end": "1116240"
  },
  {
    "text": "name space here I just highlight some of the missing configurations uh it's it's uh we have",
    "start": "1116240",
    "end": "1124080"
  },
  {
    "text": "to this allow the privilege escalation the capabilities and the run as non",
    "start": "1124080",
    "end": "1129720"
  },
  {
    "text": "route and do you think it's possible to deploy",
    "start": "1129720",
    "end": "1135039"
  },
  {
    "text": "a privilege pot in a restricted name space because it is if we deploy directly",
    "start": "1135039",
    "end": "1142440"
  },
  {
    "text": "through at CD so here I implemented the privilege flag to turn any template into",
    "start": "1142440",
    "end": "1148880"
  },
  {
    "text": "a into a privilege one and as you can see here we managed to deploy a privilege b in a restricted Nam Space by",
    "start": "1148880",
    "end": "1156640"
  },
  {
    "text": "bypassing completely the PO security admissions defined in the name",
    "start": "1156640",
    "end": "1162720"
  },
  {
    "text": "space and time for a demo I think I'm going so fast uh um let me share the",
    "start": "1162720",
    "end": "1173039"
  },
  {
    "text": "internet with my because I need to pull some",
    "start": "1173039",
    "end": "1178720"
  },
  {
    "text": "images hold on",
    "start": "1180600",
    "end": "1185600"
  },
  {
    "text": "and demo time okay you have to see okay the same",
    "start": "1187240",
    "end": "1196720"
  },
  {
    "text": "screen as me and I should",
    "start": "1196720",
    "end": "1203279"
  },
  {
    "text": "connect my iPhone yeah please don't hack my iPhone",
    "start": "1206360",
    "end": "1214080"
  },
  {
    "text": "and okay now we have um three three panels and here we have the",
    "start": "1214080",
    "end": "1222280"
  },
  {
    "text": "the administrator console this is the cluster admin it's legit nothing wrong",
    "start": "1222280",
    "end": "1227880"
  },
  {
    "text": "here the down we have a compromise control plane so the hcd is running here",
    "start": "1227880",
    "end": "1233039"
  },
  {
    "text": "and we have another remote machine that belongs to the to the",
    "start": "1233039",
    "end": "1238080"
  },
  {
    "text": "attacker so let's going to see what is running here we have just an an",
    "start": "1238080",
    "end": "1245120"
  },
  {
    "text": "Jinx let's go to see what we have we have many things running we have kerno",
    "start": "1245120",
    "end": "1251760"
  },
  {
    "text": "also implemented nothing nothing really harmful everything in place okay so now",
    "start": "1251760",
    "end": "1260320"
  },
  {
    "text": "here from the compromised um control plane we can run uh oh let me show you",
    "start": "1260320",
    "end": "1270080"
  },
  {
    "text": "something I'm going to try to run a privilege uh",
    "start": "1270080",
    "end": "1276679"
  },
  {
    "text": "engines of course it it doesn't works because the cube CTL",
    "start": "1276679",
    "end": "1285120"
  },
  {
    "text": "um we have implement the CNA policy to avoid privilege pods in all the the",
    "start": "1285200",
    "end": "1292000"
  },
  {
    "text": "cluster so it doesn't matter the the name space and here with this fancy wrapper I",
    "start": "1292000",
    "end": "1301320"
  },
  {
    "text": "will cuat CD I will create a pot that I will call it um Jinx prep let's say I",
    "start": "1301320",
    "end": "1310480"
  },
  {
    "text": "will use the the running and Jinx um pot as a team plate and and I",
    "start": "1310480",
    "end": "1318480"
  },
  {
    "text": "will say hey I want it privilege let's going to try this thing",
    "start": "1318480",
    "end": "1324600"
  },
  {
    "text": "I'm going to use um a watch just you can see what",
    "start": "1324600",
    "end": "1331480"
  },
  {
    "text": "it's happening on real time okay and cross finger and here it's",
    "start": "1331480",
    "end": "1339000"
  },
  {
    "text": "creating the Pod pulling the image it's running and the big question",
    "start": "1339000",
    "end": "1345880"
  },
  {
    "text": "is is this B really privilege okay let's get Cube CTL get and Jinx",
    "start": "1345880",
    "end": "1354720"
  },
  {
    "text": "prep and I will get this in yaml I don't have the mouse",
    "start": "1354720",
    "end": "1361559"
  },
  {
    "text": "here uh and Jinx prep get oh get",
    "start": "1361559",
    "end": "1366799"
  },
  {
    "text": "pot and here if we find the secure",
    "start": "1366799",
    "end": "1372400"
  },
  {
    "text": "context second Contex should be around here uh uh here here we have it we have",
    "start": "1372400",
    "end": "1381159"
  },
  {
    "text": "a privilege pot running in a kerno protected cluster and in addition we have I've",
    "start": "1381159",
    "end": "1389400"
  },
  {
    "text": "also had not only this uh flag but it's also sharing the these name spaces IPC",
    "start": "1389400",
    "end": "1397360"
  },
  {
    "text": "Network and Pad well that's crazy right",
    "start": "1397360",
    "end": "1403120"
  },
  {
    "text": "but we can do more fancy things",
    "start": "1403120",
    "end": "1408720"
  },
  {
    "text": "that's going to say a I want a reverse",
    "start": "1408720",
    "end": "1413840"
  },
  {
    "text": "shell into an exteral machine I'll try to get um my",
    "start": "1413840",
    "end": "1423320"
  },
  {
    "text": "IP I think it's let me check it's not this one remember that",
    "start": "1424720",
    "end": "1432279"
  },
  {
    "text": "this demo is running in in kind so I'm looking for the",
    "start": "1432279",
    "end": "1438400"
  },
  {
    "text": "doer IP the doer zero interface IP",
    "start": "1438400",
    "end": "1444520"
  },
  {
    "text": "okay P Clio thank you",
    "start": "1444520",
    "end": "1450000"
  },
  {
    "text": "no okay anyway I will be listening on this",
    "start": "1450799",
    "end": "1458760"
  },
  {
    "text": "port and here I should have in the history um okay got it got it okay",
    "start": "1458760",
    "end": "1468880"
  },
  {
    "text": "here with this command I will try to get a rever shell directly from from inside",
    "start": "1468880",
    "end": "1475240"
  },
  {
    "text": "the the the Pod and we'll try to create a fake um namespace and also we'll try",
    "start": "1475240",
    "end": "1484720"
  },
  {
    "text": "to use a a fake name for the SD path",
    "start": "1484720",
    "end": "1490279"
  },
  {
    "text": "we'll try to watch again what's happening in the cluster",
    "start": "1490279",
    "end": "1496760"
  },
  {
    "text": "and that's going to do this oh what",
    "start": "1496760",
    "end": "1504399"
  },
  {
    "text": "happened we have here a remote shell as you can see we have no new SPS here",
    "start": "1504399",
    "end": "1511480"
  },
  {
    "text": "there is nothing of course CU CD get pots slash",
    "start": "1511480",
    "end": "1521279"
  },
  {
    "text": "a uh let me check let me reduce",
    "start": "1521279",
    "end": "1526360"
  },
  {
    "text": "this we have here the new pod remote shell in the default name space But as a",
    "start": "1526360",
    "end": "1534480"
  },
  {
    "text": "legit cluster arment I will try to delete this spot call and Jinx remote",
    "start": "1534480",
    "end": "1542120"
  },
  {
    "text": "shell I cannot so okay let me check where I am I",
    "start": "1542120",
    "end": "1548760"
  },
  {
    "text": "cannot use this one host name I'm dly in the worker I've also in",
    "start": "1548760",
    "end": "1556760"
  },
  {
    "text": "the parameters I uh add the option to",
    "start": "1556760",
    "end": "1561960"
  },
  {
    "text": "mount the root file system in in this fem in",
    "start": "1561960",
    "end": "1568159"
  },
  {
    "text": "host and despite this error we have",
    "start": "1568159",
    "end": "1573840"
  },
  {
    "text": "um full access PF in it oh no sorry",
    "start": "1573840",
    "end": "1581279"
  },
  {
    "text": "P oh I lost my anyway I had full access",
    "start": "1581279",
    "end": "1589159"
  },
  {
    "text": "to the control going to try",
    "start": "1589159",
    "end": "1593960"
  },
  {
    "text": "again that's it we have root access full access to the control uh to the node",
    "start": "1608919",
    "end": "1615440"
  },
  {
    "text": "sorry and this could be also there is another flag telling a I want to move to",
    "start": "1615440",
    "end": "1623399"
  },
  {
    "text": "another note that's quite simple just using no",
    "start": "1623399",
    "end": "1628360"
  },
  {
    "text": "name I'm not sure if this will be it will work not sure not sure not sure not",
    "start": "1629279",
    "end": "1637480"
  },
  {
    "text": "sure no anyway the thing is I'm going",
    "start": "1637480",
    "end": "1642559"
  },
  {
    "text": "to stop this and turn it back to the presentation",
    "start": "1642559",
    "end": "1649520"
  },
  {
    "text": "all right",
    "start": "1654840",
    "end": "1661039"
  },
  {
    "text": "okay nope not",
    "start": "1661039",
    "end": "1664879"
  },
  {
    "text": "this no okay and here comes the big question",
    "start": "1670080",
    "end": "1677960"
  },
  {
    "text": "why does this work why this happens and to be honest I have not analyzed the",
    "start": "1677960",
    "end": "1683080"
  },
  {
    "text": "kubernetes code but all the test demonstrate that the implementation of hcd in the kubernetes architecture",
    "start": "1683080",
    "end": "1689600"
  },
  {
    "text": "provides a level of reliability regarding the API that kubernetes",
    "start": "1689600",
    "end": "1695240"
  },
  {
    "text": "clients do not have and as a users we are subject to authentication to",
    "start": "1695240",
    "end": "1704640"
  },
  {
    "text": "authorization process based on roles and finally to admission controllers that",
    "start": "1704640",
    "end": "1709919"
  },
  {
    "text": "even cluster admins cannot bypass without disabling them however atcd only",
    "start": "1709919",
    "end": "1716799"
  },
  {
    "text": "needs its certificates to get authenticated uh and then everything it",
    "start": "1716799",
    "end": "1723159"
  },
  {
    "text": "it uh in ETD will be trusted as as",
    "start": "1723159",
    "end": "1729840"
  },
  {
    "text": "valid no and the thing is how can we mitigate",
    "start": "1730360",
    "end": "1736760"
  },
  {
    "text": "this threat is that possible because attackers here have an advantage and",
    "start": "1736760",
    "end": "1742640"
  },
  {
    "text": "this technique affects you know a very specific environments and there are at",
    "start": "1742640",
    "end": "1748279"
  },
  {
    "text": "least to my knowledge there are not a widely adopted solution that serve as as",
    "start": "1748279",
    "end": "1754640"
  },
  {
    "text": "the facto standard for checking the Integrity of hcd and if we had to respond a security end incident that",
    "start": "1754640",
    "end": "1762320"
  },
  {
    "text": "exploit this technique the the the events on kubernetes they are also store",
    "start": "1762320",
    "end": "1768760"
  },
  {
    "text": "in HD so they are completely compromised even we have uh root access",
    "start": "1768760",
    "end": "1774519"
  },
  {
    "text": "to the note so if the logs are safe in any note of the cluster could be also",
    "start": "1774519",
    "end": "1781399"
  },
  {
    "text": "compromised and however we have runtime Security Solutions that could provide",
    "start": "1781399",
    "end": "1787799"
  },
  {
    "text": "early alerts it's something unusual it's happening in the cluster has your your tool",
    "start": "1787799",
    "end": "1796320"
  },
  {
    "text": "and especially you know uh endpoint security",
    "start": "1796320",
    "end": "1801600"
  },
  {
    "text": "runtime Security Solutions could detect uh easily processes that are running on",
    "start": "1801600",
    "end": "1807440"
  },
  {
    "text": "the Node for example obtaining a remote shell it's it's obvious and as we have",
    "start": "1807440",
    "end": "1813279"
  },
  {
    "text": "seen gaining root shell access on any cluster know it's quite easy even using images that are not intended for",
    "start": "1813279",
    "end": "1819840"
  },
  {
    "text": "offensive exercise remember that this image use it's Jinx latest there is no",
    "start": "1819840",
    "end": "1826360"
  },
  {
    "text": "offensive image at all so finally let's wrap up some",
    "start": "1826360",
    "end": "1832720"
  },
  {
    "text": "conclusions here as we have seen this technique um when all the requirements",
    "start": "1832720",
    "end": "1838559"
  },
  {
    "text": "are met it's it's very powerful and it can compromise the entire cluster in in",
    "start": "1838559",
    "end": "1844480"
  },
  {
    "text": "a matter of seconds and if you check any book or blog post or anything related on",
    "start": "1844480",
    "end": "1850399"
  },
  {
    "text": "how to exploit a compromise hcd you will find that in most of cases they tweet",
    "start": "1850399",
    "end": "1856559"
  },
  {
    "text": "hcd just uh as a database from which we can Reve SE Secrets but now we have",
    "start": "1856559",
    "end": "1863559"
  },
  {
    "text": "demonstrate that atcd is a key component of the kubernetes architecture and perhaps it's the most important and the",
    "start": "1863559",
    "end": "1870559"
  },
  {
    "text": "most critical one and sadly despite all this remember that this technique it",
    "start": "1870559",
    "end": "1876720"
  },
  {
    "text": "won't work on manage environments and now I would like to pose a question to you and the community",
    "start": "1876720",
    "end": "1885240"
  },
  {
    "text": "uh I won't answer it and the thing is should the trusted position that etcd",
    "start": "1885240",
    "end": "1890600"
  },
  {
    "text": "currently holds in the kubernetes architecture should be reconsidered what do you think and I",
    "start": "1890600",
    "end": "1897039"
  },
  {
    "text": "hope you catch me out there and share your thoughts uh about it and that's all",
    "start": "1897039",
    "end": "1902399"
  },
  {
    "text": "thank [Applause] you that was us you have any",
    "start": "1902399",
    "end": "1911120"
  },
  {
    "text": "question no",
    "start": "1911120",
    "end": "1915919"
  },
  {
    "text": "yep yeah okay yeah it is yeah",
    "start": "1916159",
    "end": "1923840"
  },
  {
    "text": "yes well indeed it it was not a screenshot it was my CI indeed",
    "start": "1923840",
    "end": "1931158"
  },
  {
    "text": "yeah questions oh over",
    "start": "1932360",
    "end": "1938240"
  },
  {
    "text": "there now I have um okay uh now I have uh uh uh now have",
    "start": "1940919",
    "end": "1948919"
  },
  {
    "text": "a technique to exploit the atcd so how do I get access to the",
    "start": "1948919",
    "end": "1955600"
  },
  {
    "text": "atcd uh uh or in other ways uh what's the common palls in current KB",
    "start": "1955600",
    "end": "1963440"
  },
  {
    "text": "management to let the attacker have the access to the UHD",
    "start": "1963440",
    "end": "1970000"
  },
  {
    "text": "database uh you sorry you are asking if we have anything to to to be safe",
    "start": "1970000",
    "end": "1977200"
  },
  {
    "text": "against this technique uh uh uh I'm asking is there any common palls to let",
    "start": "1977200",
    "end": "1984200"
  },
  {
    "text": "the attacker access the adcd database I I don't know to be",
    "start": "1984200",
    "end": "1989840"
  },
  {
    "text": "honest uh so how do I to exploit this uh the atcd what's what what's the common",
    "start": "1989840",
    "end": "1997799"
  },
  {
    "text": "ways to uh yeah usually the common way is just to if you get the the",
    "start": "1997799",
    "end": "2003320"
  },
  {
    "text": "credentials I mean the the certificates uh usually if you check some blog post",
    "start": "2003320",
    "end": "2011279"
  },
  {
    "text": "and and books and all the information we have in the internet most of times they",
    "start": "2011279",
    "end": "2016840"
  },
  {
    "text": "are uh treating HD just uh a place where you can retrieve secrets and that's",
    "start": "2016840",
    "end": "2024120"
  },
  {
    "text": "all okay so uh uh uh uh does the edcd",
    "start": "2024120",
    "end": "2029919"
  },
  {
    "text": "certificate uh is stored in the work note yeah okay yeah yeah okay I get I",
    "start": "2029919",
    "end": "2036480"
  },
  {
    "text": "get the point yes uh for sure yeah first you have to compromise the the control plane or the",
    "start": "2036480",
    "end": "2041679"
  },
  {
    "text": "HD node but this is not covered by by this presentation yeah yeah yeah okay I got this okay thank",
    "start": "2041679",
    "end": "2049320"
  },
  {
    "text": "you it wouldn't be it wouldn't be easy to compromise uh for sure but sometimes",
    "start": "2049320",
    "end": "2055839"
  },
  {
    "text": "you know some system administr administrators will like to put some",
    "start": "2055839",
    "end": "2061480"
  },
  {
    "text": "services in in the same note and you know and the thing is security is is",
    "start": "2061480",
    "end": "2068240"
  },
  {
    "text": "multi-layer I mean if let's it's an example if we have an image that is it's",
    "start": "2068240",
    "end": "2075358"
  },
  {
    "text": "configure to run uh to run a user that",
    "start": "2075359",
    "end": "2081000"
  },
  {
    "text": "is not root it's image that is properly configured in the docker file it doesn't",
    "start": "2081000",
    "end": "2086878"
  },
  {
    "text": "means that we do not have to use admission controllers to avoid running",
    "start": "2086879",
    "end": "2092919"
  },
  {
    "text": "pots or containers running as root I mean it's okay it's pretty difficult to",
    "start": "2092919",
    "end": "2100240"
  },
  {
    "text": "to compromise a control plane it's pretty difficult to compromise an HD note that only runs hcd but the things",
    "start": "2100240",
    "end": "2108800"
  },
  {
    "text": "works until it doesn't works I mean uh",
    "start": "2108800",
    "end": "2113920"
  },
  {
    "text": "vulnerabilities are always arise every day we we have already seen the supply",
    "start": "2113920",
    "end": "2120920"
  },
  {
    "text": "chain attacks I think this could be also secure in in any sense",
    "start": "2120920",
    "end": "2127440"
  },
  {
    "text": "yeah atcd should be in my",
    "start": "2127440",
    "end": "2133480"
  },
  {
    "text": "opinion also um restricted by the mission controllers yeah that's the",
    "start": "2133520",
    "end": "2141160"
  },
  {
    "text": "point uh you hi you basically answered my question so thanks okay",
    "start": "2141160",
    "end": "2149560"
  },
  {
    "text": "great hi I have a question um in a demo we know that we created a PO",
    "start": "2150160",
    "end": "2157920"
  },
  {
    "text": "uh with a pass that an invisible name space in the pass so I wonder why we can",
    "start": "2157920",
    "end": "2166440"
  },
  {
    "text": "use kuat get p- a to show the P um but",
    "start": "2166440",
    "end": "2172400"
  },
  {
    "text": "uh we cannot delete this part sorry I I I don't get it okay uh",
    "start": "2172400",
    "end": "2179599"
  },
  {
    "text": "let me reproduce my question so you created a part yeah uh directly through",
    "start": "2179599",
    "end": "2185720"
  },
  {
    "text": "edcd etcd with a pass uh the name space name",
    "start": "2185720",
    "end": "2192000"
  },
  {
    "text": "is invisible yep yeah so we cannot uh uh get the P without Das a yes what's the",
    "start": "2192000",
    "end": "2200200"
  },
  {
    "text": "um um but and uh but with Das a we can see that P yes because yeah yeah yeah",
    "start": "2200200",
    "end": "2207079"
  },
  {
    "text": "okay got it um the thing is when you run slash a with getting all the",
    "start": "2207079",
    "end": "2214440"
  },
  {
    "text": "information the the API goes Tod and go",
    "start": "2214440",
    "end": "2220280"
  },
  {
    "text": "to/ registry slps and iterates over this path and it",
    "start": "2220280",
    "end": "2227359"
  },
  {
    "text": "gets everything on this path okay so when we try to delete this",
    "start": "2227359",
    "end": "2236880"
  },
  {
    "text": "part oh can we oh because we don't have a name space named invisible so we",
    "start": "2236880",
    "end": "2242599"
  },
  {
    "text": "cannot delete it it's in the HD path it's SL regist SLP SL invisible but the",
    "start": "2242599",
    "end": "2249480"
  },
  {
    "text": "thing is when in cctl we try to remove this pot or to check this spot it's",
    "start": "2249480",
    "end": "2257000"
  },
  {
    "text": "taking the value of the n space from the Manifest and it doesn't matter it creat",
    "start": "2257000",
    "end": "2263160"
  },
  {
    "text": "an inconsistency and you cannot find with with other command okay thank you thank",
    "start": "2263160",
    "end": "2271640"
  },
  {
    "text": "you yep ready thank",
    "start": "2275599",
    "end": "2282280"
  },
  {
    "text": "you",
    "start": "2283319",
    "end": "2286319"
  }
]