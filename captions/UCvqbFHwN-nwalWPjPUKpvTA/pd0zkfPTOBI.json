[
  {
    "text": "and off we go welcome to everyone welcome everyone to this week's cncf",
    "start": "1920",
    "end": "7359"
  },
  {
    "text": "live webinar pawning the ci workflow and how to prevent it i'm libby schultz and i'll be",
    "start": "7359",
    "end": "13280"
  },
  {
    "text": "moderating today's webinar i'm going to read our code of conduct and then hand over to stephen",
    "start": "13280",
    "end": "18560"
  },
  {
    "text": "giguere and barack shaster with palo alto networks a few housekeeping items",
    "start": "18560",
    "end": "23760"
  },
  {
    "text": "before we get started during the webinar you are not able to talk as an attendee there's a q a box on the right hand side",
    "start": "23760",
    "end": "30880"
  },
  {
    "text": "of your screen the chat box please feel free to drop your questions there and we'll get to as many as we can",
    "start": "30880",
    "end": "35920"
  },
  {
    "text": "at the end this is an official webinar of the cncf and as such is subject to the cncf code",
    "start": "35920",
    "end": "41520"
  },
  {
    "text": "of conduct please do not add anything to the chat or questions that would be in violation of that code of conduct and",
    "start": "41520",
    "end": "47520"
  },
  {
    "text": "please be respectful of all of your fellow participants and presenters please also note that the recording and",
    "start": "47520",
    "end": "52640"
  },
  {
    "text": "slides will be posted later today to the cncf online programs page at",
    "start": "52640",
    "end": "58440"
  },
  {
    "text": "community.cncf.io under online programs they're also available via your registration link you use today and the",
    "start": "58440",
    "end": "64799"
  },
  {
    "text": "recording will be on our online programs youtube playlist later today with that i will hand it over to stephen",
    "start": "64799",
    "end": "71680"
  },
  {
    "text": "and barack to kick off today's presentation okay awesome thanks libby",
    "start": "71680",
    "end": "77759"
  },
  {
    "text": "uh yeah welcome welcome one and all uh thank you to the cncf for hosting this webinar this is amazing this is pawning",
    "start": "77759",
    "end": "84000"
  },
  {
    "text": "the ci the github action edition and with the idea that we'll eventually maybe do a gitlab or a",
    "start": "84000",
    "end": "90479"
  },
  {
    "text": "circle ci and we'll do a few different versions as we as our research progresses let's say",
    "start": "90479",
    "end": "95600"
  },
  {
    "text": "uh i'm steve jager uh this is this is i don't",
    "start": "95600",
    "end": "100720"
  },
  {
    "text": "i've done this talk and i have my boss as my co-speaker so i am a complete idiot in terms of setting up myself up",
    "start": "100720",
    "end": "106159"
  },
  {
    "text": "for high pressure situations i think that you'll be amazing steve",
    "start": "106159",
    "end": "112880"
  },
  {
    "text": "uh all right so the the obligatory intros uh if you've never seen me do anything like this before i'm a",
    "start": "113280",
    "end": "118880"
  },
  {
    "text": "developer advocate uh at bridge crew bridge crew by prismacloud at palo alto networks",
    "start": "118880",
    "end": "124079"
  },
  {
    "text": "i've been writing code since 1990 and uh did a lot of quality automation worked",
    "start": "124079",
    "end": "130080"
  },
  {
    "text": "in security since 2014 for a bunch of different companies if you find yourself in london i run a meetup called",
    "start": "130080",
    "end": "135200"
  },
  {
    "text": "difficult london gathering come join in and i have a cloud native security",
    "start": "135200",
    "end": "140400"
  },
  {
    "text": "twitch show and if you want to know more about that and you love and you want to take a risk that's my linkedin via that qr code uh",
    "start": "140400",
    "end": "147920"
  },
  {
    "text": "barack i will let you introduce yourself yeah uh i'm i'm a friend of steve i like",
    "start": "147920",
    "end": "153280"
  },
  {
    "text": "working with him uh co-founder and city of richwood that was acquired a year ago by palo alto networks i love to drink",
    "start": "153280",
    "end": "160319"
  },
  {
    "text": "wine so if you have any recommendations and you want to deliver some i'll give you",
    "start": "160319",
    "end": "165599"
  },
  {
    "text": "uh my address on direct messages and uh i love star wars um",
    "start": "165599",
    "end": "172080"
  },
  {
    "text": "so if you love if you have spoilers for the next movie don't share them over dm",
    "start": "172080",
    "end": "179440"
  },
  {
    "text": "yes in spite of founding a company based entirely on star trek",
    "start": "180159",
    "end": "186560"
  },
  {
    "text": "excellent all right uh let's that's a quick whip through on the agenda where our ci today i already",
    "start": "186560",
    "end": "192800"
  },
  {
    "text": "mentioned is going to be github actions we're going to go through some attack vectors and we're going to actually do some of the attack vectors as well which",
    "start": "192800",
    "end": "199440"
  },
  {
    "text": "is the exciting live bit that's going to go completely wrong probably but you'll be here to see it so",
    "start": "199440",
    "end": "205440"
  },
  {
    "text": "we'll talk about the threats the different positions and then of course some of the attack vectors we're going to go through",
    "start": "205440",
    "end": "211200"
  },
  {
    "text": "command injection um insecure image reference we're not doing that one we're going to talk about it",
    "start": "211200",
    "end": "217760"
  },
  {
    "text": "and create reverse channel runner hopefully on that and maybe cover our tracks which would be pretty cool",
    "start": "218959",
    "end": "226200"
  },
  {
    "text": "next slide steve come on",
    "start": "229360",
    "end": "235879"
  },
  {
    "text": "there we go",
    "start": "240000",
    "end": "243400"
  },
  {
    "text": "is my video going weird a little yeah okay",
    "start": "256799",
    "end": "262880"
  },
  {
    "text": "i i mean but i should probably also caveat that i'm in a hotel room so internet may fluctuate",
    "start": "262880",
    "end": "269919"
  },
  {
    "text": "uh so i'm gonna turn my video off uh just to make sure that i i minimize the disruption for now",
    "start": "269919",
    "end": "275440"
  },
  {
    "text": "um setting the scene a little bit i i want to talk about a little bit about the os top ten because in 2021 the new oauth",
    "start": "275440",
    "end": "282479"
  },
  {
    "text": "top 10 came out and there were some kind of significant uh differences",
    "start": "282479",
    "end": "288639"
  },
  {
    "text": "the ones that we're talking about today is that misconfigurations and insecure design issues came up at well kind of with a",
    "start": "288639",
    "end": "295759"
  },
  {
    "text": "bullet at four and five and that's really what we're talking about today the move to cloud native has meant that",
    "start": "295759",
    "end": "301759"
  },
  {
    "text": "some of the more traditional apsec issues like input sanitization etc have been replaced by misconfigurations and",
    "start": "301759",
    "end": "308000"
  },
  {
    "text": "supply chain risks which is which is fascinating and that's where that's really where we're going to focus heavily",
    "start": "308000",
    "end": "313199"
  },
  {
    "text": "throughout this talk all right this could be",
    "start": "313199",
    "end": "318960"
  },
  {
    "text": "uh teaching you how to suck eggs i believe is the the term they use in in england",
    "start": "318960",
    "end": "324639"
  },
  {
    "text": "but just to explain what github actions are just in case you're completely new to the entire situation uh github",
    "start": "324639",
    "end": "330800"
  },
  {
    "text": "actions is a continuous integration or and or continuous delivery system that allows you to automate your build test",
    "start": "330800",
    "end": "336720"
  },
  {
    "text": "and deployment pipeline most people think a few years ago github is just where you put your code and now you can actually",
    "start": "336720",
    "end": "343199"
  },
  {
    "text": "take action on that code via github actions which is cool trigger off an event and then your",
    "start": "343199",
    "end": "349280"
  },
  {
    "text": "runners can execute different steps and make things happen and we'll see some of that shortly",
    "start": "349280",
    "end": "355120"
  },
  {
    "text": "this is a cut and paste from github's documentation and it's intentional because of the way they give examples of",
    "start": "355120",
    "end": "360160"
  },
  {
    "text": "what what you can do with github actions and that is the workflows that make things happen",
    "start": "360160",
    "end": "366319"
  },
  {
    "text": "are in a specific directory called github slash workflows and the examples that they get give are",
    "start": "366319",
    "end": "372960"
  },
  {
    "text": "perhaps you know hypothetical one workflow to build and test your pull requests another to deploy your application and another interesting one",
    "start": "372960",
    "end": "380400"
  },
  {
    "text": "that says you can add a workflow to add a label every time somebody opens a new issue which is fascinating so we're",
    "start": "380400",
    "end": "385840"
  },
  {
    "text": "going to do a little bit of that and maybe abuse that as an example",
    "start": "385840",
    "end": "392720"
  },
  {
    "text": "this is what a workflow looks like so you can see we've got on push and on that push we're going to run a few very",
    "start": "392720",
    "end": "398720"
  },
  {
    "text": "simple steps so that's like crash course and github actions but you'll certainly go knee deep by the end of this in terms",
    "start": "398720",
    "end": "405199"
  },
  {
    "text": "of what it is we're going to do now the fundamental problems associated with",
    "start": "405199",
    "end": "410479"
  },
  {
    "text": "github actions and this is maybe something that we would say isn't necessarily a design issue but",
    "start": "410479",
    "end": "416000"
  },
  {
    "text": "it's more a case of security awareness that you need to know",
    "start": "416000",
    "end": "421280"
  },
  {
    "text": "and i'm going to just make them all appear github can and",
    "start": "421280",
    "end": "426960"
  },
  {
    "text": "often will run a new workflow that you create in the github workflows path",
    "start": "426960",
    "end": "433360"
  },
  {
    "text": "even if that's the file you committed which seems probably seems kind of weird so if i if i create a new commit and it",
    "start": "433360",
    "end": "440319"
  },
  {
    "text": "happens to be a workflow file that's in that directory and you can't it will run that workflow as",
    "start": "440319",
    "end": "446880"
  },
  {
    "text": "if the workflow was already there which is like seems like a bit of a paradox and it's something that we're going to",
    "start": "446880",
    "end": "452080"
  },
  {
    "text": "play with and we're going to um let's say create some abuse cases for today",
    "start": "452080",
    "end": "457440"
  },
  {
    "text": "uh the second one we're going to look at is metadata like the name of an issue for example or the description are often",
    "start": "457440",
    "end": "465039"
  },
  {
    "text": "are available to workflows like the like an issue grooming one that we're going to add today and",
    "start": "465039",
    "end": "470879"
  },
  {
    "text": "often people there are a lot of examples out there where people are using those inputs for a variety of different ways without",
    "start": "470879",
    "end": "477360"
  },
  {
    "text": "actually checking to make sure that something malicious hasn't been used in place of the name so unsanitized input",
    "start": "477360",
    "end": "482639"
  },
  {
    "text": "which is actually kind of a traditional absence issue the last one actually barack you added",
    "start": "482639",
    "end": "488479"
  },
  {
    "text": "this one so i'm going to let you go for the last one yeah let's say that you have a code repository you'll grant access for all",
    "start": "488479",
    "end": "495919"
  },
  {
    "text": "of your engineering team to write new code into that repository but do you want the",
    "start": "495919",
    "end": "502000"
  },
  {
    "text": "same level of access to your workload files to your deployment pipeline to your ci",
    "start": "502000",
    "end": "508240"
  },
  {
    "text": "pipeline being giving the capability to decide what does to run or to",
    "start": "508240",
    "end": "514159"
  },
  {
    "text": "not run to any engineer and not centralize this level of access to a few individuals",
    "start": "514159",
    "end": "522240"
  },
  {
    "text": "so you cannot have a different set of access controls on workshop files which",
    "start": "522240",
    "end": "527279"
  },
  {
    "text": "is a limitation on on the different git providers",
    "start": "527279",
    "end": "533360"
  },
  {
    "text": "excellent okay so we're going to break down some of the",
    "start": "533519",
    "end": "539040"
  },
  {
    "text": "attack vectors we mentioned earlier and i'm using as the headlines kind of the suggestions that that were in the github",
    "start": "539040",
    "end": "545040"
  },
  {
    "text": "documentation i do a lot of cutting and pasting from github documentation in this presentation",
    "start": "545040",
    "end": "550080"
  },
  {
    "text": "so the idea that a workflow that adds a label every time someone opens a new issue",
    "start": "550080",
    "end": "555200"
  },
  {
    "text": "if there's something that they're doing with the title of the issue and they're doing it the wrong way and we'll look at",
    "start": "555200",
    "end": "560320"
  },
  {
    "text": "examples there might be a way that we can execute a command injection attack on there",
    "start": "560320",
    "end": "567120"
  },
  {
    "text": "the example where we're adding a workflow to build and test pull requests well we can potentially push a new",
    "start": "567120",
    "end": "572160"
  },
  {
    "text": "workflow that does some of the things that we want to be able to do an example we've got here is i could push a workflow that",
    "start": "572160",
    "end": "579760"
  },
  {
    "text": "actually runs a command to the github api that will auto approve my own",
    "start": "579760",
    "end": "586720"
  },
  {
    "text": "comment my own pr which is weird right but it is possible and we're going to talk a little bit more about the power",
    "start": "586720",
    "end": "592720"
  },
  {
    "text": "of the built-in github token that is associated with workflows and of course finally if you're",
    "start": "592720",
    "end": "598320"
  },
  {
    "text": "deploying your application well we can push a new workflow that might exfiltrate some of the environment",
    "start": "598320",
    "end": "604800"
  },
  {
    "text": "variables or some of the github secrets that are that are available to that particular workflow",
    "start": "604800",
    "end": "611120"
  },
  {
    "text": "and in a worst case scenario say if it was a self-hosted runner that is running",
    "start": "611120",
    "end": "616880"
  },
  {
    "text": "you could potentially even run a workflow that would create a reverse shell to a command and control center",
    "start": "616880",
    "end": "623519"
  },
  {
    "text": "central and you would actually be logged into the runner and if that self-hosted runner",
    "start": "623519",
    "end": "628560"
  },
  {
    "text": "happens to be doing happens happens to be in someone's environment",
    "start": "628560",
    "end": "634000"
  },
  {
    "text": "you there's a lot of potential dangers there actually i i'm going to hand over to you sorry brac",
    "start": "634000",
    "end": "639680"
  },
  {
    "text": "like the dame the dangers of me logging into yourself self-hosted runner",
    "start": "639680",
    "end": "645600"
  },
  {
    "text": "so um in a self-hosted runner you have access to of the vpc that the runner is within it",
    "start": "645600",
    "end": "652560"
  },
  {
    "text": "assuming that it's not least privileged so you'll have access potentially to a database that is there to secrets that",
    "start": "652560",
    "end": "658800"
  },
  {
    "text": "are accessible through iem access we also have access to all the environment variables connection strings",
    "start": "658800",
    "end": "665920"
  },
  {
    "text": "for databases even if they're meant to be used in tests secrets and more cpu",
    "start": "665920",
    "end": "671680"
  },
  {
    "text": "horsepower so you can harvest the resources of that",
    "start": "671680",
    "end": "677760"
  },
  {
    "text": "machine or use that to create another attack or learn what else they're out there",
    "start": "677760",
    "end": "683200"
  },
  {
    "text": "in my own vpc network excellent so it's dangerous essentially",
    "start": "683200",
    "end": "689680"
  },
  {
    "text": "and that is what we are going to try and do today uh the attacker context is",
    "start": "689680",
    "end": "694800"
  },
  {
    "text": "there really there's the idea of an external attack and github has a lot of settings around there to try and prevent",
    "start": "694800",
    "end": "700000"
  },
  {
    "text": "external people just being able to push code really easily however it's not exactly like in great",
    "start": "700000",
    "end": "707440"
  },
  {
    "text": "big bold scary alarm bells ringing kind of um bold let's say",
    "start": "707440",
    "end": "713519"
  },
  {
    "text": "for example if i commit something in order for me to in order for workflows to actually execute and i've",
    "start": "713519",
    "end": "718880"
  },
  {
    "text": "never committed to the repo ever ever before there will be this a proven run so you",
    "start": "718880",
    "end": "724240"
  },
  {
    "text": "have to look at it and say okay you know i do i want to push the approve and run to run my workflows and i guess it's",
    "start": "724240",
    "end": "730320"
  },
  {
    "text": "psychologically you might be thinking well my workflows run all sorts of security checks and so of course i want",
    "start": "730320",
    "end": "736320"
  },
  {
    "text": "them to run that would be silly for me not to and i may not realize and you can see the upward arrow there",
    "start": "736320",
    "end": "741760"
  },
  {
    "text": "that if the commit is a workflow i'm allowing that workflow to run by clicking that button which is kind of",
    "start": "741760",
    "end": "748639"
  },
  {
    "text": "it can be easily done um",
    "start": "748639",
    "end": "755440"
  },
  {
    "text": "good it's similar to having this do you do you give your consent for cookies you",
    "start": "755440",
    "end": "761200"
  },
  {
    "text": "click yes are you approving the next windows update yes are you approving",
    "start": "761200",
    "end": "766480"
  },
  {
    "text": "running this uh workflow you'll hit yes and it will lead",
    "start": "766480",
    "end": "771760"
  },
  {
    "text": "to someone utilizing your workers of your ci system for",
    "start": "771760",
    "end": "777360"
  },
  {
    "text": "potentially bad actions yeah because we're humans and we love to",
    "start": "777360",
    "end": "783040"
  },
  {
    "text": "click it's buttons and so the idea of becoming a malicious",
    "start": "783040",
    "end": "788720"
  },
  {
    "text": "insider is is what we're going to kind of play out a little bit today uh there's a lot of things that say if",
    "start": "788720",
    "end": "794240"
  },
  {
    "text": "you're a first-time contributor and you can see there's different security settings down there in the in this image from the github",
    "start": "794240",
    "end": "799920"
  },
  {
    "text": "settings so you can require approvals for first-time contributors who are new to github so that's probably the lowest",
    "start": "799920",
    "end": "805040"
  },
  {
    "text": "security the default is the middle one approval for first-time contributors and then all outside",
    "start": "805040",
    "end": "811760"
  },
  {
    "text": "collaborators with the default it's actually pretty easy to become a first time contributor",
    "start": "811760",
    "end": "818079"
  },
  {
    "text": "you can just make a change to a readme file or do something quite innocuous quite simple so then suddenly you you're",
    "start": "818079",
    "end": "825120"
  },
  {
    "text": "past some of these initial limitations in terms of what you can and can't do so it's not all that doesn't require all",
    "start": "825120",
    "end": "830720"
  },
  {
    "text": "that much real like social engineering to make that happen",
    "start": "830720",
    "end": "835839"
  },
  {
    "text": "so here's kind of a real world story and i'm going to let barack do this because he's the one who showed it to me",
    "start": "837199",
    "end": "842639"
  },
  {
    "text": "it's hilarious uh yeah so we had uh an external contributor uh myong34",
    "start": "842639",
    "end": "849600"
  },
  {
    "text": "uh trying to contribute code to our own open source project named chekhov",
    "start": "849600",
    "end": "855519"
  },
  {
    "text": "and he probably have done it through the web console of github and created a",
    "start": "855519",
    "end": "861120"
  },
  {
    "text": "small file change to one of the files and update or build dial to one of our workflow definition files",
    "start": "861120",
    "end": "868000"
  },
  {
    "text": "let's see how it looks like well our original file on the left side has the",
    "start": "868000",
    "end": "874079"
  },
  {
    "text": "whole build pipeline it has secret scanning it has unit test it has",
    "start": "874079",
    "end": "882079"
  },
  {
    "text": "a static analysis test it has infrastructure as code configuration tests a bunch of a lot of testing to",
    "start": "882079",
    "end": "887760"
  },
  {
    "text": "make sure that the code we are delivering is doing what it should from the business logic reliable",
    "start": "887760",
    "end": "894639"
  },
  {
    "text": "test tested and secured and it's running on a self-hosted runner",
    "start": "894639",
    "end": "900399"
  },
  {
    "text": "on our own vpc on our own segregated environment but the contributor",
    "start": "900399",
    "end": "907120"
  },
  {
    "text": "have tried to get into the self-hosted runner and see what processes are",
    "start": "907120",
    "end": "913040"
  },
  {
    "text": "running in the ps command and print all of the environment variables included including secrets if i have github token",
    "start": "913040",
    "end": "920639"
  },
  {
    "text": "he would have gained access to do github operations if i had aws access keys to",
    "start": "920639",
    "end": "927519"
  },
  {
    "text": "gain access to my aws access keys where my self-hosted runners are actually running",
    "start": "927519",
    "end": "935040"
  },
  {
    "text": "um luckily we had some controls to prevent that from happening but he made a",
    "start": "935040",
    "end": "941040"
  },
  {
    "text": "request to do that change and it was not running but if i would have the default",
    "start": "941040",
    "end": "946639"
  },
  {
    "text": "configuration or a bad configuration and i would have hit a proven run this contributor would have actually",
    "start": "946639",
    "end": "953600"
  },
  {
    "text": "have um our set of environment variables printed into the console",
    "start": "953600",
    "end": "960800"
  },
  {
    "text": "and that's what we're going to do today but we're not going to be so diligent we're going to let it happen",
    "start": "963279",
    "end": "969600"
  },
  {
    "text": "okay so hack number one we're going to do uh is leveraging issue grooming",
    "start": "969600",
    "end": "975759"
  },
  {
    "text": "um i'm going to set a listing this is these are some of the things that when i went to look at github and you can just",
    "start": "975759",
    "end": "981120"
  },
  {
    "text": "search on github.event.issue.title and i'm not going to do it live because",
    "start": "981120",
    "end": "987360"
  },
  {
    "text": "on the grounds that it may incriminate people via the results of the search but this is just one example where i saw",
    "start": "987360",
    "end": "994160"
  },
  {
    "text": "somebody adding the title without checking what it was and generating web pages from it",
    "start": "994160",
    "end": "1001440"
  },
  {
    "text": "um for the website uh so that with the and some of the documentation was saying well this is so you can see how well they're",
    "start": "1001440",
    "end": "1007680"
  },
  {
    "text": "burning down issues of course the reality is that i see that i can actually probably create a title",
    "start": "1007680",
    "end": "1014000"
  },
  {
    "text": "of a of a issue that actually has functional html in it that would potentially",
    "start": "1014000",
    "end": "1020560"
  },
  {
    "text": "present a login form that say oh you've just been logged out of github please log in again and send those credentials",
    "start": "1020560",
    "end": "1026319"
  },
  {
    "text": "off to my malicious site so a very dangerous way to to just blindly use",
    "start": "1026319",
    "end": "1032400"
  },
  {
    "text": "metadata that's been provided without thinking about how how how you should do it and it's interesting because it's",
    "start": "1032400",
    "end": "1038720"
  },
  {
    "text": "actually quite difficult to even try to sanitize that content so best to not do that",
    "start": "1038720",
    "end": "1045120"
  },
  {
    "text": "be careful with what you do with the titles the other example here is",
    "start": "1045120",
    "end": "1050840"
  },
  {
    "text": "where if we search i can there are i think we found something like two and a half thousand examples where people were",
    "start": "1050840",
    "end": "1057919"
  },
  {
    "text": "echoing the issue title and the issue body into the log so they can say i'm about",
    "start": "1057919",
    "end": "1063600"
  },
  {
    "text": "to add a label to this issue documentation the log great now the reality is well what happens if",
    "start": "1063600",
    "end": "1070559"
  },
  {
    "text": "i add my own commands to the issue title and use the the backtick as you can see",
    "start": "1070559",
    "end": "1078559"
  },
  {
    "text": "so that bash executes that command into the echo so suddenly i have remote",
    "start": "1078559",
    "end": "1084320"
  },
  {
    "text": "code execution inside this particular issue and let's let's take a look at how",
    "start": "1084320",
    "end": "1090320"
  },
  {
    "text": "that's going to play out but first actually i should introduce you to the many moving parts that are",
    "start": "1090320",
    "end": "1096160"
  },
  {
    "text": "part of this uh this demo um on this side i have me this is my normal",
    "start": "1096160",
    "end": "1102400"
  },
  {
    "text": "github this is the repo that i have made in prep for this",
    "start": "1102400",
    "end": "1107440"
  },
  {
    "text": "there's a workflow in it it has a license to readme it's very big important read both lots of code there's really nothing in it",
    "start": "1107440",
    "end": "1114240"
  },
  {
    "text": "and then over here i have my malicious attacker currently",
    "start": "1114240",
    "end": "1119919"
  },
  {
    "text": "is an external person because loud canadian as this person is called is not",
    "start": "1119919",
    "end": "1124960"
  },
  {
    "text": "part of that is not a collaborator in that repo other pieces of this i have are i have a",
    "start": "1124960",
    "end": "1132080"
  },
  {
    "text": "site here called webhook.site and that's just waiting for",
    "start": "1132080",
    "end": "1137600"
  },
  {
    "text": "uh curl commands or api commands to to reach it so it's actually if you've never seen it before webhook.site is a",
    "start": "1137600",
    "end": "1142720"
  },
  {
    "text": "really handy site for for things like this or just testing api calls to make sure that your data looks",
    "start": "1142720",
    "end": "1148240"
  },
  {
    "text": "correct and then the final piece of this is over here i will be having i will i will be",
    "start": "1148240",
    "end": "1154320"
  },
  {
    "text": "waiting for a reverse shell but we'll get to that a little a little later so",
    "start": "1154320",
    "end": "1159520"
  },
  {
    "text": "what i want to do now is i'm going to add a workflow so i want to contribute to this i'm going to add a file",
    "start": "1159520",
    "end": "1167760"
  },
  {
    "text": "now you can already see issues.yaml that is going to automatically create a",
    "start": "1170400",
    "end": "1176799"
  },
  {
    "text": "fork of this project because i'm not allowed to just commit something directly to this which",
    "start": "1176799",
    "end": "1181840"
  },
  {
    "text": "is good you know that's a that's very solid defaults",
    "start": "1181840",
    "end": "1187280"
  },
  {
    "text": "so if i paste my issue grooming in here i'm not actually adding labels i'm just going to do the echo of the issue title",
    "start": "1187280",
    "end": "1193039"
  },
  {
    "text": "and i'm going to suggest that this is something this is my first contrib contribution so now i look at a really",
    "start": "1193039",
    "end": "1198320"
  },
  {
    "text": "nice person who's helping and suggesting that hey on your site you might want to do things with issues",
    "start": "1198320",
    "end": "1203919"
  },
  {
    "text": "uh and and that that is it so i'm going to propose this new file",
    "start": "1203919",
    "end": "1210158"
  },
  {
    "text": "i'm going to create the pull request you can see it automatically created",
    "start": "1213840",
    "end": "1219399"
  },
  {
    "text": "there we go that's fine",
    "start": "1220720",
    "end": "1224000"
  },
  {
    "text": "and off we go and we can see things starting to go one workflow waiting approval great that's a good thing",
    "start": "1225840",
    "end": "1232159"
  },
  {
    "text": "so we can come over here to the actual owner we can see the pull request",
    "start": "1232159",
    "end": "1238480"
  },
  {
    "text": "and there's our approve and run and i'm pretty happy with it i'm going to take a look at the files that changed",
    "start": "1238480",
    "end": "1245840"
  },
  {
    "text": "i'm becoming a big fan of loud canadian because oh look at that loud kennedy is such a good person he's trying to help",
    "start": "1245840",
    "end": "1251280"
  },
  {
    "text": "me make my repo better i'm going to say approve and run",
    "start": "1251280",
    "end": "1256799"
  },
  {
    "text": "and we can see there is a workflow here it's just the default i've just added the the one that",
    "start": "1258400",
    "end": "1263520"
  },
  {
    "text": "github gives you that prints hello world so i pre i pre-populated that default",
    "start": "1263520",
    "end": "1268640"
  },
  {
    "text": "workflow so it runs it's fantastic everyone likes it i'm confirming the merge",
    "start": "1268640",
    "end": "1277159"
  },
  {
    "text": "great and now if we go look at the code",
    "start": "1277280",
    "end": "1282240"
  },
  {
    "text": "there's a new issues.yaml and it's going to trigger when i create an issue cool",
    "start": "1283440",
    "end": "1291919"
  },
  {
    "text": "well that's not quite the end so now that i've made that contribution i can create an issue",
    "start": "1291919",
    "end": "1299120"
  },
  {
    "text": "nice well what's my issue going to be it's going to look a lot like and i'm going to cut and paste it because there's no",
    "start": "1299360",
    "end": "1305200"
  },
  {
    "text": "way i'll be able to type this sensibly there's my backtick paste",
    "start": "1305200",
    "end": "1310880"
  },
  {
    "text": "backtick so this is the first potential thing so what i'm doing here is i'm going to get",
    "start": "1310880",
    "end": "1316240"
  },
  {
    "text": "all the environment variables i'm going to a little bit more clever than the one that was submitted to uh to our own",
    "start": "1316240",
    "end": "1321520"
  },
  {
    "text": "checkout repo and pipe that to a curl out to my webhook site right there which",
    "start": "1321520",
    "end": "1328240"
  },
  {
    "text": "is just sitting right there so let's submit that new issue",
    "start": "1328240",
    "end": "1334240"
  },
  {
    "text": "and then we over here and hope it actually executes the issue yaml which it should if",
    "start": "1336159",
    "end": "1342880"
  },
  {
    "text": "we cross our fingers i should be able to come over here click on the actions",
    "start": "1342880",
    "end": "1349280"
  },
  {
    "text": "and there there we go and presto",
    "start": "1349280",
    "end": "1354960"
  },
  {
    "text": "just now 625 i have been far more successful than the attacker on chekhov i now have",
    "start": "1355039",
    "end": "1361840"
  },
  {
    "text": "all the environment variables and poor poor borax aws",
    "start": "1361840",
    "end": "1366880"
  },
  {
    "text": "keys are out in are sitting in my in my public repo so i can go from there",
    "start": "1366880",
    "end": "1373200"
  },
  {
    "text": "not too bad now this is a gate of a github hosted runner so there's nothing really of any damage in there but you",
    "start": "1373200",
    "end": "1378559"
  },
  {
    "text": "can't see though there's an awful lot of information even on a github hosted runner that you might be able to try and",
    "start": "1378559",
    "end": "1384480"
  },
  {
    "text": "find a means with which to leverage all right we can move on to the next",
    "start": "1384480",
    "end": "1392000"
  },
  {
    "text": "example and that was what do you do well what do you do we actually covered a lot of this bradley what can you do with environment variables so i mean we can",
    "start": "1392000",
    "end": "1398480"
  },
  {
    "text": "double down on that is there any any extras that you've thought of in the interim",
    "start": "1398480",
    "end": "1404320"
  },
  {
    "text": "uh i think that one changing the logging level and printing more data uh out that you wouldn't want to print usually",
    "start": "1404320",
    "end": "1411840"
  },
  {
    "text": "like sensitive data more secrets out there and uh we haven't talked about the level",
    "start": "1411840",
    "end": "1418559"
  },
  {
    "text": "of access the github token is giving us but i guess that we have another slide on it later on so we'll cover this later",
    "start": "1418559",
    "end": "1426080"
  },
  {
    "text": "all right amazing so it's it's it's a bad it's a it's an interesting start so we've got some",
    "start": "1426080",
    "end": "1432159"
  },
  {
    "text": "slides on how do we how do we protect ourselves from this product um environment variables can actually have",
    "start": "1432159",
    "end": "1439039"
  },
  {
    "text": "a scope and one of the features that are not used enough in github is the ability",
    "start": "1439039",
    "end": "1444400"
  },
  {
    "text": "to say a specific environment variable belong on into a specific environment for example this secret belongs to",
    "start": "1444400",
    "end": "1451760"
  },
  {
    "text": "production and another secret belongs to them scoping those environment variables",
    "start": "1451760",
    "end": "1457600"
  },
  {
    "text": "is enabling us to have environment protection rules which are not exactly",
    "start": "1457600",
    "end": "1463600"
  },
  {
    "text": "our back but there are a set of controls that we can enforce for example have a set of users that",
    "start": "1463600",
    "end": "1469679"
  },
  {
    "text": "will approve any usage of that environment variable so let's say that i have on the next slide",
    "start": "1469679",
    "end": "1476480"
  },
  {
    "text": "a pipeline [Music]",
    "start": "1476480",
    "end": "1482080"
  },
  {
    "text": "and within that pipeline i have the requirement to deploy to production website my website is called github.com",
    "start": "1482080",
    "end": "1488640"
  },
  {
    "text": "it could have been acme.com or something else who is the allowed practitioner that",
    "start": "1488640",
    "end": "1494880"
  },
  {
    "text": "should approve any change to my production environment or a set of practitioners if i want two",
    "start": "1494880",
    "end": "1500559"
  },
  {
    "text": "people to have their eyes on that last change that's fine too i can create an environment protection rule that will",
    "start": "1500559",
    "end": "1506960"
  },
  {
    "text": "say only people only two people or more are required before setting up a new",
    "start": "1506960",
    "end": "1513600"
  },
  {
    "text": "version of github.com let's hit the next one",
    "start": "1513600",
    "end": "1520640"
  },
  {
    "text": "another thing that we can do is eliminate the need of putting sensitive data in environment variables and",
    "start": "1522880",
    "end": "1528799"
  },
  {
    "text": "secrets from the first place github have exposed the ability to use roles and assume roles to have ephemeral",
    "start": "1528799",
    "end": "1536880"
  },
  {
    "text": "access of our self-hosted runners so let's say that i want to create a deployment to my aws",
    "start": "1536880",
    "end": "1543600"
  },
  {
    "text": "account i don't have to use aws access keys the thing that i can do is i can use the zoom role and to get to have",
    "start": "1543600",
    "end": "1551039"
  },
  {
    "text": "temporal access and within aws i can limit this level of access even if it's admin required for",
    "start": "1551039",
    "end": "1557279"
  },
  {
    "text": "deployment to come only from a specific set of ip addresses so if i'll configure",
    "start": "1557279",
    "end": "1562880"
  },
  {
    "text": "all of the deployments to come from a trusted ip that can be a static ip within a trusted subnet i can enforce",
    "start": "1562880",
    "end": "1570000"
  },
  {
    "text": "zero trust on deployment actions that are happening within my environment",
    "start": "1570000",
    "end": "1576559"
  },
  {
    "text": "and i will not have any access keys in my environment variables because i'm using a thermal",
    "start": "1576559",
    "end": "1583120"
  },
  {
    "text": "um roles that's another option uh to protect your aws tokens",
    "start": "1583200",
    "end": "1589840"
  },
  {
    "text": "and you can utilize aws tools to make those roles least privileged",
    "start": "1591200",
    "end": "1596559"
  },
  {
    "text": "also hack number two hack number two yeah crypto tracking docker image used in workflow all right",
    "start": "1596640",
    "end": "1602960"
  },
  {
    "text": "i'm gonna let you do this one too all right let's say that i have an unsecured workflow uh i created that but",
    "start": "1602960",
    "end": "1609600"
  },
  {
    "text": "it could have been a legit one within my workflow i'm using a specific",
    "start": "1609600",
    "end": "1614799"
  },
  {
    "text": "image for my job i'm using an image that called gay kkws nginx it",
    "start": "1614799",
    "end": "1621760"
  },
  {
    "text": "is a legitimate or looking legitimate image that will create a web server",
    "start": "1621760",
    "end": "1627279"
  },
  {
    "text": "within my integration test of my build workflow but",
    "start": "1627279",
    "end": "1633360"
  },
  {
    "text": "on the next slide we'll see that actually this nginx image",
    "start": "1633360",
    "end": "1639919"
  },
  {
    "text": "is poisoned it can run a vulnerable docker download it from docker hub and it might",
    "start": "1639919",
    "end": "1647440"
  },
  {
    "text": "be the case where that specific image has a cryptominer meaning on every commit on every",
    "start": "1647440",
    "end": "1654240"
  },
  {
    "text": "pipeline trigger on the pipeline that i had on the previous slide it was on every request",
    "start": "1654240",
    "end": "1660399"
  },
  {
    "text": "a cryptid or cryptominer will be executed and communicate with a c2 server just",
    "start": "1660399",
    "end": "1666880"
  },
  {
    "text": "because the image that i'm using is not a lg tool now this image used to be existing",
    "start": "1666880",
    "end": "1674399"
  },
  {
    "text": "about a year ago docker have removed it from the docker hub registry but let's",
    "start": "1674399",
    "end": "1679919"
  },
  {
    "text": "look on the content that was there xm rig is a crypto miner",
    "start": "1679919",
    "end": "1686159"
  },
  {
    "text": "that can be executed and the entry point within that docker file was just renaming",
    "start": "1686159",
    "end": "1692640"
  },
  {
    "text": "xm rig into nginx so i thought that i'm going to run a web server and",
    "start": "1692640",
    "end": "1699360"
  },
  {
    "text": "instead of it i had a crypto miner and the attacker potentially could have",
    "start": "1699360",
    "end": "1704480"
  },
  {
    "text": "done a lot of money just by submitting full requests",
    "start": "1704480",
    "end": "1709520"
  },
  {
    "text": "so one of the in other words one of the possible attacks is using that images as the",
    "start": "1709520",
    "end": "1716720"
  },
  {
    "text": "images of the workers in the different steps in a workflow so not only you need to check for",
    "start": "1716720",
    "end": "1723520"
  },
  {
    "text": "shell injection and do input sanitization should also verify what are the images that are being used",
    "start": "1723520",
    "end": "1730240"
  },
  {
    "text": "on every step of the pipeline",
    "start": "1730240",
    "end": "1733840"
  },
  {
    "text": "and there's a very good reason why we're not doing this one is because we don't want to start writing crypto miners on",
    "start": "1735279",
    "end": "1741200"
  },
  {
    "text": "github's um runners so we don't want to get in trouble",
    "start": "1741200",
    "end": "1746559"
  },
  {
    "text": "um hack number three now i'm going to combine hack three and four so i will be doing three but i'm going to",
    "start": "1746559",
    "end": "1752559"
  },
  {
    "text": "do it while i'm showing you four but the idea here is just to introduce you to the concept of branch protection rules",
    "start": "1752559",
    "end": "1759919"
  },
  {
    "text": "so that approvals require a pull request before merging and what the defaults are associated",
    "start": "1759919",
    "end": "1766320"
  },
  {
    "text": "with that because by default if we go over here my my branch protection is off i have no",
    "start": "1766320",
    "end": "1773039"
  },
  {
    "text": "rules whatsoever if i come here and i look i have nothing which actually opens up",
    "start": "1773039",
    "end": "1778880"
  },
  {
    "text": "an awful lot of freedoms for people who are committing to my repo",
    "start": "1778880",
    "end": "1784080"
  },
  {
    "text": "so what i will do is i will assign my branch protection to main and this to be secure i will say",
    "start": "1784399",
    "end": "1792080"
  },
  {
    "text": "require a pull request before merging and it automatically takes require approvals",
    "start": "1792080",
    "end": "1797520"
  },
  {
    "text": "fantastic now what's interesting about this is that if we are",
    "start": "1797520",
    "end": "1802960"
  },
  {
    "text": "happy with we could probably do a whole talk just on all of these but you can see now allow force pushes is unticked there's a",
    "start": "1802960",
    "end": "1809520"
  },
  {
    "text": "lot of set very good sensible defaults here we'll talk a little bit at the end about",
    "start": "1809520",
    "end": "1815039"
  },
  {
    "text": "requiring sign commits which a lot of people don't do by default and that requires a certain amount of extra work",
    "start": "1815039",
    "end": "1821120"
  },
  {
    "text": "but what i've highlighted back here on the slide is the very teeny tiny awkwardly positioned",
    "start": "1821120",
    "end": "1827840"
  },
  {
    "text": "one there so that means i only need one approval",
    "start": "1827840",
    "end": "1833440"
  },
  {
    "text": "and okay sounds good but at least i'm doing something the good news is that branch",
    "start": "1833440",
    "end": "1838960"
  },
  {
    "text": "protection rules are great and occasionally maybe the d and the defaults are actually generally pretty good but that's one",
    "start": "1838960",
    "end": "1845120"
  },
  {
    "text": "interesting default that is there and that's what we're going to try and get around so we've done the right thing",
    "start": "1845120",
    "end": "1851039"
  },
  {
    "text": "we've got our branch protection on there now i'm going to say create",
    "start": "1851039",
    "end": "1855919"
  },
  {
    "text": "and we are good to go there so the theory here is that what if i",
    "start": "1856880",
    "end": "1861919"
  },
  {
    "text": "want to submit a pull request with a new workflow we talked about doing that right and this particular one is just kind of blatantly called approve",
    "start": "1861919",
    "end": "1868799"
  },
  {
    "text": "and on a pull request it runs a curl that will actually instruct the github",
    "start": "1868799",
    "end": "1875760"
  },
  {
    "text": "api to approve now this is where we're going to talk a little bit about what can the provided github token do",
    "start": "1875760",
    "end": "1883279"
  },
  {
    "text": "and on its own right now this would not work because i am not a",
    "start": "1883279",
    "end": "1888640"
  },
  {
    "text": "contributor i am not a collaborator on this project i am right now just a casual open source",
    "start": "1888640",
    "end": "1895200"
  },
  {
    "text": "contributor but because i've been so good and i've been so kind",
    "start": "1895200",
    "end": "1901120"
  },
  {
    "text": "to the repo over during during my social engineering phase",
    "start": "1901120",
    "end": "1907360"
  },
  {
    "text": "i ask if i can be oh canada geez only from there",
    "start": "1907360",
    "end": "1915039"
  },
  {
    "text": "i can be a collaborator and they say yeah you've done you've done the issue grooming thing and you",
    "start": "1915039",
    "end": "1921039"
  },
  {
    "text": "fixed a readme file and so now i now now that that actually",
    "start": "1921039",
    "end": "1926080"
  },
  {
    "text": "changes just enough for this github token to have the credentials to execute that",
    "start": "1926080",
    "end": "1932399"
  },
  {
    "text": "that api now here's a weird caveat that came up",
    "start": "1932399",
    "end": "1938320"
  },
  {
    "text": "while i was creating this talk about a month ago when i created the",
    "start": "1938320",
    "end": "1943600"
  },
  {
    "text": "first repo like the one i've got here the default settings",
    "start": "1943600",
    "end": "1950000"
  },
  {
    "text": "for this particular these github actions under general",
    "start": "1950000",
    "end": "1956320"
  },
  {
    "text": "were like this and in fact i even have the original repo here which is set like this",
    "start": "1956320",
    "end": "1963039"
  },
  {
    "text": "now if you create a new repo the default is that",
    "start": "1963039",
    "end": "1968799"
  },
  {
    "text": "which is good because you can see workflows have read permissions in the",
    "start": "1968799",
    "end": "1975039"
  },
  {
    "text": "repository and only you can't do writing you can't write to the repository you can't",
    "start": "1975039",
    "end": "1980559"
  },
  {
    "text": "execute and change approve you can't use it you get of actions cannot create pull",
    "start": "1980559",
    "end": "1986159"
  },
  {
    "text": "requests or approve pull requests but if you are if you are a github user",
    "start": "1986159",
    "end": "1992240"
  },
  {
    "text": "go and look at your repos that were created more than a month ago they will all have these settings now",
    "start": "1992240",
    "end": "1997679"
  },
  {
    "text": "which weren't there before but they'll all be like that and so that's there's a little important",
    "start": "1997679",
    "end": "2003679"
  },
  {
    "text": "security tip there if you really care about your repos maybe go fix that",
    "start": "2003679",
    "end": "2008799"
  },
  {
    "text": "so i have set this up intentionally the way it used to be because that's probably how 99.9999",
    "start": "2008799",
    "end": "2014880"
  },
  {
    "text": "of all repos still are in github good okay so",
    "start": "2014880",
    "end": "2022559"
  },
  {
    "text": "act number four big finish",
    "start": "2025120",
    "end": "2029880"
  },
  {
    "text": "uh steve i cannot hear",
    "start": "2058639",
    "end": "2061838"
  },
  {
    "text": "how's that we can hear you now all right all right i think my microphone just died i had to",
    "start": "2094720",
    "end": "2101680"
  },
  {
    "text": "switch uh thank you for letting me know and thank you for uh in the chat also confirming that uh it's not just barack",
    "start": "2101680",
    "end": "2108640"
  },
  {
    "text": "um losing his hearing so the token expires when the job",
    "start": "2108640",
    "end": "2113839"
  },
  {
    "text": "finishes which is a very limited amount of time typically so it's generated and it's destroyed it's a",
    "start": "2113839",
    "end": "2119119"
  },
  {
    "text": "pretty good smart default",
    "start": "2119119",
    "end": "2123039"
  },
  {
    "text": "if we want to look at a little bit more detail a job can last up to six hours actually it's kind of a long time i mean",
    "start": "2124480",
    "end": "2129839"
  },
  {
    "text": "not that we haven't even internally exceeded that and had to break some of our research but it means okay",
    "start": "2129839",
    "end": "2136240"
  },
  {
    "text": "i've got six hours of life for a single job for that github token to exist okay we know that",
    "start": "2136240",
    "end": "2142800"
  },
  {
    "text": "and if we want to find out what the default permissions for our workflow token are this is a table which is from the github",
    "start": "2142800",
    "end": "2148400"
  },
  {
    "text": "documentation and i always find very confusing because when something says default",
    "start": "2148400",
    "end": "2153680"
  },
  {
    "text": "twice i don't necessarily know which default i've got",
    "start": "2153680",
    "end": "2159599"
  },
  {
    "text": "but you can roughly assume that the non-collaborator is the middle and i've just upgraded myself",
    "start": "2159599",
    "end": "2165040"
  },
  {
    "text": "significantly to have a lot more capability with that token by becoming a",
    "start": "2165040",
    "end": "2170079"
  },
  {
    "text": "collaborator what i also find interesting from the github documentation is that if for some",
    "start": "2170079",
    "end": "2176240"
  },
  {
    "text": "reason the github token isn't doing what you want it to do so you want to extend the capabilities of the token their",
    "start": "2176240",
    "end": "2182720"
  },
  {
    "text": "suggestion is to create a personal access token and then add it as a secret now",
    "start": "2182720",
    "end": "2188400"
  },
  {
    "text": "as we've already discussed if you saw the way that i export exfiltrated the environment variables if",
    "start": "2188400",
    "end": "2194560"
  },
  {
    "text": "i could do the same with secrets then suddenly i would have a potentially significantly",
    "start": "2194560",
    "end": "2199680"
  },
  {
    "text": "persisting github token that doesn't just vanish after six hours i have a personal access",
    "start": "2199680",
    "end": "2205440"
  },
  {
    "text": "token that might do some real damage and so here's the here's the big finish now",
    "start": "2205440",
    "end": "2211760"
  },
  {
    "text": "this is very small so i'm going to zoom in on there and show an example of what i could do in a workflow now the first",
    "start": "2211760",
    "end": "2219680"
  },
  {
    "text": "one is me echoing all of those secrets so that token into a file and then i send",
    "start": "2219680",
    "end": "2225920"
  },
  {
    "text": "that file to myself just like i did before with the environment variables out to my malicious web",
    "start": "2225920",
    "end": "2232240"
  },
  {
    "text": "webhook.site so now if there is a github token that is potentially significant or any other",
    "start": "2232240",
    "end": "2238320"
  },
  {
    "text": "secrets at all i have all of them and then afterwards the same thing that i did on the issue grooming is i'm going",
    "start": "2238320",
    "end": "2244480"
  },
  {
    "text": "to give myself all the environment variables so i kind of am attempting to get the keys to the kingdom out of this",
    "start": "2244480",
    "end": "2249839"
  },
  {
    "text": "particular this runner now here's an example i'm just going to",
    "start": "2249839",
    "end": "2255680"
  },
  {
    "text": "take an aside and something that i found when we were doing the research for this this project",
    "start": "2255680",
    "end": "2261760"
  },
  {
    "text": "uh there are actions in the github marketplace which then do encourage the",
    "start": "2261760",
    "end": "2266880"
  },
  {
    "text": "creation of a personal access token as your github token because they want to enhance the capabilities associated with",
    "start": "2266880",
    "end": "2273119"
  },
  {
    "text": "github nothing wrong with that the example i found",
    "start": "2273119",
    "end": "2278560"
  },
  {
    "text": "is",
    "start": "2278560",
    "end": "2281560"
  },
  {
    "text": "is an organ there was a particular action that was adding to the capabilities of auto merging pull",
    "start": "2284079",
    "end": "2289119"
  },
  {
    "text": "requests and in order to do this you can see in tiny down letters down there the first",
    "start": "2289119",
    "end": "2295119"
  },
  {
    "text": "step in this github action was create a personal access token with the right to",
    "start": "2295119",
    "end": "2300400"
  },
  {
    "text": "merge pull requests now as a baddie i'd love to have that token",
    "start": "2300400",
    "end": "2306480"
  },
  {
    "text": "that would be fantastic because not only could i approve but i could emerge so that's even better now now i'm just",
    "start": "2306480",
    "end": "2312480"
  },
  {
    "text": "bypassing the entire system and adding whatever code i want to the repository super duper",
    "start": "2312480",
    "end": "2318160"
  },
  {
    "text": "so then i went and searched github to find out who uses this auto merge because then i know",
    "start": "2318160",
    "end": "2324320"
  },
  {
    "text": "that they have a github token that i want because otherwise they wouldn't be using this this action",
    "start": "2324320",
    "end": "2330000"
  },
  {
    "text": "it turns out i found an organization i made that name up node core sure that makes other github actions",
    "start": "2330000",
    "end": "2337920"
  },
  {
    "text": "and they're using the auto merge on their own github action creation so i thought excellent this is fantastic if i",
    "start": "2337920",
    "end": "2344160"
  },
  {
    "text": "could do something like create a submit a workflow that allows me to pull that token out",
    "start": "2344160",
    "end": "2349359"
  },
  {
    "text": "then i can actually add my own code to those actions and then i can go find out",
    "start": "2349359",
    "end": "2355359"
  },
  {
    "text": "further on well who uses the node core actions",
    "start": "2355359",
    "end": "2360400"
  },
  {
    "text": "lots of people whatever action is the most prolific throughout the industry i will then add my bad code to that action",
    "start": "2360400",
    "end": "2366960"
  },
  {
    "text": "and suddenly i'm in one of those bizarre supply chain attacks where i'm adding codes somewhere far back the",
    "start": "2366960",
    "end": "2373920"
  },
  {
    "text": "weak link in the supply chain and people who are using that are now somewhere downstream",
    "start": "2373920",
    "end": "2380160"
  },
  {
    "text": "and it's a little bit like like almost like i don't say a solar winds but i'm i'm manipulating something",
    "start": "2380160",
    "end": "2387280"
  },
  {
    "text": "simply because there was an over privileged github token that i was able to extract so this this is a",
    "start": "2387280",
    "end": "2393040"
  },
  {
    "text": "hypothetical scenario that i may have that does exist in a variety of forms on",
    "start": "2393040",
    "end": "2399760"
  },
  {
    "text": "github",
    "start": "2399760",
    "end": "2402079"
  },
  {
    "text": "so here's here's the zoom in on what we were looking at earlier and then you can see i've added a sleep of an hour so for some reason i wanted that github token",
    "start": "2405760",
    "end": "2412400"
  },
  {
    "text": "that i just pulled out to exist and i wanted an hour to poke around with it okay i can submit something that gives",
    "start": "2412400",
    "end": "2418079"
  },
  {
    "text": "me a bit of a delay kind of cool",
    "start": "2418079",
    "end": "2423400"
  },
  {
    "text": "or in a more targeted and malicious version of this i could export all of my secrets",
    "start": "2424319",
    "end": "2431119"
  },
  {
    "text": "all of my environment variables and export a shell or a reverse shell in",
    "start": "2431119",
    "end": "2436319"
  },
  {
    "text": "this case back to my command and control and then i'm actually logged in to the runner",
    "start": "2436319",
    "end": "2442160"
  },
  {
    "text": "so not only do i have all the keys but i'm actually there and i can start to do the typical pen testing top 10 and",
    "start": "2442160",
    "end": "2449200"
  },
  {
    "text": "look at the network look at what processes are running maybe run an nmap and just see what it is i have access to",
    "start": "2449200",
    "end": "2454960"
  },
  {
    "text": "and if i as barack suggested if i have access to a particular database i can kind of take my time on this or i can",
    "start": "2454960",
    "end": "2461520"
  },
  {
    "text": "automate what i want to do so it can be a teeny tiny bit dangerous",
    "start": "2461520",
    "end": "2468880"
  },
  {
    "text": "so let's take a look if this is possible it seems like i'm you know pie in the",
    "start": "2470480",
    "end": "2475599"
  },
  {
    "text": "sky here that if this is something that i could actually execute i'm still here",
    "start": "2475599",
    "end": "2481119"
  },
  {
    "text": "i'm going to go into my workflows again and i'm now a collaborator",
    "start": "2481119",
    "end": "2486160"
  },
  {
    "text": "so i'm going to add a file",
    "start": "2486160",
    "end": "2489039"
  },
  {
    "text": "and i'm going to paste in that huge thing you just saw",
    "start": "2491200",
    "end": "2496720"
  },
  {
    "text": "called big c i 2 and it's rather long so i'm going to get",
    "start": "2497440",
    "end": "2503839"
  },
  {
    "text": "a lot of code and push it just here okay",
    "start": "2503839",
    "end": "2508960"
  },
  {
    "text": "so on my pull request i hope this is a not too small but it's going to come in and it's going to",
    "start": "2508960",
    "end": "2515359"
  },
  {
    "text": "approve the pull request for itself and then start to run all of my exfiltration and my reverse",
    "start": "2515359",
    "end": "2522079"
  },
  {
    "text": "shell kind of complicated nothing",
    "start": "2522079",
    "end": "2528720"
  },
  {
    "text": "to see here",
    "start": "2529119",
    "end": "2532240"
  },
  {
    "text": "it seems good and i'm going to call it blatantly pond.yaml",
    "start": "2535280",
    "end": "2542319"
  },
  {
    "text": "i'm going to i'm going to submit this but what i first have to do is",
    "start": "2543280",
    "end": "2548480"
  },
  {
    "text": "i have i'm not waiting for anything am i so i'm gonna have to do the uh the receiving side of this so give me",
    "start": "2548480",
    "end": "2555839"
  },
  {
    "text": "one second to run to execute that actually it might be my history",
    "start": "2555839",
    "end": "2562880"
  },
  {
    "text": "my my internet has kicked me out oh if that's the only thing that goes wrong",
    "start": "2565280",
    "end": "2570640"
  },
  {
    "text": "i'll be pretty happy with that",
    "start": "2570640",
    "end": "2573680"
  },
  {
    "text": "all right great",
    "start": "2576400",
    "end": "2583119"
  },
  {
    "text": "okay so i'm sitting and listening",
    "start": "2585200",
    "end": "2589318"
  },
  {
    "text": "and once again it's going to say yeah this looks perfectly good pull request you can see the changes are",
    "start": "2594720",
    "end": "2600160"
  },
  {
    "text": "there it seems happy with it and i'm creating a pull request again",
    "start": "2600160",
    "end": "2607838"
  },
  {
    "text": "so you can see i should i've only got one thing here so hopefully that works it works it says there's one review required but you can see it's actually",
    "start": "2609520",
    "end": "2616000"
  },
  {
    "text": "running my workflow i don't have to say approve and run it's actually just going to do it",
    "start": "2616000",
    "end": "2622240"
  },
  {
    "text": "which is kind of like kind of crazy but that's what that's the entire thing that we're trying to take",
    "start": "2622240",
    "end": "2627520"
  },
  {
    "text": "advantage of yeah while it's running i will say that",
    "start": "2627520",
    "end": "2633920"
  },
  {
    "text": "github does give us the controls to prevent that from happening if you are not configuring correctly",
    "start": "2633920",
    "end": "2640319"
  },
  {
    "text": "it's your responsibility to configure your environment to be secure you have the tools to prevent it",
    "start": "2640319",
    "end": "2646880"
  },
  {
    "text": "but and we're going to demo more tools but if you haven't done it you're you're making yourself",
    "start": "2646880",
    "end": "2654079"
  },
  {
    "text": "vulnerable to these scenarios so either misconfiguration or not hardening your",
    "start": "2654079",
    "end": "2659200"
  },
  {
    "text": "environment can lead to that we have the tools provided by github to fix it",
    "start": "2659200",
    "end": "2666480"
  },
  {
    "text": "cool so we can see the build has started looks like my approve",
    "start": "2668000",
    "end": "2673920"
  },
  {
    "text": "something was going to go wrong my approve failed i was probably something a permission i missed somehow with my collaborator to auto approve myself darn",
    "start": "2675119",
    "end": "2682560"
  },
  {
    "text": "but that's fine uh the rest of it was worked just fine so you can see up over here now i have",
    "start": "2682560",
    "end": "2688480"
  },
  {
    "text": "my github token my environment variables and",
    "start": "2688480",
    "end": "2693599"
  },
  {
    "text": "a login on the runner um even though the approved didn't work",
    "start": "2693599",
    "end": "2699839"
  },
  {
    "text": "that is actually i'm pretty happy with that and things i can do we talked about many things that i could",
    "start": "2699839",
    "end": "2705920"
  },
  {
    "text": "do i mean something that is sort of interesting is i can do a fetch",
    "start": "2705920",
    "end": "2711359"
  },
  {
    "text": "of any other branches that might exist",
    "start": "2711359",
    "end": "2715200"
  },
  {
    "text": "the branch that was created as part of this",
    "start": "2716960",
    "end": "2723200"
  },
  {
    "text": "i can go grab which is loud canadian",
    "start": "2724240",
    "end": "2728720"
  },
  {
    "text": "patch two so i can go yeah check out",
    "start": "2729440",
    "end": "2734960"
  },
  {
    "text": "oh i can spell",
    "start": "2735359",
    "end": "2738318"
  },
  {
    "text": "interesting okay i think i was going to do is is that my",
    "start": "2741760",
    "end": "2747119"
  },
  {
    "text": "branch name",
    "start": "2747119",
    "end": "2749599"
  },
  {
    "text": "okay",
    "start": "2757440",
    "end": "2760440"
  },
  {
    "text": "i'm just going to add a file to this i'm going to add this to",
    "start": "2763920",
    "end": "2769040"
  },
  {
    "text": "here and i'm going to see if my",
    "start": "2769200",
    "end": "2774640"
  },
  {
    "text": "if i'm in the right space",
    "start": "2774640",
    "end": "2779680"
  },
  {
    "text": "i should be able to see if that is there okay that's the that's the",
    "start": "2780480",
    "end": "2785680"
  },
  {
    "text": "evidence let's say what if i were to remove that i don't want that there",
    "start": "2785680",
    "end": "2791680"
  },
  {
    "text": "get [Music]",
    "start": "2791680",
    "end": "2798400"
  },
  {
    "text": "removal of that",
    "start": "2798400",
    "end": "2801960"
  },
  {
    "text": "and this is one that you said me barack which i thought was fascinating is the ability to just set my name to be with whoever i want",
    "start": "2804480",
    "end": "2811838"
  },
  {
    "text": "and then i can commit those changes back to the branch that is existing as part of the workflow which is kind of strange",
    "start": "2814800",
    "end": "2821920"
  },
  {
    "text": "and this is the part that i hope works because it's just uh some reason my branching was being bit strange there oops",
    "start": "2822400",
    "end": "2830359"
  },
  {
    "text": "and this is where i wanted to commit back to there's a lot of there's a lot of risk",
    "start": "2837760",
    "end": "2844400"
  },
  {
    "text": "going on here did i spell the uh the branch wrong on a",
    "start": "2844400",
    "end": "2850559"
  },
  {
    "text": "brack if you uh remember what my branch was called i",
    "start": "2850559",
    "end": "2856319"
  },
  {
    "text": "thought it was patch two it was just called patch two was that what i got wrong",
    "start": "2856319",
    "end": "2862079"
  },
  {
    "text": "apologies this is where we're gonna have running out of time isn't it this is the first",
    "start": "2862079",
    "end": "2867680"
  },
  {
    "text": "time run this i didn't know how long it was",
    "start": "2867680",
    "end": "2873520"
  },
  {
    "text": "gonna be is that correct yes",
    "start": "2873520",
    "end": "2878640"
  },
  {
    "text": "uh can you run git hatch before that",
    "start": "2878640",
    "end": "2883400"
  },
  {
    "text": "darn it's blowing up on me isn't it",
    "start": "2892319",
    "end": "2895839"
  },
  {
    "text": "and we are running out of time darn so the thing is we",
    "start": "2899200",
    "end": "2904800"
  },
  {
    "text": "could have done is uh to delete all the trails of the actual attack that just happened uh from we",
    "start": "2904800",
    "end": "2911599"
  },
  {
    "text": "need the server by creating another commit hiding off those changes",
    "start": "2911599",
    "end": "2917119"
  },
  {
    "text": "so that and that is exactly what these steps do yeah that when they work",
    "start": "2917119",
    "end": "2922240"
  },
  {
    "text": "if the branches if we don't rush it and the branch works you can do that you can delete the phone you can add a file you",
    "start": "2922240",
    "end": "2928720"
  },
  {
    "text": "can add it to somebody else and when you come back over here if you can use your imagination",
    "start": "2928720",
    "end": "2934240"
  },
  {
    "text": "the pull request contents will change away from being",
    "start": "2934240",
    "end": "2939440"
  },
  {
    "text": "the workflow content and that will just be an instant readme that's what that was supposed to be the",
    "start": "2939440",
    "end": "2945839"
  },
  {
    "text": "big finish this would have been gone and there would have been something very innocent there so where we would have had a reverse shell we would cover our tracks",
    "start": "2945839",
    "end": "2952800"
  },
  {
    "text": "and now that we only have eight minutes left i'm out of time to actually redo this again which is very disappointing",
    "start": "2952800",
    "end": "2959520"
  },
  {
    "text": "but it will leave you in suspense next time we have to do this talk it will probably work better and i should always record",
    "start": "2959520",
    "end": "2965599"
  },
  {
    "text": "my live demos just in case they blow up",
    "start": "2965599",
    "end": "2970520"
  },
  {
    "text": "but the best practices we are meant to learn from this and i'll put them down here quickly in the interest of time yeah and we've seen all of them",
    "start": "2971760",
    "end": "2978480"
  },
  {
    "text": "turning on branch production not adding permissive github tokens using a short life span",
    "start": "2978480",
    "end": "2983599"
  },
  {
    "text": "personal access to if you do go that route and give that token as little privilege as you as it needs",
    "start": "2983599",
    "end": "2990079"
  },
  {
    "text": "don't run workflows unless you're 100 sure be careful when you're adding contributors because it could be a social engineering kind of exercise",
    "start": "2990079",
    "end": "2997280"
  },
  {
    "text": "and use the environments protectionist brac told us all about scope secrets to environments",
    "start": "2997280",
    "end": "3002319"
  },
  {
    "text": "of course finally single sign-on multi-factor sign commit all the things that we say we're going",
    "start": "3002319",
    "end": "3008400"
  },
  {
    "text": "to do we never get around to those are all great advices and finally scanning all of your reference container",
    "start": "3008400",
    "end": "3014800"
  },
  {
    "text": "images um the final thing we want to add outside of best practices is that our open source tool that we did all the",
    "start": "3014800",
    "end": "3020880"
  },
  {
    "text": "research for is called check off and check off is the most most let's say most cover",
    "start": "3020880",
    "end": "3026319"
  },
  {
    "text": "biased most comprehensive misconfiguration scanner for infrastructures code uh version control",
    "start": "3026319",
    "end": "3031359"
  },
  {
    "text": "systems nci pipeline is code just like what we just saw and it looks rejects from github gitlab and bitbucket more",
    "start": "3031359",
    "end": "3037760"
  },
  {
    "text": "brainworks to come soon and the other",
    "start": "3037760",
    "end": "3043599"
  },
  {
    "text": "all my windows have rearranged an example of that being for example if i was to run check up as simple as this",
    "start": "3043599",
    "end": "3050160"
  },
  {
    "text": "on the example files that i've got here like tell me a secret.yaml we can see",
    "start": "3050160",
    "end": "3055760"
  },
  {
    "text": "that it runs a series looking for curls with secrets looking for netcast looking for ip addresses and of course in this one",
    "start": "3055760",
    "end": "3062079"
  },
  {
    "text": "it found that i was trying to curl out all of my secrets and check out you can get for free check",
    "start": "3062079",
    "end": "3068079"
  },
  {
    "text": "out is here is at checkout.io where you can learn more about it",
    "start": "3068079",
    "end": "3074400"
  },
  {
    "text": "and start using it immediately and it has integrations with",
    "start": "3074400",
    "end": "3079760"
  },
  {
    "text": "vs code and jetbrains ides and it does all sorts of wonderful things in terms of",
    "start": "3079760",
    "end": "3084800"
  },
  {
    "text": "infrastructures codes so that is our takeaway",
    "start": "3084800",
    "end": "3090640"
  },
  {
    "text": "and finally you can add as a github action and that can be pretty critical because",
    "start": "3091119",
    "end": "3096480"
  },
  {
    "text": "can you run it as your first github action to make sure that the workflows that you're about to approve and run aren't going to be the thing that's",
    "start": "3096480",
    "end": "3102559"
  },
  {
    "text": "malicious probably a good idea i would think",
    "start": "3102559",
    "end": "3108000"
  },
  {
    "text": "because you can find that although all of the things that i did today are preventable via check off and best practices",
    "start": "3108000",
    "end": "3116400"
  },
  {
    "text": "particularly when they work uh we only have five minutes left so the takeaways secure design",
    "start": "3116480",
    "end": "3122559"
  },
  {
    "text": "uh takes work unfortunately open source tools are there to help this configurations are first class problems",
    "start": "3122559",
    "end": "3127760"
  },
  {
    "text": "defaults as usual are not secure and pipelines code security can and should be applied to all phases throughout the",
    "start": "3127760",
    "end": "3133200"
  },
  {
    "text": "ci all of this can be done very very easily and with the help of additional automation that is the end i'm sorry that big",
    "start": "3133200",
    "end": "3139920"
  },
  {
    "text": "finish didn't work that's so frustrating",
    "start": "3139920",
    "end": "3144000"
  },
  {
    "text": "right thank you everyone if you have any questions now it's good time to put them on chat",
    "start": "3146720",
    "end": "3153838"
  },
  {
    "text": "thank y'all yes any questions pop them in the chat and we will get to them with the five minutes we",
    "start": "3154079",
    "end": "3160319"
  },
  {
    "text": "have left hopefully very",
    "start": "3160319",
    "end": "3167119"
  },
  {
    "text": "it was the first time we did that one sorry obviously because it didn't 100 work but we did a lot of damage by getting the",
    "start": "3168240",
    "end": "3174960"
  },
  {
    "text": "reverse shell and explorating all of the content so it was good",
    "start": "3174960",
    "end": "3180960"
  },
  {
    "text": "gail did great does anyone have questions",
    "start": "3180960",
    "end": "3185920"
  },
  {
    "text": "going once all right well steven barack thank y'all",
    "start": "3189119",
    "end": "3196079"
  },
  {
    "text": "so much um i know you're at a conference so thank you very much",
    "start": "3196079",
    "end": "3201440"
  },
  {
    "text": "for taking the time and um i hope everyone at your booth enjoyed this too and",
    "start": "3201440",
    "end": "3207599"
  },
  {
    "text": "we will see y'all next time and thank you everyone for joining us for cncf live webinar please remember next week",
    "start": "3207599",
    "end": "3214240"
  },
  {
    "text": "we will not have any online programs due to kubecon cloud native con europe and",
    "start": "3214240",
    "end": "3219760"
  },
  {
    "text": "hopefully we will see you all there we'll see y'all next time",
    "start": "3219760",
    "end": "3226000"
  },
  {
    "text": "thank you",
    "start": "3226000",
    "end": "3229240"
  }
]