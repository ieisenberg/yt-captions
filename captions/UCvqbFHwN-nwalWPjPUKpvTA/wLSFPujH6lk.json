[
  {
    "start": "0",
    "end": "82000"
  },
  {
    "text": "hi good morning good afternoon good",
    "start": "1680",
    "end": "3360"
  },
  {
    "text": "evening depending on where you are",
    "start": "3360",
    "end": "5440"
  },
  {
    "text": "today we're going to talk about um",
    "start": "5440",
    "end": "9200"
  },
  {
    "text": "making dashboards like automatically",
    "start": "9200",
    "end": "11440"
  },
  {
    "text": "faster",
    "start": "11440",
    "end": "12639"
  },
  {
    "text": "uh using some tools we already know",
    "start": "12639",
    "end": "14559"
  },
  {
    "text": "about like recording rules and also",
    "start": "14559",
    "end": "16480"
  },
  {
    "text": "we're going to dive into kind of the m3",
    "start": "16480",
    "end": "18000"
  },
  {
    "text": "aggregation tier",
    "start": "18000",
    "end": "20160"
  },
  {
    "text": "uh my name is shreyas uh i'm a software",
    "start": "20160",
    "end": "23439"
  },
  {
    "text": "engineer at chronosphere",
    "start": "23439",
    "end": "24640"
  },
  {
    "text": "uh we're working on building a hosted",
    "start": "24640",
    "end": "26480"
  },
  {
    "text": "metrics and monitoring platform",
    "start": "26480",
    "end": "28720"
  },
  {
    "text": "targeting large-scale high-throughput",
    "start": "28720",
    "end": "30960"
  },
  {
    "text": "use cases",
    "start": "30960",
    "end": "32719"
  },
  {
    "text": "um i'm interested in all things",
    "start": "32719",
    "end": "35280"
  },
  {
    "text": "observability",
    "start": "35280",
    "end": "37200"
  },
  {
    "text": "primarily kind of focusing on making use",
    "start": "37200",
    "end": "39760"
  },
  {
    "text": "of metrics and traces to solve like",
    "start": "39760",
    "end": "41680"
  },
  {
    "text": "interesting problems uh prior to this",
    "start": "41680",
    "end": "44800"
  },
  {
    "text": "i was on the observable team at uber",
    "start": "44800",
    "end": "46800"
  },
  {
    "text": "working on kind of",
    "start": "46800",
    "end": "47840"
  },
  {
    "text": "like building out and scaling the",
    "start": "47840",
    "end": "50160"
  },
  {
    "text": "alerting platform there",
    "start": "50160",
    "end": "52320"
  },
  {
    "text": "the agenda for today is kind of setting",
    "start": "52320",
    "end": "54719"
  },
  {
    "text": "up the problem",
    "start": "54719",
    "end": "56160"
  },
  {
    "text": "uh looking at kind of like high",
    "start": "56160",
    "end": "57840"
  },
  {
    "text": "cardinality metrics and why they're a",
    "start": "57840",
    "end": "59520"
  },
  {
    "text": "challenge",
    "start": "59520",
    "end": "61039"
  },
  {
    "text": "um then we're going to talk about kind",
    "start": "61039",
    "end": "63039"
  },
  {
    "text": "of aggregating metrics",
    "start": "63039",
    "end": "64478"
  },
  {
    "text": "using recording rules and the m3",
    "start": "64479",
    "end": "66159"
  },
  {
    "text": "aggregation here and kind of",
    "start": "66159",
    "end": "68000"
  },
  {
    "text": "like how that is uh yeah how we can kind",
    "start": "68000",
    "end": "71600"
  },
  {
    "text": "of make dashboards faster using that",
    "start": "71600",
    "end": "74400"
  },
  {
    "text": "then we kind of talk about how we make",
    "start": "74400",
    "end": "76400"
  },
  {
    "text": "things easy to use",
    "start": "76400",
    "end": "78000"
  },
  {
    "text": "uh and finally we kind of round out with",
    "start": "78000",
    "end": "79759"
  },
  {
    "text": "the demo and kind of a q a",
    "start": "79759",
    "end": "82960"
  },
  {
    "text": "so to set up the problem for most of",
    "start": "82960",
    "end": "85439"
  },
  {
    "text": "this",
    "start": "85439",
    "end": "86080"
  },
  {
    "text": "talk we're going to take c advisor as an",
    "start": "86080",
    "end": "88640"
  },
  {
    "text": "example",
    "start": "88640",
    "end": "90079"
  },
  {
    "text": "which provides essentially resource",
    "start": "90079",
    "end": "91759"
  },
  {
    "text": "usage and performance metrics",
    "start": "91759",
    "end": "94400"
  },
  {
    "text": "of running containers this dashboard",
    "start": "94400",
    "end": "97600"
  },
  {
    "text": "taken",
    "start": "97600",
    "end": "98079"
  },
  {
    "text": "is kind of the c advisor dashboard from",
    "start": "98079",
    "end": "99920"
  },
  {
    "text": "grafana",
    "start": "99920",
    "end": "101439"
  },
  {
    "text": "as you can see it has some amount of",
    "start": "101439",
    "end": "104479"
  },
  {
    "text": "aggregated information and some amount",
    "start": "104479",
    "end": "106799"
  },
  {
    "text": "of like",
    "start": "106799",
    "end": "107680"
  },
  {
    "text": "individual kind of like pod level",
    "start": "107680",
    "end": "109520"
  },
  {
    "text": "information",
    "start": "109520",
    "end": "111200"
  },
  {
    "text": "so it has like it's tracking 5000",
    "start": "111200",
    "end": "113520"
  },
  {
    "text": "containers",
    "start": "113520",
    "end": "114320"
  },
  {
    "text": "you have some aggregate sets like cpu",
    "start": "114320",
    "end": "116159"
  },
  {
    "text": "usage network traffic",
    "start": "116159",
    "end": "118640"
  },
  {
    "text": "etc you also have like per pod stats",
    "start": "118640",
    "end": "122079"
  },
  {
    "text": "like cpu usage and memory usage",
    "start": "122079",
    "end": "124399"
  },
  {
    "text": "which are useful so the aggregate stats",
    "start": "124399",
    "end": "127280"
  },
  {
    "text": "kind of give you an idea that something",
    "start": "127280",
    "end": "128959"
  },
  {
    "text": "is wrong",
    "start": "128959",
    "end": "129599"
  },
  {
    "text": "and then the more like per pod stats",
    "start": "129599",
    "end": "133040"
  },
  {
    "text": "kind of help your root cause better um",
    "start": "133040",
    "end": "136560"
  },
  {
    "text": "so this has like tons of dimensions uh",
    "start": "136560",
    "end": "139840"
  },
  {
    "text": "because it wants to kind of slice and",
    "start": "139840",
    "end": "141760"
  },
  {
    "text": "dice metrics in different forms",
    "start": "141760",
    "end": "144640"
  },
  {
    "text": "so what do these dimensions actually do",
    "start": "144640",
    "end": "146319"
  },
  {
    "text": "if you consider a simple metric",
    "start": "146319",
    "end": "148640"
  },
  {
    "text": "kind of cpu usage you end up having like",
    "start": "148640",
    "end": "151519"
  },
  {
    "text": "16 000 series and it takes 20 seconds to",
    "start": "151519",
    "end": "153920"
  },
  {
    "text": "actually query this information",
    "start": "153920",
    "end": "155519"
  },
  {
    "text": "like which is really slow",
    "start": "155519",
    "end": "158640"
  },
  {
    "text": "this is because like you can see the so",
    "start": "158640",
    "end": "161760"
  },
  {
    "text": "many different",
    "start": "161760",
    "end": "163360"
  },
  {
    "text": "tags on it like there's a part id",
    "start": "163360",
    "end": "165680"
  },
  {
    "text": "there's an instance",
    "start": "165680",
    "end": "168719"
  },
  {
    "text": "there's the image and so on so forth",
    "start": "168800",
    "end": "173440"
  },
  {
    "text": "if you only consider the two labels that",
    "start": "173840",
    "end": "175680"
  },
  {
    "text": "we're interested in and we actually",
    "start": "175680",
    "end": "177200"
  },
  {
    "text": "aggregate this using a recording rule",
    "start": "177200",
    "end": "179680"
  },
  {
    "text": "then this query becomes a way more",
    "start": "179680",
    "end": "181440"
  },
  {
    "text": "manageable like 230 series and just",
    "start": "181440",
    "end": "183920"
  },
  {
    "text": "takes like half a second to actually",
    "start": "183920",
    "end": "185440"
  },
  {
    "text": "like get back information",
    "start": "185440",
    "end": "187680"
  },
  {
    "text": "uh and in most cases this is actually",
    "start": "187680",
    "end": "190560"
  },
  {
    "text": "all the information we want",
    "start": "190560",
    "end": "193760"
  },
  {
    "text": "now the reason for getting so many",
    "start": "193840",
    "end": "196560"
  },
  {
    "text": "series here",
    "start": "196560",
    "end": "197440"
  },
  {
    "text": "is like even though it's kind of like",
    "start": "197440",
    "end": "199680"
  },
  {
    "text": "containing it's kind of something is",
    "start": "199680",
    "end": "201440"
  },
  {
    "text": "tracking one instance",
    "start": "201440",
    "end": "203280"
  },
  {
    "text": "as things get restarted like as the pod",
    "start": "203280",
    "end": "206239"
  },
  {
    "text": "gets we started reschedule like a new",
    "start": "206239",
    "end": "208239"
  },
  {
    "text": "time series shows up",
    "start": "208239",
    "end": "209440"
  },
  {
    "text": "so there are more things actually",
    "start": "209440",
    "end": "210799"
  },
  {
    "text": "getting stored in the time series",
    "start": "210799",
    "end": "212959"
  },
  {
    "text": "database which don't have data currently",
    "start": "212959",
    "end": "215440"
  },
  {
    "text": "but when you actually like query for",
    "start": "215440",
    "end": "216959"
  },
  {
    "text": "like 30 minutes or like a few hours of",
    "start": "216959",
    "end": "219280"
  },
  {
    "text": "data you end up pulling time series",
    "start": "219280",
    "end": "220879"
  },
  {
    "text": "which should not exist",
    "start": "220879",
    "end": "223840"
  },
  {
    "start": "223000",
    "end": "495000"
  },
  {
    "text": "so it basically results in like slowing",
    "start": "223840",
    "end": "226480"
  },
  {
    "text": "dashboards and",
    "start": "226480",
    "end": "227680"
  },
  {
    "text": "dashboards which kind of like constantly",
    "start": "227680",
    "end": "229599"
  },
  {
    "text": "decreasing like degrade over time",
    "start": "229599",
    "end": "233120"
  },
  {
    "text": "as mentioned this is because kind of the",
    "start": "233120",
    "end": "234799"
  },
  {
    "text": "cardinality of dimensions keep",
    "start": "234799",
    "end": "236239"
  },
  {
    "text": "increasing",
    "start": "236239",
    "end": "237439"
  },
  {
    "text": "as you add new instances roll out new",
    "start": "237439",
    "end": "239519"
  },
  {
    "text": "images",
    "start": "239519",
    "end": "240640"
  },
  {
    "text": "like things basically yeah we keep",
    "start": "240640",
    "end": "243040"
  },
  {
    "text": "adding dimensions and things keep",
    "start": "243040",
    "end": "244640"
  },
  {
    "text": "slowing up",
    "start": "244640",
    "end": "246400"
  },
  {
    "text": "okay so this basically results in kind",
    "start": "246400",
    "end": "249840"
  },
  {
    "text": "of slower dashboards",
    "start": "249840",
    "end": "251760"
  },
  {
    "text": "slower dashboards results and kind of",
    "start": "251760",
    "end": "253599"
  },
  {
    "text": "browser locking up",
    "start": "253599",
    "end": "255280"
  },
  {
    "text": "and a bad user experience",
    "start": "255280",
    "end": "258720"
  },
  {
    "text": "so when an engineer notices this the",
    "start": "258720",
    "end": "261840"
  },
  {
    "text": "dashboard needs to be optimized",
    "start": "261840",
    "end": "263680"
  },
  {
    "text": "like how we actually kind of go up go",
    "start": "263680",
    "end": "266320"
  },
  {
    "text": "about doing this",
    "start": "266320",
    "end": "268000"
  },
  {
    "text": "the first step is kind of figuring out",
    "start": "268000",
    "end": "269520"
  },
  {
    "text": "which queries are the culprit",
    "start": "269520",
    "end": "271520"
  },
  {
    "text": "you inspect the requests you could",
    "start": "271520",
    "end": "273680"
  },
  {
    "text": "inspect the request from a dashboard to",
    "start": "273680",
    "end": "275280"
  },
  {
    "text": "look for slow queries",
    "start": "275280",
    "end": "277199"
  },
  {
    "text": "you could do this in kind of chrome",
    "start": "277199",
    "end": "278479"
  },
  {
    "text": "inspector",
    "start": "278479",
    "end": "280240"
  },
  {
    "text": "you could use the prometheus query log",
    "start": "280240",
    "end": "282639"
  },
  {
    "text": "uh to do this",
    "start": "282639",
    "end": "284400"
  },
  {
    "text": "and kind of associate back and yeah",
    "start": "284400",
    "end": "287600"
  },
  {
    "text": "and try to associate back to the",
    "start": "287600",
    "end": "288880"
  },
  {
    "text": "dashboard but this is difficult",
    "start": "288880",
    "end": "291120"
  },
  {
    "text": "because the prometheus query log has",
    "start": "291120",
    "end": "292720"
  },
  {
    "text": "like all the queries running in the",
    "start": "292720",
    "end": "294240"
  },
  {
    "text": "system",
    "start": "294240",
    "end": "295360"
  },
  {
    "text": "and the dashboard itself like you may",
    "start": "295360",
    "end": "298479"
  },
  {
    "text": "have many many dashboards",
    "start": "298479",
    "end": "301759"
  },
  {
    "text": "but given that we figure out kind of",
    "start": "302160",
    "end": "303759"
  },
  {
    "text": "which are the culprit you probably want",
    "start": "303759",
    "end": "305680"
  },
  {
    "text": "to do some form of pre-aggregation of",
    "start": "305680",
    "end": "307280"
  },
  {
    "text": "these metrics to",
    "start": "307280",
    "end": "308240"
  },
  {
    "text": "make these queries faster and over the",
    "start": "308240",
    "end": "311199"
  },
  {
    "text": "next few slides we will kind of talk",
    "start": "311199",
    "end": "312800"
  },
  {
    "text": "about",
    "start": "312800",
    "end": "313280"
  },
  {
    "text": "a few of these like pre-aggregation",
    "start": "313280",
    "end": "316320"
  },
  {
    "text": "like a few ways we can actually",
    "start": "316320",
    "end": "318320"
  },
  {
    "text": "pre-aggregate things",
    "start": "318320",
    "end": "320160"
  },
  {
    "text": "uh the first thing i want to talk about",
    "start": "320160",
    "end": "321520"
  },
  {
    "text": "is recording rules this is something",
    "start": "321520",
    "end": "323520"
  },
  {
    "text": "prometheus provides support for",
    "start": "323520",
    "end": "325280"
  },
  {
    "text": "and kind of they're like widely used for",
    "start": "325280",
    "end": "327520"
  },
  {
    "text": "this purpose",
    "start": "327520",
    "end": "329280"
  },
  {
    "text": "they basically allow kind of",
    "start": "329280",
    "end": "330720"
  },
  {
    "text": "pre-computing queries and",
    "start": "330720",
    "end": "332720"
  },
  {
    "text": "storing back aggregate time series to",
    "start": "332720",
    "end": "334560"
  },
  {
    "text": "the tsdb",
    "start": "334560",
    "end": "336720"
  },
  {
    "text": "once you do that you essentially instead",
    "start": "336720",
    "end": "338320"
  },
  {
    "text": "of making the query",
    "start": "338320",
    "end": "340240"
  },
  {
    "text": "which kind of looks at all the series",
    "start": "340240",
    "end": "342080"
  },
  {
    "text": "the dashboard is just making a query",
    "start": "342080",
    "end": "343919"
  },
  {
    "text": "which is like picking back one series",
    "start": "343919",
    "end": "346400"
  },
  {
    "text": "um so it's like super fast",
    "start": "346400",
    "end": "350479"
  },
  {
    "text": "and the caveat is that now the dashboard",
    "start": "350479",
    "end": "353199"
  },
  {
    "text": "now has to go and",
    "start": "353199",
    "end": "354400"
  },
  {
    "text": "you need to point it back to the",
    "start": "354400",
    "end": "355759"
  },
  {
    "text": "pre-computer time series you need to go",
    "start": "355759",
    "end": "357360"
  },
  {
    "text": "and like change the dashboard to",
    "start": "357360",
    "end": "358639"
  },
  {
    "text": "actually",
    "start": "358639",
    "end": "359280"
  },
  {
    "text": "access the real-time series recording",
    "start": "359280",
    "end": "362240"
  },
  {
    "text": "rule looks like something like the below",
    "start": "362240",
    "end": "364479"
  },
  {
    "text": "you have a record which is basically the",
    "start": "364479",
    "end": "366400"
  },
  {
    "text": "new time series you're storing stuff in",
    "start": "366400",
    "end": "368880"
  },
  {
    "text": "um and then the expression which is like",
    "start": "368880",
    "end": "372080"
  },
  {
    "text": "whatever prom q and expression you want",
    "start": "372080",
    "end": "374319"
  },
  {
    "text": "to get executed so you can put anything",
    "start": "374319",
    "end": "376720"
  },
  {
    "text": "as complicated as you want here",
    "start": "376720",
    "end": "380319"
  },
  {
    "text": "and as mentioned the record is",
    "start": "380560",
    "end": "381759"
  },
  {
    "text": "essentially a new time series",
    "start": "381759",
    "end": "384240"
  },
  {
    "text": "um so to basically create recording",
    "start": "384240",
    "end": "387600"
  },
  {
    "text": "rules you need to know what to",
    "start": "387600",
    "end": "388639"
  },
  {
    "text": "pre-compute",
    "start": "388639",
    "end": "389680"
  },
  {
    "text": "so we figure out the background queries",
    "start": "389680",
    "end": "391759"
  },
  {
    "text": "by doing some formatting analysis on the",
    "start": "391759",
    "end": "393520"
  },
  {
    "text": "dashboard",
    "start": "393520",
    "end": "395840"
  },
  {
    "text": "then you basically go configure these",
    "start": "396160",
    "end": "397759"
  },
  {
    "text": "recording rules",
    "start": "397759",
    "end": "399840"
  },
  {
    "text": "and you can go and change the dashboard",
    "start": "399840",
    "end": "402319"
  },
  {
    "text": "people kind of query the recording rule",
    "start": "402319",
    "end": "404160"
  },
  {
    "text": "metrics",
    "start": "404160",
    "end": "405919"
  },
  {
    "text": "instead of the underlying metrics so",
    "start": "405919",
    "end": "408639"
  },
  {
    "text": "it's a",
    "start": "408639",
    "end": "409360"
  },
  {
    "text": "real long manual process let's say",
    "start": "409360",
    "end": "412080"
  },
  {
    "text": "you've actually done this",
    "start": "412080",
    "end": "415039"
  },
  {
    "text": "what happens when one of these metrics",
    "start": "415120",
    "end": "416720"
  },
  {
    "text": "changes like the",
    "start": "416720",
    "end": "418880"
  },
  {
    "text": "query for the recording rule has changed",
    "start": "418880",
    "end": "421759"
  },
  {
    "text": "or",
    "start": "421759",
    "end": "422400"
  },
  {
    "text": "a new panel becomes slow you basically",
    "start": "422400",
    "end": "425280"
  },
  {
    "text": "have to repeat this process all over",
    "start": "425280",
    "end": "426800"
  },
  {
    "text": "again",
    "start": "426800",
    "end": "427840"
  },
  {
    "text": "and kind of do the same manual",
    "start": "427840",
    "end": "429440"
  },
  {
    "text": "processing again and again",
    "start": "429440",
    "end": "432400"
  },
  {
    "text": "the second thing is recording rules are",
    "start": "432400",
    "end": "434080"
  },
  {
    "text": "very expensive",
    "start": "434080",
    "end": "436800"
  },
  {
    "text": "they basically execute and pre-compute",
    "start": "436800",
    "end": "439039"
  },
  {
    "text": "the score at regular intervals",
    "start": "439039",
    "end": "441280"
  },
  {
    "text": "so a query accessing many time series",
    "start": "441280",
    "end": "444560"
  },
  {
    "text": "can get expensive very quickly",
    "start": "444560",
    "end": "447199"
  },
  {
    "text": "especially when kind of the",
    "start": "447199",
    "end": "448319"
  },
  {
    "text": "dimensionality of",
    "start": "448319",
    "end": "449599"
  },
  {
    "text": "the underlying metrics keep increasing",
    "start": "449599",
    "end": "453520"
  },
  {
    "text": "and given that these kind of run",
    "start": "453919",
    "end": "457199"
  },
  {
    "text": "alongside other queries in the system",
    "start": "457199",
    "end": "459039"
  },
  {
    "text": "like dashboards and alerts",
    "start": "459039",
    "end": "461440"
  },
  {
    "text": "they have the potential to kind of",
    "start": "461440",
    "end": "462800"
  },
  {
    "text": "orient the query engine",
    "start": "462800",
    "end": "465840"
  },
  {
    "text": "so those are kind of a couple of like",
    "start": "465919",
    "end": "468479"
  },
  {
    "text": "really bad",
    "start": "468479",
    "end": "470560"
  },
  {
    "text": "aspects of kind of using recording rules",
    "start": "470560",
    "end": "472479"
  },
  {
    "text": "and which we need to kind of be",
    "start": "472479",
    "end": "474560"
  },
  {
    "text": "careful about but as mentioned before",
    "start": "474560",
    "end": "478479"
  },
  {
    "text": "sometimes for",
    "start": "478479",
    "end": "479360"
  },
  {
    "text": "underlying metrics we don't actually",
    "start": "479360",
    "end": "480879"
  },
  {
    "text": "need all these dimensions so it would be",
    "start": "480879",
    "end": "482800"
  },
  {
    "text": "nice if we can actually",
    "start": "482800",
    "end": "484000"
  },
  {
    "text": "get rid of these completely and not",
    "start": "484000",
    "end": "485599"
  },
  {
    "text": "store them what we care about is just",
    "start": "485599",
    "end": "487919"
  },
  {
    "text": "the aggregate",
    "start": "487919",
    "end": "489039"
  },
  {
    "text": "and we don't really care about kind of",
    "start": "489039",
    "end": "490720"
  },
  {
    "text": "the underlying metrics themselves",
    "start": "490720",
    "end": "493440"
  },
  {
    "text": "so would be great if we can do that and",
    "start": "493440",
    "end": "495599"
  },
  {
    "start": "495000",
    "end": "800000"
  },
  {
    "text": "that's kind of where the m2 aggregation",
    "start": "495599",
    "end": "497360"
  },
  {
    "text": "tier comes in",
    "start": "497360",
    "end": "498479"
  },
  {
    "text": "so m3 is a remote storage for prometheus",
    "start": "498479",
    "end": "502560"
  },
  {
    "text": "and the empty aggregation here allows us",
    "start": "502560",
    "end": "504879"
  },
  {
    "text": "to kind of move",
    "start": "504879",
    "end": "506240"
  },
  {
    "text": "the expensive recording rule computation",
    "start": "506240",
    "end": "508479"
  },
  {
    "text": "to streaming aggregation",
    "start": "508479",
    "end": "510960"
  },
  {
    "text": "so when prometheus remote write comes",
    "start": "510960",
    "end": "513680"
  },
  {
    "text": "into m3",
    "start": "513680",
    "end": "515518"
  },
  {
    "text": "it sees that some metrics need",
    "start": "515519",
    "end": "517518"
  },
  {
    "text": "aggregation and kind of it forwards it",
    "start": "517519",
    "end": "519518"
  },
  {
    "text": "to the m3 aggregation here",
    "start": "519519",
    "end": "521760"
  },
  {
    "text": "the empty aggregation tier basically",
    "start": "521760",
    "end": "523518"
  },
  {
    "text": "knows",
    "start": "523519",
    "end": "525600"
  },
  {
    "text": "what rules to apply on what metrics",
    "start": "525600",
    "end": "529760"
  },
  {
    "text": "it applies those aggregations and then",
    "start": "529760",
    "end": "531680"
  },
  {
    "text": "sends it back to the coordinator to",
    "start": "531680",
    "end": "533200"
  },
  {
    "text": "actually like persist it",
    "start": "533200",
    "end": "534560"
  },
  {
    "text": "into long-term storage in m3db",
    "start": "534560",
    "end": "538320"
  },
  {
    "text": "so the aggregator basically allows down",
    "start": "538320",
    "end": "540320"
  },
  {
    "text": "sampling dropping",
    "start": "540320",
    "end": "542000"
  },
  {
    "text": "or aggregating metrics prior to",
    "start": "542000",
    "end": "544160"
  },
  {
    "text": "persisting them to the time series",
    "start": "544160",
    "end": "545680"
  },
  {
    "text": "database",
    "start": "545680",
    "end": "547200"
  },
  {
    "text": "uh the aggregator supports kind of two",
    "start": "547200",
    "end": "550720"
  },
  {
    "text": "different types of rules",
    "start": "550720",
    "end": "552320"
  },
  {
    "text": "one of them is called roll-up rules",
    "start": "552320",
    "end": "554080"
  },
  {
    "text": "which allow aggregating these metrics",
    "start": "554080",
    "end": "556560"
  },
  {
    "text": "uh then second is mapping rules which",
    "start": "556560",
    "end": "559680"
  },
  {
    "text": "basically are kind of dropping random",
    "start": "559680",
    "end": "561600"
  },
  {
    "text": "metrics",
    "start": "561600",
    "end": "563519"
  },
  {
    "text": "uh we're going to first we're going to",
    "start": "563519",
    "end": "565200"
  },
  {
    "text": "talk about both of these but first we're",
    "start": "565200",
    "end": "567040"
  },
  {
    "text": "going to dive into roll-up rules",
    "start": "567040",
    "end": "570080"
  },
  {
    "text": "roll-up rules are a way to aggregate",
    "start": "570080",
    "end": "573600"
  },
  {
    "text": "metrics",
    "start": "573600",
    "end": "574839"
  },
  {
    "text": "so they basically have a series of",
    "start": "574839",
    "end": "577360"
  },
  {
    "text": "transforms which are applied in order",
    "start": "577360",
    "end": "580959"
  },
  {
    "text": "uh to kind of change and generate a new",
    "start": "580959",
    "end": "584480"
  },
  {
    "text": "metric",
    "start": "584480",
    "end": "585710"
  },
  {
    "text": "[Music]",
    "start": "585710",
    "end": "586880"
  },
  {
    "text": "and the metrics kind of applied to",
    "start": "586880",
    "end": "588959"
  },
  {
    "text": "depend on kind of what filter",
    "start": "588959",
    "end": "590800"
  },
  {
    "text": "actually matches it also has something",
    "start": "590800",
    "end": "592560"
  },
  {
    "text": "called a storage policy which",
    "start": "592560",
    "end": "594640"
  },
  {
    "text": "basically determines like where like",
    "start": "594640",
    "end": "597440"
  },
  {
    "text": "what",
    "start": "597440",
    "end": "598399"
  },
  {
    "text": "like where to store the generated time",
    "start": "598399",
    "end": "600800"
  },
  {
    "text": "series in m3db",
    "start": "600800",
    "end": "603600"
  },
  {
    "text": "we're talking about kind of one by one",
    "start": "603600",
    "end": "605360"
  },
  {
    "text": "uh the first step is kind of what we",
    "start": "605360",
    "end": "607120"
  },
  {
    "text": "call",
    "start": "607120",
    "end": "607839"
  },
  {
    "text": "like a transform an increase or a delta",
    "start": "607839",
    "end": "610560"
  },
  {
    "text": "transform",
    "start": "610560",
    "end": "612000"
  },
  {
    "text": "uh the underlying metrics which come",
    "start": "612000",
    "end": "613680"
  },
  {
    "text": "from prometheus are kind of",
    "start": "613680",
    "end": "614959"
  },
  {
    "text": "monotonically increasing",
    "start": "614959",
    "end": "616800"
  },
  {
    "text": "like counters so we can't really",
    "start": "616800",
    "end": "620160"
  },
  {
    "text": "aggregate them as",
    "start": "620160",
    "end": "621200"
  },
  {
    "text": "is so we need to apply the equivalent of",
    "start": "621200",
    "end": "624079"
  },
  {
    "text": "kind of the prometheus rate function",
    "start": "624079",
    "end": "625680"
  },
  {
    "text": "first",
    "start": "625680",
    "end": "626959"
  },
  {
    "text": "so that's exactly what the increased",
    "start": "626959",
    "end": "630399"
  },
  {
    "text": "transform is",
    "start": "630399",
    "end": "631440"
  },
  {
    "text": "essentially applies the prometheus rate",
    "start": "631440",
    "end": "633200"
  },
  {
    "text": "function gets diffs between successive",
    "start": "633200",
    "end": "635440"
  },
  {
    "text": "data points",
    "start": "635440",
    "end": "636880"
  },
  {
    "text": "and kind of generates a new time series",
    "start": "636880",
    "end": "639120"
  },
  {
    "text": "for kind of use",
    "start": "639120",
    "end": "640640"
  },
  {
    "text": "by the next level of the transform the",
    "start": "640640",
    "end": "643200"
  },
  {
    "text": "next level of transform",
    "start": "643200",
    "end": "644720"
  },
  {
    "text": "is called the rollup it essentially sums",
    "start": "644720",
    "end": "647360"
  },
  {
    "text": "the deltas",
    "start": "647360",
    "end": "648160"
  },
  {
    "text": "by the unique dimensions specified in",
    "start": "648160",
    "end": "650079"
  },
  {
    "text": "the group by",
    "start": "650079",
    "end": "651200"
  },
  {
    "text": "in this case we're only interested in",
    "start": "651200",
    "end": "652560"
  },
  {
    "text": "container name and namespace so it does",
    "start": "652560",
    "end": "654959"
  },
  {
    "text": "a sum by container container namespace",
    "start": "654959",
    "end": "657760"
  },
  {
    "text": "in",
    "start": "657760",
    "end": "658399"
  },
  {
    "text": "like fromql language",
    "start": "658399",
    "end": "661519"
  },
  {
    "text": "and it stores the generated thing",
    "start": "661519",
    "end": "664720"
  },
  {
    "text": "as a different metric name now the",
    "start": "664720",
    "end": "667200"
  },
  {
    "text": "metric name",
    "start": "667200",
    "end": "668480"
  },
  {
    "text": "is interesting uh if you're actually",
    "start": "668480",
    "end": "672160"
  },
  {
    "text": "using a mapping rule to",
    "start": "672160",
    "end": "675040"
  },
  {
    "text": "drop the original metrics then we can",
    "start": "675040",
    "end": "677760"
  },
  {
    "text": "basically",
    "start": "677760",
    "end": "678720"
  },
  {
    "text": "store the rolled up metric as with the",
    "start": "678720",
    "end": "681760"
  },
  {
    "text": "same metric name",
    "start": "681760",
    "end": "682880"
  },
  {
    "text": "as like as the original metric",
    "start": "682880",
    "end": "687279"
  },
  {
    "text": "if you're not planning to kind of drop",
    "start": "687279",
    "end": "689519"
  },
  {
    "text": "the underlying metrics then this metric",
    "start": "689519",
    "end": "691360"
  },
  {
    "text": "needs to be different just like it's in",
    "start": "691360",
    "end": "695040"
  },
  {
    "text": "in the recording rule case but the",
    "start": "695040",
    "end": "697360"
  },
  {
    "text": "advantage of actually",
    "start": "697360",
    "end": "698560"
  },
  {
    "text": "dropping the metrics and storing the",
    "start": "698560",
    "end": "700160"
  },
  {
    "text": "metrics using the same name",
    "start": "700160",
    "end": "702320"
  },
  {
    "text": "is that dashboards alerts or anything",
    "start": "702320",
    "end": "704320"
  },
  {
    "text": "which is actually querying these metrics",
    "start": "704320",
    "end": "706800"
  },
  {
    "text": "now just query the aggregate rather than",
    "start": "706800",
    "end": "709680"
  },
  {
    "text": "the",
    "start": "709680",
    "end": "710240"
  },
  {
    "text": "high dimensional metric so that's",
    "start": "710240",
    "end": "712800"
  },
  {
    "text": "something to keep in mind",
    "start": "712800",
    "end": "715600"
  },
  {
    "text": "now finally like after we've rolled",
    "start": "715600",
    "end": "717120"
  },
  {
    "text": "things up and we've kind of reduced the",
    "start": "717120",
    "end": "718560"
  },
  {
    "text": "dimensionality",
    "start": "718560",
    "end": "719440"
  },
  {
    "text": "we want to store this back into the tstb",
    "start": "719440",
    "end": "722399"
  },
  {
    "text": "so we need to go back from",
    "start": "722399",
    "end": "724639"
  },
  {
    "text": "dealing with deltas to actual kind of",
    "start": "724639",
    "end": "727519"
  },
  {
    "text": "accumulatively",
    "start": "727519",
    "end": "728800"
  },
  {
    "text": "like increasing like monotonically",
    "start": "728800",
    "end": "730800"
  },
  {
    "text": "increasing time series",
    "start": "730800",
    "end": "732639"
  },
  {
    "text": "so we apply kind of a cumulative add",
    "start": "732639",
    "end": "735120"
  },
  {
    "text": "operation",
    "start": "735120",
    "end": "736720"
  },
  {
    "text": "uh for each of the metrics uh to kind of",
    "start": "736720",
    "end": "739680"
  },
  {
    "text": "get the",
    "start": "739680",
    "end": "740320"
  },
  {
    "text": "aggregated like monotonically increasing",
    "start": "740320",
    "end": "742399"
  },
  {
    "text": "time series",
    "start": "742399",
    "end": "745440"
  },
  {
    "text": "this is basically sent to m3db",
    "start": "745440",
    "end": "747440"
  },
  {
    "text": "namespaces identified kind of by the",
    "start": "747440",
    "end": "749519"
  },
  {
    "text": "storage policies",
    "start": "749519",
    "end": "750639"
  },
  {
    "text": "and things get stored there",
    "start": "750639",
    "end": "754560"
  },
  {
    "text": "now as mentioned before like if you",
    "start": "754560",
    "end": "757120"
  },
  {
    "text": "actually want to go",
    "start": "757120",
    "end": "758000"
  },
  {
    "text": "and store the metric kind of with the",
    "start": "758000",
    "end": "760560"
  },
  {
    "text": "same name as the original",
    "start": "760560",
    "end": "762240"
  },
  {
    "text": "like original metric then we need a way",
    "start": "762240",
    "end": "765279"
  },
  {
    "text": "to kind of drop the",
    "start": "765279",
    "end": "767519"
  },
  {
    "text": "like the raw like high dimensional",
    "start": "767519",
    "end": "770000"
  },
  {
    "text": "metrics",
    "start": "770000",
    "end": "771120"
  },
  {
    "text": "uh this is where kind of mapping rules",
    "start": "771120",
    "end": "773040"
  },
  {
    "text": "come into play",
    "start": "773040",
    "end": "774160"
  },
  {
    "text": "so mapping rules also have a filter uh",
    "start": "774160",
    "end": "776639"
  },
  {
    "text": "which basically says oh these are the",
    "start": "776639",
    "end": "778399"
  },
  {
    "text": "metrics that",
    "start": "778399",
    "end": "779279"
  },
  {
    "text": "i'm actually interested in um",
    "start": "779279",
    "end": "782480"
  },
  {
    "text": "match these metrics and just drop them",
    "start": "782480",
    "end": "784800"
  },
  {
    "text": "do not store them",
    "start": "784800",
    "end": "786000"
  },
  {
    "text": "so the roll-up rules would still apply",
    "start": "786000",
    "end": "788079"
  },
  {
    "text": "but they won't actually get stored to",
    "start": "788079",
    "end": "789760"
  },
  {
    "text": "the tsdb",
    "start": "789760",
    "end": "791760"
  },
  {
    "text": "so the combination of roll-up rules and",
    "start": "791760",
    "end": "793360"
  },
  {
    "text": "mapping rules uh",
    "start": "793360",
    "end": "795360"
  },
  {
    "text": "we can get like aggregation like really",
    "start": "795360",
    "end": "798480"
  },
  {
    "text": "easily",
    "start": "798480",
    "end": "799360"
  },
  {
    "text": "like at ingestion time uh so to",
    "start": "799360",
    "end": "802639"
  },
  {
    "start": "800000",
    "end": "837000"
  },
  {
    "text": "summarize kind of the aggregation here",
    "start": "802639",
    "end": "804639"
  },
  {
    "text": "uh it basically allows for kind of",
    "start": "804639",
    "end": "806480"
  },
  {
    "text": "ingestion time streaming aggregation",
    "start": "806480",
    "end": "809440"
  },
  {
    "text": "uh the metrics can be aggregated or",
    "start": "809440",
    "end": "812079"
  },
  {
    "text": "rolled up based on like whatever rules",
    "start": "812079",
    "end": "813920"
  },
  {
    "text": "you provide",
    "start": "813920",
    "end": "815680"
  },
  {
    "text": "different functions are possible",
    "start": "815680",
    "end": "818959"
  },
  {
    "text": "and i think the key thing really is that",
    "start": "818959",
    "end": "821440"
  },
  {
    "text": "there's a way to kind of",
    "start": "821440",
    "end": "822800"
  },
  {
    "text": "like drop the raw metrics based on these",
    "start": "822800",
    "end": "825279"
  },
  {
    "text": "matching filters",
    "start": "825279",
    "end": "826880"
  },
  {
    "text": "which gives us the like the great",
    "start": "826880",
    "end": "830079"
  },
  {
    "text": "characteristic that",
    "start": "830079",
    "end": "831279"
  },
  {
    "text": "dashboards and alerts and different",
    "start": "831279",
    "end": "833199"
  },
  {
    "text": "queries could automatically sped up",
    "start": "833199",
    "end": "837040"
  },
  {
    "start": "837000",
    "end": "980000"
  },
  {
    "text": "uh so we really have like two ways of",
    "start": "837040",
    "end": "839519"
  },
  {
    "text": "doing things",
    "start": "839519",
    "end": "840320"
  },
  {
    "text": "uh you just want to quickly like go over",
    "start": "840320",
    "end": "842480"
  },
  {
    "text": "pros and cons of recording rules and",
    "start": "842480",
    "end": "844079"
  },
  {
    "text": "roll-up rules",
    "start": "844079",
    "end": "845680"
  },
  {
    "text": "so recording rules are generally like",
    "start": "845680",
    "end": "848000"
  },
  {
    "text": "their general purpose",
    "start": "848000",
    "end": "849279"
  },
  {
    "text": "and they support full prom ql so uh",
    "start": "849279",
    "end": "852560"
  },
  {
    "text": "if you have this like super complicated",
    "start": "852560",
    "end": "854959"
  },
  {
    "text": "like expensive query",
    "start": "854959",
    "end": "856079"
  },
  {
    "text": "which we want to speed up then recording",
    "start": "856079",
    "end": "858320"
  },
  {
    "text": "rules are probably the way to go",
    "start": "858320",
    "end": "861920"
  },
  {
    "text": "the caveat is that they're expensive",
    "start": "862000",
    "end": "864320"
  },
  {
    "text": "because they run against the regular",
    "start": "864320",
    "end": "865680"
  },
  {
    "text": "query engine",
    "start": "865680",
    "end": "867040"
  },
  {
    "text": "and they also kind of affect other",
    "start": "867040",
    "end": "868839"
  },
  {
    "text": "queries",
    "start": "868839",
    "end": "870399"
  },
  {
    "text": "so you're actually crying like if you",
    "start": "870399",
    "end": "873519"
  },
  {
    "text": "have a recording rule going",
    "start": "873519",
    "end": "875519"
  },
  {
    "text": "and like aggregating across 20 000 time",
    "start": "875519",
    "end": "878399"
  },
  {
    "text": "series recording rule every minute or",
    "start": "878399",
    "end": "880959"
  },
  {
    "text": "every interval goes and queries those 20",
    "start": "880959",
    "end": "882880"
  },
  {
    "text": "000 time series and does aggregates and",
    "start": "882880",
    "end": "884720"
  },
  {
    "text": "stores them back",
    "start": "884720",
    "end": "887439"
  },
  {
    "text": "and the third kind of yeah i guess",
    "start": "888160",
    "end": "890880"
  },
  {
    "text": "bigger point is that",
    "start": "890880",
    "end": "892320"
  },
  {
    "text": "all the data needs to be stored so",
    "start": "892320",
    "end": "894000"
  },
  {
    "text": "there's a very high storage cost you",
    "start": "894000",
    "end": "895600"
  },
  {
    "text": "cannot",
    "start": "895600",
    "end": "896839"
  },
  {
    "text": "um like with recording rule you will",
    "start": "896839",
    "end": "900079"
  },
  {
    "text": "store the low dimensionality",
    "start": "900079",
    "end": "902160"
  },
  {
    "text": "information and high dimension and",
    "start": "902160",
    "end": "904480"
  },
  {
    "text": "aggregate information at the same",
    "start": "904480",
    "end": "906160"
  },
  {
    "text": "like high dimensionality information and",
    "start": "906160",
    "end": "907920"
  },
  {
    "text": "aggregate information at the same time",
    "start": "907920",
    "end": "910560"
  },
  {
    "text": "which also means that kind of your",
    "start": "910560",
    "end": "912399"
  },
  {
    "text": "dashboards and queries and alerts need",
    "start": "912399",
    "end": "914480"
  },
  {
    "text": "to",
    "start": "914480",
    "end": "914959"
  },
  {
    "text": "be modified to actually like hit the",
    "start": "914959",
    "end": "918399"
  },
  {
    "text": "uh hit the aggregated metric instead of",
    "start": "918399",
    "end": "920880"
  },
  {
    "text": "the",
    "start": "920880",
    "end": "921680"
  },
  {
    "text": "like the original metrics",
    "start": "921680",
    "end": "925760"
  },
  {
    "text": "rules because of the way they happen at",
    "start": "925760",
    "end": "928480"
  },
  {
    "text": "ingestion time are much more efficient",
    "start": "928480",
    "end": "930160"
  },
  {
    "text": "to run",
    "start": "930160",
    "end": "932480"
  },
  {
    "text": "we have the option of only destroying",
    "start": "932560",
    "end": "934320"
  },
  {
    "text": "the aggregates we need and dropping",
    "start": "934320",
    "end": "936079"
  },
  {
    "text": "other series",
    "start": "936079",
    "end": "938800"
  },
  {
    "text": "and if we go the route of only storing",
    "start": "938800",
    "end": "940959"
  },
  {
    "text": "the aggregates then you kind of get",
    "start": "940959",
    "end": "942560"
  },
  {
    "text": "automatic",
    "start": "942560",
    "end": "943360"
  },
  {
    "text": "query speed up uh because aggregate ends",
    "start": "943360",
    "end": "946800"
  },
  {
    "text": "up having the same metric name",
    "start": "946800",
    "end": "948399"
  },
  {
    "text": "as the result matrix the biggest kind of",
    "start": "948399",
    "end": "951680"
  },
  {
    "text": "caveat with roll-up rules is they don't",
    "start": "951680",
    "end": "953839"
  },
  {
    "text": "support full prom",
    "start": "953839",
    "end": "954800"
  },
  {
    "text": "ql but rather like specific aggregates",
    "start": "954800",
    "end": "958639"
  },
  {
    "text": "we are we have been kind of adding more",
    "start": "958639",
    "end": "960959"
  },
  {
    "text": "and more of these",
    "start": "960959",
    "end": "962880"
  },
  {
    "text": "uh aggregates aggregate functions over",
    "start": "962880",
    "end": "965759"
  },
  {
    "text": "time",
    "start": "965759",
    "end": "966160"
  },
  {
    "text": "but it's unlikely that recording like",
    "start": "966160",
    "end": "969360"
  },
  {
    "text": "grow up rules would support everything",
    "start": "969360",
    "end": "971040"
  },
  {
    "text": "that recordings would support",
    "start": "971040",
    "end": "973680"
  },
  {
    "text": "so now that we have these like two",
    "start": "973680",
    "end": "976000"
  },
  {
    "text": "things",
    "start": "976000",
    "end": "976959"
  },
  {
    "text": "like two ways of kind of aggregating",
    "start": "976959",
    "end": "978720"
  },
  {
    "text": "things like",
    "start": "978720",
    "end": "980240"
  },
  {
    "start": "980000",
    "end": "1025000"
  },
  {
    "text": "how do we kind of make it easy uh",
    "start": "980240",
    "end": "983839"
  },
  {
    "text": "to do these aggregations so we're gonna",
    "start": "983839",
    "end": "987360"
  },
  {
    "text": "talk about kind of uh two we're gonna",
    "start": "987360",
    "end": "990240"
  },
  {
    "text": "talk about kind of a couple of different",
    "start": "990240",
    "end": "991759"
  },
  {
    "text": "things",
    "start": "991759",
    "end": "992880"
  },
  {
    "text": "uh around like uh",
    "start": "992880",
    "end": "996560"
  },
  {
    "text": "so we're going to talk about this tool",
    "start": "996560",
    "end": "997920"
  },
  {
    "text": "which we call the high cardinality",
    "start": "997920",
    "end": "999920"
  },
  {
    "text": "analyzer",
    "start": "999920",
    "end": "1001360"
  },
  {
    "text": "which makes it easy um",
    "start": "1001360",
    "end": "1004880"
  },
  {
    "text": "yeah which basically makes it easy to go",
    "start": "1004880",
    "end": "1006720"
  },
  {
    "text": "and like",
    "start": "1006720",
    "end": "1009120"
  },
  {
    "text": "do this",
    "start": "1009120",
    "end": "1011839"
  },
  {
    "text": "yeah which basically makes it easy to",
    "start": "1012320",
    "end": "1013839"
  },
  {
    "text": "kind of go and do this analysis",
    "start": "1013839",
    "end": "1015519"
  },
  {
    "text": "and kind of like create these recording",
    "start": "1015519",
    "end": "1018639"
  },
  {
    "text": "rules and roll up rules",
    "start": "1018639",
    "end": "1021199"
  },
  {
    "text": "uh so i'm gonna share screen again here",
    "start": "1021199",
    "end": "1025120"
  },
  {
    "start": "1025000",
    "end": "1168000"
  },
  {
    "text": "so this is actually available as a tool",
    "start": "1025120",
    "end": "1029038"
  },
  {
    "text": "on github",
    "start": "1029039",
    "end": "1030160"
  },
  {
    "text": "the link to this is posted sometime like",
    "start": "1030160",
    "end": "1032959"
  },
  {
    "text": "in the later part of the",
    "start": "1032959",
    "end": "1036400"
  },
  {
    "text": "yeah in the latter part of the talk so",
    "start": "1036400",
    "end": "1038640"
  },
  {
    "text": "we have",
    "start": "1038640",
    "end": "1039600"
  },
  {
    "text": "um it we're basically going to make use",
    "start": "1039600",
    "end": "1042000"
  },
  {
    "text": "of the prometheus",
    "start": "1042000",
    "end": "1043280"
  },
  {
    "text": "like query logs and we're going to",
    "start": "1043280",
    "end": "1045438"
  },
  {
    "text": "analyze them",
    "start": "1045439",
    "end": "1046558"
  },
  {
    "text": "and we're going to do like some",
    "start": "1046559",
    "end": "1048319"
  },
  {
    "text": "operations to actually go and like",
    "start": "1048319",
    "end": "1050640"
  },
  {
    "text": "speed things up the purpose of this",
    "start": "1050640",
    "end": "1052640"
  },
  {
    "text": "example",
    "start": "1052640",
    "end": "1054240"
  },
  {
    "text": "i emitted some metrics locally just to",
    "start": "1054240",
    "end": "1056960"
  },
  {
    "text": "kind of get",
    "start": "1056960",
    "end": "1057919"
  },
  {
    "text": "like some basic information uh",
    "start": "1057919",
    "end": "1060960"
  },
  {
    "text": "for the purposes of this demo so it's",
    "start": "1060960",
    "end": "1062720"
  },
  {
    "text": "not really high cardinality information",
    "start": "1062720",
    "end": "1064720"
  },
  {
    "text": "with too many series it's just a handful",
    "start": "1064720",
    "end": "1066960"
  },
  {
    "text": "of queries",
    "start": "1066960",
    "end": "1068480"
  },
  {
    "text": "um so what does the query log actually",
    "start": "1068480",
    "end": "1072080"
  },
  {
    "text": "have",
    "start": "1072080",
    "end": "1072559"
  },
  {
    "text": "it has some query information here",
    "start": "1072559",
    "end": "1075679"
  },
  {
    "text": "of what the exact query was when it",
    "start": "1075679",
    "end": "1077840"
  },
  {
    "text": "started",
    "start": "1077840",
    "end": "1079600"
  },
  {
    "text": "and then different stats like how long",
    "start": "1079600",
    "end": "1081440"
  },
  {
    "text": "it took to eval",
    "start": "1081440",
    "end": "1082880"
  },
  {
    "text": "how long it took to sort like that query",
    "start": "1082880",
    "end": "1085039"
  },
  {
    "text": "preparation time",
    "start": "1085039",
    "end": "1086080"
  },
  {
    "text": "any inner evaluation and so on",
    "start": "1086080",
    "end": "1089360"
  },
  {
    "text": "um so kind of just to run this",
    "start": "1089360",
    "end": "1093440"
  },
  {
    "text": "uh we have like this high chronic",
    "start": "1093440",
    "end": "1096880"
  },
  {
    "text": "analyzer we point it to a sample query",
    "start": "1096880",
    "end": "1099039"
  },
  {
    "text": "log",
    "start": "1099039",
    "end": "1101200"
  },
  {
    "text": "we give it some target saying i'm only",
    "start": "1101200",
    "end": "1103039"
  },
  {
    "text": "interested in queries which have kind of",
    "start": "1103039",
    "end": "1104640"
  },
  {
    "text": "a minimum query time of like 0.01",
    "start": "1104640",
    "end": "1106840"
  },
  {
    "text": "seconds",
    "start": "1106840",
    "end": "1108000"
  },
  {
    "text": "because it's a smaller example",
    "start": "1108000",
    "end": "1111840"
  },
  {
    "text": "and then we have kind of oh i want to",
    "start": "1111840",
    "end": "1114000"
  },
  {
    "text": "only like filter out queries which",
    "start": "1114000",
    "end": "1115840"
  },
  {
    "text": "happen at least two times so this",
    "start": "1115840",
    "end": "1118720"
  },
  {
    "text": "actually shows you",
    "start": "1118720",
    "end": "1120240"
  },
  {
    "text": "some like some options here uh",
    "start": "1120240",
    "end": "1123919"
  },
  {
    "text": "then the query log like the analyzer has",
    "start": "1123919",
    "end": "1126880"
  },
  {
    "text": "this way of like generating recording",
    "start": "1126880",
    "end": "1128559"
  },
  {
    "text": "rules for these queries that",
    "start": "1128559",
    "end": "1130400"
  },
  {
    "text": "we identified uh and we actually see",
    "start": "1130400",
    "end": "1133919"
  },
  {
    "text": "recording rules here",
    "start": "1133919",
    "end": "1136320"
  },
  {
    "text": "and it has another mode where you kind",
    "start": "1136320",
    "end": "1137760"
  },
  {
    "text": "of can generate roll-up rules",
    "start": "1137760",
    "end": "1139600"
  },
  {
    "text": "and generate mapping rules so what",
    "start": "1139600",
    "end": "1142640"
  },
  {
    "text": "exactly",
    "start": "1142640",
    "end": "1143440"
  },
  {
    "text": "is this like analyzer doing so let's",
    "start": "1143440",
    "end": "1147039"
  },
  {
    "text": "jump back to the slides kind of talk",
    "start": "1147039",
    "end": "1150400"
  },
  {
    "text": "about that",
    "start": "1150400",
    "end": "1152559"
  },
  {
    "text": "so analyzer like primarily kind of uses",
    "start": "1152559",
    "end": "1155600"
  },
  {
    "text": "the prometheus query logs",
    "start": "1155600",
    "end": "1157280"
  },
  {
    "text": "it logs all of these queries kind of",
    "start": "1157280",
    "end": "1159520"
  },
  {
    "text": "like run by the engine",
    "start": "1159520",
    "end": "1162720"
  },
  {
    "text": "and the query log has information about",
    "start": "1162720",
    "end": "1165360"
  },
  {
    "text": "kind of where",
    "start": "1165360",
    "end": "1166160"
  },
  {
    "text": "time was spent in the query so analyzer",
    "start": "1166160",
    "end": "1170000"
  },
  {
    "start": "1168000",
    "end": "1205000"
  },
  {
    "text": "is kind of an offline process a",
    "start": "1170000",
    "end": "1172000"
  },
  {
    "text": "standalone tool",
    "start": "1172000",
    "end": "1173039"
  },
  {
    "text": "to generate recording android roll-up",
    "start": "1173039",
    "end": "1174720"
  },
  {
    "text": "rules um",
    "start": "1174720",
    "end": "1176720"
  },
  {
    "text": "as mentioned it uses the prometheus",
    "start": "1176720",
    "end": "1178080"
  },
  {
    "text": "square log to find good candidates for",
    "start": "1178080",
    "end": "1179760"
  },
  {
    "text": "aggregation",
    "start": "1179760",
    "end": "1181120"
  },
  {
    "text": "uh and it provides some recommendations",
    "start": "1181120",
    "end": "1183840"
  },
  {
    "text": "for recording rules",
    "start": "1183840",
    "end": "1185360"
  },
  {
    "text": "or kind of m3 aggregator roll up and",
    "start": "1185360",
    "end": "1187919"
  },
  {
    "text": "mapping rules to create",
    "start": "1187919",
    "end": "1191039"
  },
  {
    "text": "and speed up expensive queries uh so it",
    "start": "1191039",
    "end": "1194080"
  },
  {
    "text": "just provides recommendations and then",
    "start": "1194080",
    "end": "1195600"
  },
  {
    "text": "users kind of have the option of taking",
    "start": "1195600",
    "end": "1197760"
  },
  {
    "text": "these recommendations and going and",
    "start": "1197760",
    "end": "1199520"
  },
  {
    "text": "creating the actual rules themselves",
    "start": "1199520",
    "end": "1202159"
  },
  {
    "text": "uh then kind of speeding up the",
    "start": "1202159",
    "end": "1204840"
  },
  {
    "text": "dashboards so a few steps",
    "start": "1204840",
    "end": "1207440"
  },
  {
    "start": "1205000",
    "end": "1406000"
  },
  {
    "text": "like we would do is you basically",
    "start": "1207440",
    "end": "1210960"
  },
  {
    "text": "have like days worth of prometheus query",
    "start": "1210960",
    "end": "1213120"
  },
  {
    "text": "logs",
    "start": "1213120",
    "end": "1214880"
  },
  {
    "text": "so we have enough information to know",
    "start": "1214880",
    "end": "1216559"
  },
  {
    "text": "like which are the repeated queries",
    "start": "1216559",
    "end": "1218320"
  },
  {
    "text": "which",
    "start": "1218320",
    "end": "1219360"
  },
  {
    "text": "repeated expensive queries which are",
    "start": "1219360",
    "end": "1221039"
  },
  {
    "text": "being run on the system",
    "start": "1221039",
    "end": "1222799"
  },
  {
    "text": "so we want to kind of find these most",
    "start": "1222799",
    "end": "1224720"
  },
  {
    "text": "commonly hit expensive queries",
    "start": "1224720",
    "end": "1227200"
  },
  {
    "text": "uh once we kind of get information about",
    "start": "1227200",
    "end": "1230640"
  },
  {
    "text": "that we want to kind of check the cost",
    "start": "1230640",
    "end": "1232720"
  },
  {
    "text": "of these queries are due to number of",
    "start": "1232720",
    "end": "1234159"
  },
  {
    "text": "series so the cost of a query could be",
    "start": "1234159",
    "end": "1236720"
  },
  {
    "text": "due to multiple different reasons it",
    "start": "1236720",
    "end": "1238080"
  },
  {
    "text": "could just be",
    "start": "1238080",
    "end": "1238799"
  },
  {
    "text": "because it's very important like large",
    "start": "1238799",
    "end": "1240640"
  },
  {
    "text": "chunks of data",
    "start": "1240640",
    "end": "1242159"
  },
  {
    "text": "uh large chunks of like a few series",
    "start": "1242159",
    "end": "1245520"
  },
  {
    "text": "essentially over like a huge like",
    "start": "1245520",
    "end": "1247200"
  },
  {
    "text": "sequence of time",
    "start": "1247200",
    "end": "1248559"
  },
  {
    "text": "or it could be like creating many many",
    "start": "1248559",
    "end": "1250960"
  },
  {
    "text": "series of data",
    "start": "1250960",
    "end": "1252480"
  },
  {
    "text": "uh like yeah many series of data",
    "start": "1252480",
    "end": "1257840"
  },
  {
    "text": "and the cost like even when it queries",
    "start": "1257840",
    "end": "1260400"
  },
  {
    "text": "many series of data if it's actually",
    "start": "1260400",
    "end": "1261840"
  },
  {
    "text": "returning all the data then you can't",
    "start": "1261840",
    "end": "1263520"
  },
  {
    "text": "really speed things up",
    "start": "1263520",
    "end": "1265360"
  },
  {
    "text": "but if it's",
    "start": "1265360",
    "end": "1268480"
  },
  {
    "text": "actually acquiring many underlying",
    "start": "1268480",
    "end": "1270480"
  },
  {
    "text": "series from the",
    "start": "1270480",
    "end": "1271919"
  },
  {
    "text": "tstb and then it's kind of aggregating",
    "start": "1271919",
    "end": "1274640"
  },
  {
    "text": "them together",
    "start": "1274640",
    "end": "1275600"
  },
  {
    "text": "into like a fewer set of series like",
    "start": "1275600",
    "end": "1278400"
  },
  {
    "text": "those are kind of the",
    "start": "1278400",
    "end": "1279760"
  },
  {
    "text": "candidates like candidate queries we're",
    "start": "1279760",
    "end": "1281919"
  },
  {
    "text": "actually looking for",
    "start": "1281919",
    "end": "1283520"
  },
  {
    "text": "so we want to basically look at kind of",
    "start": "1283520",
    "end": "1285679"
  },
  {
    "text": "like",
    "start": "1285679",
    "end": "1287760"
  },
  {
    "text": "the cardinality of the queries which are",
    "start": "1287760",
    "end": "1290320"
  },
  {
    "text": "actually being run",
    "start": "1290320",
    "end": "1291280"
  },
  {
    "text": "and kind of use that and only optimize",
    "start": "1291280",
    "end": "1294080"
  },
  {
    "text": "those queries",
    "start": "1294080",
    "end": "1296720"
  },
  {
    "text": "so once it kind of identifies these",
    "start": "1297039",
    "end": "1300799"
  },
  {
    "text": "these queries which actually need to be",
    "start": "1300799",
    "end": "1304320"
  },
  {
    "text": "need to be need to be sped up uh",
    "start": "1304320",
    "end": "1307840"
  },
  {
    "text": "we provide proposals for kind of",
    "start": "1307840",
    "end": "1309919"
  },
  {
    "text": "recording and roll-up rules to create",
    "start": "1309919",
    "end": "1312240"
  },
  {
    "text": "um and then users are kind of like free",
    "start": "1312240",
    "end": "1315280"
  },
  {
    "text": "to go and like configure these rules as",
    "start": "1315280",
    "end": "1317360"
  },
  {
    "text": "necessary",
    "start": "1317360",
    "end": "1319840"
  },
  {
    "text": "if the user kind of goes and creates",
    "start": "1320640",
    "end": "1322080"
  },
  {
    "text": "recording rules then dashboard and other",
    "start": "1322080",
    "end": "1324640"
  },
  {
    "text": "places where these",
    "start": "1324640",
    "end": "1326159"
  },
  {
    "text": "rules are being applied need to be",
    "start": "1326159",
    "end": "1328720"
  },
  {
    "text": "changed",
    "start": "1328720",
    "end": "1330480"
  },
  {
    "text": "if we're talking about kind of roll-up",
    "start": "1330480",
    "end": "1332159"
  },
  {
    "text": "rules then",
    "start": "1332159",
    "end": "1334400"
  },
  {
    "text": "and the user is already gone and like",
    "start": "1334400",
    "end": "1337039"
  },
  {
    "text": "the user also",
    "start": "1337039",
    "end": "1338000"
  },
  {
    "text": "said that they want to kind of drop the",
    "start": "1338000",
    "end": "1339360"
  },
  {
    "text": "underlying metrics then the queries will",
    "start": "1339360",
    "end": "1341919"
  },
  {
    "text": "kind of get sped up automatically",
    "start": "1341919",
    "end": "1344559"
  },
  {
    "text": "as the query actually captures the",
    "start": "1344559",
    "end": "1345919"
  },
  {
    "text": "aggregated metric um",
    "start": "1345919",
    "end": "1348240"
  },
  {
    "text": "in case the roll-up rule is not dropping",
    "start": "1348240",
    "end": "1350159"
  },
  {
    "text": "the underlying series",
    "start": "1350159",
    "end": "1351600"
  },
  {
    "text": "then like um then you'd",
    "start": "1351600",
    "end": "1354880"
  },
  {
    "text": "like recording rules you'll have to go",
    "start": "1354880",
    "end": "1356320"
  },
  {
    "text": "and kind of like change",
    "start": "1356320",
    "end": "1358320"
  },
  {
    "text": "uh change dashboards and other places",
    "start": "1358320",
    "end": "1360720"
  },
  {
    "text": "where things have run",
    "start": "1360720",
    "end": "1362480"
  },
  {
    "text": "uh so we built this tool um it's",
    "start": "1362480",
    "end": "1364799"
  },
  {
    "text": "available open source the link to this",
    "start": "1364799",
    "end": "1366880"
  },
  {
    "text": "is in the next",
    "start": "1366880",
    "end": "1367840"
  },
  {
    "text": "like in like the last last slide",
    "start": "1367840",
    "end": "1371760"
  },
  {
    "text": "um so yeah we encourage you to go and",
    "start": "1371760",
    "end": "1374640"
  },
  {
    "text": "like",
    "start": "1374640",
    "end": "1374960"
  },
  {
    "text": "try this out and let us know kind of how",
    "start": "1374960",
    "end": "1378240"
  },
  {
    "text": "this works out for you",
    "start": "1378240",
    "end": "1380320"
  },
  {
    "text": "uh so thank you so much",
    "start": "1380320",
    "end": "1383360"
  },
  {
    "text": "um we're open to questions now",
    "start": "1383360",
    "end": "1387679"
  },
  {
    "text": "if you want to kind of know more about",
    "start": "1387679",
    "end": "1389280"
  },
  {
    "text": "kind of the m3 aggregation tier like",
    "start": "1389280",
    "end": "1391039"
  },
  {
    "text": "reach out do reach out to us on the m3",
    "start": "1391039",
    "end": "1392799"
  },
  {
    "text": "slack channel",
    "start": "1392799",
    "end": "1394880"
  },
  {
    "text": "and there's a link to kind of the high",
    "start": "1394880",
    "end": "1396320"
  },
  {
    "text": "cardinality analyzer available here",
    "start": "1396320",
    "end": "1400320"
  },
  {
    "text": "yeah there's a link to that on an",
    "start": "1400720",
    "end": "1402000"
  },
  {
    "text": "analyzer available for you to kind of",
    "start": "1402000",
    "end": "1404000"
  },
  {
    "text": "try out",
    "start": "1404000",
    "end": "1405280"
  },
  {
    "text": "thank you again",
    "start": "1405280",
    "end": "1408320"
  }
]