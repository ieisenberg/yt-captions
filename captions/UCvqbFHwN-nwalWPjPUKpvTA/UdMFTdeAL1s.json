[
  {
    "start": "0",
    "end": "195000"
  },
  {
    "text": "okay welcome can everyone hear me okay I think we have reached capacity and we",
    "start": "3560",
    "end": "10320"
  },
  {
    "text": "are rolling okay welcome to attacking and defending kubernetes clusters we're gonna get back",
    "start": "10320",
    "end": "16440"
  },
  {
    "text": "to this I know people are still trickling in you are in the right spot if this looks familiar and you signed up",
    "start": "16440",
    "end": "22109"
  },
  {
    "text": "on this for this particular class and we're gonna have a lot of fun this is a super packed house and we have lots of",
    "start": "22109",
    "end": "29519"
  },
  {
    "text": "people here to help us out we're gonna do a quick intro and then we're gonna dive right into it we have a lot of",
    "start": "29519",
    "end": "36059"
  },
  {
    "text": "content to cover so tabby I'm Tabitha I'm Jimmy I'm Peter and I'm Brad and who",
    "start": "36059",
    "end": "44730"
  },
  {
    "text": "are helpers please raise their hands give them a round of applause thank you for helping our coffee Kunal Mike Maya",
    "start": "44730",
    "end": "52730"
  },
  {
    "text": "thank you all right so let's take a moment to meet our neighbors - if you haven't already nod your head shake your",
    "start": "52730",
    "end": "59789"
  },
  {
    "text": "hand say hi kumbaya we're gonna we're gonna get to know each other for the next 84 minutes right welcome and it's",
    "start": "59789",
    "end": "69119"
  },
  {
    "text": "gonna be great yeah yes yes this is gonna be good look I feel the love here at cube con",
    "start": "69119",
    "end": "75979"
  },
  {
    "text": "all right so we have art easily crafted",
    "start": "76470",
    "end": "83070"
  },
  {
    "text": "to scenarios to walk through step by step a guided tour that's the name",
    "start": "83070",
    "end": "88740"
  },
  {
    "text": "that's what we're gonna do but we have some important rules to follow okay bring it down okay all right so we have",
    "start": "88740",
    "end": "96390"
  },
  {
    "text": "instructions and we're gonna follow those pretty closely right everything is copy paste the bowl we have zero",
    "start": "96390",
    "end": "102620"
  },
  {
    "text": "prerequisites for this particular course if you've never used Q's control cube cuddle queue Bechdel whatever you want",
    "start": "102620",
    "end": "108690"
  },
  {
    "text": "to call it we're not gonna go there that's okay whisper please when we're presenting this is a massive room and we just want",
    "start": "108690",
    "end": "115620"
  },
  {
    "text": "to make sure that we're getting the information out to everybody in due time if you need help your first order of",
    "start": "115620",
    "end": "122220"
  },
  {
    "text": "operation should be to look at a neighbor right you're sitting pretty close to somebody who has probably solved the issue unless it's on Google",
    "start": "122220",
    "end": "129090"
  },
  {
    "text": "side then we have some Googlers in the room that we can heckle just kidding if you're completely stuck raise your hand",
    "start": "129090",
    "end": "135870"
  },
  {
    "text": "so that we have room monitors Duffy and Ian and a few others and the four of us",
    "start": "135870",
    "end": "141270"
  },
  {
    "text": "will be running around like crazy to try to get everybody through these scenarios and attack your own cluster only please",
    "start": "141270",
    "end": "148860"
  },
  {
    "text": "it's not cool to jump around and try to drop zero-day and do crazy things on",
    "start": "148860",
    "end": "154620"
  },
  {
    "text": "other people's stuff that is really cool but not for today right we put a lot of",
    "start": "154620",
    "end": "159810"
  },
  {
    "text": "effort into getting this situated isolated and please respect that and",
    "start": "159810",
    "end": "164820"
  },
  {
    "text": "don't attack anything from your cluster either right we're gonna be doing some fun scenarios with fake Bitcoin mining",
    "start": "164820",
    "end": "171060"
  },
  {
    "text": "cryptocurrency mining pods and things like that those are fake please don't set up your own mining rig on these",
    "start": "171060",
    "end": "177150"
  },
  {
    "text": "clusters that would get really expensive really fast and please have fun this is",
    "start": "177150",
    "end": "182400"
  },
  {
    "text": "supposed to be a really good time we're really honored to be here and we want everybody to come out of this with a",
    "start": "182400",
    "end": "188850"
  },
  {
    "text": "little more attack under their belt to go home with and learn about so breaking",
    "start": "188850",
    "end": "195840"
  },
  {
    "text": "down the different scenarios just a quick rough guideline for timing we are we're operating to the second",
    "start": "195840",
    "end": "203700"
  },
  {
    "text": "probably but for you all here we have scenario one we're going to do full guided attack in defense we're",
    "start": "203700",
    "end": "209670"
  },
  {
    "text": "gonna put on a red hat blue hat and walk you through some scenarios about 25 minutes there and then we're going to",
    "start": "209670",
    "end": "215340"
  },
  {
    "text": "step it up the level we're gonna go from noob to expert and take it to scenario 2",
    "start": "215340",
    "end": "220860"
  },
  {
    "text": "where we dive into some more detail and then we have some bonus challenges that are self-guided CTF style challenges",
    "start": "220860",
    "end": "227819"
  },
  {
    "text": "that you are going to be let loose on your cluster and to break things we have special flags and then we're gonna",
    "start": "227819",
    "end": "233700"
  },
  {
    "text": "hopefully squeeze in time at the end to walk you through those bonuses as well and that should bring us right up until",
    "start": "233700",
    "end": "241590"
  },
  {
    "text": "the very very end and hopefully not flow over if at all possible so we're gonna",
    "start": "241590",
    "end": "247650"
  },
  {
    "text": "walk through again getting connected and number one we're gonna start with this",
    "start": "247650",
    "end": "254040"
  },
  {
    "text": "lovely domain that I bought a long time ago as a project that never actually occurred called secure kubernetes comm",
    "start": "254040",
    "end": "261180"
  },
  {
    "text": "if you visit that you're gonna have all of the lab material necessary so please open this in a private browsing window",
    "start": "261180",
    "end": "268199"
  },
  {
    "text": "or incognito window if you've ever experienced cross Google accounts multiple gmail accounts corporate",
    "start": "268199",
    "end": "275250"
  },
  {
    "text": "accounts that's going to get messy so just do this in either a brand new fresh browser or in an incognito window or",
    "start": "275250",
    "end": "282389"
  },
  {
    "text": "bright private experience got that secured kubernetes calm cool alright so",
    "start": "282389",
    "end": "287940"
  },
  {
    "text": "let's dive right into scenario one this scenario is called free compute and we",
    "start": "287940",
    "end": "293130"
  },
  {
    "text": "have a lot of fun to do with this particular scenario so if you head on",
    "start": "293130",
    "end": "298349"
  },
  {
    "text": "over to secure kubernetes comm you can see our helpers are going out into the field getting ready to help everybody so",
    "start": "298349",
    "end": "304650"
  },
  {
    "text": "if you go to secure kubernetes comm we are going to see scenario 1 and I will",
    "start": "304650",
    "end": "310669"
  },
  {
    "text": "go there as well and you can follow along so here we are secure kubernetes",
    "start": "310669",
    "end": "316590"
  },
  {
    "start": "315000",
    "end": "560000"
  },
  {
    "text": "comm this is assuming we are all set up so I think most of us in the room with",
    "start": "316590",
    "end": "322500"
  },
  {
    "text": "the number of hands and in g-cloud kind of worries we had a little earlier hopefully those are subsiding we were",
    "start": "322500",
    "end": "329190"
  },
  {
    "text": "get running into that too but things do settle down and and we will get our our",
    "start": "329190",
    "end": "335479"
  },
  {
    "text": "cloud shell account so we're gonna get connected so you should all have a credential card does anybody not",
    "start": "335479",
    "end": "341340"
  },
  {
    "text": "a credential card yet we have one right here okay you might be number 401 in",
    "start": "341340",
    "end": "347070"
  },
  {
    "text": "this event and but we have some overflow so we'll get you hooked up maybe",
    "start": "347070",
    "end": "352199"
  },
  {
    "text": "hopefully so so we're gonna open cloud shell so when we do that this button",
    "start": "352199",
    "end": "359970"
  },
  {
    "text": "love this lovely button here it's gonna do some very special things for us if you look at the URL you can see that but",
    "start": "359970",
    "end": "366090"
  },
  {
    "text": "for the sake of this we're gonna open cloud shell and it should look something like this right so we have cloud shell",
    "start": "366090",
    "end": "371280"
  },
  {
    "text": "up and running I am cube con 4:01 the naming convention is not that important just know that you",
    "start": "371280",
    "end": "378300"
  },
  {
    "text": "are dropped into your own special project we had to go through a lot of Hoops to get that to work but we're",
    "start": "378300",
    "end": "383610"
  },
  {
    "text": "there and then we're going to get set up so when you have cloud shell open you're",
    "start": "383610",
    "end": "389580"
  },
  {
    "text": "going to be presented with a login page right this is where we're gonna enter that email on the card and the password",
    "start": "389580",
    "end": "394740"
  },
  {
    "text": "as well if that doesn't work for some reason again that's a hand up situation a lot of snow will get you figured out",
    "start": "394740",
    "end": "400770"
  },
  {
    "text": "and then we follow through the prompts we accept our terms and conditions simple stuff we've all read this in",
    "start": "400770",
    "end": "408330"
  },
  {
    "text": "great detail I'm sure then select your country United States and you agree to the GCP Terms of",
    "start": "408330",
    "end": "414840"
  },
  {
    "text": "Service great then we start cloud shell so as you start cloud shell we have a",
    "start": "414840",
    "end": "421380"
  },
  {
    "text": "very special cloud shell setup that's going to run for you be pulled into cloud shell with a lot of helper scripts",
    "start": "421380",
    "end": "427680"
  },
  {
    "text": "and things that get you up and running really really fast so the key here is",
    "start": "427680",
    "end": "433460"
  },
  {
    "text": "this command cube control get pods - - all namespaces if you're used kubernetes",
    "start": "433460",
    "end": "438690"
  },
  {
    "text": "which most of us have we've run this and this is just to prove that we have connectivity to our cluster and oh I",
    "start": "438690",
    "end": "448289"
  },
  {
    "text": "asked if this last time so set up dot sh so set up dot sh is a really important script and I'm gonna run these with you",
    "start": "448289",
    "end": "455760"
  },
  {
    "text": "so in this secure kubernetes page right here you could use the copy and paste",
    "start": "455760",
    "end": "461639"
  },
  {
    "text": "straight from here this is the easiest way so when I copy to clipboard go over",
    "start": "461639",
    "end": "466800"
  },
  {
    "text": "to my cloud shell make sure everything is good paste it in this is setting my",
    "start": "466800",
    "end": "472530"
  },
  {
    "text": "project ID to the one that was provide and a couple other helpers for you to get you connected to your gke cluster so",
    "start": "472530",
    "end": "480370"
  },
  {
    "text": "our google google kubernetes engine cluster so we're gonna let this run and this is what will enable us to run the",
    "start": "480370",
    "end": "487000"
  },
  {
    "text": "cube Patrol get pods all namespaces and i know we're going kind of fast through this section because we really want to",
    "start": "487000",
    "end": "492669"
  },
  {
    "text": "get to the meat of it and anybody not have access to a cloud shell yet this is",
    "start": "492669",
    "end": "499180"
  },
  {
    "text": "just a total okay that's not bad Google's catching up that's good that's",
    "start": "499180",
    "end": "505900"
  },
  {
    "text": "good that's only a few so for now please just work with your neighbor until your",
    "start": "505900",
    "end": "511330"
  },
  {
    "text": "cloud shell comes up I'm glad we're at critical mass with that so here we have set up dot sh that",
    "start": "511330",
    "end": "520300"
  },
  {
    "text": "did some magic for us right you can go read the script if you're interested and then we have I'm going to copy and paste",
    "start": "520300",
    "end": "526480"
  },
  {
    "text": "we have our cube control get pods all namespaces copy that to the clipboard this is our test right this is going to",
    "start": "526480",
    "end": "534940"
  },
  {
    "text": "show that we have pods running right and these pods are some of them are used in",
    "start": "534940",
    "end": "541180"
  },
  {
    "text": "class some are part of of the kubernetes gke version we're using but something",
    "start": "541180",
    "end": "547060"
  },
  {
    "text": "should show up here right if you've used kubernetes you're used to this so let's press on and that's it we've we've done",
    "start": "547060",
    "end": "556779"
  },
  {
    "text": "the getting connected step okay so now we're getting more we're getting even",
    "start": "556779",
    "end": "563020"
  },
  {
    "start": "560000",
    "end": "858000"
  },
  {
    "text": "more helpers I see Maya is helping out this is awesome so okay so let's dive",
    "start": "563020",
    "end": "574570"
  },
  {
    "text": "right in this is going to be as roleplay E as possible while still kind of breaking the fourth wall and helping",
    "start": "574570",
    "end": "581050"
  },
  {
    "text": "people along the way I'm going to take over scenario one as the attacker I'm a",
    "start": "581050",
    "end": "586360"
  },
  {
    "text": "newbie just opportunist attacker right and the backstory here really quite",
    "start": "586360",
    "end": "593020"
  },
  {
    "text": "simple I just find automated scans and scripts off the shelf and I run them against",
    "start": "593020",
    "end": "599800"
  },
  {
    "text": "vulnerable IP addresses or infrastructure right I don't have a lot of skill and I have very limited",
    "start": "599800",
    "end": "605140"
  },
  {
    "text": "kubernetes knowledge so this is something you'll probably be up against in your own clusters but we want to",
    "start": "605140",
    "end": "611000"
  },
  {
    "text": "learn kind of the how this how this plays out for somebody who is an opportunist right and cryptocurrency",
    "start": "611000",
    "end": "617150"
  },
  {
    "text": "mining is my game right that's my jam I have to make rent next month so I need to get these cryptocurrency miners",
    "start": "617150",
    "end": "623780"
  },
  {
    "text": "installed on somebody's cluster so red has been mining bit Bitcoin arrow for a",
    "start": "623780",
    "end": "630740"
  },
  {
    "text": "few months right so we're mining Bitcoin and and we are using a service that is selling shells for us right we can",
    "start": "630740",
    "end": "637820"
  },
  {
    "text": "purchase a shell or a friend gives us a shell that they have gone out and exploited and we have access to that now",
    "start": "637820",
    "end": "645020"
  },
  {
    "text": "right that's really cool right because I don't know a whole lot about what I'm doing and as an attacker I'm gonna",
    "start": "645020",
    "end": "651260"
  },
  {
    "text": "utilize that shell to do some bad things so a brief note on attack patterns right",
    "start": "651260",
    "end": "657140"
  },
  {
    "text": "if you if you attended Ian's talk this morning we a little bit of this thinking",
    "start": "657140",
    "end": "663320"
  },
  {
    "text": "and graphs a sort of mentality was mentioned right so attackers thinking graphs so we're studying our target",
    "start": "663320",
    "end": "669320"
  },
  {
    "text": "we're doing a lot of research on what's going on and we're actually planning our attack in great detail before we just go",
    "start": "669320",
    "end": "676130"
  },
  {
    "text": "and throw our exploit or our code on to that target so and if you see me skip",
    "start": "676130",
    "end": "681740"
  },
  {
    "text": "over something in the tutorial it's here for you all later and we can that'll be available for you so the key is we want",
    "start": "681740",
    "end": "688520"
  },
  {
    "text": "to attack something right we want to get our payload or our cryptocurrency miner running on this vulnerable cluster we",
    "start": "688520",
    "end": "695480"
  },
  {
    "text": "want to persist as well that's going to come into play in scenario two so attack persist and then win and win for us",
    "start": "695480",
    "end": "702950"
  },
  {
    "text": "right now is straight-up money right cryptocurrency mining and this is something we see very very often in the",
    "start": "702950",
    "end": "709730"
  },
  {
    "text": "kubernetes space so we are going to do",
    "start": "709730",
    "end": "715700"
  },
  {
    "text": "some steps to get an endpoint that we have compromised already this is a web",
    "start": "715700",
    "end": "721820"
  },
  {
    "text": "shell that's running in the kubernetes cluster that is your target your scope is your cluster and that's it so we're",
    "start": "721820",
    "end": "728960"
  },
  {
    "text": "going to do this together and we're going to run this check email script right here so if we copy check",
    "start": "728960",
    "end": "735020"
  },
  {
    "text": "email dot Sh we're gonna see some interesting things come up in our cloud shell",
    "start": "735020",
    "end": "742000"
  },
  {
    "text": "hopefully so okay this is the email for my friend my friend that I purchased",
    "start": "743490",
    "end": "749560"
  },
  {
    "text": "this shell from right so here we have an IP address 35 to 36 114 113 with a",
    "start": "749560",
    "end": "756130"
  },
  {
    "text": "special port so when we visit this we can actually get a web show so if you",
    "start": "756130",
    "end": "764770"
  },
  {
    "text": "run check email get your IP address with your port and click on that as a URL",
    "start": "764770",
    "end": "769960"
  },
  {
    "text": "you're going to be presented with this HTTP basic auth login screen right so",
    "start": "769960",
    "end": "775120"
  },
  {
    "text": "this is where we need to enter credentials these credentials will match what's on here this is not something an",
    "start": "775120",
    "end": "781120"
  },
  {
    "text": "attacker may go through typically this is to protect our our Google billing",
    "start": "781120",
    "end": "787060"
  },
  {
    "text": "account from being completely and utterly owned within this 90 minute time frame because only you all should have",
    "start": "787060",
    "end": "793900"
  },
  {
    "text": "this this set of credentials so I'm going to enter a cube con 401 that's",
    "start": "793900",
    "end": "802440"
  },
  {
    "text": "9.com and then so whew a web shell so",
    "start": "803340",
    "end": "817500"
  },
  {
    "text": "this is a web shell running in the browser right so this this could be seen",
    "start": "817500",
    "end": "823180"
  },
  {
    "text": "as an exploit some sort of backdoor there's a number of ways through an attackers lens that you can get to this",
    "start": "823180",
    "end": "829750"
  },
  {
    "text": "destination but we're not going to go over that in great detail today this is our foothold into the cluster this is",
    "start": "829750",
    "end": "835630"
  },
  {
    "text": "our entry point as an attacker the way we have access to this cluster from the",
    "start": "835630",
    "end": "840700"
  },
  {
    "text": "outside world and we see this all the time out in the wild as well so we should all be looking at a web shell",
    "start": "840700",
    "end": "846790"
  },
  {
    "text": "like this and if you don't and if you're really kind of wondering where you're at raise your hand",
    "start": "846790",
    "end": "852820"
  },
  {
    "text": "everything's laid out in the tutorial and in great detail so we want to mind",
    "start": "852820",
    "end": "859690"
  },
  {
    "text": "some Bitcoin right we've studied our target we have our web shell and we want to get some loot right so as an attacker",
    "start": "859690",
    "end": "866250"
  },
  {
    "text": "the very first step is not just throwing a Bitcoin a script that's going to go my",
    "start": "866250",
    "end": "871270"
  },
  {
    "text": "Bitcoin into this environment we have to learn a little bit about it so here we have a list of common commands we can run once",
    "start": "871270",
    "end": "879369"
  },
  {
    "text": "we're dropped into a shell right we don't know what user we are we don't know what group we're in we don't know if we're on a VM or on a container in",
    "start": "879369",
    "end": "886059"
  },
  {
    "text": "kubernetes and whatever right so we got to do some some some background check",
    "start": "886059",
    "end": "891399"
  },
  {
    "text": "rice we have to check out where we're at so we've run two commands like ID right",
    "start": "891399",
    "end": "897999"
  },
  {
    "start": "893000",
    "end": "918000"
  },
  {
    "text": "I'm gonna copy that to the clipboard and I'm not going to go through all these in these commands at this part of the walk",
    "start": "897999",
    "end": "903699"
  },
  {
    "text": "through these commands are run in this web shell in the browser so ID right same but who could tell me what what",
    "start": "903699",
    "end": "911529"
  },
  {
    "text": "what I'm looking at now UID 1,000 dashboard a my route no not route okay",
    "start": "911529",
    "end": "919209"
  },
  {
    "text": "that's interesting right so I'm gonna run let's do PS - EF huh",
    "start": "919209",
    "end": "930850"
  },
  {
    "text": "what's this what's PS - EF anybody have a guess process is this typical of a",
    "start": "930850",
    "end": "937059"
  },
  {
    "text": "virtual machine or a container probably a container there's not that many processes running right so that's",
    "start": "937059",
    "end": "943720"
  },
  {
    "text": "interesting right and as an attacker I'm writing this stuff down right step by step by step so as I go down my list and",
    "start": "943720",
    "end": "950679"
  },
  {
    "text": "we can run more and more commands if we so wish but we're gonna keep digging in right so one of the main ones here I",
    "start": "950679",
    "end": "957730"
  },
  {
    "text": "want to run I'm gonna bring in a tool from somebody else right just I think",
    "start": "957730",
    "end": "963069"
  },
  {
    "text": "this is just Brazil's tool right am I contained I want to curl this using the",
    "start": "963069",
    "end": "969100"
  },
  {
    "text": "curl utility which is going to go download this file on to my shell well",
    "start": "969100",
    "end": "974110"
  },
  {
    "text": "you know I think it's a container I hope it's a container and it's going to tell me a bunch of information about the",
    "start": "974110",
    "end": "980410"
  },
  {
    "text": "space I'm in right the space I'm operating as so I copy this this curl",
    "start": "980410",
    "end": "985629"
  },
  {
    "text": "command and I'm gonna pull this down and I see a bunch of interesting things and",
    "start": "985629",
    "end": "990879"
  },
  {
    "text": "for the sake of not going through every single assist call and and and things",
    "start": "990879",
    "end": "996309"
  },
  {
    "text": "like that there's an interesting piece here container run time is cube right what what is that what does that tell me",
    "start": "996309",
    "end": "1003239"
  },
  {
    "text": "as an attacker probably running in a container inside of kubernetes",
    "start": "1003239",
    "end": "1009600"
  },
  {
    "text": "right well we are at cube Khan's so that's a given but this is the process right I know I'm in kubernetes so I have",
    "start": "1009600",
    "end": "1016079"
  },
  {
    "text": "just reset my expectations reset my scope and I'm just gonna throw away all the things that don't pertain to",
    "start": "1016079",
    "end": "1021449"
  },
  {
    "text": "kubernetes because I need to get this thing running ASAP so I'm gonna go back",
    "start": "1021449",
    "end": "1027150"
  },
  {
    "text": "to my scenario and now I know that I'm",
    "start": "1027150",
    "end": "1033329"
  },
  {
    "text": "in kubernetes I'm gonna run some very specific kubernetes commands and I suggest I'm kind of blabbing and talking",
    "start": "1033329",
    "end": "1039839"
  },
  {
    "text": "up here but I suggest you run the commands I'm skipping over as well to kind of get a feel for what that looks",
    "start": "1039839",
    "end": "1045058"
  },
  {
    "text": "like as well so I'm gonna look at my environment variables and I'm gonna look for the word cube and when I do that",
    "start": "1045059",
    "end": "1052640"
  },
  {
    "text": "interesting right those of us who administer kubernetes clusters have seen these things kubernetes ports IP",
    "start": "1052640",
    "end": "1059520"
  },
  {
    "text": "addresses and all sorts of interesting internal IP address space that is",
    "start": "1059520",
    "end": "1065250"
  },
  {
    "text": "running kubernetes right so I'm gonna log that and put that in my memory and in my notebook write it as part of my",
    "start": "1065250",
    "end": "1071460"
  },
  {
    "text": "attack and then I'm gonna look at the version this is a really interesting one",
    "start": "1071460",
    "end": "1077630"
  },
  {
    "start": "1073000",
    "end": "1113000"
  },
  {
    "text": "so this command is going to give me one special thing right get version this is",
    "start": "1077630",
    "end": "1084120"
  },
  {
    "text": "version 113 dot 11 - gke 14 I'm running in kubernetes but I'm also running on",
    "start": "1084120",
    "end": "1090450"
  },
  {
    "text": "gke that narrows my attack surface even more right if I know there's a gke exploit which there of course would",
    "start": "1090450",
    "end": "1097110"
  },
  {
    "text": "never be one right the then I'm gonna target that right if I know the kubernetes version I'm going to the CVE",
    "start": "1097110",
    "end": "1103890"
  },
  {
    "text": "list and I'm gonna check and see if there's anything out there in the wild that I can exploit right this is really",
    "start": "1103890",
    "end": "1110190"
  },
  {
    "text": "really really useful stuff so I'm gonna keep digging in and see what I can do on",
    "start": "1110190",
    "end": "1117870"
  },
  {
    "start": "1113000",
    "end": "1128000"
  },
  {
    "text": "the actual machine right so to do that I want to interact with the API server and",
    "start": "1117870",
    "end": "1123570"
  },
  {
    "text": "how do we interact with the API server in this context what tool do we typically want to use cute cube control",
    "start": "1123570",
    "end": "1131100"
  },
  {
    "start": "1128000",
    "end": "1168000"
  },
  {
    "text": "right that's what we are keep CTL I don't know this is a tough crowd with the how to pronounce that so",
    "start": "1131100",
    "end": "1138360"
  },
  {
    "text": "I'm gonna copy this and I'm gonna go grab cube control this is going to install the coop control binary on to",
    "start": "1138360",
    "end": "1147860"
  },
  {
    "text": "it's already installed because this is our testing cluster but we're gonna have cube control installed onto our running",
    "start": "1148520",
    "end": "1156660"
  },
  {
    "text": "container that's in a pod that's on our gke cluster with that comes a lot of power right we have cube control and we",
    "start": "1156660",
    "end": "1163830"
  },
  {
    "text": "can start to test out permissions and see what we can actually provision on to the cluster so once cube control is",
    "start": "1163830",
    "end": "1170549"
  },
  {
    "start": "1168000",
    "end": "1223000"
  },
  {
    "text": "installed I'm just gonna go down the list right I'm gonna go to do a cube control get all this is a great nifty",
    "start": "1170549",
    "end": "1176520"
  },
  {
    "text": "little command what can I see right as this this user with us the service account so here we have a pretty",
    "start": "1176520",
    "end": "1183630"
  },
  {
    "text": "comprehensive list we have replica sets deployment services etc and we have the",
    "start": "1183630",
    "end": "1189510"
  },
  {
    "text": "running applications and now I want to get namespaces so I'm gonna run cube",
    "start": "1189510",
    "end": "1196440"
  },
  {
    "text": "control get namespaces interesting I am forbidden I'm not allowed to run this",
    "start": "1196440",
    "end": "1202080"
  },
  {
    "text": "command what's going on here right so namespaces is forbidden for user systems service account PRD default so this is",
    "start": "1202080",
    "end": "1209909"
  },
  {
    "text": "saying there there exists a PRD namespace and i don't have access to go",
    "start": "1209909",
    "end": "1214950"
  },
  {
    "text": "get get a list of all the namespaces running in this particular cluster so that's really interesting I need to",
    "start": "1214950",
    "end": "1220830"
  },
  {
    "text": "elevate my privileges or figure out something else to do right if I want to see everything so you know kind of",
    "start": "1220830",
    "end": "1228600"
  },
  {
    "text": "throwing it back to this cube off can i from a little earlier today if you've been around this is all the attackers love this tool this is going to just",
    "start": "1228600",
    "end": "1235650"
  },
  {
    "text": "tell me straight up what can I do right and the real thing is I want to create a pod the end of the day I want to get my",
    "start": "1235650",
    "end": "1243419"
  },
  {
    "text": "own work load running on this cluster I need to make money I don't care about my elite I am I just need to get things",
    "start": "1243419",
    "end": "1250230"
  },
  {
    "text": "rolling so I want to use cube off can I create pods so imma copy this command and yes right that's really all I care",
    "start": "1250230",
    "end": "1260610"
  },
  {
    "text": "about to mine cryptocurrency as my unskilled self right so I'm gonna go",
    "start": "1260610",
    "end": "1265950"
  },
  {
    "text": "create a pot and if you're you're privy to this you probably notice this is already running but that's okay and in",
    "start": "1265950",
    "end": "1273510"
  },
  {
    "start": "1268000",
    "end": "1398000"
  },
  {
    "text": "this section here this is my Bitcoin err cryptocurrency mining deployment I know",
    "start": "1273510",
    "end": "1279110"
  },
  {
    "text": "I can create pods I have this running web show I have access to this cluster I might not be cluster admin but that",
    "start": "1279110",
    "end": "1286309"
  },
  {
    "text": "doesn't matter for me right now right I want to do some damage and utilize this these resources to mine my",
    "start": "1286309",
    "end": "1291889"
  },
  {
    "text": "cryptocurrency so I'm going to copy this command which is just yamo and it's going to go create this deployment",
    "start": "1291889",
    "end": "1298009"
  },
  {
    "text": "called Bitcoin arrow paste that in and",
    "start": "1298009",
    "end": "1306250"
  },
  {
    "text": "magics going to happen",
    "start": "1306250",
    "end": "1310029"
  },
  {
    "text": "okay so here I have my Bitcoin aero pod",
    "start": "1314970",
    "end": "1320130"
  },
  {
    "text": "running this is a test cluster so",
    "start": "1320130",
    "end": "1325400"
  },
  {
    "text": "working on the fly okay I'm going to recreate it now so this is",
    "start": "1331940",
    "end": "1339450"
  },
  {
    "text": "what you will see so I'm going to recreate my deployment and I have my",
    "start": "1339450",
    "end": "1344700"
  },
  {
    "text": "Bitcoin mining infrastructure up and running in this kubernetes cluster right",
    "start": "1344700",
    "end": "1349980"
  },
  {
    "text": "here we have should be somewhere maybe",
    "start": "1349980",
    "end": "1355110"
  },
  {
    "text": "it's not up yet okay so to pass this on",
    "start": "1355110",
    "end": "1365190"
  },
  {
    "text": "along to my defensive counterpart as far as the script kiddies concerned I'm already mining cryptocurrency in",
    "start": "1365190",
    "end": "1371880"
  },
  {
    "text": "this cluster using my Bitcoin arrow deployment right this is running it's not sophisticated I got it from the",
    "start": "1371880",
    "end": "1378150"
  },
  {
    "text": "internet but it's getting the job done right so hopefully you were able to follow step by step and now we're going",
    "start": "1378150",
    "end": "1383909"
  },
  {
    "text": "to talk a little bit about the defensive tactics as part of this walkthrough to",
    "start": "1383909",
    "end": "1390360"
  },
  {
    "text": "my lovely counterpart Brad okay so",
    "start": "1390360",
    "end": "1398870"
  },
  {
    "start": "1398000",
    "end": "1443000"
  },
  {
    "text": "hi my name is blue and I'm an overworked sysadmin oh whoa what's that",
    "start": "1404760",
    "end": "1410430"
  },
  {
    "text": "hold on what time is it hey yeah boss oh",
    "start": "1410430",
    "end": "1416130"
  },
  {
    "text": "the web site slow got it which web site you don't know okay you know it's 1:00",
    "start": "1416130",
    "end": "1422040"
  },
  {
    "text": "a.m. right okay I'll get right on it life of a sysadmin huh okay",
    "start": "1422040",
    "end": "1428810"
  },
  {
    "text": "generally speaking I can only do the bare minimum there's only one of me so this is kind of how I roll and this is",
    "start": "1428810",
    "end": "1433890"
  },
  {
    "text": "this is just par for the course but we'll see what we can do because I'm pretty confident we're doing everything",
    "start": "1433890",
    "end": "1440340"
  },
  {
    "text": "right but we'll see so without a lot of details I sort of have to figure out",
    "start": "1440340",
    "end": "1446820"
  },
  {
    "start": "1443000",
    "end": "1468000"
  },
  {
    "text": "which cluster which deployment what's going on like why is this slow so we're gonna switch gears here so take off your",
    "start": "1446820",
    "end": "1453540"
  },
  {
    "text": "red hat put on your blue hat we are going to be using the same cloud shell as the administrator at this point okay",
    "start": "1453540",
    "end": "1460560"
  },
  {
    "text": "so now you're switching into the administrator you fire up cloud shell you have your credentials to the cluster so follow along in this sense so I'm",
    "start": "1460560",
    "end": "1469320"
  },
  {
    "start": "1468000",
    "end": "1508000"
  },
  {
    "text": "gonna run coop control get pods all namespaces I'm gonna do one more zoom that's too many okay I am in the web",
    "start": "1469320",
    "end": "1479190"
  },
  {
    "text": "shop not in the cloud show see don't follow that what I'm gonna do is zoom this in a little bit and you can do this",
    "start": "1479190",
    "end": "1486990"
  },
  {
    "text": "too if your eyes are like mine okay get pods all new spaces all right",
    "start": "1486990",
    "end": "1492480"
  },
  {
    "text": "so I'm the SIS I don't know and what I'm looking for here on the left is the running now it's on the right okay looks",
    "start": "1492480",
    "end": "1500640"
  },
  {
    "text": "good everything looks good it's running this cluster doesn't look bad from any there's no crash looping pods you know",
    "start": "1500640",
    "end": "1508200"
  },
  {
    "start": "1508000",
    "end": "1648000"
  },
  {
    "text": "what else is next well they said it was performance related so let's use cout control top okay what does COO control",
    "start": "1508200",
    "end": "1517710"
  },
  {
    "text": "top do an average of the last little bits of",
    "start": "1517710",
    "end": "1525800"
  },
  {
    "text": "let's see did did Jimmy did your we're",
    "start": "1525800",
    "end": "1531720"
  },
  {
    "text": "going to do this again so we get Bitcoin or Bitcoin arrow didn't run okay okay",
    "start": "1531720",
    "end": "1540240"
  },
  {
    "text": "one second pause the the blue scenario here in your heads and we're gonna go",
    "start": "1540240",
    "end": "1547500"
  },
  {
    "text": "back get this here doc there we go it",
    "start": "1547500",
    "end": "1556020"
  },
  {
    "text": "might still be there I'm just gonna paste it in anyway let's just put in the",
    "start": "1556020",
    "end": "1564900"
  },
  {
    "text": "default namespace tell me that nope",
    "start": "1564900",
    "end": "1572150"
  },
  {
    "text": "the coiner should be right here",
    "start": "1572600",
    "end": "1576410"
  },
  {
    "text": "okay",
    "start": "1579230",
    "end": "1582010"
  },
  {
    "text": "yeah no kidding delete I don't have there we go",
    "start": "1585980",
    "end": "1599210"
  },
  {
    "text": "interesting",
    "start": "1612120",
    "end": "1615080"
  },
  {
    "text": "I know what to do that's and I found it hold on a second",
    "start": "1625330",
    "end": "1630749"
  },
  {
    "text": "no we have uh we have something else at play here that I don't want to let let you know about until later okay hold on",
    "start": "1630929",
    "end": "1639940"
  },
  {
    "text": "a second the yeah you found that out how",
    "start": "1639940",
    "end": "1647559"
  },
  {
    "text": "stress ng excellent what is stress ng it",
    "start": "1647559",
    "end": "1661029"
  },
  {
    "start": "1648000",
    "end": "1743000"
  },
  {
    "text": "is our oops stress ng is a is a cpu",
    "start": "1661029",
    "end": "1667330"
  },
  {
    "text": "stressor or it stresses a bunch of different things but it's it's you know",
    "start": "1667330",
    "end": "1672879"
  },
  {
    "text": "its elite and there we go avert your",
    "start": "1672879",
    "end": "1678669"
  },
  {
    "text": "eyes this may or may not be part of a bonus bypass that's a clue for you okay",
    "start": "1678669",
    "end": "1685509"
  },
  {
    "text": "that's why it's not running anybody tell me what's running that's blocking shout",
    "start": "1685509",
    "end": "1690789"
  },
  {
    "text": "it out say louder OPA gatekeeper so",
    "start": "1690789",
    "end": "1696549"
  },
  {
    "text": "that's why we're creating the deployment but it didn't show up as a pod right okay okay let me go back Andrea tak oh",
    "start": "1696549",
    "end": "1709619"
  },
  {
    "text": "there it is okay great moving on back in blue shoes okay",
    "start": "1709830",
    "end": "1719429"
  },
  {
    "text": "so this this top pod sorry that's where we're back at what we're looking at here",
    "start": "1722980",
    "end": "1730809"
  },
  {
    "text": "and while we're purposely not stressing these nodes too much is a deployment that's using a bit more CPU than the",
    "start": "1730809",
    "end": "1737860"
  },
  {
    "text": "rest so it does stick out right so that's a little suspicious and I'm not",
    "start": "1737860",
    "end": "1744940"
  },
  {
    "start": "1743000",
    "end": "1773000"
  },
  {
    "text": "really sure what the image might look like from where that's coming from so how many of you have run this command to",
    "start": "1744940",
    "end": "1750850"
  },
  {
    "text": "get pods all namespaces looking for just the image and then you trade the space",
    "start": "1750850",
    "end": "1756279"
  },
  {
    "text": "for a new line and then you sort unique what is this going to give us a list of all the unique images currently running",
    "start": "1756279",
    "end": "1761980"
  },
  {
    "text": "in the cluster so we can see Bitcoin error latest it's still showing up here",
    "start": "1761980",
    "end": "1766990"
  },
  {
    "text": "it still kind of looks out of place in this sense just by its name but it's coming from a random registry so what we",
    "start": "1766990",
    "end": "1774100"
  },
  {
    "start": "1773000",
    "end": "1833000"
  },
  {
    "text": "want to do is copy this if you're following along copy this in your buffer this is a stackdriver filter and then",
    "start": "1774100",
    "end": "1782799"
  },
  {
    "text": "we're going to open this link in a new tab now I have already in incognito you might need to do in incognito if you",
    "start": "1782799",
    "end": "1789429"
  },
  {
    "text": "want to remove this over here and kill the show now go to the right hand side",
    "start": "1789429",
    "end": "1794529"
  },
  {
    "text": "convert to advanced filter select all replace and this is going to look at the",
    "start": "1794529",
    "end": "1802230"
  },
  {
    "text": "kubernetes cluster logs so our backlogs and looking for permission for",
    "start": "1802230",
    "end": "1808419"
  },
  {
    "text": "deployments create in the last hour okay so there were two as you saw I'd created",
    "start": "1808419",
    "end": "1813730"
  },
  {
    "text": "it and the deleted it created and deleted it so what I wanted to look at was who created this this the prod",
    "start": "1813730",
    "end": "1821950"
  },
  {
    "text": "default service account in the prod namespace that's kind of weird a service account created this them that's not a",
    "start": "1821950",
    "end": "1827710"
  },
  {
    "text": "human it didn't say my name at it said a service account so I want to sort of see",
    "start": "1827710",
    "end": "1836529"
  },
  {
    "start": "1833000",
    "end": "1868000"
  },
  {
    "text": "okay tell me all the deployments our pods that are running with the default service account in the prod namespace",
    "start": "1836529",
    "end": "1842309"
  },
  {
    "text": "now this is a one-liner you can parse later but basically it's JSON path and",
    "start": "1842309",
    "end": "1847720"
  },
  {
    "text": "we're looping through looking for the service account name default listed and it's the service account name a lot of",
    "start": "1847720",
    "end": "1853269"
  },
  {
    "text": "these commands are very dense and we're not gonna explain every single thing but the and is this website is public if you",
    "start": "1853269",
    "end": "1858700"
  },
  {
    "text": "want to go run these at home most of these are fairly safe to play with just do it on a test cluster please so we can",
    "start": "1858700",
    "end": "1865150"
  },
  {
    "text": "see Bitcoin arrow did show up here it is running as default okay that looks weird",
    "start": "1865150",
    "end": "1873419"
  },
  {
    "start": "1868000",
    "end": "1923000"
  },
  {
    "text": "okay four minutes ago so that was recent somebody just attacked us didn't they we don't really know though for sure so",
    "start": "1875400",
    "end": "1882250"
  },
  {
    "text": "let's go ahead and get rid of this now they're telling me that bitcoin arrow",
    "start": "1882250",
    "end": "1889390"
  },
  {
    "text": "they haven't so I texted the developers they have no idea what bitcoin arrow a so I'm gonna go ahead and delete that",
    "start": "1889390",
    "end": "1894399"
  },
  {
    "text": "deployment nobodies are probably gonna fess up to it either and that's probably another problem here now the other thing",
    "start": "1894399",
    "end": "1900700"
  },
  {
    "text": "wait they said that they left a dashboard node port service on fraud",
    "start": "1900700",
    "end": "1906510"
  },
  {
    "text": "okay so we'll delete that too that's",
    "start": "1906510",
    "end": "1913059"
  },
  {
    "text": "kind of weird why would they let external access to a dashboard directly in the cluster that kind of seems",
    "start": "1913059",
    "end": "1919090"
  },
  {
    "text": "suspicious but we'll get rid of that now I don't know who did this I don't have a",
    "start": "1919090",
    "end": "1926470"
  },
  {
    "start": "1923000",
    "end": "1968000"
  },
  {
    "text": "lot of visibility of exactly what happened I can see the surface account when it happened where it came from but",
    "start": "1926470",
    "end": "1932770"
  },
  {
    "text": "actually physically which person or user did this so what I'm gonna do is run a",
    "start": "1932770",
    "end": "1938200"
  },
  {
    "text": "deployment that we have that is a Falco installation anybody who's running Falco in their own clusters anybody you've",
    "start": "1938200",
    "end": "1945370"
  },
  {
    "text": "heard of Falco but is not yet running Falco well if you have cloud shell today you will be running Falco for the first",
    "start": "1945370",
    "end": "1950799"
  },
  {
    "text": "time what we have packaged for you or a lovely prominent blogger is packaged for you is what we affectionately like to",
    "start": "1950799",
    "end": "1957580"
  },
  {
    "text": "call coop control apply security MO and",
    "start": "1957580",
    "end": "1962730"
  },
  {
    "text": "security is now installed give yourselves a round of applause Hey",
    "start": "1962730",
    "end": "1968610"
  },
  {
    "start": "1968000",
    "end": "1993000"
  },
  {
    "text": "so being a good sis at min and now that it's getting like 3 a.m. in my and my brain here I'm just gonna check the logs",
    "start": "1970470",
    "end": "1977380"
  },
  {
    "text": "and this is getting the pods name and then using that name because it's dynamic and then piping it through logs",
    "start": "1977380",
    "end": "1983490"
  },
  {
    "text": "looks good everything looks happy it's got loading some rules I do briefly want",
    "start": "1983490",
    "end": "1989890"
  },
  {
    "text": "to show you what the rules look like actually take that back now that that's logging to the Container",
    "start": "1989890",
    "end": "1995710"
  },
  {
    "text": "logs we want to also see that in stackdriver so we're going to copy that here we're back on the advanced filter",
    "start": "1995710",
    "end": "2001580"
  },
  {
    "text": "so by now it takes about one second or two depending every time standard out hits for Falco it takes about one or two",
    "start": "2001580",
    "end": "2007679"
  },
  {
    "text": "seconds it gets over to stackdriver so everything that's running cout control logs those logs get sent to stackdriver",
    "start": "2007679",
    "end": "2012929"
  },
  {
    "text": "if you have the right filter submit the filter wow it looks good looks like we're getting some stuff right security",
    "start": "2012929",
    "end": "2019740"
  },
  {
    "text": "is happening we are ready to go everything is happy and I'm gonna run",
    "start": "2019740",
    "end": "2025890"
  },
  {
    "start": "2023000",
    "end": "2063000"
  },
  {
    "text": "one more command here for you this is the Falco rules we combine we",
    "start": "2025890",
    "end": "2031080"
  },
  {
    "text": "concatenated a few the config map rules into one line or sorry one manifest and",
    "start": "2031080",
    "end": "2036600"
  },
  {
    "text": "I just want to grep through the rules for you because this is important for what you're going to be doing later things like privilege containers",
    "start": "2036600",
    "end": "2043559"
  },
  {
    "text": "sensitive mounts and disallowed containers bash history and those kinds of things are present so with that I'm",
    "start": "2043559",
    "end": "2050850"
  },
  {
    "text": "going to you know say that that's good I'm going to go to sleep and everything is fine that's what I'm gonna trust",
    "start": "2050850",
    "end": "2057419"
  },
  {
    "text": "right okay now I'm gonna hand it over to Tammy thank you alright I'm glad he",
    "start": "2057419",
    "end": "2067648"
  },
  {
    "start": "2063000",
    "end": "2093000"
  },
  {
    "text": "thinks it's all fine because I'm dark red I'm a skilled and experienced criminal attacker and my associate red",
    "start": "2067649",
    "end": "2074608"
  },
  {
    "text": "has contacted me because they needed some help about a week ago they popped a box and they put some some",
    "start": "2074609",
    "end": "2081600"
  },
  {
    "text": "cryptocurrency miners on it and they were mining away but they got themselves caught they got themselves kicked out",
    "start": "2081600",
    "end": "2086608"
  },
  {
    "text": "and they're pretty sad about that so they tell me hey can you can you help out I'll make it worth your while if you",
    "start": "2086609",
    "end": "2092190"
  },
  {
    "text": "can get me back into this cluster and get my miners running again so I'm going",
    "start": "2092190",
    "end": "2097859"
  },
  {
    "text": "to go back and review my notes over here on mine machine clear out the screen and review",
    "start": "2097859",
    "end": "2107549"
  },
  {
    "text": "the notes that I took from when I was looking at my associates my associates email so they passed along the IP",
    "start": "2107549",
    "end": "2114630"
  },
  {
    "text": "address you can see mine here on the screen yours will appear on your screen and so I did some did some",
    "start": "2114630",
    "end": "2119910"
  },
  {
    "text": "reconnaissance on it did some studying on it found a fountain found something",
    "start": "2119910",
    "end": "2125190"
  },
  {
    "text": "that was found something that was vulnerable so to get an idea of a little bit of what that looked like we'll do a",
    "start": "2125190",
    "end": "2133470"
  },
  {
    "text": "quick port scan on this on this IP address and we'll see it looks like within this range of a hundred ports",
    "start": "2133470",
    "end": "2139710"
  },
  {
    "text": "anyway it's got three services running this end map command here this st means",
    "start": "2139710",
    "end": "2145589"
  },
  {
    "text": "do a normal TCP connection and the a means do a lot of things to enumerate so",
    "start": "2145589",
    "end": "2151680"
  },
  {
    "text": "we see it looks like three web applications to of cats versus dogs which I happen to know is that company's",
    "start": "2151680",
    "end": "2158339"
  },
  {
    "text": "production web applicant rested in this one here that says dashboard because it",
    "start": "2158339",
    "end": "2165150"
  },
  {
    "text": "seems to me that if it's a dashboard a it's probably kind of neglected not taken care of not monitored closely the",
    "start": "2165150",
    "end": "2172349"
  },
  {
    "text": "way the production application is and be it may have some kind of heightened access into something in the environment",
    "start": "2172349",
    "end": "2178950"
  },
  {
    "text": "into kubernetes or into some kind of automation framework in order to be able",
    "start": "2178950",
    "end": "2184170"
  },
  {
    "text": "to do its dashboard a job so you can open up these web applications in your browser cruise around in them if you",
    "start": "2184170",
    "end": "2189930"
  },
  {
    "text": "want to a little bit but back earlier I found this dashboard application used",
    "start": "2189930",
    "end": "2196049"
  },
  {
    "text": "some web application and tools on it found that it was based on a server side",
    "start": "2196049",
    "end": "2201390"
  },
  {
    "text": "the template that had some remote code execution vulnerability and it wrote a exploit for that vulnerability shelled",
    "start": "2201390",
    "end": "2208859"
  },
  {
    "text": "the server and installed a web show just because it's a lot more convenient to log into a web show so we'll go now and",
    "start": "2208859",
    "end": "2216599"
  },
  {
    "text": "we will log into this web show that I have left for myself",
    "start": "2216599",
    "end": "2221930"
  },
  {
    "text": "I'm right so here I am and whenever I catch a show on something that I haven't",
    "start": "2242260",
    "end": "2248080"
  },
  {
    "start": "2248000",
    "end": "2308000"
  },
  {
    "text": "been on before you know there's a whole series of enumeration commands that I like to that I like to run just to get a",
    "start": "2248080",
    "end": "2254920"
  },
  {
    "text": "little bit of a feeling for where we are so I'll go into my notes grab those paste them in and review the output so",
    "start": "2254920",
    "end": "2260980"
  },
  {
    "text": "it looks like I'm running as a user dashboard it's a little disappointing I would rather be rude but that's what",
    "start": "2260980",
    "end": "2266040"
  },
  {
    "text": "privilege escalation exploits were made for I noticed that the distribution says",
    "start": "2266040",
    "end": "2271450"
  },
  {
    "text": "it's a bun too but a bun too doesn't appear in the kernel build string that's a little suspicious if this were a normal a bunting machine the bun too",
    "start": "2271450",
    "end": "2278320"
  },
  {
    "text": "would also appear in the kernel build string and psdf is showing four processes so certainly this is a",
    "start": "2278320",
    "end": "2285490"
  },
  {
    "text": "container because I can't imagine a VM that a VM or a physical machine that was only running four processes and I see",
    "start": "2285490",
    "end": "2292690"
  },
  {
    "text": "we've got some kubernetes environment variables all of that matches up with what my associate read reported the",
    "start": "2292690",
    "end": "2298150"
  },
  {
    "text": "problem they were having so I feel like we're in the right place but a little worried that there's not a lot we can do",
    "start": "2298150",
    "end": "2303910"
  },
  {
    "text": "in here so we'll do a little bit more of poking around if it's kubernetes and I'm",
    "start": "2303910",
    "end": "2310600"
  },
  {
    "start": "2308000",
    "end": "2358000"
  },
  {
    "text": "lucky then maybe the surface account that is mounted into this container will",
    "start": "2310600",
    "end": "2315880"
  },
  {
    "text": "have some access on its own you don't always get lucky but never discount the possibility of getting lucky always got",
    "start": "2315880",
    "end": "2321670"
  },
  {
    "text": "a check so you know like what a lot of attackers would do I'll curl down a by an area and run it so I'm gonna run coop",
    "start": "2321670",
    "end": "2328780"
  },
  {
    "text": "CTL get pods I see some pots so this is a good thing because it tells me that I have some level of kubernetes access but",
    "start": "2328780",
    "end": "2335650"
  },
  {
    "text": "when I run get pods all namespaces I get clapped for that so that means I'm at",
    "start": "2335650",
    "end": "2342040"
  },
  {
    "text": "least not global admin but when I run the coop CTL get coop CTL off can i list",
    "start": "2342040",
    "end": "2348369"
  },
  {
    "text": "there's a lot of stuff in here so that makes me feel pretty good like probably I am a namespace admin I would rather be",
    "start": "2348369",
    "end": "2355690"
  },
  {
    "text": "cluster admin but with namespace admin at least I should be able to deploy something so brief little aside to talk",
    "start": "2355690",
    "end": "2363400"
  },
  {
    "start": "2358000",
    "end": "2518000"
  },
  {
    "text": "about InfoSec twitter there's a lot of jokes there's a lot of a lot of silly things on InfoSec twitter but also",
    "start": "2363400",
    "end": "2370060"
  },
  {
    "text": "there's a lot of there's a lot of neat tech tips so I found a great one here on",
    "start": "2370060",
    "end": "2375430"
  },
  {
    "text": "too and I'm just gonna paste this right in here and we'll look at it a bit before we run it so this is a coupe CTL run",
    "start": "2375430",
    "end": "2382270"
  },
  {
    "text": "command like what we'd often have but notice that it only specifies a couple of things and then has a giant stack of",
    "start": "2382270",
    "end": "2388090"
  },
  {
    "text": "overrides and we'll talk about the one or two most important bits of this override the first one is right here",
    "start": "2388090",
    "end": "2394930"
  },
  {
    "text": "house pid' true so normally one of the most important isolations that you expect from a",
    "start": "2394930",
    "end": "2400450"
  },
  {
    "text": "container is that your kid namespace is not the host speed namespace so you can",
    "start": "2400450",
    "end": "2406750"
  },
  {
    "text": "only see the few pins that are running inside your container and that's really why we want to think that it's contained",
    "start": "2406750",
    "end": "2414010"
  },
  {
    "text": "but when we pass House bid true in here this container is going to be run in the host namespace so technically speaking",
    "start": "2414010",
    "end": "2420580"
  },
  {
    "text": "it's a container but it's a container that doesn't really have walls on the",
    "start": "2420580",
    "end": "2425710"
  },
  {
    "text": "sides of it once we're in the host namespace that means when we look at proc with a number we're looking at all",
    "start": "2425710",
    "end": "2432700"
  },
  {
    "text": "of the PIDs on the system so normally we would run a command like bash or or SH",
    "start": "2432700",
    "end": "2438340"
  },
  {
    "text": "but instead we're going to run this command NS enter and that is a low-level shell interface to the Linux kernel name",
    "start": "2438340",
    "end": "2445150"
  },
  {
    "text": "space subsystem and with this - - mount argument we're saying we want to switch to a different mount namespace which",
    "start": "2445150",
    "end": "2452350"
  },
  {
    "text": "means a different route of which files we can see so it's it feels like schroot",
    "start": "2452350",
    "end": "2458080"
  },
  {
    "text": "but it's much more fundamental and powerful than shrute so we're gonna move into a different one because the",
    "start": "2458080",
    "end": "2464110"
  },
  {
    "text": "container runtime puts us in our own private one that doesn't have anything cool but we want to get everything cool so what amount name space are we gonna",
    "start": "2464110",
    "end": "2470950"
  },
  {
    "text": "move into we're gonna move into the same mount namespaces in it is in because that's guaranteed to be a process that",
    "start": "2470950",
    "end": "2477460"
  },
  {
    "text": "exists and we know that it's the main one of the system so by running this NS enter with - - mount then we can switch",
    "start": "2477460",
    "end": "2484210"
  },
  {
    "text": "into the host mount namespace so now if we started with a container with four walls and if we took two of them off",
    "start": "2484210",
    "end": "2490720"
  },
  {
    "text": "with host pit we just took the other two walls off with NS enter so technically speaking we're going to be in a",
    "start": "2490720",
    "end": "2496360"
  },
  {
    "text": "container but it's a container that doesn't contain anything isn't is really just the host and once we've taken all",
    "start": "2496360",
    "end": "2502210"
  },
  {
    "text": "the walls off our container then we're gonna run bash so we'll hit enter on this it's going to run a pod",
    "start": "2502210",
    "end": "2508920"
  },
  {
    "text": "and here it is it says right so I don't really know I just typed that so maybe",
    "start": "2508920",
    "end": "2515100"
  },
  {
    "text": "it's lying but we can use some of these same enumeration commands that we would usually use in order to explore what's",
    "start": "2515100",
    "end": "2524160"
  },
  {
    "start": "2518000",
    "end": "2568000"
  },
  {
    "text": "in our shell now so a lot of stuff so there's a good sign we'll scroll up here to the top which is",
    "start": "2524160",
    "end": "2530250"
  },
  {
    "text": "going to take awhile and we see who are we root now that's that's that's more like what I wanted to see now we see a",
    "start": "2530250",
    "end": "2537240"
  },
  {
    "text": "lot of release information something something chromos so that's not the same as the abun - that was talking about",
    "start": "2537240",
    "end": "2543390"
  },
  {
    "text": "before and PS - yep we've got hundreds of processes this is what I expect from",
    "start": "2543390",
    "end": "2548970"
  },
  {
    "text": "a VM we we're inside the host now we just broke out of the container and routed the host let's take a minute and",
    "start": "2548970",
    "end": "2555450"
  },
  {
    "text": "appreciate that raise your hand if this is the first time you've ever broken out of a container or popped a root shell",
    "start": "2555450",
    "end": "2563510"
  },
  {
    "text": "congratulations to all of you alright so now that we're rude on the host now we",
    "start": "2563510",
    "end": "2569250"
  },
  {
    "start": "2568000",
    "end": "2643000"
  },
  {
    "text": "can start to do something fun so you know red had this Bitcoin arrow minor",
    "start": "2569250",
    "end": "2574770"
  },
  {
    "text": "packaged up as a container because containers make running and deploying your applications easy and you know",
    "start": "2574770",
    "end": "2581730"
  },
  {
    "text": "that's that's fine and dandy but they did it a little too easy because I think they probably just deployed it through",
    "start": "2581730",
    "end": "2588090"
  },
  {
    "text": "kubernetes and then of kubernetes admin saw it and deleted it well I know that",
    "start": "2588090",
    "end": "2593190"
  },
  {
    "text": "usually kubernetes admins don't want to go SSH into their nodes that's what they",
    "start": "2593190",
    "end": "2598980"
  },
  {
    "text": "have kubernetes for so if we have access to docker and we do because we root on",
    "start": "2598980",
    "end": "2605790"
  },
  {
    "text": "the host we can just run a container right here that's gonna be a container",
    "start": "2605790",
    "end": "2610830"
  },
  {
    "text": "and it's going to be running but it's not gonna be under the management of kubernetes so we'll put a docker run in",
    "start": "2610830",
    "end": "2617460"
  },
  {
    "text": "here whole biome and let's look and see",
    "start": "2617460",
    "end": "2622880"
  },
  {
    "text": "make sure it's running that's a lot of stuff that's too much stuff",
    "start": "2622880",
    "end": "2629359"
  },
  {
    "text": "all right so we've got our miner running now but it's not running in kubernetes",
    "start": "2630540",
    "end": "2635970"
  },
  {
    "text": "it's just running in docker on the host so hopefully that'll make it a little less likely that the SIS admin's are",
    "start": "2635970",
    "end": "2642150"
  },
  {
    "text": "gonna notice us so we could just quit now because we fulfilled our end of the promise but this has been a lot of work",
    "start": "2642150",
    "end": "2648330"
  },
  {
    "text": "for nothing but a few cryptocurrency coins that let's face it they're gonna crash in a week or so and not be worth",
    "start": "2648330",
    "end": "2653880"
  },
  {
    "text": "anything anyway so let's see if we can do something else I want to get some",
    "start": "2653880",
    "end": "2659310"
  },
  {
    "text": "better kubernetes creds I'm a namespace admin and I'm root on the host but I would really also like to be cluster",
    "start": "2659310",
    "end": "2665220"
  },
  {
    "text": "admin so one place that we can get some creds is from the couplet cool it runs",
    "start": "2665220",
    "end": "2671040"
  },
  {
    "text": "on the runs on the node it needs to authenticate to the API server so if we look here it's got a coop config file on",
    "start": "2671040",
    "end": "2678690"
  },
  {
    "text": "that coop config files got creds associated with it so using the - - coop",
    "start": "2678690",
    "end": "2683970"
  },
  {
    "text": "config option - coop CTL let's try connecting to kubernetes as if we were the couplet and see what we can",
    "start": "2683970",
    "end": "2690360"
  },
  {
    "text": "do can I create a potty in coop system I like the look of that so maybe this is",
    "start": "2690360",
    "end": "2696930"
  },
  {
    "text": "gonna help us out let's try and actually run a pod in coop system using the",
    "start": "2696930",
    "end": "2702870"
  },
  {
    "text": "couplets creds so we got - - coop config with the path to the couplets coop",
    "start": "2702870",
    "end": "2708930"
  },
  {
    "text": "config and we're just gonna run a busybox image no and part of the reason",
    "start": "2708930",
    "end": "2716580"
  },
  {
    "text": "for this is if this had been poorly configured the couplet might have been cluster admin and we would have just won",
    "start": "2716580",
    "end": "2722040"
  },
  {
    "text": "the game but in this particular instance because it is a gke cluster the couplet",
    "start": "2722040",
    "end": "2727470"
  },
  {
    "text": "can create pods but it can only create mirror pods which are like fake metadata only pods that represent the existence",
    "start": "2727470",
    "end": "2734220"
  },
  {
    "text": "of static pods it's a neat thing go read about it if you haven't because it's lovely but but I'm not really happy",
    "start": "2734220",
    "end": "2740910"
  },
  {
    "text": "because I wanted to become cluster admin and I'm not so are there any other creds that we can steal well we're root on the",
    "start": "2740910",
    "end": "2747360"
  },
  {
    "text": "host so if you've ever looked at the mount table on a docker host you see",
    "start": "2747360",
    "end": "2753420"
  },
  {
    "text": "that it's crazy because every one of your containers has many things mounted",
    "start": "2753420",
    "end": "2758640"
  },
  {
    "text": "into it in order to build up the union file systems so one of the things that we'll see in there is",
    "start": "2758640",
    "end": "2767220"
  },
  {
    "text": "secrets secret is not a command but grep is a command that you can use to find",
    "start": "2767220",
    "end": "2773050"
  },
  {
    "text": "only the secrets so naively we could go through all of these files and copy out",
    "start": "2773050",
    "end": "2779020"
  },
  {
    "text": "the secrets and try them and you know when I was just a beginning hacker that's the sort of thing that I would do",
    "start": "2779020",
    "end": "2784780"
  },
  {
    "text": "but since I do this professionally I'll go into my notes and I'll get this handy UNIX one-liner that is going to search",
    "start": "2784780",
    "end": "2790810"
  },
  {
    "text": "for the Kubb system default token snag it automatically and stick it into an environment variable for me and there it",
    "start": "2790810",
    "end": "2799210"
  },
  {
    "text": "is I'll probably want to copy this for later so let's see if this does us any",
    "start": "2799210",
    "end": "2805810"
  },
  {
    "text": "good so we can use the - - token option on cube CTL to authenticate using this",
    "start": "2805810",
    "end": "2811540"
  },
  {
    "text": "token that we have stuffed into an environment variable and let's see can I get all secrets because if I can get all",
    "start": "2811540",
    "end": "2818320"
  },
  {
    "text": "secrets I have a good feeling that I can do whatever I want can I do whatever I want yeah so I can",
    "start": "2818320",
    "end": "2830020"
  },
  {
    "text": "do whatever I want and that's great but most of the time folks are smart enough not to keep their API server on the",
    "start": "2830020",
    "end": "2836530"
  },
  {
    "text": "Internet but right now I can access it because I'm inside the cluster I'm inside this host that's in the cluster but I'm",
    "start": "2836530",
    "end": "2843970"
  },
  {
    "text": "feeling a little worried I want to get logged out of this web shell and disappear soon because the longer I'm in",
    "start": "2843970",
    "end": "2849910"
  },
  {
    "text": "here the more logs I'm going to leave I don't get myself busted so I want to be able to log into this thing over the",
    "start": "2849910",
    "end": "2855820"
  },
  {
    "text": "internet like through tour through VPN through some other server that I've already that I've already taken",
    "start": "2855820",
    "end": "2861880"
  },
  {
    "text": "advantage of so I want to help myself by putting the API server on the Internet",
    "start": "2861880",
    "end": "2867580"
  },
  {
    "text": "and I can do this by creating a service with a static endpoint that points to",
    "start": "2867580",
    "end": "2873250"
  },
  {
    "text": "the IP address of the API server fortunately professional hacker I've got",
    "start": "2873250",
    "end": "2879610"
  },
  {
    "text": "the notes all right here in my notebook so I'll just paste that in and sto",
    "start": "2879610",
    "end": "2885880"
  },
  {
    "text": "management I don't know if they're running sto but the hope is assisted mens looking at it and their eyes are",
    "start": "2885880",
    "end": "2891250"
  },
  {
    "text": "just going to glaze right over misty oh that's normal",
    "start": "2891250",
    "end": "2896190"
  },
  {
    "text": "so I've been a little busy that's that's a thing that I probably should have done and you'll find out later I really wish",
    "start": "2904120",
    "end": "2911660"
  },
  {
    "text": "I would have so now that we've got now that we've got this token and we've got",
    "start": "2911660",
    "end": "2917600"
  },
  {
    "text": "the API server exposed on the internet I want to copy this token copy it over put",
    "start": "2917600",
    "end": "2923660"
  },
  {
    "text": "it in my Linux VM and verify that I actually have the internet-based connectivity that I think I do stuff my",
    "start": "2923660",
    "end": "2934010"
  },
  {
    "text": "token into an environment variable and this one-liner is just a fancy wrapper",
    "start": "2934010",
    "end": "2939830"
  },
  {
    "text": "around koop CTL to make it a little easier on what happens if you don't have the environment variable to find but",
    "start": "2939830",
    "end": "2946310"
  },
  {
    "text": "ultimately it comes down to coop CTL - - token with the external IP in there get",
    "start": "2946310",
    "end": "2951440"
  },
  {
    "text": "pods and so there we go I'm in I'm going",
    "start": "2951440",
    "end": "2961610"
  },
  {
    "text": "to be able to stay in and they don't even know I'm here all all in a day's",
    "start": "2961610",
    "end": "2966860"
  },
  {
    "text": "work for an elite hacker like me",
    "start": "2966860",
    "end": "2972070"
  },
  {
    "text": "alright alright so I am blue as well yes",
    "start": "2980240",
    "end": "2993150"
  },
  {
    "start": "2988000",
    "end": "3068000"
  },
  {
    "text": "I shrunk and got younger but lost some hair I'm still overworked and I'm still",
    "start": "2993150",
    "end": "3003620"
  },
  {
    "text": "getting paged at 3 a.m. same message",
    "start": "3003620",
    "end": "3009370"
  },
  {
    "text": "website is too slow so I'm not quite sure why it's slow again I just took",
    "start": "3009370",
    "end": "3016040"
  },
  {
    "text": "care of this last time so I'm gonna start by running some basic checks",
    "start": "3016040",
    "end": "3024580"
  },
  {
    "text": "let's get pods see if see if there is",
    "start": "3026720",
    "end": "3032260"
  },
  {
    "text": "Bitcoin arrow like last time nope I don't see that well website is",
    "start": "3032260",
    "end": "3040490"
  },
  {
    "text": "slow let's see if any existing let's see",
    "start": "3040490",
    "end": "3045770"
  },
  {
    "text": "how is the resource consumption on our node that looks normal how about the resource consumption of",
    "start": "3045770",
    "end": "3056690"
  },
  {
    "text": "all the pots let's take a look breakdown by pods",
    "start": "3056690",
    "end": "3061360"
  },
  {
    "text": "Falco's a little high but I don't think that would be causing a problem that's",
    "start": "3061750",
    "end": "3067220"
  },
  {
    "text": "odd so what's what's going on we installed Falco last time and it",
    "start": "3067220",
    "end": "3073580"
  },
  {
    "start": "3068000",
    "end": "3158000"
  },
  {
    "text": "looks like we're getting some alerts from Falco so let's go ahead and copy this query and OpenStack driver and take",
    "start": "3073580",
    "end": "3080510"
  },
  {
    "text": "a look what kind of logs what kind of loot siz Falco giving us",
    "start": "3080510",
    "end": "3085580"
  },
  {
    "text": "convert to click on the arrow and the right of the field a search field here",
    "start": "3085580",
    "end": "3091730"
  },
  {
    "text": "convert to advanced because we're all advanced ops people and run Oh",
    "start": "3091730",
    "end": "3100180"
  },
  {
    "text": "interesting we're getting privileged container alerts",
    "start": "3100180",
    "end": "3106410"
  },
  {
    "text": "shell alerts let's take a look here what's going on in JSON payload I see a",
    "start": "3106410",
    "end": "3113160"
  },
  {
    "text": "notice privileged container started under output fields looks like I see a",
    "start": "3113160",
    "end": "3118940"
  },
  {
    "text": "container ID and an image repository interesting it's a privileged pod hmm I",
    "start": "3118940",
    "end": "3127109"
  },
  {
    "text": "don't think that should be happening but something happened earlier to or later",
    "start": "3127109",
    "end": "3136130"
  },
  {
    "text": "let's see here yep same thing output Alpine that's interesting yeah and all",
    "start": "3136130",
    "end": "3147690"
  },
  {
    "text": "right so we're we're seeing some alerts here from Falco but no more information",
    "start": "3147690",
    "end": "3154200"
  },
  {
    "text": "namespaces blank pod is blank so I'm curious if our",
    "start": "3154200",
    "end": "3161730"
  },
  {
    "start": "3158000",
    "end": "3228000"
  },
  {
    "text": "kubernetes logs can give us some additional information based on what we know so far which is just a random",
    "start": "3161730",
    "end": "3168660"
  },
  {
    "text": "alpine container that is running so let's copy that query OpenStack driver",
    "start": "3168660",
    "end": "3175279"
  },
  {
    "text": "switch to advanced and in our kubernetes",
    "start": "3175279",
    "end": "3184710"
  },
  {
    "text": "cluster logs searching for container image alpine looks like yeah that's",
    "start": "3184710",
    "end": "3191130"
  },
  {
    "text": "interesting something got created something got",
    "start": "3191130",
    "end": "3196859"
  },
  {
    "text": "looks like yep a there is a request to",
    "start": "3196859",
    "end": "3202680"
  },
  {
    "text": "create the request was authorized by a",
    "start": "3202680",
    "end": "3207799"
  },
  {
    "text": "service account in the dev default namespace a pod got created that's",
    "start": "3207799",
    "end": "3215730"
  },
  {
    "text": "that's interesting oh that's that's not looking good",
    "start": "3215730",
    "end": "3220920"
  },
  {
    "text": "actually hmm yeah so I I saw that this pod got",
    "start": "3220920",
    "end": "3231660"
  },
  {
    "text": "created but I really want to see what is going on inside this pod so I'm gonna",
    "start": "3231660",
    "end": "3236670"
  },
  {
    "text": "copy that query and I'll go back to one of my existing cloud shell windows",
    "start": "3236670",
    "end": "3241920"
  },
  {
    "text": "pasted this query and run it see what's happening what's in oh oh wow so we're",
    "start": "3241920",
    "end": "3252450"
  },
  {
    "text": "actually capturing that looks like someone is on someone is in this pod",
    "start": "3252450",
    "end": "3257700"
  },
  {
    "text": "running commands this is very odd and",
    "start": "3257700",
    "end": "3263130"
  },
  {
    "text": "I'm starting to get worried what are we seeing here there's a bunch of mounts or",
    "start": "3263130",
    "end": "3271080"
  },
  {
    "text": "it looks like someone is running commands on that's interesting these are route mount secret that's not looking",
    "start": "3271080",
    "end": "3282450"
  },
  {
    "text": "like something in a pod did they get the",
    "start": "3282450",
    "end": "3288450"
  },
  {
    "text": "oh looks like oh they are on they they",
    "start": "3288450",
    "end": "3294810"
  },
  {
    "text": "found honest they escaped the pod the container and they're on the node and",
    "start": "3294810",
    "end": "3300800"
  },
  {
    "text": "something here about they're creating a",
    "start": "3300800",
    "end": "3306180"
  },
  {
    "text": "service and endpoints let me see if",
    "start": "3306180",
    "end": "3311760"
  },
  {
    "text": "actually if I can see that on on my",
    "start": "3311760",
    "end": "3317060"
  },
  {
    "text": "cloud shell here why is the token making",
    "start": "3317060",
    "end": "3324870"
  },
  {
    "text": "it into the logs so all the TTY all the",
    "start": "3324870",
    "end": "3333750"
  },
  {
    "text": "standard in and standard out that the attacker was doing in the pod in the",
    "start": "3333750",
    "end": "3339860"
  },
  {
    "text": "container was actually being captured by",
    "start": "3339860",
    "end": "3344030"
  },
  {
    "text": "no right so yeah I'm seeing an sto",
    "start": "3344870",
    "end": "3357680"
  },
  {
    "text": "Management Service and endpoint that must be one sneaky hacker trying to get",
    "start": "3357680",
    "end": "3364830"
  },
  {
    "text": "back into this cluster but jokes on them we're not using service mesh I am gonna",
    "start": "3364830",
    "end": "3375000"
  },
  {
    "text": "go ahead and delete the service all right yep all right hmm but I really",
    "start": "3375000",
    "end": "3390270"
  },
  {
    "text": "want to know how did they get in there in the first place",
    "start": "3390270",
    "end": "3395150"
  },
  {
    "text": "I remember seeing a create event that was authorized by a dev default service",
    "start": "3395340",
    "end": "3404640"
  },
  {
    "text": "account so something in that namespace is let me take a look at that namespace",
    "start": "3404640",
    "end": "3412560"
  },
  {
    "text": "what are the pods there's an app there's a database a dashboard dashboard don't",
    "start": "3412560",
    "end": "3419970"
  },
  {
    "text": "tell me we have an exposed dashboard let me take a look at the logs",
    "start": "3419970",
    "end": "3428780"
  },
  {
    "text": "alright let me go ahead and completion",
    "start": "3440369",
    "end": "3445660"
  },
  {
    "text": "vanish yeah completion okay I'll just copy this see",
    "start": "3445660",
    "end": "3458920"
  },
  {
    "text": "what's what's going on in here and obviously uh what really coach uh just",
    "start": "3458920",
    "end": "3471420"
  },
  {
    "text": "hmm did something happen",
    "start": "3471420",
    "end": "3478890"
  },
  {
    "text": "hmm oh it went down for for a little bit",
    "start": "3486820",
    "end": "3498210"
  },
  {
    "text": "all right",
    "start": "3498210",
    "end": "3501270"
  },
  {
    "text": "hmm",
    "start": "3511429",
    "end": "3514429"
  },
  {
    "text": "sure sure",
    "start": "3519470",
    "end": "3522430"
  },
  {
    "text": "aha",
    "start": "3545619",
    "end": "3548619"
  },
  {
    "text": "[Laughter]",
    "start": "3559190",
    "end": "3562500"
  },
  {
    "text": "all right I'm just gonna take a look",
    "start": "3572420",
    "end": "3579359"
  },
  {
    "text": "here be back in like two minutes",
    "start": "3579359",
    "end": "3593759"
  },
  {
    "text": "thanks to it sure",
    "start": "3593759",
    "end": "3596900"
  },
  {
    "text": "does anyone know some good jokes yeah",
    "start": "3622000",
    "end": "3630710"
  },
  {
    "text": "yes please",
    "start": "3630710",
    "end": "3633640"
  },
  {
    "text": "the joke was I can tell you a UDP joke but you wouldn't get it sorry what was",
    "start": "3643160",
    "end": "3649580"
  },
  {
    "text": "the question",
    "start": "3649580",
    "end": "3651730"
  },
  {
    "text": "you see he doesn't hear repeat the question I'll have to think about that I'm gonna hit us up after here's the",
    "start": "3679140",
    "end": "3685779"
  },
  {
    "text": "faster we talk yeah try it again all",
    "start": "3685779",
    "end": "3693669"
  },
  {
    "text": "right we're back all right sorry about",
    "start": "3693669",
    "end": "3700509"
  },
  {
    "text": "that so I took a look in the dev namespace",
    "start": "3700509",
    "end": "3709259"
  },
  {
    "text": "found pods that I was expecting to see but dashboard looked interesting cuz i'm",
    "start": "3709259",
    "end": "3715689"
  },
  {
    "text": "i've read some headlines of some companies getting popped for exposed",
    "start": "3715689",
    "end": "3721449"
  },
  {
    "text": "dashboards so i just want to make sure that i want to find out if that's happening here",
    "start": "3721449",
    "end": "3727479"
  },
  {
    "text": "so this dashboard container does not have anything but we have an off proxy",
    "start": "3727479",
    "end": "3735189"
  },
  {
    "text": "container in here looks like oh yeah",
    "start": "3735189",
    "end": "3741279"
  },
  {
    "text": "that is how they got in I'm seeing get web show activity in this container with",
    "start": "3741279",
    "end": "3748299"
  },
  {
    "text": "this IP address hmm so let's and since",
    "start": "3748299",
    "end": "3760599"
  },
  {
    "text": "they use this service account the the dev default token what I want to do",
    "start": "3760599",
    "end": "3767949"
  },
  {
    "text": "right away is revoke that token and I",
    "start": "3767949",
    "end": "3775140"
  },
  {
    "text": "might want to also consider disabling the automatic mounting of service",
    "start": "3775140",
    "end": "3780939"
  },
  {
    "text": "account tokens if the pod doesn't need it but I want to",
    "start": "3780939",
    "end": "3788049"
  },
  {
    "text": "mitigate this further the attacker was able to elevate their privileges by",
    "start": "3788049",
    "end": "3794249"
  },
  {
    "text": "running a privileged container and I heard a talk at coop con this week OPA",
    "start": "3794249",
    "end": "3800229"
  },
  {
    "text": "gatekeeper can be deployed as a admission controller which should work because an admission",
    "start": "3800229",
    "end": "3806620"
  },
  {
    "text": "controller is just a piece of code that intercepts requests as they flow through",
    "start": "3806620",
    "end": "3811960"
  },
  {
    "text": "the API server after the request has been authenticated and authorized so",
    "start": "3811960",
    "end": "3817750"
  },
  {
    "text": "Appa and a policy could possibly evaluate the request make a decision and",
    "start": "3817750",
    "end": "3823900"
  },
  {
    "text": "allow or deny that request before it gets persisted in @cd so in spirit of",
    "start": "3823900",
    "end": "3832680"
  },
  {
    "text": "installing security I'm going to go ahead and install security in this",
    "start": "3832680",
    "end": "3838870"
  },
  {
    "text": "cluster and the reason why I want to wait a little bit after applying",
    "start": "3838870",
    "end": "3845910"
  },
  {
    "text": "gatekeepers because customer resource definitions take a little bit extra time for the reconciliation loop to take its",
    "start": "3845910",
    "end": "3856150"
  },
  {
    "text": "course and now that we applied the CR D",
    "start": "3856150",
    "end": "3863770"
  },
  {
    "text": "and the policies let's actually test see",
    "start": "3863770",
    "end": "3869500"
  },
  {
    "text": "if I can run this policy actually so I",
    "start": "3869500",
    "end": "3875980"
  },
  {
    "text": "want to show you that the policies",
    "start": "3875980",
    "end": "3882390"
  },
  {
    "text": "there are two policies in here one is going to prevent any privileged",
    "start": "3887440",
    "end": "3894880"
  },
  {
    "text": "container any privileged pod and the other one is going to only whitelist",
    "start": "3894880",
    "end": "3900960"
  },
  {
    "text": "certain repos in certain namespaces so",
    "start": "3900960",
    "end": "3907079"
  },
  {
    "text": "let's see if I can just run an arbitrary container in the dev namespace now oh",
    "start": "3907079",
    "end": "3912299"
  },
  {
    "text": "yeah so this happens because again takes",
    "start": "3912299",
    "end": "3919450"
  },
  {
    "text": "a couple of seconds for the policies to kick in so",
    "start": "3919450",
    "end": "3924900"
  },
  {
    "text": "let's try that again Oh still good CTL",
    "start": "3936040",
    "end": "3943990"
  },
  {
    "text": "[Music] okay pods Oh",
    "start": "3943990",
    "end": "3954300"
  },
  {
    "text": "keeper all right we're doing some live blue ops what is it",
    "start": "3959160",
    "end": "3982740"
  },
  {
    "text": "so what we're gonna do okay yeah there we go so what we're gonna do is what we're troubleshooting this do me a favor",
    "start": "4013349",
    "end": "4020069"
  },
  {
    "text": "and hit the the secure kubernetes website sure okay the the field saying",
    "start": "4020069",
    "end": "4029130"
  },
  {
    "text": "apply it twice if you're following along we're going to do that in a second I want to kick start the bonus in there",
    "start": "4029130",
    "end": "4034199"
  },
  {
    "text": "okay if you refresh you'll see we have",
    "start": "4034199",
    "end": "4042059"
  },
  {
    "text": "some bonus challenges okay and we also also publish the hints we're running a little bit short on time so I want to",
    "start": "4042059",
    "end": "4048119"
  },
  {
    "text": "get you started on that if you want to take advantage of this and if you come",
    "start": "4048119",
    "end": "4053430"
  },
  {
    "text": "up I should say here we go if you get",
    "start": "4053430",
    "end": "4059039"
  },
  {
    "text": "both challenges come up and whisper to us the answers of both challenges and you'll get a fancy sticker okay so there's incentive here to be",
    "start": "4059039",
    "end": "4065729"
  },
  {
    "text": "able to do this by yourself however we will walk through at the very",
    "start": "4065729",
    "end": "4071190"
  },
  {
    "text": "very end here but we're going to do is we're gonna flip back so if you want to get started on that while we see if we can troubleshoot this oppan gatekeeper",
    "start": "4071190",
    "end": "4077819"
  },
  {
    "text": "installation that's what we're gonna do",
    "start": "4077819",
    "end": "4081829"
  },
  {
    "text": "the tutorials will stay up online for any everybody to use the clusters will",
    "start": "4122670",
    "end": "4128770"
  },
  {
    "text": "will not those will be gone very very shortly after the tutorial so for re",
    "start": "4128770",
    "end": "4135730"
  },
  {
    "text": "obvious reasons",
    "start": "4135730",
    "end": "4138630"
  },
  {
    "text": "so the question was is this applicable to all kubernetes clusters like newer",
    "start": "4181889",
    "end": "4189609"
  },
  {
    "text": "versions or does this only apply to this one 1.13 the answer is it applies to all",
    "start": "4189609",
    "end": "4198849"
  },
  {
    "text": "clusters there is nothing specific to this version of kubernetes basically",
    "start": "4198849",
    "end": "4204580"
  },
  {
    "text": "privileged pods service account mounting",
    "start": "4204580",
    "end": "4210690"
  },
  {
    "text": "stuff like that that is just basic kubernetes",
    "start": "4213239",
    "end": "4219030"
  },
  {
    "text": "the environments themselves the clusters will be be done ten minutes after all of",
    "start": "4254190",
    "end": "4262840"
  },
  {
    "text": "the secured Cooper days comm will stay up the git repos will be there we'll be publishing a little more as as we clean",
    "start": "4262840",
    "end": "4270460"
  },
  {
    "text": "up that some of the scripts the manifests but the actual environments if you want to sign up for a gke cluster",
    "start": "4270460",
    "end": "4278320"
  },
  {
    "text": "yourselves there's a $300 credit that goes a long way what's a single node cluster like this and you'll be able to",
    "start": "4278320",
    "end": "4283990"
  },
  {
    "text": "do all these labs in the same way he's going to she's got it all right",
    "start": "4283990",
    "end": "4291390"
  },
  {
    "text": "okay all right and for those who want to see",
    "start": "4296739",
    "end": "4302320"
  },
  {
    "text": "how gate keeper works in action so you have a second apply of the CR DS took",
    "start": "4302320",
    "end": "4310300"
  },
  {
    "text": "and when you run cut CTL run Alpine so",
    "start": "4310300",
    "end": "4316030"
  },
  {
    "text": "this is testing the white listing of the repos container repos you get the error",
    "start": "4316030",
    "end": "4324040"
  },
  {
    "text": "that it's been denied by white listed repos rule also if we want to test the",
    "start": "4324040",
    "end": "4330150"
  },
  {
    "text": "creating of a privileged pod again so here is a here dock and let's go ahead",
    "start": "4330150",
    "end": "4337930"
  },
  {
    "text": "and apply and that gets blocked two by",
    "start": "4337930",
    "end": "4349120"
  },
  {
    "text": "two rules it gets blocked because we do not allow privileged containers in the",
    "start": "4349120",
    "end": "4354460"
  },
  {
    "text": "dev namespace or the prod and because it's not in the white listed repose and",
    "start": "4354460",
    "end": "4361260"
  },
  {
    "text": "okay that's it thank you alright so",
    "start": "4364680",
    "end": "4369690"
  },
  {
    "text": "knowing that we have about eight minutes left and it's a ten minute walk through for the bonus challenges and",
    "start": "4369690",
    "end": "4375750"
  },
  {
    "text": "unfortunately by accident the slightly different gray stickers the gray border",
    "start": "4375750",
    "end": "4381490"
  },
  {
    "text": "that say experts as opposed to the white border stickers were distributed already so by lottery we already have our",
    "start": "4381490",
    "end": "4389830"
  },
  {
    "text": "winners picked we do have fifty or so so if you did miss one or if you have a",
    "start": "4389830",
    "end": "4395950"
  },
  {
    "text": "co-worker or friend whomever we do have them up on stage but I ask that you come",
    "start": "4395950",
    "end": "4400960"
  },
  {
    "text": "up after we do the quick walkthrough of the bonus challenge because I think the bonus challenges have some interesting",
    "start": "4400960",
    "end": "4406540"
  },
  {
    "text": "forensics items so we were going to give a little bit more time for you to run on your own but I think running through the",
    "start": "4406540",
    "end": "4412060"
  },
  {
    "text": "the walk through step by step is best can you do me a favor can you push the",
    "start": "4412060",
    "end": "4417430"
  },
  {
    "text": "can you do the make docks and copy them over so that'll start in one minute so",
    "start": "4417430",
    "end": "4422860"
  },
  {
    "text": "if you are doing the bonus challenges on your own right now just give me one more minute and then we'll follow through so",
    "start": "4422860",
    "end": "4429370"
  },
  {
    "text": "you can do every single command find every single part or artifact that we're looking for",
    "start": "4429370",
    "end": "4434940"
  },
  {
    "text": "so while tabbies helping me out here by publishing these so they're in a private repo we're copying over making a public",
    "start": "4459040",
    "end": "4465660"
  },
  {
    "text": "I'll talk through briefly what these two challenges are if you're leaving that's fine I'm going to talk over you",
    "start": "4465660",
    "end": "4471880"
  },
  {
    "text": "unfortunately though so what we're gonna do is we're gonna replay the ability to get on the root the root of the node but",
    "start": "4471880",
    "end": "4478870"
  },
  {
    "text": "we're gonna look for some evidence of something that's already happened maybe prior in the past that was sort of the",
    "start": "4478870",
    "end": "4484540"
  },
  {
    "text": "warm-up challenge and then the second challenge was another artifact driven understanding of the cluster being",
    "start": "4484540",
    "end": "4490870"
  },
  {
    "text": "compromised previously okay so we're gonna go into some tiller artifacts",
    "start": "4490870",
    "end": "4497050"
  },
  {
    "text": "hunting an investigation and container forensics so I think you'll appreciate",
    "start": "4497050",
    "end": "4502390"
  },
  {
    "text": "that if you're ever wanting to look through images and what what's in them without having to actually deploy the",
    "start": "4502390",
    "end": "4507880"
  },
  {
    "text": "code to see what's in them I think it's I think it's a nice little few set of steps it's worth staying for now I realize it's Thursday it's the end",
    "start": "4507880",
    "end": "4514780"
  },
  {
    "text": "of the conference it's been a long week for many of us so if you do just want to use your eyes at this point I think",
    "start": "4514780",
    "end": "4520120"
  },
  {
    "text": "you'll still get a lot out of it but if you really want to do it for the first time type along with us here perfect",
    "start": "4520120",
    "end": "4531700"
  },
  {
    "text": "thank you tabby looks like we're rocking so the question was I should go back to",
    "start": "4531700",
    "end": "4541930"
  },
  {
    "text": "the question this is the this is the bonus show so get a root shell in the cluster node and find the image name",
    "start": "4541930",
    "end": "4548590"
  },
  {
    "text": "that was last run directly with docker commands by the kubernetes user this kubernetes user is specific to gke in",
    "start": "4548590",
    "end": "4555250"
  },
  {
    "text": "this specific instance but it could just be anybody so one of the ways that we",
    "start": "4555250",
    "end": "4560980"
  },
  {
    "text": "can do this that will bypass OPA gatekeeper is we're gonna run this in a",
    "start": "4560980",
    "end": "4566080"
  },
  {
    "text": "different namespace open gate keeper was only running against Devon prod game spaces so we're gonna run this against the default namespace so we're gonna",
    "start": "4566080",
    "end": "4574120"
  },
  {
    "text": "clear here doc so you'll apply I need to",
    "start": "4574120",
    "end": "4582820"
  },
  {
    "text": "be shorter this helps it go okay so",
    "start": "4582820",
    "end": "4588440"
  },
  {
    "text": "we created the pod we have applied it we're gonna exec into it and this is yet",
    "start": "4588440",
    "end": "4593940"
  },
  {
    "text": "another mechanism I know tabby did it with NS enter this is the chroot or Schrute method okay we're still in the",
    "start": "4593940",
    "end": "4601800"
  },
  {
    "text": "container but we have a route FS that's what we called what we're mounting to slash on the node underneath okay so",
    "start": "4601800",
    "end": "4610560"
  },
  {
    "text": "we're gonna route in and run bash that's been bash on the node we're not in the host name space but we're able to run",
    "start": "4610560",
    "end": "4617100"
  },
  {
    "text": "docker commands and we're able to look around the file system so home kubernetes oh yeah PS cf all sorts of",
    "start": "4617100",
    "end": "4625740"
  },
  {
    "text": "good stuff we're definitely on the node right and if we cat bash history I was",
    "start": "4625740",
    "end": "4632700"
  },
  {
    "text": "gonna stop here and not actually run this command because I wanted to let people actually achieve it and then come",
    "start": "4632700",
    "end": "4637710"
  },
  {
    "text": "up and get stickers we still have a few left if you want to take some but I'll show you anyway the lovely dead beef",
    "start": "4637710",
    "end": "4644430"
  },
  {
    "text": "latest image was the one that was run so that was flag one okay so we're gonna",
    "start": "4644430",
    "end": "4650400"
  },
  {
    "text": "exit exit exit okay so if you're following along exit once now we're back into the container exit twice we're back",
    "start": "4650400",
    "end": "4655860"
  },
  {
    "text": "in cloud shell part two okay it's very",
    "start": "4655860",
    "end": "4664620"
  },
  {
    "text": "clear we're probably already popped right multiple times over history we were only finding the last hour or so in",
    "start": "4664620",
    "end": "4670650"
  },
  {
    "text": "terms of activity but what we've done is we removed tiller as a deployment with",
    "start": "4670650",
    "end": "4676560"
  },
  {
    "text": "helm reset force and what that does is that just takes the tiller deployment out but it leaves all of its artifacts",
    "start": "4676560",
    "end": "4683010"
  },
  {
    "text": "and permissions and everything else that's associated with it still in the cluster so where does tiller if it's",
    "start": "4683010",
    "end": "4688590"
  },
  {
    "text": "installed in the coop system namespace where does tiller leave its config maps I just gave it away sorry it's in the",
    "start": "4688590",
    "end": "4695160"
  },
  {
    "text": "coop system namespace it leaves config Maps for all the versions of deployments so these next commands are going to be",
    "start": "4695160",
    "end": "4700740"
  },
  {
    "text": "extracting the helm chart out of the remnant like the version history basically the tarvold sorry gzipped",
    "start": "4700740",
    "end": "4707850"
  },
  {
    "text": "version history so if you want to run this by yourself that's fine i'm going to talk through it and just do the final",
    "start": "4707850",
    "end": "4713970"
  },
  {
    "text": "commands again because the time constraints so we're gonna get the config map i'll show that and then we'll",
    "start": "4713970",
    "end": "4720600"
  },
  {
    "text": "jump to exactly how we parse this okay so we can see I should",
    "start": "4720600",
    "end": "4725850"
  },
  {
    "text": "do just the config Maps",
    "start": "4725850",
    "end": "4729080"
  },
  {
    "text": "we see toned elk version one right so that was an arbitrary and automatically",
    "start": "4731720",
    "end": "4737010"
  },
  {
    "text": "generated name for a deployment inside of helm that's still left over tillers not running right now so if we want to",
    "start": "4737010",
    "end": "4742800"
  },
  {
    "text": "get access to what that looks like you see all of this base64 encoded stuff right this is actually a gzip of a total",
    "start": "4742800",
    "end": "4752040"
  },
  {
    "text": "I think it gzip tar what are my commands",
    "start": "4752040",
    "end": "4756800"
  },
  {
    "text": "what we're gonna do is we're gonna we're gonna find out so we're using a little JQ let me scroll down get the config map",
    "start": "4757190",
    "end": "4765210"
  },
  {
    "text": "name tono output to Jason put it through JQ look for the dot data dot release",
    "start": "4765210",
    "end": "4770430"
  },
  {
    "text": "field base64 decode it and then say what kind of file is that it's gzip",
    "start": "4770430",
    "end": "4775770"
  },
  {
    "text": "compressed okay so that gives us a clue of what we should do okay",
    "start": "4775770",
    "end": "4782810"
  },
  {
    "text": "GN zip ooh that looks interesting it's literally everything Gazeta up so you",
    "start": "4783020",
    "end": "4789300"
  },
  {
    "text": "can see the the templating the there's values yeah M'Lynn here I don't think we use very many values there's the values",
    "start": "4789300",
    "end": "4794610"
  },
  {
    "text": "animal if you're familiar with helm charts right so there might be secrets or static values in there things to",
    "start": "4794610",
    "end": "4799830"
  },
  {
    "text": "ignore and helm ignore but really what we're looking for is this very suspicious-looking image right here okay",
    "start": "4799830",
    "end": "4806130"
  },
  {
    "text": "should we go ahead and dock or run that [Applause]",
    "start": "4806130",
    "end": "4812510"
  },
  {
    "text": "anybody why would we not want to do that because I'm rude on my cloud shell that",
    "start": "4812510",
    "end": "4818160"
  },
  {
    "text": "would be pretty bad so let's inspect it gently just give it a just a massage it from the side it's",
    "start": "4818160",
    "end": "4824730"
  },
  {
    "text": "fine okay so how many of you ever heard of a tool called dive by W a Goodman dive excellent wow that's that's",
    "start": "4824730",
    "end": "4832650"
  },
  {
    "text": "fantastic it's a great tool what it's gonna do I'm gonna I'm gonna run it and then I'm gonna tell what its gonna do okay and we're actually running dive as",
    "start": "4832650",
    "end": "4841470"
  },
  {
    "text": "a container so you have to install anything but dive what it does is it breaks down loads layers breaks them apart and lets you view it in a and",
    "start": "4841470",
    "end": "4848400"
  },
  {
    "text": "curses based viewer so you can look docker file line by docker file line what's going on in each each line what's",
    "start": "4848400",
    "end": "4855930"
  },
  {
    "text": "at to the container to the right you'll see so for now we're now we're actually just",
    "start": "4855930",
    "end": "4861170"
  },
  {
    "text": "looking at it inspecting we're not actually executing or running it okay so",
    "start": "4861170",
    "end": "4867030"
  },
  {
    "text": "we can see this is the from the root it just shows the hasha that's the base image if we hit our down arrow we could",
    "start": "4867030",
    "end": "4872280"
  },
  {
    "text": "see where app get installing curl and things look at the right side nothing's really changed in the meaningful way",
    "start": "4872280",
    "end": "4877590"
  },
  {
    "text": "until we copied in our back door binary it's in green it's B D that second line right there and B D I think I can tab",
    "start": "4877590",
    "end": "4885150"
  },
  {
    "text": "over that's easier to see right that's our probably our backdoor binary right and then we to mod it to be executable",
    "start": "4885150",
    "end": "4893610"
  },
  {
    "text": "and that's that really looks interesting let's try and see what we can find that we're gonna hit ctrl C okay so we're",
    "start": "4893610",
    "end": "4901290"
  },
  {
    "text": "looking how do we find that how we get that out of the the container image itself what we're gonna do is we're",
    "start": "4901290",
    "end": "4906630"
  },
  {
    "text": "gonna make a temp scratch space so we can extract this so we're just making a",
    "start": "4906630",
    "end": "4911670"
  },
  {
    "text": "BD temp backdoor temp we're going to run the docker save command and we're going",
    "start": "4911670",
    "end": "4916710"
  },
  {
    "text": "to output it to a tarball and it'll take",
    "start": "4916710",
    "end": "4922880"
  },
  {
    "text": "everybody do it all at once right now do it go I'm just kidding this is cloud shell so it's gonna be quick alright so",
    "start": "4922880",
    "end": "4928710"
  },
  {
    "text": "we've got our tar ball still don't want to extract it just yet cuz it could be you know you never know what's in a tar",
    "start": "4928710",
    "end": "4936180"
  },
  {
    "text": "ball until you poke at it so tar look at it verbose ly file we're not actually",
    "start": "4936180",
    "end": "4942900"
  },
  {
    "text": "extracting anything right we could see this is a looks like a standard",
    "start": "4942900",
    "end": "4947940"
  },
  {
    "text": "container image with all of its layers there's four layers and it's very interesting right because it lines up of layer layer layer there we have four",
    "start": "4947940",
    "end": "4954360"
  },
  {
    "text": "lines in our docker file okay so we're gonna extract it extract verbose file T",
    "start": "4954360",
    "end": "4962880"
  },
  {
    "text": "V X V F we have a manifest.json which says what's in all of these long sha-256",
    "start": "4962880",
    "end": "4968580"
  },
  {
    "text": "hash file folders and I'm going to jump ahead because we're right at the very end and I just want to get to the last",
    "start": "4968580",
    "end": "4975000"
  },
  {
    "text": "part here we're gonna look inside the manifest we're gonna pull out the config",
    "start": "4975000",
    "end": "4980640"
  },
  {
    "text": "Jason we're gonna look at the history and we're going to select all of the non-empty layers so again this looks",
    "start": "4980640",
    "end": "4986760"
  },
  {
    "text": "like our docker file again right so now we know what we're looking for we're looking for probably the third or the fourth layer",
    "start": "4986760",
    "end": "4993420"
  },
  {
    "text": "in this list we'll probably have that BD binary or script so I'm just going to",
    "start": "4993420",
    "end": "4998730"
  },
  {
    "text": "just wing it and say let's go for the last one look for the layers out of manifest.json tail - one okay so we have",
    "start": "4998730",
    "end": "5006230"
  },
  {
    "text": "that that's that's ready to go for piping into this and here is the final flag extract verbose the last layer look",
    "start": "5006230",
    "end": "5017030"
  },
  {
    "text": "at it and then that - capital o says put it to standard out this could be binary data and mess up our terminal but we",
    "start": "5017030",
    "end": "5022880"
  },
  {
    "text": "know it was 95 bytes so it's probably a script and there's our shell so the",
    "start": "5022880",
    "end": "5028970"
  },
  {
    "text": "second flag is 198 51 100 100 raise your hand has anybody followed along and",
    "start": "5028970",
    "end": "5034550"
  },
  {
    "text": "gotten these flags give yourself away",
    "start": "5034550",
    "end": "5040059"
  },
  {
    "text": "and with that thank you so much for coming I hope you had a wonderful coupon",
    "start": "5040090",
    "end": "5045440"
  },
  {
    "text": "from all of us we appreciate it thank you [Applause]",
    "start": "5045440",
    "end": "5052850"
  }
]