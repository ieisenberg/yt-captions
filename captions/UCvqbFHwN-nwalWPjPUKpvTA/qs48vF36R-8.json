[
  {
    "start": "0",
    "end": "40000"
  },
  {
    "text": "hello everyone welcome to my talk deploying rock-solid applications at",
    "start": "30",
    "end": "5670"
  },
  {
    "text": "kubernetes great to see so many people more than I expected but that's good",
    "start": "5670",
    "end": "11420"
  },
  {
    "text": "so I'm Almer I work at a company called manifolds we do a marketplace for",
    "start": "11420",
    "end": "17039"
  },
  {
    "text": "developer services it's like an independent marketplace where you can get like provision like your SAS",
    "start": "17039",
    "end": "23010"
  },
  {
    "text": "basically I work a lot on kubernetes in our stack they do a lot of ups in that",
    "start": "23010",
    "end": "29130"
  },
  {
    "text": "area but also build a lot of application stuff with that and I do a lot of go in that area",
    "start": "29130",
    "end": "34380"
  },
  {
    "text": "I've got a bunch of these stickers if anyone is interested can come grab them afterwards so this talk is about",
    "start": "34380",
    "end": "42059"
  },
  {
    "start": "40000",
    "end": "277000"
  },
  {
    "text": "rock-solid applications but what does that mean actually so the first section we'll look",
    "start": "42059",
    "end": "49140"
  },
  {
    "text": "at is how we're going to deploy secure applications this is not going to be at the level of a container or application",
    "start": "49140",
    "end": "56460"
  },
  {
    "text": "this is at a level of kubernetes Liz Rice already touched a little bit this morning in the keynote and then the",
    "start": "56460",
    "end": "64140"
  },
  {
    "text": "second part will look at is highly available applications we'll go into that in a bit so we're all here because",
    "start": "64140",
    "end": "71729"
  },
  {
    "text": "we like kubernetes I assume we work with it we reuse it and kubernetes is let a",
    "start": "71729",
    "end": "78990"
  },
  {
    "text": "lot of tools to like do a lot of things it helps us out in other areas that we had to like do manually before like it",
    "start": "78990",
    "end": "86939"
  },
  {
    "text": "makes deploying applications easy it makes killing even easier it's just changing a number but it doesn't do",
    "start": "86939",
    "end": "92700"
  },
  {
    "text": "these things by default you actually had to like configure it and especially like if you want to do a little bit more",
    "start": "92700",
    "end": "97860"
  },
  {
    "text": "advanced stuff you have to like dive into what you actually have to do so in this talk we'll look at how you can do",
    "start": "97860",
    "end": "103890"
  },
  {
    "text": "those the purpose of talk is that you like have an idea when you go home to",
    "start": "103890",
    "end": "109500"
  },
  {
    "text": "like look into these things so disclaimer will show a lot of the ammo and I've simplified it most of it",
    "start": "109500",
    "end": "117420"
  },
  {
    "text": "will probably not work like directly we copy paste it because that's like cutting it out for other slides so you",
    "start": "117420",
    "end": "123390"
  },
  {
    "text": "can actually read it but it should give you a general idea of what you should",
    "start": "123390",
    "end": "129539"
  },
  {
    "text": "look at a lot of the resources or like all the resources I've you store like all the topics of covered",
    "start": "129539",
    "end": "135240"
  },
  {
    "text": "here are linked at the end of the slides as well so if you look at the kubernetes",
    "start": "135240",
    "end": "141180"
  },
  {
    "text": "landscape for an application this is roughly yet in the century have a thought which is basically the lowest",
    "start": "141180",
    "end": "146940"
  },
  {
    "text": "abstraction level in kubernetes we start there and then we have a bunch of extra",
    "start": "146940",
    "end": "152010"
  },
  {
    "text": "things that are linked to two parts and in this talk we'll go over a few we will",
    "start": "152010",
    "end": "158310"
  },
  {
    "text": "go over deployments we'll go over our back network policies post security policies and pub disruption policy pop",
    "start": "158310",
    "end": "166410"
  },
  {
    "text": "user disruption budgets so the first section that I said we're going to look",
    "start": "166410",
    "end": "171810"
  },
  {
    "text": "at a security again this is at the kubernetes level know that after that at the application level or container level",
    "start": "171810",
    "end": "177770"
  },
  {
    "text": "and community has like three topics for this the first one are back then we also",
    "start": "177770",
    "end": "183810"
  },
  {
    "text": "have network policies and also have lot security policies will dive in with port",
    "start": "183810",
    "end": "189540"
  },
  {
    "text": "security policies first so by default this is not enabled like you actually",
    "start": "189540",
    "end": "197010"
  },
  {
    "text": "have to enable that within this admission controller but then we can actually dive in like she like install",
    "start": "197010",
    "end": "203010"
  },
  {
    "text": "these so this is a privileged policy so this is like gives you access to everything as you can see you can like",
    "start": "203010",
    "end": "209580"
  },
  {
    "text": "escalate to privilege like to do it you allow all the Linux capabilities you",
    "start": "209580",
    "end": "215220"
  },
  {
    "text": "have access to all types of volumes like config Maps secrets persistent volume claims you can access the host network",
    "start": "215220",
    "end": "222090"
  },
  {
    "text": "and you can even run as root what we want to do is make it a little bit more restricted and that's what we get in",
    "start": "222090",
    "end": "230160"
  },
  {
    "text": "here so now we say you can't go privileged you actually like can't go root you can only use secrets so you",
    "start": "230160",
    "end": "238530"
  },
  {
    "text": "can't use config Maps you can't use persistent volume claims so we can only use secrets you can't touch the host",
    "start": "238530",
    "end": "243870"
  },
  {
    "text": "network and you're not allowed to run this route so we define that now but how",
    "start": "243870",
    "end": "250709"
  },
  {
    "text": "are we going to actually like apply that to application and that's what our back and so our back is the next phase in",
    "start": "250709",
    "end": "255989"
  },
  {
    "text": "that as our back stands for a role based access control and actually exists out of three ticks so you have your service",
    "start": "255989",
    "end": "262440"
  },
  {
    "text": "account switch thanks for your identity roughly and then you also have a role or cholesterol and then you also have cholesterol",
    "start": "262440",
    "end": "269190"
  },
  {
    "text": "bindings or roll bindings and so the roll is then defining what your access",
    "start": "269190",
    "end": "275250"
  },
  {
    "text": "pattern actually is so we'll start by creating a service accounts in this case",
    "start": "275250",
    "end": "282030"
  },
  {
    "start": "277000",
    "end": "581000"
  },
  {
    "text": "it's a simple service accounts for cucum then we apply that and then we can",
    "start": "282030",
    "end": "287490"
  },
  {
    "text": "create a cluster role note that there's",
    "start": "287490",
    "end": "293460"
  },
  {
    "text": "this is a cluster role here as you might have remember from the previous slides you can actually have a role as well so",
    "start": "293460",
    "end": "300030"
  },
  {
    "text": "cluster roles are scoped across your entire cluster but just regular roles",
    "start": "300030",
    "end": "307140"
  },
  {
    "text": "are scoped across just the namespace so if you would have a role that is linked",
    "start": "307140",
    "end": "312420"
  },
  {
    "text": "to your namespace websites it's only valid in that namespace so in your default namespace you wouldn't have",
    "start": "312420",
    "end": "318150"
  },
  {
    "text": "access to that that's important to think about because pop security policies or cluster code by",
    "start": "318150",
    "end": "323730"
  },
  {
    "text": "default so I don't have to define don't have to define them per namespace so",
    "start": "323730",
    "end": "330180"
  },
  {
    "text": "we're gonna do with this cholesterol here is we're going to define that we're going to use these pop security policies",
    "start": "330180",
    "end": "335190"
  },
  {
    "text": "and we're going to reference the one that we created earlier so the restricted well we can now also",
    "start": "335190",
    "end": "340979"
  },
  {
    "text": "link that or service accounts that we created earlier by referencing that cholesterol so we say Keep Calm security",
    "start": "340979",
    "end": "347669"
  },
  {
    "text": "and then we're going to link that to subjects in this case or subject or subject as the service accounts you also",
    "start": "347669",
    "end": "353430"
  },
  {
    "text": "have some some different ones we're not gonna go into that so we link that to the cube from service account now so we",
    "start": "353430",
    "end": "360840"
  },
  {
    "text": "have this all set up now we have our cluster or roles linked or service account but now we have to actually have",
    "start": "360840",
    "end": "366300"
  },
  {
    "text": "to bring that to our application as well and that happens in the deployment or in",
    "start": "366300",
    "end": "371460"
  },
  {
    "text": "the pot more precisely so we can actually define a service account name",
    "start": "371460",
    "end": "376740"
  },
  {
    "text": "so we're gonna reference Keep Calm here as well and now that means that that",
    "start": "376740",
    "end": "382350"
  },
  {
    "text": "service account is linked to that deployment so every time you do deploy that service account is taking care of",
    "start": "382350",
    "end": "388380"
  },
  {
    "text": "like its identity for that deployment so we have roughly secure applications now",
    "start": "388380",
    "end": "394830"
  },
  {
    "text": "we secure that but as Liz rice show dinner keynote this",
    "start": "394830",
    "end": "399840"
  },
  {
    "text": "morning we also had this API server which pots can speak to so how can we like secure that now a simple way is to",
    "start": "399840",
    "end": "409789"
  },
  {
    "text": "disable alt amounting that services account token if you remember from the",
    "start": "409789",
    "end": "415080"
  },
  {
    "text": "keynote again you can like load that token file and then you actually have access to to the cluster API which you",
    "start": "415080",
    "end": "422580"
  },
  {
    "text": "don't know you want to do so you can disable that by default but some",
    "start": "422580",
    "end": "428630"
  },
  {
    "text": "applications might actually need to have access to to do a cluster so for example",
    "start": "428630",
    "end": "434610"
  },
  {
    "text": "if you use certain manager for example or if you use contour they actually need to like speak to the API to get some",
    "start": "434610",
    "end": "440160"
  },
  {
    "text": "information out so you want to give some specific rules that they can actually do and how you can do that is with our back",
    "start": "440160",
    "end": "446940"
  },
  {
    "text": "again so you can make another cluster all and I say oh ok in this case we're gonna make a rule that says this",
    "start": "446940",
    "end": "453120"
  },
  {
    "text": "accounts can actually use the secrets so we can actually get the secret's out so this one can only get the secret's out",
    "start": "453120",
    "end": "458490"
  },
  {
    "text": "so it can't read or account the lead or it can't create it's just getting them and you can do that with any resource",
    "start": "458490",
    "end": "464010"
  },
  {
    "text": "that you want so we now have secure pots also security interaction with those",
    "start": "464010",
    "end": "469860"
  },
  {
    "text": "pots between between the pots and the API server but what about the interaction between pots themselves",
    "start": "469860",
    "end": "475610"
  },
  {
    "text": "that's where Network policies come in so this is like a rough diagram that you",
    "start": "475610",
    "end": "481349"
  },
  {
    "text": "can make you can say oh we have an ingress maybe envoi and then we have a",
    "start": "481349",
    "end": "486810"
  },
  {
    "text": "few applications some are open some are very restricted so you can actually like",
    "start": "486810",
    "end": "492240"
  },
  {
    "text": "control that incoming and outgoing traffic so this is an allow",
    "start": "492240",
    "end": "497479"
  },
  {
    "text": "configuration which basically means obviously like a lot o so you can allow all incoming and outgoing traffic and",
    "start": "497479",
    "end": "503699"
  },
  {
    "text": "this is a default so if you enable Network policies this is default you're not talking else but then we can",
    "start": "503699",
    "end": "511020"
  },
  {
    "text": "restrict that a little bit more so in this case we have court deployment and",
    "start": "511020",
    "end": "516089"
  },
  {
    "text": "then we say for the network policy the pub selector is an important part in",
    "start": "516089",
    "end": "521520"
  },
  {
    "text": "this so we're going to find the port's that have the label links the app label",
    "start": "521520",
    "end": "526860"
  },
  {
    "text": "linked which are this application and we want to deploy and then we're gonna say the ingress the",
    "start": "526860",
    "end": "532870"
  },
  {
    "text": "incoming traffic we're going to restrict that to the ingress controller namespace and we're gonna restrict that to the pot",
    "start": "532870",
    "end": "539830"
  },
  {
    "text": "that has App Engine X link to it as well so only ports that are engine X from the",
    "start": "539830",
    "end": "545320"
  },
  {
    "text": "ingress controller namespace are allowed to speak to this these applications",
    "start": "545320",
    "end": "551760"
  },
  {
    "text": "there's one caveat to that and that like it depends on the network plug-in that",
    "start": "552240",
    "end": "558310"
  },
  {
    "text": "you have so some implement all of this like he can control incoming and outgoing traffic some only he do",
    "start": "558310",
    "end": "564399"
  },
  {
    "text": "incoming traffic some of them do none of it at all so depending on that you'll have a little",
    "start": "564399",
    "end": "569860"
  },
  {
    "text": "bit of differentiation so we have a secure setup now we cover that part it's",
    "start": "569860",
    "end": "577630"
  },
  {
    "text": "time to go into the high availability section of this before we dive in want",
    "start": "577630",
    "end": "584350"
  },
  {
    "start": "581000",
    "end": "911000"
  },
  {
    "text": "to clarify us or what we mean high availability this talk is not about high",
    "start": "584350",
    "end": "590080"
  },
  {
    "text": "availability for like your notes we're purely gonna talk about high availability for your applications and there's order of talks about like how",
    "start": "590080",
    "end": "596680"
  },
  {
    "text": "you can actually set up a high available cluster and stuff and we're not gonna dive into that here we assume you",
    "start": "596680",
    "end": "602020"
  },
  {
    "text": "already had that so the first thing that",
    "start": "602020",
    "end": "607779"
  },
  {
    "text": "like the first thing we wanna bet but high built is like if you have an application if one of your application",
    "start": "607779",
    "end": "613120"
  },
  {
    "text": "fails and you want to make sure that your users to get to see something right so you're gonna deploy multiply via",
    "start": "613120",
    "end": "618880"
  },
  {
    "text": "these applications and then everyone fails the other ones take over and you still have that interaction that also",
    "start": "618880",
    "end": "625180"
  },
  {
    "text": "works for internal traffic so you might have a circuit breaker somewhere and then if you go from app application one",
    "start": "625180",
    "end": "630459"
  },
  {
    "text": "application to have some communication wanna make sure that that responds properly and because we work in a",
    "start": "630459",
    "end": "635649"
  },
  {
    "text": "distributed environment we want to make sure that we if something happens like",
    "start": "635649",
    "end": "641680"
  },
  {
    "text": "network fault we can still we can still get the response back",
    "start": "641680",
    "end": "648240"
  },
  {
    "text": "so for this high availability high availability parts we're going to look at two sections deployments habitual",
    "start": "648620",
    "end": "655340"
  },
  {
    "text": "size replica sets and then also both both disruption budgets so with",
    "start": "655340",
    "end": "661940"
  },
  {
    "text": "deployments there they're basically a functionality on top of replica sets and",
    "start": "661940",
    "end": "667700"
  },
  {
    "text": "the main thing that they add is replicas and update strategy so with replicas",
    "start": "667700",
    "end": "673190"
  },
  {
    "text": "it's easy to scale so you just changed that number and then it will scale to that and then the other strategy is",
    "start": "673190",
    "end": "679160"
  },
  {
    "text": "actually quite interesting and that's how we can define how we roll out or applications so we can say this is the",
    "start": "679160",
    "end": "684470"
  },
  {
    "text": "way if we scale that it should happen or if we deploy a new version this is how",
    "start": "684470",
    "end": "689480"
  },
  {
    "text": "it should be rolled out this is a simple",
    "start": "689480",
    "end": "694510"
  },
  {
    "text": "template and we're gonna start with that so we just say we're gonna deploy two replicas we're not going to think about",
    "start": "694510",
    "end": "700610"
  },
  {
    "text": "update strategy yet we're going to just use a default that communities provides and we're just going to deploy to",
    "start": "700610",
    "end": "705980"
  },
  {
    "text": "applications so what happens here is we deployed that we have two version 1.0",
    "start": "705980",
    "end": "712250"
  },
  {
    "text": "1.0 and that's running nicely we have service link to that that does load balancing and then traffic flow strips",
    "start": "712250",
    "end": "720470"
  },
  {
    "text": "both of these but what happens if we do a deploy and so at one point 2.0 version",
    "start": "720470",
    "end": "726260"
  },
  {
    "text": "gets deployed and immediately the one point one point over and gets terminated but the more important part here is that",
    "start": "726260",
    "end": "734830"
  },
  {
    "text": "we lose high availability basically because well as you can see the one",
    "start": "734830",
    "end": "739910"
  },
  {
    "text": "point one always terminate it but one point 2.0 isn't booted yet it takes a while to do and in that like brief",
    "start": "739910",
    "end": "746750"
  },
  {
    "text": "moment we actually serve only one pot so we have to think about that eventually",
    "start": "746750",
    "end": "752650"
  },
  {
    "text": "this one point two point output comes available and then we have high availability again and then the cycle",
    "start": "752650",
    "end": "758450"
  },
  {
    "text": "repeats until all one point one point OS or done and everything is to do version",
    "start": "758450",
    "end": "763550"
  },
  {
    "text": "everyone's but what if that new clock doesn't come available then you're in a",
    "start": "763550",
    "end": "770060"
  },
  {
    "text": "bad situation where you only have one pop and because your deployment is on the new version you can't really like",
    "start": "770060",
    "end": "775880"
  },
  {
    "text": "trigger a new one point one foot or you can draw do a rollback off sleep",
    "start": "775880",
    "end": "781240"
  },
  {
    "text": "so a way to fix that or no way to fix that this is so this is a default configuration actually so by deep by",
    "start": "781310",
    "end": "788240"
  },
  {
    "text": "default we're gonna have a rolling update strategy with a max search of 25%",
    "start": "788240",
    "end": "795050"
  },
  {
    "text": "and a maximum available of 25% as well the important thing to think to remember",
    "start": "795050",
    "end": "800120"
  },
  {
    "text": "here is that these numbers they get rounded up so that means in case of two replicas you actually get one maximum",
    "start": "800120",
    "end": "807050"
  },
  {
    "text": "available so that means that if you do deployments whilst you're deploying",
    "start": "807050",
    "end": "812199"
  },
  {
    "text": "kubernetes tolerates one unavailable parts in your cluster the max search is",
    "start": "812199",
    "end": "818120"
  },
  {
    "text": "saying that demand of parts that is going to create extra so if you have two is going to create one extra pop you",
    "start": "818120",
    "end": "824540"
  },
  {
    "text": "could set up to one hundred and then it's going to deploy two hundred two extra parts and you have to like play",
    "start": "824540",
    "end": "829730"
  },
  {
    "text": "with those values a little bit but for this example we're just gonna have a look at what happens they be set this to",
    "start": "829730",
    "end": "835249"
  },
  {
    "text": "max and available to zero which is a little bit more interesting and maybe a",
    "start": "835249",
    "end": "841309"
  },
  {
    "text": "little bit more desires actually just a quick note on that like if you have more",
    "start": "841309",
    "end": "847639"
  },
  {
    "text": "replicas you still want to think about these numbers because it the behavior is similar and you have to like fine tune",
    "start": "847639",
    "end": "853309"
  },
  {
    "text": "that yourself so again we start with the two one point one point or versions and",
    "start": "853309",
    "end": "858649"
  },
  {
    "text": "then we do deploy so what we see here now is that this new version becomes available but we maintain this high",
    "start": "858649",
    "end": "865459"
  },
  {
    "text": "availability which is good and then eventually the new version becomes available we go to all the parts and",
    "start": "865459",
    "end": "872120"
  },
  {
    "text": "then kubernetes actually like terminates that last one or the old one and then it repeats that cycle and goes to",
    "start": "872120",
    "end": "878689"
  },
  {
    "text": "everything again but the interesting part here is if that new deployment fails like you don't have an issue you",
    "start": "878689",
    "end": "885470"
  },
  {
    "text": "get alerted because one of your pulse is not like spinning up but you can like still like surf traffic and you don't",
    "start": "885470",
    "end": "891740"
  },
  {
    "text": "have performance degradation and again if you have like more replicas and you might not go to like one part but if you",
    "start": "891740",
    "end": "898939"
  },
  {
    "text": "have a hundred replicas the question is can you tolerate like for example 25 percent of that going down while you do",
    "start": "898939",
    "end": "905059"
  },
  {
    "text": "in plot and which is probably not the case so you want to definitely fine-tune those numbers the next section we want",
    "start": "905059",
    "end": "913100"
  },
  {
    "start": "911000",
    "end": "1113000"
  },
  {
    "text": "to look at is a so with affinity you can say I'm going to deploy these applications on a",
    "start": "913100",
    "end": "920329"
  },
  {
    "text": "specific set of nodes or regions there's a few areas that you can like apologies",
    "start": "920329",
    "end": "927230"
  },
  {
    "text": "I can look into basically we're gonna look at hosts here before we dive into",
    "start": "927230",
    "end": "932750"
  },
  {
    "text": "the code let's just have a quick look at what happens if you don't defy anything so we have two zones here with each with",
    "start": "932750",
    "end": "941449"
  },
  {
    "text": "two nodes and all of the sudden no three goes out which is fine we're running kubernetes it's gonna take",
    "start": "941449",
    "end": "947899"
  },
  {
    "text": "care of this right but note that we in node one we only have one application running at the moment so a kubernetes is",
    "start": "947899",
    "end": "954350"
  },
  {
    "text": "going to do is going to see oh this node one actually has a lot of resources available so it's gonna reschedule those",
    "start": "954350",
    "end": "961630"
  },
  {
    "text": "faulty applications on that node one and it's gonna be happy the issue with that",
    "start": "961630",
    "end": "967910"
  },
  {
    "text": "is there's actually two issues so the issue that is that node one now has to app once so if that node goes out for",
    "start": "967910",
    "end": "975350"
  },
  {
    "text": "some reason as well we lose like a lot of capacity but if you look closely",
    "start": "975350",
    "end": "981370"
  },
  {
    "text": "application one is only deployed in zone one now that means that if zone one goes",
    "start": "981370",
    "end": "988160"
  },
  {
    "text": "out for some reason it happens like we lose application one so what we want to",
    "start": "988160",
    "end": "993949"
  },
  {
    "text": "do is we want to define some affinity rules so again this is the deployments",
    "start": "993949",
    "end": "999110"
  },
  {
    "text": "and then we gonna define affinity and we're gonna use anti infinity here so we're gonna say these tools like we",
    "start": "999110",
    "end": "1005350"
  },
  {
    "text": "don't want to adhere to that like we don't wanna do it refers basically and",
    "start": "1005350",
    "end": "1010660"
  },
  {
    "text": "we're using preferred during scheduling you also have required during scheduling and the preferred during scheduling is",
    "start": "1010660",
    "end": "1016589"
  },
  {
    "text": "basically saying to determinate this API like we prefer that you like do not",
    "start": "1016589",
    "end": "1023410"
  },
  {
    "text": "deploy this on this machine if like if these rules already apply there but if",
    "start": "1023410",
    "end": "1029319"
  },
  {
    "text": "it is if it is the case and there's nothing else you can still do it if you do require it it's not going to deploy",
    "start": "1029319",
    "end": "1035319"
  },
  {
    "text": "it'd be perfect like we chose to do the preferred and then set up alerting on",
    "start": "1035319",
    "end": "1040688"
  },
  {
    "text": "that to like make sure that we still have enough capacity and then you can like look after it once we have the",
    "start": "1040689",
    "end": "1047650"
  },
  {
    "text": "alerts at least we still have the same amount of like replicas running so we can make",
    "start": "1047650",
    "end": "1053460"
  },
  {
    "text": "sure we can serve traffic so what we're gonna do here is we're gonna do that",
    "start": "1053460",
    "end": "1058549"
  },
  {
    "text": "plenty of affinity term and we're gonna do label selection again again we're",
    "start": "1058549",
    "end": "1063659"
  },
  {
    "text": "gonna select that same application and we're gonna say oh is this application already running on this host so what",
    "start": "1063659",
    "end": "1070860"
  },
  {
    "text": "we're going to do here is we're going to determine like yeah does this hostname like the machines with this hostname",
    "start": "1070860",
    "end": "1076769"
  },
  {
    "text": "does this already have this application on and then kubernetes is going to determine like it does so I shouldn't schedule it on that so if you look at",
    "start": "1076769",
    "end": "1084389"
  },
  {
    "text": "that now what's going to happen instead of putting everything on the old one it's actually going to say oh node one",
    "start": "1084389",
    "end": "1090179"
  },
  {
    "text": "already has this application one so I shouldn't schedule it there and definitely like Note 4 doesn't have this",
    "start": "1090179",
    "end": "1096179"
  },
  {
    "text": "yet so I'll prefer to schedule it there that's what that's a nice way to like make sure you like spray spread low",
    "start": "1096179",
    "end": "1102409"
  },
  {
    "text": "across your notes basically and your region so the example here was cut out",
    "start": "1102409",
    "end": "1107610"
  },
  {
    "text": "so we actually have some rule set up to do that across regions and zones as well",
    "start": "1107610",
    "end": "1113570"
  },
  {
    "start": "1113000",
    "end": "1428000"
  },
  {
    "text": "so we talked about like disruptions or like unavailability jutsu like external",
    "start": "1113990",
    "end": "1120809"
  },
  {
    "text": "events like know that pictures on a pitch but what if your application is having an issue like how does kubernetes",
    "start": "1120809",
    "end": "1126510"
  },
  {
    "text": "know that like when we talked about deployments we say it like this application you see like we want X",
    "start": "1126510",
    "end": "1132299"
  },
  {
    "text": "amount of applications to be available but how does kubernetes know that and that's where probes come into play so",
    "start": "1132299",
    "end": "1138539"
  },
  {
    "text": "there's two types of probes there's your readiness probe which basically works for determining every",
    "start": "1138539",
    "end": "1145169"
  },
  {
    "text": "application is ready to serve traffic so if you have a boot like a longer boot",
    "start": "1145169",
    "end": "1151769"
  },
  {
    "text": "time you probably want to play with these initial delay seconds or period seconds and that's basically like until",
    "start": "1151769",
    "end": "1158090"
  },
  {
    "text": "these checks basically run until like your application is ready to serve traffic and then you also had the",
    "start": "1158090",
    "end": "1163830"
  },
  {
    "text": "liveness probe so once your application is running you want to make sure that like it's still LT and you can still",
    "start": "1163830",
    "end": "1169889"
  },
  {
    "text": "serve traffic to that and that's where the the liveness probes come into play and usually those liveness probes have a",
    "start": "1169889",
    "end": "1176399"
  },
  {
    "text": "shorter period ii and a shorter initial delay seconds",
    "start": "1176399",
    "end": "1181920"
  },
  {
    "text": "you want to like regularly check that like once your application is running once it's serving traffic you want to make sure that it's still healthy and",
    "start": "1181920",
    "end": "1187950"
  },
  {
    "text": "then community is going to do a rebus or whatever it needs to do to make sure",
    "start": "1187950",
    "end": "1193350"
  },
  {
    "text": "it's running correctly there's one caveat with that and that's circular",
    "start": "1193350",
    "end": "1199200"
  },
  {
    "text": "dependencies so a lot of people set up these health checks and then say we're gonna check I have these dependencies",
    "start": "1199200",
    "end": "1205020"
  },
  {
    "text": "and I'm going to check that that dependency is live and then if that's not alive I'm going to fail my health check but you might have end up in a",
    "start": "1205020",
    "end": "1212280"
  },
  {
    "text": "situation where you have this where you have three applications in this case a B and C that all depend on each other so",
    "start": "1212280",
    "end": "1219030"
  },
  {
    "text": "in this case a Leyden C C relies on being B relies on a the issue here is",
    "start": "1219030",
    "end": "1224970"
  },
  {
    "text": "that if she fails that's not that big of deal yeah where C fails the next step",
    "start": "1224970",
    "end": "1232320"
  },
  {
    "text": "that's going to happen is that a is gonna fail as well which means that B is going to fail as well and to actually",
    "start": "1232320",
    "end": "1238830"
  },
  {
    "text": "get out of that you need to like either time it very well or not use a circular dependency basically so we reinstalled",
    "start": "1238830",
    "end": "1246510"
  },
  {
    "text": "de crédit we added a degraded label to that so instead of actually failing the",
    "start": "1246510",
    "end": "1252810"
  },
  {
    "text": "hell check we just say that it's degraded and that way like external monitoring services can I see detect and",
    "start": "1252810",
    "end": "1258630"
  },
  {
    "text": "just alert us as well on that so we talked about a lot of this captions so",
    "start": "1258630",
    "end": "1265260"
  },
  {
    "text": "far so we talked about like expected disruptions from deployment so if we like take out some some applications but",
    "start": "1265260",
    "end": "1273300"
  },
  {
    "text": "also about unexpected failures or disruptions like an application failure",
    "start": "1273300",
    "end": "1279270"
  },
  {
    "text": "or a node failure or zone failure so kubernetes does a lot of scheduling and",
    "start": "1279270",
    "end": "1285390"
  },
  {
    "text": "rescheduling and you need to make sure that kubernetes like is aware of this and make sure that cuban it is like",
    "start": "1285390",
    "end": "1291870"
  },
  {
    "text": "knows that you definitely want this application to always be running at this capacity that's where poor disruption",
    "start": "1291870",
    "end": "1299910"
  },
  {
    "text": "budgets come into play so another",
    "start": "1299910",
    "end": "1305010"
  },
  {
    "text": "example here is we have four nodes and",
    "start": "1305010",
    "end": "1310130"
  },
  {
    "text": "node 4 is just know that just spun up so we're scaling or we just tolerate",
    "start": "1310130",
    "end": "1315450"
  },
  {
    "text": "we just had node failure so Note 4 is a new note that came out into our cluster and we also have application woman that",
    "start": "1315450",
    "end": "1322050"
  },
  {
    "text": "is using a lot of resources so application one is on node 1 and node 3 and then no - just doesn't have that",
    "start": "1322050",
    "end": "1329220"
  },
  {
    "text": "much stuff going on at the moment so what cubanía is going to do is going to say oh I can take these like hi or",
    "start": "1329220",
    "end": "1336330"
  },
  {
    "text": "fencing application the applications that are using a lot of resources and I",
    "start": "1336330",
    "end": "1341820"
  },
  {
    "text": "can just reschedule them on to an app to a node that isn't using a lot of resources if you notice that here",
    "start": "1341820",
    "end": "1348960"
  },
  {
    "text": "station now is that well again our application is not available it's being",
    "start": "1348960",
    "end": "1355290"
  },
  {
    "text": "rescheduled so that's where all destruction budgets come into play so again we want to define this and it's",
    "start": "1355290",
    "end": "1362280"
  },
  {
    "text": "important to like the finest correctly like to what you need because these objects are immutable so once you apply",
    "start": "1362280",
    "end": "1368220"
  },
  {
    "text": "it you you have to stick well you can delete it and apply it again obviously or replace it but you can't just update",
    "start": "1368220",
    "end": "1376140"
  },
  {
    "text": "them at will so it's like better to use a percentage here so that way if you",
    "start": "1376140",
    "end": "1382320"
  },
  {
    "text": "scale up it applies that percentage instead of like having a fixed number number and that wouldn't really scale",
    "start": "1382320",
    "end": "1388770"
  },
  {
    "text": "and again the percentages are being rounded up as with database strikes you",
    "start": "1388770",
    "end": "1396590"
  },
  {
    "text": "so what's going to happen now again we start with this beginning face and",
    "start": "1396590",
    "end": "1403020"
  },
  {
    "text": "kubernetes just going to say oh I'm going to see redeploy this app one",
    "start": "1403020",
    "end": "1409050"
  },
  {
    "text": "that's using a lot of resources I'm going to redeploy it on this note that doesn't have anything at all and then",
    "start": "1409050",
    "end": "1414390"
  },
  {
    "text": "I'm gonna in the next face when application one has become available I'm going to take application one from node",
    "start": "1414390",
    "end": "1420900"
  },
  {
    "text": "tree and I'm going to put that on to and that's basically rescheduling so we kind",
    "start": "1420900",
    "end": "1430080"
  },
  {
    "start": "1428000",
    "end": "1800000"
  },
  {
    "text": "of want to prevent all of this miss configuration and how can we ensure all",
    "start": "1430080",
    "end": "1436530"
  },
  {
    "text": "of this is set up correctly so there's a lot to think about here we have to think about what destruction veggies I think",
    "start": "1436530",
    "end": "1443370"
  },
  {
    "text": "that we set up these update strategies correctly that we have replica setup",
    "start": "1443370",
    "end": "1448990"
  },
  {
    "text": "you have to think about a lot of things and that's not always the nicest thing to do can we avoid that what linting",
    "start": "1448990",
    "end": "1457630"
  },
  {
    "text": "linting is like a lot of work you have to lie set that up correctly make sure it's like up today",
    "start": "1457630",
    "end": "1464240"
  },
  {
    "text": "it's quite fragile as well you might miss something if your winter isn't the great like isn't configured correctly",
    "start": "1464240",
    "end": "1470060"
  },
  {
    "text": "and but the biggest issue is that if you just don't run the linter well then you",
    "start": "1470060",
    "end": "1476360"
  },
  {
    "text": "can still deploy all of this to your cluster right so what we want to do is want to use web hooks so quickness has",
    "start": "1476360",
    "end": "1483860"
  },
  {
    "text": "web hooks and as you we saw in a keynote this morning we can do validation we can",
    "start": "1483860",
    "end": "1490100"
  },
  {
    "text": "also do change this abomination that means we can actually become bypass",
    "start": "1490100",
    "end": "1495950"
  },
  {
    "text": "style anything so it's actually in the cluster so if you deploy that into your cluster it will definitely get validated",
    "start": "1495950",
    "end": "1500960"
  },
  {
    "text": "properly and again Liz touched on this in her keynote she used open policy",
    "start": "1500960",
    "end": "1508640"
  },
  {
    "text": "agent and in this example here we're gonna just use another tool called Barbossa so quick overview of the web",
    "start": "1508640",
    "end": "1517280"
  },
  {
    "text": "hooks again so if you do requests already do keep CTL apply you're gonna",
    "start": "1517280",
    "end": "1523910"
  },
  {
    "text": "go to the API it should be handler that's going to do like some modification and authorization and then",
    "start": "1523910",
    "end": "1529700"
  },
  {
    "text": "you're gonna hit the mutating admission controller and it's going to see for",
    "start": "1529700",
    "end": "1535160"
  },
  {
    "text": "this object so in our case it deployment is a web hook that is watching this if",
    "start": "1535160",
    "end": "1541340"
  },
  {
    "text": "this is going to go to that left hook and then it's going to do its mutation that is needed so you could even have a",
    "start": "1541340",
    "end": "1548840"
  },
  {
    "text": "limitation mutating weapon that says I'm going to make sure that all my",
    "start": "1548840",
    "end": "1554560"
  },
  {
    "text": "applications at least have two replicas running or you can do like automatically",
    "start": "1554560",
    "end": "1560360"
  },
  {
    "text": "spin about disruption budgets and stuff like that then you also we also do like",
    "start": "1560360",
    "end": "1566510"
  },
  {
    "text": "very light schema validation so every object has Jason validation even if you",
    "start": "1566510",
    "end": "1572990"
  },
  {
    "text": "use custom resources you can find that that's quite lightweight and then we",
    "start": "1572990",
    "end": "1578720"
  },
  {
    "text": "also have the validating admission controller so the validating",
    "start": "1578720",
    "end": "1588820"
  },
  {
    "text": "admission controller is going through a list show this morning and it's going to like take that object so again our",
    "start": "1588820",
    "end": "1595130"
  },
  {
    "text": "deployment is going to take that object and it's going to validate that against a set of rules that we have defined and",
    "start": "1595130",
    "end": "1601430"
  },
  {
    "text": "that way by having this reinforced at the cluster level that you have all of these policies set up and if you don't",
    "start": "1601430",
    "end": "1610070"
  },
  {
    "text": "pass this validation it's obviously going to error on your side if you do is going to be persisted to SVD so again in",
    "start": "1610070",
    "end": "1618680"
  },
  {
    "text": "our case we're gonna have this simple example here we're gonna apply that one",
    "start": "1618680",
    "end": "1624920"
  },
  {
    "text": "replica that's the important part and no update strategy so we're gonna apply that and we see of this deployment is",
    "start": "1624920",
    "end": "1631760"
  },
  {
    "text": "successfully created but now we're gonna say I'm gonna have a high availability",
    "start": "1631760",
    "end": "1637150"
  },
  {
    "text": "policy so again this is like specific to the Barbossa tool you can do this with",
    "start": "1637150",
    "end": "1642710"
  },
  {
    "text": "open as well it's just the syntax is a little bit different this is like with custom resource definitions so what",
    "start": "1642710",
    "end": "1650900"
  },
  {
    "text": "we're gonna do here is we're gonna deploy this high availability policy in a namespace and then we're gonna say",
    "start": "1650900",
    "end": "1656900"
  },
  {
    "text": "this applies to all pots so we use the selector here which is to get in a label selector and reason for that is that you",
    "start": "1656900",
    "end": "1664910"
  },
  {
    "text": "can actually start mixing so you can have a policy that says all pots should",
    "start": "1664910",
    "end": "1672380"
  },
  {
    "text": "have a label for example team and then you can start making availability",
    "start": "1672380",
    "end": "1678380"
  },
  {
    "text": "policies based on teams so then you can have a selector based on the team level which is quite named and then we're",
    "start": "1678380",
    "end": "1685430"
  },
  {
    "text": "gonna say you need at least two replicas so yeah you want that to like at least",
    "start": "1685430",
    "end": "1691190"
  },
  {
    "text": "have some high availability and then we want to make sure that our strategy is rolling update not recreate because you",
    "start": "1691190",
    "end": "1698030"
  },
  {
    "text": "don't like recreate and then the minimum surge that you're gonna do is 25% which",
    "start": "1698030",
    "end": "1703490"
  },
  {
    "text": "is fine and maximum surge is 50% that's to make sure if you have like a bunch of a bunch of replicas because we have a",
    "start": "1703490",
    "end": "1710990"
  },
  {
    "text": "minimum that we haven't specified maximum so you could have like a and if you would say max urges under",
    "start": "1710990",
    "end": "1717540"
  },
  {
    "text": "percents then all of a sudden you spin up 100 hundred extra parts which you can",
    "start": "1717540",
    "end": "1723450"
  },
  {
    "text": "do but you needed a cluster autoscaler so we want to limit that as well and then we want to say the max unavailable",
    "start": "1723450",
    "end": "1729930"
  },
  {
    "text": "in in our case is going to be zero you can make this percentage base as well so",
    "start": "1729930",
    "end": "1735960"
  },
  {
    "text": "we're going to apply this policy great and then what happens if we apply this",
    "start": "1735960",
    "end": "1743090"
  },
  {
    "text": "deployment we see that we have two errors the first one is that the replicas is invalid we want to at least",
    "start": "1743090",
    "end": "1749640"
  },
  {
    "text": "do but we have one so that's not valid and then we also see that the maximum available is invalid as well so we have",
    "start": "1749640",
    "end": "1756900"
  },
  {
    "text": "spent five percents and again this is rounded up so if you have two replicas or even one the 25% is going to be",
    "start": "1756900",
    "end": "1764100"
  },
  {
    "text": "rounded up to one so it's more than the at most zero so it's going to fell on",
    "start": "1764100",
    "end": "1770160"
  },
  {
    "text": "that as well yeah so webhooks so this is using Barbossa the main differences that",
    "start": "1770160",
    "end": "1777330"
  },
  {
    "text": "proposed I would do the machine that focuses all that the over stuff works great as well",
    "start": "1777330",
    "end": "1784610"
  },
  {
    "text": "so that's it if you're interested in all this stuff manifold is hiring so definitely come",
    "start": "1784850",
    "end": "1790080"
  },
  {
    "text": "reach out and yeah that's it I'll be around for questions if you are",
    "start": "1790080",
    "end": "1796220"
  },
  {
    "text": "you",
    "start": "1799290",
    "end": "1801350"
  }
]