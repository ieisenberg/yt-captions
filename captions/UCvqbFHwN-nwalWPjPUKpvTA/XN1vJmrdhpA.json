[
  {
    "text": "good afternoon uh my name is Zach loffman and realized I was going to be talking to such a packed house I'm glad",
    "start": "359",
    "end": "6520"
  },
  {
    "text": "to see you all here this afternoon hopefully you're not in a too much of a food coma uh I am a staff fesser at",
    "start": "6520",
    "end": "12639"
  },
  {
    "text": "Google I've been working on gke for about a decade now um and here I'm going",
    "start": "12639",
    "end": "18960"
  },
  {
    "text": "to talk to you about better pod availability this is a pretty nebulous topic um but we're going to go over",
    "start": "18960",
    "end": "26279"
  },
  {
    "text": "several ways to manage workload disruptions many of which are familiar to you some of which may be",
    "start": "26279",
    "end": "32879"
  },
  {
    "text": "new so what is POD disruption anything that interrupts a",
    "start": "32879",
    "end": "39719"
  },
  {
    "text": "pod before the application exits can be considered disruption now that's a super nebulous",
    "start": "39719",
    "end": "47600"
  },
  {
    "text": "uh that's a super nebulous definition there's so many things that are actually in this",
    "start": "47600",
    "end": "55199"
  },
  {
    "text": "envelope and in fact the kubernetes documentation even has uh a taxonomy of",
    "start": "55199",
    "end": "62239"
  },
  {
    "text": "these splitting it up into involuntary and voluntary disrupture",
    "start": "62239",
    "end": "67759"
  },
  {
    "text": "disruption um by the way I have uploaded these slides to sked so if uh you see me",
    "start": "67759",
    "end": "74880"
  },
  {
    "text": "putting links in here uh you can follow those or you can just take pictures uh most of these things are googleable",
    "start": "74880",
    "end": "80400"
  },
  {
    "text": "pretty quickly um so let's go through these in just",
    "start": "80400",
    "end": "86960"
  },
  {
    "text": "broad terms I Loosely categorize these on the the left uh which is where the",
    "start": "86960",
    "end": "94360"
  },
  {
    "text": "kubernetes documentation calls them involuntary disruptions into things like",
    "start": "94360",
    "end": "99680"
  },
  {
    "text": "Halt and Catch Fire events uh they are Hardware failure uh OS failure Network",
    "start": "99680",
    "end": "105439"
  },
  {
    "text": "failure anything that just stops your pod suddenly um another thing in that",
    "start": "105439",
    "end": "111079"
  },
  {
    "text": "involuntary category is out is also out of resource evictions and we'll talk about that in just a",
    "start": "111079",
    "end": "116640"
  },
  {
    "text": "minute in the voluntary category uh on the other end of the spectrum are",
    "start": "116640",
    "end": "122560"
  },
  {
    "text": "various app owner disruptions so you have a roll out you delete the deployment you restart the deployment",
    "start": "122560",
    "end": "130200"
  },
  {
    "text": "Etc and in the middle there's an interesting category that's voluntary but it really depends on your provider",
    "start": "130200",
    "end": "136640"
  },
  {
    "text": "as to how voluntary it is uh that includes cluster administrative actions",
    "start": "136640",
    "end": "141720"
  },
  {
    "text": "so this is anything that incurs a node drain so evicted by upgrade scale down",
    "start": "141720",
    "end": "146800"
  },
  {
    "text": "node repair and we're actually going to spend a chunk of time talking about this",
    "start": "146800",
    "end": "152640"
  },
  {
    "text": "category so that's categorizing it into voluntary and involuntary and a lot of that has to do with",
    "start": "153000",
    "end": "160200"
  },
  {
    "text": "um how the Pod uh how all of the communties Machinery reacts uh to that",
    "start": "160200",
    "end": "166280"
  },
  {
    "text": "particular disruptor but we can also talk about is this good disruption or bad disruption",
    "start": "166280",
    "end": "172800"
  },
  {
    "text": "now this is of course a qualitative definition but anything that's uh the Pod is interrupted when you want it to",
    "start": "172800",
    "end": "178959"
  },
  {
    "text": "be interrupted is good disruption most of you are wining workloads that are infinitely running right um and so you",
    "start": "178959",
    "end": "186120"
  },
  {
    "text": "can't not have disruption so a lot of disruption is good disruption by our",
    "start": "186120",
    "end": "191840"
  },
  {
    "text": "very broad definition of anything that causes the application to exit bad disruption anytime the Pod is",
    "start": "191840",
    "end": "197879"
  },
  {
    "text": "interrupted unexpectedly by by your own uh definitions that's bad",
    "start": "197879",
    "end": "204760"
  },
  {
    "text": "disruption so now we can start to look at that previous taxonomy again",
    "start": "205519",
    "end": "210640"
  },
  {
    "text": "and we can start to describe kind of best practices around uh these disruptors for any of this broad like",
    "start": "210640",
    "end": "217879"
  },
  {
    "text": "Hal and Catch Fire category it's mostly driven it's mostly bad disruption and",
    "start": "217879",
    "end": "223239"
  },
  {
    "text": "it's mostly driven by hardware and software quality um you've had this one hammered",
    "start": "223239",
    "end": "229640"
  },
  {
    "text": "into you I am sure but your best practice here is to design for failure",
    "start": "229640",
    "end": "235200"
  },
  {
    "text": "uh there is you know we could talk about uh making sure you get",
    "start": "235200",
    "end": "240640"
  },
  {
    "text": "hardware and software and keeping patches up to date and yada yada that's a whole other talk uh there are ways",
    "start": "240640",
    "end": "247519"
  },
  {
    "text": "communties can actually help you here um there are things like anti-affinity and topology spread constraints to make sure",
    "start": "247519",
    "end": "254360"
  },
  {
    "text": "that you actually keep pods um apart on nodes on replicated applications or",
    "start": "254360",
    "end": "260560"
  },
  {
    "text": "apart within availability zones again on the other end of the",
    "start": "260560",
    "end": "267639"
  },
  {
    "text": "spectrum is the kind of application owner disrupt disruption this is I I'll",
    "start": "267639",
    "end": "274800"
  },
  {
    "text": "say mostly good disruption config changes in kubernetes mostly",
    "start": "274800",
    "end": "281560"
  },
  {
    "text": "good obviously and this is the other part that uh has probably been hammered into you over the years the best",
    "start": "281560",
    "end": "288479"
  },
  {
    "text": "practice here is things like robust change management so you know most of",
    "start": "288479",
    "end": "293759"
  },
  {
    "text": "you here are probably practicing some form of get Ops that is a form of robust change management especially with proper",
    "start": "293759",
    "end": "299120"
  },
  {
    "text": "review Etc um there are other practices like we employ internally like uh",
    "start": "299120",
    "end": "305160"
  },
  {
    "text": "multiparty authorization for manual changes so if you ever have to go slightly off of your uh off of your",
    "start": "305160",
    "end": "312880"
  },
  {
    "text": "existing patterns making sure that you at least have someone looking over the shoulder",
    "start": "312880",
    "end": "318319"
  },
  {
    "text": "um I'm going to just there's actually multiple ways that kuties can help here I'm going to talk about a one big one",
    "start": "318319",
    "end": "325440"
  },
  {
    "text": "here uh I also mention that that things like the deployment roll out strategy are a great example for uh ways you can",
    "start": "325440",
    "end": "332919"
  },
  {
    "text": "limit disruption during cluster administrative actions um but one big",
    "start": "332919",
    "end": "339680"
  },
  {
    "text": "one that I'll mention uh uh is POD disruption budget uh because it actually",
    "start": "339680",
    "end": "345840"
  },
  {
    "text": "interacts a lot with uh some of the topics we talk about later so Drilling in on uh on",
    "start": "345840",
    "end": "353120"
  },
  {
    "text": "pdb I'm sure that most of you how many of you are familiar with",
    "start": "353120",
    "end": "358160"
  },
  {
    "text": "pdbs okay good I'd be a little Disturbed if not um but",
    "start": "358160",
    "end": "365479"
  },
  {
    "text": "pdb specifies A disruption limit so you can have it most one pod down two must be available 80% must be available",
    "start": "365479",
    "end": "373599"
  },
  {
    "text": "Etc um in general pdbs are meant to help",
    "start": "373599",
    "end": "378800"
  },
  {
    "text": "protect replicated apps uh and they can be used on any scaled resource um so it",
    "start": "378800",
    "end": "387120"
  },
  {
    "text": "uh they are honored by most of the voluntary disruptors uh and in general most of the",
    "start": "387120",
    "end": "394599"
  },
  {
    "text": "disruptors um the one case that where it's a little bit best effort is",
    "start": "394599",
    "end": "400280"
  },
  {
    "text": "actually on the next slide which is the out of resource evictions uh if you aren't using pdbs you should",
    "start": "400280",
    "end": "407080"
  },
  {
    "text": "be so if you aren't familiar with the topic go you should probably go",
    "start": "407080",
    "end": "412800"
  },
  {
    "text": "research so now we're kind of moving into the middle of this taxonomy um out of resource of are",
    "start": "412840",
    "end": "420680"
  },
  {
    "text": "interesting uh the kubernetes taxonomy puts them in the involuntary camp and",
    "start": "420680",
    "end": "426039"
  },
  {
    "text": "they are because you have to make decisions quickly on this um they aren't",
    "start": "426039",
    "end": "431280"
  },
  {
    "text": "necessarily involuntary though uh you might voluntarily configure your cluster",
    "start": "431280",
    "end": "436840"
  },
  {
    "text": "for these um again this is a broad topic uh in fact I",
    "start": "436840",
    "end": "443160"
  },
  {
    "text": "think there was even a breakout this morning talking about how to about evictions and uh tuning request quests",
    "start": "443160",
    "end": "449800"
  },
  {
    "text": "and limits um so here you have to decide",
    "start": "449800",
    "end": "455599"
  },
  {
    "text": "where your tradeoffs are uh for example if you're tuning for",
    "start": "455599",
    "end": "461960"
  },
  {
    "text": "utmost reliability for a specific pod you're probably going to want to avoid oversubscribing your nodes uh which",
    "start": "461960",
    "end": "469759"
  },
  {
    "text": "means your requests are equal to your limits around so but in general people like over",
    "start": "469759",
    "end": "478680"
  },
  {
    "text": "subscribing their and it depends on the the workload Etc um so if you're tuning",
    "start": "478680",
    "end": "483759"
  },
  {
    "text": "for cost you're going to be looking at things like pod priority",
    "start": "483759",
    "end": "489319"
  },
  {
    "text": "um resource evictions are one of the cases where pdb",
    "start": "489319",
    "end": "494639"
  },
  {
    "text": "is only off is only honored on a best effort basis and in particular when a node is running hot and has to evict",
    "start": "494639",
    "end": "501919"
  },
  {
    "text": "something um immediately uh that's a case where pdb just isn't really on it",
    "start": "501919",
    "end": "507440"
  },
  {
    "text": "at all so now kind of whittling into the",
    "start": "507440",
    "end": "513878"
  },
  {
    "text": "middle uh is this class of cluster administrative actions so it's uh node",
    "start": "514159",
    "end": "521680"
  },
  {
    "text": "drains in particular um most of these are uh actually driven",
    "start": "521680",
    "end": "529839"
  },
  {
    "text": "by automation these days um actually curious how many of you regularly take",
    "start": "529839",
    "end": "535640"
  },
  {
    "text": "nodes out of service on your own like manually use a Cube control",
    "start": "535640",
    "end": "541720"
  },
  {
    "text": "drain okay not a ton",
    "start": "541720",
    "end": "546800"
  },
  {
    "text": "but there you go so right most of these",
    "start": "546959",
    "end": "552040"
  },
  {
    "text": "actions are covered by automation these days uh in particular uh cluster",
    "start": "552040",
    "end": "557079"
  },
  {
    "text": "autoscaler um upgrades and uh things like node repair and I'm actually going",
    "start": "557079",
    "end": "563640"
  },
  {
    "text": "to focus here for the rest of the talk because this was a a surprising area where there was a lot of Divergence uh",
    "start": "563640",
    "end": "571440"
  },
  {
    "text": "between providers and and implementations um and so now I'm going",
    "start": "571440",
    "end": "577640"
  },
  {
    "text": "to talk about a particular case study so I came at this while working on a",
    "start": "577640",
    "end": "582680"
  },
  {
    "text": "framework called agones uh is anyone familiar with agon all right cool we have a few hands",
    "start": "582680",
    "end": "591440"
  },
  {
    "text": "um agonas is a framework for running uh dedicated Game servers in the cloud for",
    "start": "591440",
    "end": "598120"
  },
  {
    "text": "those of you who aren't familiar the idea behind this is uh you know you and",
    "start": "598120",
    "end": "603519"
  },
  {
    "text": "I want to play a FIFA match uh so a games we both connect to the same pod in",
    "start": "603519",
    "end": "610399"
  },
  {
    "text": "the cloud and that's what's I'm trying to indicate here by these controllers connecting to a pod and that that pod",
    "start": "610399",
    "end": "616560"
  },
  {
    "text": "runs a simulation of the game State now Game servers are an",
    "start": "616560",
    "end": "621880"
  },
  {
    "text": "interesting case study in disruption on kubernetes",
    "start": "621880",
    "end": "627680"
  },
  {
    "text": "so the problem here here is that actually each pod is a game session with",
    "start": "627680",
    "end": "633040"
  },
  {
    "text": "its own inmemory State its own basically simulation of the state of the game and these can run as as uh thin as a very",
    "start": "633040",
    "end": "642360"
  },
  {
    "text": "lightweight simulation of uh you know particular player uh you know placement",
    "start": "642360",
    "end": "648440"
  },
  {
    "text": "Etc to all the way to I'm going to render a bunch of stuff uh and then",
    "start": "648440",
    "end": "653680"
  },
  {
    "text": "pipeline that out kind of similar to how like stadia or other like uh games in Cloud would go",
    "start": "653680",
    "end": "661240"
  },
  {
    "text": "um and they all have direct player connections like straight to that pod uh",
    "start": "661680",
    "end": "667040"
  },
  {
    "text": "there's a few exceptions to that as well a single game session can last from",
    "start": "667040",
    "end": "672920"
  },
  {
    "text": "minutes mobile Games Etc to hours um and even even longer in the case of",
    "start": "672920",
    "end": "682560"
  },
  {
    "text": "uh companies that are running like MMOs on Game servers which we saw plenty of",
    "start": "682560",
    "end": "687839"
  },
  {
    "text": "as well um there are cost and complexity trade-offs and literally like game",
    "start": "687839",
    "end": "694519"
  },
  {
    "text": "development tradeoffs to implementing any sort of reasonable like checkpoint restart for Game servers uh and an",
    "start": "694519",
    "end": "702760"
  },
  {
    "text": "example of what I mean there is uh if any of you um have played a popular MMOs",
    "start": "702760",
    "end": "709839"
  },
  {
    "text": "you might have seen uh a little inter stitle popup saying hey the number of",
    "start": "709839",
    "end": "715440"
  },
  {
    "text": "players on this particular server is getting low uh you know here a reward to migrate off the server that's actually",
    "start": "715440",
    "end": "722120"
  },
  {
    "text": "an example of a company that's uh that's implemented a a form of disruption",
    "start": "722120",
    "end": "728920"
  },
  {
    "text": "control in order to scale down their game server uh a lot of times they still",
    "start": "728920",
    "end": "734279"
  },
  {
    "text": "give you something like an hour um to get off the",
    "start": "734279",
    "end": "739760"
  },
  {
    "text": "server uh so this actually presents a unique challenge in the ku's landscape because",
    "start": "740000",
    "end": "747360"
  },
  {
    "text": "the most of the kuun workloads are actually not intended for just running forever um bad pod disruption on Game",
    "start": "747360",
    "end": "755240"
  },
  {
    "text": "servers basically just means game over like you Lo lost your connection to the game server um results in a reputation",
    "start": "755240",
    "end": "763800"
  },
  {
    "text": "loss for the company itself and you know at scale this can result in real money",
    "start": "763800",
    "end": "768920"
  },
  {
    "text": "losses for uh the game company as well if you run training jobs or HPC",
    "start": "768920",
    "end": "776959"
  },
  {
    "text": "workloads uh this concept May be familiar as well um anytime you disrupt",
    "start": "776959",
    "end": "784120"
  },
  {
    "text": "a uh training job that's on you know thousands of dollars per hour",
    "start": "784120",
    "end": "789760"
  },
  {
    "text": "gpus uh you typically are going to be paying a fair amount of money to recover",
    "start": "789760",
    "end": "795079"
  },
  {
    "text": "that State uh because there's a lot of times not robust checkpoint",
    "start": "795079",
    "end": "801480"
  },
  {
    "text": "restore so as a trade-off for these pods that can't fail cluster administrators running game servers and other similar",
    "start": "802360",
    "end": "808800"
  },
  {
    "text": "workload loads have a unique set of challenges uh kind of going through these categories any of these like Hal",
    "start": "808800",
    "end": "815680"
  },
  {
    "text": "and Catch Fire events uh game over right like that's just the node uh leaving and",
    "start": "815680",
    "end": "823320"
  },
  {
    "text": "that uh the any players connected to pods on that node uh the game is",
    "start": "823320",
    "end": "829079"
  },
  {
    "text": "over so your mitigations here are things like hardware and software quality",
    "start": "829079",
    "end": "834560"
  },
  {
    "text": "better monitoring you know we heard in one of the Keynotes around trying to monitor",
    "start": "834560",
    "end": "839920"
  },
  {
    "text": "uh for events better and uh you know pull nodes out uh",
    "start": "839920",
    "end": "845279"
  },
  {
    "text": "earlier um for things like out of resource",
    "start": "845279",
    "end": "851720"
  },
  {
    "text": "evictions again your mitigation here is to make sure that these instate uh these",
    "start": "851720",
    "end": "860839"
  },
  {
    "text": "workloads that are keeping a lot of uh state in memory and aren't really capable of",
    "start": "860839",
    "end": "866360"
  },
  {
    "text": "checkpointing um have have decent Resource Management so good resources and good requests and",
    "start": "866360",
    "end": "874079"
  },
  {
    "text": "limits and configure pod priority appropriately because these are fairly high priority workloads if they can't be",
    "start": "874079",
    "end": "881279"
  },
  {
    "text": "evicted but what about these cluster administrative actions that uh are around",
    "start": "881279",
    "end": "887600"
  },
  {
    "text": "automation so let's talk about that for a second so why do I care about",
    "start": "887600",
    "end": "895120"
  },
  {
    "text": "this I care because as a uh uh Google SRE we would actually love you all to",
    "start": "895120",
    "end": "902399"
  },
  {
    "text": "use automation all the time if you could uh it actually helps us as much as it helps you um so the cluster",
    "start": "902399",
    "end": "909959"
  },
  {
    "text": "administrative actions largely cover things that would drain the node uh either by automation or you know as I",
    "start": "909959",
    "end": "916839"
  },
  {
    "text": "had you show hands directly by a cluster administrator so I've seen a lot of",
    "start": "916839",
    "end": "923199"
  },
  {
    "text": "cases where customers just basically disabled most automation on their system",
    "start": "923199",
    "end": "928519"
  },
  {
    "text": "so why do we allow automation at all in the case of cluster",
    "start": "928519",
    "end": "933639"
  },
  {
    "text": "autoscaler you you really want uh to allow cluster autoscaler to scale down",
    "start": "933639",
    "end": "940360"
  },
  {
    "text": "your nodes uh and this is especially true uh like we came at this looking at",
    "start": "940360",
    "end": "946800"
  },
  {
    "text": "Game servers and in the game uh for platforms running game servers uh",
    "start": "946800",
    "end": "954480"
  },
  {
    "text": "it's exceedingly common for for fleets of Game servers to have dial Cycles",
    "start": "954480",
    "end": "960319"
  },
  {
    "text": "where they uh you know Spike at night and kind of recede in the middle of the",
    "start": "960319",
    "end": "965759"
  },
  {
    "text": "day depending on the time zones obviously and especially heavy weekend Cycles you really don't want to be",
    "start": "965759",
    "end": "971759"
  },
  {
    "text": "managing that manually so uh you know for these apps that are hard",
    "start": "971759",
    "end": "980600"
  },
  {
    "text": "to disrupt there's an interesting tension there similarly node upgrade you want to",
    "start": "980600",
    "end": "987120"
  },
  {
    "text": "keep your software up to date and frankly if you're not using automation you're feeding your sres to the machines",
    "start": "987120",
    "end": "993600"
  },
  {
    "text": "and in the case of repair or autoscaling you're probably just leaving uh hard",
    "start": "993600",
    "end": "998680"
  },
  {
    "text": "money on the table so with that is kind of in mind for why I was looking at this in the",
    "start": "998680",
    "end": "1004560"
  },
  {
    "text": "first place how does node drain work in the first at all so your automation",
    "start": "1004560",
    "end": "1009959"
  },
  {
    "text": "wants to take a node out of service or you want to take it out manually the first thing we do is the",
    "start": "1009959",
    "end": "1016199"
  },
  {
    "text": "first thing kubernetes does is Waits and tries to honor the Pod disruption budget um if there's any uh pod that where",
    "start": "1016199",
    "end": "1025199"
  },
  {
    "text": "evicting that pod would violate the pdb uh you know it waits for that for",
    "start": "1025199",
    "end": "1031038"
  },
  {
    "text": "for that period of time and then it gracefully terminates the Pod honoring What's called the termination grace",
    "start": "1031039",
    "end": "1036319"
  },
  {
    "text": "period seconds how many of you have configured termination grace period on your pods",
    "start": "1036319",
    "end": "1041760"
  },
  {
    "text": "before good all right then maybe we didn't need this talk um",
    "start": "1041760",
    "end": "1049720"
  },
  {
    "text": "these are both lies though depending on your provider and your configuration so uh first is a little",
    "start": "1049720",
    "end": "1056240"
  },
  {
    "text": "bit of an overview of just how termination grace period works when kubernetes wants to stop a pod uh in",
    "start": "1056240",
    "end": "1062679"
  },
  {
    "text": "these voluntary eviction cases cuet will while waiting termination grace period",
    "start": "1062679",
    "end": "1069520"
  },
  {
    "text": "seconds run a pre-stop hook if there's one Define that lets you kind of do arbitrary behaviors at stop and then it",
    "start": "1069520",
    "end": "1077080"
  },
  {
    "text": "sends a Sig term signal to the applic after the pre-stop hook runs most people",
    "start": "1077080",
    "end": "1082240"
  },
  {
    "text": "are not using the pre-stop hook they're just allowing the Sig term to come but I wanted to include that in",
    "start": "1082240",
    "end": "1088720"
  },
  {
    "text": "there and then after the the tgps passes it'll send a s kill to the Pod uh if",
    "start": "1088720",
    "end": "1095600"
  },
  {
    "text": "it's still running so effectively termination grace period seconds acts as",
    "start": "1095600",
    "end": "1101480"
  },
  {
    "text": "the cleanup period for a pod it defaults to 30 seconds so most applications uh",
    "start": "1101480",
    "end": "1107600"
  },
  {
    "text": "are given a a you know decent grace period by kind of stateless web surveying uh",
    "start": "1107600",
    "end": "1115600"
  },
  {
    "text": "standards um most pod evictions offer honor some grace period which is a",
    "start": "1115600",
    "end": "1122080"
  },
  {
    "text": "really weasly way of saying it works most of the",
    "start": "1122080",
    "end": "1128320"
  },
  {
    "text": "time so now that we've actually kind of defined what this termination grace period",
    "start": "1128320",
    "end": "1134440"
  },
  {
    "text": "is and we were looking at this case study around Game Servers we can really",
    "start": "1134440",
    "end": "1140640"
  },
  {
    "text": "uh kind of Def refine our taxonomies a little more and talk about fast yielding",
    "start": "1140640",
    "end": "1148120"
  },
  {
    "text": "apps and slow yielding apps and what do I mean by that uh anything I this is a",
    "start": "1148120",
    "end": "1155159"
  },
  {
    "text": "somewhat arbitrary point but it's actually related to a a arbitrary definition but it's actually related to",
    "start": "1155159",
    "end": "1160240"
  },
  {
    "text": "a cluster autoscaler default so we can kind of think of fast yielding apps as anything that where the Pod can be",
    "start": "1160240",
    "end": "1166360"
  },
  {
    "text": "evicted in less than 10 minutes um that seems like a a long amount of",
    "start": "1166360",
    "end": "1173000"
  },
  {
    "text": "time right um and it covers most RPC servers and HTTP servers and it covers",
    "start": "1173000",
    "end": "1180000"
  },
  {
    "text": "most stateful workloads and I might get a little bit of a challenge on that but",
    "start": "1180000",
    "end": "1185159"
  },
  {
    "text": "it's most stateful workloads that are uh uh you know keeping themselves uh or",
    "start": "1185159",
    "end": "1192039"
  },
  {
    "text": "sorry maintaining their state on disk your databases Etc can typically checkpoint in this amount of time",
    "start": "1192039",
    "end": "1198880"
  },
  {
    "text": "usually much less then we get into these like slow yielding apps which is basically",
    "start": "1198880",
    "end": "1205320"
  },
  {
    "text": "everything else any workload where losing the end memory state is costly uh",
    "start": "1205320",
    "end": "1210640"
  },
  {
    "text": "in you know hard money like your training workloads in reputation like Game servers so session servers uh agon",
    "start": "1210640",
    "end": "1218640"
  },
  {
    "text": "we actually use to run other things like uh we had we have an internal customer using it to run voice chat uh we have",
    "start": "1218640",
    "end": "1225799"
  },
  {
    "text": "another one that's using it for live video transcoding um so for example if if this were streamed uh you know live",
    "start": "1225799",
    "end": "1234559"
  },
  {
    "text": "through Google Cloud uh that's actually running through a similar mechanic as a game server um many of the AI training jobs",
    "start": "1234559",
    "end": "1243919"
  },
  {
    "text": "have this attribute too of being fairly slow yielding and kind of the HPC is batch jobs as",
    "start": "1243919",
    "end": "1251320"
  },
  {
    "text": "well so now that we've talked about this notion of kind of",
    "start": "1251320",
    "end": "1259720"
  },
  {
    "text": "uh splitting our workloads up into the slow yielding and fast yielding camps let's talk about why actually allowing",
    "start": "1259720",
    "end": "1267080"
  },
  {
    "text": "automation is a challenge the first is the cloud providers and I'm sorry because I was",
    "start": "1267080",
    "end": "1274559"
  },
  {
    "text": "part of this did not make it easy for you um we all chose different Mechanics",
    "start": "1274559",
    "end": "1280480"
  },
  {
    "text": "for things like upgrades uh at at",
    "start": "1280480",
    "end": "1286039"
  },
  {
    "text": "Google gke on a standard surge upgrade will",
    "start": "1286039",
    "end": "1292880"
  },
  {
    "text": "uh basically just disrupt your pod if the uh combination of the pdb plus",
    "start": "1292880",
    "end": "1300039"
  },
  {
    "text": "termination grace period uh lasts more than an hour on so we chose that the",
    "start": "1300039",
    "end": "1307360"
  },
  {
    "text": "upgrade operation itself uh has priority uh on AKs and eks they both",
    "start": "1307360",
    "end": "1313919"
  },
  {
    "text": "fail the upgrade operation after uh 15 minutes or 30 minutes",
    "start": "1313919",
    "end": "1320080"
  },
  {
    "text": "um those are both configurable and so they chose that the upgrade operation",
    "start": "1320080",
    "end": "1325159"
  },
  {
    "text": "should uh kind of more more toil towards the uh whoever is maintaining the",
    "start": "1325159",
    "end": "1331320"
  },
  {
    "text": "upgrade in the first place um one advice here is a depending",
    "start": "1331320",
    "end": "1338400"
  },
  {
    "text": "on your provider you might just be able to bump the upgrade operation uh like timeouts associated",
    "start": "1338400",
    "end": "1345400"
  },
  {
    "text": "with disruption and then B uh a lot of the cloud providers are",
    "start": "1345400",
    "end": "1351400"
  },
  {
    "text": "actually starting to provide automated blue green upgrades where they you know",
    "start": "1351400",
    "end": "1356720"
  },
  {
    "text": "scale down one node pool while another uh scale down one set of nodes while the other set of nodes uh scales",
    "start": "1356720",
    "end": "1365480"
  },
  {
    "text": "up uh with a different set of choices is",
    "start": "1367039",
    "end": "1372080"
  },
  {
    "text": "the autoscalers cluster autoscaler and Carpenter uh both honor the",
    "start": "1372080",
    "end": "1380000"
  },
  {
    "text": "pdb they both uh honor the the termination grace period seconds to a",
    "start": "1380000",
    "end": "1386600"
  },
  {
    "text": "point um how many of you knew that uh cluster autoscaler will actually just",
    "start": "1386600",
    "end": "1392159"
  },
  {
    "text": "terminate your pod after 10 minutes by default all right few",
    "start": "1392159",
    "end": "1398640"
  },
  {
    "text": "hands um so this might be a surprise to you uh so you get no warning no status",
    "start": "1398640",
    "end": "1406159"
  },
  {
    "text": "no annotation on the Pod anything cluster autoscaler if you do not change its defaults will just disrupt your pod",
    "start": "1406159",
    "end": "1412880"
  },
  {
    "text": "regardless of what you set your termination grace period seconds to uh Carpenter actually uses a",
    "start": "1412880",
    "end": "1418880"
  },
  {
    "text": "configurable per node pool uh maximum and in both of them you do have a",
    "start": "1418880",
    "end": "1425039"
  },
  {
    "text": "concern because like scale down has some bandwidth associated with it too like",
    "start": "1425039",
    "end": "1430360"
  },
  {
    "text": "obviously if these uh workloads yield slowly you're going to have",
    "start": "1430360",
    "end": "1436799"
  },
  {
    "text": "um uh nodes are kind of slow to to be drained uh and they both have like a",
    "start": "1436799",
    "end": "1443720"
  },
  {
    "text": "magic annotation where you can say don't evict me",
    "start": "1443720",
    "end": "1448640"
  },
  {
    "text": "ever so now that we've seen this we have a few kind of best practices you can use",
    "start": "1449080",
    "end": "1455440"
  },
  {
    "text": "for these slower yielding apps uh you can ensure that your app first off is",
    "start": "1455440",
    "end": "1461400"
  },
  {
    "text": "ensure that your app uh supports Sig term in some way if you want to support",
    "start": "1461400",
    "end": "1466640"
  },
  {
    "text": "automation you need to be cooperative with the uh eviction system as it stands",
    "start": "1466640",
    "end": "1472279"
  },
  {
    "text": "you can for like Legacy apps or some other reason use a pre-op hook to block",
    "start": "1472279",
    "end": "1477760"
  },
  {
    "text": "Sig term uh but it's a little bit tricky tune the termination grace period",
    "start": "1477760",
    "end": "1483520"
  },
  {
    "text": "seconds in your in the Pod specification tune the maximum termination grace period seconds for",
    "start": "1483520",
    "end": "1490039"
  },
  {
    "text": "your auto scaler so cluster Auto scaler and Carpenter both support ways to tune",
    "start": "1490039",
    "end": "1495240"
  },
  {
    "text": "that uh tune your upgrade or look into automated uh blue green upgrades so if",
    "start": "1495240",
    "end": "1502200"
  },
  {
    "text": "you have an hourong workload you may need to tune that as well",
    "start": "1502200",
    "end": "1507279"
  },
  {
    "text": "um and a kind of advanced case but if you know what your cycles look like uh",
    "start": "1507279",
    "end": "1513799"
  },
  {
    "text": "you can also try to aine slower yielding apps to the same nodes typically you",
    "start": "1513799",
    "end": "1520120"
  },
  {
    "text": "want them all to kind of terminate near the same time too that is a longer conversation but it's definitely",
    "start": "1520120",
    "end": "1525520"
  },
  {
    "text": "something you can uh Tinker with if you're interested",
    "start": "1525520",
    "end": "1530320"
  },
  {
    "text": "in Aon we actually tried to build an eviction API to make this a little easier this is a little bit of a an eyes",
    "start": "1532200",
    "end": "1539799"
  },
  {
    "text": "sore but uh the idea was we have a little tag that says it's always safe to",
    "start": "1539799",
    "end": "1545720"
  },
  {
    "text": "evict or it's never safe to evict um this translated into the goal was to",
    "start": "1545720",
    "end": "1554720"
  },
  {
    "text": "translate a declared evlen into appropriate po policies for a given",
    "start": "1554720",
    "end": "1559880"
  },
  {
    "text": "environment uh I did this when gka autopilot didn't yet support the safe to",
    "start": "1559880",
    "end": "1566480"
  },
  {
    "text": "evict equals false flag so there was a few other machinations we needed to do basically I wanted a way for people to",
    "start": "1566480",
    "end": "1572600"
  },
  {
    "text": "be able to translate uh agon's game server specifications and have them kind of",
    "start": "1572600",
    "end": "1578799"
  },
  {
    "text": "work portably between at least gka standard and autopilot with hooks available for other",
    "start": "1578799",
    "end": "1586559"
  },
  {
    "text": "clouds but that's is honestly if you were interested in uh",
    "start": "1586799",
    "end": "1593559"
  },
  {
    "text": "doing this on your own workloads you could probably do something similar with just a straight policy agent or a custom",
    "start": "1593559",
    "end": "1600520"
  },
  {
    "text": "web hook to enforce policies that are appropriate for your work workloads uh in particular if your",
    "start": "1600520",
    "end": "1607840"
  },
  {
    "text": "workloads all support Sig term so they're like you know uh let's call them",
    "start": "1607840",
    "end": "1613480"
  },
  {
    "text": "digital native apps or modern apps right uh that know that Sig term means I need",
    "start": "1613480",
    "end": "1618840"
  },
  {
    "text": "to clean up now you could probably just use the termination grace period seconds",
    "start": "1618840",
    "end": "1625000"
  },
  {
    "text": "as an indicator and say you know if tgps is this then I need to follow this set",
    "start": "1625000",
    "end": "1631200"
  },
  {
    "text": "of steps and similarly you know you can also then ensure that they those",
    "start": "1631200",
    "end": "1637039"
  },
  {
    "text": "workloads are scheduled onto node pools or clusters where that uh where the",
    "start": "1637039",
    "end": "1643559"
  },
  {
    "text": "cluster autoscaler and upgrades are appropriately scheduled appropriately configured",
    "start": "1643559",
    "end": "1649320"
  },
  {
    "text": "um so a lot of this is kind of just a you know you can make this a little bit",
    "start": "1649320",
    "end": "1655480"
  },
  {
    "text": "magical on your own uh just by looking at the termination grace period seconds",
    "start": "1655480",
    "end": "1661320"
  },
  {
    "text": "and it's kind of a disservice that the cluster autoscaler actually just kind of violates it willy-nilly um but you know that's an example of a",
    "start": "1661320",
    "end": "1668600"
  },
  {
    "text": "way to kind of get around it um and and and to make your workloads",
    "start": "1668600",
    "end": "1673919"
  },
  {
    "text": "portable in case you for instance want to test out both cluster AOS scaler and Carpenter or you're porting between",
    "start": "1673919",
    "end": "1680360"
  },
  {
    "text": "different clouds and you're running different things on each one Etc so the two biggest things you need to consider",
    "start": "1680360",
    "end": "1686080"
  },
  {
    "text": "if you wanted to implement something like what a gones does is does the app do the right thing with Sig term",
    "start": "1686080",
    "end": "1691880"
  },
  {
    "text": "otherwise you're going to have to do something different and how long does it take after Sig term before it's safe to",
    "start": "1691880",
    "end": "1697360"
  },
  {
    "text": "terminate which is the tgps uh conversation so",
    "start": "1697360",
    "end": "1703799"
  },
  {
    "text": "takeaways pod disruption on kubernetes is a series of tradeoffs it's a multivariate problem of cost human toil",
    "start": "1703799",
    "end": "1712240"
  },
  {
    "text": "complexity of the application Etc think about the cost of disruption",
    "start": "1712240",
    "end": "1718480"
  },
  {
    "text": "dis uh disruption is not a binary thing of this app can be disrupted or not",
    "start": "1718480",
    "end": "1724200"
  },
  {
    "text": "disruption is uh a cost associated with what is the cost",
    "start": "1724200",
    "end": "1730760"
  },
  {
    "text": "of disrupting this particular pod and engineer appropriately so for application",
    "start": "1730760",
    "end": "1736279"
  },
  {
    "text": "owners um think about can you introduce some sort of checkpointing or is it too expensive in",
    "start": "1736279",
    "end": "1741679"
  },
  {
    "text": "complexity of resources so if you do have an application like a game server you know how do you convince the game",
    "start": "1741679",
    "end": "1747960"
  },
  {
    "text": "developer to allow some sort of checkpointing uh introduce you know",
    "start": "1747960",
    "end": "1755120"
  },
  {
    "text": "uh during cutcenes we reconnect to the clients stuff like that right for app",
    "start": "1755120",
    "end": "1761480"
  },
  {
    "text": "owners and administrators with fast yielding apps make sure to tune your pdbs consider things like topology",
    "start": "1761480",
    "end": "1768840"
  },
  {
    "text": "Etc uh with slower yielding apps also make sure to tune your your termination grace period seconds and tune your",
    "start": "1768840",
    "end": "1775799"
  },
  {
    "text": "automation appropriately and with that I am going to take some questions um and just",
    "start": "1775799",
    "end": "1783840"
  },
  {
    "text": "before I do I will be at the Google Booth from like 4: to 6: p.m today if you have any questions you just want to",
    "start": "1783840",
    "end": "1790080"
  },
  {
    "text": "chat with me about too so [Applause]",
    "start": "1790080",
    "end": "1800799"
  },
  {
    "text": "all right uh hello I have a question um so famously a lot of the workload operators like replica set stateful set",
    "start": "1800799",
    "end": "1807320"
  },
  {
    "text": "they don't use the Pod eviction API they just go ahead and uh Delete the Pod and uh I assume you know similarly humans",
    "start": "1807320",
    "end": "1814000"
  },
  {
    "text": "can fat finger and delete pods controller can delete pods for all sorts of reasons uh I think the agonas case is",
    "start": "1814000",
    "end": "1819679"
  },
  {
    "text": "very interesting because the Pod is essentially stateful right you don't want to disconnect people from the game server um I Wonder has there any um",
    "start": "1819679",
    "end": "1827279"
  },
  {
    "text": "interest in see apps or any other uh interest groups before to look into maybe some sort of external um system to",
    "start": "1827279",
    "end": "1834559"
  },
  {
    "text": "consult to before allowing a pod to be evicted or deleted in the first place that's a super interesting question so",
    "start": "1834559",
    "end": "1840840"
  },
  {
    "text": "the the question was is there a notion of like a central uh disruption controller uh to ask can this pod be",
    "start": "1840840",
    "end": "1848559"
  },
  {
    "text": "evicted right now disrupted right now uh I don't know of an effort like that I'd",
    "start": "1848559",
    "end": "1853919"
  },
  {
    "text": "be actually super interested in it um but uh that is actually how some like",
    "start": "1853919",
    "end": "1859720"
  },
  {
    "text": "Google systems are arranged for instance is instead of like trying to Federate disruption outward we try to like kind",
    "start": "1859720",
    "end": "1865639"
  },
  {
    "text": "of centralize it in and say can this thing be disrupted so we can make like Central decisions around this um and I",
    "start": "1865639",
    "end": "1872639"
  },
  {
    "text": "think it's something worth considering um",
    "start": "1872639",
    "end": "1879080"
  },
  {
    "text": "cool any other",
    "start": "1879279",
    "end": "1882720"
  },
  {
    "text": "questions awesome well thank you all",
    "start": "1886919",
    "end": "1893159"
  }
]