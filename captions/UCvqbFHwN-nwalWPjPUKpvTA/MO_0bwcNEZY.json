[
  {
    "start": "0",
    "end": "63000"
  },
  {
    "text": "this talk is about how we moved the core of our traffic management product from an engine X based proxy core over to",
    "start": "0",
    "end": "6390"
  },
  {
    "text": "envoy over the course of about six months starting last late last summer and finalizing very late last year",
    "start": "6390",
    "end": "13730"
  },
  {
    "text": "beginning of this year so background I was a Twitter from 2009 to 12 when",
    "start": "13730",
    "end": "21660"
  },
  {
    "text": "Twitter was moving a lot of things off the rails monolith on to JVM services and then from big JVM services into",
    "start": "21660",
    "end": "27720"
  },
  {
    "text": "smaller JVM services and a lot of what became sort of proto cloud native if you",
    "start": "27720",
    "end": "33059"
  },
  {
    "text": "look at what Twitter was doing in 2012 or so it looks a lot like cloud native today - all the nice things like",
    "start": "33059",
    "end": "38790"
  },
  {
    "text": "kubernetes envoy linker do all this other stuff that came out after which we",
    "start": "38790",
    "end": "44399"
  },
  {
    "text": "would have loved to use we were going to built ourselves and did early versions of I left Twitter in 2012 and with the",
    "start": "44399",
    "end": "50309"
  },
  {
    "text": "nest and LED server site engineering there and didn't get to use a lot of the tools that we'd built at Twitter because",
    "start": "50309",
    "end": "55739"
  },
  {
    "text": "they didn't quite exist yet and started turbine Labs really with a goal of productizing a lot of those practices",
    "start": "55739",
    "end": "61829"
  },
  {
    "text": "and ways that other people could use this is about migrations and so we want",
    "start": "61829",
    "end": "67710"
  },
  {
    "start": "63000",
    "end": "63000"
  },
  {
    "text": "to kind of set the stage here for why would you even do a migration these things often fail they're really hard",
    "start": "67710",
    "end": "74060"
  },
  {
    "text": "this talk was rated as advanced skill level which in hindsight I was a little nervous about it because technically",
    "start": "74060",
    "end": "79860"
  },
  {
    "text": "this stuff isn't it's not rocket science socially migrations are really hard to",
    "start": "79860",
    "end": "85020"
  },
  {
    "text": "pull off and having gone through a bunch of pretty big ones they're difficult not",
    "start": "85020",
    "end": "90030"
  },
  {
    "text": "in the same way that doing like distributed consensus is hard but they are difficult in the sense that you have",
    "start": "90030",
    "end": "95460"
  },
  {
    "text": "to get a lot of people to buy into a lot of stuff you have to do risk a lot of things and from a process perspective",
    "start": "95460",
    "end": "101640"
  },
  {
    "text": "and a political perspective they're much more difficult than a lot of the deeper technical challenges I think so why",
    "start": "101640",
    "end": "108899"
  },
  {
    "text": "would you do them they are one of the only ways to scale ibly get tech debt",
    "start": "108899",
    "end": "115590"
  },
  {
    "text": "fixed and so will Larsen who's a manager at stripe has a great post that lays out",
    "start": "115590",
    "end": "120869"
  },
  {
    "text": "the case that most systems are really only designed to grow an order of magnitude beyond their initial design constraints then you have to start",
    "start": "120869",
    "end": "126750"
  },
  {
    "text": "looking at other systems to get you to that next level and a lot of people",
    "start": "126750",
    "end": "132660"
  },
  {
    "text": "don't do that soon enough and end up kind of grinding out that last little bit and it's painful so this talk is",
    "start": "132660",
    "end": "139290"
  },
  {
    "text": "about making your envoy migration easier but a lot of the practices and the principles apply to general migrations",
    "start": "139290",
    "end": "144300"
  },
  {
    "text": "and one of the nice things about envoy as a fluid proxy in front of things is it makes all kinds of migrations easier",
    "start": "144300",
    "end": "150660"
  },
  {
    "text": "it's an extra benefit a disclaimer I didn't do much of the work outlined here",
    "start": "150660",
    "end": "157160"
  },
  {
    "text": "my name's not on here but I'm here to more or less do a read out an analysis",
    "start": "157160",
    "end": "162510"
  },
  {
    "text": "of all the stuff that our great engineers did along the way turbine Labs",
    "start": "162510",
    "end": "167879"
  },
  {
    "start": "167000",
    "end": "167000"
  },
  {
    "text": "the company we started after coming out of Twitter and nest is a traffic",
    "start": "167879",
    "end": "174180"
  },
  {
    "text": "management application that's designed to give a lot of the practices we built at Twitter and put those into the hands",
    "start": "174180",
    "end": "179670"
  },
  {
    "text": "of the wider engineering population proxies are the technical core of that",
    "start": "179670",
    "end": "184860"
  },
  {
    "text": "and so we're in a pretty unique position as being a vendor selling stuff but also a consumer proxy tech and kind of",
    "start": "184860",
    "end": "191640"
  },
  {
    "text": "connoisseurs of the differences between H a proxy engine X envoy various things so interesting place to be we have lots",
    "start": "191640",
    "end": "199200"
  },
  {
    "text": "of opinions this on board migration sums up a lot of them so step one here and",
    "start": "199200",
    "end": "206849"
  },
  {
    "text": "sort of kind of sensing inception of the company was we are going to use a proxy technology that exists at the time in",
    "start": "206849",
    "end": "214530"
  },
  {
    "text": "late 2015 the reasonable options who are engine X and H a proxy we built the",
    "start": "214530",
    "end": "220409"
  },
  {
    "text": "product on top of engine X this is our early plan straight out of 2015 and",
    "start": "220409",
    "end": "226409"
  },
  {
    "text": "comments on this slide it's a very bottom this is kind of a train wreck and",
    "start": "226409",
    "end": "232049"
  },
  {
    "start": "227000",
    "end": "227000"
  },
  {
    "text": "it was really so about the slide this is throughout the stock I'm not saying",
    "start": "232049",
    "end": "237330"
  },
  {
    "text": "engine X is a bad piece of software by any means it served us very well this was mostly about the graphics that I did",
    "start": "237330",
    "end": "243830"
  },
  {
    "text": "but also as we'll go through the kind of rough spots of the architecture we built",
    "start": "243830",
    "end": "249120"
  },
  {
    "text": "it was it was pretty high friction for us trying to deal with the cloud native type dynamic high cardinality frequently",
    "start": "249120",
    "end": "256949"
  },
  {
    "text": "changing environment this is the initial product we built and notice it looks",
    "start": "256949",
    "end": "262710"
  },
  {
    "text": "almost exactly the same as this but we had somebody better do pictures so it's not a trainwreck ish circles and",
    "start": "262710",
    "end": "271780"
  },
  {
    "text": "this worked so we built a lot of stuff on engine ax and we got the system working it was great you could do",
    "start": "271780",
    "end": "277300"
  },
  {
    "text": "Bluegreen deploys Canaries header based routing it was super cool so why move",
    "start": "277300",
    "end": "283270"
  },
  {
    "text": "and I think if you're looking at practice today a lot of you have who's using engine X on kubernetes and",
    "start": "283270",
    "end": "290730"
  },
  {
    "text": "good-good H a proxy do you say to H a proxy or how a proxy Joey ends now okay",
    "start": "290730",
    "end": "297190"
  },
  {
    "text": "I don't know how to pronounce it so there's a bunch of things we looked at",
    "start": "297190",
    "end": "302430"
  },
  {
    "text": "in our architecture as we were considering this moved envoy at about",
    "start": "302430",
    "end": "308290"
  },
  {
    "text": "the same time we started our company Matt Klein had left Twitter to go to lift and one of his first tasks we knew",
    "start": "308290",
    "end": "313750"
  },
  {
    "text": "was to build a proxy to help lift manage traffic internally and so it's a weird sort of parallel story arc there that we",
    "start": "313750",
    "end": "321070"
  },
  {
    "text": "were talking with Pete their VP of engineering and Matt and knew that they were gonna build a thing that would",
    "start": "321070",
    "end": "326860"
  },
  {
    "text": "likely be better suited for our needs that engine acts unfortunately didn't exist and being venture funded who we",
    "start": "326860",
    "end": "332979"
  },
  {
    "text": "needed to build a thing so we chose nginx and here's where we ended up the the first thing is that the base routing",
    "start": "332979",
    "end": "340300"
  },
  {
    "text": "primitives are not are not the greatest so engine X has locations you can kind of route traffic but this notion of",
    "start": "340300",
    "end": "346840"
  },
  {
    "text": "probabilistic releases like five percenter traffic to a thing and 95% to the other and gradually shift that",
    "start": "346840",
    "end": "351850"
  },
  {
    "text": "across like a sliding blue-green deploy like wasn't in there and extending it meant shipping a custom module so that's",
    "start": "351850",
    "end": "359740"
  },
  {
    "text": "like strike one we had to ship a custom engine X build to get our functionality out to people which from an adoption",
    "start": "359740",
    "end": "364900"
  },
  {
    "text": "perspective is kind of a scary thing the other thing is that the upstream constructs they had weren't super",
    "start": "364900",
    "end": "372160"
  },
  {
    "text": "full-featured in that a lot of systems expect an upstream to really be a host important to wait and that's good from",
    "start": "372160",
    "end": "379360"
  },
  {
    "text": "for some things but with modern systems you get a lot of labels and metadata and",
    "start": "379360",
    "end": "384850"
  },
  {
    "text": "tags etc on instances so you know more about that workload than just where it lives",
    "start": "384850",
    "end": "390160"
  },
  {
    "text": "and we wanted to be able to route based on the version of software deployed or what get branch it came from or whether this was a QA or a product",
    "start": "390160",
    "end": "396460"
  },
  {
    "text": "system and so we had to add that to our custom module as well the other thing is",
    "start": "396460",
    "end": "403509"
  },
  {
    "text": "that even after we'd added all that to the custom module configuration was still file based and so for us shipping",
    "start": "403509",
    "end": "409479"
  },
  {
    "text": "a product and using it internally both involved a lot of just copying files all over the place and for the most part",
    "start": "409479",
    "end": "415330"
  },
  {
    "text": "this works but when you have enough of them you'll end up with like a file didn't get pushed in one box and things",
    "start": "415330",
    "end": "420699"
  },
  {
    "text": "are weird and we don't know why until you go check something all the files and find out there's an outlier and have to",
    "start": "420699",
    "end": "425860"
  },
  {
    "text": "go fix it the other thing is that every time that config changes you have to reload the process an index is a great",
    "start": "425860",
    "end": "431680"
  },
  {
    "text": "job on reloads but it's still the case that you end up with worker drift and things draining connections etc etc and",
    "start": "431680",
    "end": "438690"
  },
  {
    "text": "it's a little little clunky another",
    "start": "438690",
    "end": "443830"
  },
  {
    "text": "thing is that observability was important for us from the get-go when you're trying to do routing across multiple versions of stuff you want to",
    "start": "443830",
    "end": "450190"
  },
  {
    "text": "know what the behavior differences are between multiple versions of stuff and so getting the good stats out of any",
    "start": "450190",
    "end": "455590"
  },
  {
    "text": "proxy really at that time meant having a log tailor that would parse the access logs and give you the stats and send",
    "start": "455590",
    "end": "462159"
  },
  {
    "text": "them off to your system so you could parse them and so having these like necessary agents co-located with in",
    "start": "462159",
    "end": "468610"
  },
  {
    "text": "genetics meant that we had to ship this whole ball of stuff out to all of our customers and internally - it wasn't as",
    "start": "468610",
    "end": "475960"
  },
  {
    "text": "simple like lightweight sidecar here's the whole proxy operationalized in this like very non idiomatic docker single",
    "start": "475960",
    "end": "483370"
  },
  {
    "text": "process system and like you should just install this it'll just work don't worry about it it did work but people still",
    "start": "483370",
    "end": "491620"
  },
  {
    "text": "worried about it and then the last limitation was engine X was really at",
    "start": "491620",
    "end": "497259"
  },
  {
    "text": "the time built for TCP load balancing in HTTP 1 which was you know that covers a",
    "start": "497259",
    "end": "502780"
  },
  {
    "text": "majority of traffic HTTP - and 2015 was becoming a thing ERP C was very nascent but we thought",
    "start": "502780",
    "end": "510009"
  },
  {
    "text": "going forward that people would be skewing much more heavily - G RPC we'd",
    "start": "510009",
    "end": "515860"
  },
  {
    "text": "seen the benefits of similar systems at Twitter and thought that we should have support for that in engine X at the time",
    "start": "515860",
    "end": "522130"
  },
  {
    "text": "only had kind of HTTP to support so HTTP 2 on the front found out too upone in the back not the greatest for",
    "start": "522130",
    "end": "529290"
  },
  {
    "text": "into end connections across the deep service RPC chain so Susur realize we're",
    "start": "529290",
    "end": "538140"
  },
  {
    "text": "not in Sweden but this is an old Twitter inside joke for the proxy call of envoys",
    "start": "538140",
    "end": "545490"
  },
  {
    "text": "see what we can do to help here so this is what we actually can build with envoy",
    "start": "545490",
    "end": "552240"
  },
  {
    "text": "and so this is a much cleaner break of there's envoy and there's management stuff and we'll go through the reasons",
    "start": "552240",
    "end": "558510"
  },
  {
    "text": "why why that's possible and whether it's a better solution both for us as a",
    "start": "558510",
    "end": "564420"
  },
  {
    "text": "vendor for people as a consumer for operators you know for everybody everybody concerned so the benefits we",
    "start": "564420",
    "end": "572940"
  },
  {
    "start": "571000",
    "end": "571000"
  },
  {
    "text": "looked at as envoy had well these are",
    "start": "572940",
    "end": "578070"
  },
  {
    "text": "the benefits envoy has now we'll go through how we got there more sophisticated routing when you're",
    "start": "578070",
    "end": "583530"
  },
  {
    "text": "working in the service mesh style environment or even at the edge there's just a lot more you can do now with modern systems that have tags labels",
    "start": "583530",
    "end": "589950"
  },
  {
    "text": "more information about workloads than you had before changes are easier to get in this is just like a non-functional",
    "start": "589950",
    "end": "597420"
  },
  {
    "text": "feature but our ability to get changes made directly to envoy has been much better than our ability to push a patch",
    "start": "597420",
    "end": "603240"
  },
  {
    "text": "to nginx and it's not really a knock-on engine X so much but it's an older",
    "start": "603240",
    "end": "609330"
  },
  {
    "text": "project there's more inertia there it's hard to make fundamental changes upstream definitions are much much",
    "start": "609330",
    "end": "616020"
  },
  {
    "text": "richer envoys notion of an endpoint has arbitrary GRP c structs so you can shove",
    "start": "616020",
    "end": "621480"
  },
  {
    "text": "whatever you want in there is an endpoint provider which is great the whole config via service design is",
    "start": "621480",
    "end": "627480"
  },
  {
    "text": "pretty novel for a proxy so for people not as familiar with envoy you can still",
    "start": "627480",
    "end": "633120"
  },
  {
    "text": "configure it with files but it also defines G RPC interfaces that will deliver config and so you implement the",
    "start": "633120",
    "end": "639450"
  },
  {
    "text": "service you point envoy at it and it will say hey give me my clusters give me my listeners give me my routes and if",
    "start": "639450",
    "end": "644820"
  },
  {
    "text": "they change let me know and so your entire Envoy fleet is connecting to a management service getting config which",
    "start": "644820",
    "end": "650520"
  },
  {
    "text": "means you have a central point of control for Envoy config changes which is great the other thing that's pretty",
    "start": "650520",
    "end": "656970"
  },
  {
    "text": "recent is the ability to stream logs over G RPC as well so instead of having to run a log tailor",
    "start": "656970",
    "end": "661980"
  },
  {
    "text": "you implement a log sync and you can do all your processing central lights as well and there's a wide range of",
    "start": "661980",
    "end": "666990"
  },
  {
    "text": "protocol supported so not just HTTP one through two I guess that's all they're up to now",
    "start": "666990",
    "end": "673110"
  },
  {
    "text": "but there's Redis dynamo it's a couple of others and adding new new",
    "start": "673110",
    "end": "679410"
  },
  {
    "text": "protocols is pretty straightforward so this is all good we looked in in mid-summer as like sounds great but",
    "start": "679410",
    "end": "686480"
  },
  {
    "start": "685000",
    "end": "685000"
  },
  {
    "text": "features aren't necessarily enough to kind of bet a company or production site",
    "start": "686480",
    "end": "691560"
  },
  {
    "text": "on so you get into like the non-functional requirements of a migration I'm gonna do this thing technically it seems better there's a",
    "start": "691560",
    "end": "698220"
  },
  {
    "text": "lot of features I want but if it's only gonna be up fifty percent of the time that's not great and if it's not",
    "start": "698220",
    "end": "703470"
  },
  {
    "text": "supported that's not great and so we went through these as the is a qualitative aspects of an envoy",
    "start": "703470",
    "end": "709650"
  },
  {
    "text": "migration so how supported is it is a lightweight if we're going to have people deploy this aside cars it's",
    "start": "709650",
    "end": "715440"
  },
  {
    "text": "important is it fast enough if you're going to introduce this as a hop between",
    "start": "715440",
    "end": "720660"
  },
  {
    "text": "every service call you don't want it to be super slow and then predictable latency is also pretty important so the",
    "start": "720660",
    "end": "727260"
  },
  {
    "text": "way to experience a Twitter working with proxies written on the JVM and for the most part performance is very good but",
    "start": "727260",
    "end": "734190"
  },
  {
    "text": "you have surprising outliers when there's full GCS and stuff like that that can be not good for your long tail",
    "start": "734190",
    "end": "739470"
  },
  {
    "text": "agency so with envoy now I look at the",
    "start": "739470",
    "end": "745080"
  },
  {
    "text": "last release so between one six and one five on Envoy so 71 committers on the project it's maintained by pretty big",
    "start": "745080",
    "end": "753150"
  },
  {
    "text": "companies and us so lift Google Apple and us with eleven people it's kind of",
    "start": "753150",
    "end": "759960"
  },
  {
    "text": "an outlier and so these aren't people that commit these are people who are maintainer x' of the project 50% of the",
    "start": "759960",
    "end": "766410"
  },
  {
    "text": "commits actually greater than 50% came from people not in those orgs so there's",
    "start": "766410",
    "end": "772470"
  },
  {
    "text": "a pretty diverse set of people committing the other nice thing about usage is that it's not just use it lifts",
    "start": "772470",
    "end": "778710"
  },
  {
    "text": "it's fairly unique that it sprang from lift open sourced already and full production there is no real incubation",
    "start": "778710",
    "end": "784290"
  },
  {
    "text": "period where it wasn't prod ready but the things Google is doing with envoy are very different from a use case",
    "start": "784290",
    "end": "789480"
  },
  {
    "text": "perspective and lift and I put Verizon is doing with it is very different than what lift it's using",
    "start": "789480",
    "end": "794579"
  },
  {
    "text": "it for so there's a pretty broad set of use cases it's applied to that made us more comfortable it was a general-purpose effective proxy for a",
    "start": "794579",
    "end": "801959"
  },
  {
    "text": "variety of workloads that we'd be delivering so if anybody follows Matt",
    "start": "801959",
    "end": "808980"
  },
  {
    "start": "805000",
    "end": "805000"
  },
  {
    "text": "the Envoy author on Twitter you know he has strong opinions about C++ still being cool enough to write software in",
    "start": "808980",
    "end": "817850"
  },
  {
    "text": "it's controversial apparently so I mean the benefit C++ gives envoy like not",
    "start": "817850",
    "end": "824339"
  },
  {
    "text": "directly you can write bad code in any language but it has a pretty small footprint resource wise that makes it",
    "start": "824339",
    "end": "830579"
  },
  {
    "text": "very suitable for running in a sidecar manner there's no garbage collection which means it has a very predictable",
    "start": "830579",
    "end": "835860"
  },
  {
    "text": "latency profile and it's fast enough like if you stack it up against Engine X",
    "start": "835860",
    "end": "840959"
  },
  {
    "text": "or H a proxy now it's not going to win a benchmark that you contrived but for the flexibility and other like",
    "start": "840959",
    "end": "847889"
  },
  {
    "text": "non-functional or even other functional requirements it has it's fast enough to trade-off for the additional management",
    "start": "847889",
    "end": "854220"
  },
  {
    "text": "capabilities you get and so our process last summer was really watching that",
    "start": "854220",
    "end": "860040"
  },
  {
    "text": "curve of support community speed footprint and saying like is this the",
    "start": "860040",
    "end": "866309"
  },
  {
    "text": "right time for us to move from engine X to envoy and that all converged mid to late last summer we decided to make the",
    "start": "866309",
    "end": "872730"
  },
  {
    "text": "port so let's do a migration and so we",
    "start": "872730",
    "end": "880259"
  },
  {
    "text": "won't get into like technical like commit by commit aspects of this migration but we'll go through go",
    "start": "880259",
    "end": "887910"
  },
  {
    "start": "887000",
    "end": "887000"
  },
  {
    "text": "through this so things you consider after you've decided this is a good idea",
    "start": "887910",
    "end": "893419"
  },
  {
    "text": "so Engine X and H a proxy have a lot of features they've been around for a long",
    "start": "893419",
    "end": "898589"
  },
  {
    "text": "time and you probably don't use all of them but you need to make sure that",
    "start": "898589",
    "end": "904410"
  },
  {
    "text": "there's there's some way for you to ensure that like your envoy deploy is going to match up except ibly with your",
    "start": "904410",
    "end": "910110"
  },
  {
    "text": "engine X and H a proxy deploy and the way we did that is we started off with a higher level of abstraction for config",
    "start": "910110",
    "end": "915540"
  },
  {
    "text": "and so instead of our source of truth being engine X comp distributed everywhere",
    "start": "915540",
    "end": "921209"
  },
  {
    "text": "we had a data model that led us to find the attributes we needed in an in genetics comp file and that allowed us",
    "start": "921209",
    "end": "926819"
  },
  {
    "text": "to come up with an equivalent envoy config and match those things up and so when we rolled out we knew that envoy",
    "start": "926819",
    "end": "932040"
  },
  {
    "text": "would behave identically to the nginx based system that was there before the other thing is there just may be",
    "start": "932040",
    "end": "938220"
  },
  {
    "text": "straight feature gaps that you can't you can't address and so you really have had three choices contribute to core highly",
    "start": "938220",
    "end": "946589"
  },
  {
    "text": "recommended push to stuff back to the open source project so everybody everybody wins envoy has a really",
    "start": "946589",
    "end": "953369"
  },
  {
    "text": "extensible filter mechanism so very much in the vein of like working with with Metis or other filter based network",
    "start": "953369",
    "end": "959759"
  },
  {
    "text": "pipelines you can implement your own stuff pretty easily there has Lewis support now so you can script it up for",
    "start": "959759",
    "end": "965100"
  },
  {
    "text": "prototypes and then the higher level abstraction thing we did and our",
    "start": "965100",
    "end": "971100"
  },
  {
    "text": "approach was when we found gaps we just worked to commit them back to open source envoy which was great it was",
    "start": "971100",
    "end": "979559"
  },
  {
    "text": "pretty easy to get full request through there's high code review standards but that's a good thing not a bad thing",
    "start": "979559",
    "end": "985439"
  },
  {
    "text": "and so we committed pretty pretty substantial things like the ability to build on a Mac not in a docker container",
    "start": "985439",
    "end": "990449"
  },
  {
    "text": "just super useful subset load balancing arbitrary meditate on endpoints some",
    "start": "990449",
    "end": "995970"
  },
  {
    "text": "pretty big things we got in place I think fairly quickly the next thing their operational parity",
    "start": "995970",
    "end": "1002389"
  },
  {
    "text": "is definitely a thing I think for a lot of migrations people go through it's like I have this running on my laptop",
    "start": "1002389",
    "end": "1007459"
  },
  {
    "text": "this is fantastic we should just go to prod and the more seasoned slash older people and the team will be like you",
    "start": "1007459",
    "end": "1013249"
  },
  {
    "text": "know how you're gonna deal with logs right like oh yeah that's a thing and so",
    "start": "1013249",
    "end": "1018799"
  },
  {
    "text": "on voice pretty good about most of the stuff like getting along shout pretty standard metrics it has an admin server",
    "start": "1018799",
    "end": "1024740"
  },
  {
    "text": "that gives you a pretty wider range of stats if you're used to dealing with some of the other proxies and trying to",
    "start": "1024740",
    "end": "1030890"
  },
  {
    "text": "get internal proxy stats out envoy is much more approachable let's figure out to do alerting packaging and deployment",
    "start": "1030890",
    "end": "1037459"
  },
  {
    "text": "are still pretty new for envoy there's a docker image and not much else but it's",
    "start": "1037459",
    "end": "1042470"
  },
  {
    "text": "not that hard to roll your own at this point and the process management is a thing too that it doesn't come with like",
    "start": "1042470",
    "end": "1048048"
  },
  {
    "text": "a built-in systemd integration it is a docker container so you'll have to figure that out too",
    "start": "1048049",
    "end": "1053710"
  },
  {
    "text": "none of this is super hard but definitely things to think about when you're rolling on the other thing before",
    "start": "1053890",
    "end": "1060970"
  },
  {
    "text": "the migration is there's a temptation especially we haven't done too many of these like I'm pretty sure this new",
    "start": "1060970",
    "end": "1067390"
  },
  {
    "text": "thing is gonna work so it's not plan for failure let's plan for success and when I flip the switch it's gonna be great",
    "start": "1067390",
    "end": "1073840"
  },
  {
    "text": "then it isn't so one of the things we really pioneered at Twitter was",
    "start": "1073840",
    "end": "1079060"
  },
  {
    "text": "incremental rollout of all the things because I never worked so sliders are",
    "start": "1079060",
    "end": "1085900"
  },
  {
    "text": "better than switches in almost all cases when you're thinking about this migration so how can I do X percent of",
    "start": "1085900",
    "end": "1091930"
  },
  {
    "text": "this thing as a test how will I roll it that quickly when it fails how easy is it and how many people",
    "start": "1091930",
    "end": "1098020"
  },
  {
    "text": "can do the ramp up ramp down these are all things to plan in the other thing",
    "start": "1098020",
    "end": "1103090"
  },
  {
    "text": "that is is really good to know up front so what stats am I going to look at or like what what KPIs am I going to look",
    "start": "1103090",
    "end": "1109570"
  },
  {
    "text": "at to know that this migrations going well for a proxy that's probably things like latency like resource usage like",
    "start": "1109570",
    "end": "1115450"
  },
  {
    "text": "error rate it's not that you shouldn't you know it's not just about collecting",
    "start": "1115450",
    "end": "1120880"
  },
  {
    "text": "those things and observing them but having like having fallback points that if latency gets this bad we will roll",
    "start": "1120880",
    "end": "1127450"
  },
  {
    "text": "this thing back it's much easier to know that stuff upfront then during the migration when people are worried and",
    "start": "1127450",
    "end": "1133300"
  },
  {
    "text": "emotions run a little hotter and you have to have an argument with somebody to roll it back because you think 50 milliseconds is fine and they think it",
    "start": "1133300",
    "end": "1140290"
  },
  {
    "text": "should be 30 so having those set points to find upfront makes the whole process quite a bit smoother hopefully don't",
    "start": "1140290",
    "end": "1147400"
  },
  {
    "text": "have to ramp down but it's good to know when you would otherwise so with all",
    "start": "1147400",
    "end": "1153970"
  },
  {
    "text": "that in place our first step and also on the incremental note was we didn't go sort of full envoy from the beginning",
    "start": "1153970",
    "end": "1160870"
  },
  {
    "text": "like if you look at this picture of phase 1 it just looks exactly like the old picture we had it's just instead of",
    "start": "1160870",
    "end": "1166570"
  },
  {
    "text": "the management agent we implement the next es server and instead of what we still had a log parser so there's a new",
    "start": "1166570",
    "end": "1173110"
  },
  {
    "text": "log parser that parses envoy logs but it's still a log parser the nice thing about this is operationally it is the",
    "start": "1173110",
    "end": "1180010"
  },
  {
    "text": "same thing there's a ball of a container we ship this one has envoy the last one had nginx nobody knew the difference",
    "start": "1180010",
    "end": "1186649"
  },
  {
    "text": "and it was really just a bump on the container version like change your",
    "start": "1186649",
    "end": "1191659"
  },
  {
    "text": "deployment to use this new thing and you'll have envoy tada and this worked after a lot of work",
    "start": "1191659",
    "end": "1200360"
  },
  {
    "start": "1199000",
    "end": "1199000"
  },
  {
    "text": "along these things so our process kind of beginning to end to get to phase 1 was a lot of like filling the feature",
    "start": "1200360",
    "end": "1207350"
  },
  {
    "text": "gaps we had and this wasn't that envoy just had a pour feature set it's just that we'd built a lot of stuff into",
    "start": "1207350",
    "end": "1212809"
  },
  {
    "text": "engine acts that we didn't want to give up so we kind of looked at what all had we added what did envoy have and there were the",
    "start": "1212809",
    "end": "1219320"
  },
  {
    "text": "beginnings of a lot of those features that we just fleshed out implementing an",
    "start": "1219320",
    "end": "1224450"
  },
  {
    "text": "XDS service which has been something we push on for for quite a long time",
    "start": "1224450",
    "end": "1230019"
  },
  {
    "text": "because there's several of the XDS services and varying levels of difficulty and implementing them",
    "start": "1230019",
    "end": "1237220"
  },
  {
    "text": "updating the log parser this was like surprisingly a reasonable amount of work",
    "start": "1237220",
    "end": "1243649"
  },
  {
    "text": "I don't remember why but it was packaging deployment so this is a lot of",
    "start": "1243649",
    "end": "1250009"
  },
  {
    "text": "engine X has a pretty you know straightforward like configure make we've entered it we built a binary shoved it into a container with envoy it",
    "start": "1250009",
    "end": "1257869"
  },
  {
    "text": "is easiest we found to get the shipped Envoy container yank the binary out of",
    "start": "1257869",
    "end": "1263659"
  },
  {
    "text": "it plop it into your container and go or you can just extend extend their container this one actually wasn't too",
    "start": "1263659",
    "end": "1270470"
  },
  {
    "text": "bad did a lot of testing the fun thing about proxies is they are very hard to",
    "start": "1270470",
    "end": "1276830"
  },
  {
    "text": "test with a live traffic workload because unless you're doing really sophisticated capture we play a",
    "start": "1276830",
    "end": "1282470"
  },
  {
    "text": "production traffic at scale the best place to test these things is actually in production which can be",
    "start": "1282470",
    "end": "1289429"
  },
  {
    "text": "nerve-wracking but sliders be switches be prepared to rollback we didn't",
    "start": "1289429",
    "end": "1295279"
  },
  {
    "text": "actually have to with this we did a lot of testing outside production and it happened to work but we were prepared",
    "start": "1295279",
    "end": "1301720"
  },
  {
    "text": "after that canary new proxies so we had an e lb for our site we have a bunch of",
    "start": "1301720",
    "end": "1308059"
  },
  {
    "text": "containers behind that that we're running engine X we upgraded one of them to run on voi looked at stats across the",
    "start": "1308059",
    "end": "1314600"
  },
  {
    "text": "whole fleet see if latency is the same resource usage is the same error rates are the same run all of our qualification tests with",
    "start": "1314600",
    "end": "1321830"
  },
  {
    "text": "our app to make sure behavior was the same the 400s for a requester still four hundredths 404s to four fours this was",
    "start": "1321830",
    "end": "1328610"
  },
  {
    "text": "all good and then fully rolled out new proxies this whole process took us like",
    "start": "1328610",
    "end": "1335540"
  },
  {
    "text": "from the time we headed well from the time we started the time we rolled out was probably five months a lot of that",
    "start": "1335540",
    "end": "1341090"
  },
  {
    "text": "was spent in steps one and two six and seven were pretty smooth I think we kept",
    "start": "1341090",
    "end": "1347300"
  },
  {
    "text": "their canary running for a week or so there were really no issues then we",
    "start": "1347300",
    "end": "1352550"
  },
  {
    "text": "decided to fully roll them out that was great it's been very smooth and then once we",
    "start": "1352550",
    "end": "1360230"
  },
  {
    "text": "had that transparent swap in place like the ergonomics of deploy were exactly the same with Engine X and H a proxy",
    "start": "1360230",
    "end": "1365990"
  },
  {
    "text": "then we took that next step of taking advantage of the XDS services to really",
    "start": "1365990",
    "end": "1371060"
  },
  {
    "text": "fully separate that management playing from envoy itself so this is where we",
    "start": "1371060",
    "end": "1376970"
  },
  {
    "text": "ended up and we are much much happier the envoy we we run now or the week we",
    "start": "1376970",
    "end": "1383510"
  },
  {
    "text": "can run you know run further people is just stock open-source bring your own pointed at our thing and it'll get",
    "start": "1383510",
    "end": "1388730"
  },
  {
    "text": "itself configured and this means that we don't have to ship our own container of Envoy we don't have to worry about",
    "start": "1388730",
    "end": "1394250"
  },
  {
    "text": "patches somebody else has to which is better for us somebody else worries",
    "start": "1394250",
    "end": "1401060"
  },
  {
    "text": "about it but it also means that people can use their own build pipeline their own packaging their own deployment their own",
    "start": "1401060",
    "end": "1406490"
  },
  {
    "text": "etc and just point to the management server and get benefits the other thing that we've used that's pretty new is the",
    "start": "1406490",
    "end": "1413630"
  },
  {
    "text": "access log service which is great so we don't even have to have a telemetry sidecar on envoy we just say hey ship",
    "start": "1413630",
    "end": "1420020"
  },
  {
    "text": "your access logs to us we'll take that and forward it to STATS dear influx or prometheus or whatever and you don't",
    "start": "1420020",
    "end": "1426350"
  },
  {
    "text": "have to worry about anything other than just deploying envoy and getting it configured properly this has been really great really great and that's where we",
    "start": "1426350",
    "end": "1437690"
  },
  {
    "text": "are today fully deployed envoy XDS it's really good so here's lessons learned",
    "start": "1437690",
    "end": "1445220"
  },
  {
    "start": "1443000",
    "end": "1443000"
  },
  {
    "text": "and after after six months of this stuff and I would say six months of this one at Twitter for a long time our job was",
    "start": "1445220",
    "end": "1451559"
  },
  {
    "text": "basically doing these things over and over and there was like a little checklist of here's how we're going to",
    "start": "1451559",
    "end": "1457230"
  },
  {
    "text": "move some slice of the rails monolith onto the JVM and so these these things like these approaches apply to lots of",
    "start": "1457230",
    "end": "1463380"
  },
  {
    "text": "different kinds of migrations the same approach D risk incremental know when you're gonna have to roll back know that",
    "start": "1463380",
    "end": "1468840"
  },
  {
    "text": "you're going to know when you have to roll back and just be prepared to do that several times along the way the",
    "start": "1468840",
    "end": "1474480"
  },
  {
    "text": "nice thing is if you get that as a common practice then the refactoring of the system becomes quicker and I think",
    "start": "1474480",
    "end": "1480750"
  },
  {
    "text": "your developer productivity and the ability you're able to get out of your system increases you don't accrue all",
    "start": "1480750",
    "end": "1486030"
  },
  {
    "text": "that friction along the way of just trying to stay on the same system because it would be really really scary to move off it the other thing we",
    "start": "1486030",
    "end": "1495360"
  },
  {
    "text": "learned here like a third bullet cluster management and listener management for Envoy was interesting for us where",
    "start": "1495360",
    "end": "1500940"
  },
  {
    "text": "cluster management is almost always you have some sort of truth some source of truth that knows about clusters and",
    "start": "1500940",
    "end": "1508650"
  },
  {
    "text": "endpoints and you're really just mapping that from whatever the native implementation is into envoy speak so in",
    "start": "1508650",
    "end": "1515970"
  },
  {
    "text": "kubernetes you do coop control get pods you can convert that to an EDS response pretty easily and it's really just glue",
    "start": "1515970",
    "end": "1523110"
  },
  {
    "text": "code when you want to do listener and route management you have to come up with some other canonical store of how",
    "start": "1523110",
    "end": "1529110"
  },
  {
    "text": "you want layer 7 traffic flowing across your system and that's a whole other project and so we see a lot of people",
    "start": "1529110",
    "end": "1534929"
  },
  {
    "text": "coming to envoy implement their EDS EDS service me like this is great and then",
    "start": "1534929",
    "end": "1540540"
  },
  {
    "text": "kind of stopping because the next step is real hard which I understand but that's something that provides a ton of",
    "start": "1540540",
    "end": "1546419"
  },
  {
    "text": "benefit on top of just dynamic service discovery it's a little frustrating so",
    "start": "1546419",
    "end": "1552590"
  },
  {
    "start": "1551000",
    "end": "1551000"
  },
  {
    "text": "none of this is rocket science like none of this is like deep system stuff you don't have to read like ACM papers",
    "start": "1552590",
    "end": "1559230"
  },
  {
    "text": "really but it's a long project it's a high-risk project it's hard to keep",
    "start": "1559230",
    "end": "1566309"
  },
  {
    "text": "people excited along the way to let you keep doing the thing to roll it out and a lot of migrations gonna get bogged",
    "start": "1566309",
    "end": "1571440"
  },
  {
    "text": "down with three months and with management there's somebody else saying like I don't know that we're actually ever gonna finish this and I don't see",
    "start": "1571440",
    "end": "1577559"
  },
  {
    "text": "the benefits if we do so it seemed to be risky for different reason",
    "start": "1577559",
    "end": "1583230"
  },
  {
    "text": "and so that's another reason that like incremental ISM showing like quick wins the ability that you're still moving",
    "start": "1583230",
    "end": "1588630"
  },
  {
    "text": "forward is great the other thing is a lot of the stuff we built along the way I think are pretty",
    "start": "1588630",
    "end": "1594120"
  },
  {
    "text": "useful outside our project so we'll actually be open sourcing this ball of",
    "start": "1594120",
    "end": "1600180"
  },
  {
    "text": "management Bastion over the next few weeks so this is a drop-in you know",
    "start": "1600180",
    "end": "1608700"
  },
  {
    "text": "implementation of c.d.s and EDS that will bridge console ec2 things there into cluster discovery so you don't have",
    "start": "1608700",
    "end": "1615540"
  },
  {
    "text": "to write your own if you're using those environments it'll also read from JSON or EML files which is probably easier than writing",
    "start": "1615540",
    "end": "1621240"
  },
  {
    "text": "your own cdf service it has an ALS implementation that forwards to the big metrics backends yeah that's all the all",
    "start": "1621240",
    "end": "1630210"
  },
  {
    "text": "the big ones I think and then we'll set up a simple LDS and RDS config to give you like a fully working envoy if this",
    "start": "1630210",
    "end": "1637740"
  },
  {
    "text": "LDS and RDS isn't sophisticated enough you can use a combination of static and dynamic config to do customization and",
    "start": "1637740",
    "end": "1643850"
  },
  {
    "text": "then the upgrade path to our product which does much more sophisticated routing and listener management is just",
    "start": "1643850",
    "end": "1649110"
  },
  {
    "text": "provide an API key and it'll use us as the canonical store instead of LDS and Rd has the other thing we'll open source",
    "start": "1649110",
    "end": "1656760"
  },
  {
    "start": "1655000",
    "end": "1655000"
  },
  {
    "text": "is what we call envoy simple right now to run envoy you need a bootstrap config that you provide so you almost",
    "start": "1656760",
    "end": "1663710"
  },
  {
    "text": "necessarily have to stand up your own container to get it configured this does a very simple go template file that lets",
    "start": "1663710",
    "end": "1670560"
  },
  {
    "text": "you configure the stuff via environment variables it gets you to a head start on rolling out an envoy managed by XDS in",
    "start": "1670560",
    "end": "1676500"
  },
  {
    "text": "production so pointed XDS configure the admin server configure the log level and",
    "start": "1676500",
    "end": "1681870"
  },
  {
    "text": "go and so this is a pretty dramatic speed up from trying to figure out the Envoy packaging stuff we're excited",
    "start": "1681870",
    "end": "1689580"
  },
  {
    "text": "about this so it's not quite ready yet we were hoping it would be but in the",
    "start": "1689580",
    "end": "1695370"
  },
  {
    "text": "next couple weeks so this bow should be available when I think a pretty dramatic speed-up for people looking to roll out envoy in their environments so here's a",
    "start": "1695370",
    "end": "1704970"
  },
  {
    "text": "little bit of info on me envoy project you can come by our booth happy to talk",
    "start": "1704970",
    "end": "1712370"
  },
  {
    "text": "about envoy rollouts migrations whenever any questions are we doing on time six",
    "start": "1712370",
    "end": "1722090"
  },
  {
    "text": "minutes for questions anybody I think",
    "start": "1722090",
    "end": "1728539"
  },
  {
    "text": "there's a mic in the middle I can repeat the question and yell if you really don't want to get up so is there any",
    "start": "1728539",
    "end": "1737570"
  },
  {
    "text": "particular feature of N word that helps you with was a row now changes in CH",
    "start": "1737570",
    "end": "1744559"
  },
  {
    "text": "production so it depends on the type of change short answer yes why not there",
    "start": "1744559",
    "end": "1751940"
  },
  {
    "text": "are a wide variety of production changes that envoy helps roll out we've seen people use it from migrating from system",
    "start": "1751940",
    "end": "1758809"
  },
  {
    "text": "a to B where a is usually not kubernetes and B is kubernetes but being able to",
    "start": "1758809",
    "end": "1763820"
  },
  {
    "text": "load up endpoints that span multiple different runtimes and being able to gradually shift traffic from like an ec2",
    "start": "1763820",
    "end": "1770480"
  },
  {
    "text": "console runtime over into kubernetes is really useful we use if our own software",
    "start": "1770480",
    "end": "1776000"
  },
  {
    "text": "releases to always do Bluegreen deploys for those like incremental Bluegreen so yes there's a lot of different ways to",
    "start": "1776000",
    "end": "1782030"
  },
  {
    "text": "smooth that out yes",
    "start": "1782030",
    "end": "1787690"
  },
  {
    "text": "is this a question is how are you on using invoice checks versus kubernetes",
    "start": "1793520",
    "end": "1798660"
  },
  {
    "text": "liveness probes that is like a whole talk I'm not a big believer in health",
    "start": "1798660",
    "end": "1805560"
  },
  {
    "text": "checks in general which is probably a pretty hot take the the downside with",
    "start": "1805560",
    "end": "1811980"
  },
  {
    "text": "health checks is that they tend to never be full fidelity so health check is like a I'm listening on a port I can accept traffic which is cool but",
    "start": "1811980",
    "end": "1819270"
  },
  {
    "text": "does not mean that the service behind it is working at all and so on voice supports some pretty interesting",
    "start": "1819270",
    "end": "1825650"
  },
  {
    "text": "liveness constructs internally like if it starts receiving error responses from",
    "start": "1825650",
    "end": "1831360"
  },
  {
    "text": "a from an endpoint it will eject it from the pool and then retry again later to see if it's healthy and so I think in",
    "start": "1831360",
    "end": "1837540"
  },
  {
    "text": "most cases I'm more in favor of not even using the health checks at the cluster level and on void but using outlier detection and it's sort of built in",
    "start": "1837540",
    "end": "1845400"
  },
  {
    "text": "version of health other questions hard to see back there just a question",
    "start": "1845400",
    "end": "1856620"
  },
  {
    "text": "that does invoice supports that initial thing the SSL handshakes from a sub you",
    "start": "1856620",
    "end": "1864360"
  },
  {
    "text": "were up or turn SSL handshakes from a sub URL you just like to initiate layer",
    "start": "1864360",
    "end": "1871980"
  },
  {
    "text": "four limitation like client-side certificates for a particular you whether I don't know if it does it for a",
    "start": "1871980",
    "end": "1878370"
  },
  {
    "text": "particular URL it definitely supports M TLS for an entire listener but I'm not",
    "start": "1878370",
    "end": "1884040"
  },
  {
    "text": "sure if it does it for a sub URL I would have to check because as far as I seen",
    "start": "1884040",
    "end": "1890630"
  },
  {
    "text": "only offer she supports this now that sounds entirely plausible and it's quite",
    "start": "1890630",
    "end": "1898320"
  },
  {
    "text": "a legend about heavily used feature just to protect the sub interesting interesting I don't know yes",
    "start": "1898320",
    "end": "1909920"
  },
  {
    "text": "would there be any reason to use nginx over envoy for new services so so in",
    "start": "1917350",
    "end": "1929150"
  },
  {
    "text": "void does not do static file serving right now which is which is a big thing that engine X does very well at there's",
    "start": "1929150",
    "end": "1935900"
  },
  {
    "text": "also I think a larger overall list of modules for engine X particularly around mail handling and some other things so I",
    "start": "1935900",
    "end": "1942920"
  },
  {
    "text": "think short answer is yes there are cases where you would want to use engine X I think",
    "start": "1942920",
    "end": "1947930"
  },
  {
    "text": "envoy is catching up very rapidly on almost all fronts and surpassing it on a number of others so I think those cases",
    "start": "1947930",
    "end": "1955880"
  },
  {
    "text": "will become more rare yeah yeah UDP from",
    "start": "1955880",
    "end": "1961130"
  },
  {
    "text": "from the front there's a ticket open for UDP support and there's a lot of discussion there but yes anything else",
    "start": "1961130",
    "end": "1972430"
  },
  {
    "text": "yes yes so the question is I briefly",
    "start": "1972430",
    "end": "1979310"
  },
  {
    "text": "mentioned test in production have I ever had to do some our original product was very much a test and production product",
    "start": "1979310",
    "end": "1984380"
  },
  {
    "text": "we are strong believers in test and prod and that's like a whole other probably",
    "start": "1984380",
    "end": "1991700"
  },
  {
    "text": "conference but the our core thesis is that going to production is another form",
    "start": "1991700",
    "end": "1999890"
  },
  {
    "text": "of test and like if test production makes you feel dirty then using validation and production is",
    "start": "1999890",
    "end": "2005320"
  },
  {
    "text": "probably a little better but it's the same thing like you're deploying new code the chance of there being bugs in it is greater than zero and you should",
    "start": "2005320",
    "end": "2012400"
  },
  {
    "text": "tool up to be able to detect those and find them and respond to them and a lot of the things like the incremental",
    "start": "2012400",
    "end": "2017830"
  },
  {
    "text": "blue-green release are exactly a testing prod I'm going to put a thing out and it's not that I just leave it I want to",
    "start": "2017830",
    "end": "2023350"
  },
  {
    "text": "observe metrics like the differences between a test and a control and if the",
    "start": "2023350",
    "end": "2028480"
  },
  {
    "text": "test looks good relative to the control then I can proceed if it doesn't then I turn it off so so very much believe your",
    "start": "2028480",
    "end": "2035290"
  },
  {
    "text": "intestine prod one more minute anyway yes yes so the",
    "start": "2035290",
    "end": "2054780"
  },
  {
    "text": "question is I said it was fast enough and how does it compare to other proxies I think the general stance in the envoy",
    "start": "2054780",
    "end": "2061250"
  },
  {
    "text": "slack whenever it's come up is that there's no good standard benchmark to",
    "start": "2061250",
    "end": "2067260"
  },
  {
    "text": "use right now which may be I don't know there have not been people complaining I",
    "start": "2067260",
    "end": "2072360"
  },
  {
    "text": "think the generally accepted Delta is somewhere around 10% but it's hard to come up with the benchmark for a given",
    "start": "2072360",
    "end": "2077550"
  },
  {
    "text": "workload at you know a client or production site to do an apples-to-apples comparison you know",
    "start": "2077550",
    "end": "2085700"
  },
  {
    "text": "eBay uses it at the edge now for a lot of their ingress traffic they're kind of a big deal so I think it works and I",
    "start": "2085700",
    "end": "2095639"
  },
  {
    "text": "think that there was no real inclination to look at replacing like their Hardware load balancers was something different",
    "start": "2095640",
    "end": "2100710"
  },
  {
    "text": "so I think that's a pretty big like vote of confidence and there's other",
    "start": "2100710",
    "end": "2106620"
  },
  {
    "text": "companies that are doing like pretty high scale things where they care about density from a sidecar perspective it's",
    "start": "2106620",
    "end": "2112950"
  },
  {
    "text": "interesting that fast enough is really about if you're running as a sidecar on a docker container you are in no danger",
    "start": "2112950",
    "end": "2118110"
  },
  {
    "text": "of saturating a 10 gig network interface like which is not gonna happen so trying to eke all the performance out",
    "start": "2118110",
    "end": "2124860"
  },
  {
    "text": "of Envoy to be able to serve as the core of a hardware appliance is probably not worthwhile there and we're alright thank",
    "start": "2124860",
    "end": "2135750"
  },
  {
    "text": "you everybody",
    "start": "2135750",
    "end": "2138080"
  },
  {
    "text": "come come by the booth hit me up on Twitter or whatever I'm always happy to talk about this stuff",
    "start": "2141390",
    "end": "2147839"
  }
]