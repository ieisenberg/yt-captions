[
  {
    "text": "thank you so much for your interest in in this topic that we want to talk about which was in fact something that that a",
    "start": "80",
    "end": "6480"
  },
  {
    "text": "couple of us discussed last cubec Con in Chicago and that's the question why do",
    "start": "6480",
    "end": "12440"
  },
  {
    "text": "we as a cloud native Community not have a truly open and free way to collect and",
    "start": "12440",
    "end": "17800"
  },
  {
    "text": "share threat intelligence with each other amongst ourselves and the other question is what would a t to change",
    "start": "17800",
    "end": "25400"
  },
  {
    "text": "that and this is what this talk is about and in reference to the Sans internet Storm Center we were bold enough to call",
    "start": "25400",
    "end": "32758"
  },
  {
    "text": "it the kubernetes Storm Center maybe some of you know that podcast it is it's mostly about endpoints and like maybe",
    "start": "32759",
    "end": "38320"
  },
  {
    "text": "printers and Adobe exploits and uh what they do is they have a Global Network of",
    "start": "38320",
    "end": "43879"
  },
  {
    "text": "Honey pots from which they report what's currently going on what's being exploited and what we we want to do in",
    "start": "43879",
    "end": "50320"
  },
  {
    "text": "analogy to that is we want to use a network of Honey clusters um",
    "start": "50320",
    "end": "55640"
  },
  {
    "text": "instrumented with evf to collect that threat intelligence and disseminate it",
    "start": "55640",
    "end": "61239"
  },
  {
    "text": "my name is consens Ric I uh work at the Technical University as of Vienna teaching computer science and doing all",
    "start": "61239",
    "end": "67799"
  },
  {
    "text": "sorts of practical stuff and with me is hello everyone I am James Callahan uh",
    "start": "67799",
    "end": "73240"
  },
  {
    "text": "like Constance I have a background as a theoretical physicist however around 10 years ago I became interested in cyber",
    "start": "73240",
    "end": "79640"
  },
  {
    "text": "security and now I work as a principal consultant at control plane uh working",
    "start": "79640",
    "end": "84799"
  },
  {
    "text": "mainly in security architecture in my spare time I make music and I also make",
    "start": "84799",
    "end": "90320"
  },
  {
    "text": "very bad spinal tap jokes on slide decks uh so if anyone actually gets that very very Niche reference please come and",
    "start": "90320",
    "end": "96880"
  },
  {
    "text": "talk to me afterwards because we'll probably get on very very well on the topic of bad jokes two theoretical",
    "start": "96880",
    "end": "104520"
  },
  {
    "text": "physicists walk into cucon armed with a host of um practical experience of the",
    "start": "104520",
    "end": "111920"
  },
  {
    "text": "real world like uh modeling the universe in n greater than four dimensions um we thought it would be good to do some real",
    "start": "111920",
    "end": "118119"
  },
  {
    "text": "world practical experiments I mean how badly can it go right on that note I mean we're not",
    "start": "118119",
    "end": "125640"
  },
  {
    "text": "going to take any liability for anything um but we should so this is the",
    "start": "125640",
    "end": "131560"
  },
  {
    "text": "agenda for the next 35 minutes and we should always start with why so why do we think this is relevant and I hope",
    "start": "131560",
    "end": "138920"
  },
  {
    "text": "that and think that most of you will have been in that situation where you deployment your product was almost ready",
    "start": "138920",
    "end": "144920"
  },
  {
    "text": "for production then you had a threat model going on and there's this discussion well we found that there is",
    "start": "144920",
    "end": "150720"
  },
  {
    "text": "attack Vector a attack path a to a Target but also attack Vector B attack",
    "start": "150720",
    "end": "156640"
  },
  {
    "text": "path B to the same Target and then internally you have your teams discussing well one is much harder or",
    "start": "156640",
    "end": "162519"
  },
  {
    "text": "much more effortful to remediate than the other one and now how are we're going to prioritize and get the budget",
    "start": "162519",
    "end": "168200"
  },
  {
    "text": "like which one should we prioritize in remediation and of course you could",
    "start": "168200",
    "end": "173879"
  },
  {
    "text": "model um this in N Dimensions you could hire pent testers uh you could do buck",
    "start": "173879",
    "end": "179560"
  },
  {
    "text": "Bond programs all of that non withstanding or what we're going to show you in the next 30 or so minutes um on a",
    "start": "179560",
    "end": "186920"
  },
  {
    "text": "on an examp on an example is you could uh model the attack instrument very",
    "start": "186920",
    "end": "193720"
  },
  {
    "text": "lightweight the critical attack path noes with e BPF in this case you in you",
    "start": "193720",
    "end": "200400"
  },
  {
    "text": "take that instrumentation and stream the events you have a method to reduce the Baseline out that means you only have",
    "start": "200400",
    "end": "206200"
  },
  {
    "text": "anomaly detection and then you analyze these signals and disseminate them out",
    "start": "206200",
    "end": "211319"
  },
  {
    "text": "we're going to show you two real life experiments one on an example attack path and one on a famous cve that came",
    "start": "211319",
    "end": "219000"
  },
  {
    "text": "out recently and we're going to conclude with a four-fold path to threat intelligence um that means how you could",
    "start": "219000",
    "end": "226040"
  },
  {
    "text": "do that um yourselves if we want this to succeed however such that it becomes common",
    "start": "226040",
    "end": "233000"
  },
  {
    "text": "practice that not just the tech Giants but also smaller Enterprises even budget",
    "start": "233000",
    "end": "239239"
  },
  {
    "text": "constraint teams can have benefits and run honey clusters for themselves we",
    "start": "239239",
    "end": "245560"
  },
  {
    "text": "need to have stringent requirements on ourselves such as that it's truly free not bigger budget impact but also it's",
    "start": "245560",
    "end": "252120"
  },
  {
    "text": "minimally invasive so if you have your cluster situation going on we only do a Delta Epsilon of instrumentation on top",
    "start": "252120",
    "end": "258199"
  },
  {
    "text": "you don't need to change your firewall etc etc and also there's going to be no black magic no machine learning no fancy",
    "start": "258199",
    "end": "265720"
  },
  {
    "text": "pancy algorithms in N Dimensions no it's going to be actually very accessible to",
    "start": "265720",
    "end": "271400"
  },
  {
    "text": "let's say an average Sr that's been around in the field and a truly free",
    "start": "271400",
    "end": "276680"
  },
  {
    "text": "license and the idea the vision is that this four-fold path this process of going from threat model via attack model",
    "start": "276680",
    "end": "284199"
  },
  {
    "text": "to the uh instrumentation and the the data collection that this is really achievable by anyone and becomes common",
    "start": "284199",
    "end": "291440"
  },
  {
    "text": "practice so that we have an a wonderful sampling of the face space and can really interpret what's going on in the",
    "start": "291440",
    "end": "297160"
  },
  {
    "text": "world on our uh various configurations and deployments but",
    "start": "297160",
    "end": "303080"
  },
  {
    "text": "that's the vision and no devil is in the detail so let's start with the example attack",
    "start": "303080",
    "end": "309000"
  },
  {
    "text": "model okay so the first thing to note is that open- Source threat intelligence is out there so for example uh you can",
    "start": "309000",
    "end": "316120"
  },
  {
    "text": "check this really cool resource uh made available by by whiz uh where you can see recent CV exploits you can see",
    "start": "316120",
    "end": "322800"
  },
  {
    "text": "threat actor information tactics techniques and procedures that are being used in the wild uh so this and bunch of",
    "start": "322800",
    "end": "330000"
  },
  {
    "text": "other sources are really good if you want to augment your threat models and understand a little bit more about real",
    "start": "330000",
    "end": "335800"
  },
  {
    "text": "life what's going on however what happens if we want to verify and",
    "start": "335800",
    "end": "341080"
  },
  {
    "text": "quantify our threat models uh so at some point in threat modeling we'll end up with something like this an attack tree",
    "start": "341080",
    "end": "347120"
  },
  {
    "text": "where at the top we have an attacker goal and underneath it we'll have a bunch of attack paths or steps made up",
    "start": "347120",
    "end": "353440"
  },
  {
    "text": "of these attack nodes uh which have to be realized for the attacker to achieve their goal and we will have an nodes and",
    "start": "353440",
    "end": "360919"
  },
  {
    "text": "or nodes and together this makes up the logic of our theoretical attack path now",
    "start": "360919",
    "end": "367160"
  },
  {
    "text": "at some point we need to know what's the likelihood that an attacker traverses a particular path through the tree and the",
    "start": "367160",
    "end": "374080"
  },
  {
    "text": "traditional way of doing this is by using experience and putting your finger in the air and saying this is probably",
    "start": "374080",
    "end": "379520"
  },
  {
    "text": "the likelihood because I I I've observed these attacks I've carried out these attacks as a red teamer Etc and and we",
    "start": "379520",
    "end": "385479"
  },
  {
    "text": "put some probabilities on this thing however wouldn't it be really nice if we had empirical data to back this",
    "start": "385479",
    "end": "391960"
  },
  {
    "text": "up so first of all going back to the four-fold path our first path is getting",
    "start": "391960",
    "end": "397319"
  },
  {
    "text": "a theoretical attack model uh so we wanted a demo attack um that you can run",
    "start": "397319",
    "end": "402479"
  },
  {
    "text": "yourselves we have this in um available in a kind cluster uh which you can run we'll show you the repo at the end and",
    "start": "402479",
    "end": "408840"
  },
  {
    "text": "we had a few requirements for our attack uh we wanted it to work with Baseline pod security standards so we didn't want",
    "start": "408840",
    "end": "414520"
  },
  {
    "text": "you to just be able to spin up a privileged pod in your cluster or something like that um we we also wanted",
    "start": "414520",
    "end": "420280"
  },
  {
    "text": "several distinct indicators of compromise so we wanted a fairly long attack path and this is purely as a demo",
    "start": "420280",
    "end": "426479"
  },
  {
    "text": "uh so this is not a real world honey cluster this is just to show you our instrumentation and how we would do this",
    "start": "426479",
    "end": "433080"
  },
  {
    "text": "uh so we want several IND U distinct indicators of compromise um where each one has a unique um signal and finally",
    "start": "433080",
    "end": "442039"
  },
  {
    "text": "we wanted it to be semi-realistic um based on an overprivileged role basically so constant will show you an",
    "start": "442039",
    "end": "447960"
  },
  {
    "text": "example later on with a real world cve but for this very simple base example we",
    "start": "447960",
    "end": "453479"
  },
  {
    "text": "just wanted to uh use plain old misconfiguration as the uh as as the vector so let's have a look at this",
    "start": "453479",
    "end": "460000"
  },
  {
    "text": "attack tree because these things can be a bit hard to um to understand and pass on first uh sighting uh so let's just",
    "start": "460000",
    "end": "466960"
  },
  {
    "text": "walk through it node by node at the top we have our goal which is for an",
    "start": "466960",
    "end": "472120"
  },
  {
    "text": "attacker to access sensitive data on a node on which a pod is running we need",
    "start": "472120",
    "end": "477879"
  },
  {
    "text": "to provide an entry point um and as you can see from the entry point at the",
    "start": "477879",
    "end": "482919"
  },
  {
    "text": "bottom there's kind of two paths through this tree there's this path on the right which will go through in a second and",
    "start": "482919",
    "end": "488680"
  },
  {
    "text": "this more complex path with more nodes on the left the one on the left is the one with more indicators of compromise",
    "start": "488680",
    "end": "494639"
  },
  {
    "text": "and more stuff for us to demo so this is the one that we're going to be interested in and this is actually it's",
    "start": "494639",
    "end": "499960"
  },
  {
    "text": "quite an old um attack path it was raised in the kubernetes audit by trail of bits a few years ago and expanded on",
    "start": "499960",
    "end": "505919"
  },
  {
    "text": "in a really really cool blog post by Jack leadford um we'll go go through this step by step so back to the bottom",
    "start": "505919",
    "end": "513120"
  },
  {
    "text": "of the tree and to our starting point we need an initial entry into the cluster now in a real world honey cluster what",
    "start": "513120",
    "end": "520039"
  },
  {
    "text": "we might want to do is run uh expose a vulnerable service to the world maybe some rce vulnerability and allow our",
    "start": "520039",
    "end": "526959"
  },
  {
    "text": "attackers initial entry however we're doing something much more basic than that we are just running a vulnerable",
    "start": "526959",
    "end": "532600"
  },
  {
    "text": "SSH server in a cluster so maybe this is a little bit too obvious but it gets our point across the credentials are root",
    "start": "532600",
    "end": "538720"
  },
  {
    "text": "squared this should be hitable by uh automatic uh scans and hopefully we should see some results from this we're",
    "start": "538720",
    "end": "546040"
  },
  {
    "text": "also going to introduce some misconfigure arbac which is the uh key for most kubernetes um escalation and",
    "start": "546040",
    "end": "553680"
  },
  {
    "text": "pivoting and then what we can do from here depends on how badly misconfigured or overprivileged the role is so we have",
    "start": "553680",
    "end": "560959"
  },
  {
    "text": "a pod has a service account bounce some role and let's say we have some operator likee workload which can create pods",
    "start": "560959",
    "end": "568160"
  },
  {
    "text": "well we're saying we want this to with Baseline pod security standards enforced therefore we can't just create a p",
    "start": "568160",
    "end": "574320"
  },
  {
    "text": "privilege pod or a pod with host path in um in its spec however let's say we can",
    "start": "574320",
    "end": "579800"
  },
  {
    "text": "do something very privileged like create persistent volumes and Associated claims",
    "start": "579800",
    "end": "585240"
  },
  {
    "text": "if we can do this we can fully take um the right hand path through this tree and we can just create a persistent",
    "start": "585240",
    "end": "591320"
  },
  {
    "text": "volume with host path um we pick a directory on the host that we're interested in and we're good to go",
    "start": "591320",
    "end": "597640"
  },
  {
    "text": "however the attack on the left uh we wanted again a few more indicators of compromise and this is kind of a subset",
    "start": "597640",
    "end": "604160"
  },
  {
    "text": "so to achieve this attack on the left it's not just any old host path maybe we have some restrictions in place um all",
    "start": "604160",
    "end": "610600"
  },
  {
    "text": "we need is to be able to have a host path persistent volume to SLV log uh we",
    "start": "610600",
    "end": "616680"
  },
  {
    "text": "need to be able to run containers as route and we need to um Create a Sim Link in the in the new pod this bad pod",
    "start": "616680",
    "end": "622680"
  },
  {
    "text": "that gets spun up a Sim link from its log file to the interesting file on the host that we care about then moving",
    "start": "622680",
    "end": "629040"
  },
  {
    "text": "upward one step if we have uh get on pod /log uh we can run Cube control get logs",
    "start": "629040",
    "end": "634720"
  },
  {
    "text": "or do this programmatically from a script and we can cat out the um interesting file line by line now I",
    "start": "634720",
    "end": "642320"
  },
  {
    "text": "showed this um this talk demo and the um uh the logic of the talk to my excellent",
    "start": "642320",
    "end": "647560"
  },
  {
    "text": "colleague Ian smart who said well in your demo you haven't actually put any restrictions in place so in the wild if",
    "start": "647560",
    "end": "654399"
  },
  {
    "text": "you if you ran this as a honey cluster the attacker would only go down the right hand path and and this is key",
    "start": "654399",
    "end": "660079"
  },
  {
    "text": "because when you're doing these um um attack trees you will always have multiple paths to to the goal and what",
    "start": "660079",
    "end": "666320"
  },
  {
    "text": "you might have to do if you particularly want to observe a particular Trace through the tree is you might have to",
    "start": "666320",
    "end": "672720"
  },
  {
    "text": "put constraints in place so you might have to say let's have uh an environment where we don't have this such privilege",
    "start": "672720",
    "end": "679399"
  },
  {
    "text": "role but maybe um we we we can't create persistent volumes anymore but maybe there's a volume unclaimed lying around",
    "start": "679399",
    "end": "685800"
  },
  {
    "text": "in the cluster something like that or maybe we want to use some um kind of logic as to why um certain um host path",
    "start": "685800",
    "end": "694320"
  },
  {
    "text": "persistent volumes would be allowed maybe SLV far log is allowed in this world in this U um hypothetical honey",
    "start": "694320",
    "end": "701160"
  },
  {
    "text": "cluster because there there are pods in the cluster which want to observe other pods logs something like that anyway the",
    "start": "701160",
    "end": "707519"
  },
  {
    "text": "key is that we might want to lead attackers down certain paths or we might just want to see what happens with a",
    "start": "707519",
    "end": "713839"
  },
  {
    "text": "very very generic setup so let's have a look at this attack on kind we're just going to run",
    "start": "713839",
    "end": "719680"
  },
  {
    "text": "through this very very quickly uh so first of all we are going to have a look",
    "start": "719680",
    "end": "724800"
  },
  {
    "text": "um in our cluster and we see that we have our SSH service running we're just",
    "start": "724800",
    "end": "731519"
  },
  {
    "text": "going to port forward this so that we can hit it and here we will see a very",
    "start": "731519",
    "end": "736760"
  },
  {
    "text": "bad overprivileged role sorry that was so short um and what we're going to do is use a python script which as you can",
    "start": "736760",
    "end": "743320"
  },
  {
    "text": "see here is going to create this uh persistent volume uh to/ log and we're",
    "start": "743320",
    "end": "749279"
  },
  {
    "text": "going to create an Associated claim again um if you want to uh restrict what the what what you do this script might",
    "start": "749279",
    "end": "755600"
  },
  {
    "text": "look different so we'll copy the script into our container and we will run it and uh",
    "start": "755600",
    "end": "762120"
  },
  {
    "text": "yeah we've got the very secure root root uh colon rot and uh let's uh actually",
    "start": "762120",
    "end": "769639"
  },
  {
    "text": "now uh run that so we've copied our uh scripts in",
    "start": "769639",
    "end": "775120"
  },
  {
    "text": "now it's running and eventually we will see uh a new pod running in cluster which will be called my pod or something",
    "start": "775120",
    "end": "781760"
  },
  {
    "text": "like that and this is the Pod uh there it is uh which we're going to carry out our attack from so we exec into the Pod",
    "start": "781760",
    "end": "788480"
  },
  {
    "text": "uh we are going to create this Sim link and then this again is going to give us",
    "start": "788480",
    "end": "793839"
  },
  {
    "text": "a very distinct uh indicator and then finally we're going to cube control logs",
    "start": "793839",
    "end": "799199"
  },
  {
    "text": "and we see we see the start of a private key there which is obviously very very bad so bit of a forced example but you",
    "start": "799199",
    "end": "807000"
  },
  {
    "text": "can see what we're trying to do with this the next bit that Constance is going to take you through is how we instrument the cluster to observe these",
    "start": "807000",
    "end": "813760"
  },
  {
    "text": "attacks so for each node in the attack tree we will have an individual",
    "start": "813760",
    "end": "819120"
  },
  {
    "text": "indicator of compromise and if you run this yourself on kind you should see we've got we're streaming these events",
    "start": "819120",
    "end": "825519"
  },
  {
    "text": "into red panda um constants will go through the instrumentation in a lot more detail on the next slide but you",
    "start": "825519",
    "end": "830839"
  },
  {
    "text": "can see here that we've got this uh detect k8's API invoke and this is watching our script make that call to",
    "start": "830839",
    "end": "837399"
  },
  {
    "text": "the kubernetes API Baseline removal is something constants will cover uh but essentially we're looking for things",
    "start": "837399",
    "end": "843959"
  },
  {
    "text": "which shouldn't be calling the kubernetes API and with that on to",
    "start": "843959",
    "end": "849320"
  },
  {
    "text": "instrumentation exactly so now we have this example threat model and attack model now the question is how can we",
    "start": "849320",
    "end": "855720"
  },
  {
    "text": "instrument a cluster in an extremely lightweight way without any black boxes to make this actually possible for",
    "start": "855720",
    "end": "862160"
  },
  {
    "text": "non-experts so we we have a GitHub uh repo where you can run this yourself and",
    "start": "862160",
    "end": "868199"
  },
  {
    "text": "judge for yourself it's simple enough so the bait so now we're going to go to real clusters we're going to use rk2",
    "start": "868199",
    "end": "874440"
  },
  {
    "text": "with Ranger on it for those real life clusters the bait is going to be very similar for that real cluster it's a",
    "start": "874440",
    "end": "880680"
  },
  {
    "text": "old-fashioned reverse SSH tunnel to that vulnerable SSH server still root squared",
    "start": "880680",
    "end": "886000"
  },
  {
    "text": "on it so that's where we start now we have to instrument these tries uh we use",
    "start": "886000",
    "end": "891480"
  },
  {
    "text": "tetragon to abstract so we do not have to write actual ebpf code so it's a",
    "start": "891480",
    "end": "897240"
  },
  {
    "text": "kubernetes crd that lets us write yaml files to for example attach to K",
    "start": "897240",
    "end": "902399"
  },
  {
    "text": "probes the log forwarding is achieved using vector and we use red Punda to",
    "start": "902399",
    "end": "907560"
  },
  {
    "text": "implement the Kafka API this is also so that we If This Were to take off we have",
    "start": "907560",
    "end": "913720"
  },
  {
    "text": "a very very good scalability here but importantly also that we can use wasm in inlays to achieve high performance",
    "start": "913720",
    "end": "920880"
  },
  {
    "text": "Transformations for two purposes and the one important purpose is this Baseline removal and we're going to look at a",
    "start": "920880",
    "end": "927519"
  },
  {
    "text": "hash table that does this for us and that uses one Kafka feature which essentially achieves uh intelligent",
    "start": "927519",
    "end": "934680"
  },
  {
    "text": "duplication and the other part that we do is we want to make this non-expert so we Implement in wasm what is essentially",
    "start": "934680",
    "end": "942000"
  },
  {
    "text": "a jQuery to uh get these very different looking uh K probe um return values",
    "start": "942000",
    "end": "948360"
  },
  {
    "text": "return Json into something that we can call a schema which we can then give to a database with sticks 2 format a stick",
    "start": "948360",
    "end": "955800"
  },
  {
    "text": "to taxi format and do our actual threat intelligence on that uh",
    "start": "955800",
    "end": "961199"
  },
  {
    "text": "database um also important if you do this in the wild with a real cluster and you're just doing the uh you know you",
    "start": "961199",
    "end": "967440"
  },
  {
    "text": "you're starting you should have an actual tool that verifies what's going on and notifies you that if you actually",
    "start": "967440",
    "end": "972680"
  },
  {
    "text": "get accidentally breached so we're using spy but uh that also does abpf instrumentation gives us this really",
    "start": "972680",
    "end": "978680"
  },
  {
    "text": "detailed UI so we can really Trace arbitrary amounts of detail out just in",
    "start": "978680",
    "end": "984160"
  },
  {
    "text": "case uh we're concerned that we're not catching the right stuff um now one of",
    "start": "984160",
    "end": "989240"
  },
  {
    "text": "the core pieces that we have here and this is also why I think that uh people would get value out of this even if they",
    "start": "989240",
    "end": "995240"
  },
  {
    "text": "don't participate in the threat dissemination is the Baseline removal making such a setup very quickly the",
    "start": "995240",
    "end": "1002399"
  },
  {
    "text": "simplest intrusion detection system that I've ever seen so essentially you take",
    "start": "1002399",
    "end": "1007519"
  },
  {
    "text": "um the tetr or the ebpf instrumentation stream it into Kafka and then create a",
    "start": "1007519",
    "end": "1013560"
  },
  {
    "text": "key in order to do D duplication from anything so that you can class ify",
    "start": "1013560",
    "end": "1019279"
  },
  {
    "text": "anything that is known to be non-malicious as non-malicious and the key here is it takes a second to",
    "start": "1019279",
    "end": "1026600"
  },
  {
    "text": "understand that the second line to concatenate the right uids that you have previously seen on your cluster and use",
    "start": "1026600",
    "end": "1033798"
  },
  {
    "text": "them as a key for on which to do the duplication automatically and so what we",
    "start": "1033799",
    "end": "1039438"
  },
  {
    "text": "have with the the right choice of hash is we have an IDs configure to avoid false positives completely",
    "start": "1039439",
    "end": "1047240"
  },
  {
    "text": "and um implement this in in one of the wasm inlays in web assembly uh",
    "start": "1047240",
    "end": "1052640"
  },
  {
    "text": "transformations in red panda so this turned actually out to be super simple the thing that turned out to be not so",
    "start": "1052640",
    "end": "1058520"
  },
  {
    "text": "super simple is how do we model with the tracing policies in ebpf the faceb correctly such that we actually know",
    "start": "1058520",
    "end": "1065360"
  },
  {
    "text": "this is the Baseline the Baseline is the Baseline and the attack is the attack this is the anomaly so we need to model",
    "start": "1065360",
    "end": "1071120"
  },
  {
    "text": "this correctly and here of course just enough is ideal um and this might be",
    "start": "1071120",
    "end": "1076320"
  },
  {
    "text": "quite Artful however um if you're just getting started or we getting started",
    "start": "1076320",
    "end": "1081559"
  },
  {
    "text": "you actually don't need to do this entire face base you can just go what we call the critical attack path along the",
    "start": "1081559",
    "end": "1088880"
  },
  {
    "text": "critical attack path what what is that now so we've we've seen um the tree which is relatively complex however you",
    "start": "1088880",
    "end": "1096840"
  },
  {
    "text": "can identify along each attack path things that must occur there is nothing",
    "start": "1096840",
    "end": "1102480"
  },
  {
    "text": "that can stop them from having to be there for example an SSH socket will",
    "start": "1102480",
    "end": "1107520"
  },
  {
    "text": "open a socket there will be CCP traffic non zero on that if you spawn a new pod",
    "start": "1107520",
    "end": "1112840"
  },
  {
    "text": "there will be a new Linux name space created there will be credential changes they must occur if you're communicating",
    "start": "1112840",
    "end": "1119159"
  },
  {
    "text": "from this um overprivileged service account to the API that is something that again must occur and it's those",
    "start": "1119159",
    "end": "1126000"
  },
  {
    "text": "points along each of the branches that we instrument um with at least one Trace point in in this case Tetra tetron",
    "start": "1126000",
    "end": "1133159"
  },
  {
    "text": "tracing policies to make sure we captured exactly that so we don't need to already solve the entire problem up",
    "start": "1133159",
    "end": "1140640"
  },
  {
    "text": "front we can focus for each tree this critical path and one important thing is that you",
    "start": "1140640",
    "end": "1148039"
  },
  {
    "text": "should maybe verify that you actually capture it so you run your uh sample attack script in this case it's a make",
    "start": "1148039",
    "end": "1154039"
  },
  {
    "text": "file and first we see that we see the raw values here being streamed into the red panda UI which is the Full Nest",
    "start": "1154039",
    "end": "1161240"
  },
  {
    "text": "adjacent that you get back from these K probes but and then also we check that we can flatten it out and bring it into",
    "start": "1161240",
    "end": "1168080"
  },
  {
    "text": "the standard format that we will then ship Upstream to a threat intelligence system for",
    "start": "1168080",
    "end": "1176080"
  },
  {
    "text": "example all right so we have some events now how do we share this data this is",
    "start": "1176919",
    "end": "1182520"
  },
  {
    "text": "the key how do we make this open source and free for everyone to benefit from uh",
    "start": "1182520",
    "end": "1187720"
  },
  {
    "text": "so the UK's National Security uh National cyber security Center or ncsc",
    "start": "1187720",
    "end": "1192919"
  },
  {
    "text": "advise the use of uh sticks 2 and taxi 2 um now sticks is the format for the data",
    "start": "1192919",
    "end": "1199520"
  },
  {
    "text": "and taxi is how this is uh shared pretty much now other standards do exist such",
    "start": "1199520",
    "end": "1205480"
  },
  {
    "text": "as misp um however misp really focuses on describing incidents and past events",
    "start": "1205480",
    "end": "1211360"
  },
  {
    "text": "so the data model is extremely event-based but what you seeing here is we're more interested in these attack",
    "start": "1211360",
    "end": "1217000"
  },
  {
    "text": "trees and actual linkages between observed events and those observed events with a theoretical threat model",
    "start": "1217000",
    "end": "1224080"
  },
  {
    "text": "uh so sticks is actually very well suited to this because it's graph-based now it is quite an old standard it has a",
    "start": "1224080",
    "end": "1230440"
  },
  {
    "text": "yeah Roots which are a number of years old um and it's quite complex but with",
    "start": "1230440",
    "end": "1236320"
  },
  {
    "text": "complexity comes flexibility uh so we can actually model everything in terms",
    "start": "1236320",
    "end": "1242080"
  },
  {
    "text": "of sticks objects which we will do on the next slide at least show you a a suggestion of how this could be done um",
    "start": "1242080",
    "end": "1248640"
  },
  {
    "text": "it's important not to note that sticks is graph-based with relationships between objects so it's very well suited",
    "start": "1248640",
    "end": "1254320"
  },
  {
    "text": "to these sorts of attack models and trees we have here on the right hand side um a conceptual um vision of what",
    "start": "1254320",
    "end": "1262200"
  },
  {
    "text": "the kuet Storm Center looks like so we have organizations or individuals",
    "start": "1262200",
    "end": "1267520"
  },
  {
    "text": "contributing to this storm Center in a couple of different ways the first way along the top is by running these",
    "start": "1267520",
    "end": "1273919"
  },
  {
    "text": "instrumented honey clusters where hopefully if the bait is tasty enough we will get some observed events these",
    "start": "1273919",
    "end": "1280760"
  },
  {
    "text": "observed events can then be shared in a central uh threat intelligence database",
    "start": "1280760",
    "end": "1286279"
  },
  {
    "text": "but hopefully also people will contribute on the attack model side as well because each cluster should have a",
    "start": "1286279",
    "end": "1291880"
  },
  {
    "text": "counterpart threat model so that we can label things and match things up we'll see on the next slide how we can",
    "start": "1291880",
    "end": "1297760"
  },
  {
    "text": "actually relate these to scks objects which are these very generic objects like I said um but this actually helps",
    "start": "1297760",
    "end": "1303840"
  },
  {
    "text": "us out so here we go we've got the same diagram but we've overlaid on these green objects which are sticks to",
    "start": "1303840",
    "end": "1310799"
  },
  {
    "text": "objects so in version two of the standard um as you can see on the left we have different classes of objects we",
    "start": "1310799",
    "end": "1316799"
  },
  {
    "text": "have domain objects Cy observable objects and then relationship objects so",
    "start": "1316799",
    "end": "1322480"
  },
  {
    "text": "the organization is obviously going to map to something called an identity that is fairly simple this organization is",
    "start": "1322480",
    "end": "1328679"
  },
  {
    "text": "hopefully observing advents on their instrumented honey clusters and we have a sticks SRO called a sighting which",
    "start": "1328679",
    "end": "1336279"
  },
  {
    "text": "hopefully Maps nicely to an event now this is a relationship um because the sighting can reference observable data",
    "start": "1336279",
    "end": "1343960"
  },
  {
    "text": "so as we saw in uh the example that constant ran through um we are interested interested in a few uh key",
    "start": "1343960",
    "end": "1350039"
  },
  {
    "text": "observables such as the binary being run the arguments all of these are going to be give us indicators as to the attack",
    "start": "1350039",
    "end": "1357240"
  },
  {
    "text": "tree node which is being observed we need to relate this back to the theoretical model uh so you can see here",
    "start": "1357240",
    "end": "1364039"
  },
  {
    "text": "we have an attack uh goal at the top in yellow this is mapped again to a sticks object which is an attack pattern now an",
    "start": "1364039",
    "end": "1371679"
  },
  {
    "text": "attack pattern can have again very generic data structures in there uh one such data structure is a killchain so",
    "start": "1371679",
    "end": "1379200"
  },
  {
    "text": "you can envisage the killchain for an attack pattern being the underlying nodes which need to happen it's that",
    "start": "1379200",
    "end": "1384799"
  },
  {
    "text": "critical attack path so there would be then a many to many relationship uh between indicators which is another",
    "start": "1384799",
    "end": "1391799"
  },
  {
    "text": "object and these attack patterns and an indicator would then go full circle by",
    "start": "1391799",
    "end": "1397320"
  },
  {
    "text": "referencing The observed data so we have indicators which map to the theoretical model and then we have observables which",
    "start": "1397320",
    "end": "1404600"
  },
  {
    "text": "um give us our uh trace of yes this event is happening and so everything is linked together now we have real events",
    "start": "1404600",
    "end": "1411360"
  },
  {
    "text": "mapped back to this threat model okay right so far the reference",
    "start": "1411360",
    "end": "1418400"
  },
  {
    "text": "implementation and what we thought to prove the point on the old um in the past written threat model",
    "start": "1418400",
    "end": "1427080"
  },
  {
    "text": "now in January there was a rather famous cve came out and one question that we",
    "start": "1427080",
    "end": "1432760"
  },
  {
    "text": "asked ourselves um well now we've constructed this super cheap intrusion",
    "start": "1432760",
    "end": "1438000"
  },
  {
    "text": "detection system so what about how much can we see if we have just the default",
    "start": "1438000",
    "end": "1443159"
  },
  {
    "text": "configuration none of the theoretical um modeling of the actual attack model",
    "start": "1443159",
    "end": "1450200"
  },
  {
    "text": "but can we see simply by running multiple clusters that are vulnerable",
    "start": "1450200",
    "end": "1455679"
  },
  {
    "text": "can we see an attack campaign on such a cve as if it just came out in January",
    "start": "1455679",
    "end": "1461760"
  },
  {
    "text": "and I guess you some of you will know what I'm talking about this is the Leaky vessels um attack I'm going to attack",
    "start": "1461760",
    "end": "1467960"
  },
  {
    "text": "two of my own clusters by poisoning the supply chain um I have the Baseline",
    "start": "1467960",
    "end": "1473799"
  },
  {
    "text": "removal in place I have only default tetron config um these two clusters run",
    "start": "1473799",
    "end": "1480240"
  },
  {
    "text": "full load so they have I think 20 name spaces they're slightly different will pretend that the white one's my cluster",
    "start": "1480240",
    "end": "1486440"
  },
  {
    "text": "red uh the black cluster is uh James's and um the way this exploit works is um",
    "start": "1486440",
    "end": "1493240"
  },
  {
    "text": "at the boot of a poison container there is basically a outof wax file descriptor and if I catch it I can Chader into the",
    "start": "1493240",
    "end": "1500919"
  },
  {
    "text": "host node and I can uh modify the host and in this case I'm going to um cut out",
    "start": "1500919",
    "end": "1508600"
  },
  {
    "text": "a sensitive file so in this video what I'm going to show is me attacking my own",
    "start": "1508600",
    "end": "1515600"
  },
  {
    "text": "clusters so we see on the bottom is the anomaly reduced signal now we look at",
    "start": "1515600",
    "end": "1521080"
  },
  {
    "text": "the node the note of the actual kubernetes cluster is clean here is the green running default payload and now",
    "start": "1521080",
    "end": "1529240"
  },
  {
    "text": "I'm poisoning my my registry by over tagging the image with a POC exploit for",
    "start": "1529240",
    "end": "1534399"
  },
  {
    "text": "leaky vessel and to expedite that it gets triggered I'm I'm deleting my green",
    "start": "1534399",
    "end": "1540320"
  },
  {
    "text": "deployments I could also just wait and now I'm doing this on both clusters and",
    "start": "1540320",
    "end": "1545399"
  },
  {
    "text": "now when it at the moment of the new container the poison container booting",
    "start": "1545399",
    "end": "1550559"
  },
  {
    "text": "we see in the anomaly detection immediately a signal yeah I mean I put in something that um clearly stands out",
    "start": "1550559",
    "end": "1557799"
  },
  {
    "text": "as an alert and now we see that um the the chair is happening we're cutting out",
    "start": "1557799",
    "end": "1563720"
  },
  {
    "text": "the file um we see it's the um container dhim being executed and now let's see",
    "start": "1563720",
    "end": "1570320"
  },
  {
    "text": "which pod was actually the one that got lucky with the out ofb file descriptor",
    "start": "1570320",
    "end": "1575360"
  },
  {
    "text": "it is PO number eight so if we go go to this um image number eight sorry um and",
    "start": "1575360",
    "end": "1582360"
  },
  {
    "text": "look at the logs we do actually see in the logs the sensitive file and if we go",
    "start": "1582360",
    "end": "1588399"
  },
  {
    "text": "to the node we will see that on the host we have this the the new file having been",
    "start": "1588399",
    "end": "1595640"
  },
  {
    "text": "created that means the attack worked and again we look at the other cluster and",
    "start": "1595640",
    "end": "1600840"
  },
  {
    "text": "we see okay we have obviously the same uh detection because we what we what we",
    "start": "1600840",
    "end": "1607039"
  },
  {
    "text": "did is a sort of self-made campaign of that leaky vessel exploit that we saw in",
    "start": "1607039",
    "end": "1613039"
  },
  {
    "text": "both clusters and what and we also um verified it again on the um on an",
    "start": "1613039",
    "end": "1619039"
  },
  {
    "text": "independent tool that this is really what happened and we didn't see anything else and and what this proed to us is",
    "start": "1619039",
    "end": "1625640"
  },
  {
    "text": "that we can't just uh do all this theoretical modeling with the instrumention of these tracing policies which can be a bit effortful but we can",
    "start": "1625640",
    "end": "1633039"
  },
  {
    "text": "also just use fingerprint correlation across without any effort from the only thing we have to do is this this",
    "start": "1633039",
    "end": "1639440"
  },
  {
    "text": "Baseline removal and by running this on real load clusters for a period of two",
    "start": "1639440",
    "end": "1645200"
  },
  {
    "text": "weeks we saw that the Baseline was actually quite stably removed and really the only thing it's doing is a fancy D",
    "start": "1645200",
    "end": "1650480"
  },
  {
    "text": "duplication algorithm and that's I think as simple as it gets so in terms of our",
    "start": "1650480",
    "end": "1655760"
  },
  {
    "text": "own requirements I think it is accessible in simplicity so that the hardest part is the hash function",
    "start": "1655760",
    "end": "1662279"
  },
  {
    "text": "essentially and some some J queries um the most difficult part is if you were",
    "start": "1662279",
    "end": "1668000"
  },
  {
    "text": "to fine-tune the tracing policies on level of K probes because that does require kernel level knowledge if you",
    "start": "1668000",
    "end": "1674200"
  },
  {
    "text": "want to um observe very specific things um but that um was also something that",
    "start": "1674200",
    "end": "1680720"
  },
  {
    "text": "we could crowdsource together so that not everybody needs to be a kernel expert important was that we saw parity",
    "start": "1680720",
    "end": "1686880"
  },
  {
    "text": "between a real tool and something we coded up in three weeks um because that's not obvious um we could see the l",
    "start": "1686880",
    "end": "1693840"
  },
  {
    "text": "v exploit and the one thing that I was a bit sad about that these clusters did actually not get properly attacked there",
    "start": "1693840",
    "end": "1699919"
  },
  {
    "text": "were just a couple of SSH connections um but I got really excited last week when um I got a lot of um API calls Sim links",
    "start": "1699919",
    "end": "1708159"
  },
  {
    "text": "and whatnot created but then I asked the infrastructure team and it was the SE cluster that had a bit of a network",
    "start": "1708159",
    "end": "1714720"
  },
  {
    "text": "wobble but I mean we saw it so um one of the potential reasons is that if you",
    "start": "1714720",
    "end": "1720840"
  },
  {
    "text": "looked up the the domain of this cluster you would very very quickly come to this talk into my face so that's potentially",
    "start": "1720840",
    "end": "1726519"
  },
  {
    "text": "why it didn't get properly attacked um so what I think we need is a bit less obvious bait uh and more diverse setups",
    "start": "1726519",
    "end": "1733880"
  },
  {
    "text": "that are not obvious as being traps and why I mean of course this costs money right to invest in this why do I think",
    "start": "1733880",
    "end": "1740760"
  },
  {
    "text": "this this should be invested in is if it was common knowledge that a certain percentage of all our clusters are",
    "start": "1740760",
    "end": "1747399"
  },
  {
    "text": "essentially traps or honey traps this could act as a repellent or detractor for real attackers maybe not apts but",
    "start": "1747399",
    "end": "1754640"
  },
  {
    "text": "real attackers that this could just be somebody um fishing for attacks um and",
    "start": "1754640",
    "end": "1760760"
  },
  {
    "text": "another thing is uh of course sentiment analysis of what our attacker friends are up to like this week we we're really",
    "start": "1760760",
    "end": "1768640"
  },
  {
    "text": "interested in doing a lot of copy cut behavior on this attack and maybe next week it's a it's a particular other",
    "start": "1768640",
    "end": "1774600"
  },
  {
    "text": "attack that is currently on walk so we can uh track what what is in this",
    "start": "1774600",
    "end": "1779679"
  },
  {
    "text": "particular time frame a priority to defend against and that brings us back to the outset is if we are to have these",
    "start": "1779679",
    "end": "1787960"
  },
  {
    "text": "discussions about what should we remediate first how do we prioritize this would bring us some facts in and we",
    "start": "1787960",
    "end": "1794080"
  },
  {
    "text": "wouldn't have to just rely on the opinions or whoever speaks",
    "start": "1794080",
    "end": "1799320"
  },
  {
    "text": "louder and handing over okay so thanks for staying with us so far so to",
    "start": "1799320",
    "end": "1805679"
  },
  {
    "text": "summarize our approach then we have this four-fold path to threat intelligence step one we create a threat model and we",
    "start": "1805679",
    "end": "1812799"
  },
  {
    "text": "instrument uh we we understand our critical attack path once we have this",
    "start": "1812799",
    "end": "1817960"
  },
  {
    "text": "threat model we instrument a honey cluster with ebpf trip wires and some",
    "start": "1817960",
    "end": "1823039"
  },
  {
    "text": "bait step three we then trace and stream events and remove the Baseline as",
    "start": "1823039",
    "end": "1828760"
  },
  {
    "text": "constants has described and then finally we disseminate this so that people can uh gain knowledge and use this in their",
    "start": "1828760",
    "end": "1835120"
  },
  {
    "text": "own threat models and understand these likelihoods of particular attack patterns being observed given a certain",
    "start": "1835120",
    "end": "1841559"
  },
  {
    "text": "set of constraints so this is a very big undertaking obviously and Community is",
    "start": "1841559",
    "end": "1848080"
  },
  {
    "text": "going to be crucial we need the wonderful Cloud native Community to help us obviously clusters cost money and we",
    "start": "1848080",
    "end": "1855840"
  },
  {
    "text": "need a wide variety of the these honey pot honey clusters um in order to um",
    "start": "1855840",
    "end": "1861799"
  },
  {
    "text": "build the kubernetes Storm Center so if anyone is interested in sponsoring a honey cluster we will be extremely",
    "start": "1861799",
    "end": "1867799"
  },
  {
    "text": "grateful and interested uh but also we're interested in contributions on the attack path side as well this will only",
    "start": "1867799",
    "end": "1874480"
  },
  {
    "text": "work if we have a diverse library of attack paths within the kubernetes Storm",
    "start": "1874480",
    "end": "1880080"
  },
  {
    "text": "Center such that we can create instrumented honey clusters and look for",
    "start": "1880080",
    "end": "1886039"
  },
  {
    "text": "observations you can try everything that you've seen today for yourself um we have the K8 Storm Center organization on",
    "start": "1886039",
    "end": "1892840"
  },
  {
    "text": "GitHub and there is a honey cluster repo within there where you can try out the kind stuff the rk2 stuff is in there as",
    "start": "1892840",
    "end": "1900039"
  },
  {
    "text": "well um and just another note about Community this talk would not have been possible without help from a tremendous",
    "start": "1900039",
    "end": "1906799"
  },
  {
    "text": "number of people a few of which we have uh named on this slide uh particular Liv Keats we we love these uh um bee and",
    "start": "1906799",
    "end": "1914399"
  },
  {
    "text": "spider logos um absolutely phenomenal work uh so thank you to everyone who has helped us um and thank you for listening",
    "start": "1914399",
    "end": "1922000"
  },
  {
    "text": "as well if you'd like to give us some feedback please do and we'll be around for the rest of the conference if you want to chat to us about",
    "start": "1922000",
    "end": "1928840"
  },
  {
    "text": "anything we we do have time for questions because we finished five five minutes earlier than we thought um and",
    "start": "1928840",
    "end": "1935480"
  },
  {
    "text": "we can hand out mics if if anyone does have any questions but if you prefer we'll just hang around and you can talk",
    "start": "1935480",
    "end": "1940639"
  },
  {
    "text": "to us in person whatever people prefer",
    "start": "1940639",
    "end": "1947679"
  }
]