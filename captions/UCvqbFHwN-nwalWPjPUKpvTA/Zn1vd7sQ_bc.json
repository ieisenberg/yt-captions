[
  {
    "start": "0",
    "end": "60000"
  },
  {
    "text": "well welcome everybody I'm Josh burkas I work for Red Hat in the OSS which is",
    "start": "60",
    "end": "8400"
  },
  {
    "text": "always known as the community department where I get to work on kubernetes which is truly awesome and if you know me from",
    "start": "8400",
    "end": "18300"
  },
  {
    "text": "earlier times you look at my CV you know the way that I got into kubernetes was actually moving Postgres to kubernetes",
    "start": "18300",
    "end": "25949"
  },
  {
    "text": "so this has been my sort of personal project for a while of course what you're about to see is",
    "start": "25949",
    "end": "32219"
  },
  {
    "text": "not just my personal project even primarily my personal project the lion's",
    "start": "32219",
    "end": "37230"
  },
  {
    "text": "share the work is done by the engineering team at zoeland oh we're specifically the database team Enzo endo",
    "start": "37230",
    "end": "43530"
  },
  {
    "text": "we started collaborating two years ago on the Patroni project they nobody from",
    "start": "43530",
    "end": "49950"
  },
  {
    "text": "that database team could be here at coop con which is why I'm on this podium by myself but I'll tell you all about it",
    "start": "49950",
    "end": "56460"
  },
  {
    "text": "and I'm sure they will be at coop con Europe I'm talking about things so my",
    "start": "56460",
    "end": "63390"
  },
  {
    "start": "60000",
    "end": "213000"
  },
  {
    "text": "goal and really the goal the Patroni project from the beginning is to make",
    "start": "63390",
    "end": "70680"
  },
  {
    "text": "deploying PostgreSQL on kubernetes or frankly to make deploying PostgreSQL in",
    "start": "70680",
    "end": "78390"
  },
  {
    "text": "any form boring that is it shouldn't",
    "start": "78390",
    "end": "83460"
  },
  {
    "text": "take you shouldn't be boasting about deploying PostgreSQL on your internal",
    "start": "83460",
    "end": "90600"
  },
  {
    "text": "cloud or on your public cloud because it should be something that everyone does with the single command and and that's",
    "start": "90600",
    "end": "98549"
  },
  {
    "text": "our goal now was what boarding comes from is if you saw Matt si posted an",
    "start": "98549",
    "end": "106049"
  },
  {
    "text": "article a couple of days ago talking about how despite being 27 years old at",
    "start": "106049",
    "end": "113670"
  },
  {
    "text": "this point I think PostgreSQL is like one of the hot hip databases to use with",
    "start": "113670",
    "end": "120270"
  },
  {
    "text": "all your new technology tools and why this is one of the reasons why people like using PostgreSQL even with new",
    "start": "120270",
    "end": "127439"
  },
  {
    "text": "languages and new servers and new technologies is that it is boring and what he means by boring is",
    "start": "127439",
    "end": "134230"
  },
  {
    "text": "it is not something that you have to think about as in you deploy Postgres",
    "start": "134230",
    "end": "142270"
  },
  {
    "text": "and then you save your data to Postgres and in Postgres as your data has saved it's saved and opposed to assess your",
    "start": "142270",
    "end": "148569"
  },
  {
    "text": "data is replicated it's replicated and you don't really have to think about whether that's true or not or about",
    "start": "148569",
    "end": "154810"
  },
  {
    "text": "starting strategies or about all kinds of other stuff that you have to with",
    "start": "154810",
    "end": "160750"
  },
  {
    "text": "some of the more interesting scale of databases now it's a good statement it's",
    "start": "160750",
    "end": "167530"
  },
  {
    "text": "not hip it it's not hip and takes a bit to setup but after you're done you have a reliable workhorse well so what I want",
    "start": "167530",
    "end": "173200"
  },
  {
    "text": "to do is I want to actually take out one part of that statement the it takes a bit to setup and that's what this",
    "start": "173200",
    "end": "179920"
  },
  {
    "text": "project is about and kubernetes is a big help with us so I'm going to explain a few things here I'm gonna explain the",
    "start": "179920",
    "end": "186160"
  },
  {
    "text": "Patroni project and the tool in general for anybody who hasn't seen one of these one of the earlier presentations for",
    "start": "186160",
    "end": "193299"
  },
  {
    "text": "earlier versions of the tool explain what we changed recently for anybody who has seen my previous presentations and",
    "start": "193299",
    "end": "200470"
  },
  {
    "text": "then actually show you the sort of kubernetes native version of it and demo that as well as a brief demo of the",
    "start": "200470",
    "end": "208420"
  },
  {
    "text": "solando post quiz operator and then talk a little bit about another post quiz operator now for anybody who has seen",
    "start": "208420",
    "end": "215500"
  },
  {
    "start": "213000",
    "end": "333000"
  },
  {
    "text": "you know this before or read any of my stuff about Patroni etc what's changed",
    "start": "215500",
    "end": "222790"
  },
  {
    "text": "since like the last coop con is a lot tighter kubernetes integration in order",
    "start": "222790",
    "end": "230470"
  },
  {
    "text": "to just rely more on kubernetes for all of the infrastructure things I'll show you that the second thing is that we",
    "start": "230470",
    "end": "237820"
  },
  {
    "text": "have an operator now which is fairly alpha but there's an operator out there for anybody it's really the operator",
    "start": "237820",
    "end": "243430"
  },
  {
    "text": "pattern and again I will show you that and then the third thing of course is that Patroni kubernetes etc is now being",
    "start": "243430",
    "end": "251019"
  },
  {
    "text": "used in production and in a couple of different places and so as a result",
    "start": "251019",
    "end": "256060"
  },
  {
    "text": "we've learned a lot by having it deployed in production and relied on which improvements have gone into pitch",
    "start": "256060",
    "end": "262840"
  },
  {
    "text": "so some terminology so post res PostgreSQL that's the database we're",
    "start": "262840",
    "end": "268760"
  },
  {
    "text": "talking about they you know one that's been around again you know since the 80s",
    "start": "268760",
    "end": "275440"
  },
  {
    "text": "and yet continues to add new things Patroni is a high availability demon",
    "start": "275440",
    "end": "282530"
  },
  {
    "text": "service that runs inside a container explain a little bit more about that and spy low is a distribution that wraps",
    "start": "282530",
    "end": "292040"
  },
  {
    "text": "Patroni and PostgreSQL and some other common utilities in a container to be",
    "start": "292040",
    "end": "298100"
  },
  {
    "text": "your container of Postgres goodness so you'll see those words again in this presentation and that's what the three",
    "start": "298100",
    "end": "304100"
  },
  {
    "text": "different sort of things are so petite them to talk a lot about a Patroni which is the high availability demon so this",
    "start": "304100",
    "end": "310370"
  },
  {
    "text": "does a few things you run in your container as PID one it controls whether",
    "start": "310370",
    "end": "315500"
  },
  {
    "text": "or not Postgres is running in that container it automates failover and replication for your cluster of whatever",
    "start": "315500",
    "end": "322400"
  },
  {
    "text": "defined size and it also supplies a management API high for the things that",
    "start": "322400",
    "end": "329390"
  },
  {
    "text": "you can't do through the normal per squares interface now question of you",
    "start": "329390",
    "end": "335960"
  },
  {
    "start": "333000",
    "end": "745000"
  },
  {
    "text": "know what's the idea what's the design behind this what are sort of specifically what do we think why we're",
    "start": "335960",
    "end": "343130"
  },
  {
    "text": "doing Patroni and not using some other systems and you know what are our goals and there's three basic ones so we're",
    "start": "343130",
    "end": "350150"
  },
  {
    "text": "looking for simplicity usability and availability and what I mean by",
    "start": "350150",
    "end": "356510"
  },
  {
    "text": "simplicity is we're really trying to the majority people write us people who are",
    "start": "356510",
    "end": "362240"
  },
  {
    "text": "post quiz geeks we think of Postgres is this huge constellation of services you know that does all these different",
    "start": "362240",
    "end": "367430"
  },
  {
    "text": "things need that for it data wrappers and you've got monitoring tools know these are these things for us you know having push must be being complex is",
    "start": "367430",
    "end": "373700"
  },
  {
    "text": "actually a virtue for everyone else Postgres is one thing it's an endpoint and they want that to be one endpoint",
    "start": "373700",
    "end": "379880"
  },
  {
    "text": "and not sixteen different things in so our goal partly with the patron Ian's",
    "start": "379880",
    "end": "386600"
  },
  {
    "text": "phyllo is to make postcards one endpoint and not sixteen different things",
    "start": "386600",
    "end": "392470"
  },
  {
    "text": "- in you know rely on kubernetes as much as possible so that the Patroni if you",
    "start": "392470",
    "end": "398620"
  },
  {
    "text": "know install does not have to be complicated that instead we're simply relying on the tools that ship with or",
    "start": "398620",
    "end": "405400"
  },
  {
    "text": "tools that we can enable with kubernetes in to supply a set of defaults that are",
    "start": "405400",
    "end": "411460"
  },
  {
    "text": "what we believe just work for most users instead of requiring anybody to go",
    "start": "411460",
    "end": "416770"
  },
  {
    "text": "through any kind of a complicated configuration for a simple database that's going to support say a web",
    "start": "416770",
    "end": "422260"
  },
  {
    "text": "application for usability we've got a couple of things one is there are some",
    "start": "422260",
    "end": "427600"
  },
  {
    "text": "things in terms of controlling PostgreSQL that you can't do through the port five four three two sequel",
    "start": "427600",
    "end": "433690"
  },
  {
    "text": "interface and that includes things like changing security settings starting and",
    "start": "433690",
    "end": "439210"
  },
  {
    "text": "stopping initializing replication etc and so we supply port access to that with a",
    "start": "439210",
    "end": "445390"
  },
  {
    "text": "restful interface I some configuration and plugins in order to support a variety of cloud environments like for",
    "start": "445390",
    "end": "452290"
  },
  {
    "text": "example is a whole set of plugins for different backup tools because for",
    "start": "452290",
    "end": "458620"
  },
  {
    "text": "continuous backup to cold storage just in case you lose your entire cluster so you still have data and then the other",
    "start": "458620",
    "end": "465790"
  },
  {
    "text": "thing is that of course unlike a lot of public cloud providers we want you to be able to run something that places no",
    "start": "465790",
    "end": "471970"
  },
  {
    "text": "limitation on what Postgres plugins or configuration options you're going to run you know because maybe you want some",
    "start": "471970",
    "end": "478450"
  },
  {
    "text": "obscure plugin for doing I don't know biological data in Postgres that you can't get off of Amazon RDS we",
    "start": "478450",
    "end": "485590"
  },
  {
    "text": "want you to be able to install that so and then of course availability we're",
    "start": "485590",
    "end": "491020"
  },
  {
    "text": "talking about fully automated replication and failover that's it just",
    "start": "491020",
    "end": "496480"
  },
  {
    "text": "work you've got three Postma's nodes one of them is the master at any given time if the master goes away you get a new",
    "start": "496480",
    "end": "502480"
  },
  {
    "text": "master so now let's talk about a little bit about what's changed recently and by",
    "start": "502480",
    "end": "508750"
  },
  {
    "text": "change recently I mean this is still a feature branch the so our Patroni design",
    "start": "508750",
    "end": "515820"
  },
  {
    "text": "I started out actually before kubernetes",
    "start": "515820",
    "end": "521500"
  },
  {
    "text": "was really usable as anything but we had at CD and so",
    "start": "521500",
    "end": "526779"
  },
  {
    "text": "we designed it where you spin up an fcd cluster to provide to provide a single",
    "start": "526779",
    "end": "534010"
  },
  {
    "text": "source of truth I think everybody here knows what @cd is and what it does yes yeah at least byte by this point in the",
    "start": "534010",
    "end": "541360"
  },
  {
    "text": "conference you ought to the and to supply a single sort of truth run that",
    "start": "541360",
    "end": "546550"
  },
  {
    "text": "xcd semper net CD cost on kubernetes and then the post quiz nodes communicate to",
    "start": "546550",
    "end": "553060"
  },
  {
    "text": "and update the sed cluster and then at the same time the kubernetes cluster maintains things like I should have",
    "start": "553060",
    "end": "560140"
  },
  {
    "text": "three nodes in this particular post Chrisette or five nodes or whatever and they have this storage etc so and that",
    "start": "560140",
    "end": "568420"
  },
  {
    "text": "works pretty well and that's actually what's in production in several places however Wilkin at this and we're saying you know what that's still more",
    "start": "568420",
    "end": "574720"
  },
  {
    "text": "complicated than it needs to be why don't we need this separate at CD when I already have a single source of truth",
    "start": "574720",
    "end": "580930"
  },
  {
    "text": "which is called the kubernetes api so what we've done recently is get rid of",
    "start": "580930",
    "end": "588430"
  },
  {
    "text": "that separate act at CD as an option there's actually always going to be reasons why you want to run a separate",
    "start": "588430",
    "end": "594790"
  },
  {
    "text": "CD for some clusters but again simple defaults and as a default you know",
    "start": "594790",
    "end": "601560"
  },
  {
    "text": "instead of having a separate DCs everything goes through the kubernetes",
    "start": "601560",
    "end": "606790"
  },
  {
    "text": "api so you know leader elections go through the kubernetes api to some other",
    "start": "606790",
    "end": "613839"
  },
  {
    "text": "structures and everything else so this is as simple as possible because the idea is now I can deploy a high",
    "start": "613839",
    "end": "620470"
  },
  {
    "text": "availability puskás cluster that consists of three and only three pods instead of needing several different",
    "start": "620470",
    "end": "627100"
  },
  {
    "text": "services so now because most people in",
    "start": "627100",
    "end": "632589"
  },
  {
    "text": "the room have not seen any Patroni presentations before let me go over basically how this works in terms of",
    "start": "632589",
    "end": "637930"
  },
  {
    "text": "high availability with an animation and then I'll go ahead and actually demo in action so the basic idea here is we have",
    "start": "637930",
    "end": "644680"
  },
  {
    "text": "our container with Postgres inside we've got the Patroni daemon running in the",
    "start": "644680",
    "end": "650050"
  },
  {
    "text": "container is PID one and then what happens is we have kubernetes we tell it",
    "start": "650050",
    "end": "656199"
  },
  {
    "text": "to create a stateful set and it distributes a bunch of these creates a whole bunch of these and then we've",
    "start": "656199",
    "end": "662880"
  },
  {
    "text": "got a bunch up and running that are empty currently because we're deploying a new cluster so what happens is they",
    "start": "662880",
    "end": "669150"
  },
  {
    "text": "all communicate with kubernetes api and they say we want to have a leader election by updating actually a config",
    "start": "669150",
    "end": "675900"
  },
  {
    "text": "map and an endpoint and then they have that leader election and one of the",
    "start": "675900",
    "end": "680910"
  },
  {
    "text": "nodes wins that node becomes the master at which point replication the other two",
    "start": "680910",
    "end": "686760"
  },
  {
    "text": "nodes start replicating from that master now things can happen to the master",
    "start": "686760",
    "end": "692940"
  },
  {
    "text": "particularly we're in a container cloud environment if nothing else we can run out of resources on that node and",
    "start": "692940",
    "end": "698220"
  },
  {
    "text": "kubernetes can decide that it needs to migrate that container right so if",
    "start": "698220",
    "end": "704160"
  },
  {
    "text": "something happens to the master what happens is the master key in the config",
    "start": "704160",
    "end": "709560"
  },
  {
    "text": "map times out and then the remaining replicas will do another leader election",
    "start": "709560",
    "end": "715350"
  },
  {
    "text": "and one of them will win and become the new master and the other one will start",
    "start": "715350",
    "end": "720510"
  },
  {
    "text": "replication from that new master and this will all happen in the background and then of course kubernetes will",
    "start": "720510",
    "end": "726600"
  },
  {
    "text": "notice that it does not have enough nodes in its stateful set and bring up another another Postgres which will then",
    "start": "726600",
    "end": "734250"
  },
  {
    "text": "replicate from the existing master making sure you have constant you know this and then via kubernetes services",
    "start": "734250",
    "end": "741089"
  },
  {
    "text": "and endpoints we can make sure that there is always a connection to the master available so let me actually go a",
    "start": "741089",
    "end": "746910"
  },
  {
    "start": "745000",
    "end": "817000"
  },
  {
    "text": "little bit more into detail and that failover because it is a little more complicated than just making a call to",
    "start": "746910",
    "end": "751980"
  },
  {
    "text": "the API so what happens is the master van vanishes and it's gotten this",
    "start": "751980",
    "end": "757500"
  },
  {
    "text": "timeout you know we've got a time stamp on it and so we know the master hasn't checked in in a while so then the",
    "start": "757500",
    "end": "762779"
  },
  {
    "text": "replicas who are checking in realized the master is not there and they grab a lock currently what we are doing for",
    "start": "762779",
    "end": "768690"
  },
  {
    "text": "that is we're actually having them redefine the master endpoint because in the way the kubernetes currently works",
    "start": "768690",
    "end": "775140"
  },
  {
    "text": "that's an operation that only one of them can win the the winner then checks",
    "start": "775140",
    "end": "782220"
  },
  {
    "text": "the current replication status to make sure that it wasn't already it didn't already have broken replication before",
    "start": "782220",
    "end": "787980"
  },
  {
    "text": "the last down I if replication status is okay it",
    "start": "787980",
    "end": "793440"
  },
  {
    "text": "will update the config map indicating that it is the master and then the other replicas who are not able to grab the",
    "start": "793440",
    "end": "799560"
  },
  {
    "text": "end point will remaster off of that master and you will have a new cluster so it's a little bit it's a two-stage",
    "start": "799560",
    "end": "807680"
  },
  {
    "text": "failover which can affect you if you have a really crappy network because if",
    "start": "807680",
    "end": "813930"
  },
  {
    "text": "your network support is really crappy then it's gonna be a little slow but so let's actually do that so",
    "start": "813930",
    "end": "828470"
  },
  {
    "text": "well actually let me show you what's in that before I do this because it creates very fast so so we've got here a sample",
    "start": "832510",
    "end": "843519"
  },
  {
    "text": "manifest this is just a slight modification of the one given as an example in the kubernetes branch of the",
    "start": "843519",
    "end": "851649"
  },
  {
    "text": "Patroni repo so you can take a look at this yourself later but basically we just have we define a cluster name in",
    "start": "851649",
    "end": "858100"
  },
  {
    "text": "there we have labeled applications we're telling it to do three replicas you know",
    "start": "858100",
    "end": "864550"
  },
  {
    "text": "for obviously for high availability purposes I recommend always at least three because there's a lot of things",
    "start": "864550",
    "end": "870130"
  },
  {
    "text": "that can cause two to fail the and then",
    "start": "870130",
    "end": "875260"
  },
  {
    "text": "we have our container here I have a slightly modified image because this is",
    "start": "875260",
    "end": "881199"
  },
  {
    "text": "a feature branch and I've been debugging but it will be merged before the end of",
    "start": "881199",
    "end": "887350"
  },
  {
    "text": "the year the end then we just have some",
    "start": "887350",
    "end": "892389"
  },
  {
    "text": "definition of the container and everything else and your usual volumes",
    "start": "892389",
    "end": "898350"
  },
  {
    "text": "and then we define a whole bunch of environment variables that are getting passed through to the Patroni daemon in",
    "start": "898350",
    "end": "904269"
  },
  {
    "text": "order to configure the behavior of Postgres so the usual things password",
    "start": "904269",
    "end": "910720"
  },
  {
    "text": "ports if we were going to put in any kind of performance modifications from the post whose defaults like how much",
    "start": "910720",
    "end": "916600"
  },
  {
    "text": "memory uses etc we would also pass them here the and I've got this commented out",
    "start": "916600",
    "end": "924970"
  },
  {
    "text": "because I've got it running in me and cubed and there's no actual volumes the then we have to define a couple of other",
    "start": "924970",
    "end": "930339"
  },
  {
    "text": "things we actually wanted to find a separate end point if people are not familiar with endpoints because you might not be normally when you create a",
    "start": "930339",
    "end": "935709"
  },
  {
    "text": "kubernetes service and you to give that service a selector then in the",
    "start": "935709",
    "end": "940779"
  },
  {
    "text": "background agreed something called an endpoint that actually allows things to connect however you can create a service",
    "start": "940779",
    "end": "947019"
  },
  {
    "text": "without a selector in which case there is no endpoint and you can define your own invoice most of the time people use",
    "start": "947019",
    "end": "953139"
  },
  {
    "text": "this to connect to services outside of kubernetes but in our case we're using this to redefine the connection",
    "start": "953139",
    "end": "958810"
  },
  {
    "text": "specifically to the master node so that we update only the endpoint the",
    "start": "958810",
    "end": "965860"
  },
  {
    "text": "and then we create this sort of headless service with no selector now I also want",
    "start": "965860",
    "end": "971890"
  },
  {
    "text": "a separate service that's going to load balance to all nodes for read-only connections so I create that service as",
    "start": "971890",
    "end": "977920"
  },
  {
    "text": "well and then of course we have to have passwords and secrets so okay",
    "start": "977920",
    "end": "993180"
  },
  {
    "text": "okay so you can see this here we've got this extra label called roll you know I'm gonna actually shrink this just a",
    "start": "998110",
    "end": "1004410"
  },
  {
    "text": "little bit and you can see first a master comes up and then replicas come",
    "start": "1004410",
    "end": "1010650"
  },
  {
    "text": "up oh that's very interesting sorry",
    "start": "1010650",
    "end": "1020460"
  },
  {
    "text": "about that that is a remnant of running through this demo over there so we've got a",
    "start": "1020460",
    "end": "1029040"
  },
  {
    "text": "master in two replicas right there show you this actually in the console because",
    "start": "1029040",
    "end": "1034829"
  },
  {
    "text": "it's actually kind of in easier way so we've got our state full set of Patroni demo right here and then again here are",
    "start": "1034830",
    "end": "1042089"
  },
  {
    "text": "all of the nodes these are actually sort of fun if you look at the we we send all",
    "start": "1042089",
    "end": "1050100"
  },
  {
    "text": "of the activity here to the log output",
    "start": "1050100",
    "end": "1054890"
  },
  {
    "text": "so you get the leader talking about being the leader",
    "start": "1055940",
    "end": "1061460"
  },
  {
    "text": "and we'll get the rep of this talking about being replicas where's your main logout but we also funnel of course the",
    "start": "1072080",
    "end": "1077900"
  },
  {
    "text": "post course log output to this I in the process of this we create a couple of",
    "start": "1077900",
    "end": "1083000"
  },
  {
    "text": "config maps and those should also not be there okay you know one of which",
    "start": "1083000",
    "end": "1090560"
  },
  {
    "text": "actually has the configuration of the cluster which would have any non default",
    "start": "1090560",
    "end": "1096140"
  },
  {
    "text": "items I haven't I don't have a lot of non default settings in here one of the non default settings I have in there is",
    "start": "1096140",
    "end": "1101330"
  },
  {
    "text": "there's a tool called PG rewind that can allow us to bring individual post",
    "start": "1101330",
    "end": "1107240"
  },
  {
    "text": "quizzes into sync if they've gotten a little ahead during a failover circumstance that post goes our",
    "start": "1107240",
    "end": "1113210"
  },
  {
    "text": "application details the and but the more",
    "start": "1113210",
    "end": "1120890"
  },
  {
    "text": "important thing is this leader config map actually gives you the is one of the one of these several ways we offer to",
    "start": "1120890",
    "end": "1127280"
  },
  {
    "text": "get information about who's the current leader so there's a lot more interesting extra fishery the failover",
    "start": "1127280",
    "end": "1134380"
  },
  {
    "text": "so it's killed the current master and as",
    "start": "1143530",
    "end": "1149740"
  },
  {
    "text": "you can see when when network latency is negligible as it is when you're running this on mini cube it picks up the fact",
    "start": "1149740",
    "end": "1157510"
  },
  {
    "text": "that the master is gone really fast any when it's slower than that it's slower",
    "start": "1157510",
    "end": "1162640"
  },
  {
    "text": "than that specifically because of network round-trip time to actually sort of detect that things are gone and",
    "start": "1162640",
    "end": "1168160"
  },
  {
    "text": "obviously when you do things like when you lose physical nodes from your network it can take a little bit longer for a network to timeout and then",
    "start": "1168160",
    "end": "1175200"
  },
  {
    "text": "kubernetes will spin up a new one and we'll have a replica again and let me",
    "start": "1175200",
    "end": "1182140"
  },
  {
    "text": "show you those endpoints here so we've got two endpoints one is the master on the endpoint which is pointed at",
    "start": "1182140",
    "end": "1187570"
  },
  {
    "text": "whichever one is currently the master and then we have our load balancing endpoint that gets created now one of",
    "start": "1187570",
    "end": "1199930"
  },
  {
    "start": "1196000",
    "end": "1232000"
  },
  {
    "text": "the things that you can actually say here he is Wow that's nifty and that's really super useful but among other",
    "start": "1199930",
    "end": "1205480"
  },
  {
    "text": "things who want to actually do among",
    "start": "1205480",
    "end": "1211570"
  },
  {
    "text": "other things do all this passing configuration the environment variables in kubernetes manifests is really",
    "start": "1211570",
    "end": "1218620"
  },
  {
    "text": "irritating and really doesn't help me when I need to actually manage dozens or",
    "start": "1218620",
    "end": "1223840"
  },
  {
    "text": "hundreds of postcodes clusters so it would be nice if there was another way",
    "start": "1223840",
    "end": "1229470"
  },
  {
    "text": "well there is and that's called operators so are people how many people",
    "start": "1229470",
    "end": "1236560"
  },
  {
    "start": "1232000",
    "end": "1252000"
  },
  {
    "text": "here are familiar with the operator pattern the hole operator idea yeah so I mean core OS created the sort of",
    "start": "1236560",
    "end": "1244030"
  },
  {
    "text": "operator idea around a database at CD and it turns out that it's actually useful for databases in general probably",
    "start": "1244030",
    "end": "1250960"
  },
  {
    "text": "for other things where I've seen it used as databases so there's a few reasons why you want to use an operator one is",
    "start": "1250960",
    "end": "1257200"
  },
  {
    "start": "1252000",
    "end": "1319000"
  },
  {
    "text": "it makes it easier to keep documented and they get repo the clusters that",
    "start": "1257200",
    "end": "1262990"
  },
  {
    "text": "you're supposed to have because you reduce the information to the information that's distinct about each",
    "start": "1262990",
    "end": "1268840"
  },
  {
    "text": "cluster rather than having a lot of scaffolding in with your cluster configuration files the for that",
    "start": "1268840",
    "end": "1277080"
  },
  {
    "text": "if you have divided up teams you can actually pass a much simpler structure set of information to define the cluster",
    "start": "1277080",
    "end": "1284130"
  },
  {
    "text": "so that people don't have to understand kubernetes yeah mole structure and how to define kubernetes objects and stuff",
    "start": "1284130",
    "end": "1289800"
  },
  {
    "text": "and have the opportunity to screw up your kubernetes cluster in the process and then the other thing is an operator",
    "start": "1289800",
    "end": "1297810"
  },
  {
    "text": "is actually an active thing it is a thing that runs on your kubernetes cluster and that's important because databases require scheduled work like if",
    "start": "1297810",
    "end": "1305700"
  },
  {
    "text": "you have continuous backup running they have to take a snapshot periodically sometimes you want to run other forms of",
    "start": "1305700",
    "end": "1310980"
  },
  {
    "text": "maintenance and that sort of thing so simply a stateful deployment deployment",
    "start": "1310980",
    "end": "1316950"
  },
  {
    "text": "you're not done and the big thing is hey I'm effectively",
    "start": "1316950",
    "end": "1322980"
  },
  {
    "start": "1319000",
    "end": "1333000"
  },
  {
    "text": "creating this a manifest anyway so if I'm doing that why not have that run",
    "start": "1322980",
    "end": "1328830"
  },
  {
    "text": "everything why don't just create a manifest and have everything else be automatic so I'm gonna show you one",
    "start": "1328830",
    "end": "1336480"
  },
  {
    "start": "1333000",
    "end": "1361000"
  },
  {
    "text": "Operator so like I said spy lo is the sort of full packaging of Patroni plus the other stuff so there's an operator",
    "start": "1336480",
    "end": "1343860"
  },
  {
    "text": "for spy lo which is what zillion o currently uses in their staging cluster it hasn't gone to the production cluster",
    "start": "1343860",
    "end": "1349590"
  },
  {
    "text": "yet and what you do for that is you",
    "start": "1349590",
    "end": "1354900"
  },
  {
    "text": "install the operator you create a manifest for each cluster if you want to modify clusters you do that by modifying",
    "start": "1354900",
    "end": "1360000"
  },
  {
    "text": "the manifest so let's actually do that although it'll",
    "start": "1360000",
    "end": "1366480"
  },
  {
    "start": "1361000",
    "end": "1711000"
  },
  {
    "text": "take me a minute because apparently I have a lot of remnants of the previous uninstall so",
    "start": "1366480",
    "end": "1375500"
  },
  {
    "text": "okay so pardon me why delete stuff left over from the previous run of this",
    "start": "1378180",
    "end": "1385580"
  },
  {
    "text": "because otherwise it will refuse to build it okay so I need to install a",
    "start": "1390620",
    "end": "1401700"
  },
  {
    "text": "config map for the operator itself because the operator has a configuration",
    "start": "1401700",
    "end": "1407540"
  },
  {
    "text": "and then I need actually create a service account for it because something is required for greeting operators and",
    "start": "1407990",
    "end": "1418580"
  },
  {
    "text": "then I need to create the operator",
    "start": "1418580",
    "end": "1422480"
  },
  {
    "text": "and then you'll see the operator plugs in registers itself that's the this",
    "start": "1425800",
    "end": "1432250"
  },
  {
    "text": "Philo operator there so once I've created an operator I can",
    "start": "1432250",
    "end": "1443560"
  },
  {
    "text": "by simply defining a manifest in passing the manifest to the operator tell it to",
    "start": "1443560",
    "end": "1448600"
  },
  {
    "text": "create a cluster so this is what a manifest looks like for an operator you",
    "start": "1448600",
    "end": "1453730"
  },
  {
    "text": "know it's still yellow but it is not you don't have to understand the kubernetes",
    "start": "1453730",
    "end": "1459340"
  },
  {
    "text": "infrastructure to be able to write these which is really important if you're gonna have say development teams",
    "start": "1459340",
    "end": "1464710"
  },
  {
    "text": "breeding databases for their own applications instead you define some users you define some post Chris",
    "start": "1464710",
    "end": "1470260"
  },
  {
    "text": "settings I don't really have a lot in this particular one because I'm trying to show you a simple one but you can define a whole bunch of Postgres",
    "start": "1470260",
    "end": "1475840"
  },
  {
    "text": "settings within that manifest so okay",
    "start": "1475840",
    "end": "1488280"
  },
  {
    "text": "so let's actually go down here and now",
    "start": "1488280",
    "end": "1494250"
  },
  {
    "text": "okay why do we not have",
    "start": "1497880",
    "end": "1501230"
  },
  {
    "text": "hmm no no I'm actually going to do hold",
    "start": "1504679",
    "end": "1513480"
  },
  {
    "text": "on a moment I I still think I have remnants left over",
    "start": "1513480",
    "end": "1519570"
  },
  {
    "text": "from other stuff so let me spin up a new cluster Hey",
    "start": "1519570",
    "end": "1525200"
  },
  {
    "text": "there we go yeah when one of the outstanding bugs if you go to the post cruise operator thing you will see that",
    "start": "1536240",
    "end": "1542990"
  },
  {
    "text": "there's an outstanding issue for it failing to clean up when we delete clusters so there is actually an issue",
    "start": "1542990",
    "end": "1548690"
  },
  {
    "text": "there it's being worked on the but we go ahead and install that and why are we",
    "start": "1548690",
    "end": "1557690"
  },
  {
    "text": "not seeing this pilot roll oh there we are so again like rate like the the bear",
    "start": "1557690",
    "end": "1563780"
  },
  {
    "text": "Patroni one of them get selected whoops no it's not what it wanted what doesn't get selected is the master then the",
    "start": "1563780",
    "end": "1570500"
  },
  {
    "text": "other two should replicate from it in just a second the if we actually refresh",
    "start": "1570500",
    "end": "1582470"
  },
  {
    "text": "so we've got now our stateful set running our three nodes for that",
    "start": "1582470",
    "end": "1591980"
  },
  {
    "text": "and the same some of the same config maps that you would actually see through",
    "start": "1591980",
    "end": "1598150"
  },
  {
    "text": "doing the Patroni it's the same thing but again you've simplified it even further and this has",
    "start": "1598150",
    "end": "1604940"
  },
  {
    "text": "the tremendous advantage that you can now hand this off to development or testing teams who can deploy Postgres",
    "start": "1604940",
    "end": "1610850"
  },
  {
    "text": "clusters as they need them without needing to understand how kubernetes works",
    "start": "1610850",
    "end": "1616570"
  },
  {
    "text": "now the spinal operator is not the only operator out there there's another whole",
    "start": "1622810",
    "end": "1630140"
  },
  {
    "text": "nother project for post-closing kubernetes that comes from crunchy data hi there we've one of the quincy data",
    "start": "1630140",
    "end": "1637490"
  },
  {
    "text": "staff here that comes from crunchy data they have their own operator that's been out for a little bit longer so it's a",
    "start": "1637490",
    "end": "1644090"
  },
  {
    "text": "little bit more mature their architecture is very different from their architectures very different from",
    "start": "1644090",
    "end": "1649760"
  },
  {
    "text": "the petronia architecture they were very much coming from the enterprise side of things and so they're really looking at",
    "start": "1649760",
    "end": "1656270"
  },
  {
    "text": "having a very full service Postgres offering with a lot of tooling the which",
    "start": "1656270",
    "end": "1664400"
  },
  {
    "text": "is what their thing the crunchy container suite is what it's called we will get up the and also the design of",
    "start": "1664400",
    "end": "1671000"
  },
  {
    "text": "operate their operators a little bit different design of our operator Spile operators extremely manifest driven and",
    "start": "1671000",
    "end": "1678380"
  },
  {
    "text": "there really aren't like other ways to interact with it the crunchy puskás operator is very command and control",
    "start": "1678380",
    "end": "1683870"
  },
  {
    "text": "driven and what I mean by command and control is there's a client tool called pgo that talks to the operator and so if",
    "start": "1683870",
    "end": "1691610"
  },
  {
    "text": "you're using the crunchy operator the main way to actually deploy things is to use this client to specifically",
    "start": "1691610",
    "end": "1697370"
  },
  {
    "text": "communicate with the operator the and they have a whole demo and everything",
    "start": "1697370",
    "end": "1702800"
  },
  {
    "text": "else around that and it's and again it's one of those sort of trade offs in terms of how you want to do things there are",
    "start": "1702800",
    "end": "1708680"
  },
  {
    "text": "advantages both ways they don't pop in",
    "start": "1708680",
    "end": "1714080"
  },
  {
    "text": "sorry I had your hole I had the whole architecture diagram of the container suite again industry just a lot of",
    "start": "1714080",
    "end": "1719420"
  },
  {
    "text": "things in it so like I said it's also a very different set up for high availability Postgres and I am a little",
    "start": "1719420",
    "end": "1725480"
  },
  {
    "text": "bit too far forward so so very different setup for high availability post quiz then the Patroni setup quick comparison",
    "start": "1725480",
    "end": "1734570"
  },
  {
    "start": "1732000",
    "end": "1796000"
  },
  {
    "text": "of actually going through and trying out both operators and going through this there's some of it I mean the biggest thing is that the spy low operator is",
    "start": "1734570",
    "end": "1741170"
  },
  {
    "text": "still kind of alpha because it was created recently yeah things move fast we'll say it forever sort of different",
    "start": "1741170",
    "end": "1748640"
  },
  {
    "text": "ways looking in there one of the main reasons why it's still kind of alpha is we haven't really written any documentation for it",
    "start": "1748640",
    "end": "1754820"
  },
  {
    "text": "which will change the eye there's not yeah there's not a specific CLI for the",
    "start": "1754820",
    "end": "1764480"
  },
  {
    "text": "Spile operator they're very much is one for the crunch operator very sophisticated CLI depends on with likes",
    "start": "1764480",
    "end": "1769789"
  },
  {
    "text": "the eyes are not crunchy is God is openshift compatible now Spile o is not really both support rolling up rates of",
    "start": "1769789",
    "end": "1779299"
  },
  {
    "text": "post press which is another important thing that the operator does for you because you can do that by specifying a",
    "start": "1779299",
    "end": "1784850"
  },
  {
    "text": "lot of things in your upgrade strategy for new containers in kubernetes",
    "start": "1784850",
    "end": "1790760"
  },
  {
    "text": "deployment but you'd rather not have to write that since since the operator already knows what to do so",
    "start": "1790760",
    "end": "1797630"
  },
  {
    "start": "1796000",
    "end": "1849000"
  },
  {
    "text": "some future work plans because is active number one is obviously merge the kubernetes native branch into the main",
    "start": "1797630",
    "end": "1804620"
  },
  {
    "text": "Patroni second thing is to actually right now the operator integrate the",
    "start": "1804620",
    "end": "1813200"
  },
  {
    "text": "operator and the kubernetes native branch which currently currently the",
    "start": "1813200",
    "end": "1818900"
  },
  {
    "text": "operator uses the older version of Patroni I'm working on OpenShift compatibility because they work for Red",
    "start": "1818900",
    "end": "1824150"
  },
  {
    "text": "Hat and I have to work on openshift compatibility and besides there's lots of people who use openshift and use postcards on open chests so the",
    "start": "1824150",
    "end": "1831250"
  },
  {
    "text": "Prometheus integration is a big interest of mine because I like metrics but I also want to package some other things",
    "start": "1831250",
    "end": "1837740"
  },
  {
    "text": "up for it like powwow which is this Postgres performance analysis tool and",
    "start": "1837740",
    "end": "1843080"
  },
  {
    "text": "then one of the other things that's come immediately is support for more complex replication topologies other things that",
    "start": "1843080",
    "end": "1851360"
  },
  {
    "start": "1849000",
    "end": "1904000"
  },
  {
    "text": "have come out some other much more hypothetical things that will come out partly from being here at the conference obviously is do integration in order to",
    "start": "1851360",
    "end": "1858740"
  },
  {
    "text": "route traffic have more sophisticated routing of traffic to the post cruise nodes the there actually gives a command",
    "start": "1858740",
    "end": "1867590"
  },
  {
    "text": "line tool for Patroni that's used for a few things and right now it's completely separate from the operator and maybe it",
    "start": "1867590",
    "end": "1873500"
  },
  {
    "text": "shouldn't be we're discussing that also I was interested in Brendan's meta",
    "start": "1873500",
    "end": "1879020"
  },
  {
    "text": "particle locks er D so we're gonna look at that and potentially having something that's defined block operator rather",
    "start": "1879020",
    "end": "1885350"
  },
  {
    "text": "than overloading in to perform that function for us support",
    "start": "1885350",
    "end": "1890399"
  },
  {
    "text": "for logical the new logical replication is obviously big to serve hypothetical thing and whether or not we could",
    "start": "1890399",
    "end": "1896899"
  },
  {
    "text": "customize the workloads API and maybe be less reliant on operator custom",
    "start": "1896899",
    "end": "1902909"
  },
  {
    "text": "controller behavior now there are a few things that we run into in kubernetes",
    "start": "1902909",
    "end": "1909690"
  },
  {
    "start": "1904000",
    "end": "1964000"
  },
  {
    "text": "that are still limitations that make life hard for us there really aren't very many I mean in mind you I've been working with the team that does stateful",
    "start": "1909690",
    "end": "1916139"
  },
  {
    "text": "sat for quite a while and so there really aren't very many because a lot of the things that I had in my issue list",
    "start": "1916139",
    "end": "1921419"
  },
  {
    "text": "got done but multi datacenter multi availability zone cluster is hard to do",
    "start": "1921419",
    "end": "1927600"
  },
  {
    "text": "with stateful sets right now I should you know COO Bernays have it built in",
    "start": "1927600",
    "end": "1932820"
  },
  {
    "text": "leader election things has been discussed before I'll discuss again upgrading stateful sets pretty much",
    "start": "1932820",
    "end": "1939899"
  },
  {
    "text": "requires you do to an operator right now because the stateful set has no intelligence about what order it should",
    "start": "1939899",
    "end": "1945419"
  },
  {
    "text": "upgrade things in and it could so again up for discussion and then it would be",
    "start": "1945419",
    "end": "1952889"
  },
  {
    "text": "really nice to be able to extending of coop control so that we could stop",
    "start": "1952889",
    "end": "1957929"
  },
  {
    "text": "having all of these separate Co eyes one per operator that's completely separate from Google control so but if you're",
    "start": "1957929",
    "end": "1966090"
  },
  {
    "text": "interested in this is something going to use we really would be happy to have more contributors open project the",
    "start": "1966090",
    "end": "1973700"
  },
  {
    "text": "Patroni I admit that we do most of our communication via github issues is not a",
    "start": "1973700",
    "end": "1979440"
  },
  {
    "text": "mailing list or anything so if you have a question or something like that file an issue or find one of us on the",
    "start": "1979440",
    "end": "1986159"
  },
  {
    "text": "Postgres IRC and let's make posters boring I'll take questions in just a second research links and now questions",
    "start": "1986159",
    "end": "1994799"
  },
  {
    "start": "1987000",
    "end": "2168000"
  },
  {
    "text": "go ahead do to do okay whatever passes",
    "start": "1994799",
    "end": "2002059"
  },
  {
    "text": "run so the question was what's it written in the bulk of so Patroni is in",
    "start": "2002059",
    "end": "2007460"
  },
  {
    "text": "Python and the operators in go because operators don't go the more questions",
    "start": "2007460",
    "end": "2016840"
  },
  {
    "text": "Rich's own yeah okay so question was the",
    "start": "2016840",
    "end": "2027399"
  },
  {
    "text": "replication is with replication lag yeah the default is a synchronous replication",
    "start": "2027399",
    "end": "2034350"
  },
  {
    "text": "which means indeed there is replication lag and if you have an unexpected master failure then you will lose some",
    "start": "2034350",
    "end": "2041769"
  },
  {
    "text": "transactions if they're in flight however petronia is completely compatible with you turning synchronous",
    "start": "2041769",
    "end": "2047980"
  },
  {
    "text": "replication on there's examples in the documentation of what that would look like and so if you want to run it with",
    "start": "2047980",
    "end": "2055450"
  },
  {
    "text": "synchronous replication then you can turn that on and particularly if you're going to do that I'd recommend using",
    "start": "2055450",
    "end": "2061658"
  },
  {
    "text": "post was 10 and running it with synchronous quorum replication so that you don't get replicas failure blocking",
    "start": "2061659",
    "end": "2067780"
  },
  {
    "text": "your your write transactions so there's another question up here",
    "start": "2067780",
    "end": "2073169"
  },
  {
    "text": "okay so Reyes question was will you miss most was user management and Korean users via config maps the operator if",
    "start": "2080619",
    "end": "2089329"
  },
  {
    "text": "you modified the manifest as a section of the manifests devoted to users and if you operate the man if you modify the",
    "start": "2089329",
    "end": "2094878"
  },
  {
    "text": "manifest it should create the users if you're using the operator if you're",
    "start": "2094879",
    "end": "2101029"
  },
  {
    "text": "using Patroni without the operator then you can either create the users when you",
    "start": "2101029",
    "end": "2108019"
  },
  {
    "text": "create the cluster because that goes into Patroni config or if you want to create a user later on obviously login a",
    "start": "2108019",
    "end": "2114230"
  },
  {
    "text": "super user and create the other user but you know which would happen at deployment time but if you're trying to",
    "start": "2114230",
    "end": "2120140"
  },
  {
    "text": "do it in a sort of get repo managed way then the operator is the way to go let",
    "start": "2120140",
    "end": "2127160"
  },
  {
    "text": "me just see if there was someone else that are quite some yeah what about storage how do you specify storage well",
    "start": "2127160",
    "end": "2135440"
  },
  {
    "text": "the same way honestly that you'd specify it in well for Patroni in general you're specifying storage just through the",
    "start": "2135440",
    "end": "2141470"
  },
  {
    "text": "kubernetes api right right the there's a",
    "start": "2141470",
    "end": "2151369"
  },
  {
    "text": "section in the operator example where you tell it the storage selector and and",
    "start": "2151369",
    "end": "2157400"
  },
  {
    "text": "that's the limit of the discrimination it has yeah yeah okay we're over time so",
    "start": "2157400",
    "end": "2165380"
  },
  {
    "text": "further questions will have to be taken out in the hallway thank you very much",
    "start": "2165380",
    "end": "2170619"
  }
]