[
  {
    "text": "so i' would like to welcome Brian from",
    "start": "440",
    "end": "2480"
  },
  {
    "text": "graan Labs who want to talk us about how",
    "start": "2480",
    "end": "5319"
  },
  {
    "text": "Prometheus help its memory usage give a",
    "start": "5319",
    "end": "8320"
  },
  {
    "text": "welcome Applause to to",
    "start": "8320",
    "end": "12040"
  },
  {
    "text": "Brian well",
    "start": "17000",
    "end": "18960"
  },
  {
    "text": "hello um so a little bit similar to uh r",
    "start": "18960",
    "end": "24359"
  },
  {
    "text": "one earlier I asked the I asked the AI",
    "start": "24359",
    "end": "27400"
  },
  {
    "text": "to illustrate my talk uh uh I I pasted",
    "start": "27400",
    "end": "31320"
  },
  {
    "text": "the title of the talk",
    "start": "31320",
    "end": "33600"
  },
  {
    "text": "into uh the AI and this is what it came",
    "start": "33600",
    "end": "36399"
  },
  {
    "text": "up with and I have no",
    "start": "36399",
    "end": "38600"
  },
  {
    "text": "idea what this has got to do with",
    "start": "38600",
    "end": "41800"
  },
  {
    "text": "Prometheus or memory but it's nice",
    "start": "41800",
    "end": "45480"
  },
  {
    "text": "picture",
    "start": "45480",
    "end": "47199"
  },
  {
    "text": "um okay so this is roughly the",
    "start": "47199",
    "end": "51239"
  },
  {
    "text": "agenda uh who who who runs",
    "start": "51239",
    "end": "54520"
  },
  {
    "text": "Prometheus oh like quite a lot of people",
    "start": "54520",
    "end": "57920"
  },
  {
    "text": "okay who's who's got a big Prometheus",
    "start": "57920",
    "end": "60160"
  },
  {
    "text": "like 10",
    "start": "60160",
    "end": "61960"
  },
  {
    "text": "GB yeah you got it you got the joke yeah",
    "start": "61960",
    "end": "65280"
  },
  {
    "text": "okay 100",
    "start": "65280",
    "end": "67320"
  },
  {
    "text": "GB",
    "start": "67320",
    "end": "69000"
  },
  {
    "text": "200 still going okay who's I don't know",
    "start": "69000",
    "end": "71759"
  },
  {
    "text": "we could have a contest who's got the",
    "start": "71759",
    "end": "73040"
  },
  {
    "text": "biggest Prometheus well um so the the",
    "start": "73040",
    "end": "78080"
  },
  {
    "text": "talk uh is about making it smaller um",
    "start": "78080",
    "end": "82600"
  },
  {
    "text": "and who's who's kind of new to this who",
    "start": "82600",
    "end": "84920"
  },
  {
    "text": "who has no idea what Prometheus is yes I",
    "start": "84920",
    "end": "87680"
  },
  {
    "text": "thought there might be a couple okay not",
    "start": "87680",
    "end": "89200"
  },
  {
    "text": "very many but uh so I drew you a",
    "start": "89200",
    "end": "92360"
  },
  {
    "text": "picture",
    "start": "92360",
    "end": "94200"
  },
  {
    "text": "um so this is the basic idea it's",
    "start": "94200",
    "end": "96880"
  },
  {
    "text": "Prometheus is",
    "start": "96880",
    "end": "98119"
  },
  {
    "text": "selfcontained it takes metric time",
    "start": "98119",
    "end": "100759"
  },
  {
    "text": "series data in from a whole bunch of",
    "start": "100759",
    "end": "103399"
  },
  {
    "text": "things could be your machine your",
    "start": "103399",
    "end": "105159"
  },
  {
    "text": "program your",
    "start": "105159",
    "end": "107040"
  },
  {
    "text": "database",
    "start": "107040",
    "end": "108759"
  },
  {
    "text": "um it'll store them on disk uh but it",
    "start": "108759",
    "end": "112360"
  },
  {
    "text": "doesn't it doesn't rely on another",
    "start": "112360",
    "end": "114439"
  },
  {
    "text": "database or another key value store or",
    "start": "114439",
    "end": "117479"
  },
  {
    "text": "whatever it's s contained um",
    "start": "117479",
    "end": "120680"
  },
  {
    "text": "and then it can it can connect up to",
    "start": "120680",
    "end": "122840"
  },
  {
    "text": "things that are going to display the",
    "start": "122840",
    "end": "124240"
  },
  {
    "text": "data draw some kind of wiggly line which",
    "start": "124240",
    "end": "126840"
  },
  {
    "text": "we like to look",
    "start": "126840",
    "end": "128319"
  },
  {
    "text": "at",
    "start": "128319",
    "end": "129920"
  },
  {
    "text": "um oh yeah who am I uh so my name I was",
    "start": "129920",
    "end": "134920"
  },
  {
    "text": "on the slide earlier my name is Brian",
    "start": "134920",
    "end": "136400"
  },
  {
    "text": "borm I work for grafana labs um so I",
    "start": "136400",
    "end": "141920"
  },
  {
    "text": "guess most people know about grafana the",
    "start": "141920",
    "end": "143440"
  },
  {
    "text": "dashboard you know which draws the",
    "start": "143440",
    "end": "145519"
  },
  {
    "text": "wiggly lines but we also have a bunch of",
    "start": "145519",
    "end": "148319"
  },
  {
    "text": "people working on storing",
    "start": "148319",
    "end": "150519"
  },
  {
    "text": "data uh and I I work on that I work on",
    "start": "150519",
    "end": "153319"
  },
  {
    "text": "storage of metrics logs traces",
    "start": "153319",
    "end": "156599"
  },
  {
    "text": "profiles",
    "start": "156599",
    "end": "158360"
  },
  {
    "text": "um and a lot of that is uh",
    "start": "158360",
    "end": "162200"
  },
  {
    "text": "using um Prometheus code uh so I am a",
    "start": "162200",
    "end": "166959"
  },
  {
    "text": "Prometheus maintainer I am the ninth",
    "start": "166959",
    "end": "170120"
  },
  {
    "text": "biggest contributor to Prometheus",
    "start": "170120",
    "end": "172440"
  },
  {
    "text": "apparently so um mostly mostly in the",
    "start": "172440",
    "end": "175400"
  },
  {
    "text": "last couple of years uh but I have been",
    "start": "175400",
    "end": "177360"
  },
  {
    "text": "working on this stuff for about six",
    "start": "177360",
    "end": "178760"
  },
  {
    "text": "years",
    "start": "178760",
    "end": "180319"
  },
  {
    "text": "um I have been optimizing programs for",
    "start": "180319",
    "end": "183879"
  },
  {
    "text": "like 40 years so I do this a",
    "start": "183879",
    "end": "187840"
  },
  {
    "text": "lot uh so let's get into it okay oh by",
    "start": "187840",
    "end": "193159"
  },
  {
    "text": "the way this is most this is an",
    "start": "193159",
    "end": "194680"
  },
  {
    "text": "observability day talk right so I'm not",
    "start": "194680",
    "end": "196720"
  },
  {
    "text": "going to talk about the code I this kind",
    "start": "196720",
    "end": "199360"
  },
  {
    "text": "of occurred to me halfway through",
    "start": "199360",
    "end": "201200"
  },
  {
    "text": "preparing this talk that I should do",
    "start": "201200",
    "end": "202799"
  },
  {
    "text": "another talk at like gopher con or",
    "start": "202799",
    "end": "204879"
  },
  {
    "text": "something where I where I talk about the",
    "start": "204879",
    "end": "207080"
  },
  {
    "text": "code but this is this is not about the",
    "start": "207080",
    "end": "209000"
  },
  {
    "text": "code this is about well so we're going",
    "start": "209000",
    "end": "210319"
  },
  {
    "text": "to start with like how do you observe",
    "start": "210319",
    "end": "213560"
  },
  {
    "text": "memory",
    "start": "213560",
    "end": "215080"
  },
  {
    "text": "usage um well metrics is one way uh so",
    "start": "215080",
    "end": "220400"
  },
  {
    "text": "which which memory metric should we use",
    "start": "220400",
    "end": "222360"
  },
  {
    "text": "I I went and looked up uh so these are",
    "start": "222360",
    "end": "225200"
  },
  {
    "text": "all the ones you can get out of um C",
    "start": "225200",
    "end": "227840"
  },
  {
    "text": "advisor if you're using containers or",
    "start": "227840",
    "end": "230799"
  },
  {
    "text": "these come out of cuet if if you're",
    "start": "230799",
    "end": "232439"
  },
  {
    "text": "running",
    "start": "232439",
    "end": "233360"
  },
  {
    "text": "kubernetes uh there's a few more you can",
    "start": "233360",
    "end": "235599"
  },
  {
    "text": "get out of Prometheus client library",
    "start": "235599",
    "end": "238599"
  },
  {
    "text": "from the operating system Prometheus is",
    "start": "238599",
    "end": "240599"
  },
  {
    "text": "written in",
    "start": "240599",
    "end": "241680"
  },
  {
    "text": "go uh there's some more you can get from",
    "start": "241680",
    "end": "244760"
  },
  {
    "text": "go and and you know I could have gone on",
    "start": "244760",
    "end": "246720"
  },
  {
    "text": "for a couple more",
    "start": "246720",
    "end": "248040"
  },
  {
    "text": "pages um so who's who knows the right",
    "start": "248040",
    "end": "252959"
  },
  {
    "text": "answer always there's one person who",
    "start": "253159",
    "end": "255280"
  },
  {
    "text": "gets all my",
    "start": "255280",
    "end": "257799"
  },
  {
    "text": "jokes we should",
    "start": "258040",
    "end": "259959"
  },
  {
    "text": "meet uh you want to tell me the right",
    "start": "259959",
    "end": "263080"
  },
  {
    "text": "answer RSS RSS okay there's a vote okay",
    "start": "263080",
    "end": "268600"
  },
  {
    "text": "um oh I I put this up to indicate that",
    "start": "268600",
    "end": "272280"
  },
  {
    "text": "it's something to think about uh so I",
    "start": "272280",
    "end": "274680"
  },
  {
    "text": "put them all on on one uh dashboard just",
    "start": "274680",
    "end": "278280"
  },
  {
    "text": "in case maybe that's the right answer",
    "start": "278280",
    "end": "280080"
  },
  {
    "text": "like look at all of them um it's a",
    "start": "280080",
    "end": "282600"
  },
  {
    "text": "little hard to figure out what's going",
    "start": "282600",
    "end": "285000"
  },
  {
    "text": "on",
    "start": "285000",
    "end": "286720"
  },
  {
    "text": "uh so you can Google this you you know",
    "start": "286720",
    "end": "289240"
  },
  {
    "text": "you can get people's opinion on the",
    "start": "289240",
    "end": "291400"
  },
  {
    "text": "internet and um so we had a vote for RSS",
    "start": "291400",
    "end": "295520"
  },
  {
    "text": "I I actually decided to focus on uh",
    "start": "295520",
    "end": "298560"
  },
  {
    "text": "working set",
    "start": "298560",
    "end": "300639"
  },
  {
    "text": "uh which is nearly the same thing",
    "start": "300639",
    "end": "304720"
  },
  {
    "text": "um so there's a metric called container",
    "start": "304720",
    "end": "307240"
  },
  {
    "text": "memory working set bytes so you can look",
    "start": "307240",
    "end": "309479"
  },
  {
    "text": "at that people will uh recommend",
    "start": "309479",
    "end": "313880"
  },
  {
    "text": "that and I also want to want to stress",
    "start": "313880",
    "end": "316960"
  },
  {
    "text": "like why why do we care about memory",
    "start": "316960",
    "end": "322199"
  },
  {
    "text": "usage so one one answer is you got to",
    "start": "322199",
    "end": "324720"
  },
  {
    "text": "pay for it right you got to got to pay",
    "start": "324720",
    "end": "327039"
  },
  {
    "text": "for more memory if you're using more",
    "start": "327039",
    "end": "328560"
  },
  {
    "text": "memory um but probably the most vital",
    "start": "328560",
    "end": "332360"
  },
  {
    "text": "reason is if you run out it goes",
    "start": "332360",
    "end": "334560"
  },
  {
    "text": "bang right it goes o you're out of",
    "start": "334560",
    "end": "337800"
  },
  {
    "text": "memory error your program crashes so um",
    "start": "337800",
    "end": "343520"
  },
  {
    "text": "so we can look at the the peak on this",
    "start": "343520",
    "end": "346120"
  },
  {
    "text": "particular time period was 17.7",
    "start": "346120",
    "end": "348759"
  },
  {
    "text": "GB so this is me running",
    "start": "348759",
    "end": "352479"
  },
  {
    "text": "Prometheus uh",
    "start": "352479",
    "end": "355600"
  },
  {
    "text": "2.27 from two years ago I decided arbit",
    "start": "355600",
    "end": "359600"
  },
  {
    "text": "arily I would take that as my starting",
    "start": "359600",
    "end": "361520"
  },
  {
    "text": "point for the halfing in memory go back",
    "start": "361520",
    "end": "365360"
  },
  {
    "text": "two",
    "start": "365360",
    "end": "366199"
  },
  {
    "text": "years um it's it's running in a Dev",
    "start": "366199",
    "end": "369840"
  },
  {
    "text": "environment it's scraping about 600",
    "start": "369840",
    "end": "372000"
  },
  {
    "text": "targets running under kubernetes there's",
    "start": "372000",
    "end": "374560"
  },
  {
    "text": "about 2 million time",
    "start": "374560",
    "end": "377319"
  },
  {
    "text": "series and it peaked here at 17.7",
    "start": "377319",
    "end": "381560"
  },
  {
    "text": "GB",
    "start": "381560",
    "end": "383599"
  },
  {
    "text": "so um mostly you",
    "start": "383599",
    "end": "387440"
  },
  {
    "text": "will have a limit of memory you can set",
    "start": "387440",
    "end": "390840"
  },
  {
    "text": "it in",
    "start": "390840",
    "end": "391880"
  },
  {
    "text": "kubernetes if you change the limit it",
    "start": "391880",
    "end": "393840"
  },
  {
    "text": "restarts the process that's what that",
    "start": "393840",
    "end": "395880"
  },
  {
    "text": "kind of dip in the picture is um but the",
    "start": "395880",
    "end": "401280"
  },
  {
    "text": "little bit interesting I I I it was",
    "start": "401280",
    "end": "403319"
  },
  {
    "text": "peing above 17 gbt I put the limit to 17",
    "start": "403319",
    "end": "406919"
  },
  {
    "text": "gigabytes and it just it just runs",
    "start": "406919",
    "end": "409880"
  },
  {
    "text": "smaller so that's kind of",
    "start": "409880",
    "end": "413160"
  },
  {
    "text": "weird",
    "start": "413160",
    "end": "414800"
  },
  {
    "text": "um well let's bring some more data into",
    "start": "414800",
    "end": "417879"
  },
  {
    "text": "this picture",
    "start": "417879",
    "end": "420400"
  },
  {
    "text": "uh Prometheus is written in go and we",
    "start": "420400",
    "end": "422680"
  },
  {
    "text": "can ask to see the go Heap",
    "start": "422680",
    "end": "426800"
  },
  {
    "text": "memory with this metric go M stats Heap",
    "start": "426800",
    "end": "429479"
  },
  {
    "text": "in use bites um and this is uh this is",
    "start": "429479",
    "end": "435479"
  },
  {
    "text": "by far the biggest component of memory",
    "start": "435479",
    "end": "438240"
  },
  {
    "text": "usage in Prometheus the G",
    "start": "438240",
    "end": "440440"
  },
  {
    "text": "Heap um it's kind of waving up and down",
    "start": "440440",
    "end": "444120"
  },
  {
    "text": "a lot on that picture right it's it's so",
    "start": "444120",
    "end": "447680"
  },
  {
    "text": "so I drew another one",
    "start": "447680",
    "end": "450240"
  },
  {
    "text": "uh simplified view so this is kind of",
    "start": "450240",
    "end": "453360"
  },
  {
    "text": "what's going on inside the um the memory",
    "start": "453360",
    "end": "456960"
  },
  {
    "text": "sort of builds up uh and then the",
    "start": "456960",
    "end": "459240"
  },
  {
    "text": "garbage collector runs and it comes down",
    "start": "459240",
    "end": "461199"
  },
  {
    "text": "again and then it builds up so you got",
    "start": "461199",
    "end": "463360"
  },
  {
    "text": "this kind of Sawtooth pattern",
    "start": "463360",
    "end": "466400"
  },
  {
    "text": "right and this um this is happening",
    "start": "466400",
    "end": "469639"
  },
  {
    "text": "quite fast I mean in this particular",
    "start": "469639",
    "end": "471360"
  },
  {
    "text": "Prometheus it's like every 10 seconds or",
    "start": "471360",
    "end": "473159"
  },
  {
    "text": "something like that so it's this is why",
    "start": "473159",
    "end": "476360"
  },
  {
    "text": "on on this picture it's kind of waggling",
    "start": "476360",
    "end": "478599"
  },
  {
    "text": "around rapidly because it's actually",
    "start": "478599",
    "end": "479960"
  },
  {
    "text": "faster than we're sampling the data so",
    "start": "479960",
    "end": "483039"
  },
  {
    "text": "it's it's kind of random somebody should",
    "start": "483039",
    "end": "485440"
  },
  {
    "text": "look up Nyquist or something like that",
    "start": "485440",
    "end": "487159"
  },
  {
    "text": "so we could learn things um anyway so I",
    "start": "487159",
    "end": "492599"
  },
  {
    "text": "what I like to do uh is bring in this",
    "start": "492599",
    "end": "495319"
  },
  {
    "text": "different metric which is is next GC",
    "start": "495319",
    "end": "497720"
  },
  {
    "text": "bytes so this is essentially the top of",
    "start": "497720",
    "end": "500960"
  },
  {
    "text": "the Sawtooth the the crests of the",
    "start": "500960",
    "end": "503800"
  },
  {
    "text": "Waves um so this",
    "start": "503800",
    "end": "507039"
  },
  {
    "text": "darker color here",
    "start": "507039",
    "end": "511159"
  },
  {
    "text": "um is the uh is the the peak of the Heap",
    "start": "511159",
    "end": "516360"
  },
  {
    "text": "usage if you like so this is getting a",
    "start": "516360",
    "end": "519518"
  },
  {
    "text": "bit closer there's still there's still a",
    "start": "519519",
    "end": "522000"
  },
  {
    "text": "gap though but but I I mean you take it",
    "start": "522000",
    "end": "525360"
  },
  {
    "text": "for me if this one hits the limit it'll",
    "start": "525360",
    "end": "527600"
  },
  {
    "text": "go",
    "start": "527600",
    "end": "528600"
  },
  {
    "text": "bang um so that one that little tip for",
    "start": "528600",
    "end": "531640"
  },
  {
    "text": "me if you're looking at a go program",
    "start": "531640",
    "end": "533160"
  },
  {
    "text": "this this number is kind of more",
    "start": "533160",
    "end": "536760"
  },
  {
    "text": "dependable uh let's try and understand",
    "start": "536760",
    "end": "539680"
  },
  {
    "text": "what is in that",
    "start": "539680",
    "end": "541160"
  },
  {
    "text": "Gap um so this it's it's really hard to",
    "start": "541160",
    "end": "545399"
  },
  {
    "text": "get into all the detail but basically",
    "start": "545399",
    "end": "547839"
  },
  {
    "text": "it's it's the kernel cache memory that's",
    "start": "547839",
    "end": "550360"
  },
  {
    "text": "in the",
    "start": "550360",
    "end": "551320"
  },
  {
    "text": "Gap uh and I I I kind of appeal to you",
    "start": "551320",
    "end": "555320"
  },
  {
    "text": "to believe me because it never never",
    "start": "555320",
    "end": "557160"
  },
  {
    "text": "goes above the limit when we add those",
    "start": "557160",
    "end": "559640"
  },
  {
    "text": "two up um so the it's IO right",
    "start": "559640",
    "end": "564360"
  },
  {
    "text": "Prometheus is writing to disk everything",
    "start": "564360",
    "end": "566360"
  },
  {
    "text": "that it writes to disk then sits in the",
    "start": "566360",
    "end": "568120"
  },
  {
    "text": "cache for a bit",
    "start": "568120",
    "end": "570000"
  },
  {
    "text": "everything it reads from dis sits in the",
    "start": "570000",
    "end": "571880"
  },
  {
    "text": "cache for a for a bit and that includes",
    "start": "571880",
    "end": "574440"
  },
  {
    "text": "the memory maap IO that that Prometheus",
    "start": "574440",
    "end": "577240"
  },
  {
    "text": "does a lot of um if you're looking at a",
    "start": "577240",
    "end": "581200"
  },
  {
    "text": "program that doesn't do a lot of dis iio",
    "start": "581200",
    "end": "583480"
  },
  {
    "text": "it it won't look like this right because",
    "start": "583480",
    "end": "585600"
  },
  {
    "text": "it just won't have there's no reason for",
    "start": "585600",
    "end": "587760"
  },
  {
    "text": "the memory to be in the cache if it's",
    "start": "587760",
    "end": "589240"
  },
  {
    "text": "not doing a lot of dis iio um but in the",
    "start": "589240",
    "end": "592560"
  },
  {
    "text": "case of promethus uh that's that's kind",
    "start": "592560",
    "end": "595519"
  },
  {
    "text": "of the bulk of the difference between",
    "start": "595519",
    "end": "597200"
  },
  {
    "text": "the working set and the the uh the heat",
    "start": "597200",
    "end": "600079"
  },
  {
    "text": "memory is in Cache and because it's in",
    "start": "600079",
    "end": "603160"
  },
  {
    "text": "Cache you know we don't really need it",
    "start": "603160",
    "end": "604600"
  },
  {
    "text": "it can go back to the disc and get it as",
    "start": "604600",
    "end": "607360"
  },
  {
    "text": "as you get closer and closer um the",
    "start": "607360",
    "end": "611480"
  },
  {
    "text": "limit comes down closer to what's really",
    "start": "611480",
    "end": "613360"
  },
  {
    "text": "needed the program will slow down a bit",
    "start": "613360",
    "end": "615240"
  },
  {
    "text": "but it won't it won't crash until they",
    "start": "615240",
    "end": "617360"
  },
  {
    "text": "they kind of",
    "start": "617360",
    "end": "619839"
  },
  {
    "text": "touch uh okay so this is my this is my",
    "start": "619880",
    "end": "622920"
  },
  {
    "text": "kind of biggest",
    "start": "622920",
    "end": "624640"
  },
  {
    "text": "takeaway uh sorry it was a trick",
    "start": "624640",
    "end": "628040"
  },
  {
    "text": "question",
    "start": "628040",
    "end": "630360"
  },
  {
    "text": "um there is no single metric for",
    "start": "630360",
    "end": "633959"
  },
  {
    "text": "memory",
    "start": "633959",
    "end": "635720"
  },
  {
    "text": "um I I interact with a lot of people on",
    "start": "635720",
    "end": "638800"
  },
  {
    "text": "slack or whatever and they say oh my",
    "start": "638800",
    "end": "640519"
  },
  {
    "text": "memory is this and I always say well",
    "start": "640519",
    "end": "642040"
  },
  {
    "text": "which metric are you looking at and then",
    "start": "642040",
    "end": "643959"
  },
  {
    "text": "the next thing I usually say is well you",
    "start": "643959",
    "end": "645360"
  },
  {
    "text": "should look at these three other ones um",
    "start": "645360",
    "end": "647880"
  },
  {
    "text": "because there's there one metric will",
    "start": "647880",
    "end": "650440"
  },
  {
    "text": "never tell you the complete picture so I",
    "start": "650440",
    "end": "652399"
  },
  {
    "text": "really want to stress that for",
    "start": "652399",
    "end": "654680"
  },
  {
    "text": "observability",
    "start": "654680",
    "end": "657399"
  },
  {
    "text": "d uh oh yeah so I reduced the limit so",
    "start": "657399",
    "end": "660760"
  },
  {
    "text": "it was at 17 GB I took it down to 16 G",
    "start": "660760",
    "end": "663920"
  },
  {
    "text": "GB and it went bang it didn't go bang",
    "start": "663920",
    "end": "667399"
  },
  {
    "text": "straight",
    "start": "667399",
    "end": "668480"
  },
  {
    "text": "away um but it did go bang and uh so a",
    "start": "668480",
    "end": "674160"
  },
  {
    "text": "little bit more detail inside Prometheus",
    "start": "674160",
    "end": "676279"
  },
  {
    "text": "what's going on here",
    "start": "676279",
    "end": "679480"
  },
  {
    "text": "um it's building up this this data",
    "start": "679480",
    "end": "682240"
  },
  {
    "text": "structure we call the head",
    "start": "682240",
    "end": "683959"
  },
  {
    "text": "block uh which is the most recent data",
    "start": "683959",
    "end": "686560"
  },
  {
    "text": "and it's it's by default it's two hours",
    "start": "686560",
    "end": "689160"
  },
  {
    "text": "of data that it builds up in memory and",
    "start": "689160",
    "end": "692079"
  },
  {
    "text": "then it writes that to disk in a in a",
    "start": "692079",
    "end": "693800"
  },
  {
    "text": "process called",
    "start": "693800",
    "end": "695800"
  },
  {
    "text": "compaction and because we don't want to",
    "start": "695800",
    "end": "698200"
  },
  {
    "text": "lose two hours of data if it does crash",
    "start": "698200",
    "end": "701000"
  },
  {
    "text": "it also writes all the data to another",
    "start": "701000",
    "end": "703160"
  },
  {
    "text": "thing on disk which is called the write",
    "start": "703160",
    "end": "704360"
  },
  {
    "text": "ahead log so I go back to this picture",
    "start": "704360",
    "end": "708720"
  },
  {
    "text": "so what happens this",
    "start": "708720",
    "end": "710959"
  },
  {
    "text": "um probably it was doing a compaction",
    "start": "710959",
    "end": "713480"
  },
  {
    "text": "here because that uses a little bit",
    "start": "713480",
    "end": "714720"
  },
  {
    "text": "extra memory and that's when it went",
    "start": "714720",
    "end": "716519"
  },
  {
    "text": "bang uh so it goes down to zero it start",
    "start": "716519",
    "end": "719120"
  },
  {
    "text": "up again it reads all the data back in",
    "start": "719120",
    "end": "721079"
  },
  {
    "text": "from the",
    "start": "721079",
    "end": "723399"
  },
  {
    "text": "W um and it gets going again and uh",
    "start": "723480",
    "end": "727519"
  },
  {
    "text": "there's there's a real problem here that",
    "start": "727519",
    "end": "729440"
  },
  {
    "text": "that",
    "start": "729440",
    "end": "730480"
  },
  {
    "text": "um Prometheus only tidies up and makes",
    "start": "730480",
    "end": "735160"
  },
  {
    "text": "everything neat and tidy and truncates",
    "start": "735160",
    "end": "736800"
  },
  {
    "text": "the while after a",
    "start": "736800",
    "end": "738560"
  },
  {
    "text": "compaction so it crashed again and and",
    "start": "738560",
    "end": "742000"
  },
  {
    "text": "it started up again now the Wild's a bit",
    "start": "742000",
    "end": "743720"
  },
  {
    "text": "bigger because it' been running for",
    "start": "743720",
    "end": "745760"
  },
  {
    "text": "another 2 or 3 minutes so now it needs",
    "start": "745760",
    "end": "749320"
  },
  {
    "text": "more memory so it crashed again and",
    "start": "749320",
    "end": "751519"
  },
  {
    "text": "again and again and again this is a",
    "start": "751519",
    "end": "753320"
  },
  {
    "text": "pattern that some of you will be",
    "start": "753320",
    "end": "754440"
  },
  {
    "text": "familiar with I thought it would be nice",
    "start": "754440",
    "end": "755720"
  },
  {
    "text": "to explain it um if you get into this",
    "start": "755720",
    "end": "758480"
  },
  {
    "text": "state the main thing you can do is give",
    "start": "758480",
    "end": "761639"
  },
  {
    "text": "it a lot more memory so that it can can",
    "start": "761639",
    "end": "764680"
  },
  {
    "text": "get out of this state and",
    "start": "764680",
    "end": "767399"
  },
  {
    "text": "recover but I kind of promised in the",
    "start": "767399",
    "end": "771000"
  },
  {
    "text": "title of this talk that the memory usage",
    "start": "771000",
    "end": "773240"
  },
  {
    "text": "had",
    "start": "773240",
    "end": "774360"
  },
  {
    "text": "half um and this is running 2.29 from",
    "start": "774360",
    "end": "777880"
  },
  {
    "text": "two years ago",
    "start": "777880",
    "end": "779680"
  },
  {
    "text": "so uh I showed you that um oh we'll come",
    "start": "779680",
    "end": "784279"
  },
  {
    "text": "back to that okay I I I want to talk",
    "start": "784279",
    "end": "786079"
  },
  {
    "text": "about profiles",
    "start": "786079",
    "end": "787480"
  },
  {
    "text": "first yeah how do how did I make it",
    "start": "787480",
    "end": "789720"
  },
  {
    "text": "smaller how did how do we know where all",
    "start": "789720",
    "end": "792680"
  },
  {
    "text": "the memory is",
    "start": "792680",
    "end": "794360"
  },
  {
    "text": "going well a profile is a good tool for",
    "start": "794360",
    "end": "797839"
  },
  {
    "text": "that uh I I skip exactly how you get",
    "start": "797839",
    "end": "802560"
  },
  {
    "text": "hold of a profile go has in its runtime",
    "start": "802560",
    "end": "805720"
  },
  {
    "text": "a built-in profiler and you can ask it",
    "start": "805720",
    "end": "808880"
  },
  {
    "text": "uh for all the memory and all the CPU",
    "start": "808880",
    "end": "811600"
  },
  {
    "text": "usage as well but we're focused on",
    "start": "811600",
    "end": "813040"
  },
  {
    "text": "memory here and you can visualize it in",
    "start": "813040",
    "end": "816240"
  },
  {
    "text": "this what's called a flame graph view",
    "start": "816240",
    "end": "818959"
  },
  {
    "text": "the width of the blocks is the",
    "start": "818959",
    "end": "821880"
  },
  {
    "text": "proportion of how much memory is being",
    "start": "821880",
    "end": "824639"
  },
  {
    "text": "used um so the the What's called the",
    "start": "824639",
    "end": "827639"
  },
  {
    "text": "root the at the top of everything that's",
    "start": "827639",
    "end": "830880"
  },
  {
    "text": "100% And it's um 6.7 gabt this is",
    "start": "830880",
    "end": "835639"
  },
  {
    "text": "basically the bottom of that",
    "start": "835639",
    "end": "837759"
  },
  {
    "text": "Sawtooth uh the go memory profiler",
    "start": "837759",
    "end": "840759"
  },
  {
    "text": "reports the memory usage as at the last",
    "start": "840759",
    "end": "843360"
  },
  {
    "text": "garbage",
    "start": "843360",
    "end": "844399"
  },
  {
    "text": "collection so you never see garbage on",
    "start": "844399",
    "end": "846920"
  },
  {
    "text": "this picture a lot of people think that",
    "start": "846920",
    "end": "848440"
  },
  {
    "text": "this oh it's probably mostly garbage I",
    "start": "848440",
    "end": "850160"
  },
  {
    "text": "don't need to think about it this is",
    "start": "850160",
    "end": "852079"
  },
  {
    "text": "never garbage when you look at a profile",
    "start": "852079",
    "end": "853880"
  },
  {
    "text": "from go this this is the bottom of the",
    "start": "853880",
    "end": "856199"
  },
  {
    "text": "Sawtooth this is what was could not be",
    "start": "856199",
    "end": "859240"
  },
  {
    "text": "discarded anyway um so the process of",
    "start": "859240",
    "end": "863079"
  },
  {
    "text": "making it smaller starts with saying",
    "start": "863079",
    "end": "865759"
  },
  {
    "text": "well what is making it so big and I uh",
    "start": "865759",
    "end": "869199"
  },
  {
    "text": "I added up these various bars so I'm",
    "start": "869199",
    "end": "872720"
  },
  {
    "text": "running some queries in my test system",
    "start": "872720",
    "end": "874800"
  },
  {
    "text": "that that turned out to be about",
    "start": "874800",
    "end": "877360"
  },
  {
    "text": "9%",
    "start": "877360",
    "end": "879040"
  },
  {
    "text": "the uh metadata if you like for the",
    "start": "879040",
    "end": "881720"
  },
  {
    "text": "series uh",
    "start": "881720",
    "end": "884279"
  },
  {
    "text": "14% the samples themselves you'd think",
    "start": "884279",
    "end": "886800"
  },
  {
    "text": "that would be the biggest thing but",
    "start": "886800",
    "end": "888639"
  },
  {
    "text": "they're very very highly compressed in",
    "start": "888639",
    "end": "892040"
  },
  {
    "text": "memory um the metadata to do with scrap",
    "start": "892040",
    "end": "895680"
  },
  {
    "text": "and getting the metrics in that was",
    "start": "895680",
    "end": "897600"
  },
  {
    "text": "pretty big but the winner overall and",
    "start": "897600",
    "end": "901600"
  },
  {
    "text": "this is aat two years",
    "start": "901600",
    "end": "903360"
  },
  {
    "text": "ago pretty much a third of all the",
    "start": "903360",
    "end": "905680"
  },
  {
    "text": "memory inside promethus was taken up",
    "start": "905680",
    "end": "907360"
  },
  {
    "text": "with",
    "start": "907360",
    "end": "908480"
  },
  {
    "text": "labels so",
    "start": "908480",
    "end": "910800"
  },
  {
    "text": "strings what do I mean by labels well",
    "start": "910800",
    "end": "913279"
  },
  {
    "text": "every series in uh Prometheus is",
    "start": "913279",
    "end": "915600"
  },
  {
    "text": "uniquely identified by this name value",
    "start": "915600",
    "end": "918519"
  },
  {
    "text": "pair",
    "start": "918519",
    "end": "920600"
  },
  {
    "text": "set and if you have another series which",
    "start": "920600",
    "end": "923800"
  },
  {
    "text": "is kind of related and this you know",
    "start": "923800",
    "end": "925360"
  },
  {
    "text": "these the only difference there is",
    "start": "925360",
    "end": "926680"
  },
  {
    "text": "between the method um",
    "start": "926680",
    "end": "929480"
  },
  {
    "text": "you actually get a whole new set of",
    "start": "929480",
    "end": "931959"
  },
  {
    "text": "strings and on and on and on so you look",
    "start": "931959",
    "end": "936199"
  },
  {
    "text": "at this and you say well that's",
    "start": "936199",
    "end": "938440"
  },
  {
    "text": "dumb uh just have one copy of the",
    "start": "938440",
    "end": "940560"
  },
  {
    "text": "strings but it's not as simple as",
    "start": "940560",
    "end": "944160"
  },
  {
    "text": "that so this is um this is showing you",
    "start": "944399",
    "end": "949160"
  },
  {
    "text": "the kind of data structure",
    "start": "949160",
    "end": "951399"
  },
  {
    "text": "inside um and I don't want to get deeply",
    "start": "951399",
    "end": "954600"
  },
  {
    "text": "into the the go programming details you",
    "start": "954600",
    "end": "956759"
  },
  {
    "text": "can I put a link on there if you want to",
    "start": "956759",
    "end": "958440"
  },
  {
    "text": "go go look um but basically the the",
    "start": "958440",
    "end": "962120"
  },
  {
    "text": "thing called The Slice header that's",
    "start": "962120",
    "end": "963519"
  },
  {
    "text": "pointing to all the labels that's 24",
    "start": "963519",
    "end": "965399"
  },
  {
    "text": "bytes and every string has a string",
    "start": "965399",
    "end": "968000"
  },
  {
    "text": "header which is 16 bytes it's it's a",
    "start": "968000",
    "end": "970000"
  },
  {
    "text": "pointer to the contents and a",
    "start": "970000",
    "end": "972079"
  },
  {
    "text": "length um and if you add all them up it",
    "start": "972079",
    "end": "976600"
  },
  {
    "text": "it turns out that all of these pointers",
    "start": "976600",
    "end": "979399"
  },
  {
    "text": "in the data structure are way bigger",
    "start": "979399",
    "end": "981519"
  },
  {
    "text": "than the strings",
    "start": "981519",
    "end": "984360"
  },
  {
    "text": "themselves uh so I did",
    "start": "984920",
    "end": "989639"
  },
  {
    "text": "this uh so this is Prometheus PR",
    "start": "989639",
    "end": "993959"
  },
  {
    "text": "10991",
    "start": "993959",
    "end": "995959"
  },
  {
    "text": "um and I put all the strings in a single",
    "start": "995959",
    "end": "999839"
  },
  {
    "text": "string and I kind of encoded them with a",
    "start": "999839",
    "end": "1003720"
  },
  {
    "text": "with a length uh so you can sort of walk",
    "start": "1003720",
    "end": "1006440"
  },
  {
    "text": "down the string and find the one that",
    "start": "1006440",
    "end": "1007720"
  },
  {
    "text": "you're after and this is a little bit",
    "start": "1007720",
    "end": "1010319"
  },
  {
    "text": "exaggerated because the strings are",
    "start": "1010319",
    "end": "1011680"
  },
  {
    "text": "really small but but most of the strings",
    "start": "1011680",
    "end": "1013959"
  },
  {
    "text": "that people use in Prometheus are small",
    "start": "1013959",
    "end": "1016040"
  },
  {
    "text": "you know they're they're they're things",
    "start": "1016040",
    "end": "1017199"
  },
  {
    "text": "like namespace and cluster and job and",
    "start": "1017199",
    "end": "1019480"
  },
  {
    "text": "so there's a lot of small strings in",
    "start": "1019480",
    "end": "1021600"
  },
  {
    "text": "there anyway this um this shipped in",
    "start": "1021600",
    "end": "1027600"
  },
  {
    "text": "2.44 uh it took a",
    "start": "1027600",
    "end": "1030079"
  },
  {
    "text": "year 2 and a half thousand lines of code",
    "start": "1030079",
    "end": "1032880"
  },
  {
    "text": "changed because there was a huge amount",
    "start": "1032880",
    "end": "1035240"
  },
  {
    "text": "of code that that just assumed that it",
    "start": "1035240",
    "end": "1037240"
  },
  {
    "text": "knew what that data structure was",
    "start": "1037240",
    "end": "1039839"
  },
  {
    "text": "like",
    "start": "1039839",
    "end": "1041400"
  },
  {
    "text": "um there's lots of projects that use",
    "start": "1041400",
    "end": "1044038"
  },
  {
    "text": "this code uh which had knock on if they",
    "start": "1044039",
    "end": "1047558"
  },
  {
    "text": "needed basically thousand line changes",
    "start": "1047559",
    "end": "1050480"
  },
  {
    "text": "to um uh react to this but um and I also",
    "start": "1050480",
    "end": "1056000"
  },
  {
    "text": "I want to give credit to the Prometheus",
    "start": "1056000",
    "end": "1057840"
  },
  {
    "text": "team that that put up with this I I did",
    "start": "1057840",
    "end": "1059720"
  },
  {
    "text": "a lot of the typing uh but they were",
    "start": "1059720",
    "end": "1062520"
  },
  {
    "text": "reviewing these changes and helping with",
    "start": "1062520",
    "end": "1065039"
  },
  {
    "text": "uh uh testing and and all kinds of",
    "start": "1065039",
    "end": "1067720"
  },
  {
    "text": "things like that so um shout out to",
    "start": "1067720",
    "end": "1071200"
  },
  {
    "text": "them uh right so I didn't add any more",
    "start": "1071200",
    "end": "1076320"
  },
  {
    "text": "memory I um I started up uh so the",
    "start": "1076320",
    "end": "1079960"
  },
  {
    "text": "previous one that was crashing at",
    "start": "1079960",
    "end": "1082039"
  },
  {
    "text": "17",
    "start": "1082039",
    "end": "1083559"
  },
  {
    "text": "gabt um I ran",
    "start": "1083559",
    "end": "1088799"
  },
  {
    "text": "oh I I wrote this up in detail yes great",
    "start": "1109200",
    "end": "1112039"
  },
  {
    "text": "oh but maybe I can explain this because",
    "start": "1112039",
    "end": "1115520"
  },
  {
    "text": "um we added out of order handling of",
    "start": "1115520",
    "end": "1118640"
  },
  {
    "text": "samples we added native histograms that",
    "start": "1118640",
    "end": "1121120"
  },
  {
    "text": "that um Richie was very pleased about",
    "start": "1121120",
    "end": "1123880"
  },
  {
    "text": "earlier um maybe they used up all no",
    "start": "1123880",
    "end": "1127240"
  },
  {
    "text": "they didn't really use up all that",
    "start": "1127240",
    "end": "1129799"
  },
  {
    "text": "no okay so this is conference driven",
    "start": "1129799",
    "end": "1133120"
  },
  {
    "text": "development right this is uh I'm",
    "start": "1133120",
    "end": "1136559"
  },
  {
    "text": "preparing for this talk I said it was",
    "start": "1136559",
    "end": "1138440"
  },
  {
    "text": "half well maybe there's another thing I",
    "start": "1138440",
    "end": "1140600"
  },
  {
    "text": "can talk about um uh this was a bug that",
    "start": "1140600",
    "end": "1144159"
  },
  {
    "text": "was fixed in",
    "start": "1144159",
    "end": "1146720"
  },
  {
    "text": "2.39 uh where for really big Prometheus",
    "start": "1147400",
    "end": "1150480"
  },
  {
    "text": "it used to the the the transaction",
    "start": "1150480",
    "end": "1152480"
  },
  {
    "text": "isolation ring used to get enormous",
    "start": "1152480",
    "end": "1154679"
  },
  {
    "text": "under certain",
    "start": "1154679",
    "end": "1156240"
  },
  {
    "text": "conditions I did the math it's still not",
    "start": "1156240",
    "end": "1158600"
  },
  {
    "text": "half I",
    "start": "1158600",
    "end": "1160760"
  },
  {
    "text": "can't okay what are we going to do",
    "start": "1160760",
    "end": "1165120"
  },
  {
    "text": "um so I went back I did the thing that",
    "start": "1165120",
    "end": "1168760"
  },
  {
    "text": "everyone said I should have done in the",
    "start": "1168760",
    "end": "1170080"
  },
  {
    "text": "first place which is to have only one",
    "start": "1170080",
    "end": "1171760"
  },
  {
    "text": "copy of every",
    "start": "1171760",
    "end": "1173760"
  },
  {
    "text": "string",
    "start": "1173760",
    "end": "1175520"
  },
  {
    "text": "um so this was April I did a version of",
    "start": "1175520",
    "end": "1178880"
  },
  {
    "text": "that",
    "start": "1178880",
    "end": "1180840"
  },
  {
    "text": "um it is quite complicated uh for a",
    "start": "1180840",
    "end": "1184480"
  },
  {
    "text": "couple of reasons well first of all it's",
    "start": "1184480",
    "end": "1186320"
  },
  {
    "text": "a lot smaller right because the only the",
    "start": "1186320",
    "end": "1188280"
  },
  {
    "text": "only thing that we're storing is is",
    "start": "1188280",
    "end": "1190000"
  },
  {
    "text": "indexes into a",
    "start": "1190000",
    "end": "1191720"
  },
  {
    "text": "table uh so we have a thing that is",
    "start": "1191720",
    "end": "1193960"
  },
  {
    "text": "technically a string and go but it's",
    "start": "1193960",
    "end": "1195600"
  },
  {
    "text": "actually just a list of",
    "start": "1195600",
    "end": "1197240"
  },
  {
    "text": "numbers",
    "start": "1197240",
    "end": "1198799"
  },
  {
    "text": "um we we have a a table index by those",
    "start": "1198799",
    "end": "1202240"
  },
  {
    "text": "numbers and we need to point to that",
    "start": "1202240",
    "end": "1205320"
  },
  {
    "text": "and uh the thing that makes it really",
    "start": "1205320",
    "end": "1207559"
  },
  {
    "text": "complicated is we don't just want to",
    "start": "1207559",
    "end": "1209080"
  },
  {
    "text": "have one of those tables if if I just",
    "start": "1209080",
    "end": "1210799"
  },
  {
    "text": "have one table for the entire program",
    "start": "1210799",
    "end": "1213320"
  },
  {
    "text": "it's it it's a bottleneck basically the",
    "start": "1213320",
    "end": "1216240"
  },
  {
    "text": "entire program becomes single threaded",
    "start": "1216240",
    "end": "1218520"
  },
  {
    "text": "on this one table where all the strings",
    "start": "1218520",
    "end": "1221640"
  },
  {
    "text": "live so",
    "start": "1221640",
    "end": "1224480"
  },
  {
    "text": "uh it's it's a very intricate change",
    "start": "1224480",
    "end": "1227520"
  },
  {
    "text": "that we have multiple of these symbol",
    "start": "1227520",
    "end": "1230400"
  },
  {
    "text": "tables",
    "start": "1230400",
    "end": "1233400"
  },
  {
    "text": "um that took us down to 10 gigs so this",
    "start": "1233400",
    "end": "1236679"
  },
  {
    "text": "is like about a month ago uh because I",
    "start": "1236679",
    "end": "1239760"
  },
  {
    "text": "wrote that I submitted that PR in April",
    "start": "1239760",
    "end": "1243080"
  },
  {
    "text": "10",
    "start": "1243080",
    "end": "1244360"
  },
  {
    "text": "gigs still not",
    "start": "1244360",
    "end": "1247880"
  },
  {
    "text": "half okay so I've carried on I did I",
    "start": "1248039",
    "end": "1253240"
  },
  {
    "text": "looked I mean basically the process you",
    "start": "1253240",
    "end": "1254760"
  },
  {
    "text": "get the profile you pick the biggest",
    "start": "1254760",
    "end": "1256760"
  },
  {
    "text": "number you work work on that find some",
    "start": "1256760",
    "end": "1259280"
  },
  {
    "text": "inefficiency in it if you",
    "start": "1259280",
    "end": "1261320"
  },
  {
    "text": "can do it again and now what was the",
    "start": "1261320",
    "end": "1265039"
  },
  {
    "text": "second biggest number is now the biggest",
    "start": "1265039",
    "end": "1266520"
  },
  {
    "text": "number and you do that a few times and",
    "start": "1266520",
    "end": "1268520"
  },
  {
    "text": "numbers that were really not that big to",
    "start": "1268520",
    "end": "1270919"
  },
  {
    "text": "begin with are no big numbers so you",
    "start": "1270919",
    "end": "1273000"
  },
  {
    "text": "it's a nice uh",
    "start": "1273000",
    "end": "1275360"
  },
  {
    "text": "self-reinforcing uh",
    "start": "1275360",
    "end": "1277320"
  },
  {
    "text": "process anyway um running low on time",
    "start": "1277320",
    "end": "1280960"
  },
  {
    "text": "here uh this is uh 2. 47 plus all of",
    "start": "1280960",
    "end": "1287720"
  },
  {
    "text": "those PRS on the previous",
    "start": "1287720",
    "end": "1290480"
  },
  {
    "text": "page",
    "start": "1290480",
    "end": "1292320"
  },
  {
    "text": "um 8.6",
    "start": "1292320",
    "end": "1294679"
  },
  {
    "text": "GB are we at",
    "start": "1294679",
    "end": "1296919"
  },
  {
    "text": "half",
    "start": "1296919",
    "end": "1298720"
  },
  {
    "text": "nearly I don't know I think that's",
    "start": "1298720",
    "end": "1300559"
  },
  {
    "text": "pretty good",
    "start": "1300559",
    "end": "1303080"
  },
  {
    "text": "though okay tough",
    "start": "1303240",
    "end": "1307200"
  },
  {
    "text": "audience one more",
    "start": "1307919",
    "end": "1310440"
  },
  {
    "text": "thing there uh there is a parameter in",
    "start": "1310440",
    "end": "1314039"
  },
  {
    "text": "the go runtime called GOC and it",
    "start": "1314039",
    "end": "1316840"
  },
  {
    "text": "defaults to 100 and and basically the",
    "start": "1316840",
    "end": "1319679"
  },
  {
    "text": "size that it the heat the this Sawtooth",
    "start": "1319679",
    "end": "1322159"
  },
  {
    "text": "the size it grows to is 100% of the size",
    "start": "1322159",
    "end": "1325559"
  },
  {
    "text": "at the bottom of the the",
    "start": "1325559",
    "end": "1328320"
  },
  {
    "text": "Sawtooth um so in Prometheus that's you",
    "start": "1328320",
    "end": "1332799"
  },
  {
    "text": "know in my in my little test one here",
    "start": "1332799",
    "end": "1334919"
  },
  {
    "text": "that's that's 6 s gigabytes in",
    "start": "1334919",
    "end": "1338360"
  },
  {
    "text": "um uh in those of you who have 100",
    "start": "1338360",
    "end": "1341640"
  },
  {
    "text": "gigabyte Prometheus that it's it's kind",
    "start": "1341640",
    "end": "1343760"
  },
  {
    "text": "of growing by 50",
    "start": "1343760",
    "end": "1346080"
  },
  {
    "text": "gigs basically for house keeping",
    "start": "1346080",
    "end": "1348760"
  },
  {
    "text": "purposes um it doesn't really you don't",
    "start": "1348760",
    "end": "1351559"
  },
  {
    "text": "need 50 gigs of garbage to to run an",
    "start": "1351559",
    "end": "1354559"
  },
  {
    "text": "effective Heap um so you can tune that",
    "start": "1354559",
    "end": "1358640"
  },
  {
    "text": "number you can it's an environment",
    "start": "1358640",
    "end": "1360159"
  },
  {
    "text": "variable you can",
    "start": "1360159",
    "end": "1361799"
  },
  {
    "text": "set",
    "start": "1361799",
    "end": "1363679"
  },
  {
    "text": "um what it will grow to whatever",
    "start": "1363679",
    "end": "1367520"
  },
  {
    "text": "percentage you set it to over what it",
    "start": "1367520",
    "end": "1369679"
  },
  {
    "text": "what it went down to as the minimum um",
    "start": "1369679",
    "end": "1372480"
  },
  {
    "text": "and it will uh it will garbage collect a",
    "start": "1372480",
    "end": "1374679"
  },
  {
    "text": "bit faster so probably your CPU will go",
    "start": "1374679",
    "end": "1376960"
  },
  {
    "text": "up but like I say if it's if it's",
    "start": "1376960",
    "end": "1379240"
  },
  {
    "text": "enormous if if if it's garbage",
    "start": "1379240",
    "end": "1382000"
  },
  {
    "text": "collecting like really slowly because",
    "start": "1382000",
    "end": "1383640"
  },
  {
    "text": "it's got to grow to 50 gigs uh and I I",
    "start": "1383640",
    "end": "1386760"
  },
  {
    "text": "worked on that as well worked on",
    "start": "1386760",
    "end": "1388080"
  },
  {
    "text": "optimizing the amount of garbage being",
    "start": "1388080",
    "end": "1390320"
  },
  {
    "text": "created Um this can work out so anyway I",
    "start": "1390320",
    "end": "1393039"
  },
  {
    "text": "did that so this is the",
    "start": "1393039",
    "end": "1395640"
  },
  {
    "text": "Prometheus uh 2.47 plus the 8 PRS on the",
    "start": "1395640",
    "end": "1399000"
  },
  {
    "text": "previous page plus gogc equals 60 and",
    "start": "1399000",
    "end": "1401440"
  },
  {
    "text": "it's running with a memory limit of 8",
    "start": "1401440",
    "end": "1404159"
  },
  {
    "text": "gab and I'm",
    "start": "1404159",
    "end": "1406880"
  },
  {
    "text": "done",
    "start": "1406880",
    "end": "1408320"
  },
  {
    "text": "[Applause]",
    "start": "1408320",
    "end": "1418120"
  },
  {
    "text": "so yeah there's the takeaways um I",
    "start": "1418120",
    "end": "1421440"
  },
  {
    "text": "really love feedback uh if you go to the",
    "start": "1421440",
    "end": "1424840"
  },
  {
    "text": "page for the talk uh you can download",
    "start": "1424840",
    "end": "1427120"
  },
  {
    "text": "the slides and you can tell me what you",
    "start": "1427120",
    "end": "1428799"
  },
  {
    "text": "thought and I have some qu time for",
    "start": "1428799",
    "end": "1432480"
  },
  {
    "text": "questions thank you Brian if you have",
    "start": "1432480",
    "end": "1434600"
  },
  {
    "text": "any question please approach here the",
    "start": "1434600",
    "end": "1436880"
  },
  {
    "text": "microphone",
    "start": "1436880",
    "end": "1439880"
  },
  {
    "text": "I have the first",
    "start": "1444159",
    "end": "1446919"
  },
  {
    "text": "person yeah thanks great talk um I'm",
    "start": "1448720",
    "end": "1451640"
  },
  {
    "text": "just curious uh normally when you get",
    "start": "1451640",
    "end": "1453600"
  },
  {
    "text": "that much memory improvement you're",
    "start": "1453600",
    "end": "1454960"
  },
  {
    "text": "paying for it in some other way do you",
    "start": "1454960",
    "end": "1456720"
  },
  {
    "text": "have um like a summary of the CPU impact",
    "start": "1456720",
    "end": "1460200"
  },
  {
    "text": "uh from all these changes uh yeah well",
    "start": "1460200",
    "end": "1463559"
  },
  {
    "text": "that's okay so yeah the the engineering",
    "start": "1463559",
    "end": "1467200"
  },
  {
    "text": "is all about train offs were you over",
    "start": "1467200",
    "end": "1469480"
  },
  {
    "text": "there",
    "start": "1469480",
    "end": "1470919"
  },
  {
    "text": "um so it is it is quite likely that we",
    "start": "1470919",
    "end": "1474960"
  },
  {
    "text": "when we when we squeeze down on one",
    "start": "1474960",
    "end": "1476720"
  },
  {
    "text": "thing that something else goes up um",
    "start": "1476720",
    "end": "1480120"
  },
  {
    "text": "memory is is kind of an interesting one",
    "start": "1480120",
    "end": "1483080"
  },
  {
    "text": "though because the",
    "start": "1483080",
    "end": "1485120"
  },
  {
    "text": "um uh the way your CPU works it's",
    "start": "1485120",
    "end": "1489039"
  },
  {
    "text": "working in U A lot of the time 4K",
    "start": "1489039",
    "end": "1492720"
  },
  {
    "text": "Pages uh and and so it's it's kind of",
    "start": "1492720",
    "end": "1495559"
  },
  {
    "text": "spending a lot of time in housekeeping",
    "start": "1495559",
    "end": "1497279"
  },
  {
    "text": "and and it's got a I mean your your",
    "start": "1497279",
    "end": "1499679"
  },
  {
    "text": "cache on your CPU is probably something",
    "start": "1499679",
    "end": "1501399"
  },
  {
    "text": "like 10 gigs H sorry 10 mags and we've",
    "start": "1501399",
    "end": "1504320"
  },
  {
    "text": "got 100 gigs so basically if you reduce",
    "start": "1504320",
    "end": "1507279"
  },
  {
    "text": "the amount of memory being used by your",
    "start": "1507279",
    "end": "1508919"
  },
  {
    "text": "program it might go",
    "start": "1508919",
    "end": "1510360"
  },
  {
    "text": "faster because more of it might fit in",
    "start": "1510360",
    "end": "1513080"
  },
  {
    "text": "the cache more of it might not uh cause",
    "start": "1513080",
    "end": "1516679"
  },
  {
    "text": "what's called a tlb Miss can't don't",
    "start": "1516679",
    "end": "1519799"
  },
  {
    "text": "have time to explain that sorry um",
    "start": "1519799",
    "end": "1522720"
  },
  {
    "text": "anyway uh uh",
    "start": "1522720",
    "end": "1525720"
  },
  {
    "text": "so the very last thing that I did push",
    "start": "1525720",
    "end": "1528640"
  },
  {
    "text": "the CPU utilization up a bit uh for",
    "start": "1528640",
    "end": "1531960"
  },
  {
    "text": "everything else that I talked about it",
    "start": "1531960",
    "end": "1533279"
  },
  {
    "text": "goes",
    "start": "1533279",
    "end": "1535520"
  },
  {
    "text": "down yes that is nice",
    "start": "1535679",
    "end": "1539840"
  },
  {
    "text": "yes when evaluating the performance",
    "start": "1540480",
    "end": "1543279"
  },
  {
    "text": "improvements that you went through do",
    "start": "1543279",
    "end": "1544919"
  },
  {
    "text": "you have any general framework for",
    "start": "1544919",
    "end": "1547240"
  },
  {
    "text": "deciding if the development effort to",
    "start": "1547240",
    "end": "1548840"
  },
  {
    "text": "implement it is worth the performance",
    "start": "1548840",
    "end": "1551039"
  },
  {
    "text": "optimization oh yeah that's a good",
    "start": "1551039",
    "end": "1553279"
  },
  {
    "text": "question oh this is the when when do you",
    "start": "1553279",
    "end": "1556480"
  },
  {
    "text": "stop uh",
    "start": "1556480",
    "end": "1559679"
  },
  {
    "text": "question uh well I recommend having a",
    "start": "1559679",
    "end": "1562000"
  },
  {
    "text": "talk",
    "start": "1562000",
    "end": "1563720"
  },
  {
    "text": "[Laughter]",
    "start": "1563720",
    "end": "1570500"
  },
  {
    "text": "deadline",
    "start": "1571720",
    "end": "1573640"
  },
  {
    "text": "um yeah more seriously I mean yeah it is",
    "start": "1573640",
    "end": "1576799"
  },
  {
    "text": "good if you can somehow work out uh and",
    "start": "1576799",
    "end": "1579559"
  },
  {
    "text": "and you know it Richie was actually",
    "start": "1579559",
    "end": "1581640"
  },
  {
    "text": "talking about our uh I work for graan",
    "start": "1581640",
    "end": "1583919"
  },
  {
    "text": "lab same place um sending out these",
    "start": "1583919",
    "end": "1587039"
  },
  {
    "text": "weekly about about what we're spending",
    "start": "1587039",
    "end": "1589080"
  },
  {
    "text": "in the cloud and",
    "start": "1589080",
    "end": "1591640"
  },
  {
    "text": "um um memory and CPU is a part of that",
    "start": "1591640",
    "end": "1595440"
  },
  {
    "text": "and and so you can you can literally put",
    "start": "1595440",
    "end": "1597200"
  },
  {
    "text": "a a dollar amount on uh what what is",
    "start": "1597200",
    "end": "1601440"
  },
  {
    "text": "hard is to predict what the improvements",
    "start": "1601440",
    "end": "1603200"
  },
  {
    "text": "going to be right um so I think I think",
    "start": "1603200",
    "end": "1606799"
  },
  {
    "text": "realistically you have to uh you have to",
    "start": "1606799",
    "end": "1609880"
  },
  {
    "text": "get the data get the metrics get the",
    "start": "1609880",
    "end": "1612159"
  },
  {
    "text": "profile",
    "start": "1612159",
    "end": "1613919"
  },
  {
    "text": "and uh you get some kind of idea",
    "start": "1613919",
    "end": "1618480"
  },
  {
    "text": "like you know I mean a profile that is",
    "start": "1618480",
    "end": "1621039"
  },
  {
    "text": "really attractive to optimize is one",
    "start": "1621039",
    "end": "1623480"
  },
  {
    "text": "where there's one big bar like like the",
    "start": "1623480",
    "end": "1627760"
  },
  {
    "text": "one that I showed you there was kind of",
    "start": "1627760",
    "end": "1629279"
  },
  {
    "text": "a lot of kind of evenly sized bars that",
    "start": "1629279",
    "end": "1631559"
  },
  {
    "text": "means people have already optimized it",
    "start": "1631559",
    "end": "1633159"
  },
  {
    "text": "quite a lot anyway yeah it it's really",
    "start": "1633159",
    "end": "1635919"
  },
  {
    "text": "hard to predict what a benefit you're",
    "start": "1635919",
    "end": "1638039"
  },
  {
    "text": "going to get out of it so you kind of",
    "start": "1638039",
    "end": "1639279"
  },
  {
    "text": "have to say well you know I'll give it",
    "start": "1639279",
    "end": "1642080"
  },
  {
    "text": "I'll give it three weeks or something",
    "start": "1642080",
    "end": "1643480"
  },
  {
    "text": "like that and that's that's worth you",
    "start": "1643480",
    "end": "1645320"
  },
  {
    "text": "know that's so much of my time and",
    "start": "1645320",
    "end": "1647760"
  },
  {
    "text": "hoping to get this much drop in my cloud",
    "start": "1647760",
    "end": "1649960"
  },
  {
    "text": "bill but if I don't get anywhere by",
    "start": "1649960",
    "end": "1651760"
  },
  {
    "text": "three weeks I'm just going to have to",
    "start": "1651760",
    "end": "1652840"
  },
  {
    "text": "drop it because it didn't work out I sad",
    "start": "1652840",
    "end": "1656440"
  },
  {
    "text": "you know I don't have I don't have a",
    "start": "1656440",
    "end": "1657919"
  },
  {
    "text": "better story than that just kind of time",
    "start": "1657919",
    "end": "1660559"
  },
  {
    "text": "box",
    "start": "1660559",
    "end": "1661960"
  },
  {
    "text": "it yes hey uh great talk thanks that",
    "start": "1661960",
    "end": "1665600"
  },
  {
    "text": "resonates a lot with our experience with",
    "start": "1665600",
    "end": "1668279"
  },
  {
    "text": "Prometheus so it's great to see the",
    "start": "1668279",
    "end": "1670399"
  },
  {
    "text": "memory being lower uh my question is",
    "start": "1670399",
    "end": "1672840"
  },
  {
    "text": "about the agent config does agent what",
    "start": "1672840",
    "end": "1675200"
  },
  {
    "text": "is it magent mode does it change the",
    "start": "1675200",
    "end": "1677519"
  },
  {
    "text": "situation if you use the Prometheus as",
    "start": "1677519",
    "end": "1679200"
  },
  {
    "text": "the agent is the memory usage lower okay",
    "start": "1679200",
    "end": "1682120"
  },
  {
    "text": "yeah so so there's a mode you can run",
    "start": "1682120",
    "end": "1684039"
  },
  {
    "text": "Prometheus in Called Agent mode that's",
    "start": "1684039",
    "end": "1685640"
  },
  {
    "text": "what you're asking about um and",
    "start": "1685640",
    "end": "1688519"
  },
  {
    "text": "essentially it does not build uh tsdb in",
    "start": "1688519",
    "end": "1692440"
  },
  {
    "text": "that mode but you still have the right",
    "start": "1692440",
    "end": "1695000"
  },
  {
    "text": "the headlock right you still have those",
    "start": "1695000",
    "end": "1696679"
  },
  {
    "text": "two",
    "start": "1696679",
    "end": "1697720"
  },
  {
    "text": "hours yeah so it'll be a little bit",
    "start": "1697720",
    "end": "1699880"
  },
  {
    "text": "different but I in my tests I did have",
    "start": "1699880",
    "end": "1702559"
  },
  {
    "text": "remote right turned on oh yeah that",
    "start": "1702559",
    "end": "1706000"
  },
  {
    "text": "that's hard uh takes a lot of memory",
    "start": "1706000",
    "end": "1709440"
  },
  {
    "text": "yeah I I think there's some specific",
    "start": "1709440",
    "end": "1711480"
  },
  {
    "text": "fixes in there and",
    "start": "1711480",
    "end": "1713840"
  },
  {
    "text": "um uh yeah it's so basically the the",
    "start": "1713840",
    "end": "1717799"
  },
  {
    "text": "labels as string table",
    "start": "1717799",
    "end": "1720760"
  },
  {
    "text": "thing was not particularly helpful for",
    "start": "1720760",
    "end": "1723559"
  },
  {
    "text": "Prometheus agent the the next one that",
    "start": "1723559",
    "end": "1726440"
  },
  {
    "text": "labels as symbol table um will",
    "start": "1726440",
    "end": "1730919"
  },
  {
    "text": "be great",
    "start": "1730919",
    "end": "1734240"
  },
  {
    "text": "thanks thank you so much Ryan we",
    "start": "1735480",
    "end": "1737960"
  },
  {
    "text": "appreciate",
    "start": "1737960",
    "end": "1738780"
  },
  {
    "text": "[Applause]",
    "start": "1738780",
    "end": "1746960"
  },
  {
    "text": "you",
    "start": "1746960",
    "end": "1749960"
  }
]