[
  {
    "text": "hello everyone thanks for coming I'm",
    "start": "410",
    "end": "6089"
  },
  {
    "text": "going to talk about how to safely upgrade the kubernetes clusters this is",
    "start": "6089",
    "end": "12030"
  },
  {
    "text": "that this talk is a collaboration between my colleague Leo you and myself shoot all we're both software engineers",
    "start": "12030",
    "end": "19980"
  },
  {
    "text": "at Google we are we contribute most to the SiC API machinery so there's an oh",
    "start": "19980",
    "end": "31859"
  },
  {
    "text": "saying that the only certainties in life are death and taxes",
    "start": "31859",
    "end": "37129"
  },
  {
    "text": "fortunately for kubernetes cluster operators there's another certainty which is upgrades like every other",
    "start": "37129",
    "end": "46530"
  },
  {
    "text": "software upgrading kubernetes clusters is necessary to pick up the latest",
    "start": "46530",
    "end": "51870"
  },
  {
    "text": "security patch the bug fixes or to use any new features however it is very hard",
    "start": "51870",
    "end": "59460"
  },
  {
    "text": "to get the upgrade correct if you're operating your own cluster on Prem you",
    "start": "59460",
    "end": "65909"
  },
  {
    "text": "don't have many chances to practice kubernetes upgrades because after all kubernetes only release once every",
    "start": "65909",
    "end": "72600"
  },
  {
    "text": "quarter and even for cloud providers like Google although we do how we do",
    "start": "72600",
    "end": "78299"
  },
  {
    "text": "upgrades very often we face other challenges for example we don't control",
    "start": "78299",
    "end": "84900"
  },
  {
    "text": "the workloads running on the nodes so we cannot validate kubernetes",
    "start": "84900",
    "end": "90540"
  },
  {
    "text": "the new version of kubernetes with every client's workloads before hand so it's very difficult for us okay to get",
    "start": "90540",
    "end": "97770"
  },
  {
    "text": "upgrades 100% safe for everyone so I",
    "start": "97770",
    "end": "103590"
  },
  {
    "text": "have been managing g k g:k ease upgrades for the past half a year I think it's",
    "start": "103590",
    "end": "111689"
  },
  {
    "text": "worth sharing my experience with the community I hope from this talk cluster",
    "start": "111689",
    "end": "117390"
  },
  {
    "text": "admins can learn what are the current best practices of upgrades and some some",
    "start": "117390",
    "end": "123600"
  },
  {
    "text": "known issues and how to work around them and two contributors I hope you can",
    "start": "123600",
    "end": "129060"
  },
  {
    "text": "learn from this talk what are the what are the areas that the improvements and where to pay",
    "start": "129060",
    "end": "136079"
  },
  {
    "text": "attention to when you're doing code reviews to ensure us to ensure successful upgraded experience upgrade",
    "start": "136079",
    "end": "147450"
  },
  {
    "text": "is a very complex topic it includes many things like upgrading your network",
    "start": "147450",
    "end": "153500"
  },
  {
    "text": "upgrading your base OS image but for the sake of time I'm only going to focus on",
    "start": "153500",
    "end": "160560"
  },
  {
    "text": "how to up how to upgrade the kubernetes binaries like the cube api server the",
    "start": "160560",
    "end": "165659"
  },
  {
    "text": "controller manager etc I plan to",
    "start": "165659",
    "end": "172290"
  },
  {
    "text": "structure the talk in three sections first I'll talk about the state of the",
    "start": "172290",
    "end": "177450"
  },
  {
    "text": "art what are the current diversity practices then I'll share some knowing",
    "start": "177450",
    "end": "182849"
  },
  {
    "text": "issues and how to work around them and at last I'll talk about some unforeseen",
    "start": "182849",
    "end": "188700"
  },
  {
    "text": "problems and how to tackle with them let's begin with the first section",
    "start": "188700",
    "end": "195889"
  },
  {
    "text": "however before we can even begin to upgrade we need to take some steps what",
    "start": "196940",
    "end": "202799"
  },
  {
    "text": "do you think is the first step when you are doing classed upgrade ah yeah that's",
    "start": "202799",
    "end": "210540"
  },
  {
    "text": "the that's great in my opinion backup is the most important thing to do as the first step",
    "start": "210540",
    "end": "217379"
  },
  {
    "text": "of upgrade you can achieve this easily with the sed control command according",
    "start": "217379",
    "end": "224699"
  },
  {
    "text": "to our our experience this command will only will take at most 10 minutes to run",
    "start": "224699",
    "end": "230699"
  },
  {
    "text": "and in most cases it's a matter of seconds so it's a very cheap insurance",
    "start": "230699",
    "end": "236370"
  },
  {
    "text": "to buy before you do the upgrade that that way you will at least have a point",
    "start": "236370",
    "end": "242009"
  },
  {
    "text": "to row back to if your upgrades fails",
    "start": "242009",
    "end": "246560"
  },
  {
    "text": "please know that the backup sometimes",
    "start": "247220",
    "end": "252509"
  },
  {
    "text": "will be corrupted we do see searches we do see such issues in production so",
    "start": "252509",
    "end": "258870"
  },
  {
    "text": "after you take the backup it's suggested that it should also use the sed control command to do a sanity check of the",
    "start": "258870",
    "end": "266219"
  },
  {
    "text": "backup this is also a cheapo operation and the",
    "start": "266219",
    "end": "273060"
  },
  {
    "text": "second question I hope this is even more easier can we jump minor versions when",
    "start": "273060",
    "end": "280320"
  },
  {
    "text": "we do upgrade you're right the answer is",
    "start": "280320",
    "end": "286229"
  },
  {
    "text": "no all right let's let's talk offline if you think it is but this is a policy",
    "start": "286229",
    "end": "292919"
  },
  {
    "text": "decision of kubernetes many backward compatibility guarantees",
    "start": "292919",
    "end": "298979"
  },
  {
    "text": "of kubernetes only supports only sub only guarantees the backward",
    "start": "298979",
    "end": "305130"
  },
  {
    "text": "compatibility for one minor version difference so if you want if your cluster is down 1.9 and you want to",
    "start": "305130",
    "end": "312540"
  },
  {
    "text": "upgrade to one 12 I suggested to take three small steps instead of a big jump",
    "start": "312540",
    "end": "318479"
  },
  {
    "text": "and in later in the talk I will actually mention some of the",
    "start": "318479",
    "end": "323729"
  },
  {
    "text": "issues you will meet if you jumped minor versions and last but not least before",
    "start": "323729",
    "end": "333389"
  },
  {
    "text": "you do that wait please look the read the release notes carefully especially",
    "start": "333389",
    "end": "339330"
  },
  {
    "text": "we should pay attention to the following three sections the knowing issues the",
    "start": "339330",
    "end": "344700"
  },
  {
    "text": "actually required and the deprecations and removals they are very important because if there is any backward",
    "start": "344700",
    "end": "351930"
  },
  {
    "text": "incompatibilities the developers will highlight them in these three sections",
    "start": "351930",
    "end": "358760"
  },
  {
    "text": "now let's begin our upgrade there are many tools that can make upgrades easier",
    "start": "360770",
    "end": "367320"
  },
  {
    "text": "all these popular cluster lifecycle management tools they all automated the",
    "start": "367320",
    "end": "373500"
  },
  {
    "text": "upgrade process to some extent like the cops the cube ADM the cube spray and",
    "start": "373500",
    "end": "379729"
  },
  {
    "text": "from another talk I heard the clutter API is the future it will be the unified",
    "start": "379729",
    "end": "385349"
  },
  {
    "text": "channel to orchestrate upgrades however all these tools have their limitations",
    "start": "385349",
    "end": "391910"
  },
  {
    "text": "for example some of them might only work on certain cloud providers and some of",
    "start": "391910",
    "end": "397890"
  },
  {
    "text": "them require you to set up your cluster with those tools they cannot adopt the",
    "start": "397890",
    "end": "402960"
  },
  {
    "text": "existing clusters I think it's worth sharing the menu steps step by step so",
    "start": "402960",
    "end": "411060"
  },
  {
    "text": "what I did is I read the the cube ATM upgrade the code and I'm trying to",
    "start": "411060",
    "end": "417750"
  },
  {
    "text": "reverse engineering it here so when we do up wait we should always upgrade the",
    "start": "417750",
    "end": "423510"
  },
  {
    "text": "master before note this is this is another policy decision of kubernetes",
    "start": "423510",
    "end": "428660"
  },
  {
    "text": "the notes are allowed the to lag behind the master by two minor versions but not",
    "start": "428660",
    "end": "434940"
  },
  {
    "text": "the other way around there's no guarantee if if your master is lagging behind it a note so always upgrade a",
    "start": "434940",
    "end": "442530"
  },
  {
    "text": "note sorry always upgrade master before your upgrade note and also when you're",
    "start": "442530",
    "end": "448380"
  },
  {
    "text": "actually doing the master upgrade it's suggested to upgrade to your cube API server first because your clients like",
    "start": "448380",
    "end": "456210"
  },
  {
    "text": "controller managers they might depend on the new features and you only the newer",
    "start": "456210",
    "end": "462030"
  },
  {
    "text": "version of cube API server provide those features so you upgrade your cube API",
    "start": "462030",
    "end": "467130"
  },
  {
    "text": "server and then you upgrade to your clients like the controller manager the scheduler and add-ons and in Cuba ATMs",
    "start": "467130",
    "end": "475770"
  },
  {
    "text": "in Cuba diem setup the last step of upgrading master is setting up the our",
    "start": "475770",
    "end": "481620"
  },
  {
    "text": "back rules for the node bootstrap tokens this this step is optional it's required",
    "start": "481620",
    "end": "488970"
  },
  {
    "text": "only if you are using the feature but this is a very good example of how small",
    "start": "488970",
    "end": "494820"
  },
  {
    "text": "features miscellaneous features can can get in the way of a successful upgrade",
    "start": "494820",
    "end": "501410"
  },
  {
    "text": "then we calculate our notes usually this is done in a fashion of rolling upgrade",
    "start": "503370",
    "end": "509699"
  },
  {
    "text": "we were upgrade one node at a time and to do that we first used the cube",
    "start": "509699",
    "end": "515490"
  },
  {
    "text": "control joint command which will remove the workloads from the node and it will",
    "start": "515490",
    "end": "520589"
  },
  {
    "text": "mark the note as unschedulable to prevent any further assignments and if",
    "start": "520589",
    "end": "527610"
  },
  {
    "text": "you use this switch the cube control Jane was the port disruption budget feature then you can minimize that",
    "start": "527610",
    "end": "534210"
  },
  {
    "text": "disruptions caused the two your services after all the workloads are removed from",
    "start": "534210",
    "end": "539940"
  },
  {
    "text": "your note then you can upgrade your cubelet binary after that's done you can",
    "start": "539940",
    "end": "546930"
  },
  {
    "text": "use the cube karo and cordon command which will mark the note as scheduled up again then you finish the upgrade of one",
    "start": "546930",
    "end": "554400"
  },
  {
    "text": "node it's worth mentioning that the",
    "start": "554400",
    "end": "561120"
  },
  {
    "text": "in-place cubelet upgrade is not supported here by in place I mean",
    "start": "561120",
    "end": "566690"
  },
  {
    "text": "upgrading your cubelet while they're still pods or containers running on your",
    "start": "566690",
    "end": "571920"
  },
  {
    "text": "on your note it is not supported because cubelet has States and it will recorded",
    "start": "571920",
    "end": "578730"
  },
  {
    "text": "the states on a node and there's no guarantee that the newer version cubelet",
    "start": "578730",
    "end": "584670"
  },
  {
    "text": "will treat those states in a backward compatible way so for example I think",
    "start": "584670",
    "end": "590700"
  },
  {
    "text": "I've seen one ten cubelets changed where where it stores the logs for the pots so",
    "start": "590700",
    "end": "597540"
  },
  {
    "text": "if you do a in-place cubelet upgrade to one ten then you will lose all the logs",
    "start": "597540",
    "end": "604260"
  },
  {
    "text": "to the existing pots so in place cubelet upgrade is not supported so this",
    "start": "604260",
    "end": "614339"
  },
  {
    "text": "concludes the current ambassador practices I hope those these are easy for you because now we are going to talk",
    "start": "614339",
    "end": "621029"
  },
  {
    "text": "about some known issues so you can so even if you are following the previous",
    "start": "621029",
    "end": "627480"
  },
  {
    "text": "best practices you can still meet these no issues I'll talk about all of them",
    "start": "627480",
    "end": "636560"
  },
  {
    "text": "the first issue is that you might end up with deprecated data that",
    "start": "638060",
    "end": "644129"
  },
  {
    "text": "uninterpretable data in your sed to understand how can we and how can we get",
    "start": "644129",
    "end": "650610"
  },
  {
    "text": "into this situation our first step we flay describe how cube api server",
    "start": "650610",
    "end": "655800"
  },
  {
    "text": "normally stores api objects' so in this graph starting from the left top corner",
    "start": "655800",
    "end": "663180"
  },
  {
    "text": "a happy user is trying to create a batch v1 job so it will send he will send the",
    "start": "663180",
    "end": "671220"
  },
  {
    "text": "content to the battery one job and point of api server api server will be",
    "start": "671220",
    "end": "677100"
  },
  {
    "text": "serialized the content do the validations apply the defaults and then",
    "start": "677100",
    "end": "683279"
  },
  {
    "text": "it will convert the object to the storage version which is extensions v1",
    "start": "683279",
    "end": "690779"
  },
  {
    "text": "beta 1 and then it will store the the version the object SCD so the content in",
    "start": "690779",
    "end": "697620"
  },
  {
    "text": "SED is actually version versioned and it will be extensions v 1 beta 1 by default",
    "start": "697620",
    "end": "703370"
  },
  {
    "text": "and when the user is trying to read the data the reverse of the process is",
    "start": "703370",
    "end": "709769"
  },
  {
    "text": "applied the content is read from the SED an api server needs to deserialize the",
    "start": "709769",
    "end": "716670"
  },
  {
    "text": "extensions v1 beta one job and then converted to whatever version the user",
    "start": "716670",
    "end": "722040"
  },
  {
    "text": "user is requesting this is the normal process however if you create a job",
    "start": "722040",
    "end": "730199"
  },
  {
    "text": "today and you forget to and you didn't - you didn't to read or write to it for",
    "start": "730199",
    "end": "736439"
  },
  {
    "text": "the part for the next year then this job will stay in the extensions v1 beta 1",
    "start": "736439",
    "end": "741689"
  },
  {
    "text": "you know in your STD however one year later extensions v1 beta one might get",
    "start": "741689",
    "end": "749009"
  },
  {
    "text": "removed from the codebase your API server will not understand extensions V",
    "start": "749009",
    "end": "755399"
  },
  {
    "text": "1 beta 1 anymore so at that time if you try to read the job from a CD again API",
    "start": "755399",
    "end": "763800"
  },
  {
    "text": "server will fail to read it it will give you a obscure error message",
    "start": "763800",
    "end": "768810"
  },
  {
    "text": "claiming that there's no job registered at the extensions view and beta1 at that",
    "start": "768810",
    "end": "776340"
  },
  {
    "text": "time you cannot read the data it cannot update it you cannot even delete it because many delete options in Cuban",
    "start": "776340",
    "end": "783120"
  },
  {
    "text": "artists will require read from sed to do some validation so at this point this",
    "start": "783120",
    "end": "790440"
  },
  {
    "text": "job yes is completely dead in CD you have to directly interact with a CD",
    "start": "790440",
    "end": "796410"
  },
  {
    "text": "using a CD control to delete it so this",
    "start": "796410",
    "end": "805500"
  },
  {
    "text": "is a known issue in the upstream we actually have taken actions so in this",
    "start": "805500",
    "end": "811680"
  },
  {
    "text": "in this issue of 5 to 185 we have declared a freeze of the removal of API",
    "start": "811680",
    "end": "818760"
  },
  {
    "text": "versions before we can solve this this problem so the message to the contributors is",
    "start": "818760",
    "end": "825089"
  },
  {
    "text": "that when you are doing code reviews we have to reject any poor request that's",
    "start": "825089",
    "end": "831540"
  },
  {
    "text": "trying to remove a deprecated API version they need to stay there for now",
    "start": "831540",
    "end": "837890"
  },
  {
    "text": "as to the root cause of the issue we are working on a proper fix which is the",
    "start": "837890",
    "end": "844050"
  },
  {
    "text": "storage migration system you can see the details in the link in the link the cap",
    "start": "844050",
    "end": "850260"
  },
  {
    "text": "and the repository we have our own repository working on that and currently",
    "start": "850260",
    "end": "855900"
  },
  {
    "text": "I'm the only contributor it's quite unquiet lonely so you're welcome to help",
    "start": "855900",
    "end": "862430"
  },
  {
    "text": "also the message to the cluster admins is that you don't need to over concern",
    "start": "862430",
    "end": "868500"
  },
  {
    "text": "with this issue because we have free we have freeze the removal of API versions",
    "start": "868500",
    "end": "874170"
  },
  {
    "text": "since 1/6 so if your cluster is newer than 1/6 then you are safe from this",
    "start": "874170",
    "end": "880170"
  },
  {
    "text": "issue and also please in the future please read the release notes because",
    "start": "880170",
    "end": "885540"
  },
  {
    "text": "once the storage microd migration system is ready we'll start removing API",
    "start": "885540",
    "end": "891060"
  },
  {
    "text": "versions again and if there's any action required on your site we were highlighted in the release notes",
    "start": "891060",
    "end": "899570"
  },
  {
    "text": "and here is the second issue this one should be easier to explain so if you",
    "start": "901209",
    "end": "909860"
  },
  {
    "text": "have any custom automation depend depending on extensions v1 beta1",
    "start": "909860",
    "end": "915499"
  },
  {
    "text": "workload the api's and you upgrade your cluster to 115 you will suddenly see all",
    "start": "915499",
    "end": "922369"
  },
  {
    "text": "those automation stops working that is because the extensions v1 best beta one",
    "start": "922369",
    "end": "927529"
  },
  {
    "text": "endpoints are scheduled to be removed from API server so your client cannot",
    "start": "927529",
    "end": "933259"
  },
  {
    "text": "visit these endpoints anymore so",
    "start": "933259",
    "end": "938540"
  },
  {
    "text": "solutions to this kind of problems is easy the class data means you need to",
    "start": "938540",
    "end": "944059"
  },
  {
    "text": "remember to update your clients to read to read the release notes see what api's",
    "start": "944059",
    "end": "949759"
  },
  {
    "text": "are going to be removed in the new version and you have to upgrade your client to use the newer api before you",
    "start": "949759",
    "end": "957170"
  },
  {
    "text": "can upgrade your cluster and i think it would be cool if we have a tool that can",
    "start": "957170",
    "end": "963949"
  },
  {
    "text": "check can analyze the api service metrics and detect if there is any to be",
    "start": "963949",
    "end": "970339"
  },
  {
    "text": "deleted api still being used and warned the clustered me before they do the upgrade such a tool will be very useful",
    "start": "970339",
    "end": "977749"
  },
  {
    "text": "and will benefit everyone so contributors this is a chance to work",
    "start": "977749",
    "end": "982999"
  },
  {
    "text": "on and a third issue I want to share",
    "start": "982999",
    "end": "989749"
  },
  {
    "text": "that's after the upgrade it might break your policy dissing your policies so our",
    "start": "989749",
    "end": "996799"
  },
  {
    "text": "use admission web hooks as an example for those of you who are not familiar",
    "start": "996799",
    "end": "1002170"
  },
  {
    "text": "what admission web hooks are they are just an extension points to API server",
    "start": "1002170",
    "end": "1008970"
  },
  {
    "text": "you can instruct the API server to fold the requests of any specific resources",
    "start": "1008970",
    "end": "1018309"
  },
  {
    "text": "to your web book and in your web book you can do some custom validation to enforce policies so in this example set",
    "start": "1018309",
    "end": "1027399"
  },
  {
    "text": "up the web hook it is instructing the API server to Ford any request",
    "start": "1027399",
    "end": "1033760"
  },
  {
    "text": "to batch we want jobs forwarded the requests to the your web hook and the web hook can restrict can restrict what",
    "start": "1033760",
    "end": "1041770"
  },
  {
    "text": "images the jobs are using so far so good however once you upgrade your cluster",
    "start": "1041770",
    "end": "1051030"
  },
  {
    "text": "there might be a new version of the job like batch v2 or even trickier the jobs",
    "start": "1051030",
    "end": "1058990"
  },
  {
    "text": "might be available through different API group like awesome batch v1 at this",
    "start": "1058990",
    "end": "1065920"
  },
  {
    "text": "point you have a security hole in your system because users can bypass your web hooks by visiting the jobs through these",
    "start": "1065920",
    "end": "1074140"
  },
  {
    "text": "new endpoints so to avoid this kind of",
    "start": "1074140",
    "end": "1083980"
  },
  {
    "text": "issues again for cluster admins we need to read the release notes and see what",
    "start": "1083980",
    "end": "1092230"
  },
  {
    "text": "are the new API is that's becoming available and we need to upgrade our web hooks and the web hook configurations to",
    "start": "1092230",
    "end": "1099550"
  },
  {
    "text": "solve such issues to include the new versions to prevent any security holes",
    "start": "1099550",
    "end": "1104730"
  },
  {
    "text": "and I think this issue is not just it's not limited to what box any rules by",
    "start": "1104730",
    "end": "1112870"
  },
  {
    "text": "rule-based the validation in the system suffer from the same problem so I think",
    "start": "1112870",
    "end": "1118240"
  },
  {
    "text": "we should have fix this issue in general in a general way we should fix the API I",
    "start": "1118240",
    "end": "1124650"
  },
  {
    "text": "have a preliminary cap opening there you're welcome to share your thoughts",
    "start": "1124650",
    "end": "1130570"
  },
  {
    "text": "with me and the last issue I want to",
    "start": "1130570",
    "end": "1137020"
  },
  {
    "text": "share is about HJ pass the upgrade so in",
    "start": "1137020",
    "end": "1142840"
  },
  {
    "text": "this example setup there are three masters forming a each a cluster they",
    "start": "1142840",
    "end": "1148540"
  },
  {
    "text": "can all independently serve their clients and here is the real issue that",
    "start": "1148540",
    "end": "1155980"
  },
  {
    "text": "happened maybe one year ago after we do when we do the rolling upgrade and one",
    "start": "1155980",
    "end": "1161980"
  },
  {
    "text": "of the master has finished the operate while the other two are still using the old",
    "start": "1161980",
    "end": "1167350"
  },
  {
    "text": "of the coatis so in the new version of kubernetes the port has a new fielding",
    "start": "1167350",
    "end": "1174910"
  },
  {
    "text": "inspect called the Toleration x' and there are clients actively writing to this field to a non default value",
    "start": "1174910",
    "end": "1183419"
  },
  {
    "text": "harbor because there are still two masters of the old version and clients",
    "start": "1183419",
    "end": "1188919"
  },
  {
    "text": "are reading and writing through those old masters the and those old masters",
    "start": "1188919",
    "end": "1196929"
  },
  {
    "text": "doesn't even know about the existence of the old field so once the right happens occur happens",
    "start": "1196929",
    "end": "1203320"
  },
  {
    "text": "in the old master the field will be lost and this will lead this work this causes",
    "start": "1203320",
    "end": "1209559"
  },
  {
    "text": "data loss and then lead to indeterminate interment behavior so so this is a this",
    "start": "1209559",
    "end": "1223120"
  },
  {
    "text": "is an issue but you don't need to over concern with it because we have been",
    "start": "1223120",
    "end": "1228460"
  },
  {
    "text": "living with this long-standing issue for a while and we haven't seen any production serious production issue with",
    "start": "1228460",
    "end": "1235630"
  },
  {
    "text": "it but to fail on the safe side plus that means you should we should it will",
    "start": "1235630",
    "end": "1243970"
  },
  {
    "text": "be safe it will be safer if we can if we restricted the use of the new AP is before the rolling upgrade has completed",
    "start": "1243970",
    "end": "1250890"
  },
  {
    "text": "and two contributors I think this the",
    "start": "1250890",
    "end": "1256030"
  },
  {
    "text": "root cause of this issue that's in a che API server setup we don't have a mechanism to ensure that consistent",
    "start": "1256030",
    "end": "1263200"
  },
  {
    "text": "configurations so this is a big issue and it will cause problems",
    "start": "1263200",
    "end": "1268210"
  },
  {
    "text": "even without the involvement of upgrades so if you have ideas please share with",
    "start": "1268210",
    "end": "1273970"
  },
  {
    "text": "the still KPI machinery or you can talk we can talk offline",
    "start": "1273970",
    "end": "1278970"
  },
  {
    "text": "I hope I didn't I hope I haven't intimidates you too much so far these",
    "start": "1284630",
    "end": "1292400"
  },
  {
    "text": "are just there for knowing issues and it's an it's an incomplete list and before us in front of us they're still",
    "start": "1292400",
    "end": "1299650"
  },
  {
    "text": "enforceable issues but what are you expecting here it's called Oren",
    "start": "1299650",
    "end": "1306559"
  },
  {
    "text": "foreseeable issues I cannot foresee them right that's by definition uncertainty",
    "start": "1306559",
    "end": "1311980"
  },
  {
    "text": "uncertainties are just part of our life we have to live with it ji-hye Union comes on being hot right",
    "start": "1311980",
    "end": "1318730"
  },
  {
    "text": "but there's still some measures we can take to make upgrade safer so I think",
    "start": "1318730",
    "end": "1326630"
  },
  {
    "text": "the first thing we need to do more is testing this is a I think this is a",
    "start": "1326630",
    "end": "1332059"
  },
  {
    "text": "common-sense but I think it's worth emphasizing here for kubernetes upgrades",
    "start": "1332059",
    "end": "1338090"
  },
  {
    "text": "the open source testing coverage is actually very limited we only tested",
    "start": "1338090",
    "end": "1343429"
  },
  {
    "text": "some api's in some very specific configurations and in production we did",
    "start": "1343429",
    "end": "1351559"
  },
  {
    "text": "see some problems that will happen in very specific conditions so for example",
    "start": "1351559",
    "end": "1357410"
  },
  {
    "text": "we have seen issues that will only occur if we are upgrading from a very specific",
    "start": "1357410",
    "end": "1362540"
  },
  {
    "text": "patch version to the new version but not from other patch versions we have also",
    "start": "1362540",
    "end": "1368870"
  },
  {
    "text": "seen bugs that will only review if we have if the user has set up an API",
    "start": "1368870",
    "end": "1375950"
  },
  {
    "text": "objects with a very specific value so all these issues will not be catched",
    "start": "1375950",
    "end": "1381290"
  },
  {
    "text": "will not be caught by the stand standard OSS open source upgrade tests so the",
    "start": "1381290",
    "end": "1388400"
  },
  {
    "text": "suggestion here is that we should test to the upgrade situation seeing as real",
    "start": "1388400",
    "end": "1393950"
  },
  {
    "text": "as possible environment so if you can afford the resource it's suggested to",
    "start": "1393950",
    "end": "1400280"
  },
  {
    "text": "always have a staging environment stand by and tested your upgrades with the",
    "start": "1400280",
    "end": "1405410"
  },
  {
    "text": "real workloads and then you can proceed well with the production environment",
    "start": "1405410",
    "end": "1412690"
  },
  {
    "text": "and even if we do all the preparation up rates upgrades can still go wrong and at",
    "start": "1412830",
    "end": "1421169"
  },
  {
    "text": "that time we will really hope there's a boat button there so we can press it and",
    "start": "1421169",
    "end": "1426360"
  },
  {
    "text": "undo the upgrade mmm for kubernetes such an abort button will be a safe done",
    "start": "1426360",
    "end": "1433409"
  },
  {
    "text": "great but unfortunately downgrade is not generally safe today there are some",
    "start": "1433409",
    "end": "1441000"
  },
  {
    "text": "known issues I'll talk about some of them but I will be hand waving here because I haven't done any downgrading",
    "start": "1441000",
    "end": "1448559"
  },
  {
    "text": "production environment yet these are just the issues that occurred to me",
    "start": "1448559",
    "end": "1454610"
  },
  {
    "text": "first issue is that errands might crash after you do the downgrade because today",
    "start": "1454610",
    "end": "1460769"
  },
  {
    "text": "add-ons might use the latest features so if you downgrade your API server your",
    "start": "1460769",
    "end": "1466019"
  },
  {
    "text": "control plane those add-ons will not work anymore and if the atom is critical",
    "start": "1466019",
    "end": "1472590"
  },
  {
    "text": "enough they will do a bring your cluster down with it so I think for contributors",
    "start": "1472590",
    "end": "1479309"
  },
  {
    "text": "we should ban this kind of operation when we do code reviews for add-ons we",
    "start": "1479309",
    "end": "1484590"
  },
  {
    "text": "need to ban them from using the latest features this is not safe and a second",
    "start": "1484590",
    "end": "1491370"
  },
  {
    "text": "issue I think it's obvious if user have already created have you have already",
    "start": "1491370",
    "end": "1497940"
  },
  {
    "text": "used the new API S or the new API fields they have already created objects then",
    "start": "1497940",
    "end": "1504120"
  },
  {
    "text": "once you done great the API world will not be there anymore but the data was",
    "start": "1504120",
    "end": "1509760"
  },
  {
    "text": "still lurking the sed and they are a time bomb that will detonate once you",
    "start": "1509760",
    "end": "1515340"
  },
  {
    "text": "upgrade again so for this kind of issue I have a brainstorm idea I think it's",
    "start": "1515340",
    "end": "1522630"
  },
  {
    "text": "worth exploring we can do Multi multi phase upgrade for example we can upgrade",
    "start": "1522630",
    "end": "1529950"
  },
  {
    "text": "the clusters to use the new kubernetes binaries but we can disable the new API",
    "start": "1529950",
    "end": "1536909"
  },
  {
    "text": "at first and only after we are satisfied with the quality of the new binaries",
    "start": "1536909",
    "end": "1542149"
  },
  {
    "text": "then we were enabled a new API this should eliminate should reduce the chance of",
    "start": "1542149",
    "end": "1549270"
  },
  {
    "text": "this kind of data loss yes you have from happening as I said this is just an",
    "start": "1549270",
    "end": "1555540"
  },
  {
    "text": "incomplete list and downgrade is sung on the top of my wish list for 2019 so if",
    "start": "1555540",
    "end": "1563100"
  },
  {
    "text": "you have any ideas please share with me and there was the sig and this concludes",
    "start": "1563100",
    "end": "1569010"
  },
  {
    "text": "my talk today thank you very much for bearing with me and in the last light I",
    "start": "1569010",
    "end": "1575370"
  },
  {
    "text": "summarized some of the current ambassador practices thank you again any questions I feel",
    "start": "1575370",
    "end": "1597000"
  },
  {
    "text": "comfortable to use English so a little background about our setup as as we use",
    "start": "1597000",
    "end": "1603240"
  },
  {
    "text": "criminalities EWS and we start use kubernetes 1.8 hosted and for tab ec2",
    "start": "1603240",
    "end": "1613410"
  },
  {
    "text": "instances and we were trying to upgrade the community's version from one point 8",
    "start": "1613410",
    "end": "1620040"
  },
  {
    "text": "2 2 1 1 10 by manner version but we the",
    "start": "1620040",
    "end": "1626640"
  },
  {
    "text": "reason we won't do that is we will use an v type on AWS which give us more",
    "start": "1626640",
    "end": "1632520"
  },
  {
    "text": "benefits but like when we're trying to do that in one shot I failed and we don't know why it's like",
    "start": "1632520",
    "end": "1640920"
  },
  {
    "text": "some weird message we got and I just wonder like what is the best practice of",
    "start": "1640920",
    "end": "1646610"
  },
  {
    "text": "upgrading kubernetes and upgrading the underlying physical resources",
    "start": "1646610",
    "end": "1653960"
  },
  {
    "text": "I think first as I as I shared in the slides it's not safe in general to",
    "start": "1659970",
    "end": "1665220"
  },
  {
    "text": "operate multiple minor versions at a time right I see",
    "start": "1665220",
    "end": "1673380"
  },
  {
    "text": "so yes the is the error happening when you upgrade from 180 to one I know one",
    "start": "1673380",
    "end": "1679470"
  },
  {
    "text": "ninety 110 but I think this underlying issues needs to be analyzed a case by",
    "start": "1679470",
    "end": "1686760"
  },
  {
    "text": "case a Google we also do upgrades we",
    "start": "1686760",
    "end": "1692100"
  },
  {
    "text": "also operated the backend the resources and the communities but we usually do",
    "start": "1692100",
    "end": "1698070"
  },
  {
    "text": "them at a different pace and we have we will have a staging cluster that will",
    "start": "1698070",
    "end": "1703650"
  },
  {
    "text": "test all those issues together so the",
    "start": "1703650",
    "end": "1708960"
  },
  {
    "text": "reason we do them at different paces because we want to separate causes right I don't know if you in your case you can",
    "start": "1708960",
    "end": "1717650"
  },
  {
    "text": "upgrade to the backend the resource first and test it and then upgrade the kubernetes then you can you can at least",
    "start": "1717650",
    "end": "1724740"
  },
  {
    "text": "identify which one causes the problem or if it's all your fields suggest a",
    "start": "1724740",
    "end": "1730650"
  },
  {
    "text": "compatibility issue but in general I think this kind of issues is difficult",
    "start": "1730650",
    "end": "1735900"
  },
  {
    "text": "and we need to analyze some case-by-case",
    "start": "1735900",
    "end": "1740210"
  },
  {
    "text": "yeah hi are Varian benefits of replacing the notes instead of upgrading them in",
    "start": "1749240",
    "end": "1755520"
  },
  {
    "text": "place like creating new notes with the new version and they are scrapping the old ones or are there issues with that",
    "start": "1755520",
    "end": "1764330"
  },
  {
    "text": "let me try to repeat a question is it is there any benefit of doing in place",
    "start": "1768860",
    "end": "1774659"
  },
  {
    "text": "cubelet upgrade then ok so I think one",
    "start": "1774659",
    "end": "1780960"
  },
  {
    "text": "is one is the resource concern right maybe not not every cluster is flexible",
    "start": "1780960",
    "end": "1788400"
  },
  {
    "text": "you can maybe you cannot when you do the cube control Jane you do need to find a new home for all the pods right so if",
    "start": "1788400",
    "end": "1795240"
  },
  {
    "text": "you don't have extra resource when you once you join the pods it might take a",
    "start": "1795240",
    "end": "1801929"
  },
  {
    "text": "longer time to schedule them and also I think if you don't schedule them carefully there will be actually cost",
    "start": "1801929",
    "end": "1810570"
  },
  {
    "text": "the cube control Jane might cause all the poles to be moved in multiple times and that will cause disruption to",
    "start": "1810570",
    "end": "1817260"
  },
  {
    "text": "services so if we can do increase upgrade that will be the best right",
    "start": "1817260",
    "end": "1822780"
  },
  {
    "text": "we can't the worker there will be no downtime to the no disruption to the services you suggested always testing so",
    "start": "1822780",
    "end": "1840179"
  },
  {
    "text": "setting up some extra resources to validate that your real workloads can work before moving your cluster at that",
    "start": "1840179",
    "end": "1848520"
  },
  {
    "text": "point what's the technical rationale for supporting downgrade in my engineering experience downgrade is extremely",
    "start": "1848520",
    "end": "1854970"
  },
  {
    "text": "difficult to support and it feels like that takes resources from stabilizing",
    "start": "1854970",
    "end": "1860250"
  },
  {
    "text": "the actual upgrade path",
    "start": "1860250",
    "end": "1863720"
  },
  {
    "text": "so the question is what are the technical blockers for successful done great as I said I there there are many",
    "start": "1869330",
    "end": "1878990"
  },
  {
    "text": "problems and I only mentioned that to love them in my talk because we haven't",
    "start": "1878990",
    "end": "1888470"
  },
  {
    "text": "done any dunk rating production so it's hard to say but in general I think",
    "start": "1888470",
    "end": "1893600"
  },
  {
    "text": "engineers are feared about doing downgrade because we we don't in the in the I think in the kubernetes open",
    "start": "1893600",
    "end": "1900170"
  },
  {
    "text": "source we do have some downgrade tests but they are like the upgrade tests that",
    "start": "1900170",
    "end": "1906080"
  },
  {
    "text": "they only tested very certain cases I think to find the order done great",
    "start": "1906080",
    "end": "1911540"
  },
  {
    "text": "blockers we will need the most thorough test first and then we can identify the problems I think that will be the first",
    "start": "1911540",
    "end": "1918380"
  },
  {
    "text": "step it was partly a question of why",
    "start": "1918380",
    "end": "1925580"
  },
  {
    "text": "even choose to support downgrade in the community so from this sig release",
    "start": "1925580",
    "end": "1931490"
  },
  {
    "text": "perspective we've very often had the downgrade test failing and it's been",
    "start": "1931490",
    "end": "1936590"
  },
  {
    "text": "hard to find somebody to work on fixing them and everybody says we don't care about downgrade only Google cares about",
    "start": "1936590",
    "end": "1943580"
  },
  {
    "text": "downgrade but then you say that you haven't really so I wonder if we're spending engineering resources trying to",
    "start": "1943580",
    "end": "1950180"
  },
  {
    "text": "support something needlessly",
    "start": "1950180",
    "end": "1953380"
  },
  {
    "text": "I think dunk rate is just a safety net it will give all the customers and all the users more confidence about upgrade",
    "start": "1956540",
    "end": "1963470"
  },
  {
    "text": "right hopefully we will never need to use it if we have storoe testing of the",
    "start": "1963470",
    "end": "1969680"
  },
  {
    "text": "upgrades and suppose all the production workload production environment is exactly the same as our stage in the",
    "start": "1969680",
    "end": "1976640"
  },
  {
    "text": "environment then I agree we don't we will never need to dunk wait but usually",
    "start": "1976640",
    "end": "1982040"
  },
  {
    "text": "the reality is is far from the our imagination from the ideal world right",
    "start": "1982040",
    "end": "1987260"
  },
  {
    "text": "so I think it's still valuable too if we can do downgrade and I don't think it's",
    "start": "1987260",
    "end": "1992990"
  },
  {
    "text": "it will only benefit Google I think for everyone if we have a downgrade as a backup",
    "start": "1992990",
    "end": "1998419"
  },
  {
    "text": "as a plan-b that will be useful",
    "start": "1998419",
    "end": "2002638"
  },
  {
    "text": "hi um you mentioned you talked about backing up your ad CD cluster and I was",
    "start": "2012769",
    "end": "2021389"
  },
  {
    "text": "wondering if you can briefly talk about like in case of the upgrade failed when",
    "start": "2021389",
    "end": "2029100"
  },
  {
    "text": "you restore your ed CD cluster like a brief like how is the process done like",
    "start": "2029100",
    "end": "2036200"
  },
  {
    "text": "do you actually perform the restore on the same master node that that you fail",
    "start": "2036200",
    "end": "2042779"
  },
  {
    "text": "that or to create a new node and restore the data to the new new master no or I",
    "start": "2042779",
    "end": "2048599"
  },
  {
    "text": "I'm not yeah hi I'm Jo Betts I work on",
    "start": "2048599",
    "end": "2057210"
  },
  {
    "text": "that CD so this is actually a path that we want to improve over time right now",
    "start": "2057210",
    "end": "2064378"
  },
  {
    "text": "it's a little bit risky to just restore the sed state under kubernetes if you haven't performed any scheduling tasks",
    "start": "2064379",
    "end": "2071040"
  },
  {
    "text": "and the cluster is very stable he didn't theory may work but I would definitely consider this a bit of an",
    "start": "2071040",
    "end": "2077190"
  },
  {
    "text": "unsolved problem so I expect to see work over this in time but right now it might",
    "start": "2077190",
    "end": "2085200"
  },
  {
    "text": "be better to go get the objects out of sed that you need if you run into a problem but the best the best bet if",
    "start": "2085200",
    "end": "2090540"
  },
  {
    "text": "you're going to do this is to try and mostly stop operating on your cluster until you're done with your upgrades so that if you have to restore from the",
    "start": "2090540",
    "end": "2096750"
  },
  {
    "text": "backup that deltas as minimal as possible",
    "start": "2096750",
    "end": "2100670"
  },
  {
    "text": "oh thank you everyone that's it yeah",
    "start": "2104190",
    "end": "2114710"
  },
  {
    "text": "[Applause]",
    "start": "2114830",
    "end": "2118449"
  }
]