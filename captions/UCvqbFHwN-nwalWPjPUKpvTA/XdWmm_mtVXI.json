[
  {
    "start": "0",
    "end": "33000"
  },
  {
    "text": "hello everyone welcome my name is Dee I'm from Detroit I'm one of the",
    "start": "149",
    "end": "6089"
  },
  {
    "text": "environment inner today I'll talk about the extending alpha without webassembly",
    "start": "6089",
    "end": "12090"
  },
  {
    "text": "with John from Google so I'll do the introduction on on how we extend envoy",
    "start": "12090",
    "end": "19279"
  },
  {
    "text": "current in the current state and then we will try to introduce new plug-in system",
    "start": "19279",
    "end": "25260"
  },
  {
    "text": "I can say that a new way to xn envoy using we have assembly so this is the",
    "start": "25260",
    "end": "34950"
  },
  {
    "start": "33000",
    "end": "74000"
  },
  {
    "text": "today's agenda it's about envoy I mean it's like a quick recap on envoy I mean it will so",
    "start": "34950",
    "end": "41579"
  },
  {
    "text": "please bear with me it's an invitation for the for all of you to basically try",
    "start": "41579",
    "end": "48570"
  },
  {
    "text": "to contribute to envoy and then after that we will go down to talk about a",
    "start": "48570",
    "end": "53670"
  },
  {
    "text": "little bit about our FOIA architecture itself and how we it can be extended and of course we will go to the core is the",
    "start": "53670",
    "end": "61260"
  },
  {
    "text": "extending unemployed with Assembly John we will do that for us and there will be",
    "start": "61260",
    "end": "66930"
  },
  {
    "text": "a demo it's hopefully a good demo it's a live demo so and then we will do a Q&A",
    "start": "66930",
    "end": "73790"
  },
  {
    "text": "so the promise of our voice network should be transparent to application so",
    "start": "73790",
    "end": "78930"
  },
  {
    "text": "we believe that developers should focus on the business logic I mean developers",
    "start": "78930",
    "end": "85619"
  },
  {
    "text": "should only deal with the application logic not thinking about network itself",
    "start": "85619",
    "end": "92549"
  },
  {
    "text": "so but when when some problem occurs it needs to be very very apparent where is",
    "start": "92549",
    "end": "100409"
  },
  {
    "text": "the problem I mean like if the problem is the in the application logic itself or in the mapper layer so on for itself",
    "start": "100409",
    "end": "110700"
  },
  {
    "text": "is a it's very high quality code base",
    "start": "110700",
    "end": "116969"
  },
  {
    "text": "and and the speed if you you see the speed of the project on the github it's",
    "start": "116969",
    "end": "123390"
  },
  {
    "text": "very very fast and then it's designed to be extensible at its core it has",
    "start": "123390",
    "end": "130280"
  },
  {
    "text": "eventual consistent configuration API if you we have this XTS API we call it",
    "start": "130280",
    "end": "138240"
  },
  {
    "text": "its LDS CD s and stuff like that and no",
    "start": "138240",
    "end": "143850"
  },
  {
    "text": "open core pet premium version it's all there everything so in our foyer we believe that again",
    "start": "143850",
    "end": "150870"
  },
  {
    "text": "this is an invitation so we believe in community so people can come up with",
    "start": "150870",
    "end": "156000"
  },
  {
    "text": "ideas put some proposal in our project and we will make it happen so who is",
    "start": "156000",
    "end": "166080"
  },
  {
    "text": "sound boy so basically this is the talk from Harvey the last on ficon so as you can see that",
    "start": "166080",
    "end": "174360"
  },
  {
    "text": "envoy consists of many contributors from many organizations but as you can see",
    "start": "174360",
    "end": "184320"
  },
  {
    "text": "here you can see our turbine laps the turbine laps has this contribution on",
    "start": "184320",
    "end": "191270"
  },
  {
    "text": "trif filters so it's an extension of armful so as you can see if you do",
    "start": "191270",
    "end": "197910"
  },
  {
    "text": "expansion basically you will be on top of the contributors so to know alpha",
    "start": "197910",
    "end": "205260"
  },
  {
    "text": "better I'm just on Tuesday you you can go to the mid container design will be",
    "start": "205260",
    "end": "211650"
  },
  {
    "text": "there and then the next day and Thursday as well there will be interest one for",
    "start": "211650",
    "end": "216990"
  },
  {
    "text": "you and deep dive so again so this is the the anvil key texture envoy is",
    "start": "216990",
    "end": "228620"
  },
  {
    "start": "218000",
    "end": "377000"
  },
  {
    "text": "structured like this so basically there are some workers running to accept some",
    "start": "228620",
    "end": "235620"
  },
  {
    "text": "to accept the connections and then after that there we go to the listeners so",
    "start": "235620",
    "end": "241950"
  },
  {
    "text": "here the in the listeners here is the the first extension point that you can do so if you go to the arm voice source",
    "start": "241950",
    "end": "250200"
  },
  {
    "text": "code tree there will be an example of listener extension is TRS inspector for example",
    "start": "250200",
    "end": "256590"
  },
  {
    "text": "so basically you can dealing with the",
    "start": "256590",
    "end": "262040"
  },
  {
    "text": "read and pick the when before you accept it connect",
    "start": "262040",
    "end": "267569"
  },
  {
    "text": "and then after that you go down to the ol4 at the TCP stack of envoy currently",
    "start": "267569",
    "end": "274259"
  },
  {
    "text": "I'm for only work on TCP but the UDP part is is in progress right now so",
    "start": "274259",
    "end": "280289"
  },
  {
    "text": "after that we have these alpha rate",
    "start": "280289",
    "end": "285810"
  },
  {
    "text": "filters and to read the bytes in and bytes out and then we we do have these",
    "start": "285810",
    "end": "293400"
  },
  {
    "text": "l4 right filters where you can actually like mutate the traffic and and here so",
    "start": "293400",
    "end": "302400"
  },
  {
    "text": "basically the l7 itself is built as a network filters that were filled us in all four filters so you can have like",
    "start": "302400",
    "end": "310229"
  },
  {
    "text": "all seven filters like HTTP or trip or",
    "start": "310229",
    "end": "315289"
  },
  {
    "text": "probably my sequel right now we have my C code but not as it's only like grid",
    "start": "315289",
    "end": "320819"
  },
  {
    "text": "the filter but of course you can do like write filter for any protocol you want",
    "start": "320819",
    "end": "327120"
  },
  {
    "text": "and then inside inside that l7 layer you",
    "start": "327120",
    "end": "333060"
  },
  {
    "text": "can have another another stack of filters so that's another extension",
    "start": "333060",
    "end": "338400"
  },
  {
    "text": "point so you can write your own l4 filters and you can also write your own",
    "start": "338400",
    "end": "344270"
  },
  {
    "text": "l7 filters and for itself has many",
    "start": "344270",
    "end": "349680"
  },
  {
    "text": "another components like auxiliary components like stats so you basically",
    "start": "349680",
    "end": "355860"
  },
  {
    "text": "can have stat sinks I mean in alpha we have many options of how you sense",
    "start": "355860",
    "end": "363930"
  },
  {
    "text": "that's out like stats D or Prometheus endpoints or many other things we can we",
    "start": "363930",
    "end": "372449"
  },
  {
    "text": "have also like ex DSP is I told you before so to emphasize this to that",
    "start": "372449",
    "end": "382139"
  },
  {
    "start": "377000",
    "end": "449000"
  },
  {
    "text": "alpha is designed to be extensible with multiple extension points as you can see",
    "start": "382139",
    "end": "387719"
  },
  {
    "text": "the very obvious thing is you can put your extension on Al for seven as well",
    "start": "387719",
    "end": "393180"
  },
  {
    "text": "for ins our seven filters you can basically pick your date pick your traffic or",
    "start": "393180",
    "end": "399310"
  },
  {
    "text": "you can also mutate this traffic and if I also allows you to have your own access logger so we have like divine",
    "start": "399310",
    "end": "407790"
  },
  {
    "text": "interfaces for you to build your own access loggers we also allows you to",
    "start": "407790",
    "end": "414810"
  },
  {
    "text": "bring your own tracers we have Zipkin we have open dressing we have a couple of",
    "start": "414810",
    "end": "422200"
  },
  {
    "text": "things here even we do love people to extend a half Decker's the current",
    "start": "422200",
    "end": "429090"
  },
  {
    "text": "example right now in in arm for three is on like readies health checker but basically you can build our things and",
    "start": "429090",
    "end": "437430"
  },
  {
    "text": "another interesting things probably like retry policy you're probably in different",
    "start": "437430",
    "end": "442870"
  },
  {
    "text": "organization you need a different way of retrying request so if you go to an for",
    "start": "442870",
    "end": "452260"
  },
  {
    "start": "449000",
    "end": "467000"
  },
  {
    "text": "a source code github repository you can see that this you can go to an FOIA",
    "start": "452260",
    "end": "458950"
  },
  {
    "text": "source of extensions you can see it's growing and growing you can actually like introduce your own if you want so",
    "start": "458950",
    "end": "468460"
  },
  {
    "start": "467000",
    "end": "571000"
  },
  {
    "text": "basically this the structure of an extension is consists of business politics the how you read the data the",
    "start": "468460",
    "end": "476170"
  },
  {
    "text": "bytes or in a higher level like like l7 HTTP the how you actually read the",
    "start": "476170",
    "end": "484660"
  },
  {
    "text": "headers the the body or the trailers and",
    "start": "484660",
    "end": "490650"
  },
  {
    "text": "how you actually manipulate those data but another thing will important is the",
    "start": "490650",
    "end": "498460"
  },
  {
    "text": "configuration on on how that filter to be to be be to to behave just like what",
    "start": "498460",
    "end": "506380"
  },
  {
    "text": "you want the problem with this is you need to introduce it introduce this I",
    "start": "506380",
    "end": "512050"
  },
  {
    "text": "mean the code the business logic it should be inside the Envoy currently if",
    "start": "512050",
    "end": "519250"
  },
  {
    "text": "only can be introduced inside the Envoy code structure it should be statically linked but but",
    "start": "519250",
    "end": "528270"
  },
  {
    "text": "later we will introduce the web apps umbly where you can excel dynamically load some logic put in side",
    "start": "528270",
    "end": "537400"
  },
  {
    "text": "the envoy and then run it to manipulate your data so the configuration in our",
    "start": "537400",
    "end": "545320"
  },
  {
    "text": "voice is represented as a proto tree protobuf tree is very interesting",
    "start": "545320",
    "end": "551290"
  },
  {
    "text": "technology so so basically you can for example like in your organization you need this out service filter probably",
    "start": "551290",
    "end": "559150"
  },
  {
    "text": "you don't want it to be upstream because it is very specific to your organization so you can have your private extension",
    "start": "559150",
    "end": "566320"
  },
  {
    "text": "to be configured like this so yeah as I",
    "start": "566320",
    "end": "573760"
  },
  {
    "start": "571000",
    "end": "599000"
  },
  {
    "text": "said that the to write your own extension currently we can do it using C++ or Lua but Lua has some limitation",
    "start": "573760",
    "end": "580990"
  },
  {
    "text": "currently this only for a sativa traffic of course it can be extended to all four but Lua is the if you deal with some",
    "start": "580990",
    "end": "590890"
  },
  {
    "text": "kind of you embed some another runtime inside inside another process you will",
    "start": "590890",
    "end": "597040"
  },
  {
    "text": "have another problem so this is an example of GZ filter in C++ I just want",
    "start": "597040",
    "end": "603760"
  },
  {
    "text": "to very quickly to go on how we what we need to to have your own filter inside",
    "start": "603760",
    "end": "611500"
  },
  {
    "text": "point soand is a filter basically we have this this is how you plug in the",
    "start": "611500",
    "end": "618580"
  },
  {
    "text": "configuration as you can see here in the disable filter conflict you get the",
    "start": "618580",
    "end": "624360"
  },
  {
    "text": "unfold the gzip specific configuration it's divine as product message and then you",
    "start": "624360",
    "end": "633850"
  },
  {
    "text": "can load the configuration that is needed but it is it to be be it to behave so in the sed be stream filter",
    "start": "633850",
    "end": "642910"
  },
  {
    "start": "640000",
    "end": "711000"
  },
  {
    "text": "basically we have several things to be override overridden the first one is",
    "start": "642910",
    "end": "649300"
  },
  {
    "text": "that they got headers there is the decode the recode thing is when the data",
    "start": "649300",
    "end": "655720"
  },
  {
    "text": "comes in inside and void so basically when you have this HTTP requests coming",
    "start": "655720",
    "end": "661090"
  },
  {
    "text": "in inside envoy and then you do this decode headers you basically see what is",
    "start": "661090",
    "end": "666190"
  },
  {
    "text": "inside the head and then you want you can do the decision on what you what to do when you",
    "start": "666190",
    "end": "672310"
  },
  {
    "text": "see a certain headers and then the code data is doing with the data and the",
    "start": "672310",
    "end": "679690"
  },
  {
    "text": "trails also so in the case of gzip basically if the bigger headers first we",
    "start": "679690",
    "end": "685240"
  },
  {
    "text": "probably like you see that oh the requests near wants you to response with",
    "start": "685240",
    "end": "691990"
  },
  {
    "text": "the compress data so you can see it from the decoder the decode headers by having",
    "start": "691990",
    "end": "700120"
  },
  {
    "text": "that information you can send it back through encode data to to the color as",
    "start": "700120",
    "end": "708699"
  },
  {
    "text": "compress bytes so this is a what I said",
    "start": "708699",
    "end": "714040"
  },
  {
    "start": "711000",
    "end": "745000"
  },
  {
    "text": "before that the decode headers in DC filters is basically the first one very",
    "start": "714040",
    "end": "719079"
  },
  {
    "text": "simple if it is enabled or it is if you configure it to compress it responds or",
    "start": "719079",
    "end": "727769"
  },
  {
    "text": "it has the exact encoding here's something like that so you can basically",
    "start": "727769",
    "end": "733470"
  },
  {
    "text": "sending back the compress response this",
    "start": "733470",
    "end": "739300"
  },
  {
    "text": "is the encode data that basically send you back the compress information so",
    "start": "739300",
    "end": "746069"
  },
  {
    "text": "basically currently seems like we can do",
    "start": "746069",
    "end": "751689"
  },
  {
    "text": "better than this right so probably we can introduce some some plugin mechanism",
    "start": "751689",
    "end": "757329"
  },
  {
    "text": "that is dynamic enough and easy enough for us to integrate it into our workflow",
    "start": "757329",
    "end": "762850"
  },
  {
    "text": "in negotiation so now I'll invite John to talk about more about extending our",
    "start": "762850",
    "end": "770019"
  },
  {
    "text": "for with assembly [Applause]",
    "start": "770019",
    "end": "779450"
  },
  {
    "start": "772000",
    "end": "840000"
  },
  {
    "text": "hi I'm John plavix from Google and I'm going to tell you a little bit our projects I've been working on which is",
    "start": "779450",
    "end": "785340"
  },
  {
    "text": "to add webassembly VMs into envoy and stitch it in through all the different",
    "start": "785340",
    "end": "792240"
  },
  {
    "text": "extension points currently we have several extension points done and I'll",
    "start": "792240",
    "end": "797430"
  },
  {
    "text": "tell you about those and some of our future plans as well so I'm gonna start by talking about the overall architecture how the VMS are placed",
    "start": "797430",
    "end": "804780"
  },
  {
    "text": "within the envelope process I'm going to talk about the the different extension API that we're supporting and how the",
    "start": "804780",
    "end": "812070"
  },
  {
    "text": "VMA API works and the way that you know anybody else could add a new VM support",
    "start": "812070",
    "end": "817350"
  },
  {
    "text": "currently support rabbim and v8 and what we call the null sandbox which is a way",
    "start": "817350",
    "end": "823230"
  },
  {
    "text": "to link in your extensions directly but using the same API it would use if",
    "start": "823230",
    "end": "829080"
  },
  {
    "text": "you're going to do it in web assembly and that will allow you to put your extension under a standard debugger and",
    "start": "829080",
    "end": "835950"
  },
  {
    "text": "not have to deal with the the sandbox during your debugging phase so the first",
    "start": "835950",
    "end": "842370"
  },
  {
    "start": "840000",
    "end": "949000"
  },
  {
    "text": "question is well why why well but Emily in the first place well you know it has a bunch of",
    "start": "842370",
    "end": "847740"
  },
  {
    "text": "advantages one is it's portable and in this sense I don't mean that you can like move the code around but that you",
    "start": "847740",
    "end": "853980"
  },
  {
    "text": "could take a web assembly module and you could run it inside Envoy or you could",
    "start": "853980",
    "end": "860610"
  },
  {
    "text": "build a similar environment you could run it an inside node for example if you wanted to test it there or if you wanted",
    "start": "860610",
    "end": "866640"
  },
  {
    "text": "to use it in a different environment it's also sandbox machine code so it has you know advantages there in terms of",
    "start": "866640",
    "end": "874640"
  },
  {
    "text": "protecting yourself it's a web standard that's under active development there's",
    "start": "874640",
    "end": "879750"
  },
  {
    "text": "a whole bunch of new extensions coming out with threads huazi support which is a generic OS api",
    "start": "879750",
    "end": "887010"
  },
  {
    "text": "support different tool chains are available it's got good languages a support",
    "start": "887010",
    "end": "894080"
  },
  {
    "text": "typescript C++ rust and a variety of other languages in different states and",
    "start": "894080",
    "end": "900300"
  },
  {
    "text": "because it's being actively developed we expect that you know once for example the GC support gets standardized that",
    "start": "900300",
    "end": "905910"
  },
  {
    "text": "will see you know other languages like you know Java and go fully supported it's also pretty",
    "start": "905910",
    "end": "914850"
  },
  {
    "text": "fast so you know we can expect performance about you know 60 70 percent",
    "start": "914850",
    "end": "921089"
  },
  {
    "text": "of what you'd expect out of native C++ code and it's it's relatively safe so",
    "start": "921089",
    "end": "926339"
  },
  {
    "text": "it's sandbox you could also add additional levels of sandboxing to it to",
    "start": "926339",
    "end": "931589"
  },
  {
    "text": "make it you know even safer and finally one big advantage is that it's portable",
    "start": "931589",
    "end": "937529"
  },
  {
    "text": "in the sets you can move code into a running envelope process and dynamically link it in and that's really nice",
    "start": "937529",
    "end": "944009"
  },
  {
    "text": "because it you know allows us to modify our extensions which have what I have from to restart envoy itself so let's",
    "start": "944009",
    "end": "951149"
  },
  {
    "start": "949000",
    "end": "1006000"
  },
  {
    "text": "consider what use case you might have for something like this let's think about the use case of sto the the",
    "start": "951149",
    "end": "957149"
  },
  {
    "text": "service mesh so envoy is used in the data planes to enforce sto policy but",
    "start": "957149",
    "end": "963089"
  },
  {
    "text": "you know by having web assembly extensions we can avoid having to modify envoy itself which is you know a real",
    "start": "963089",
    "end": "970620"
  },
  {
    "text": "big advantage because you can run on the standard Co base and it also means you can avoid a certain high network hops",
    "start": "970620",
    "end": "977910"
  },
  {
    "text": "during policy checks so you can cache a lot of data locally without if they make",
    "start": "977910",
    "end": "983459"
  },
  {
    "text": "a G RPC request to say mixer you can also avoid restarting during dynamic reloads you get some isolation which is",
    "start": "983459",
    "end": "990480"
  },
  {
    "text": "nice so if your extension crashes it won't necessarily take down all of Envoy and if you've got you know certain",
    "start": "990480",
    "end": "997259"
  },
  {
    "text": "extensions that are pinned to certain flows you know then they'll only take",
    "start": "997259",
    "end": "1002449"
  },
  {
    "text": "down those and also you can do a/b testing so I'll go over a little bit of",
    "start": "1002449",
    "end": "1007579"
  },
  {
    "text": "the architecture and the api's that we have so there are three types of api's",
    "start": "1007579",
    "end": "1012769"
  },
  {
    "text": "there's general api's was the ones exported by envoy itself things like logging stats there's also extension",
    "start": "1012769",
    "end": "1020899"
  },
  {
    "text": "api's those are like you know filters l4 filters l7 filters logging filters and",
    "start": "1020899",
    "end": "1026659"
  },
  {
    "text": "finally there's those vm the vm api that you'd only use if you're going to add support for another vm system into this",
    "start": "1026659",
    "end": "1034449"
  },
  {
    "text": "project so you don't have to really understand this whole slide I'm gonna",
    "start": "1034449",
    "end": "1039980"
  },
  {
    "start": "1036000",
    "end": "1058000"
  },
  {
    "text": "have different slides to break it down but this is the overall architect and the the big area in the center here",
    "start": "1039980",
    "end": "1045980"
  },
  {
    "text": "we've got envoy there's a variety of vans in there and subsystems and it's talking to the other mesh nodes over",
    "start": "1045980",
    "end": "1053600"
  },
  {
    "text": "here on the left-hand side and the control plane now I'll break it down so this is how we configure VMs in an",
    "start": "1053600",
    "end": "1063620"
  },
  {
    "start": "1058000",
    "end": "1111000"
  },
  {
    "text": "envoy so initially when you start up you've got your normal envoy llamo file that describes all your filters and in",
    "start": "1063620",
    "end": "1070160"
  },
  {
    "text": "there you're gonna have a description that says hey I want to have this VM and I want it to have this this VM ID and",
    "start": "1070160",
    "end": "1078770"
  },
  {
    "text": "that VM ID is going to be used for these set of filters and you can have any",
    "start": "1078770",
    "end": "1084320"
  },
  {
    "text": "number of those you want so you can in you can have a lot of different VMs and then later on you can pass in new",
    "start": "1084320",
    "end": "1092210"
  },
  {
    "text": "descriptions new configurations dynamically using X Y s and those descriptions could include say URI and",
    "start": "1092210",
    "end": "1099400"
  },
  {
    "text": "you know a sha-256 it says hey go out to this code repo pull down this Waze",
    "start": "1099400",
    "end": "1105050"
  },
  {
    "text": "module this is the one you want to use so initially we start out with it on disk but you could go get it from",
    "start": "1105050",
    "end": "1110540"
  },
  {
    "text": "another source later on alright so the",
    "start": "1110540",
    "end": "1116530"
  },
  {
    "start": "1111000",
    "end": "1167000"
  },
  {
    "text": "the first thing to understand about envoy is it uses silos those are single threads that handle a dedicated set of",
    "start": "1116530",
    "end": "1125000"
  },
  {
    "text": "streams and the therefore the wasm VMs that we have are also going to be single",
    "start": "1125000",
    "end": "1131210"
  },
  {
    "text": "threaded so when we describe a VM template in the configuration that",
    "start": "1131210",
    "end": "1137630"
  },
  {
    "text": "template if it's used for filters is not going to be instantiated one VM / silo",
    "start": "1137630",
    "end": "1144470"
  },
  {
    "text": "that allows us to be single threaded within the silos and to not have to worry about locks or any other sort of",
    "start": "1144470",
    "end": "1151070"
  },
  {
    "text": "issue so as you can see a variety of streams will come in some subset of those streams that's going to be handled",
    "start": "1151070",
    "end": "1157160"
  },
  {
    "text": "by a silo and therefore some subset of those streams is going to be handled by a particular wasum vm for any given",
    "start": "1157160",
    "end": "1165410"
  },
  {
    "text": "filter now the question is that how do these things communicate so we've got",
    "start": "1165410",
    "end": "1171830"
  },
  {
    "start": "1167000",
    "end": "1256000"
  },
  {
    "text": "all these different sand boxes but we still want to have you know potentially to have collective information",
    "start": "1171830",
    "end": "1177410"
  },
  {
    "text": "so if you want to have for example you know collective stats or collected",
    "start": "1177410",
    "end": "1182480"
  },
  {
    "text": "policies you know if the the VMS have to make G RPC calls out or HTTP calls out",
    "start": "1182480",
    "end": "1189170"
  },
  {
    "text": "in order to get specific information about you know particular paths we want to cache that information we can store",
    "start": "1189170",
    "end": "1195620"
  },
  {
    "text": "it and share data that's another one of these general api's we're providing to",
    "start": "1195620",
    "end": "1201410"
  },
  {
    "text": "the Y's and modules that allows us to share data between VMs and we might also",
    "start": "1201410",
    "end": "1206480"
  },
  {
    "text": "have a situation where we want to consolidate a variety of information maybe stats or logs and we want to send",
    "start": "1206480",
    "end": "1213260"
  },
  {
    "text": "these out to some other process so we're sending them out to you know sto air or",
    "start": "1213260",
    "end": "1219260"
  },
  {
    "text": "fluid e or whoever and so in order to allow this to happen we can also have",
    "start": "1219260",
    "end": "1226450"
  },
  {
    "text": "services so services are Singleton's so as singleton would be a single VM that",
    "start": "1226900",
    "end": "1234950"
  },
  {
    "text": "runs in the Envoy process that then uses a consolidator it can talk to the siloed",
    "start": "1234950",
    "end": "1241640"
  },
  {
    "text": "VMS through shared data or through a message queue and then it can go take that information consolidate and for",
    "start": "1241640",
    "end": "1248990"
  },
  {
    "text": "instance send that information out to log sinks to stat sinks or any other sort of metrics back-end that you might",
    "start": "1248990",
    "end": "1255350"
  },
  {
    "text": "have okay so what kind of general API is",
    "start": "1255350",
    "end": "1260540"
  },
  {
    "start": "1256000",
    "end": "1289000"
  },
  {
    "text": "do we support these are the api's that are supported by aunt that are in Envoy that represent calls made out of the VM",
    "start": "1260540",
    "end": "1268400"
  },
  {
    "text": "to do some operation that's more general and on voice so we have support for timers metadata of all sorts of which",
    "start": "1268400",
    "end": "1276260"
  },
  {
    "text": "Envoy has like you know seven or eight different types HTTP GET you know Russ",
    "start": "1276260",
    "end": "1282350"
  },
  {
    "text": "it calls G RPC both envoy and Google style logging stats metrics shared data",
    "start": "1282350",
    "end": "1288500"
  },
  {
    "text": "and message queues and let me give you an example of how these things are wired in so we want to have multi-language",
    "start": "1288500",
    "end": "1294500"
  },
  {
    "start": "1289000",
    "end": "1395000"
  },
  {
    "text": "support and but we also want to have a nice API and so we've taken the API and",
    "start": "1294500",
    "end": "1301940"
  },
  {
    "text": "we split it into two parts we have a low-level C style API that's actually supported by envoy but in in the",
    "start": "1301940",
    "end": "1310850"
  },
  {
    "text": "and it has a format like a pointer as a format like up top so as you can see",
    "start": "1310850",
    "end": "1317900"
  },
  {
    "text": "things are passed in just as as raw primitives and so if you want to pass",
    "start": "1317900",
    "end": "1323270"
  },
  {
    "text": "any data in or data out you have to pass it by a pointer and a size pair and those things are opaque but for a high",
    "start": "1323270",
    "end": "1332360"
  },
  {
    "text": "level API we'd like to have something more powerful something that we're more used to and so for each different language and in this case particular C +",
    "start": "1332360",
    "end": "1339590"
  },
  {
    "text": "+ we're gonna provide this this set of wrappers these wrappers are provided just in header files as part of the API",
    "start": "1339590",
    "end": "1345950"
  },
  {
    "text": "and in this case you can see that we've taken the low level API which allows you to define a metric which comes back as",
    "start": "1345950",
    "end": "1352910"
  },
  {
    "text": "an opaque integer and then increment it by increment that it by passing back that opaque integer and turn it into",
    "start": "1352910",
    "end": "1359150"
  },
  {
    "text": "something a lot nicer so we have a counter that is has fully typed tags we",
    "start": "1359150",
    "end": "1365000"
  },
  {
    "text": "can increment based on you know providing the information for the tags we can also resolve that so that it goes",
    "start": "1365000",
    "end": "1372020"
  },
  {
    "text": "back to this integer which is gonna be a lot more efficient so we don't have to send the strength through every time and",
    "start": "1372020",
    "end": "1377780"
  },
  {
    "text": "then that with that resolved one we can increment it directly so this gives us an example of how all the API is work",
    "start": "1377780",
    "end": "1384230"
  },
  {
    "text": "there's a low-level API that's available to all the language all the languages",
    "start": "1384230",
    "end": "1390230"
  },
  {
    "text": "and then a high-level API it's specific to each language that follows the idioms of that language okay so what what type",
    "start": "1390230",
    "end": "1399740"
  },
  {
    "start": "1395000",
    "end": "1427000"
  },
  {
    "text": "of extension API is do we have currently we're supporting HB filters log filters service Singleton's we have definite",
    "start": "1399740",
    "end": "1407300"
  },
  {
    "text": "plans to do TCP filters and log sinks we'd like to do listeners as well you",
    "start": "1407300",
    "end": "1413570"
  },
  {
    "text": "know it just comes down to how much bandwidth we have who wants what right so the API extensions are pretty easy if",
    "start": "1413570",
    "end": "1421970"
  },
  {
    "text": "you just follow the template of the code it would be really easy to add another one so here's an example of what an HTTP",
    "start": "1421970",
    "end": "1430730"
  },
  {
    "start": "1427000",
    "end": "1498000"
  },
  {
    "text": "filter looks like because these filt because this is all callback related",
    "start": "1430730",
    "end": "1437320"
  },
  {
    "text": "there's you know no threading so you're not getting a situation like you would in lua where you know it looks like you",
    "start": "1437320",
    "end": "1443210"
  },
  {
    "text": "have continued code instead you just have calls there's a context and that context represents a",
    "start": "1443210",
    "end": "1448250"
  },
  {
    "text": "stream so that's like one you know HP request and it has the call-outs so like",
    "start": "1448250",
    "end": "1456020"
  },
  {
    "text": "on request headers means the request errors come in and then you can you can log you can make a debugging log call",
    "start": "1456020",
    "end": "1461900"
  },
  {
    "text": "you can get a header you can modify that",
    "start": "1461900",
    "end": "1467000"
  },
  {
    "text": "header and then you can return you know your your filter status and as you can",
    "start": "1467000",
    "end": "1474230"
  },
  {
    "text": "see here this this supports actually both an HTTP filter and a logging filter",
    "start": "1474230",
    "end": "1479780"
  },
  {
    "text": "all in one so you know when you're doing your configuration you can figure both of those things you'd vector into the",
    "start": "1479780",
    "end": "1485300"
  },
  {
    "text": "same VM and you'd handle them with the same context and that gives you the advantage of carrying contacts through",
    "start": "1485300",
    "end": "1491330"
  },
  {
    "text": "both the HTTP filter and the logging filter which is a nice plus next we've",
    "start": "1491330",
    "end": "1500660"
  },
  {
    "start": "1498000",
    "end": "1570000"
  },
  {
    "text": "got the VM API is it's really only important for somebody who wants to add a new VM currently support watham v8 and",
    "start": "1500660",
    "end": "1507740"
  },
  {
    "text": "the Noll sandbox which allows you to compile directly into Envoy and if you want to add a new VM for instance you",
    "start": "1507740",
    "end": "1514340"
  },
  {
    "text": "know you're into crane left and you want to really want to put that one in there's only a few things that you need to do you need to implement a function",
    "start": "1514340",
    "end": "1521929"
  },
  {
    "text": "to register callbacks these are calls that come out of the VM all those you know general API as I was talking about",
    "start": "1521929",
    "end": "1527510"
  },
  {
    "text": "you need to add a function to get functions from the VM so you can get the",
    "start": "1527510",
    "end": "1533059"
  },
  {
    "text": "handlers that the VM has for like you know when a call comes into the VM like",
    "start": "1533059",
    "end": "1539929"
  },
  {
    "text": "the on log call you'd have to have to have a way for envoy to get that call from the VM and then you know you need",
    "start": "1539929",
    "end": "1547400"
  },
  {
    "text": "the general load link and start and finally we do everything by copying",
    "start": "1547400",
    "end": "1552440"
  },
  {
    "text": "memory in and out of the VM that's because that's sort of the lowest level simplest API it also means we can you",
    "start": "1552440",
    "end": "1557600"
  },
  {
    "text": "know wrap the VM and a process we want to additional security and so you have to add a simple set memory and get",
    "start": "1557600",
    "end": "1564470"
  },
  {
    "text": "memory operations and once you do that you could implement you could implement a new VM so what's the status think",
    "start": "1564470",
    "end": "1572570"
  },
  {
    "start": "1570000",
    "end": "1617000"
  },
  {
    "text": "we've gone over this before a bunch of this stuff is done we've got you know several different types of filters",
    "start": "1572570",
    "end": "1577789"
  },
  {
    "text": "several different types of VMs several different types of general api's metrics and logging HTTP calls G RPC calls and",
    "start": "1577789",
    "end": "1586960"
  },
  {
    "text": "what are we planning to do well we want to do additional extension api's we'd",
    "start": "1586960",
    "end": "1593479"
  },
  {
    "text": "like to have you know additional VMs there's a bunch of new standards coming out threads we'd love to have zero copy",
    "start": "1593479",
    "end": "1599710"
  },
  {
    "text": "memory for those cases that it's appropriate for and we'd like to have",
    "start": "1599710",
    "end": "1605509"
  },
  {
    "text": "support for dynamic loading and linking and of course we'd love to up stream this into the Envoy master branch it's",
    "start": "1605509",
    "end": "1613429"
  },
  {
    "text": "not there yet you know it's something we fully intend to do so in conclusion you",
    "start": "1613429",
    "end": "1619369"
  },
  {
    "start": "1617000",
    "end": "1647000"
  },
  {
    "text": "know web assembly is good for Envoy yeah it's efficient relatively safe and secure it's dynamically upgradeable and",
    "start": "1619369",
    "end": "1626389"
  },
  {
    "text": "we've got an issue to put it in as well as a repo under on V proxy but it's not",
    "start": "1626389",
    "end": "1634519"
  },
  {
    "text": "on the way itself its Envoy wasum it's a sort of a sandbox right now so it's a staging area so that we can get the PRS",
    "start": "1634519",
    "end": "1640279"
  },
  {
    "text": "and upstream and we'd love to get some contributions so now I'm going to try to",
    "start": "1640279",
    "end": "1645320"
  },
  {
    "text": "do a live demo that's always a fun experience okay so like a half yeah I",
    "start": "1645320",
    "end": "1654409"
  },
  {
    "start": "1647000",
    "end": "1709000"
  },
  {
    "text": "have a few minutes okay so the first thing is the API so there's a file in",
    "start": "1654409",
    "end": "1663159"
  },
  {
    "text": "sorry directory which is API wasm c p-- cpp so there's you know additional",
    "start": "1663159",
    "end": "1670639"
  },
  {
    "text": "languages in there like API was in rust and in here you'll see that we've got some dot BC files those are actually",
    "start": "1670639",
    "end": "1678019"
  },
  {
    "text": "wasm encoded bit code files for support for protobufs that are pre-built for you there's also",
    "start": "1678019",
    "end": "1686229"
  },
  {
    "text": "various header files so proxy wasm extern over there those the external",
    "start": "1686229",
    "end": "1693590"
  },
  {
    "text": "function calls the general API calls the imple dot h1 is the high level API",
    "start": "1693590",
    "end": "1702340"
  },
  {
    "text": "and the enums over there are the enumerations that you might see so let's take a look at like say the enumeration",
    "start": "1702550",
    "end": "1708100"
  },
  {
    "text": "one you know you can see in here that we have the various log levels defined",
    "start": "1708100",
    "end": "1713410"
  },
  {
    "start": "1709000",
    "end": "1725000"
  },
  {
    "text": "different header status messages things like that I can try if I do that you actually all",
    "start": "1713410",
    "end": "1723130"
  },
  {
    "text": "right I'm gonna do the second part of the demo and then I'll come back and make the font bigger because otherwise you can't see the log lines alright so",
    "start": "1723130",
    "end": "1731640"
  },
  {
    "start": "1725000",
    "end": "1735000"
  },
  {
    "text": "let me show you how this goes this is envoy running and this is what",
    "start": "1731640",
    "end": "1741010"
  },
  {
    "start": "1735000",
    "end": "1755000"
  },
  {
    "text": "happens when you run example so this is",
    "start": "1741010",
    "end": "1749590"
  },
  {
    "text": "the example that we saw well I'll show you the example of a second after I make the font bigger but as you can see here",
    "start": "1749590",
    "end": "1758620"
  },
  {
    "text": "it's actually printing out the log lines for the different callbacks so on done",
    "start": "1758620",
    "end": "1764590"
  },
  {
    "text": "is when the stream is done on log is when the logs when it gets the on log",
    "start": "1764590",
    "end": "1770320"
  },
  {
    "text": "callback and on delete is when the context is deleted so we can see that you know there's those logs are coming",
    "start": "1770320",
    "end": "1777130"
  },
  {
    "text": "out and if you look over here you can see that we've added a new header called a new header now let's see what happens",
    "start": "1777130",
    "end": "1785380"
  },
  {
    "text": "when we modify the code sorry that this is so small alright so this again is one",
    "start": "1785380",
    "end": "1801760"
  },
  {
    "text": "of those contexts as you can see it has like on done on log on delete on request",
    "start": "1801760",
    "end": "1807610"
  },
  {
    "text": "headers right so in on request headers we're gonna well actually an on response",
    "start": "1807610",
    "end": "1816010"
  },
  {
    "text": "headers we're gonna modify the response header and so that's what I printed out before as you saw we added a new header called it's really hard to see I'm sorry",
    "start": "1816010",
    "end": "1823630"
  },
  {
    "text": "called a new header and the value is new header value and as you can see up top",
    "start": "1823630",
    "end": "1830100"
  },
  {
    "text": "well as you saw before when I printed it out it came back as new header value gonna just change it and I'll show you",
    "start": "1830100",
    "end": "1836360"
  },
  {
    "text": "what happens when you have to compile it so you can pilot its using the in scripting tool chain",
    "start": "1836360",
    "end": "1844550"
  },
  {
    "text": "so that's PM plus plus for the inscription C++ all this all the",
    "start": "1844550",
    "end": "1850280"
  },
  {
    "text": "additional parameters are coming out of that make file that I showed you before now we've just generated the new code",
    "start": "1850280",
    "end": "1855800"
  },
  {
    "text": "and if we run it again and now you can",
    "start": "1855800",
    "end": "1862790"
  },
  {
    "text": "see that we've changed the value is now set as new header value so we've compiled new code we've uploaded it into",
    "start": "1862790",
    "end": "1870350"
  },
  {
    "text": "envoy and we run it modified it and",
    "start": "1870350",
    "end": "1875360"
  },
  {
    "text": "change the value so and it's you know the make file is pretty pretty",
    "start": "1875360",
    "end": "1880370"
  },
  {
    "start": "1877000",
    "end": "1892000"
  },
  {
    "text": "straightforward it just refers to the make file in the API directory in this",
    "start": "1880370",
    "end": "1887000"
  },
  {
    "text": "case it's the lite version so there's two versions of the protocol I bury one of them files down to about 200k that's",
    "start": "1887000",
    "end": "1894170"
  },
  {
    "start": "1892000",
    "end": "1921000"
  },
  {
    "text": "the lite version the other one compiles to about two two and a half megabytes so you know if you need that support you",
    "start": "1894170",
    "end": "1901100"
  },
  {
    "text": "know and you really want to have it and you're willing to pay two two and a half megabytes for it then you can use the full protocol support but if you don't",
    "start": "1901100",
    "end": "1907430"
  },
  {
    "text": "need it the lite version is available to you you know I'll see if I can make",
    "start": "1907430",
    "end": "1914540"
  },
  {
    "text": "these things a little larger I don't",
    "start": "1914540",
    "end": "1920180"
  },
  {
    "text": "know yeah well we could do some questions now while I make a little larger if anybody has any",
    "start": "1920180",
    "end": "1930970"
  },
  {
    "start": "1921000",
    "end": "1941000"
  },
  {
    "text": "yeah",
    "start": "1932810",
    "end": "1935410"
  },
  {
    "text": "yeah I think it'll be something somewhere between you know 50 and 60% I think that's what what v8 and crane",
    "start": "1940950",
    "end": "1947830"
  },
  {
    "text": "lifts are running out right now yeah yeah so Wow em is different I would",
    "start": "1947830",
    "end": "1956679"
  },
  {
    "text": "expect that we'll have them you can pre compile it and he uses LLVM as the backend I would imagine that with you",
    "start": "1956679",
    "end": "1962230"
  },
  {
    "text": "know all the flags set you could probably get it to native if you wanted to go that route walking just to make",
    "start": "1962230",
    "end": "1972760"
  },
  {
    "text": "sure I understood right now you have to have the compiled file locally in the",
    "start": "1972760",
    "end": "1980440"
  },
  {
    "text": "file system or is it part of the configuration yeah it's right now you",
    "start": "1980440",
    "end": "1987190"
  },
  {
    "text": "specify the file name in the configuration but we're gonna we're gonna wire it into XTS so that's like",
    "start": "1987190",
    "end": "1993399"
  },
  {
    "text": "you know that's definitely happening soon somebody's you know assigned to that but we just haven't got it okay",
    "start": "1993399",
    "end": "2000299"
  },
  {
    "text": "done yet great and do you have time estimation for when it's gonna be in an official",
    "start": "2000299",
    "end": "2007200"
  },
  {
    "text": "and voy release it we thought like the code is in is sitting in the Android",
    "start": "2007200",
    "end": "2013169"
  },
  {
    "text": "proxy you know namespace it's in its own repo though because you know we're talking to everybody over there about up",
    "start": "2013169",
    "end": "2019620"
  },
  {
    "text": "streaming it but nobody wants to just take the code right I mean you could take the code but but the community",
    "start": "2019620",
    "end": "2027000"
  },
  {
    "text": "needs to agree that the code is structured correctly and the api's are the ones they want right and once they",
    "start": "2027000",
    "end": "2032700"
  },
  {
    "text": "agree like we're I'm gonna you know do everything that they want me to do to",
    "start": "2032700",
    "end": "2037799"
  },
  {
    "text": "get that thing up stream so I don't have a timeline it's really up to the community okay great thanks sure yeah",
    "start": "2037799",
    "end": "2047510"
  },
  {
    "start": "2048000",
    "end": "2214000"
  },
  {
    "text": "it depends so you know it spent some time with big your code is like v8 uses",
    "start": "2048500",
    "end": "2054510"
  },
  {
    "text": "about 2.5 megabytes per VM so if you have a lot of threads a lot of silos",
    "start": "2054510",
    "end": "2060750"
  },
  {
    "text": "then that you know it could add up most of that's just because you know you've got stacks in there you've got you know",
    "start": "2060750",
    "end": "2066388"
  },
  {
    "text": "a stack in there and you've got a heap in there and you can tune these things down right so if memory is really an",
    "start": "2066389",
    "end": "2071820"
  },
  {
    "text": "issue for you you can get and you know your memory usage like this is just the defaults you can tune it down or you",
    "start": "2071820",
    "end": "2078840"
  },
  {
    "text": "know tune it up if that works for you as well yeah",
    "start": "2078840",
    "end": "2086359"
  },
  {
    "text": "the yeah the only deaf in there is if you want to use the null sandbox because",
    "start": "2091980",
    "end": "2100140"
  },
  {
    "text": "the null sandbox is actually compiled in so wasm itself as a 32-bit standard right now",
    "start": "2100140",
    "end": "2105809"
  },
  {
    "text": "and the null sandbox is compiled into 64-bit envoy so you know there's a",
    "start": "2105809",
    "end": "2111029"
  },
  {
    "text": "difference there and in addition an envoy you know we have to be in the envoy namespaces there's like a big",
    "start": "2111029",
    "end": "2117420"
  },
  {
    "text": "block of namespace logic that has to go in around your code but other than that there are no changes so it's actually",
    "start": "2117420",
    "end": "2124160"
  },
  {
    "text": "pretty transparent yeah definitely",
    "start": "2124160",
    "end": "2130740"
  },
  {
    "text": "definitely I'd love to use that tool chain I've been playing around with it",
    "start": "2130740",
    "end": "2136849"
  },
  {
    "text": "you know as it progresses I really like to go that route yeah anybody else oh",
    "start": "2137059",
    "end": "2146700"
  },
  {
    "text": "yeah",
    "start": "2146700",
    "end": "2148940"
  },
  {
    "text": "no it compiles with both GCC and clang and it's uh it's actually so you can you",
    "start": "2152380",
    "end": "2159950"
  },
  {
    "text": "can decide to compile in any number of VM so you could compile in just v8 or",
    "start": "2159950",
    "end": "2165020"
  },
  {
    "text": "just wave them or you can compile them all in but but you can only select you",
    "start": "2165020",
    "end": "2170660"
  },
  {
    "text": "know one obviously it's been compiled in but that's the only constraint yeah and",
    "start": "2170660",
    "end": "2178610"
  },
  {
    "text": "if you compile into v8 it takes a you know takes a lot longer to build initially because it has to download and",
    "start": "2178610",
    "end": "2184760"
  },
  {
    "text": "build all of v8 which takes like 10 minutes on a 32 core machine yeah cuz",
    "start": "2184760",
    "end": "2191120"
  },
  {
    "text": "it's big you know but but Wow them's a lot smaller so but that requires LVM",
    "start": "2191120",
    "end": "2197270"
  },
  {
    "text": "which itself is quite large so yeah some trade-offs any other questions okay all",
    "start": "2197270",
    "end": "2210560"
  },
  {
    "text": "right okay well thank you very much [Applause] [Music] [Applause]",
    "start": "2210560",
    "end": "2216559"
  }
]