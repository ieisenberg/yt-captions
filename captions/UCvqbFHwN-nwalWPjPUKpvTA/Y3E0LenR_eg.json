[
  {
    "text": "okay [Music] um thank you guys for coming in today um",
    "start": "280",
    "end": "6520"
  },
  {
    "text": "we're really excited to talk about acending way gu to customer tension with way so before we get started I'd like to",
    "start": "6520",
    "end": "14360"
  },
  {
    "text": "know how many of you have heard about W way before session can you show your",
    "start": "14360",
    "end": "20840"
  },
  {
    "text": "hand okay a couple them and how many of you have actually use it in development or testing",
    "start": "20840",
    "end": "30279"
  },
  {
    "text": "okay and anyone uniting production okay um hope I can somebody",
    "start": "30800",
    "end": "39719"
  },
  {
    "text": "to try out okay session um I'm from I'm",
    "start": "39719",
    "end": "46879"
  },
  {
    "text": "maintainer and I'm guy D from sap also an advocate PR maintainer okay let's jump",
    "start": "46879",
    "end": "53800"
  },
  {
    "text": "in so let's kick out with some background of g f um s have there a",
    "start": "54039",
    "end": "61280"
  },
  {
    "text": "upgrade of the old inish API and we know that um Ingress Ki the the in F has",
    "start": "61280",
    "end": "69920"
  },
  {
    "text": "limited feature in terms of the traffic management for your gateway I think it",
    "start": "69920",
    "end": "75159"
  },
  {
    "text": "may cover like 50% of what you really lead for gway but for the other 50%",
    "start": "75159",
    "end": "81479"
  },
  {
    "text": "maybe some unstructured annotation so you know how M and uh how to maintain it",
    "start": "81479",
    "end": "87880"
  },
  {
    "text": "can get but if you upgrade to gway you get a much larer set of feature like uh",
    "start": "87880",
    "end": "94119"
  },
  {
    "text": "you can load traffic based on um at pass and header host even quare parameter and",
    "start": "94119",
    "end": "104240"
  },
  {
    "text": "you get some Advanced feature like uh traffic splitting request Direction and",
    "start": "104240",
    "end": "110680"
  },
  {
    "text": "header manip manipulation all this featur PR only available uh with uh",
    "start": "110680",
    "end": "117520"
  },
  {
    "text": "annotation now can be directly handled by by the G API itself but uh we know that any",
    "start": "117520",
    "end": "126240"
  },
  {
    "text": "standard no matter how it's defined It ultimately ends up being just a lan",
    "start": "126240",
    "end": "132720"
  },
  {
    "text": "common Eliminator of all information and G API at low exception but what I",
    "start": "132720",
    "end": "138200"
  },
  {
    "text": "personally love about G is that it's it's Innovation allowing you to acting",
    "start": "138200",
    "end": "145440"
  },
  {
    "text": "it core AP with a very well defined struction manner so for example you can",
    "start": "145440",
    "end": "153360"
  },
  {
    "text": "Define your own Poli policy Uh custom policy like for security maybe you add",
    "start": "153360",
    "end": "158920"
  },
  {
    "text": "some authenication or authorization um policy but you can attach that policy um",
    "start": "158920",
    "end": "167519"
  },
  {
    "text": "to the cor API without mod modify the core API itself it's mucher than",
    "start": "167519",
    "end": "174720"
  },
  {
    "text": "annotation also custom filters and custom back Buon Etc",
    "start": "174720",
    "end": "181720"
  },
  {
    "text": "and uh gway it's uh actually it's a fully compatible of gway",
    "start": "182080",
    "end": "188519"
  },
  {
    "text": "implementation um it's a controller for managing deploying configuring the only",
    "start": "188519",
    "end": "195000"
  },
  {
    "text": "way as a AP gway so it does all the heavy lifting it can handle traffic for",
    "start": "195000",
    "end": "200760"
  },
  {
    "text": "both CES and we based workloads um it does stop at GPI it uh",
    "start": "200760",
    "end": "208760"
  },
  {
    "text": "also introduce some Advanced featur so you can think about it like a superet of",
    "start": "208760",
    "end": "216319"
  },
  {
    "text": "gway for example it has the CL traffic policy which can help you conf config",
    "start": "216319",
    "end": "222239"
  },
  {
    "text": "The Collection between client and and back traffic policy for the",
    "start": "222239",
    "end": "227799"
  },
  {
    "text": "configuration between and back service and a security policy for the IDC G GW",
    "start": "227799",
    "end": "235319"
  },
  {
    "text": "authentication and IP white list course and Etc and PCH policy and extension",
    "start": "235319",
    "end": "244280"
  },
  {
    "text": "policy um uh in case you want to out your own extension and um go beyond its",
    "start": "244280",
    "end": "252079"
  },
  {
    "text": "default feature and and also you can it has own custom ATP R Fator and uh backend to ro",
    "start": "252079",
    "end": "260040"
  },
  {
    "text": "traffic uh outside of theate",
    "start": "260040",
    "end": "264000"
  },
  {
    "text": "cluster um today we want to talk about exension policy uh it's type of gway gway API um Poli",
    "start": "265560",
    "end": "274440"
  },
  {
    "text": "attachment that allows you to load custom tension into way to inject your",
    "start": "274440",
    "end": "280759"
  },
  {
    "text": "own custom Logic for request response processing is supposed two type of",
    "start": "280759",
    "end": "286039"
  },
  {
    "text": "extension Wason an exal process and we are looking for the same more in future",
    "start": "286039",
    "end": "291120"
  },
  {
    "text": "like laa and damic module uh it's very flexible in terms of",
    "start": "291120",
    "end": "296360"
  },
  {
    "text": "configuration U it's supposed to attach uh a policy on both the Gateway and lo if",
    "start": "296360",
    "end": "304479"
  },
  {
    "text": "Target on Gateway it will be automatically applied to all the HP Lo under that gway and you are not un limited to only",
    "start": "304479",
    "end": "312720"
  },
  {
    "text": "one extension part policy you can actually Define multiple extension for example in this uh configuration we",
    "start": "312720",
    "end": "319720"
  },
  {
    "text": "defend two uh was extension and another ex process exension uh to handle",
    "start": "319720",
    "end": "325080"
  },
  {
    "text": "different tasks within one policy and you can also control precisely how the",
    "start": "325080",
    "end": "332400"
  },
  {
    "text": "uh how tension are applied in the f chain by the prox resource for example",
    "start": "332400",
    "end": "339000"
  },
  {
    "text": "we move the ex process after rate limiting probably because uh we have",
    "start": "339000",
    "end": "345000"
  },
  {
    "text": "some very heav processing in the exra process we don't we don't want to waste our CP time on some unnecessary",
    "start": "345000",
    "end": "354680"
  },
  {
    "text": "request um was extension with support like a uh o image at the remote Wason",
    "start": "356560",
    "end": "363600"
  },
  {
    "text": "code source which means you can package your Wason module as an O image and put",
    "start": "363600",
    "end": "369880"
  },
  {
    "text": "it to O registry and uh just use a tag within theing policy uh it brings some",
    "start": "369880",
    "end": "377599"
  },
  {
    "text": "benefits for example you you can use a tar of O image to manage the version of your what module so uh you can easily",
    "start": "377599",
    "end": "386240"
  },
  {
    "text": "roll out roll back or test a new version of your was module if you have any sensitive data inside",
    "start": "386240",
    "end": "394240"
  },
  {
    "text": "was module you can uh use a private image U which means only the user who",
    "start": "394240",
    "end": "400759"
  },
  {
    "text": "have the right access uh can uh can putas this was module and uh use it in",
    "start": "400759",
    "end": "405960"
  },
  {
    "text": "your inv way we also we can use the existing tool set of the oide EOS system",
    "start": "405960",
    "end": "413160"
  },
  {
    "text": "to manage distribute uh the was module her uh some example of the",
    "start": "413160",
    "end": "421560"
  },
  {
    "text": "extension policy with was extension um on the left side it's also",
    "start": "421560",
    "end": "427560"
  },
  {
    "text": "image U the first one is the Public Image basically you only need to um",
    "start": "427560",
    "end": "433840"
  },
  {
    "text": "specify the URL of the what module uh within your policy the second one is the",
    "start": "433840",
    "end": "440240"
  },
  {
    "text": "private image um so you also need to uh specify the length of the Ku secret",
    "start": "440240",
    "end": "447240"
  },
  {
    "text": "which store the quential for your priority image um the right one is the ATP wasn't",
    "start": "447240",
    "end": "454720"
  },
  {
    "text": "source so only need the URL for was",
    "start": "454720",
    "end": "460919"
  },
  {
    "text": "module thanks foring so besides wasm which is a pretty wellknown extensibility mechanism in Envoy Envoy",
    "start": "462919",
    "end": "469800"
  },
  {
    "text": "Gateway also supports the external processing filter Which is less known um this filter is also capable of",
    "start": "469800",
    "end": "476120"
  },
  {
    "text": "inspecting and mutating HTTP requests and responses um and it does so by um registering an",
    "start": "476120",
    "end": "483400"
  },
  {
    "text": "external call out to an external grpc service that is responsible for this functionality now this service can be",
    "start": "483400",
    "end": "489120"
  },
  {
    "text": "registered to uh the relevant life cycle hooks of the stream so for example request headers or response body Etc and",
    "start": "489120",
    "end": "496960"
  },
  {
    "text": "the protocol between Envoy proxy and the external processor is actually quite simple Envoy proxy generates a",
    "start": "496960",
    "end": "502879"
  },
  {
    "text": "processing request that typically contains the relevant portion of the stream so for example request headers",
    "start": "502879",
    "end": "508360"
  },
  {
    "text": "and then uh this is send to the external processor which uh needs to return a processing response where this response",
    "start": "508360",
    "end": "514279"
  },
  {
    "text": "would typically contain something like a mutation so for example adding or moving or changing headers or the body itself",
    "start": "514279",
    "end": "521440"
  },
  {
    "text": "or even possibly an immediate response if we want to for example block a certain",
    "start": "521440",
    "end": "526640"
  },
  {
    "text": "request Now using an outof process extension obviously creates um some new",
    "start": "526640",
    "end": "532440"
  },
  {
    "text": "considerations and challenges right so uh for example for security we now have to authenticate this external extension",
    "start": "532440",
    "end": "538640"
  },
  {
    "text": "we maybe want to ensure that the data is transmitted in a confidential manner right for resilience uh there's now",
    "start": "538640",
    "end": "545040"
  },
  {
    "text": "Network between Envoy and this external extension so uh some instability can occur due to network hiccups um this",
    "start": "545040",
    "end": "551680"
  },
  {
    "text": "extension has a decoupled life cycle from Envoy so maybe it's unavailable at some point in time and an cannot reach",
    "start": "551680",
    "end": "557360"
  },
  {
    "text": "it right so we have to take care of all sorts of uh resilience related aspects here and also uh notably performance",
    "start": "557360",
    "end": "564920"
  },
  {
    "text": "right so if previously uh extension would run in process now we have an of process extension with some network",
    "start": "564920",
    "end": "571640"
  },
  {
    "text": "communication um that adds additional latency and possibly even other things like additional marshalling and",
    "start": "571640",
    "end": "577040"
  },
  {
    "text": "unmarshalling that's happening and uh encryption now to mitigate some of these",
    "start": "577040",
    "end": "582519"
  },
  {
    "text": "uh concerns and to help with some of these uh things Anway offers a lot of advanced configuration options um so for",
    "start": "582519",
    "end": "588880"
  },
  {
    "text": "example for security we can establish mtls between Envoy proxy and this",
    "start": "588880",
    "end": "594040"
  },
  {
    "text": "external processor for resilience we can uh leverage Envoy gateways uh extended",
    "start": "594040",
    "end": "599399"
  },
  {
    "text": "back and draft to specify all sorts of Behavior Uh with regards to the connection pool from Envoy to the",
    "start": "599399",
    "end": "605480"
  },
  {
    "text": "external processor so setting up health checks failover circuit breakers timeouts whatever we need to uh tailor",
    "start": "605480",
    "end": "612600"
  },
  {
    "text": "our solution to be a a more resilient architecture and finally for performance anval Gateway makes it possible to",
    "start": "612600",
    "end": "618720"
  },
  {
    "text": "integrate an external processor using Unix the main sockets and not just TCP sockets that uh opens up a path to",
    "start": "618720",
    "end": "626399"
  },
  {
    "text": "reduce the latency and to some degree uh reduce the performance impact of using an outof process extension so here we",
    "start": "626399",
    "end": "634279"
  },
  {
    "text": "can see an example of uh such a advanced deployment pattern so um you can see that we have a backend resource of anvo",
    "start": "634279",
    "end": "641880"
  },
  {
    "text": "Gateway that has an endpoint which is not uh fully qualified domain name or an IP or a kubernetes service rather it is",
    "start": "641880",
    "end": "647959"
  },
  {
    "text": "a path to a Unix domain socket that it would use to communicate with this external processor we have the envoy",
    "start": "647959",
    "end": "653160"
  },
  {
    "text": "extension policy that binds this external processing um uh service um to",
    "start": "653160",
    "end": "658839"
  },
  {
    "text": "an H GP route but also configures various backend settings so for example here we have active grpc health checks",
    "start": "658839",
    "end": "665320"
  },
  {
    "text": "and circuit breakers and timeouts um we have the backend TLS policy that attaches to the backend and essentially",
    "start": "665320",
    "end": "672440"
  },
  {
    "text": "instructs Envoy to always use TLS when communicating with this particular back end and we also have the envoy proxy",
    "start": "672440",
    "end": "678600"
  },
  {
    "text": "resource here that uh defines a client certificate that Envoy proxy should use to authenticate itself towards the",
    "start": "678600",
    "end": "684839"
  },
  {
    "text": "external processor uh thereby creating essentially an mtls connection",
    "start": "684839",
    "end": "691240"
  },
  {
    "text": "so as we discuss we support two type of extension was and actal process um",
    "start": "693639",
    "end": "699760"
  },
  {
    "text": "picking the right one really depends on your user case so let's go over a few cases to think",
    "start": "699760",
    "end": "705320"
  },
  {
    "text": "about F performance is a high priority and we probably go to Wason because they",
    "start": "705320",
    "end": "711440"
  },
  {
    "text": "run directly with way which reduce orad um in contrast aoral process",
    "start": "711440",
    "end": "717839"
  },
  {
    "text": "because they rely on network communication so which can add a little bit of lessen but as guy um introduced",
    "start": "717839",
    "end": "726279"
  },
  {
    "text": "we can use like U set car deployment to reduce this uh",
    "start": "726279",
    "end": "733199"
  },
  {
    "text": "latency when it come to functionality um was because they La in Senter box so",
    "start": "733199",
    "end": "740040"
  },
  {
    "text": "which uh only have access to the resource and API exposed by the C",
    "start": "740040",
    "end": "746720"
  },
  {
    "text": "box that's that's its limitation and however exal process extension they",
    "start": "746720",
    "end": "752399"
  },
  {
    "text": "can be Rel in any language and have full access to any actal uh the all o",
    "start": "752399",
    "end": "760920"
  },
  {
    "text": "World um for deployment was exension uh is very convenient so you just need get",
    "start": "761000",
    "end": "768519"
  },
  {
    "text": "to dynamically load them from registry or it server so that's that's it an ex",
    "start": "768519",
    "end": "776880"
  },
  {
    "text": "process tension and in additional to our uh ex policy you also need to deploy",
    "start": "776880",
    "end": "783639"
  },
  {
    "text": "them and allocate resource for them so which is a little bit complex to the",
    "start": "783639",
    "end": "791240"
  },
  {
    "text": "deployment security is very important um wasn't LA with way so which means any",
    "start": "791240",
    "end": "797959"
  },
  {
    "text": "bugs any issues could potentially impact in stability ex process extension they they",
    "start": "797959",
    "end": "805959"
  },
  {
    "text": "are in the separate process so if something goes wrong as want directly",
    "start": "805959",
    "end": "811120"
  },
  {
    "text": "of operation lastly",
    "start": "811120",
    "end": "816560"
  },
  {
    "text": "scalability was exension they are ti to only instance so they can only scale",
    "start": "816560",
    "end": "822360"
  },
  {
    "text": "together together with instance and and they will share the resource with way and act process",
    "start": "822360",
    "end": "829720"
  },
  {
    "text": "exension they can scale independently and they can be allocated Resource as",
    "start": "829720",
    "end": "837320"
  },
  {
    "text": "needed so at the end of the day it really depends on what you need whether",
    "start": "837600",
    "end": "842759"
  },
  {
    "text": "it's uh uh performance and simplicity or uh flexibility and access to the exter",
    "start": "842759",
    "end": "849839"
  },
  {
    "text": "world I hope this BL down help you decide which option is best for your use case",
    "start": "849839",
    "end": "856880"
  },
  {
    "text": "okay thanks foring so for this talk we wanted to present a project from the llm",
    "start": "856880",
    "end": "863920"
  },
  {
    "text": "space that's leveraging un Gateway extensions um it's called the kubernetes llm instance Gateway but before we dive",
    "start": "863920",
    "end": "869759"
  },
  {
    "text": "into that maybe just a bit of background on the topic so as many of you are probably aware llms can be tuned to",
    "start": "869759",
    "end": "875480"
  },
  {
    "text": "perform certain tasks better right and one of the popular tuning techniques is called Lower end adaptation or Laura now",
    "start": "875480",
    "end": "883320"
  },
  {
    "text": "the nice thing about Laura is that it makes it possible for us to take a certain base model load several Laura",
    "start": "883320",
    "end": "889639"
  },
  {
    "text": "adapters together with this base model within a single llm server and then essentially have a server that is tuned",
    "start": "889639",
    "end": "896839"
  },
  {
    "text": "to perform various tasks now this is very advantageous for operators and",
    "start": "896839",
    "end": "901959"
  },
  {
    "text": "providers of llm because it helps us really reduce cost and um manage our resources much better uh as opposed to",
    "start": "901959",
    "end": "908320"
  },
  {
    "text": "having a fleet of servers where each server can only be tuned to perform one specific task uh as is the case with",
    "start": "908320",
    "end": "914880"
  },
  {
    "text": "other tuning techniques um so this is great for llm operators but there are",
    "start": "914880",
    "end": "920160"
  },
  {
    "text": "still some limitations uh namely these uh adapters also consume some resources",
    "start": "920160",
    "end": "925320"
  },
  {
    "text": "and so there's a limit to the amount of adapters that can actually run concurrently within a single llm server",
    "start": "925320",
    "end": "932160"
  },
  {
    "text": "and this creates a certain challenge for us because um if a server receives a request that requires a certain adapter",
    "start": "932160",
    "end": "939480"
  },
  {
    "text": "and this adapter is currently not loaded and the server already reached its maximum capacity of loaded adapters this",
    "start": "939480",
    "end": "946600"
  },
  {
    "text": "request would essentially cue until we can swap out one of the currently running adapters and swap in this uh",
    "start": "946600",
    "end": "952680"
  },
  {
    "text": "necessary dis required adapter and um this can actually create a significant",
    "start": "952680",
    "end": "957759"
  },
  {
    "text": "delay until this request is processed and so we understand that when we're",
    "start": "957759",
    "end": "963079"
  },
  {
    "text": "using something like a generic round robin kind of load balancing algorithm",
    "start": "963079",
    "end": "968639"
  },
  {
    "text": "uh there's really nothing that would stop this sort of thing from happening right requests are just um you know load",
    "start": "968639",
    "end": "973720"
  },
  {
    "text": "balanced at random and it's possible that a request would reach a pod that is not the most optimal pod not the most uh",
    "start": "973720",
    "end": "980800"
  },
  {
    "text": "best suited pod to handle this request and so to handle this Challenge and to",
    "start": "980800",
    "end": "986880"
  },
  {
    "text": "to solve this issue the kuity serving working group that is focused on on llm on kubernetes together with the Gateway",
    "start": "986880",
    "end": "993120"
  },
  {
    "text": "API working group got together and proposed a solution that's based on uh gateways and Gateway extensions the idea",
    "start": "993120",
    "end": "999680"
  },
  {
    "text": "here is basically that gateways have a very comprehensive view of the entire system and so they can know and keep",
    "start": "999680",
    "end": "1006160"
  },
  {
    "text": "track of the state of each and every llm uh server pod that is running within our",
    "start": "1006160",
    "end": "1011839"
  },
  {
    "text": "cluster and so the Gateway can know um which adapters are running in each and every llm instance and what is the cas",
    "start": "1011839",
    "end": "1019120"
  },
  {
    "text": "cach utilization uh what is the size of the queue for each and every adapter and basically use this information to make",
    "start": "1019120",
    "end": "1025839"
  },
  {
    "text": "uh an educated uh decision an educated load balancing decision and decide where",
    "start": "1025839",
    "end": "1031360"
  },
  {
    "text": "a request based on the adapter that it needs should be uh routed to improve",
    "start": "1031360",
    "end": "1036520"
  },
  {
    "text": "performance latency and so on and uh the team that built the solution uh was able to demonstrate a significant uh uh",
    "start": "1036520",
    "end": "1043038"
  },
  {
    "text": "increase in throughput and a reduction in latency uh by just using this uh",
    "start": "1043039",
    "end": "1048360"
  },
  {
    "text": "Laura aware load balancing strategy as opposed to just using U round robin uh",
    "start": "1048360",
    "end": "1054160"
  },
  {
    "text": "simple kind of uh load balancing strategy and so the way that this solution was built is uh by leveraging",
    "start": "1054160",
    "end": "1061640"
  },
  {
    "text": "anva Gateway and Ana Gateway extensions so um the team that was responsible for this uh project uh built a new component",
    "start": "1061640",
    "end": "1069360"
  },
  {
    "text": "let's call it D llm schedul and this component has two main responsibilities first of all it keeps track of all of",
    "start": "1069360",
    "end": "1076240"
  },
  {
    "text": "the uh metrics of all of the V L pods in our cluster so basically this component",
    "start": "1076240",
    "end": "1082840"
  },
  {
    "text": "knows which Laura adapters are currently running in uh which llm pod it knows",
    "start": "1082840",
    "end": "1088840"
  },
  {
    "text": "what is the resource utilization it knows what are the Q sizes and so um",
    "start": "1088840",
    "end": "1094720"
  },
  {
    "text": "with this metrix we can perform our second responsibility which is to act as an external processing service that when",
    "start": "1094720",
    "end": "1101320"
  },
  {
    "text": "a request comes in uh as part of the processing this llm Schuler essentially",
    "start": "1101320",
    "end": "1106600"
  },
  {
    "text": "decides on what is the most most optimal pod to handle a request by analyzing uh",
    "start": "1106600",
    "end": "1112960"
  },
  {
    "text": "the request body identifying the required adapter and then uh based on the Matrix that we have uh finding the",
    "start": "1112960",
    "end": "1119520"
  },
  {
    "text": "Pod that is best suited to handle this request and then uh the processor would return this information to Envoy using",
    "start": "1119520",
    "end": "1126320"
  },
  {
    "text": "uh a header mutation and envoy can use this uh pod IP to uh basically route to",
    "start": "1126320",
    "end": "1132559"
  },
  {
    "text": "this most optimal po so before diving into the demo I just wanted to thank the",
    "start": "1132559",
    "end": "1138080"
  },
  {
    "text": "uh um serving working group uh for their collaboration on this presentation and",
    "start": "1138080",
    "end": "1143400"
  },
  {
    "text": "if you're interested in this then you can follow the links on uh here on the slide and also the uh team is having a",
    "start": "1143400",
    "end": "1149320"
  },
  {
    "text": "talk this week in cucon so you should go and check that out and if you are generally interested in the topic of AI",
    "start": "1149320",
    "end": "1156080"
  },
  {
    "text": "in Envoy Gateway we have a new slack channel for that so please join and let's try to build a community around",
    "start": "1156080",
    "end": "1161520"
  },
  {
    "text": "that and also there is another talk this week um also on the topic of using anva",
    "start": "1161520",
    "end": "1166840"
  },
  {
    "text": "Gateway for AI use cases also very interesting so you should also go and check that out if that's interesting for",
    "start": "1166840",
    "end": "1172400"
  },
  {
    "text": "you and the demo itself is quite simple uh we will quickly go over some manifests and uh really run through the",
    "start": "1172400",
    "end": "1180360"
  },
  {
    "text": "implementation of the processing server and finally uh basically demonstrate a very simple uh Laura aware load",
    "start": "1180360",
    "end": "1186640"
  },
  {
    "text": "balancing algorithm uh that routes uh requests to the Pod that is best suited to handle them so we start out by",
    "start": "1186640",
    "end": "1193600"
  },
  {
    "text": "basically deploying uh uh a deployment of the VM open source which is an open source llm server um it's running on",
    "start": "1193600",
    "end": "1200919"
  },
  {
    "text": "appropriate hardware and you can see that we're using the meta Lama model as our base model and we're using Laura",
    "start": "1200919",
    "end": "1207240"
  },
  {
    "text": "lowen adaptation uh as our tuning technique and we're enabling two uh sorts of adapters one for summarizing",
    "start": "1207240",
    "end": "1213400"
  },
  {
    "text": "tweets and the other one for uh uh SQL our external processor is also yet another deployment in the cluster uh",
    "start": "1213400",
    "end": "1220520"
  },
  {
    "text": "exposed by cluster IP service um and the uh we are using here",
    "start": "1220520",
    "end": "1226120"
  },
  {
    "text": "an uh original destination cluster that that uh we were patching the configuration to basically turn the uh",
    "start": "1226120",
    "end": "1232200"
  },
  {
    "text": "uh back end uh into an original destination cluster that allows us to route to uh the target pod based on a",
    "start": "1232200",
    "end": "1238840"
  },
  {
    "text": "header this is a part with the external processor which is basically just a deployment in the cluster and an Envoy extension policy that attaches to it um",
    "start": "1238840",
    "end": "1247320"
  },
  {
    "text": "attaches it to an HTP route and we're basically defining some behaviors here so for example the body is completely",
    "start": "1247320",
    "end": "1252640"
  },
  {
    "text": "buffered before it is being sent over to the um external processor and um yeah",
    "start": "1252640",
    "end": "1258600"
  },
  {
    "text": "when we want to implement um uh an external processor the easiest way to go about this is to use uh some of these",
    "start": "1258600",
    "end": "1265159"
  },
  {
    "text": "libraries from the go control plane this grpc interface uh we can register this uh grpc server uh within our go uh",
    "start": "1265159",
    "end": "1272279"
  },
  {
    "text": "solution and then we basically need to implement the main method of this uh interface which is the process method uh",
    "start": "1272279",
    "end": "1279640"
  },
  {
    "text": "the process method we are receiving processing requests for Envoy and we have to first of all distinguish between",
    "start": "1279640",
    "end": "1285440"
  },
  {
    "text": "the source of requests so whether we received headers or a body of the request or the response and then handle",
    "start": "1285440",
    "end": "1290760"
  },
  {
    "text": "them accordingly uh by basically performing our logic and generating a response so if we dive into the handle",
    "start": "1290760",
    "end": "1298400"
  },
  {
    "text": "body request which is the most interesting part for this uh particular uh open source uh we can see that we",
    "start": "1298400",
    "end": "1304320"
  },
  {
    "text": "start out by uh unmarshaling the body that has been buffered so we have it completely and extracting from the body",
    "start": "1304320",
    "end": "1311960"
  },
  {
    "text": "uh a specific attribute called Model this is basically the attribute that tells us uh which adapter is required",
    "start": "1311960",
    "end": "1317480"
  },
  {
    "text": "for this particular ele request and then we can use this model as an input to our scheduling algorithm that would",
    "start": "1317480",
    "end": "1324120"
  },
  {
    "text": "determine the IP of the Pod that is best suited to handle this particular request",
    "start": "1324120",
    "end": "1330520"
  },
  {
    "text": "and so um now that we have that at hand we can generate a header mutation response",
    "start": "1330520",
    "end": "1337000"
  },
  {
    "text": "this response essentially uh is a processing response as as we know is the interface between Envoy in the external",
    "start": "1337000",
    "end": "1343120"
  },
  {
    "text": "processor and we're uh doing a header mutation we're adding a new header to the request on its way up out uh and",
    "start": "1343120",
    "end": "1349720"
  },
  {
    "text": "this header is called the target pod header and it contains the IP of the Pod that is best suited for handling this",
    "start": "1349720",
    "end": "1355320"
  },
  {
    "text": "request now in order to be able to make these decisions uh we are constantly",
    "start": "1355320",
    "end": "1360760"
  },
  {
    "text": "scraping behind the scenes uh metrics from the VM pods uh metrics such as uh",
    "start": "1360760",
    "end": "1367159"
  },
  {
    "text": "which adapters are currently loaded what is the cache utilization in each and every uh pod and uh what are the Q sizes",
    "start": "1367159",
    "end": "1374880"
  },
  {
    "text": "and then based on these metrics we can uh essentially build uh a set of filters that would",
    "start": "1374880",
    "end": "1381919"
  },
  {
    "text": "determine the most optimal pod for uh our purposes so we have filters like uh",
    "start": "1381919",
    "end": "1388279"
  },
  {
    "text": "least KV cache lowest Lowa adapter uh and and so on and that basically helps us select the best pod so in our cluster",
    "start": "1388279",
    "end": "1396200"
  },
  {
    "text": "we have two instances of the VM open source and if we have a quick look at the debug logs of our external processor",
    "start": "1396200",
    "end": "1401840"
  },
  {
    "text": "we can see that each of these pods currently has a different adapter running within it one has SQL and the",
    "start": "1401840",
    "end": "1406880"
  },
  {
    "text": "other tweet summary and now if we make a request using the Tweet summary model uh",
    "start": "1406880",
    "end": "1412120"
  },
  {
    "text": "we we get a response which is already great but besides that you can see that behind the scenes our uh algorithm",
    "start": "1412120",
    "end": "1417960"
  },
  {
    "text": "essentially filtered out the Pod that did not have that adapter loaded and selected the Pod that had that adapter",
    "start": "1417960",
    "end": "1423799"
  },
  {
    "text": "loaded which is what we wanted to achieve this sort of affinity to the pods that have the necessary uh adapters",
    "start": "1423799",
    "end": "1429960"
  },
  {
    "text": "and now if we make a request the same request really but just change the model that we're using to the SQL model we",
    "start": "1429960",
    "end": "1435720"
  },
  {
    "text": "also get a response you can actually see that the responses are a bit different because these are differently tuned models but um the behavior of the",
    "start": "1435720",
    "end": "1443640"
  },
  {
    "text": "external processing service is quite the same we're selecting the Pod that already has the necessary adapter loaded",
    "start": "1443640",
    "end": "1449640"
  },
  {
    "text": "and now if we'll just run um a batch of requests to both of these uh different models and inspect the traffic we",
    "start": "1449640",
    "end": "1456840"
  },
  {
    "text": "basically expect the this thing to to persist to continue uh behaving this way",
    "start": "1456840",
    "end": "1461960"
  },
  {
    "text": "so if we look at the metric we can see that we have two PODS of the llm each of them has a different adapter currently",
    "start": "1461960",
    "end": "1467840"
  },
  {
    "text": "loaded and as the request and traffic comes in this does not change this basically means that requests for tweet",
    "start": "1467840",
    "end": "1474240"
  },
  {
    "text": "summary went to the Pod that had the Tweet summary adapter loaded and requests for uh the SQL model went to",
    "start": "1474240",
    "end": "1480200"
  },
  {
    "text": "the Pod that had the SQL model loaded and this essentially achieves this uh",
    "start": "1480200",
    "end": "1485440"
  },
  {
    "text": "Affinity this sort of Laura aware load balancing where requests are not just sent out kind of 50/50 between the pods",
    "start": "1485440",
    "end": "1492880"
  },
  {
    "text": "but rather they are sent out to the Pod that has uh the best state in terms of of Laura to to handle these",
    "start": "1492880",
    "end": "1500480"
  },
  {
    "text": "requests so I think that pretty much covers what we wanted to talk about um",
    "start": "1500480",
    "end": "1505799"
  },
  {
    "text": "if you're interested in getting involved in AV gateway then here are some links this is the QR for our uh session",
    "start": "1505799",
    "end": "1511039"
  },
  {
    "text": "feedback and do we have time for questions I don't know we do questions",
    "start": "1511039",
    "end": "1516159"
  },
  {
    "text": "please yes",
    "start": "1516159",
    "end": "1520159"
  },
  {
    "text": "so using what so the question was maybe the question was um that this is like a very complex load balancing uh uh",
    "start": "1532320",
    "end": "1541320"
  },
  {
    "text": "algorithm so I'm not like familiar with the specific uh feature that you're referring to but I think that since this",
    "start": "1551039",
    "end": "1557240"
  },
  {
    "text": "is requires like a very intimate knowledge of which is like very domain specific right you have to know things",
    "start": "1557240",
    "end": "1563120"
  },
  {
    "text": "about llm to make these decisions it kind of uh feels um out of scope for like core Envoy to",
    "start": "1563120",
    "end": "1570600"
  },
  {
    "text": "support that sort of thing right and and this is why and this is an interesting use case for extensibility in my view because typically use extensibility for",
    "start": "1570600",
    "end": "1577080"
  },
  {
    "text": "like security maybe like transforming requests and responses but this actually shows that you can use extensibility",
    "start": "1577080",
    "end": "1582440"
  },
  {
    "text": "even for um load balancing and scheduling which is pretty cool yeah other questions",
    "start": "1582440",
    "end": "1590159"
  },
  {
    "text": "yes so this is actually a project that was built by um a group that is not",
    "start": "1609600",
    "end": "1614840"
  },
  {
    "text": "really a part of like the envoy Community necessarily right so uh um but we have a bunch of aners with us here",
    "start": "1614840",
    "end": "1620919"
  },
  {
    "text": "that maybe can help us uh yeah answer that question um yeah I guess so right I",
    "start": "1620919",
    "end": "1626480"
  },
  {
    "text": "mean you do see in various applications like performance aware load balancing uh",
    "start": "1626480",
    "end": "1632080"
  },
  {
    "text": "I think that maybe like rtt aware load balancing is something that's like generic enough to be part of envoy",
    "start": "1632080",
    "end": "1637799"
  },
  {
    "text": "perhaps uh I'm not sure that this sort of um super domain specific um uh",
    "start": "1637799",
    "end": "1643399"
  },
  {
    "text": "performance overload balancing would uh necessarily make sense an Envoy but uh um but this is again an extension that",
    "start": "1643399",
    "end": "1651520"
  },
  {
    "text": "you can develop today for your use case with anvo Gateway any other",
    "start": "1651520",
    "end": "1657360"
  },
  {
    "text": "questions",
    "start": "1657360",
    "end": "1660360"
  },
  {
    "text": "yes so I I think um we maybe talk about this more but I think system calls right",
    "start": "1676880",
    "end": "1682840"
  },
  {
    "text": "and some libraries yeah basically you sorry the question was um um why can't",
    "start": "1682840",
    "end": "1688919"
  },
  {
    "text": "we for example Implement something like this with wasen as opposed to XPR because you are limited by the s box if",
    "start": "1688919",
    "end": "1696320"
  },
  {
    "text": "you was and you you're limited by the iing proxy Wason fgi basically you can",
    "start": "1696320",
    "end": "1702000"
  },
  {
    "text": "access some atps uh make some ATP call and you can",
    "start": "1702000",
    "end": "1707120"
  },
  {
    "text": "get it some reest header from the pass to it but if you want to access some um",
    "start": "1707120",
    "end": "1715600"
  },
  {
    "text": "amatory protocol like radius or something natively you can do that but",
    "start": "1715600",
    "end": "1720760"
  },
  {
    "text": "uh you're learning if you are using like exteral process you can do everything you want so that's the I think main",
    "start": "1720760",
    "end": "1727640"
  },
  {
    "text": "difference between them yeah yeah and I think also one of the previous talks really mentioned something like this",
    "start": "1727640",
    "end": "1732880"
  },
  {
    "text": "they started out with wasm and go and then for example um uh they realize that",
    "start": "1732880",
    "end": "1738159"
  },
  {
    "text": "that uh uh some of the tiny tiny go does not support some of the like core libraries and and Things become pretty",
    "start": "1738159",
    "end": "1744279"
  },
  {
    "text": "hard and uh yeah here you have the full flexibility to implement your extension as you see fit in whatever technology",
    "start": "1744279",
    "end": "1750480"
  },
  {
    "text": "you see fit yeah any other questions yes than for",
    "start": "1750480",
    "end": "1758000"
  },
  {
    "text": "theing the performance and",
    "start": "1758000",
    "end": "1764279"
  },
  {
    "text": "actually because I mostly work on the control plan side so from what I know I",
    "start": "1777760",
    "end": "1784360"
  },
  {
    "text": "think there only one virtual machine support in in was right in right now",
    "start": "1784360",
    "end": "1790679"
  },
  {
    "text": "right but maybe I'm not right so I don't have this comparation right maybe we",
    "start": "1790679",
    "end": "1796480"
  },
  {
    "text": "should ask for the maintainer from way yeah yeah but this is definitely like an",
    "start": "1796480",
    "end": "1802799"
  },
  {
    "text": "interesting Benchmark to perform right so yeah okay any other",
    "start": "1802799",
    "end": "1809559"
  },
  {
    "text": "questions okay great so I think that yeah we're also out of time so thank you everyone very very much thank yeah",
    "start": "1810120",
    "end": "1818200"
  },
  {
    "text": "[Applause]",
    "start": "1818200",
    "end": "1823339"
  }
]