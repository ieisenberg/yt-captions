[
  {
    "text": "[Applause]",
    "start": "0",
    "end": "199"
  },
  {
    "text": "thank you very much it's uh can you hear",
    "start": "199",
    "end": "2480"
  },
  {
    "text": "me is it good it's a real pleasure to be",
    "start": "2480",
    "end": "5000"
  },
  {
    "text": "talking at the first Thanos con I think",
    "start": "5000",
    "end": "6560"
  },
  {
    "text": "it's uh I was super excited when I saw",
    "start": "6560",
    "end": "8240"
  },
  {
    "text": "that there was a Thanos con a cuon I was",
    "start": "8240",
    "end": "9920"
  },
  {
    "text": "like I have to be there um so this talk",
    "start": "9920",
    "end": "12559"
  },
  {
    "text": "is called re receiver Deep dive um I",
    "start": "12559",
    "end": "15360"
  },
  {
    "text": "didn't really put too much thought into",
    "start": "15360",
    "end": "16840"
  },
  {
    "text": "the name um when I submitted the talk as",
    "start": "16840",
    "end": "19279"
  },
  {
    "text": "you can maybe tell um so a bit about me",
    "start": "19279",
    "end": "21760"
  },
  {
    "text": "I'm a system engineer at open systems um",
    "start": "21760",
    "end": "24640"
  },
  {
    "text": "the company we actually offer say",
    "start": "24640",
    "end": "26439"
  },
  {
    "text": "managed connectivity so we do a lot of",
    "start": "26439",
    "end": "28800"
  },
  {
    "text": "uh firewall proxies these kind of",
    "start": "28800",
    "end": "30400"
  },
  {
    "text": "services and what's uh I think",
    "start": "30400",
    "end": "32398"
  },
  {
    "text": "interesting about us is that we have",
    "start": "32399",
    "end": "34280"
  },
  {
    "text": "hosts or you customer hosts all over the",
    "start": "34280",
    "end": "36640"
  },
  {
    "text": "world so we deploy physical devices um",
    "start": "36640",
    "end": "39800"
  },
  {
    "text": "and recently we started to get into the",
    "start": "39800",
    "end": "41280"
  },
  {
    "text": "cloud and experience all the fun of",
    "start": "41280",
    "end": "43760"
  },
  {
    "text": "merging Legacy with new stuff um so this",
    "start": "43760",
    "end": "47760"
  },
  {
    "text": "is yeah this is quite an exciting time I",
    "start": "47760",
    "end": "49680"
  },
  {
    "text": "would say at open systems in general um",
    "start": "49680",
    "end": "52520"
  },
  {
    "text": "and we're big users of Thanos so Thanos",
    "start": "52520",
    "end": "54520"
  },
  {
    "text": "is the new metrics back end which we're",
    "start": "54520",
    "end": "56879"
  },
  {
    "text": "migrating to um we've been using it",
    "start": "56879",
    "end": "59079"
  },
  {
    "text": "since about two two and a half years now",
    "start": "59079",
    "end": "61440"
  },
  {
    "text": "maybe three years",
    "start": "61440",
    "end": "62680"
  },
  {
    "text": "even um so a bit of a yeah a bit of a",
    "start": "62680",
    "end": "64878"
  },
  {
    "text": "history historical context let's say so",
    "start": "64879",
    "end": "67920"
  },
  {
    "text": "this is me um back in November in",
    "start": "67920",
    "end": "71240"
  },
  {
    "text": "Chicago giving another talk about Thanos",
    "start": "71240",
    "end": "73080"
  },
  {
    "text": "receive uh it was a fun talk uh at the",
    "start": "73080",
    "end": "75680"
  },
  {
    "text": "time I thought I understood the Thanos",
    "start": "75680",
    "end": "77840"
  },
  {
    "text": "receiver now I'm not so sure so um yeah",
    "start": "77840",
    "end": "82200"
  },
  {
    "text": "then I had some nice time in Chicago saw",
    "start": "82200",
    "end": "84000"
  },
  {
    "text": "the bean flew home and not well about",
    "start": "84000",
    "end": "87159"
  },
  {
    "text": "two weeks later Thanos blew up and it",
    "start": "87159",
    "end": "90560"
  },
  {
    "text": "was caused by a instable uh receive um",
    "start": "90560",
    "end": "95119"
  },
  {
    "text": "let's say runaway Cascade of receive",
    "start": "95119",
    "end": "97720"
  },
  {
    "text": "failures uh and what was interesting is",
    "start": "97720",
    "end": "99920"
  },
  {
    "text": "that the Thanos cons submission deadline",
    "start": "99920",
    "end": "101360"
  },
  {
    "text": "was on the 2nd of December so this was",
    "start": "101360",
    "end": "103119"
  },
  {
    "text": "kind of four days apart it was very much",
    "start": "103119",
    "end": "105439"
  },
  {
    "text": "in my mind so I was like okay we're",
    "start": "105439",
    "end": "106920"
  },
  {
    "text": "going to dig into this so this is maybe",
    "start": "106920",
    "end": "108920"
  },
  {
    "text": "conference driven debugging if you",
    "start": "108920",
    "end": "111920"
  },
  {
    "text": "like so this is the story of that",
    "start": "111920",
    "end": "114840"
  },
  {
    "text": "incident",
    "start": "114840",
    "end": "116520"
  },
  {
    "text": "um you probably know this graph this is",
    "start": "116520",
    "end": "119280"
  },
  {
    "text": "showing um rights to Thanos so the green",
    "start": "119280",
    "end": "123000"
  },
  {
    "text": "is good the blue is eh and the red is",
    "start": "123000",
    "end": "125479"
  },
  {
    "text": "bad there's not much red except up here",
    "start": "125479",
    "end": "128319"
  },
  {
    "text": "we'll talk about what that is there's a",
    "start": "128319",
    "end": "130160"
  },
  {
    "text": "lot of blue we'll talk about what that",
    "start": "130160",
    "end": "131599"
  },
  {
    "text": "is and then the green comes back and",
    "start": "131599",
    "end": "133360"
  },
  {
    "text": "we'll talk about why or why not um that",
    "start": "133360",
    "end": "137120"
  },
  {
    "text": "happened so uh I don't think I need to",
    "start": "137120",
    "end": "139720"
  },
  {
    "text": "spend too much time on this bit uh this",
    "start": "139720",
    "end": "141360"
  },
  {
    "text": "is the introductory bit this is to make",
    "start": "141360",
    "end": "142800"
  },
  {
    "text": "sure we're all up to speed on what we're",
    "start": "142800",
    "end": "144400"
  },
  {
    "text": "talking about so um the Thanos receive",
    "start": "144400",
    "end": "147120"
  },
  {
    "text": "component was designed uh introduced",
    "start": "147120",
    "end": "149560"
  },
  {
    "text": "like s said basically a Pock in prod um",
    "start": "149560",
    "end": "153480"
  },
  {
    "text": "it allows us to remote write metrics to",
    "start": "153480",
    "end": "155280"
  },
  {
    "text": "Thanos and this was not the original uh",
    "start": "155280",
    "end": "157519"
  },
  {
    "text": "let's say vision for Thanos the sidecar",
    "start": "157519",
    "end": "160440"
  },
  {
    "text": "was the vision for Thanos originally um",
    "start": "160440",
    "end": "162959"
  },
  {
    "text": "but we wouldn't be able to work with",
    "start": "162959",
    "end": "164480"
  },
  {
    "text": "Thanos if we didn't have this component",
    "start": "164480",
    "end": "166239"
  },
  {
    "text": "so for us it's very very important",
    "start": "166239",
    "end": "167840"
  },
  {
    "text": "because we literally remote write 10,000",
    "start": "167840",
    "end": "170920"
  },
  {
    "text": "batches of me metrics every 30 seconds",
    "start": "170920",
    "end": "173879"
  },
  {
    "text": "from 10,000 hosts around the world so",
    "start": "173879",
    "end": "176080"
  },
  {
    "text": "this is how we are able to use and to",
    "start": "176080",
    "end": "178000"
  },
  {
    "text": "scale our metrics",
    "start": "178000",
    "end": "180519"
  },
  {
    "text": "so um yeah so we know that uh the",
    "start": "180519",
    "end": "183400"
  },
  {
    "text": "receive forms um a hash ring so we have",
    "start": "183400",
    "end": "186280"
  },
  {
    "text": "a hash ring label sets come in they get",
    "start": "186280",
    "end": "189599"
  },
  {
    "text": "hashed to certain receive uh",
    "start": "189599",
    "end": "192280"
  },
  {
    "text": "receivers different label sets get",
    "start": "192280",
    "end": "194239"
  },
  {
    "text": "hashed to different receives we",
    "start": "194239",
    "end": "196040"
  },
  {
    "text": "understand that we have this um hashing",
    "start": "196040",
    "end": "197799"
  },
  {
    "text": "component which is basically mapping",
    "start": "197799",
    "end": "199360"
  },
  {
    "text": "which series get mapped to which receive",
    "start": "199360",
    "end": "201519"
  },
  {
    "text": "uh",
    "start": "201519",
    "end": "203080"
  },
  {
    "text": "replica and the question is what happens",
    "start": "203080",
    "end": "205680"
  },
  {
    "text": "when things go wrong what happens when",
    "start": "205680",
    "end": "207959"
  },
  {
    "text": "uh receivers become unhealthy how can we",
    "start": "207959",
    "end": "210040"
  },
  {
    "text": "deal with this um basically we have a",
    "start": "210040",
    "end": "213560"
  },
  {
    "text": "receive controller so this is how we",
    "start": "213560",
    "end": "215360"
  },
  {
    "text": "work with kubernetes we have an operator",
    "start": "215360",
    "end": "217519"
  },
  {
    "text": "which is looking at our receives and",
    "start": "217519",
    "end": "219120"
  },
  {
    "text": "it's uh monitoring their health",
    "start": "219120",
    "end": "221040"
  },
  {
    "text": "basically so quickly how this works this",
    "start": "221040",
    "end": "224400"
  },
  {
    "text": "is the receive controller from the",
    "start": "224400",
    "end": "226200"
  },
  {
    "text": "observatorium we tell it to look for a",
    "start": "226200",
    "end": "228720"
  },
  {
    "text": "hash label on our receivers it will then",
    "start": "228720",
    "end": "231599"
  },
  {
    "text": "go and find um the end points which",
    "start": "231599",
    "end": "234120"
  },
  {
    "text": "belong to that hash label it will build",
    "start": "234120",
    "end": "236040"
  },
  {
    "text": "the hash ring config and we feed that",
    "start": "236040",
    "end": "237560"
  },
  {
    "text": "into the routin receives the routin",
    "start": "237560",
    "end": "239439"
  },
  {
    "text": "receives will distribute across that",
    "start": "239439",
    "end": "240760"
  },
  {
    "text": "hashing there um when we scale that will",
    "start": "240760",
    "end": "244040"
  },
  {
    "text": "be updated by the operator that's all",
    "start": "244040",
    "end": "245840"
  },
  {
    "text": "good when something goes wrong if we",
    "start": "245840",
    "end": "247959"
  },
  {
    "text": "have Dynamic hashing um or dynamic",
    "start": "247959",
    "end": "250319"
  },
  {
    "text": "control enabled in the receive",
    "start": "250319",
    "end": "251599"
  },
  {
    "text": "controller it will remove the component",
    "start": "251599",
    "end": "254079"
  },
  {
    "text": "from the hash",
    "start": "254079",
    "end": "255560"
  },
  {
    "text": "ring um now what happens when we",
    "start": "255560",
    "end": "258519"
  },
  {
    "text": "actually want to read the data okay so",
    "start": "258519",
    "end": "260079"
  },
  {
    "text": "we have multiple replicas we have a",
    "start": "260079",
    "end": "262400"
  },
  {
    "text": "component maybe ruler uh who wants to",
    "start": "262400",
    "end": "264560"
  },
  {
    "text": "read that data and that's important",
    "start": "264560",
    "end": "266120"
  },
  {
    "text": "because we may be alerting from this guy",
    "start": "266120",
    "end": "268840"
  },
  {
    "text": "um if the receiver goes down the ruler",
    "start": "268840",
    "end": "270960"
  },
  {
    "text": "can't get the data right so that's a",
    "start": "270960",
    "end": "272520"
  },
  {
    "text": "problem because then our alerts are",
    "start": "272520",
    "end": "273759"
  },
  {
    "text": "going to be um screwed up so how can we",
    "start": "273759",
    "end": "276919"
  },
  {
    "text": "deal with that uh we can enable",
    "start": "276919",
    "end": "279160"
  },
  {
    "text": "replication um so what we do is we",
    "start": "279160",
    "end": "281240"
  },
  {
    "text": "basically replicate metrics replicate",
    "start": "281240",
    "end": "283840"
  },
  {
    "text": "rights to multiple receive components",
    "start": "283840",
    "end": "286840"
  },
  {
    "text": "and when one of them goes down as long",
    "start": "286840",
    "end": "288320"
  },
  {
    "text": "as we have a quorum so as long as enough",
    "start": "288320",
    "end": "291840"
  },
  {
    "text": "of the rights agree uh enough of the",
    "start": "291840",
    "end": "294160"
  },
  {
    "text": "receives agree that a right was",
    "start": "294160",
    "end": "295600"
  },
  {
    "text": "successful um the the ruler can still",
    "start": "295600",
    "end": "298360"
  },
  {
    "text": "continue to function so this is all good",
    "start": "298360",
    "end": "301440"
  },
  {
    "text": "this is how the Quorum is calculated in",
    "start": "301440",
    "end": "303320"
  },
  {
    "text": "Thanos um it's maybe a bit controversial",
    "start": "303320",
    "end": "307080"
  },
  {
    "text": "because uh we can talk about that later",
    "start": "307080",
    "end": "309160"
  },
  {
    "text": "but currently this is the way so",
    "start": "309160",
    "end": "310919"
  },
  {
    "text": "currently replication Factor two gives",
    "start": "310919",
    "end": "312720"
  },
  {
    "text": "us um a quorum of two so there's a",
    "start": "312720",
    "end": "315720"
  },
  {
    "text": "little hint there as to what went",
    "start": "315720",
    "end": "317639"
  },
  {
    "text": "wrong and we had a great talk just now",
    "start": "317639",
    "end": "320960"
  },
  {
    "text": "um about multi-tenancy so we also",
    "start": "320960",
    "end": "323680"
  },
  {
    "text": "Implement um a multi tendency model at",
    "start": "323680",
    "end": "326160"
  },
  {
    "text": "open systems and the reason is in the",
    "start": "326160",
    "end": "328240"
  },
  {
    "text": "past we've had problems with service",
    "start": "328240",
    "end": "330280"
  },
  {
    "text": "teams who are our actual tenants um you",
    "start": "330280",
    "end": "333440"
  },
  {
    "text": "know maybe pushing some Metric which",
    "start": "333440",
    "end": "334960"
  },
  {
    "text": "tries to label a a request IP and the",
    "start": "334960",
    "end": "338240"
  },
  {
    "text": "domain and the user right so just",
    "start": "338240",
    "end": "340280"
  },
  {
    "text": "cardinality explosion which can cause a",
    "start": "340280",
    "end": "343039"
  },
  {
    "text": "sort of uh failover not failover but a",
    "start": "343039",
    "end": "345880"
  },
  {
    "text": "failure Cascade in our receives so one",
    "start": "345880",
    "end": "348759"
  },
  {
    "text": "tenant can take out",
    "start": "348759",
    "end": "350440"
  },
  {
    "text": "many this is the problem that hard tency",
    "start": "350440",
    "end": "352919"
  },
  {
    "text": "aims to solve um so we have two specific",
    "start": "352919",
    "end": "355560"
  },
  {
    "text": "pipelines for our hard tenants okay this",
    "start": "355560",
    "end": "358560"
  },
  {
    "text": "is the summary receiv scalable way to",
    "start": "358560",
    "end": "360759"
  },
  {
    "text": "remote rate replication um make the",
    "start": "360759",
    "end": "364880"
  },
  {
    "text": "receivers more resilient to failures and",
    "start": "364880",
    "end": "367479"
  },
  {
    "text": "hard tendency isolated hash",
    "start": "367479",
    "end": "370000"
  },
  {
    "text": "rings in principle everything should be",
    "start": "370000",
    "end": "373120"
  },
  {
    "text": "fully",
    "start": "373120",
    "end": "374080"
  },
  {
    "text": "isolated okay now we can dive into the",
    "start": "374080",
    "end": "376800"
  },
  {
    "text": "incident so it lasted about 4 hours um",
    "start": "376800",
    "end": "379680"
  },
  {
    "text": "like I say it was at the end of November",
    "start": "379680",
    "end": "381120"
  },
  {
    "text": "last year we were puzzled we absolutely",
    "start": "381120",
    "end": "383919"
  },
  {
    "text": "puzzled during this thing we had no idea",
    "start": "383919",
    "end": "385360"
  },
  {
    "text": "what was going on um the resolution was",
    "start": "385360",
    "end": "388800"
  },
  {
    "text": "just time and luck it everything",
    "start": "388800",
    "end": "390759"
  },
  {
    "text": "resolved and we sort of worked out what",
    "start": "390759",
    "end": "392840"
  },
  {
    "text": "happened afterwards um that was lucky um",
    "start": "392840",
    "end": "396919"
  },
  {
    "text": "let me just show you how we are",
    "start": "396919",
    "end": "399240"
  },
  {
    "text": "configured so up here we have our",
    "start": "399240",
    "end": "402800"
  },
  {
    "text": "sources metric sources we have the edge",
    "start": "402800",
    "end": "405240"
  },
  {
    "text": "devices 10,000 of them all around the",
    "start": "405240",
    "end": "407160"
  },
  {
    "text": "world and we have some kubernetes",
    "start": "407160",
    "end": "409360"
  },
  {
    "text": "clusters which are just running",
    "start": "409360",
    "end": "411360"
  },
  {
    "text": "Prometheus okay they're all remote",
    "start": "411360",
    "end": "414360"
  },
  {
    "text": "rating but actually on the hosts we have",
    "start": "414360",
    "end": "417400"
  },
  {
    "text": "Telegraph um which is influx in in the",
    "start": "417400",
    "end": "420639"
  },
  {
    "text": "influx DB World um actually this agent",
    "start": "420639",
    "end": "423479"
  },
  {
    "text": "is doing the remote",
    "start": "423479",
    "end": "424919"
  },
  {
    "text": "writing that's maybe a legacy thing and",
    "start": "424919",
    "end": "428840"
  },
  {
    "text": "then centrally we have an ISO Ingress",
    "start": "428840",
    "end": "431400"
  },
  {
    "text": "and this is rooting stuff based on um a",
    "start": "431400",
    "end": "433759"
  },
  {
    "text": "tenant a tenant header to different um",
    "start": "433759",
    "end": "437160"
  },
  {
    "text": "hard tency pipelines and over here we",
    "start": "437160",
    "end": "439400"
  },
  {
    "text": "have a queria and this is the global",
    "start": "439400",
    "end": "440879"
  },
  {
    "text": "queria so we plug in that quer to all of",
    "start": "440879",
    "end": "443120"
  },
  {
    "text": "the tenants then we can query stuff as",
    "start": "443120",
    "end": "445400"
  },
  {
    "text": "we like as if there were no",
    "start": "445400",
    "end": "447440"
  },
  {
    "text": "tenants and this is the start of the in",
    "start": "447440",
    "end": "449520"
  },
  {
    "text": "in so we receive a report um basically",
    "start": "449520",
    "end": "452160"
  },
  {
    "text": "at 9:00 hey some of my metrics are",
    "start": "452160",
    "end": "454080"
  },
  {
    "text": "missing and the effect of this is the",
    "start": "454080",
    "end": "456199"
  },
  {
    "text": "alerts started to weird stuff they",
    "start": "456199",
    "end": "458080"
  },
  {
    "text": "started to refire they started to",
    "start": "458080",
    "end": "460639"
  },
  {
    "text": "um yeah just weird stuff started to",
    "start": "460639",
    "end": "462960"
  },
  {
    "text": "happen so some metrics were getting",
    "start": "462960",
    "end": "464440"
  },
  {
    "text": "through but not all of them we dug in",
    "start": "464440",
    "end": "468080"
  },
  {
    "text": "and we see this and this is not good",
    "start": "468080",
    "end": "471080"
  },
  {
    "text": "this is the receivers and it's very",
    "start": "471080",
    "end": "473080"
  },
  {
    "text": "strange because we can see that they've",
    "start": "473080",
    "end": "474520"
  },
  {
    "text": "all suffered a sort of catastrophic",
    "start": "474520",
    "end": "476960"
  },
  {
    "text": "failure at the same time um um multiple",
    "start": "476960",
    "end": "480879"
  },
  {
    "text": "restarts um and it's across tenants",
    "start": "480879",
    "end": "483199"
  },
  {
    "text": "right so we've got different tenants",
    "start": "483199",
    "end": "484240"
  },
  {
    "text": "here we've got like firewall we've got",
    "start": "484240",
    "end": "486479"
  },
  {
    "text": "Central infrastructure we've got",
    "start": "486479",
    "end": "487800"
  },
  {
    "text": "bandwidth control multiple different",
    "start": "487800",
    "end": "489599"
  },
  {
    "text": "tenants all kicked out at the same time",
    "start": "489599",
    "end": "493080"
  },
  {
    "text": "um they were un killed of course so what",
    "start": "493080",
    "end": "496039"
  },
  {
    "text": "the hell happened like that's really",
    "start": "496039",
    "end": "498000"
  },
  {
    "text": "weird and that's also really concerning",
    "start": "498000",
    "end": "499560"
  },
  {
    "text": "because we were like feeling secure that",
    "start": "499560",
    "end": "501360"
  },
  {
    "text": "we had a hard tency pipeline we",
    "start": "501360",
    "end": "503440"
  },
  {
    "text": "shouldn't yeah that shouldn't happen so",
    "start": "503440",
    "end": "506360"
  },
  {
    "text": "what happened um the clue was in these",
    "start": "506360",
    "end": "509879"
  },
  {
    "text": "metric here so this is just the resource",
    "start": "509879",
    "end": "511800"
  },
  {
    "text": "metrix uh the one of our the querer blew",
    "start": "511800",
    "end": "515120"
  },
  {
    "text": "up so the queria um spiked we we saw",
    "start": "515120",
    "end": "518399"
  },
  {
    "text": "this we dug in and we find this series",
    "start": "518399",
    "end": "520440"
  },
  {
    "text": "query hiding uh this is the monster",
    "start": "520440",
    "end": "523479"
  },
  {
    "text": "query and so what happened basically",
    "start": "523480",
    "end": "525720"
  },
  {
    "text": "yeah so the monster query came along",
    "start": "525720",
    "end": "528440"
  },
  {
    "text": "um it didn't work so they tried a few",
    "start": "528440",
    "end": "530920"
  },
  {
    "text": "more times and then the receives all",
    "start": "530920",
    "end": "534040"
  },
  {
    "text": "died cross tenant",
    "start": "534040",
    "end": "536040"
  },
  {
    "text": "Kut so yeah that was surprising that was",
    "start": "536040",
    "end": "539000"
  },
  {
    "text": "like yeah okay that made me question a",
    "start": "539000",
    "end": "541079"
  },
  {
    "text": "whole hard tendency thing but let's go",
    "start": "541079",
    "end": "543320"
  },
  {
    "text": "ahead um and then Thanos got itself in a",
    "start": "543320",
    "end": "545920"
  },
  {
    "text": "real mess like this is the mess that",
    "start": "545920",
    "end": "547800"
  },
  {
    "text": "Thanos got itself in so these are just",
    "start": "547800",
    "end": "550360"
  },
  {
    "text": "this is like a lowkey um query for error",
    "start": "550360",
    "end": "553839"
  },
  {
    "text": "logs from Thanos and we see this kind of",
    "start": "553839",
    "end": "555920"
  },
  {
    "text": "Str strange structure um periodicity but",
    "start": "555920",
    "end": "559640"
  },
  {
    "text": "it's it's just not ending right",
    "start": "559640",
    "end": "561440"
  },
  {
    "text": "nothing's resolving and what these",
    "start": "561440",
    "end": "563040"
  },
  {
    "text": "errors are actually are um out of bounds",
    "start": "563040",
    "end": "565640"
  },
  {
    "text": "errors so they're returning four NES",
    "start": "565640",
    "end": "567680"
  },
  {
    "text": "which is non- retriable error okay so",
    "start": "567680",
    "end": "570160"
  },
  {
    "text": "these things should be being dropped but",
    "start": "570160",
    "end": "571760"
  },
  {
    "text": "they're not um and this yeah it's it's",
    "start": "571760",
    "end": "574720"
  },
  {
    "text": "just not resolving we were just",
    "start": "574720",
    "end": "576000"
  },
  {
    "text": "observing and watching and trying things",
    "start": "576000",
    "end": "577680"
  },
  {
    "text": "and it just wouldn't go away this was",
    "start": "577680",
    "end": "580040"
  },
  {
    "text": "really really",
    "start": "580040",
    "end": "581160"
  },
  {
    "text": "strange just check the",
    "start": "581160",
    "end": "583600"
  },
  {
    "text": "time I know it's lunch neck so I don't",
    "start": "583600",
    "end": "585760"
  },
  {
    "text": "want to keep you",
    "start": "585760",
    "end": "588040"
  },
  {
    "text": "um okay so we dug in a little bit and it",
    "start": "588040",
    "end": "592360"
  },
  {
    "text": "turned out that actually the uh the",
    "start": "592360",
    "end": "594640"
  },
  {
    "text": "telegraph components had the problem so",
    "start": "594640",
    "end": "597000"
  },
  {
    "text": "Prometheus remote right that was going",
    "start": "597000",
    "end": "598480"
  },
  {
    "text": "fine that was the C the graph here uh",
    "start": "598480",
    "end": "601640"
  },
  {
    "text": "Prometheus was okay but Telegraph those",
    "start": "601640",
    "end": "603920"
  },
  {
    "text": "pipelines all those tenants they had",
    "start": "603920",
    "end": "605640"
  },
  {
    "text": "issues and all this blue is actually 409",
    "start": "605640",
    "end": "608920"
  },
  {
    "text": "errors and at the top there's like tiny",
    "start": "608920",
    "end": "611720"
  },
  {
    "text": "little amount of 500s just tiny amount",
    "start": "611720",
    "end": "615360"
  },
  {
    "text": "and you can also see some other",
    "start": "615360",
    "end": "616480"
  },
  {
    "text": "interesting stuff here so the red on the",
    "start": "616480",
    "end": "618600"
  },
  {
    "text": "left hand side this is the initial",
    "start": "618600",
    "end": "620519"
  },
  {
    "text": "monster query that killed the receives",
    "start": "620519",
    "end": "622600"
  },
  {
    "text": "for everyone um so yeah they there was",
    "start": "622600",
    "end": "627279"
  },
  {
    "text": "some outage there we get some 500",
    "start": "627279",
    "end": "629360"
  },
  {
    "text": "hundreds unable to um push the request",
    "start": "629360",
    "end": "632399"
  },
  {
    "text": "and then an hour",
    "start": "632399",
    "end": "634120"
  },
  {
    "text": "later the the telegraph components",
    "start": "634120",
    "end": "636440"
  },
  {
    "text": "started to have",
    "start": "636440",
    "end": "638320"
  },
  {
    "text": "issues very weird so let's look a bit",
    "start": "638320",
    "end": "641720"
  },
  {
    "text": "deeper at what's going on on the hosts",
    "start": "641720",
    "end": "643800"
  },
  {
    "text": "okay so we have actually a very weird",
    "start": "643800",
    "end": "645279"
  },
  {
    "text": "setup on the hosts and again this is all",
    "start": "645279",
    "end": "646959"
  },
  {
    "text": "part of Legacy migration this talk is",
    "start": "646959",
    "end": "650040"
  },
  {
    "text": "messy right this is the real world this",
    "start": "650040",
    "end": "651760"
  },
  {
    "text": "is actual production where things are",
    "start": "651760",
    "end": "653600"
  },
  {
    "text": "not sort of tied up in a nice bow this",
    "start": "653600",
    "end": "656200"
  },
  {
    "text": "is how we have to actually do things so",
    "start": "656200",
    "end": "658519"
  },
  {
    "text": "we have a prome is running on our host",
    "start": "658519",
    "end": "660560"
  },
  {
    "text": "which then remote writes to Telegraph",
    "start": "660560",
    "end": "662360"
  },
  {
    "text": "which then remote writes to Thanos Okay",
    "start": "662360",
    "end": "664519"
  },
  {
    "text": "the reason for that is we actually still",
    "start": "664519",
    "end": "665760"
  },
  {
    "text": "have influx DB in production um so we",
    "start": "665760",
    "end": "668519"
  },
  {
    "text": "basically told Telegraph hey we got this",
    "start": "668519",
    "end": "670120"
  },
  {
    "text": "new back end called Thanos can you also",
    "start": "670120",
    "end": "671440"
  },
  {
    "text": "ship the metrics there but keep shipping",
    "start": "671440",
    "end": "673240"
  },
  {
    "text": "them to influx we still need",
    "start": "673240",
    "end": "674959"
  },
  {
    "text": "you it also has a an important function",
    "start": "674959",
    "end": "677959"
  },
  {
    "text": "because it means that um we have",
    "start": "677959",
    "end": "679800"
  },
  {
    "text": "different metric buffers for each of",
    "start": "679800",
    "end": "681360"
  },
  {
    "text": "these hard tenants so actually Telegraph",
    "start": "681360",
    "end": "685000"
  },
  {
    "text": "is doing an important thing it's kind of",
    "start": "685000",
    "end": "686279"
  },
  {
    "text": "a buffer between Prometheus and the hard",
    "start": "686279",
    "end": "689480"
  },
  {
    "text": "tency pipelines if one of the pipelines",
    "start": "689480",
    "end": "691680"
  },
  {
    "text": "goes down it'll back up to Telegraph but",
    "start": "691680",
    "end": "694360"
  },
  {
    "text": "in principle Prometheus shouldn't be um",
    "start": "694360",
    "end": "697480"
  },
  {
    "text": "affected or not so the telegraph config",
    "start": "697480",
    "end": "701000"
  },
  {
    "text": "it looked okay we were not we were not",
    "start": "701000",
    "end": "703600"
  },
  {
    "text": "retrying 49 so Telegraph should be",
    "start": "703600",
    "end": "706639"
  },
  {
    "text": "handling the stuff handling the data",
    "start": "706639",
    "end": "708920"
  },
  {
    "text": "okay um but there was like some other",
    "start": "708920",
    "end": "712320"
  },
  {
    "text": "interesting stuff lurking in the logs",
    "start": "712320",
    "end": "714440"
  },
  {
    "text": "like we found this and what's happening",
    "start": "714440",
    "end": "716959"
  },
  {
    "text": "here is that we're getting we're getting",
    "start": "716959",
    "end": "719800"
  },
  {
    "text": "out of bounds from the receives so that",
    "start": "719800",
    "end": "722800"
  },
  {
    "text": "should be a 409 but we get two of them",
    "start": "722800",
    "end": "725000"
  },
  {
    "text": "in the same",
    "start": "725000",
    "end": "726399"
  },
  {
    "text": "response and so what happens the overall",
    "start": "726399",
    "end": "728959"
  },
  {
    "text": "error is a 500 like that's weird uh",
    "start": "728959",
    "end": "732320"
  },
  {
    "text": "there's actually sorry I put 429 it's",
    "start": "732320",
    "end": "734360"
  },
  {
    "text": "actually 409 that's a mistake on my half",
    "start": "734360",
    "end": "736160"
  },
  {
    "text": "it should be a 409 so 409 plus 409 gives",
    "start": "736160",
    "end": "739880"
  },
  {
    "text": "us a 500 there's actually an explanation",
    "start": "739880",
    "end": "742040"
  },
  {
    "text": "for that I'm not going to go into it",
    "start": "742040",
    "end": "743399"
  },
  {
    "text": "there are some slides if you want to see",
    "start": "743399",
    "end": "745440"
  },
  {
    "text": "um but it's because we were using",
    "start": "745440",
    "end": "746920"
  },
  {
    "text": "replication Factor 2 at the time and",
    "start": "746920",
    "end": "749360"
  },
  {
    "text": "that case there's sort of this strange",
    "start": "749360",
    "end": "751600"
  },
  {
    "text": "condition where you cannot reach Quorum",
    "start": "751600",
    "end": "754000"
  },
  {
    "text": "so therefore the error is basically",
    "start": "754000",
    "end": "755839"
  },
  {
    "text": "always a 500 regardless of what the",
    "start": "755839",
    "end": "758600"
  },
  {
    "text": "underlying error",
    "start": "758600",
    "end": "760240"
  },
  {
    "text": "is but this was yeah this was actually a",
    "start": "760240",
    "end": "762720"
  },
  {
    "text": "red herring like does this make sense um",
    "start": "762720",
    "end": "767000"
  },
  {
    "text": "this is the hypothesis then so Telegraph",
    "start": "767000",
    "end": "769560"
  },
  {
    "text": "is shipping metric out of bounds Thanos",
    "start": "769560",
    "end": "775199"
  },
  {
    "text": "responds with the 409 but it's a nested",
    "start": "775199",
    "end": "777760"
  },
  {
    "text": "409 which gets interpreted as a retrival",
    "start": "777760",
    "end": "780639"
  },
  {
    "text": "500 by Telegraph and the cycle continues",
    "start": "780639",
    "end": "783959"
  },
  {
    "text": "and that's what gives us this right",
    "start": "783959",
    "end": "785880"
  },
  {
    "text": "makes sense complete bull it's not the",
    "start": "785880",
    "end": "788720"
  },
  {
    "text": "case",
    "start": "788720",
    "end": "790560"
  },
  {
    "text": "so actually this is this is the response",
    "start": "790560",
    "end": "793160"
  },
  {
    "text": "code from the receiver right the routing",
    "start": "793160",
    "end": "794920"
  },
  {
    "text": "receiver so the r receiver is doing its",
    "start": "794920",
    "end": "796800"
  },
  {
    "text": "job it's actually responding with",
    "start": "796800",
    "end": "798600"
  },
  {
    "text": "409 and in the logs um of telegraph most",
    "start": "798600",
    "end": "802800"
  },
  {
    "text": "of the entries we saw were 409 so",
    "start": "802800",
    "end": "805680"
  },
  {
    "text": "telegraph was really dropping the metric",
    "start": "805680",
    "end": "808839"
  },
  {
    "text": "um there are some like like I say there",
    "start": "808839",
    "end": "810959"
  },
  {
    "text": "are some hints of 500s they were there",
    "start": "810959",
    "end": "813279"
  },
  {
    "text": "in the logs it was happening but it",
    "start": "813279",
    "end": "815000"
  },
  {
    "text": "wasn't the",
    "start": "815000",
    "end": "816360"
  },
  {
    "text": "primary cause of this incident so back",
    "start": "816360",
    "end": "819920"
  },
  {
    "text": "to the drawing",
    "start": "819920",
    "end": "821160"
  },
  {
    "text": "board where are",
    "start": "821160",
    "end": "823160"
  },
  {
    "text": "we yeah this is what we tried I mean as",
    "start": "823160",
    "end": "825600"
  },
  {
    "text": "all good kubernetes operators what do we",
    "start": "825600",
    "end": "827880"
  },
  {
    "text": "do we switch it off and back on again we",
    "start": "827880",
    "end": "829839"
  },
  {
    "text": "hope and pray that that's going to fix",
    "start": "829839",
    "end": "831079"
  },
  {
    "text": "it it didn't fix it um we tried",
    "start": "831079",
    "end": "835079"
  },
  {
    "text": "restarting Prometheus on the hosts that",
    "start": "835079",
    "end": "837279"
  },
  {
    "text": "didn't fix it uh we tried reciting",
    "start": "837279",
    "end": "839600"
  },
  {
    "text": "Telegraph on the host that didn't fix it",
    "start": "839600",
    "end": "841480"
  },
  {
    "text": "we got really desperate and started",
    "start": "841480",
    "end": "842959"
  },
  {
    "text": "deleting data in the Thanos receed V",
    "start": "842959",
    "end": "845120"
  },
  {
    "text": "that didn't fix it the metrics just came",
    "start": "845120",
    "end": "846720"
  },
  {
    "text": "back all out of bounds all kind of",
    "start": "846720",
    "end": "850600"
  },
  {
    "text": "unexplainable while we were doing this",
    "start": "850600",
    "end": "852600"
  },
  {
    "text": "the incident resolved itself so great we",
    "start": "852600",
    "end": "857040"
  },
  {
    "text": "can go home problem solved right",
    "start": "857040",
    "end": "860040"
  },
  {
    "text": "no what's going on here I mean it's it's",
    "start": "860040",
    "end": "862800"
  },
  {
    "text": "really weird case this",
    "start": "862800",
    "end": "864959"
  },
  {
    "text": "is again the monster query an hour l",
    "start": "864959",
    "end": "869160"
  },
  {
    "text": "later 409 Loop 4 hours later",
    "start": "869160",
    "end": "875360"
  },
  {
    "text": "resolution that's what we're here to",
    "start": "875639",
    "end": "877880"
  },
  {
    "text": "discuss does anyone have an idea please",
    "start": "877880",
    "end": "880759"
  },
  {
    "text": "come find me at the end um so we of",
    "start": "880759",
    "end": "884079"
  },
  {
    "text": "course go to GitHub and we look into the",
    "start": "884079",
    "end": "885839"
  },
  {
    "text": "issues there is this open issue still um",
    "start": "885839",
    "end": "889040"
  },
  {
    "text": "where there's kind of similar",
    "start": "889040",
    "end": "890800"
  },
  {
    "text": "Behavior but then we looked and this is",
    "start": "890800",
    "end": "893399"
  },
  {
    "text": "us on top and this is the the graphs",
    "start": "893399",
    "end": "895920"
  },
  {
    "text": "which we get you know in the issue and",
    "start": "895920",
    "end": "897920"
  },
  {
    "text": "it's really not the same signature so in",
    "start": "897920",
    "end": "899680"
  },
  {
    "text": "the in the issue actually what's going",
    "start": "899680",
    "end": "900959"
  },
  {
    "text": "on is some of the fan forward requests",
    "start": "900959",
    "end": "903279"
  },
  {
    "text": "from Thanos they get time out so",
    "start": "903279",
    "end": "905720"
  },
  {
    "text": "basically the appender cannot keep up",
    "start": "905720",
    "end": "907920"
  },
  {
    "text": "with the incoming requests it it starts",
    "start": "907920",
    "end": "910279"
  },
  {
    "text": "to um fail so receive start to time out",
    "start": "910279",
    "end": "913720"
  },
  {
    "text": "that causes more requests to back up um",
    "start": "913720",
    "end": "916440"
  },
  {
    "text": "and so on so forth and you get into",
    "start": "916440",
    "end": "918040"
  },
  {
    "text": "another kind of loop that's a completely",
    "start": "918040",
    "end": "919720"
  },
  {
    "text": "different failure mode um so I don't",
    "start": "919720",
    "end": "922639"
  },
  {
    "text": "think this is what's going on here we",
    "start": "922639",
    "end": "924519"
  },
  {
    "text": "actually all of our requests were very",
    "start": "924519",
    "end": "926279"
  },
  {
    "text": "very quick on the receives the receives",
    "start": "926279",
    "end": "928560"
  },
  {
    "text": "were fine it was something",
    "start": "928560",
    "end": "930880"
  },
  {
    "text": "else um why did it take an hour for this",
    "start": "930880",
    "end": "935560"
  },
  {
    "text": "409 T infinite Loop to sort of kick",
    "start": "935560",
    "end": "938920"
  },
  {
    "text": "in I'm going to disappoint you I don't",
    "start": "938920",
    "end": "941120"
  },
  {
    "text": "have an answer for that today I have a",
    "start": "941120",
    "end": "942519"
  },
  {
    "text": "hypothesis and I want to see if you have",
    "start": "942519",
    "end": "944279"
  },
  {
    "text": "an idea but that's really weird that's",
    "start": "944279",
    "end": "947040"
  },
  {
    "text": "super weird and another thing this is",
    "start": "947040",
    "end": "949600"
  },
  {
    "text": "from a tenant which was not affected by",
    "start": "949600",
    "end": "952440"
  },
  {
    "text": "the receiver outage so here the tenant",
    "start": "952440",
    "end": "956680"
  },
  {
    "text": "was fine at 9:00 the receivers were fine",
    "start": "956680",
    "end": "959079"
  },
  {
    "text": "at",
    "start": "959079",
    "end": "959959"
  },
  {
    "text": "9:00 but it still got screwed up at",
    "start": "959959",
    "end": "963040"
  },
  {
    "text": "10:00 with the 409",
    "start": "963040",
    "end": "965360"
  },
  {
    "text": "Loop and what was going on here this was",
    "start": "965360",
    "end": "967759"
  },
  {
    "text": "actually the probing tenant this is the",
    "start": "967759",
    "end": "969279"
  },
  {
    "text": "tenant which is responsible for our",
    "start": "969279",
    "end": "970839"
  },
  {
    "text": "connection down alerts so the SRE team",
    "start": "970839",
    "end": "973600"
  },
  {
    "text": "was like we got to fix this um so they",
    "start": "973600",
    "end": "975920"
  },
  {
    "text": "were like restarting everything and",
    "start": "975920",
    "end": "978120"
  },
  {
    "text": "trying to fix it but it didn't",
    "start": "978120",
    "end": "980639"
  },
  {
    "text": "work so a",
    "start": "980639",
    "end": "984600"
  },
  {
    "text": "hypothesis again let's revisit this",
    "start": "984600",
    "end": "986560"
  },
  {
    "text": "weird pipeline we have on the host um so",
    "start": "986560",
    "end": "989240"
  },
  {
    "text": "we have a Prometheus with a retention of",
    "start": "989240",
    "end": "990880"
  },
  {
    "text": "4 hours which again is that's the",
    "start": "990880",
    "end": "993480"
  },
  {
    "text": "duration of the incident we have a head",
    "start": "993480",
    "end": "995800"
  },
  {
    "text": "block and we have the chunks which are",
    "start": "995800",
    "end": "998279"
  },
  {
    "text": "getting written in and M mapped and then",
    "start": "998279",
    "end": "1000360"
  },
  {
    "text": "the the the chunks are cut to persistent",
    "start": "1000360",
    "end": "1002759"
  },
  {
    "text": "persistent dis so that's all going on",
    "start": "1002759",
    "end": "1005199"
  },
  {
    "text": "right now at 9:00 well let's",
    "start": "1005199",
    "end": "1008720"
  },
  {
    "text": "say oh at 8:50 this is the good scenario",
    "start": "1008720",
    "end": "1012959"
  },
  {
    "text": "right everything is working normally at",
    "start": "1012959",
    "end": "1015160"
  },
  {
    "text": "9:00 a lot of stuff happens um",
    "start": "1015160",
    "end": "1019440"
  },
  {
    "text": "the receives go down so the the monster",
    "start": "1019440",
    "end": "1021319"
  },
  {
    "text": "query comes in kills the receives that",
    "start": "1021319",
    "end": "1023759"
  },
  {
    "text": "stops the remote right from Telegraph",
    "start": "1023759",
    "end": "1025480"
  },
  {
    "text": "Telegraph gets backed up Telegraph can't",
    "start": "1025480",
    "end": "1028600"
  },
  {
    "text": "handle any more metrics Telegraph stops",
    "start": "1028600",
    "end": "1031199"
  },
  {
    "text": "accepting remote right from Prometheus",
    "start": "1031199",
    "end": "1033959"
  },
  {
    "text": "okay and at the same time there's some",
    "start": "1033959",
    "end": "1037079"
  },
  {
    "text": "block cut over here right I",
    "start": "1037079",
    "end": "1041918"
  },
  {
    "text": "think so a lot of stuff happened at 9:00",
    "start": "1041919",
    "end": "1044839"
  },
  {
    "text": "this is when the blocks get cut um now",
    "start": "1044839",
    "end": "1047558"
  },
  {
    "text": "at 10:00",
    "start": "1047559",
    "end": "1049440"
  },
  {
    "text": "I think Prometheus started to",
    "start": "1049440",
    "end": "1051960"
  },
  {
    "text": "um send old data to Telegraph again so",
    "start": "1051960",
    "end": "1055919"
  },
  {
    "text": "everything was healthy Upstream but",
    "start": "1055919",
    "end": "1057679"
  },
  {
    "text": "Prometheus somehow started to send",
    "start": "1057679",
    "end": "1060919"
  },
  {
    "text": "um send old data again and I think this",
    "start": "1060919",
    "end": "1063880"
  },
  {
    "text": "is the only explanation because all of",
    "start": "1063880",
    "end": "1066039"
  },
  {
    "text": "the tenants were affected it wasn't just",
    "start": "1066039",
    "end": "1068679"
  },
  {
    "text": "uh the tenants who had the reips knocked",
    "start": "1068679",
    "end": "1070200"
  },
  {
    "text": "out it was",
    "start": "1070200",
    "end": "1072799"
  },
  {
    "text": "everyone and I don't know why that would",
    "start": "1072799",
    "end": "1074919"
  },
  {
    "text": "happen that's something which I'd like",
    "start": "1074919",
    "end": "1076440"
  },
  {
    "text": "to discuss so that would kill then",
    "start": "1076440",
    "end": "1078880"
  },
  {
    "text": "remote R because the 409s would come",
    "start": "1078880",
    "end": "1080960"
  },
  {
    "text": "cast gate back down um and then yeah we",
    "start": "1080960",
    "end": "1084440"
  },
  {
    "text": "wouldn't be able to ship anything and",
    "start": "1084440",
    "end": "1085679"
  },
  {
    "text": "we'd have this kind of infinite Loop and",
    "start": "1085679",
    "end": "1087880"
  },
  {
    "text": "then as we continue at 1:00 the for the",
    "start": "1087880",
    "end": "1090760"
  },
  {
    "text": "block falls out of retention the data",
    "start": "1090760",
    "end": "1092480"
  },
  {
    "text": "goes away and Prometheus just gives up",
    "start": "1092480",
    "end": "1094400"
  },
  {
    "text": "dry of remote right and everything goes",
    "start": "1094400",
    "end": "1096440"
  },
  {
    "text": "back so everything goes back to",
    "start": "1096440",
    "end": "1100320"
  },
  {
    "text": "normal",
    "start": "1100320",
    "end": "1101919"
  },
  {
    "text": "okay I don't know if that's the case um",
    "start": "1101919",
    "end": "1104840"
  },
  {
    "text": "we still need to investigate this more",
    "start": "1104840",
    "end": "1107039"
  },
  {
    "text": "on our side um to me it seems like",
    "start": "1107039",
    "end": "1110120"
  },
  {
    "text": "that's the suspicious part of our",
    "start": "1110120",
    "end": "1112159"
  },
  {
    "text": "pipeline yeah this Prometheus to",
    "start": "1112159",
    "end": "1114720"
  },
  {
    "text": "Telegraph remote right part um we still",
    "start": "1114720",
    "end": "1117240"
  },
  {
    "text": "need to think about what we can do about",
    "start": "1117240",
    "end": "1118520"
  },
  {
    "text": "that um maybe a solution would be to",
    "start": "1118520",
    "end": "1121720"
  },
  {
    "text": "actually have one Prometheus per tenant",
    "start": "1121720",
    "end": "1123360"
  },
  {
    "text": "and then we have a fully separated",
    "start": "1123360",
    "end": "1124919"
  },
  {
    "text": "pipeline for everything but that's going",
    "start": "1124919",
    "end": "1126880"
  },
  {
    "text": "very very complicated um we need to sort",
    "start": "1126880",
    "end": "1130120"
  },
  {
    "text": "of try and recreate this let's",
    "start": "1130120",
    "end": "1132280"
  },
  {
    "text": "say now what mitigation steps could we",
    "start": "1132280",
    "end": "1134880"
  },
  {
    "text": "take the first thing we wanted to do is",
    "start": "1134880",
    "end": "1137159"
  },
  {
    "text": "make sure that this monster query can",
    "start": "1137159",
    "end": "1139200"
  },
  {
    "text": "never get through again okay so the",
    "start": "1139200",
    "end": "1141320"
  },
  {
    "text": "monster query had to go um that's",
    "start": "1141320",
    "end": "1144200"
  },
  {
    "text": "actually really easy there's this really",
    "start": "1144200",
    "end": "1146640"
  },
  {
    "text": "cool config options store. limits um and",
    "start": "1146640",
    "end": "1150880"
  },
  {
    "text": "that basically says to the receiver",
    "start": "1150880",
    "end": "1152400"
  },
  {
    "text": "don't try and fetch more than this",
    "start": "1152400",
    "end": "1153919"
  },
  {
    "text": "number of series okay otherwise you're",
    "start": "1153919",
    "end": "1155640"
  },
  {
    "text": "going to hurt yourself so that was a",
    "start": "1155640",
    "end": "1158360"
  },
  {
    "text": "very easy option to enable but then the",
    "start": "1158360",
    "end": "1160480"
  },
  {
    "text": "SR team started to complain that their",
    "start": "1160480",
    "end": "1162480"
  },
  {
    "text": "rules were failing because they couldn't",
    "start": "1162480",
    "end": "1165520"
  },
  {
    "text": "hurt Thanos",
    "start": "1165520",
    "end": "1166840"
  },
  {
    "text": "anymore so you have to find a balance",
    "start": "1166840",
    "end": "1170200"
  },
  {
    "text": "between your users and the system that",
    "start": "1170200",
    "end": "1172280"
  },
  {
    "text": "you're running right so that's just one",
    "start": "1172280",
    "end": "1174120"
  },
  {
    "text": "thing I would say when you implement",
    "start": "1174120",
    "end": "1176440"
  },
  {
    "text": "this make sure the users are happy and",
    "start": "1176440",
    "end": "1178280"
  },
  {
    "text": "the",
    "start": "1178280",
    "end": "1179159"
  },
  {
    "text": "system but that that works really well",
    "start": "1179159",
    "end": "1181320"
  },
  {
    "text": "for us since then we've had no kind of",
    "start": "1181320",
    "end": "1183159"
  },
  {
    "text": "uh issues with the receives oing it's",
    "start": "1183159",
    "end": "1184799"
  },
  {
    "text": "been very very",
    "start": "1184799",
    "end": "1185880"
  },
  {
    "text": "good another thing um we previously ran",
    "start": "1185880",
    "end": "1189400"
  },
  {
    "text": "with Dynamic",
    "start": "1189400",
    "end": "1191320"
  },
  {
    "text": "scaling now this is maybe a bit more um",
    "start": "1191320",
    "end": "1195240"
  },
  {
    "text": "this is maybe more specific for our use",
    "start": "1195240",
    "end": "1197080"
  },
  {
    "text": "case but you usually receives go away",
    "start": "1197080",
    "end": "1199880"
  },
  {
    "text": "one at a time so usually when we roll",
    "start": "1199880",
    "end": "1201840"
  },
  {
    "text": "out and what happens when you lose a",
    "start": "1201840",
    "end": "1205400"
  },
  {
    "text": "receive and dynamic scaling is enabled",
    "start": "1205400",
    "end": "1207679"
  },
  {
    "text": "is it actually gets dropped from the",
    "start": "1207679",
    "end": "1209600"
  },
  {
    "text": "hashing and that means that the",
    "start": "1209600",
    "end": "1211559"
  },
  {
    "text": "receivers kind of redistribute all the",
    "start": "1211559",
    "end": "1213039"
  },
  {
    "text": "metrics right even though it's a",
    "start": "1213039",
    "end": "1215240"
  },
  {
    "text": "consistent hash ring still there's some",
    "start": "1215240",
    "end": "1216960"
  },
  {
    "text": "there's some metrics some samples which",
    "start": "1216960",
    "end": "1218440"
  },
  {
    "text": "will go to different receives and so",
    "start": "1218440",
    "end": "1220559"
  },
  {
    "text": "when the receiver comes back actually",
    "start": "1220559",
    "end": "1222200"
  },
  {
    "text": "enters back into the hash ring",
    "start": "1222200",
    "end": "1224919"
  },
  {
    "text": "um what we found is it's more stable if",
    "start": "1224919",
    "end": "1227440"
  },
  {
    "text": "you don't have Dynamic scaling and you",
    "start": "1227440",
    "end": "1231760"
  },
  {
    "text": "actually run with a replication factor",
    "start": "1231760",
    "end": "1233159"
  },
  {
    "text": "of three then you can actually handle",
    "start": "1233159",
    "end": "1235080"
  },
  {
    "text": "the loss of the receive so then you",
    "start": "1235080",
    "end": "1237280"
  },
  {
    "text": "don't have sort of samples all across",
    "start": "1237280",
    "end": "1239559"
  },
  {
    "text": "all the tsbs um and this ends up being",
    "start": "1239559",
    "end": "1243200"
  },
  {
    "text": "more stable for our situation but we're",
    "start": "1243200",
    "end": "1245679"
  },
  {
    "text": "kind of Lucky in that we can talk to the",
    "start": "1245679",
    "end": "1247679"
  },
  {
    "text": "service teams we can say Hey you notice",
    "start": "1247679",
    "end": "1249320"
  },
  {
    "text": "there's a spike in your metrics do we",
    "start": "1249320",
    "end": "1250720"
  },
  {
    "text": "need to scale up is that going to be a",
    "start": "1250720",
    "end": "1252000"
  },
  {
    "text": "permanent thing um obviously your",
    "start": "1252000",
    "end": "1254760"
  },
  {
    "text": "mileage may",
    "start": "1254760",
    "end": "1257320"
  },
  {
    "text": "vary",
    "start": "1257600",
    "end": "1259919"
  },
  {
    "text": "okay where are we we're getting to the",
    "start": "1259919",
    "end": "1261679"
  },
  {
    "text": "end for good measure now I didn't really",
    "start": "1261679",
    "end": "1264000"
  },
  {
    "text": "talk about out of order rights but this",
    "start": "1264000",
    "end": "1265440"
  },
  {
    "text": "is a feature which I didn't know existed",
    "start": "1265440",
    "end": "1267679"
  },
  {
    "text": "um I think it's actually hidden flag so",
    "start": "1267679",
    "end": "1270600"
  },
  {
    "text": "this is a very useful feature which will",
    "start": "1270600",
    "end": "1273120"
  },
  {
    "text": "enable outof order rights uh for",
    "start": "1273120",
    "end": "1275120"
  },
  {
    "text": "incoming samples so that gives you some",
    "start": "1275120",
    "end": "1277960"
  },
  {
    "text": "sort of uh window when you can actually",
    "start": "1277960",
    "end": "1280720"
  },
  {
    "text": "ship samples out of order that's what it",
    "start": "1280720",
    "end": "1282559"
  },
  {
    "text": "does right um this is useful especially",
    "start": "1282559",
    "end": "1285480"
  },
  {
    "text": "as we're using Telegraph and Telegraph",
    "start": "1285480",
    "end": "1287320"
  },
  {
    "text": "doesn't really have any guarantees I",
    "start": "1287320",
    "end": "1288799"
  },
  {
    "text": "think on the um the order of the metrics",
    "start": "1288799",
    "end": "1292000"
  },
  {
    "text": "which are",
    "start": "1292000",
    "end": "1293080"
  },
  {
    "text": "ingested or order of the samples",
    "start": "1293080",
    "end": "1296279"
  },
  {
    "text": "sorry so yeah I mean this is wrapping up",
    "start": "1296279",
    "end": "1300000"
  },
  {
    "text": "um I think the main takeaway is that",
    "start": "1300000",
    "end": "1302200"
  },
  {
    "text": "building a resilient multi- tented",
    "start": "1302200",
    "end": "1303960"
  },
  {
    "text": "pipeline is quite hard I I was confident",
    "start": "1303960",
    "end": "1307960"
  },
  {
    "text": "back in November I'm not so confident",
    "start": "1307960",
    "end": "1309520"
  },
  {
    "text": "anymore there's a lot to learn um that's",
    "start": "1309520",
    "end": "1311679"
  },
  {
    "text": "a good thing right we learn from",
    "start": "1311679",
    "end": "1312960"
  },
  {
    "text": "incidents um we can do our best to",
    "start": "1312960",
    "end": "1315760"
  },
  {
    "text": "protect the receives the receives must",
    "start": "1315760",
    "end": "1317279"
  },
  {
    "text": "be protected uh at the same time I think",
    "start": "1317279",
    "end": "1320039"
  },
  {
    "text": "what would be interesting is to revisit",
    "start": "1320039",
    "end": "1321640"
  },
  {
    "text": "the Bubble Up approach for errors um",
    "start": "1321640",
    "end": "1324320"
  },
  {
    "text": "this is how the receives determine which",
    "start": "1324320",
    "end": "1326600"
  },
  {
    "text": "error to return when you have",
    "start": "1326600",
    "end": "1328559"
  },
  {
    "text": "replication enabled and you have",
    "start": "1328559",
    "end": "1329840"
  },
  {
    "text": "multiple rights um there's sort of maybe",
    "start": "1329840",
    "end": "1332720"
  },
  {
    "text": "some work which could be done there to",
    "start": "1332720",
    "end": "1334000"
  },
  {
    "text": "enumerate all the different",
    "start": "1334000",
    "end": "1335200"
  },
  {
    "text": "possibilities of Errors rather than",
    "start": "1335200",
    "end": "1337320"
  },
  {
    "text": "relying on some kind of bubble up logic",
    "start": "1337320",
    "end": "1340279"
  },
  {
    "text": "that would be very interesting to dig",
    "start": "1340279",
    "end": "1341559"
  },
  {
    "text": "into and as we saw in the previous talk",
    "start": "1341559",
    "end": "1344039"
  },
  {
    "text": "I think that it would be quite exciting",
    "start": "1344039",
    "end": "1346039"
  },
  {
    "text": "to experiment with the new tenant",
    "start": "1346039",
    "end": "1348679"
  },
  {
    "text": "queries um because maybe then we can",
    "start": "1348679",
    "end": "1350720"
  },
  {
    "text": "protect ourselves a little bit",
    "start": "1350720",
    "end": "1352600"
  },
  {
    "text": "better anyway thank you that's been the",
    "start": "1352600",
    "end": "1355039"
  },
  {
    "text": "incident and uh let's go to",
    "start": "1355039",
    "end": "1359630"
  },
  {
    "text": "[Music]",
    "start": "1359630",
    "end": "1360120"
  },
  {
    "text": "[Applause]",
    "start": "1360120",
    "end": "1367360"
  },
  {
    "text": "lunch thanks jel for that amazing um",
    "start": "1367360",
    "end": "1371480"
  },
  {
    "text": "incident",
    "start": "1371480",
    "end": "1372520"
  },
  {
    "text": "debugging uh any",
    "start": "1372520",
    "end": "1375960"
  },
  {
    "text": "questions or answers answers would be",
    "start": "1376039",
    "end": "1378520"
  },
  {
    "text": "appreciate it that",
    "start": "1378520",
    "end": "1381440"
  },
  {
    "text": "too um did you say that you went away",
    "start": "1386279",
    "end": "1389600"
  },
  {
    "text": "from replication Factor 2 and you now",
    "start": "1389600",
    "end": "1392279"
  },
  {
    "text": "now we're on replication Factor 3",
    "start": "1392279",
    "end": "1393679"
  },
  {
    "text": "exactly do you think application factor",
    "start": "1393679",
    "end": "1395480"
  },
  {
    "text": "of two should not even be",
    "start": "1395480",
    "end": "1397279"
  },
  {
    "text": "allowed yeah I mean that's I had a slide",
    "start": "1397279",
    "end": "1400200"
  },
  {
    "text": "that said that and then I had to cut it",
    "start": "1400200",
    "end": "1401919"
  },
  {
    "text": "um I think that we should solve that",
    "start": "1401919",
    "end": "1403520"
  },
  {
    "text": "issue definitely like that issue is",
    "start": "1403520",
    "end": "1405120"
  },
  {
    "text": "still open um what like in The Proposal",
    "start": "1405120",
    "end": "1408559"
  },
  {
    "text": "replication so sorry to to give some",
    "start": "1408559",
    "end": "1410919"
  },
  {
    "text": "background context in the proposal for",
    "start": "1410919",
    "end": "1413840"
  },
  {
    "text": "um for the receives right for the remote",
    "start": "1413840",
    "end": "1416360"
  },
  {
    "text": "right it was mentioned about replication",
    "start": "1416360",
    "end": "1419080"
  },
  {
    "text": "factor and there the formula was given",
    "start": "1419080",
    "end": "1420720"
  },
  {
    "text": "that would make replication Factor two a",
    "start": "1420720",
    "end": "1422679"
  },
  {
    "text": "kind of valid replication Factor um so",
    "start": "1422679",
    "end": "1425679"
  },
  {
    "text": "for replication Factor two you would",
    "start": "1425679",
    "end": "1427159"
  },
  {
    "text": "have a quorum of one now the that's",
    "start": "1427159",
    "end": "1431080"
  },
  {
    "text": "actually a bit different to I think how",
    "start": "1431080",
    "end": "1432240"
  },
  {
    "text": "normal quorums work but for Thanos maybe",
    "start": "1432240",
    "end": "1434760"
  },
  {
    "text": "it kind of makes sense that replication",
    "start": "1434760",
    "end": "1436440"
  },
  {
    "text": "Factor 2 should have a quorum of one",
    "start": "1436440",
    "end": "1437960"
  },
  {
    "text": "like it would reduce costs it would be",
    "start": "1437960",
    "end": "1439520"
  },
  {
    "text": "sort of a reasonable approach maybe um I",
    "start": "1439520",
    "end": "1442200"
  },
  {
    "text": "think we can definitely revisit the",
    "start": "1442200",
    "end": "1443400"
  },
  {
    "text": "issue we should",
    "start": "1443400",
    "end": "1446039"
  },
  {
    "text": "yeah cool any other",
    "start": "1446039",
    "end": "1450600"
  },
  {
    "text": "questions yeah if not maybe we can start",
    "start": "1452520",
    "end": "1455679"
  },
  {
    "text": "with the",
    "start": "1455679",
    "end": "1458039"
  },
  {
    "text": "[Applause]",
    "start": "1458700",
    "end": "1461960"
  },
  {
    "text": "closing",
    "start": "1461960",
    "end": "1464960"
  }
]