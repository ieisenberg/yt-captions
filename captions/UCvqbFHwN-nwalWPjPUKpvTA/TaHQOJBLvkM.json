[
  {
    "start": "0",
    "end": "93000"
  },
  {
    "text": "everyone settled I'll I'll start so before I start I'd like to thank Kelsey",
    "start": "0",
    "end": "5730"
  },
  {
    "text": "for actually basically forcing me to submit this proposal and then Michelle for reviewing it before I submitted as",
    "start": "5730",
    "end": "12059"
  },
  {
    "text": "she gave some awesome feedback so before we start there's not a lot of people in the room so we can do a poll how many of",
    "start": "12059",
    "end": "18210"
  },
  {
    "text": "you actually running bezos and marathon in production okay well everyone's here so the via the maze of the marathon",
    "start": "18210",
    "end": "23340"
  },
  {
    "text": "people already okay great so this talk is about moving from mazes to kubernetes",
    "start": "23340",
    "end": "29210"
  },
  {
    "text": "without anyone noticing and without anyone noticing part is in asterisks because there are some conditions applied my name is Misha I used to work",
    "start": "29210",
    "end": "37290"
  },
  {
    "text": "for a company called HootSuite I was in the pair I was in the production operations and delivery team which was",
    "start": "37290",
    "end": "43379"
  },
  {
    "text": "basically responsible for building our micro services platform on mazes and marathon and then we migrated it to",
    "start": "43379",
    "end": "48899"
  },
  {
    "text": "kubernetes so a bit of a context HootSuite is a social media management tool that lets you manage a different",
    "start": "48899",
    "end": "54539"
  },
  {
    "text": "social media accounts in one place and we have things like sentiment analysis analytics scheduling and things like",
    "start": "54539",
    "end": "60000"
  },
  {
    "text": "that we have or north of 15 million customers with 800 of the thousand 14 companies using us where I work now I'll",
    "start": "60000",
    "end": "68010"
  },
  {
    "text": "talk about it at the end it's not relevant right now I also work and maintain a project called Atlantis which",
    "start": "68010",
    "end": "74340"
  },
  {
    "text": "is basically a terraform workflow to my contribution to the kubernetes community",
    "start": "74340",
    "end": "80040"
  },
  {
    "text": "has been basically being part of the community for a year talking meetups in conferences about kubernetes and the",
    "start": "80040",
    "end": "85470"
  },
  {
    "text": "cloud native tools my small code contribution is in helm bunch of butt fixes hopefully in the future I can kind",
    "start": "85470",
    "end": "91829"
  },
  {
    "text": "of contribute to kubernetes upstream so one kind of disclaimer this talk is not a kubernetes versus meso stack both",
    "start": "91829",
    "end": "99720"
  },
  {
    "start": "99000",
    "end": "161000"
  },
  {
    "text": "these platforms are great we already know the platform that's better right I'm just the the agenda for this talk is",
    "start": "99720",
    "end": "108030"
  },
  {
    "text": "basically who's whose journey from moving from mazes to kubernetes it's very much a user story and then we're",
    "start": "108030",
    "end": "114390"
  },
  {
    "text": "kind of before we get into actually like the the implementation details will kind of explore the micro services pipeline",
    "start": "114390",
    "end": "120390"
  },
  {
    "text": "and it turns out like the abstractions that we build in the micro service pipeline actually helped us move away",
    "start": "120390",
    "end": "125579"
  },
  {
    "text": "from mazes they're math on very easily then we'll kind of talk about things that we did to kind of minimize",
    "start": "125579",
    "end": "130830"
  },
  {
    "text": "disruption then I'll dare to do a live demo for you which is actually moving a service from mr. kubernetes similar to what we did at",
    "start": "130830",
    "end": "138130"
  },
  {
    "text": "HootSuite and then we'll kind of conclude where the lessons learned and conclusion it's a bit of a context",
    "start": "138130",
    "end": "143740"
  },
  {
    "text": "HootSuite now is hundred twenty plus developers with 60 plus micro services written in both Scala and golang we have",
    "start": "143740",
    "end": "150790"
  },
  {
    "text": "two cluster schedulers which includes mezzos and kubernetes major still runs our Jenkins pipeline and kubernetes runs",
    "start": "150790",
    "end": "157150"
  },
  {
    "text": "are stateless workload and we have 1,500 plus servers all running on Amazon so before we even get to schedulers it's",
    "start": "157150",
    "end": "163870"
  },
  {
    "start": "161000",
    "end": "300000"
  },
  {
    "text": "really important to understand like how things before and will give you a really good like kind of like where we were before and like why we moved to",
    "start": "163870",
    "end": "169989"
  },
  {
    "text": "schedulers so 2014 you know we was just starting to do micro services a developer would ask for a micro service",
    "start": "169989",
    "end": "176830"
  },
  {
    "text": "suddenly an operator would appear with like five screens I don't know why they have so many screens and and then you",
    "start": "176830",
    "end": "182290"
  },
  {
    "text": "had to actually explain the operators you know why why we're going to towards SOA why we want to do a microscope for",
    "start": "182290",
    "end": "188680"
  },
  {
    "text": "Microsoft architecture and then in the end of the like the conv conversation would be like hey just create me a zero ticket and you",
    "start": "188680",
    "end": "195580"
  },
  {
    "text": "get your service so minutes later the developer will just create the ticket and then this amazing conversation would",
    "start": "195580",
    "end": "201190"
  },
  {
    "text": "start on JIRA but like a common thread like hey how many CPUs do you want how many servers do you want and like how",
    "start": "201190",
    "end": "206620"
  },
  {
    "text": "much memory do you want and things like that and then somehow you'd end up in confluence like a developer had to write",
    "start": "206620",
    "end": "213010"
  },
  {
    "text": "an ops run book which is basically before they actually build a service you have to define how the service would operate so you basically hit every other",
    "start": "213010",
    "end": "220450"
  },
  {
    "text": "Atlassian tool that's there in your company before hitting like actually creating a micro service and this is our",
    "start": "220450",
    "end": "225459"
  },
  {
    "text": "way of kind of giving back to the enterprise so weeks later the the servers would be ready and then the",
    "start": "225459",
    "end": "232480"
  },
  {
    "text": "developer at this at this point is like super sad like it's already taken weeks and all the wonders of micro service in",
    "start": "232480",
    "end": "238120"
  },
  {
    "text": "production and then on top of that we were doing Scala micro services back then so they actually needed to install",
    "start": "238120",
    "end": "243850"
  },
  {
    "text": "Java so need to write some ansible also write write some sensory checks to monitor the service and then on top of",
    "start": "243850",
    "end": "249700"
  },
  {
    "text": "that create a Jenkins pipeline to deploy to go servers so all that work was still to be done and it's already been weeks",
    "start": "249700",
    "end": "255400"
  },
  {
    "text": "so overall this situation isn't good right like it's not happiness right the whole promise of micro service is not",
    "start": "255400",
    "end": "261579"
  },
  {
    "text": "basically happening so fast forward a couple of years 2016 2017",
    "start": "261579",
    "end": "267150"
  },
  {
    "text": "still want microsomes I hope they keep one they love micro-services and then in",
    "start": "267150",
    "end": "272280"
  },
  {
    "text": "this time like five minutes later they actually able to deploy the micro service to production without any talking to anyone so why the five",
    "start": "272280",
    "end": "280050"
  },
  {
    "text": "minutes part isn't interesting the part that's interesting is actually the cells of nature of the platform and that was",
    "start": "280050",
    "end": "285600"
  },
  {
    "text": "one of the keys to how we actually migrated off of the platform as well so the micro service pipeline for HootSuite",
    "start": "285600",
    "end": "291240"
  },
  {
    "text": "look we've basically made up of these big things one was the project generator one was the idea of pipeline has code",
    "start": "291240",
    "end": "297270"
  },
  {
    "text": "and then the actual platform which was mezzos and Mathon so the project skeleton is basically the first thing",
    "start": "297270",
    "end": "304470"
  },
  {
    "start": "300000",
    "end": "370000"
  },
  {
    "text": "that a developer would interact with it was as a group at HootSuite we came to a consensus that we want to build micro",
    "start": "304470",
    "end": "310979"
  },
  {
    "text": "services a certain way so we basically chose the languages we chose the libraries we chose the structure of",
    "start": "310979",
    "end": "316350"
  },
  {
    "text": "micro services and we created a git repo and committed that to basically get so a developer would clone this repo and",
    "start": "316350",
    "end": "322199"
  },
  {
    "text": "provide things like you know the the service names and the like the nice names descriptions the maintainer of the",
    "start": "322199",
    "end": "328169"
  },
  {
    "text": "service and choose a language and then part of that project was also a go binary you just run that binary it would",
    "start": "328169",
    "end": "333930"
  },
  {
    "text": "actually generate you a fully functional micro service in Cola or Scala and with",
    "start": "333930",
    "end": "339210"
  },
  {
    "text": "bunch of other stuff so what was another part of this like the the repo was the actual Jenkins file so you can actually",
    "start": "339210",
    "end": "344849"
  },
  {
    "text": "define your whole micro service pipeline in Jenkins using Jenkins files so it stages like build test and deploy and it",
    "start": "344849",
    "end": "351810"
  },
  {
    "text": "may be in the future when we were actually migrating off of off of mazes to cover this this would be super useful",
    "start": "351810",
    "end": "357510"
  },
  {
    "text": "and you see how once you commit this Jenkins file to get it automatically",
    "start": "357510",
    "end": "362669"
  },
  {
    "text": "like Jenkins I can scan your organization and automatically build you a fully featured micro service pipeline",
    "start": "362669",
    "end": "367830"
  },
  {
    "text": "with like build test features and things like that we also in terms of like the actual micro service we as I said we both Scala",
    "start": "367830",
    "end": "374970"
  },
  {
    "start": "370000",
    "end": "393000"
  },
  {
    "text": "and golang micro services early on at HootSuite maybe made a decision that we want to kind of unify the packaging",
    "start": "374970",
    "end": "381060"
  },
  {
    "text": "format and we decided that hey like we'll use docker for kind of unifying that we embrace the polyglot nature of",
    "start": "381060",
    "end": "387000"
  },
  {
    "text": "what our Microsoft is were going to be in the future and we decided like docker is gonna be the way we kind of want to",
    "start": "387000",
    "end": "392490"
  },
  {
    "text": "manage those dependencies in terms of the deployment files we also have the deployment files checked in as part of",
    "start": "392490",
    "end": "398700"
  },
  {
    "start": "393000",
    "end": "421000"
  },
  {
    "text": "this project so it has like things like replica and resources and memory and things like that health checks define already as",
    "start": "398700",
    "end": "405030"
  },
  {
    "text": "part of them so this is all generated for you and this is again important in the in the next few steps and then we",
    "start": "405030",
    "end": "411300"
  },
  {
    "text": "also have the makefile this is just the ease-of-use thing you know to do things like building your service testing it deploying it to dev staging in",
    "start": "411300",
    "end": "417510"
  },
  {
    "text": "production we just have simple targets that is just defined in a make file in terms of the platform we run both mesas",
    "start": "417510",
    "end": "424110"
  },
  {
    "start": "421000",
    "end": "441000"
  },
  {
    "text": "math and some of you actually did not raise your hand I'll just like kind of mention what makes with mesas these mesas is basically the resource manager",
    "start": "424110",
    "end": "430950"
  },
  {
    "text": "that pulls all these like different notes together and makes them feel like one machine and then Marathon is the framework that sits on top of mazes and",
    "start": "430950",
    "end": "437040"
  },
  {
    "text": "lets you schedule like long living workloads and things like health checks and stuff like that so our set up was",
    "start": "437040",
    "end": "442830"
  },
  {
    "start": "441000",
    "end": "464000"
  },
  {
    "text": "pretty straightforward there's nothing special here we had like three four masters or whatever and they were running the mazes master process and",
    "start": "442830",
    "end": "449310"
  },
  {
    "text": "then math on alongside it and then we had slaves that were running the maze of slave and then the docker container so",
    "start": "449310",
    "end": "454860"
  },
  {
    "text": "with the way this worked is Jenkins would just say make deploy dev staging and production this post call would come",
    "start": "454860",
    "end": "460320"
  },
  {
    "text": "in and this container will be scheduled somewhere in the menos cluster and that's how we kind of did things so now",
    "start": "460320",
    "end": "466260"
  },
  {
    "start": "464000",
    "end": "481000"
  },
  {
    "text": "if you're using schedulers you probably have more than one service running in there so so to route between these",
    "start": "466260",
    "end": "472560"
  },
  {
    "text": "services like how did the actual mazes driving work this is where things get interesting and I'll kind of spend more time in routing and show you guys how",
    "start": "472560",
    "end": "479280"
  },
  {
    "text": "the actual migration happened to in there in the next few slides so we kind of said that okay we're gonna do this",
    "start": "479280",
    "end": "485520"
  },
  {
    "start": "481000",
    "end": "572000"
  },
  {
    "text": "like fat middle way approach or the service proxy or the service match there's so many names for it now but we",
    "start": "485520",
    "end": "490800"
  },
  {
    "text": "kind of decided on on doing that really early on and we chose engine acts as a service proxy and then we chose console",
    "start": "490800",
    "end": "497580"
  },
  {
    "text": "which is a 2 by Hoshi comp to do our service discovery for us so kind of connected all the containers for",
    "start": "497580",
    "end": "504240"
  },
  {
    "text": "us together so let's say a service one would come up on some major slave we use registrated to kind of register that one",
    "start": "504240",
    "end": "510300"
  },
  {
    "text": "docker container in console and that that consoles now that service is now available for console and you can kind",
    "start": "510300",
    "end": "515550"
  },
  {
    "text": "of interface with it using a DNS interface or an HTTP interface and now the way the way the actual routing would",
    "start": "515550",
    "end": "521940"
  },
  {
    "text": "work is let's say if this service two was to talk to service one service two would just do a simple localhost call on",
    "start": "521940",
    "end": "528150"
  },
  {
    "text": "a special board called 5040 which expands to s or a out and then you and",
    "start": "528150",
    "end": "533610"
  },
  {
    "text": "it's basically a path based right like right this is just a simple girl path pace car service is hard-coded",
    "start": "533610",
    "end": "539070"
  },
  {
    "text": "there the name of the service you want to talk to you and the actual end point you want to talk to then Ingenix would already have this upstream defined using",
    "start": "539070",
    "end": "545910"
  },
  {
    "text": "console because console is kind of discovering those those docker containers for us and then this engine X router would forward call to that the",
    "start": "545910",
    "end": "552510"
  },
  {
    "text": "the other engine next router that's actually running this this workload and also there's a translation here like we",
    "start": "552510",
    "end": "557940"
  },
  {
    "text": "convert the call from HTTP to HTTPS and then take the request in a special port called 5041 which is SOA in so you kind",
    "start": "557940",
    "end": "565529"
  },
  {
    "text": "of get the idea there and then what happens is this engine deck started just proxy forwards this call up to the the",
    "start": "565529",
    "end": "571140"
  },
  {
    "text": "actual instance that's running so all this is great you guys are like okay you actually had a great platform you know what did you guys do next we spend a lot",
    "start": "571140",
    "end": "578100"
  },
  {
    "start": "572000",
    "end": "654000"
  },
  {
    "text": "of a lot of time on actually getting this adoption like going at HootSuite so spend a lot of time writing great",
    "start": "578100",
    "end": "583890"
  },
  {
    "text": "documentation getting deep teams on board and guess where and so by the way this graph is the service adoption",
    "start": "583890",
    "end": "590339"
  },
  {
    "text": "basically that's the number of services and that is the actual actual timeline",
    "start": "590339",
    "end": "595410"
  },
  {
    "text": "so this is where we did the zero to five minutes thing you can see like immediately everyone wants to use micro service they want to write it on the",
    "start": "595410",
    "end": "601589"
  },
  {
    "text": "scheduler so at this point sorry that was Nikki at this point we have great",
    "start": "601589",
    "end": "607440"
  },
  {
    "text": "autonomy in the company our service platform is doing really well everyone loves us right developers are loving the",
    "start": "607440",
    "end": "613770"
  },
  {
    "text": "the whole new platform five minutes thing because it took weeks so there was a lot at stake when we said like let's",
    "start": "613770",
    "end": "619140"
  },
  {
    "text": "move to kubernetes and now you guys will ask why did you actually move to kubernetes we actually talked about it",
    "start": "619140",
    "end": "624209"
  },
  {
    "text": "we wrote a pretty in-depth blog about why we compared all these scheduled the cluster managers and schedulers and",
    "start": "624209",
    "end": "630390"
  },
  {
    "text": "decided on kubernetes so at the end i'll link this to the two slides in the end so you can kind of go through it i'm not",
    "start": "630390",
    "end": "636300"
  },
  {
    "text": "going to go into the exact reasons why we did but basically it came down to kubernetes had the right attractions and",
    "start": "636300",
    "end": "642060"
  },
  {
    "text": "primitives for us to build basically a micro service on and we resonated that as as as a business and also also in",
    "start": "642060",
    "end": "649529"
  },
  {
    "text": "terms of like the developer tooling and the ecosystem it's amazing that you pretty much get everything for free so",
    "start": "649529",
    "end": "654720"
  },
  {
    "text": "it took us four months and was three of us luckily I have both of these guys here so mark and Luke also here so if",
    "start": "654720",
    "end": "660690"
  },
  {
    "text": "you have any questions after the doc you can ask them as well so my whole team is here is awesome it took us four months and we got Cuban",
    "start": "660690",
    "end": "667800"
  },
  {
    "text": "Aires running in for on Amazon we told Kelsey he was super happy I think you did that like in my",
    "start": "667800",
    "end": "673829"
  },
  {
    "text": "mind he was doing this basically so it was super it was a awesome day and it was actually time to move these books",
    "start": "673829",
    "end": "679709"
  },
  {
    "text": "now right so now we have all the stuff running in mazes we first need to deploy that in kubernetes right second thing we",
    "start": "679709",
    "end": "686339"
  },
  {
    "text": "need to figure out routing you have to route from mazes to kubernetes and also stuff that's outside of mazes into",
    "start": "686339",
    "end": "691649"
  },
  {
    "text": "communities as well and then the developers that that want to use a new kubernetes platform have to adopt that",
    "start": "691649",
    "end": "697379"
  },
  {
    "text": "and I kind of learned about the platform there's great kubernetes documentation but there are some implementation details on how you would roll that out",
    "start": "697379",
    "end": "704100"
  },
  {
    "text": "in your company so you know you have to basically lay that out for them as well so the way we kind of solve these problems is it's interesting so like the",
    "start": "704100",
    "end": "711119"
  },
  {
    "text": "mazes the mazes math or platform was composed of these things right project skeleton the pipeline is called docker",
    "start": "711119",
    "end": "716879"
  },
  {
    "text": "containers and then the dynamic service is covered using console and nginx pretty much everything was used to move",
    "start": "716879",
    "end": "723269"
  },
  {
    "text": "off of basis as well so each of these things were actually important to move off of it and then we also wrote some",
    "start": "723269",
    "end": "729059"
  },
  {
    "text": "great documentation to get started on kubernetes and then we wrote a tool called mazes to kubernetes and I'll explain what that was so the first thing",
    "start": "729059",
    "end": "736169"
  },
  {
    "text": "was like once you start looking at like these mazes projects we had to actually migrate them we started writing out",
    "start": "736169",
    "end": "741239"
  },
  {
    "text": "these kubernetes llaman files and i'm like how do we do that like we were doing that manually every time so when",
    "start": "741239",
    "end": "746639"
  },
  {
    "text": "we would do a pull request like I think Luke actually just pointers like we should just automate this like we're doing this every time we know how both's",
    "start": "746639",
    "end": "753149"
  },
  {
    "text": "both schemas look like so we wrote a simple golang binary that you can download and you can just run it on your",
    "start": "753149",
    "end": "758429"
  },
  {
    "text": "project it would read all the major marathon deployment files and write the kubernetes llam√≥ files for you because",
    "start": "758429",
    "end": "763889"
  },
  {
    "text": "we kind of knew how the structure was in terms of the actual deployment files we also added some new simple targets in",
    "start": "763889",
    "end": "770309"
  },
  {
    "text": "the make file that you saw earlier so we just added targets for deploy here it's dev staging so basically at both",
    "start": "770309",
    "end": "776279"
  },
  {
    "text": "clusters running at the same time so in terms of the actual pipeline we end up deploying to both the platforms so we",
    "start": "776279",
    "end": "783600"
  },
  {
    "start": "778000",
    "end": "797000"
  },
  {
    "text": "duplicated the workload we deployed everything in in kubernetes as well so once we migrated deploy everything but",
    "start": "783600",
    "end": "788850"
  },
  {
    "text": "the the tricky thing is like we only route it to mazes first so basically everything was as it is for all the",
    "start": "788850",
    "end": "794189"
  },
  {
    "text": "dependent services and the service that was to be moved so it does the packaging",
    "start": "794189",
    "end": "799259"
  },
  {
    "start": "797000",
    "end": "816000"
  },
  {
    "text": "Scallon golang micro service pack is using docker container this is the benefit right here that you",
    "start": "799259",
    "end": "804900"
  },
  {
    "text": "can actually move this taka-kun district kubernetes you don't have to figure out the implementation details for Scala or",
    "start": "804900",
    "end": "810420"
  },
  {
    "text": "golang which is really nice both both mazes marathon and kubernetes understand our containers so this is the benefit",
    "start": "810420",
    "end": "816150"
  },
  {
    "start": "816000",
    "end": "1016000"
  },
  {
    "text": "there in terms of routing as I said that the workload is duplicated in both places you already understand how the",
    "start": "816150",
    "end": "822930"
  },
  {
    "text": "routing works in mazes tomatoes so basically we spin down the major side and the Kuban each side is already",
    "start": "822930",
    "end": "828540"
  },
  {
    "text": "running and it also has that nginx router and console so console discovers the kubernetes nodes and make them",
    "start": "828540",
    "end": "834510"
  },
  {
    "text": "available in the backends for nginx and nginx basically does a routing call translation in you see how so let's see",
    "start": "834510",
    "end": "840810"
  },
  {
    "text": "if the service let's say that the service to was to be calling service one again say would again do that localhost",
    "start": "840810",
    "end": "847320"
  },
  {
    "text": "call which is pretty much the same for the service but this time you see there's no upstream back in available so",
    "start": "847320",
    "end": "853290"
  },
  {
    "text": "it's one because it doesn't exist in in mazes anymore and you would go to this special back and call the bridge and",
    "start": "853290",
    "end": "859170"
  },
  {
    "text": "this is again an implementation detail you don't have to do this we have of something called a bridge which is again",
    "start": "859170",
    "end": "864960"
  },
  {
    "text": "powered by nginx and console and it basically lets you bridge the blade literally bridge the gap between two",
    "start": "864960",
    "end": "870270"
  },
  {
    "text": "data centers so with console we kind of went Greenfield we said ok we're gonna set up a fully functional V PC and its",
    "start": "870270",
    "end": "876210"
  },
  {
    "text": "own network its own networking and then spin up kubernetes so be basically treated it as a different data center so",
    "start": "876210",
    "end": "882720"
  },
  {
    "text": "what would happen with the request is it would get translated to the bridge the bridge you say ok I'm trying to find micro services this name in your data",
    "start": "882720",
    "end": "889560"
  },
  {
    "text": "center I couldn't find it and then with this this simple dumb routing we said everything else should just go to kubernetes so this is a pretty like a",
    "start": "889560",
    "end": "896250"
  },
  {
    "text": "decision that we made because we kind of understand how a micro service is work and at this point it ends up in the",
    "start": "896250",
    "end": "901320"
  },
  {
    "text": "kubernetes side here the engine extract it just translates the request to to actually say that see the kubernetes",
    "start": "901320",
    "end": "907620"
  },
  {
    "text": "like conformant request so at that point it's just Kubb dns coop dns kicking in but with the service name default SVC",
    "start": "907620",
    "end": "914730"
  },
  {
    "text": "the console local and then a port 8080 basically so at that point kubernetes takes over it basically goes to the",
    "start": "914730",
    "end": "921360"
  },
  {
    "text": "service the kubernetes service and the service forwards using IP tables into the part so it's pretty straightforward so on the other side the service",
    "start": "921360",
    "end": "927930"
  },
  {
    "text": "actually didn't the service too did not notice that this sir was actually got moved and it's still doing that localhost path based call it didn't",
    "start": "927930",
    "end": "934800"
  },
  {
    "text": "realize that this new service is now there's nothing special on the suicide and this is where the service meshes and",
    "start": "934800",
    "end": "940050"
  },
  {
    "text": "service proxies actually shine that the applications don't have to can be super dumb and the mesh can do the the crazy",
    "start": "940050",
    "end": "946710"
  },
  {
    "text": "routing for you in terms of roll back this is interesting we we basically had",
    "start": "946710",
    "end": "952710"
  },
  {
    "text": "it so that the routing as I said earlier would always prefer mazes first so in this case if there was something",
    "start": "952710",
    "end": "958590"
  },
  {
    "text": "something went wrong we would just spend these workloads back up in math on and all that routing would just still work",
    "start": "958590",
    "end": "964140"
  },
  {
    "text": "so you would just end up hitting the major side basically so how did the",
    "start": "964140",
    "end": "969180"
  },
  {
    "text": "service calls go outside so if gaps let's say service one running in kubernetes and it was to be called some",
    "start": "969180",
    "end": "974220"
  },
  {
    "text": "food service which is running ec2 or mazes the way routing worked is we just basically fake the community service so",
    "start": "974220",
    "end": "980400"
  },
  {
    "text": "we created a community service with the name foo and then we just forward it all the traffic on a special port 50 40",
    "start": "980400",
    "end": "986430"
  },
  {
    "text": "which would go to the local engine X router and then once once that cold call was made this request could get forward",
    "start": "986430",
    "end": "992100"
  },
  {
    "text": "the intern X here then we had this amazing glorified reg X which mark wrote which would just translate the call into",
    "start": "992100",
    "end": "998010"
  },
  {
    "text": "the path based call again so you would end up with some requests looking like the path based request again outside",
    "start": "998010",
    "end": "1003110"
  },
  {
    "text": "from nginx but go to the bridge bridge again knows how to route this and it would route that to do the actual",
    "start": "1003110",
    "end": "1009650"
  },
  {
    "text": "service this is how we kind of do things and this was kind of married because you had to create a list of all the micro-services dependencies before okay",
    "start": "1009650",
    "end": "1017540"
  },
  {
    "start": "1016000",
    "end": "1048000"
  },
  {
    "text": "so in terms of the project skeleton which is like the basically where a developer starts their microservice",
    "start": "1017540",
    "end": "1022970"
  },
  {
    "text": "journey what we did is we had a branch for this like basically get branch that was doing the kubernetes animators both",
    "start": "1022970",
    "end": "1029180"
  },
  {
    "text": "both the things and maybe pretty confident we basically delayed deleted the major side we wanted to make sure",
    "start": "1029180",
    "end": "1034430"
  },
  {
    "text": "that all the new services that were getting spun up would actually end up in kubernetes so we just merge that branch",
    "start": "1034430",
    "end": "1039740"
  },
  {
    "text": "and boom like all the new services were now getting created in kubernetes I've been really care because we don't want",
    "start": "1039740",
    "end": "1045319"
  },
  {
    "text": "to create technical debt and move those services again this is I think the most important part like in the whole",
    "start": "1045320",
    "end": "1051260"
  },
  {
    "start": "1048000",
    "end": "1094000"
  },
  {
    "text": "presentation the documentation whenever you bring in something new you really need to write documentation that's",
    "start": "1051260",
    "end": "1057500"
  },
  {
    "text": "readable that's something that people can follow so we created a dock that would just basically give you add option",
    "start": "1057500",
    "end": "1063320"
  },
  {
    "text": "to the new plot platform so you'd say okay how to create a service in Cuban Ares how do you call it how does login work",
    "start": "1063320",
    "end": "1068390"
  },
  {
    "text": "in Cuban Ares how alerting work and things like that on the other side we also created a doctor my grade and you see that warning right",
    "start": "1068390",
    "end": "1074810"
  },
  {
    "text": "there it says talk to us first which is basically our team just so that we can onboard them to the new platform try to",
    "start": "1074810",
    "end": "1080180"
  },
  {
    "text": "get kind of give them tips how to migrate the service in terms of the actual migration implementation detail we wrote everything down in the doc and",
    "start": "1080180",
    "end": "1086750"
  },
  {
    "text": "literally like that bash commands that you have to run all the stuff that I just talked about they can just follow through and do it if it's a simple",
    "start": "1086750",
    "end": "1092990"
  },
  {
    "text": "service all right so now we come to the important part which is the actual live demo let's all bow our heads to the demo",
    "start": "1092990",
    "end": "1099830"
  },
  {
    "start": "1094000",
    "end": "1460000"
  },
  {
    "text": "God which is Kelsey here right okay let's do this okay so here I have here I",
    "start": "1099830",
    "end": "1107420"
  },
  {
    "text": "have them at three node mezzos marathon cluster it's very low scale like this is not how fish run stuff back home and",
    "start": "1107420",
    "end": "1114170"
  },
  {
    "text": "then kubernetes as just a one node cluster and then we have console basically so that's marathon nothing is",
    "start": "1114170",
    "end": "1119930"
  },
  {
    "text": "running there that's console there's only two services that are about console service itself and then the two services are the",
    "start": "1119930",
    "end": "1125930"
  },
  {
    "text": "kubernetes services that are being kind of discovered dynamically so we can discover that kubernetes node dynamically okay so in terms of the",
    "start": "1125930",
    "end": "1133400"
  },
  {
    "text": "actual micro service today we're gonna migrate it's called cube contrary 17 it's a simple like calling service I'll just show you the code there's nothing",
    "start": "1133400",
    "end": "1139850"
  },
  {
    "text": "exciting here basically what we're doing is we're returning back response with a random name that we are generating and",
    "start": "1139850",
    "end": "1145820"
  },
  {
    "text": "then the host name of that instance that's running it so we can kind of know where it app is running so so it's clear",
    "start": "1145820",
    "end": "1151520"
  },
  {
    "text": "to us okay so let's go back here okay yeah so I've already built the docker",
    "start": "1151520",
    "end": "1156710"
  },
  {
    "text": "image for this for the stuff so we don't waste time and we won't be using any CI CD pipeline so if you won't be going",
    "start": "1156710",
    "end": "1162500"
  },
  {
    "text": "through Jenkins and stuff because it just takes longer okay so in terms of right now we have the maser disbarment",
    "start": "1162500",
    "end": "1167690"
  },
  {
    "text": "file so if you look at that deploy folder it has like the major's mazes JSON file let me just get that for you",
    "start": "1167690",
    "end": "1174640"
  },
  {
    "text": "yeah so it's a simple mazes you know Jason file it you probably know okay and",
    "start": "1174640",
    "end": "1180290"
  },
  {
    "text": "then we have the make few make targets here so we're just deploying to production one environment and we'll",
    "start": "1180290",
    "end": "1185420"
  },
  {
    "text": "just say make deploy production and that should go to and that should actually",
    "start": "1185420",
    "end": "1191570"
  },
  {
    "text": "spin this up in Marathon yeah this is deploying that and thing and we have two healthy instances of this app running and then also consoles automatically",
    "start": "1191570",
    "end": "1198650"
  },
  {
    "text": "detected this new container containers and then they would just register the httpservlet that attack HTTP service",
    "start": "1198650",
    "end": "1205760"
  },
  {
    "text": "and would run on mazes master one and three so that's that's all working this is using the register basically so okay",
    "start": "1205760",
    "end": "1211790"
  },
  {
    "text": "that's all good that that all works let's see if the actual routing works inside of mazes so let's go to a mezzos",
    "start": "1211790",
    "end": "1216920"
  },
  {
    "text": "master and like try to hit the service using that path based thing so if I go up here hopefully I'm a history so here",
    "start": "1216920",
    "end": "1222860"
  },
  {
    "text": "I'm doing a localhost call on 50 40 as you can see slash service is static here and then the name of the service is cube",
    "start": "1222860",
    "end": "1228590"
  },
  {
    "text": "contouring 17 so we're gonna do this you can actually see this routing is actually working it's responding with",
    "start": "1228590",
    "end": "1234410"
  },
  {
    "text": "some random names and their host name and what's special here is this header called exile skyline driver ingress and",
    "start": "1234410",
    "end": "1239660"
  },
  {
    "text": "egress we just inject that in engine X skyline is the name of the framework that we call internally and here I'm",
    "start": "1239660",
    "end": "1246170"
  },
  {
    "text": "we're just always preferring the local the local instance since I own master one and this container exists so I'm not",
    "start": "1246170",
    "end": "1251750"
  },
  {
    "text": "going out of the machine I'm just hitting the container that's inside you can just do that with simple waiting on",
    "start": "1251750",
    "end": "1257000"
  },
  {
    "text": "on on on nginx back-end basically so that so that all works so rabbiting works for me so this curl call is",
    "start": "1257000",
    "end": "1263000"
  },
  {
    "text": "actually acting as like the dependent service that's hidden mezzos that that coupe con 2070 service this is the",
    "start": "1263000",
    "end": "1269270"
  },
  {
    "text": "dependent service which shouldn't notice anything basically okay so now we've set this up now we'll actually start doing",
    "start": "1269270",
    "end": "1274580"
  },
  {
    "text": "this migration which is the interesting part let's go back here okay so the first thing we'll do is translate the",
    "start": "1274580",
    "end": "1280580"
  },
  {
    "text": "file from from basically write the cuban aires files so we will use the the Mazeroski h2 this is not this I'm just",
    "start": "1280580",
    "end": "1287780"
  },
  {
    "text": "faking this this is not the actual tool I don't work at HootSuite anymore as I said so this is just a simple go like",
    "start": "1287780",
    "end": "1292790"
  },
  {
    "text": "manage this output stuff this is just gonna output saying here like you know I just generated the kubernetes folder for",
    "start": "1292790",
    "end": "1298400"
  },
  {
    "text": "you I'm just moving a file in the background basically so I'm being super transparent with you guys so not faking",
    "start": "1298400",
    "end": "1303560"
  },
  {
    "text": "anything by the way so okay here we go so here's here's the Cuban air is Jason yeah Mel file so let's just get that -",
    "start": "1303560",
    "end": "1311120"
  },
  {
    "text": "yeah this is pretty simple here we have a service that we're creating and then also the deployment and this in in real",
    "start": "1311120",
    "end": "1317000"
  },
  {
    "text": "life we actually use ham charts but it for this demo purposes I'm just generated in Y on the files ok so now",
    "start": "1317000",
    "end": "1323090"
  },
  {
    "text": "next thing we'll actually add the make targets so if you go to the the make",
    "start": "1323090",
    "end": "1328580"
  },
  {
    "text": "file here I will just uncomment this which is deployed kay it's okay",
    "start": "1328580",
    "end": "1335900"
  },
  {
    "text": "okay so I'm just doing a coupe CDL apply in real life as I said we use ham charts which basically translates the certain",
    "start": "1335900",
    "end": "1343400"
  },
  {
    "text": "variables that you define your new service which in Yama format and injects that to the helm chart and this is",
    "start": "1343400",
    "end": "1348920"
  },
  {
    "text": "nothing special here you do make you just run this make deploy hits so now",
    "start": "1348920",
    "end": "1357350"
  },
  {
    "text": "it's created the service of kubernetes we do cube CTL rusty here we go yeah actually yeah",
    "start": "1357350",
    "end": "1364820"
  },
  {
    "text": "pods in service yeah so it's created the coupon service and also the actual part for those services again two instances",
    "start": "1364820",
    "end": "1371090"
  },
  {
    "text": "were created at this point to the routing if you see like nothing still like nothing's going to kubernetes yet",
    "start": "1371090",
    "end": "1376370"
  },
  {
    "text": "right like you're still preferring mezzos because this exists in Bezos oh yeah now this is the the nerve-racking",
    "start": "1376370",
    "end": "1382580"
  },
  {
    "text": "part this is where we scale this thing down to zero and wait and one Wi-Fi so",
    "start": "1382580",
    "end": "1388670"
  },
  {
    "text": "please Wi-Fi don't you know okay so that's gone and then in console we see",
    "start": "1388670",
    "end": "1393920"
  },
  {
    "text": "the service go away basically so this console local DC says okay we don't have this service anymore now if you go back",
    "start": "1393920",
    "end": "1400550"
  },
  {
    "text": "to to here routing here you see the ingress is going to kubernetes now so seamlessly this is moved you might see",
    "start": "1400550",
    "end": "1406520"
  },
  {
    "text": "some upstream errors based on the way you shutdown containers and things like that you can do some smart free tries on",
    "start": "1406520",
    "end": "1412400"
  },
  {
    "text": "it but for the demo purposes I wasn't doing it so if we were to see this demo like as soon as I changed it you will see some upstream errors five or tubes",
    "start": "1412400",
    "end": "1419179"
  },
  {
    "text": "or something but here you see that ingress is actually going to Cuban Aires now and then the the pod name at the pod",
    "start": "1419179",
    "end": "1424340"
  },
  {
    "text": "name is basically the host name for the container okay so let's say if something really bad happens as soon as you see it",
    "start": "1424340",
    "end": "1429770"
  },
  {
    "text": "like this the engineer see like this error rates go up and things like that if you just scale this back again right",
    "start": "1429770",
    "end": "1435410"
  },
  {
    "text": "like well just get me back aware of where I was just scale this back to two again okay yeah so this healthy",
    "start": "1435410",
    "end": "1443120"
  },
  {
    "text": "containers here let's go here Yukon again this the service is available and you see we're back on",
    "start": "1443120",
    "end": "1448730"
  },
  {
    "text": "mazes so basically that's like the the rollback mechanism so that is what I",
    "start": "1448730",
    "end": "1454160"
  },
  {
    "text": "have for the demo let's go back to the presentation again Kelsey is still chilling yeah so in terms of the",
    "start": "1454160",
    "end": "1461600"
  },
  {
    "start": "1460000",
    "end": "1477000"
  },
  {
    "text": "migration results we we migrated move 20 services and one and a half months with",
    "start": "1461600",
    "end": "1468110"
  },
  {
    "text": "three people loop being like the technical lead and then the two interns that basically moved most of our services which is not the",
    "start": "1468110",
    "end": "1475559"
  },
  {
    "text": "best but yeah I wouldn't advise on that but yeah it does the the things going really well like sometimes things",
    "start": "1475559",
    "end": "1480630"
  },
  {
    "start": "1477000",
    "end": "1547000"
  },
  {
    "text": "actually don't go that well and I'll talk about like what went wrong things weren't as seamless as this seemed we we",
    "start": "1480630",
    "end": "1487799"
  },
  {
    "text": "had like - I guess like two outages that you kind of remember one was what I call a bad configure which which is when we",
    "start": "1487799",
    "end": "1494730"
  },
  {
    "text": "moved these services to kubernetes we were using kubernetes environment variables to kind of inject the config",
    "start": "1494730",
    "end": "1499950"
  },
  {
    "text": "based on environment and things like that and one of the variables was basically how the routing the external routing",
    "start": "1499950",
    "end": "1506610"
  },
  {
    "text": "works like that the fake service fubar and stuff so we basically misspelled that or something happened like that I",
    "start": "1506610",
    "end": "1512640"
  },
  {
    "text": "don't exactly remember and then we couldn't route from like the service that was inside of kubernetes outside",
    "start": "1512640",
    "end": "1517710"
  },
  {
    "text": "like and I was like as simple as that is just a human error second one is like the classic security group you know a",
    "start": "1517710",
    "end": "1523679"
  },
  {
    "text": "white listing error which is happens all the time in Amazon so let's say a service in Bezos was using an RDS",
    "start": "1523679",
    "end": "1530280"
  },
  {
    "text": "database and we have a whole like security groups white listing that - the white RDS database we moved it to Cuba",
    "start": "1530280",
    "end": "1535890"
  },
  {
    "text": "net he's forgot to whitelist a database you know the cars got the call starts failing in and we moved it back we",
    "start": "1535890",
    "end": "1541020"
  },
  {
    "text": "rolled it back so yeah - two big things that cause like decent amount of impact but overall it was pretty like seamless",
    "start": "1541020",
    "end": "1547440"
  },
  {
    "text": "so what were the lessons that we kind of learned and this is where like I feel like the technical implementation",
    "start": "1547440",
    "end": "1553110"
  },
  {
    "text": "details don't really matter so much but like the high-level stuff matters so cheese Jews always choose the least",
    "start": "1553110",
    "end": "1558600"
  },
  {
    "start": "1554000",
    "end": "1575000"
  },
  {
    "text": "important service first this is pretty common pretty simple to do this is",
    "start": "1558600",
    "end": "1563700"
  },
  {
    "text": "important because you want to basically make sure that there's no business impact when you do these big translations and kind of understand like",
    "start": "1563700",
    "end": "1569880"
  },
  {
    "text": "there's so many things that you won't realize you can't foresee this will hug and of help you you know debug that",
    "start": "1569880",
    "end": "1575480"
  },
  {
    "start": "1575000",
    "end": "1586000"
  },
  {
    "text": "always have a rollback plan you know in our case like things went wrong bunch of times we had to rollback bunch of times",
    "start": "1575480",
    "end": "1582120"
  },
  {
    "text": "so yeah having that mezzos fallback was awesome in terms of writing down like",
    "start": "1582120",
    "end": "1588270"
  },
  {
    "start": "1586000",
    "end": "1607000"
  },
  {
    "text": "the actual deployment pipeline so sometimes you have to actually visualize how your deployment works because there might be different flavors of you know",
    "start": "1588270",
    "end": "1595770"
  },
  {
    "text": "services getting deployed so it's nice to write it down and then kind of feel figure out where you can abstract things",
    "start": "1595770",
    "end": "1601770"
  },
  {
    "text": "they can inject think so to make the degradation like basically small in terms of documentation it",
    "start": "1601770",
    "end": "1608729"
  },
  {
    "start": "1607000",
    "end": "1620000"
  },
  {
    "text": "should be readable for humans don't do like a brain dump this is how I did it and these are the batch commands explain",
    "start": "1608729",
    "end": "1613919"
  },
  {
    "text": "why you did it this is really really important especially when we were having interns kind of go through and do that",
    "start": "1613919",
    "end": "1619469"
  },
  {
    "text": "right in terms of being pragmatic I think this is another important thing nothing is like it's like usually you",
    "start": "1619469",
    "end": "1625379"
  },
  {
    "start": "1620000",
    "end": "1637000"
  },
  {
    "text": "won't get services that I built exact same way sometimes you actually have to go in and write some code so it's okay",
    "start": "1625379",
    "end": "1631169"
  },
  {
    "text": "to do that there's going to be some special service we all have them and you can just go in and do that it's totally",
    "start": "1631169",
    "end": "1636539"
  },
  {
    "text": "okay this is I feel is like the most important part is like minimizing disruption I've said this multiple times",
    "start": "1636539",
    "end": "1642599"
  },
  {
    "start": "1637000",
    "end": "1701000"
  },
  {
    "text": "but I can't emphasize this enough this is for both the services and actually the people the service part is like",
    "start": "1642599",
    "end": "1649169"
  },
  {
    "text": "basically making sure that the dependence is dependent services aren't seeing anything any errors and things like that but for people you can't be",
    "start": "1649169",
    "end": "1656190"
  },
  {
    "text": "asking like developers to do these migrations ask the product manager and ask for like bunch of story points and stuff like they won't you know they",
    "start": "1656190",
    "end": "1662700"
  },
  {
    "text": "don't like that they already have stuff to do right so you want to make sure that make sure that you know this the",
    "start": "1662700",
    "end": "1668339"
  },
  {
    "text": "the disruption of actual like the work flow is also like minimize and we focused on it a lot like we made it so",
    "start": "1668339",
    "end": "1674039"
  },
  {
    "text": "that it's actually similar to be wrote tools that would make the make the translation easy and that actually helps with a great adoption of a new platform",
    "start": "1674039",
    "end": "1680659"
  },
  {
    "text": "it's really easy to tarnish like an image of a new tool like you bring in kubernetes and then you move the service",
    "start": "1680659",
    "end": "1687149"
  },
  {
    "text": "and it causes outage everyone's like oh kubernetes actually causes outages and it's like a civil it wouldn't be",
    "start": "1687149",
    "end": "1692519"
  },
  {
    "text": "kubernetes fault it would be something else and you really want to you really want to make sure that that that image",
    "start": "1692519",
    "end": "1697679"
  },
  {
    "text": "is is maintained and so that with that way you can drive an option basically so in terms of links I have a link for that",
    "start": "1697679",
    "end": "1703679"
  },
  {
    "start": "1701000",
    "end": "1726000"
  },
  {
    "text": "blog post of like why we moved to kubernetes I also have a link to the",
    "start": "1703679",
    "end": "1709589"
  },
  {
    "text": "abstraction that we built on top of marathon I think that's important because if we kind of kind of define everything in Yammer as you saw in the",
    "start": "1709589",
    "end": "1716249"
  },
  {
    "text": "in the slide but in the real life I was using JSON files so we kind of abstracted that out in an API and then",
    "start": "1716249",
    "end": "1721440"
  },
  {
    "text": "consoles link which basically helped us link between infrastructures from both mesas and kubernetes side so thank you",
    "start": "1721440",
    "end": "1728039"
  },
  {
    "text": "really appreciated appreciate you guys coming out this is the last thing where I work in which I said I won't talk about I'm joining hash you go up as a",
    "start": "1728039",
    "end": "1734249"
  },
  {
    "text": "developer advocate I'm super excited to meet you and talk about hash acog Jules thank you",
    "start": "1734249",
    "end": "1741028"
  },
  {
    "text": "if you have time for questions I don't know yeah here we go we have time for questions structure",
    "start": "1742200",
    "end": "1757119"
  },
  {
    "text": "side of the migration right how do you went from a mrs. Kloster to equities right so in terms of the actual major",
    "start": "1757119",
    "end": "1763570"
  },
  {
    "text": "side mirror side of the infrastructure was basically built using terraform and and was the three nodes with some slaves",
    "start": "1763570",
    "end": "1771039"
  },
  {
    "text": "with some console nodes and stuff that was like the backbone basically and we used terraform for like writing all the",
    "start": "1771039",
    "end": "1776889"
  },
  {
    "text": "defined things on defined things on like all amazing stuff and then we use Packer to kind of build these images and use",
    "start": "1776889",
    "end": "1783249"
  },
  {
    "text": "ansible to pretty much do all I can take management so it's pretty pretty much like on in an auto scaling group like",
    "start": "1783249",
    "end": "1788980"
  },
  {
    "text": "the the Masters one in the auto scaling group the slaves were and they were imaged so you can actually like and when and you know what would come up the",
    "start": "1788980",
    "end": "1794710"
  },
  {
    "text": "slave could just add itself to the mazes master in which is work on the kubernetes side we took as I said a Greenfield approach so we created all",
    "start": "1794710",
    "end": "1801460"
  },
  {
    "text": "the way down from the V PC to the actual nodes again we managed everything ourselves using terraform and then",
    "start": "1801460",
    "end": "1807489"
  },
  {
    "text": "everything was in auto scaling group so the API server the the slaves the NC",
    "start": "1807489",
    "end": "1813519"
  },
  {
    "text": "Dino's even that was tricky and hopefully he eventually blog about everybody should and then what was",
    "start": "1813519",
    "end": "1819789"
  },
  {
    "text": "interesting was like the we also generate like asserts for every",
    "start": "1819789",
    "end": "1824799"
  },
  {
    "text": "component of kubernetes using wall so we generate basically dynamic search for every component so you spend a lot of",
    "start": "1824799",
    "end": "1830529"
  },
  {
    "text": "lot that's what took us so long took us long time to kind of get to a production ready kubernetes cluster managed by us",
    "start": "1830529",
    "end": "1835779"
  },
  {
    "text": "and we use an overlay to do the networking views planner to network between in between the kubernetes no now",
    "start": "1835779",
    "end": "1840879"
  },
  {
    "text": "you can Amazon services out so we will see see how that goes I'm sure these guys have made the right decision so",
    "start": "1840879",
    "end": "1846609"
  },
  {
    "text": "it's up to them okay anyone else everyone's happy with maze okay great",
    "start": "1846609",
    "end": "1855149"
  },
  {
    "text": "thanks guys thanks really appreciate you spending some time",
    "start": "1855149",
    "end": "1860009"
  }
]