[
  {
    "start": "0",
    "end": "463000"
  },
  {
    "text": "see we get started now Wow it's crazy to see so many people here in this room wow",
    "start": "149",
    "end": "5759"
  },
  {
    "text": "this is pretty exciting thank you so much for coming to our talk my name is",
    "start": "5759",
    "end": "12059"
  },
  {
    "text": "leta and this is Jose and we're going to be presenting to you a case study of how",
    "start": "12059",
    "end": "17609"
  },
  {
    "text": "lyft is migrating over to kubernetes specific specifically on the networking",
    "start": "17609",
    "end": "23730"
  },
  {
    "text": "side so we'll be talking about like how we're handling network traffic and how about handling service discovery in this",
    "start": "23730",
    "end": "30420"
  },
  {
    "text": "new kubernetes world there's many parts to a cooperate migration so there's like",
    "start": "30420",
    "end": "35700"
  },
  {
    "text": "the deployment phase as well as the provisioning stage and security groups but we don't have time to cover all of",
    "start": "35700",
    "end": "41820"
  },
  {
    "text": "that so it's very good specifically if you'd be talking about the networking portion of it so a little brief intro to",
    "start": "41820",
    "end": "49260"
  },
  {
    "text": "who we are my name is leta I really like boba so that icon drives with me very",
    "start": "49260",
    "end": "55410"
  },
  {
    "text": "much I'm in the networking team for a year and a half now I like working on",
    "start": "55410",
    "end": "63390"
  },
  {
    "text": "like many different things but mostly on like operating on voice and lately like",
    "start": "63390",
    "end": "69140"
  },
  {
    "text": "integrating kubernetes with our service mesh and creating the networking portion of them creating a migration plan for",
    "start": "69140",
    "end": "76170"
  },
  {
    "text": "the networking portion and I've been that live for a long time like a four and a half years and half of my time at",
    "start": "76170",
    "end": "81750"
  },
  {
    "text": "lyft I've been in product I have launched lyft line and then the second half has been in infrastructure so it's",
    "start": "81750",
    "end": "87930"
  },
  {
    "text": "been pretty great to be able to take all my learnings from product and bring them over to infrastructure la before left I",
    "start": "87930",
    "end": "95040"
  },
  {
    "text": "came from a computer graphics background so I worked at DreamWorks Animation working on like render farms and",
    "start": "95040",
    "end": "101640"
  },
  {
    "text": "rendering algorithms as well as like making tooling for artists to ship out a",
    "start": "101640",
    "end": "107610"
  },
  {
    "text": "movie look a children's movie every like every year and my name is Jose and I've",
    "start": "107610",
    "end": "114030"
  },
  {
    "text": "been at lift and with the networking team for about two and a half years in",
    "start": "114030",
    "end": "119130"
  },
  {
    "text": "that time I've done a lot of adult with a lot of aspects of our networking",
    "start": "119130",
    "end": "124500"
  },
  {
    "text": "topology all the way from the data plane to building lives new control plane platform",
    "start": "124500",
    "end": "130340"
  },
  {
    "text": "as well as being a nun boy maintainer so we've broken up this talk to like three",
    "start": "130340",
    "end": "136220"
  },
  {
    "text": "pieces so first we want to give you some context of why I love doing this kubernetes migration migrations are",
    "start": "136220",
    "end": "142370"
  },
  {
    "text": "expensive they take a lot of engineering time and they're and they take up a lot",
    "start": "142370",
    "end": "148940"
  },
  {
    "text": "of resources so we want to explain why we decided to do this and what are the visit business benefits secondly we",
    "start": "148940",
    "end": "155959"
  },
  {
    "text": "wanted to talk about give you context about our network topology is like and what our service mesh is like in the old",
    "start": "155959",
    "end": "161900"
  },
  {
    "text": "legacy system and then how we're transitioning it into this hybrid world of like kubernetes in our legacy system",
    "start": "161900",
    "end": "167959"
  },
  {
    "text": "and lastly we want to share with you some lessons learned so that when you decide to do your own kubernetes",
    "start": "167959",
    "end": "174019"
  },
  {
    "text": "migration you could take these lessons with you and take some of our learnings",
    "start": "174019",
    "end": "179209"
  },
  {
    "text": "so you don't have to relearn them twice so let's dive into it so like so we're",
    "start": "179209",
    "end": "185780"
  },
  {
    "text": "gonna dive into why lyft decide to do this migration in the first place cuz yeah again migrations are expensive it's",
    "start": "185780",
    "end": "193519"
  },
  {
    "text": "easier to just to maintain our legacy system so what made us decide to pay",
    "start": "193519",
    "end": "198950"
  },
  {
    "text": "this cost now at the size that we are and move over to kubernetes so I'm gonna",
    "start": "198950",
    "end": "204290"
  },
  {
    "text": "give a little bit of context business-wise so looked it's a very real-time system and we usually can",
    "start": "204290",
    "end": "210410"
  },
  {
    "text": "predict when our peak events are from historical data but sometimes we can't",
    "start": "210410",
    "end": "215959"
  },
  {
    "text": "always do that right so we have this so there's a particular day I remember the",
    "start": "215959",
    "end": "221720"
  },
  {
    "text": "Mayweather vs McGregor fight it was a boxing match and it costs like $100 on",
    "start": "221720",
    "end": "227569"
  },
  {
    "text": "HBO to like watch and what tended to happen was people ended up gathering at",
    "start": "227569",
    "end": "233359"
  },
  {
    "text": "people's houses to watch it and like split the cost or go to a bar and watch it there and after like after the fight",
    "start": "233359",
    "end": "241459"
  },
  {
    "text": "was over everyone requested a ride all at the same time to go home and that is",
    "start": "241459",
    "end": "247190"
  },
  {
    "text": "when everyone did that like it wasn't it",
    "start": "247190",
    "end": "253849"
  },
  {
    "text": "wasn't very something that we were aware of because it was a one-off thing it didn't happen historically before it",
    "start": "253849",
    "end": "259820"
  },
  {
    "text": "was also a nationwide thing that was happen to be very popular but we didn't have any historical data",
    "start": "259820",
    "end": "265530"
  },
  {
    "text": "to like predict that and also we in our legacy infrastructure it's pretty",
    "start": "265530",
    "end": "271349"
  },
  {
    "text": "expensive like you know we use AWS ec2 instances and to launch that many instances it",
    "start": "271349",
    "end": "278550"
  },
  {
    "text": "takes around 20 minutes so like we couldn't like ceiling out fast this is something that that's that's what we",
    "start": "278550",
    "end": "286349"
  },
  {
    "text": "struggle with at that book that that birth bursty traffic but like in and if we were to try to handle this beforehand",
    "start": "286349",
    "end": "293759"
  },
  {
    "text": "we would basically have to be over provisioned and then like waste a lot of",
    "start": "293759",
    "end": "298819"
  },
  {
    "text": "waste a lot of resources like because we're not utilizing them efficiently and that's what kubernetes gives us right",
    "start": "298819",
    "end": "305550"
  },
  {
    "text": "like we're able to scale up pretty quickly and effectively user of use resources so we can handle these bursty",
    "start": "305550",
    "end": "312210"
  },
  {
    "text": "traffic scenarios secondly is we like",
    "start": "312210",
    "end": "317310"
  },
  {
    "text": "that criminals gives you a separation of concerns between your infrastructure code and your application layer so right",
    "start": "317310",
    "end": "326550"
  },
  {
    "text": "now in our legacy world we have this folder called ops folder and that's where all your orchestration files go",
    "start": "326550",
    "end": "333509"
  },
  {
    "text": "and also like you run a lot of infrastructure like processes on your",
    "start": "333509",
    "end": "338699"
  },
  {
    "text": "ec2 box so product engineers are the owners of these services and they still",
    "start": "338699",
    "end": "343740"
  },
  {
    "text": "have to be aware about what sidecar processes are running as well as like maintain this like configuration code to",
    "start": "343740",
    "end": "351240"
  },
  {
    "text": "like manage their manage their like what instance types are running or like",
    "start": "351240",
    "end": "356639"
  },
  {
    "text": "manage these like like these launch configurations and it's like something they don't use every day they like want",
    "start": "356639",
    "end": "363210"
  },
  {
    "text": "to program their application and business logic and then once a month or once every like two quarter they like",
    "start": "363210",
    "end": "369000"
  },
  {
    "text": "look at this and like oh we need to scale I forgot how to like I don't know what these terms mean I have to go look him",
    "start": "369000",
    "end": "374399"
  },
  {
    "text": "up so there's a lot of context switching happening here and in kubernetes everything all that info like in",
    "start": "374399",
    "end": "380149"
  },
  {
    "text": "kubernetes everything was in a container and you just own your application container so like they have a lot less",
    "start": "380149",
    "end": "387330"
  },
  {
    "text": "things to think about and all the infrastructure stuff can be run on separate containers in the same pod so",
    "start": "387330",
    "end": "392819"
  },
  {
    "text": "that's like that's pretty powerful like that's what we want you want the product engineers to think",
    "start": "392819",
    "end": "399330"
  },
  {
    "text": "about just their application and minimize the knowledge of infrastructure things that they need to need to do and",
    "start": "399330",
    "end": "406069"
  },
  {
    "text": "reduce that cognitive load lastly the biggest reason is kubernetes",
    "start": "406069",
    "end": "412229"
  },
  {
    "text": "gives you this immutable infrastructure due to the fact that you know like in our latest legacy infrastructure due to",
    "start": "412229",
    "end": "418529"
  },
  {
    "text": "the fact that what is it ec2 instances take a long time to spin up we can't",
    "start": "418529",
    "end": "426930"
  },
  {
    "text": "deploy like rotating aSG's because then a deployer would take a really long time",
    "start": "426930",
    "end": "432300"
  },
  {
    "text": "it will take probably an hour hours or so and so we want we value like",
    "start": "432300",
    "end": "437520"
  },
  {
    "text": "being able to deploy and roll back very quickly so we do upgrades in place but there's some downsides to that then one",
    "start": "437520",
    "end": "444180"
  },
  {
    "text": "main downside is that the fact that your scale-up code it's not necessary this lets the behavior of scale-up it's not",
    "start": "444180",
    "end": "450330"
  },
  {
    "text": "necessarily the same as your initial deploy and with communities because of the immutable infrastructure you get the",
    "start": "450330",
    "end": "456599"
  },
  {
    "text": "same no matter what so when you do the initial deploy it will behave the same as if it were scaling up or scaling down",
    "start": "456599",
    "end": "464419"
  },
  {
    "start": "463000",
    "end": "770000"
  },
  {
    "text": "all right so taking into account the gains that we would see in a kubernetes",
    "start": "464419",
    "end": "470009"
  },
  {
    "text": "infrastructure let's dive into what we have done from the networking perspective so unless you're starting",
    "start": "470009",
    "end": "477120"
  },
  {
    "text": "from scratch you will end up in this hybrid scenarios where you might have negative infrastructure and the",
    "start": "477120",
    "end": "482699"
  },
  {
    "text": "infrastructure that you're moving to and because we're real-time systems that can take down time we have to live this long",
    "start": "482699",
    "end": "489960"
  },
  {
    "text": "migrations so the focus that we want to do for the for the rest of the talk is",
    "start": "489960",
    "end": "496669"
  },
  {
    "text": "how do we deal with this hybrid environments in this hybrid infrastructure and the lens that we want",
    "start": "496669",
    "end": "502620"
  },
  {
    "text": "to look at that through is the lens of a networking team and more specifically how do we do service discovery in this",
    "start": "502620",
    "end": "508050"
  },
  {
    "text": "hybrid infrastructure so before we start with where we are today and where we're",
    "start": "508050",
    "end": "513930"
  },
  {
    "text": "going let's take a look at our network topology up until now envoy is a project",
    "start": "513930",
    "end": "521279"
  },
  {
    "text": "that came out of lyft and it is our networking proxy all the way from the",
    "start": "521279",
    "end": "526740"
  },
  {
    "text": "edge of our infrastructure to all of our services to also egress out of our infrastructure so",
    "start": "526740",
    "end": "533340"
  },
  {
    "text": "what we have here really is a universal network primitive all now our traffic",
    "start": "533340",
    "end": "538950"
  },
  {
    "text": "that flows through lifts flows through envoy and this will become very powerful as we move into this hybrid system",
    "start": "538950",
    "end": "546210"
  },
  {
    "text": "we'll see how today we're going to focus on the are the internal services that it",
    "start": "546210",
    "end": "553530"
  },
  {
    "text": "runs to run our platform and this is what we have deemed the service mesh so",
    "start": "553530",
    "end": "560880"
  },
  {
    "text": "before I go into talking more about service discovery I just want to do some novel setting and briefly discuss what",
    "start": "560880",
    "end": "566820"
  },
  {
    "text": "what service discovery yes so in elastic infrastructure it says you may know we have machines coming up and",
    "start": "566820",
    "end": "573960"
  },
  {
    "text": "shutting down all the time and so it is hard to pinpoint all the machines that",
    "start": "573960",
    "end": "580280"
  },
  {
    "text": "in a stable manner all the machines that might belong to a logical service so",
    "start": "580280",
    "end": "585960"
  },
  {
    "text": "what we do in service discovery is be able to pair a particular host or",
    "start": "585960",
    "end": "591450"
  },
  {
    "text": "particular IP addresses to a logical set of a service or an application so for",
    "start": "591450",
    "end": "597420"
  },
  {
    "text": "example in the left we might have three machines that are running a Python application all this machines belong to",
    "start": "597420",
    "end": "604110"
  },
  {
    "text": "you know service foo versus in the right we might have again three machines that",
    "start": "604110",
    "end": "610320"
  },
  {
    "text": "are running a go service and well there's three different machines with three IPS they all belong to the logical",
    "start": "610320",
    "end": "617100"
  },
  {
    "text": "service bar so let's look at what service discovery looked at lift before",
    "start": "617100",
    "end": "624260"
  },
  {
    "text": "kubernetes on the left here we have again three services that might be",
    "start": "624260",
    "end": "630840"
  },
  {
    "text": "composed of and/or a machines and on the right we have our legacy discovery",
    "start": "630840",
    "end": "637800"
  },
  {
    "text": "service which is a simple Python crud service backed by dynamodb the machines",
    "start": "637800",
    "end": "645000"
  },
  {
    "text": "in our service mesh run a cron job that every 30 seconds is registering the IP",
    "start": "645000",
    "end": "650580"
  },
  {
    "text": "of that particular machine with a host of metadata so the region that the",
    "start": "650580",
    "end": "656820"
  },
  {
    "text": "service might be running in the specific availability zone the identity that it",
    "start": "656820",
    "end": "663270"
  },
  {
    "text": "wants to pertain to in the mesh so bill I belong to service fou as well as",
    "start": "663270",
    "end": "669680"
  },
  {
    "text": "importantly the the IP address of that machine that's the right side of her",
    "start": "669680",
    "end": "678779"
  },
  {
    "text": "discovery service then on the right side the cyber envoy that runs next to all",
    "start": "678779",
    "end": "684750"
  },
  {
    "text": "the applications rediscovery data from",
    "start": "684750",
    "end": "691140"
  },
  {
    "text": "the discovery service so this is how envoy will know that for the logical service foo these are the 30 IP",
    "start": "691140",
    "end": "698550"
  },
  {
    "text": "addresses that belong to that service and and we will be able to load balanced requests from from that service on to",
    "start": "698550",
    "end": "705240"
  },
  {
    "text": "others in the mesh so the desired end",
    "start": "705240",
    "end": "711930"
  },
  {
    "text": "state that we have both in our legacy infrastructure and as we want to introduce infrastructure managed by",
    "start": "711930",
    "end": "718529"
  },
  {
    "text": "kubernetes is this this simple flow of requests",
    "start": "718529",
    "end": "724500"
  },
  {
    "text": "through the service mesh so we want request to flow through this I convoy",
    "start": "724500",
    "end": "729630"
  },
  {
    "text": "regardless of what application it might be or particularly what where that resource might be either in our AWS",
    "start": "729630",
    "end": "737130"
  },
  {
    "text": "infrastructure or in our Cooper various infrastructure so we won this is the",
    "start": "737130",
    "end": "742200"
  },
  {
    "text": "logical and state that we want even though behind the scenes we might have something like this where all the",
    "start": "742200",
    "end": "749070"
  },
  {
    "text": "resources that a service might have for the might be in kubernetes or you know",
    "start": "749070",
    "end": "754440"
  },
  {
    "text": "there might be another service that is all running in our legacy infrastructure or even and particularly interestingly",
    "start": "754440",
    "end": "760470"
  },
  {
    "text": "we might have a service that has both machines in our legacy infrastructure or",
    "start": "760470",
    "end": "766190"
  },
  {
    "text": "in kubernetes so really the goal that we",
    "start": "766190",
    "end": "773130"
  },
  {
    "start": "770000",
    "end": "879000"
  },
  {
    "text": "have as we move into this hybrid infrastructure is from the perspective",
    "start": "773130",
    "end": "778440"
  },
  {
    "text": "of product engineers we want to build a system that makes it easy for them to operate the network regardless of what",
    "start": "778440",
    "end": "784740"
  },
  {
    "text": "might be behind the scenes so this is the focus that the network and team has had ever since we were ever since we'd",
    "start": "784740",
    "end": "793500"
  },
  {
    "text": "begun and particularly for kubernetes we want to make this new infrastructure accessible",
    "start": "793500",
    "end": "798959"
  },
  {
    "text": "and easy to use while at the same time maintaining lives real-time system reliable so in particular for this",
    "start": "798959",
    "end": "808019"
  },
  {
    "text": "migration we have three three goals and on the Left we have the goal that we",
    "start": "808019",
    "end": "813689"
  },
  {
    "text": "have for product engineers this change as we move to new infrastructure has to",
    "start": "813689",
    "end": "818759"
  },
  {
    "text": "be transparent to them they they can we can burn our product engineers with",
    "start": "818759",
    "end": "823829"
  },
  {
    "text": "knowing the internals of our infrastructure for example when appropriate genera wants to make a",
    "start": "823829",
    "end": "829139"
  },
  {
    "text": "request a service foo they shouldn't need to think about is this request going to a pod managed by kubernetes or",
    "start": "829139",
    "end": "835620"
  },
  {
    "text": "to a virtual machine in AWS the request should be transparent they should they",
    "start": "835620",
    "end": "840720"
  },
  {
    "text": "should just send the request and it should be managed by by the proxy so",
    "start": "840720",
    "end": "845970"
  },
  {
    "text": "what that's the goal for that we have for product engineers we also us infrastructure engineers have two",
    "start": "845970",
    "end": "851509"
  },
  {
    "text": "particularly important goals to keep lift services and platform reliable the",
    "start": "851509",
    "end": "857399"
  },
  {
    "text": "first one is we want to design the system such that we can do an incremental rollout of this new",
    "start": "857399",
    "end": "862920"
  },
  {
    "text": "infrastructure and second while we try",
    "start": "862920",
    "end": "868500"
  },
  {
    "text": "to have the most reliable infrastructure and release it in safe ways we also need",
    "start": "868500",
    "end": "873509"
  },
  {
    "text": "to preserve the ability to rollback when problems occur so before we delve into",
    "start": "873509",
    "end": "882389"
  },
  {
    "text": "the solution that that we came up with I want to emphasize that what allows us to",
    "start": "882389",
    "end": "887910"
  },
  {
    "text": "do what allows us to design the system in the way that leaders going to explain is the fact that we have this universal",
    "start": "887910",
    "end": "894959"
  },
  {
    "text": "network primitive running alongside every single service at lift having an",
    "start": "894959",
    "end": "901470"
  },
  {
    "text": "voice as a sidecar next to every service abstracts the network from the service itself and allows us to do more",
    "start": "901470",
    "end": "908040"
  },
  {
    "text": "sophisticated routing regardless of where the resource might be and specifically what would what Android",
    "start": "908040",
    "end": "915209"
  },
  {
    "text": "provides to us that allows us to do this is the set of XDS API is that Android",
    "start": "915209",
    "end": "920490"
  },
  {
    "text": "has described which are a set of API is that can dynamically configure the proxy",
    "start": "920490",
    "end": "926240"
  },
  {
    "text": "from a centralized management server so here we're separate",
    "start": "926240",
    "end": "931470"
  },
  {
    "text": "the actual data plane that is that requests are flowing through from the",
    "start": "931470",
    "end": "936519"
  },
  {
    "text": "control plane that might configure how that data plane is is managing requests",
    "start": "936519",
    "end": "941529"
  },
  {
    "text": "so specifically for service discovery and what it has implemented implemented",
    "start": "941529",
    "end": "946769"
  },
  {
    "text": "the eds api which stands for endpoint discovery service endpoint is just a",
    "start": "946769",
    "end": "953439"
  },
  {
    "text": "specific entity that responds to a logical set of load balancing entities",
    "start": "953439",
    "end": "960749"
  },
  {
    "text": "so specifically the XDS api's are a set of G RPC API is that from a central",
    "start": "960749",
    "end": "968170"
  },
  {
    "text": "control plane can configure the data plane and it separates a concern of configuration from actual requests",
    "start": "968170",
    "end": "974949"
  },
  {
    "text": "person so I'm gonna go dive into like",
    "start": "974949",
    "end": "982300"
  },
  {
    "start": "977000",
    "end": "1231000"
  },
  {
    "text": "the hybrid service discovery service discovery architecture that we came up",
    "start": "982300",
    "end": "987970"
  },
  {
    "text": "with so as you are from before we although sidecar on voice running a",
    "start": "987970",
    "end": "994480"
  },
  {
    "text": "separate processes are registering the IP address of that machine into the crowd discovery service but now we also",
    "start": "994480",
    "end": "1001860"
  },
  {
    "text": "have these kubernetes clusters where where they we have multiple clusters and",
    "start": "1001860",
    "end": "1008999"
  },
  {
    "text": "there's a pot pocket we have services as pods and they are charted between mini",
    "start": "1008999",
    "end": "1014670"
  },
  {
    "text": "clusters and we design it that way so that if one cluster will go down we could still in encrypted entities we can",
    "start": "1014670",
    "end": "1020639"
  },
  {
    "text": "still serve traffic from the other clusters and there's a kubernetes api",
    "start": "1020639",
    "end": "1026038"
  },
  {
    "text": "server that is aware of the state of the cluster and so we migrated over to the",
    "start": "1026039",
    "end": "1033120"
  },
  {
    "text": "Envoy xes control plane which is a go service that had that is up created the",
    "start": "1033120",
    "end": "1040319"
  },
  {
    "text": "configuration to the new XDS api's and it's pulling in data from the old",
    "start": "1040319",
    "end": "1047520"
  },
  {
    "text": "discovery service and also making connections it uses the kubernetes watch",
    "start": "1047520",
    "end": "1053010"
  },
  {
    "text": "api's to get this get the IP addresses of each pods that of that cluster and",
    "start": "1053010",
    "end": "1059820"
  },
  {
    "text": "then converts all that data into and the eds configuration and sends that",
    "start": "1059820",
    "end": "1068440"
  },
  {
    "text": "off to the side car envoys and now that now that I have that data they know",
    "start": "1068440",
    "end": "1074350"
  },
  {
    "text": "about each other and they could start routing traffic to each other and know here the note here that in our",
    "start": "1074350",
    "end": "1081820"
  },
  {
    "text": "communities clusters there's no ingress controller the pods are able to get an",
    "start": "1081820",
    "end": "1087010"
  },
  {
    "text": "IP address that is aware in our V PC and so that means that the legacy machines",
    "start": "1087010",
    "end": "1092409"
  },
  {
    "text": "can talk to that pod directly and there's many reasons why we went with",
    "start": "1092409",
    "end": "1097539"
  },
  {
    "text": "this route there's a portion we don't have time to go over why we went that way today but if you want to talk about",
    "start": "1097539",
    "end": "1104289"
  },
  {
    "text": "how we did that and why we did that you could come talk to me or my colleague Paul is here and he'll be happily talk",
    "start": "1104289",
    "end": "1111100"
  },
  {
    "text": "to you about how we made that possible but yeah so at the end of the day that we because we are able to send those IP",
    "start": "1111100",
    "end": "1118570"
  },
  {
    "text": "addresses out to all the sidecar envoys they now form that mesh like like now there's no difference between the legacy",
    "start": "1118570",
    "end": "1125559"
  },
  {
    "text": "boxes versus the kubernetes boxes and they could have servers this can be split between kubernetes then and the",
    "start": "1125559",
    "end": "1132220"
  },
  {
    "text": "legacy infrastructure but we this at the end a day they get converted and merge and could serve traffic to each other",
    "start": "1132220",
    "end": "1137820"
  },
  {
    "text": "so like this is great so the reason why we went with this approach is the change",
    "start": "1137820",
    "end": "1143019"
  },
  {
    "text": "is transparent to the product engineers they could still write application code and resend a request and envoy will",
    "start": "1143019",
    "end": "1149559"
  },
  {
    "text": "figure out how to route that request to and send basically I get a response back",
    "start": "1149559",
    "end": "1156059"
  },
  {
    "text": "we can now do incremental rollouts because we can using envoys xes api's we",
    "start": "1156059",
    "end": "1163720"
  },
  {
    "text": "can like set priorities so we could put a lower priority on the kubernetes clusters or we can we can just scale up",
    "start": "1163720",
    "end": "1172659"
  },
  {
    "text": "fewer pods and then fewer traffic will go to those kubernetes clusters so like",
    "start": "1172659",
    "end": "1178480"
  },
  {
    "text": "we could slowly migrate old services over to kubernetes in a safe way and we're able to roll back as well so we",
    "start": "1178480",
    "end": "1188139"
  },
  {
    "text": "could there's all these kill switches we could use leverage as such I was like when if let's say we have a rollout of",
    "start": "1188139",
    "end": "1194139"
  },
  {
    "text": "bad kubernetes change we can fail checks on the on the services on",
    "start": "1194139",
    "end": "1199510"
  },
  {
    "text": "kubernetes and that all the traffic will be routed to the legacy infrastructure as well as we could just scale down and",
    "start": "1199510",
    "end": "1205270"
  },
  {
    "text": "then in kubernetes and the traffic will still get routed to the legacy",
    "start": "1205270",
    "end": "1210580"
  },
  {
    "text": "infrastructure which is pretty powerful so we'll go over the lessons learned as",
    "start": "1210580",
    "end": "1217240"
  },
  {
    "text": "we started this process and there's four main lessons that we want to share with",
    "start": "1217240",
    "end": "1223750"
  },
  {
    "text": "you as we went through changing our service discovery over to this hybrid",
    "start": "1223750",
    "end": "1229809"
  },
  {
    "text": "system so the first one that we want to talk about is eventual consistency it's",
    "start": "1229809",
    "end": "1236440"
  },
  {
    "start": "1231000",
    "end": "1377000"
  },
  {
    "text": "at friend or foe so the way that service discovery works in Envoy is it's an",
    "start": "1236440",
    "end": "1242350"
  },
  {
    "text": "eventual consistent system where it's the the ability of a particular Envoy to",
    "start": "1242350",
    "end": "1249039"
  },
  {
    "text": "route traffic to another envoy is based on on this matrix where it depends both",
    "start": "1249039",
    "end": "1254380"
  },
  {
    "text": "on the data that the discovery system is sending via the EDS API but also based",
    "start": "1254380",
    "end": "1261880"
  },
  {
    "text": "on the health check status between one envoy and the other one so as you can",
    "start": "1261880",
    "end": "1269470"
  },
  {
    "text": "see here in this in this table only if the health trick is passing then I'm",
    "start": "1269470",
    "end": "1275289"
  },
  {
    "text": "going to route traffic to to that particular box and importantly only if",
    "start": "1275289",
    "end": "1281710"
  },
  {
    "text": "the health check is failing on a particular host and that host is not",
    "start": "1281710",
    "end": "1286720"
  },
  {
    "text": "being delivered via the discovery system and we will prune that data out of out",
    "start": "1286720",
    "end": "1291789"
  },
  {
    "text": "of a set of hosts that it load manses traffic to the reason why this is particularly important in this migration",
    "start": "1291789",
    "end": "1297400"
  },
  {
    "text": "is that let's suppose that our discovery system as we move into this hybrid",
    "start": "1297400",
    "end": "1302860"
  },
  {
    "text": "ecosystem has a bug and can deliver host for the kubernetes clusters if envoy has",
    "start": "1302860",
    "end": "1311020"
  },
  {
    "text": "already known of that of those hosts in a previous deploy of the discovery",
    "start": "1311020",
    "end": "1316960"
  },
  {
    "text": "system then and we will still will still have that host in its local knowledge of",
    "start": "1316960",
    "end": "1324789"
  },
  {
    "text": "the mesh even if they discover if the discovery system is failing this allows us to more rely",
    "start": "1324789",
    "end": "1330940"
  },
  {
    "text": "and more confidently deployed changes our discovery system why I say it might",
    "start": "1330940",
    "end": "1339820"
  },
  {
    "text": "also be faux is that because we have an",
    "start": "1339820",
    "end": "1345160"
  },
  {
    "text": "eventually consistent discovery system as we roll out changes changes are not",
    "start": "1345160",
    "end": "1350170"
  },
  {
    "text": "impacting the entirety of the topology at once this changes take time to roll",
    "start": "1350170",
    "end": "1355330"
  },
  {
    "text": "out and so as an operator when you're deploying changes to service mesh you",
    "start": "1355330",
    "end": "1361000"
  },
  {
    "text": "might expect that metrics changed more rapidly that they actually do and so you",
    "start": "1361000",
    "end": "1367660"
  },
  {
    "text": "might have to be able to monitor and think about problems not immediately but",
    "start": "1367660",
    "end": "1372820"
  },
  {
    "text": "in in the long term as the mesh converges another important lesson that",
    "start": "1372820",
    "end": "1379540"
  },
  {
    "start": "1377000",
    "end": "1436000"
  },
  {
    "text": "we discussed as we were embarking on this migration is what I try to describe",
    "start": "1379540",
    "end": "1385840"
  },
  {
    "text": "as the golden egg problem is kind of like Indiana Jones where you're taking out the rock and put in you're taking",
    "start": "1385840",
    "end": "1392260"
  },
  {
    "text": "out the golden egg I'm putting the rock although hopefully we're doing it in the reverse order where the new system is",
    "start": "1392260",
    "end": "1397270"
  },
  {
    "text": "the golden egg but-but-but-but this really means for us is that we can take",
    "start": "1397270",
    "end": "1402940"
  },
  {
    "text": "down time and we can just have maintenance phones where we are shifting our infrastructure into first this",
    "start": "1402940",
    "end": "1409570"
  },
  {
    "text": "hybrid this hybrid environment and then into the end state we have to do it as",
    "start": "1409570",
    "end": "1414790"
  },
  {
    "text": "we run the service so the the beauty and the power of having this universal",
    "start": "1414790",
    "end": "1421800"
  },
  {
    "text": "network primitive is that we can do this migration in in ways that we can control",
    "start": "1421800",
    "end": "1428260"
  },
  {
    "text": "how traffic's slowly shifting from our legacy system into our new system a",
    "start": "1428260",
    "end": "1436680"
  },
  {
    "start": "1436000",
    "end": "1576000"
  },
  {
    "text": "final two lessons we've learned is that having unified observability is very",
    "start": "1437700",
    "end": "1442720"
  },
  {
    "text": "powerful the fact that we have a service mesh and we have envoys running on all",
    "start": "1442720",
    "end": "1448860"
  },
  {
    "text": "the pods and all the legacy machines we can actually compare apples to apples so",
    "start": "1448860",
    "end": "1454510"
  },
  {
    "text": "like as we roll out to communities more services to cover nowadays we can have",
    "start": "1454510",
    "end": "1460000"
  },
  {
    "text": "comparisons of like how quickly do how quickly does these pots spin up and",
    "start": "1460000",
    "end": "1466340"
  },
  {
    "text": "like what are the rate of changes and and we could also like we could also have a unified language and to like",
    "start": "1466340",
    "end": "1475550"
  },
  {
    "text": "to observe like like such as like like Network what is it now requests coming",
    "start": "1475550",
    "end": "1481880"
  },
  {
    "text": "in as well as 504 hundreds and also what's really nice is that we can tune our we could use existing dashboards and",
    "start": "1481880",
    "end": "1488420"
  },
  {
    "text": "we could tune our alarms to easier as we migrate over to kubernetes and secondly",
    "start": "1488420",
    "end": "1494980"
  },
  {
    "text": "we have we can D risk our migration and we have protection against like things",
    "start": "1494980",
    "end": "1502220"
  },
  {
    "text": "not going perfectly in in our communities migration like nothing's gonna go perfect like software is going",
    "start": "1502220",
    "end": "1509180"
  },
  {
    "text": "to fail and and the biggest thing is that we can migrate faster because the",
    "start": "1509180",
    "end": "1516260"
  },
  {
    "text": "fact that we have the circuit abstraction of the server's mesh we can by this I mean like you we can be able",
    "start": "1516260",
    "end": "1522710"
  },
  {
    "text": "to we could low balance at a finer grain level and like ship traffic slowly to",
    "start": "1522710",
    "end": "1528380"
  },
  {
    "text": "the new crudities pods as they spin up and we can also fail hull checks on the",
    "start": "1528380",
    "end": "1533450"
  },
  {
    "text": "kubernetes clusters if things are going awry and quickly route traffic back to",
    "start": "1533450",
    "end": "1538760"
  },
  {
    "text": "the legacy infrastructure an envoy has really great retries policies so we in",
    "start": "1538760",
    "end": "1544610"
  },
  {
    "text": "the end there should be no degraded experience for the end user and this is",
    "start": "1544610",
    "end": "1550310"
  },
  {
    "text": "big honestly because is we've migrated over to the service mesh early on and",
    "start": "1550310",
    "end": "1555530"
  },
  {
    "text": "we're not paying the dividends to to do these like risky to do these like kind",
    "start": "1555530",
    "end": "1561920"
  },
  {
    "text": "of big migration and not receive a big wave makers like kubernetes and and that",
    "start": "1561920",
    "end": "1567380"
  },
  {
    "text": "would be I don't think we would have this eat much of a easier time if we didn't go to if we didn't migrate to the",
    "start": "1567380",
    "end": "1573830"
  },
  {
    "text": "surface mesh in the first place well today we've talked about service",
    "start": "1573830",
    "end": "1579860"
  },
  {
    "start": "1576000",
    "end": "1625000"
  },
  {
    "text": "discovery and in a larger sense the network team this hybrid infrastructure",
    "start": "1579860",
    "end": "1586880"
  },
  {
    "text": "as I said previously is something that happens for for any type of of migration",
    "start": "1586880",
    "end": "1592340"
  },
  {
    "text": "for any time type of system where you're moving from leg see infrastructure to a new",
    "start": "1592340",
    "end": "1599060"
  },
  {
    "text": "infrastructure while today we've only talked about kubernetes and and our",
    "start": "1599060",
    "end": "1604310"
  },
  {
    "text": "legacy virtual machines the principles here of maintaining a hybrid infrastructure can apply to other",
    "start": "1604310",
    "end": "1610790"
  },
  {
    "text": "topologies like multi cloud or multi tenant that is all that we had for today",
    "start": "1610790",
    "end": "1616520"
  },
  {
    "text": "so thank you very much for coming and we have some time for questions [Music]",
    "start": "1616520",
    "end": "1623349"
  },
  {
    "text": "I think we have about five minutes for questions yeah yeah",
    "start": "1624370",
    "end": "1636780"
  },
  {
    "start": "1625000",
    "end": "1919000"
  },
  {
    "text": "[Music]",
    "start": "1638660",
    "end": "1641799"
  },
  {
    "text": "so the question was in this eventually consistent discovery model did we have",
    "start": "1649070",
    "end": "1655860"
  },
  {
    "text": "any issues with training connections do you mean training connections as we fell health checks yeah so so the the rest of",
    "start": "1655860",
    "end": "1678510"
  },
  {
    "text": "the question is say you have a host that you want to do provision it's still part of the discovery set but we we take it",
    "start": "1678510",
    "end": "1685590"
  },
  {
    "text": "off the the health check we were star failing health checks we're still taking requests on that connection so active",
    "start": "1685590",
    "end": "1694799"
  },
  {
    "text": "health check in envoy works with with certain parameters we have it such that",
    "start": "1694799",
    "end": "1700250"
  },
  {
    "text": "you you have check on an interval right",
    "start": "1700250",
    "end": "1705360"
  },
  {
    "text": "and so when that health check starts failing and we will drain they will drain the connection so it will it will",
    "start": "1705360",
    "end": "1711270"
  },
  {
    "text": "still finish the requests that are you know in flight but it will not accept new connections to that particular",
    "start": "1711270",
    "end": "1717000"
  },
  {
    "text": "stream so any other requests that might have happened to that logical cluster",
    "start": "1717000",
    "end": "1722549"
  },
  {
    "text": "will be load balance to other healthy endpoints so this is one of the reasons why as we migrate to a new",
    "start": "1722549",
    "end": "1729029"
  },
  {
    "text": "infrastructure we're able to you know fine-tune traffic in a very granular way",
    "start": "1729029",
    "end": "1736850"
  },
  {
    "text": "yes",
    "start": "1736850",
    "end": "1739850"
  },
  {
    "text": "yes oh right so the question I believe",
    "start": "1754169",
    "end": "1761500"
  },
  {
    "text": "if I understand it is that how do you deal with the scaling other clusters as",
    "start": "1761500",
    "end": "1767110"
  },
  {
    "text": "well so from in that's for that",
    "start": "1767110",
    "end": "1772270"
  },
  {
    "text": "perspective we I think provisioning is coming up with a plan to scale up like",
    "start": "1772270",
    "end": "1778960"
  },
  {
    "text": "make sure that there's like a pool of nodes so there's oh they're always going to be a resources available and then",
    "start": "1778960",
    "end": "1784330"
  },
  {
    "text": "like we and basically there should be enough if there's if as more pots spin",
    "start": "1784330",
    "end": "1793630"
  },
  {
    "text": "up and there's less nodes available for resources they say they start scaling up so we're getting ahead of it right by a",
    "start": "1793630",
    "end": "1799330"
  },
  {
    "text": "like so there would be there always gonna be a pool available for more workloads and that's provisioning job to",
    "start": "1799330",
    "end": "1805870"
  },
  {
    "text": "make sure that that they they're always going to be enough to enough",
    "start": "1805870",
    "end": "1811659"
  },
  {
    "text": "nodes available to launch more pods onto the kubernetes cluster and if and ice",
    "start": "1811659",
    "end": "1817720"
  },
  {
    "text": "and then there is an issue of like oh like if we start writing all this traffic back to the legacy systems how",
    "start": "1817720",
    "end": "1824770"
  },
  {
    "text": "do we handle that we just have to over you to let you have to do we have to overdo over we have to over provision at",
    "start": "1824770",
    "end": "1830679"
  },
  {
    "text": "that point in the legacy infrastructure to handle that right but like the idea",
    "start": "1830679",
    "end": "1838270"
  },
  {
    "text": "is that that's a short-term cost as we move over to kubernetes right like that's what we're doing now essentially",
    "start": "1838270",
    "end": "1844679"
  },
  {
    "text": "yes",
    "start": "1846510",
    "end": "1849510"
  },
  {
    "text": "yes so the question is how does this topology of the hybrid ecosystem relate",
    "start": "1854010",
    "end": "1859630"
  },
  {
    "text": "to the front proxy so the front proxy is also reading discovery or EDS data from",
    "start": "1859630",
    "end": "1865000"
  },
  {
    "text": "the XDS control plane so it's essentially the same right the front",
    "start": "1865000",
    "end": "1870220"
  },
  {
    "text": "proxy has for example a logical cluster foo and within that logical cluster foo",
    "start": "1870220",
    "end": "1875680"
  },
  {
    "text": "we might have endpoints that are in kubernetes or in the legacy discord or in the legacy system so the same way",
    "start": "1875680",
    "end": "1883420"
  },
  {
    "text": "that the service mesh discovers you know particular hosts for particular services",
    "start": "1883420",
    "end": "1888460"
  },
  {
    "text": "the front proxies the season the same system yep the question is do we have",
    "start": "1888460",
    "end": "1903520"
  },
  {
    "text": "any plans to use SEO as our control plane I have a full talk or in control",
    "start": "1903520",
    "end": "1909550"
  },
  {
    "text": "planes basically my basic answer here is control planes are very opinionated",
    "start": "1909550",
    "end": "1915310"
  },
  {
    "text": "I always describe them as a service in three parts and the front part of a",
    "start": "1915310",
    "end": "1920380"
  },
  {
    "text": "control plane is munging you know your do infrastructures topology into the XDS",
    "start": "1920380",
    "end": "1926200"
  },
  {
    "text": "api's for lyft in particular because you know we have we carry the history of",
    "start": "1926200",
    "end": "1931720"
  },
  {
    "text": "Android with us and a very very opinionated topology it makes no sense for us to at this point you know massage",
    "start": "1931720",
    "end": "1939760"
  },
  {
    "text": "our infrastructure and our topology into a serious way of service discovery of",
    "start": "1939760",
    "end": "1945250"
  },
  {
    "text": "route configuration of cluster topology so that that's why we build our own control plane one of the reasons I can",
    "start": "1945250",
    "end": "1953290"
  },
  {
    "text": "talk at length about this so if you're interested we can talk more",
    "start": "1953290",
    "end": "1958620"
  },
  {
    "text": "failure where you know something's wrong",
    "start": "1974610",
    "end": "1978389"
  },
  {
    "text": "so the question is in in this environments where we're relying on",
    "start": "1987050",
    "end": "1993630"
  },
  {
    "text": "health check into actually doing traffic shifting and and popping endpoints out",
    "start": "1993630",
    "end": "1999270"
  },
  {
    "text": "of out of a logical service how do you deal with Grayson errors where an",
    "start": "1999270",
    "end": "2004940"
  },
  {
    "text": "endpoint might be not responding correctly but it might still be responding health checking that's what I",
    "start": "2004940",
    "end": "2012740"
  },
  {
    "text": "was talking about the power of the EDS API is that you can specify for example",
    "start": "2012740",
    "end": "2018680"
  },
  {
    "text": "load balancing priorities so we might as network operators open up an API in our",
    "start": "2018680",
    "end": "2025520"
  },
  {
    "text": "control plane that can say okay mark or mark you know this endpoints as",
    "start": "2025520",
    "end": "2031690"
  },
  {
    "text": "unhealthy not by failing health check on the on the machine itself but by delivering discovery data that says you",
    "start": "2031690",
    "end": "2039740"
  },
  {
    "text": "know this has a priority of you know negative 1000 so that traffic will not be routed there so so that's one of the",
    "start": "2039740",
    "end": "2047510"
  },
  {
    "text": "ways that having this having this topology has to resist this migration because we have several you know checks",
    "start": "2047510",
    "end": "2056360"
  },
  {
    "text": "and balances or flags that allow us to shape traffic the way that we want mmm I",
    "start": "2056360",
    "end": "2063520"
  },
  {
    "text": "think we are a time thank you so much but we'll be here",
    "start": "2063520",
    "end": "2068649"
  },
  {
    "text": "[Applause]",
    "start": "2068650",
    "end": "2072649"
  }
]