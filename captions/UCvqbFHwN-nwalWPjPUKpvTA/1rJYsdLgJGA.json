[
  {
    "text": "thanks daniel well as daniel said my name is mitch connors i've been a software engineer at google on the istio",
    "start": "0",
    "end": "6319"
  },
  {
    "text": "project for three and a half years hello everyone i'm stefan pradhan i'm a principal engineer at weworks and i'm on",
    "start": "6319",
    "end": "13120"
  },
  {
    "text": "flux and flagger maintainers for many years all right well let's get to it",
    "start": "13120",
    "end": "19760"
  },
  {
    "text": "everyone here should probably already know that istio makes your service mesh more secure right it's the leading",
    "start": "19760",
    "end": "25920"
  },
  {
    "text": "reason for adoption among our users they want the security they want zero trust built on mtls they want the ability to",
    "start": "25920",
    "end": "32880"
  },
  {
    "text": "set authen and off z policies to have their certificates automatically rotated and it makes all of that really easy and",
    "start": "32880",
    "end": "39440"
  },
  {
    "text": "seamless but there's a little bit of a catch 88",
    "start": "39440",
    "end": "44559"
  },
  {
    "text": "of istio installations are running known cves so if you're using istio to make your",
    "start": "44559",
    "end": "50879"
  },
  {
    "text": "service mesh more secure and then istio that you're running has its own cves",
    "start": "50879",
    "end": "55920"
  },
  {
    "text": "some of them 9 9.8 on the cve scale that that's problematic",
    "start": "55920",
    "end": "62800"
  },
  {
    "text": "in fact your service mesh could be less secure because istio is there rather than more secure",
    "start": "62800",
    "end": "67920"
  },
  {
    "text": "so why is this why are 88 it's not that istio is not patching their vulnerabilities right we have patch",
    "start": "67920",
    "end": "74159"
  },
  {
    "text": "releases that come out at least once a month each of them covers a bunch of known cves uh but it's still not being",
    "start": "74159",
    "end": "80960"
  },
  {
    "text": "picked up in the community very quickly so today we're going to talk just for a brief time about why our users aren't",
    "start": "80960",
    "end": "87360"
  },
  {
    "text": "upgrading i'm going to rely on stefan a lot to tell us how good ops can help us with",
    "start": "87360",
    "end": "92400"
  },
  {
    "text": "this problem we'll have actually a handful of demos sprinkled throughout and some takeaways",
    "start": "92400",
    "end": "98479"
  },
  {
    "text": "so this is sort of a timeline a history of what we thought was the problem with upgrades in the istio project and as you",
    "start": "98479",
    "end": "104560"
  },
  {
    "text": "can see it's changed a lot over time we first noticed that no one was upgrading istio in q2 of 2020 and we",
    "start": "104560",
    "end": "111119"
  },
  {
    "text": "thought well maybe they don't know maybe users don't realize that there are cves in their istio installation so we ran a",
    "start": "111119",
    "end": "118000"
  },
  {
    "text": "survey and we did find a few users who were unaware and we built some tooling and some documentation to help boost that awareness we found a lot more users",
    "start": "118000",
    "end": "125520"
  },
  {
    "text": "who were aware that their service mesh was vulnerable but they didn't feel like they had time to get to it",
    "start": "125520",
    "end": "130560"
  },
  {
    "text": "you know these istio is not the only thing that anyone is running in production they've got their own apps",
    "start": "130560",
    "end": "135680"
  },
  {
    "text": "they've got telemetry systems they've got maybe some ebpf systems that need to stay up to date and staying on top of",
    "start": "135680",
    "end": "142000"
  },
  {
    "text": "all of it is just so difficult it's like a treadmill that you can never keep up with so we decided let's make istio",
    "start": "142000",
    "end": "149120"
  },
  {
    "text": "upgrades easier this was a part of the 2021 roadmap you see it now on the 2022 roadmap for the project istio upgrades",
    "start": "149120",
    "end": "156080"
  },
  {
    "text": "should be easy and we launched surveys that went along with every release asking users how easy was this and we",
    "start": "156080",
    "end": "161440"
  },
  {
    "text": "saw consistently from one release to the next the studio is getting easier to upgrade easier to upgrade nothing huge",
    "start": "161440",
    "end": "166720"
  },
  {
    "text": "but consistent improvement from one release to the next so a year later we ran our production survey again and",
    "start": "166720",
    "end": "172319"
  },
  {
    "text": "asked okay how much of istio is up to date in production and 88 percent of istio installations still",
    "start": "172319",
    "end": "178640"
  },
  {
    "text": "have known cves so okay easiness and difficulty was not the problem",
    "start": "178640",
    "end": "183760"
  },
  {
    "text": "what else well right now as of last fall you had to upgrade seo four times a year",
    "start": "183760",
    "end": "189840"
  },
  {
    "text": "and that's a lot so maybe we should move to something else you know kubernetes has now the three times a year release",
    "start": "189840",
    "end": "195760"
  },
  {
    "text": "process we looked at that a little bit the sweet spot we landed on was once every six months and we we kept our",
    "start": "195760",
    "end": "201120"
  },
  {
    "text": "release process the same so we still release four times a year but you can now upgrade directly from say 112 to one",
    "start": "201120",
    "end": "207920"
  },
  {
    "text": "or sorry 1 10 to 112 or 111 to 113 without doing an",
    "start": "207920",
    "end": "212959"
  },
  {
    "text": "intermediate upgrade along the way and then we extended our support window so that 110 and 112 would overlap by six",
    "start": "212959",
    "end": "219040"
  },
  {
    "text": "weeks giving you that time to upgrade so now we just cut your work in half it's really easy to upgrade istio and so we",
    "start": "219040",
    "end": "225599"
  },
  {
    "text": "waited six months and then we surveyed production and we found out that 88 of all istio installations still have known",
    "start": "225599",
    "end": "232000"
  },
  {
    "text": "cves so it's not that it's too difficult it's not that our customers don't know they should",
    "start": "232000",
    "end": "237439"
  },
  {
    "text": "uh it's not that it's too frequent we need a new hypothesis so this one's really controversial our 2022 hypothesis",
    "start": "237439",
    "end": "244560"
  },
  {
    "text": "for why istio upgrades aren't happening is that humans are bad at repetitive monotonous labor",
    "start": "244560",
    "end": "250480"
  },
  {
    "text": "i know i know that super controversial in a group of programmers we all love our monotonous repetitive",
    "start": "250480",
    "end": "256320"
  },
  {
    "text": "tasks but that's what we're going after this year that's how we hope to move the needle down from 88 percent",
    "start": "256320",
    "end": "263840"
  },
  {
    "text": "stefan's going to share with us how we're going to remove that monotonous repetitive labor from istio",
    "start": "263840",
    "end": "269759"
  },
  {
    "text": "installations with some products from weaveworks sure there are not products of weavers there",
    "start": "269759",
    "end": "275759"
  },
  {
    "text": "cncf projects okay so i'm guessing everybody here knows what",
    "start": "275759",
    "end": "282160"
  },
  {
    "text": "githubs is it's uh you know you already seen this slide and this uh event",
    "start": "282160",
    "end": "289440"
  },
  {
    "text": "10 times per day probably the idea behind githubs is you let your cluster",
    "start": "289440",
    "end": "295199"
  },
  {
    "text": "figure out its state from an external source and with flux",
    "start": "295199",
    "end": "300320"
  },
  {
    "text": "that can be you know git repository or an s3 bucket or we",
    "start": "300320",
    "end": "305600"
  },
  {
    "text": "have many ways of how you can define your cluster state outside of the cluster so instead of you know you",
    "start": "305600",
    "end": "312320"
  },
  {
    "text": "having to run commands to upgrade your infrastructure or your applications what",
    "start": "312320",
    "end": "318400"
  },
  {
    "text": "you can do is define how those can be automatically upgraded in your git repo for example",
    "start": "318400",
    "end": "324960"
  },
  {
    "text": "with kubernetes custom resources and something the cluster itself something",
    "start": "324960",
    "end": "331120"
  },
  {
    "text": "running on the cluster you know sees that okay i need to upgrade myself from the source and i'm",
    "start": "331120",
    "end": "336880"
  },
  {
    "text": "going to do it automatically i'm going to talk about the flux project",
    "start": "336880",
    "end": "343600"
  },
  {
    "text": "so in the flux project we have two main projects one is flux itself which is a",
    "start": "343600",
    "end": "349039"
  },
  {
    "text": "collection of kubernetes controllers we have 12 custom resource definitions",
    "start": "349039",
    "end": "356880"
  },
  {
    "text": "and what flux aims to provide you is a you know like a lego system where you",
    "start": "356880",
    "end": "362400"
  },
  {
    "text": "can build your own continuous delivery solution that fits your use case",
    "start": "362400",
    "end": "368319"
  },
  {
    "text": "flux is not operated in any way we don't offer you a ui we offer you",
    "start": "368319",
    "end": "374240"
  },
  {
    "text": "something that allows you to build your platform and besides flux we have a second",
    "start": "374240",
    "end": "381600"
  },
  {
    "text": "project called flagger and the flagger role is to you know decouple the deployment from",
    "start": "381600",
    "end": "387680"
  },
  {
    "text": "the release process so if flux does the deployment automatically based on what's in git",
    "start": "387680",
    "end": "394400"
  },
  {
    "text": "that doesn't mean that those things that are engaged should be automatically",
    "start": "394400",
    "end": "399520"
  },
  {
    "text": "exposed to all your users and flagger role is to detect oh you want to deploy a new version of your",
    "start": "399520",
    "end": "405520"
  },
  {
    "text": "application let me test the new version on some of your users so with flagger you can say",
    "start": "405520",
    "end": "413280"
  },
  {
    "text": "uh okay when there is a new version move one percent of the traffic to the new version see if that works measure uh",
    "start": "413280",
    "end": "421440"
  },
  {
    "text": "slos like i don't know error rates latency other custom metrics",
    "start": "421440",
    "end": "426479"
  },
  {
    "text": "and if that works add more traffic more traffic and if everything",
    "start": "426479",
    "end": "431840"
  },
  {
    "text": "goes okay only then flagger fully rolls out the new version to all your users and that's called progressive delivery",
    "start": "431840",
    "end": "440400"
  },
  {
    "text": "so this is how flux looks like and how the continuous delivery you know",
    "start": "441440",
    "end": "448080"
  },
  {
    "text": "circle is flux is fluxes controllers are even based so",
    "start": "448080",
    "end": "453280"
  },
  {
    "text": "every time you push something to your repo flux will be notified and it will reconcile the new state but you can also",
    "start": "453280",
    "end": "459360"
  },
  {
    "text": "ping it from ci it also monitors your container images it can upgrade",
    "start": "459360",
    "end": "465520"
  },
  {
    "text": "your container applications inside the cluster you can say for example i want",
    "start": "465520",
    "end": "470639"
  },
  {
    "text": "for envoy every time there is a patch release i don't want to go into git and modify",
    "start": "470639",
    "end": "476720"
  },
  {
    "text": "that batch release and you can tell plugs scan the envoy container registry",
    "start": "476720",
    "end": "483759"
  },
  {
    "text": "if there is a new patch release version commit that to git and upgrade",
    "start": "483759",
    "end": "489680"
  },
  {
    "text": "envoy all over the cluster for me and plugs can be run on a management cluster where you",
    "start": "489680",
    "end": "496160"
  },
  {
    "text": "can target all your environments like your production cluster or staging or you can deploy a flux installation per",
    "start": "496160",
    "end": "502879"
  },
  {
    "text": "cluster and make that cluster independent it also works with cluster api very well",
    "start": "502879",
    "end": "509440"
  },
  {
    "text": "okay flagger i i mentioned about it besides integrating with istio for routing",
    "start": "509520",
    "end": "515919"
  },
  {
    "text": "traffic between versions it works with a bunch of other service meshes and also",
    "start": "515919",
    "end": "521440"
  },
  {
    "text": "ingress control so if you are not into the service mesh hype",
    "start": "521440",
    "end": "526560"
  },
  {
    "text": "you just use an ingress controller you can still do a b testing and progressive delivery for your front end applications",
    "start": "526560",
    "end": "534880"
  },
  {
    "text": "and of course how flagger detects that everything is working uh primarily work",
    "start": "534880",
    "end": "539920"
  },
  {
    "text": "with prometheus which comes with with the instant installation with linkard and everybody",
    "start": "539920",
    "end": "545519"
  },
  {
    "text": "else but it can also reach two things like cloudwatch um what's it called uh",
    "start": "545519",
    "end": "551200"
  },
  {
    "text": "the google uh product where you have metrics oh stackdriver oh no it's not there yeah",
    "start": "551200",
    "end": "556959"
  },
  {
    "text": "driver anymore they rebranded the new spec driver",
    "start": "556959",
    "end": "563519"
  },
  {
    "text": "also new relic and another solutions",
    "start": "563519",
    "end": "568160"
  },
  {
    "text": "so okay flux can take care of you know shipping patches and automatic",
    "start": "569760",
    "end": "577360"
  },
  {
    "text": "automates the upgrade procedure of your apps and infrastructure who upgrades flux right",
    "start": "577360",
    "end": "582720"
  },
  {
    "text": "so you are we release flux every two weeks",
    "start": "582720",
    "end": "588240"
  },
  {
    "text": "so it's a lot of work to keep our flux up to date uh we have a solution for this flux is",
    "start": "588560",
    "end": "595839"
  },
  {
    "text": "able to upgrade itself and how we how we can do that we use the github",
    "start": "595839",
    "end": "601839"
  },
  {
    "text": "action or something in our ci that monitors the flux github releases when",
    "start": "601839",
    "end": "610000"
  },
  {
    "text": "that action detects oh there is a new patch release for flux it will open a pull request for you",
    "start": "610000",
    "end": "616399"
  },
  {
    "text": "where it can bump the flux version directly in a branch then flux is oh my definition",
    "start": "616399",
    "end": "622480"
  },
  {
    "text": "from git my own definitions have changed so now it's time to upgrade myself it",
    "start": "622480",
    "end": "627600"
  },
  {
    "text": "pulls the his new version starts a rolling deployment and that's how you can keep flux fully automated up",
    "start": "627600",
    "end": "634720"
  },
  {
    "text": "to date and unlike istio you can jump from any flux version to",
    "start": "634720",
    "end": "640640"
  },
  {
    "text": "any other flux version so we had flux version 2 users who installed it six months ago",
    "start": "640640",
    "end": "647680"
  },
  {
    "text": "they ran the upgrade last week and it worked even if we released i don't know",
    "start": "647680",
    "end": "652880"
  },
  {
    "text": "60 uh versions between then and now so yeah flux is it's all about backwards",
    "start": "652880",
    "end": "659920"
  },
  {
    "text": "compatibility and being able to upgrade itself because we think that continuous upgrades is the way to do it",
    "start": "659920",
    "end": "666480"
  },
  {
    "text": "with uh you know in in kubernetes it's great for that",
    "start": "666480",
    "end": "673040"
  },
  {
    "text": "okay so i'm going to do a start a demo this will be a three-part demo",
    "start": "673120",
    "end": "678480"
  },
  {
    "text": "uh what i'm going to show you now is how we can install flux on the cluster and tell",
    "start": "678480",
    "end": "685200"
  },
  {
    "text": "flux to install istio install applications install these to your gateway set up",
    "start": "685200",
    "end": "691600"
  },
  {
    "text": "ingress and all of that with the with a single command",
    "start": "691600",
    "end": "697240"
  },
  {
    "text": "okay so i have here the flux bootstrap command and this is uh uh you can boost",
    "start": "702160",
    "end": "708079"
  },
  {
    "text": "reflux on clusters using this generic command which works with any kind of git server you pass it your",
    "start": "708079",
    "end": "715360"
  },
  {
    "text": "an ssh key and that has read access to a repo and",
    "start": "715360",
    "end": "721760"
  },
  {
    "text": "what what this command will do the flux cli will clone the repository will write",
    "start": "721760",
    "end": "727200"
  },
  {
    "text": "its own definitions in the repo will commit its definitions to the upstream",
    "start": "727200",
    "end": "733600"
  },
  {
    "text": "and dell will install itself on the cluster and we also have flavors of bootstrap",
    "start": "733600",
    "end": "739839"
  },
  {
    "text": "for github gitlab bitbucket where you can say flux bootstrap github and it creates the repository for you it sets",
    "start": "739839",
    "end": "747200"
  },
  {
    "text": "up the deploys keys for you and so on but today we are using this uh command that works with any kind of",
    "start": "747200",
    "end": "754079"
  },
  {
    "text": "of git server okay so i'm pressing enter",
    "start": "754079",
    "end": "760639"
  },
  {
    "text": "hopefully it will work what's happening now i'm clone the repository locally",
    "start": "760639",
    "end": "767839"
  },
  {
    "text": "it pushes all its definitions to get through using ssh",
    "start": "767839",
    "end": "774959"
  },
  {
    "text": "go on go on we are really in a hurry flux",
    "start": "775040",
    "end": "780079"
  },
  {
    "text": "and yeah after it it it talks to the git repo after it it",
    "start": "780079",
    "end": "785279"
  },
  {
    "text": "places there it's its configuration next what it does is it configures",
    "start": "785279",
    "end": "791600"
  },
  {
    "text": "itself for a particular uh path in the git ripple so you can use a",
    "start": "791600",
    "end": "797120"
  },
  {
    "text": "single git repository to manage your whole infrastructure fleets you can have",
    "start": "797120",
    "end": "802720"
  },
  {
    "text": "i know a production cluster and staging cluster in the same repository then you can migrate workloads from staging to",
    "start": "802720",
    "end": "809600"
  },
  {
    "text": "production using that ripple or you can use dedicated repositories",
    "start": "809600",
    "end": "815360"
  },
  {
    "text": "for each cluster or each environment you have",
    "start": "815360",
    "end": "819760"
  },
  {
    "text": "okay after it has installed anything now flux is verifying itself if all the controls are running and we have",
    "start": "820800",
    "end": "829120"
  },
  {
    "text": "four controllers which are part of the base flux installation one is the source",
    "start": "829120",
    "end": "834480"
  },
  {
    "text": "controller which deals with all the git operations and another one is customize control",
    "start": "834480",
    "end": "840480"
  },
  {
    "text": "which can apply customized plane research kubernetes plane resources or customized",
    "start": "840480",
    "end": "846480"
  },
  {
    "text": "overlays and finally the helm controller which are using now for for istio we are",
    "start": "846480",
    "end": "851680"
  },
  {
    "text": "installing istio now flux is installing istio on the cluster using all the eco helm charts and",
    "start": "851680",
    "end": "858079"
  },
  {
    "text": "if we look at the we can do a flux minus send hto",
    "start": "858079",
    "end": "864800"
  },
  {
    "text": "system get helm releases and we should",
    "start": "864800",
    "end": "870399"
  },
  {
    "text": "see here what is what what the flux did so",
    "start": "870399",
    "end": "875920"
  },
  {
    "text": "first we have we have a thing in flux where we can define dependencies between",
    "start": "875920",
    "end": "882079"
  },
  {
    "text": "our infrastructure items in in the case of istio this is critical because istio",
    "start": "882079",
    "end": "887680"
  },
  {
    "text": "has several charts one contains the crds another one contains pilot another one",
    "start": "887680",
    "end": "893199"
  },
  {
    "text": "contains the gateway right i cannot install the gateway until i have the crds i cannot install pilot and so on so",
    "start": "893199",
    "end": "899920"
  },
  {
    "text": "in in the repo we have we can define this declarative and say install all things in a particular order",
    "start": "899920",
    "end": "906720"
  },
  {
    "text": "and also do the upgrade in that order so when there is a new sql release we first upgrade the crds then pilot then gate",
    "start": "906720",
    "end": "913440"
  },
  {
    "text": "and so on and you see here for example dependencies tld is not ready so what",
    "start": "913440",
    "end": "919279"
  },
  {
    "text": "flags does it checks the it looks at the health check of each deployment and blocks until all list your components",
    "start": "919279",
    "end": "926240"
  },
  {
    "text": "are ready and it it deploys them in the in the particular order so now we should see that",
    "start": "926240",
    "end": "933120"
  },
  {
    "text": "everything is done yes so we have estia installed on the cluster all our applications are there the gateway is",
    "start": "933120",
    "end": "939600"
  },
  {
    "text": "set up okay one of three demos let's go fast fast fast",
    "start": "939600",
    "end": "947040"
  },
  {
    "text": "all right so that was a great introduction to how good ops helps you manage the resources that are in a cluster and we saw a little bit of",
    "start": "949519",
    "end": "954800"
  },
  {
    "text": "what's going on with this deal but let's dig a little bit deeper into what's necessary to automate get ops for to",
    "start": "954800",
    "end": "960399"
  },
  {
    "text": "automate upgrades for istio and by the way these principles should apply pretty fairly to just about any service mesh",
    "start": "960399",
    "end": "966240"
  },
  {
    "text": "project i work on istio so i'm that's where i built this but you should be able to take the principles and carry",
    "start": "966240",
    "end": "972079"
  },
  {
    "text": "them over but first why did we choose to work with flagger and flux",
    "start": "972079",
    "end": "978399"
  },
  {
    "text": "the the only progressive delivery api that i could find that worked directly on deployments so that i did not need to",
    "start": "978399",
    "end": "985360"
  },
  {
    "text": "change anything about how the customer was defining their workloads was flagger i've found other tools that will allow",
    "start": "985360",
    "end": "991519"
  },
  {
    "text": "you to do progressive delivery with a pipeline where you define your own steps but i didn't really want to do that on",
    "start": "991519",
    "end": "996880"
  },
  {
    "text": "behalf of the user also stefan already did most of the work the get ops repo that we're demoing today",
    "start": "996880",
    "end": "1003680"
  },
  {
    "text": "you saw the link actually back here stefan proud on get ups istio has been around for some time",
    "start": "1003680",
    "end": "1009120"
  },
  {
    "text": "i just recently joined stefan in making some tweaks to it which we'll be showing off this afternoon",
    "start": "1009120",
    "end": "1015920"
  },
  {
    "text": "so how is this going to work for istio well flux is going to manage what we're going to see first is that flux is managing",
    "start": "1015920",
    "end": "1021759"
  },
  {
    "text": "the sdo control plane so when you merge an update which by the way can happen when someone makes a change to your",
    "start": "1021759",
    "end": "1027918"
  },
  {
    "text": "istio installation or when github actions notice that there is a new version of istio available we'll get a",
    "start": "1027919",
    "end": "1034319"
  },
  {
    "text": "pull request saying hey new version of istio go ahead and install it uh and there's checks and tests that will run",
    "start": "1034319",
    "end": "1040319"
  },
  {
    "text": "on that pull request just like you all should have for your ci systems once it gets approved flux will see it uh in the",
    "start": "1040319",
    "end": "1046640"
  },
  {
    "text": "main branch and we'll reconcile it along with flagger prometheus etc we already saw that work but in a minute",
    "start": "1046640",
    "end": "1052880"
  },
  {
    "text": "we're going to see an upgrade also i should take a step back because we've been talking about pilot or the",
    "start": "1052880",
    "end": "1058480"
  },
  {
    "text": "control plane and terminology can get really overwhelming really quickly in service mesh",
    "start": "1058480",
    "end": "1063520"
  },
  {
    "text": "i am almost certainly going to slip up and say data plane sidecar and proxy",
    "start": "1063520",
    "end": "1069280"
  },
  {
    "text": "interchangeably or the envoy those are all the same thing it sounds like really overwhelming",
    "start": "1069280",
    "end": "1074400"
  },
  {
    "text": "vocabulary but we're really talking about one thing it's a proxy that runs everywhere everywhere you have an application you need a proxy right next",
    "start": "1074400",
    "end": "1080799"
  },
  {
    "text": "to it so it's in the pod running alongside your application and managing things we just like to give it four",
    "start": "1080799",
    "end": "1086160"
  },
  {
    "text": "names because istio so istio is divided between a control",
    "start": "1086160",
    "end": "1092000"
  },
  {
    "text": "plane and a data plane we just saw the control plane get installed and now what we're going to demo is having a control",
    "start": "1092000",
    "end": "1098080"
  },
  {
    "text": "plane upgrade oh before the demo i wanted to talk about this along the way we found stefan and i",
    "start": "1098080",
    "end": "1104640"
  },
  {
    "text": "found that it is really difficult to integrate istio control with github actions so we launched our own get istio",
    "start": "1104640",
    "end": "1111280"
  },
  {
    "text": "control action if there's anything you'd like to do in github actions in your ci system get istio just downloads the binary for",
    "start": "1111280",
    "end": "1118400"
  },
  {
    "text": "you into your path so that you can run it i strongly recommend using this for things like analyze which we're not",
    "start": "1118400",
    "end": "1124160"
  },
  {
    "text": "showing off today but is in the repo you can see that uh at the re at the uri we mentioned before we have an analyze step",
    "start": "1124160",
    "end": "1130480"
  },
  {
    "text": "that checks and make sure your config is good but let's get to the good part again",
    "start": "1130480",
    "end": "1137840"
  },
  {
    "text": "okay oh actually no i was already where i wanted to be that's the problem so this is where we're running our demo",
    "start": "1139280",
    "end": "1146480"
  },
  {
    "text": "from again i've forked this repo from stefan's and that's actually your first step in your process if you'd like to do",
    "start": "1146480",
    "end": "1151600"
  },
  {
    "text": "the same thing fork stefan's repo don't fork mine for various reasons",
    "start": "1151600",
    "end": "1157840"
  },
  {
    "text": "but you can see that we've got our istio installation we've got our apps installed here we've got cluster",
    "start": "1157840",
    "end": "1163120"
  },
  {
    "text": "definitions and interestingly if we look at pull requests we have a pull request that was just created two hours ago",
    "start": "1163120",
    "end": "1170559"
  },
  {
    "text": "it says it was by me it's actually using my credentials but it was created by a github action that downloaded istio",
    "start": "1170559",
    "end": "1177440"
  },
  {
    "text": "control saw that there was a new version and has updated our control plane spec so let's take a look at this pull",
    "start": "1177440",
    "end": "1182480"
  },
  {
    "text": "request um the only thing that's changing here is the version of the control plane and you",
    "start": "1182480",
    "end": "1189679"
  },
  {
    "text": "can see that from the diff here we can also see that there are two automated checks that have run for this and one",
    "start": "1189679",
    "end": "1195679"
  },
  {
    "text": "that seems to still be running after oh it's only been six minutes oh because of the changes pushed by the bootstrap",
    "start": "1195679",
    "end": "1202159"
  },
  {
    "text": "okay i'm not going to wait for the e2e test to pass because i know we've got a lot to go but normally obviously you'd want all of your checks passing we can",
    "start": "1202159",
    "end": "1208880"
  },
  {
    "text": "see that all of the analyzers passed so our config looks good i think we can feel good about merging this pull",
    "start": "1208880",
    "end": "1215280"
  },
  {
    "text": "request so i'm going to go ahead and do that",
    "start": "1215280",
    "end": "1221158"
  },
  {
    "text": "so what we've been doing we've been running kubernetes kind inside the github action runner",
    "start": "1221360",
    "end": "1227440"
  },
  {
    "text": "and in there we are streaming down istio bringing down the requests the limits everything down so",
    "start": "1227440",
    "end": "1233679"
  },
  {
    "text": "we can run everything in there and make sure that the new version of the control plane works and we do that with flux so",
    "start": "1233679",
    "end": "1240080"
  },
  {
    "text": "flux is deployed inside kind pulls the branch from the pull request and runs an end-to-end test suite for",
    "start": "1240080",
    "end": "1247919"
  },
  {
    "text": "all the istio components right before everything goes out to our staging cluster we'll do some real testing and",
    "start": "1247919",
    "end": "1254640"
  },
  {
    "text": "only then to production cluster so we're going to revisit the cluster in a minute to show you that it actually",
    "start": "1254640",
    "end": "1259919"
  },
  {
    "text": "worked but it does take a few minutes so i'm going to move on and at the beginning of the next demo we'll circle back to that what went well here our control plane is",
    "start": "1259919",
    "end": "1267039"
  },
  {
    "text": "now kept up to date as long as we're willing to approve pull requests on about a monthly basis that's not too bad",
    "start": "1267039",
    "end": "1273440"
  },
  {
    "text": "we got everything tested before we ever pushed to production so a pretty high degree of certainty that this",
    "start": "1273440",
    "end": "1278880"
  },
  {
    "text": "configuration ought to work really well and we got analyzers to run so that if we're changing our istio config we know",
    "start": "1278880",
    "end": "1285919"
  },
  {
    "text": "before we break production that we had a typo in our virtual service which by the way if you saw in the pull request there",
    "start": "1285919",
    "end": "1291919"
  },
  {
    "text": "was one called bad sidecar i very specifically tried to merge some bad config and it's blocked by analyzer",
    "start": "1291919",
    "end": "1298000"
  },
  {
    "text": "a couple of disadvantages though what version of the proxy is going to be running or the data plane is going to be running in my cluster well the answer is",
    "start": "1298000",
    "end": "1306240"
  },
  {
    "text": "yes yes both uh maybe or one or the other we don't know",
    "start": "1306240",
    "end": "1311600"
  },
  {
    "text": "the version of your proxy in istio by default is determined when the pod starts up",
    "start": "1311600",
    "end": "1317120"
  },
  {
    "text": "and that's a little bit problematic because it means all the way through your test infrastructure your units your integration test your staging",
    "start": "1317120",
    "end": "1322880"
  },
  {
    "text": "environment you don't actually know what proxy you're going to be running with and it's a fairly important component it's something you want to test about",
    "start": "1322880",
    "end": "1328720"
  },
  {
    "text": "against so that's not great also this doesn't yet use revision based update upgrades that is a best practice across",
    "start": "1328720",
    "end": "1335039"
  },
  {
    "text": "the istio project that i just didn't have time to bake into this repo look for that coming in the next couple",
    "start": "1335039",
    "end": "1340159"
  },
  {
    "text": "of months so let's talk a little bit more about this problem with proxies right in the",
    "start": "1340159",
    "end": "1346159"
  },
  {
    "text": "software development life cycle uh the proxy is defined at the very end it",
    "start": "1346159",
    "end": "1351679"
  },
  {
    "text": "doesn't even necessarily result or isn't necessarily the result of a kubernetes deployment you could have a deployment",
    "start": "1351679",
    "end": "1357200"
  },
  {
    "text": "that's running an old proxy you upgrade the control plane you scale that deployment up the new pods will get the",
    "start": "1357200",
    "end": "1362240"
  },
  {
    "text": "new proxy the old pods will still have the old proxy it's very unpredictable",
    "start": "1362240",
    "end": "1367520"
  },
  {
    "text": "and as you can see that reduces determinacy in the whole process it's very uncontrolled and the",
    "start": "1367520",
    "end": "1373200"
  },
  {
    "text": "way to fix that is you run global restarts on your cluster which like i",
    "start": "1373200",
    "end": "1378400"
  },
  {
    "text": "i don't really want to recommend that you do in production um so let's let's talk about how we can make this better",
    "start": "1378400",
    "end": "1384080"
  },
  {
    "text": "what we want to do is shift the declaration of that proxy or the specification of the proxy left in the",
    "start": "1384080",
    "end": "1390000"
  },
  {
    "text": "software development life cycle to the point of get ops get ops needs to happen at the test",
    "start": "1390000",
    "end": "1395600"
  },
  {
    "text": "environment so that from test to release to deploy to operate you have a consistent piece of software that you're",
    "start": "1395600",
    "end": "1401200"
  },
  {
    "text": "operating across all those environments your test results are meaningful and then of course your your rollbacks are",
    "start": "1401200",
    "end": "1407440"
  },
  {
    "text": "just to get revert if something goes wrong you know how to get back it's not quite so simple if you're using sidecar",
    "start": "1407440",
    "end": "1412720"
  },
  {
    "text": "injection in istio how do you define a sidecar in git well",
    "start": "1412720",
    "end": "1417840"
  },
  {
    "text": "it turns out there's been a command to help you do this for some time in the istio community called cube inject it will take a yaml that could be a",
    "start": "1417840",
    "end": "1424400"
  },
  {
    "text": "deployment or a job or a replica set or a stateful set and it will output a",
    "start": "1424400",
    "end": "1429520"
  },
  {
    "text": "modified version of that deployment that includes a sidecar pretty simple um and so we've built that in and baked",
    "start": "1429520",
    "end": "1437120"
  },
  {
    "text": "it into a github action so what we've already seen is a new version of istio was available so we upgraded our control plane uh yaml in",
    "start": "1437120",
    "end": "1444880"
  },
  {
    "text": "git they created a pull request we had kind tests and and our analyzed tests we approved the pull request and it got",
    "start": "1444880",
    "end": "1451440"
  },
  {
    "text": "committed and deployed to kubernetes but that commit now hopefully we're going to see in just a second has triggered a",
    "start": "1451440",
    "end": "1457360"
  },
  {
    "text": "second github action which saw oh your control plane version now does not match your data plane version let's go ahead",
    "start": "1457360",
    "end": "1462640"
  },
  {
    "text": "and fix that and so we are going to see a new pull request that upd updates our workload",
    "start": "1462640",
    "end": "1469120"
  },
  {
    "text": "yamls actually it doesn't even update that it updates a file next to the workload yml which is going to go through exactly the same test and",
    "start": "1469120",
    "end": "1475200"
  },
  {
    "text": "release process let's take a look",
    "start": "1475200",
    "end": "1480158"
  },
  {
    "text": "moment of truth here pull requests all right update istio sidecar to 113 4.",
    "start": "1481840",
    "end": "1488240"
  },
  {
    "text": "again our end-to-end test hasn't passed it's extremely thorough it actually does a roll out that goes through the entire",
    "start": "1488240",
    "end": "1494960"
  },
  {
    "text": "canary process and you don't want canaries to run terribly quickly but for that reason i'm not going to stand around and wait for the end to end test",
    "start": "1494960",
    "end": "1501440"
  },
  {
    "text": "to pass today i want to upgrade my data plane uh let's go ahead and confirm that",
    "start": "1501440",
    "end": "1509039"
  },
  {
    "text": "now i'm going to double back and show you that our control plane actually did upgrade uh what was",
    "start": "1509039",
    "end": "1515520"
  },
  {
    "text": "what was the command there is dod",
    "start": "1515520",
    "end": "1519039"
  },
  {
    "text": "i didn't show you the before which was a mistake but before oh actually we did here we were at 113 3 on istio base",
    "start": "1520960",
    "end": "1527279"
  },
  {
    "text": "before",
    "start": "1527279",
    "end": "1529840"
  },
  {
    "text": "and now we're still at 1 13 4. do a flux get run run am i on the wrong cluster no run the",
    "start": "1533840",
    "end": "1540480"
  },
  {
    "text": "command again let's see what flux does",
    "start": "1540480",
    "end": "1544640"
  },
  {
    "text": "okay so it only upgraded the crds and yeah we",
    "start": "1547760",
    "end": "1552799"
  },
  {
    "text": "have we can do a minus minus weight",
    "start": "1552799",
    "end": "1558399"
  },
  {
    "text": "oops you can type it wait",
    "start": "1559600",
    "end": "1563679"
  },
  {
    "text": "no watch watch sorry i wrote the command and i don't know don't know the name",
    "start": "1567039",
    "end": "1574158"
  },
  {
    "text": "okay so now what flags does slowly moves through all all the releases so it takes okay i've",
    "start": "1577600",
    "end": "1584640"
  },
  {
    "text": "upgraded the crds and it waits for all the crds to be reconciled on the",
    "start": "1584640",
    "end": "1589840"
  },
  {
    "text": "by the cluster api and now it does okay has upgraded the gateway which is",
    "start": "1589840",
    "end": "1595840"
  },
  {
    "text": "the custom resource of the gateway that worked and now he's doing what he's doing",
    "start": "1595840",
    "end": "1601679"
  },
  {
    "text": "constellation in progress still the gateway so you see the revision how it moves from three to four right",
    "start": "1601679",
    "end": "1609840"
  },
  {
    "text": "and for all this uh all these upgrades that flux is doing once has upgraded something or started",
    "start": "1609840",
    "end": "1615919"
  },
  {
    "text": "to upgrade something to let you know through you know slack channels uh team microsoft teams and so on so you can",
    "start": "1615919",
    "end": "1622480"
  },
  {
    "text": "actually see those if you have other thing uh sorted out okay so",
    "start": "1622480",
    "end": "1628600"
  },
  {
    "text": "[Applause] and the good news about a nail biter",
    "start": "1628600",
    "end": "1634799"
  },
  {
    "text": "like that is it's given me enough time that i think i should be able to check our data plane and see the same thing",
    "start": "1634799",
    "end": "1641279"
  },
  {
    "text": "updated we should be at 113 113 4. so we've gone ahead and done a live upgrade of istio we'd separated between the",
    "start": "1641279",
    "end": "1647600"
  },
  {
    "text": "control plane and the data plane also one added benefit of having the proxy defined actually in the deployment spec",
    "start": "1647600",
    "end": "1654080"
  },
  {
    "text": "is that flagger will do progressive delivery across your deployment so if i check flaggers canaries",
    "start": "1654080",
    "end": "1661679"
  },
  {
    "text": "i think it hasn't been too long they should still be in progress so on our back end service we currently have five",
    "start": "1661679",
    "end": "1667440"
  },
  {
    "text": "percent of our traffic going to the new version of the proxy and fi 95 of our",
    "start": "1667440",
    "end": "1672720"
  },
  {
    "text": "traffic going to the old version and it's going to periodically check with prometheus and ask is the service still",
    "start": "1672720",
    "end": "1678159"
  },
  {
    "text": "healthy shift a little bit more is the service still healthy shift a little bit more and it's going to be really boring",
    "start": "1678159",
    "end": "1683679"
  },
  {
    "text": "which is uh one of our favorite things to be in istio yeah",
    "start": "1683679",
    "end": "1689520"
  },
  {
    "text": "so let's take a look at our advantages and disadvantages now",
    "start": "1689520",
    "end": "1694559"
  },
  {
    "text": "um our proxy is now maintained up to date with an assembler range we can",
    "start": "1694559",
    "end": "1699919"
  },
  {
    "text": "automatically apply updates if we want if we want to without like patch updates can roll out without a pull request",
    "start": "1699919",
    "end": "1706240"
  },
  {
    "text": "or they could be stuck with a pull request it just depends on how your operational like security and safety how much how",
    "start": "1706240",
    "end": "1713200"
  },
  {
    "text": "paranoid you want to be i want to be pretty paranoid personally canaries are controlling the rollback",
    "start": "1713200",
    "end": "1718720"
  },
  {
    "text": "and we have auto or out and we have automated rollback if something is wrong with that proxy the 113 for proxy will",
    "start": "1718720",
    "end": "1724720"
  },
  {
    "text": "stop executing in the cluster the canary will fail back to 113.3 and our cluster will stay up even if our istio upgrade",
    "start": "1724720",
    "end": "1731360"
  },
  {
    "text": "was not great we still haven't fixed that revision based problem but when once we do this is what the new",
    "start": "1731360",
    "end": "1737279"
  },
  {
    "text": "workflow should look like when a new version of the control plane becomes available we don't replace the",
    "start": "1737279",
    "end": "1742720"
  },
  {
    "text": "control plane yaml instead we create a new revision this is what you all should be doing if you're upgrading istio it's much more",
    "start": "1742720",
    "end": "1748799"
  },
  {
    "text": "secure it means that they'll run side by side two control planes two different versions we'll go through the same pull",
    "start": "1748799",
    "end": "1754320"
  },
  {
    "text": "request process and then we will move tags tags are like sim links for your",
    "start": "1754320",
    "end": "1760000"
  },
  {
    "text": "revisions so you might have like a first wave second",
    "start": "1760000",
    "end": "1766799"
  },
  {
    "text": "wave third wave the first wave is going to get updates first second wave second what we're going to do is we're going to",
    "start": "1766799",
    "end": "1771919"
  },
  {
    "text": "find this the first wave tag and say first wave tag used to be one thirteen three now first wave tag is one thirteen",
    "start": "1771919",
    "end": "1777279"
  },
  {
    "text": "four and all of those proxies as soon as that that pr finishes will get moved over and we'll get canaried just as in",
    "start": "1777279",
    "end": "1784240"
  },
  {
    "text": "the past so we think that this will be a good way to keep istio up to date in production",
    "start": "1784240",
    "end": "1791120"
  },
  {
    "text": "we obviously it's still very much a work in progress and there will be continued updates to it over the coming months but",
    "start": "1791120",
    "end": "1796640"
  },
  {
    "text": "you're welcome to fork the repo and kick the tires on it",
    "start": "1796640",
    "end": "1802640"
  },
  {
    "text": "if there's any takeaways if there is one thing that you leave this room with today i would like for it to be and i said",
    "start": "1802640",
    "end": "1808720"
  },
  {
    "text": "istio here i think we can just replace that with service mesh automate your service mesh upgrades please please",
    "start": "1808720",
    "end": "1816080"
  },
  {
    "text": "please or consider paying a vendor to do it if this is overwhelming to you google and many other vendors in this space",
    "start": "1816080",
    "end": "1822320"
  },
  {
    "text": "will take care of your upgrades on your behalf and that is a totally fine way of doing things if you're not willing to do",
    "start": "1822320",
    "end": "1829279"
  },
  {
    "text": "either of those things you need to budget engineering time to upgrade a steal don't take an open",
    "start": "1829279",
    "end": "1836080"
  },
  {
    "text": "source project make it core to the application that you're running and then forget about it and not have any",
    "start": "1836080",
    "end": "1842159"
  },
  {
    "text": "operations budget for it don't beat the 88 of your users yes yes if you're upgrading",
    "start": "1842159",
    "end": "1848799"
  },
  {
    "text": "it you are now in the in the top 12 so uh congratulations we want to widen that quite a bit uh with that being said",
    "start": "1848799",
    "end": "1855919"
  },
  {
    "text": "here's some links where you can find more information and i think we actually still have a few minutes for questions didn't expect that",
    "start": "1855919",
    "end": "1863560"
  },
  {
    "text": "[Applause]",
    "start": "1863560",
    "end": "1871260"
  },
  {
    "text": "really nice talk um we've been upgrading istio religiously with the istio operator how it is the",
    "start": "1882720",
    "end": "1889279"
  },
  {
    "text": "operator uh we're together with a flux and flag thank you",
    "start": "1889279",
    "end": "1895919"
  },
  {
    "text": "you're saying do they work together with flex and flagger i mean if i've been maintaining it with the operator how would i use a uh flux and flagger i can",
    "start": "1896720",
    "end": "1904559"
  },
  {
    "text": "answer that so the first version of my repository was using history operator",
    "start": "1904559",
    "end": "1910159"
  },
  {
    "text": "and that works great because flagger and flux can do with any kind of custom resource",
    "start": "1910159",
    "end": "1915679"
  },
  {
    "text": "right it was the same experience but",
    "start": "1915679",
    "end": "1921039"
  },
  {
    "text": "yeah so the instio team said switch to helen charles because the operator all",
    "start": "1921039",
    "end": "1926080"
  },
  {
    "text": "he does in inside are doing is the same thing he's running a helm",
    "start": "1926080",
    "end": "1931760"
  },
  {
    "text": "upgrade and so on and flux has a dedicated helm controller which does all things helm way better than you know",
    "start": "1931760",
    "end": "1939200"
  },
  {
    "text": "wrapping it out and hiding it so you have the helm experience you can debug it with helm and so on so it's it's add",
    "start": "1939200",
    "end": "1945440"
  },
  {
    "text": "more adds more observability to the whole process like you do flux and uh",
    "start": "1945440",
    "end": "1950640"
  },
  {
    "text": "get helm releases and you can actually see oh it's stuck at the crds or if there is a problem with the gateway the",
    "start": "1950640",
    "end": "1956559"
  },
  {
    "text": "operator will just hide all of that under a single upgrade operation so that being said if if you're happy with the",
    "start": "1956559",
    "end": "1962799"
  },
  {
    "text": "operator stick with it and you can look in the repo about three weeks ago that was what we were doing in the repo",
    "start": "1962799",
    "end": "1968640"
  },
  {
    "text": "if you're looking if you're not currently upgrading and you're looking for a way to do that probably don't look at the operator we",
    "start": "1968640",
    "end": "1974399"
  },
  {
    "text": "would recommend that new users go to helm charts we're still going to keep maintaining and fixing bugs in the operator but the future direction is",
    "start": "1974399",
    "end": "1980799"
  },
  {
    "text": "definitely helm any other questions",
    "start": "1980799",
    "end": "1987200"
  },
  {
    "text": "all right so we are top of our uh okay one last question",
    "start": "1988000",
    "end": "1994320"
  },
  {
    "text": "hello uh nice talk thank you um i just had one question would you say that this",
    "start": "1998799",
    "end": "2004159"
  },
  {
    "text": "git ops approach is better than doing it on infrastructure as code because sometimes for cluster wide or",
    "start": "2004159",
    "end": "2012840"
  },
  {
    "text": "infrastructure-wide components we usually put these installations in terraform",
    "start": "2012840",
    "end": "2019679"
  },
  {
    "text": "but what would you say is an advantage of having it here in githubs",
    "start": "2019679",
    "end": "2026398"
  },
  {
    "text": "why would you use teraform if you are deploying on kubernetes i'm asking you",
    "start": "2026640",
    "end": "2033080"
  },
  {
    "text": "cure near this provider it's really good i guess i'll i probably have a little",
    "start": "2033919",
    "end": "2038960"
  },
  {
    "text": "bit of a different opinion than stefan does on this particular topic for my part i want to make sure that",
    "start": "2038960",
    "end": "2044159"
  },
  {
    "text": "you're comfortable doing it the way that you do other upgrades istio should not be something that is unique and special",
    "start": "2044159",
    "end": "2049760"
  },
  {
    "text": "in your environment it should upgrade the same way that every other piece of infrastructure that you have so if terraform is your tool of choice for all",
    "start": "2049760",
    "end": "2056079"
  },
  {
    "text": "of your infrastructure there are istio is it charts or i'm not a terraform person there's terraform",
    "start": "2056079",
    "end": "2062079"
  },
  {
    "text": "stuff for istio that you can use and you should look at investing there but if you're already using git ops or if",
    "start": "2062079",
    "end": "2067118"
  },
  {
    "text": "you're not using anything then i would encourage you to look at get ops so the main difference from my perspective is",
    "start": "2067119",
    "end": "2072800"
  },
  {
    "text": "the fact that terraform you run it once but flux will keep monitoring what's happening",
    "start": "2072800",
    "end": "2078398"
  },
  {
    "text": "right so it's the difference between githubs and just doing once applying it is the fact that github does a",
    "start": "2078399",
    "end": "2085200"
  },
  {
    "text": "reconciliation all the time so if something breaks or something goes on the class someone goes on the cluster",
    "start": "2085200",
    "end": "2091118"
  },
  {
    "text": "does a cube cattle edit of the of some you know pilot deployment",
    "start": "2091119",
    "end": "2096320"
  },
  {
    "text": "and that goes wrong flux will just undo it automatically because flux does not allow uh divergency a drift inside the",
    "start": "2096320",
    "end": "2103920"
  },
  {
    "text": "cluster i'm guessing you don't run hella terraform apply every couple of seconds",
    "start": "2103920",
    "end": "2109520"
  },
  {
    "text": "well flex can do that because it's right there in the cluster and can monitor all the changes that were done outside of",
    "start": "2109520",
    "end": "2117200"
  },
  {
    "text": "git and you correct that change and will let you know hey some modified issue i'm putting back in the same thing in the",
    "start": "2117200",
    "end": "2123920"
  },
  {
    "text": "same way it was described there in the in the git repo thank you you're welcome",
    "start": "2123920",
    "end": "2129520"
  },
  {
    "text": "that was it right all right so we are tappable and thanks for joining today and a great presentation and demo",
    "start": "2129520",
    "end": "2135839"
  },
  {
    "text": "meeting stefan and hopefully you guys say before i back and enjoy the rest of the kubecon",
    "start": "2135839",
    "end": "2141530"
  },
  {
    "text": "[Applause] you",
    "start": "2141530",
    "end": "2147680"
  }
]