[
  {
    "start": "0",
    "end": "15000"
  },
  {
    "text": "hey my name is rob scott and i get to",
    "start": "2159",
    "end": "4000"
  },
  {
    "text": "work with a great team",
    "start": "4000",
    "end": "5520"
  },
  {
    "text": "at google on kubernetes networking",
    "start": "5520",
    "end": "8720"
  },
  {
    "text": "today i want to talk with you about",
    "start": "8720",
    "end": "10400"
  },
  {
    "text": "improving network efficiency",
    "start": "10400",
    "end": "12480"
  },
  {
    "text": "with topology aware routing but before",
    "start": "12480",
    "end": "16480"
  },
  {
    "start": "15000",
    "end": "15000"
  },
  {
    "text": "we get into that i want to provide just",
    "start": "16480",
    "end": "17920"
  },
  {
    "text": "a brief",
    "start": "17920",
    "end": "18560"
  },
  {
    "text": "outline of how i want to structure",
    "start": "18560",
    "end": "20960"
  },
  {
    "text": "today's talk",
    "start": "20960",
    "end": "23279"
  },
  {
    "text": "first i'm going to go through a little",
    "start": "23279",
    "end": "24720"
  },
  {
    "text": "bit of background as far as how we got",
    "start": "24720",
    "end": "27119"
  },
  {
    "text": "to where we are",
    "start": "27119",
    "end": "28800"
  },
  {
    "text": "and then cover our first attempt at",
    "start": "28800",
    "end": "30640"
  },
  {
    "text": "topology aware routing and some of the",
    "start": "30640",
    "end": "32719"
  },
  {
    "text": "limitations associated with that",
    "start": "32719",
    "end": "35600"
  },
  {
    "text": "then i want to explain our second",
    "start": "35600",
    "end": "39040"
  },
  {
    "text": "attempt and what we're trying to do",
    "start": "39040",
    "end": "40640"
  },
  {
    "text": "differently this time as well as",
    "start": "40640",
    "end": "44239"
  },
  {
    "text": "how that actually performs in real life",
    "start": "44239",
    "end": "46640"
  },
  {
    "text": "with the simulator",
    "start": "46640",
    "end": "48000"
  },
  {
    "text": "simulating millions of different inputs",
    "start": "48000",
    "end": "50000"
  },
  {
    "text": "and scenarios",
    "start": "50000",
    "end": "51760"
  },
  {
    "text": "and finally i want to provide a",
    "start": "51760",
    "end": "53199"
  },
  {
    "text": "long-term vision for where we see this",
    "start": "53199",
    "end": "55280"
  },
  {
    "text": "going in the months and years to come",
    "start": "55280",
    "end": "60079"
  },
  {
    "start": "60000",
    "end": "60000"
  },
  {
    "text": "but before i go any further i have to",
    "start": "60079",
    "end": "62239"
  },
  {
    "text": "add some disclaimers",
    "start": "62239",
    "end": "64080"
  },
  {
    "text": "topology aware routing is hard to get",
    "start": "64080",
    "end": "66400"
  },
  {
    "text": "right",
    "start": "66400",
    "end": "67600"
  },
  {
    "text": "this talk attempts to show our thought",
    "start": "67600",
    "end": "69760"
  },
  {
    "text": "process here",
    "start": "69760",
    "end": "71119"
  },
  {
    "text": "and i'll be the first to say this",
    "start": "71119",
    "end": "73520"
  },
  {
    "text": "approach is",
    "start": "73520",
    "end": "74720"
  },
  {
    "text": "not perfect we still have lots of areas",
    "start": "74720",
    "end": "76960"
  },
  {
    "text": "for improvement",
    "start": "76960",
    "end": "78240"
  },
  {
    "text": "and things still could change but i",
    "start": "78240",
    "end": "81119"
  },
  {
    "text": "wanted to bring attention to",
    "start": "81119",
    "end": "82560"
  },
  {
    "text": "the direction we're going and the",
    "start": "82560",
    "end": "84479"
  },
  {
    "text": "improvements we're hoping to make here",
    "start": "84479",
    "end": "88159"
  },
  {
    "text": "so let's get into the background a",
    "start": "88320",
    "end": "89759"
  },
  {
    "text": "little bit",
    "start": "89759",
    "end": "91840"
  },
  {
    "start": "91000",
    "end": "91000"
  },
  {
    "text": "now if you've used kubernetes recently",
    "start": "91840",
    "end": "94079"
  },
  {
    "text": "you've probably created a service or a",
    "start": "94079",
    "end": "96400"
  },
  {
    "text": "pod or both",
    "start": "96400",
    "end": "98079"
  },
  {
    "text": "and if it's a new cluster a relatively",
    "start": "98079",
    "end": "101439"
  },
  {
    "text": "new kubernetes cluster",
    "start": "101439",
    "end": "102960"
  },
  {
    "text": "it probably has the endpoint slice",
    "start": "102960",
    "end": "104720"
  },
  {
    "text": "controller running and that watches",
    "start": "104720",
    "end": "107040"
  },
  {
    "text": "services and pods and creates endpoint",
    "start": "107040",
    "end": "110159"
  },
  {
    "text": "slices based on those",
    "start": "110159",
    "end": "111840"
  },
  {
    "text": "and those endpoint slices are just lists",
    "start": "111840",
    "end": "114079"
  },
  {
    "text": "of pod ips for each service",
    "start": "114079",
    "end": "117040"
  },
  {
    "text": "and couproxy watches those endpoint",
    "start": "117040",
    "end": "119200"
  },
  {
    "text": "slices",
    "start": "119200",
    "end": "120640"
  },
  {
    "text": "and configures iptables on each",
    "start": "120640",
    "end": "123840"
  },
  {
    "text": "node so what does iptables look like",
    "start": "123840",
    "end": "128160"
  },
  {
    "start": "127000",
    "end": "127000"
  },
  {
    "text": "here",
    "start": "128160",
    "end": "130399"
  },
  {
    "text": "iptables configuration that we're",
    "start": "130479",
    "end": "132720"
  },
  {
    "text": "writing is",
    "start": "132720",
    "end": "134239"
  },
  {
    "text": "very much based on probabilities",
    "start": "134239",
    "end": "137280"
  },
  {
    "text": "so i copied this little snippet from",
    "start": "137280",
    "end": "139560"
  },
  {
    "text": "iptablesconfig",
    "start": "139560",
    "end": "140720"
  },
  {
    "text": "on a node in one of my kubernetes",
    "start": "140720",
    "end": "142640"
  },
  {
    "text": "clusters that had a",
    "start": "142640",
    "end": "144319"
  },
  {
    "text": "two endpoint service and that just means",
    "start": "144319",
    "end": "146560"
  },
  {
    "text": "a service with two pods behind it",
    "start": "146560",
    "end": "149680"
  },
  {
    "text": "and in this case we have two key lines",
    "start": "149680",
    "end": "153200"
  },
  {
    "text": "here",
    "start": "153200",
    "end": "154840"
  },
  {
    "text": "first if you're targeting this service",
    "start": "154840",
    "end": "158560"
  },
  {
    "text": "there should be a 50 probability that",
    "start": "158560",
    "end": "161200"
  },
  {
    "text": "you'll choose",
    "start": "161200",
    "end": "162000"
  },
  {
    "text": "this specific service endpoint so that",
    "start": "162000",
    "end": "164480"
  },
  {
    "text": "0.5 probability",
    "start": "164480",
    "end": "166879"
  },
  {
    "text": "and second if you don't choose that",
    "start": "166879",
    "end": "168800"
  },
  {
    "text": "service endpoint",
    "start": "168800",
    "end": "170000"
  },
  {
    "text": "continue down the list and since you",
    "start": "170000",
    "end": "172160"
  },
  {
    "text": "haven't chosen that endpoint",
    "start": "172160",
    "end": "174000"
  },
  {
    "text": "you should choose this second service",
    "start": "174000",
    "end": "176640"
  },
  {
    "text": "endpoint",
    "start": "176640",
    "end": "177519"
  },
  {
    "text": "so each endpoint has a 50 chance of",
    "start": "177519",
    "end": "180080"
  },
  {
    "text": "being chosen",
    "start": "180080",
    "end": "181599"
  },
  {
    "text": "and you can see that same thing scaled",
    "start": "181599",
    "end": "184239"
  },
  {
    "text": "out to",
    "start": "184239",
    "end": "185040"
  },
  {
    "text": "thousands or even a hundred thousand",
    "start": "185040",
    "end": "186800"
  },
  {
    "text": "endpoints across different kubernetes",
    "start": "186800",
    "end": "188879"
  },
  {
    "text": "clusters",
    "start": "188879",
    "end": "189840"
  },
  {
    "text": "we rely heavily on iptable's",
    "start": "189840",
    "end": "192000"
  },
  {
    "text": "probabilities",
    "start": "192000",
    "end": "194239"
  },
  {
    "start": "194000",
    "end": "194000"
  },
  {
    "text": "now this works but it does come along",
    "start": "194239",
    "end": "197440"
  },
  {
    "text": "with some issues",
    "start": "197440",
    "end": "199120"
  },
  {
    "text": "traffic is distributed randomly across",
    "start": "199120",
    "end": "201440"
  },
  {
    "text": "all endpoints",
    "start": "201440",
    "end": "202800"
  },
  {
    "text": "regardless of where it actually",
    "start": "202800",
    "end": "204319"
  },
  {
    "text": "originates from",
    "start": "204319",
    "end": "206000"
  },
  {
    "text": "so in a three zone cluster traffic is",
    "start": "206000",
    "end": "208080"
  },
  {
    "text": "more likely to go to another zone",
    "start": "208080",
    "end": "210319"
  },
  {
    "text": "than to stay in the zone it actually",
    "start": "210319",
    "end": "212319"
  },
  {
    "text": "originated from",
    "start": "212319",
    "end": "214400"
  },
  {
    "text": "and every instance of coup proxy needs",
    "start": "214400",
    "end": "216640"
  },
  {
    "text": "to keep track of",
    "start": "216640",
    "end": "217599"
  },
  {
    "text": "every single endpoint in your cluster",
    "start": "217599",
    "end": "220239"
  },
  {
    "text": "which means the larger a cluster gets",
    "start": "220239",
    "end": "222560"
  },
  {
    "text": "the more end points every instance of",
    "start": "222560",
    "end": "224640"
  },
  {
    "text": "kubeproxy has to manage",
    "start": "224640",
    "end": "226640"
  },
  {
    "text": "which results in slower updates and even",
    "start": "226640",
    "end": "229920"
  },
  {
    "text": "sometimes",
    "start": "229920",
    "end": "230640"
  },
  {
    "text": "more latency we also have to work within",
    "start": "230640",
    "end": "234720"
  },
  {
    "start": "233000",
    "end": "233000"
  },
  {
    "text": "some constraints here",
    "start": "234720",
    "end": "236720"
  },
  {
    "text": "coupe proxy doesn't handle requests",
    "start": "236720",
    "end": "238879"
  },
  {
    "text": "directly it just",
    "start": "238879",
    "end": "240480"
  },
  {
    "text": "programs iptables or ipvs",
    "start": "240480",
    "end": "243920"
  },
  {
    "text": "and that's great in many cases it means",
    "start": "243920",
    "end": "246159"
  },
  {
    "text": "if there's",
    "start": "246159",
    "end": "246959"
  },
  {
    "text": "some kind of problem with coop proxy",
    "start": "246959",
    "end": "249599"
  },
  {
    "text": "your networking",
    "start": "249599",
    "end": "250560"
  },
  {
    "text": "doesn't break immediately instead it",
    "start": "250560",
    "end": "253439"
  },
  {
    "text": "just relies on whatever was already in",
    "start": "253439",
    "end": "255360"
  },
  {
    "text": "iptables",
    "start": "255360",
    "end": "256560"
  },
  {
    "text": "config or ipvs config which is good",
    "start": "256560",
    "end": "260720"
  },
  {
    "text": "because coup proxy is not perfect but",
    "start": "260720",
    "end": "263600"
  },
  {
    "text": "unfortunately it means we don't have",
    "start": "263600",
    "end": "265360"
  },
  {
    "text": "visibility",
    "start": "265360",
    "end": "266400"
  },
  {
    "text": "into request errors or timeouts and it's",
    "start": "266400",
    "end": "268960"
  },
  {
    "text": "really difficult to",
    "start": "268960",
    "end": "270240"
  },
  {
    "text": "understand when an endpoint is",
    "start": "270240",
    "end": "272479"
  },
  {
    "text": "overloaded",
    "start": "272479",
    "end": "274639"
  },
  {
    "text": "and also coup proxy is deployed on each",
    "start": "274639",
    "end": "277280"
  },
  {
    "text": "node in your cluster",
    "start": "277280",
    "end": "278960"
  },
  {
    "text": "so any significant change could be",
    "start": "278960",
    "end": "281759"
  },
  {
    "text": "expensive",
    "start": "281759",
    "end": "283199"
  },
  {
    "text": "so think about this because it's running",
    "start": "283199",
    "end": "285840"
  },
  {
    "text": "on every node in your cluster",
    "start": "285840",
    "end": "287680"
  },
  {
    "text": "any change to an endpoint anywhere in",
    "start": "287680",
    "end": "289440"
  },
  {
    "text": "your cluster has to be sent out to",
    "start": "289440",
    "end": "292000"
  },
  {
    "text": "every instance of crew proxy on every",
    "start": "292000",
    "end": "294400"
  },
  {
    "text": "node",
    "start": "294400",
    "end": "295120"
  },
  {
    "text": "so if we're updating endpoints more",
    "start": "295120",
    "end": "296800"
  },
  {
    "text": "frequently",
    "start": "296800",
    "end": "298400"
  },
  {
    "text": "that's expensive similarly more advanced",
    "start": "298400",
    "end": "301680"
  },
  {
    "text": "logic increases cpu utilization again",
    "start": "301680",
    "end": "305039"
  },
  {
    "text": "on each node which is significant",
    "start": "305039",
    "end": "307280"
  },
  {
    "text": "overhead to add",
    "start": "307280",
    "end": "308800"
  },
  {
    "text": "on every single note in your cluster so",
    "start": "308800",
    "end": "310720"
  },
  {
    "text": "we have to be careful",
    "start": "310720",
    "end": "312240"
  },
  {
    "text": "with any approach we take here okay so",
    "start": "312240",
    "end": "315039"
  },
  {
    "text": "with that background let's talk about",
    "start": "315039",
    "end": "316639"
  },
  {
    "text": "our first attempt",
    "start": "316639",
    "end": "318560"
  },
  {
    "start": "318000",
    "end": "318000"
  },
  {
    "text": "we added a new alpha api field to",
    "start": "318560",
    "end": "320880"
  },
  {
    "text": "services called topology keys",
    "start": "320880",
    "end": "323360"
  },
  {
    "text": "this allowed for endless flexibility you",
    "start": "323360",
    "end": "326160"
  },
  {
    "text": "could specify",
    "start": "326160",
    "end": "327039"
  },
  {
    "text": "arbitrary topology keys in any order",
    "start": "327039",
    "end": "330960"
  },
  {
    "text": "and coup proxy would then filter",
    "start": "330960",
    "end": "334240"
  },
  {
    "text": "endpoints based on those topology keys",
    "start": "334240",
    "end": "336639"
  },
  {
    "text": "based on those labels so",
    "start": "336639",
    "end": "338000"
  },
  {
    "text": "any endpoints with matching values for",
    "start": "338000",
    "end": "340400"
  },
  {
    "text": "those labels",
    "start": "340400",
    "end": "341360"
  },
  {
    "text": "would be filtered in and everything else",
    "start": "341360",
    "end": "343600"
  },
  {
    "text": "would be excluded from",
    "start": "343600",
    "end": "344960"
  },
  {
    "text": "what couproxy considered on a given node",
    "start": "344960",
    "end": "348240"
  },
  {
    "text": "a wild card character could then be used",
    "start": "348240",
    "end": "350880"
  },
  {
    "text": "to indicate that if matching labels",
    "start": "350880",
    "end": "352960"
  },
  {
    "text": "couldn't be found",
    "start": "352960",
    "end": "354320"
  },
  {
    "text": "traffic should be routed elsewhere",
    "start": "354320",
    "end": "357759"
  },
  {
    "text": "so let's take some concrete examples",
    "start": "357759",
    "end": "360479"
  },
  {
    "text": "here of this configuration",
    "start": "360479",
    "end": "362960"
  },
  {
    "start": "362000",
    "end": "362000"
  },
  {
    "text": "first if you wanted to require traffic",
    "start": "362960",
    "end": "365120"
  },
  {
    "text": "stay in the same",
    "start": "365120",
    "end": "366000"
  },
  {
    "text": "zone or region your topology keys might",
    "start": "366000",
    "end": "369680"
  },
  {
    "text": "look something like this",
    "start": "369680",
    "end": "372560"
  },
  {
    "text": "and if instead in of requiring you are",
    "start": "372560",
    "end": "375199"
  },
  {
    "text": "fine with just",
    "start": "375199",
    "end": "376080"
  },
  {
    "text": "preferring the traffic stay in the same",
    "start": "376080",
    "end": "378160"
  },
  {
    "text": "zone or region",
    "start": "378160",
    "end": "379280"
  },
  {
    "text": "you would add that final wild card at",
    "start": "379280",
    "end": "381680"
  },
  {
    "text": "the end of the",
    "start": "381680",
    "end": "382880"
  },
  {
    "text": "field so this made sense it was a very",
    "start": "382880",
    "end": "387120"
  },
  {
    "text": "powerful api",
    "start": "387120",
    "end": "389120"
  },
  {
    "text": "but it did come with some real",
    "start": "389120",
    "end": "392840"
  },
  {
    "text": "limitations",
    "start": "392840",
    "end": "394000"
  },
  {
    "start": "394000",
    "end": "394000"
  },
  {
    "text": "now first off this was a relatively",
    "start": "394000",
    "end": "396000"
  },
  {
    "text": "complex api",
    "start": "396000",
    "end": "397919"
  },
  {
    "text": "and what most users wanted was very",
    "start": "397919",
    "end": "400160"
  },
  {
    "text": "similar",
    "start": "400160",
    "end": "401280"
  },
  {
    "text": "traffic should stay as close to where it",
    "start": "401280",
    "end": "403520"
  },
  {
    "text": "originated from",
    "start": "403520",
    "end": "404720"
  },
  {
    "text": "as possible and unfortunately",
    "start": "404720",
    "end": "408319"
  },
  {
    "text": "that really common use case was",
    "start": "408319",
    "end": "411120"
  },
  {
    "text": "relatively",
    "start": "411120",
    "end": "411840"
  },
  {
    "text": "difficult to communicate with this api",
    "start": "411840",
    "end": "415840"
  },
  {
    "text": "and it required configuration on every",
    "start": "415840",
    "end": "418800"
  },
  {
    "text": "single service and",
    "start": "418800",
    "end": "420080"
  },
  {
    "text": "relatively significant and complex",
    "start": "420080",
    "end": "422720"
  },
  {
    "text": "configuration",
    "start": "422720",
    "end": "425360"
  },
  {
    "text": "similarly all the logic behind this",
    "start": "425360",
    "end": "428160"
  },
  {
    "text": "functionality",
    "start": "428160",
    "end": "429120"
  },
  {
    "text": "lived in coup proxy and that meant that",
    "start": "429120",
    "end": "432319"
  },
  {
    "text": "there was",
    "start": "432319",
    "end": "432880"
  },
  {
    "text": "extra processing on each node and it",
    "start": "432880",
    "end": "435840"
  },
  {
    "text": "also meant",
    "start": "435840",
    "end": "436560"
  },
  {
    "text": "that all endpoints still needed to be",
    "start": "436560",
    "end": "439039"
  },
  {
    "text": "delivered",
    "start": "439039",
    "end": "439680"
  },
  {
    "text": "to every node in the cluster even if",
    "start": "439680",
    "end": "442240"
  },
  {
    "text": "that node was then going to filter those",
    "start": "442240",
    "end": "444080"
  },
  {
    "text": "endpoints out",
    "start": "444080",
    "end": "446879"
  },
  {
    "text": "it was also a relatively difficult api",
    "start": "447919",
    "end": "450880"
  },
  {
    "start": "448000",
    "end": "448000"
  },
  {
    "text": "to implement",
    "start": "450880",
    "end": "452720"
  },
  {
    "text": "so ideally topology keys would be given",
    "start": "452720",
    "end": "455199"
  },
  {
    "text": "more weight",
    "start": "455199",
    "end": "455919"
  },
  {
    "text": "if they appeared first in the list",
    "start": "455919",
    "end": "459199"
  },
  {
    "text": "but this would be quite difficult to",
    "start": "459199",
    "end": "460880"
  },
  {
    "text": "achieve safely",
    "start": "460880",
    "end": "462960"
  },
  {
    "text": "there's a very real potential that we",
    "start": "462960",
    "end": "464960"
  },
  {
    "text": "could overload endpoints",
    "start": "464960",
    "end": "467520"
  },
  {
    "text": "so let's take an example where we have a",
    "start": "467520",
    "end": "469759"
  },
  {
    "text": "lot of traffic originating from a zone",
    "start": "469759",
    "end": "472080"
  },
  {
    "text": "but only one endpoint to serve that",
    "start": "472080",
    "end": "474240"
  },
  {
    "text": "traffic",
    "start": "474240",
    "end": "475120"
  },
  {
    "text": "it's easy to see if you had configured a",
    "start": "475120",
    "end": "477199"
  },
  {
    "text": "service with",
    "start": "477199",
    "end": "478400"
  },
  {
    "text": "prefer or even require zone",
    "start": "478400",
    "end": "481680"
  },
  {
    "text": "that would be very difficult to avoid",
    "start": "481680",
    "end": "484400"
  },
  {
    "text": "overload",
    "start": "484400",
    "end": "486160"
  },
  {
    "text": "now you know at first we just did some",
    "start": "486160",
    "end": "489199"
  },
  {
    "text": "basic filtering",
    "start": "489199",
    "end": "490479"
  },
  {
    "text": "that matched any labels based on",
    "start": "490479",
    "end": "492240"
  },
  {
    "text": "topology keys and",
    "start": "492240",
    "end": "493759"
  },
  {
    "text": "that kind of worked but we still had the",
    "start": "493759",
    "end": "495440"
  },
  {
    "text": "same risk of overload",
    "start": "495440",
    "end": "497759"
  },
  {
    "text": "and of course if that wild card",
    "start": "497759",
    "end": "499360"
  },
  {
    "text": "character was passed in then",
    "start": "499360",
    "end": "501120"
  },
  {
    "text": "we couldn't really do any filtering",
    "start": "501120",
    "end": "502879"
  },
  {
    "text": "because well you could route traffic",
    "start": "502879",
    "end": "505520"
  },
  {
    "text": "anywhere so our initial implementation",
    "start": "505520",
    "end": "508800"
  },
  {
    "text": "was",
    "start": "508800",
    "end": "509440"
  },
  {
    "text": "very basic and it was hard to get it",
    "start": "509440",
    "end": "511520"
  },
  {
    "text": "quite right",
    "start": "511520",
    "end": "512959"
  },
  {
    "text": "especially because you could have so",
    "start": "512959",
    "end": "515039"
  },
  {
    "text": "many potential combinations of",
    "start": "515039",
    "end": "516959"
  },
  {
    "text": "configuration",
    "start": "516959",
    "end": "519599"
  },
  {
    "text": "so ideally we would prioritize endpoints",
    "start": "519599",
    "end": "522240"
  },
  {
    "start": "520000",
    "end": "520000"
  },
  {
    "text": "matching",
    "start": "522240",
    "end": "522800"
  },
  {
    "text": "earlier labels in the list and we'd",
    "start": "522800",
    "end": "525200"
  },
  {
    "text": "avoid overloading those endpoints",
    "start": "525200",
    "end": "527920"
  },
  {
    "text": "we'd also avoid sending traffic nowhere",
    "start": "527920",
    "end": "530320"
  },
  {
    "text": "so",
    "start": "530320",
    "end": "531040"
  },
  {
    "text": "as an example we would avoid sending",
    "start": "531040",
    "end": "533120"
  },
  {
    "text": "traffic",
    "start": "533120",
    "end": "534080"
  },
  {
    "text": "to you know no end points if there's no",
    "start": "534080",
    "end": "536640"
  },
  {
    "text": "end points in the zone or region",
    "start": "536640",
    "end": "538560"
  },
  {
    "text": "we want to avoid that situation where",
    "start": "538560",
    "end": "540720"
  },
  {
    "text": "traffic has nowhere to go",
    "start": "540720",
    "end": "543519"
  },
  {
    "text": "and similarly we'd make that star",
    "start": "543519",
    "end": "546160"
  },
  {
    "text": "character behave more like a wild card",
    "start": "546160",
    "end": "548160"
  },
  {
    "text": "more like",
    "start": "548160",
    "end": "548720"
  },
  {
    "text": "failover configuration instead of just",
    "start": "548720",
    "end": "551440"
  },
  {
    "text": "removing filtering altogether",
    "start": "551440",
    "end": "554320"
  },
  {
    "text": "and although these all seem like great",
    "start": "554320",
    "end": "556959"
  },
  {
    "text": "goals",
    "start": "556959",
    "end": "558000"
  },
  {
    "text": "they became quite difficult to achieve",
    "start": "558000",
    "end": "560880"
  },
  {
    "text": "especially with such a flexible",
    "start": "560880",
    "end": "562880"
  },
  {
    "text": "api so",
    "start": "562880",
    "end": "566560"
  },
  {
    "text": "with that background we said well maybe",
    "start": "566560",
    "end": "569279"
  },
  {
    "text": "we should try again",
    "start": "569279",
    "end": "572240"
  },
  {
    "text": "and in our second attempt we wanted to",
    "start": "572399",
    "end": "575760"
  },
  {
    "start": "573000",
    "end": "573000"
  },
  {
    "text": "identify",
    "start": "575760",
    "end": "576800"
  },
  {
    "text": "three goals first",
    "start": "576800",
    "end": "580240"
  },
  {
    "text": "we wanted to build consensus around a",
    "start": "580240",
    "end": "582560"
  },
  {
    "text": "small set of topology labels",
    "start": "582560",
    "end": "584720"
  },
  {
    "text": "that would be clearly defined and",
    "start": "584720",
    "end": "586560"
  },
  {
    "text": "officially supported",
    "start": "586560",
    "end": "588800"
  },
  {
    "text": "we wanted to develop a simple approach",
    "start": "588800",
    "end": "590880"
  },
  {
    "text": "that covered the most",
    "start": "590880",
    "end": "592240"
  },
  {
    "text": "common use cases as automatically as",
    "start": "592240",
    "end": "595120"
  },
  {
    "text": "possible",
    "start": "595120",
    "end": "596880"
  },
  {
    "text": "and finally we wanted to only deliver",
    "start": "596880",
    "end": "599200"
  },
  {
    "text": "the endpoints",
    "start": "599200",
    "end": "600240"
  },
  {
    "text": "that each node would actually care about",
    "start": "600240",
    "end": "602399"
  },
  {
    "text": "instead of continuing to deliver",
    "start": "602399",
    "end": "604079"
  },
  {
    "text": "all endpoints to all instances of coup",
    "start": "604079",
    "end": "606880"
  },
  {
    "text": "proxy",
    "start": "606880",
    "end": "607760"
  },
  {
    "text": "we thought this would make a very",
    "start": "607760",
    "end": "609200"
  },
  {
    "text": "significant difference for both",
    "start": "609200",
    "end": "611040"
  },
  {
    "text": "scalability",
    "start": "611040",
    "end": "611920"
  },
  {
    "text": "and performance so because this is",
    "start": "611920",
    "end": "615440"
  },
  {
    "text": "kubernetes",
    "start": "615440",
    "end": "616320"
  },
  {
    "text": "each one of these goals had an",
    "start": "616320",
    "end": "618240"
  },
  {
    "text": "associated cap",
    "start": "618240",
    "end": "620480"
  },
  {
    "text": "so if you're interested in all the",
    "start": "620480",
    "end": "622079"
  },
  {
    "text": "details associated with each one of",
    "start": "622079",
    "end": "623760"
  },
  {
    "text": "these proposals",
    "start": "623760",
    "end": "624800"
  },
  {
    "text": "i highly recommend you get on github and",
    "start": "624800",
    "end": "627040"
  },
  {
    "text": "go to the kubernetes enhancements repo",
    "start": "627040",
    "end": "630000"
  },
  {
    "text": "and look up each one of these caps i'm",
    "start": "630000",
    "end": "632720"
  },
  {
    "text": "going to provide",
    "start": "632720",
    "end": "633519"
  },
  {
    "text": "a decent overview of each of them in",
    "start": "633519",
    "end": "636240"
  },
  {
    "text": "this talk but i simply don't have enough",
    "start": "636240",
    "end": "638320"
  },
  {
    "text": "time",
    "start": "638320",
    "end": "638959"
  },
  {
    "text": "to provide the same level of detail that",
    "start": "638959",
    "end": "641600"
  },
  {
    "text": "each one of these cats",
    "start": "641600",
    "end": "642880"
  },
  {
    "text": "provides on their own for example cap",
    "start": "642880",
    "end": "645839"
  },
  {
    "text": "2004 elite apology aware routing",
    "start": "645839",
    "end": "648240"
  },
  {
    "text": "kep hat describes a lot of the different",
    "start": "648240",
    "end": "650880"
  },
  {
    "text": "algorithms we considered",
    "start": "650880",
    "end": "652480"
  },
  {
    "text": "and provides diagrams to show exactly",
    "start": "652480",
    "end": "654880"
  },
  {
    "text": "how they might work",
    "start": "654880",
    "end": "656399"
  },
  {
    "text": "i don't have enough time to cover every",
    "start": "656399",
    "end": "658480"
  },
  {
    "text": "different algorithm we've considered",
    "start": "658480",
    "end": "660800"
  },
  {
    "text": "but i hope i still will be able to give",
    "start": "660800",
    "end": "663040"
  },
  {
    "text": "a decent overview in this talk",
    "start": "663040",
    "end": "666560"
  },
  {
    "text": "so with that said let's talk about the",
    "start": "666560",
    "end": "668959"
  },
  {
    "text": "first cap",
    "start": "668959",
    "end": "670000"
  },
  {
    "text": "building consensus around a small set of",
    "start": "670000",
    "end": "672480"
  },
  {
    "text": "topology labels",
    "start": "672480",
    "end": "675040"
  },
  {
    "start": "675000",
    "end": "675000"
  },
  {
    "text": "now in this cap we wanted to standardize",
    "start": "675040",
    "end": "677760"
  },
  {
    "text": "on the following",
    "start": "677760",
    "end": "678800"
  },
  {
    "text": "labels one for region and one for zone",
    "start": "678800",
    "end": "682720"
  },
  {
    "text": "and we wanted to define region and zone",
    "start": "682720",
    "end": "685440"
  },
  {
    "text": "as being",
    "start": "685440",
    "end": "686839"
  },
  {
    "text": "hierarchical this meant that",
    "start": "686839",
    "end": "689200"
  },
  {
    "text": "zones could not be spread across",
    "start": "689200",
    "end": "691360"
  },
  {
    "text": "multiple regions",
    "start": "691360",
    "end": "692880"
  },
  {
    "text": "but a region could contain multiple",
    "start": "692880",
    "end": "695120"
  },
  {
    "text": "zones",
    "start": "695120",
    "end": "696560"
  },
  {
    "text": "we also wanted to state that these",
    "start": "696560",
    "end": "699440"
  },
  {
    "text": "labels",
    "start": "699440",
    "end": "700079"
  },
  {
    "text": "should be considered immutable this is a",
    "start": "700079",
    "end": "702720"
  },
  {
    "text": "very big deal and something that should",
    "start": "702720",
    "end": "704720"
  },
  {
    "text": "dramatically simplify",
    "start": "704720",
    "end": "706399"
  },
  {
    "text": "any implementations working with these",
    "start": "706399",
    "end": "709360"
  },
  {
    "text": "labels",
    "start": "709360",
    "end": "710800"
  },
  {
    "text": "and finally we've left open the door for",
    "start": "710800",
    "end": "713680"
  },
  {
    "text": "a third or maybe even",
    "start": "713680",
    "end": "714800"
  },
  {
    "text": "fourth key to be introduced in the",
    "start": "714800",
    "end": "716959"
  },
  {
    "text": "future but",
    "start": "716959",
    "end": "717839"
  },
  {
    "text": "for right now we want to keep it very",
    "start": "717839",
    "end": "719680"
  },
  {
    "text": "simple and straightforward",
    "start": "719680",
    "end": "722399"
  },
  {
    "text": "our second goal was likely the most",
    "start": "722399",
    "end": "724079"
  },
  {
    "text": "significant one",
    "start": "724079",
    "end": "725519"
  },
  {
    "text": "it was to develop a simple approach that",
    "start": "725519",
    "end": "728160"
  },
  {
    "text": "covers the most common use cases",
    "start": "728160",
    "end": "730560"
  },
  {
    "text": "as automatically as possible",
    "start": "730560",
    "end": "733600"
  },
  {
    "start": "733000",
    "end": "733000"
  },
  {
    "text": "and an automated approach meant we",
    "start": "733600",
    "end": "735440"
  },
  {
    "text": "needed a good algorithm",
    "start": "735440",
    "end": "737200"
  },
  {
    "text": "but not just a good algorithm a good way",
    "start": "737200",
    "end": "740480"
  },
  {
    "text": "of evaluating lots of potential",
    "start": "740480",
    "end": "742560"
  },
  {
    "text": "algorithms so we could actually",
    "start": "742560",
    "end": "743920"
  },
  {
    "text": "understand",
    "start": "743920",
    "end": "745040"
  },
  {
    "text": "what a good algorithm was and so",
    "start": "745040",
    "end": "748480"
  },
  {
    "text": "rick chen an awesome google intern",
    "start": "748480",
    "end": "751279"
  },
  {
    "text": "developed an",
    "start": "751279",
    "end": "751920"
  },
  {
    "text": "open source tool called kubernetes",
    "start": "751920",
    "end": "754000"
  },
  {
    "text": "topology simulator",
    "start": "754000",
    "end": "755760"
  },
  {
    "text": "and this allowed us to plug in any",
    "start": "755760",
    "end": "757519"
  },
  {
    "text": "number of algorithm",
    "start": "757519",
    "end": "759200"
  },
  {
    "text": "and run against millions of inputs",
    "start": "759200",
    "end": "762480"
  },
  {
    "text": "to see just how well or poorly it",
    "start": "762480",
    "end": "764800"
  },
  {
    "text": "performed",
    "start": "764800",
    "end": "766000"
  },
  {
    "text": "and we'll cover a little bit more about",
    "start": "766000",
    "end": "767519"
  },
  {
    "text": "this topology simulate simulator later",
    "start": "767519",
    "end": "770839"
  },
  {
    "text": "on",
    "start": "770839",
    "end": "772160"
  },
  {
    "start": "771000",
    "end": "771000"
  },
  {
    "text": "but let's talk about the algorithm that",
    "start": "772160",
    "end": "774079"
  },
  {
    "text": "we ended up deciding",
    "start": "774079",
    "end": "776240"
  },
  {
    "text": "and of course this algorithm can still",
    "start": "776240",
    "end": "778560"
  },
  {
    "text": "change and",
    "start": "778560",
    "end": "779279"
  },
  {
    "text": "can still be improved i've tried to",
    "start": "779279",
    "end": "782160"
  },
  {
    "text": "simplify this algorithm into",
    "start": "782160",
    "end": "784000"
  },
  {
    "text": "just a couple sentences so",
    "start": "784000",
    "end": "787040"
  },
  {
    "text": "once a service has enough endpoints",
    "start": "787040",
    "end": "789839"
  },
  {
    "text": "subset those",
    "start": "789839",
    "end": "791040"
  },
  {
    "text": "endpoint slices by zone if a zone",
    "start": "791040",
    "end": "794240"
  },
  {
    "text": "doesn't have enough endpoints",
    "start": "794240",
    "end": "796480"
  },
  {
    "text": "contribute some from a zone that does",
    "start": "796480",
    "end": "800480"
  },
  {
    "text": "so what does it mean for a service to",
    "start": "800480",
    "end": "802240"
  },
  {
    "text": "have enough endpoints",
    "start": "802240",
    "end": "804639"
  },
  {
    "text": "below a certain threshold this approach",
    "start": "804639",
    "end": "807040"
  },
  {
    "text": "results in a lot of churn",
    "start": "807040",
    "end": "808880"
  },
  {
    "text": "and potential for overloaded endpoints",
    "start": "808880",
    "end": "812639"
  },
  {
    "text": "our testing showed that approximately",
    "start": "812639",
    "end": "814720"
  },
  {
    "text": "three times the number of zones",
    "start": "814720",
    "end": "816800"
  },
  {
    "text": "was a reasonable starting point here so",
    "start": "816800",
    "end": "819360"
  },
  {
    "text": "if you had three zones",
    "start": "819360",
    "end": "821120"
  },
  {
    "text": "approximately nine endpoints was a good",
    "start": "821120",
    "end": "824240"
  },
  {
    "text": "starting point",
    "start": "824240",
    "end": "825519"
  },
  {
    "text": "anything below that risk significant",
    "start": "825519",
    "end": "828959"
  },
  {
    "text": "overload potential or significant churn",
    "start": "828959",
    "end": "832720"
  },
  {
    "text": "so as an example if you have three",
    "start": "832720",
    "end": "835360"
  },
  {
    "text": "endpoints",
    "start": "835360",
    "end": "836240"
  },
  {
    "text": "and three zones you could theoretically",
    "start": "836240",
    "end": "839040"
  },
  {
    "text": "distribute them",
    "start": "839040",
    "end": "840240"
  },
  {
    "text": "across those zones evenly but what if",
    "start": "840240",
    "end": "842399"
  },
  {
    "text": "one zone is slightly",
    "start": "842399",
    "end": "843920"
  },
  {
    "text": "larger than the others or what if all",
    "start": "843920",
    "end": "846560"
  },
  {
    "text": "the traffic is coming from one zone",
    "start": "846560",
    "end": "848399"
  },
  {
    "text": "instead of",
    "start": "848399",
    "end": "849440"
  },
  {
    "text": "all the zones you have significant risks",
    "start": "849440",
    "end": "852240"
  },
  {
    "text": "of overlook",
    "start": "852240",
    "end": "853519"
  },
  {
    "text": "and also if there's any changes along",
    "start": "853519",
    "end": "855600"
  },
  {
    "text": "the way",
    "start": "855600",
    "end": "856800"
  },
  {
    "text": "you have significant risk of churn where",
    "start": "856800",
    "end": "859920"
  },
  {
    "text": "everything has to change across all of",
    "start": "859920",
    "end": "862320"
  },
  {
    "text": "these zones across all of these slices",
    "start": "862320",
    "end": "864720"
  },
  {
    "text": "and that gets expensive so at least",
    "start": "864720",
    "end": "866880"
  },
  {
    "text": "initially",
    "start": "866880",
    "end": "868160"
  },
  {
    "text": "we're proposing starting once we have a",
    "start": "868160",
    "end": "870639"
  },
  {
    "text": "little bit",
    "start": "870639",
    "end": "871519"
  },
  {
    "text": "of room to work with and not just",
    "start": "871519",
    "end": "875120"
  },
  {
    "text": "precisely nine in the three zone cluster",
    "start": "875120",
    "end": "878639"
  },
  {
    "text": "case",
    "start": "878639",
    "end": "879760"
  },
  {
    "text": "we need to add a little bit of padding",
    "start": "879760",
    "end": "881440"
  },
  {
    "text": "both above and below",
    "start": "881440",
    "end": "883360"
  },
  {
    "text": "to ensure that we're not constantly",
    "start": "883360",
    "end": "885040"
  },
  {
    "text": "flapping back and forth between",
    "start": "885040",
    "end": "886639"
  },
  {
    "text": "approaches",
    "start": "886639",
    "end": "887680"
  },
  {
    "text": "so as an example the upper limit might",
    "start": "887680",
    "end": "890399"
  },
  {
    "text": "be closer to 12",
    "start": "890399",
    "end": "892000"
  },
  {
    "text": "and the lower limit might be closer to 6",
    "start": "892000",
    "end": "894959"
  },
  {
    "text": "when we're switching between these",
    "start": "894959",
    "end": "896839"
  },
  {
    "text": "approaches",
    "start": "896839",
    "end": "898959"
  },
  {
    "text": "now once a service has enough endpoints",
    "start": "898959",
    "end": "901839"
  },
  {
    "text": "we want to",
    "start": "901839",
    "end": "902639"
  },
  {
    "text": "subset the endpoint slices by zone",
    "start": "902639",
    "end": "906560"
  },
  {
    "text": "so we're introducing a new label that",
    "start": "906560",
    "end": "908639"
  },
  {
    "text": "can be set on endpoint slices",
    "start": "908639",
    "end": "910880"
  },
  {
    "text": "and couproxy will be updated to",
    "start": "910880",
    "end": "913920"
  },
  {
    "text": "read from this label and only care about",
    "start": "913920",
    "end": "917199"
  },
  {
    "text": "endpoint slices for the specific zone",
    "start": "917199",
    "end": "920399"
  },
  {
    "text": "and of course for backwards",
    "start": "920399",
    "end": "921760"
  },
  {
    "text": "compatibility coup proxy will continue",
    "start": "921760",
    "end": "924320"
  },
  {
    "text": "to watch",
    "start": "924320",
    "end": "925040"
  },
  {
    "text": "and point slices that don't have this",
    "start": "925040",
    "end": "927360"
  },
  {
    "text": "label at all",
    "start": "927360",
    "end": "928560"
  },
  {
    "text": "but we imagine going forward the vast",
    "start": "928560",
    "end": "930880"
  },
  {
    "text": "majority of endpoint slices",
    "start": "930880",
    "end": "932880"
  },
  {
    "text": "will get a label like this that",
    "start": "932880",
    "end": "934560"
  },
  {
    "text": "indicates which",
    "start": "934560",
    "end": "935920"
  },
  {
    "text": "zone they're intended for",
    "start": "935920",
    "end": "939519"
  },
  {
    "text": "so if a zone doesn't have enough",
    "start": "939600",
    "end": "942480"
  },
  {
    "text": "endpoints what do we",
    "start": "942480",
    "end": "943519"
  },
  {
    "text": "mean by a zone not having enough",
    "start": "943519",
    "end": "945600"
  },
  {
    "text": "endpoints",
    "start": "945600",
    "end": "947040"
  },
  {
    "text": "now in this case we're talking about the",
    "start": "947040",
    "end": "948800"
  },
  {
    "text": "number of expected endpoints",
    "start": "948800",
    "end": "951279"
  },
  {
    "text": "which at least initially will be based",
    "start": "951279",
    "end": "953120"
  },
  {
    "text": "on the proportion of cpu",
    "start": "953120",
    "end": "955040"
  },
  {
    "text": "cores in a zone so let's take this",
    "start": "955040",
    "end": "958160"
  },
  {
    "text": "example",
    "start": "958160",
    "end": "958720"
  },
  {
    "text": "we've got a cluster that has 12 total",
    "start": "958720",
    "end": "961199"
  },
  {
    "text": "endpoints",
    "start": "961199",
    "end": "962720"
  },
  {
    "text": "and we've got 6 total cpu cores",
    "start": "962720",
    "end": "967680"
  },
  {
    "text": "three of those or half of those happen",
    "start": "967680",
    "end": "970000"
  },
  {
    "text": "to live in zone a",
    "start": "970000",
    "end": "972320"
  },
  {
    "text": "so we expect half of the endpoints to",
    "start": "972320",
    "end": "975839"
  },
  {
    "text": "also be delivered",
    "start": "975839",
    "end": "977120"
  },
  {
    "text": "to zone a and similarly one third",
    "start": "977120",
    "end": "980880"
  },
  {
    "text": "of the cores live in zone b so we expect",
    "start": "980880",
    "end": "984639"
  },
  {
    "text": "one-third of the expected endpoints to",
    "start": "984639",
    "end": "987360"
  },
  {
    "text": "also be",
    "start": "987360",
    "end": "988079"
  },
  {
    "text": "in zone b all the way down the list",
    "start": "988079",
    "end": "992240"
  },
  {
    "text": "so that's relatively straightforward but",
    "start": "992240",
    "end": "994959"
  },
  {
    "text": "what happens",
    "start": "994959",
    "end": "995839"
  },
  {
    "text": "if this isn't the case if there's a zone",
    "start": "995839",
    "end": "998800"
  },
  {
    "text": "that doesn't have enough endpoints",
    "start": "998800",
    "end": "1001360"
  },
  {
    "text": "well to minimize churn",
    "start": "1001360",
    "end": "1004480"
  },
  {
    "text": "we're only going to redistribute those",
    "start": "1004480",
    "end": "1006160"
  },
  {
    "text": "endpoints once a threshold has been",
    "start": "1006160",
    "end": "1008839"
  },
  {
    "text": "passed",
    "start": "1008839",
    "end": "1010079"
  },
  {
    "text": "we define an acceptable overload",
    "start": "1010079",
    "end": "1012079"
  },
  {
    "text": "threshold as",
    "start": "1012079",
    "end": "1013360"
  },
  {
    "text": "maybe 25 and what does overload mean",
    "start": "1013360",
    "end": "1017440"
  },
  {
    "text": "it at least in this context we're",
    "start": "1017440",
    "end": "1019360"
  },
  {
    "text": "defining it as",
    "start": "1019360",
    "end": "1020639"
  },
  {
    "text": "the amount of extra traffic some",
    "start": "1020639",
    "end": "1023199"
  },
  {
    "text": "endpoints",
    "start": "1023199",
    "end": "1024000"
  },
  {
    "text": "might receive so if we expected 10",
    "start": "1024000",
    "end": "1027199"
  },
  {
    "text": "endpoints in a zone",
    "start": "1027199",
    "end": "1028798"
  },
  {
    "text": "and we only had eight that would mean",
    "start": "1028799",
    "end": "1032319"
  },
  {
    "text": "each of those eight endpoints were 25",
    "start": "1032319",
    "end": "1035120"
  },
  {
    "text": "percent overloaded they had",
    "start": "1035120",
    "end": "1037038"
  },
  {
    "text": "they could get 25 more traffic than",
    "start": "1037039",
    "end": "1040000"
  },
  {
    "text": "might be expected",
    "start": "1040000",
    "end": "1041120"
  },
  {
    "text": "if everything was evenly distributed",
    "start": "1041120",
    "end": "1044319"
  },
  {
    "text": "now seven endpoints on the other hand",
    "start": "1044319",
    "end": "1046240"
  },
  {
    "text": "would be below",
    "start": "1046240",
    "end": "1047678"
  },
  {
    "text": "that threshold because now each of those",
    "start": "1047679",
    "end": "1050480"
  },
  {
    "text": "endpoints would be getting",
    "start": "1050480",
    "end": "1052080"
  },
  {
    "text": "43 percent more traffic than expected",
    "start": "1052080",
    "end": "1055679"
  },
  {
    "text": "which is something we're trying to avoid",
    "start": "1055679",
    "end": "1057840"
  },
  {
    "text": "so once we reach",
    "start": "1057840",
    "end": "1058960"
  },
  {
    "text": "that level of difference it's time to",
    "start": "1058960",
    "end": "1061600"
  },
  {
    "text": "start",
    "start": "1061600",
    "end": "1062000"
  },
  {
    "text": "redistributing endpoints before then",
    "start": "1062000",
    "end": "1065440"
  },
  {
    "text": "we rely on kind of lazy rebalancing",
    "start": "1065440",
    "end": "1069039"
  },
  {
    "text": "so when a new endpoint comes in it's",
    "start": "1069039",
    "end": "1071440"
  },
  {
    "text": "automatically delivered wherever it",
    "start": "1071440",
    "end": "1073440"
  },
  {
    "text": "makes the most sense",
    "start": "1073440",
    "end": "1075200"
  },
  {
    "text": "uh now there's a lot more to this",
    "start": "1075200",
    "end": "1077280"
  },
  {
    "text": "algorithm than i can explain in this",
    "start": "1077280",
    "end": "1078960"
  },
  {
    "text": "talk",
    "start": "1078960",
    "end": "1079520"
  },
  {
    "text": "so if you're interested we've included a",
    "start": "1079520",
    "end": "1081360"
  },
  {
    "text": "lot more diagrams",
    "start": "1081360",
    "end": "1082960"
  },
  {
    "text": "and examples in the cap itself",
    "start": "1082960",
    "end": "1086720"
  },
  {
    "text": "but finally you may be trying to picture",
    "start": "1086720",
    "end": "1088880"
  },
  {
    "text": "exactly how this might work",
    "start": "1088880",
    "end": "1090720"
  },
  {
    "text": "so i thought an example might be helpful",
    "start": "1090720",
    "end": "1092840"
  },
  {
    "text": "here",
    "start": "1092840",
    "end": "1094000"
  },
  {
    "text": "so in this case we've got nine total",
    "start": "1094000",
    "end": "1096880"
  },
  {
    "text": "pods",
    "start": "1096880",
    "end": "1098559"
  },
  {
    "text": "four in zone a and two in zone c",
    "start": "1098559",
    "end": "1102559"
  },
  {
    "text": "with our original approach all of those",
    "start": "1102559",
    "end": "1105520"
  },
  {
    "text": "pods would",
    "start": "1105520",
    "end": "1106240"
  },
  {
    "text": "be bunched into a single endpoint slice",
    "start": "1106240",
    "end": "1110160"
  },
  {
    "text": "but with this automatic topology aware",
    "start": "1110160",
    "end": "1112559"
  },
  {
    "text": "routing approach",
    "start": "1112559",
    "end": "1114320"
  },
  {
    "text": "instead what we're suggesting is that",
    "start": "1114320",
    "end": "1117520"
  },
  {
    "text": "three endpoints go into a slice for",
    "start": "1117520",
    "end": "1120559"
  },
  {
    "text": "zone a same with zone b",
    "start": "1120559",
    "end": "1123840"
  },
  {
    "text": "and for zone c we only have two",
    "start": "1123840",
    "end": "1126559"
  },
  {
    "text": "endpoints",
    "start": "1126559",
    "end": "1127600"
  },
  {
    "text": "from zone c that we can contribute but",
    "start": "1127600",
    "end": "1130160"
  },
  {
    "text": "we have an",
    "start": "1130160",
    "end": "1130799"
  },
  {
    "text": "extra one we can take from zone a so we",
    "start": "1130799",
    "end": "1133919"
  },
  {
    "text": "do that",
    "start": "1133919",
    "end": "1135280"
  },
  {
    "text": "so that's a very simplified way of how",
    "start": "1135280",
    "end": "1138080"
  },
  {
    "text": "we imagine",
    "start": "1138080",
    "end": "1139200"
  },
  {
    "text": "this kind of subsetting would work",
    "start": "1139200",
    "end": "1142720"
  },
  {
    "text": "and of course as i mentioned there's a",
    "start": "1142720",
    "end": "1144559"
  },
  {
    "text": "lot more examples",
    "start": "1144559",
    "end": "1146080"
  },
  {
    "text": "in the cap covering a large number of",
    "start": "1146080",
    "end": "1148080"
  },
  {
    "text": "potential edge cases we could run into",
    "start": "1148080",
    "end": "1150559"
  },
  {
    "text": "here",
    "start": "1150559",
    "end": "1152559"
  },
  {
    "text": "and finally we want to only deliver end",
    "start": "1152559",
    "end": "1155200"
  },
  {
    "text": "points that are",
    "start": "1155200",
    "end": "1156320"
  },
  {
    "text": "closest to each instance of coupe proxy",
    "start": "1156320",
    "end": "1159280"
  },
  {
    "text": "instead of delivering",
    "start": "1159280",
    "end": "1160400"
  },
  {
    "text": "all endpoints everywhere so we've",
    "start": "1160400",
    "end": "1163280"
  },
  {
    "text": "introduced",
    "start": "1163280",
    "end": "1164080"
  },
  {
    "start": "1164000",
    "end": "1164000"
  },
  {
    "text": "two new labels one for zone",
    "start": "1164080",
    "end": "1167360"
  },
  {
    "text": "and one for region to indicate where an",
    "start": "1167360",
    "end": "1170559"
  },
  {
    "text": "endpoint slice",
    "start": "1170559",
    "end": "1171600"
  },
  {
    "text": "should be delivered and coup proxy will",
    "start": "1171600",
    "end": "1174080"
  },
  {
    "text": "be updated to watch endpoint slices",
    "start": "1174080",
    "end": "1176640"
  },
  {
    "text": "with those labels and so it will",
    "start": "1176640",
    "end": "1179120"
  },
  {
    "text": "specifically",
    "start": "1179120",
    "end": "1179919"
  },
  {
    "text": "not pay any attention to end point",
    "start": "1179919",
    "end": "1182960"
  },
  {
    "text": "slices labeled for another zone",
    "start": "1182960",
    "end": "1185039"
  },
  {
    "text": "or for another region",
    "start": "1185039",
    "end": "1188159"
  },
  {
    "start": "1187000",
    "end": "1187000"
  },
  {
    "text": "so in summary there's three main things",
    "start": "1188240",
    "end": "1190799"
  },
  {
    "text": "happening here",
    "start": "1190799",
    "end": "1192320"
  },
  {
    "text": "one two official topology labels zone",
    "start": "1192320",
    "end": "1195440"
  },
  {
    "text": "and region are now well defined",
    "start": "1195440",
    "end": "1197919"
  },
  {
    "text": "two endpoint slices can be delivered to",
    "start": "1197919",
    "end": "1200960"
  },
  {
    "text": "zones or regions and three users can",
    "start": "1200960",
    "end": "1204559"
  },
  {
    "text": "opt into automatic topology aware",
    "start": "1204559",
    "end": "1207039"
  },
  {
    "text": "routing",
    "start": "1207039",
    "end": "1208000"
  },
  {
    "text": "on every service this will likely start",
    "start": "1208000",
    "end": "1211120"
  },
  {
    "text": "as an annotation but",
    "start": "1211120",
    "end": "1212640"
  },
  {
    "text": "could be extended in the future and",
    "start": "1212640",
    "end": "1215840"
  },
  {
    "text": "maybe if we're lucky we'll get this",
    "start": "1215840",
    "end": "1218880"
  },
  {
    "text": "done well enough that we could even",
    "start": "1218880",
    "end": "1220799"
  },
  {
    "text": "default this to just being enabled",
    "start": "1220799",
    "end": "1223280"
  },
  {
    "text": "and we wouldn't need any configuration",
    "start": "1223280",
    "end": "1225360"
  },
  {
    "text": "at all",
    "start": "1225360",
    "end": "1227679"
  },
  {
    "text": "so with all that background now that you",
    "start": "1228400",
    "end": "1230159"
  },
  {
    "text": "understand how this approach works",
    "start": "1230159",
    "end": "1232480"
  },
  {
    "text": "it would be helpful to understand how",
    "start": "1232480",
    "end": "1234320"
  },
  {
    "text": "our simulation actually scored this",
    "start": "1234320",
    "end": "1236559"
  },
  {
    "text": "approach",
    "start": "1236559",
    "end": "1238240"
  },
  {
    "start": "1238000",
    "end": "1238000"
  },
  {
    "text": "so to understand our score",
    "start": "1238240",
    "end": "1241520"
  },
  {
    "text": "to understand our results it's helpful",
    "start": "1241520",
    "end": "1243679"
  },
  {
    "text": "to understand what we were evaluating",
    "start": "1243679",
    "end": "1246000"
  },
  {
    "text": "algorithms on so we gave a high weight",
    "start": "1246000",
    "end": "1249840"
  },
  {
    "text": "to the percent of traffic",
    "start": "1249840",
    "end": "1251360"
  },
  {
    "text": "that stayed in zone and that weight was",
    "start": "1251360",
    "end": "1254799"
  },
  {
    "text": "45 of the total score",
    "start": "1254799",
    "end": "1258000"
  },
  {
    "text": "next we cared about overload",
    "start": "1258000",
    "end": "1261280"
  },
  {
    "text": "the proportion of extra traffic that any",
    "start": "1261280",
    "end": "1263679"
  },
  {
    "text": "single endpoint",
    "start": "1263679",
    "end": "1264640"
  },
  {
    "text": "might expect to receive in a simulation",
    "start": "1264640",
    "end": "1268240"
  },
  {
    "text": "so across our 39 million inputs that we",
    "start": "1268240",
    "end": "1271600"
  },
  {
    "text": "tested",
    "start": "1271600",
    "end": "1272320"
  },
  {
    "text": "every algorithm against our max",
    "start": "1272320",
    "end": "1275520"
  },
  {
    "text": "overload got a 20 contribution to the",
    "start": "1275520",
    "end": "1279280"
  },
  {
    "text": "total score so our worst case scenario",
    "start": "1279280",
    "end": "1281679"
  },
  {
    "text": "you know of those 39 million inputs the",
    "start": "1281679",
    "end": "1284799"
  },
  {
    "text": "single worst endpoint of all those",
    "start": "1284799",
    "end": "1287440"
  },
  {
    "text": "inputs",
    "start": "1287440",
    "end": "1288320"
  },
  {
    "text": "that got the most overloaded we gave",
    "start": "1288320",
    "end": "1290559"
  },
  {
    "text": "that a weight of 20",
    "start": "1290559",
    "end": "1292720"
  },
  {
    "text": "and then we also wanted to make sure",
    "start": "1292720",
    "end": "1294559"
  },
  {
    "text": "that our average case",
    "start": "1294559",
    "end": "1296080"
  },
  {
    "text": "was also quite low so we uh also gave",
    "start": "1296080",
    "end": "1299520"
  },
  {
    "text": "weight of",
    "start": "1299520",
    "end": "1300240"
  },
  {
    "text": "20 to our average overload",
    "start": "1300240",
    "end": "1304000"
  },
  {
    "text": "and finally we also cared about the",
    "start": "1304000",
    "end": "1306640"
  },
  {
    "text": "proportion of new",
    "start": "1306640",
    "end": "1307679"
  },
  {
    "text": "endpoint slices that would be required",
    "start": "1307679",
    "end": "1309600"
  },
  {
    "text": "with this approach",
    "start": "1309600",
    "end": "1311520"
  },
  {
    "text": "so we gave a weight of 15 to that",
    "start": "1311520",
    "end": "1316840"
  },
  {
    "text": "proportion",
    "start": "1316840",
    "end": "1318080"
  },
  {
    "start": "1317000",
    "end": "1317000"
  },
  {
    "text": "so our automatic approach actually",
    "start": "1318080",
    "end": "1320159"
  },
  {
    "text": "scored reasonably well here",
    "start": "1320159",
    "end": "1322559"
  },
  {
    "text": "it managed to keep 84 percent of traffic",
    "start": "1322559",
    "end": "1325360"
  },
  {
    "text": "in zone",
    "start": "1325360",
    "end": "1326000"
  },
  {
    "text": "which is significantly better than the",
    "start": "1326000",
    "end": "1328159"
  },
  {
    "text": "original approach",
    "start": "1328159",
    "end": "1330320"
  },
  {
    "text": "which you would expect because the",
    "start": "1330320",
    "end": "1331760"
  },
  {
    "text": "original approach wasn't even trying to",
    "start": "1331760",
    "end": "1333520"
  },
  {
    "text": "keep traffic in zone",
    "start": "1333520",
    "end": "1335440"
  },
  {
    "text": "but 84 we thought was quite good because",
    "start": "1335440",
    "end": "1338559"
  },
  {
    "text": "all these inputs included a lot of edge",
    "start": "1338559",
    "end": "1341440"
  },
  {
    "text": "cases",
    "start": "1341440",
    "end": "1342240"
  },
  {
    "text": "the kind of edge cases where you'd have",
    "start": "1342240",
    "end": "1344000"
  },
  {
    "text": "hundreds of endpoints in one zone and",
    "start": "1344000",
    "end": "1346159"
  },
  {
    "text": "only one in another zone",
    "start": "1346159",
    "end": "1347679"
  },
  {
    "text": "and so you end up with",
    "start": "1347679",
    "end": "1350960"
  },
  {
    "text": "some really impressive results given",
    "start": "1350960",
    "end": "1353120"
  },
  {
    "text": "those",
    "start": "1353120",
    "end": "1354080"
  },
  {
    "text": "highly lopsided inputs what we observed",
    "start": "1354080",
    "end": "1357360"
  },
  {
    "text": "when results were more balanced or more",
    "start": "1357360",
    "end": "1359760"
  },
  {
    "text": "normal was",
    "start": "1359760",
    "end": "1360640"
  },
  {
    "text": "significantly better than even this 84",
    "start": "1360640",
    "end": "1362960"
  },
  {
    "text": "percent",
    "start": "1362960",
    "end": "1364880"
  },
  {
    "text": "and then next our overload",
    "start": "1364880",
    "end": "1368000"
  },
  {
    "text": "our overload was quite good on average",
    "start": "1368000",
    "end": "1370720"
  },
  {
    "text": "it was around 1.7 percent",
    "start": "1370720",
    "end": "1373440"
  },
  {
    "text": "uh which we thought was a reasonable",
    "start": "1373440",
    "end": "1376559"
  },
  {
    "text": "level of overload and although it's",
    "start": "1376559",
    "end": "1380080"
  },
  {
    "text": "not quite as good as the original it",
    "start": "1380080",
    "end": "1382640"
  },
  {
    "text": "still felt like",
    "start": "1382640",
    "end": "1383600"
  },
  {
    "text": "a reasonable compromise to get to that",
    "start": "1383600",
    "end": "1386320"
  },
  {
    "text": "very high",
    "start": "1386320",
    "end": "1387120"
  },
  {
    "text": "level of end zone traffic",
    "start": "1387120",
    "end": "1390400"
  },
  {
    "text": "and again overload performs",
    "start": "1390400",
    "end": "1392159"
  },
  {
    "text": "significantly better",
    "start": "1392159",
    "end": "1394080"
  },
  {
    "text": "uh when you aren't dealing with all",
    "start": "1394080",
    "end": "1395840"
  },
  {
    "text": "these wild edge cases that we had in our",
    "start": "1395840",
    "end": "1398240"
  },
  {
    "text": "inputs",
    "start": "1398240",
    "end": "1400000"
  },
  {
    "text": "and finally for extra slices uh",
    "start": "1400000",
    "end": "1403679"
  },
  {
    "text": "the new automatic approach required",
    "start": "1403679",
    "end": "1406640"
  },
  {
    "text": "approximately 37 percent",
    "start": "1406640",
    "end": "1408720"
  },
  {
    "text": "more endpoint slices than the original",
    "start": "1408720",
    "end": "1411200"
  },
  {
    "text": "approach",
    "start": "1411200",
    "end": "1412240"
  },
  {
    "text": "but even still that did not seem like a",
    "start": "1412240",
    "end": "1414559"
  },
  {
    "text": "significant",
    "start": "1414559",
    "end": "1415440"
  },
  {
    "text": "issue and definitely seemed worth all",
    "start": "1415440",
    "end": "1418400"
  },
  {
    "text": "the advantages that we got",
    "start": "1418400",
    "end": "1420080"
  },
  {
    "text": "for keeping traffic in zone so",
    "start": "1420080",
    "end": "1423120"
  },
  {
    "text": "overall our simulator gave",
    "start": "1423120",
    "end": "1426640"
  },
  {
    "text": "this automatic approach an 87 percent",
    "start": "1426640",
    "end": "1430559"
  },
  {
    "text": "score compared to a 73 score for the",
    "start": "1430559",
    "end": "1433760"
  },
  {
    "text": "original approach",
    "start": "1433760",
    "end": "1435279"
  },
  {
    "text": "so we recognize there's still room for",
    "start": "1435279",
    "end": "1437200"
  },
  {
    "text": "improvement here but we think",
    "start": "1437200",
    "end": "1438799"
  },
  {
    "text": "what we have already is a significant",
    "start": "1438799",
    "end": "1441520"
  },
  {
    "text": "significant step in the right direction",
    "start": "1441520",
    "end": "1445279"
  },
  {
    "text": "and with that i want to talk just a",
    "start": "1445279",
    "end": "1446880"
  },
  {
    "text": "little bit about our long-term vision",
    "start": "1446880",
    "end": "1448640"
  },
  {
    "text": "here because",
    "start": "1448640",
    "end": "1450000"
  },
  {
    "text": "really we're still in a pre-alpha stage",
    "start": "1450000",
    "end": "1453200"
  },
  {
    "text": "we're still very early in this process",
    "start": "1453200",
    "end": "1455760"
  },
  {
    "text": "and we still could use feedback and we",
    "start": "1455760",
    "end": "1457600"
  },
  {
    "text": "still could use a lot of work",
    "start": "1457600",
    "end": "1459919"
  },
  {
    "start": "1458000",
    "end": "1458000"
  },
  {
    "text": "our first priority is to get this into",
    "start": "1459919",
    "end": "1462960"
  },
  {
    "text": "alpha",
    "start": "1462960",
    "end": "1463520"
  },
  {
    "text": "and get some feedback we're hoping we'll",
    "start": "1463520",
    "end": "1466000"
  },
  {
    "text": "hit that target in kubernetes 1.21",
    "start": "1466000",
    "end": "1469600"
  },
  {
    "text": "we also have a number of open questions",
    "start": "1469600",
    "end": "1472640"
  },
  {
    "text": "you know obviously how can we improve",
    "start": "1472640",
    "end": "1474960"
  },
  {
    "text": "this approach if you have ideas if you",
    "start": "1474960",
    "end": "1476720"
  },
  {
    "text": "have feedback",
    "start": "1476720",
    "end": "1477840"
  },
  {
    "text": "don't hesitate get in touch comment on",
    "start": "1477840",
    "end": "1480320"
  },
  {
    "text": "the cap",
    "start": "1480320",
    "end": "1481600"
  },
  {
    "text": "come to sig network whatever it happens",
    "start": "1481600",
    "end": "1483360"
  },
  {
    "text": "to be we'd love to hear what you're",
    "start": "1483360",
    "end": "1485200"
  },
  {
    "text": "thinking",
    "start": "1485200",
    "end": "1486480"
  },
  {
    "text": "and we're also interested in if we can",
    "start": "1486480",
    "end": "1488159"
  },
  {
    "text": "use any kind of similar patterns",
    "start": "1488159",
    "end": "1490159"
  },
  {
    "text": "for dns but is there any additional",
    "start": "1490159",
    "end": "1494159"
  },
  {
    "text": "configuration",
    "start": "1494159",
    "end": "1495039"
  },
  {
    "text": "we need to provide for say power users",
    "start": "1495039",
    "end": "1498480"
  },
  {
    "text": "or advanced use cases",
    "start": "1498480",
    "end": "1500960"
  },
  {
    "text": "and on the other side can we eventually",
    "start": "1500960",
    "end": "1503760"
  },
  {
    "text": "make this good enough that",
    "start": "1503760",
    "end": "1505600"
  },
  {
    "text": "we can just make this the default and we",
    "start": "1505600",
    "end": "1507760"
  },
  {
    "text": "won't need any configuration at all",
    "start": "1507760",
    "end": "1511520"
  },
  {
    "text": "now some longer term bigger picture",
    "start": "1511600",
    "end": "1513760"
  },
  {
    "start": "1512000",
    "end": "1512000"
  },
  {
    "text": "questions are",
    "start": "1513760",
    "end": "1515039"
  },
  {
    "text": "how can we implement topology aware",
    "start": "1515039",
    "end": "1516960"
  },
  {
    "text": "routing with real time feedback",
    "start": "1516960",
    "end": "1519840"
  },
  {
    "text": "this is really the goal if we had",
    "start": "1519840",
    "end": "1521919"
  },
  {
    "text": "real-time feedback",
    "start": "1521919",
    "end": "1523039"
  },
  {
    "text": "we could detect overloaded endpoints and",
    "start": "1523039",
    "end": "1525440"
  },
  {
    "text": "route traffic",
    "start": "1525440",
    "end": "1526559"
  },
  {
    "text": "elsewhere automatically this is really",
    "start": "1526559",
    "end": "1529120"
  },
  {
    "text": "something that would be great to include",
    "start": "1529120",
    "end": "1530960"
  },
  {
    "text": "inside kubernetes but it requires",
    "start": "1530960",
    "end": "1534159"
  },
  {
    "text": "a lot of changes all the way up and down",
    "start": "1534159",
    "end": "1536640"
  },
  {
    "text": "the stack",
    "start": "1536640",
    "end": "1537520"
  },
  {
    "text": "and is a bigger project that will not be",
    "start": "1537520",
    "end": "1541120"
  },
  {
    "text": "done",
    "start": "1541120",
    "end": "1541440"
  },
  {
    "text": "probably in the next uh couple release",
    "start": "1541440",
    "end": "1543600"
  },
  {
    "text": "cycles at least",
    "start": "1543600",
    "end": "1545039"
  },
  {
    "text": "but we're still thinking about it and",
    "start": "1545039",
    "end": "1546240"
  },
  {
    "text": "we're trying to picture ways that we",
    "start": "1546240",
    "end": "1548240"
  },
  {
    "text": "could actually achieve this",
    "start": "1548240",
    "end": "1550799"
  },
  {
    "text": "and finally can we do any of this",
    "start": "1550799",
    "end": "1553279"
  },
  {
    "text": "redistribution of traffic",
    "start": "1553279",
    "end": "1555200"
  },
  {
    "text": "without updating endpoint slices on each",
    "start": "1555200",
    "end": "1557440"
  },
  {
    "text": "change because right now we're",
    "start": "1557440",
    "end": "1559039"
  },
  {
    "text": "highly reliant on updating endpoint",
    "start": "1559039",
    "end": "1561520"
  },
  {
    "text": "slices",
    "start": "1561520",
    "end": "1562559"
  },
  {
    "text": "to describe what crew proxy should do",
    "start": "1562559",
    "end": "1566480"
  },
  {
    "text": "where a coup proxy should route traffic",
    "start": "1566480",
    "end": "1568640"
  },
  {
    "text": "which is fine but it seems like there's",
    "start": "1568640",
    "end": "1571120"
  },
  {
    "text": "probably a bit more room",
    "start": "1571120",
    "end": "1572960"
  },
  {
    "text": "to add local optimizations maybe in cube",
    "start": "1572960",
    "end": "1575679"
  },
  {
    "text": "proxy",
    "start": "1575679",
    "end": "1576799"
  },
  {
    "text": "that could require less",
    "start": "1576799",
    "end": "1579919"
  },
  {
    "text": "updates to endpoint slices so",
    "start": "1579919",
    "end": "1583120"
  },
  {
    "text": "this is just a sampling of the things",
    "start": "1583120",
    "end": "1585279"
  },
  {
    "text": "we're thinking about",
    "start": "1585279",
    "end": "1586400"
  },
  {
    "text": "there's plenty more many of them are",
    "start": "1586400",
    "end": "1588159"
  },
  {
    "text": "addressed in the caps",
    "start": "1588159",
    "end": "1589520"
  },
  {
    "text": "so if you're interested i'd definitely",
    "start": "1589520",
    "end": "1591360"
  },
  {
    "text": "encourage you to get involved",
    "start": "1591360",
    "end": "1593360"
  },
  {
    "text": "ask questions provide feedback we'd love",
    "start": "1593360",
    "end": "1596080"
  },
  {
    "text": "to hear from you",
    "start": "1596080",
    "end": "1598240"
  },
  {
    "text": "so thanks so much for coming my name is",
    "start": "1598240",
    "end": "1600720"
  },
  {
    "text": "rob scott",
    "start": "1600720",
    "end": "1601600"
  },
  {
    "text": "uh you can find me on slack github",
    "start": "1601600",
    "end": "1604320"
  },
  {
    "text": "twitter etc",
    "start": "1604320",
    "end": "1606000"
  },
  {
    "text": "if you have any thoughts about how we",
    "start": "1606000",
    "end": "1607440"
  },
  {
    "text": "can make this even better",
    "start": "1607440",
    "end": "1609039"
  },
  {
    "text": "i'd love to hear from you thanks so much",
    "start": "1609039",
    "end": "1613840"
  }
]