[
  {
    "start": "0",
    "end": "58000"
  },
  {
    "text": "all right welcome welcome to our talk we'll be talking about managing secrets",
    "start": "0",
    "end": "5069"
  },
  {
    "text": "in kubernetes and Turtles all the way down so I'm Mike at Roskam a product",
    "start": "5069",
    "end": "10469"
  },
  {
    "text": "manager in security at Google I'm Alex sure Nicole's camera a security engineer on Google keeper magazine and in the",
    "start": "10469",
    "end": "16650"
  },
  {
    "text": "talk today will cover how crimini secrets are protected secret management features that have recently been added",
    "start": "16650",
    "end": "21869"
  },
  {
    "text": "to communities namely kms plugin and what to take into account when picking the solution that works best for you so",
    "start": "21869",
    "end": "28260"
  },
  {
    "text": "first let's talk about protecting secrets so what is a secret a secret can be a lot of things right it could be",
    "start": "28260",
    "end": "34790"
  },
  {
    "text": "anything that an application needs at build or at runtime some common examples include credentials API keys things like",
    "start": "34790",
    "end": "42300"
  },
  {
    "text": "your stripe API key username password combos etc what's not a secret is your",
    "start": "42300",
    "end": "48149"
  },
  {
    "text": "entire application your entire config file other sensitive data that you might have like email addresses is pei and you",
    "start": "48149",
    "end": "55079"
  },
  {
    "text": "don't want it to leak but it's not a secret okay so we're gonna start in a",
    "start": "55079",
    "end": "71010"
  },
  {
    "start": "58000",
    "end": "58000"
  },
  {
    "text": "second with a demo but just to give a bit of a setup of what were what we're talking through first okay we're going",
    "start": "71010",
    "end": "81869"
  },
  {
    "text": "to start with the motivating was a motivating demo so what I would like would like us to imagine that we are",
    "start": "81869",
    "end": "89340"
  },
  {
    "text": "attackers and we are interested in penetrating a financial system let's",
    "start": "89340",
    "end": "95790"
  },
  {
    "text": "let's say store some great card data for example something that would be a value",
    "start": "95790",
    "end": "101220"
  },
  {
    "text": "to us so we've been trying to be required to attack this financial system",
    "start": "101220",
    "end": "107030"
  },
  {
    "text": "directly but we haven't really been getting anywhere it seems to be well patched and protected so we started to",
    "start": "107030",
    "end": "113460"
  },
  {
    "text": "look around are there any other systems that we can pivot on to attack this financial system and through",
    "start": "113460",
    "end": "119880"
  },
  {
    "text": "reconnaissance we found out that in fact there is a Cuban in this cluster that communicates with this financial system",
    "start": "119880",
    "end": "125670"
  },
  {
    "text": "and we assume that this particular cluster must have some credentials in",
    "start": "125670",
    "end": "132330"
  },
  {
    "text": "this configuration to a knack to this financial system so we expanded our scope of attack and we are",
    "start": "132330",
    "end": "138090"
  },
  {
    "text": "now looking at the this debate this kubernetes cluster unfortunately no luck again the server's",
    "start": "138090",
    "end": "146310"
  },
  {
    "text": "the cluster seems to be well patched and we're not really getting anywhere was our attack against the kubernetes",
    "start": "146310",
    "end": "151920"
  },
  {
    "text": "cluster however we do not give up",
    "start": "151920",
    "end": "157110"
  },
  {
    "text": "good attackers don't give up right so we expand our attacks attack surface and we",
    "start": "157110",
    "end": "163020"
  },
  {
    "text": "do more reconnaissance and we find out that interestingly enough this particular kubernetes cluster is being",
    "start": "163020",
    "end": "169230"
  },
  {
    "text": "backed up daily to remote file server interesting from our perspective we are",
    "start": "169230",
    "end": "176100"
  },
  {
    "text": "not so much interested in this particular cluster we don't want to control it directly rather we are",
    "start": "176100",
    "end": "181350"
  },
  {
    "text": "interested in this configuration somewhere on that cluster there is a password that will get us access to that",
    "start": "181350",
    "end": "187860"
  },
  {
    "text": "financial system so really if we can get an offline copy of the master that's really all we need so we started to",
    "start": "187860",
    "end": "195480"
  },
  {
    "text": "reckon essence against the backup server and we got now we got lucky this backup",
    "start": "195480",
    "end": "201270"
  },
  {
    "text": "server has an attached owner ability and now we're able to control the backup server so now what I'm going to do is",
    "start": "201270",
    "end": "208560"
  },
  {
    "text": "I'm going to show you a sort of the experience of an attacker that was able",
    "start": "208560",
    "end": "213630"
  },
  {
    "text": "to was able to get a copy offline copy of Cuban a deus master right so imagine",
    "start": "213630",
    "end": "226830"
  },
  {
    "text": "please remember I'm still an attacker and finally this is sort of days or",
    "start": "226830",
    "end": "232080"
  },
  {
    "text": "months of work and they're finally paying off I have an offline version of the master I did some googling around",
    "start": "232080",
    "end": "238290"
  },
  {
    "text": "because I don't really that much about @cd but I heard that Q Burnett is uses that city for its configuration store",
    "start": "238290",
    "end": "243740"
  },
  {
    "text": "and a little of googling around I found that HCD stores its data in the file",
    "start": "243740",
    "end": "249750"
  },
  {
    "text": "called DB in the directory called member snap so at this point I'm kind of",
    "start": "249750",
    "end": "257280"
  },
  {
    "text": "curious like what should I look for well how about I just do a grab for secret I",
    "start": "257280",
    "end": "265320"
  },
  {
    "text": "mean that sounds seems obvious but see what happens and in fact inside",
    "start": "265320",
    "end": "270690"
  },
  {
    "text": "this database there is a secret you can see that EDD is actually helping me here",
    "start": "270690",
    "end": "275729"
  },
  {
    "text": "quite a bit because s it is a key value store pair key value pair store and it",
    "start": "275729",
    "end": "283740"
  },
  {
    "text": "nicely it provides me very good hints as to where to find where to look for",
    "start": "283740",
    "end": "288780"
  },
  {
    "text": "secrets so basically all secrets are stored on the registry secret default namespace and here I find an interesting",
    "start": "288780",
    "end": "296520"
  },
  {
    "text": "fact they have in fact DB secret 0 1 well let me use that and it enhance my",
    "start": "296520",
    "end": "303810"
  },
  {
    "text": "my my search and here's the password in",
    "start": "303810",
    "end": "309300"
  },
  {
    "text": "clear-text okay I'm tired of being an attacker I want to switch roles now and",
    "start": "309300",
    "end": "315539"
  },
  {
    "text": "I want to become a security conscious savvy kubernetes administrator and I",
    "start": "315539",
    "end": "321479"
  },
  {
    "text": "won't ask a question how could I have prevented this attack from happening and probably encryption comes to mind here",
    "start": "321479",
    "end": "327690"
  },
  {
    "text": "we probably should have encrypted that CD so before we moved it to the backup backup server so you in the right talk",
    "start": "327690",
    "end": "336659"
  },
  {
    "text": "by the time of the talk is finish you will know all about how to do something like that and my will walk mine I will",
    "start": "336659",
    "end": "344070"
  },
  {
    "text": "walk you through this process but for now I just wanted to show you",
    "start": "344070",
    "end": "348560"
  },
  {
    "text": "attackers experience if that particular server was enabled for for encryption at",
    "start": "350690",
    "end": "359340"
  },
  {
    "text": "rest so this is for this demo I created basically similar version exactly the same configuration of a cluster but this",
    "start": "359340",
    "end": "366479"
  },
  {
    "text": "particular cluster uses the encryption at rest feature and as you can see yes the secret is still there but it's not",
    "start": "366479",
    "end": "372570"
  },
  {
    "text": "really usable to the attacker what this means is that now I have to as an attacker now have to find probably",
    "start": "372570",
    "end": "378419"
  },
  {
    "text": "another way of attacking that system my vacuum awesome so the demo that Alex",
    "start": "378419",
    "end": "383880"
  },
  {
    "text": "showed us showed one way of you know doing an offline attack against a system but it's not the only way right you",
    "start": "383880",
    "end": "389610"
  },
  {
    "text": "couldn't also imagine while I try to drag this back to the other screen which is not gonna work oh that might work you",
    "start": "389610",
    "end": "396360"
  },
  {
    "text": "could also imagine other attacks that occurred for an offline server things",
    "start": "396360",
    "end": "401660"
  },
  {
    "text": "like I snapshotting a VM reminding the database on a remote server even somebody walking into your data center",
    "start": "401660",
    "end": "407960"
  },
  {
    "start": "402000",
    "end": "402000"
  },
  {
    "text": "and walking away with a hard disk right so stealing it API credentials through mismanagement is not that crazy of an",
    "start": "407960",
    "end": "413479"
  },
  {
    "text": "idea right we see that happen in the real world we see people post credentials on github we see CEOs have",
    "start": "413479",
    "end": "418639"
  },
  {
    "text": "access to private keys we see secrets and buckets on in public buckets and it's the first thing I'm gonna look like",
    "start": "418639",
    "end": "424069"
  },
  {
    "text": "it look for if I'm an attacker I'm gonna look for credentials in your environment and can I find a way to use those",
    "start": "424069",
    "end": "429080"
  },
  {
    "text": "credentials to escalate my privileges so if you're gonna protect your credentials in your secrets there's a couple of desirable properties you can go for you",
    "start": "429080",
    "end": "436340"
  },
  {
    "start": "430000",
    "end": "430000"
  },
  {
    "text": "know go through these really quickly identity to enforce access management and use tight authorization scopes you",
    "start": "436340",
    "end": "441590"
  },
  {
    "text": "need this to maintain the privilege the principle of least privilege and audit who is accessing your secrets in terms",
    "start": "441590",
    "end": "447680"
  },
  {
    "text": "of auditing itself verifying the proper use of those secrets ideally it at a per secret level this lets you trace back",
    "start": "447680",
    "end": "454009"
  },
  {
    "text": "what happened who accessed a secret or when it was changed encryption at rest secrets should only be in plain text in",
    "start": "454009",
    "end": "461000"
  },
  {
    "text": "memory but encrypted on disk rotation to refresh secrets things like changing a password in isolation to create a",
    "start": "461000",
    "end": "467479"
  },
  {
    "text": "separation of duties from where secrets are used versus where they're managed so today we'll focus specifically on the",
    "start": "467479",
    "end": "472880"
  },
  {
    "text": "encryption piece of it okay when it",
    "start": "472880",
    "end": "479090"
  },
  {
    "text": "comes to encryption we have several options available to us technologists such as seven cooking drives full disk",
    "start": "479090",
    "end": "488000"
  },
  {
    "text": "encryption encrypted file systems have become ubiquitous in their recent in recent years so the choices that we have",
    "start": "488000",
    "end": "495409"
  },
  {
    "text": "to make is at which level do we enable encryption do we just use do we just let",
    "start": "495409",
    "end": "500599"
  },
  {
    "text": "Hardware do the encryption do we let operating system do the encryption or we do encryption ourselves like what you",
    "start": "500599",
    "end": "507620"
  },
  {
    "text": "will see in this in the store kubernetes community decided that we should take encryption into kubernetes at the",
    "start": "507620",
    "end": "514010"
  },
  {
    "text": "application level so so what is application level encryption application",
    "start": "514010",
    "end": "520190"
  },
  {
    "start": "518000",
    "end": "518000"
  },
  {
    "text": "level encryption as the name implies is the encryption scheme where the",
    "start": "520190",
    "end": "525940"
  },
  {
    "text": "encryption protection confidentiality protection of data is is in the hands of",
    "start": "525940",
    "end": "532250"
  },
  {
    "text": "there that's all this is in contrast to full disk encryption or hardware-based encryption we're operating they where",
    "start": "532250",
    "end": "539150"
  },
  {
    "text": "application may not even be aware that is data being encrypted however application level encryption has",
    "start": "539150",
    "end": "545480"
  },
  {
    "text": "a couple of interesting characteristics which will be of an interest to us here so it is applied at the earliest",
    "start": "545480",
    "end": "552710"
  },
  {
    "text": "possible point so think about it you submitted a create new secret request a cube API server cube a pacer it takes",
    "start": "552710",
    "end": "559310"
  },
  {
    "text": "this data and immediately protects it in other words from that point on your data travels through the rest of the system",
    "start": "559310",
    "end": "565730"
  },
  {
    "text": "in the encrypted form second we protect at the most granule level we even if you",
    "start": "565730",
    "end": "572270"
  },
  {
    "text": "take probably the biggest class that I've ever seen maybe have hundreds or maybe thousands of Secrets you're still",
    "start": "572270",
    "end": "578450"
  },
  {
    "text": "talking about a couple of kilobytes of data to be encrypted why is this important well when you have that little data to",
    "start": "578450",
    "end": "585140"
  },
  {
    "text": "encrypt you can be encrypted on a regular basis without any significant performance overhead and last but not",
    "start": "585140",
    "end": "593420"
  },
  {
    "text": "least application level encryption stays with the data as it moves around from server to server let's just step back a",
    "start": "593420",
    "end": "600560"
  },
  {
    "text": "little bit and think about that example the original example that I showed where the data was copied from one system to",
    "start": "600560",
    "end": "606320"
  },
  {
    "text": "the next let's pretend for a second that the original cluster was using full disk encryption by the time the data is",
    "start": "606320",
    "end": "613160"
  },
  {
    "text": "copied using for example copy command the Fuji stream pressure would have already decrypted the data and by the",
    "start": "613160",
    "end": "619580"
  },
  {
    "text": "time it lands on a different system it's in plaintext this is not the case with application level encryption having said",
    "start": "619580",
    "end": "627020"
  },
  {
    "text": "that I don't want to paint the picture that somehow full disk encryption is worse or application level encryption is",
    "start": "627020",
    "end": "632750"
  },
  {
    "text": "better they're complementing each other there are some very cool things that you can do with full disk encryption encryption",
    "start": "632750",
    "end": "638870"
  },
  {
    "text": "like for example secure boot and there are certain things that you can do only",
    "start": "638870",
    "end": "644630"
  },
  {
    "text": "with application of encryption for this reason for example in Google Cloud we",
    "start": "644630",
    "end": "650150"
  },
  {
    "text": "always use for this encryption for all customer data that's that's a given however we also provide customers for",
    "start": "650150",
    "end": "658220"
  },
  {
    "text": "many products an option to enable additional level of protection at the application layer so let's talk a bit",
    "start": "658220",
    "end": "665660"
  },
  {
    "text": "about rotation so once you've encrypted your secrets now you have these keys to manage and that's what used to encrypt",
    "start": "665660",
    "end": "670680"
  },
  {
    "text": "it you're your protector data but the keys are just as important if not more important than that then the data that",
    "start": "670680",
    "end": "675990"
  },
  {
    "text": "they protect because they give that access if your key management practices aren't good it doesn't really matter how",
    "start": "675990",
    "end": "681300"
  },
  {
    "text": "good your algorithm is or how many bits you're using because someone you just like get access to the keys so how",
    "start": "681300",
    "end": "687150"
  },
  {
    "text": "should you think about key management well a very simple first thing to do would just be generate a local encryption key on your laptop and use",
    "start": "687150",
    "end": "693420"
  },
  {
    "text": "that right and that's that's a great first step and without even getting into how to protect that key once you've",
    "start": "693420",
    "end": "699180"
  },
  {
    "start": "695000",
    "end": "695000"
  },
  {
    "text": "generated it if you're using it for a long time like for many years it's not a great way to protect your data right you",
    "start": "699180",
    "end": "705420"
  },
  {
    "text": "might have changed system ins during that time what's considered a world bet best algorithm might have changed during that time but also that key that you",
    "start": "705420",
    "end": "712800"
  },
  {
    "text": "just tried and rated on your laptop one day is now protecting a lot of data and potentially a lot of sensitive data and",
    "start": "712800",
    "end": "718500"
  },
  {
    "text": "that's not ideal so instead a better model might not be a use one key but use multiple keys or multiple key versions",
    "start": "718500",
    "end": "724620"
  },
  {
    "text": "that you change over time you can refer to them as a single key for naming purposes but the point is these have",
    "start": "724620",
    "end": "730170"
  },
  {
    "text": "different bits that change changing keys frequently is meant to limit the amount",
    "start": "730170",
    "end": "735420"
  },
  {
    "text": "of data compromised if a single key is compromised potential access to the key and corresponding data it's kind of like",
    "start": "735420",
    "end": "741300"
  },
  {
    "text": "changing a password regularly and the potential time for a crypt in the crypt analytic or brute-force attack on that",
    "start": "741300",
    "end": "746460"
  },
  {
    "text": "data encryption keys can be rotated in two ways either through a regular rotation or a regular rotation regular",
    "start": "746460",
    "end": "753330"
  },
  {
    "text": "rotation is an ongoing schedule for example every 90 days to change your keys that might be required for an",
    "start": "753330",
    "end": "759300"
  },
  {
    "text": "internal business compliance reason for example this provides some security benefit without significant complexity",
    "start": "759300",
    "end": "764760"
  },
  {
    "text": "by limiting the amount of data encrypted with a single key irregular rotation is",
    "start": "764760",
    "end": "770070"
  },
  {
    "text": "an ad hoc rotation that you would do for example after a suspected incident as an additional stopgap you might also have",
    "start": "770070",
    "end": "776520"
  },
  {
    "text": "to re encrypt the data that was affected note that we don't recommend that you rely only on a regular rotation but",
    "start": "776520",
    "end": "783150"
  },
  {
    "text": "rather that use that to complement a regular rotation schedule that you already have in place",
    "start": "783150",
    "end": "788720"
  },
  {
    "text": "when we're describing a particular key rotation we call the crypto period at the time during which the particular key",
    "start": "789840",
    "end": "794970"
  },
  {
    "text": "version is used to encrypt data so that's why so it could be like 90 days one day whatever is your requirement in",
    "start": "794970",
    "end": "802090"
  },
  {
    "text": "your organization now envelope encryption so once you start encrypting and managing large",
    "start": "802090",
    "end": "808300"
  },
  {
    "text": "amounts of data rotating Keys and Riaan crypting a bunch of data becomes really annoying and really computationally",
    "start": "808300",
    "end": "813550"
  },
  {
    "text": "intensive so you typically end up using a central key cryptographic a key management system with multiple layers",
    "start": "813550",
    "end": "820120"
  },
  {
    "text": "of keys for the encrypted data this is something known as envelope encryption which is the process of encrypting one",
    "start": "820120",
    "end": "825790"
  },
  {
    "text": "key with another key usually a key that encrypts the data you'll need three pieces here first your data for example",
    "start": "825790",
    "end": "831610"
  },
  {
    "text": "your secret next a data encryption key or a dek which is used to encrypt your",
    "start": "831610",
    "end": "836650"
  },
  {
    "text": "secret this is typically stored with the data that it protects and third a key encryption key or a ke ke which",
    "start": "836650",
    "end": "842620"
  },
  {
    "text": "envelopes or encrypts the dek and that's typically stored somewhere centrally and like for example a key management system",
    "start": "842620",
    "end": "848760"
  },
  {
    "text": "to use envelope encryption you first encrypt the data with the Tek encrypt the dek with the ke k and then together",
    "start": "848760",
    "end": "856080"
  },
  {
    "text": "those are known as the envelope so let's go through an example to see how",
    "start": "856080",
    "end": "861790"
  },
  {
    "start": "860000",
    "end": "860000"
  },
  {
    "text": "envelope encryption and rotation of keys works together in practice that should help make it more concrete to start",
    "start": "861790",
    "end": "871690"
  },
  {
    "text": "let's assume that you have a data store and this is actually working that you're going to be storing your secrets right these are the things that you're trying to encrypt separately we're going to",
    "start": "871690",
    "end": "877839"
  },
  {
    "text": "have a centralized key management service now as I mentioned earlier the de K is typically stored with a data so",
    "start": "877839",
    "end": "882910"
  },
  {
    "text": "that'll be stored in the data store and the ke KS are typically stored centrally so they'll be stored in the canvas and let's assume in this example that the",
    "start": "882910",
    "end": "889720"
  },
  {
    "text": "kms has a rotation schedule that rotates keys monthly okay so we are in oh no I",
    "start": "889720",
    "end": "895839"
  },
  {
    "text": "can't click forward I lied we are in",
    "start": "895839",
    "end": "903339"
  },
  {
    "text": "November so first we're gonna create essentially eight the first instance of a key a ke ke the first ke ke comes up",
    "start": "903339",
    "end": "910450"
  },
  {
    "text": "great it's ready to be used for encryption and it's also important to",
    "start": "910450",
    "end": "915640"
  },
  {
    "text": "note that again as I mentioned these are in separate places so that the people who manage this ke ke are different than the people who manages C ok you can have",
    "start": "915640",
    "end": "921550"
  },
  {
    "text": "a separation of duties here now let's encrypt our for a secret secret one so we're going to generate a dk4 secret one",
    "start": "921550",
    "end": "927790"
  },
  {
    "text": "and use that to encrypt it and then the de ke is going to encrypt it with the ke ke version one that we have",
    "start": "927790",
    "end": "933200"
  },
  {
    "text": "now note that we're versioning the ke case because these are gonna change over time as different versions of the same",
    "start": "933200",
    "end": "938240"
  },
  {
    "text": "key whereas the decays we're not going to rotate we're just gonna use brand new decays every time so we're just gonna",
    "start": "938240",
    "end": "944120"
  },
  {
    "text": "number them sequentially okay we're still November now we create secret - secret - was generated it gets its own",
    "start": "944120",
    "end": "951650"
  },
  {
    "text": "DK DK - and DK 2 is also encrypted with KK version 1 because that's still the",
    "start": "951650",
    "end": "956870"
  },
  {
    "text": "current version in November so far so good now we're in December we generates",
    "start": "956870",
    "end": "963200"
  },
  {
    "text": "another KK and the next version of the KK we don't delete or remove KK P 1 we",
    "start": "963200",
    "end": "969020"
  },
  {
    "text": "don't re-encrypt these secrets we just have a new version for any new data that we're going to encrypt now unfortunately",
    "start": "969020",
    "end": "974180"
  },
  {
    "text": "in November nobody writes a secret so we move on to January same thing January we generate a new key KK KK V 3 this time",
    "start": "974180",
    "end": "982160"
  },
  {
    "text": "when we write a secret they write secret v 3 sir secret 3 we encrypt it with its own DK DK 3 and that's encrypted with ke",
    "start": "982160",
    "end": "989480"
  },
  {
    "text": "ke v 3 that makes sense now suppose that we're going to rewrite one of those",
    "start": "989480",
    "end": "996650"
  },
  {
    "text": "secrets so we're gonna change secret to an update what's written there first we have the decrypt secret - so we have to",
    "start": "996650",
    "end": "1002680"
  },
  {
    "text": "go get DK 2 and DK 2 is encrypted with KK 1 so we have to go get that and use",
    "start": "1002680",
    "end": "1008440"
  },
  {
    "text": "it like I said this is still valid it hasn't been removed now we're gonna when we write secret - we're gonna write it with a new DK again",
    "start": "1008440",
    "end": "1015340"
  },
  {
    "text": "we're not reading sorry we're not rotating decays we're generating a new te case and this DK is gonna encrypted",
    "start": "1015340",
    "end": "1020860"
  },
  {
    "text": "with the current valid KK the most recent version which is KK v3 and so",
    "start": "1020860",
    "end": "1027100"
  },
  {
    "text": "that's how using envelope encryption and and key rotation you give this constant freshness in your environment and",
    "start": "1027100",
    "end": "1032589"
  },
  {
    "text": "encryption of these these things without actually a lot of management overhead and without a lot of you know calls to",
    "start": "1032589",
    "end": "1038199"
  },
  {
    "text": "your kms which can end up being rather expensive ok Thank You Maya so I explained us in",
    "start": "1038199",
    "end": "1046449"
  },
  {
    "start": "1041000",
    "end": "1041000"
  },
  {
    "text": "great details about versioning of keys and envelope encryption but I thought we will make it a little bit more concrete",
    "start": "1046449",
    "end": "1052230"
  },
  {
    "text": "with a practical example so in this demo we'll look at using Walt another great",
    "start": "1052230",
    "end": "1059170"
  },
  {
    "text": "open source project for impor secrets management and we certainly encourage you to to look at more deep",
    "start": "1059170",
    "end": "1067150"
  },
  {
    "text": "because I'm certainly not going to have time to do a justice in this presentation but concretely volt",
    "start": "1067150",
    "end": "1073720"
  },
  {
    "text": "provides us with an ability to play a role of external key management service",
    "start": "1073720",
    "end": "1078910"
  },
  {
    "text": "so think of a vault in transit mode by the way world has many different facets you can you can use it as an external",
    "start": "1078910",
    "end": "1084790"
  },
  {
    "text": "key secret management system but we will just simply use it as a key management service think of it in terms of you have",
    "start": "1084790",
    "end": "1091990"
  },
  {
    "text": "a service I have a I would like something to be encrypted I just send it to vault and it returns back ciphertext",
    "start": "1091990",
    "end": "1098440"
  },
  {
    "text": "in other words it never stores my data it simply takes something encrypts it and returns it back but we also talked",
    "start": "1098440",
    "end": "1106150"
  },
  {
    "text": "about and hopefully I will be able to illustrate the idea of thinking in terms of keys as a container of version of",
    "start": "1106150",
    "end": "1113110"
  },
  {
    "text": "keys so when you create a key it's not a single thing it's basically something get gets versioned over time so",
    "start": "1113110",
    "end": "1119650"
  },
  {
    "text": "hopefully I'll be able to illustrate that and just sort of this to set the dam up both is a restful api you can",
    "start": "1119650",
    "end": "1126310"
  },
  {
    "text": "think of it as restful api with certain endpoints so for example when you want to encrypt something you just simply",
    "start": "1126310",
    "end": "1133000"
  },
  {
    "text": "send something to those to those endpoints thank you my that's you're",
    "start": "1133000",
    "end": "1141370"
  },
  {
    "text": "doing great okay just make sure I'm on the right here okay what we're going to",
    "start": "1141370",
    "end": "1149320"
  },
  {
    "text": "start with was the idea of keys so the first thing you will do when you're",
    "start": "1149320",
    "end": "1155170"
  },
  {
    "text": "working with vault in transit mode you will create a key and just to save some time I already created this key for us",
    "start": "1155170",
    "end": "1160510"
  },
  {
    "text": "and I was using it to build the rest of our demos but what if I I wanted to sort",
    "start": "1160510",
    "end": "1166840"
  },
  {
    "text": "of request so the name of the key is key WS and what I'm doing in this I'm",
    "start": "1166840",
    "end": "1172630"
  },
  {
    "text": "actually calling this REST API to get the metadata on the ski in the",
    "start": "1172630",
    "end": "1179110"
  },
  {
    "text": "interesting part if we scroll up the metadata contains nine different key",
    "start": "1179110",
    "end": "1185020"
  },
  {
    "text": "versions so think about in terms of a container so key that I created it's called KWS but it's not actually",
    "start": "1185020",
    "end": "1192160"
  },
  {
    "text": "the like when we think of keys we think of this long string of random bytes but",
    "start": "1192160",
    "end": "1197560"
  },
  {
    "text": "it's in fact it's a container that contains many array of random bytes so",
    "start": "1197560",
    "end": "1203679"
  },
  {
    "text": "the current version the most current version is version 9 version 10 ok thank you so the latest version is",
    "start": "1203679",
    "end": "1211809"
  },
  {
    "text": "version 10 and those by the way are not the actual secrets this is just AI ideas",
    "start": "1211809",
    "end": "1219130"
  },
  {
    "text": "like those long numbers and X 2 1 & 2 3 & 4 those are just ideas that identify uniquely the key so what I want to do is",
    "start": "1219130",
    "end": "1227710"
  },
  {
    "text": "sort of show a very simple use of vault in this example I'm simply I'm creating",
    "start": "1227710",
    "end": "1235299"
  },
  {
    "text": "a new secret hello secret 1 and I'm sending this plaintext to the ink transit encrypt",
    "start": "1235299",
    "end": "1243610"
  },
  {
    "text": "endpoint and what I get back is this ciphertext and I'm safe saving the ciphertext and then i'm later in the",
    "start": "1243610",
    "end": "1250450"
  },
  {
    "text": "next line i'm sending it to the another end point which is decrypt and it should be getting back the same stick the same",
    "start": "1250450",
    "end": "1258280"
  },
  {
    "text": "value okay so that's work at what has",
    "start": "1258280",
    "end": "1266830"
  },
  {
    "text": "expected but what i wanted to show you here is make sure that this is the",
    "start": "1266830",
    "end": "1273370"
  },
  {
    "text": "encrypted payload but it has a metadata attached to it so it's and the current",
    "start": "1273370",
    "end": "1279160"
  },
  {
    "text": "version of the key is the attend so you notice that v10 is attached to the data itself so if I wanted to decrypt this",
    "start": "1279160",
    "end": "1285190"
  },
  {
    "text": "payload I needed to not only supply the ciphertext but I also need to tell what what version of the key was used okay so",
    "start": "1285190",
    "end": "1294130"
  },
  {
    "text": "let me show you something else so this basically we are pretending that",
    "start": "1294130",
    "end": "1299590"
  },
  {
    "text": "30 day test let's say I don't want to wait 30 days I'm gonna rotate the key right now so just another API call and",
    "start": "1299590",
    "end": "1308020"
  },
  {
    "text": "we rotated the key so what that means is what is the current version now that's 11 it should be 11 so if if at this",
    "start": "1308020",
    "end": "1315190"
  },
  {
    "text": "point I wanted to encrypt something else let's do that",
    "start": "1315190",
    "end": "1320580"
  },
  {
    "text": "version 11 is attached in the payload so this is this is the really the crux of this presentation is to explaining that",
    "start": "1323990",
    "end": "1330390"
  },
  {
    "text": "as you rotate the key new keys are being used in protected data and the point being here is that version 10 service",
    "start": "1330390",
    "end": "1337530"
  },
  {
    "text": "for 30 days and it encrypted some data then 30 days next 30 days come along and",
    "start": "1337530",
    "end": "1342630"
  },
  {
    "text": "we want to use another key so if v10 is ever compromised only the data that was encrypted in the",
    "start": "1342630",
    "end": "1348030"
  },
  {
    "text": "previous 30 days is compromised be b11 is still is still something that we can",
    "start": "1348030",
    "end": "1353040"
  },
  {
    "text": "trust okay so that was a lot of buildup",
    "start": "1353040",
    "end": "1361560"
  },
  {
    "text": "you're like what does this have to do with kubernetes aha this is this is because you need to understand all this stuff it'll help to",
    "start": "1361560",
    "end": "1367200"
  },
  {
    "text": "understand what's going on in kubernetes so - by default in Crewe bananas as Alex demoed at the very beginning of this",
    "start": "1367200",
    "end": "1372660"
  },
  {
    "text": "talk secrets are actually stored in net CD and have no additional protection right they're not further encrypted",
    "start": "1372660",
    "end": "1377880"
  },
  {
    "text": "they're encrypted the same way as the rest rest of a tedious a pod can access all secrets for the file system as",
    "start": "1377880",
    "end": "1383430"
  },
  {
    "text": "environment variable or via crannies API call now starting in caranas 1.7 Rene's",
    "start": "1383430",
    "end": "1389340"
  },
  {
    "text": "offers application layer secrets encryption using something called an encryption config using this there's a",
    "start": "1389340",
    "end": "1394920"
  },
  {
    "text": "differential protection of foetus secrets with a key that's specified in a local @ CD secret can fit so the key is",
    "start": "1394920",
    "end": "1400170"
  },
  {
    "text": "to store the net CD now we actually don't recommend this option because it doesn't actually improve your security right it's the same threat model that",
    "start": "1400170",
    "end": "1407190"
  },
  {
    "text": "you had before if somebody can break in and see your secrets they can break in and get this key and get to your secrets and it Cronus 1.10 criminales introduced",
    "start": "1407190",
    "end": "1415710"
  },
  {
    "text": "envelope encryption or these secrets using something called a kms provider using that once again you have a DK",
    "start": "1415710",
    "end": "1421080"
  },
  {
    "text": "that's stored locally that protects those secrets but this DK is encrypted with a kek that's stored somewhere else",
    "start": "1421080",
    "end": "1427040"
  },
  {
    "text": "so let's see how this works ok thank you",
    "start": "1427040",
    "end": "1435590"
  },
  {
    "start": "1430000",
    "end": "1430000"
  },
  {
    "text": "so let's take a look at the secrets of it now we're talking actually how application encryption is implemented in",
    "start": "1435590",
    "end": "1442110"
  },
  {
    "text": "kubernetes version 1 point 10 so what are the players here like what are the",
    "start": "1442110",
    "end": "1447600"
  },
  {
    "text": "main components involved so you need a version of kubernetes at at least one point and because that's that's where we",
    "start": "1447600",
    "end": "1454980"
  },
  {
    "text": "implemented encryption with EMS with the certain kms provider here the kms plugin and I'll",
    "start": "1454980",
    "end": "1461070"
  },
  {
    "text": "explain what Camus plugin is in a second and you need kms external system for the",
    "start": "1461070",
    "end": "1466379"
  },
  {
    "text": "purposes of this demo were using volt in transit mode but many other came as",
    "start": "1466379",
    "end": "1471570"
  },
  {
    "text": "providers for work as a matter of fact at this point in time there are EMS",
    "start": "1471570",
    "end": "1476970"
  },
  {
    "text": "providers Cuban atheists will work with Azure Google cloud AWS key management",
    "start": "1476970",
    "end": "1485129"
  },
  {
    "text": "servers services rather so what is why do we need kms plugin why couldn't Cube",
    "start": "1485129",
    "end": "1491159"
  },
  {
    "text": "API server directly talk to kms interestingly now that's actually how things started but later we discover",
    "start": "1491159",
    "end": "1498330"
  },
  {
    "text": "that it was actually not going to scale because in that way if we were implemented directly basically if we",
    "start": "1498330",
    "end": "1505169"
  },
  {
    "text": "implemented the communication protocol become cube API server in all the kms implementations it would not scale it",
    "start": "1505169",
    "end": "1511409"
  },
  {
    "text": "would be very difficult to maintain so the decision was made to abstract to abstract you BPI server from the",
    "start": "1511409",
    "end": "1517320"
  },
  {
    "text": "implementation details of the areas EMS providers so for example there is a kms",
    "start": "1517320",
    "end": "1522869"
  },
  {
    "text": "plugin for a zero there is a kms blogger plug-in for AWS there is kms blogging",
    "start": "1522869",
    "end": "1528090"
  },
  {
    "text": "for 4 volt which will using in this example ok so that's an EDD I put it",
    "start": "1528090",
    "end": "1534989"
  },
  {
    "text": "here just for just for completeness but you will see that sed interestingly enough does not play much of a role in",
    "start": "1534989",
    "end": "1541289"
  },
  {
    "text": "this whole process so ok thanks so user requested to create a new secret",
    "start": "1541289",
    "end": "1549090"
  },
  {
    "text": "and what happens at this point the first thing that the cube a piercer will do is it will generate using pseudo random",
    "start": "1549090",
    "end": "1554669"
  },
  {
    "text": "generator generate a data encryption key once the data encryption key is generated this deck will be passed to",
    "start": "1554669",
    "end": "1562619"
  },
  {
    "text": "JMS plugin and tim has plugin all it really does is just forwards it to the KMS however I'm kind of skipping through",
    "start": "1562619",
    "end": "1569669"
  },
  {
    "text": "a lot of details obviously camus plugin you start and akitoki MS but for now let's just keep it at the sky level",
    "start": "1569669",
    "end": "1575899"
  },
  {
    "text": "assuming everything went well KMS returns wrapped data encryption key",
    "start": "1575899",
    "end": "1583240"
  },
  {
    "text": "and KMS plugins simply forwards it up to the cube API server now cube API server",
    "start": "1583240",
    "end": "1589120"
  },
  {
    "text": "actually has everything it needs remember that envelope consists of two parts the secret itself encrypted with a",
    "start": "1589120",
    "end": "1595690"
  },
  {
    "text": "deck and the deck encrypt it was CAG we put together those two things and we create an envelope and the Senate to hcd",
    "start": "1595690",
    "end": "1602890"
  },
  {
    "text": "hcd is not aware of the fact that data is encrypted it just sees a normal write request from its perspective nothing",
    "start": "1602890",
    "end": "1609520"
  },
  {
    "text": "really interesting what's happening there okay okay Thank You Maya doing",
    "start": "1609520",
    "end": "1624220"
  },
  {
    "start": "1613000",
    "end": "1613000"
  },
  {
    "text": "great this is the hardest part of the presentation it's the switching screens",
    "start": "1624220",
    "end": "1629820"
  },
  {
    "text": "okay okay so when we're talking about",
    "start": "1629820",
    "end": "1640330"
  },
  {
    "text": "cube API server I wanted to show you some of the key components that make up cube API server in the context of",
    "start": "1640330",
    "end": "1647950"
  },
  {
    "text": "encryption so really there are a couple of encryption files configuration files that we need to set up so I already",
    "start": "1647950",
    "end": "1654700"
  },
  {
    "text": "started kms plug-in volt and it's already running and as you can see when",
    "start": "1654700",
    "end": "1661450"
  },
  {
    "text": "I'm starting came as plug-in I need to supply the remote address of the vault",
    "start": "1661450",
    "end": "1666820"
  },
  {
    "text": "which we need to know how to talk to to the kms itself and we need to supply a talk in so that the chemists wagon can",
    "start": "1666820",
    "end": "1673900"
  },
  {
    "text": "authenticate itself to the kms I will have more to say in the next slide about this token also please note that this is",
    "start": "1673900",
    "end": "1682059"
  },
  {
    "text": "a demo in reality you will never you should never have a local address so that they came as plug-in talks to this",
    "start": "1682059",
    "end": "1688840"
  },
  {
    "text": "2-day to the kms on the same server because that kind of defeats the purpose you want to make sure that the keys are",
    "start": "1688840",
    "end": "1694809"
  },
  {
    "text": "actually on the remote system protected by key management server there's another",
    "start": "1694809",
    "end": "1700870"
  },
  {
    "text": "configuration file this one is actually supplied to the this one is supplied to the cube API server and here we have",
    "start": "1700870",
    "end": "1708070"
  },
  {
    "text": "some let me let me highlight a couple of points here so the first one is you need to supply what type of resources you",
    "start": "1708070",
    "end": "1714880"
  },
  {
    "text": "would like to be encrypted typically those are secrets but you're not limited to secrets you can encrypt",
    "start": "1714880",
    "end": "1720100"
  },
  {
    "text": "any type of kubernetes resource if you feel like it you can encrypt for example pods or anything like any configuration",
    "start": "1720100",
    "end": "1727029"
  },
  {
    "text": "data can be encrypted inside inside at CD then we come down to the to the",
    "start": "1727029",
    "end": "1734710"
  },
  {
    "text": "configuration of they came as plug-in itself it's actually remarkably simple because remember all the details of how",
    "start": "1734710",
    "end": "1741210"
  },
  {
    "text": "cube API server talks to the kms is implemented inside the kms plugin so all",
    "start": "1741210",
    "end": "1746950"
  },
  {
    "text": "that came as bi-cubic a server needs to know is how to connect to the JMS",
    "start": "1746950",
    "end": "1753580"
  },
  {
    "text": "plug-in and this is accomplished via a UNIX domain socket and this is the file paths which we need to ensure that both",
    "start": "1753580",
    "end": "1760299"
  },
  {
    "text": "kms plugin and the cube API server talking to the same socket you can also",
    "start": "1760299",
    "end": "1766720"
  },
  {
    "text": "use caching caching is there for removing the need to make Network calls",
    "start": "1766720",
    "end": "1772330"
  },
  {
    "text": "to kms and they it's something that may potentially improve your performance",
    "start": "1772330",
    "end": "1779669"
  },
  {
    "text": "okay and the final piece of this puzzle is when we start in few API server we",
    "start": "1779700",
    "end": "1785710"
  },
  {
    "text": "need to supply another flag experimental encryption provider config we're",
    "start": "1785710",
    "end": "1791110"
  },
  {
    "text": "actually removing the word experimental in hopefully 113 so but really is just",
    "start": "1791110",
    "end": "1799269"
  },
  {
    "text": "the only thing that QB pacer when used to know is how to find that encryption config we just described which was just",
    "start": "1799269",
    "end": "1806080"
  },
  {
    "text": "described here so this is it so let me start up cube API server now in in the",
    "start": "1806080",
    "end": "1814240"
  },
  {
    "text": "encryption mode with encryption mode enabled",
    "start": "1814240",
    "end": "1818100"
  },
  {
    "text": "all right okay",
    "start": "1822400",
    "end": "1833350"
  },
  {
    "text": "let's fire up qvp ice alright so it's now the setup for encryption but how",
    "start": "1833350",
    "end": "1838490"
  },
  {
    "text": "would we test this so why don't we I'll just give it a couple of seconds to start up and what I'm going to do here",
    "start": "1838490",
    "end": "1845330"
  },
  {
    "text": "is I'm going to create another secret this time I'm creating a new secret code",
    "start": "1845330",
    "end": "1850700"
  },
  {
    "text": "you can shine a demo and once it is created I want to kind of play the role",
    "start": "1850700",
    "end": "1855980"
  },
  {
    "text": "of an attacker and I want to look at the raw LCD because I'm on the same machine so it's easy for me to do and when I",
    "start": "1855980",
    "end": "1861530"
  },
  {
    "text": "make sure that the secret is actually encrypted and there it is",
    "start": "1861530",
    "end": "1870080"
  },
  {
    "text": "it is protected so an attack an offline attack would have failed at this point and this is unfortunately I know this I",
    "start": "1870080",
    "end": "1878510"
  },
  {
    "text": "had to go fairly fast through this demo there is a couple of interesting details but I want to make sure that I'm being",
    "start": "1878510",
    "end": "1884060"
  },
  {
    "text": "not run out of time if you have any more questions regarding this please see us up at the talk",
    "start": "1884060",
    "end": "1889570"
  },
  {
    "text": "the only track alright yeah okay so we",
    "start": "1898230",
    "end": "1906880"
  },
  {
    "text": "saw this talkin in the configuration just a minute ago just a couple of seconds ago we saw that in order for",
    "start": "1906880",
    "end": "1912850"
  },
  {
    "text": "kmetz plug-in to to talk to the vault what has to be what the the game is",
    "start": "1912850",
    "end": "1920140"
  },
  {
    "text": "playin somehow needed to authenticate to the remote EMS provider which is which is what in this case however if we think",
    "start": "1920140",
    "end": "1927700"
  },
  {
    "text": "about it carefully what just happened we had to supply a secret and place it",
    "start": "1927700",
    "end": "1934000"
  },
  {
    "text": "on the file system inside the same box which is master so if an attacker was",
    "start": "1934000",
    "end": "1939070"
  },
  {
    "text": "able to get complete file system what would have happened in this case they could potentially reverse the whole",
    "start": "1939070",
    "end": "1945220"
  },
  {
    "text": "process they can take the talkin they can call into a vault decrypt the",
    "start": "1945220",
    "end": "1952570"
  },
  {
    "text": "decrypted DAC and they can unwrap everything and basically get back to the secrets so this seems like a kind of a",
    "start": "1952570",
    "end": "1959200"
  },
  {
    "text": "circular relation a circle of dependency but there are some ways to get around in",
    "start": "1959200",
    "end": "1965380"
  },
  {
    "text": "a nutshell what we need to look at I recommend using technology like trusted",
    "start": "1965380",
    "end": "1971170"
  },
  {
    "text": "protected modules TPMS to to seal the secret to the hardware on the server",
    "start": "1971170",
    "end": "1978040"
  },
  {
    "text": "that way if an attacker gets an offline version they would not be able to read this talkin please see me after the talk",
    "start": "1978040",
    "end": "1984970"
  },
  {
    "text": "if this wasn't clear and unfortunate we are running out of time so up best of the matter yeah the last last option we",
    "start": "1984970",
    "end": "1991420"
  },
  {
    "start": "1989000",
    "end": "1989000"
  },
  {
    "text": "haven't talked about is not using criminal secrets at all so you don't have to use secrets and kubernetes if",
    "start": "1991420",
    "end": "1996700"
  },
  {
    "text": "you're already using an external secret store to store secrets that might be a great option for you one popular example",
    "start": "1996700",
    "end": "2002700"
  },
  {
    "text": "is hash record vault Alex just demoed the first way of using vault which is by using the kms plugin",
    "start": "2002700",
    "end": "2007860"
  },
  {
    "text": "so that actually keeps your secrets of record in kubernetes and uses vault as the root of trust the alternative is to",
    "start": "2007860",
    "end": "2013440"
  },
  {
    "text": "have communities authenticate directly to hash a court fault using the kubernetes off back in for vault that uses vault as your root of",
    "start": "2013440",
    "end": "2019560"
  },
  {
    "text": "trust for for community secrets typically I hear users pick the second option that's because if someone's",
    "start": "2019560",
    "end": "2025230"
  },
  {
    "text": "talking about using vault in Korean together they're probably already using vault and already have an external",
    "start": "2025230",
    "end": "2030269"
  },
  {
    "text": "secret store so that makes that make sense in that case so to recap all the different options we went through today extremely quickly by",
    "start": "2030269",
    "end": "2037259"
  },
  {
    "text": "default your secrets are not encrypted if you use an encryption config you don't get significantly more security you can kind of you know check the",
    "start": "2037259",
    "end": "2043710"
  },
  {
    "text": "encryption box but your threat model hasn't changed using the kms plugin you have a couple more options your secrets are encrypted",
    "start": "2043710",
    "end": "2050368"
  },
  {
    "text": "using an external route of trust that's a bit better although there's more to manage a protects your secrets in case",
    "start": "2050369",
    "end": "2055560"
  },
  {
    "text": "your cluster is compromised including your master but not if the attacker can authenticate from the cluster to whatever using for secrets and then",
    "start": "2055560",
    "end": "2062490"
  },
  {
    "text": "lastly you can use an external secrets provider as well and that's also a pretty good option and then over all",
    "start": "2062490",
    "end": "2067530"
  },
  {
    "start": "2067000",
    "end": "2067000"
  },
  {
    "text": "today you know using Krypton based on your threat model use two layers full disk encryption plus application layer",
    "start": "2067530",
    "end": "2073290"
  },
  {
    "text": "encryption rotate keys regularly to limit the amount of that--of that can be compromised when encrypting a lot of",
    "start": "2073290",
    "end": "2079079"
  },
  {
    "text": "data and Volokh encryption is a common scheme this lets you encrypt data by using a local data encryption key and a",
    "start": "2079079",
    "end": "2084628"
  },
  {
    "text": "remote key encryption key to encrypt that data and in kerbin Eddy's we'd recommend you either use that option the",
    "start": "2084629",
    "end": "2089940"
  },
  {
    "text": "kms plugin or if you already have one use your external secrets provider and that was a very quick recap and I think",
    "start": "2089940",
    "end": "2097200"
  },
  {
    "text": "we're out of time if you have any questions we'll be around",
    "start": "2097200",
    "end": "2104310"
  },
  {
    "text": "[Applause] you [Applause]",
    "start": "2104310",
    "end": "2110949"
  }
]