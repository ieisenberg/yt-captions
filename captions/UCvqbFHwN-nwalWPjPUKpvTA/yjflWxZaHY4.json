[
  {
    "start": "0",
    "end": "78000"
  },
  {
    "text": "hi everybody i hope you're having a good cube con so far um no mine's a it's a little different",
    "start": "80",
    "end": "5680"
  },
  {
    "text": "than usual but um still very exciting to be here and be part of this uh",
    "start": "5680",
    "end": "10800"
  },
  {
    "text": "amazing conference so my name is chris carty i am a customer engineer with google",
    "start": "10800",
    "end": "17359"
  },
  {
    "text": "cloud canada's public sector team when i came up with this talk i was",
    "start": "17359",
    "end": "23199"
  },
  {
    "text": "kubernetes administrator and operator so this is based off of my experiences as from that position so today we'll be",
    "start": "23199",
    "end": "30400"
  },
  {
    "text": "talking about managing multi-cluster multi-tenant kubernetes with git ops i know it's a bit of a mouthful but",
    "start": "30400",
    "end": "36239"
  },
  {
    "text": "it's kind of more or less what we're doing i can think of a shorter name so by multi-cluster probably already",
    "start": "36239",
    "end": "44399"
  },
  {
    "text": "talking about there but multi-tenant it's um the problem that i was looking at solving when um",
    "start": "44399",
    "end": "50559"
  },
  {
    "text": "at the time was we had multiple clusters and of course we had multiple teams that would need to be deploying to those",
    "start": "50559",
    "end": "56239"
  },
  {
    "text": "clusters so this is how we kind of came up with a pattern to address that issue and some of the fun",
    "start": "56239",
    "end": "61840"
  },
  {
    "text": "things that we came up came up with along the way so this is the first time i've done a",
    "start": "61840",
    "end": "67520"
  },
  {
    "text": "live or not a live presentation or recorded presentation which is uh",
    "start": "67520",
    "end": "72880"
  },
  {
    "text": "quite fun so unfortunately i don't have all you find people um to present to so instead we have",
    "start": "72880",
    "end": "80560"
  },
  {
    "text": "our friends optimus prime and a couple other autobots and a few decepticons mixed in",
    "start": "80560",
    "end": "86640"
  },
  {
    "text": "there will be my my audience today not quite the same but i expect some encouraging words and uh",
    "start": "86640",
    "end": "94079"
  },
  {
    "text": "claps from optimus prime over there on the left so now with um we'll get into it",
    "start": "94079",
    "end": "101439"
  },
  {
    "text": "so i said so this is based off of my experience um managing multiple clusters",
    "start": "101439",
    "end": "108960"
  },
  {
    "text": "and a large a large number of teams so when we first started out the problem",
    "start": "108960",
    "end": "115119"
  },
  {
    "text": "that we needed or i was looking to solve was how do i manage",
    "start": "115119",
    "end": "122719"
  },
  {
    "text": "let the teams maintain their autonomy without causing this kind of situation every team had uh",
    "start": "122719",
    "end": "129920"
  },
  {
    "start": "123000",
    "end": "136000"
  },
  {
    "text": "theoretically their own ci version or ci cd pattern they had their source control in its own",
    "start": "129920",
    "end": "136560"
  },
  {
    "start": "136000",
    "end": "164000"
  },
  {
    "text": "specific location so while we were all on git things could be",
    "start": "136560",
    "end": "142400"
  },
  {
    "text": "you know get lab github bitbucket a few different places we couldn't as a",
    "start": "142400",
    "end": "149360"
  },
  {
    "text": "commercial administrator i couldn't you know get them to centralize on one that would",
    "start": "149360",
    "end": "154959"
  },
  {
    "text": "be a bit too big of an ask for for me and we wanted to be able to let them do what they want",
    "start": "154959",
    "end": "161519"
  },
  {
    "text": "while getting things into the cluster with as little friction as possible and of course without causing more fires",
    "start": "161519",
    "end": "168640"
  },
  {
    "start": "164000",
    "end": "171000"
  },
  {
    "text": "more pain for the developer we wanted to do less automate all the",
    "start": "168640",
    "end": "174239"
  },
  {
    "start": "171000",
    "end": "255000"
  },
  {
    "text": "things and have things move slowly as moved smoothly so one of the awesome parts about",
    "start": "174239",
    "end": "181040"
  },
  {
    "text": "kubernetes is that everything is declarative so we were able to",
    "start": "181040",
    "end": "187200"
  },
  {
    "text": "um look at leveraging tools that could use that to our advantage so we had to",
    "start": "187200",
    "end": "193680"
  },
  {
    "text": "initially start looking at this more traditional cd aspect so pushing the changes to the cluster",
    "start": "193680",
    "end": "199920"
  },
  {
    "text": "so with gitlab and jenkins it worked really nice but at some point it didn't quite",
    "start": "199920",
    "end": "205630"
  },
  {
    "text": "[Music] didn't quite scale you know we had to load up the those cds with our",
    "start": "205630",
    "end": "212400"
  },
  {
    "text": "cd tools with the configuration files for specific clusters and you know if any of those clusters",
    "start": "212400",
    "end": "218400"
  },
  {
    "text": "went down came up or were replaced we'd have to update all the intuos cis cd tools which is a bit of a bit of a",
    "start": "218400",
    "end": "224879"
  },
  {
    "text": "headache especially when we knew that you know we'd be we'd have multiple zones you'd have",
    "start": "224879",
    "end": "230000"
  },
  {
    "text": "different you know dev qa prod clusters it could be multiple of them there could be on-prem could be in the cloud it could",
    "start": "230000",
    "end": "236319"
  },
  {
    "text": "be anywhere we wanted to not have that burden of managing and maintaining",
    "start": "236319",
    "end": "242000"
  },
  {
    "text": "where the cluster was on the development team we just wanted them to focus on this is my config",
    "start": "242000",
    "end": "249840"
  },
  {
    "text": "deploy it right so that's where we've kind of focused on looking through tools and eventually we found",
    "start": "249840",
    "end": "256160"
  },
  {
    "start": "255000",
    "end": "464000"
  },
  {
    "text": "get ops so as uh kelsey here says gitops is the best thing since",
    "start": "256160",
    "end": "262800"
  },
  {
    "text": "configuration as code and probably key point here for me is it",
    "start": "262800",
    "end": "269040"
  },
  {
    "text": "our same similar to kelsey is um this is key to dealing with infrastructure at scale",
    "start": "269040",
    "end": "274960"
  },
  {
    "text": "and we found this was super beneficial for that because the development team",
    "start": "274960",
    "end": "280639"
  },
  {
    "text": "for us didn't need to know where those clusters were that was um that burden was put on the",
    "start": "280639",
    "end": "286639"
  },
  {
    "text": "um the ops stops team or if there are kubernetes and min team",
    "start": "286639",
    "end": "292880"
  },
  {
    "text": "and so we were able to work with them with this so get ops is a",
    "start": "292880",
    "end": "300479"
  },
  {
    "text": "workflow which emphasizes git as your single source of truth i'm assuming most people at this point",
    "start": "300479",
    "end": "306639"
  },
  {
    "text": "are storing things in some kind of source control primarily get and",
    "start": "306639",
    "end": "314479"
  },
  {
    "text": "so this isn't a big leap to do which is really nice so there the workflow is you know there's an",
    "start": "314479",
    "end": "321680"
  },
  {
    "text": "operator of some kind that sits in your cluster and its job is to monitor your git repo",
    "start": "321680",
    "end": "327360"
  },
  {
    "text": "and just apply the changes that it sees there so you have a single source of truth and then an agent",
    "start": "327360",
    "end": "334320"
  },
  {
    "text": "which tries to make that so similar now kubernetes works when you give it the manifest right just like this is the",
    "start": "334320",
    "end": "341120"
  },
  {
    "text": "state of the world i'm going to make sure that this happens so now we have kubernetes trying to do that with the manifest",
    "start": "341120",
    "end": "346560"
  },
  {
    "text": "that the agent deploys and then the agent is telling kubernetes constantly this is",
    "start": "346560",
    "end": "352320"
  },
  {
    "text": "the state of the world that i see and get so you have this another for loop",
    "start": "352320",
    "end": "357840"
  },
  {
    "text": "essentially and one of the other nice of the other benefits this process",
    "start": "357840",
    "end": "363520"
  },
  {
    "text": "is the developer doesn't necessarily need to have direct access to a cluster now there's going to be instances where",
    "start": "363520",
    "end": "369440"
  },
  {
    "text": "you're going to need to do this if something goes down or you have to do some debugging on the fly but",
    "start": "369440",
    "end": "374880"
  },
  {
    "text": "predominantly the changes will come from a merge request or pr",
    "start": "374880",
    "end": "380080"
  },
  {
    "text": "and the changes will get merged in and then deployed via git once those have been approved and passed your passes",
    "start": "380080",
    "end": "386160"
  },
  {
    "text": "your ci so you reduce the reliance on having people imperatively deploying things",
    "start": "386160",
    "end": "391840"
  },
  {
    "text": "to a cluster instead everything goes through git and then you have the kind of the baked",
    "start": "391840",
    "end": "396880"
  },
  {
    "text": "in benefits of git where you know it's trace the changes are traceable auditable you'll",
    "start": "396880",
    "end": "401919"
  },
  {
    "text": "hopefully have good practice around that so you have your pr and any discussion that comes over changes so you can understand",
    "start": "401919",
    "end": "409199"
  },
  {
    "text": "what what's happening within your cluster system now the cncf has also started adopting",
    "start": "409199",
    "end": "417840"
  },
  {
    "text": "github so we have two primary projects within the get ops field",
    "start": "417840",
    "end": "424160"
  },
  {
    "text": "so flux cd as well as rgo cd flux is the tool that i settled on when",
    "start": "424160",
    "end": "429759"
  },
  {
    "text": "um was building out our internal platform argo is a very close second it was",
    "start": "429759",
    "end": "436639"
  },
  {
    "text": "really cool tool just it did a few extra things that we didn't need it to do",
    "start": "436639",
    "end": "441840"
  },
  {
    "text": "but it was still still great flux was a little bit more lightweight and flexible and it was just focused on",
    "start": "441840",
    "end": "449199"
  },
  {
    "text": "doing the deployment aspect which which is what we certainly needed as we had other things that",
    "start": "449199",
    "end": "455039"
  },
  {
    "text": "filled in the argo part i do check out both both of the tools as they're both really",
    "start": "455039",
    "end": "461039"
  },
  {
    "text": "great they sell different use cases but both fantastic so this is what the the flux",
    "start": "461039",
    "end": "469440"
  },
  {
    "start": "464000",
    "end": "530000"
  },
  {
    "text": "system looks like so you have a single you have your flux agent which does the syncing and then it also has the added benefit",
    "start": "469440",
    "end": "476479"
  },
  {
    "text": "of being able to monitor a container registry and pull in any new um",
    "start": "476479",
    "end": "481680"
  },
  {
    "text": "tags that have been pushed that image so you can have this nice little automated loop so your cd for your",
    "start": "481680",
    "end": "489440"
  },
  {
    "text": "application creates a new container push it up to the registry",
    "start": "489440",
    "end": "494800"
  },
  {
    "text": "flux will see that and it will patch the manifest commit those changes",
    "start": "494800",
    "end": "501360"
  },
  {
    "text": "back to git so you that's how it actually achieves",
    "start": "501360",
    "end": "506560"
  },
  {
    "text": "the um the constant loop there so it's writing back uh to your uh your source of truth",
    "start": "506560",
    "end": "514000"
  },
  {
    "text": "and then it keeps the metadata from those containers within a small memcached container so it's",
    "start": "514000",
    "end": "521360"
  },
  {
    "text": "pretty tight which is nice and that was one of the features that we wanted to to leverage especially within dev qa",
    "start": "521360",
    "end": "527920"
  },
  {
    "text": "just so we have that quick release cycle which is nice so the other part so we",
    "start": "527920",
    "end": "535519"
  },
  {
    "start": "530000",
    "end": "557000"
  },
  {
    "text": "kind of so we found the tool um we did some dry runs to figure out which how it worked and different processes",
    "start": "535519",
    "end": "542080"
  },
  {
    "text": "but we'd started you know what was the appropriate way to structure project",
    "start": "542080",
    "end": "547680"
  },
  {
    "text": "what was the logical way to put things buckets to put the code in how do we",
    "start": "547680",
    "end": "553200"
  },
  {
    "text": "divvy that up so digging around looking at the best practices and",
    "start": "553200",
    "end": "559839"
  },
  {
    "start": "557000",
    "end": "633000"
  },
  {
    "text": "like it came became quite clear that the best way to start structuring um the application",
    "start": "559839",
    "end": "566959"
  },
  {
    "text": "code was to keep the application code separate from the the manifest so up to this point we had been kind of",
    "start": "566959",
    "end": "573680"
  },
  {
    "text": "bundling everything in a single repo but you know you update a manifest then",
    "start": "573680",
    "end": "579920"
  },
  {
    "text": "you start triggering a docker build so it's kind of added time to the release processor you start getting more",
    "start": "579920",
    "end": "585680"
  },
  {
    "text": "artifacts and containers than you actually needed so if by separating the two you had a more clear",
    "start": "585680",
    "end": "592240"
  },
  {
    "text": "ci pipeline for both processes where the app developer side is focused on",
    "start": "592240",
    "end": "597440"
  },
  {
    "text": "creating an artifact and so in most cases a container whereas the app operator side was",
    "start": "597440",
    "end": "603600"
  },
  {
    "text": "focused more on just the ammo and making sure it's compliant with your corporate standards and any",
    "start": "603600",
    "end": "609839"
  },
  {
    "text": "policies you might have as well as api compliant with the kubernetes version that you'll be",
    "start": "609839",
    "end": "614959"
  },
  {
    "text": "deploying against so the um the intent of both",
    "start": "614959",
    "end": "620560"
  },
  {
    "text": "the ci's on those repos are different so it's just it's nicer if they're if they're kept separate sure for smaller projects and teams it's",
    "start": "620560",
    "end": "627760"
  },
  {
    "text": "not a big deal having them together but once you start getting bigger it um it's nicer to keep them in their own buckets",
    "start": "627760",
    "end": "633830"
  },
  {
    "start": "633000",
    "end": "661000"
  },
  {
    "text": "[Music] and this is what the that app operator repo look like in very simple scenario",
    "start": "633830",
    "end": "640640"
  },
  {
    "text": "just have a folder with your ammo in it and all the agent is going to do is or",
    "start": "640640",
    "end": "646399"
  },
  {
    "text": "yeah so there's nothing fancy happening here uh it's just a deployment file um i'm missing some important things",
    "start": "646399",
    "end": "653839"
  },
  {
    "text": "like uh you know root access elevated privileges but just do this just to give you an",
    "start": "653839",
    "end": "660880"
  },
  {
    "text": "overview of what's uh what's going on [Music] so practice going back to the",
    "start": "660880",
    "end": "666880"
  },
  {
    "text": "uh some of the original slide there so is a developer will open up a pr against the get repo",
    "start": "666880",
    "end": "674399"
  },
  {
    "text": "if things pass ci will get merged in and then our eight uh our git operator in this case flux will",
    "start": "674399",
    "end": "680880"
  },
  {
    "text": "be monitoring at a specific branch or tag for those changes and once it saw those default is a five",
    "start": "680880",
    "end": "687440"
  },
  {
    "text": "minute loop it'll just start deploying things and then there you there you have it so",
    "start": "687440",
    "end": "693440"
  },
  {
    "text": "as a developer wouldn't need to touch the cluster at all which is really nice and we're able to leverage this for",
    "start": "693440",
    "end": "700839"
  },
  {
    "text": "onboarding um [Music] so cluster access was heightened",
    "start": "700839",
    "end": "706560"
  },
  {
    "text": "um heightened status only certain people to have access to those resources so for the developer they wouldn't need to",
    "start": "706560",
    "end": "713760"
  },
  {
    "text": "get access they would have to go through an extra process to get access to the cluster and this allowed them to",
    "start": "713760",
    "end": "719040"
  },
  {
    "text": "keep their workflow going without having to get those elevated privileges and maybe able to",
    "start": "719040",
    "end": "725120"
  },
  {
    "text": "box them in to keep it nice and nice and secure at least restrict what they do",
    "start": "725120",
    "end": "731760"
  },
  {
    "text": "and so part of this process um and i touched that lightly was just that is the ci and how you're trying to",
    "start": "731760",
    "end": "738959"
  },
  {
    "text": "make sure things are compliant and ready to ready to go so there's a few",
    "start": "738959",
    "end": "745040"
  },
  {
    "start": "742000",
    "end": "833000"
  },
  {
    "text": "tools that we have out in the there's a lot of tools out in the the ecosystem but the ones i",
    "start": "745040",
    "end": "750800"
  },
  {
    "text": "want to focus on and i've used them are open policy agent um so this let's",
    "start": "750800",
    "end": "756639"
  },
  {
    "text": "for those of you who don't know this lets you write less policy as code um conf test is a separate project which",
    "start": "756639",
    "end": "765040"
  },
  {
    "text": "actually just came under the open policy agent umbrella so uh congrats to",
    "start": "765040",
    "end": "770320"
  },
  {
    "text": "the team for that that's a that's a huge win it allows you to run those policies",
    "start": "770320",
    "end": "776959"
  },
  {
    "text": "within your either your local machine or through a ci process so you can start shifting left and",
    "start": "776959",
    "end": "782959"
  },
  {
    "text": "capturing those those uh violations sooner in the process instead of having to wait for",
    "start": "782959",
    "end": "788320"
  },
  {
    "text": "the force to hit the cluster to get get your pass fails cube val is a thing i'm from the same",
    "start": "788320",
    "end": "795519"
  },
  {
    "text": "team that um from the confidence originator gareth thrushgrove so it allows you to",
    "start": "795519",
    "end": "802880"
  },
  {
    "text": "validate whether or not your yaml is um compliant or api compliant",
    "start": "802880",
    "end": "809680"
  },
  {
    "text": "and then kind so that's for those who don't know that stands for kubernetes and docker",
    "start": "809680",
    "end": "815360"
  },
  {
    "text": "so it's a tool that lets you spin up kubernetes in docker containers so this is a really nice way of",
    "start": "815360",
    "end": "821360"
  },
  {
    "text": "getting a disposable kubernetes cluster in your ci you deploy against that and test things",
    "start": "821360",
    "end": "827120"
  },
  {
    "text": "so you get a better understanding of how your application is",
    "start": "827120",
    "end": "832160"
  },
  {
    "text": "going to behave before it even hits your cluster and so a example",
    "start": "832160",
    "end": "838480"
  },
  {
    "start": "833000",
    "end": "882000"
  },
  {
    "text": "this is very bare bones a pipeline would look something like this you know you do a validation run cube",
    "start": "838480",
    "end": "843519"
  },
  {
    "text": "valve comp test to make sure things are all good and dandy and then you test things in a kubernetes",
    "start": "843519",
    "end": "850000"
  },
  {
    "text": "cluster so demand your budget either do a provision something on the fly in a",
    "start": "850000",
    "end": "856399"
  },
  {
    "text": "cloud provider or you could just spin up kind really quick just lower cost and test",
    "start": "856399",
    "end": "861920"
  },
  {
    "text": "against that and then finally would be your release pipeline sorry release stage and that would just",
    "start": "861920",
    "end": "868399"
  },
  {
    "text": "be consist of a manual approval on a pr you know xyz person has signed off on it",
    "start": "868399",
    "end": "874079"
  },
  {
    "text": "so say its production you know security networking and whoever is in charge of the change",
    "start": "874079",
    "end": "880800"
  },
  {
    "text": "approval process if your company has one so the next",
    "start": "880800",
    "end": "886000"
  },
  {
    "start": "882000",
    "end": "955000"
  },
  {
    "text": "hurdle that we started looking at or started hitting was once he had that or sorry once we",
    "start": "886000",
    "end": "892399"
  },
  {
    "text": "had the kind of folder structure in the ci and decided and how that was going to work was",
    "start": "892399",
    "end": "899199"
  },
  {
    "text": "well how do we kind of manage all the different teams so this is where we kind of bumped into our multi-tenant",
    "start": "899199",
    "end": "904399"
  },
  {
    "text": "issue so how do we have everyone putting things against a single get repo",
    "start": "904399",
    "end": "910160"
  },
  {
    "text": "and just have that define the cluster or clusters so different through either",
    "start": "910160",
    "end": "915199"
  },
  {
    "text": "different folders or different branches or do we continue letting the teams have",
    "start": "915199",
    "end": "920720"
  },
  {
    "text": "more autonomy right so each team would have their own specific git repo that they'd be storing those against and",
    "start": "920720",
    "end": "927199"
  },
  {
    "text": "they'll find some way to reconcile against those",
    "start": "927199",
    "end": "933360"
  },
  {
    "text": "so those are kind of the general patterns i've seen i think i think argo does something different",
    "start": "933839",
    "end": "939440"
  },
  {
    "text": "and something around those lines too um the flux team came up with a their own pattern which i",
    "start": "939440",
    "end": "947199"
  },
  {
    "text": "quite enjoy and i'll show you that in just a few slides i just want to talk about the single repo",
    "start": "947199",
    "end": "953600"
  },
  {
    "text": "for a minute so the single repository no and like i lose to there is just a",
    "start": "953600",
    "end": "960399"
  },
  {
    "start": "955000",
    "end": "1042000"
  },
  {
    "text": "single repository with a bunch of folders you can organize that however you want depending on",
    "start": "960399",
    "end": "966320"
  },
  {
    "text": "your team structure or however your projects are organized in this case i have a folder for cluster",
    "start": "966320",
    "end": "972240"
  },
  {
    "text": "admins and then we have some monitoring networking security folders under there so presumably we'd",
    "start": "972240",
    "end": "978000"
  },
  {
    "text": "have you know something like elasticstack network policies uh maybe something like",
    "start": "978000",
    "end": "985040"
  },
  {
    "text": "falco oppa with gatekeeper all organized up there and then each team would have however",
    "start": "985040",
    "end": "992079"
  },
  {
    "text": "they have want to set things up so it would be in this case i have a folder for app under each each team",
    "start": "992079",
    "end": "1001040"
  },
  {
    "text": "and then all the flux agent would do is sync against that and just recursively",
    "start": "1001040",
    "end": "1006800"
  },
  {
    "text": "deploy all the ammo right so depending on how large your team is this could get",
    "start": "1006800",
    "end": "1012320"
  },
  {
    "text": "quite big at some point given that flux is just doing a get clone",
    "start": "1012320",
    "end": "1017680"
  },
  {
    "text": "so you know all it takes would be one for one team to misconfigure something and then your",
    "start": "1017680",
    "end": "1024000"
  },
  {
    "text": "deployment might fail or something like that so you know smaller teams i see this working really well but",
    "start": "1024000",
    "end": "1030558"
  },
  {
    "text": "once you start getting into larger enterprise situations where you have",
    "start": "1030559",
    "end": "1035869"
  },
  {
    "text": "[Music] quite a few teams it starts getting a little",
    "start": "1035869",
    "end": "1041120"
  },
  {
    "text": "a little clunky [Music] this is what it would look like from a",
    "start": "1041120",
    "end": "1047079"
  },
  {
    "start": "1042000",
    "end": "1112000"
  },
  {
    "text": "multi-cluster point of view so we have all of our teams they deploy against the single git repo",
    "start": "1047079",
    "end": "1053200"
  },
  {
    "text": "and then we have an agent in each cluster or clusters um with an agent",
    "start": "1053200",
    "end": "1059840"
  },
  {
    "text": "sorry yeah with an agent pointing to this to the right branch so in this case we have a",
    "start": "1059840",
    "end": "1064960"
  },
  {
    "text": "just a three cluster set up so each branch is um each cluster is thinking with uh say",
    "start": "1064960",
    "end": "1070799"
  },
  {
    "text": "dev qa prod pretty straight forward there are different ways you can do this",
    "start": "1070799",
    "end": "1076720"
  },
  {
    "text": "if you have different folders use customize to you know pull off of base and you can break things up like that which",
    "start": "1076720",
    "end": "1084160"
  },
  {
    "text": "is nice and then you can start doing kind of organizing clusters by kind",
    "start": "1084160",
    "end": "1090160"
  },
  {
    "text": "so for example you want to have everything safe",
    "start": "1090160",
    "end": "1095520"
  },
  {
    "text": "security has a group of policies you want to have everything going to a heightened security area and you can",
    "start": "1095520",
    "end": "1101440"
  },
  {
    "text": "start doing neat things like that i find a lot easier to achieve in the multi-tenant repo or sorry the",
    "start": "1101440",
    "end": "1107360"
  },
  {
    "text": "multi-repo structure but you can there's ways you can do it within this model as well",
    "start": "1107360",
    "end": "1112640"
  },
  {
    "start": "1112000",
    "end": "1122000"
  },
  {
    "text": "you've got the hybrid approach [Music] so the multi-repo structure um is",
    "start": "1112640",
    "end": "1119280"
  },
  {
    "text": "where you have every team has their own repository and it would look something like this",
    "start": "1119280",
    "end": "1124480"
  },
  {
    "start": "1122000",
    "end": "1211000"
  },
  {
    "text": "and this is adapted from the flex themes multi multi-tenant",
    "start": "1124480",
    "end": "1130240"
  },
  {
    "text": "pattern so we'd have a single agent which is in charge of cluster-wide",
    "start": "1130240",
    "end": "1136880"
  },
  {
    "text": "resources as well as managing the [Music] flux agents which would sync with the",
    "start": "1136880",
    "end": "1144080"
  },
  {
    "text": "team repositories so that cluster-wide admin agent",
    "start": "1144080",
    "end": "1149600"
  },
  {
    "text": "you'd be creating your name spaces rbac policies quotas",
    "start": "1149600",
    "end": "1155919"
  },
  {
    "text": "role bindings there are cluster role bindings those kinds of things and then each team they would define",
    "start": "1156559",
    "end": "1164480"
  },
  {
    "text": "within that cluster repo their namespace",
    "start": "1164480",
    "end": "1170880"
  },
  {
    "text": "or they would open could open pr you could create it so they'd just be doing those things then there'd be an agent which gets provisioned in that",
    "start": "1171520",
    "end": "1178320"
  },
  {
    "text": "name space which would sync with their own repo and that would be namespace and scope",
    "start": "1178320",
    "end": "1184720"
  },
  {
    "text": "so you give them a lot more freedom to do what they want but you have from that one cluster repo a lot of",
    "start": "1184720",
    "end": "1190480"
  },
  {
    "text": "control over what they can do and then you also open up a lot more visibility so",
    "start": "1190480",
    "end": "1195679"
  },
  {
    "text": "depending on how you want to work they could open up a pr if they want to change anything against their main repo",
    "start": "1195679",
    "end": "1202240"
  },
  {
    "text": "or you can open up tickets and you can change it but they would still be able to see",
    "start": "1202240",
    "end": "1207600"
  },
  {
    "text": "what's happening within their namespace even though they couldn't change it directly [Music]",
    "start": "1207600",
    "end": "1213200"
  },
  {
    "start": "1211000",
    "end": "1224000"
  },
  {
    "text": "and this is so i mentioned this briefly within the a couple slides ago but it's nice where",
    "start": "1213200",
    "end": "1219200"
  },
  {
    "text": "you can with this you can start using uh branch tag equals a group or environment of clusters",
    "start": "1219200",
    "end": "1226000"
  },
  {
    "start": "1224000",
    "end": "1321000"
  },
  {
    "text": "and so if the security teams a networking team they had their own repos",
    "start": "1226000",
    "end": "1231280"
  },
  {
    "text": "they could start defining on their own say uh groups of policies",
    "start": "1231280",
    "end": "1237200"
  },
  {
    "text": "or for for zones of clusters right so a high medium low",
    "start": "1237200",
    "end": "1242400"
  },
  {
    "text": "zone or you know pci or however you want to your teams organize",
    "start": "1242400",
    "end": "1247760"
  },
  {
    "text": "themselves so the security team would just need both those teams who just need to commit their",
    "start": "1247760",
    "end": "1253120"
  },
  {
    "text": "their policies to those specific branches and then i as a cluster admin",
    "start": "1253120",
    "end": "1259919"
  },
  {
    "text": "would just be able to you know sync or tell those clusters that were going to be in those regions to sync with their policies so",
    "start": "1259919",
    "end": "1267360"
  },
  {
    "text": "as soon as they changed them change them those clusters would get them right away",
    "start": "1267360",
    "end": "1272480"
  },
  {
    "text": "and if i booted up a cluster they would get those policies again right off the bat so those individual",
    "start": "1272480",
    "end": "1279760"
  },
  {
    "text": "teams wouldn't need to update their ci process to target the new clusters that have come online",
    "start": "1279760",
    "end": "1285679"
  },
  {
    "text": "the fun part is the clusters become a little bit more ephemeral to the teams are abstracted away so they're they know",
    "start": "1285679",
    "end": "1292720"
  },
  {
    "text": "they're there but they don't need to know where they are exactly or what they are it's just that the",
    "start": "1292720",
    "end": "1298720"
  },
  {
    "text": "policies are getting targeted and deployed effectively",
    "start": "1298720",
    "end": "1304000"
  },
  {
    "text": "which is really cool and quite powerful especially if you're trying to affect change on you know tens or",
    "start": "1304000",
    "end": "1310640"
  },
  {
    "text": "hundreds of clusters depending on what the kind of organization size you're looking at",
    "start": "1310640",
    "end": "1315760"
  },
  {
    "text": "and just be able to do that with a single pr or commit is is quite powerful",
    "start": "1315760",
    "end": "1322400"
  },
  {
    "start": "1321000",
    "end": "1404000"
  },
  {
    "text": "and so this is what that tenant structure would look like so it's similar to the single tenant",
    "start": "1323200",
    "end": "1329840"
  },
  {
    "text": "structure but it doesn't have the nested nested folders within the the team team",
    "start": "1329840",
    "end": "1335440"
  },
  {
    "text": "folders so all the team folders would go under the cluster directory",
    "start": "1335440",
    "end": "1340640"
  },
  {
    "text": "and so like i said there there's a agent description for flux then you have your",
    "start": "1340640",
    "end": "1346000"
  },
  {
    "text": "config file uh sorry cube config this is all levers and customized",
    "start": "1346000",
    "end": "1351120"
  },
  {
    "text": "under the base there's the data the main flux configuration you have your",
    "start": "1351120",
    "end": "1357360"
  },
  {
    "text": "namespace psp on our back and then each team's just going to get that and it describes the agent",
    "start": "1357360",
    "end": "1363840"
  },
  {
    "text": "which then gets deployed to the environment and then that flux agent will look like",
    "start": "1363840",
    "end": "1369120"
  },
  {
    "text": "this you're telling it what repo it's going or what repo is going to the name space it's targeting",
    "start": "1369120",
    "end": "1375600"
  },
  {
    "text": "as well as the branch and if you're doing this in a more open fashion the teams again",
    "start": "1375600",
    "end": "1381840"
  },
  {
    "text": "would be able to open up a pr change this and then bring it in so you can",
    "start": "1381840",
    "end": "1387360"
  },
  {
    "text": "give them a lot of autonomy to do what they need to do while also having a lot of oversight in",
    "start": "1387360",
    "end": "1392720"
  },
  {
    "text": "what happens so your cluster environment becomes a lot less of a black box like what's the point",
    "start": "1392720",
    "end": "1398480"
  },
  {
    "text": "where what am i deploying to where where are things [Music]",
    "start": "1398480",
    "end": "1406400"
  },
  {
    "start": "1404000",
    "end": "1440000"
  },
  {
    "text": "and now we'll get into a quick demo just to show off um what this could look",
    "start": "1406400",
    "end": "1413120"
  },
  {
    "text": "like in practice and just to show you it's not um i mean it's pretty cool just to be able to see",
    "start": "1413120",
    "end": "1418799"
  },
  {
    "text": "see it works so i'll have uh three clusters running uh two of which will already be",
    "start": "1418799",
    "end": "1423840"
  },
  {
    "text": "synced with um with our configuration and i'll just bootstrap more last that",
    "start": "1423840",
    "end": "1429039"
  },
  {
    "text": "individual cluster or that single cluster that's not synced just to show you that how we can inherit",
    "start": "1429039",
    "end": "1434960"
  },
  {
    "text": "the process or inherit all the features of those",
    "start": "1434960",
    "end": "1439519"
  },
  {
    "start": "1440000",
    "end": "1860000"
  },
  {
    "text": "[Music] clusters",
    "start": "1440910",
    "end": "1445840"
  },
  {
    "text": "okay so now for our quick demo we're almost at the end of the session so this won't be too long",
    "start": "1446799",
    "end": "1453279"
  },
  {
    "text": "it's going to show how to bootstrap a cluster and bring it in line with a few existing",
    "start": "1453279",
    "end": "1460000"
  },
  {
    "text": "clusters in a multi-tenant scenario so right now we have three clusters uh",
    "start": "1460000",
    "end": "1465679"
  },
  {
    "text": "dev qa prod and they're all saying came to the main repo on this on the same branch",
    "start": "1465679",
    "end": "1470880"
  },
  {
    "text": "probably want to have it separated out in our actual scenario but this is just a demonstration so cheating",
    "start": "1470880",
    "end": "1477440"
  },
  {
    "text": "a little so i'll take a look just to show you what's in this cluster",
    "start": "1477440",
    "end": "1482720"
  },
  {
    "text": "so i'm in the dev or sorry the prod cluster we have a few different name spaces right now i'm",
    "start": "1482720",
    "end": "1488640"
  },
  {
    "text": "in the demo app name space which simply has a little web app that i wrote the falco",
    "start": "1488640",
    "end": "1495279"
  },
  {
    "text": "namespace our falco system has falco running and then gatekeeper has gatekeeper",
    "start": "1495279",
    "end": "1501360"
  },
  {
    "text": "running you can see it's a there's several nodes in the cluster they're all all doing things so",
    "start": "1501360",
    "end": "1507679"
  },
  {
    "text": "the same thing goes for the qa cluster or sorry um the dev cluster the qa",
    "start": "1507679",
    "end": "1513520"
  },
  {
    "text": "cluster is the one we're going to bring up online so if we do that it's going to be in the",
    "start": "1513520",
    "end": "1519440"
  },
  {
    "text": "there we go same scenario as the prod cluster so we're in the demo app name space",
    "start": "1519440",
    "end": "1526159"
  },
  {
    "text": "yeah we got um same app so if i switch my name space over to falco just to show you what's going on",
    "start": "1526159",
    "end": "1532640"
  },
  {
    "text": "there same setup different contacts different cluster so i go over to my qa cluster",
    "start": "1532640",
    "end": "1543840"
  },
  {
    "text": "so it's going to be bare bones nothing there as of yet so what i'm",
    "start": "1544799",
    "end": "1550559"
  },
  {
    "text": "going to do is run a quick little script which just installs the the flux agent",
    "start": "1550559",
    "end": "1557679"
  },
  {
    "text": "and updates the ssh key to allow access to the the cluster which",
    "start": "1557679",
    "end": "1564720"
  },
  {
    "text": "everything's stored at so just going to run that",
    "start": "1564720",
    "end": "1571840"
  },
  {
    "text": "we go i'm just switching over to context and that cluster or is here that repo that's sticking up",
    "start": "1575679",
    "end": "1581039"
  },
  {
    "text": "syncing against is right here so it's pulling all the resources in from this folder here",
    "start": "1581039",
    "end": "1588080"
  },
  {
    "text": "and then each one of these application folders is going to generate a flux agent which will sync up to a",
    "start": "1588080",
    "end": "1593520"
  },
  {
    "text": "specific repository so the demo app here we'll point to the this repo here which",
    "start": "1593520",
    "end": "1600640"
  },
  {
    "text": "has the configurations stored in the deployment repo you can see here if i go into flux patch",
    "start": "1600640",
    "end": "1608559"
  },
  {
    "text": "everything is set there so it's pointing everything at the deploy folder on the main branch at that that target",
    "start": "1608559",
    "end": "1615679"
  },
  {
    "text": "the falco repo is going to look a little different because it's running um using the it's",
    "start": "1615760",
    "end": "1622320"
  },
  {
    "text": "being deployed by helm so let's just take a look here it's only read only",
    "start": "1622320",
    "end": "1628400"
  },
  {
    "text": "and then it's being pulled from this helm branch or repo that i have set",
    "start": "1628400",
    "end": "1635120"
  },
  {
    "text": "up so i'll just go there just to show you i guess i could just",
    "start": "1635120",
    "end": "1641840"
  },
  {
    "text": "sorry i've been on a windows or chromebook for a while so i have my command key flipped around",
    "start": "1644320",
    "end": "1651440"
  },
  {
    "text": "there we'll go here all that's sitting in here is the values file for",
    "start": "1651440",
    "end": "1656559"
  },
  {
    "text": "falco so there's our helm release information",
    "start": "1656559",
    "end": "1661679"
  },
  {
    "text": "and then if we go here these are",
    "start": "1662159",
    "end": "1669840"
  },
  {
    "text": "this what it would look like for just a standard falco release",
    "start": "1669840",
    "end": "1674960"
  },
  {
    "text": "go back to the helm release here so it's kind home release and then those values",
    "start": "1676399",
    "end": "1681840"
  },
  {
    "text": "right there so you can see i have down here our back is enabled psp",
    "start": "1681840",
    "end": "1687200"
  },
  {
    "text": "should be enabled and then i have i think evpf turned on so it works with gcp",
    "start": "1687200",
    "end": "1694640"
  },
  {
    "text": "all right so now if i go back to the cluster hopefully everything has booted up as expected",
    "start": "1694880",
    "end": "1702000"
  },
  {
    "text": "and there you go so i've deployed all the all this infrastructure or most of the infrastructure without having to touch",
    "start": "1702000",
    "end": "1708399"
  },
  {
    "text": "much so if i look at the falco system so i'll just switch over to falco",
    "start": "1708399",
    "end": "1715600"
  },
  {
    "text": "i'm not picking on falco for any other reason other than i like saying it right now so you can see that the agent is there",
    "start": "1715919",
    "end": "1721440"
  },
  {
    "text": "and it's not doing or nothing else has been deployed that's because the agents that have",
    "start": "1721440",
    "end": "1726799"
  },
  {
    "text": "that were deployed by the master don't have their respective ssh keys to access",
    "start": "1726799",
    "end": "1732640"
  },
  {
    "text": "the clusters or sorry the git repos so in order to kind of bypass that i",
    "start": "1732640",
    "end": "1738880"
  },
  {
    "text": "just have a little a script that just deletes the secret that's in there and recreates it with the right",
    "start": "1738880",
    "end": "1746159"
  },
  {
    "text": "um right key which is stored locally so nothing too magical happening there now",
    "start": "1746399",
    "end": "1753279"
  },
  {
    "text": "if i go do this it'll take just a couple minutes just for that um",
    "start": "1753279",
    "end": "1760240"
  },
  {
    "text": "agent or the five minute cooldown time for everything to take effect but if i go",
    "start": "1760240",
    "end": "1767600"
  },
  {
    "text": "let's try different name space some falco one because it has to go through a helm deploy",
    "start": "1767600",
    "end": "1773039"
  },
  {
    "text": "takes a little bit longer so let's go check and take a look on",
    "start": "1773039",
    "end": "1779679"
  },
  {
    "text": "gatekeeper there we go so it's already starting to roll out",
    "start": "1779679",
    "end": "1785600"
  },
  {
    "text": "so now we have gatekeeper up and running in the the cluster everything's going to be thinking from its repository so",
    "start": "1785600",
    "end": "1792080"
  },
  {
    "text": "if i or say the security team set up a central control for all the gatekeeper policies",
    "start": "1792080",
    "end": "1797760"
  },
  {
    "text": "i would automatically be getting those and the configuration which they've set up in that specific branch or policy",
    "start": "1797760",
    "end": "1803679"
  },
  {
    "text": "same goes for falco agents",
    "start": "1803679",
    "end": "1809840"
  },
  {
    "text": "so they should be up now if let's take a look",
    "start": "1810960",
    "end": "1816880"
  },
  {
    "text": "let's show the labels",
    "start": "1817440",
    "end": "1822480"
  },
  {
    "text": "oh because it's a damon set",
    "start": "1822480",
    "end": "1828398"
  },
  {
    "text": "there we go so let's do logs",
    "start": "1829600",
    "end": "1837360"
  },
  {
    "text": "all right so there you can see everything that's putting out there it's getting set up so we're we're good",
    "start": "1837360",
    "end": "1845039"
  },
  {
    "text": "to go and that's kind of how you'd bootstrap everything and get it going",
    "start": "1845039",
    "end": "1850559"
  },
  {
    "text": "and that's bringing things in sync from different clusters into a single",
    "start": "1850559",
    "end": "1855600"
  },
  {
    "text": "single cluster or sorry across multiple clusters from multiple multiple repos okay so i hope you",
    "start": "1855600",
    "end": "1861600"
  },
  {
    "start": "1860000",
    "end": "1964000"
  },
  {
    "text": "enjoyed that demo of showing how we bring on a cluster with a with existing repositories using the",
    "start": "1861600",
    "end": "1867840"
  },
  {
    "text": "flux agent and our multi-tenant repository so hope you enjoyed the presentation",
    "start": "1867840",
    "end": "1873919"
  },
  {
    "text": "overall i know it was a try to keep it high level being that this is an introductory course",
    "start": "1873919",
    "end": "1879279"
  },
  {
    "text": "or session i hope it gave you an idea of how you would approach building your",
    "start": "1879279",
    "end": "1884880"
  },
  {
    "text": "multi-tenant solution going forward we have our multi-multi-git repo",
    "start": "1884880",
    "end": "1891360"
  },
  {
    "text": "pattern or even a single single git repo and some of the pros and cons of approaching",
    "start": "1891360",
    "end": "1896799"
  },
  {
    "text": "approaching that and how would you apply those to managing multi-multi-tenant",
    "start": "1896799",
    "end": "1902000"
  },
  {
    "text": "multi-cluster kubernetes and so i will be in the chat for a",
    "start": "1902000",
    "end": "1908320"
  },
  {
    "text": "little while but if uh you have to get to another session or um you want to reach out to me at a",
    "start": "1908320",
    "end": "1913760"
  },
  {
    "text": "later date um feel free to reach out and contact me on twitter or kubernetes you can find me in both places at",
    "start": "1913760",
    "end": "1920880"
  },
  {
    "text": "macintosh prime i've also a few resources here for you to",
    "start": "1920880",
    "end": "1926000"
  },
  {
    "text": "take a look at and that i found found quite helpful in my journey and the the one via",
    "start": "1926000",
    "end": "1932640"
  },
  {
    "text": "steve wade from metal is quite new but it's a really good example of how",
    "start": "1932640",
    "end": "1937679"
  },
  {
    "text": "you can do this in a practical way and thank you for for having me",
    "start": "1937679",
    "end": "1943840"
  },
  {
    "text": "today and tuning in i hope you enjoy the rest of kubecon and i hope that we'll be able to meet up in uh or see",
    "start": "1943840",
    "end": "1951279"
  },
  {
    "text": "each other all in the reel sometime in the near future until then hope everyone stays safe stay safe",
    "start": "1951279",
    "end": "1958320"
  },
  {
    "text": "enjoys the rest of summer and of course again have a great kubecon thank you very much",
    "start": "1958320",
    "end": "1966799"
  }
]