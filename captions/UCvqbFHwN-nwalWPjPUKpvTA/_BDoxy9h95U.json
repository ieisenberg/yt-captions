[
  {
    "start": "0",
    "end": "380000"
  },
  {
    "text": "hello everyone good afternoon welcome to this talk on root causing kubernetes",
    "start": "3600",
    "end": "9599"
  },
  {
    "text": "networking problems in an automated way i wish this session was in person and",
    "start": "9599",
    "end": "15599"
  },
  {
    "text": "interactive i still would like to have this as interactive as possible so keep your questions",
    "start": "15599",
    "end": "23359"
  },
  {
    "text": "coming in on chat and i'll answer them as we go i will also",
    "start": "23359",
    "end": "28640"
  },
  {
    "text": "locate some time at the end as much as possible for q a i've debugged network problems",
    "start": "28640",
    "end": "35360"
  },
  {
    "text": "in over 100 customer cost clusters in production so whatever you hear today as",
    "start": "35360",
    "end": "40719"
  },
  {
    "text": "well as what you'll see from a tool kds network perspective it is from my",
    "start": "40719",
    "end": "47600"
  },
  {
    "text": "that experience all right so what is this talk all about right",
    "start": "47600",
    "end": "53920"
  },
  {
    "text": "have you been in a situation where everything looks okay all of the points are running",
    "start": "53920",
    "end": "59840"
  },
  {
    "text": "but then your app just won't communicate or it works",
    "start": "59840",
    "end": "65280"
  },
  {
    "text": "most of the times but does not work sometime now if you look at the the cartoons",
    "start": "65280",
    "end": "72880"
  },
  {
    "text": "there that could turn from an exciting happy person running kubernetes and happen",
    "start": "72880",
    "end": "78720"
  },
  {
    "text": "within kubernetes to a very frustrated person especially when it comes to a network networking problem",
    "start": "78720",
    "end": "85439"
  },
  {
    "text": "at the end of the talk i'm hoping that you feel less intimidated about networking issues as",
    "start": "85439",
    "end": "91520"
  },
  {
    "text": "well as a lot more comfortable within kubernetes networking and i leave you equipped with",
    "start": "91520",
    "end": "98400"
  },
  {
    "text": "a couple of tools and ways in which you can get to root",
    "start": "98400",
    "end": "103840"
  },
  {
    "text": "causing a kubernetes networking problem in an automated way as well as if not getting to the problem getting to",
    "start": "103840",
    "end": "110240"
  },
  {
    "text": "the place where you can find right help it's always beneficial to",
    "start": "110240",
    "end": "117280"
  },
  {
    "text": "know some basics of kubernetes networking um rest assured most of the hard stuff is",
    "start": "117280",
    "end": "123600"
  },
  {
    "text": "going to be done by k this network in that sense i will be talking about",
    "start": "123600",
    "end": "130319"
  },
  {
    "text": "kubernetes networking uh in brief uh it is a big topic in itself",
    "start": "130319",
    "end": "135680"
  },
  {
    "text": "and a whole talk so think of it as a crash course uh we'll then look at the problems that you",
    "start": "135680",
    "end": "143520"
  },
  {
    "text": "normally see with kubernetes networking and running pods within kubernetes and how to classify these issues",
    "start": "143520",
    "end": "150800"
  },
  {
    "text": "and then we'll look at what people do to resolve these issues it's very interesting what people do and",
    "start": "150800",
    "end": "157680"
  },
  {
    "text": "that slide is exciting after that the important part we'll look at some open source tools and how we can",
    "start": "157680",
    "end": "165280"
  },
  {
    "text": "use them to [Music] debug any networking issue and how to go",
    "start": "165280",
    "end": "170800"
  },
  {
    "text": "about that debugging process and then we'll look at kts network in detail uh give you an inflection on it",
    "start": "170800",
    "end": "177040"
  },
  {
    "text": "and a quick demo on how to work with it all right without further ado let's get",
    "start": "177040",
    "end": "183680"
  },
  {
    "text": "started so kubernetes networking to keep it simple right there are three golden",
    "start": "183680",
    "end": "190000"
  },
  {
    "text": "rules um and when it comes to communication within kubernetes and they are that all",
    "start": "190000",
    "end": "196959"
  },
  {
    "text": "containers within the kubernetes cluster talk to each other without any kind of map",
    "start": "196959",
    "end": "204400"
  },
  {
    "text": "which means that the ip address that the container knows when you when you say",
    "start": "204400",
    "end": "209840"
  },
  {
    "text": "run ipconfig or if config or ip link show or ip address show",
    "start": "209840",
    "end": "215680"
  },
  {
    "text": "the address that you see is the same address that another container outside of",
    "start": "215680",
    "end": "221599"
  },
  {
    "text": "within that cluster would use the other is that all nodes are able to",
    "start": "221599",
    "end": "228080"
  },
  {
    "text": "reach these parts or containers without any net um nyc version right so",
    "start": "228080",
    "end": "233920"
  },
  {
    "text": "without nad is a and it is an important uh construct here",
    "start": "233920",
    "end": "239360"
  },
  {
    "text": "now we'll to understand network problems and how to debug it's",
    "start": "239360",
    "end": "245599"
  },
  {
    "text": "uh beneficial to know what the components are that play into kubernetes networking so let's",
    "start": "245599",
    "end": "253120"
  },
  {
    "text": "quick quickly take a look at what these components are which are responsible for",
    "start": "253120",
    "end": "258639"
  },
  {
    "text": "everything from connecting your card to your service and everything else within kubernetes",
    "start": "258639",
    "end": "265280"
  },
  {
    "text": "the first one is the cni back end most of you are would be familiar with",
    "start": "265280",
    "end": "270720"
  },
  {
    "text": "it you either run calico or flannel or celium and shia there are so many other",
    "start": "270720",
    "end": "277360"
  },
  {
    "text": "cni backends out there that's the component that provides pod",
    "start": "277360",
    "end": "282400"
  },
  {
    "text": "connectivity it connects multiple parts together either on the same host or across hosts it also does",
    "start": "282400",
    "end": "289440"
  },
  {
    "text": "nothing so if a part needs to reach the internet it kind of connects that part over to the internet",
    "start": "289440",
    "end": "296560"
  },
  {
    "text": "um the next component is cube proxy uh it's responsible for the service",
    "start": "296560",
    "end": "303039"
  },
  {
    "text": "construct whenever you create a service within kubernetes q proxy comes into play and",
    "start": "303039",
    "end": "308400"
  },
  {
    "text": "it works with ip tables ipvs [Music]",
    "start": "308400",
    "end": "313440"
  },
  {
    "text": "to give you that functionality of internal load balancing or e-stress load balancing",
    "start": "313440",
    "end": "318800"
  },
  {
    "text": "and then there is the load balancing implementation if you're running a cluster cloud you have aws efb for",
    "start": "318800",
    "end": "325120"
  },
  {
    "text": "example uh metal lb is an open source project that",
    "start": "325120",
    "end": "330080"
  },
  {
    "text": "is used in production to deploy um a software headload balancer within the",
    "start": "330160",
    "end": "336240"
  },
  {
    "text": "kubernetes cluster then there is ingress if you want to be able to connect",
    "start": "336240",
    "end": "342479"
  },
  {
    "text": "multiple services and route through a single point single entry point either by using url paths",
    "start": "342479",
    "end": "349280"
  },
  {
    "text": "or ports you can do l4 english l7 english there are various examples there again",
    "start": "349280",
    "end": "356880"
  },
  {
    "text": "as you can see as we go down this list complexity increases so that is service mesh which is a lot more complex you",
    "start": "356880",
    "end": "363120"
  },
  {
    "text": "have hto link rd console connect and the whole kubernetes networking stack right ip tables ipvs linux networking stack",
    "start": "363120",
    "end": "369840"
  },
  {
    "text": "and yeah so let's look at how communication works",
    "start": "369840",
    "end": "375120"
  },
  {
    "text": "uh across the cluster say for example two parts in an east-west manner",
    "start": "375120",
    "end": "381840"
  },
  {
    "start": "380000",
    "end": "531000"
  },
  {
    "text": "and say let's say you have two parts one is the blog app the other is an index app you have two copies of these they're",
    "start": "382560",
    "end": "389120"
  },
  {
    "text": "running on two different hosts in your kubernetes cluster now if pod a or the blog app wants to",
    "start": "389120",
    "end": "395199"
  },
  {
    "text": "talk to part b uh or the index app through the service uh assuming there's a service that's",
    "start": "395199",
    "end": "401120"
  },
  {
    "text": "backing this uh app or index b or part b",
    "start": "401120",
    "end": "406639"
  },
  {
    "text": "how would it look like right so it for the first call would be to core dns to get the uh",
    "start": "406639",
    "end": "413039"
  },
  {
    "text": "dns resolution uh if you're doing a http get using the",
    "start": "413039",
    "end": "418880"
  },
  {
    "text": "service discovery dns address then you'd need a cluster id",
    "start": "418880",
    "end": "423919"
  },
  {
    "text": "once you get that cluster ip you reach out to or on the packet",
    "start": "423919",
    "end": "429520"
  },
  {
    "text": "goes to iptables to look up which part it needs to get to so it it hits the ip",
    "start": "429520",
    "end": "434960"
  },
  {
    "text": "tables with the service id it translates over to a pod ip destination port ip and then it goes to the particular point and",
    "start": "434960",
    "end": "441919"
  },
  {
    "text": "on on on the way back contract and [Music] keeps track of these connections and",
    "start": "441919",
    "end": "448800"
  },
  {
    "text": "replaces the source destination ip accordingly and when it comes to north south you",
    "start": "448800",
    "end": "456080"
  },
  {
    "text": "have end points node ports and load balancers",
    "start": "456080",
    "end": "461199"
  },
  {
    "text": "either not this out can be either that the pod is trying to reach out to the internet uh or",
    "start": "462000",
    "end": "468400"
  },
  {
    "text": "in most cases what happens is a client is trying to connect to an application and service that you're running",
    "start": "468400",
    "end": "475120"
  },
  {
    "text": "uh how does that happen right so you have a load balancer service that you deploy within kubernetes you create a",
    "start": "475120",
    "end": "480560"
  },
  {
    "text": "load balancer object that backs your pods or your app",
    "start": "480560",
    "end": "485759"
  },
  {
    "text": "it goes through something called a node port so when a client tries to connect your app they hit the load balancer ip and",
    "start": "485759",
    "end": "493599"
  },
  {
    "text": "then it translates over selects one of the hosts that's part of your kubernetes",
    "start": "493599",
    "end": "498960"
  },
  {
    "text": "cluster either where the port is running or any of the other worker hosts it goes to that host through",
    "start": "498960",
    "end": "505520"
  },
  {
    "text": "the node port or a large high number port and from there on goes through cluster ip and then to the pond",
    "start": "505520",
    "end": "512640"
  },
  {
    "text": "so this is the basic working of east-west traffic and lots of traffic within kubernetes again this is",
    "start": "512640",
    "end": "519599"
  },
  {
    "text": "a this was a very short kubernetes networking introduction so",
    "start": "519599",
    "end": "525040"
  },
  {
    "text": "with that uh let's start looking at what problems can exist right within kubernetes",
    "start": "525040",
    "end": "532000"
  },
  {
    "start": "531000",
    "end": "697000"
  },
  {
    "text": "so the way i see it when you have a networking issue it's good to think about it and do two terms or two ways uh",
    "start": "532000",
    "end": "539760"
  },
  {
    "text": "one is think about the the impact right so what kind of an outage is it is it a complete service",
    "start": "539760",
    "end": "546720"
  },
  {
    "text": "impact or is it partial outage or is it negated performance so plays the",
    "start": "546720",
    "end": "552399"
  },
  {
    "text": "problem that you see in one of these three buckets uh it helps here right because if it's a",
    "start": "552399",
    "end": "558880"
  },
  {
    "text": "complete service outage that means and if you have multiple parts backing your service that",
    "start": "558880",
    "end": "564480"
  },
  {
    "text": "means that either there is a problem with your app or service or there is something",
    "start": "564480",
    "end": "570320"
  },
  {
    "text": "critically wrong within the kubernetes cluster it's a larger problem whereas if it's a",
    "start": "570320",
    "end": "575680"
  },
  {
    "text": "partial outage that means maybe few parts in your of your service isn't working",
    "start": "575680",
    "end": "581360"
  },
  {
    "text": "um that's that's a lot more localized that's mainly your app",
    "start": "581360",
    "end": "587040"
  },
  {
    "text": "or even if it's the subsystem it has something to do with specificity of that particular one app degradation",
    "start": "587040",
    "end": "593440"
  },
  {
    "text": "performance is the most difficult uh problem to debug and fix as you can see",
    "start": "593440",
    "end": "600240"
  },
  {
    "text": "the difficulty of debugging kind of increases when you start moving towards your right",
    "start": "600240",
    "end": "605760"
  },
  {
    "text": "and debugging performance is difficult we'll see what tools are there and how to do it um",
    "start": "605760",
    "end": "611519"
  },
  {
    "text": "but it's always good to classify your problem in these two aspects one is the",
    "start": "611519",
    "end": "617440"
  },
  {
    "text": "impact severity or class type i call it the other one is where this problem is occurring right or what type of problem",
    "start": "617440",
    "end": "624160"
  },
  {
    "text": "it is it could be an application problem which means that your application isn't",
    "start": "624160",
    "end": "629600"
  },
  {
    "text": "working and what you could do there right so some of the things that people end up",
    "start": "629600",
    "end": "634640"
  },
  {
    "text": "doing is look at logs to see if there are errors in your app maybe there was a code problem",
    "start": "634640",
    "end": "641120"
  },
  {
    "text": "the process crashed file descriptors run out or if the app",
    "start": "641120",
    "end": "646560"
  },
  {
    "text": "was just doing so much and running out of cpu or memory now let's look at uh the other one could",
    "start": "646560",
    "end": "652880"
  },
  {
    "text": "be platform components right so this is where a problem within the kubernetes subsystem happens",
    "start": "652880",
    "end": "660240"
  },
  {
    "text": "dns load balancer q proxy service there could be some kind of a problem",
    "start": "660240",
    "end": "665519"
  },
  {
    "text": "happening uh somewhere there you're not able to get dns access or load balancer",
    "start": "665519",
    "end": "671600"
  },
  {
    "text": "there could be a configuration problem which is the third type or third bucket which is very common uh in my experience",
    "start": "671760",
    "end": "678240"
  },
  {
    "text": "there is a problem in mtu settings somewhere across from your source to a destination that's",
    "start": "678240",
    "end": "684160"
  },
  {
    "text": "causing an issue or there are route routing issues or there is an ip",
    "start": "684160",
    "end": "689839"
  },
  {
    "text": "overflow just simply that your part is not able to get an ip address and it just fails coming up",
    "start": "689839",
    "end": "697200"
  },
  {
    "start": "697000",
    "end": "840000"
  },
  {
    "text": "now how do people resolve these right",
    "start": "697519",
    "end": "702680"
  },
  {
    "text": "this is a good uh segue to what do you do today without any of the debugging tools right",
    "start": "702959",
    "end": "709279"
  },
  {
    "text": "uh the first one is the big hammer approach um what that means is there are two ways",
    "start": "709279",
    "end": "715839"
  },
  {
    "text": "of how people fix it one is by just hammering the part or the deployment of the service or the english just kill it",
    "start": "715839",
    "end": "722560"
  },
  {
    "text": "right and let kubernetes do the job uh we spin it up or reschedule it on a",
    "start": "722560",
    "end": "727839"
  },
  {
    "text": "different node and everything starts working magically cloud native",
    "start": "727839",
    "end": "732959"
  },
  {
    "text": "architectures are meant to do that are meant to kind of have",
    "start": "732959",
    "end": "738399"
  },
  {
    "text": "failures be tolerated uh but then it may not be as feasible for state collapse or it takes longer to",
    "start": "738399",
    "end": "745440"
  },
  {
    "text": "figure out i've also seen people do this where they go ahead and delete the node if there's",
    "start": "745440",
    "end": "752399"
  },
  {
    "text": "a problem in the node with multiple apps and rather than fixing it it might just be easier and quicker to delete it",
    "start": "752399",
    "end": "758880"
  },
  {
    "text": "especially if the kubernetes cluster is running in the cloud just delete it and let aws or google or",
    "start": "758880",
    "end": "764560"
  },
  {
    "text": "azure kind of recreate that vm for you if it's in the scale set",
    "start": "764560",
    "end": "769760"
  },
  {
    "text": "the other one that actually works most cases is asking for help",
    "start": "769760",
    "end": "775920"
  },
  {
    "text": "that's always great even there right knowing which component to ask help for",
    "start": "775920",
    "end": "782240"
  },
  {
    "text": "goes a long way so if you know that there's a problem with calico you know there's a problem with flannel or the",
    "start": "782240",
    "end": "787360"
  },
  {
    "text": "cni vacuum or if you know there's a problem with cube proxy you get to be able to reach those specific",
    "start": "787360",
    "end": "793600"
  },
  {
    "text": "groups and people are very helpful so slack or github you'll be able to get help",
    "start": "793600",
    "end": "799680"
  },
  {
    "text": "there or i've seen this happen too where people",
    "start": "799680",
    "end": "805120"
  },
  {
    "text": "find a hard networking problem and they revert back to saying hey let's just use",
    "start": "805120",
    "end": "811519"
  },
  {
    "text": "vms or not containerize it or you run it outside of kubernetes or just not use a",
    "start": "811519",
    "end": "817600"
  },
  {
    "text": "load balancer or an english and let's keep it simple and do something differently so that happens quite a bit",
    "start": "817600",
    "end": "822720"
  },
  {
    "text": "too uh for people who are a lot more uh excited and a lot more uh",
    "start": "822720",
    "end": "829519"
  },
  {
    "text": "exploring they try to troubleshoot live setups and",
    "start": "829519",
    "end": "834959"
  },
  {
    "text": "manually and that's where today's talk should help",
    "start": "834959",
    "end": "841040"
  },
  {
    "start": "840000",
    "end": "1232000"
  },
  {
    "text": "now uh troubleshooting workflow right um",
    "start": "841519",
    "end": "848160"
  },
  {
    "text": "this is an interesting topic so what i wanted to do here was to put whatever i've seen",
    "start": "848160",
    "end": "854959"
  },
  {
    "text": "out in the field with respect to problems and how i've gone about solving a problem and how",
    "start": "854959",
    "end": "860800"
  },
  {
    "text": "i built cades network to start looking at it in an automated way so the first",
    "start": "860800",
    "end": "866240"
  },
  {
    "text": "thing that i say is if there's a problem uh then uh",
    "start": "866240",
    "end": "872399"
  },
  {
    "text": "see what the problem is right if if a part is crashing it's it's a lot more obvious but then if everything is",
    "start": "872399",
    "end": "878880"
  },
  {
    "text": "working but you still don't have communication it's a lot more harder to do so see if there are other apps down uh",
    "start": "878880",
    "end": "885839"
  },
  {
    "text": "more often than not there are other apps that aren't working which means that it's not localized to your app it could",
    "start": "885839",
    "end": "891279"
  },
  {
    "text": "be more than one app it could be specific to a node and if it's specific to a node then",
    "start": "891279",
    "end": "896800"
  },
  {
    "text": "it's probably the subsystem or the kubernetes components that might be causing an issue",
    "start": "896800",
    "end": "902720"
  },
  {
    "text": "if it isn't then if it's an app specific problem first would be to rule out your app",
    "start": "902720",
    "end": "907760"
  },
  {
    "text": "itself look for logs look for help metrics in all of these cases right if you have",
    "start": "907760",
    "end": "913040"
  },
  {
    "text": "prometheus the fauna set up have time series data being pulled in it's it's a lot better",
    "start": "913040",
    "end": "919600"
  },
  {
    "text": "there's a cube metrics service which gives you node statistics there's a node exporter there",
    "start": "919600",
    "end": "925680"
  },
  {
    "text": "are a bunch of tools out there that allow you to monitor your kubernetes cluster",
    "start": "925680",
    "end": "930800"
  },
  {
    "text": "um again let me put a warning on that in a lot of cases i've seen network",
    "start": "930800",
    "end": "936720"
  },
  {
    "text": "policy within the kubernetes cluster cause issues i've seen firewall causing issues outside in your",
    "start": "936720",
    "end": "942720"
  },
  {
    "text": "environment which means external traffic uh does not come in or go out and then search or tls causing issues",
    "start": "942720",
    "end": "949199"
  },
  {
    "text": "which could be either mtu or again firewall or just your app right",
    "start": "949199",
    "end": "955120"
  },
  {
    "text": "anyway now coming back to that flowchart uh if other apps are down then",
    "start": "955120",
    "end": "960399"
  },
  {
    "text": "look at your subsystem right either case",
    "start": "960399",
    "end": "965839"
  },
  {
    "text": "what we need to do is to identify the problem type of the class like i said is it partial complete",
    "start": "965839",
    "end": "971680"
  },
  {
    "text": "or a performance degradation problem in case of both partial and complete outage",
    "start": "971680",
    "end": "976800"
  },
  {
    "text": "what we do next is to see what type of traffic path the problem lies on",
    "start": "976800",
    "end": "982880"
  },
  {
    "text": "and here again we classified into three things one is east west and what i mean",
    "start": "982880",
    "end": "988079"
  },
  {
    "text": "by east west is applications within the communities cluster talking to each other somewhere there's a problem there",
    "start": "988079",
    "end": "993680"
  },
  {
    "text": "and that's normally through a kubernetes service the second one is",
    "start": "993680",
    "end": "999759"
  },
  {
    "text": "north south and and not south again can be divided into two",
    "start": "999759",
    "end": "1005279"
  },
  {
    "text": "which is part to external which means that the part is trying to",
    "start": "1005279",
    "end": "1010720"
  },
  {
    "text": "reach a uh object store or database server running",
    "start": "1010720",
    "end": "1015839"
  },
  {
    "text": "outside kubernetes or just for example if it's running in cloud it could be rds",
    "start": "1015839",
    "end": "1021839"
  },
  {
    "text": "um [Music] and then the other uh case is when clients are trying to",
    "start": "1021839",
    "end": "1028079"
  },
  {
    "text": "connect to your service that's running within the kubernetes customer from outside of your company's classroom either outside onto the internet or",
    "start": "1028079",
    "end": "1036240"
  },
  {
    "text": "from your intranet um whatever it may be right so",
    "start": "1036240",
    "end": "1041600"
  },
  {
    "text": "first figure that out uh and then if let's look at the east west case where there's a problem with apto app uh what",
    "start": "1041600",
    "end": "1048079"
  },
  {
    "text": "would you do right you would first run something like thing to see if",
    "start": "1048079",
    "end": "1054880"
  },
  {
    "text": "pod a of your app a is able to reach part b of your b right through ip",
    "start": "1054880",
    "end": "1061280"
  },
  {
    "text": "through a specific container if that doesn't work there's definitely a problem either in the overlay or the",
    "start": "1061280",
    "end": "1066480"
  },
  {
    "text": "overlay which is your cni backend you're now kind of localizing the problem",
    "start": "1066480",
    "end": "1073440"
  },
  {
    "text": "which is a very important step and then you'll be able to get help",
    "start": "1073440",
    "end": "1078559"
  },
  {
    "text": "the second one is if that works then look at dns uh try",
    "start": "1078559",
    "end": "1083679"
  },
  {
    "text": "uh pinging or reaching the destination service through dns you you can use pod",
    "start": "1083679",
    "end": "1089919"
  },
  {
    "text": "dns uh if that doesn't work there's probably a coordinate issue or again that could be an issue",
    "start": "1089919",
    "end": "1097200"
  },
  {
    "text": "or an overlay issue if that works too then look at cluster ip uh so if there's a service that's",
    "start": "1097200",
    "end": "1104240"
  },
  {
    "text": "backing your destination app then pick up the cluster ip for that",
    "start": "1104240",
    "end": "1110640"
  },
  {
    "text": "particular service and see if you're able to connect to that if that works again if that doesn't work it's q proxy",
    "start": "1110640",
    "end": "1117440"
  },
  {
    "text": "it could be a problem in ip table rules or it could just be the underlay",
    "start": "1117440",
    "end": "1123760"
  },
  {
    "text": "so the bubbles that i've put there is is where the problem class could could lie",
    "start": "1123760",
    "end": "1128799"
  },
  {
    "text": "which component and the the blue boxes are the ones that you would probably do manually to figure out if",
    "start": "1128799",
    "end": "1135600"
  },
  {
    "text": "the problem if that's exactly the problem and going down you would then look at uh",
    "start": "1135600",
    "end": "1140880"
  },
  {
    "text": "part to service dns name uh if that works then you'd look at np tables uh",
    "start": "1140880",
    "end": "1148720"
  },
  {
    "text": "ipvs admin if you're using ipvs for q proxy and then of course look at pathmt",
    "start": "1148720",
    "end": "1155039"
  },
  {
    "text": "if there's an if if the amount the size of the packet that's allowed on the network is",
    "start": "1155039",
    "end": "1161280"
  },
  {
    "text": "some size defined and if you're trying to send larger packets it's not going to go coming to north south you do similar uh",
    "start": "1161280",
    "end": "1170000"
  },
  {
    "text": "to add it to whatever you do in east west you also do auto gateway right so leaving the part it snaps out of the",
    "start": "1170000",
    "end": "1176640"
  },
  {
    "text": "node and gets to the gateway on your physical network and are you able to reach your gateway",
    "start": "1176640",
    "end": "1182559"
  },
  {
    "text": "first if yes then are you able to is is the path mtu fine again if that's",
    "start": "1182559",
    "end": "1188559"
  },
  {
    "text": "a s2 then maybe there's a problem between your gateway and your internet which means it could be a firewall",
    "start": "1188559",
    "end": "1196000"
  },
  {
    "text": "if that works too then check net rules iptable rules if there's if there's any problem there",
    "start": "1196000",
    "end": "1201600"
  },
  {
    "text": "more often than not i've seen flannel or calico if there isn't a rule uh present in in",
    "start": "1201600",
    "end": "1207840"
  },
  {
    "text": "iptables in that table that that tells that the packet that's leaving pod",
    "start": "1207840",
    "end": "1213280"
  },
  {
    "text": "busting to external to the node needs to be matted out it's not going to work so that that's",
    "start": "1213280",
    "end": "1220400"
  },
  {
    "text": "another assumption and if all else fails you can always tcp dump and look at packets which is a lot more",
    "start": "1220400",
    "end": "1226559"
  },
  {
    "text": "complex so in interest of time quickly going",
    "start": "1226559",
    "end": "1232720"
  },
  {
    "start": "1232000",
    "end": "1395000"
  },
  {
    "text": "forward uh open source tools right so there are a bunch of open source tools",
    "start": "1232720",
    "end": "1239120"
  },
  {
    "text": "that you can use to figure out what where the problem lies",
    "start": "1239120",
    "end": "1244720"
  },
  {
    "text": "some of them that i've used or found helpful is net shoot net shoot is a docker image that essentially bundles",
    "start": "1244720",
    "end": "1252000"
  },
  {
    "text": "all of the binaries and programs that are useful to",
    "start": "1252000",
    "end": "1257120"
  },
  {
    "text": "debug tcp dump ipping hyper it even has",
    "start": "1257120",
    "end": "1263120"
  },
  {
    "text": "uh tools to look at just calls uh various counters performance metrics and",
    "start": "1263120",
    "end": "1268159"
  },
  {
    "text": "whatnot and this is useful because you may have an app that does not even have a shell and so how do you debug that",
    "start": "1268159",
    "end": "1275039"
  },
  {
    "text": "live app that's not working but then",
    "start": "1275039",
    "end": "1280320"
  },
  {
    "text": "you you need to be able to log into that pod to try it out right so let you can what you can do is run it shoot attach",
    "start": "1280320",
    "end": "1287039"
  },
  {
    "text": "it to that particular pod and then run commands as if you're running within",
    "start": "1287039",
    "end": "1293840"
  },
  {
    "text": "the network namespace and what k does netlook does or the way i've built it is",
    "start": "1293840",
    "end": "1299200"
  },
  {
    "text": "to do somewhat similar right so it's a binary you run it on the node",
    "start": "1299200",
    "end": "1304799"
  },
  {
    "text": "and you give it your on the node where the source part is running it's a source side debugging tool",
    "start": "1304799",
    "end": "1311280"
  },
  {
    "text": "and what it does is it runs a couple of things on the node to check if communication on the node and",
    "start": "1311280",
    "end": "1317600"
  },
  {
    "text": "configuration is fine and then what it does is it kind of goes or runs inside the pod network namespace",
    "start": "1317600",
    "end": "1325120"
  },
  {
    "text": "that you've specified and then runs as if it's running within the pod so you're able to see or figure out",
    "start": "1325120",
    "end": "1331919"
  },
  {
    "text": "problems within the part that actually has a problem",
    "start": "1331919",
    "end": "1337039"
  },
  {
    "text": "and the other way of debugging is by using probes or monitoring tools",
    "start": "1337039",
    "end": "1343600"
  },
  {
    "text": "so cubeners is a tool that deploys apps uh on",
    "start": "1343600",
    "end": "1349039"
  },
  {
    "text": "multiple boxes or nodes and then it talks to each other all of these agents or apps on each of",
    "start": "1349039",
    "end": "1356240"
  },
  {
    "text": "these nodes talk to each other and provide metrics in terms of communication path in terms of",
    "start": "1356240",
    "end": "1362240"
  },
  {
    "text": "performance so it's like a synthetic probe so it gives you information of whether the kubernetes cluster is",
    "start": "1362240",
    "end": "1368080"
  },
  {
    "text": "healthy whether the pod networking is healthy but it doesn't tell you if why your part is not working",
    "start": "1368080",
    "end": "1373840"
  },
  {
    "text": "because it could be that there are other apps running on the same note that's working and",
    "start": "1373840",
    "end": "1378880"
  },
  {
    "text": "you would still get a healthy result but your app might still be crashing so that's where k does not look",
    "start": "1378880",
    "end": "1384640"
  },
  {
    "text": "and net should to some extent comes into play okay checker is another probe based tool uh",
    "start": "1384640",
    "end": "1391440"
  },
  {
    "text": "it's not been updated for a long long time so i'll leave it as is what to use when right this is important",
    "start": "1391440",
    "end": "1397919"
  },
  {
    "start": "1395000",
    "end": "1434000"
  },
  {
    "text": "so again going back to the slide where we looked at problem classification and common problems what i did was",
    "start": "1397919",
    "end": "1404880"
  },
  {
    "text": "i put it put down what you would normally do when you saw such problems",
    "start": "1404880",
    "end": "1411760"
  },
  {
    "text": "and we've discussed this in the flowchart so i'm going to skip this slide very quickly but",
    "start": "1411760",
    "end": "1417440"
  },
  {
    "text": "for example if it's a complete outage then you're probably better off looking at continuous monitoring and looking at",
    "start": "1417440",
    "end": "1423679"
  },
  {
    "text": "probes yeah each of these links i'll share the five slides and each of these links will",
    "start": "1423679",
    "end": "1429200"
  },
  {
    "text": "take you to github repos where you get the app you'll be able to install it and play it play for yourself",
    "start": "1429200",
    "end": "1435200"
  },
  {
    "start": "1434000",
    "end": "1445000"
  },
  {
    "text": "um now for the automated way how do you do things in an",
    "start": "1435200",
    "end": "1440400"
  },
  {
    "text": "automated way right so that's where k test comes in so why k does net look what does it do",
    "start": "1440400",
    "end": "1446720"
  },
  {
    "start": "1445000",
    "end": "1548000"
  },
  {
    "text": "it is a standalone binary it it also has a docker image you can run",
    "start": "1446720",
    "end": "1451919"
  },
  {
    "text": "it within kubernetes but i prefer it to run outside of kubernetes because you",
    "start": "1451919",
    "end": "1457039"
  },
  {
    "text": "don't want to run a monitoring solution within the platform that may be having",
    "start": "1457039",
    "end": "1462320"
  },
  {
    "text": "an issue so it's an external uh to create as binary it",
    "start": "1462320",
    "end": "1468000"
  },
  {
    "text": "does source side debugging and it needs to be run on the node that runs the source pod",
    "start": "1468000",
    "end": "1474240"
  },
  {
    "text": "uh it imitates the pod as i as i spoke about earlier why did i do this",
    "start": "1474240",
    "end": "1480000"
  },
  {
    "text": "right because as you know networking is fundamentally hard to debug and and it is also",
    "start": "1480000",
    "end": "1486960"
  },
  {
    "text": "the network is unreliable and most issues need to be debugged by environments in the app that's causing",
    "start": "1486960",
    "end": "1492320"
  },
  {
    "text": "the issue and the aim of this tool is to make that network debugging easy and not have",
    "start": "1492320",
    "end": "1498480"
  },
  {
    "text": "people shy away from it or get started uh time is of the essence for debugging",
    "start": "1498480",
    "end": "1504400"
  },
  {
    "text": "things uh the problem might correct itself uh so knowing that there's a problem uh is important because",
    "start": "1504400",
    "end": "1510640"
  },
  {
    "text": "kubernetes is built to fix itself but then if there's a problem then it's good to",
    "start": "1510640",
    "end": "1515760"
  },
  {
    "text": "know about it because if it keeps compounding there might be a large scale downtime",
    "start": "1515760",
    "end": "1521840"
  },
  {
    "text": "uh automating a lot of those steps that you saw in on the flowchart one it's hard you might probably need to know",
    "start": "1521840",
    "end": "1527760"
  },
  {
    "text": "about some networking technology and tools the idea is with kds network you're able to automate that it is",
    "start": "1527760",
    "end": "1533200"
  },
  {
    "text": "automated so you're able to run it easily and then get some kind of uh feedback",
    "start": "1533200",
    "end": "1539679"
  },
  {
    "text": "essentially give you that self-service debugging and it's inspired by that note problem",
    "start": "1539679",
    "end": "1544799"
  },
  {
    "text": "detector that that's there in the github you should check that out uh what can it do today yeah it works",
    "start": "1544799",
    "end": "1550960"
  },
  {
    "start": "1548000",
    "end": "1606000"
  },
  {
    "text": "with ipv6 ipv4 stacks there are a bunch of checks that it runs",
    "start": "1550960",
    "end": "1556400"
  },
  {
    "text": "on the host side when it's running on the host network name space it runs connectivity check for the gateway api",
    "start": "1556400",
    "end": "1562159"
  },
  {
    "text": "server it runs if there are multiple api servers in a highly available cluster it checks all",
    "start": "1562159",
    "end": "1569039"
  },
  {
    "text": "of them when it comes to pods it again looks at gateway it looks like if it's",
    "start": "1569039",
    "end": "1574559"
  },
  {
    "text": "able to talk to the api server it does dns by looking at",
    "start": "1574559",
    "end": "1579679"
  },
  {
    "text": "dns lookup it also does pmto discovery which is a big one uh that i've seen causing issues",
    "start": "1579679",
    "end": "1586640"
  },
  {
    "text": "uh and it also looks like various uh ip endpoints for a service so if a service has 20 points that's backed by",
    "start": "1586640",
    "end": "1594240"
  },
  {
    "text": "it it's going to reach each of these 20 parts and see if everything's working because if there's a partial degradation",
    "start": "1594240",
    "end": "1600080"
  },
  {
    "text": "where you have 18 parts working out of 20 you want a tool to tell you that so this",
    "start": "1600080",
    "end": "1605360"
  },
  {
    "text": "tool will do that for you uh we'll quickly go to the demo i'm hoping i'll be able to give you five",
    "start": "1605360",
    "end": "1611679"
  },
  {
    "start": "1606000",
    "end": "1640000"
  },
  {
    "text": "minutes in the demo but what you will see in the demo is that uh there are three nodes uh two workers and uh",
    "start": "1611679",
    "end": "1619440"
  },
  {
    "text": "and a control pin node kt netlook binary is installed on all of the nodes and",
    "start": "1619440",
    "end": "1624720"
  },
  {
    "text": "there is a busy box part that i've deployed as well as the hostnames part which is my app",
    "start": "1624720",
    "end": "1631039"
  },
  {
    "text": "backed by a service printed by a service so let's quickly take a look at this",
    "start": "1631039",
    "end": "1638159"
  },
  {
    "text": "and switch to the demo so what you can see here uh is the",
    "start": "1638159",
    "end": "1644159"
  },
  {
    "text": "number of nodes and i have a bunch of containers running there but if you look at",
    "start": "1644159",
    "end": "1650559"
  },
  {
    "text": "get all minus wide you'll see that the hostnames app is",
    "start": "1650559",
    "end": "1657600"
  },
  {
    "text": "deployed busybox is deployed i have a service that's backing hostnames it's a",
    "start": "1657600",
    "end": "1662799"
  },
  {
    "text": "cluster ip service not load balancer and there's also traffic which you can",
    "start": "1662799",
    "end": "1668720"
  },
  {
    "text": "ignore so we'll see two cases here we'll mainly see east west communication and how kts network helps in in that",
    "start": "1668720",
    "end": "1676399"
  },
  {
    "text": "um and the first case we'll see is where the communication stops working uh",
    "start": "1676399",
    "end": "1682480"
  },
  {
    "text": "due to maybe say a network policy right so let's see um",
    "start": "1682480",
    "end": "1688640"
  },
  {
    "text": "if things are working fine now so what i'm going to do is i'm just going to run a",
    "start": "1688640",
    "end": "1693760"
  },
  {
    "text": "http get on the dns entry for my host name lab from my busy",
    "start": "1693760",
    "end": "1701520"
  },
  {
    "text": "box which is app a to app b and if you look at it it works and it gives you",
    "start": "1701520",
    "end": "1707799"
  },
  {
    "text": "k242k which is",
    "start": "1707799",
    "end": "1711840"
  },
  {
    "text": "one of the parts running that if you run the same command again you're going to get a",
    "start": "1713120",
    "end": "1718399"
  },
  {
    "text": "reply from another one so it seems to be working fine right and if you look at it",
    "start": "1718399",
    "end": "1724559"
  },
  {
    "text": "busy box is running on worker one so on worker one i have gds network",
    "start": "1724559",
    "end": "1731200"
  },
  {
    "text": "installed here so if i do a grand demo this is where my k doesn't network",
    "start": "1731200",
    "end": "1737360"
  },
  {
    "text": "binary is if i do a host and run it i'm going to get",
    "start": "1737360",
    "end": "1743120"
  },
  {
    "text": "a bunch of checks and it's what it's saying is my cluster",
    "start": "1743120",
    "end": "1749039"
  },
  {
    "text": "looks healthy everything looks good and you can run a debug command that gives",
    "start": "1749039",
    "end": "1754960"
  },
  {
    "text": "you more information of what it did and how did how it did all of these tests you can make it silent to get a",
    "start": "1754960",
    "end": "1763520"
  },
  {
    "text": "json blob in case you want to program it",
    "start": "1763520",
    "end": "1769120"
  },
  {
    "text": "now what we'll do right we'll we'll look at a case where we're trying to",
    "start": "1769120",
    "end": "1774559"
  },
  {
    "text": "uh there's a problem in the node and i'll do this by applying a network policy",
    "start": "1774559",
    "end": "1783440"
  },
  {
    "text": "that's basically going to deny all traffic right and now if i run",
    "start": "1783440",
    "end": "1789360"
  },
  {
    "text": "a pod check right let's see what happens",
    "start": "1789360",
    "end": "1794640"
  },
  {
    "text": "it's trying to run it",
    "start": "1794640",
    "end": "1797760"
  },
  {
    "text": "and it'll give you a result that says host checks are good but then it's not able to connect to the",
    "start": "1800159",
    "end": "1807440"
  },
  {
    "text": "destination card uh pmtu path mtu is also not working",
    "start": "1807440",
    "end": "1813039"
  },
  {
    "text": "uh let's look at the bug information so what's happening it's trying to run the destination part",
    "start": "1813039",
    "end": "1819840"
  },
  {
    "text": "connectivity check and it failed it's trying to run pmtu and it prints so",
    "start": "1819840",
    "end": "1825760"
  },
  {
    "text": "that's the result that you get let's remove this",
    "start": "1825760",
    "end": "1832360"
  },
  {
    "text": "happening yesterday and let's run the same test again",
    "start": "1836000",
    "end": "1842960"
  },
  {
    "text": "looks like things are back back to good so this tool kind of gives you or helps you",
    "start": "1843039",
    "end": "1848640"
  },
  {
    "text": "figure out what's going on right and you can see the debug it also tries various it does a binary search to get to the",
    "start": "1848640",
    "end": "1855679"
  },
  {
    "text": "right mtu and it tells you that there is a the path mtu is 1480 and things are",
    "start": "1855679",
    "end": "1862320"
  },
  {
    "text": "working so let's look at an mq problem next uh what i'm going to do is i'm going to do a cubicle exact minus i t",
    "start": "1862320",
    "end": "1870080"
  },
  {
    "text": "let's go into busy box",
    "start": "1870080",
    "end": "1875039"
  },
  {
    "text": "and change the mtu",
    "start": "1875360",
    "end": "1882240"
  },
  {
    "text": "to something bigger 15 1500 and 1500 is normal right",
    "start": "1883600",
    "end": "1889679"
  },
  {
    "text": "so it's the default size but then we are running an overlay",
    "start": "1889679",
    "end": "1897200"
  },
  {
    "text": "with calico in ipip mode so it is going to need 20 bytes for the x encapsulation",
    "start": "1897200",
    "end": "1903279"
  },
  {
    "text": "header so if i do this now let's see what happens",
    "start": "1903279",
    "end": "1909840"
  },
  {
    "text": "connectivity check works uh but something failed right so let's look at what failed pmtu check for",
    "start": "1910080",
    "end": "1916320"
  },
  {
    "text": "destination ip actually failed because it's not able to get things from",
    "start": "1916320",
    "end": "1922159"
  },
  {
    "text": "there and if you look at the pmt discovery it got",
    "start": "1922159",
    "end": "1927600"
  },
  {
    "text": "a reflection for one four to four bytes but it didn't get something for 1500.",
    "start": "1927600",
    "end": "1935480"
  },
  {
    "text": "so there you go now let's fix this again and fix it to 1480",
    "start": "1937360",
    "end": "1943760"
  },
  {
    "text": "and then run this again the mtu for destination is 1480 and",
    "start": "1943760",
    "end": "1950799"
  },
  {
    "text": "everything looks good we can do the same thing for external ip as well so",
    "start": "1950799",
    "end": "1956000"
  },
  {
    "text": "let let me say external ip let's try",
    "start": "1956000",
    "end": "1961279"
  },
  {
    "text": "1.1.1.1 more checks added to it and you can see",
    "start": "1961279",
    "end": "1966960"
  },
  {
    "text": "that the external ip connector it's a console works i have an issue on my laptop running",
    "start": "1966960",
    "end": "1972480"
  },
  {
    "text": "i'm running vagrant boxes on the laptop for this demo so if you if i try to use external ip8.8.8",
    "start": "1972480",
    "end": "1980880"
  },
  {
    "text": "that is an issue and you will see that with the tool",
    "start": "1980880",
    "end": "1988159"
  },
  {
    "text": "and that's pretty much for the demo uh you can run it as a docker container you can run it within kubernetes as an app",
    "start": "1988159",
    "end": "1995840"
  },
  {
    "text": "all of that information is present in uh in the github repo",
    "start": "1995840",
    "end": "2002080"
  },
  {
    "start": "2000000",
    "end": "2061000"
  },
  {
    "text": "with that i hope you've had a good session and learned something about kubernetes",
    "start": "2002080",
    "end": "2008080"
  },
  {
    "text": "networking looked at various problems that can happen within kubernetes when you're deploying pods or apps as well as",
    "start": "2008080",
    "end": "2015200"
  },
  {
    "text": "hopefully kds network will help you to get to that first level debugging",
    "start": "2015200",
    "end": "2021120"
  },
  {
    "text": "and at least finding out where the problem could could lie and then getting to the right people for fixing it",
    "start": "2021120",
    "end": "2027679"
  },
  {
    "text": "um as always looking for contributors there's a lot of things that needs to be",
    "start": "2027679",
    "end": "2032799"
  },
  {
    "text": "done the tool doesn't do any automation for the external report today it only does",
    "start": "2032799",
    "end": "2037840"
  },
  {
    "text": "search uh it's not cni aware today so we can do a lot more to that",
    "start": "2037840",
    "end": "2044320"
  },
  {
    "text": "so yeah anybody interested please do uh look at givea github reach reach out to",
    "start": "2044320",
    "end": "2050720"
  },
  {
    "text": "me on slack or github again the link is on on the first page",
    "start": "2050720",
    "end": "2056480"
  },
  {
    "text": "uh feedback for the session welcome and q a",
    "start": "2056480",
    "end": "2063040"
  }
]