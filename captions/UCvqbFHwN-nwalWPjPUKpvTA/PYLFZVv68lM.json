[
  {
    "start": "0",
    "end": "65000"
  },
  {
    "text": "yeah hello welcome and thank you for coming along to extending Cuba Nettie's",
    "start": "390",
    "end": "6569"
  },
  {
    "text": "what the Doc's don't tell you funnily I wrote this well I read this title a few",
    "start": "6569",
    "end": "11910"
  },
  {
    "text": "months ago and the doctor didn't tell you a lot of this stuff then we're gradually getting better at actually documenting some of this stuff so you",
    "start": "11910",
    "end": "17550"
  },
  {
    "text": "might be able to find some bits in the documentation now you should anyway",
    "start": "17550",
    "end": "22619"
  },
  {
    "text": "complain us if not so yeah Who am I oh a",
    "start": "22619",
    "end": "28680"
  },
  {
    "text": "jet stack so I'm from a uk-based Cuban FTS consultancy we do a lot of well a",
    "start": "28680",
    "end": "35309"
  },
  {
    "text": "lot of deployments for a lot of different customers of Cuba Nettie's and kind of accelerating their journeys a cloud native as it were oz words we",
    "start": "35309",
    "end": "44520"
  },
  {
    "text": "write a lot of API extensions so this is with custom resources API vacations so on yeah so yeah I'm a software engineer",
    "start": "44520",
    "end": "54379"
  },
  {
    "text": "solutions engineer at jet stack sorry and yeah I've been using Cuban it's",
    "start": "54379",
    "end": "59670"
  },
  {
    "text": "quite a long while and all this new extension stuff is really exciting so",
    "start": "59670",
    "end": "65700"
  },
  {
    "start": "65000",
    "end": "157000"
  },
  {
    "text": "first of all like what is all of this and why do it yeah kubernetes has got a",
    "start": "65700",
    "end": "72689"
  },
  {
    "text": "really nicely formed API I think it has its problems occasionally I'm sure many",
    "start": "72689",
    "end": "78570"
  },
  {
    "text": "of you know run into issues at points but you know it's relatively consistent between types you interact with",
    "start": "78570",
    "end": "84390"
  },
  {
    "text": "everything in a similar way you create your manifest it's all nice and declarative and things eventually happen",
    "start": "84390",
    "end": "90329"
  },
  {
    "text": "they converge we have things like versioning although occasionally there",
    "start": "90329",
    "end": "96090"
  },
  {
    "text": "have been historically some problems with this you know we can release v2 of an API and automatically migrate your",
    "start": "96090",
    "end": "103640"
  },
  {
    "text": "applications across everything works fine you don't have to upgrade everything at once and that's versioning",
    "start": "103640",
    "end": "110659"
  },
  {
    "text": "it's got a lot of tooling for building all of these reconciliation loops so you probably hear a hell of a",
    "start": "110659",
    "end": "116759"
  },
  {
    "text": "lot this desired versus actual state in kubernetes yeah the kubernetes project",
    "start": "116759",
    "end": "122969"
  },
  {
    "text": "itself has a lot of code helpers utilities to actually help building all of this and of course we've got the CLI",
    "start": "122969",
    "end": "130259"
  },
  {
    "text": "we all know and love cube CTL yeah so we have a lot of things",
    "start": "130259",
    "end": "138070"
  },
  {
    "text": "in the project and we can kind of reuse all of this you know it's all well and good writing your own and sometimes it",
    "start": "138070",
    "end": "144100"
  },
  {
    "text": "does make sense but it would be nice if we can kind of integrate this as part of the standard experience that we've all come to know but it is hard to do that",
    "start": "144100",
    "end": "153400"
  },
  {
    "text": "yourself so we can piggyback we can extend yeah there's a number of examples",
    "start": "153400",
    "end": "160090"
  },
  {
    "start": "157000",
    "end": "182000"
  },
  {
    "text": "of this out there I mean the NCD operator was probably one of the first things I remember hearing about but now",
    "start": "160090",
    "end": "166180"
  },
  {
    "text": "even the kubernetes project itself large parts of it are implemented through extensions yeah and gradually more and",
    "start": "166180",
    "end": "174640"
  },
  {
    "text": "more obviously this whole track all day is about this it's it's becoming a big big deal extending Cuba Nettie's and it",
    "start": "174640",
    "end": "183040"
  },
  {
    "text": "lets us do things like this I think this is kind of in my mind the most basic way",
    "start": "183040",
    "end": "188890"
  },
  {
    "text": "of looking to it you can just integrate immediately and start getting and posting a resource and I'm sure a lot of",
    "start": "188890",
    "end": "194320"
  },
  {
    "text": "you probably already know this and given you are here so yeah it's this control",
    "start": "194320",
    "end": "202150"
  },
  {
    "start": "198000",
    "end": "219000"
  },
  {
    "text": "loop pattern that we see in kubernetes this is the way that kind of you can",
    "start": "202150",
    "end": "207370"
  },
  {
    "text": "start really getting into it and writing your own it's you want to follow kind of",
    "start": "207370",
    "end": "213610"
  },
  {
    "text": "the standards that we've come to use throughout and yeah why we get things",
    "start": "213610",
    "end": "222100"
  },
  {
    "start": "219000",
    "end": "258000"
  },
  {
    "text": "out of the box when we do it this way we get our back authorization all of this it can all be folded into our types we",
    "start": "222100",
    "end": "228760"
  },
  {
    "text": "don't need to reinvent authorization we can do this all with the standard cuba Nettie's native tooling we've got you",
    "start": "228760",
    "end": "234940"
  },
  {
    "text": "can go and create a role binding a role that works and operates on your types and mean that's pretty powerful it seems",
    "start": "234940",
    "end": "241840"
  },
  {
    "text": "might seem insignificant initially but you know as you start to grow you don't want 20 different authorization systems",
    "start": "241840",
    "end": "247989"
  },
  {
    "text": "and so you can start using extensions from all over writing your own and manage them all in the exact same way",
    "start": "247989",
    "end": "254590"
  },
  {
    "text": "and yeah that's that's pretty great and yeah to me it just kind of feels natural",
    "start": "254590",
    "end": "261310"
  },
  {
    "start": "258000",
    "end": "271000"
  },
  {
    "text": "you know cube CTL get my type that's great",
    "start": "261310",
    "end": "266400"
  },
  {
    "text": "so how do we actually do this though we've got custom resource definitions so",
    "start": "266400",
    "end": "273939"
  },
  {
    "start": "271000",
    "end": "310000"
  },
  {
    "text": "these are a nice quick easy way to add a new type we've all seen it I'm sure well",
    "start": "273939",
    "end": "281169"
  },
  {
    "text": "I hope anyway and then you know it's good it's quick it gets you up and running but there's a",
    "start": "281169",
    "end": "287379"
  },
  {
    "text": "few things we don't have with that we don't have the versioning that we just spoke of just yet admission control we kind of do have",
    "start": "287379",
    "end": "294580"
  },
  {
    "text": "these now with things like web hooks coming out we don't have defaulting on fields and",
    "start": "294580",
    "end": "301060"
  },
  {
    "text": "so on so if this isn't set then make it this we don't get that with CR DS right",
    "start": "301060",
    "end": "306219"
  },
  {
    "text": "now anyway and there's one other option which is custom api service so you've",
    "start": "306219",
    "end": "313180"
  },
  {
    "start": "310000",
    "end": "405000"
  },
  {
    "text": "probably seen cube aggregator being able to put something behind the standards sounded kubernetes api and have it act",
    "start": "313180",
    "end": "320560"
  },
  {
    "text": "as if it's part of you know cuba Nettie's core behind the scenes you're you've got proxies going roundabouts all",
    "start": "320560",
    "end": "326800"
  },
  {
    "text": "over the place but that complexity is hidden from the end-user to make a",
    "start": "326800",
    "end": "332289"
  },
  {
    "text": "custom API server though it's a bit more work we have to actually write our custom API server and yeah it's there's",
    "start": "332289",
    "end": "341409"
  },
  {
    "text": "a bit more of a learning curve and just you know keep CTL create my custom resource yeah but it is very similar to",
    "start": "341409",
    "end": "350379"
  },
  {
    "text": "how API is in kubernetes are already done you know the actual kubernetes api",
    "start": "350379",
    "end": "355839"
  },
  {
    "text": "server it's based on the same code that you can build your own API server from so you get a very very you know all of",
    "start": "355839",
    "end": "363339"
  },
  {
    "text": "these similarities are right there you get your admission control and everything else works as normal and we",
    "start": "363339",
    "end": "368589"
  },
  {
    "text": "can do things like versioning downside of this we do need to actually kind of persist some data somewhere we can no",
    "start": "368589",
    "end": "375250"
  },
  {
    "text": "longer just chuck it at the API server and it goes away we need EDD CD or the like well EDD",
    "start": "375250",
    "end": "380919"
  },
  {
    "text": "that's it right now to store this data it has to go somewhere so there's a",
    "start": "380919",
    "end": "386770"
  },
  {
    "text": "definitely more of an onus on your you know cluster administrators the people using your extensions they now need to",
    "start": "386770",
    "end": "394330"
  },
  {
    "text": "manage an EDD CD cluster or they need to open up their core one no security-wise might not be the wisest",
    "start": "394330",
    "end": "401040"
  },
  {
    "text": "yeah but it's a lot more flexible so that's my first tip is API aggregation",
    "start": "401040",
    "end": "407980"
  },
  {
    "start": "405000",
    "end": "418000"
  },
  {
    "text": "provides a far greater flexibility but",
    "start": "407980",
    "end": "413080"
  },
  {
    "text": "they both do require some supporting code that's supporting code however we",
    "start": "413080",
    "end": "419410"
  },
  {
    "start": "418000",
    "end": "592000"
  },
  {
    "text": "don't have to write all ourselves there's some bits we do and some bits we don't and I hope I really hope people",
    "start": "419410",
    "end": "426280"
  },
  {
    "text": "are aware of all the generators in the Kuban ''tis project sig api machinery do",
    "start": "426280",
    "end": "431460"
  },
  {
    "text": "absolutely great work putting all this together and it really is the you know",
    "start": "431460",
    "end": "436930"
  },
  {
    "text": "supporting it supports all of the kubernetes project I think anyway it you know everything works together and yeah",
    "start": "436930",
    "end": "445330"
  },
  {
    "text": "but this is the API this is a really cool piece and getting it right and consistently right between all of these",
    "start": "445330",
    "end": "451390"
  },
  {
    "text": "different API groups all these different versions is really important because if you had a bug in say one API groups",
    "start": "451390",
    "end": "458140"
  },
  {
    "text": "client that can get pretty difficult to track down so generating code in a consistent way",
    "start": "458140",
    "end": "463270"
  },
  {
    "text": "is important so a lot of you seen client go again I'd have thought and client go",
    "start": "463270",
    "end": "473500"
  },
  {
    "text": "ultimately at its core is a client set so you know it's a rest client and",
    "start": "473500",
    "end": "479110"
  },
  {
    "text": "introduces informers and Lister's and all of these other utilities fare building and extending against Kiva",
    "start": "479110",
    "end": "486370"
  },
  {
    "text": "Nettie's and we'll get into kind of what these things mean and do but this is well it's not just useful for building",
    "start": "486370",
    "end": "493200"
  },
  {
    "text": "extensions to call kubernetes types but it's kind of essential you could just do",
    "start": "493200",
    "end": "499810"
  },
  {
    "text": "it all through a rest client you know you can even do it with curl and bash but it's you end up with inconsistencies",
    "start": "499810",
    "end": "506560"
  },
  {
    "text": "and how everything works so when we're writing our own types we can generate these ourselves client go a large",
    "start": "506560",
    "end": "512919"
  },
  {
    "text": "majority of it is generated and we can do exactly the same and you can go from kind of nought to a project in 30",
    "start": "512919",
    "end": "519880"
  },
  {
    "text": "minutes once you get the hang of it and this is just a list I don't think this",
    "start": "519880",
    "end": "525460"
  },
  {
    "text": "is exhaustive this is a list of some of the generators you see so we've got client generators",
    "start": "525460",
    "end": "531050"
  },
  {
    "text": "generating that restclient you know nice typed go conversion generators so when",
    "start": "531050",
    "end": "536240"
  },
  {
    "text": "we need to do these breaking changes got deep copy generators which are it's more",
    "start": "536240",
    "end": "541580"
  },
  {
    "text": "of a technical thing here but you know if you want to just take a copy of the struct and start working on it again you",
    "start": "541580",
    "end": "546740"
  },
  {
    "text": "need deep copies defaulters as we've mentioned go to protobufs so we need to",
    "start": "546740",
    "end": "552380"
  },
  {
    "text": "generate some protobuf definitions for our go structures go to protobuf does that it's kind of weird because you'd",
    "start": "552380",
    "end": "558260"
  },
  {
    "text": "normally write your proto bar first and generate the go we don't do that with kubernetes yeah and some more we've got",
    "start": "558260",
    "end": "566149"
  },
  {
    "text": "informers Lister's so this is like a nice cache when you're writing your extensions you don't want to be hitting",
    "start": "566149",
    "end": "572060"
  },
  {
    "text": "the API server constantly for every single loop because it gets really expensive on the network as it doesn't",
    "start": "572060",
    "end": "579140"
  },
  {
    "text": "scale well yeah and a few more open API it's like the swagger specs we can",
    "start": "579140",
    "end": "585560"
  },
  {
    "text": "generate specifications for the types there so we write our types once and everything else just comes for free so",
    "start": "585560",
    "end": "592690"
  },
  {
    "start": "592000",
    "end": "617000"
  },
  {
    "text": "yeah to do this we write our types go file we",
    "start": "592690",
    "end": "598220"
  },
  {
    "text": "use comments to give it more information here so like telling it whether it's a",
    "start": "598220",
    "end": "604579"
  },
  {
    "text": "namespace tree source or not and so on and saying whether to generate a client for this particular structure and kind",
    "start": "604579",
    "end": "611420"
  },
  {
    "text": "of just hit run on the generators and off we go it's pretty convenient and pretty easy easy so yeah don't write",
    "start": "611420",
    "end": "619850"
  },
  {
    "text": "this code yourself I've seen a number of projects around where they have they've",
    "start": "619850",
    "end": "624950"
  },
  {
    "text": "either tried to write some parts of it I've never seen someone writing for me yet but hey maybe but yeh don't don't go",
    "start": "624950",
    "end": "634070"
  },
  {
    "text": "and write this yourself because honestly it's so much easier to generate it and it's so much more consistent it gives you the runway for the future too you",
    "start": "634070",
    "end": "640610"
  },
  {
    "text": "know you can generate it against the latest version of the generator and you keep up to date with the latest things",
    "start": "640610",
    "end": "645620"
  },
  {
    "text": "in cuba Nettie's so I've put together",
    "start": "645620",
    "end": "650649"
  },
  {
    "text": "example application kind of demonstrate all of this which is the API pager demo",
    "start": "650649",
    "end": "656269"
  },
  {
    "start": "652000",
    "end": "669000"
  },
  {
    "text": "I did this talk in London without the API server which you'll see soon and this is kind of an extension of it",
    "start": "656269",
    "end": "662480"
  },
  {
    "text": "so Zul on github under my name space you'll put the link up in a minute I think it's towards the end so it's a",
    "start": "662480",
    "end": "670189"
  },
  {
    "start": "669000",
    "end": "697000"
  },
  {
    "text": "small simple pager for Cuba Nettie's this is not something no to go and use",
    "start": "670189",
    "end": "675259"
  },
  {
    "text": "as a pager in Cuba Nettie's really I guess you create an alert resource in",
    "start": "675259",
    "end": "680629"
  },
  {
    "text": "the API server and you get alerts from pushbullet if anyone knows pushbullet",
    "start": "680629",
    "end": "686269"
  },
  {
    "text": "it's a little paging application and yeah here's the link I did put on there so I'll quickly show you that running",
    "start": "686269",
    "end": "695089"
  },
  {
    "text": "just so we're all on the same page so I've got a cluster this is me making sure the internet works first yeah so",
    "start": "695089",
    "end": "703579"
  },
  {
    "start": "697000",
    "end": "725000"
  },
  {
    "text": "I've got a cluster a gku cluster and I've written a helm chat for this pager",
    "start": "703579",
    "end": "709240"
  },
  {
    "text": "there we go cool and you can see there we've deployed our",
    "start": "709240",
    "end": "715699"
  },
  {
    "text": "service accounts our vac roles and our controller and API server so when I go get pods in the pager namespace just",
    "start": "715699",
    "end": "723319"
  },
  {
    "text": "probably bump this up slightly we can see here now we've got our API server",
    "start": "723319",
    "end": "730220"
  },
  {
    "start": "725000",
    "end": "760000"
  },
  {
    "text": "and controller running we can see here we'll see a lot of things we can see",
    "start": "730220",
    "end": "735889"
  },
  {
    "text": "we've actually registered this with the cube aggregator soo here we go v1 l4",
    "start": "735889",
    "end": "741290"
  },
  {
    "text": "one-pager Kate scope and now I can say cube CTL get alerts there's nothing",
    "start": "741290",
    "end": "747470"
  },
  {
    "text": "there but it is we didn't get an error saying you can't find the type and go ahead know create - Jeff Docs I'm creating a",
    "start": "747470",
    "end": "759110"
  },
  {
    "text": "dirt and shirt on my phone you can see there we've got an alert come through",
    "start": "759110",
    "end": "765879"
  },
  {
    "start": "760000",
    "end": "771000"
  },
  {
    "text": "yeah I really hate that bit because my face appears very very big on the screen and cool so that's lost my slides",
    "start": "765879",
    "end": "775540"
  },
  {
    "start": "771000",
    "end": "780000"
  },
  {
    "text": "watching keynote earlier I thought I closed all my windows clearly not here",
    "start": "775540",
    "end": "780860"
  },
  {
    "text": "we go so yeah that's the pager that's what we're working with right here so",
    "start": "780860",
    "end": "786110"
  },
  {
    "start": "785000",
    "end": "795000"
  },
  {
    "text": "what have I used to do this I've used the client generator conversion generator deep caca generator Informer",
    "start": "786110",
    "end": "791779"
  },
  {
    "text": "and Lister so what is all of this so",
    "start": "791779",
    "end": "797449"
  },
  {
    "start": "795000",
    "end": "839000"
  },
  {
    "text": "first we've defined like this so we have our type alert we've got our standard metadata blocks",
    "start": "797449",
    "end": "803770"
  },
  {
    "text": "type metadata and then a spec and a status just like you see with other cuba",
    "start": "803770",
    "end": "808840"
  },
  {
    "text": "Nettie's types this is a really simple one we have our message as part of the spec and then the status at the end of",
    "start": "808840",
    "end": "815440"
  },
  {
    "text": "AIDS yeah and the status just records a boolean which is whether or not the message has already been sent because",
    "start": "815440",
    "end": "821350"
  },
  {
    "text": "these types will persist in the API we have a declarative API in kubernetes they don't just go away afterwards we",
    "start": "821350",
    "end": "827590"
  },
  {
    "text": "could delete them maybe that gets a bit racy there potentially so yeah we've",
    "start": "827590",
    "end": "833320"
  },
  {
    "text": "defined these types there's some extra comments that go in here and we'll see those in a second and then we run the generators so follow the rules with",
    "start": "833320",
    "end": "842050"
  },
  {
    "start": "839000",
    "end": "872000"
  },
  {
    "text": "these generators if anyone's used them already you might have run into random panics you might have not got the code",
    "start": "842050",
    "end": "848830"
  },
  {
    "text": "you want at the end you have to follow the rules and these work they're their",
    "start": "848830",
    "end": "854020"
  },
  {
    "text": "depth they're documented in I think the client go repository there's a few",
    "start": "854020",
    "end": "859120"
  },
  {
    "text": "different places we've got some links at the end so send you out there so you can go in with yourself but yeah you do need",
    "start": "859120",
    "end": "865510"
  },
  {
    "text": "to follow the rules I've tried to fight it it's hours wasted basically yeah so",
    "start": "865510",
    "end": "873040"
  },
  {
    "start": "872000",
    "end": "889000"
  },
  {
    "text": "client generator first of all what does that give us things like this our client page of V 1 alpha 1 dot alerts and then",
    "start": "873040",
    "end": "880180"
  },
  {
    "text": "namespace and we can do an update and under the hood that's hitting a REST API and it's actually going to go and",
    "start": "880180",
    "end": "886000"
  },
  {
    "text": "perform this update for us in form a generator so I don't know how many",
    "start": "886000",
    "end": "892270"
  },
  {
    "start": "889000",
    "end": "931000"
  },
  {
    "text": "people are using Informers right now but you want to know when something in your API server has changed that is the core",
    "start": "892270",
    "end": "898330"
  },
  {
    "text": "of this reconciliation they desired and actual so here we add an event handler",
    "start": "898330",
    "end": "903450"
  },
  {
    "text": "and we say when something has been added when a new resource is added we queue it",
    "start": "903450",
    "end": "909400"
  },
  {
    "text": "to be processed when it's updated we do a quick check to see if it's actually changed because there's not a guarantee",
    "start": "909400",
    "end": "915970"
  },
  {
    "text": "of you know once only once delivery here this can be called multiple times multiple times which is why you have to",
    "start": "915970",
    "end": "921580"
  },
  {
    "text": "always look at the desired and the actual state of the world and writing these and a simple delete function as",
    "start": "921580",
    "end": "927070"
  },
  {
    "text": "well so responding to your resource going away conversion generator now this is an",
    "start": "927070",
    "end": "933500"
  },
  {
    "start": "931000",
    "end": "978000"
  },
  {
    "text": "exciting one I think if you get excited about api's and maintenance so this is",
    "start": "933500",
    "end": "940100"
  },
  {
    "text": "one example say we've written our v1 of our elasticsearch cluster resource type and we thought we could just have a",
    "start": "940100",
    "end": "945860"
  },
  {
    "text": "simple you know three data nodes three ingest nodes so on and we want to change that to something more like what we see",
    "start": "945860",
    "end": "952459"
  },
  {
    "text": "on the right conversions allow us to do this without causing massive problems for our users the users can still go and",
    "start": "952459",
    "end": "959510"
  },
  {
    "text": "create the old resource type and everything continues working with the next bit and that's like super powerful",
    "start": "959510",
    "end": "965029"
  },
  {
    "text": "it means you can more confidently push out an API and get users using it without thinking that you're gonna go",
    "start": "965029",
    "end": "971149"
  },
  {
    "text": "and break everything next week when you realize that you've done something wrong and will see an example this in a minute",
    "start": "971149",
    "end": "977800"
  },
  {
    "text": "so let's actually take a look at some of this code quickly first I did say it's a",
    "start": "977800",
    "end": "983510"
  },
  {
    "text": "bit of a technical talk so this is the repository here yeah I've already linked",
    "start": "983510",
    "end": "991880"
  },
  {
    "start": "984000",
    "end": "1140000"
  },
  {
    "text": "to it and you can see this is a very very simple controller and if I jump into it I'll have to talk you through it",
    "start": "991880",
    "end": "999230"
  },
  {
    "text": "we can see here the actual creating our Informer so we grab an informer here",
    "start": "999230",
    "end": "1004420"
  },
  {
    "text": "from our shared informer Factory now this allows us to build multiple",
    "start": "1004420",
    "end": "1009670"
  },
  {
    "text": "different control loops that all use these same types and not kind of have to watch 20 times it's only one there's a",
    "start": "1009670",
    "end": "1016510"
  },
  {
    "text": "nice big shared cache but we here we just add our new function so in queue",
    "start": "1016510",
    "end": "1021959"
  },
  {
    "text": "update delete and so on and the reason why we actually in queue things we don't",
    "start": "1021959",
    "end": "1027548"
  },
  {
    "text": "directly do stuff here instead of we don't like to send the notification immediately we have a work queue internally to the application and this",
    "start": "1027549",
    "end": "1034780"
  },
  {
    "text": "is all part of client go you can see just a little bit further down you can see that we're actually reading messages",
    "start": "1034780",
    "end": "1042160"
  },
  {
    "text": "off of a queue periodically we have like a one two three four workers and that",
    "start": "1042160",
    "end": "1047438"
  },
  {
    "text": "prevents that stops you having to where it stops you processing the same item twice at the same time which is quite a",
    "start": "1047439",
    "end": "1054130"
  },
  {
    "text": "big thing you know you don't want to be otherwise I could end up getting two alerts instead of one just just then",
    "start": "1054130",
    "end": "1060040"
  },
  {
    "text": "when I sent that and it does a number of other things too it goes on and going",
    "start": "1060040",
    "end": "1067510"
  },
  {
    "text": "into it there's a little bit of logic here with pushbullet where we're actually sending the message and yeah",
    "start": "1067510",
    "end": "1073450"
  },
  {
    "text": "then our message goes out and we set",
    "start": "1073450",
    "end": "1078720"
  },
  {
    "text": "scent you can see here in our sync function so our sync function is called each time",
    "start": "1078810",
    "end": "1085120"
  },
  {
    "text": "that a message is read our resources right off of the queue and the first thing we do is check to see if it's already been sent and if it's already",
    "start": "1085120",
    "end": "1091300"
  },
  {
    "text": "been sent we can just kind of return nil here we don't error we're done there's nothing more to do otherwise we prepare",
    "start": "1091300",
    "end": "1098350"
  },
  {
    "text": "our new message and we go and post this note and that's how it gets through to",
    "start": "1098350",
    "end": "1104380"
  },
  {
    "text": "my phone so it's pretty simple there and at the end here if we have just sent the",
    "start": "1104380",
    "end": "1110920"
  },
  {
    "text": "message we now need to actually mark it as sent in the status so we set sent",
    "start": "1110920",
    "end": "1116170"
  },
  {
    "text": "here and this is where the deep copy comes in because a minute ago I mentioned this shared cache well we",
    "start": "1116170",
    "end": "1121990"
  },
  {
    "text": "don't want to modify resources in that shared cache because it can cause all kinds of inconsistencies so we use the",
    "start": "1121990",
    "end": "1127690"
  },
  {
    "text": "deep coffee function here which was automatically generated by the deep coffee gen and then modify our resource",
    "start": "1127690",
    "end": "1133960"
  },
  {
    "text": "and then called update great so where",
    "start": "1133960",
    "end": "1139030"
  },
  {
    "text": "does the API server come into this well yeah sorry first of all that tip don't",
    "start": "1139030",
    "end": "1145450"
  },
  {
    "start": "1140000",
    "end": "1159000"
  },
  {
    "text": "modify resources in the cache bad things can happen and you probably won't see the bad things happening for quite a",
    "start": "1145450",
    "end": "1151690"
  },
  {
    "text": "while and then they suddenly will and you won't know why and yeah it's not good not good",
    "start": "1151690",
    "end": "1158880"
  },
  {
    "start": "1159000",
    "end": "1181000"
  },
  {
    "text": "cool so I was talking about these conversions so creating the new version",
    "start": "1159270",
    "end": "1164380"
  },
  {
    "text": "of our API v1 beta one so I'm you know I've had a breakthrough I've realized",
    "start": "1164380",
    "end": "1170410"
  },
  {
    "text": "message isn't quite what I want I want content and I want a title field too so I'm going to launch my v1 beta one",
    "start": "1170410",
    "end": "1176410"
  },
  {
    "text": "version of the API yeah so jumping to",
    "start": "1176410",
    "end": "1183250"
  },
  {
    "text": "that just so you can see what I'm doing here this is our alpha version here I've got a cube con alert",
    "start": "1183250",
    "end": "1190210"
  },
  {
    "text": "and this is our beta version you can see the title has switched sorry we've added the title field and the field content",
    "start": "1190210",
    "end": "1197360"
  },
  {
    "text": "has changed so thanks to these conversions you know this is possible so",
    "start": "1197360",
    "end": "1203450"
  },
  {
    "start": "1203000",
    "end": "1272000"
  },
  {
    "text": "I can show you here our custom API server is able to actually if I can",
    "start": "1203450",
    "end": "1209720"
  },
  {
    "text": "remember no there we go so I found out I",
    "start": "1209720",
    "end": "1217429"
  },
  {
    "text": "can actually a request a specific version from the API just with this",
    "start": "1217429",
    "end": "1223160"
  },
  {
    "text": "command so you can put the full path in so cubes et I'll get alerts in a V 1 beta 1 format so first of all that's",
    "start": "1223160",
    "end": "1231440"
  },
  {
    "text": "that we can see we've got content and title set and now if I want to get this in alpha 1 format I can to just by",
    "start": "1231440",
    "end": "1240530"
  },
  {
    "text": "changing that there and you can see this same resource it's got the same UID everything's the same but the API server",
    "start": "1240530",
    "end": "1248299"
  },
  {
    "text": "can dynamically convert that for us so your old controller that is written against the alpha version of the API",
    "start": "1248299",
    "end": "1254750"
  },
  {
    "text": "will continue to work if someone's created something in the beta format so you get this kind of nice seamless",
    "start": "1254750",
    "end": "1260660"
  },
  {
    "text": "upgrade process you don't need to do everything all at once you know turn it off and then spin it all back up",
    "start": "1260660",
    "end": "1266480"
  },
  {
    "text": "it all happens for us so yeah I'll",
    "start": "1266480",
    "end": "1273020"
  },
  {
    "text": "quickly show you how these actual conversions are done because I think it's something you don't actually",
    "start": "1273020",
    "end": "1279710"
  },
  {
    "text": "there's a lot of complexity in Cuban Etta's itself and it really does make it",
    "start": "1279710",
    "end": "1284720"
  },
  {
    "text": "hard to see so here we have our conversions and we're basically a lot of",
    "start": "1284720",
    "end": "1290510"
  },
  {
    "text": "this can automatically be generated but some bits you know content to message a generator is never going to be able to work this out so we do have to help it",
    "start": "1290510",
    "end": "1297049"
  },
  {
    "text": "out here and tell it how to do it so if I just jump in start into the beta version here",
    "start": "1297049",
    "end": "1304910"
  },
  {
    "text": "we can see first of all we're converting the alert spec and we say out content",
    "start": "1304910",
    "end": "1310880"
  },
  {
    "start": "1305000",
    "end": "1321000"
  },
  {
    "text": "equals iNDOT message so it's a simple one equals the other we're just mapping these two fields together but how do we",
    "start": "1310880",
    "end": "1320150"
  },
  {
    "text": "manage that so there are external API versions and you'll see this in cube",
    "start": "1320150",
    "end": "1326330"
  },
  {
    "start": "1321000",
    "end": "1377000"
  },
  {
    "text": "Nettie's if you go into kate diag work sorry into the actual Cuba Nettie's repo you'll be able to see",
    "start": "1326330",
    "end": "1333290"
  },
  {
    "text": "we have external versions and we have internal versions well an internal version so the external ones the ones",
    "start": "1333290",
    "end": "1339410"
  },
  {
    "text": "that you actually see they're the ones that you can request and do things with whereas the internal API version is used",
    "start": "1339410",
    "end": "1344780"
  },
  {
    "text": "solely internally by the API server now that is kind of a basis for conversions",
    "start": "1344780",
    "end": "1350900"
  },
  {
    "text": "you don't write a conversion between v1 l4 1 and V 1 beta 1 you write a conversion between the internal version",
    "start": "1350900",
    "end": "1356690"
  },
  {
    "text": "and the alpha version and then the internal version and the beta version and back and the API server can then use",
    "start": "1356690",
    "end": "1362720"
  },
  {
    "text": "that internal version as kind of a way to go anywhere so if you need to go from V 1 alpha 1 to beta 2 V 1 or anything it",
    "start": "1362720",
    "end": "1370490"
  },
  {
    "text": "can just go from the external to the internal to whichever other external version you like and we can see that",
    "start": "1370490",
    "end": "1376820"
  },
  {
    "text": "here in the pager demo we have our internal version to find here there's a",
    "start": "1376820",
    "end": "1382130"
  },
  {
    "start": "1377000",
    "end": "1438000"
  },
  {
    "text": "few differences that you'll notice there's no JSON struct tags so if we go here we have all of this JSON that's",
    "start": "1382130",
    "end": "1389390"
  },
  {
    "text": "because we do actually convert this to Jason at some point but the internal version you don't and this is one of the",
    "start": "1389390",
    "end": "1395870"
  },
  {
    "text": "rules that you have to follow if you go and put some JSON tags here the",
    "start": "1395870",
    "end": "1401000"
  },
  {
    "text": "generator it doesn't even our nicely it just doesn't it doesn't do what you expect it to do it tries to make it in",
    "start": "1401000",
    "end": "1406430"
  },
  {
    "text": "an external internal version and things start to fall apart a little bit maybe that will get better I don't know and",
    "start": "1406430",
    "end": "1412010"
  },
  {
    "text": "you can see we actually have these tags we say gen client here so this is telling the client generator to go and",
    "start": "1412010",
    "end": "1417890"
  },
  {
    "text": "generate the client so yeah cool I've",
    "start": "1417890",
    "end": "1424910"
  },
  {
    "text": "jumped ahead there take a look we just did so you define conversions between",
    "start": "1424910",
    "end": "1430190"
  },
  {
    "text": "the external versions and the internal versions that's it never between the different external",
    "start": "1430190",
    "end": "1435890"
  },
  {
    "text": "versions so yeah kind of wrapping all",
    "start": "1435890",
    "end": "1442130"
  },
  {
    "start": "1438000",
    "end": "1513000"
  },
  {
    "text": "this up the API aggregation really is it makes it it's far more flexible you can",
    "start": "1442130",
    "end": "1448550"
  },
  {
    "text": "do a hell of a lot more with it when you start writing your admission controllers and so on so as a resource is submitted",
    "start": "1448550",
    "end": "1455000"
  },
  {
    "text": "to the API being able to change that or modify it manipulator or even reject it",
    "start": "1455000",
    "end": "1461690"
  },
  {
    "text": "you can get that with API aggregation obviously don't generate you don't write",
    "start": "1461690",
    "end": "1468139"
  },
  {
    "text": "your code by hand there's no need generate it and yeah",
    "start": "1468139",
    "end": "1474080"
  },
  {
    "text": "so following the rules not modifying the cash and defining your conversions between the different boats between the",
    "start": "1474080",
    "end": "1480559"
  },
  {
    "text": "external and the internal version so yeah this is a nice big slide with tons",
    "start": "1480559",
    "end": "1487639"
  },
  {
    "text": "of different things we've got Stefan actually sitting at the front here he's done a great blog post on all of these conversions and I'd highly recommend",
    "start": "1487639",
    "end": "1494720"
  },
  {
    "text": "sorry on all these generators I'd highly recommend taking a look if you're gonna be doing this but yeah and yeah that's",
    "start": "1494720",
    "end": "1504500"
  },
  {
    "text": "kind of wrapping up there I'll leave this up for a second longer because I know there's a lot of people in to capture this I'll be posting the slides",
    "start": "1504500",
    "end": "1511009"
  },
  {
    "text": "online so you better see but yeah thank you for watching and know if there's any",
    "start": "1511009",
    "end": "1516470"
  },
  {
    "start": "1513000",
    "end": "1672000"
  },
  {
    "text": "questions",
    "start": "1516470",
    "end": "1518799"
  },
  {
    "text": "do cogeneration and then can you run it in a previous version of criminalities",
    "start": "1522260",
    "end": "1527940"
  },
  {
    "text": "or does it have to be so the question was if you do cogeneration does it work with an older",
    "start": "1527940",
    "end": "1535230"
  },
  {
    "text": "version of kubernetes so it does work with an old version it does work with",
    "start": "1535230",
    "end": "1540720"
  },
  {
    "text": "older versions if you're a their remote API server is a different version you do",
    "start": "1540720",
    "end": "1546720"
  },
  {
    "text": "need to use the right version of the generators with the right version of the kubernetes api is it's like dependency pinning is important but yeah you can it",
    "start": "1546720",
    "end": "1555360"
  },
  {
    "text": "does work backwards yeah yep so the",
    "start": "1555360",
    "end": "1571679"
  },
  {
    "text": "question there is why did I do I think the reflect DP equal there I actually think you are right we recently",
    "start": "1571679",
    "end": "1577770"
  },
  {
    "text": "put together a sample controller and that was pointed out to me as well that we can just look at the resource version",
    "start": "1577770",
    "end": "1583290"
  },
  {
    "text": "instead and it's yeah it is more efficient because that update function called quite a lot yeah so so the",
    "start": "1583290",
    "end": "1614100"
  },
  {
    "text": "question there is does everything will have to be in one repository do we have to have our controller our API server",
    "start": "1614100",
    "end": "1620160"
  },
  {
    "text": "are tied together no you don't you know there's a certain amount of repository",
    "start": "1620160",
    "end": "1625320"
  },
  {
    "text": "infrastructure you need to make sure you've got to manage that but it's just the same as every other project there's nothing specific to this that enforces",
    "start": "1625320",
    "end": "1632040"
  },
  {
    "text": "it you could generate elsewhere yeah yeah the kubernetes project itself does",
    "start": "1632040",
    "end": "1638340"
  },
  {
    "text": "do that a number of layers of indirection yeah",
    "start": "1638340",
    "end": "1645980"
  },
  {
    "text": "it's right to save again why use the",
    "start": "1656420",
    "end": "1669380"
  },
  {
    "text": "like generated one sort of thing yeah so yeah you're right there is actually a generic shared Informer that you can use",
    "start": "1669380",
    "end": "1676980"
  },
  {
    "start": "1672000",
    "end": "2026000"
  },
  {
    "text": "I think it's just a generic shared index Informer the issues there is it's not a typed Informer ultimately your ad",
    "start": "1676980",
    "end": "1684809"
  },
  {
    "text": "function is still hit with like an interface type it's just it becomes kind",
    "start": "1684809",
    "end": "1691500"
  },
  {
    "text": "of harder to understand your code and read it straight away because you are just using some cache new shared index",
    "start": "1691500",
    "end": "1698040"
  },
  {
    "text": "Informer I think is the function and your shared Informer factory as well",
    "start": "1698040",
    "end": "1703110"
  },
  {
    "text": "that does rely upon like some typed generated typed informants but actually",
    "start": "1703110",
    "end": "1708809"
  },
  {
    "text": "under the hood to share in the shared informer factory does just return one of these kind of generic looking types and",
    "start": "1708809",
    "end": "1716010"
  },
  {
    "text": "the informer generator ultimately is generating you these factories that yeah",
    "start": "1716010",
    "end": "1721350"
  },
  {
    "text": "make easier I can quickly show you actually the output of that because it",
    "start": "1721350",
    "end": "1726420"
  },
  {
    "text": "is a bit of a confusing one because the Informer's it is a shared resource here",
    "start": "1726420",
    "end": "1731880"
  },
  {
    "text": "so ultimately it automatically the generator automatically writes this bit",
    "start": "1731880",
    "end": "1737910"
  },
  {
    "text": "for you so you can see we still have the cache new shared index Informer and then",
    "start": "1737910",
    "end": "1743040"
  },
  {
    "text": "this list function and watch function yeah this is written for you already",
    "start": "1743040",
    "end": "1748440"
  },
  {
    "text": "basically yeah it's ultimately the same",
    "start": "1748440",
    "end": "1754470"
  },
  {
    "text": "there but you don't get that nice shared cache well the shared list of informers",
    "start": "1754470",
    "end": "1760559"
  },
  {
    "text": "you can go get the same reference to the same Informer to safe watching two three four times",
    "start": "1760559",
    "end": "1767090"
  },
  {
    "text": "so yeah documentation in this area has been weak in the past and it's something",
    "start": "1780030",
    "end": "1787630"
  },
  {
    "text": "we're all trying to improve we actually had a meeting just yesterday to try and",
    "start": "1787630",
    "end": "1792640"
  },
  {
    "text": "get some more things together I think there's gonna be some blog posts on it we've got the sample controller",
    "start": "1792640",
    "end": "1797650"
  },
  {
    "text": "repository now I'm not sure if you've seen that it doesn't go enough into",
    "start": "1797650",
    "end": "1802930"
  },
  {
    "text": "depth I think on what each generator does and how and why but it does give you a bit of a blueprint to doing it",
    "start": "1802930",
    "end": "1809920"
  },
  {
    "text": "there is also a new like script which will eventually become a full binary",
    "start": "1809920",
    "end": "1815200"
  },
  {
    "text": "like an application which will take care of actually running the generators for you because they've all got different",
    "start": "1815200",
    "end": "1821440"
  },
  {
    "text": "Flags different arguments and so on so I think that said there's generate internal groups and generate external",
    "start": "1821440",
    "end": "1830560"
  },
  {
    "text": "groups I can't remember the exact name you can actually see just here I'm no",
    "start": "1830560",
    "end": "1836230"
  },
  {
    "text": "longer actually having to cool these generators myself I instead just call",
    "start": "1836230",
    "end": "1841240"
  },
  {
    "text": "the generate internal groups script from the code gen package tell it where to",
    "start": "1841240",
    "end": "1846370"
  },
  {
    "text": "generate the code into so PKG slash client and then we point to at my internal and actually the directory",
    "start": "1846370",
    "end": "1853150"
  },
  {
    "text": "containing my external files - and you can see we just give it a list of groups and versions to generate for so yep so",
    "start": "1853150",
    "end": "1865960"
  },
  {
    "text": "the way i'm yeah because i need the actual so this will comes from this Kate's - io / code generator package so",
    "start": "1865960",
    "end": "1874390"
  },
  {
    "text": "I basically vendor this and using my I think this is with Det I've basically",
    "start": "1874390",
    "end": "1879820"
  },
  {
    "text": "just got sorry I'm Tamil syntax highlighting in sublime I list these as",
    "start": "1879820",
    "end": "1885790"
  },
  {
    "text": "required packages and then I've got all of the dependency pinning below so just",
    "start": "1885790",
    "end": "1891250"
  },
  {
    "text": "making sure I stick to these versions there any more questions yeah",
    "start": "1891250",
    "end": "1899670"
  },
  {
    "text": "how do we validate the CR okay so this is actually one thing so by having this",
    "start": "1900760",
    "end": "1906800"
  },
  {
    "text": "API server and writing ourselves the API server is able to do that validation",
    "start": "1906800",
    "end": "1912110"
  },
  {
    "text": "automatically and that happens as part of the API server library that you've",
    "start": "1912110",
    "end": "1917480"
  },
  {
    "text": "build your API servers from because it's actually got a copy of that type it can",
    "start": "1917480",
    "end": "1922820"
  },
  {
    "text": "it can automatically like fail if if there's any kind of an issue so it's",
    "start": "1922820",
    "end": "1928400"
  },
  {
    "text": "kind of done for free when you do API aggregations if you needed to do",
    "start": "1928400",
    "end": "1933770"
  },
  {
    "text": "anything more advanced than that you can write in a mission controller that could check things but for example if I come",
    "start": "1933770",
    "end": "1939830"
  },
  {
    "text": "along here and force a typo or something so but you know that if I make this a I",
    "start": "1939830",
    "end": "1946400"
  },
  {
    "text": "don't know an integer so very wrong and then I do a create yeah I create there",
    "start": "1946400",
    "end": "1955360"
  },
  {
    "text": "Internet's getting a bit contended clearly but it tells me that it can't be",
    "start": "1956200",
    "end": "1961790"
  },
  {
    "text": "hand reserved because they're read string well this is actually a much more",
    "start": "1961790",
    "end": "1967040"
  },
  {
    "text": "ugly error messages than I error message then I expect it but it's telling me here that it can't be had as an alert",
    "start": "1967040",
    "end": "1972320"
  },
  {
    "text": "because the type is invalid on that field and if you're doing this with a custom resource definition there's new",
    "start": "1972320",
    "end": "1978410"
  },
  {
    "text": "API validation stuff that Nikita worked on and that actually works great it's",
    "start": "1978410",
    "end": "1984800"
  },
  {
    "text": "not why well yeah you can do you can basically do the same thing with it but obviously you still don't get your full",
    "start": "1984800",
    "end": "1990170"
  },
  {
    "text": "of mission controller yeah it's better in 1/9 so use it to step up and yeah I",
    "start": "1990170",
    "end": "1998330"
  },
  {
    "text": "actually had to play this on the plane over and it it is really good so yeah thank you Nikita shoutout so any more oh well more",
    "start": "1998330",
    "end": "2006700"
  },
  {
    "text": "quick",
    "start": "2006700",
    "end": "2008909"
  },
  {
    "text": "this light the one the links they go cool I'm being told my times up",
    "start": "2013200",
    "end": "2020620"
  },
  {
    "text": "so yeah if anyone's got any more questions though I'll be around here",
    "start": "2020620",
    "end": "2027840"
  }
]