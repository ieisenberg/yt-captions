[
  {
    "text": "all right what's up nerds yeah so I'd like to know uh did you come here",
    "start": "960",
    "end": "8880"
  },
  {
    "text": "because you play Minecraft raise your hand and then and then keep your hand up please",
    "start": "8880",
    "end": "14160"
  },
  {
    "text": "alternatively did you come here because you have important customers who play Minecraft",
    "start": "14160",
    "end": "19759"
  },
  {
    "text": "yeah I'm both um I have some kids who are uh massively",
    "start": "20100",
    "end": "25320"
  },
  {
    "text": "obsessed with Minecraft and then I also like to play it and for me it's a resource management game I collect all",
    "start": "25320",
    "end": "30660"
  },
  {
    "text": "the resources and my children consume them um on the game and then I also use it as a three-dimensional programming model so",
    "start": "30660",
    "end": "37260"
  },
  {
    "text": "I get to automate things and that's super dope so if you do uh Minecraft that's great how many of you came here",
    "start": "37260",
    "end": "43680"
  },
  {
    "text": "because you have to manage commercial off-the-shelf software that's provided",
    "start": "43680",
    "end": "49500"
  },
  {
    "text": "you by others with strange constraints you don't always know right",
    "start": "49500",
    "end": "55079"
  },
  {
    "text": "cool good everyone's going to be happy there's going to be a lot more of the",
    "start": "55079",
    "end": "61559"
  },
  {
    "text": "kubernetes than the Minecraft I hope that's all right okay this is my first talk in in an actual",
    "start": "61559",
    "end": "69060"
  },
  {
    "text": "conference in more than two years for undisclosed reasons but I'm pretty",
    "start": "69060",
    "end": "75000"
  },
  {
    "text": "excited you can reach out to me I'm at Casey West everywhere I recently bought",
    "start": "75000",
    "end": "80520"
  },
  {
    "text": "the Instagram handle from the other person um you know and if you do go and follow me",
    "start": "80520",
    "end": "87180"
  },
  {
    "text": "uh you're probably gonna see like hiking and rock climbing and stuff more than computery nerd stuff but if you're into",
    "start": "87180",
    "end": "92880"
  },
  {
    "text": "that that's where I'm at let's start with the Minecraft architecture diagram",
    "start": "92880",
    "end": "99840"
  },
  {
    "text": "so those of you who run a Minecraft server know that this is the architecture diagram",
    "start": "99840",
    "end": "105479"
  },
  {
    "text": "you've got a client on the left there that's your computer and if you're running a server that's",
    "start": "105479",
    "end": "111240"
  },
  {
    "text": "separate from that computer then you run server.jar and you connect to it right",
    "start": "111240",
    "end": "118200"
  },
  {
    "text": "um obviously the title of this talk is Enterprise grade Minecraft on kubernetes",
    "start": "118200",
    "end": "123360"
  },
  {
    "text": "and so I got to to thinking you know is it possible to run this server on",
    "start": "123360",
    "end": "129000"
  },
  {
    "text": "kubernetes in a way that's resilient and we can also do things like you know data backup so that if we if we need to",
    "start": "129000",
    "end": "135420"
  },
  {
    "text": "recover the world from a previous snapshot we could do something like that and it turns out you can",
    "start": "135420",
    "end": "141720"
  },
  {
    "text": "so uh I work for a cloud company so my my kubernetes live in in one place yours",
    "start": "141720",
    "end": "148200"
  },
  {
    "text": "can live wherever they want it doesn't matter this isn't a a specific talk in any way but this is roughly what the",
    "start": "148200",
    "end": "154440"
  },
  {
    "text": "architecture is going to look like you know you so you've got your client there on the left uh there's going to be a load balancer",
    "start": "154440",
    "end": "160500"
  },
  {
    "text": "just in front of an instance so that's fun uh an instance of This Server if",
    "start": "160500",
    "end": "166319"
  },
  {
    "text": "you're running commercial grade software that's provided you by others the one that I love uh for work is like s4hana",
    "start": "166319",
    "end": "173099"
  },
  {
    "text": "from sap incredible massive database super performant and there are a couple",
    "start": "173099",
    "end": "179819"
  },
  {
    "text": "of different ways to scale it but you know one of them is get the biggest computer you can find right and that's",
    "start": "179819",
    "end": "185700"
  },
  {
    "text": "kind of like Minecraft uh so another thing about this piece of",
    "start": "185700",
    "end": "191580"
  },
  {
    "text": "software is that you can do modifications right so you can install modifications on the server uh and and",
    "start": "191580",
    "end": "198239"
  },
  {
    "text": "that's pretty fun how many of you play or know about modded Minecraft yes we really do have a room full of",
    "start": "198239",
    "end": "204959"
  },
  {
    "text": "nerds this is great yeah so you know I like you know Fabric and some vanilla",
    "start": "204959",
    "end": "210239"
  },
  {
    "text": "tweaks data packs and things like that and I figure I shouldn't uh just go and",
    "start": "210239",
    "end": "215519"
  },
  {
    "text": "you know curl them from the web I should do that but then put them in a storage solution that I control right and that I",
    "start": "215519",
    "end": "222720"
  },
  {
    "text": "can also do things like Version Control and then I can get them into my into my Minecraft instance so that's one thing",
    "start": "222720",
    "end": "229140"
  },
  {
    "text": "we're going to do with customizations and then of course uh the other big thing is backups right",
    "start": "229140",
    "end": "234780"
  },
  {
    "text": "so how do we do backups well I'm going to choose to to do uh storage like super",
    "start": "234780",
    "end": "240659"
  },
  {
    "text": "cold like um uh version controlled storage it's pretty inexpensive and I can always pull",
    "start": "240659",
    "end": "247560"
  },
  {
    "text": "out a version uh from the past and I can configure that however I want so so that's kind of the plan but it's a",
    "start": "247560",
    "end": "253739"
  },
  {
    "text": "little bit there are a couple of other little things to point out one of them is you know being able to consistently",
    "start": "253739",
    "end": "259620"
  },
  {
    "text": "know the address of your Minecraft server is handy so we need like a static IP we can throw DNS in front of that we",
    "start": "259620",
    "end": "265860"
  },
  {
    "text": "could do you know a solution like that there's also uh you know the server is",
    "start": "265860",
    "end": "270900"
  },
  {
    "text": "running and we might need to run remote commands against that server right this is something that happens a lot with",
    "start": "270900",
    "end": "276000"
  },
  {
    "text": "commercial software that's given to us is is that you know usually we're required to log into the machine it's",
    "start": "276000",
    "end": "282720"
  },
  {
    "text": "running on or the the VM it's running on and do stuff right and we we don't really want to do that for obvious",
    "start": "282720",
    "end": "288240"
  },
  {
    "text": "reasons I think for for probably most of us in the in the kubernetes world in a containerized landscape we don't want to",
    "start": "288240",
    "end": "293880"
  },
  {
    "text": "be logging on and messing around so we need some sort of remote admin thankfully in the gaming World valve",
    "start": "293880",
    "end": "299639"
  },
  {
    "text": "released an open protocol called archon which lets you do remote control of uh",
    "start": "299639",
    "end": "305699"
  },
  {
    "text": "of your game server and it's been baked into Minecraft Go Minecraft devs",
    "start": "305699",
    "end": "312060"
  },
  {
    "text": "I also want to use a mod called voice chat because I play with my children and",
    "start": "312060",
    "end": "317699"
  },
  {
    "text": "uh you know it's really fun for them to bark orders at me to collect certain",
    "start": "317699",
    "end": "322919"
  },
  {
    "text": "types of resources for them so they can use them in the build and we do that through voice chat so we're going to",
    "start": "322919",
    "end": "328560"
  },
  {
    "text": "install that as a client and of course that that requires a service and a protocol so that our clients can",
    "start": "328560",
    "end": "334139"
  },
  {
    "text": "interact with the the server-side voice chat system and then for backups we're going to use a good old cron but we're",
    "start": "334139",
    "end": "341100"
  },
  {
    "text": "going to do it the kubernetes way so you know that's going to be the fun",
    "start": "341100",
    "end": "346520"
  },
  {
    "text": "and I have let's see about a maximum of 30 minutes to get into it um so just to uh give you a heads up I'm",
    "start": "346919",
    "end": "354479"
  },
  {
    "text": "gonna I'm gonna go ahead and create a cluster forget the thing on the left that's a typo that'll come in later but a thing that",
    "start": "354479",
    "end": "362580"
  },
  {
    "text": "is Handy to know uh if you don't know about our machine types it doesn't really matter but this is a high memory",
    "start": "362580",
    "end": "367979"
  },
  {
    "text": "High CPU machine type so I'm just going to create a node pool with one instance",
    "start": "367979",
    "end": "373320"
  },
  {
    "text": "because I'm running one Minecraft server and I can only one run one instance of",
    "start": "373320",
    "end": "378660"
  },
  {
    "text": "that server and we'll get into why in a moment and uh this is roughly the configuration",
    "start": "378660",
    "end": "385800"
  },
  {
    "text": "that I'm going to use for that and I'm just going to set a few other things to try and keep my kubernetes cluster up to",
    "start": "385800",
    "end": "391080"
  },
  {
    "text": "date and in good shape so let's start with State Management there are some requirements for this",
    "start": "391080",
    "end": "398100"
  },
  {
    "text": "particular piece of commercial off-the-shelf software I didn't write them down because I'm a bad product manager but I am an all right engineer",
    "start": "398100",
    "end": "406080"
  },
  {
    "text": "so you know it worked out for me but um one of the requirements of Minecraft one",
    "start": "406080",
    "end": "412319"
  },
  {
    "text": "of the things to know about this application is that it keeps its state on disk so when you create a new world a",
    "start": "412319",
    "end": "419940"
  },
  {
    "text": "new world is a bunch of files on disk in a directory furthermore you can configure your Minecraft server you can",
    "start": "419940",
    "end": "426539"
  },
  {
    "text": "set a bunch of parameters like am I playing in creative mode or survival am I playing on hard mode who's allowed to",
    "start": "426539",
    "end": "432180"
  },
  {
    "text": "connect to this server what is my white list of those individuals who can be an operator right these sorts of things",
    "start": "432180",
    "end": "438419"
  },
  {
    "text": "that that are important to know and the devs for Minecraft have decided that the",
    "start": "438419",
    "end": "443520"
  },
  {
    "text": "the way to do that is on disk right so that's also on disk all of this is",
    "start": "443520",
    "end": "448979"
  },
  {
    "text": "inside of a data directory so we obviously need to keep that data directory",
    "start": "448979",
    "end": "454520"
  },
  {
    "text": "we have to manage that as state we don't want it to disappear if our if our game",
    "start": "454520",
    "end": "459900"
  },
  {
    "text": "crashes right if our pod disappears we don't want our actual world to disappear",
    "start": "459900",
    "end": "465180"
  },
  {
    "text": "that makes the children literally cry so we don't want to do that",
    "start": "465180",
    "end": "472080"
  },
  {
    "text": "so for State Management and you know there's a lot of crds in here and I'm not gonna I'm not gonna go",
    "start": "472080",
    "end": "477960"
  },
  {
    "text": "through every every line I'm going to assume that we can all Google this or or maybe even know what all of these things",
    "start": "477960",
    "end": "483599"
  },
  {
    "text": "are but I'm just going to highlight a couple of things as we walk through what the configuration looks like and why I",
    "start": "483599",
    "end": "489360"
  },
  {
    "text": "chose the things I did so one of the things that that I want to do is I want to use a fast disk so Minecraft is going",
    "start": "489360",
    "end": "495599"
  },
  {
    "text": "to work better if your disk is fast it's going to perform a little better it's also going to perform if you have more CPU and memory or the most you can have",
    "start": "495599",
    "end": "501660"
  },
  {
    "text": "right so up to a point because Java but but it's going to perform pretty well if",
    "start": "501660",
    "end": "507000"
  },
  {
    "text": "you have a lot of resources and so I'm going to use solid state disks and in order to do that I just need to set up a",
    "start": "507000",
    "end": "512760"
  },
  {
    "text": "storage class first I'm going to call it fast disk here and there are a couple of things I'm going to do",
    "start": "512760",
    "end": "518539"
  },
  {
    "text": "the thing I want to point out is the reclaim policy here which is to retain so if something happens where this gets",
    "start": "518539",
    "end": "525860"
  },
  {
    "text": "heated from your kubernetes state for your cluster we can retain",
    "start": "525860",
    "end": "532740"
  },
  {
    "text": "this the actual disk underneath so and the other thing is of course volume expansion and you're going to see right",
    "start": "532740",
    "end": "538080"
  },
  {
    "text": "now that I'm going to start with about 50 gigs of data that's a pretty sizable world but if you play the game for a",
    "start": "538080",
    "end": "544680"
  },
  {
    "text": "while you know that you can you can outpace that 50 gigs pretty easily and and you want to be able to to expand",
    "start": "544680",
    "end": "550080"
  },
  {
    "text": "that but you don't want to have to pay for an over provision you know 300 or 500 gigs or something like that",
    "start": "550080",
    "end": "555899"
  },
  {
    "text": "so that's one of the things we're going to do the other thing we're going to do is set this access mode",
    "start": "555899",
    "end": "562399"
  },
  {
    "text": "so like a lot of again commercial upgrade software off-the-shelf software that wasn't designed to work in a",
    "start": "562399",
    "end": "568980"
  },
  {
    "text": "kubernetes world and sort of scale in a in a cloud first manner uh this",
    "start": "568980",
    "end": "575820"
  },
  {
    "text": "application runs one instance against one set of data right so you can't run multiple instances against the same set",
    "start": "575820",
    "end": "581940"
  },
  {
    "text": "of data we would run into all the classic problems that we're familiar with from the last 30 or 40 years with",
    "start": "581940",
    "end": "588540"
  },
  {
    "text": "disk based State and multiple instances of our applications like file locking and reading and writing is is an issue",
    "start": "588540",
    "end": "594720"
  },
  {
    "text": "so we want to avoid all that issue and we're just going to say read write one's pod so only one pod can have access to",
    "start": "594720",
    "end": "601800"
  },
  {
    "text": "read or write on our cluster to this disk right that's one of the the key things here and of course we're",
    "start": "601800",
    "end": "607560"
  },
  {
    "text": "specifying that we're going to use the fast fast disk storage class so that",
    "start": "607560",
    "end": "612660"
  },
  {
    "text": "allows us to get away with having our solid state disk",
    "start": "612660",
    "end": "617940"
  },
  {
    "text": "um and we also happen to have a secret and the secret is actually for that archon tool so I mentioned that we're going to create we're going to set up",
    "start": "617940",
    "end": "624240"
  },
  {
    "text": "the protocol for doing Remote Management of this uh application",
    "start": "624240",
    "end": "629339"
  },
  {
    "text": "and we're using the archon protocol again valve open sourced the the protocol and it's an open standard and",
    "start": "629339",
    "end": "636360"
  },
  {
    "text": "we need a secret password to to connect to it um so it this is not a secure password I",
    "start": "636360",
    "end": "642540"
  },
  {
    "text": "don't recommend you using it it isn't my real password um yeah use it if you want actually it",
    "start": "642540",
    "end": "647700"
  },
  {
    "text": "doesn't matter to me all right application deployment so let's get into this a little bit um this",
    "start": "647700",
    "end": "654180"
  },
  {
    "text": "is actually good this is of course going to be a bit longer um so one of the things here is our",
    "start": "654180",
    "end": "661200"
  },
  {
    "text": "recreate strategy so by default um many of us may know that when we go",
    "start": "661200",
    "end": "666959"
  },
  {
    "text": "to update a deployment it's going to do a rolling deployer it's going to attempt to do a rolling deploy that's not going",
    "start": "666959",
    "end": "672660"
  },
  {
    "text": "to work out so well for us if we have multiple things trying to access this state on disk right so instead of that",
    "start": "672660",
    "end": "678060"
  },
  {
    "text": "in this particular case we have to deal with the the downtime and and just recreate the Pod so we're going to shut",
    "start": "678060",
    "end": "683760"
  },
  {
    "text": "down the old one terminate it and we're going to start up another one super important for our state here",
    "start": "683760",
    "end": "691220"
  },
  {
    "text": "um here's a little bit more of the deployment under the specification here so for our container I'm actually",
    "start": "691620",
    "end": "697380"
  },
  {
    "text": "standing on the shoulders of giants this user here who's that's also his username on on GitHub",
    "start": "697380",
    "end": "704220"
  },
  {
    "text": "um created a Minecraft server Docker container for us which is really handy and I'm going to pretend that you know in the world of Enterprise grade work",
    "start": "704220",
    "end": "711180"
  },
  {
    "text": "this person is on my team and uh built me a kick in Docker container and in",
    "start": "711180",
    "end": "718380"
  },
  {
    "text": "fact that is what happens so we've got a great image to work from and we're going to start from there and",
    "start": "718380",
    "end": "724980"
  },
  {
    "text": "I'm using latest which is uh should be a red flag for all of you totally not Enterprise grade send your pull requests",
    "start": "724980",
    "end": "730920"
  },
  {
    "text": "but hopefully everybody knows",
    "start": "730920",
    "end": "737279"
  },
  {
    "text": "yeah I saw a lot of head nods we should we should pick our versions okay cool yep so uh then we're going to request",
    "start": "737279",
    "end": "745079"
  },
  {
    "text": "some resources so in this case I'm going to request as much CPU as I can get and about five gigs of memory and this particular machine type class I think",
    "start": "745079",
    "end": "752279"
  },
  {
    "text": "has six gigs of memory so I'm leaving a little bit of room for the overhead but basically consuming it all",
    "start": "752279",
    "end": "760160"
  },
  {
    "text": "with this application and I already know you know because I've I've designed this solution that I'm going to run one",
    "start": "760680",
    "end": "766860"
  },
  {
    "text": "instance on one machine right one node will run one pod",
    "start": "766860",
    "end": "772860"
  },
  {
    "text": "and that's it and in fact because again the way that Minecraft works it's it's going to be a Noisy Neighbor it's going",
    "start": "772860",
    "end": "778920"
  },
  {
    "text": "to consume and aggressively use the resources that you try and offer it I wouldn't necessarily want to run more",
    "start": "778920",
    "end": "785399"
  },
  {
    "text": "than one on a node um you know your mileage may vary but I would probably choose one per node going",
    "start": "785399",
    "end": "792600"
  },
  {
    "text": "forward and then I'm going to set up these volume mounts so I mentioned state is managed on disk in this container image",
    "start": "792600",
    "end": "800459"
  },
  {
    "text": "configuration that state is at slash data from root so we're going to mount our uh fast disk our persistent volume",
    "start": "800459",
    "end": "808620"
  },
  {
    "text": "claim um into that location so that's going to be how we how we keep our state inside",
    "start": "808620",
    "end": "815399"
  },
  {
    "text": "of this pod so that's a state our stateful container",
    "start": "815399",
    "end": "819800"
  },
  {
    "text": "um the dev that built our image provided through environment variables a",
    "start": "821820",
    "end": "827940"
  },
  {
    "text": "bunch of ways to configure the server I mentioned that we have all kinds of configuration settings that we can use you can see here and this is actually",
    "start": "827940",
    "end": "834899"
  },
  {
    "text": "pretty important for Minecraft if you want to tune its actual execution is to supply a bunch of jvm arguments I've",
    "start": "834899",
    "end": "842579"
  },
  {
    "text": "I've uh for the sake of this slide and just space I've cut out a bunch of what's actually in my configuration",
    "start": "842579",
    "end": "849660"
  },
  {
    "text": "um and I would you know that's something you can Google for yourself if if you haven't uh when it comes to running Java",
    "start": "849660",
    "end": "855660"
  },
  {
    "text": "version of of Minecraft but um you can see I'm going to set the memory",
    "start": "855660",
    "end": "861060"
  },
  {
    "text": "at four gigs now this is interesting because I'm I've provisioned five gigs for the or I've requested five gigs for",
    "start": "861060",
    "end": "867839"
  },
  {
    "text": "the Pod and I'm using four I'm giving myself a little bit Headroom here um just in case uh because I really want",
    "start": "867839",
    "end": "874560"
  },
  {
    "text": "things to run smoothly I accept the end user license agreement I'm enabling",
    "start": "874560",
    "end": "880139"
  },
  {
    "text": "Arcon and I'm also um setting the password through this",
    "start": "880139",
    "end": "885360"
  },
  {
    "text": "environment State as well from a secret right so we set up that secret earlier",
    "start": "885360",
    "end": "891420"
  },
  {
    "text": "cool okay so our server um",
    "start": "891420",
    "end": "897620"
  },
  {
    "text": "exposes multiple protocols on multiple ports or multiple Services I should say",
    "start": "897620",
    "end": "903959"
  },
  {
    "text": "Network Services on multiple ports and using a couple of different protocols so we need to expose those as well so this",
    "start": "903959",
    "end": "910980"
  },
  {
    "text": "is something that I've learned to appreciate about kubernetes in general I",
    "start": "910980",
    "end": "916620"
  },
  {
    "text": "come from a more like platform higher abstraction like application development",
    "start": "916620",
    "end": "922139"
  },
  {
    "text": "world and of course in that world like a lot of your apps like they're connecting over one protocol or you're using them",
    "start": "922139",
    "end": "928019"
  },
  {
    "text": "over one protocol you're only you only have one port like you can you can have a whole bunch of constraints and everything is fine but",
    "start": "928019",
    "end": "934860"
  },
  {
    "text": "I didn't write this software and it was given to me and I got to run it and I need more flexibility than that right so",
    "start": "934860",
    "end": "941399"
  },
  {
    "text": "I already have to do custom things with disk and state I have to do custom things with ports I can do that with",
    "start": "941399",
    "end": "947639"
  },
  {
    "text": "kubernetes it's really not not that big of a deal right it's designed to allow for that and that's why I think we can",
    "start": "947639",
    "end": "953579"
  },
  {
    "text": "get away with this uh doing stateful and caught Solutions on on kubernetes in a",
    "start": "953579",
    "end": "958680"
  },
  {
    "text": "pretty pretty easy uh to manage way",
    "start": "958680",
    "end": "963740"
  },
  {
    "text": "so we've got voice chat that's UDP we've got archon we've got Minecraft itself these ports are all uh default from from",
    "start": "963779",
    "end": "971880"
  },
  {
    "text": "the configuration of the software directly and then finally I'm going to set up some probes right so I want to know when",
    "start": "971880",
    "end": "978240"
  },
  {
    "text": "the server is ready I also want to know if it's alive so we're just going to do some probes to",
    "start": "978240",
    "end": "983279"
  },
  {
    "text": "check that sort of thing doesn't hurt to do it it's a it's a decent idea",
    "start": "983279",
    "end": "989699"
  },
  {
    "text": "and this is where I had some fun so how do I get my mods",
    "start": "989699",
    "end": "994920"
  },
  {
    "text": "on disk right how do I get my mods into the server instance before it spins up",
    "start": "994920",
    "end": "1000259"
  },
  {
    "text": "so that it knows that it has mods and this is a solution that I came up with is is using uh initialization containers",
    "start": "1000259",
    "end": "1007220"
  },
  {
    "text": "and this is pretty pretty dope and you can actually have an array of them so I just have one here but you can do",
    "start": "1007220",
    "end": "1012320"
  },
  {
    "text": "another Dash args Down Below and you can have a whole list and they run an order and and so that's pretty neat because",
    "start": "1012320",
    "end": "1018259"
  },
  {
    "text": "then you can separate them out so this is the one to install voice chat and I've got one for fabric and one for the",
    "start": "1018259",
    "end": "1023899"
  },
  {
    "text": "vanilla tweaks data pack and and so on and so forth but you can see here that I am storing",
    "start": "1023899",
    "end": "1031100"
  },
  {
    "text": "uh the mods as jars in a bucket that I can access and I can pull from and I'm",
    "start": "1031100",
    "end": "1037579"
  },
  {
    "text": "just using curl I'm using the curl image here um for this initialization container so",
    "start": "1037579",
    "end": "1042798"
  },
  {
    "text": "I don't have to initialize using the Minecraft container all I have to do is make sure I mount the data directory and",
    "start": "1042799",
    "end": "1048500"
  },
  {
    "text": "I make it readable or writable rather right so as long as I do that I can actually write the state into it and I",
    "start": "1048500",
    "end": "1053840"
  },
  {
    "text": "do that before the game ever starts up and that's how I can get my mods in there now it does this every single time",
    "start": "1053840",
    "end": "1061100"
  },
  {
    "text": "I restart the server but I don't restart the server that often and it's pretty fast and I think I",
    "start": "1061100",
    "end": "1067880"
  },
  {
    "text": "think that's okay and I could optimize this with additional um checks to like bail out early to you",
    "start": "1067880",
    "end": "1074360"
  },
  {
    "text": "know freshness or whatever but um but it's good enough",
    "start": "1074360",
    "end": "1079240"
  },
  {
    "text": "cool so initializing containers pretty neat all right now uh service availability so",
    "start": "1080059",
    "end": "1087679"
  },
  {
    "text": "we obviously have the Minecraft service itself so if I have a client and I want to connect to the server I'd have to",
    "start": "1087679",
    "end": "1093559"
  },
  {
    "text": "connect to some IP address or if I set up DNS it would be DNS um we also have the voice chat which",
    "start": "1093559",
    "end": "1099860"
  },
  {
    "text": "connects through the client as well if the client has that plugin enabled or that mod",
    "start": "1099860",
    "end": "1104960"
  },
  {
    "text": "and we have the archon remote control API",
    "start": "1104960",
    "end": "1110000"
  },
  {
    "text": "so we have to set up these services so the first thing that I need to do is is have an IP address this is how I get my",
    "start": "1110000",
    "end": "1116480"
  },
  {
    "text": "IP address and how I make it static you can do it however you like it's worth",
    "start": "1116480",
    "end": "1122299"
  },
  {
    "text": "noting that by default this first command gives you an ipv4 I actually",
    "start": "1122299",
    "end": "1127640"
  },
  {
    "text": "don't know if Minecraft can speak over or if like the client knows IPv6 I see some nods I see some maybes",
    "start": "1127640",
    "end": "1134720"
  },
  {
    "text": "so you know I stuck with ipv4 um you could also do a global IP but all",
    "start": "1134720",
    "end": "1140960"
  },
  {
    "text": "of my users are within the United States and I feel like it's not so bad if it's",
    "start": "1140960",
    "end": "1147140"
  },
  {
    "text": "all in uh from one zone so I just stuck with that and then of course if you do describe that'll essentially tell you what the IP",
    "start": "1147140",
    "end": "1153020"
  },
  {
    "text": "address is so we have three services so the first one is is Minecraft this is relatively",
    "start": "1153020",
    "end": "1158480"
  },
  {
    "text": "straightforward we're going to set up the load balancer give it the IP address that we have that's static and in this",
    "start": "1158480",
    "end": "1165200"
  },
  {
    "text": "case I set external traffic policy to Cluster I set it to Cluster because I didn't mind the Hop I think we could do",
    "start": "1165200",
    "end": "1171260"
  },
  {
    "text": "local and honestly I didn't check it so you could do local or cluster",
    "start": "1171260",
    "end": "1176720"
  },
  {
    "text": "um that's up to you but it is nice to have the load balancer in there so I",
    "start": "1176720",
    "end": "1182299"
  },
  {
    "text": "like to uh I like to have it and we're going to do the same for archon here it's again it's TCP same IP",
    "start": "1182299",
    "end": "1190820"
  },
  {
    "text": "address we're going to do the load balancer and finally uh voice chat so for voice",
    "start": "1190820",
    "end": "1197299"
  },
  {
    "text": "chat it's UDP which of course we can do through the load balancer so no big deal",
    "start": "1197299",
    "end": "1202700"
  },
  {
    "text": "and same IP address at services so now we've got the services exposed",
    "start": "1202700",
    "end": "1208880"
  },
  {
    "text": "but here's the here's the big one right so how do we do backup and I found this personally like really",
    "start": "1208880",
    "end": "1215780"
  },
  {
    "text": "a little overly complex for my taste um and for those of you who have had to",
    "start": "1215780",
    "end": "1221120"
  },
  {
    "text": "deal with like identity management and access to external services and having",
    "start": "1221120",
    "end": "1226580"
  },
  {
    "text": "access to manipulate um kubernetes through the API you you",
    "start": "1226580",
    "end": "1231620"
  },
  {
    "text": "maybe have already had to deal with this and and I'm sure that there are many people in this audience right now who",
    "start": "1231620",
    "end": "1236720"
  },
  {
    "text": "are more expert than me so I'm just going to walk you through what I did but basically what I wanted to do is",
    "start": "1236720",
    "end": "1242419"
  },
  {
    "text": "every uh is about twice a day I just wanted to take a snapshot right take a snapshot throw it into a storage bucket",
    "start": "1242419",
    "end": "1248660"
  },
  {
    "text": "it's versioned and I keep a certain number of versions I think I chose to keep five so that's about two and a half",
    "start": "1248660",
    "end": "1254480"
  },
  {
    "text": "days of of play so essentially if like one of my children you know",
    "start": "1254480",
    "end": "1260720"
  },
  {
    "text": "TNT griefs the heck out of one of my other kids builds I I have two and a half days to like",
    "start": "1260720",
    "end": "1266660"
  },
  {
    "text": "make it right right so that's you know my that's my concern there",
    "start": "1266660",
    "end": "1272080"
  },
  {
    "text": "so the first thing I had to do is create a service account um you know just a backup Runner",
    "start": "1273559",
    "end": "1281299"
  },
  {
    "text": "then I had to create a role to interact with kubernetes right so the kubernetes API so essentially I need to",
    "start": "1281299",
    "end": "1287960"
  },
  {
    "text": "be able to get information out of this pod the data is in the Pod the Pod gets us generated you know name with a Shaw",
    "start": "1287960",
    "end": "1294740"
  },
  {
    "text": "and I need to be able to access it in order to run some commands and you'll see why in a second",
    "start": "1294740",
    "end": "1301539"
  },
  {
    "text": "and then I have to bind this role these are all pretty straightforward there's no like sort of fancy thing here no no",
    "start": "1301700",
    "end": "1308240"
  },
  {
    "text": "magic necessarily but then because I want to store this on uh cloud storage in my uh you know",
    "start": "1308240",
    "end": "1316820"
  },
  {
    "text": "infrastructure provider of choice I have to manage that as well so I have to create an uh an IAM service account",
    "start": "1316820",
    "end": "1324020"
  },
  {
    "text": "uh to interact with my service or my infrastructure provider",
    "start": "1324020",
    "end": "1330080"
  },
  {
    "text": "and then I have to add that service account to a policy that can manage",
    "start": "1330080",
    "end": "1335480"
  },
  {
    "text": "storage objects so that's this right here like be a storage admin let me do stuff with storage",
    "start": "1335480",
    "end": "1340760"
  },
  {
    "text": "and do it in my project alrighty so now we're at this policy",
    "start": "1340760",
    "end": "1347840"
  },
  {
    "text": "which allows you know kubernetes workload to do to to have an identity right so we're",
    "start": "1347840",
    "end": "1353659"
  },
  {
    "text": "going to run a Cron job on kubernetes and that's going to initialize a pod that pod's going to",
    "start": "1353659",
    "end": "1360740"
  },
  {
    "text": "um log on to this other pod get the data out of it and put it into the GCS object",
    "start": "1360740",
    "end": "1366140"
  },
  {
    "text": "or Google Cloud Storage uh object and in order to do that we have to be some some",
    "start": "1366140",
    "end": "1373640"
  },
  {
    "text": "identity right this this application has to has to take on an identity and I wanted to take on the service account",
    "start": "1373640",
    "end": "1379400"
  },
  {
    "text": "for gcp in this case so that's a workload identity user here",
    "start": "1379400",
    "end": "1385280"
  },
  {
    "text": "and I'm setting this member the Minecraft backup Runner essay so essentially it can it can be this other",
    "start": "1385280",
    "end": "1392419"
  },
  {
    "text": "service account which leads us to the Cron job which",
    "start": "1392419",
    "end": "1398179"
  },
  {
    "text": "I was relatively new to when I first set this up I set this up initially about a year ago I think but I was initially new",
    "start": "1398179",
    "end": "1404900"
  },
  {
    "text": "to it and and this is super cool so it's just like cron jobs of old you say you",
    "start": "1404900",
    "end": "1410000"
  },
  {
    "text": "want to run it twice a day I'm going to say specifically like I do not want to run this concurrently right so I just",
    "start": "1410000",
    "end": "1417200"
  },
  {
    "text": "only want to ever run one instance of this thing at a time so I can if I if my world was massive and or I was taking",
    "start": "1417200",
    "end": "1423740"
  },
  {
    "text": "snapshots very frequently I wouldn't have these things running over one another",
    "start": "1423740",
    "end": "1429500"
  },
  {
    "text": "and this is a scent uh this is what what the crown job looks like so",
    "start": "1429500",
    "end": "1435039"
  },
  {
    "text": "I'm going to run an uh a pod and the container that I'm going to pull the",
    "start": "1435440",
    "end": "1441559"
  },
  {
    "text": "image I'm going to pull is the cloud SDK because I need some tools to interact with my infrastructure provider and it",
    "start": "1441559",
    "end": "1447799"
  },
  {
    "text": "turns out you know I can just get this super lightweight Cloud SDK it's running Alpine or it's on Alpine and then I'm",
    "start": "1447799",
    "end": "1455480"
  },
  {
    "text": "going to install these uh components on gcloud because I get gcloud from the cloud SDK so I can",
    "start": "1455480",
    "end": "1462620"
  },
  {
    "text": "get my kubernetes API interaction and I can get my storage object management",
    "start": "1462620",
    "end": "1469820"
  },
  {
    "text": "um so I'm going to get my pod ID using this gnarly thing here and once I have that I can start",
    "start": "1469820",
    "end": "1475159"
  },
  {
    "text": "executing commands now I'm running in the cluster so I'm using the archon CLI",
    "start": "1475159",
    "end": "1481580"
  },
  {
    "text": "so I mentioned already that this is a remote control API that you can use to to manage the server remotely you can",
    "start": "1481580",
    "end": "1487460"
  },
  {
    "text": "also use the CLI just like you'd you know use the the uh kubernetes API",
    "start": "1487460",
    "end": "1493480"
  },
  {
    "text": "controller API directly or you'd use the command line and so I'm going to turn off saving in",
    "start": "1493480",
    "end": "1499340"
  },
  {
    "text": "the game and then I'm going to save everything that's currently in memory right get our snapshot",
    "start": "1499340",
    "end": "1505120"
  },
  {
    "text": "snapshot it turn saving back on so there's a little blip here where you know maybe something",
    "start": "1505120",
    "end": "1511760"
  },
  {
    "text": "would glitch out and we would actually uh lose some state if people were playing while it was happening I haven't",
    "start": "1511760",
    "end": "1516919"
  },
  {
    "text": "seen that happen but it could happen you know it's it's a race um and then",
    "start": "1516919",
    "end": "1522559"
  },
  {
    "text": "we're going to use gsutil to copy that new snapshot into the bucket and again",
    "start": "1522559",
    "end": "1530720"
  },
  {
    "text": "this bucket is just called like archive storage that uh that gets versioned and",
    "start": "1530720",
    "end": "1536120"
  },
  {
    "text": "so old versions just go away automatically it cost me a little bit extra in you know because I'm using a",
    "start": "1536120",
    "end": "1542900"
  },
  {
    "text": "cloudy provider here it cost me a little extra to yank it back out but it's really really really cheap to put it in",
    "start": "1542900",
    "end": "1548720"
  },
  {
    "text": "so that's nice and then if it happens to fail then we'll we'll restart we'll just",
    "start": "1548720",
    "end": "1554179"
  },
  {
    "text": "try again and that's you know that's backups so that's not too bad",
    "start": "1554179",
    "end": "1560059"
  },
  {
    "text": "um this is what the backup uh configuration roughly looks like this is the important bits that you would need",
    "start": "1560059",
    "end": "1565700"
  },
  {
    "text": "to know again I think you can do this on any provider that provides this kind of uh storage solution it's not it's not",
    "start": "1565700",
    "end": "1572720"
  },
  {
    "text": "unique but the idea is you know turn on versioning and you can set retention",
    "start": "1572720",
    "end": "1578360"
  },
  {
    "text": "policy to be a certain number of days or a certain number of revisions right so you can do that sort of thing",
    "start": "1578360",
    "end": "1584900"
  },
  {
    "text": "all right so does it run okay so",
    "start": "1584900",
    "end": "1592100"
  },
  {
    "text": "uh if I start the client which I I just took snapshots I just took pictures to",
    "start": "1592100",
    "end": "1597559"
  },
  {
    "text": "to be super safe but if I start the client you know I would see you know my Minecraft server running on kubernetes",
    "start": "1597559",
    "end": "1603640"
  },
  {
    "text": "I've said that a maximum of four players can play because I've only white listed four players um that's how many I have",
    "start": "1603640",
    "end": "1610059"
  },
  {
    "text": "and nobody was on when I took the snapshot and then when I logged in last",
    "start": "1610059",
    "end": "1615080"
  },
  {
    "text": "uh I had nothing and I was in a cave but you know it's uh it did run",
    "start": "1615080",
    "end": "1623539"
  },
  {
    "text": "and just for the heck of it um we can try",
    "start": "1623539",
    "end": "1629620"
  },
  {
    "text": "and I last uh deployed this last night because you know conference talks",
    "start": "1638380",
    "end": "1645559"
  },
  {
    "text": "so it should still be and we will find out",
    "start": "1645559",
    "end": "1651679"
  },
  {
    "text": "so if I go to multiplayer family server",
    "start": "1651679",
    "end": "1657519"
  },
  {
    "text": "I should still be stuck in a scary scary cave yeah",
    "start": "1658400",
    "end": "1665059"
  },
  {
    "text": "there I am all right yeah",
    "start": "1665059",
    "end": "1669980"
  },
  {
    "text": "thank you thank you and and you can see that we have our internet connectivity here so that's",
    "start": "1670760",
    "end": "1677179"
  },
  {
    "text": "cool um those uh those bars like your mobile phone indicate how good your latency is",
    "start": "1677179",
    "end": "1683600"
  },
  {
    "text": "and we're not doing too bad so that's pretty cool by the way",
    "start": "1683600",
    "end": "1689480"
  },
  {
    "text": "um I I was here earlier than most because I",
    "start": "1689480",
    "end": "1694820"
  },
  {
    "text": "was prepping to give this talk and it felt like we should have music and I don't know how many of you know this but",
    "start": "1694820",
    "end": "1700159"
  },
  {
    "text": "if you do play Minecraft and if some of your constituents are are small or fun",
    "start": "1700159",
    "end": "1706179"
  },
  {
    "text": "there's a parody of Katy Perry's Last Friday Night",
    "start": "1706179",
    "end": "1711980"
  },
  {
    "text": "uh I know it's on Spotify because that's what I use but it's called Don't Mind at Night uh and it is very funny",
    "start": "1711980",
    "end": "1719419"
  },
  {
    "text": "um it's like I know you're feeling kind of Brave and I know you're looking at that cave and you're feeling kind of Brave",
    "start": "1719419",
    "end": "1725240"
  },
  {
    "text": "you know don't mind at night it's it's pretty good so highly recommended uh it's a Bop",
    "start": "1725240",
    "end": "1733658"
  },
  {
    "text": "all right so what if you want to do this for yourself but you don't want to uh go find my slides on sketch and uh and you",
    "start": "1733760",
    "end": "1742460"
  },
  {
    "text": "know piece this together Yourself by hand turns out the same person who wrote uh the the awesome or put together the",
    "start": "1742460",
    "end": "1749600"
  },
  {
    "text": "awesome image from Minecraft also put together these server charts uh and threw it on GitHub and that's",
    "start": "1749600",
    "end": "1756020"
  },
  {
    "text": "actually what I do use to manage my instances and they are great and he has",
    "start": "1756020",
    "end": "1761299"
  },
  {
    "text": "in fact also done like the backup management and all that stuff for you so if you want specifically to run",
    "start": "1761299",
    "end": "1767840"
  },
  {
    "text": "Minecraft and do it in a decent way this is a pretty cool way to do it I think",
    "start": "1767840",
    "end": "1773000"
  },
  {
    "text": "um and it works on um you know on kubernetes it's it's not",
    "start": "1773000",
    "end": "1779179"
  },
  {
    "text": "um provider specific but he does have some uh notes here and there if you're using a particular provider and then I",
    "start": "1779179",
    "end": "1785840"
  },
  {
    "text": "did a couple of things Uh custom most notably like the storage class for",
    "start": "1785840",
    "end": "1791059"
  },
  {
    "text": "persistent disks because it's a certain configuration that works with with my chosen uh infrastructure location so so",
    "start": "1791059",
    "end": "1799039"
  },
  {
    "text": "that's pretty cool and hopefully through this uh my goal",
    "start": "1799039",
    "end": "1805360"
  },
  {
    "text": "was to explain some of the things that kubernetes has on hand that I use to run",
    "start": "1805360",
    "end": "1811340"
  },
  {
    "text": "an off-the-shelf piece of software that I also recommend uh when I talk to big companies and and people who are trying",
    "start": "1811340",
    "end": "1818240"
  },
  {
    "text": "to figure out how to containerize their stuff you know when it comes to off-the-shelf software the first question is like are you really sure",
    "start": "1818240",
    "end": "1824419"
  },
  {
    "text": "that's what you need to do and if they are really really sure that's what they need to do a lot of these tips and",
    "start": "1824419",
    "end": "1831080"
  },
  {
    "text": "tricks are quite useful for a lot of solutions that you have to manage that",
    "start": "1831080",
    "end": "1836120"
  },
  {
    "text": "could go into a kubernetes cluster but need a little finessing of the",
    "start": "1836120",
    "end": "1841460"
  },
  {
    "text": "configuration um we've got options for you so hopefully you can take these and run",
    "start": "1841460",
    "end": "1847399"
  },
  {
    "text": "with them there's a four minutes if there's a question or",
    "start": "1847399",
    "end": "1855320"
  },
  {
    "text": "two yep",
    "start": "1855320",
    "end": "1858340"
  },
  {
    "text": "yeah so question is have I thought about using a job template to restore the data totally uh yes that is a good idea",
    "start": "1861140",
    "end": "1867620"
  },
  {
    "text": "however uh I didn't write anything to do data restore because that's how good of",
    "start": "1867620",
    "end": "1873200"
  },
  {
    "text": "an engineer I am now just because",
    "start": "1873200",
    "end": "1879620"
  },
  {
    "text": "um uh I I honestly was like I can solve that problem if I have it at least I",
    "start": "1879620",
    "end": "1885440"
  },
  {
    "text": "have the backups the snapshots I trust them and I believe that uh I know that",
    "start": "1885440",
    "end": "1891260"
  },
  {
    "text": "my customer would alert me to an issue with this application immediately",
    "start": "1891260",
    "end": "1896659"
  },
  {
    "text": "and I would have time to fix it that's my circumstances may not be everybody's that's a good question",
    "start": "1896659",
    "end": "1902539"
  },
  {
    "text": "uh one last question oh we have a question right here yep go",
    "start": "1902539",
    "end": "1908539"
  },
  {
    "text": "for it totally",
    "start": "1908539",
    "end": "1913640"
  },
  {
    "text": "um this configure this cluster configuration I think on my infrastructure provider is about a",
    "start": "1915559",
    "end": "1921260"
  },
  {
    "text": "hundred and six dollars a month yeah now uh Minecraft is really",
    "start": "1921260",
    "end": "1928580"
  },
  {
    "text": "important to my family yeah um so yeah no doubt uh you don't have to",
    "start": "1928580",
    "end": "1935840"
  },
  {
    "text": "run um a four gig server instance and again like getting nerdy about Minecraft",
    "start": "1935840",
    "end": "1941059"
  },
  {
    "text": "specifically for a moment there are a lot of mods that hyper optimize both",
    "start": "1941059",
    "end": "1946340"
  },
  {
    "text": "memory and CPU consumption there's also mods that optimize network uh traffic and you can get a really high quality",
    "start": "1946340",
    "end": "1954260"
  },
  {
    "text": "experience with reduced resource uh claims",
    "start": "1954260",
    "end": "1960679"
  },
  {
    "text": "um so you could probably I think for four players like you could probably cut that in half and be happy for a while",
    "start": "1960679",
    "end": "1966740"
  },
  {
    "text": "um but it's not free that's a good point",
    "start": "1966740",
    "end": "1971260"
  },
  {
    "text": "yeah totally awesome question so the question is this is this running 24 7 or can you",
    "start": "1973279",
    "end": "1979340"
  },
  {
    "text": "optimize it uh I do not run it 24 7. because sometimes my children get grounded",
    "start": "1979340",
    "end": "1985039"
  },
  {
    "text": "um which is basically the same as hey you know maybe you only need this during business hours like you know in in one",
    "start": "1985039",
    "end": "1992179"
  },
  {
    "text": "uh one time zone um yeah you can you can shut this down so I shut it down just by",
    "start": "1992179",
    "end": "1997220"
  },
  {
    "text": "um I'm I'm super I don't have it automated I just go and and run um uh replicas to zero uh scale right so",
    "start": "1997220",
    "end": "2006159"
  },
  {
    "text": "I just say run zero replicas or run one run one replica and when it when I run one because I have the persistent volume",
    "start": "2006159",
    "end": "2012399"
  },
  {
    "text": "claim and it's and it is persistent uh it just pulls the world back up and everything is good to go",
    "start": "2012399",
    "end": "2018399"
  },
  {
    "text": "yeah that is uh an excellent question yeah so in this particular case it's it's pretty easy and you could throw",
    "start": "2018399",
    "end": "2024880"
  },
  {
    "text": "that into a Cron job if you wanted to you know um another good question",
    "start": "2024880",
    "end": "2029980"
  },
  {
    "text": "uh yeah all right last one",
    "start": "2029980",
    "end": "2033778"
  },
  {
    "text": "um yeah so the backup still it's still try and they fail yeah that's a good question too yeah so",
    "start": "2035140",
    "end": "2041500"
  },
  {
    "text": "they fail because they can't get the Pod ID and then and then there's an error yeah totally yeah that's a good question",
    "start": "2041500",
    "end": "2047679"
  },
  {
    "text": "all right I really appreciate it everybody uh it's a long walk back to whatever talk you're going to next so",
    "start": "2047679",
    "end": "2054220"
  },
  {
    "text": "thank you very much for coming down here",
    "start": "2054220",
    "end": "2057419"
  }
]