[
  {
    "start": "0",
    "end": "13000"
  },
  {
    "text": "all right I think we're ready to get started first given how large the the",
    "start": "0",
    "end": "5370"
  },
  {
    "text": "audience's I have to ask are you all aware this is a talk about DNS yeah okay",
    "start": "5370",
    "end": "12799"
  },
  {
    "text": "first all I'll just briefly introduce the three of us will be speaking my name is cricket Lou I am the chief DNS",
    "start": "12799",
    "end": "19560"
  },
  {
    "start": "13000",
    "end": "13000"
  },
  {
    "text": "architect and an EVP of engineering for a company called Infoblox I also was one",
    "start": "19560",
    "end": "26609"
  },
  {
    "text": "of the co-authors of book called DNS and bind which is a blue and white book with a grasshopper on the cover and until",
    "start": "26609",
    "end": "34260"
  },
  {
    "text": "recently I thought I was the co-author of all of O'Reilly books on DNS but apparently they slipped a new one in",
    "start": "34260",
    "end": "39540"
  },
  {
    "text": "there that I had nothing to do with so I'm not and this is Prince elector who",
    "start": "39540",
    "end": "44670"
  },
  {
    "text": "is one of our senior software managers at Infoblox and one of the maintainer zuv core DNS",
    "start": "44670",
    "end": "50610"
  },
  {
    "text": "and we also have up front here john bela mark and john is a senior staff engineer",
    "start": "50610",
    "end": "56039"
  },
  {
    "text": "for google he did work at Infoblox up until recently and he's also a core DNS maintainer so here's our agenda today",
    "start": "56039",
    "end": "64799"
  },
  {
    "start": "63000",
    "end": "63000"
  },
  {
    "text": "I'll give you guys a really brief introduction five more so I had something like that and then John will",
    "start": "64799",
    "end": "71490"
  },
  {
    "text": "come up and he'll talk about the cluster default configuration for core DNS will",
    "start": "71490",
    "end": "77640"
  },
  {
    "text": "look a little bit at some non default configurations as well and will give you pointers to more resources and with any",
    "start": "77640",
    "end": "84030"
  },
  {
    "text": "luck at the end we'll have a little bit of time for Q&A as well and we have I think mics and the aisles so that we can",
    "start": "84030",
    "end": "90960"
  },
  {
    "text": "actually hear you so let's talk very broadly about core DNS first of all is a",
    "start": "90960",
    "end": "96900"
  },
  {
    "start": "93000",
    "end": "93000"
  },
  {
    "text": "flexible DNS server it's written in go so you get some of the advantages of go",
    "start": "96900",
    "end": "102689"
  },
  {
    "text": "right off the bat you get a memory safe executable which is a big deal in the",
    "start": "102689",
    "end": "107700"
  },
  {
    "text": "world of DNS because if you're running a name server that's directly exposed to the Internet you want to make sure it's",
    "start": "107700",
    "end": "113220"
  },
  {
    "text": "not vulnerable to things like buffer overruns if any of you have run bind for example",
    "start": "113220",
    "end": "119369"
  },
  {
    "text": "over many years on an internet attached host you know that there were a lot",
    "start": "119369",
    "end": "124950"
  },
  {
    "text": "there have been lots of buffer overruns over the course of time that it is fallen victim to unfortunately being",
    "start": "124950",
    "end": "131400"
  },
  {
    "text": "written and go also means that the top end performance is not good as say bind running on a modern",
    "start": "131400",
    "end": "137959"
  },
  {
    "text": "linux operating system right but that's typically not an issue because we don't",
    "start": "137959",
    "end": "143209"
  },
  {
    "text": "really use core DNS in applications where we need to get really really high performance it uses a plug-in based",
    "start": "143209",
    "end": "150200"
  },
  {
    "text": "architecture which is easily extended John actually has a talk later on where",
    "start": "150200",
    "end": "155870"
  },
  {
    "text": "he'll actually go into some of that you'll you'll learn a little bit about writing plug-ins for core DNS even if",
    "start": "155870",
    "end": "162650"
  },
  {
    "text": "you're not somebody who would be interested in or capable of writing a plug-in have no fear there are lots and",
    "start": "162650",
    "end": "168470"
  },
  {
    "text": "lots of plugins available to perform all kinds of interesting functionality and there are more being written all the",
    "start": "168470",
    "end": "174260"
  },
  {
    "text": "time one affirmation actually of the plug-in",
    "start": "174260",
    "end": "179480"
  },
  {
    "text": "architecture is that bind is actually moving to a plug-in architecture so the great granddaddy of DNS servers is",
    "start": "179480",
    "end": "185959"
  },
  {
    "text": "actually going to implement a plug-in architecture as of by 9.15 core DNS",
    "start": "185959",
    "end": "192230"
  },
  {
    "text": "supports DNS of course it's a DNS server it also supports DNS over TLS which we",
    "start": "192230",
    "end": "198560"
  },
  {
    "text": "call dot for short and dodd is kind of a hot new technology in the DNS community so if you want to play with the cool",
    "start": "198560",
    "end": "204470"
  },
  {
    "text": "kids and set up your own recursive server that can do dot and use your android p device in order to send",
    "start": "204470",
    "end": "211579"
  },
  {
    "text": "encrypted queries to it then you can do that right also supports dns over g RPC",
    "start": "211579",
    "end": "217370"
  },
  {
    "text": "and the project was initiated by me jibon who's a dutch guy who lives in london works for goldman sachs and he",
    "start": "217370",
    "end": "225139"
  },
  {
    "text": "also wrote sky DNS and sky DNS to so he has experience writing thanks francois",
    "start": "225139",
    "end": "231470"
  },
  {
    "text": "writing dns servers he also wrote what is probably the most popular dns library",
    "start": "231470",
    "end": "236799"
  },
  {
    "text": "written in go and he looked at the Cadi web server and I think he admired its",
    "start": "236799",
    "end": "243340"
  },
  {
    "text": "architecture and decided gee you know I have a go DNS library I could easily use",
    "start": "243340",
    "end": "248419"
  },
  {
    "text": "this framework in order to develop a DNS server and that's really what core DNS",
    "start": "248419",
    "end": "254299"
  },
  {
    "text": "is so as you know we have native support",
    "start": "254299",
    "end": "259310"
  },
  {
    "text": "of kubernetes service discovery in core DNS accordion has when GA with",
    "start": "259310",
    "end": "265190"
  },
  {
    "text": "kubernetes in version one dot and as you probably heard during the keynotes yesterday it's now the default",
    "start": "265190",
    "end": "271580"
  },
  {
    "text": "DNS server in 1.13 it boasts all kinds of integration with Etsy and other cloud",
    "start": "271580",
    "end": "279229"
  },
  {
    "text": "vendors for example if you have if user out 53 with an AWS as an authoritative",
    "start": "279229",
    "end": "284840"
  },
  {
    "text": "DNS server you want to pull authoritative data into core DNS and republish it or simply use it in order",
    "start": "284840",
    "end": "290960"
  },
  {
    "text": "to resolve you can do that and it does so via the route 53 API so you don't",
    "start": "290960",
    "end": "296449"
  },
  {
    "text": "even need a you know direct UDP path to the name server that you're resolving to it has support for Prometheus for",
    "start": "296449",
    "end": "303380"
  },
  {
    "text": "metrics it also is capable of forwarding to a recursive DNS server and this is important because it doesn't actually",
    "start": "303380",
    "end": "311539"
  },
  {
    "text": "have the capability to act as a full service DNS recurse ur itself so it has",
    "start": "311539",
    "end": "318560"
  },
  {
    "text": "to rely on another name server to do that or you can use some optional plugins some out of tree plugins we have",
    "start": "318560",
    "end": "323930"
  },
  {
    "text": "one called unbound for example right so",
    "start": "323930",
    "end": "329690"
  },
  {
    "start": "329000",
    "end": "329000"
  },
  {
    "text": "you may be asking yourself why core DNS versus the old cubed DNS and there are a number of reasons one is that plug-in",
    "start": "329690",
    "end": "337550"
  },
  {
    "text": "architecture that allows you to extend it very very easily the rich set of plugins the bridge ecosystem that's",
    "start": "337550",
    "end": "343490"
  },
  {
    "text": "available to you about 34 plugins as of this state and new ones being developed all the time right it's simpler it has",
    "start": "343490",
    "end": "351919"
  },
  {
    "text": "many fewer moving parts than the old cube DNS did cube DNS was I think three",
    "start": "351919",
    "end": "358880"
  },
  {
    "text": "different executables it was Q DNS itself it was DNS mask as well as a sidecar application and some of those",
    "start": "358880",
    "end": "365659"
  },
  {
    "text": "were written in C naught and go right and there are a couple of other things that are maybe in the category of",
    "start": "365659",
    "end": "372680"
  },
  {
    "text": "esoterica but still worth mentioning customizable DNS entries for example if you want to add static DNS data within",
    "start": "372680",
    "end": "379820"
  },
  {
    "text": "the cluster domain that's completely unrelated to the service discovery stuff you can do that which is a pretty",
    "start": "379820",
    "end": "386659"
  },
  {
    "text": "powerful thing to be able to do there's an experimental server-side search path feature that will actually speed up",
    "start": "386659",
    "end": "393919"
  },
  {
    "text": "resolution because what you'll find is that within a containerized environment",
    "start": "393919",
    "end": "399650"
  },
  {
    "text": "your containers have these really long search lists that they're going to go through to find a particular domain name",
    "start": "399650",
    "end": "405800"
  },
  {
    "text": "and cord eNOS can actually anticipate that it's gonna walk through all of the elements of that search list and match",
    "start": "405800",
    "end": "411710"
  },
  {
    "text": "the first one rather than waiting to till the 10th for example here's the",
    "start": "411710",
    "end": "417770"
  },
  {
    "start": "415000",
    "end": "415000"
  },
  {
    "text": "project status we're at version 1.2 dot six I came out about a month ago on",
    "start": "417770",
    "end": "423830"
  },
  {
    "text": "November 5th it's an incubating project within the CN CF the graduation vote is either",
    "start": "423830",
    "end": "430430"
  },
  {
    "text": "underway or just about to get underway is it is it actually underway the one the one doctrine x1 oh I see okay",
    "start": "430430",
    "end": "438669"
  },
  {
    "text": "imminent and a growing community of contributors 112 contributors all of",
    "start": "438669",
    "end": "443960"
  },
  {
    "text": "whom we thank 16 maintainer x' two of whom are speaking today 29 plus public adopters around the world and if you do",
    "start": "443960",
    "end": "450800"
  },
  {
    "text": "use poor dns please please please add yourself to the adopters list and over 3,000 stars on github and with that i'll",
    "start": "450800",
    "end": "459740"
  },
  {
    "start": "457000",
    "end": "457000"
  },
  {
    "text": "turn this over to Francois thank you thank you Thank You cricket so I will try to",
    "start": "459740",
    "end": "468229"
  },
  {
    "text": "present now how it looks like in Cuban it is the core DNS configuration for",
    "start": "468229",
    "end": "475490"
  },
  {
    "text": "Cabana tees we do that in to set 10 minutes about really the big picture of",
    "start": "475490",
    "end": "482719"
  },
  {
    "text": "community is how to how the query are resolving in coordinates and how then we",
    "start": "482719",
    "end": "489229"
  },
  {
    "text": "can tweak the configuration for some easy from easy change or easy tweaks and",
    "start": "489229",
    "end": "497120"
  },
  {
    "text": "then John will come after for more complicated option or take advantage of of Co DNS more deeply so our",
    "start": "497120",
    "end": "509349"
  },
  {
    "text": "configuration right now is korrina's is the DNS server of a cluster you have a cabinet is Christian Korean s is",
    "start": "509349",
    "end": "517279"
  },
  {
    "text": "connected to the API of humanities so we can watch listen the service the pods",
    "start": "517279",
    "end": "523669"
  },
  {
    "text": "endpoints they just will resolve any query that aims to have an IP from from",
    "start": "523669",
    "end": "530990"
  },
  {
    "text": "the cluster and will forward upstream every queries that are out of the crystal okay",
    "start": "530990",
    "end": "537770"
  },
  {
    "text": "so the pods are the one that query and say oh where is this service where this service always is domain so the domain",
    "start": "537770",
    "end": "544850"
  },
  {
    "text": "can be inside the cluster or outside the cluster this button",
    "start": "544850",
    "end": "553670"
  },
  {
    "start": "553000",
    "end": "553000"
  },
  {
    "text": "so first let's let's look at a when you deploy I mean when Cody and s is the",
    "start": "553670",
    "end": "560000"
  },
  {
    "text": "punch abilities what do you have so you have a service account a cluster role a",
    "start": "560000",
    "end": "566690"
  },
  {
    "text": "cluster wall biding that's very simple and then you have maybe the more interesting part the config map named",
    "start": "566690",
    "end": "573590"
  },
  {
    "text": "Cody NS it's where reside the what we call the cockfight so you have a CO file",
    "start": "573590",
    "end": "578900"
  },
  {
    "text": "key with exactly the the configuration for coordinates so this each time you",
    "start": "578900",
    "end": "584930"
  },
  {
    "text": "will change the config map this configuration will be pushed to the - all the coordinates pods that are",
    "start": "584930",
    "end": "591050"
  },
  {
    "text": "running second you have this the",
    "start": "591050",
    "end": "596990"
  },
  {
    "text": "deployment so I I lighted here in the deployment what is a little specific you have always at least two replicas of",
    "start": "596990",
    "end": "604240"
  },
  {
    "text": "core DNS the labels I will go the labeled later first the image of",
    "start": "604240",
    "end": "611060"
  },
  {
    "text": "coordinates you have by default is located in cuba Nettie's repository",
    "start": "611060",
    "end": "616540"
  },
  {
    "text": "which means it's not the regular regular the usual docker hub core dns repository",
    "start": "616540",
    "end": "624170"
  },
  {
    "text": "each time we qualify the image Eastham you have a release for chip entities we",
    "start": "624170",
    "end": "629690"
  },
  {
    "text": "qualify the image and push the image on the cube and it is repository one thing",
    "start": "629690",
    "end": "635090"
  },
  {
    "text": "I wanted to say is CPU and memory so the request of memory is 70 mega bytes or",
    "start": "635090",
    "end": "645320"
  },
  {
    "text": "less that is that is what was for cube",
    "start": "645320",
    "end": "651110"
  },
  {
    "text": "DNS it's what you what you need but you have to know that either cube your",
    "start": "651110",
    "end": "656510"
  },
  {
    "text": "network or DNS we have to watch all the service and the larger your cluster is",
    "start": "656510",
    "end": "661790"
  },
  {
    "text": "the larger the more we will need memory so when you eat one thousand not too",
    "start": "661790",
    "end": "668230"
  },
  {
    "text": "thousand odd question then you may have to tune your memory sighs okay so it can",
    "start": "668230",
    "end": "673990"
  },
  {
    "text": "go the limit is 170 so we check that a we fit into 170 if you go to a 5,000",
    "start": "673990",
    "end": "679120"
  },
  {
    "text": "node cluster but depending your option you may have to need more or less memory",
    "start": "679120",
    "end": "685680"
  },
  {
    "text": "live nice pub there is a pub that check that coordinates is running and if if",
    "start": "685680",
    "end": "691720"
  },
  {
    "text": "not then the scheduler will automatically restart the pod okay so",
    "start": "691720",
    "end": "697810"
  },
  {
    "text": "that means the configuration of coordinates has to take care of that and the DNS policy because it's its problem",
    "start": "697810",
    "end": "705370"
  },
  {
    "text": "we see on on the supporters usually each pod of of cluster as a DNS policy called",
    "start": "705370",
    "end": "713200"
  },
  {
    "text": "first that means it will call the name cervical it will call Korean s as the regular name server except Corian s",
    "start": "713200",
    "end": "720340"
  },
  {
    "text": "because you don't want colonists try to call itself to resolve all right so that",
    "start": "720340",
    "end": "727000"
  },
  {
    "text": "is for the deployment and the last part is a service service is the same as before is even the same name it's take",
    "start": "727000",
    "end": "734890"
  },
  {
    "text": "cube dearness it is a DNS of kubernetes anyway there's no change from from",
    "start": "734890",
    "end": "741690"
  },
  {
    "text": "before and that was expected like that it is the DNS service anyway so you",
    "start": "741690",
    "end": "750340"
  },
  {
    "text": "don't want you won't see the change from cube DNS to cadenas same service and all",
    "start": "750340",
    "end": "755740"
  },
  {
    "text": "the pot that resolve genus wood will resolve for the cluster okay what is a",
    "start": "755740",
    "end": "763680"
  },
  {
    "start": "762000",
    "end": "762000"
  },
  {
    "text": "default configuration so in the config map you will have this information which we call the core file and I would like",
    "start": "763680",
    "end": "770770"
  },
  {
    "text": "to go so quickly over each of the ETM so each item is called a directive and the",
    "start": "770770",
    "end": "777160"
  },
  {
    "text": "directive of a plug-in code analysis based on plug-in and you just pile up",
    "start": "777160",
    "end": "784090"
  },
  {
    "text": "all your plugins so the most important is the Cheban it is one the one that will resolve a cuban it is request the",
    "start": "784090",
    "end": "793590"
  },
  {
    "text": "that will resolve the zone of communities the cluster of that local in",
    "start": "793590",
    "end": "798820"
  },
  {
    "text": "fact that is a sample we'll be replaced by this the zone you associate with your question that means",
    "start": "798820",
    "end": "806189"
  },
  {
    "text": "Q manatees will resolve everything that is in the cluster load balance at the",
    "start": "806189",
    "end": "812069"
  },
  {
    "text": "bottom just say if I have several reply for your request I will try to simulate",
    "start": "812069",
    "end": "821279"
  },
  {
    "text": "your load balancing by shuffle the order of the return records all right so that you that make an importance only for the",
    "start": "821279",
    "end": "829319"
  },
  {
    "text": "Atlas service where you can have all end point will we will be replied it's okay",
    "start": "829319",
    "end": "835499"
  },
  {
    "text": "if if your question about local then you will resolve your query with kubernetes if not that means out of cluster domain",
    "start": "835499",
    "end": "842429"
  },
  {
    "text": "so it will be resolved outside by your poxy to an upstream name server alright",
    "start": "842429",
    "end": "848309"
  },
  {
    "text": "and the list of names ever is by default in ATC resolve outcome for us it is on every every border or every machine we",
    "start": "848309",
    "end": "856220"
  },
  {
    "text": "have a cache 40-second so that works mostly for the upstream dns query",
    "start": "856220",
    "end": "864809"
  },
  {
    "text": "because kubernetes will will have a TTL of five second in fact next one is a",
    "start": "864809",
    "end": "870720"
  },
  {
    "text": "loop loop is just a very small plugin that detect that you have no loop in your resolution of queries that happen",
    "start": "870720",
    "end": "879029"
  },
  {
    "text": "sometime on some system so it's something that just stop coordinates if we detect a loop in the resolution you",
    "start": "879029",
    "end": "885149"
  },
  {
    "text": "go upstream that go back that go back and come back so we just send a query and if it comes back we say there's rope",
    "start": "885149",
    "end": "892790"
  },
  {
    "text": "health is the plug-in that serve the liveness status so you need it",
    "start": "892790",
    "end": "899549"
  },
  {
    "text": "in fact else go down if cube unit is plug-in cannot connect to the API or just the API disappear then alt will go",
    "start": "899549",
    "end": "907290"
  },
  {
    "text": "down and the scheduler will reschedule another part",
    "start": "907290",
    "end": "912799"
  },
  {
    "text": "arrow is just enabling the logging of our internal errors permit use is to",
    "start": "912799",
    "end": "919410"
  },
  {
    "text": "provide the matrix of primitives on the poor 91 53 and this one is an important",
    "start": "919410",
    "end": "924689"
  },
  {
    "text": "one hollowed it allows it allows core DNS to watch its own core file and",
    "start": "924689",
    "end": "931499"
  },
  {
    "text": "reload the service if you change the core file which means if you change the configured then that will push the call file and",
    "start": "931499",
    "end": "937989"
  },
  {
    "text": "call DNS is watching its own core file and we will all take care it will take about two minutes between the change on",
    "start": "937989",
    "end": "945369"
  },
  {
    "text": "your config map to have the co DNS server reloaded ok next thing before we",
    "start": "945369",
    "end": "959709"
  },
  {
    "start": "954000",
    "end": "954000"
  },
  {
    "text": "tune the configuration we need to work to see how how Co DNS behave and how it",
    "start": "959709",
    "end": "967059"
  },
  {
    "text": "resolves a query so I am on the left side I have a sample of a core file and",
    "start": "967059",
    "end": "974970"
  },
  {
    "text": "on the right I have its meaning inside of in terms of organization of the of",
    "start": "974970",
    "end": "982660"
  },
  {
    "text": "the processing of queries so as you can see on the left you have three big parts which we call the block server or stanza",
    "start": "982660",
    "end": "990220"
  },
  {
    "text": "one is organization comm so you it will match the left branch of history of",
    "start": "990220",
    "end": "997049"
  },
  {
    "text": "resolution the middle one unclaimed organization the right branch and and the last one the middle branch with a",
    "start": "997049",
    "end": "1003720"
  },
  {
    "text": "dot okay so each time on the on the blog server you have a domain name and the port you",
    "start": "1003720",
    "end": "1010379"
  },
  {
    "text": "may I mean nobody wants in code in Cuban it is to change the port because DNS has",
    "start": "1010379",
    "end": "1015509"
  },
  {
    "text": "to listen to port 53 as it won't work all the other products just to send the",
    "start": "1015509",
    "end": "1020609"
  },
  {
    "text": "query somewhere else but by default you will be on port 53 so how does it work",
    "start": "1020609",
    "end": "1026308"
  },
  {
    "text": "is on the tree when a queries come in so",
    "start": "1026309",
    "end": "1031500"
  },
  {
    "text": "let's say we have a query it will go it will get into the the tree decision by",
    "start": "1031500",
    "end": "1038730"
  },
  {
    "text": "the top and then depan we will go into the branch depending the domain queried",
    "start": "1038730",
    "end": "1043829"
  },
  {
    "text": "it will try to match the most specific domain you are querying so here",
    "start": "1043829",
    "end": "1049320"
  },
  {
    "text": "organization come the most specific would be on plan but that does not match so you will go on the left branch and we",
    "start": "1049320",
    "end": "1057539"
  },
  {
    "text": "reserve your query going by a verse cache and proxy so it will be it will be",
    "start": "1057539",
    "end": "1063169"
  },
  {
    "text": "resolved by your proxy 120 3.3.4 dot for that one",
    "start": "1063169",
    "end": "1069950"
  },
  {
    "text": "for this one if I take the next one my DB on-prem same thing I let's say I",
    "start": "1070010",
    "end": "1079800"
  },
  {
    "text": "push the query by the top there is a decision on the tree and it will go by the right branch because it match the",
    "start": "1079800",
    "end": "1086340"
  },
  {
    "text": "unclaimed organization it much also the organization that come but on-prem is more specific so it will take the right",
    "start": "1086340",
    "end": "1092670"
  },
  {
    "text": "branch I try to try another one my company that come so at the top level",
    "start": "1092670",
    "end": "1099740"
  },
  {
    "text": "does not match organization the nose match on crime organization but it matched the point point means everything",
    "start": "1099740",
    "end": "1105690"
  },
  {
    "text": "so that will go by the middle branch go down Chiba netic rest of the clock or it",
    "start": "1105690",
    "end": "1110880"
  },
  {
    "text": "does not match the crystal clock all will go to the next resolver proxy my",
    "start": "1110880",
    "end": "1116370"
  },
  {
    "text": "company oh yes it's match so it will be resolved by this proxy okay as soon as",
    "start": "1116370",
    "end": "1122670"
  },
  {
    "text": "you Ito resolve wear an orange orange plug in is a resolver it will take care if the the resolver",
    "start": "1122670",
    "end": "1130140"
  },
  {
    "text": "say on advertising on on the top a what domain I am resolving and as soon as you match",
    "start": "1130140",
    "end": "1139080"
  },
  {
    "text": "this one the resolver will handle it so they will not go down to any other resolver okay last one or I'll make up a",
    "start": "1139080",
    "end": "1149490"
  },
  {
    "text": "can go back this one service crostata local so as you can see --gel will go",
    "start": "1149490",
    "end": "1154950"
  },
  {
    "text": "some hole and will be resolved by the cube unit is plug in next one google.com",
    "start": "1154950",
    "end": "1161160"
  },
  {
    "text": "how does it work here so other job it will go by the middle bunch because of",
    "start": "1161160",
    "end": "1166920"
  },
  {
    "text": "the does not match anything else and in fact does not match anything so it will go by the last proxy dot because dot",
    "start": "1166920",
    "end": "1175620"
  },
  {
    "text": "match anything okay so it work it's just a decision of which branch I will go",
    "start": "1175620",
    "end": "1182790"
  },
  {
    "text": "with my query and then you organize your branch to to process your query",
    "start": "1182790",
    "end": "1191960"
  },
  {
    "text": "okay so next slide so the first configuration maybe you want you want to",
    "start": "1193570",
    "end": "1199130"
  },
  {
    "start": "1195000",
    "end": "1195000"
  },
  {
    "text": "tune is I have some stub domain that are not public I mean they will never be",
    "start": "1199130",
    "end": "1205580"
  },
  {
    "text": "resolved by your public dns resolver or I know that it will be resolved but it",
    "start": "1205580",
    "end": "1212600"
  },
  {
    "text": "will take a long time so I would like to make a shortcut and and just push to the right IP of the name cell of the",
    "start": "1212600",
    "end": "1220010"
  },
  {
    "text": "authorized or authoritative name server for this domain so you just want to",
    "start": "1220010",
    "end": "1226730"
  },
  {
    "text": "create this block server you have on the lot for corporate or local cooperate and proxy to the right IP okay so the way to",
    "start": "1226730",
    "end": "1236059"
  },
  {
    "text": "write it is okay you add a blog server with your domain and add a proxy plug-in",
    "start": "1236059",
    "end": "1242110"
  },
  {
    "text": "point means I match everything that will go into this branch and I forward to the",
    "start": "1242110",
    "end": "1248059"
  },
  {
    "text": "IP I provide after you can provide several IPS in that you can provide",
    "start": "1248059",
    "end": "1255140"
  },
  {
    "text": "several IPS in that case there will be an automatic round-robin between all the",
    "start": "1255140",
    "end": "1261230"
  },
  {
    "text": "IPS okay next thing you may want to do is",
    "start": "1261230",
    "end": "1270289"
  },
  {
    "start": "1268000",
    "end": "1268000"
  },
  {
    "text": "okay for specific domain I want a specific IP but maybe I will also tune",
    "start": "1270289",
    "end": "1275690"
  },
  {
    "text": "some of the other configuration the first one is a cache for example by",
    "start": "1275690",
    "end": "1280880"
  },
  {
    "text": "default it is 40 second for your corporate you know it is it it does not",
    "start": "1280880",
    "end": "1285919"
  },
  {
    "text": "change too much so you prefer to have a cache of for one hour for example you",
    "start": "1285919",
    "end": "1291860"
  },
  {
    "text": "may want also to log some special queries just to to monitor your your",
    "start": "1291860",
    "end": "1299390"
  },
  {
    "text": "queries so that that in fact that fix I",
    "start": "1299390",
    "end": "1305470"
  },
  {
    "text": "don't know 80% of of the problem of people that want to tune in in Cubana",
    "start": "1305470",
    "end": "1310970"
  },
  {
    "text": "T's after the 20% I will let John explain what else you can do anyway I",
    "start": "1310970",
    "end": "1319520"
  },
  {
    "text": "went quickly into this proxy each one has a lot of configuration please go to",
    "start": "1319520",
    "end": "1324799"
  },
  {
    "text": "the a website of core DNS are your plugins to have a description and the list of",
    "start": "1324799",
    "end": "1331030"
  },
  {
    "text": "option of a proxy of log of arrow of cache you can do a lot of tuning on each",
    "start": "1331030",
    "end": "1336550"
  },
  {
    "text": "of these plugins thank you so John it's",
    "start": "1336550",
    "end": "1342220"
  },
  {
    "text": "up to you alright hello everybody so I'll talk a little bit more of some of",
    "start": "1342220",
    "end": "1347320"
  },
  {
    "start": "1346000",
    "end": "1346000"
  },
  {
    "text": "the things you can do that are outside the defaults things that maybe aren't as common but what might be interesting to",
    "start": "1347320",
    "end": "1352990"
  },
  {
    "text": "people a little bit about different options specifically within the kubernetes plugin there's also several",
    "start": "1352990",
    "end": "1359950"
  },
  {
    "text": "other plugins that are really built specifically for kubernetes and then a",
    "start": "1359950",
    "end": "1365050"
  },
  {
    "text": "few of these other use cases that cricut credit mentioned in the beginning so",
    "start": "1365050",
    "end": "1370810"
  },
  {
    "start": "1370000",
    "end": "1370000"
  },
  {
    "text": "looking at the these are the most commonly potentially changed options within the kubernetes plug-in the the",
    "start": "1370810",
    "end": "1378790"
  },
  {
    "text": "first one here controls of whether or not we reply to the pod namespace so normally the subdomain for services is",
    "start": "1378790",
    "end": "1386530"
  },
  {
    "text": "SVC dot cluster dot local there's also one pod dot cluster at local that's in cube DNS basically just",
    "start": "1386530",
    "end": "1394120"
  },
  {
    "text": "anything any name you give it that looks like an IP address it will reply with",
    "start": "1394120",
    "end": "1399790"
  },
  {
    "text": "that IP which is not ideal so we have a few different modes you can completely disable it or you can have it actually",
    "start": "1399790",
    "end": "1407350"
  },
  {
    "text": "only reply with the IP address of the pod if that's actually a pod in that actual namespace endpoint pod names will",
    "start": "1407350",
    "end": "1414940"
  },
  {
    "text": "allow you to instead of using some random numbers as the endpoint name and",
    "start": "1414940",
    "end": "1420430"
  },
  {
    "text": "a headless service it will use the pod name by default and of course you can change TTL follow through is interesting",
    "start": "1420430",
    "end": "1427360"
  },
  {
    "text": "and we'll talk a little bit more about that that's a sort of internal way to allow more than one plug-in to be",
    "start": "1427360",
    "end": "1433390"
  },
  {
    "text": "authoritative on a given zone there are a bunch of other options too that are",
    "start": "1433390",
    "end": "1438850"
  },
  {
    "start": "1437000",
    "end": "1437000"
  },
  {
    "text": "not going to be as commonly used so these top ones here are really about how",
    "start": "1438850",
    "end": "1445210"
  },
  {
    "text": "to connect to the API server when you deploy it as cluster DNS which is really what this talk is about that's not an",
    "start": "1445210",
    "end": "1451720"
  },
  {
    "text": "issue because it's all done through the service account and and all of that but if you want to deploy core DNS external to the cluster",
    "start": "1451720",
    "end": "1458250"
  },
  {
    "text": "for some reason then you would make use of these these options there's another",
    "start": "1458250",
    "end": "1464580"
  },
  {
    "text": "set of options around filtering or what we what we actually expose so a question came up I believe in the intro about can",
    "start": "1464580",
    "end": "1471000"
  },
  {
    "text": "we limit the what we show to a namespace actually we can when you're running as",
    "start": "1471000",
    "end": "1476730"
  },
  {
    "text": "cluster DNS that's probably not what you want to do in general but there are some use cases around only exposing a narrow",
    "start": "1476730",
    "end": "1482880"
  },
  {
    "text": "set of names so you can do with a label selector you can do it with namespace or both there's also some little tweaks you",
    "start": "1482880",
    "end": "1489090"
  },
  {
    "text": "can do on on how the how the results are returned",
    "start": "1489090",
    "end": "1495919"
  },
  {
    "text": "Padma these two we already talked about as well as as all of these we also do support zone transfer so you can with",
    "start": "1496290",
    "end": "1505920"
  },
  {
    "text": "your dig client or with some other name server you can initiate a transfer and get all of the the cluster zone records",
    "start": "1505920",
    "end": "1514200"
  },
  {
    "text": "into your other name server it's also very useful for debugging if you're",
    "start": "1514200",
    "end": "1519450"
  },
  {
    "text": "trying to figure out what what records are there in Inc or DNS you can do a",
    "start": "1519450",
    "end": "1525510"
  },
  {
    "text": "zone transfer just on the command line and see all the options so here are a few of the plugins the as far as well",
    "start": "1525510",
    "end": "1533100"
  },
  {
    "text": "said we sort of categorized these into a few different categories there's plugins that just modify the configuration of",
    "start": "1533100",
    "end": "1539460"
  },
  {
    "text": "the overall server there's these middleware that manipulate the query and",
    "start": "1539460",
    "end": "1544890"
  },
  {
    "text": "make some changes to it and then there's the back ends or resolvers that actually provide a source of data for for is that",
    "start": "1544890",
    "end": "1553740"
  },
  {
    "text": "for resource records the there's actually a whole bunch more and we have",
    "start": "1553740",
    "end": "1559950"
  },
  {
    "text": "this whole deck as a PDF in the sched",
    "start": "1559950",
    "end": "1565490"
  },
  {
    "text": "thing and then you can follow these links and see the whole list of various",
    "start": "1565490",
    "end": "1571230"
  },
  {
    "text": "plugins one thing to note this second",
    "start": "1571230",
    "end": "1577560"
  },
  {
    "text": "bullet here is that all of these plugins are company the default image compiles",
    "start": "1577560",
    "end": "1584160"
  },
  {
    "text": "in a bunch of plugins they're not plugins that you can load they are compiled in plugins so and not",
    "start": "1584160",
    "end": "1591520"
  },
  {
    "text": "only that but the ordering is specific to compile time so if you want to do something really different than most",
    "start": "1591520",
    "end": "1597280"
  },
  {
    "text": "people you may have to roll your own image okay let's look at the other",
    "start": "1597280",
    "end": "1606340"
  },
  {
    "start": "1603000",
    "end": "1603000"
  },
  {
    "text": "plugins that are a check time check here let's look at the other plugins related",
    "start": "1606340",
    "end": "1613420"
  },
  {
    "text": "this one of the most interesting is is what we call auto path and there's I think for a swallow cricut alluded to",
    "start": "1613420",
    "end": "1620679"
  },
  {
    "text": "this a little earlier that I think Cricut there there's a lot of different",
    "start": "1620679",
    "end": "1626160"
  },
  {
    "start": "1622000",
    "end": "1622000"
  },
  {
    "text": "long search paths in kubernetes so when you go to make a query you can use a",
    "start": "1626160",
    "end": "1631570"
  },
  {
    "text": "name just like foo and it'll check if that's the name of a service in the name",
    "start": "1631570",
    "end": "1637030"
  },
  {
    "text": "space of the pod that's making the query if not it'll you know check the check",
    "start": "1637030",
    "end": "1643620"
  },
  {
    "text": "you know it'll walk this whole path from name space that service that cluster to",
    "start": "1643620",
    "end": "1648880"
  },
  {
    "text": "service dot cluster that local cluster that local and then all of the nodes search paths so if you're in a cloud",
    "start": "1648880",
    "end": "1655870"
  },
  {
    "text": "environment sometimes that'll have regional names there can be a whole bunch so what you end up with and this",
    "start": "1655870",
    "end": "1661690"
  },
  {
    "text": "is one of the sources of a lot of issues DNS issues in kubernetes is you can end",
    "start": "1661690",
    "end": "1666730"
  },
  {
    "text": "up with making one query one lookup you're trying to find google.com and it",
    "start": "1666730",
    "end": "1673179"
  },
  {
    "text": "tries all of these different different thanks now these are tried from the client so the actual client makes a",
    "start": "1673179",
    "end": "1679150"
  },
  {
    "text": "request to the server gets a response we which is in the next domain no such",
    "start": "1679150",
    "end": "1684880"
  },
  {
    "text": "domain it makes another request makes another request every single one of those is UDP could timeout could be lost",
    "start": "1684880",
    "end": "1690700"
  },
  {
    "text": "could have a five second timeout waiting for it so it can run into a lot of problems plus it kind of pollutes the",
    "start": "1690700",
    "end": "1696970"
  },
  {
    "text": "contract entries in the in the node so we we looked at this and we said well",
    "start": "1696970",
    "end": "1703710"
  },
  {
    "start": "1701000",
    "end": "1701000"
  },
  {
    "text": "since we're already watching the kubernetes api if we watch pods as well",
    "start": "1703710",
    "end": "1709840"
  },
  {
    "text": "as the other things we normally watch we can take the source IP address of the client look up the pod that that belongs",
    "start": "1709840",
    "end": "1716260"
  },
  {
    "text": "to and what namespace it's in and then we can figure out what that search path actually is in the pod all on the server-side so",
    "start": "1716260",
    "end": "1724150"
  },
  {
    "text": "if you enable the the pods verified mode which causes a watch on pods and you",
    "start": "1724150",
    "end": "1729429"
  },
  {
    "text": "enable the auto path plug-in we will follow that entire path on the server",
    "start": "1729429",
    "end": "1735970"
  },
  {
    "text": "side and then return a what's called a cname or an alias record that that that",
    "start": "1735970",
    "end": "1742080"
  },
  {
    "text": "points to the real record so essentially what that means in this",
    "start": "1742080",
    "end": "1748480"
  },
  {
    "text": "case instead of doing those five queries from the client to the server you do the",
    "start": "1748480",
    "end": "1753760"
  },
  {
    "text": "one query from the client of the server and it turns a result immediately so this is what this looks like this is one",
    "start": "1753760",
    "end": "1760809"
  },
  {
    "text": "of our our users actually Oh a year ago sent me this graph saying hey I enabled",
    "start": "1760809",
    "end": "1767350"
  },
  {
    "text": "it and all these you know the latency dropped dramatically on all these requests to this",
    "start": "1767350",
    "end": "1772690"
  },
  {
    "text": "that's three bucket or something well so why wouldn't we enable this by default and there's a good reason the the pods",
    "start": "1772690",
    "end": "1781480"
  },
  {
    "text": "verified adds load your API server and adds memory to the actual core DNS",
    "start": "1781480",
    "end": "1787419"
  },
  {
    "text": "instance so if you've got a very large cluster it's not advisable to enable",
    "start": "1787419",
    "end": "1792640"
  },
  {
    "text": "that option so for a default type of setup we couldn't really do that there's",
    "start": "1792640",
    "end": "1798970"
  },
  {
    "text": "also a very strange edge case when you have caching enabled that you can",
    "start": "1798970",
    "end": "1807130"
  },
  {
    "text": "sometimes get the wrong name wrong answer if you have services and endpoints and name spaces that have kind",
    "start": "1807130",
    "end": "1813730"
  },
  {
    "text": "of colliding names all right this next one's really interesting this",
    "start": "1813730",
    "end": "1820690"
  },
  {
    "start": "1817000",
    "end": "1817000"
  },
  {
    "text": "is something we're working on it's not done but I think it's something people will be will be happy to see we expect",
    "start": "1820690",
    "end": "1827080"
  },
  {
    "text": "this to be in 1.3 the idea here is that normally for in cluster DNS the records",
    "start": "1827080",
    "end": "1834820"
  },
  {
    "text": "that we are creating and returning are for those those in cluster service names cluster dot local but of course if we",
    "start": "1834820",
    "end": "1842200"
  },
  {
    "text": "want to actually create a service that's usable by by people outside of the",
    "start": "1842200",
    "end": "1847870"
  },
  {
    "text": "cluster then those are useless names we have all the we have a lot of metadata",
    "start": "1847870",
    "end": "1853539"
  },
  {
    "text": "anyway that we may be able to expose the load balancer IP addresses or the external IPS on the service directly to the",
    "start": "1853539",
    "end": "1863200"
  },
  {
    "text": "outside world with another name so that's what this plug-in does it it piggy backs on the kubernetes connection",
    "start": "1863200",
    "end": "1869250"
  },
  {
    "text": "and allows you to specify a zone that  for which we should present all of",
    "start": "1869250",
    "end": "1877570"
  },
  {
    "text": "these load balancers actually external IPs you could run this internally with",
    "start": "1877570",
    "end": "1883750"
  },
  {
    "text": "the same cluster DNS and expose that cluster DNS or you could run a separate core DNS instance which would be really",
    "start": "1883750",
    "end": "1890169"
  },
  {
    "text": "the best practice to separate those out since you've got external traffic you can't really control and another comment",
    "start": "1890169",
    "end": "1900850"
  },
  {
    "text": "on that this is an unfortunate thing if you're using AWS or or Google Cloud I don't know about azure but the load",
    "start": "1900850",
    "end": "1907779"
  },
  {
    "text": "balancers only support either TCP or UDP and at least from kubernetes",
    "start": "1907779",
    "end": "1914320"
  },
  {
    "text": "configuration which is basically kills using them for DNS without some manual",
    "start": "1914320",
    "end": "1919570"
  },
  {
    "text": "intervention so if you do want to use this you might have to do some extra rules in your load balancers not through",
    "start": "1919570",
    "end": "1925210"
  },
  {
    "text": "the to expose this particular service not not to expose the other services but to expose the DNS service do it time how",
    "start": "1925210",
    "end": "1939028"
  },
  {
    "start": "1933000",
    "end": "1933000"
  },
  {
    "text": "cou Burnette I so this is an external plugin that you'd have to build I would have it's out of tree you'd have to do a",
    "start": "1939779",
    "end": "1945340"
  },
  {
    "text": "custom build for it but this is something we built actually originally for Sto I don't I think been using it",
    "start": "1945340",
    "end": "1951809"
  },
  {
    "text": "the idea is that we should be able to have the same name server talk to",
    "start": "1951809",
    "end": "1957850"
  },
  {
    "text": "multiple API servers using say a different cluster zone and provide",
    "start": "1957850",
    "end": "1964539"
  },
  {
    "text": "service for all of those so if you this can this can do a sort of poor-man's",
    "start": "1964539",
    "end": "1971529"
  },
  {
    "text": "Federation where you can essentially look up you can be sitting in your cluster and by using this plug-in along",
    "start": "1971529",
    "end": "1979360"
  },
  {
    "text": "with fall through which said you could have the same same name be responded to",
    "start": "1979360",
    "end": "1986470"
  },
  {
    "text": "if the it would ask for the local cluster if there's nothing in the local cluster it would go out to the next",
    "start": "1986470",
    "end": "1991810"
  },
  {
    "text": "cluster and try and resolve that name that works for headless services when",
    "start": "1991810",
    "end": "1997240"
  },
  {
    "text": "you have routable potties cluster I peas are not routable that's what why this isn't default or built-in it's kind of",
    "start": "1997240",
    "end": "2003900"
  },
  {
    "text": "special purpose because cluster I peas generally aren't routable okay two other",
    "start": "2003900",
    "end": "2013620"
  },
  {
    "start": "2011000",
    "end": "2011000"
  },
  {
    "text": "ways to go about and make changes I believe it was mentioned earlier that we could add add some static data to the",
    "start": "2013620",
    "end": "2019710"
  },
  {
    "text": "zone and then there's a query rewrite which has some interesting use cases the",
    "start": "2019710",
    "end": "2025910"
  },
  {
    "start": "2022000",
    "end": "2022000"
  },
  {
    "text": "adding set of Gators because c√°rdenas is just a DNS server and kubernetes happens to be one of the things that does it",
    "start": "2025910",
    "end": "2032670"
  },
  {
    "text": "also serves zone files and it serves can you conserve inline records right out of the core file using the hosts plugin so",
    "start": "2032670",
    "end": "2039300"
  },
  {
    "text": "this enables us to essentially override individual names if we want with the",
    "start": "2039300",
    "end": "2044910"
  },
  {
    "text": "host plug-in or actually populate subdomains that that aren't that are",
    "start": "2044910",
    "end": "2051360"
  },
  {
    "text": "subdomains of the cluster dot local but not normally part of kubernetes this is",
    "start": "2051360",
    "end": "2056580"
  },
  {
    "text": "an example of how to do that with the auto plug-in which automatically loads own files out of a directory another",
    "start": "2056580",
    "end": "2065970"
  },
  {
    "start": "2065000",
    "end": "2065000"
  },
  {
    "text": "option that we think people may be interested in is query rewriting so we saw this the particularly use case this",
    "start": "2065970",
    "end": "2072300"
  },
  {
    "text": "really helps with is if you have you have an existing certificate that's got",
    "start": "2072300",
    "end": "2077879"
  },
  {
    "text": "say a public name on it but you want your in cluster services to be able to access that in cluster without going all",
    "start": "2077880",
    "end": "2085080"
  },
  {
    "text": "the way out outside you can actually rewrite that name so your your pod your",
    "start": "2085080",
    "end": "2090360"
  },
  {
    "text": "client in the cluster uses the public name the DNS looks at that public name and says oh that actually corresponds to",
    "start": "2090360",
    "end": "2096659"
  },
  {
    "text": "this service over here this internal name resolves that service to an IP",
    "start": "2096660",
    "end": "2102450"
  },
  {
    "text": "address and then returns that IP address to the to the client so things running",
    "start": "2102450",
    "end": "2109800"
  },
  {
    "text": "inside the cluster using food out example.com will get an in cluster IP",
    "start": "2109800",
    "end": "2115410"
  },
  {
    "text": "and things outside the cluster using food out example that we'll get say a load balancer IP that talks into the into the service so the",
    "start": "2115410",
    "end": "2122640"
  },
  {
    "text": "same certificate can be used so that's",
    "start": "2122640",
    "end": "2127680"
  },
  {
    "text": "really what I wanted to discuss so if we have time for QA be happy to answer any questions",
    "start": "2127680",
    "end": "2134690"
  },
  {
    "text": "[Applause]",
    "start": "2136180",
    "end": "2142589"
  }
]