[
  {
    "start": "0",
    "end": "46000"
  },
  {
    "text": "hello everyone and welcome to our talk on testing kubernetes clusters and",
    "start": "1839",
    "end": "7200"
  },
  {
    "text": "building confidence in your changes um in terms of what we're going to cover",
    "start": "7200",
    "end": "12400"
  },
  {
    "text": "today uh we'll cover a little about us um then we'll go over the problems that",
    "start": "12400",
    "end": "17760"
  },
  {
    "text": "we faced and that prompted us to go down this investigation rate and building our own solution",
    "start": "17760",
    "end": "23199"
  },
  {
    "text": "and then give an overview of the potential solutions that we looked at",
    "start": "23199",
    "end": "29119"
  },
  {
    "text": "uh give you a deep dive into our solution how it works and the the components that we brought together to",
    "start": "29119",
    "end": "35120"
  },
  {
    "text": "make it work and then finally cover some dutch's tips and other options",
    "start": "35120",
    "end": "40640"
  },
  {
    "text": "for you so in terms of who we are um i'm a guy i'm",
    "start": "40640",
    "end": "47120"
  },
  {
    "start": "46000",
    "end": "46000"
  },
  {
    "text": "a principal software engineer at scott scanner um i work um on the teams responsible for uh",
    "start": "47120",
    "end": "54000"
  },
  {
    "text": "our shared container platform so and for the most part that's kubernetes um and enabling the rest of the business",
    "start": "54000",
    "end": "60480"
  },
  {
    "text": "to build applications on top of that and that operate reliably at scale",
    "start": "60480",
    "end": "65840"
  },
  {
    "text": "um in addition to that i'm also a co-chair of kubernetes auto scaling and",
    "start": "65840",
    "end": "71200"
  },
  {
    "text": "it could be found on most places on the internet under the handle gj templeton",
    "start": "71200",
    "end": "77360"
  },
  {
    "start": "77000",
    "end": "77000"
  },
  {
    "text": "hello everyone thank you for joining us my name is mattel i'm a senior software engineer here at stress camera where",
    "start": "77360",
    "end": "84159"
  },
  {
    "text": "i work with guy on keeping our kubernetes infrastructure up and running in the",
    "start": "84159",
    "end": "90320"
  },
  {
    "text": "production platform tribe uh you can find me technically on twitter but yeah please",
    "start": "90320",
    "end": "96960"
  },
  {
    "text": "look for me on github so um we both write for skyscanner um",
    "start": "96960",
    "end": "103439"
  },
  {
    "text": "who are the sky scanner um so we're the travel company that puts you first um we",
    "start": "103439",
    "end": "108640"
  },
  {
    "text": "help millions of people millions of people in 52 countries over 30 languages find best travel options for",
    "start": "108640",
    "end": "114720"
  },
  {
    "text": "not only flights but also hotels and carhart each month and work with over",
    "start": "114720",
    "end": "120600"
  },
  {
    "text": "1200 travel partners to enable that",
    "start": "120600",
    "end": "125040"
  },
  {
    "text": "in terms of kubernetes at skyscannerville um we've been running the case since um 1.6",
    "start": "126079",
    "end": "133040"
  },
  {
    "text": "release and we over that time we have built up the the number of clusters we have to more than",
    "start": "133040",
    "end": "139680"
  },
  {
    "text": "35 production clusters at this point and spread across four different aws regions",
    "start": "139680",
    "end": "145200"
  },
  {
    "text": "and then on those clusters we've got 475 and more services and most of them",
    "start": "145200",
    "end": "152000"
  },
  {
    "text": "running in multiple clusters multiple regions for improved resilience um to a number of",
    "start": "152000",
    "end": "158400"
  },
  {
    "text": "different uh potential scenarios um and in terms of scaling the clusters underneath them we've currently we",
    "start": "158400",
    "end": "164959"
  },
  {
    "text": "currently run about 40 000 plus cpu cores across the clusters with about 150",
    "start": "164959",
    "end": "170000"
  },
  {
    "text": "terabytes of ram at any one time as well",
    "start": "170000",
    "end": "174000"
  },
  {
    "text": "so what do we want to talk about today well uh if you",
    "start": "175360",
    "end": "180959"
  },
  {
    "text": "run kubernetes you're probably aware that it's it's a complex platform let's be honest there are like multiple",
    "start": "180959",
    "end": "186959"
  },
  {
    "text": "microservices api servers distributed database and if you're running a production",
    "start": "186959",
    "end": "193280"
  },
  {
    "text": "workload on top of kubernetes you probably also want to install a few other components for example",
    "start": "193280",
    "end": "200239"
  },
  {
    "text": "uh you have your you might have your cni uh maybe you have a service mesh or maybe you have an ingress controller uh",
    "start": "200239",
    "end": "207680"
  },
  {
    "text": "you probably wanted to do something about the metrics and logging so you have a set of",
    "start": "207680",
    "end": "213440"
  },
  {
    "text": "observability components and",
    "start": "213440",
    "end": "218000"
  },
  {
    "text": "while kubernetes has a good set of unit and integration tests",
    "start": "219200",
    "end": "224799"
  },
  {
    "text": "on its own and i'm pretty sure that all the others that you're running they have their own set of tests",
    "start": "224799",
    "end": "231760"
  },
  {
    "text": "the very difficult thing is here is when you glue everything together so how do you test your kubernetes setup",
    "start": "231760",
    "end": "238239"
  },
  {
    "text": "with all the components you care about with all your configuration inside either your",
    "start": "238239",
    "end": "244239"
  },
  {
    "text": "uh cloud environment maybe you're running in aws like we do or",
    "start": "244239",
    "end": "249360"
  },
  {
    "text": "you're running on premises why do you care about making sure that",
    "start": "249360",
    "end": "255120"
  },
  {
    "start": "252000",
    "end": "252000"
  },
  {
    "text": "everything is up there it works just better why why do you want to test that well the obvious things is that you want",
    "start": "255120",
    "end": "261519"
  },
  {
    "text": "to reduce the disruption when you make a change into the clusters you want to keep your customer happy with users",
    "start": "261519",
    "end": "267360"
  },
  {
    "text": "happy you also want to do something for the people responsible for the cluster so maybe",
    "start": "267360",
    "end": "273040"
  },
  {
    "text": "your squad you want to push out features",
    "start": "273040",
    "end": "278240"
  },
  {
    "text": "for your users and then you want to keep like a decent velocity so you want to be able to reliable uh",
    "start": "278240",
    "end": "285199"
  },
  {
    "text": "test and making sure that achieve something that you're pushing out is working and it's not breaking anything",
    "start": "285199",
    "end": "291520"
  },
  {
    "text": "this gives you like confidence that uh the users are getting the behavior",
    "start": "291520",
    "end": "298320"
  },
  {
    "text": "they're respecting it also gives you a baseline so if you make a change then you can",
    "start": "298320",
    "end": "304320"
  },
  {
    "text": "pinpoint like when the behavior changed or when something broke",
    "start": "304320",
    "end": "309440"
  },
  {
    "text": "and maybe helps you like in better troubleshooting",
    "start": "309440",
    "end": "314880"
  },
  {
    "text": "so um we've covered now the the problem the reasons we wanted to look at this and so",
    "start": "316639",
    "end": "322400"
  },
  {
    "text": "we we started to exploring what our potential solutions to enable us then to do this work um",
    "start": "322400",
    "end": "328320"
  },
  {
    "start": "327000",
    "end": "327000"
  },
  {
    "text": "so the first um which i assume many of you are familiar with is it was manual acceptance testing so the idea of",
    "start": "328320",
    "end": "335039"
  },
  {
    "text": "we'd stick a manual approval gate in our continuous deployment pipelines and that would give us the opportunity as",
    "start": "335039",
    "end": "341280"
  },
  {
    "text": "operators to go and run some manual acceptance tests against clusters or against individual nodes whatever it may",
    "start": "341280",
    "end": "348240"
  },
  {
    "text": "be before manually approving the the pipeline to continue",
    "start": "348240",
    "end": "353520"
  },
  {
    "text": "um the problem obviously with that is as we've scaled up to 35 clusters",
    "start": "353520",
    "end": "358800"
  },
  {
    "text": "that this this solution doesn't really scale as the number of clusters uh increases so increa increase increases",
    "start": "358800",
    "end": "366000"
  },
  {
    "text": "every new cluster adds to your toil burden and unlike with an automated solution and",
    "start": "366000",
    "end": "372000"
  },
  {
    "text": "it's also easy to make mistakes and it's inconsistent even if you've made it into run books if you're still relying on",
    "start": "372000",
    "end": "378319"
  },
  {
    "text": "engineers correctly running the run books with the correct options for instance or copying and pasting commands",
    "start": "378319",
    "end": "384319"
  },
  {
    "text": "in from runebooks you you've you've still got a human factor in there and a risk that things won't quite",
    "start": "384319",
    "end": "391520"
  },
  {
    "text": "actually be what you thought you had run um so for that reason we sort of rolled out",
    "start": "391520",
    "end": "397520"
  },
  {
    "start": "397000",
    "end": "397000"
  },
  {
    "text": "manual acceptance sites pretty quickly and the next option we looked at was a custom service and we ran with this for",
    "start": "397520",
    "end": "403919"
  },
  {
    "text": "for actually quite a while and in this case we spun up a microservice on our cluster um",
    "start": "403919",
    "end": "409680"
  },
  {
    "text": "and that microservice hud had our back permissions to create codes create and modify some some objects",
    "start": "409680",
    "end": "416400"
  },
  {
    "text": "inside the cluster um and that that was constantly on a running these tests and",
    "start": "416400",
    "end": "422639"
  },
  {
    "text": "that that had a good benefit and that it made it easier to catch any degradation",
    "start": "422639",
    "end": "427680"
  },
  {
    "text": "so if we made changes and say uh it worked fine initially but six hours later something could say bogged down",
    "start": "427680",
    "end": "434560"
  },
  {
    "text": "the api server to the point that things weren't working the way you thought they should anymore this this would actually",
    "start": "434560",
    "end": "441440"
  },
  {
    "text": "catch that it exposed metrics so we could alert on those that that was a real benefit of this approach the the",
    "start": "441440",
    "end": "447360"
  },
  {
    "text": "downsides however where that the way we implemented at least it was harder to block our update pipelines on so we we",
    "start": "447360",
    "end": "454240"
  },
  {
    "text": "couldn't we couldn't as easily basically say i have a conditional in our continuous deployment test of if these",
    "start": "454240",
    "end": "460720"
  },
  {
    "text": "tests fail the next time the loop evaluates then after we've made these changes then",
    "start": "460720",
    "end": "466160"
  },
  {
    "text": "block um and the other was it's not there was no easy ability for us from a",
    "start": "466160",
    "end": "471919"
  },
  {
    "text": "talk test when when where we wanted we were at the mercy of the the loop that was evaluating these things",
    "start": "471919",
    "end": "478960"
  },
  {
    "text": "um and we could have we could have done work to fix that but we took the opportunity to look at other",
    "start": "478960",
    "end": "485199"
  },
  {
    "text": "options to see if there were a better battery um so the next option was building on top of existing frameworks and so",
    "start": "485199",
    "end": "491919"
  },
  {
    "text": "there's existing infrastructure and kubernetes testing frameworks and this would have minimized",
    "start": "491919",
    "end": "497360"
  },
  {
    "text": "the custom work they had to do and these different frameworks have a number of different different benefits some are",
    "start": "497360",
    "end": "503280"
  },
  {
    "text": "written in gold some are in python um some are very very cognitive focused",
    "start": "503280",
    "end": "508560"
  },
  {
    "text": "some are way more generic and have their origins from before kubernetes um so there's",
    "start": "508560",
    "end": "515518"
  },
  {
    "text": "there are a number of options we've looked at there um and then we looked at",
    "start": "515519",
    "end": "522000"
  },
  {
    "start": "519000",
    "end": "519000"
  },
  {
    "text": "more specific like provided and supported by the kubernetes core kubernetes community um options um",
    "start": "522000",
    "end": "529760"
  },
  {
    "text": "so the first option we looked at was um cube test uh this is a stored in the",
    "start": "529760",
    "end": "535279"
  },
  {
    "text": "kubernetes test center repo and there's a framework that allows for the creation and teardown of test clusters um it",
    "start": "535279",
    "end": "542000"
  },
  {
    "text": "supports the addition of custom bingo tests and it's supported by the kubernetes project but it does come with",
    "start": "542000",
    "end": "548800"
  },
  {
    "text": "extra overhead and because obviously if you're tearing up spinning up and tearing down clusters",
    "start": "548800",
    "end": "554320"
  },
  {
    "text": "you've got to wait for that creation and teardown to happen anytime you're running these tests however the biggest",
    "start": "554320",
    "end": "560240"
  },
  {
    "text": "drawback of this for us was it's not necessarily representative of our production clusters say we've had a",
    "start": "560240",
    "end": "566399"
  },
  {
    "text": "production cluster running for six months um we've we've had many changes um",
    "start": "566399",
    "end": "572080"
  },
  {
    "text": "applied over time spinning up a fresh new cluster and applying all the components you think are in your cluster is not",
    "start": "572080",
    "end": "578959"
  },
  {
    "text": "mess it is almost certainly not actually going to be representative of that cluster that's had accreted changes on",
    "start": "578959",
    "end": "585279"
  },
  {
    "text": "it um so that that was the main drawback here for us",
    "start": "585279",
    "end": "591040"
  },
  {
    "start": "590000",
    "end": "590000"
  },
  {
    "text": "then we started looking at the conformance suite and so you might be familiar with this if you've ever had a",
    "start": "591040",
    "end": "596640"
  },
  {
    "text": "look at the certification of managed kubernetes",
    "start": "596640",
    "end": "601760"
  },
  {
    "text": "offerings these are the tests that um cloud providers or any provider of a",
    "start": "601760",
    "end": "607440"
  },
  {
    "text": "certified kubernetes offering has to validate that they've run against their offering and all these tests passed they",
    "start": "607440",
    "end": "613600"
  },
  {
    "text": "test a huge range of core kubernetes functionality make sure it all works with an acceptable limits",
    "start": "613600",
    "end": "619519"
  },
  {
    "text": "etc etc um so that that would have made it really easy for us to use the community's",
    "start": "619519",
    "end": "625440"
  },
  {
    "text": "existing tests um however the downsides that are obviously because of the range of the tests in",
    "start": "625440",
    "end": "631680"
  },
  {
    "text": "there it's really time consuming to run that entire suite um there's there's some disruptive tests if you're running",
    "start": "631680",
    "end": "638079"
  },
  {
    "text": "the full suite although by default it doesn't run the disruptive test um and also",
    "start": "638079",
    "end": "643920"
  },
  {
    "text": "you're not necessarily testing the behavior that your users care about our users don't care about you know",
    "start": "643920",
    "end": "651120"
  },
  {
    "text": "some of the low level stuff what they care about is is my application skill",
    "start": "651120",
    "end": "656880"
  },
  {
    "text": "the thing that conformance suite did lead us to though was the tool that's used to",
    "start": "656880",
    "end": "662480"
  },
  {
    "start": "657000",
    "end": "657000"
  },
  {
    "text": "run the conformance suite which is a tool called sona boy uh it's an open source tool for vmware um it's it's very",
    "start": "662480",
    "end": "669600"
  },
  {
    "text": "active community constantly improving project and but the killer feature for us was the ability to run custom tests",
    "start": "669600",
    "end": "676560"
  },
  {
    "text": "by the creation of plugins so that meant that we could build our own tests only testing the functionality we could care",
    "start": "676560",
    "end": "682720"
  },
  {
    "text": "about into into binary and use sonaboy to run that",
    "start": "682720",
    "end": "688800"
  },
  {
    "text": "so what did we choose uh to iterate from our from our custom",
    "start": "688800",
    "end": "695200"
  },
  {
    "text": "solution so uh before taking a decision like we we sat down and then we look at what we",
    "start": "695200",
    "end": "701680"
  },
  {
    "start": "696000",
    "end": "696000"
  },
  {
    "text": "wanted from from our next generation tool and uh uh the very thing was like",
    "start": "701680",
    "end": "707680"
  },
  {
    "text": "something easy to run that the previous tool was like the by this as a demo set across the whole kubernetes so it was",
    "start": "707680",
    "end": "713760"
  },
  {
    "text": "not very easy uh if you have a cumbersome test tool you're not going to use it a",
    "start": "713760",
    "end": "720240"
  },
  {
    "text": "lot so i wanted something simple that you could run from a laptop when while writing a new test or even if you wanted",
    "start": "720240",
    "end": "727440"
  },
  {
    "text": "to quickly test like a live cluster but then the sim 2 we wanted to be",
    "start": "727440",
    "end": "732800"
  },
  {
    "text": "able to embed it in our cd pipeline uh we wanted all the the things that you",
    "start": "732800",
    "end": "738720"
  },
  {
    "text": "probably expect in a test suite so run test is here or in parallel uh",
    "start": "738720",
    "end": "746399"
  },
  {
    "text": "able to get in store and archive test results so you you can do the com the",
    "start": "746399",
    "end": "753279"
  },
  {
    "text": "you can look at them over time and see if you have like you can spot them trends another important thing is alerting",
    "start": "753279",
    "end": "760880"
  },
  {
    "text": "on on a filling test so uh you might take a decision like in our case we we",
    "start": "760880",
    "end": "766320"
  },
  {
    "text": "page one of the cluster operator if if the tests are not passing because uh maybe means that",
    "start": "766320",
    "end": "772399"
  },
  {
    "text": "uh one changes one change that we're making that made into production uh despite of the tests is you know",
    "start": "772399",
    "end": "778880"
  },
  {
    "text": "probably breaking the functionality you might want to even add like an automatic rollback",
    "start": "778880",
    "end": "784959"
  },
  {
    "text": "uh this on the test street on the actual writing writing the code we",
    "start": "784959",
    "end": "790800"
  },
  {
    "text": "wanted to find a solution that was allowed us to write the less vulnerable",
    "start": "790800",
    "end": "795920"
  },
  {
    "text": "code as possible so to rely a lot on",
    "start": "795920",
    "end": "801360"
  },
  {
    "text": "other other people best practices the community uh maybe uh have like a few examples of",
    "start": "801360",
    "end": "808959"
  },
  {
    "text": "well-written tests that we we could took inspiration from and so uh",
    "start": "808959",
    "end": "815040"
  },
  {
    "start": "814000",
    "end": "814000"
  },
  {
    "text": "our current test solution is based on writing a custom soluble plugin so",
    "start": "815040",
    "end": "821760"
  },
  {
    "text": "as guy said uh soluboy is the tool that runs the conformance test suite but we",
    "start": "821760",
    "end": "827120"
  },
  {
    "text": "wrote a plugin and then soloboy now is driving in our case only our skyscanner",
    "start": "827120",
    "end": "832800"
  },
  {
    "text": "internal smoke tests and then we had a look at the kubernetes for a",
    "start": "832800",
    "end": "838320"
  },
  {
    "text": "native repository and there is like a huge section around tests",
    "start": "838320",
    "end": "843600"
  },
  {
    "text": "and then to intestine so there is all framework that gives you like a",
    "start": "843600",
    "end": "849760"
  },
  {
    "text": "function and utilities to reduce the amount of code that you have to write",
    "start": "849760",
    "end": "855360"
  },
  {
    "text": "unfortunately our repository is not open source yet because there are",
    "start": "855360",
    "end": "861279"
  },
  {
    "text": "a lot of sketch scanner custom custom tester so",
    "start": "861279",
    "end": "867920"
  },
  {
    "text": "we haven't done it yet but we hopefully uh we are going to do that in the next few",
    "start": "867920",
    "end": "873920"
  },
  {
    "text": "few months but i hope to give you like an offer so you can uh go away and try to replicate",
    "start": "873920",
    "end": "880399"
  },
  {
    "text": "our own setup so as we said we run the solo boy uh",
    "start": "880399",
    "end": "887360"
  },
  {
    "text": "image to drive the tests uh we made a little changes so that we can easily",
    "start": "887360",
    "end": "893680"
  },
  {
    "text": "retrieve the field test then we can differentiate the exit code",
    "start": "893680",
    "end": "898800"
  },
  {
    "start": "896000",
    "end": "896000"
  },
  {
    "text": "when we look it into our cd pipeline so we can bail out if if any of the tests are failing",
    "start": "898800",
    "end": "904639"
  },
  {
    "text": "and then we build the actual end to end image we based these on top of the upstream",
    "start": "904639",
    "end": "912000"
  },
  {
    "text": "kubernetes conformance image because uh that image was already added",
    "start": "912000",
    "end": "917519"
  },
  {
    "text": "jingo and everything that we need to run our test",
    "start": "917519",
    "end": "922560"
  },
  {
    "text": "as you can see here we make a couple of changes in particular we change the",
    "start": "922560",
    "end": "928240"
  },
  {
    "text": "running station and i will tell you more about that later at the end to end the doctor test the binary is the angular",
    "start": "928240",
    "end": "934160"
  },
  {
    "text": "binary uh produced by when you compile code and then we pass uh some yammer",
    "start": "934160",
    "end": "940480"
  },
  {
    "text": "configuration because we mirror internally all of the ex",
    "start": "940480",
    "end": "945600"
  },
  {
    "text": "all the docker images so here we're changing the configuration of solo boy to to point to our internal docker",
    "start": "945600",
    "end": "951440"
  },
  {
    "text": "registry uh in terms of the uh how the repository looks like",
    "start": "951440",
    "end": "957440"
  },
  {
    "text": "uh we basically shift and lift the the end-to-end uh go files that are the entry point for",
    "start": "957440",
    "end": "964240"
  },
  {
    "text": "the street from cumulative kubernetes and then we we brought like uh our uh",
    "start": "964240",
    "end": "969519"
  },
  {
    "text": "smog test here we have a networking file because we have a lot",
    "start": "969519",
    "end": "974959"
  },
  {
    "text": "of network uh testers so we move them in a separate file and the common dot go that als all",
    "start": "974959",
    "end": "980720"
  },
  {
    "text": "the share the function between between the smoke tests so",
    "start": "980720",
    "end": "986720"
  },
  {
    "text": "when what do we do when we push a change to kubernetes itself or to a component",
    "start": "986720",
    "end": "994560"
  },
  {
    "text": "we have as i said we we change like a little the soluble images so we can we can write so",
    "start": "994560",
    "end": "1000560"
  },
  {
    "text": "we have the job that is actually responsible for triggering uh uh soluble itself and then retrieving the the",
    "start": "1000560",
    "end": "1007040"
  },
  {
    "text": "result and the and the exit code we also have a job to delete and make sure that we start with",
    "start": "1007040",
    "end": "1014000"
  },
  {
    "text": "the uh from scratch every time because robot doesn't like if there is like already",
    "start": "1014000",
    "end": "1019120"
  },
  {
    "text": "any space at least in our version if there is already the namespace around them uh so inside the solar board in",
    "start": "1019120",
    "end": "1025520"
  },
  {
    "text": "space there is a there called uh slowpoint binary uh driving driving the the test and these spin-ups like",
    "start": "1025520",
    "end": "1033120"
  },
  {
    "text": "our actual uh end-to-end image and that creates uh or",
    "start": "1033120",
    "end": "1038720"
  },
  {
    "text": "uh and that runs all the tests so the the good thing about these is that every test lives inside",
    "start": "1038720",
    "end": "1045520"
  },
  {
    "text": "its own namespace so we run those tests alongside",
    "start": "1045520",
    "end": "1050840"
  },
  {
    "text": "uh production workload because then we have the confidence that we're not polluting other namespaces or we",
    "start": "1050840",
    "end": "1058480"
  },
  {
    "text": "live like exterior resources around so what kind of tests do we do we write",
    "start": "1058480",
    "end": "1065440"
  },
  {
    "text": "we try to really think about what our users care about uh and so networking of course is a big",
    "start": "1065440",
    "end": "1071919"
  },
  {
    "text": "thing you have a bother you want to talk to other pods you want to talk to the internet",
    "start": "1071919",
    "end": "1078000"
  },
  {
    "text": "we we use easter as a service mesh and uh we have like some",
    "start": "1078000",
    "end": "1084480"
  },
  {
    "text": "uh internal configuration uh custom configuration to to have a multi-cluster setup so we want to make sure that",
    "start": "1084480",
    "end": "1091520"
  },
  {
    "text": "uh that setup is still running every time with achistio we have a few tests around dns because",
    "start": "1091520",
    "end": "1098880"
  },
  {
    "text": "let's be honest it's always dns so you want to make sure that that is working",
    "start": "1098880",
    "end": "1106320"
  },
  {
    "text": "internal means uh we make sure that kubernetes dns internal resolution works we run in aws so we have a bunch of",
    "start": "1106320",
    "end": "1114080"
  },
  {
    "text": "specific tests against aws endpoints and also uh other tests around",
    "start": "1114080",
    "end": "1119760"
  },
  {
    "text": "external domains a lot of our users rely on",
    "start": "1119760",
    "end": "1125760"
  },
  {
    "text": "auto scaling so of course we want the hpa to be up and running and also scaling on custom",
    "start": "1125760",
    "end": "1132000"
  },
  {
    "text": "metrics and since we're running in nws some of you might be familiar with the",
    "start": "1132000",
    "end": "1137840"
  },
  {
    "text": "concept that they have for for giving permission or improves so we want of our users to be able to",
    "start": "1137840",
    "end": "1143200"
  },
  {
    "text": "assign uh the role that allows the report to talk to the their market or their",
    "start": "1143200",
    "end": "1149039"
  },
  {
    "text": "database and that functionality needs to be to be working",
    "start": "1149039",
    "end": "1154480"
  },
  {
    "text": "moreover there are like a few cases or when you are not changing anything at the kubernetes level so at those all the",
    "start": "1154480",
    "end": "1161919"
  },
  {
    "text": "same combinations version all the same and no flags anything but maybe you're changing them i or you are changing like",
    "start": "1161919",
    "end": "1169039"
  },
  {
    "text": "some uh uh something uh you're to",
    "start": "1169039",
    "end": "1174080"
  },
  {
    "text": "tuning the kernel so you want to make sure that all the nodes of your cluster are in a known state",
    "start": "1174080",
    "end": "1181440"
  },
  {
    "start": "1181000",
    "end": "1181000"
  },
  {
    "text": "and this is an example like how how does a test look like so uh kubernetes kubernetes a test framework",
    "start": "1181440",
    "end": "1188400"
  },
  {
    "text": "use jinko as a as a as a framework so here you can see that there is like uh um",
    "start": "1188400",
    "end": "1195310"
  },
  {
    "text": "[Music] the protopod uh and the pop-top test so a communication between a source powder",
    "start": "1195310",
    "end": "1202480"
  },
  {
    "text": "to the destination pod and so we create the uh the source ball the name",
    "start": "1202480",
    "end": "1207679"
  },
  {
    "text": "space and the interesting thing is in the last line you can see that with just one line we can make sure that",
    "start": "1207679",
    "end": "1214400"
  },
  {
    "text": "the framework spread that doesn't uh doesn't happen any error when",
    "start": "1214400",
    "end": "1220240"
  },
  {
    "text": "we try to create the namespace and the pod and have the pod running then we can create a destination service",
    "start": "1220240",
    "end": "1228480"
  },
  {
    "text": "with the destination pod again same function to make sure that the destination pod is up running",
    "start": "1228480",
    "end": "1234480"
  },
  {
    "text": "and waiting for and ready to to set the connection and then in the last step we",
    "start": "1234480",
    "end": "1239840"
  },
  {
    "text": "create a service that we uh that is gonna forward the the call to",
    "start": "1239840",
    "end": "1245039"
  },
  {
    "text": "the initiation pod and then we use uh other framework functionality to",
    "start": "1245039",
    "end": "1250240"
  },
  {
    "text": "basically iterate and make the same uh uh call from the source folder to the",
    "start": "1250240",
    "end": "1256159"
  },
  {
    "text": "destination pod and we we make an assertion about it that we are expecting uh into under status code if we don't if",
    "start": "1256159",
    "end": "1263520"
  },
  {
    "text": "we don't get uh that code within uh a certain timeout then we we know",
    "start": "1263520",
    "end": "1269760"
  },
  {
    "text": "that the pod uh is broken and and we raised an alert",
    "start": "1269760",
    "end": "1277840"
  },
  {
    "text": "so um matteo's taking you over how we implemented our solution there um",
    "start": "1278559",
    "end": "1284000"
  },
  {
    "text": "however this didn't come without a few drawbacks and we want to take over",
    "start": "1284000",
    "end": "1289679"
  },
  {
    "text": "like what we've problems we ran into some tips as well um as well as other",
    "start": "1289679",
    "end": "1294799"
  },
  {
    "start": "1290000",
    "end": "1290000"
  },
  {
    "text": "options if you're looking at this and think i you know this this seems not the right fit for me but i still want to",
    "start": "1294799",
    "end": "1301280"
  },
  {
    "text": "test my kubernetes clusters um so in terms of the gotchas with our",
    "start": "1301280",
    "end": "1306880"
  },
  {
    "text": "approach the the first one and the main one is that as matteo mentioned we're using um",
    "start": "1306880",
    "end": "1313360"
  },
  {
    "text": "code from the main kubernetes kubernetes repo to avoid having to write a lot boilerplate um however the the main",
    "start": "1313360",
    "end": "1321039"
  },
  {
    "text": "problem with that is as you can see from this comment on an issue on the um",
    "start": "1321039",
    "end": "1326240"
  },
  {
    "text": "on the repo it's not intended to be consumed this module this this isn't his intended use case um",
    "start": "1326240",
    "end": "1333120"
  },
  {
    "text": "so we need to use a workaround to get get this code to be in a usable state in our",
    "start": "1333120",
    "end": "1339280"
  },
  {
    "text": "our project um and thankfully in the same thread someone",
    "start": "1339280",
    "end": "1344640"
  },
  {
    "text": "has written a script to enable us to do that um so you can use the script is what we're",
    "start": "1344640",
    "end": "1350400"
  },
  {
    "text": "using successfully we've used it to get us through multiple minor version upgrades of kubernetes and vendor in the",
    "start": "1350400",
    "end": "1356159"
  },
  {
    "text": "new code successfully um that that works for us it works well and",
    "start": "1356159",
    "end": "1361440"
  },
  {
    "text": "so yes it's certainly something i i wouldn't have any hesitation in recommending it's a solution to this",
    "start": "1361440",
    "end": "1367760"
  },
  {
    "text": "problem if if this is what you need to do is used in multiple different projects across the community as well",
    "start": "1367760",
    "end": "1372960"
  },
  {
    "text": "for different parts of the kubernetes code base as well",
    "start": "1372960",
    "end": "1378158"
  },
  {
    "text": "um so the the other um problem with versioning the et code",
    "start": "1378880",
    "end": "1385840"
  },
  {
    "text": "however is that the the other part of it being not designed for this means that",
    "start": "1385840",
    "end": "1392000"
  },
  {
    "text": "there's no api stability guarantees like there is with you know public facing parts of kubernetes and these these are",
    "start": "1392000",
    "end": "1399039"
  },
  {
    "text": "this code is written with the intent being it's explicitly tied to a given minor",
    "start": "1399039",
    "end": "1405120"
  },
  {
    "text": "or a given release of kubernetes um so there's there's no hesitation in and",
    "start": "1405120",
    "end": "1411360"
  },
  {
    "text": "renaming removing um completely replacing methods and that means that when you do a minor",
    "start": "1411360",
    "end": "1418720"
  },
  {
    "text": "version update of kubernetes you you have an extra cost here of potentially",
    "start": "1418720",
    "end": "1424240"
  },
  {
    "text": "needing to update functions so one of the methods that mattel highlighted in terms of names creating namespaces",
    "start": "1424240",
    "end": "1431440"
  },
  {
    "text": "waiting for pods and that that method has changed previously completely",
    "start": "1431440",
    "end": "1436480"
  },
  {
    "text": "changed name and we needed to do some investigation as to what the correct method to use was now",
    "start": "1436480",
    "end": "1442960"
  },
  {
    "text": "um that's that's only a one-time and cost though effectively when you're doing a",
    "start": "1442960",
    "end": "1448559"
  },
  {
    "text": "minor kubernetes version update so it becomes another item on your list of we're going to upgrade kubernetes we're",
    "start": "1448559",
    "end": "1454240"
  },
  {
    "text": "going to need to upgrade these components we'll just we'll need to update the vendor code and figure out",
    "start": "1454240",
    "end": "1459520"
  },
  {
    "text": "what what um what methods we need to use now potentially um the other thing is the",
    "start": "1459520",
    "end": "1466799"
  },
  {
    "text": "um the code um provides test images like there's a static effectively a static",
    "start": "1466799",
    "end": "1473360"
  },
  {
    "text": "mapping within the code of test images and tags and including the repositories",
    "start": "1473360",
    "end": "1478559"
  },
  {
    "text": "there they're pulled from um if you're potentially running an air gap cluster or",
    "start": "1478559",
    "end": "1484000"
  },
  {
    "text": "one where for security reasons you can only pull images from from certain registries or because you don't want a",
    "start": "1484000",
    "end": "1489840"
  },
  {
    "text": "third-party dependency you may need to dive into the code find out what those",
    "start": "1489840",
    "end": "1496480"
  },
  {
    "text": "images are mirror them and also um use that use the custom um",
    "start": "1496480",
    "end": "1502640"
  },
  {
    "text": "config file that mattel mentioned to effectively configure your test to pull them from",
    "start": "1502640",
    "end": "1507760"
  },
  {
    "text": "different registers rather than the default registration um there's also occasionally flaky tests",
    "start": "1507760",
    "end": "1514400"
  },
  {
    "text": "um so if you have very dynamic clusters where you're scaling up and down a lot or you're running on for instance aws",
    "start": "1514400",
    "end": "1521200"
  },
  {
    "text": "spots instances where your your instant skins can be lost um sony boy",
    "start": "1521200",
    "end": "1527200"
  },
  {
    "text": "or the version we run is not the greatest recovery uh dealing with tests being interrupted mid-run",
    "start": "1527200",
    "end": "1533279"
  },
  {
    "text": "um so it might you might end up with flaky tests due to the dynamic nature of the clusters",
    "start": "1533279",
    "end": "1538960"
  },
  {
    "text": "you're running then these in or something else um and finally in terms of blockchains you might need to run um the run.s8",
    "start": "1538960",
    "end": "1545520"
  },
  {
    "text": "script so this is a script that we pull in from upstream and modify slightly um",
    "start": "1545520",
    "end": "1551679"
  },
  {
    "text": "because we want to basically make it more configurable for our use case in our case we want the ability to allow",
    "start": "1551679",
    "end": "1558559"
  },
  {
    "text": "more unready nodes and so that's basically an argument that we need to pass into the",
    "start": "1558559",
    "end": "1563760"
  },
  {
    "text": "invocation of gingko and that that means we have to modify the script but it allows us to run this",
    "start": "1563760",
    "end": "1570240"
  },
  {
    "text": "on clusters that are scaling up and down because some roads might be unready and normally that would talk because these",
    "start": "1570240",
    "end": "1575840"
  },
  {
    "text": "tests fail and very quickly and in terms of some tips",
    "start": "1575840",
    "end": "1582400"
  },
  {
    "start": "1578000",
    "end": "1578000"
  },
  {
    "text": "that i'd encourage you to think about even if you don't take this approach like um",
    "start": "1582400",
    "end": "1589200"
  },
  {
    "text": "capture the behavior that your users care about but that it's the same as writing any tests a sort of end time",
    "start": "1589279",
    "end": "1595679"
  },
  {
    "text": "text but put yourself in the mindset of your users and figure out what behavior",
    "start": "1595679",
    "end": "1600799"
  },
  {
    "text": "you're actually trying to test is working is still working hasn't degraded whatever is you're",
    "start": "1600799",
    "end": "1606159"
  },
  {
    "text": "looking for um leverage the community's efforts like not just the code also the images that",
    "start": "1606159",
    "end": "1612080"
  },
  {
    "text": "have been built and one of the tests natal showed used an agn host image that's something that's built by",
    "start": "1612080",
    "end": "1618480"
  },
  {
    "text": "kubernetes test infra and it ensures that no matter what architecture you're",
    "start": "1618480",
    "end": "1624320"
  },
  {
    "text": "running on or whatever the commands that you're running whether it's a deck whether it's a network call whatever it is they're",
    "start": "1624320",
    "end": "1630559"
  },
  {
    "text": "consistent and they're they're they're types of response etc so those those things there's a lot of thought and care",
    "start": "1630559",
    "end": "1636320"
  },
  {
    "text": "put into them make use of them don't don't go around building your own images to do things that might fail in weird",
    "start": "1636320",
    "end": "1643279"
  },
  {
    "text": "ways on different architectures etc and finally figure out which of your tests can be running safely in parallel",
    "start": "1643279",
    "end": "1649919"
  },
  {
    "text": "and obviously if you're running these for every change against your cluster which i would encourage you to do you",
    "start": "1649919",
    "end": "1655279"
  },
  {
    "text": "want them to run as fast as possible so you get that fast feedback loop so that your your tests don't become a pain",
    "start": "1655279",
    "end": "1661200"
  },
  {
    "text": "point they become an enabler rather than pinpoint",
    "start": "1661200",
    "end": "1665919"
  },
  {
    "start": "1666000",
    "end": "1666000"
  },
  {
    "text": "um if if you've listened to all that and you're still thinking um i'm not sure",
    "start": "1666880",
    "end": "1672080"
  },
  {
    "text": "that this this approach will work for us whether it's too much effort for for diversion upgrades or whatever it is or",
    "start": "1672080",
    "end": "1678159"
  },
  {
    "text": "you don't want to write ginkgo tests and there are a couple of other options um the first is um",
    "start": "1678159",
    "end": "1684960"
  },
  {
    "text": "i i already mentioned the cube test framework um since we did the evaluation cube test two has become the the",
    "start": "1684960",
    "end": "1691279"
  },
  {
    "text": "solution that's that's in a separate repo um and a number of different providers have got implementations so",
    "start": "1691279",
    "end": "1697679"
  },
  {
    "text": "that i've i've linked to the aws implementation here as we run on aws but um that enables you to spin up um an",
    "start": "1697679",
    "end": "1705679"
  },
  {
    "text": "eks cluster quickly run tests against it to do some teardown um that's that's um potentially if",
    "start": "1705679",
    "end": "1713200"
  },
  {
    "text": "you're scared about running tests on a live cluster with your production uh traffic on it that might be the better",
    "start": "1713200",
    "end": "1718880"
  },
  {
    "text": "option for you and and then there's there's some other community supported frameworks",
    "start": "1718880",
    "end": "1724399"
  },
  {
    "text": "effectively then the first is test emperor so this is um a bit older it's um not very it's not specifically",
    "start": "1724399",
    "end": "1730960"
  },
  {
    "text": "kubernetes focus but allows you to test your infrastructure whether it's provisioned by ansible or salt or a",
    "start": "1730960",
    "end": "1737279"
  },
  {
    "text": "kubernetes for a kubernetes cluster um and that's that's python based um the next two are a bit more",
    "start": "1737279",
    "end": "1744799"
  },
  {
    "text": "kubernetes focused um so the first is cube test but a different cube test not the kubernetes",
    "start": "1744799",
    "end": "1751039"
  },
  {
    "text": "cube test which i've previously mentioned and this is this is um to enable you to",
    "start": "1751039",
    "end": "1756080"
  },
  {
    "text": "use pi test uh in kubernetes so it makes makes use of um",
    "start": "1756080",
    "end": "1761760"
  },
  {
    "text": "allows you to make use of the kubernetes python client but in a pi test framework so if you're really used to writing pi",
    "start": "1761760",
    "end": "1768159"
  },
  {
    "text": "test test rather than big test maybe that's the the approach you would want to go down",
    "start": "1768159",
    "end": "1773760"
  },
  {
    "text": "um and finally a slightly different approach is kuber healthy so this is actually an operator um that runs in",
    "start": "1773760",
    "end": "1780559"
  },
  {
    "text": "cluster it has some custom resource definitions and you basically interact with it by creating custom resources",
    "start": "1780559",
    "end": "1787279"
  },
  {
    "text": "that define your tests and it takes care of spinning up the pods and gathering results and exposing metrics about",
    "start": "1787279",
    "end": "1793679"
  },
  {
    "text": "what's happened so if that if you want something a bit less involved in terms of you having to write everything",
    "start": "1793679",
    "end": "1800000"
  },
  {
    "text": "in code and building binaries that might be the the best option for you",
    "start": "1800000",
    "end": "1805840"
  },
  {
    "text": "that has been our talk um thank you very much for attending",
    "start": "1806960",
    "end": "1814200"
  }
]