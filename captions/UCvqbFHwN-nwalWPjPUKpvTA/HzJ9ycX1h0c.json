[
  {
    "start": "0",
    "end": "50000"
  },
  {
    "text": "my name is Mike goodness I'm a systems engineer on the Cooper knots team at Ticketmaster joined by my colleague and",
    "start": "30",
    "end": "7470"
  },
  {
    "text": "co-worker Raphael who was also a systems engineer on the Cobra knots team at Ticketmaster before",
    "start": "7470",
    "end": "15240"
  },
  {
    "text": "we get started I have a couple of notes first of all I want to say hi to my",
    "start": "15240",
    "end": "20670"
  },
  {
    "text": "family and friends who are watching this on YouTube despite not having any idea what I do for a living",
    "start": "20670",
    "end": "28010"
  },
  {
    "text": "secondly I want to apologize again to everyone who's watching and I was hoping",
    "start": "28560",
    "end": "34020"
  },
  {
    "text": "to see some sweet Lord of the Rings memes given the title of the talk you're",
    "start": "34020",
    "end": "41250"
  },
  {
    "text": "gonna be sorely disappointed although I could say a Ticketmaster one does not",
    "start": "41250",
    "end": "46320"
  },
  {
    "text": "simply cube cuddle create a little",
    "start": "46320",
    "end": "51510"
  },
  {
    "start": "50000",
    "end": "97000"
  },
  {
    "text": "background I have a couple of years of production experience with kubernetes",
    "start": "51510",
    "end": "57780"
  },
  {
    "text": "both at Ticketmaster and at my previous company I'm a Helmut arts contributor and Co",
    "start": "57780",
    "end": "64408"
  },
  {
    "text": "maintainer recently became a CNC F ambassador and I co organised the DevOps",
    "start": "64409",
    "end": "70590"
  },
  {
    "text": "days Madison conference let's see my",
    "start": "70590",
    "end": "77159"
  },
  {
    "text": "name is Raphael Dean I'm an open source enthusiast I maintain the sanik which is a Python web framework also pretty new",
    "start": "77159",
    "end": "84869"
  },
  {
    "text": "to kubernetes probably started using about six months ago and this is my first time speaking in front of so many",
    "start": "84869",
    "end": "90450"
  },
  {
    "text": "people",
    "start": "90450",
    "end": "92899"
  },
  {
    "text": "the the code there is you know be gentle this is what we're going to talk about I",
    "start": "96280",
    "end": "104259"
  },
  {
    "start": "97000",
    "end": "139000"
  },
  {
    "text": "gonna keep it you know kind of nice and tight hopefully we are going to kind of",
    "start": "104259",
    "end": "110299"
  },
  {
    "text": "assume some familiar some familiarity with helm I will cover a few of the",
    "start": "110299",
    "end": "116390"
  },
  {
    "text": "basics but you know I'm also going to be picking apart or kind of dissecting a",
    "start": "116390",
    "end": "122210"
  },
  {
    "text": "few sections from our our web service chart and it's going to assume some",
    "start": "122210",
    "end": "128979"
  },
  {
    "text": "knowledge of how helm works and kubernetes manifests but I this seems",
    "start": "128979",
    "end": "134540"
  },
  {
    "text": "like a good crowd to have to have kind of that baseline so anybody who's worked",
    "start": "134540",
    "end": "141950"
  },
  {
    "start": "139000",
    "end": "268000"
  },
  {
    "text": "with kubernetes knows that you're working with quite a bit of yamo like",
    "start": "141950",
    "end": "147769"
  },
  {
    "text": "lots of llamo you want to deploy some pods so at the very minimum you need a",
    "start": "147769",
    "end": "154819"
  },
  {
    "text": "deployment llamo you probably want to expose those pods behind a load balancer",
    "start": "154819",
    "end": "163069"
  },
  {
    "text": "so you have a service llamo you may or",
    "start": "163069",
    "end": "169370"
  },
  {
    "text": "may not well I mean assuming you want to actually be able to do anything with those pads I would you know from outside",
    "start": "169370",
    "end": "174889"
  },
  {
    "text": "the cluster you want an ingress say it with me yamo I'm not gonna I'm not going",
    "start": "174889",
    "end": "184280"
  },
  {
    "text": "to show every possible resource because as we all know there are a lot of AP is",
    "start": "184280",
    "end": "189380"
  },
  {
    "text": "now in kubernetes and each one involves yamo so you take you know all of those",
    "start": "189380",
    "end": "198049"
  },
  {
    "text": "all of it all of that ya know file that goes into building an application deploying an application to kubernetes",
    "start": "198049",
    "end": "203359"
  },
  {
    "text": "you multiply that by you know the number of clusters that you may have in your",
    "start": "203359",
    "end": "209480"
  },
  {
    "text": "environment you know and and each one has a certain you know certain configuration points that you know that",
    "start": "209480",
    "end": "215060"
  },
  {
    "text": "are different than the others you need to deploy different versions of the same",
    "start": "215060",
    "end": "220160"
  },
  {
    "text": "application and each you know some of them have I mean at the very least your",
    "start": "220160",
    "end": "225470"
  },
  {
    "text": "docker image tag is going to be different so that's you know that's a different configuration point you know",
    "start": "225470",
    "end": "230540"
  },
  {
    "text": "the problem with kubernetes as it is today is there's no real way to bundle all of those applicable all of these",
    "start": "230540",
    "end": "237950"
  },
  {
    "text": "resources all these manifests together into a into a single unit you know into what we really think of as a deployable",
    "start": "237950",
    "end": "246040"
  },
  {
    "text": "application we have labels and that's you know that's the native mechanism but",
    "start": "246040",
    "end": "251359"
  },
  {
    "text": "there's there's no real enforcement you know you you other than manual",
    "start": "251359",
    "end": "257060"
  },
  {
    "text": "manipulation making sure that you know each manifest has a label you know to to create that Association there's no other",
    "start": "257060",
    "end": "264110"
  },
  {
    "text": "real mechanism for it and that's where helm comes into play so helm again at a",
    "start": "264110",
    "end": "271759"
  },
  {
    "start": "268000",
    "end": "351000"
  },
  {
    "text": "high level allows you to treat your kubernetes application as a single unit",
    "start": "271759",
    "end": "278300"
  },
  {
    "text": "it provides a rendering engine most mostly focused on go template though",
    "start": "278300",
    "end": "285050"
  },
  {
    "text": "that is pluggable with a great deal of",
    "start": "285050",
    "end": "290449"
  },
  {
    "text": "difficulty it provides a package and application manager is that butcher did",
    "start": "290449",
    "end": "296360"
  },
  {
    "text": "I hear butcher laughs no all right so it can act as your application you're a",
    "start": "296360",
    "end": "303110"
  },
  {
    "text": "package manager akin to you know the way app to yum or apk works for your Linux",
    "start": "303110",
    "end": "309470"
  },
  {
    "text": "distribution and then it also provides a release manager so that if you're deploying the same application multiple",
    "start": "309470",
    "end": "316010"
  },
  {
    "text": "times you can track that release you can you can you can track those those related manifests or those related",
    "start": "316010",
    "end": "322970"
  },
  {
    "text": "resources and alter them as a single unit some terminology really and you",
    "start": "322970",
    "end": "331550"
  },
  {
    "text": "know I should have put this build a point last obviously when we refer to helm we're you know we're going to be",
    "start": "331550",
    "end": "337580"
  },
  {
    "text": "referring to the complete application but it's also specifically the client-side tiller is the server-side",
    "start": "337580",
    "end": "346009"
  },
  {
    "text": "application that actually lives in your cluster and communicates with the API server so one of the reasons we did this",
    "start": "346009",
    "end": "356030"
  },
  {
    "start": "351000",
    "end": "483000"
  },
  {
    "text": "is because we have a lot of clusters last we counted there 15 total",
    "start": "356030",
    "end": "361660"
  },
  {
    "text": "have hybrid cloud so we have AWS and on Prem we have different regions for each",
    "start": "361660",
    "end": "366910"
  },
  {
    "text": "of those and we also have multiple environments so as you can see that's",
    "start": "366910",
    "end": "373630"
  },
  {
    "text": "quite a few clusters there we also have one namespace per team so every team",
    "start": "373630",
    "end": "380440"
  },
  {
    "text": "gets their own namespace this is facilitated through we have a tool",
    "start": "380440",
    "end": "387190"
  },
  {
    "text": "called namespace creator internally kind of like how github was if you went I heard that in the keynote they have",
    "start": "387190",
    "end": "392440"
  },
  {
    "text": "something similar so the team basically a product team that wants to use",
    "start": "392440",
    "end": "399010"
  },
  {
    "text": "kubernetes cluster will fork a repository that has a list of the enabled namespaces and add their product",
    "start": "399010",
    "end": "406360"
  },
  {
    "text": "code to it and then that will perform some validation to make sure for",
    "start": "406360",
    "end": "411670"
  },
  {
    "text": "instance that they have one thing that we enforce is that they have a contact technical contact filled in another",
    "start": "411670",
    "end": "418630"
  },
  {
    "text": "system so that if their stuff goes down we know who to reach out to let's see",
    "start": "418630",
    "end": "425610"
  },
  {
    "text": "the namespace creator also provides role based access control via Active",
    "start": "425610",
    "end": "431140"
  },
  {
    "text": "Directory groups so if you know you want to give somebody access to that namespace you add them to an Active",
    "start": "431140",
    "end": "437380"
  },
  {
    "text": "Directory group and it also enforces resource quotas on the entire namespace",
    "start": "437380",
    "end": "443500"
  },
  {
    "text": "and deploy is tiller the server side of helm for each namespace to isolate",
    "start": "443500",
    "end": "450520"
  },
  {
    "text": "things the resources and the creation of them everything is separate finally another detail here is that we have",
    "start": "450520",
    "end": "457360"
  },
  {
    "text": "multiple as a result of having the hybrid cloud we have AWS ingress",
    "start": "457360",
    "end": "462760"
  },
  {
    "text": "controller which uses the application load balancing and gorse controller which we developed jointly with Kouros",
    "start": "462760",
    "end": "469210"
  },
  {
    "text": "and then on Prem we just use the standard nginx ingress controller but as",
    "start": "469210",
    "end": "474460"
  },
  {
    "text": "a result of all these complications or you know different details that's essentially why we developed the web",
    "start": "474460",
    "end": "480910"
  },
  {
    "text": "service chart so yeah as Raphael said this we refer to",
    "start": "480910",
    "end": "488540"
  },
  {
    "start": "483000",
    "end": "754000"
  },
  {
    "text": "our our common a helmet art as the webservice chart who really couldn't get",
    "start": "488540",
    "end": "495290"
  },
  {
    "text": "any more generic of a title than that we developed it originally so our original",
    "start": "495290",
    "end": "501620"
  },
  {
    "text": "approach was that it would be just kind of a template for teams to fork and",
    "start": "501620",
    "end": "506810"
  },
  {
    "text": "customize as needed that's you know that's a pattern that we've seen in the",
    "start": "506810",
    "end": "512750"
  },
  {
    "text": "in or that we've used in the community charts repo you know each application",
    "start": "512750",
    "end": "517820"
  },
  {
    "text": "has its own chart it is tuned to that applications needs and as it needs to be",
    "start": "517820",
    "end": "522950"
  },
  {
    "text": "extended PRS are filed against it and we you know we integrate those changes",
    "start": "522950",
    "end": "529150"
  },
  {
    "text": "there are some pros and cons as there are to everything to that approach the",
    "start": "529150",
    "end": "534350"
  },
  {
    "text": "pros as I mentioned is that or you know the the single Pro really the biggest",
    "start": "534350",
    "end": "539780"
  },
  {
    "text": "one is that that chart is tuned to specifically to that application there",
    "start": "539780",
    "end": "544790"
  },
  {
    "text": "are no extra configuration points to confuse a team or to you know to",
    "start": "544790",
    "end": "549940"
  },
  {
    "text": "conflict or just to you know cause problems it's it's very purpose-built the cons are that you know there's no",
    "start": "549940",
    "end": "557960"
  },
  {
    "text": "there's no commonality between those charts so when team a you know discovers",
    "start": "557960",
    "end": "565370"
  },
  {
    "text": "a new way to do something team that that's not easily communicated or shared",
    "start": "565370",
    "end": "571010"
  },
  {
    "text": "with team B you know there's no shared best practices or you know not it at",
    "start": "571010",
    "end": "577100"
  },
  {
    "text": "least not easily you know requires some manual intervention people actually you know talking to each other which yeah",
    "start": "577100",
    "end": "584330"
  },
  {
    "text": "you're right yeah but then you know kind of the the inverse is that when there's",
    "start": "584330",
    "end": "591530"
  },
  {
    "text": "when there are cluster changes you know whether it's something that we've done to add or remove functionality we being",
    "start": "591530",
    "end": "599300"
  },
  {
    "text": "the cluster Ops teams we then need to communicate those changes back to the",
    "start": "599300",
    "end": "605330"
  },
  {
    "text": "teams again communication alright or",
    "start": "605330",
    "end": "610700"
  },
  {
    "text": "when there's an upstream bug that is either discovered or fixed that requires",
    "start": "610700",
    "end": "616790"
  },
  {
    "text": "a change and chart functionality that needs to be shared so it's just you know it's it's",
    "start": "616790",
    "end": "621840"
  },
  {
    "text": "all about sharing and the difficulty therein so a few months ago we decided to kind",
    "start": "621840",
    "end": "629580"
  },
  {
    "text": "of flip that and as you can see from the bullet points like really flip it so now",
    "start": "629580",
    "end": "636570"
  },
  {
    "text": "the coup Bernards team maintains that web service chart manually and we share",
    "start": "636570",
    "end": "642240"
  },
  {
    "text": "it across all the teams so when a team deploys an application using the chart",
    "start": "642240",
    "end": "648150"
  },
  {
    "text": "they point to our you know to that one helm repository to that one chart in the",
    "start": "648150",
    "end": "654480"
  },
  {
    "text": "helm repository rather than you know having a team a chart and a team B chart",
    "start": "654480",
    "end": "661070"
  },
  {
    "text": "so the pros again as you can see are again flipped you know we have some",
    "start": "661070",
    "end": "666300"
  },
  {
    "text": "there there's no need for commonality because there is only one chart team a",
    "start": "666300",
    "end": "672240"
  },
  {
    "text": "deploys that chart using the same values or the same you know the same options are available to team a as are available",
    "start": "672240",
    "end": "679050"
  },
  {
    "text": "to team B if a team discovers a new better way to do it they can submit",
    "start": "679050",
    "end": "685470"
  },
  {
    "text": "those improvements via PR likewise when we change something in the in the cluster or there's an upstream change we",
    "start": "685470",
    "end": "693780"
  },
  {
    "text": "can integrate that into the cluster cut a new version and you know send that out to the teams who you know then update",
    "start": "693780",
    "end": "701700"
  },
  {
    "text": "their pipelines so that they're deploying using that new version of of the chart this has worked out you know",
    "start": "701700",
    "end": "707820"
  },
  {
    "text": "really pretty well so far I don't know if you know I don't know",
    "start": "707820",
    "end": "714660"
  },
  {
    "text": "how long it'll work you know before we have some really customized applications that need you know that need special",
    "start": "714660",
    "end": "725640"
  },
  {
    "text": "care and attention but we're hoping that this can get us pretty far so what I'd",
    "start": "725640",
    "end": "731640"
  },
  {
    "text": "like to do now is kind of a la Vika glazes demo yesterday of the community",
    "start": "731640",
    "end": "738420"
  },
  {
    "text": "charts best practices dive into some of the some of the things that we've done",
    "start": "738420",
    "end": "743730"
  },
  {
    "text": "in the web service chart to support deployment to hybrid cloud",
    "start": "743730",
    "end": "750200"
  },
  {
    "text": "account for the differences between those environments so basic structure",
    "start": "750200",
    "end": "757790"
  },
  {
    "start": "754000",
    "end": "779000"
  },
  {
    "text": "here we have the usual usual components",
    "start": "757790",
    "end": "763310"
  },
  {
    "text": "of a helm our chart yeah Mel you know metadata we have the templates folder and then our",
    "start": "763310",
    "end": "768560"
  },
  {
    "text": "values files so I'm going to dig into the values file and because I'm using a",
    "start": "768560",
    "end": "775010"
  },
  {
    "text": "large terminal this is going to be lots of scrolling as you can see this values",
    "start": "775010",
    "end": "781250"
  },
  {
    "start": "779000",
    "end": "929000"
  },
  {
    "text": "file is 251 lines long 60 256 characters",
    "start": "781250",
    "end": "786490"
  },
  {
    "text": "so to say we provide a lot of knobs and dials is putting it somewhat mildly a",
    "start": "786490",
    "end": "795490"
  },
  {
    "text": "few I'll go through a few of these options so we have things like you know",
    "start": "795490",
    "end": "802760"
  },
  {
    "text": "a configurable AWS region I am role revision history limit let's",
    "start": "802760",
    "end": "808940"
  },
  {
    "text": "get to some more interesting ones of affinity if a team and most teams eggs have actually adopted this we're",
    "start": "808940",
    "end": "815270"
  },
  {
    "text": "probably going to flip this bit because most teams do want to have some anti",
    "start": "815270",
    "end": "821960"
  },
  {
    "text": "affinities so that their pods get spread across availability zones here we have",
    "start": "821960",
    "end": "827060"
  },
  {
    "text": "that set to false just because that is kind of the you know it's not it's not",
    "start": "827060",
    "end": "832790"
  },
  {
    "text": "out-of-the-box behavior but again we're probably going to flip that pretty soon a couple of things that I will mention",
    "start": "832790",
    "end": "840230"
  },
  {
    "text": "in just a few minutes our replicas count and max replicas counts so these come",
    "start": "840230",
    "end": "845840"
  },
  {
    "text": "into play when creating the deployment replicas count is you know the number of replicas kind of static replicas that",
    "start": "845840",
    "end": "852470"
  },
  {
    "text": "you want minimum and then max replicas count is used by our horizontal pod",
    "start": "852470",
    "end": "857630"
  },
  {
    "text": "autoscaler component so again I'll cover that in just a just a second and then we",
    "start": "857630",
    "end": "864890"
  },
  {
    "text": "have an option for max unavailable pods which is used by a pod disruption budget which again I will show in a couple of",
    "start": "864890",
    "end": "872810"
  },
  {
    "text": "minutes so I'm really just going to kind of scroll through the rest of these some",
    "start": "872810",
    "end": "878000"
  },
  {
    "text": "standard stuff if you used a community chart before you're gonna recognize some of these",
    "start": "878000",
    "end": "883670"
  },
  {
    "text": "values because we've identified those as best patterns so you know being able to specify the service account name being",
    "start": "883670",
    "end": "891080"
  },
  {
    "text": "able to add custom pod annotations and labels we recognize that you know we",
    "start": "891080",
    "end": "897170"
  },
  {
    "text": "don't want to provide values for everything so some of these are relatively relatively freeform where",
    "start": "897170",
    "end": "903650"
  },
  {
    "text": "they you know they're just expecting lists or whereas you know others are",
    "start": "903650",
    "end": "908930"
  },
  {
    "text": "expecting actual objects ingress settings so again a 62% of the way",
    "start": "908930",
    "end": "917600"
  },
  {
    "text": "through and I've scrolled enough so the first resource I'd like to show is our",
    "start": "917600",
    "end": "924830"
  },
  {
    "text": "deployments after a deployment object pretty standard manifest with the",
    "start": "924830",
    "end": "932480"
  },
  {
    "start": "929000",
    "end": "1059000"
  },
  {
    "text": "addition of lots of curly braces which you know really improves readability I know but you know it's a it's a standard",
    "start": "932480",
    "end": "945140"
  },
  {
    "text": "manifest that we just have made very configurable one particular item of",
    "start": "945140",
    "end": "953030"
  },
  {
    "text": "interest here is what we've done with this conditional around our rolling update strategy we've we've said if if",
    "start": "953030",
    "end": "960580"
  },
  {
    "text": "we're only deploying one replica we want to set the maximum unavailable to zero",
    "start": "960580",
    "end": "967340"
  },
  {
    "text": "so that when we do a rolling update we're sure that we still have a pod running you know during that update so",
    "start": "967340",
    "end": "973040"
  },
  {
    "text": "it'll bring a pod up rather than killing the old pod and bring you know before and then not waiting until the new one",
    "start": "973040",
    "end": "979430"
  },
  {
    "text": "is our you know bring your pod up and then not waiting until the old one new one is ready it makes sure that at least",
    "start": "979430",
    "end": "986240"
  },
  {
    "text": "one pod is running during the rolling update so that is actually something we did that one of our teams discovered",
    "start": "986240",
    "end": "992930"
  },
  {
    "text": "they were having you know they were having outages with any time they were deploying you know best but like best",
    "start": "992930",
    "end": "999440"
  },
  {
    "text": "best practice would be don't run one replicas but you know we try to",
    "start": "999440",
    "end": "1004840"
  },
  {
    "text": "accommodate we've added let's see",
    "start": "1004840",
    "end": "1010360"
  },
  {
    "text": "I am role so this again this is a pattern that use in the community charts repo for AWS",
    "start": "1010360",
    "end": "1018829"
  },
  {
    "text": "specific applications being able to add the I am role as an annotation and it",
    "start": "1018829",
    "end": "1025339"
  },
  {
    "text": "containers there's a there's a bug in versions of kubernetes less than 1.8",
    "start": "1025339",
    "end": "1031970"
  },
  {
    "text": "that ignore the standard init containers object so the fix for until 1.8 was to",
    "start": "1031970",
    "end": "1043699"
  },
  {
    "text": "revert to the pod bay de cornet east io / and the containers annotation so we've",
    "start": "1043699",
    "end": "1049669"
  },
  {
    "text": "accounted for that let's see there are here's the anti affinity rule that I",
    "start": "1049669",
    "end": "1057409"
  },
  {
    "text": "mentioned in the values file I think what's a particular interest in what we actually kind of called out in",
    "start": "1057409",
    "end": "1063320"
  },
  {
    "start": "1059000",
    "end": "1204000"
  },
  {
    "text": "our summary of the talk is the ability to add side cars to your applications so",
    "start": "1063320",
    "end": "1069289"
  },
  {
    "text": "we've recently started pursuing Jaeger for tracing distributed tracing so we",
    "start": "1069289",
    "end": "1077809"
  },
  {
    "text": "added a Jaeger dot enabled flag to our values file if you said Jaeger not",
    "start": "1077809",
    "end": "1083990"
  },
  {
    "text": "enabled to true the Jaeger agent gets added as a sidecar and then we provide",
    "start": "1083990",
    "end": "1089720"
  },
  {
    "text": "other configuration points so that if a team is testing a newer version or a",
    "start": "1089720",
    "end": "1096590"
  },
  {
    "text": "different version of the image they can plug that in resources also this is a",
    "start": "1096590",
    "end": "1102860"
  },
  {
    "text": "pattern that that Vic mentioned yesterday and just kind of FYI you",
    "start": "1102860",
    "end": "1108770"
  },
  {
    "text": "should definitely when that video is available check that out because if you contribute to the community repo we will",
    "start": "1108770",
    "end": "1115370"
  },
  {
    "text": "be very grateful if you follow those patterns like day one but in this case I'm referring to the resources section",
    "start": "1115370",
    "end": "1122840"
  },
  {
    "text": "here where you plug in your resources because you're you know different teams are going to discover different resource",
    "start": "1122840",
    "end": "1130220"
  },
  {
    "text": "needs so this is how we accommodate that fluent D some of our teams are using",
    "start": "1130220",
    "end": "1137120"
  },
  {
    "text": "fluent D for log collection and forwarding so we have provided a very",
    "start": "1137120",
    "end": "1142610"
  },
  {
    "text": "simple one-off configuration point for enabling a fluent container sidecar I've done the same for",
    "start": "1142610",
    "end": "1151890"
  },
  {
    "text": "Splunk but what's what's really kind of interesting is that we acknowledge that we can't cover all the bases we have no",
    "start": "1151890",
    "end": "1159390"
  },
  {
    "text": "interest in covering all the bases 251 you know lines and our values file is",
    "start": "1159390",
    "end": "1164790"
  },
  {
    "text": "you know pretty good we don't need to add you know options for every possible sidecar that somebody might want to",
    "start": "1164790",
    "end": "1170580"
  },
  {
    "text": "deploy so we have here just a plane if",
    "start": "1170580",
    "end": "1175770"
  },
  {
    "text": "you want to provide a custom sidecar just give us the ammo and we inject that",
    "start": "1175770",
    "end": "1181620"
  },
  {
    "text": "right into the manifest and then that gets added to your pod there's yeah",
    "start": "1181620",
    "end": "1189750"
  },
  {
    "text": "there's you know plenty more in this deployment file that I would love to go into but I also want to give Raphael a",
    "start": "1189750",
    "end": "1196020"
  },
  {
    "text": "chance to talk at some point so what I'll do next is show our service so just",
    "start": "1196020",
    "end": "1205200"
  },
  {
    "start": "1204000",
    "end": "1246000"
  },
  {
    "text": "like we want to be able to enable sidecar containers we want to enable",
    "start": "1205200",
    "end": "1212010"
  },
  {
    "text": "Prometheus like OneTouch Prometheus metrics scraping so we have a metrics",
    "start": "1212010",
    "end": "1218340"
  },
  {
    "text": "enabled value you set that to true and helm adds these annotations to the",
    "start": "1218340",
    "end": "1225600"
  },
  {
    "text": "service and then our standard Prometheus configuration starts scraping those",
    "start": "1225600",
    "end": "1230670"
  },
  {
    "text": "services scraping the metrics off of those services automatically let's see",
    "start": "1230670",
    "end": "1239340"
  },
  {
    "text": "then the other thing I wanted to point out in the service is right here we have",
    "start": "1239340",
    "end": "1246990"
  },
  {
    "start": "1246000",
    "end": "1326000"
  },
  {
    "text": "a conditional we wrap our service type in a conditional here so when we deploy",
    "start": "1246990",
    "end": "1252690"
  },
  {
    "text": "to AWS we set the platform value to AWS",
    "start": "1252690",
    "end": "1258720"
  },
  {
    "text": "and if we're requesting an ingress we said ingress dot enabled equals true the",
    "start": "1258720",
    "end": "1263910"
  },
  {
    "text": "way the alb ingress controller works is that it you know it requires a node port",
    "start": "1263910",
    "end": "1269130"
  },
  {
    "text": "to be exposed it attaches to the node you know the nodes port so we have this",
    "start": "1269130",
    "end": "1275190"
  },
  {
    "text": "conditional that says if those if those two values are set this service is going",
    "start": "1275190",
    "end": "1280230"
  },
  {
    "text": "to be a note port if it's if they're not set then they you know it doesn't get set explicitly and the default kubernetes",
    "start": "1280230",
    "end": "1287100"
  },
  {
    "text": "behaviors to provision a cluster IP service we have discovered that this",
    "start": "1287100",
    "end": "1293460"
  },
  {
    "text": "it's not quite a binary thing so this is probably something we need to revisit soon we have services that are not",
    "start": "1293460",
    "end": "1302820"
  },
  {
    "text": "deployed to AWS and do need to be note ports and you know they're not always going to be cluster IP services you know",
    "start": "1302820",
    "end": "1310680"
  },
  {
    "text": "even though these conditions aren't met so again that's that's something we",
    "start": "1310680",
    "end": "1316530"
  },
  {
    "text": "learn and as we do we make changes and everybody benefits speaking of ingress",
    "start": "1316530",
    "end": "1323780"
  },
  {
    "text": "let's take a look here the entire manifest is wrapped in a conditional",
    "start": "1323780",
    "end": "1329430"
  },
  {
    "text": "so if ingress if if an egress isn't required we don't bother creating the",
    "start": "1329430",
    "end": "1334470"
  },
  {
    "text": "resource you know pretty straightforward but here again if we're deploying to AWS",
    "start": "1334470",
    "end": "1342030"
  },
  {
    "text": "then we need to add a set of annotations that the alb ingress controller uses to",
    "start": "1342030",
    "end": "1348690"
  },
  {
    "text": "provision those application load balancers and there are quite a few of",
    "start": "1348690",
    "end": "1353760"
  },
  {
    "text": "them AWS provides a wealth of options configurability and the alb ingress",
    "start": "1353760",
    "end": "1360990"
  },
  {
    "text": "makes does really does a good job of supporting them also if you have a TLS",
    "start": "1360990",
    "end": "1369660"
  },
  {
    "text": "certificate that you want to attach to the alb you can provide that you can try to its Arne here you set the health",
    "start": "1369660",
    "end": "1377010"
  },
  {
    "text": "check etc all of these options some of which are kind of sub templated for",
    "start": "1377010",
    "end": "1384300"
  },
  {
    "text": "example the security groups if whoops we",
    "start": "1384300",
    "end": "1394320"
  },
  {
    "text": "have a helper template that lists our ten our subnet names based on the type",
    "start": "1394320",
    "end": "1404310"
  },
  {
    "text": "of sub based on the type of alb we're asking for if we're asking for an internet facing ingress then it puts the",
    "start": "1404310",
    "end": "1411360"
  },
  {
    "text": "security groups and the subnets that correspond to our public facing infrastructure in those",
    "start": "1411360",
    "end": "1416640"
  },
  {
    "text": "annotations if they are internal only alb endpoints then we use a different",
    "start": "1416640",
    "end": "1422340"
  },
  {
    "text": "set of security groups and subnets so that that kind of covers how we deploy",
    "start": "1422340",
    "end": "1429810"
  },
  {
    "text": "or how we handle the AWS case if we're at the point you are unplanned premises",
    "start": "1429810",
    "end": "1436020"
  },
  {
    "text": "its Rafael mentioned we use a shared nginx ingress controller in those clusters so we so we don't need the AWS",
    "start": "1436020",
    "end": "1444210"
  },
  {
    "text": "annotations we just need one that sets the class to in our case shared nginx",
    "start": "1444210",
    "end": "1450450"
  },
  {
    "text": "and then here we have you know a few of the usual suspects you know annotations",
    "start": "1450450",
    "end": "1455940"
  },
  {
    "text": "and we can set hostname we actually do have another helper template that will",
    "start": "1455940",
    "end": "1462690"
  },
  {
    "text": "provide a default fully qualified domain name that can be overridden by teams if",
    "start": "1462690",
    "end": "1468900"
  },
  {
    "text": "they want to use you know their own custom hostname as promised I'm not",
    "start": "1468900",
    "end": "1475500"
  },
  {
    "start": "1474000",
    "end": "1514000"
  },
  {
    "text": "going to go into config Maps they're really pretty pretty bare-bones for the most part fluent E is just kind of a",
    "start": "1475500",
    "end": "1481680"
  },
  {
    "text": "default configuration config map the config map yeah mo is basically empty",
    "start": "1481680",
    "end": "1488220"
  },
  {
    "text": "all we do is you feed in you feed in a key value of you know what's your what's",
    "start": "1488220",
    "end": "1495300"
  },
  {
    "text": "your config name your config map key should be and then you feed in the data",
    "start": "1495300",
    "end": "1501270"
  },
  {
    "text": "and we just stick it right in the manifest it's it's super elegant what I",
    "start": "1501270",
    "end": "1507330"
  },
  {
    "text": "will show though because I mentioned it earlier is the horizontal pod autoscaler so this is where those two values max",
    "start": "1507330",
    "end": "1515580"
  },
  {
    "start": "1514000",
    "end": "1614000"
  },
  {
    "text": "replicas replicas count and max replicas count come into play if you provide both of them and met your specify a higher",
    "start": "1515580",
    "end": "1524160"
  },
  {
    "text": "max then you know kind of min I guess we could have called it min then it will",
    "start": "1524160",
    "end": "1531510"
  },
  {
    "text": "create this manifest and it will use those values in the in the appropriate field so in the spec you have max",
    "start": "1531510",
    "end": "1537660"
  },
  {
    "text": "replicas and you have min replicas you",
    "start": "1537660",
    "end": "1542880"
  },
  {
    "text": "know anybody who knows the HPA realizes that that it is if you",
    "start": "1542880",
    "end": "1550530"
  },
  {
    "text": "if you have the custom metrics api enabled you can scale based on you know",
    "start": "1550530",
    "end": "1556380"
  },
  {
    "text": "Prometheus metrics for example and this this that's something that we really like to offer like soon to our dev teams",
    "start": "1556380",
    "end": "1562560"
  },
  {
    "text": "they are really keenly interested in being able to scale based on things like",
    "start": "1562560",
    "end": "1567870"
  },
  {
    "text": "requests per second you know being able to spin up new pods when you hit a threshold for now though we are using",
    "start": "1567870",
    "end": "1576660"
  },
  {
    "text": "just the base functionality which is CPU so with that what the HPA does is it",
    "start": "1576660",
    "end": "1583350"
  },
  {
    "text": "looks at the average CPU usage across pods and it when it when it exceeds a",
    "start": "1583350",
    "end": "1588710"
  },
  {
    "text": "given threshold it will create more pods up to your maximum until that threshold",
    "start": "1588710",
    "end": "1596160"
  },
  {
    "text": "is no longer being met so a little bit",
    "start": "1596160",
    "end": "1601170"
  },
  {
    "text": "yeah inside kubernetes and not really inside but bonus kubernetes information",
    "start": "1601170",
    "end": "1606380"
  },
  {
    "text": "the last one I'm going to show is pod pod disruption budget this is a",
    "start": "1606380",
    "end": "1611820"
  },
  {
    "text": "relatively new ish resource that we are also finding pretty convenient this is",
    "start": "1611820",
    "end": "1619560"
  },
  {
    "start": "1614000",
    "end": "1741000"
  },
  {
    "text": "when we're doing when we're doing manual node native maintenance say we need to take a node down for whatever reason",
    "start": "1619560",
    "end": "1626490"
  },
  {
    "text": "when you do a cube drain its first going to look at your pod disruption budget and make sure that you keep that it that",
    "start": "1626490",
    "end": "1634050"
  },
  {
    "text": "the scheduler keeps your max unavailable pods that number of pods it's going to",
    "start": "1634050",
    "end": "1641760"
  },
  {
    "text": "affect no more than the head number of pods during a maintenance during",
    "start": "1641760",
    "end": "1648600"
  },
  {
    "text": "maintenance so this is again something that was highlighted by an application",
    "start": "1648600",
    "end": "1654060"
  },
  {
    "text": "team they were wondering interactive you know why all of their pods are why would",
    "start": "1654060",
    "end": "1661440"
  },
  {
    "text": "they were returning five hundreds you know at the same time that we were taking a pod down for maintenance and",
    "start": "1661440",
    "end": "1666660"
  },
  {
    "text": "it's because of a few things I mean you know all of their pods got Co scheduled which you know oops",
    "start": "1666660",
    "end": "1673700"
  },
  {
    "text": "but something like this you know the pod DB is meant to address that so that even if you do get close",
    "start": "1673700",
    "end": "1679440"
  },
  {
    "text": "scheduled this will make sure that you know that X number of pods will be will",
    "start": "1679440",
    "end": "1685440"
  },
  {
    "text": "be up and running before it kills the rest of them so it comes in very handy",
    "start": "1685440",
    "end": "1691639"
  },
  {
    "text": "you'll notice we have a conditional around this manifest as well this",
    "start": "1691639",
    "end": "1696690"
  },
  {
    "text": "so if release dot is install is a helm condition that says you know we're only",
    "start": "1696690",
    "end": "1703980"
  },
  {
    "text": "going to create this if this is an initial installation the reason is that the pdb at least as we understand that",
    "start": "1703980",
    "end": "1711629"
  },
  {
    "text": "the pdb is currently immutable so if you try to change a pod disruption budget after it's been created your helm is",
    "start": "1711629",
    "end": "1718019"
  },
  {
    "text": "gonna flip out a little bit you're gonna get an error message that it you know resource already exists or so their you",
    "start": "1718019",
    "end": "1725190"
  },
  {
    "text": "know field cannot be changed so there are a couple of issues I know about that",
    "start": "1725190",
    "end": "1730320"
  },
  {
    "text": "are open on this so hopefully that gets addressed soon we are I am running super",
    "start": "1730320",
    "end": "1737850"
  },
  {
    "text": "long so at this point I'm gonna hit it over to Rafael to try to squeeze in the",
    "start": "1737850",
    "end": "1744059"
  },
  {
    "text": "last five minutes all right you guys",
    "start": "1744059",
    "end": "1760080"
  },
  {
    "text": "hear me all right so I'm just gonna run really quickly through an example of",
    "start": "1760080",
    "end": "1765690"
  },
  {
    "text": "deploying our deployment essentially with the web service chart let's see if",
    "start": "1765690",
    "end": "1772919"
  },
  {
    "text": "you're interested the code is available on my github brothels hello cube con it's pretty minimal it's",
    "start": "1772919",
    "end": "1779519"
  },
  {
    "text": "just it's not actually going to include the web service chart or anything but if you want to go and look at the files in",
    "start": "1779519",
    "end": "1784590"
  },
  {
    "text": "more detail that I'm pulling up that's where it is what the example does just basic go application like hello world",
    "start": "1784590",
    "end": "1791490"
  },
  {
    "text": "it's gonna run go to us it's gonna build the application push the container image",
    "start": "1791490",
    "end": "1796710"
  },
  {
    "text": "to our container registry which in our case this ECR amazonia CR and then",
    "start": "1796710",
    "end": "1801720"
  },
  {
    "text": "finally deploy the application using the web service chart and helm hope thank",
    "start": "1801720",
    "end": "1808320"
  },
  {
    "text": "you so this is the app in question as you can see just as hello a cube con I'm",
    "start": "1808320",
    "end": "1814840"
  },
  {
    "start": "1809000",
    "end": "2020000"
  },
  {
    "text": "gonna just show you the files here really quickly simple go app here's the",
    "start": "1814840",
    "end": "1820330"
  },
  {
    "text": "test my hands are shaking like I was hoping they wouldn't this is you know",
    "start": "1820330",
    "end": "1826630"
  },
  {
    "text": "just checking to make sure the status code is 200 and that the message is as intended and let's see what else so this",
    "start": "1826630",
    "end": "1835690"
  },
  {
    "text": "values file this is a more minimal one as you know you don't have to fill in a lot of those values were just already",
    "start": "1835690",
    "end": "1841660"
  },
  {
    "text": "defaulted in the other thing so here's like a kind of minimal example for what",
    "start": "1841660",
    "end": "1846790"
  },
  {
    "text": "you would need to deploy this as you can see I'm just the important stuff here is that I'm telling it hey use the app I",
    "start": "1846790",
    "end": "1852700"
  },
  {
    "text": "mean this is where I'm gonna push the container so that's probably the most",
    "start": "1852700",
    "end": "1857980"
  },
  {
    "text": "important thing this is shared values that will be used both for AWS and on-prem if we look at one of the others",
    "start": "1857980",
    "end": "1863980"
  },
  {
    "text": "you'll see I also filled in the fully qualified domain name and the platform is on-prem so yeah you can specify",
    "start": "1863980",
    "end": "1870400"
  },
  {
    "text": "multiple values files for helm and it will use a you know they can overwrite each other and stuff these are",
    "start": "1870400",
    "end": "1876130"
  },
  {
    "text": "completely not overlapping so that's not even the consideration anyway so we can",
    "start": "1876130",
    "end": "1882280"
  },
  {
    "text": "go to the website I already deployed this so we wouldn't have to wait for the",
    "start": "1882280",
    "end": "1887429"
  },
  {
    "text": "whoops how do I do that three fingers yes yep",
    "start": "1887429",
    "end": "1895679"
  },
  {
    "text": "whoops I also need the fqdn oops",
    "start": "1895679",
    "end": "1902700"
  },
  {
    "text": "so you know the whoops we have to be on the these are internal only or so you",
    "start": "1913450",
    "end": "1918950"
  },
  {
    "text": "have to get on the VPN so might I yeah we're intended to do that earlier so",
    "start": "1918950",
    "end": "1924320"
  },
  {
    "text": "yeah hello Keep Calm that would be showing up there but but yeah it's only it's not exposed externally we've had to",
    "start": "1924320",
    "end": "1931190"
  },
  {
    "text": "configure that separately I did not put that annotation on there or up yeah so we won't be able to see the hello Keep",
    "start": "1931190",
    "end": "1937039"
  },
  {
    "text": "Calm but you can use your imagination it's just regular text what we were going to do next I can do it but it will",
    "start": "1937039",
    "end": "1943429"
  },
  {
    "text": "be far less exciting is a modify that message or the fqdn and then do a get",
    "start": "1943429",
    "end": "1948679"
  },
  {
    "text": "push you know so go over here so yeah just imagine that that we had",
    "start": "1948679",
    "end": "1955010"
  },
  {
    "text": "seen the hello cube con in the web browser it's really there I promise you",
    "start": "1955010",
    "end": "1960100"
  },
  {
    "text": "let's see what else oh yes the test will not be happy if we don't change that as well but yeah that so you know the point",
    "start": "1960100",
    "end": "1974029"
  },
  {
    "text": "is that once we do this I didn't go over actually what get lab runners are but",
    "start": "1974029",
    "end": "1980240"
  },
  {
    "text": "you're probably familiar with them in some flavor or another it's a lot like Jenkins or Travis CI and essentially",
    "start": "1980240",
    "end": "1985760"
  },
  {
    "text": "we're just running some code in a you know to find the container of choice and",
    "start": "1985760",
    "end": "1994149"
  },
  {
    "text": "so you know whoops oh yeah well we need to be on the VPN to push as well so",
    "start": "1994149",
    "end": "2000399"
  },
  {
    "text": "there we go those but yeah next you would have seen that the message changed after a moment yeah so now if you have",
    "start": "2000399",
    "end": "2008799"
  },
  {
    "text": "any questions or yeah and if you have questions about the any of this you can contact us there Mike's on Twitter or",
    "start": "2008799",
    "end": "2014950"
  },
  {
    "text": "you can see my email address [Applause] [Music]",
    "start": "2014950",
    "end": "2021569"
  }
]