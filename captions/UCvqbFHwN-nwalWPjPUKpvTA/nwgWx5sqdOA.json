[
  {
    "text": "okay I guess I'll go ahead and get started um thank you for coming after lunch hopefully I keep you awake I know",
    "start": "299",
    "end": "5940"
  },
  {
    "text": "uh I was I got fully caffeinated beforehand so I'm good to go",
    "start": "5940",
    "end": "11280"
  },
  {
    "text": "um we're here to talk about hardening against kubernetes hacks this is a beginner level track this is not going",
    "start": "11280",
    "end": "16619"
  },
  {
    "text": "to be something that's super crazy look at this crazy way I found a exploits a",
    "start": "16619",
    "end": "23880"
  },
  {
    "text": "buffer overrun or anything like that this is more of a look at why you need to pay attention especially from a",
    "start": "23880",
    "end": "29699"
  },
  {
    "text": "developer point of view but also from operations why you need to pay attention to defaults and configurations and",
    "start": "29699",
    "end": "37200"
  },
  {
    "text": "things that you might not be thinking about when you deploy an app now",
    "start": "37200",
    "end": "43320"
  },
  {
    "text": "I come from a developer background I'm not going to read all that um I'm a developer Advocate at sneak I am not here to talk about our products",
    "start": "43320",
    "end": "50940"
  },
  {
    "text": "at all today just here to talk about kubernetes best practice deployments on top of it and what can",
    "start": "50940",
    "end": "55980"
  },
  {
    "text": "happen if you're not paying attention to things that it can impact security",
    "start": "55980",
    "end": "61140"
  },
  {
    "text": "um those Eagle I might notice I have a crossout on my CK it just expired so I got to renew my cka I actually made that",
    "start": "61140",
    "end": "67860"
  },
  {
    "text": "change because I don't want to misrepresent but I do have my cks I do my ckad and I will have my cka by this",
    "start": "67860",
    "end": "73680"
  },
  {
    "text": "time hopefully next month when I get around to it um I hear that they've moved it all",
    "start": "73680",
    "end": "79560"
  },
  {
    "text": "right up to 126 now so I'm still boning up on what I need to know I'm Eric",
    "start": "79560",
    "end": "84960"
  },
  {
    "text": "Smalling all the socials I'm on hacky Durham for uh Mastodon but you can find me all those places",
    "start": "84960",
    "end": "91320"
  },
  {
    "text": "um again if you want to follow along this is the GitHub repository uh click on the workshop directory in it that has",
    "start": "91320",
    "end": "98340"
  },
  {
    "text": "the full walk through what we're going to do we're not going to do a lot of slides here we're going to mostly be",
    "start": "98340",
    "end": "103500"
  },
  {
    "text": "coming right out of that GitHub repository um one more person let's see",
    "start": "103500",
    "end": "111000"
  },
  {
    "text": "get my notes in front of me and we'll get going here so today we're going to be talking about",
    "start": "111000",
    "end": "116759"
  },
  {
    "text": "how the combination of app vulnerabilities and misconfigurations can allow an attacker to spread the the",
    "start": "116759",
    "end": "124740"
  },
  {
    "text": "the radius of their attack on your cluster this is a pattern that most every major",
    "start": "124740",
    "end": "130200"
  },
  {
    "text": "exploit of recent years pretty much follows an application vulnerability gives an attacker the initial initial",
    "start": "130200",
    "end": "136020"
  },
  {
    "text": "foothold and then either application or infrastructure level misconfigurations allow the attacker to spread out to",
    "start": "136020",
    "end": "142860"
  },
  {
    "text": "other parts of your system it's pretty common narrative today we're going to be talking about this in the context of kubernetes",
    "start": "142860",
    "end": "148620"
  },
  {
    "text": "obviously we can we're going to walk through how we can go from exploiting an app vulnerability to basically owning a cluster",
    "start": "148620",
    "end": "155599"
  },
  {
    "text": "now this is a contrived demo I'm not going to show you some fancy new rce that's out there that nobody's seen",
    "start": "155599",
    "end": "161819"
  },
  {
    "text": "before sorry to disappoint um I have to do something that's easily reproducible and demonstrable so we're",
    "start": "161819",
    "end": "170400"
  },
  {
    "text": "going to set the stage here as a hacker whether it be from the outside in or",
    "start": "170400",
    "end": "175620"
  },
  {
    "text": "inside of a company you have found a vulnerable ports you have found an",
    "start": "175620",
    "end": "180660"
  },
  {
    "text": "application that has an rce and throughout this and again I'll get",
    "start": "180660",
    "end": "185940"
  },
  {
    "text": "off these slides in a second I have this graphic we're calling the timeline of Doom where we're going to walk through left to right the the things we're",
    "start": "185940",
    "end": "193440"
  },
  {
    "text": "finding and how we get from the initial app bone Discovery to Cluster ownership",
    "start": "193440",
    "end": "200040"
  },
  {
    "text": "and with that I'm going to get out of the slides and we're going to jump right over to the GitHub repository that I was",
    "start": "200040",
    "end": "206940"
  },
  {
    "text": "pointing you to get it to go back to the top",
    "start": "206940",
    "end": "212760"
  },
  {
    "text": "so as I said if we go to the first okay I'm on Wi-Fi don't do that",
    "start": "212760",
    "end": "218120"
  },
  {
    "text": "we're going to go to the workshop if you're following along we're going to go to First we're going to stop here at",
    "start": "218120",
    "end": "224280"
  },
  {
    "text": "the beginning as I said to a couple people earlier that walked in here anytime you see a",
    "start": "224280",
    "end": "229319"
  },
  {
    "text": "sneak person demonstrating something with a dash goof at the end do not deploy this anywhere you care about",
    "start": "229319",
    "end": "235700"
  },
  {
    "text": "these are usually highly highly vulnerable repositories this one's not",
    "start": "235700",
    "end": "240840"
  },
  {
    "text": "so bad because it's a contrived example but we have other ones out there if you go poke around our account if you were",
    "start": "240840",
    "end": "246720"
  },
  {
    "text": "to deploy some of those apps to production people will own your cluster or own your at least own your environment pretty quickly they're meant",
    "start": "246720",
    "end": "253379"
  },
  {
    "text": "for us to demonstrate vulnerable things so you have been warned don't put this on your development servers your QA",
    "start": "253379",
    "end": "259320"
  },
  {
    "text": "environment your company's Cloud account please um so you have been warned so the setup",
    "start": "259320",
    "end": "265860"
  },
  {
    "text": "as I said if you're going to follow along you need Docker desktop you need kind kubernetes and Docker Cube",
    "start": "265860",
    "end": "272880"
  },
  {
    "text": "CTL get and you need to clone this repository down so for those who do want to follow along",
    "start": "272880",
    "end": "278940"
  },
  {
    "text": "uh start doing that now and I'm going to I have a question",
    "start": "278940",
    "end": "285979"
  },
  {
    "text": "the images pull down should work on arm I am on M1 and it works on mine I have built multi-arc for this so you should",
    "start": "286440",
    "end": "292919"
  },
  {
    "text": "be good either way I also supposedly have unrate limited",
    "start": "292919",
    "end": "299040"
  },
  {
    "text": "Docker Hub accounts so we shouldn't get hammered there either should is the key word",
    "start": "299040",
    "end": "305340"
  },
  {
    "text": "uh so the reason I'm gonna while people are doing that I'm going to talk a little bit of why I'm why we have this",
    "start": "305340",
    "end": "311460"
  },
  {
    "text": "platform so uh Docker desktop is just easy because it's there it's easy to install a lot of people have it",
    "start": "311460",
    "end": "317220"
  },
  {
    "text": "um if as long as you have Docker on your machine if you're running Linux and you've just got the docker command line that should work just fine uh the reason",
    "start": "317220",
    "end": "323160"
  },
  {
    "text": "I am using kind is because it is a nice reproducible way to demonstrate a cubeadm style deployment of kubernetes",
    "start": "323160",
    "end": "330120"
  },
  {
    "text": "this is meant to Dem to be an example of you work at a company and you're DIY in your own cluster and some of the things",
    "start": "330120",
    "end": "336720"
  },
  {
    "text": "you might or might not be thinking about while you do that and as an application deployer developer deploying on top of",
    "start": "336720",
    "end": "342300"
  },
  {
    "text": "that kind of a cluster kind is really nice in that way because it is you can put on your own cni on top of it you can",
    "start": "342300",
    "end": "348539"
  },
  {
    "text": "do all sorts of stuff with it uh you can use other you could probably do this with minicube you could probably do this with a lot of others but uh I chose kind",
    "start": "348539",
    "end": "355440"
  },
  {
    "text": "because I did uh one thing you don't want to make sure of though is if you are running Docker desktop or Rancher",
    "start": "355440",
    "end": "360600"
  },
  {
    "text": "desktop do not be running their kubernetes make sure that is turned off because they will you will hey you run",
    "start": "360600",
    "end": "367620"
  },
  {
    "text": "out of battery real quick but they will fight each other and you'll may have to know which one you're pointing at not using the docker one because it can't do",
    "start": "367620",
    "end": "373919"
  },
  {
    "text": "multi-node and I can't do cni and things like that so uh if you're running through the",
    "start": "373919",
    "end": "380340"
  },
  {
    "text": "setup at the bottom of this setup page you'll see that there is a",
    "start": "380340",
    "end": "386520"
  },
  {
    "text": "aptly named setup sh file CD into the setup folder run that script that is",
    "start": "386520",
    "end": "391979"
  },
  {
    "text": "going to stand up that Cube that kind cluster it'll be 124 for you that the screenshots old",
    "start": "391979",
    "end": "398759"
  },
  {
    "text": "um it's going to set it up with two nodes a control plane and a worker it's going to put I think I have I don't",
    "start": "398759",
    "end": "405660"
  },
  {
    "text": "remember if I'm using Calico or psyllium it says it's Calico so it must be Calico",
    "start": "405660",
    "end": "410880"
  },
  {
    "text": "um I changed it every once in a while and uh it's going to deploy our vulnerable app into it and set some",
    "start": "410880",
    "end": "417960"
  },
  {
    "text": "other things up about it you'll see at the bottom of it a bunch of weightings it's basically just",
    "start": "417960",
    "end": "423479"
  },
  {
    "text": "caching up some some containers that we'll be using throughout the demonstration at the very bottom you",
    "start": "423479",
    "end": "428880"
  },
  {
    "text": "should see pods sneaky created pod sneaky deleted that's on purpose so that",
    "start": "428880",
    "end": "433979"
  },
  {
    "text": "it just it primes the uh cache the image cache inside of the kind cluster and then for sanity tests you",
    "start": "433979",
    "end": "441000"
  },
  {
    "text": "can check your nodes and then you want to go to this URL which is localhost web admin",
    "start": "441000",
    "end": "448680"
  },
  {
    "text": "if you followed all the steps and you're on Docker desktop at least this should work if it doesn't and you get a 404",
    "start": "448680",
    "end": "455160"
  },
  {
    "text": "it's I've got some kind of race condition in the script I need to work on if you just rerun this Cube apply",
    "start": "455160",
    "end": "461400"
  },
  {
    "text": "which is comes from the setup script just re resends the the Ingress that",
    "start": "461400",
    "end": "467520"
  },
  {
    "text": "should that should solve your 404 problem should you be getting it what you should get is something that looks",
    "start": "467520",
    "end": "472680"
  },
  {
    "text": "like this and as I said this is a contrived rce so",
    "start": "472680",
    "end": "477960"
  },
  {
    "text": "this is just a python app that allows you to execute commands in a real kit in a real world scenario a remote code",
    "start": "477960",
    "end": "484139"
  },
  {
    "text": "execution exploit if you're not familiar with it is a way that a bad actor or",
    "start": "484139",
    "end": "490020"
  },
  {
    "text": "attacker whatever can send specifically formatted requests queries data into your app and",
    "start": "490020",
    "end": "498240"
  },
  {
    "text": "get access to run arbitrary code on your instance your host your server and we'll",
    "start": "498240",
    "end": "504840"
  },
  {
    "text": "be emulating that now we have other demos out there we can show you of like you know love Rochelle or things that",
    "start": "504840",
    "end": "509879"
  },
  {
    "text": "allow you to actually do that but in 90 minutes I can't really get into all that minutia so we do this simple one which",
    "start": "509879",
    "end": "516899"
  },
  {
    "text": "acts like one and gives a nice pretty demonstratable face to it so for those who are running",
    "start": "516899",
    "end": "523500"
  },
  {
    "text": "the setup script can I get a hands up that you're still running it or you okay has anyone completed it",
    "start": "523500",
    "end": "529920"
  },
  {
    "text": "yeah on this wi-fi I have a bad feeling um that it's going to take a while so",
    "start": "529920",
    "end": "536899"
  },
  {
    "text": "oh",
    "start": "537779",
    "end": "540140"
  },
  {
    "text": "well it's going to need to be depending what version of kubernetes you're running inside kind the the setup it's",
    "start": "543720",
    "end": "549240"
  },
  {
    "text": "going to start is a kind cluster with a specific set of parameters on it and a specific version of kubernetes 124 in",
    "start": "549240",
    "end": "556260"
  },
  {
    "text": "this case so the thing that takes the longest honestly is downloading that 124 node image so if you already have that",
    "start": "556260",
    "end": "562560"
  },
  {
    "text": "image possibly that'll speed things up but you do do need to run the setup",
    "start": "562560",
    "end": "567600"
  },
  {
    "text": "scripts to get that and the Apple deployed",
    "start": "567600",
    "end": "572880"
  },
  {
    "text": "so I'm going to go slowly forward and hopefully this will finish so I want to",
    "start": "572880",
    "end": "577980"
  },
  {
    "text": "make sure that the goal today is to show you the exploit walk through the whole process of expanding and expanding and",
    "start": "577980",
    "end": "584100"
  },
  {
    "text": "expanding this exploit and then get into talking about what are some of the things we could do to mitigate this",
    "start": "584100",
    "end": "590880"
  },
  {
    "text": "um I will mention some as we go but at the end there's a whole section on ideas for patterns and and things you can do",
    "start": "590880",
    "end": "597899"
  },
  {
    "text": "to mitigate you know problems like this a couple things I'll call out",
    "start": "597899",
    "end": "603060"
  },
  {
    "text": "immediately that will come up as a question is why the heck am I doing pod security policy there's PSPs in here",
    "start": "603060",
    "end": "609420"
  },
  {
    "text": "PSPs were deprecated and removed in 125. problem is most people aren't on 125. um",
    "start": "609420",
    "end": "616140"
  },
  {
    "text": "I shouldn't say most many people aren't on 125. you are going to if you are a consultant working with customers",
    "start": "616140",
    "end": "621420"
  },
  {
    "text": "whether you're a develop working with developers operations whatever if they're running their own kubernetes clusters there's a very high chance",
    "start": "621420",
    "end": "627899"
  },
  {
    "text": "you're still using PSPs so I'm showing them here we will discuss what's you know what replaces PSP how to",
    "start": "627899",
    "end": "635640"
  },
  {
    "text": "do PSA you know we'll talk about that when we get there but PSPs are still a valid thing you're going to see in the",
    "start": "635640",
    "end": "641580"
  },
  {
    "text": "wild right now so they're included in this um I talked about why I'm using kind",
    "start": "641580",
    "end": "648540"
  },
  {
    "text": "um we will talk about managed clusters like eks sivo and whatever",
    "start": "648540",
    "end": "655079"
  },
  {
    "text": "um a little bit later as well but for now I'm going to go back to the",
    "start": "655079",
    "end": "660300"
  },
  {
    "text": "steps and when you get to where that sanity test is passed we're going to go",
    "start": "660300",
    "end": "666360"
  },
  {
    "text": "start exploring and this is where you kind of put on the black hat ish",
    "start": "666360",
    "end": "671660"
  },
  {
    "text": "and we're going to go look at this taking a vulnerability and going forward",
    "start": "671660",
    "end": "676680"
  },
  {
    "text": "with it so we have this vulnerable route we we found this app out there for whatever through whatever means maybe",
    "start": "676680",
    "end": "682079"
  },
  {
    "text": "we've got a POC we pulled down from the bone DB and we're able to identify that this endpoint has the uh the rce in it",
    "start": "682079",
    "end": "690120"
  },
  {
    "text": "and if we take the URL in Step part one step one",
    "start": "690120",
    "end": "695399"
  },
  {
    "text": "which is basically localhost web admin and we're going to send a CMD argument in with the word hostname",
    "start": "695399",
    "end": "701760"
  },
  {
    "text": "you'll see that the hostname of the server the the host",
    "start": "701760",
    "end": "708260"
  },
  {
    "text": "that this process is running in Ran now again like I said this is contrived but",
    "start": "708260",
    "end": "714839"
  },
  {
    "text": "that is exactly how an rce can work is for instance in a log for Shell situation you have an a fake ldap server",
    "start": "714839",
    "end": "721860"
  },
  {
    "text": "out there that feeds back a class file that can do a remote shell",
    "start": "721860",
    "end": "728040"
  },
  {
    "text": "back and all of a sudden you can start running commands like this on somebody else's host",
    "start": "728040",
    "end": "733380"
  },
  {
    "text": "so hostname is interesting but the next thing I'm probably going to",
    "start": "733380",
    "end": "738720"
  },
  {
    "text": "want to do is start poking around for information about what's going on you know in the environment this app is",
    "start": "738720",
    "end": "744480"
  },
  {
    "text": "running in so we're going to run EnV and take a look at the environment variables",
    "start": "744480",
    "end": "749880"
  },
  {
    "text": "all sorts of stuff in there so we get some interesting info here we could see that there's a whole bunch of things",
    "start": "749880",
    "end": "754980"
  },
  {
    "text": "called kubernetes so we now know oh this is most likely running in a kubernetes cluster again take off the put on the",
    "start": "754980",
    "end": "762240"
  },
  {
    "text": "the mental Blinder that you installed this yourself we know that we're in a kubernetes cluster which means we're probably",
    "start": "762240",
    "end": "767940"
  },
  {
    "text": "running in a container obviously and all that stuff we see things like a service host one of the more interesting pieces",
    "start": "767940",
    "end": "776160"
  },
  {
    "text": "is we see a kubernetes port and there's an internal IP address and",
    "start": "776160",
    "end": "782220"
  },
  {
    "text": "ports that is the internal API server endpoint that's the control plane for",
    "start": "782220",
    "end": "789000"
  },
  {
    "text": "kubernetes if you're not familiar with the API server so we'll note that",
    "start": "789000",
    "end": "795839"
  },
  {
    "text": "and this was just you know the text in here talks about that and the next thing we want to do is I",
    "start": "795839",
    "end": "801899"
  },
  {
    "text": "want to know what the IP my my pods IP is because I'm going to need that info later as well so we're going to send",
    "start": "801899",
    "end": "807300"
  },
  {
    "text": "hostname space Dash I and I got too many tabs already there we",
    "start": "807300",
    "end": "814019"
  },
  {
    "text": "go so now I have that so I know okay well I'm I'm on this 10. address interesting",
    "start": "814019",
    "end": "819600"
  },
  {
    "text": "okay more information so at that point let's take a checkpoint let's see what",
    "start": "819600",
    "end": "825180"
  },
  {
    "text": "we know now so we know that we have an application with this rce this remote code execution vulnerability and it's",
    "start": "825180",
    "end": "831240"
  },
  {
    "text": "available to us through Port 80 in this case um we're pretty sure that we're running on a kubernetes cluster one of the",
    "start": "831240",
    "end": "837779"
  },
  {
    "text": "environmental variables in there showed a port of 5000 so we probably earn a service with this support is this pods listening on Port 5000.",
    "start": "837779",
    "end": "844440"
  },
  {
    "text": "uh we have the internal API server apparently of a kubernetes control plane IP address sorry and we",
    "start": "844440",
    "end": "852600"
  },
  {
    "text": "know what IP address we're running on so pretty graphic skip past um so in the timeline of Doom we're in",
    "start": "852600",
    "end": "858540"
  },
  {
    "text": "the with that one I had showed before we know we have an app voltm at that point okay",
    "start": "858540",
    "end": "865380"
  },
  {
    "text": "how many people are still running the setup script okay I apologize",
    "start": "865380",
    "end": "871560"
  },
  {
    "text": "[Music] um I I've had people actually draw I presented versions like this where they",
    "start": "871560",
    "end": "877440"
  },
  {
    "text": "use their hotspot and it's it's better but I apologize the uh I didn't count on it being as slow as it is",
    "start": "877440",
    "end": "884399"
  },
  {
    "text": "I'm just going to go forward and we're going to treat this as you can play with this afterwards if you can follow along and catch up great in fact uh if I had",
    "start": "884399",
    "end": "891899"
  },
  {
    "text": "swag I'd give you some for doing it but we're gonna I'm gonna keep going through this so I wanna make sure we have time",
    "start": "891899",
    "end": "897300"
  },
  {
    "text": "at the end for questions and to get through it all so I'm just going to go through to step two now",
    "start": "897300",
    "end": "903240"
  },
  {
    "text": "and so now we're going to try to access that API server",
    "start": "903240",
    "end": "909120"
  },
  {
    "text": "so by default every kubernetes pod has a service token",
    "start": "909120",
    "end": "916459"
  },
  {
    "text": "associated with a service account it's let me just open this talk about it",
    "start": "916459",
    "end": "922860"
  },
  {
    "text": "while I pull it and there it is so I just catted I ran Cat bar run Secrets kubernetes i o service",
    "start": "922860",
    "end": "929459"
  },
  {
    "text": "account token that's the default place for the default token that by default gets mounted there",
    "start": "929459",
    "end": "935100"
  },
  {
    "text": "so that is a credential we can use that to try to",
    "start": "935100",
    "end": "942360"
  },
  {
    "text": "get at um that started picking away at that API server and see if what we can see with",
    "start": "942360",
    "end": "948540"
  },
  {
    "text": "it this which is the next stage this is just a a side saying even if we didn't",
    "start": "948540",
    "end": "954899"
  },
  {
    "text": "have an rce we could potentially get a lot of this kind of information through something like",
    "start": "954899",
    "end": "960420"
  },
  {
    "text": "um the proc file system if we could just get a directory traversal vulnerability we could actually get into your",
    "start": "960420",
    "end": "966540"
  },
  {
    "text": "environment variables that way look at that so similar kind of information to be gathered there it's",
    "start": "966540",
    "end": "972360"
  },
  {
    "text": "just a more of an aside than anything else but we do have an rce so we're going to try to see let's see if we've",
    "start": "972360",
    "end": "977880"
  },
  {
    "text": "got some tools that are and access at our disposal so I just ran curl to google.com",
    "start": "977880",
    "end": "985320"
  },
  {
    "text": "and not only do I have curl so hey I've got curl on my file system yay",
    "start": "985320",
    "end": "990800"
  },
  {
    "text": "but I also have it looks like access to the internet from this post to this container I got a",
    "start": "990800",
    "end": "997860"
  },
  {
    "text": "301 back from Google which is the normal response so we have network access and we have curl",
    "start": "997860",
    "end": "1005540"
  },
  {
    "text": "at our disposal so",
    "start": "1005540",
    "end": "1010579"
  },
  {
    "text": "let's take what we've learned and we're going to apply this to try to get out that API server so we are going to take",
    "start": "1010579",
    "end": "1015740"
  },
  {
    "text": "the kubernetes port we saw on the from the environment of the environmental variables we're going to",
    "start": "1015740",
    "end": "1021500"
  },
  {
    "text": "um I'm going to skip past the the pecking away at the at the API server to",
    "start": "1021500",
    "end": "1026540"
  },
  {
    "text": "try to find something vulnerable and say that I found out hey endpoints seems to be available to me and we're going to",
    "start": "1026540",
    "end": "1032720"
  },
  {
    "text": "form a curl command that goes after that so here we have curling we're taking the",
    "start": "1032720",
    "end": "1039620"
  },
  {
    "text": "casert which is right alongside that token same place using that and setting",
    "start": "1039620",
    "end": "1045199"
  },
  {
    "text": "an authorization Bearer with the output of catting the token calling the that's uh 10 9601 that's the kubit host",
    "start": "1045199",
    "end": "1053660"
  },
  {
    "text": "and we're calling the default endpoints and we got a response back",
    "start": "1053660",
    "end": "1058779"
  },
  {
    "text": "this is interesting it shows that we have a good token mainly we know we are able to talk to the kubernetes API",
    "start": "1060080",
    "end": "1065600"
  },
  {
    "text": "server if this was not running in kind um this is one of the bad things about",
    "start": "1065600",
    "end": "1071780"
  },
  {
    "text": "using kind since it's behind a Docker networking kind of layer onion layer we're seeing an IP address there that's",
    "start": "1071780",
    "end": "1078260"
  },
  {
    "text": "172 1903 in the in this bottom section that is very likely would have otherwise",
    "start": "1078260",
    "end": "1084500"
  },
  {
    "text": "be the public facing API server endpoint that I could get in at because we're in",
    "start": "1084500",
    "end": "1090080"
  },
  {
    "text": "kind we're actually it's a local host one that's it's wrapped but if we weren't kind that we could uh use this",
    "start": "1090080",
    "end": "1096020"
  },
  {
    "text": "IP now to try to get at this thing from outside of this pod and that's all spelled out in the uh",
    "start": "1096020",
    "end": "1102980"
  },
  {
    "text": "paragraphs below here so we already knew a bunch of stuff when the new info we have the service account",
    "start": "1102980",
    "end": "1109220"
  },
  {
    "text": "and pod configurations and it's applications namespace is using the default Auto Mount service account token",
    "start": "1109220",
    "end": "1115460"
  },
  {
    "text": "setting of true so when you create a service account",
    "start": "1115460",
    "end": "1120700"
  },
  {
    "text": "um by default that service account token will get automated you can turn that off you can set that to false",
    "start": "1121220",
    "end": "1127700"
  },
  {
    "text": "unfortunately the default and kubernetes is true and so it'll be there you should set it to loss in my opinion",
    "start": "1127700",
    "end": "1134660"
  },
  {
    "text": "um so we'll leave that at that for a moment uh so we found that token and we're able to connect to the API",
    "start": "1134660",
    "end": "1140600"
  },
  {
    "text": "server with it and again the external IP is kind of",
    "start": "1140600",
    "end": "1146000"
  },
  {
    "text": "masked so we now know we have a pod token inside the Pod we have a it allows access to the endpoints API",
    "start": "1146000",
    "end": "1153559"
  },
  {
    "text": "so let's see if we can get deeper this step we're going to try to find out",
    "start": "1153559",
    "end": "1158600"
  },
  {
    "text": "some more information about the cluster itself so we found out a bunch of information about this container in this pod and we found a little bit about the",
    "start": "1158600",
    "end": "1164660"
  },
  {
    "text": "cluster we're going to get more info about this cluster so we wanted now this this using our rce this this URL based",
    "start": "1164660",
    "end": "1173480"
  },
  {
    "text": "back and forth is cumbersome so I want to try to use a local Cube CTL and that",
    "start": "1173480",
    "end": "1178760"
  },
  {
    "text": "token to start accessing this from my machine now you can imagine this",
    "start": "1178760",
    "end": "1185059"
  },
  {
    "text": "could be either a machine connecting over the Internet or more likely this is probably somebody who's got malware on a laptop who's connecting",
    "start": "1185059",
    "end": "1191900"
  },
  {
    "text": "into your QA cluster or your Dev cluster you know who knows what so",
    "start": "1191900",
    "end": "1197539"
  },
  {
    "text": "um we're going to take that token that we found in the prior",
    "start": "1197539",
    "end": "1203000"
  },
  {
    "text": "to which dab are you there we are I'm just going to copy that whole thing and in your demonstration GitHub",
    "start": "1203000",
    "end": "1210380"
  },
  {
    "text": "repository that we cloned coming back out of that setup folder there is a little helper script in here",
    "start": "1210380",
    "end": "1217220"
  },
  {
    "text": "called setup cubeconfig shell I'm going to source that let me put it I'm going to put a dot set up",
    "start": "1217220",
    "end": "1224559"
  },
  {
    "text": "cubeconfig and it's going to ask for the token I'm going to paste what I just copied out of the browser into this",
    "start": "1224559",
    "end": "1230600"
  },
  {
    "text": "and now again here because I'm in kind I'm going to put localhost oops I could type it",
    "start": "1230600",
    "end": "1238039"
  },
  {
    "text": "6443 and we just it just created a quick config file and set my context to that",
    "start": "1238039",
    "end": "1245840"
  },
  {
    "text": "so if I do Cube CTL uh let's do get pods",
    "start": "1245840",
    "end": "1253760"
  },
  {
    "text": "I gotta forbidden that's actually not a bad thing hopefully I'm not riffing away from my my steps here but",
    "start": "1253760",
    "end": "1260419"
  },
  {
    "text": "this is telling me that um that tells me first of all my context is set up correctly I was able to connect to that",
    "start": "1260419",
    "end": "1266059"
  },
  {
    "text": "API server because I got a forbidden back and it's telling me that the system service account secure web admin cannot",
    "start": "1266059",
    "end": "1272179"
  },
  {
    "text": "list resources pods in the API Group in the deep in the namespace default",
    "start": "1272179",
    "end": "1278299"
  },
  {
    "text": "because I didn't specify default on the command line obviously so this walks through all of that",
    "start": "1278299",
    "end": "1284820"
  },
  {
    "text": "[Music] um but that forbidden error exposed",
    "start": "1284820",
    "end": "1290120"
  },
  {
    "text": "something interesting pure if that's is that legible from the",
    "start": "1290120",
    "end": "1296780"
  },
  {
    "text": "back and you need me to grow that are we okay so there's a namespace named secure",
    "start": "1296780",
    "end": "1304280"
  },
  {
    "text": "namespaces aren't technically security boundaries naming one secure does not make your deployment secure",
    "start": "1304280",
    "end": "1311240"
  },
  {
    "text": "um but this one is named secure so that's where the service account came from so let's try",
    "start": "1311240",
    "end": "1317480"
  },
  {
    "text": "using it so we'll do add that to my command and sure enough there's a pod single pod single",
    "start": "1317480",
    "end": "1323299"
  },
  {
    "text": "container in there running a web app that's that's our vulnerable app so we are now connecting from an",
    "start": "1323299",
    "end": "1329960"
  },
  {
    "text": "external entity index my laptop in this case to the API server using a token we",
    "start": "1329960",
    "end": "1336080"
  },
  {
    "text": "stole from the Pod that had a vulnerable remote code execution vulnerability in",
    "start": "1336080",
    "end": "1341659"
  },
  {
    "text": "it let's see let's see what else we can do with this so we're going to use the cube",
    "start": "1341659",
    "end": "1347960"
  },
  {
    "text": "CTL auth can I command and we're going to list our capabilities",
    "start": "1347960",
    "end": "1353900"
  },
  {
    "text": "so in the default namespace because I didn't provide one it's saying I can get it endpoints so that was my kind of my",
    "start": "1353900",
    "end": "1360559"
  },
  {
    "text": "first in to know that the token worked remember we were able to get endpoints that's interesting but whatever but I",
    "start": "1360559",
    "end": "1366620"
  },
  {
    "text": "don't really have a lot of access to access to anything else but if I ask what I can do in the secure namespace",
    "start": "1366620",
    "end": "1373840"
  },
  {
    "text": "here you can see at the top resources point at it here I guess the very top",
    "start": "1375440",
    "end": "1381559"
  },
  {
    "text": "you see resources wild card and all the verbs so I pretty much have",
    "start": "1381559",
    "end": "1388159"
  },
  {
    "text": "all the access I need in this namespace this is not uncommon",
    "start": "1388159",
    "end": "1393740"
  },
  {
    "text": "with with a deployment developer will write a deployment and create a service account and create our back for it",
    "start": "1393740",
    "end": "1399140"
  },
  {
    "text": "because of course I'm going to need to access the stuff in my namespace it's my namespace it's where my app is deployed I need access to all the things",
    "start": "1399140",
    "end": "1406340"
  },
  {
    "text": "we they might think so",
    "start": "1406340",
    "end": "1411620"
  },
  {
    "text": "we have access to things in the namespace in the secure namespace",
    "start": "1411620",
    "end": "1417100"
  },
  {
    "text": "um so uh so what we found out now among we already already know all that stuff",
    "start": "1417380",
    "end": "1422600"
  },
  {
    "text": "the new info is that we have this uh token that has limited access and default but it has",
    "start": "1422600",
    "end": "1428900"
  },
  {
    "text": "um broad access in the secure named namespace",
    "start": "1428900",
    "end": "1434140"
  },
  {
    "text": "and the finding here is that there's a role that gives a service account way too many permissions in the same space",
    "start": "1434240",
    "end": "1439820"
  },
  {
    "text": "shouldn't have that many verbs you shouldn't give blanket access just because it's your namespace",
    "start": "1439820",
    "end": "1445039"
  },
  {
    "text": "doesn't mean you need to do everything in your namespace so moving to the next step",
    "start": "1445039",
    "end": "1452419"
  },
  {
    "text": "so now um we want to get a beachhead in this cluster we want to get our own code",
    "start": "1452419",
    "end": "1458360"
  },
  {
    "text": "running out there it's been nice visiting this this vulnerable pod but I'd like to get my own stuff running out",
    "start": "1458360",
    "end": "1464539"
  },
  {
    "text": "there so the first thing I'm going to do is um I want to get into that pod that's",
    "start": "1464539",
    "end": "1470659"
  },
  {
    "text": "running with a with an exec so that I have a like a real shell in there and I'm not having to use that web interface to mess with it so we have I'll rerun",
    "start": "1470659",
    "end": "1479780"
  },
  {
    "text": "that pod so there's our pod and we're just going to do",
    "start": "1479780",
    "end": "1485419"
  },
  {
    "text": "um an exec into it so I'll just type it I have K Alias to",
    "start": "1485419",
    "end": "1491900"
  },
  {
    "text": "cubesatel because I'm lazy I.T we're going to go after web admin up",
    "start": "1491900",
    "end": "1498980"
  },
  {
    "text": "name the namespace secure I'm going to go after web admin and we want to run",
    "start": "1498980",
    "end": "1505580"
  },
  {
    "text": "Bash okay and I'm exacting to that pod now from outside exact in",
    "start": "1505580",
    "end": "1512419"
  },
  {
    "text": "who am I I can see it from The Prompt but I wanted to type it to be sure I'm the web",
    "start": "1512419",
    "end": "1518000"
  },
  {
    "text": "admin user so that's a hey that's a bonus whoever developed this container or rent or this deployment is not",
    "start": "1518000",
    "end": "1523280"
  },
  {
    "text": "running as root by default most open source containers by default the base images you pull are usually root by",
    "start": "1523280",
    "end": "1530179"
  },
  {
    "text": "default um you should not run as root if you can avoid it we'll talk more about that in",
    "start": "1530179",
    "end": "1536179"
  },
  {
    "text": "the mitigation sections but um that's a good sign for them",
    "start": "1536179",
    "end": "1541279"
  },
  {
    "text": "I need to be root though to do something so let's see if I can sudo and become root sudo not found okay well this image",
    "start": "1541279",
    "end": "1548000"
  },
  {
    "text": "doesn't have suda that's that's good for them let's see if we can touch the file system and make some",
    "start": "1548000",
    "end": "1554480"
  },
  {
    "text": "changes so I'm going to do a touch test I was able to make a file so I have a",
    "start": "1554480",
    "end": "1561500"
  },
  {
    "text": "readable or I'm sorry a writable root file system here um",
    "start": "1561500",
    "end": "1567220"
  },
  {
    "text": "that is because whoever deployed this did not set these security context read",
    "start": "1567220",
    "end": "1573320"
  },
  {
    "text": "only root file system equal true for those of you aren't aware when you container runtime starts up a container",
    "start": "1573320",
    "end": "1579500"
  },
  {
    "text": "all the layers that are in the image are immutable basically and then it adds",
    "start": "1579500",
    "end": "1584539"
  },
  {
    "text": "inserts by default a read write layer and any mutations that happen at runtime",
    "start": "1584539",
    "end": "1589580"
  },
  {
    "text": "are happen happen there with a copy on write kind of an operation so what I just did is told you know the process",
    "start": "1589580",
    "end": "1595700"
  },
  {
    "text": "said make a file so the file got put into that read write layer [Music]",
    "start": "1595700",
    "end": "1600799"
  },
  {
    "text": "um that's interesting we'll talk about why you might not want to run with a read",
    "start": "1600799",
    "end": "1606320"
  },
  {
    "text": "write layer in a bit but we'll leave it at that good information to have",
    "start": "1606320",
    "end": "1611600"
  },
  {
    "text": "um so that's nice but I really can't do much else here I I don't want to really poke",
    "start": "1611600",
    "end": "1618679"
  },
  {
    "text": "around in here much more but I know now this pod really isn't interesting so I want to run my own pod",
    "start": "1618679",
    "end": "1625159"
  },
  {
    "text": "so we have I'm going to pull this up in my IDE to show it to you we have some demo yamls with different pods to try to",
    "start": "1625159",
    "end": "1633620"
  },
  {
    "text": "deploy I'm going to try to run a root pod which is simply an Alpine pod I just",
    "start": "1633620",
    "end": "1638720"
  },
  {
    "text": "want to see Alpine is root by default I just want to see if this will run it's just going to start up and sleep",
    "start": "1638720",
    "end": "1645020"
  },
  {
    "text": "I just want to see if I can deploy that so we'll go back to my shell and get out of my exec",
    "start": "1645020",
    "end": "1651559"
  },
  {
    "text": "and I'm going to do an apply into the secure namespace",
    "start": "1651559",
    "end": "1658480"
  },
  {
    "text": "the file demo yamos root",
    "start": "1660260",
    "end": "1665539"
  },
  {
    "text": "pod it says it created it as you'll see right there",
    "start": "1665840",
    "end": "1671960"
  },
  {
    "text": "so if I do a git pod in the secure namespace yes I could set my default",
    "start": "1671960",
    "end": "1677260"
  },
  {
    "text": "namespace but I don't want to uh so it's sitting there on container creating it's",
    "start": "1677260",
    "end": "1682460"
  },
  {
    "text": "probably pulling the Alpine image at the moment um",
    "start": "1682460",
    "end": "1688059"
  },
  {
    "text": "in a moment I'm not going to wait for it right now but you're going to see it change to create configure create",
    "start": "1688880",
    "end": "1694159"
  },
  {
    "text": "container config error the reason being if",
    "start": "1694159",
    "end": "1699380"
  },
  {
    "text": "come on hey there it goes so if we do a describe on this",
    "start": "1699380",
    "end": "1704440"
  },
  {
    "text": "pod root pod see at the bottom here it says container",
    "start": "1706840",
    "end": "1711980"
  },
  {
    "text": "has run is non-root and an image will run as root um so something I didn't say that my",
    "start": "1711980",
    "end": "1718700"
  },
  {
    "text": "manifest didn't have run as non-read in it but something is doing that and that something is a pod security policy I'm",
    "start": "1718700",
    "end": "1723980"
  },
  {
    "text": "pretty I know because I wrote this demo but you can see here there's a PSP here so pod",
    "start": "1723980",
    "end": "1729799"
  },
  {
    "text": "security policy is making sure no images are running or no containers are running as roots",
    "start": "1729799",
    "end": "1735799"
  },
  {
    "text": "that's also a smart choice because again if even if you're in a container if",
    "start": "1735799",
    "end": "1741679"
  },
  {
    "text": "you're root you have elevated privileges in that container to do things you can do app get install possibly you can do",
    "start": "1741679",
    "end": "1747020"
  },
  {
    "text": "all sorts of things you might not want people to do so I've got",
    "start": "1747020",
    "end": "1752059"
  },
  {
    "text": "another pod here called non-root priv I'm going to look at that",
    "start": "1752059",
    "end": "1757820"
  },
  {
    "text": "this one's a little more longer it has an image called sneaky it's in my Docker Hub repository it's my",
    "start": "1757820",
    "end": "1765200"
  },
  {
    "text": "own image of my own crafting it's actually Matt up here wrote it but I took it over and I own it now",
    "start": "1765200",
    "end": "1771679"
  },
  {
    "text": "um it is going to try to run with privileged mode on",
    "start": "1771679",
    "end": "1777380"
  },
  {
    "text": "privileged basically gives you access to devices on the hosts uh I've heard it",
    "start": "1777380",
    "end": "1783260"
  },
  {
    "text": "called the insecure mode uh so but it's going to run as a non-root user so it's",
    "start": "1783260",
    "end": "1788480"
  },
  {
    "text": "going to start startup is non-root but be privileged and in doing so I want it's going to try to mount the host",
    "start": "1788480",
    "end": "1794120"
  },
  {
    "text": "volume on the Node into the container out of at a path called charoot",
    "start": "1794120",
    "end": "1799940"
  },
  {
    "text": "so let's try to deploy that let me kill uh secure I'm going to delete that root pod",
    "start": "1799940",
    "end": "1807080"
  },
  {
    "text": "just to get it out of the way so it's not confusing let me tell it it's a pod",
    "start": "1807080",
    "end": "1814419"
  },
  {
    "text": "did I type that wrong",
    "start": "1814640",
    "end": "1817720"
  },
  {
    "text": "okay did I what I miss oh thank you",
    "start": "1820039",
    "end": "1827120"
  },
  {
    "text": "okay so now",
    "start": "1827120",
    "end": "1830200"
  },
  {
    "text": "yamos root",
    "start": "1834020",
    "end": "1837980"
  },
  {
    "text": "oh actually read your notes are non-root",
    "start": "1840440",
    "end": "1846380"
  },
  {
    "text": "peruv yaml this one immediately fails and sure enough it says pod security policy unable to admit pod invalid",
    "start": "1846380",
    "end": "1853820"
  },
  {
    "text": "privileged containers are not allowed that's very standard that's the standard pod security example you don't want",
    "start": "1853820",
    "end": "1859159"
  },
  {
    "text": "privileged containers privileged containers are you you don't need them I mean unless you're writing like low level uh",
    "start": "1859159",
    "end": "1866779"
  },
  {
    "text": "monitoring stuff for your kubernetes clusters or or you're running things that you're a cluster you're a cluster",
    "start": "1866779",
    "end": "1871940"
  },
  {
    "text": "op and you've got things like that if you're running business apps you don't need to be privileged",
    "start": "1871940",
    "end": "1877100"
  },
  {
    "text": "um you shouldn't be privileged if you are come talk to me I'll tell you why you don't need to be privileged",
    "start": "1877100",
    "end": "1882200"
  },
  {
    "text": "um utilities Maybe but so that's good to know so I've got",
    "start": "1882200",
    "end": "1888200"
  },
  {
    "text": "another one called non-root non-priv that gets a gets rid of that we'll just",
    "start": "1888200",
    "end": "1893720"
  },
  {
    "text": "say fine we're just going to run my sneaky image with um my non-root non-privileged user since",
    "start": "1893720",
    "end": "1900559"
  },
  {
    "text": "that's the only thing I'm seeming to be able to do",
    "start": "1900559",
    "end": "1904778"
  },
  {
    "text": "that says it deployed so let's look at and there it is running so we have a",
    "start": "1906380",
    "end": "1912980"
  },
  {
    "text": "sneaky pod that is running so again I want to get away from my notes because I'll get ahead of myself uh",
    "start": "1912980",
    "end": "1919640"
  },
  {
    "text": "let's exec into it I'm just going to copy this so it's type it so here I am in my sneaky pod now we",
    "start": "1919640",
    "end": "1926840"
  },
  {
    "text": "can't run as root so we are the sneaky user in the sneaky pod",
    "start": "1926840",
    "end": "1934100"
  },
  {
    "text": "um and however this is my image I do have sudo in my image so now I am",
    "start": "1934100",
    "end": "1940640"
  },
  {
    "text": "root in a pod in a container on somebody else's kubernetes server",
    "start": "1940640",
    "end": "1946940"
  },
  {
    "text": "what can we do with that so let's do a checkpoint real quick we now know that um the container is somewhat hardened by",
    "start": "1946940",
    "end": "1953960"
  },
  {
    "text": "running is non-root and not having sudo in there um the application application container",
    "start": "1953960",
    "end": "1959659"
  },
  {
    "text": "is mutable interesting uh there are PSP configurations in place that are",
    "start": "1959659",
    "end": "1966080"
  },
  {
    "text": "stopping root user and um privilege mode",
    "start": "1966080",
    "end": "1971179"
  },
  {
    "text": "but that namespace the PSP must not be setting allow privileged escalation to",
    "start": "1971179",
    "end": "1976880"
  },
  {
    "text": "false what that setting would do would be stop an suid binary from doing what I just",
    "start": "1976880",
    "end": "1982279"
  },
  {
    "text": "did that is not default so even though you say don't allow",
    "start": "1982279",
    "end": "1988100"
  },
  {
    "text": "privileged containers don't allow root users unless you explicitly say don't allow privilege escalation you can and",
    "start": "1988100",
    "end": "1995840"
  },
  {
    "text": "that's because there are applications out there who need to use possibly Elevate privileges temporarily to do",
    "start": "1995840",
    "end": "2002559"
  },
  {
    "text": "something so the folks that wrote you know the original uh you know containerd Docker",
    "start": "2002559",
    "end": "2008860"
  },
  {
    "text": "and podman and all that they're like oh we're going to have to allow that one kind of because there's too many apps",
    "start": "2008860",
    "end": "2014740"
  },
  {
    "text": "that would break if we didn't nowadays I kind of wish they hadn't made that decision and the kubernetes folks",
    "start": "2014740",
    "end": "2020740"
  },
  {
    "text": "would have you know would change this but again backwards compatibility so just know that you can you know run",
    "start": "2020740",
    "end": "2027039"
  },
  {
    "text": "SE IDs unless you explicitly say not to so the PSP did not disallow privilege escalation is that is that step and I'm",
    "start": "2027039",
    "end": "2032980"
  },
  {
    "text": "going to take a drink for anybody that might have caught up",
    "start": "2032980",
    "end": "2038860"
  },
  {
    "text": "and I'm doubting Wi-Fi has let you but uh we are now on 2E exploit MD part five",
    "start": "2038860",
    "end": "2047500"
  },
  {
    "text": "so we have now exploited the secure name namespace let's see if we get out of that because",
    "start": "2047500",
    "end": "2054839"
  },
  {
    "text": "I'm I want to I I want more I always want more I want to expand my borders",
    "start": "2054839",
    "end": "2061000"
  },
  {
    "text": "um so we now have a container with root privileges and we're going to use that to explore more of the cluster",
    "start": "2061000",
    "end": "2068260"
  },
  {
    "text": "we know this cluster hat is hosting this vulnerable application we're saying in production but you know",
    "start": "2068260",
    "end": "2074200"
  },
  {
    "text": "in this environment whatever this might be uh but you know what there's a good",
    "start": "2074200",
    "end": "2079898"
  },
  {
    "text": "chance there might be people running the same app somewhere else on this cluster and I would like to find that if so and maybe use that to break out",
    "start": "2079899",
    "end": "2087220"
  },
  {
    "text": "so I'm going to use nmap this is why I needed root because there are some commands that you need root to run and",
    "start": "2087220",
    "end": "2093339"
  },
  {
    "text": "nmap is one of them I'm not a I'm not an uh sys admin I'm not a network engineer",
    "start": "2093339",
    "end": "2099099"
  },
  {
    "text": "what I know of nmap is it's a tool for scanning your network to find open ports I know it has valid uses I'm sure",
    "start": "2099099",
    "end": "2106119"
  },
  {
    "text": "Mourinho over here can tell me these cool uses that Network people use nmap for but I know it is this is the thing",
    "start": "2106119",
    "end": "2112300"
  },
  {
    "text": "you sniff networks with to break into things so what I'm going to do first",
    "start": "2112300",
    "end": "2118060"
  },
  {
    "text": "so I'd like to know what my IP address is just so I kind of have a bearing of who I am on this on this network",
    "start": "2118060",
    "end": "2123460"
  },
  {
    "text": "and I'm using hostname I you could also use ifconfig or whatever you like and I'm going to use that in the nmap",
    "start": "2123460",
    "end": "2129940"
  },
  {
    "text": "arguments which I have to copy because I had to relearn these every time I do it and I'm going to replace what's in this",
    "start": "2129940",
    "end": "2135839"
  },
  {
    "text": "with what I just pulled up so I'm going to delete",
    "start": "2135839",
    "end": "2141700"
  },
  {
    "text": "honestly it's just a 24 so I probably don't even need to do that so so what nmap is now doing is it is",
    "start": "2141700",
    "end": "2148720"
  },
  {
    "text": "searching for any five port five thousand listeners on that subnet on the 24-bit uh bitmap netmask",
    "start": "2148720",
    "end": "2155920"
  },
  {
    "text": "um so anything in 10 to 244 162 that's listing on 5000 any moment now it will",
    "start": "2155920",
    "end": "2162220"
  },
  {
    "text": "come back and tell me what's there there we go so it is telling me",
    "start": "2162220",
    "end": "2169359"
  },
  {
    "text": "that's",
    "start": "2169359",
    "end": "2172259"
  },
  {
    "text": "scan report for we've got 162 129 and 162 133 both were found listening on",
    "start": "2174520",
    "end": "2182260"
  },
  {
    "text": "that TCP Port we know that 129 well let's actually before I say that let's",
    "start": "2182260",
    "end": "2187660"
  },
  {
    "text": "go back to our browser and the port where I pulled the IP address 133 is our",
    "start": "2187660",
    "end": "2193780"
  },
  {
    "text": "vulnerable app that we started with that's this one that's not that's something else",
    "start": "2193780",
    "end": "2200200"
  },
  {
    "text": "listening on Port 5000. now I know it's not this my my uh sneaky image container because that's",
    "start": "2200200",
    "end": "2207880"
  },
  {
    "text": "136. so I want to see what's what's in this 133 it's listing on Fort 5000.",
    "start": "2207880",
    "end": "2214300"
  },
  {
    "text": "maybe it's vulnerable",
    "start": "2214300",
    "end": "2217380"
  },
  {
    "text": "um so again I'm not gonna to labor this but we have another app listening on 5000 that's not in the",
    "start": "2220660",
    "end": "2227320"
  },
  {
    "text": "secure namespace we know it's not in the secure name space because we looked at the pods running in Secure there's only one and it only has one instance one one",
    "start": "2227320",
    "end": "2234400"
  },
  {
    "text": "replica so it's got to be somewhere else um this also tells me this plus the fact",
    "start": "2234400",
    "end": "2241359"
  },
  {
    "text": "that I was able to hit Google pull images from Docker Hub is we probably have absolutely no network policy in",
    "start": "2241359",
    "end": "2247180"
  },
  {
    "text": "place here or we have a very loose one if any and uh perimeter firewalls are seem to be not set up either which is",
    "start": "2247180",
    "end": "2253540"
  },
  {
    "text": "you know maybe that's contrived but Network policy missing is not something that's that",
    "start": "2253540",
    "end": "2259300"
  },
  {
    "text": "um that that happens a lot a lot of developers shy away from Network policy because they think oh firewall rules",
    "start": "2259300",
    "end": "2265300"
  },
  {
    "text": "that's not my job Network policy if if you're a developer Like Me In This Crowd and you look at",
    "start": "2265300",
    "end": "2270700"
  },
  {
    "text": "Network policy and you think it's scary it's really not please take some time to learn it and we'll talk about that in a",
    "start": "2270700",
    "end": "2275920"
  },
  {
    "text": "little bit um as a yeah we'll talk about that a little bit so I'm going to skip over",
    "start": "2275920",
    "end": "2281920"
  },
  {
    "text": "that we're just going to go to the timeout if we now we now know that network has nearly no or no network controls are in",
    "start": "2281920",
    "end": "2287980"
  },
  {
    "text": "place here so let's try to get out of our namespace by attacking that IP address",
    "start": "2287980",
    "end": "2293560"
  },
  {
    "text": "for now on part six and we're going to use another tool that",
    "start": "2293560",
    "end": "2298839"
  },
  {
    "text": "I'm sure has valid reasons for you all useless admins out there so cat I use it for tunneling through things",
    "start": "2298839",
    "end": "2305079"
  },
  {
    "text": "um so we're going to use that in the sneaky pod we're going to set up a listener there on 5001 and we're going",
    "start": "2305079",
    "end": "2311859"
  },
  {
    "text": "to send all traffic to this other pod on 5000. and I have to adjust that IP",
    "start": "2311859",
    "end": "2318760"
  },
  {
    "text": "because it what was it it was 130 129 yeah okay",
    "start": "2318760",
    "end": "2325720"
  },
  {
    "text": "there we go so that's just going to sit there and Route traffic for me so I need now need to",
    "start": "2325720",
    "end": "2331540"
  },
  {
    "text": "come back out I'm going to open another shell and I'm going to do a cube CTL port forward into the sneaky pod so that",
    "start": "2331540",
    "end": "2338440"
  },
  {
    "text": "I can send traffic through that port forward and then bounce it through that socat so I'm going to copy that so if I open",
    "start": "2338440",
    "end": "2344920"
  },
  {
    "text": "another terminal let me grow that font up for you and CD",
    "start": "2344920",
    "end": "2350920"
  },
  {
    "text": "back into the right directory so if you look at where we ran that setup kubeconfig sh it dropped a demo Cube",
    "start": "2350920",
    "end": "2357880"
  },
  {
    "text": "config file and I can cat that so that's that token we stole at the",
    "start": "2357880",
    "end": "2364540"
  },
  {
    "text": "beginning I want to set my kubeconfig to that",
    "start": "2364540",
    "end": "2370720"
  },
  {
    "text": "and then I'm going to port forward into the sneaky pod and the secure named namespace",
    "start": "2370720",
    "end": "2376420"
  },
  {
    "text": "so now I'm listening on localhost 5001 sending to 5001 in sneaky pod which will",
    "start": "2376420",
    "end": "2383320"
  },
  {
    "text": "then turn around and send it to 5000 and whatever that other thing is",
    "start": "2383320",
    "end": "2388380"
  },
  {
    "text": "so from there I'm just going to open a localhost 5001. and lo and behold it's the same app imagine that",
    "start": "2388420",
    "end": "2395520"
  },
  {
    "text": "so uh you notice I didn't put a context on there because I I am not going through Port 80 I'm not going through",
    "start": "2395520",
    "end": "2400960"
  },
  {
    "text": "any kind of Ingress any kind of routing thing I'm hitting a pod directly at this point or a service",
    "start": "2400960",
    "end": "2407859"
  },
  {
    "text": "so let's see if it's vulnerable maybe this is a new version maybe they know about this vulnerability and they fixed",
    "start": "2407859",
    "end": "2412960"
  },
  {
    "text": "it so let's just do command equal oh I don't know hostname again",
    "start": "2412960",
    "end": "2418599"
  },
  {
    "text": "it's vulnerable so somebody else maybe a developer who knows is running another",
    "start": "2418599",
    "end": "2423820"
  },
  {
    "text": "copy of this app somewhere else in the cluster now okay",
    "start": "2423820",
    "end": "2429099"
  },
  {
    "text": "so let's rinse and repeat rinse and repeat let's try to get the token out of that",
    "start": "2429099",
    "end": "2435160"
  },
  {
    "text": "there it is so we're going to copy that token now",
    "start": "2435160",
    "end": "2440500"
  },
  {
    "text": "again I'm going to make sure I'm following my steps don't want to skip ahead of anything now I don't really need the port forward anymore because if",
    "start": "2440500",
    "end": "2446320"
  },
  {
    "text": "this is what I think it is I should be able to get into that pod the same way I got into this one so just so I'm going to kill my",
    "start": "2446320",
    "end": "2452680"
  },
  {
    "text": "port forward here I'm going to kill my slow cat and exit out of my sneaky pod",
    "start": "2452680",
    "end": "2460119"
  },
  {
    "text": "I'm going to edit that demo Cube config file just because it's easy",
    "start": "2460119",
    "end": "2465280"
  },
  {
    "text": "and I'll just comment that line out",
    "start": "2465280",
    "end": "2469619"
  },
  {
    "text": "and we'll add a new token I'm just going to paste it in",
    "start": "2470800",
    "end": "2476200"
  },
  {
    "text": "and now let's do Cube CTL get pods it's a default namespace token so I can",
    "start": "2476200",
    "end": "2484780"
  },
  {
    "text": "see there's another copy web admin running but I'm in the default namespace because I did not specify a namespace on",
    "start": "2484780",
    "end": "2490000"
  },
  {
    "text": "that command line so I should now be able to do the good",
    "start": "2490000",
    "end": "2495940"
  },
  {
    "text": "old Q that's k auth can",
    "start": "2495940",
    "end": "2502259"
  },
  {
    "text": "I dash dash lists so now I'm in the default namespace with a wild card",
    "start": "2502780",
    "end": "2508119"
  },
  {
    "text": "resource that has all the verbs so why would this have happened well",
    "start": "2508119",
    "end": "2514300"
  },
  {
    "text": "developer maybe deployed to default namespace in this development cluster",
    "start": "2514300",
    "end": "2519460"
  },
  {
    "text": "and didn't bother to go through and set up our back for it",
    "start": "2519460",
    "end": "2524619"
  },
  {
    "text": "just because they're they're hacking away they're trying something out not uncommon",
    "start": "2524619",
    "end": "2530079"
  },
  {
    "text": "um so yeah that's interesting to me so now",
    "start": "2530079",
    "end": "2538300"
  },
  {
    "text": "um I would like to try to deploy my non-rootproof file again into the",
    "start": "2538300",
    "end": "2544900"
  },
  {
    "text": "default namespace so if you remember this is the one that's going to try to run in privilege mode",
    "start": "2544900",
    "end": "2551320"
  },
  {
    "text": "so again we're kind of in a rinse and repeat mode here we're going to get K apply file demo yaml non-root prove",
    "start": "2551320",
    "end": "2560619"
  },
  {
    "text": "I'm not doing the root one because that's just Alpine and I'm kind of past that I don't really care right now it says it created it so we don't have a",
    "start": "2560619",
    "end": "2567280"
  },
  {
    "text": "PSP stopping things in the default namespace apparently",
    "start": "2567280",
    "end": "2573040"
  },
  {
    "text": "um okay get pods it's running okay exact",
    "start": "2573040",
    "end": "2579060"
  },
  {
    "text": "i t into the non-root prove Bash",
    "start": "2579520",
    "end": "2585339"
  },
  {
    "text": "and you can see where I'm going I'm now root in a privileged pod",
    "start": "2585339",
    "end": "2590560"
  },
  {
    "text": "in the default namespace of this cluster and again making sure I'm not getting",
    "start": "2590560",
    "end": "2596800"
  },
  {
    "text": "past anything um so",
    "start": "2596800",
    "end": "2602040"
  },
  {
    "text": "what am I looking at okay so uh I've become root now what I can do is kind of interesting",
    "start": "2604000",
    "end": "2609700"
  },
  {
    "text": "let's do a PS there's my process list that's normal for a container right all I see is the bash that I'm in ignore the",
    "start": "2609700",
    "end": "2617319"
  },
  {
    "text": "go TTY that's another hack I have in this this sneaky image I could actually be connecting through a web terminal go",
    "start": "2617319",
    "end": "2622960"
  },
  {
    "text": "TTY server go tdi's fund um but I'm just running PS here I've just got those are the processes running",
    "start": "2622960",
    "end": "2628900"
  },
  {
    "text": "in this container however if you know I I'm again I'm not a CIS admin but I know that uh PS uses",
    "start": "2628900",
    "end": "2636400"
  },
  {
    "text": "the proc file system to list its processes so if I do a true root change my route to the aptly named",
    "start": "2636400",
    "end": "2644440"
  },
  {
    "text": "charroot volume and do it again there's all the processes on the host",
    "start": "2644440",
    "end": "2651160"
  },
  {
    "text": "I'm now basically rude on this box this node is mine",
    "start": "2651160",
    "end": "2656339"
  },
  {
    "text": "because I'm privileged again privileged bad unless you know what you're doing please don't use privilege",
    "start": "2656339",
    "end": "2664119"
  },
  {
    "text": "um and again that's because the proc file says the PS command is looking at the proc file system to come up with all the",
    "start": "2664119",
    "end": "2670180"
  },
  {
    "text": "processes uh and when I remapped to root remaps your what what your your root",
    "start": "2670180",
    "end": "2675819"
  },
  {
    "text": "volume is for the you know the context of of where you ran it",
    "start": "2675819",
    "end": "2681099"
  },
  {
    "text": "um so now we know got a lot of stuff here but you've been following along so you get where we are here we we are now",
    "start": "2681099",
    "end": "2688599"
  },
  {
    "text": "finding that we have no restrictions in the default namespace to speak of or at least not enough that stopped me from doing that",
    "start": "2688599",
    "end": "2694420"
  },
  {
    "text": "so the next step check my time well we're doing pretty good okay um let's take this over the Finish Line",
    "start": "2694420",
    "end": "2701020"
  },
  {
    "text": "as it says so owning a node is nice but we want to own a cluster so",
    "start": "2701020",
    "end": "2708460"
  },
  {
    "text": "um now that we have that host file system there's a lot of information on a node's file system that is useful",
    "start": "2708460",
    "end": "2715260"
  },
  {
    "text": "so what we want to get at now is I want to look into the cube system namespace",
    "start": "2715260",
    "end": "2721180"
  },
  {
    "text": "and I want to see what other nodes are in this cluster so I need a token for doing that well",
    "start": "2721180",
    "end": "2728319"
  },
  {
    "text": "fortunately the kublet has one of those as you can see in these steps I'm going",
    "start": "2728319",
    "end": "2733359"
  },
  {
    "text": "to now use the kubelets cubeconfig to start poking around so we're going to copy this so now I have to type it",
    "start": "2733359",
    "end": "2741760"
  },
  {
    "text": "and it's my sneaky pod I have Cube CTL in there so I don't even have to worry about downloading and installing that",
    "start": "2741760",
    "end": "2747400"
  },
  {
    "text": "let's list our pods and so I can see Kube system now because kubelet has that",
    "start": "2747400",
    "end": "2752560"
  },
  {
    "text": "privilege and it has the ability to look at nodes so I",
    "start": "2752560",
    "end": "2759040"
  },
  {
    "text": "can see I have a kind control plane and a kind worker uh",
    "start": "2759040",
    "end": "2764460"
  },
  {
    "text": "that's all that I want to run a pod directly on This",
    "start": "2764460",
    "end": "2771040"
  },
  {
    "text": "Server I'm not going to do this because I don't want to wait for the Wi-Fi to pull down BusyBox you can't the kublets",
    "start": "2771040",
    "end": "2776619"
  },
  {
    "text": "token is not allowed to ask the API server to start a pod because it would never need to do that kublet starts",
    "start": "2776619",
    "end": "2782859"
  },
  {
    "text": "containers kubelet talks to the runtime it wouldn't do that so if I were to try to run that I'm going to get a forbidden",
    "start": "2782859",
    "end": "2788500"
  },
  {
    "text": "because it doesn't have those privileges um however I do have Etsy kubernetes manifests I",
    "start": "2788500",
    "end": "2795640"
  },
  {
    "text": "could put in anything I want in there and it'll start those up all day long um not going to do that that's that is an",
    "start": "2795640",
    "end": "2802660"
  },
  {
    "text": "option though but because we've escaped the spot security policy and we know what nodes we have uh I want to go after something",
    "start": "2802660",
    "end": "2809140"
  },
  {
    "text": "else I want to launch um uh I want to launch a pod to the node that is hosting FCD",
    "start": "2809140",
    "end": "2817420"
  },
  {
    "text": "and um Mount the file system there to find out the credentials to NCD because SCD is",
    "start": "2817420",
    "end": "2824859"
  },
  {
    "text": "where everything is so go back to my IDE",
    "start": "2824859",
    "end": "2830200"
  },
  {
    "text": "see I have a simple SCD pod definition it's going to go use the standard FCD 3310 image and",
    "start": "2830200",
    "end": "2840160"
  },
  {
    "text": "I'm actually skipping forward here so let me show you let's just let me do this",
    "start": "2840160",
    "end": "2848460"
  },
  {
    "text": "so I'm going to describe the Pod that we see in there named FCD kind control plane in the cube system",
    "start": "2849280",
    "end": "2855460"
  },
  {
    "text": "and I can scroll up here and there's all sorts of Juicy bits of information here it's telling me where my cert file is",
    "start": "2855460",
    "end": "2861400"
  },
  {
    "text": "what's my what's the IPS for connecting to the to the FCD database all that good information that",
    "start": "2861400",
    "end": "2869140"
  },
  {
    "text": "I might need to get at go after at CD now I've because it's kind it's all",
    "start": "2869140",
    "end": "2875560"
  },
  {
    "text": "going to be the same values every time so I've already copied those create in here for you and you can see environment",
    "start": "2875560",
    "end": "2881859"
  },
  {
    "text": "variables being set up for all the things about where where that is and the amount paths for where those certain",
    "start": "2881859",
    "end": "2889359"
  },
  {
    "text": "keys are on the on the Node that we're going to run this on so",
    "start": "2889359",
    "end": "2895480"
  },
  {
    "text": "let me go ahead and again let me go back to my steps",
    "start": "2895480",
    "end": "2901359"
  },
  {
    "text": "uh this just talks about what I just said and if they were different you would",
    "start": "2901359",
    "end": "2907000"
  },
  {
    "text": "edit that yaml file to to match but we're going to go ahead and oops",
    "start": "2907000",
    "end": "2913619"
  },
  {
    "text": "copy this we're going to get out of my sneaky pod",
    "start": "2913900",
    "end": "2918420"
  },
  {
    "text": "one more they're back on the laptop using the defaults namespace token",
    "start": "2919619",
    "end": "2928000"
  },
  {
    "text": "foreign sorry that is my my daughter's school district calling to say they probably have no school tomorrow again because",
    "start": "2928000",
    "end": "2933099"
  },
  {
    "text": "it's ice all over the place there okay so we have just deployed FCD client",
    "start": "2933099",
    "end": "2942000"
  },
  {
    "text": "it's running and I'm then going to exec into that and",
    "start": "2942280",
    "end": "2948940"
  },
  {
    "text": "I first just want to do something that will verify that the connection's working so I'm going to do a net CD CTL member list",
    "start": "2948940",
    "end": "2956260"
  },
  {
    "text": "and it's that tells me hey yeah I was able to connect here's some information about",
    "start": "2956260",
    "end": "2961480"
  },
  {
    "text": "um the cluster about the LCD cluster",
    "start": "2961480",
    "end": "2965880"
  },
  {
    "text": "um now what do you go after an FCD you go after secrets of course so I'm going to go get keys",
    "start": "2966579",
    "end": "2974380"
  },
  {
    "text": "um rep for secrets and only two things came back",
    "start": "2974380",
    "end": "2979960"
  },
  {
    "text": "that's interesting",
    "start": "2979960",
    "end": "2982859"
  },
  {
    "text": "hmm so this has changed from when I ran this probably because I ran this against 123.",
    "start": "2988240",
    "end": "2996070"
  },
  {
    "text": "[Music] um oh crap",
    "start": "2996070",
    "end": "3003599"
  },
  {
    "text": "just a second",
    "start": "3003599",
    "end": "3006560"
  },
  {
    "text": "all right here here's a here here is where you see the guy that does the demo sweat because I've made a change to my",
    "start": "3013079",
    "end": "3020880"
  },
  {
    "text": "uh my repository without changing my steps so um",
    "start": "3020880",
    "end": "3026520"
  },
  {
    "text": "shoot what I expected to see is what you see output here and I now I'm thinking back",
    "start": "3026520",
    "end": "3032460"
  },
  {
    "text": "and this is why because I normally I used to run this on 123 and I've updated it to 124. and",
    "start": "3032460",
    "end": "3039060"
  },
  {
    "text": "you never do that right before your demo um in 124 the defaults for Secrets I",
    "start": "3039060",
    "end": "3044760"
  },
  {
    "text": "believe changed for tokens but what you should be seeing if I were to go back and troubleshoot this if I had time to",
    "start": "3044760",
    "end": "3050640"
  },
  {
    "text": "is a whole bunch of Secrets and we're looking for the cluster aggregation controller token one",
    "start": "3050640",
    "end": "3056819"
  },
  {
    "text": "that's not a cluster aggregation controller one",
    "start": "3056819",
    "end": "3061520"
  },
  {
    "text": "um this one has cluster admin rights by default so we want to go after that token if",
    "start": "3062099",
    "end": "3069720"
  },
  {
    "text": "if I have time at the end of this I'm going to run through showing you the screenshots and I'm going to try to",
    "start": "3070500",
    "end": "3075540"
  },
  {
    "text": "redeploy this quickly on 123 and show it to you um but what you would see",
    "start": "3075540",
    "end": "3082559"
  },
  {
    "text": "is this big long if you if you go on there you get it replace the that",
    "start": "3082559",
    "end": "3087660"
  },
  {
    "text": "command with the right token you'd get the output with this token in it set that up the same way we set the other",
    "start": "3087660",
    "end": "3093420"
  },
  {
    "text": "token up and do a can I this is old you don't actually have to do the pasting of the token in there but",
    "start": "3093420",
    "end": "3099900"
  },
  {
    "text": "you would see that you have um not quite full access but you do have escalates on cluster roles",
    "start": "3099900",
    "end": "3109160"
  },
  {
    "text": "if you then uh edit your roles because you have",
    "start": "3110520",
    "end": "3115740"
  },
  {
    "text": "escalate you can escalate your privileges to wildcard everything",
    "start": "3115740",
    "end": "3121859"
  },
  {
    "text": "and do the auth can I again and now you have wild card with all verbs I",
    "start": "3121859",
    "end": "3127319"
  },
  {
    "text": "apologize for that demo failing at the very end there trust me you can do this and I will fix this but",
    "start": "3127319",
    "end": "3134400"
  },
  {
    "text": "um what you uh what we did here is we got root",
    "start": "3134400",
    "end": "3139740"
  },
  {
    "text": "access on the Node got us the kublet token used the kublet token to get access to the cube system resources",
    "start": "3139740",
    "end": "3144859"
  },
  {
    "text": "including NCD pod um we use we then deployed that FCD client",
    "start": "3144859",
    "end": "3153240"
  },
  {
    "text": "in there and went after the uh the credentials got that credential and then escalated its rights to become root so",
    "start": "3153240",
    "end": "3159720"
  },
  {
    "text": "we are now owning the cluster um so like I said let's talk about ways",
    "start": "3159720",
    "end": "3165420"
  },
  {
    "text": "to mitigate a lot of the things we just saw and if I have time I'll go back and I'll actually show you that happening in",
    "start": "3165420",
    "end": "3171059"
  },
  {
    "text": "a second um so there's a few this is by no in by no means exhaustive there are many",
    "start": "3171059",
    "end": "3176760"
  },
  {
    "text": "things if those of you who do security you you probably think of a million things we could be doing better in this",
    "start": "3176760",
    "end": "3182339"
  },
  {
    "text": "cluster but some of the the low-hanging fruit um",
    "start": "3182339",
    "end": "3188160"
  },
  {
    "text": "first of all we had an RC and an app now given this was this was a contrived example but you should be scanning your",
    "start": "3188160",
    "end": "3195540"
  },
  {
    "text": "apps for vulnerabilities period now obviously I work for sneak I would love you to use our tools I don't care what tools you use honestly use whatever you",
    "start": "3195540",
    "end": "3202619"
  },
  {
    "text": "sneak use whatever um you you have to make sure you're",
    "start": "3202619",
    "end": "3207900"
  },
  {
    "text": "catching any known vulnerabilities in your apps uh this is just a screenshot of what our tool would look like",
    "start": "3207900",
    "end": "3213660"
  },
  {
    "text": "actually we've updated our UI I need to update that um static analysis uh Library you know",
    "start": "3213660",
    "end": "3220440"
  },
  {
    "text": "dependency analysis image analysis all those kinds of scans you want to do all that to find vulnerabilities snuff them",
    "start": "3220440",
    "end": "3226200"
  },
  {
    "text": "out before they even get committed to your code um also",
    "start": "3226200",
    "end": "3232380"
  },
  {
    "text": "you want to scan you want to have there's many scanners to do this you want to go in and look for bad practice",
    "start": "3232380",
    "end": "3238160"
  },
  {
    "text": "in your kubernetes yaml so here we're looking at that allow privilege escalation",
    "start": "3238160",
    "end": "3243300"
  },
  {
    "text": "if you were to run most kubernetes scanners this is our the output of ours it'll let you know hey medium level",
    "start": "3243300",
    "end": "3249480"
  },
  {
    "text": "severity your containers running without privilege escalation control it walks",
    "start": "3249480",
    "end": "3255300"
  },
  {
    "text": "you through tells you why that's bad how to resolve it all those kinds of things so scan your code scan your IAC files",
    "start": "3255300",
    "end": "3262800"
  },
  {
    "text": "scan everything you got with whatever scanners you prefer to use uh next we talked about this when we saw",
    "start": "3262800",
    "end": "3271020"
  },
  {
    "text": "it the service account token Auto Mount uh this you should set to false whenever",
    "start": "3271020",
    "end": "3276540"
  },
  {
    "text": "you create a service account do it uh you can also set it in the Pod but just set it on the service account",
    "start": "3276540",
    "end": "3281579"
  },
  {
    "text": "um unless your program your process for some reason needs to talk to the cube",
    "start": "3281579",
    "end": "3288119"
  },
  {
    "text": "API you don't need that token um don't don't mount it in there",
    "start": "3288119",
    "end": "3294000"
  },
  {
    "text": "um and setting up to false will stop that that would have stopped us on our tracks on this example and this this",
    "start": "3294000",
    "end": "3299220"
  },
  {
    "text": "thread of execution right right away and this will walk you through if you go through here how to do this is basically",
    "start": "3299220",
    "end": "3305819"
  },
  {
    "text": "you just add this line to your service account definition and you're done um",
    "start": "3305819",
    "end": "3311339"
  },
  {
    "text": "so there were changes in 124 and I'm wondering if this is what caused my issue at the end um but that's uh",
    "start": "3311339",
    "end": "3319079"
  },
  {
    "text": "124 Legacy service account token no Auto generation feature is now enabled",
    "start": "3319079",
    "end": "3326220"
  },
  {
    "text": "um and that sounds like it would stop that token from getting mounted but it doesn't it just stops the secret from",
    "start": "3326220",
    "end": "3331800"
  },
  {
    "text": "being created that you can easily pull down from the API it does not stop the token from getting mounted in the Pod because again backwards compatibility",
    "start": "3331800",
    "end": "3338099"
  },
  {
    "text": "you may have apps that do talk to the API server and they don't want to by default break everybody's app that's not",
    "start": "3338099",
    "end": "3344520"
  },
  {
    "text": "explicitly asking for that token",
    "start": "3344520",
    "end": "3348200"
  },
  {
    "text": "yeah see there you go is it yep so there you go",
    "start": "3351059",
    "end": "3356220"
  },
  {
    "text": "um and again you should be setting if you're using PSPs again we'll get to PSPs are going away",
    "start": "3356220",
    "end": "3363599"
  },
  {
    "text": "um you should be at least setting that don't allow people to have privileged escalation because",
    "start": "3363599",
    "end": "3369780"
  },
  {
    "text": "they can you know use suid now again that can break things so test your apps obviously",
    "start": "3369780",
    "end": "3376339"
  },
  {
    "text": "um lock down your rbac permissions for goodness sake um if you were to look into the what we",
    "start": "3376500",
    "end": "3382260"
  },
  {
    "text": "deployed in this example the web admin service account are back roles you'll see a common mistake uh giving your",
    "start": "3382260",
    "end": "3388980"
  },
  {
    "text": "service account blanket privileges that allowed me to get around get start doing things in there that I shouldn't be",
    "start": "3388980",
    "end": "3394500"
  },
  {
    "text": "allowed to do um not only that but um they also basically didn't have anything",
    "start": "3394500",
    "end": "3401400"
  },
  {
    "text": "on the default namespace so pay attention to default now this is a",
    "start": "3401400",
    "end": "3406440"
  },
  {
    "text": "religious War um whether or not you should allow people to use default in your clusters",
    "start": "3406440",
    "end": "3411780"
  },
  {
    "text": "um I don't care but a lot of people don't want developers using default it's just another namespace however it's",
    "start": "3411780",
    "end": "3417900"
  },
  {
    "text": "everywhere you can't not have it so there are some people who would say block default from getting deployments",
    "start": "3417900",
    "end": "3425339"
  },
  {
    "text": "in your clusters because then you don't have to worry about our permissions being set there correctly or not",
    "start": "3425339",
    "end": "3432059"
  },
  {
    "text": "that's your call um I was talking to Duffy Cooley about this as far as how would you do how",
    "start": "3432059",
    "end": "3437099"
  },
  {
    "text": "would you do that foolproofly and his favorite way to do that actually he said you could just set quotas to zero in",
    "start": "3437099",
    "end": "3443160"
  },
  {
    "text": "default so you deploy all you want but it's not going to run like it's interesting I don't know if that's a",
    "start": "3443160",
    "end": "3448500"
  },
  {
    "text": "it's it's it's it It's Curious way to do it but uh um again we'll get to more ways better",
    "start": "3448500",
    "end": "3455700"
  },
  {
    "text": "ways maybe to do that in a minute um be explicit in your name spaces that's another way to do it is make sure",
    "start": "3455700",
    "end": "3461460"
  },
  {
    "text": "everyone's deploying with a declared namespace that's another again religious",
    "start": "3461460",
    "end": "3466619"
  },
  {
    "text": "War you could have uh for that kind of a thing if you're going to do that I've seen a lot of people use customize so that they're using that to automatically",
    "start": "3466619",
    "end": "3472859"
  },
  {
    "text": "populate in a namespace as they create you know the the or as they do the",
    "start": "3472859",
    "end": "3478200"
  },
  {
    "text": "deployments um you know the body you look into that if you want but the one I want to really",
    "start": "3478200",
    "end": "3483720"
  },
  {
    "text": "talk about though is Network policies I mentioned this earlier again coming from a developer background the developers I",
    "start": "3483720",
    "end": "3490079"
  },
  {
    "text": "don't know why we have this aversion Network policy or network firewalling or if you come from the VMware space the",
    "start": "3490079",
    "end": "3496380"
  },
  {
    "text": "the the uh what are they what does NSX call it they call it the uh uh micro segmented",
    "start": "3496380",
    "end": "3503280"
  },
  {
    "text": "distributed firewall right it sounds so complicated and oh my gosh tags and selectors and what it's not you're",
    "start": "3503280",
    "end": "3510180"
  },
  {
    "text": "basically if you've not in I don't know if anyone here has not done Network policy but the basic Network policy not",
    "start": "3510180",
    "end": "3515400"
  },
  {
    "text": "even getting into custom cnis what they provide on top of it but you're basically just saying hey this is the",
    "start": "3515400",
    "end": "3522119"
  },
  {
    "text": "Pod selectors for what can and can't talk to each other and I like the",
    "start": "3522119",
    "end": "3527160"
  },
  {
    "text": "standard deny everything and then only allow the pieces you want that's my go-to for example",
    "start": "3527160",
    "end": "3534720"
  },
  {
    "text": "this network policy that that one right there is that's the denial that's saying for every pod that's the wild card for",
    "start": "3534720",
    "end": "3540359"
  },
  {
    "text": "every pod set up empty ingression egress so it's completely broken",
    "start": "3540359",
    "end": "3546059"
  },
  {
    "text": "technically you probably need egress out to DNS because you can't do service Discovery but that's you know",
    "start": "3546059",
    "end": "3552119"
  },
  {
    "text": "that's you'll need that but other than that all you all I would then would add in this case would be I need Ingress to",
    "start": "3552119",
    "end": "3559140"
  },
  {
    "text": "five thousand on TCP that's all I need I don't want anyone connecting to any other ports I don't want any egress out",
    "start": "3559140",
    "end": "3565559"
  },
  {
    "text": "of this app because it's like a static hosting kind of a thing if this was a",
    "start": "3565559",
    "end": "3570720"
  },
  {
    "text": "two-tier app maybe I'd have an egress just to my back end namespace or to my backend pod selector and then I wouldn't",
    "start": "3570720",
    "end": "3577440"
  },
  {
    "text": "have any access maybe between web tier so if I'm running five replicas there's",
    "start": "3577440",
    "end": "3582480"
  },
  {
    "text": "no reason unless I had a distributed caching system and built in for them to talk to each other so don't allow that",
    "start": "3582480",
    "end": "3588480"
  },
  {
    "text": "um all sorts of stuff now that's easy to say as the the person up",
    "start": "3588480",
    "end": "3594299"
  },
  {
    "text": "here just giving a demo um real world you probably have uh apms",
    "start": "3594299",
    "end": "3599880"
  },
  {
    "text": "and other things that have you know connections from your apps coming back and and things that are",
    "start": "3599880",
    "end": "3605280"
  },
  {
    "text": "specific to your organization that you need done blanket across there are some",
    "start": "3605280",
    "end": "3610440"
  },
  {
    "text": "we'll talk about I think on the next page I have some interesting mitigations for that but you got to take",
    "start": "3610440",
    "end": "3615960"
  },
  {
    "text": "that into account so you got to make sure you're not going to break your you know you have to throw vendors out there or anyone but like your your dynatrace",
    "start": "3615960",
    "end": "3623040"
  },
  {
    "text": "or whatever whatever you got running you want to make sure you're connecting to all the things you need to connect to but that should be well known for your",
    "start": "3623040",
    "end": "3628559"
  },
  {
    "text": "for your developers anyway because they're doing it in the agent strings for their apps or whatever",
    "start": "3628559",
    "end": "3634020"
  },
  {
    "text": "um so that appears to be duplicated I'm",
    "start": "3634020",
    "end": "3639900"
  },
  {
    "text": "going to skip that so let's talk PSP so as I said PSP was removed in v125 it",
    "start": "3639900",
    "end": "3646619"
  },
  {
    "text": "was deprecated two years ago um and so it's been coming it's becoming they finally removed it in 125. uh again",
    "start": "3646619",
    "end": "3654119"
  },
  {
    "text": "I showed it here because people don't upgrade immediately to things and PSPs are still going to be",
    "start": "3654119",
    "end": "3660480"
  },
  {
    "text": "out there however you should be migrating off and you should if you're working with a team that is still using PSPs you should be",
    "start": "3660480",
    "end": "3666480"
  },
  {
    "text": "at least planning to get off of them and uh the uh six security folks Tabitha and other",
    "start": "3666480",
    "end": "3672839"
  },
  {
    "text": "folks have a good blog about kind of the history of this if you're curious why did they deprecate it what was the what",
    "start": "3672839",
    "end": "3678480"
  },
  {
    "text": "was the plan for the future and then of course the kubernetes docs talks about um what to go to so it's pod security",
    "start": "3678480",
    "end": "3684660"
  },
  {
    "text": "admission is kind of the new replacement for it kind of sort of it doesn't do everything PSP did but it's kind of a",
    "start": "3684660",
    "end": "3692640"
  },
  {
    "text": "new take on how to do this kind of security however most shops that I've",
    "start": "3692640",
    "end": "3697980"
  },
  {
    "text": "seen or the people that I've talked to have are replacing it with either kyberno or Opa with gatekeeper an",
    "start": "3697980",
    "end": "3704760"
  },
  {
    "text": "emission controller and PSA is an emission controller on pod security policies admission controllers for that matter but having policy management",
    "start": "3704760",
    "end": "3712680"
  },
  {
    "text": "systems like Carbono or Opa or whatever allow you to have centralized policy on all of this stuff and enforce it across",
    "start": "3712680",
    "end": "3719339"
  },
  {
    "text": "your cluster and it's much more flexible and you can block all of these kinds of things with any of these kinds of tools",
    "start": "3719339",
    "end": "3726420"
  },
  {
    "text": "so take a look at those uh there's there's I mean since I've written this page there's probably 18 more blogs you",
    "start": "3726420",
    "end": "3732359"
  },
  {
    "text": "could add to this because once 125 went live it's uh quite common to need to do that",
    "start": "3732359",
    "end": "3738299"
  },
  {
    "text": "uh Network policy complexities some things some references that you can point your developers to if they are",
    "start": "3738299",
    "end": "3744059"
  },
  {
    "text": "trying to learn Network policy um the kind of the the Bible uh the the",
    "start": "3744059",
    "end": "3749099"
  },
  {
    "text": "recipe guide Ahmed all Balkans kubernetes Network policy recipes let me go ahead and click on that because it",
    "start": "3749099",
    "end": "3755579"
  },
  {
    "text": "this is a nice simple listing of ideas with most of them",
    "start": "3755579",
    "end": "3761940"
  },
  {
    "text": "having animated graphics showing the policy we're talking about looks like",
    "start": "3761940",
    "end": "3767400"
  },
  {
    "text": "this Ingress egress so for instance let's look at I'll pick one that doesn't have a Graphic process uh let's see",
    "start": "3767400",
    "end": "3773760"
  },
  {
    "text": "limit traffic to an application this one does so this is a restrict traffic to a service blah blah blah it's showing that",
    "start": "3773760",
    "end": "3781200"
  },
  {
    "text": "Ingress from App coffee shop in is blocked but app bookstore in that",
    "start": "3781200",
    "end": "3787680"
  },
  {
    "text": "selector works that selector doesn't and then it shows you the actual policy",
    "start": "3787680",
    "end": "3793079"
  },
  {
    "text": "so this is a nice resource the psyllium folks have a really cool",
    "start": "3793079",
    "end": "3799319"
  },
  {
    "text": "visualizer if you go to network policy.io you can craft Network policies and it'll show you how it looks",
    "start": "3799319",
    "end": "3806250"
  },
  {
    "text": "[Music] um cnis have their specific policies so if you are a psyllium shop or a Calico",
    "start": "3806250",
    "end": "3812220"
  },
  {
    "text": "Shopper insert the name of your favorite cni almost all of them it's what maybe well flannel doesn't have Network policy",
    "start": "3812220",
    "end": "3818220"
  },
  {
    "text": "so not that one but all the rest have their own network policy additions extensions that do things for instance",
    "start": "3818220",
    "end": "3825059"
  },
  {
    "text": "Calico will have a cluster-wide policy option where you can apply things not just at the namespace psyllium has the",
    "start": "3825059",
    "end": "3831420"
  },
  {
    "text": "same kinds of things so take a look generally your your cni is going to be picked for you if you're a developer you",
    "start": "3831420",
    "end": "3837180"
  },
  {
    "text": "don't normally get to pick your cni but you should learn what your cni offers and weigh the benefits or costs of using",
    "start": "3837180",
    "end": "3843299"
  },
  {
    "text": "specific cni functionalities because you are tying yourself to that cni when you do so the network policy next-gen folks",
    "start": "3843299",
    "end": "3850559"
  },
  {
    "text": "are doing you know similar things to try to take some of those cool extensions and make them part of the main spec I've",
    "start": "3850559",
    "end": "3856500"
  },
  {
    "text": "not been following that Sig or tag I'll be interested to see where they are with that but it's a good group to go listen",
    "start": "3856500",
    "end": "3863760"
  },
  {
    "text": "to if you want so that's the network policy plus plus comments um there's another cool one here I've",
    "start": "3863760",
    "end": "3869400"
  },
  {
    "text": "never seen actually at anyone I've talked to use but I've read blogs on this and that's a link to a Blog",
    "start": "3869400",
    "end": "3874460"
  },
  {
    "text": "hierarchical name spaces anyone used hierarchical namespaces here",
    "start": "3874460",
    "end": "3879599"
  },
  {
    "text": "no see I'm not running to anyone using it it sounds really cool though it allows you to have hierarchical namespaces which allows you to set",
    "start": "3879599",
    "end": "3886200"
  },
  {
    "text": "workloads in a sub in a kind of a sub tree pattern where you could set Ingress and egress rules that apply to all the",
    "start": "3886200",
    "end": "3892980"
  },
  {
    "text": "namespace that are Downstream from it um you've got a parent Network policy propagates to its children sounds really",
    "start": "3892980",
    "end": "3898920"
  },
  {
    "text": "cool um I'm not Consulting anymore so I've not had time to go try this at any once",
    "start": "3898920",
    "end": "3905000"
  },
  {
    "text": "but take a look at the the with that that looks off to the project actually",
    "start": "3905000",
    "end": "3910260"
  },
  {
    "text": "it's not a Blog um there you go so that's an interesting idea for especially for handling that",
    "start": "3910260",
    "end": "3916440"
  },
  {
    "text": "issue where everybody in this company must connect to our APM server so you",
    "start": "3916440",
    "end": "3922020"
  },
  {
    "text": "would you could use something like this to implement that uh and finally Community Resources uh",
    "start": "3922020",
    "end": "3929400"
  },
  {
    "text": "obviously kubernetes security uh I'm in there often um this is uh where a lot of discusses a",
    "start": "3929400",
    "end": "3936780"
  },
  {
    "text": "lot of the things that you see here came from discussions there cncf tag security",
    "start": "3936780",
    "end": "3941819"
  },
  {
    "text": "which runs this conference if you're not attending tax security it's not a bad thing to lurk on at least and get in",
    "start": "3941819",
    "end": "3947220"
  },
  {
    "text": "there I try to go to that as often as I can um Sig Network for the network stuff I was just talking about and then the open",
    "start": "3947220",
    "end": "3952740"
  },
  {
    "text": "ssf if you get outside the cncf world the open ssf talks a lot of really cool stuff also Linux Foundation owned and if",
    "start": "3952740",
    "end": "3960059"
  },
  {
    "text": "that is that's the end of the workshop itself and I have left us 15 minutes for any",
    "start": "3960059",
    "end": "3967680"
  },
  {
    "text": "questions I can try to get this the actual you know I can bump down to 123 real quick and try to get the the finish",
    "start": "3967680",
    "end": "3973559"
  },
  {
    "text": "the demo for you but I'm thinking maybe if you've got questions that might be a better use of our time",
    "start": "3973559",
    "end": "3979880"
  },
  {
    "text": "no questions here's one",
    "start": "3980339",
    "end": "3984020"
  },
  {
    "text": "so the question is could we have saved a step because we had so much access in the secret secure named namespace could",
    "start": "3998880",
    "end": "4006079"
  },
  {
    "text": "we have edited the Pod security policy there to give us privileged access possibly um that's a good I should try",
    "start": "4006079",
    "end": "4013039"
  },
  {
    "text": "that um I should try that and I should change my demo then to make sure you don't have that much access but yes that that very",
    "start": "4013039",
    "end": "4019339"
  },
  {
    "text": "likely um hopefully you don't that would be one thing that you would think out you would",
    "start": "4019339",
    "end": "4024640"
  },
  {
    "text": "specifically not that's a good one though I like that any other questions comments",
    "start": "4024640",
    "end": "4031880"
  },
  {
    "text": "say again that's a good question let's click on it",
    "start": "4033380",
    "end": "4040039"
  },
  {
    "text": "I haven't looked at it in a little while this is",
    "start": "4040039",
    "end": "4048400"
  },
  {
    "text": "I should say in here right",
    "start": "4048559",
    "end": "4051579"
  },
  {
    "text": "overseen by working group multi-tenancy uh",
    "start": "4053780",
    "end": "4059480"
  },
  {
    "text": "I'm not sure it's been a while it's been around a while though",
    "start": "4059480",
    "end": "4065240"
  },
  {
    "text": "um it's probably still an alpha whatever it is I'd have to look it up I'm not going to do that up here but yeah go",
    "start": "4065240",
    "end": "4070400"
  },
  {
    "text": "take a look um I'll find out later today and I'll tweet it out or something",
    "start": "4070400",
    "end": "4076599"
  },
  {
    "text": "any other ideas that we could have blocked this early Beyond these",
    "start": "4076819",
    "end": "4084578"
  },
  {
    "text": "right good question so the question is the the",
    "start": "4101179",
    "end": "4107298"
  },
  {
    "text": "run is non-root stops the container from starting as root the escalation privilege being not there allows you to",
    "start": "4107299",
    "end": "4114380"
  },
  {
    "text": "elevate privilege as you run an suid to become elevated privilege or basically",
    "start": "4114380",
    "end": "4120980"
  },
  {
    "text": "root what's the point of doing one without the other um",
    "start": "4120980",
    "end": "4126920"
  },
  {
    "text": "you can there are processes who need to elevate privilege",
    "start": "4126920",
    "end": "4133160"
  },
  {
    "text": "um I'm trying to think of a ping used to need it but now it uses net um the capabilities to do it but there",
    "start": "4133160",
    "end": "4138560"
  },
  {
    "text": "are processes that need to become root quickly to grab a low port or do whatever they need to do and then they drop right back down if you set that",
    "start": "4138560",
    "end": "4144920"
  },
  {
    "text": "elevation to false it will not be able to do that anymore but your point is valid and then I think you're right I",
    "start": "4144920",
    "end": "4150920"
  },
  {
    "text": "think you should always have both unless you absolutely need one or the other",
    "start": "4150920",
    "end": "4156440"
  },
  {
    "text": "um the main thing with the the run is non-roots is in if if I'm root in a container even if",
    "start": "4156440",
    "end": "4164238"
  },
  {
    "text": "I wasn't trying to do nmap and do that I can still do other things like I can um let's say I've got a standard uh Debian",
    "start": "4164239",
    "end": "4171500"
  },
  {
    "text": "base image that has the full apt in it or um yeah I can I can install software",
    "start": "4171500",
    "end": "4177140"
  },
  {
    "text": "if I've got access to an apt an apprepo um because I'm root because I can do whatever I want in a container then and",
    "start": "4177140",
    "end": "4183560"
  },
  {
    "text": "I'm uid 0. if I found another volume Mount maybe it's not a privileged one maybe it's not a root Mount like that",
    "start": "4183560",
    "end": "4189258"
  },
  {
    "text": "but if I somebody has mounted another file system in I'm uid 0 in that mount so now let's say there's sensitive",
    "start": "4189259",
    "end": "4196940"
  },
  {
    "text": "information application configurations that I shouldn't be able to read as the normal user but I can because I'm uid 0.",
    "start": "4196940",
    "end": "4204140"
  },
  {
    "text": "so there's that now there's also username spaces which is a whole nother ball of wax we can talk about which",
    "start": "4204140",
    "end": "4210260"
  },
  {
    "text": "someday will have um which allows you to then map names username spaces so that you're no longer",
    "start": "4210260",
    "end": "4216440"
  },
  {
    "text": "root in a container no longer means root on the host that's a whole other scope that I'm not going to tackle right",
    "start": "4216440",
    "end": "4223699"
  },
  {
    "text": "now other things that I didn't talk about capability I mean uh security context",
    "start": "4223699",
    "end": "4230960"
  },
  {
    "text": "that whole API for your pods learn it understand what the different things in",
    "start": "4230960",
    "end": "4236120"
  },
  {
    "text": "there do do like capabilities a lot of time you can deny capabilities because your app doesn't need them if you're not",
    "start": "4236120",
    "end": "4242840"
  },
  {
    "text": "doing low-level networking things you don't need extra networking capabilities for your process a lot of business apps you can just deny",
    "start": "4242840",
    "end": "4249440"
  },
  {
    "text": "all and they'll run just fine you need to test that you need to make sure your",
    "start": "4249440",
    "end": "4254900"
  },
  {
    "text": "app can run that way but if you're in a micro service type of environment with a tiny app that's not a hard thing to you",
    "start": "4254900",
    "end": "4260239"
  },
  {
    "text": "know figure out um immutability is important I talked about read-only root file system that's",
    "start": "4260239",
    "end": "4266659"
  },
  {
    "text": "it's one of my favorites because it's an easy one um generally if you're you're if you're truly writing microservices they're",
    "start": "4266659",
    "end": "4273980"
  },
  {
    "text": "going to be immutable because it's one of the 12 factors you're supposed to be following 12 factors right that makes kubernetes more easily able to move",
    "start": "4273980",
    "end": "4279980"
  },
  {
    "text": "things around if your containers don't have state in them that they care about now that's easy for me to say here then",
    "start": "4279980",
    "end": "4285500"
  },
  {
    "text": "you got and I stepped back into my last roles as a developer where I'm writing Tomcat apps that are dropping log files",
    "start": "4285500",
    "end": "4291020"
  },
  {
    "text": "and you know work directories all over the place so you got to make sure you're mounting volumes or doing whatever you",
    "start": "4291020",
    "end": "4296060"
  },
  {
    "text": "need to do to make your app run but honestly that's things you should probably be migrating away from anyway",
    "start": "4296060",
    "end": "4302540"
  },
  {
    "text": "in modern apps so read only root file system is one of my favorites because without it it makes it harder it's not a",
    "start": "4302540",
    "end": "4308960"
  },
  {
    "text": "silver bullet but it makes it harder I can't download a script and start Bitcoin mining it's as easy if I can't",
    "start": "4308960",
    "end": "4314120"
  },
  {
    "text": "modify your file system I mean I got the temp file system maybe but just every little thing you do makes it",
    "start": "4314120",
    "end": "4320600"
  },
  {
    "text": "a little harder it's kind of like in the old days you have the club on your car it's not going to stop a thief from stealing your Ferrari but",
    "start": "4320600",
    "end": "4326300"
  },
  {
    "text": "if it's on a Civic yeah maybe they're going to look at the next car",
    "start": "4326300",
    "end": "4332020"
  },
  {
    "text": "okay well with that um I am going to uh call it done unless you have anything else",
    "start": "4332420",
    "end": "4339320"
  },
  {
    "text": "I'm going to let you out early thanks oh one other thing one thing I actually do",
    "start": "4339320",
    "end": "4345020"
  },
  {
    "text": "have a slide that I do very much care to show if I can get my browser back up",
    "start": "4345020",
    "end": "4350120"
  },
  {
    "text": "here um get past all so you have all these slides that",
    "start": "4350120",
    "end": "4356060"
  },
  {
    "text": "we're all in the GitHub repository so you don't need them um that's all we just talked about I just",
    "start": "4356060",
    "end": "4361640"
  },
  {
    "text": "want to give thanks first of all so the people listed here plus a ton more um a lot of the content you saw here is",
    "start": "4361640",
    "end": "4366980"
  },
  {
    "text": "is gathered from calls and and blogs and and discussions had with folks like this",
    "start": "4366980",
    "end": "4374420"
  },
  {
    "text": "people in the in six security tag security I just want to thank them all because and we all we all learn from",
    "start": "4374420",
    "end": "4379460"
  },
  {
    "text": "each other and uh we do have this QR code if you want to",
    "start": "4379460",
    "end": "4385940"
  },
  {
    "text": "um give feedback on the um to the to the people running the show they will uh take that I am Eric Smalling on all the",
    "start": "4385940",
    "end": "4393980"
  },
  {
    "text": "socials um that's it thanks again",
    "start": "4393980",
    "end": "4400450"
  },
  {
    "text": "[Applause]",
    "start": "4400450",
    "end": "4404609"
  }
]