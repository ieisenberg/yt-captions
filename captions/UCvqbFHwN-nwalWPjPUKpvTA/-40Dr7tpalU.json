[
  {
    "start": "0",
    "end": "20000"
  },
  {
    "text": "hi everyone my name is jealous and today",
    "start": "1280",
    "end": "4400"
  },
  {
    "text": "i'm going to talk about",
    "start": "4400",
    "end": "5520"
  },
  {
    "text": "authorization at square i'm a software",
    "start": "5520",
    "end": "7839"
  },
  {
    "text": "engineer on square's developers iam team",
    "start": "7839",
    "end": "10240"
  },
  {
    "text": "and i've been on this team for almost a",
    "start": "10240",
    "end": "12960"
  },
  {
    "text": "year and a half now and the entire time",
    "start": "12960",
    "end": "15040"
  },
  {
    "text": "on the team i've been working on",
    "start": "15040",
    "end": "16400"
  },
  {
    "text": "authorization",
    "start": "16400",
    "end": "17520"
  },
  {
    "text": "which is what i would like to talk about",
    "start": "17520",
    "end": "18800"
  },
  {
    "text": "today",
    "start": "18800",
    "end": "20560"
  },
  {
    "start": "20000",
    "end": "20000"
  },
  {
    "text": "here's a quick agenda of the different",
    "start": "20560",
    "end": "21840"
  },
  {
    "text": "topics i'm going to cover",
    "start": "21840",
    "end": "23680"
  },
  {
    "text": "first i'll talk a little bit about envoy",
    "start": "23680",
    "end": "26160"
  },
  {
    "text": "at square",
    "start": "26160",
    "end": "26800"
  },
  {
    "text": "then give you a quick overview of our",
    "start": "26800",
    "end": "28840"
  },
  {
    "text": "previous",
    "start": "28840",
    "end": "30320"
  },
  {
    "text": "authorization architecture some of the",
    "start": "30320",
    "end": "32160"
  },
  {
    "text": "problems and challenges we face with",
    "start": "32160",
    "end": "33680"
  },
  {
    "text": "that",
    "start": "33680",
    "end": "34079"
  },
  {
    "text": "and then how we're leveraging envoy to",
    "start": "34079",
    "end": "36480"
  },
  {
    "text": "do authorization",
    "start": "36480",
    "end": "39120"
  },
  {
    "text": "before we do that i do want to talk",
    "start": "39120",
    "end": "41360"
  },
  {
    "start": "40000",
    "end": "40000"
  },
  {
    "text": "about authentication and authorization",
    "start": "41360",
    "end": "44079"
  },
  {
    "text": "uh authentication is a process verifying",
    "start": "44079",
    "end": "45920"
  },
  {
    "text": "your identity",
    "start": "45920",
    "end": "47280"
  },
  {
    "text": "are you who you say you are is this the",
    "start": "47280",
    "end": "49039"
  },
  {
    "text": "authentic sally",
    "start": "49039",
    "end": "50320"
  },
  {
    "text": "while authorization is a process of",
    "start": "50320",
    "end": "52559"
  },
  {
    "text": "verifying that someone has the right",
    "start": "52559",
    "end": "54000"
  },
  {
    "text": "permissions",
    "start": "54000",
    "end": "54719"
  },
  {
    "text": "and is allowed to do uh what they want",
    "start": "54719",
    "end": "57120"
  },
  {
    "text": "to do",
    "start": "57120",
    "end": "58800"
  },
  {
    "text": "uh and during this talk we're going to",
    "start": "58800",
    "end": "60559"
  },
  {
    "text": "cover the second bullet point",
    "start": "60559",
    "end": "62239"
  },
  {
    "text": "which is authorization and i know that",
    "start": "62239",
    "end": "64400"
  },
  {
    "text": "very often these two",
    "start": "64400",
    "end": "65760"
  },
  {
    "text": "go together and i would encourage people",
    "start": "65760",
    "end": "68240"
  },
  {
    "text": "to try to think about them separately",
    "start": "68240",
    "end": "70880"
  },
  {
    "text": "we are definitely trying to decouple",
    "start": "70880",
    "end": "72640"
  },
  {
    "text": "these two at square as much as possible",
    "start": "72640",
    "end": "74799"
  },
  {
    "text": "because i think that gives your",
    "start": "74799",
    "end": "77040"
  },
  {
    "text": "architecture a little bit more",
    "start": "77040",
    "end": "78479"
  },
  {
    "text": "flexibility",
    "start": "78479",
    "end": "80560"
  },
  {
    "text": "next i would like to introduce you to",
    "start": "80560",
    "end": "82159"
  },
  {
    "text": "safe uh safe is",
    "start": "82159",
    "end": "83680"
  },
  {
    "text": "our session authorization framework",
    "start": "83680",
    "end": "85759"
  },
  {
    "text": "enforcer it's",
    "start": "85759",
    "end": "87040"
  },
  {
    "text": "one of the authorization frameworks",
    "start": "87040",
    "end": "90240"
  },
  {
    "text": "available for service owners at square",
    "start": "90240",
    "end": "93840"
  },
  {
    "text": "next on voice safe which is our uh envoy",
    "start": "93840",
    "end": "96720"
  },
  {
    "text": "based authorization solution which is",
    "start": "96720",
    "end": "98479"
  },
  {
    "text": "the main solution",
    "start": "98479",
    "end": "99439"
  },
  {
    "text": "i'm going to talk about today and it",
    "start": "99439",
    "end": "101680"
  },
  {
    "text": "takes a lot of the things that were",
    "start": "101680",
    "end": "102960"
  },
  {
    "text": "available",
    "start": "102960",
    "end": "103680"
  },
  {
    "text": "in our safe framework and it took that",
    "start": "103680",
    "end": "106560"
  },
  {
    "text": "and moved it to",
    "start": "106560",
    "end": "107520"
  },
  {
    "text": "an actual service that we are leveraging",
    "start": "107520",
    "end": "109600"
  },
  {
    "text": "with our service mesh",
    "start": "109600",
    "end": "112479"
  },
  {
    "text": "uh next on voyage square so",
    "start": "112479",
    "end": "116960"
  },
  {
    "start": "115000",
    "end": "115000"
  },
  {
    "text": "there's a great talk uh that two of my",
    "start": "116960",
    "end": "119280"
  },
  {
    "text": "colleagues",
    "start": "119280",
    "end": "120159"
  },
  {
    "text": "gave at this exact same conference two",
    "start": "120159",
    "end": "122000"
  },
  {
    "text": "years ago",
    "start": "122000",
    "end": "123360"
  },
  {
    "text": "and a lot of the things they talked",
    "start": "123360",
    "end": "125840"
  },
  {
    "text": "about",
    "start": "125840",
    "end": "126399"
  },
  {
    "text": "then now are a reality at square so",
    "start": "126399",
    "end": "129520"
  },
  {
    "text": "we're at the next level where now we can",
    "start": "129520",
    "end": "131200"
  },
  {
    "text": "leverage our service mesh",
    "start": "131200",
    "end": "132879"
  },
  {
    "text": "to build a lot of these new exciting",
    "start": "132879",
    "end": "135200"
  },
  {
    "text": "features",
    "start": "135200",
    "end": "136800"
  },
  {
    "text": "and so some of the highlights and things",
    "start": "136800",
    "end": "139360"
  },
  {
    "text": "to keep in mind that",
    "start": "139360",
    "end": "140319"
  },
  {
    "text": "are important for this talk is that",
    "start": "140319",
    "end": "142080"
  },
  {
    "text": "square has a centralized control plane",
    "start": "142080",
    "end": "145440"
  },
  {
    "text": "and the control plane has a",
    "start": "145440",
    "end": "146879"
  },
  {
    "text": "preconfigured cache with sidecar",
    "start": "146879",
    "end": "148879"
  },
  {
    "text": "configurations",
    "start": "148879",
    "end": "150480"
  },
  {
    "text": "also known as snapshots",
    "start": "150480",
    "end": "154400"
  },
  {
    "text": "and now a quick overview of",
    "start": "155120",
    "end": "157040"
  },
  {
    "text": "authorization",
    "start": "157040",
    "end": "158160"
  },
  {
    "text": "or how we used to do authorization at",
    "start": "158160",
    "end": "159920"
  },
  {
    "text": "square",
    "start": "159920",
    "end": "161840"
  },
  {
    "start": "161000",
    "end": "161000"
  },
  {
    "text": "we had multiple authorization strategies",
    "start": "161840",
    "end": "164319"
  },
  {
    "text": "so",
    "start": "164319",
    "end": "165360"
  },
  {
    "text": "services could implement different",
    "start": "165360",
    "end": "167280"
  },
  {
    "text": "libraries or leverage different",
    "start": "167280",
    "end": "168959"
  },
  {
    "text": "libraries to do authorizations",
    "start": "168959",
    "end": "171040"
  },
  {
    "text": "some of these were using protos some of",
    "start": "171040",
    "end": "173040"
  },
  {
    "text": "these some of these other libraries such",
    "start": "173040",
    "end": "174800"
  },
  {
    "text": "as",
    "start": "174800",
    "end": "175120"
  },
  {
    "text": "safe they had echo like files",
    "start": "175120",
    "end": "178640"
  },
  {
    "text": "or you could specify the the different",
    "start": "178640",
    "end": "180480"
  },
  {
    "text": "rules",
    "start": "180480",
    "end": "181680"
  },
  {
    "text": "and authorization requirements while a",
    "start": "181680",
    "end": "184000"
  },
  {
    "text": "third set of services",
    "start": "184000",
    "end": "185680"
  },
  {
    "text": "were using custom code no additional",
    "start": "185680",
    "end": "188319"
  },
  {
    "text": "library",
    "start": "188319",
    "end": "189280"
  },
  {
    "text": "and it was all uh written in the",
    "start": "189280",
    "end": "192400"
  },
  {
    "text": "actual application layer on top of this",
    "start": "192400",
    "end": "195519"
  },
  {
    "text": "square supports three major languages",
    "start": "195519",
    "end": "197440"
  },
  {
    "text": "several minor",
    "start": "197440",
    "end": "198879"
  },
  {
    "text": "and the same authorization solution is",
    "start": "198879",
    "end": "200640"
  },
  {
    "text": "not available in all languages what they",
    "start": "200640",
    "end": "202560"
  },
  {
    "text": "mean what that means as a service owner",
    "start": "202560",
    "end": "204799"
  },
  {
    "text": "if you have multiple microservices",
    "start": "204799",
    "end": "206879"
  },
  {
    "text": "written in different languages",
    "start": "206879",
    "end": "208400"
  },
  {
    "text": "it is possible that you cannot leverage",
    "start": "208400",
    "end": "210560"
  },
  {
    "text": "the same authorization solution",
    "start": "210560",
    "end": "212640"
  },
  {
    "text": "for both these microservices",
    "start": "212640",
    "end": "217120"
  },
  {
    "text": "so in reality that looks a little bit",
    "start": "217120",
    "end": "218720"
  },
  {
    "text": "more like this and even though",
    "start": "218720",
    "end": "220560"
  },
  {
    "text": "we try to keep these libraries in sync",
    "start": "220560",
    "end": "223519"
  },
  {
    "text": "or or",
    "start": "223519",
    "end": "224400"
  },
  {
    "text": "keep feature parity as much as possible",
    "start": "224400",
    "end": "226879"
  },
  {
    "text": "that is not always the case",
    "start": "226879",
    "end": "229040"
  },
  {
    "text": "some features get implemented in one",
    "start": "229040",
    "end": "231840"
  },
  {
    "text": "language then they get",
    "start": "231840",
    "end": "233319"
  },
  {
    "text": "de-prioritized uh others still haven't",
    "start": "233319",
    "end": "236400"
  },
  {
    "text": "been developed",
    "start": "236400",
    "end": "237280"
  },
  {
    "text": "so there's always a little bit of a",
    "start": "237280",
    "end": "238640"
  },
  {
    "text": "difference even between the same",
    "start": "238640",
    "end": "240319"
  },
  {
    "text": "authorization library and in different",
    "start": "240319",
    "end": "243120"
  },
  {
    "text": "languages",
    "start": "243120",
    "end": "245439"
  },
  {
    "text": "on top of this we have a different",
    "start": "245439",
    "end": "248080"
  },
  {
    "text": "permission set for our private apis and",
    "start": "248080",
    "end": "250080"
  },
  {
    "text": "our public apis",
    "start": "250080",
    "end": "251599"
  },
  {
    "text": "and only one of our authorization",
    "start": "251599",
    "end": "253680"
  },
  {
    "text": "frameworks is",
    "start": "253680",
    "end": "255040"
  },
  {
    "text": "able to authorize against both sets of",
    "start": "255040",
    "end": "257199"
  },
  {
    "text": "permissions and",
    "start": "257199",
    "end": "258239"
  },
  {
    "text": "map them together so what that means",
    "start": "258239",
    "end": "261600"
  },
  {
    "text": "that if you're",
    "start": "261600",
    "end": "262400"
  },
  {
    "text": "using that framework you can completely",
    "start": "262400",
    "end": "264560"
  },
  {
    "text": "use this authorization layer for",
    "start": "264560",
    "end": "266960"
  },
  {
    "text": "both type of apis while if you're using",
    "start": "266960",
    "end": "269919"
  },
  {
    "text": "a different library",
    "start": "269919",
    "end": "270800"
  },
  {
    "text": "you still have to implement an",
    "start": "270800",
    "end": "273440"
  },
  {
    "text": "authorization",
    "start": "273440",
    "end": "274639"
  },
  {
    "text": "you have to implement some authorization",
    "start": "274639",
    "end": "276560"
  },
  {
    "text": "code for",
    "start": "276560",
    "end": "277680"
  },
  {
    "text": "private apis",
    "start": "277680",
    "end": "282000"
  },
  {
    "text": "as you can imagine even though this",
    "start": "282000",
    "end": "283520"
  },
  {
    "text": "works it definitely presents",
    "start": "283520",
    "end": "286000"
  },
  {
    "text": "uh multiple challenges some of these",
    "start": "286000",
    "end": "288720"
  },
  {
    "text": "challenges are",
    "start": "288720",
    "end": "290160"
  },
  {
    "start": "289000",
    "end": "289000"
  },
  {
    "text": "it's really hard to know what is if all",
    "start": "290160",
    "end": "293040"
  },
  {
    "text": "our microservices are running",
    "start": "293040",
    "end": "294720"
  },
  {
    "text": "the latest version of our odds framework",
    "start": "294720",
    "end": "298720"
  },
  {
    "text": "it's also hard to just roll out new",
    "start": "298720",
    "end": "300320"
  },
  {
    "text": "features because you have to implement",
    "start": "300320",
    "end": "301759"
  },
  {
    "text": "them in multiple languages",
    "start": "301759",
    "end": "303520"
  },
  {
    "text": "it's it's hard to even roll them out",
    "start": "303520",
    "end": "306720"
  },
  {
    "text": "for all the same services so you might",
    "start": "306720",
    "end": "309440"
  },
  {
    "text": "have to implement the same feature in a",
    "start": "309440",
    "end": "311280"
  },
  {
    "text": "different library as well",
    "start": "311280",
    "end": "313600"
  },
  {
    "text": "on top of that given the two different",
    "start": "313600",
    "end": "315759"
  },
  {
    "text": "permission sets",
    "start": "315759",
    "end": "316720"
  },
  {
    "text": "i just mentioned it's it's complicated",
    "start": "316720",
    "end": "319280"
  },
  {
    "text": "to use our public apis internally",
    "start": "319280",
    "end": "322560"
  },
  {
    "text": "and then a lot of people would reach out",
    "start": "322560",
    "end": "324000"
  },
  {
    "text": "to us and ask us",
    "start": "324000",
    "end": "325680"
  },
  {
    "text": "what is right authorization strategy",
    "start": "325680",
    "end": "327600"
  },
  {
    "text": "what is the right framework to use",
    "start": "327600",
    "end": "329840"
  },
  {
    "text": "and there was not always a clear answer",
    "start": "329840",
    "end": "332960"
  },
  {
    "text": "to that question besides all these",
    "start": "332960",
    "end": "336320"
  },
  {
    "text": "problems another",
    "start": "336320",
    "end": "337360"
  },
  {
    "text": "challenge we had it was for our infosec",
    "start": "337360",
    "end": "339600"
  },
  {
    "text": "team it was extremely hard for them to",
    "start": "339600",
    "end": "341840"
  },
  {
    "text": "do audits because they would have to",
    "start": "341840",
    "end": "344080"
  },
  {
    "text": "look at these aqua files proto files or",
    "start": "344080",
    "end": "346080"
  },
  {
    "text": "even custom code",
    "start": "346080",
    "end": "347360"
  },
  {
    "text": "to look at things like is this endpoint",
    "start": "347360",
    "end": "350479"
  },
  {
    "text": "exposing pii data if it is",
    "start": "350479",
    "end": "352400"
  },
  {
    "text": "if it's requiring the right permissions",
    "start": "352400",
    "end": "355680"
  },
  {
    "text": "uh that it should given the data it's",
    "start": "355680",
    "end": "358000"
  },
  {
    "text": "exposing",
    "start": "358000",
    "end": "358960"
  },
  {
    "text": "that was a very hard question to answer",
    "start": "358960",
    "end": "362240"
  },
  {
    "text": "so we try to come up with a few",
    "start": "362240",
    "end": "363759"
  },
  {
    "text": "solutions some of them are",
    "start": "363759",
    "end": "366000"
  },
  {
    "text": "we need a consistent authorization",
    "start": "366000",
    "end": "367680"
  },
  {
    "text": "strategy",
    "start": "367680",
    "end": "369280"
  },
  {
    "text": "um and then we could also we talked",
    "start": "369280",
    "end": "371440"
  },
  {
    "text": "about unifying both permission sets",
    "start": "371440",
    "end": "373280"
  },
  {
    "text": "so we could reuse our public apis",
    "start": "373280",
    "end": "375120"
  },
  {
    "text": "internally the next effort to solve the",
    "start": "375120",
    "end": "377680"
  },
  {
    "text": "infosec",
    "start": "377680",
    "end": "378400"
  },
  {
    "text": "problem we thought about a centralized",
    "start": "378400",
    "end": "380160"
  },
  {
    "text": "source of truth that they could use",
    "start": "380160",
    "end": "382240"
  },
  {
    "text": "to actually look up resources look up",
    "start": "382240",
    "end": "384720"
  },
  {
    "text": "their requirements",
    "start": "384720",
    "end": "386000"
  },
  {
    "text": "and and see if these permissions match",
    "start": "386000",
    "end": "388000"
  },
  {
    "text": "what is expected",
    "start": "388000",
    "end": "389440"
  },
  {
    "text": "uh from a security perspective some",
    "start": "389440",
    "end": "392639"
  },
  {
    "text": "other things that came up is",
    "start": "392639",
    "end": "394319"
  },
  {
    "text": "we need a single authorization point",
    "start": "394319",
    "end": "396800"
  },
  {
    "text": "that way we can make sure that everyone",
    "start": "396800",
    "end": "399120"
  },
  {
    "text": "is using the same code to authorize and",
    "start": "399120",
    "end": "401360"
  },
  {
    "text": "they're always",
    "start": "401360",
    "end": "402479"
  },
  {
    "text": "using the latest version available",
    "start": "402479",
    "end": "406000"
  },
  {
    "text": "so these were some of the solutions and",
    "start": "406000",
    "end": "407840"
  },
  {
    "text": "motivations and",
    "start": "407840",
    "end": "409039"
  },
  {
    "text": "and then we started thinking in how we",
    "start": "409039",
    "end": "410560"
  },
  {
    "text": "would actually uh",
    "start": "410560",
    "end": "412160"
  },
  {
    "text": "implement these as i mentioned some of",
    "start": "412160",
    "end": "413919"
  },
  {
    "text": "them we would be able to",
    "start": "413919",
    "end": "415680"
  },
  {
    "text": "address this with a centralized source",
    "start": "415680",
    "end": "417599"
  },
  {
    "text": "of truth",
    "start": "417599",
    "end": "419360"
  },
  {
    "text": "some other issues uh we could fix them",
    "start": "419360",
    "end": "422639"
  },
  {
    "text": "by having a single authorization point",
    "start": "422639",
    "end": "426560"
  },
  {
    "text": "and then we also wanted to have a deny",
    "start": "426560",
    "end": "428400"
  },
  {
    "text": "by default approach",
    "start": "428400",
    "end": "430240"
  },
  {
    "text": "which we're still not quite sure how we",
    "start": "430240",
    "end": "431840"
  },
  {
    "text": "were going to fix that you deny by",
    "start": "431840",
    "end": "433440"
  },
  {
    "text": "default what it means is",
    "start": "433440",
    "end": "435039"
  },
  {
    "text": "if a resource or an endpoint has not",
    "start": "435039",
    "end": "438240"
  },
  {
    "text": "defined",
    "start": "438240",
    "end": "438800"
  },
  {
    "text": "any authentication or authorization",
    "start": "438800",
    "end": "440560"
  },
  {
    "text": "requirements",
    "start": "440560",
    "end": "441840"
  },
  {
    "text": "it gets a night so you have to",
    "start": "441840",
    "end": "443680"
  },
  {
    "text": "explicitly define these requirements",
    "start": "443680",
    "end": "446479"
  },
  {
    "text": "before your endpoint will work correctly",
    "start": "446479",
    "end": "451840"
  },
  {
    "text": "at that point we had been looking at the",
    "start": "452160",
    "end": "454240"
  },
  {
    "text": "external ot filter that's",
    "start": "454240",
    "end": "456160"
  },
  {
    "text": "available in envoy because we had",
    "start": "456160",
    "end": "458479"
  },
  {
    "text": "reached a point at square where all",
    "start": "458479",
    "end": "459759"
  },
  {
    "text": "these services had envoy side cars",
    "start": "459759",
    "end": "461919"
  },
  {
    "text": "so now leveraging envoy became a real",
    "start": "461919",
    "end": "465199"
  },
  {
    "text": "thing",
    "start": "465199",
    "end": "467440"
  },
  {
    "start": "467000",
    "end": "467000"
  },
  {
    "text": "and so for those of you who are not",
    "start": "467440",
    "end": "469360"
  },
  {
    "text": "familiar with the external oddsy",
    "start": "469360",
    "end": "471680"
  },
  {
    "text": "filter on an envoy it's personally my",
    "start": "471680",
    "end": "475199"
  },
  {
    "text": "favorite extension",
    "start": "475199",
    "end": "476720"
  },
  {
    "text": "it has made my life so much easier and",
    "start": "476720",
    "end": "479280"
  },
  {
    "text": "basically the way it works is that it's",
    "start": "479280",
    "end": "480800"
  },
  {
    "text": "a filter that will call",
    "start": "480800",
    "end": "482000"
  },
  {
    "text": "an external service send to the original",
    "start": "482000",
    "end": "485120"
  },
  {
    "text": "request",
    "start": "485120",
    "end": "486400"
  },
  {
    "text": "and the external service can then make a",
    "start": "486400",
    "end": "488639"
  },
  {
    "text": "decision if that request",
    "start": "488639",
    "end": "490560"
  },
  {
    "text": "is authorized or not if it's authorized",
    "start": "490560",
    "end": "493199"
  },
  {
    "text": "it will return a 200",
    "start": "493199",
    "end": "494639"
  },
  {
    "text": "and then envoy will move on to the next",
    "start": "494639",
    "end": "497759"
  },
  {
    "text": "filter",
    "start": "497759",
    "end": "498400"
  },
  {
    "text": "and eventually reach the application",
    "start": "498400",
    "end": "501199"
  },
  {
    "text": "layer upstream and now",
    "start": "501199",
    "end": "502639"
  },
  {
    "text": "the application upstream knows that this",
    "start": "502639",
    "end": "505120"
  },
  {
    "text": "request has been authorized",
    "start": "505120",
    "end": "507680"
  },
  {
    "text": "if the authorization service decides",
    "start": "507680",
    "end": "510080"
  },
  {
    "text": "that",
    "start": "510080",
    "end": "510800"
  },
  {
    "text": "this request is not authorized it's",
    "start": "510800",
    "end": "512479"
  },
  {
    "text": "lacking certain permissions",
    "start": "512479",
    "end": "514080"
  },
  {
    "text": "it can return an error such as a 403 in",
    "start": "514080",
    "end": "516959"
  },
  {
    "text": "that case",
    "start": "516959",
    "end": "517599"
  },
  {
    "text": "envoy will take that response return",
    "start": "517599",
    "end": "519919"
  },
  {
    "text": "that to the client",
    "start": "519919",
    "end": "521279"
  },
  {
    "text": "including the response body that the",
    "start": "521279",
    "end": "523279"
  },
  {
    "text": "authorization service is returning",
    "start": "523279",
    "end": "526880"
  },
  {
    "text": "um so basically this is how this would",
    "start": "527120",
    "end": "529279"
  },
  {
    "text": "look like for a successful request",
    "start": "529279",
    "end": "531760"
  },
  {
    "text": "so the client sends a request which gets",
    "start": "531760",
    "end": "535519"
  },
  {
    "text": "proxied",
    "start": "535519",
    "end": "536320"
  },
  {
    "text": "by envoy which then calls the",
    "start": "536320",
    "end": "537839"
  },
  {
    "text": "authorization service receives a 200",
    "start": "537839",
    "end": "540320"
  },
  {
    "text": "then envoy forwards the request to the",
    "start": "540320",
    "end": "542560"
  },
  {
    "text": "application layer",
    "start": "542560",
    "end": "544160"
  },
  {
    "text": "that who eventually will return that to",
    "start": "544160",
    "end": "546320"
  },
  {
    "text": "the client",
    "start": "546320",
    "end": "549760"
  },
  {
    "text": "uh as you saw earlier we use a lot of",
    "start": "549760",
    "end": "551920"
  },
  {
    "text": "library code at square and we did not",
    "start": "551920",
    "end": "554000"
  },
  {
    "text": "have a authorization service",
    "start": "554000",
    "end": "555760"
  },
  {
    "text": "so we had to build an authorization",
    "start": "555760",
    "end": "558160"
  },
  {
    "text": "service to",
    "start": "558160",
    "end": "559360"
  },
  {
    "text": "accept and and support these uh this",
    "start": "559360",
    "end": "562000"
  },
  {
    "text": "external rt filter",
    "start": "562000",
    "end": "565040"
  },
  {
    "text": "for the authorization service we decided",
    "start": "565040",
    "end": "568399"
  },
  {
    "text": "to",
    "start": "568399",
    "end": "568720"
  },
  {
    "text": "use a database as a source of truth for",
    "start": "568720",
    "end": "571920"
  },
  {
    "text": "all authentication and authorization",
    "start": "571920",
    "end": "574480"
  },
  {
    "text": "requirements for all routes",
    "start": "574480",
    "end": "576480"
  },
  {
    "text": "at square and we back that up with a on",
    "start": "576480",
    "end": "579519"
  },
  {
    "text": "voice avi",
    "start": "579519",
    "end": "580720"
  },
  {
    "text": "and this ui is what allowed service",
    "start": "580720",
    "end": "582240"
  },
  {
    "text": "owners to configure their routes",
    "start": "582240",
    "end": "583760"
  },
  {
    "text": "configure their requirements",
    "start": "583760",
    "end": "585600"
  },
  {
    "text": "and essentially that's what would be",
    "start": "585600",
    "end": "587600"
  },
  {
    "text": "enforced by",
    "start": "587600",
    "end": "588880"
  },
  {
    "text": "by envoy this is a quick preview",
    "start": "588880",
    "end": "592720"
  },
  {
    "text": "of how that ui looks like and",
    "start": "592720",
    "end": "596399"
  },
  {
    "text": "we did go back and forth on should we",
    "start": "596399",
    "end": "598399"
  },
  {
    "text": "use a ui in a database",
    "start": "598399",
    "end": "599920"
  },
  {
    "text": "or should we use echo files that",
    "start": "599920",
    "end": "603440"
  },
  {
    "text": "can be checked in in our search control",
    "start": "603440",
    "end": "607440"
  },
  {
    "text": "and the main reason we decided to go",
    "start": "607440",
    "end": "608880"
  },
  {
    "text": "with the ui in the database is",
    "start": "608880",
    "end": "610560"
  },
  {
    "text": "because we're still making a lot of",
    "start": "610560",
    "end": "613279"
  },
  {
    "text": "changes",
    "start": "613279",
    "end": "614160"
  },
  {
    "text": "we still want to make some improvements",
    "start": "614160",
    "end": "615839"
  },
  {
    "text": "in our authorization model",
    "start": "615839",
    "end": "618079"
  },
  {
    "text": "and making these changes having a",
    "start": "618079",
    "end": "619440"
  },
  {
    "text": "database is slightly easier than having",
    "start": "619440",
    "end": "622160"
  },
  {
    "text": "to make that",
    "start": "622160",
    "end": "623360"
  },
  {
    "text": "in files or static static files",
    "start": "623360",
    "end": "626640"
  },
  {
    "text": "and on top of that if you want to make a",
    "start": "626640",
    "end": "629519"
  },
  {
    "text": "change",
    "start": "629519",
    "end": "630079"
  },
  {
    "text": "to your authorization requirements with",
    "start": "630079",
    "end": "631760"
  },
  {
    "text": "a database you can do that immediately",
    "start": "631760",
    "end": "634640"
  },
  {
    "text": "while if you're using apple files it",
    "start": "634640",
    "end": "636560"
  },
  {
    "text": "would require a redeploy",
    "start": "636560",
    "end": "638480"
  },
  {
    "text": "of the authorization service so since we",
    "start": "638480",
    "end": "641120"
  },
  {
    "text": "have",
    "start": "641120",
    "end": "641760"
  },
  {
    "text": "somewhere around 250 services that we",
    "start": "641760",
    "end": "643839"
  },
  {
    "text": "were trying to migrate",
    "start": "643839",
    "end": "645279"
  },
  {
    "text": "every single time one of those services",
    "start": "645279",
    "end": "648720"
  },
  {
    "text": "makes a change we would have to",
    "start": "648720",
    "end": "650800"
  },
  {
    "text": "redeploy the authorization service for",
    "start": "650800",
    "end": "653920"
  },
  {
    "text": "that change",
    "start": "653920",
    "end": "656079"
  },
  {
    "text": "to to show up in either staging or",
    "start": "656079",
    "end": "658839"
  },
  {
    "text": "production",
    "start": "658839",
    "end": "661839"
  },
  {
    "text": "next we had uh the solution in place",
    "start": "661839",
    "end": "664560"
  },
  {
    "text": "where",
    "start": "664560",
    "end": "664959"
  },
  {
    "text": "envoy is calling the authorization",
    "start": "664959",
    "end": "666640"
  },
  {
    "text": "service for every single request",
    "start": "666640",
    "end": "668800"
  },
  {
    "text": "that's when we introduce the concept of",
    "start": "668800",
    "end": "670320"
  },
  {
    "text": "protected and unprotected routes",
    "start": "670320",
    "end": "672959"
  },
  {
    "text": "unprotected routes uh there are routes",
    "start": "672959",
    "end": "675600"
  },
  {
    "text": "for static content blog posts",
    "start": "675600",
    "end": "677600"
  },
  {
    "text": "images that do not need authorization",
    "start": "677600",
    "end": "680720"
  },
  {
    "text": "so for",
    "start": "680720",
    "end": "683839"
  },
  {
    "text": "those routes we we really don't want",
    "start": "683839",
    "end": "686480"
  },
  {
    "text": "envoy to call the authorization service",
    "start": "686480",
    "end": "688640"
  },
  {
    "text": "because that's",
    "start": "688640",
    "end": "689680"
  },
  {
    "text": "a waste of resources for both the",
    "start": "689680",
    "end": "691760"
  },
  {
    "text": "authorization service and the request",
    "start": "691760",
    "end": "693680"
  },
  {
    "text": "itself",
    "start": "693680",
    "end": "694560"
  },
  {
    "text": "so in order to do that uh we started we",
    "start": "694560",
    "end": "696959"
  },
  {
    "text": "gave service owners the option of",
    "start": "696959",
    "end": "700079"
  },
  {
    "text": "uh saying if their routes were uh",
    "start": "700079",
    "end": "703040"
  },
  {
    "text": "required authorization or authentication",
    "start": "703040",
    "end": "705680"
  },
  {
    "text": "and then we built a integration uh",
    "start": "705680",
    "end": "709200"
  },
  {
    "text": "with our centralized control plane",
    "start": "709200",
    "end": "712320"
  },
  {
    "text": "and our authorization service which",
    "start": "712320",
    "end": "714320"
  },
  {
    "text": "would now",
    "start": "714320",
    "end": "715360"
  },
  {
    "text": "send over to the control plane the",
    "start": "715360",
    "end": "717680"
  },
  {
    "text": "unprotected routes and the services",
    "start": "717680",
    "end": "720160"
  },
  {
    "text": "so when the control plane is building a",
    "start": "720160",
    "end": "722079"
  },
  {
    "text": "new snapshot",
    "start": "722079",
    "end": "723440"
  },
  {
    "text": "for a envoy sidecar it would know",
    "start": "723440",
    "end": "726560"
  },
  {
    "text": "for which routes it had to disable the",
    "start": "726560",
    "end": "729200"
  },
  {
    "text": "external audi",
    "start": "729200",
    "end": "730320"
  },
  {
    "text": "filter",
    "start": "730320",
    "end": "732720"
  },
  {
    "text": "next we we had this in place uh it was",
    "start": "733360",
    "end": "736480"
  },
  {
    "text": "great",
    "start": "736480",
    "end": "736880"
  },
  {
    "text": "and now we had a migration challenge so",
    "start": "736880",
    "end": "739680"
  },
  {
    "text": "we had the solution",
    "start": "739680",
    "end": "740800"
  },
  {
    "text": "but we still had 250 services that we",
    "start": "740800",
    "end": "743360"
  },
  {
    "text": "now needed to",
    "start": "743360",
    "end": "744000"
  },
  {
    "text": "migrate how do we get all those",
    "start": "744000",
    "end": "747600"
  },
  {
    "text": "rules and authorization requirements",
    "start": "747600",
    "end": "749680"
  },
  {
    "text": "into this central storage",
    "start": "749680",
    "end": "751600"
  },
  {
    "text": "this is when the team decided to invest",
    "start": "751600",
    "end": "753600"
  },
  {
    "text": "some time in",
    "start": "753600",
    "end": "754880"
  },
  {
    "text": "building migration scripts",
    "start": "754880",
    "end": "758000"
  },
  {
    "text": "if you remember from this this previous",
    "start": "758000",
    "end": "760079"
  },
  {
    "text": "overview",
    "start": "760079",
    "end": "761519"
  },
  {
    "text": "different libraries some use aqua file",
    "start": "761519",
    "end": "763440"
  },
  {
    "text": "some use proto files",
    "start": "763440",
    "end": "764880"
  },
  {
    "text": "and what we did is we build different",
    "start": "764880",
    "end": "767440"
  },
  {
    "text": "scripts that would extract the rules",
    "start": "767440",
    "end": "769920"
  },
  {
    "text": "from these files and call temporary",
    "start": "769920",
    "end": "771760"
  },
  {
    "text": "endpoints in the authorization service",
    "start": "771760",
    "end": "774399"
  },
  {
    "text": "so we could store that data in the",
    "start": "774399",
    "end": "776320"
  },
  {
    "text": "authorization",
    "start": "776320",
    "end": "777519"
  },
  {
    "text": "database this turned out to be a great",
    "start": "777519",
    "end": "780560"
  },
  {
    "text": "solution",
    "start": "780560",
    "end": "782079"
  },
  {
    "text": "mainly because it was a very flexible",
    "start": "782079",
    "end": "784839"
  },
  {
    "text": "approach",
    "start": "784839",
    "end": "786079"
  },
  {
    "text": "we were the decision makers so we could",
    "start": "786079",
    "end": "788160"
  },
  {
    "text": "allocate as many",
    "start": "788160",
    "end": "789680"
  },
  {
    "text": "resources to this problem as we wanted",
    "start": "789680",
    "end": "792720"
  },
  {
    "text": "and at the same time it kept both",
    "start": "792720",
    "end": "794560"
  },
  {
    "text": "authorization strategies in sync",
    "start": "794560",
    "end": "797200"
  },
  {
    "text": "this was very helpful as we were rolling",
    "start": "797200",
    "end": "800160"
  },
  {
    "text": "out",
    "start": "800160",
    "end": "801279"
  },
  {
    "text": "uh envoy safe having the ability to",
    "start": "801279",
    "end": "804720"
  },
  {
    "text": "disable it knowing that there was still",
    "start": "804720",
    "end": "806639"
  },
  {
    "text": "a backup strategy this library would be",
    "start": "806639",
    "end": "809360"
  },
  {
    "text": "up to date",
    "start": "809360",
    "end": "810160"
  },
  {
    "text": "and would have all the right",
    "start": "810160",
    "end": "811839"
  },
  {
    "text": "requirements in place",
    "start": "811839",
    "end": "815839"
  },
  {
    "text": "next we had a set of services that had",
    "start": "815920",
    "end": "819040"
  },
  {
    "text": "their",
    "start": "819040",
    "end": "819600"
  },
  {
    "text": "uh authorization requirements built in",
    "start": "819600",
    "end": "822560"
  },
  {
    "text": "the application layer",
    "start": "822560",
    "end": "823760"
  },
  {
    "text": "unfortunately there was no easy way to",
    "start": "823760",
    "end": "825839"
  },
  {
    "text": "extract that data and migrate it",
    "start": "825839",
    "end": "827760"
  },
  {
    "text": "to the authorization service so we had",
    "start": "827760",
    "end": "830399"
  },
  {
    "text": "to work with service owners",
    "start": "830399",
    "end": "832000"
  },
  {
    "text": "to have them manually migrate these",
    "start": "832000",
    "end": "834320"
  },
  {
    "text": "routes",
    "start": "834320",
    "end": "835040"
  },
  {
    "text": "this is not as ideal mainly because",
    "start": "835040",
    "end": "837920"
  },
  {
    "text": "teams",
    "start": "837920",
    "end": "838560"
  },
  {
    "text": "have their own deadlines their own",
    "start": "838560",
    "end": "839839"
  },
  {
    "text": "schedules so we had to work with that",
    "start": "839839",
    "end": "842399"
  },
  {
    "text": "and even though our teams were very",
    "start": "842399",
    "end": "843600"
  },
  {
    "text": "supportive",
    "start": "843600",
    "end": "845120"
  },
  {
    "text": "it's there's still no automated way to",
    "start": "845120",
    "end": "847199"
  },
  {
    "text": "keep these both to keep both strategies",
    "start": "847199",
    "end": "849199"
  },
  {
    "text": "in sync so now we have to ask teams",
    "start": "849199",
    "end": "851440"
  },
  {
    "text": "hey you have to update your permission",
    "start": "851440",
    "end": "853600"
  },
  {
    "text": "requirements",
    "start": "853600",
    "end": "854560"
  },
  {
    "text": "in both places until we're fully rolled",
    "start": "854560",
    "end": "857199"
  },
  {
    "text": "out",
    "start": "857199",
    "end": "857760"
  },
  {
    "text": "and you can actually deprecate the code",
    "start": "857760",
    "end": "859839"
  },
  {
    "text": "in your application layer",
    "start": "859839",
    "end": "863040"
  },
  {
    "text": "uh next i would like to talk a little",
    "start": "863279",
    "end": "864560"
  },
  {
    "text": "bit more about our our rollout strategy",
    "start": "864560",
    "end": "867199"
  },
  {
    "text": "so at this point we had a solution in",
    "start": "867199",
    "end": "869760"
  },
  {
    "text": "place",
    "start": "869760",
    "end": "870240"
  },
  {
    "text": "we had a lot of data and we were ready",
    "start": "870240",
    "end": "872880"
  },
  {
    "text": "to",
    "start": "872880",
    "end": "873279"
  },
  {
    "text": "to try this and roll out for for",
    "start": "873279",
    "end": "875040"
  },
  {
    "text": "multiple services",
    "start": "875040",
    "end": "877440"
  },
  {
    "start": "877000",
    "end": "877000"
  },
  {
    "text": "and first what we did is we introduced a",
    "start": "877440",
    "end": "879600"
  },
  {
    "text": "logging only mode",
    "start": "879600",
    "end": "881120"
  },
  {
    "text": "um a logging only mode what that does is",
    "start": "881120",
    "end": "883600"
  },
  {
    "text": "that our authorization service would",
    "start": "883600",
    "end": "885680"
  },
  {
    "text": "always return to 200 no matter what",
    "start": "885680",
    "end": "888079"
  },
  {
    "text": "the actual authorization decision was so",
    "start": "888079",
    "end": "891120"
  },
  {
    "text": "envoy would never short-circuit the",
    "start": "891120",
    "end": "892880"
  },
  {
    "text": "request",
    "start": "892880",
    "end": "894240"
  },
  {
    "text": "we did this with additional metrics and",
    "start": "894240",
    "end": "897680"
  },
  {
    "text": "logs",
    "start": "897680",
    "end": "898240"
  },
  {
    "text": "so service owners could actually compare",
    "start": "898240",
    "end": "900800"
  },
  {
    "text": "the decision the authorization service",
    "start": "900800",
    "end": "902720"
  },
  {
    "text": "would have made",
    "start": "902720",
    "end": "903760"
  },
  {
    "text": "versus what the existing library or",
    "start": "903760",
    "end": "906560"
  },
  {
    "text": "their existing application layer",
    "start": "906560",
    "end": "908720"
  },
  {
    "text": "actually did that allowed them to tweak",
    "start": "908720",
    "end": "911600"
  },
  {
    "text": "their requirements",
    "start": "911600",
    "end": "913360"
  },
  {
    "text": "tweak some of the the permissions or",
    "start": "913360",
    "end": "915600"
  },
  {
    "text": "configurations that they had in place",
    "start": "915600",
    "end": "917440"
  },
  {
    "text": "through the on voice safe ui",
    "start": "917440",
    "end": "920880"
  },
  {
    "text": "uh our next uh rollout strategy",
    "start": "921120",
    "end": "925279"
  },
  {
    "text": "is we use the runtime uh fraction",
    "start": "925279",
    "end": "928399"
  },
  {
    "text": "configuration this allowed us to split",
    "start": "928399",
    "end": "930720"
  },
  {
    "text": "some of the traffic and roll out on a",
    "start": "930720",
    "end": "932839"
  },
  {
    "text": "percentage-based",
    "start": "932839",
    "end": "934959"
  },
  {
    "text": "uh approach so what we did is that we",
    "start": "934959",
    "end": "938480"
  },
  {
    "text": "would roll out",
    "start": "938480",
    "end": "940079"
  },
  {
    "text": "on voice safe for five percent of a",
    "start": "940079",
    "end": "942480"
  },
  {
    "text": "given service traffic",
    "start": "942480",
    "end": "944000"
  },
  {
    "text": "that allowed us to make sure that the",
    "start": "944000",
    "end": "945199"
  },
  {
    "text": "authorization service was hitting the",
    "start": "945199",
    "end": "947199"
  },
  {
    "text": "right",
    "start": "947199",
    "end": "948000"
  },
  {
    "text": "uh slas we were able to handle",
    "start": "948000",
    "end": "951120"
  },
  {
    "text": "that qps and we're also sure that not",
    "start": "951120",
    "end": "953519"
  },
  {
    "text": "we're not blocking any traffic we should",
    "start": "953519",
    "end": "955440"
  },
  {
    "text": "not be blocking",
    "start": "955440",
    "end": "956639"
  },
  {
    "text": "and do a little bit more of a control",
    "start": "956639",
    "end": "958560"
  },
  {
    "text": "rollout",
    "start": "958560",
    "end": "961040"
  },
  {
    "text": "so in order to support this percentage",
    "start": "963920",
    "end": "965600"
  },
  {
    "text": "rollout we introduced that as part of an",
    "start": "965600",
    "end": "968399"
  },
  {
    "text": "admin panel and we had that uh passed",
    "start": "968399",
    "end": "971920"
  },
  {
    "text": "to the onvoice control plane through",
    "start": "971920",
    "end": "974000"
  },
  {
    "text": "that same integration that i mentioned",
    "start": "974000",
    "end": "975440"
  },
  {
    "text": "earlier for",
    "start": "975440",
    "end": "976240"
  },
  {
    "text": "unprotected routes that did require",
    "start": "976240",
    "end": "979519"
  },
  {
    "text": "some changes in our data model",
    "start": "979519",
    "end": "983199"
  },
  {
    "text": "on the on the control plane side to",
    "start": "983199",
    "end": "984880"
  },
  {
    "text": "support these these different values but",
    "start": "984880",
    "end": "987360"
  },
  {
    "text": "that worked out",
    "start": "987360",
    "end": "990160"
  },
  {
    "start": "990000",
    "end": "990000"
  },
  {
    "text": "and then next i want to talk a little",
    "start": "990720",
    "end": "991920"
  },
  {
    "text": "bit about some of the lessons learned",
    "start": "991920",
    "end": "994320"
  },
  {
    "text": "uh first we in our ui",
    "start": "994320",
    "end": "997440"
  },
  {
    "text": "we allowed users or service owners to",
    "start": "997440",
    "end": "1000079"
  },
  {
    "text": "use wildcards",
    "start": "1000079",
    "end": "1001440"
  },
  {
    "text": "and for for given namespaces and mark",
    "start": "1001440",
    "end": "1004079"
  },
  {
    "text": "that",
    "start": "1004079",
    "end": "1004480"
  },
  {
    "text": "as a unprotected route or a protected",
    "start": "1004480",
    "end": "1006639"
  },
  {
    "text": "route and specify",
    "start": "1006639",
    "end": "1008320"
  },
  {
    "text": "and group certain permissions and",
    "start": "1008320",
    "end": "1010000"
  },
  {
    "text": "endpoints um this introduced",
    "start": "1010000",
    "end": "1012560"
  },
  {
    "text": "conflicts as you can see someone would",
    "start": "1012560",
    "end": "1016079"
  },
  {
    "text": "mark a wild card or all traffic",
    "start": "1016079",
    "end": "1019920"
  },
  {
    "text": "as unprotected and later on a more",
    "start": "1019920",
    "end": "1021759"
  },
  {
    "text": "granular route with actual",
    "start": "1021759",
    "end": "1023759"
  },
  {
    "text": "authorization permissions uh",
    "start": "1023759",
    "end": "1026400"
  },
  {
    "text": "requirements",
    "start": "1026400",
    "end": "1027438"
  },
  {
    "text": "so we had to build some logic around",
    "start": "1027439",
    "end": "1029839"
  },
  {
    "text": "that to detect these cases",
    "start": "1029839",
    "end": "1031678"
  },
  {
    "text": "and either notify the end user",
    "start": "1031679",
    "end": "1035600"
  },
  {
    "text": "through the ui saying hey you're",
    "start": "1035600",
    "end": "1038079"
  },
  {
    "text": "introducing a conflict you might want to",
    "start": "1038079",
    "end": "1039760"
  },
  {
    "text": "consider",
    "start": "1039760",
    "end": "1041199"
  },
  {
    "text": "specifying a more granular route or",
    "start": "1041199",
    "end": "1044400"
  },
  {
    "text": "we have to be very clever about how we",
    "start": "1044400",
    "end": "1046079"
  },
  {
    "text": "organize these routes when we send them",
    "start": "1046079",
    "end": "1048240"
  },
  {
    "text": "as unprotected routes to the",
    "start": "1048240",
    "end": "1049679"
  },
  {
    "text": "authorization service",
    "start": "1049679",
    "end": "1052080"
  },
  {
    "text": "but it's definitely something to keep in",
    "start": "1052080",
    "end": "1053520"
  },
  {
    "text": "mind because we missed that",
    "start": "1053520",
    "end": "1055840"
  },
  {
    "text": "initially debugging",
    "start": "1055840",
    "end": "1058880"
  },
  {
    "text": "debugging becomes a little bit more",
    "start": "1058880",
    "end": "1060240"
  },
  {
    "text": "challenging because now service owners",
    "start": "1060240",
    "end": "1062640"
  },
  {
    "text": "have to rely on the logs",
    "start": "1062640",
    "end": "1065200"
  },
  {
    "text": "we use in the service mesh or in the",
    "start": "1065200",
    "end": "1067039"
  },
  {
    "text": "authorization service",
    "start": "1067039",
    "end": "1068559"
  },
  {
    "text": "so they can it's a little bit harder for",
    "start": "1068559",
    "end": "1070400"
  },
  {
    "text": "them to they cannot add any custom",
    "start": "1070400",
    "end": "1072960"
  },
  {
    "text": "logging",
    "start": "1072960",
    "end": "1073760"
  },
  {
    "text": "or custom metrics they have to rely on a",
    "start": "1073760",
    "end": "1075919"
  },
  {
    "text": "more generic",
    "start": "1075919",
    "end": "1078840"
  },
  {
    "text": "output and",
    "start": "1078840",
    "end": "1081200"
  },
  {
    "text": "next some shortcomings we noticed with",
    "start": "1081200",
    "end": "1083200"
  },
  {
    "text": "the external",
    "start": "1083200",
    "end": "1084320"
  },
  {
    "text": "ozzy extension is that as i mentioned",
    "start": "1084320",
    "end": "1086960"
  },
  {
    "text": "earlier it's my favorite filter",
    "start": "1086960",
    "end": "1088400"
  },
  {
    "text": "and i'm not the only one who thinks that",
    "start": "1088400",
    "end": "1091679"
  },
  {
    "text": "so there are a lot of teams at square",
    "start": "1091679",
    "end": "1093840"
  },
  {
    "text": "who",
    "start": "1093840",
    "end": "1094240"
  },
  {
    "text": "are trying to use this filter not only",
    "start": "1094240",
    "end": "1096240"
  },
  {
    "text": "for authorization but for other use",
    "start": "1096240",
    "end": "1098000"
  },
  {
    "text": "cases as well",
    "start": "1098000",
    "end": "1099360"
  },
  {
    "text": "so this filter i think it's very",
    "start": "1099360",
    "end": "1102160"
  },
  {
    "text": "versatile so it can be used for",
    "start": "1102160",
    "end": "1104320"
  },
  {
    "text": "multiple use cases and solve different",
    "start": "1104320",
    "end": "1108400"
  },
  {
    "text": "problems",
    "start": "1108400",
    "end": "1109679"
  },
  {
    "text": "so as far as i know there's no other",
    "start": "1109679",
    "end": "1112400"
  },
  {
    "text": "filter",
    "start": "1112400",
    "end": "1113039"
  },
  {
    "text": "that allows you to call a service mutate",
    "start": "1113039",
    "end": "1116160"
  },
  {
    "text": "the headers and mute the headers of the",
    "start": "1116160",
    "end": "1117919"
  },
  {
    "text": "original request",
    "start": "1117919",
    "end": "1120880"
  },
  {
    "text": "and there is no out-of-the-box way to",
    "start": "1120960",
    "end": "1123200"
  },
  {
    "text": "differentiate",
    "start": "1123200",
    "end": "1124320"
  },
  {
    "text": "two external odd-c filters and deploy",
    "start": "1124320",
    "end": "1126640"
  },
  {
    "text": "different configurations",
    "start": "1126640",
    "end": "1128400"
  },
  {
    "text": "so at the same time there's no way to",
    "start": "1128400",
    "end": "1130960"
  },
  {
    "text": "enable or disable them individually",
    "start": "1130960",
    "end": "1133120"
  },
  {
    "text": "that caused some conflicts between",
    "start": "1133120",
    "end": "1134640"
  },
  {
    "text": "different teams who are trying to use",
    "start": "1134640",
    "end": "1136080"
  },
  {
    "text": "this filter",
    "start": "1136080",
    "end": "1137360"
  },
  {
    "text": "and they cannot we cannot use them for",
    "start": "1137360",
    "end": "1139440"
  },
  {
    "text": "the same services",
    "start": "1139440",
    "end": "1140880"
  },
  {
    "text": "because if they disable it they're",
    "start": "1140880",
    "end": "1142640"
  },
  {
    "text": "disabling our solution",
    "start": "1142640",
    "end": "1143919"
  },
  {
    "text": "if we disable or enable it we're also",
    "start": "1143919",
    "end": "1146080"
  },
  {
    "text": "enabling",
    "start": "1146080",
    "end": "1147200"
  },
  {
    "text": "the filter for on their solution",
    "start": "1147200",
    "end": "1152160"
  },
  {
    "text": "there's also no way to bypass the filter",
    "start": "1152160",
    "end": "1155360"
  },
  {
    "text": "for a given uh header that would have",
    "start": "1155360",
    "end": "1158559"
  },
  {
    "text": "been useful in in some cases",
    "start": "1158559",
    "end": "1161120"
  },
  {
    "text": "to make sure we do not reauthorize or",
    "start": "1161120",
    "end": "1163039"
  },
  {
    "text": "reauthenticate a request twice",
    "start": "1163039",
    "end": "1165679"
  },
  {
    "text": "and then",
    "start": "1165679",
    "end": "1168159"
  },
  {
    "text": "you can't change the class of how the",
    "start": "1168799",
    "end": "1171039"
  },
  {
    "text": "grpc",
    "start": "1171039",
    "end": "1171919"
  },
  {
    "text": "call works and and that limits you if",
    "start": "1171919",
    "end": "1174880"
  },
  {
    "text": "you want to have a microservice that",
    "start": "1174880",
    "end": "1176840"
  },
  {
    "text": "implements two endpoints that",
    "start": "1176840",
    "end": "1180000"
  },
  {
    "text": "could be called by the external rt",
    "start": "1180000",
    "end": "1181840"
  },
  {
    "text": "filter that is no longer",
    "start": "1181840",
    "end": "1184240"
  },
  {
    "text": "a possibility",
    "start": "1184240",
    "end": "1187200"
  },
  {
    "start": "1187000",
    "end": "1187000"
  },
  {
    "text": "so conclusion we decided to move all our",
    "start": "1187600",
    "end": "1190720"
  },
  {
    "text": "authorization from app and library code",
    "start": "1190720",
    "end": "1192720"
  },
  {
    "text": "into the service mesh with a centralized",
    "start": "1192720",
    "end": "1194480"
  },
  {
    "text": "source of truth",
    "start": "1194480",
    "end": "1195919"
  },
  {
    "text": "where we are um so currently we start",
    "start": "1195919",
    "end": "1198640"
  },
  {
    "text": "rolling this out in production we are",
    "start": "1198640",
    "end": "1200320"
  },
  {
    "text": "targeting your rollout",
    "start": "1200320",
    "end": "1202400"
  },
  {
    "text": "on voicey for closely 250 services",
    "start": "1202400",
    "end": "1206400"
  },
  {
    "text": "and we're expecting to handle somewhere",
    "start": "1206400",
    "end": "1208159"
  },
  {
    "text": "around uh 20k",
    "start": "1208159",
    "end": "1209840"
  },
  {
    "text": "qps then our next steps uh",
    "start": "1209840",
    "end": "1213280"
  },
  {
    "text": "is going to be focus a little bit more",
    "start": "1213280",
    "end": "1215520"
  },
  {
    "text": "on decoupling",
    "start": "1215520",
    "end": "1216720"
  },
  {
    "text": "some of our authentication authorization",
    "start": "1216720",
    "end": "1218960"
  },
  {
    "text": "strategies",
    "start": "1218960",
    "end": "1220240"
  },
  {
    "text": "and then that will also allow us to",
    "start": "1220240",
    "end": "1222400"
  },
  {
    "text": "implement a",
    "start": "1222400",
    "end": "1224000"
  },
  {
    "text": "new and more flexible permission system",
    "start": "1224000",
    "end": "1227280"
  },
  {
    "text": "uh that will allow us to implement even",
    "start": "1227280",
    "end": "1230000"
  },
  {
    "text": "more features",
    "start": "1230000",
    "end": "1230880"
  },
  {
    "text": "from a application site",
    "start": "1230880",
    "end": "1234080"
  },
  {
    "text": "that's all i had today uh thanks",
    "start": "1234080",
    "end": "1235919"
  },
  {
    "text": "everyone for listening uh",
    "start": "1235919",
    "end": "1237600"
  },
  {
    "text": "this is my email if you want to reach",
    "start": "1237600",
    "end": "1239360"
  },
  {
    "text": "out i would love to hear",
    "start": "1239360",
    "end": "1241120"
  },
  {
    "text": "how your team is solving authorization",
    "start": "1241120",
    "end": "1243760"
  },
  {
    "text": "and if you're",
    "start": "1243760",
    "end": "1244640"
  },
  {
    "text": "interested in working on some of these",
    "start": "1244640",
    "end": "1245919"
  },
  {
    "text": "problems square is hiring",
    "start": "1245919",
    "end": "1249600"
  },
  {
    "text": "thanks everyone",
    "start": "1249600",
    "end": "1252240"
  },
  {
    "text": "hey everyone um thanks for",
    "start": "1253760",
    "end": "1256880"
  },
  {
    "text": "for listening to the talk um let me know",
    "start": "1256880",
    "end": "1259440"
  },
  {
    "text": "if you have",
    "start": "1259440",
    "end": "1260000"
  },
  {
    "text": "any questions",
    "start": "1260000",
    "end": "1263840"
  },
  {
    "text": "how long are you projecting this rollout",
    "start": "1269039",
    "end": "1270960"
  },
  {
    "text": "to take for say 90",
    "start": "1270960",
    "end": "1272320"
  },
  {
    "text": "of all services um it took us about",
    "start": "1272320",
    "end": "1276559"
  },
  {
    "text": "three four months to get most of these",
    "start": "1276559",
    "end": "1278400"
  },
  {
    "text": "routes um",
    "start": "1278400",
    "end": "1280000"
  },
  {
    "text": "into our database and and have service",
    "start": "1280000",
    "end": "1282080"
  },
  {
    "text": "owners review them",
    "start": "1282080",
    "end": "1283120"
  },
  {
    "text": "update them and start rolling out in",
    "start": "1283120",
    "end": "1284880"
  },
  {
    "text": "staging",
    "start": "1284880",
    "end": "1286159"
  },
  {
    "text": "uh we're currently working on our",
    "start": "1286159",
    "end": "1287679"
  },
  {
    "text": "rollout production we expect this to",
    "start": "1287679",
    "end": "1289360"
  },
  {
    "text": "take",
    "start": "1289360",
    "end": "1290000"
  },
  {
    "text": "somewhere between four four to five",
    "start": "1290000",
    "end": "1292799"
  },
  {
    "text": "months",
    "start": "1292799",
    "end": "1293520"
  },
  {
    "text": "um easily probably a little bit longer",
    "start": "1293520",
    "end": "1297760"
  },
  {
    "text": "uh what was the overhead overhead like",
    "start": "1301840",
    "end": "1304559"
  },
  {
    "text": "from running these ot calls not only out",
    "start": "1304559",
    "end": "1306640"
  },
  {
    "text": "of process but over the network",
    "start": "1306640",
    "end": "1308799"
  },
  {
    "text": "um that's a good question i think",
    "start": "1308799",
    "end": "1312799"
  },
  {
    "text": "some of our request calls uh we have an",
    "start": "1312799",
    "end": "1315600"
  },
  {
    "text": "additional latency",
    "start": "1315600",
    "end": "1316960"
  },
  {
    "text": "depending on",
    "start": "1316960",
    "end": "1319840"
  },
  {
    "text": "some of these calls i think our average",
    "start": "1320000",
    "end": "1322240"
  },
  {
    "text": "is still below",
    "start": "1322240",
    "end": "1323039"
  },
  {
    "text": "10 milliseconds which is pretty good uh",
    "start": "1323039",
    "end": "1325840"
  },
  {
    "text": "for a while we were making two calls one",
    "start": "1325840",
    "end": "1327679"
  },
  {
    "text": "to the authentication service and one to",
    "start": "1327679",
    "end": "1329360"
  },
  {
    "text": "the authorization service",
    "start": "1329360",
    "end": "1330640"
  },
  {
    "text": "and so that was um that was doubling",
    "start": "1330640",
    "end": "1334080"
  },
  {
    "text": "uh almost that uh additional latency",
    "start": "1334080",
    "end": "1338240"
  },
  {
    "text": "uh is mtls part of any of your",
    "start": "1339760",
    "end": "1341760"
  },
  {
    "text": "architecture with ot calls",
    "start": "1341760",
    "end": "1343600"
  },
  {
    "text": "um not for these rt calls we're",
    "start": "1343600",
    "end": "1345600"
  },
  {
    "text": "definitely using mtls for",
    "start": "1345600",
    "end": "1347520"
  },
  {
    "text": "uh some some other authorization",
    "start": "1347520",
    "end": "1349840"
  },
  {
    "text": "strategies that we have in place",
    "start": "1349840",
    "end": "1351600"
  },
  {
    "text": "uh but not for this particular design",
    "start": "1351600",
    "end": "1356080"
  },
  {
    "text": "when db updates are done through the ui",
    "start": "1359280",
    "end": "1361440"
  },
  {
    "text": "how do you push the changes through the",
    "start": "1361440",
    "end": "1362720"
  },
  {
    "text": "odds",
    "start": "1362720",
    "end": "1363200"
  },
  {
    "text": "service instances um",
    "start": "1363200",
    "end": "1366480"
  },
  {
    "text": "yeah so the way that works is through",
    "start": "1366480",
    "end": "1368080"
  },
  {
    "text": "the um",
    "start": "1368080",
    "end": "1369679"
  },
  {
    "text": "integration i mentioned earlier between",
    "start": "1369679",
    "end": "1371200"
  },
  {
    "text": "the control plane um so basically uh",
    "start": "1371200",
    "end": "1373600"
  },
  {
    "text": "when somebody updates through the ui",
    "start": "1373600",
    "end": "1375600"
  },
  {
    "text": "some of the routes some of the",
    "start": "1375600",
    "end": "1376480"
  },
  {
    "text": "permission requirements",
    "start": "1376480",
    "end": "1377840"
  },
  {
    "text": "this gets synced to to the database and",
    "start": "1377840",
    "end": "1380159"
  },
  {
    "text": "then our authorization service",
    "start": "1380159",
    "end": "1382000"
  },
  {
    "text": "and the control plane they uh are",
    "start": "1382000",
    "end": "1384640"
  },
  {
    "text": "constantly syncing",
    "start": "1384640",
    "end": "1386000"
  },
  {
    "text": "so when a envoy sidecar will request",
    "start": "1386000",
    "end": "1389679"
  },
  {
    "text": "uh our hit our centralized uh control",
    "start": "1389679",
    "end": "1392400"
  },
  {
    "text": "plane it will get an updated",
    "start": "1392400",
    "end": "1393679"
  },
  {
    "text": "configuration",
    "start": "1393679",
    "end": "1394640"
  },
  {
    "text": "and i think right now we can get that",
    "start": "1394640",
    "end": "1397039"
  },
  {
    "text": "done in",
    "start": "1397039",
    "end": "1398080"
  },
  {
    "text": "uh there's a max latency of five minutes",
    "start": "1398080",
    "end": "1402320"
  },
  {
    "text": "um",
    "start": "1402320",
    "end": "1404880"
  },
  {
    "text": "oh how do you deal with the situation",
    "start": "1409440",
    "end": "1412320"
  },
  {
    "text": "where safe",
    "start": "1412320",
    "end": "1412960"
  },
  {
    "text": "and other teams used to separate",
    "start": "1412960",
    "end": "1415200"
  },
  {
    "text": "external rt filters in the same pipeline",
    "start": "1415200",
    "end": "1417919"
  },
  {
    "text": "uh that is a problem we haven't solved",
    "start": "1417919",
    "end": "1420240"
  },
  {
    "text": "yet it's something we're working on",
    "start": "1420240",
    "end": "1422000"
  },
  {
    "text": "um we are considering making changes",
    "start": "1422000",
    "end": "1425039"
  },
  {
    "text": "maybe to the external rt filter itself",
    "start": "1425039",
    "end": "1427520"
  },
  {
    "text": "uh so we can",
    "start": "1427520",
    "end": "1428559"
  },
  {
    "text": "identify these and enable or disable it",
    "start": "1428559",
    "end": "1430799"
  },
  {
    "text": "depending on",
    "start": "1430799",
    "end": "1432159"
  },
  {
    "text": "the configuration or give it some sort",
    "start": "1432159",
    "end": "1433679"
  },
  {
    "text": "of identifier",
    "start": "1433679",
    "end": "1435279"
  },
  {
    "text": "right now we have not solved that",
    "start": "1435279",
    "end": "1437120"
  },
  {
    "text": "problem yet",
    "start": "1437120",
    "end": "1439679"
  },
  {
    "text": "uh our odyssey decision always pays",
    "start": "1443440",
    "end": "1445919"
  },
  {
    "text": "path-based or is there any application",
    "start": "1445919",
    "end": "1447840"
  },
  {
    "text": "business logic",
    "start": "1447840",
    "end": "1449039"
  },
  {
    "text": "so so far it's all path-based um",
    "start": "1449039",
    "end": "1452720"
  },
  {
    "text": "and the main reason is that we try to",
    "start": "1452720",
    "end": "1454880"
  },
  {
    "text": "keep as much application and business",
    "start": "1454880",
    "end": "1456480"
  },
  {
    "text": "logic",
    "start": "1456480",
    "end": "1456960"
  },
  {
    "text": "out of the authorization service uh",
    "start": "1456960",
    "end": "1459200"
  },
  {
    "text": "that's also why we're trying to",
    "start": "1459200",
    "end": "1460640"
  },
  {
    "text": "decouple some of our authentication",
    "start": "1460640",
    "end": "1462400"
  },
  {
    "text": "service from our authorization service",
    "start": "1462400",
    "end": "1464240"
  },
  {
    "text": "to keep some of that that logic separate",
    "start": "1464240",
    "end": "1466880"
  },
  {
    "text": "uh we are working on a uh different",
    "start": "1466880",
    "end": "1469840"
  },
  {
    "text": "authorization",
    "start": "1469840",
    "end": "1470960"
  },
  {
    "text": "model um where you can force them of",
    "start": "1470960",
    "end": "1474480"
  },
  {
    "text": "like",
    "start": "1474480",
    "end": "1474799"
  },
  {
    "text": "more business logic or business decision",
    "start": "1474799",
    "end": "1478000"
  },
  {
    "text": "in your and specify more granular rules",
    "start": "1478000",
    "end": "1480480"
  },
  {
    "text": "um that's still",
    "start": "1480480",
    "end": "1481919"
  },
  {
    "text": "under development uh but we're hoping uh",
    "start": "1481919",
    "end": "1484640"
  },
  {
    "text": "by",
    "start": "1484640",
    "end": "1485120"
  },
  {
    "text": "once we have that to have a little bit",
    "start": "1485120",
    "end": "1486480"
  },
  {
    "text": "more flexibility and you can force on",
    "start": "1486480",
    "end": "1488320"
  },
  {
    "text": "certain parameters",
    "start": "1488320",
    "end": "1489279"
  },
  {
    "text": "and right because right now that still",
    "start": "1489279",
    "end": "1491200"
  },
  {
    "text": "lives in on",
    "start": "1491200",
    "end": "1492720"
  },
  {
    "text": "the actual application layer so it's",
    "start": "1492720",
    "end": "1494400"
  },
  {
    "text": "still possible that",
    "start": "1494400",
    "end": "1496080"
  },
  {
    "text": "a service will get the authorized",
    "start": "1496080",
    "end": "1498080"
  },
  {
    "text": "request and need to do some uh",
    "start": "1498080",
    "end": "1500080"
  },
  {
    "text": "additional uh authorization",
    "start": "1500080",
    "end": "1503120"
  },
  {
    "text": "logic uh in order to especially if it's",
    "start": "1503120",
    "end": "1505760"
  },
  {
    "text": "very close",
    "start": "1505760",
    "end": "1506480"
  },
  {
    "text": "to the data model in that service",
    "start": "1506480",
    "end": "1510559"
  },
  {
    "text": "uh did you look at oppa ferrazzi if so",
    "start": "1512000",
    "end": "1515120"
  },
  {
    "text": "why did you choose a db model um we did",
    "start": "1515120",
    "end": "1518159"
  },
  {
    "text": "not",
    "start": "1518159",
    "end": "1518799"
  },
  {
    "text": "look into that too much um which is the",
    "start": "1518799",
    "end": "1522000"
  },
  {
    "text": "db model",
    "start": "1522000",
    "end": "1522880"
  },
  {
    "text": "mainly for um when i mentioned what for",
    "start": "1522880",
    "end": "1525520"
  },
  {
    "text": "what i mentioned during the talk",
    "start": "1525520",
    "end": "1526799"
  },
  {
    "text": "um flexibility was the main reason we",
    "start": "1526799",
    "end": "1529360"
  },
  {
    "text": "decided to",
    "start": "1529360",
    "end": "1530559"
  },
  {
    "text": "to move forward with a database model um",
    "start": "1530559",
    "end": "1532880"
  },
  {
    "text": "also we wanted",
    "start": "1532880",
    "end": "1533760"
  },
  {
    "text": "to have the ui integration uh which is",
    "start": "1533760",
    "end": "1537200"
  },
  {
    "text": "some of the features we were looking to",
    "start": "1537200",
    "end": "1540840"
  },
  {
    "text": "implement",
    "start": "1540840",
    "end": "1543840"
  },
  {
    "text": "did you guys resolve for better uh",
    "start": "1544400",
    "end": "1547840"
  },
  {
    "text": "through foot um we have not it's",
    "start": "1547840",
    "end": "1550159"
  },
  {
    "text": "something we've considered",
    "start": "1550159",
    "end": "1551200"
  },
  {
    "text": "um it's an optimization we might",
    "start": "1551200",
    "end": "1553760"
  },
  {
    "text": "implement later",
    "start": "1553760",
    "end": "1554880"
  },
  {
    "text": "on especially since as i mentioned as",
    "start": "1554880",
    "end": "1557840"
  },
  {
    "text": "well",
    "start": "1557840",
    "end": "1558960"
  },
  {
    "text": "there is no way to um actually skip the",
    "start": "1558960",
    "end": "1561760"
  },
  {
    "text": "external odds",
    "start": "1561760",
    "end": "1562720"
  },
  {
    "text": "uh filter um which is possibly a good",
    "start": "1562720",
    "end": "1565120"
  },
  {
    "text": "thing but",
    "start": "1565120",
    "end": "1565840"
  },
  {
    "text": "uh yeah we might consider caching uh",
    "start": "1565840",
    "end": "1568080"
  },
  {
    "text": "some of the odds",
    "start": "1568080",
    "end": "1569039"
  },
  {
    "text": "result results",
    "start": "1569039",
    "end": "1572320"
  },
  {
    "text": "uh the does each of the rt hit the",
    "start": "1576480",
    "end": "1579520"
  },
  {
    "text": "database or is there a cache",
    "start": "1579520",
    "end": "1581120"
  },
  {
    "text": "um we have a cache um that has most of",
    "start": "1581120",
    "end": "1584480"
  },
  {
    "text": "these patent rules",
    "start": "1584480",
    "end": "1585600"
  },
  {
    "text": "uh already uh preloaded",
    "start": "1585600",
    "end": "1589440"
  },
  {
    "text": "is safe odds done by save um",
    "start": "1591440",
    "end": "1596240"
  },
  {
    "text": "i'm not sure uh what that question",
    "start": "1596240",
    "end": "1599520"
  },
  {
    "text": "means um so we had a safe framework",
    "start": "1599520",
    "end": "1602960"
  },
  {
    "text": "that was doing ot and then basically we",
    "start": "1602960",
    "end": "1605520"
  },
  {
    "text": "took a lot of",
    "start": "1605520",
    "end": "1607120"
  },
  {
    "text": "the way that uh authorization was being",
    "start": "1607120",
    "end": "1609360"
  },
  {
    "text": "enforced by that framework and we move",
    "start": "1609360",
    "end": "1611200"
  },
  {
    "text": "that to a service but it's",
    "start": "1611200",
    "end": "1612720"
  },
  {
    "text": "it's essentially your implementation of",
    "start": "1612720",
    "end": "1614799"
  },
  {
    "text": "some of those uh authorization rules",
    "start": "1614799",
    "end": "1617440"
  },
  {
    "text": "um so safe and on voice safe it's",
    "start": "1617440",
    "end": "1620480"
  },
  {
    "text": "it's uh it's a different implementation",
    "start": "1620480",
    "end": "1622400"
  },
  {
    "text": "uh but they",
    "start": "1622400",
    "end": "1623520"
  },
  {
    "text": "use the same concept same permission",
    "start": "1623520",
    "end": "1625279"
  },
  {
    "text": "sets and some of",
    "start": "1625279",
    "end": "1627360"
  },
  {
    "text": "the mapping between these uh permissions",
    "start": "1627360",
    "end": "1630080"
  },
  {
    "text": "that we had for private apis and public",
    "start": "1630080",
    "end": "1631840"
  },
  {
    "text": "apis",
    "start": "1631840",
    "end": "1632640"
  },
  {
    "text": "so there's some like shared um",
    "start": "1632640",
    "end": "1636320"
  },
  {
    "text": "concepts that these two share but the",
    "start": "1636320",
    "end": "1638720"
  },
  {
    "text": "authorization service has its own",
    "start": "1638720",
    "end": "1640240"
  },
  {
    "text": "implementation and does not reuse",
    "start": "1640240",
    "end": "1642000"
  },
  {
    "text": "the existing safe framework",
    "start": "1642000",
    "end": "1654960"
  },
  {
    "text": "uh i think i answered all the questions",
    "start": "1654960",
    "end": "1657520"
  },
  {
    "text": "if i",
    "start": "1657520",
    "end": "1658159"
  },
  {
    "text": "missed any of your questions um feel",
    "start": "1658159",
    "end": "1661200"
  },
  {
    "text": "free to reach out",
    "start": "1661200",
    "end": "1662159"
  },
  {
    "text": "uh or repost it again and",
    "start": "1662159",
    "end": "1665200"
  },
  {
    "text": "i'll try to answer it um i left my email",
    "start": "1665200",
    "end": "1668480"
  },
  {
    "text": "uh and in the slides so feel free to",
    "start": "1668480",
    "end": "1670799"
  },
  {
    "text": "reach out",
    "start": "1670799",
    "end": "1671679"
  },
  {
    "text": "and and happy to chat a little bit more",
    "start": "1671679",
    "end": "1682320"
  },
  {
    "text": "awesome thanks everyone",
    "start": "1682320",
    "end": "1687039"
  }
]