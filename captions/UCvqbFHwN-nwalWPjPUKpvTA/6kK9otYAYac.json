[
  {
    "text": "all right hello everyone um good afternoon my name's Igor vitkovic I'm uh",
    "start": "359",
    "end": "6560"
  },
  {
    "text": "SD for Amazon eks and we're going to be talking about um what you can do with admission web Hooks and admission",
    "start": "6560",
    "end": "13040"
  },
  {
    "text": "controllers and also the dangers of those and I'm joined by my colleague here um my name is Amin I'm also an",
    "start": "13040",
    "end": "19800"
  },
  {
    "text": "engineer at the Amazon eks and uh yeah um before we kick it off",
    "start": "19800",
    "end": "27840"
  },
  {
    "text": "um I would like to ask you a question so by show of hands uh have ever anyone",
    "start": "27840",
    "end": "33200"
  },
  {
    "text": "here like used admission web Works before a little bit uh have you ever broken a cluster or",
    "start": "33200",
    "end": "40840"
  },
  {
    "text": "an application running in your in your U cluster using admission web hooks or admission",
    "start": "40840",
    "end": "46480"
  },
  {
    "text": "controllers nice I already see three or four oh five that's cool you're in the right talk so today we're going to be",
    "start": "46480",
    "end": "52840"
  },
  {
    "text": "talking about exactly those problems and how to mitigate them in today's menu we have a quick",
    "start": "52840",
    "end": "59640"
  },
  {
    "text": "intr prodction to uh mutation and validation web hooks so if you never used them before it's completely fine we're going to talk about them and then",
    "start": "59640",
    "end": "66040"
  },
  {
    "text": "we're going to switch to the dangers um of using the admission controllers and",
    "start": "66040",
    "end": "71080"
  },
  {
    "text": "web hooks uh we will also IG is going to do a demo of uh web Hooks and how to",
    "start": "71080",
    "end": "77119"
  },
  {
    "text": "take down your cluster using um mutating web hooks we're going to also talk about new feature that just landed in cues",
    "start": "77119",
    "end": "84320"
  },
  {
    "text": "1.27 1.28 uh called uh match conditions or the common expression language and",
    "start": "84320",
    "end": "90400"
  },
  {
    "text": "also known as cell and we also going to finish with a demo about how to use cell on Leverage in your cluster to uh for a",
    "start": "90400",
    "end": "97680"
  },
  {
    "text": "better security um of R um so let's State the problem in early",
    "start": "97680",
    "end": "105479"
  },
  {
    "text": "uh 20123 we stopped using kgcr iio and we started recommending to use registry",
    "start": "105479",
    "end": "111399"
  },
  {
    "text": "case. iio for multiple reasons um that the community is very aware of on the bottom you can see them uh tweeting",
    "start": "111399",
    "end": "117680"
  },
  {
    "text": "about this in in 2020 like saying like hey we should uh switch Registries um and uh try to to spread the message",
    "start": "117680",
    "end": "124360"
  },
  {
    "text": "across the community anyways uh the reason why we're talking about this like hey as an administrator I want to",
    "start": "124360",
    "end": "130119"
  },
  {
    "text": "enforce this policy in my cluster I want my uh cluster users to start using the",
    "start": "130119",
    "end": "135319"
  },
  {
    "text": "new registry however there will be always someone who's going to forget about it so let's say actor let's say",
    "start": "135319",
    "end": "142480"
  },
  {
    "text": "Bob or Alice someone who forgot about them twet and they are still writing manifest let's say pods or deployments",
    "start": "142480",
    "end": "149599"
  },
  {
    "text": "and they are still using the old registry let's call it a um they are using kgcr IO and what's",
    "start": "149599",
    "end": "157440"
  },
  {
    "text": "going to happen they're going to apply that to the API server the API server is going to um persist the information at",
    "start": "157440",
    "end": "164879"
  },
  {
    "text": "CD however I want the API server to process the new um DNS or registry uh",
    "start": "164879",
    "end": "172800"
  },
  {
    "text": "address one of the one of the ways we can do that is by using mutating web hooks uh thinking about mutating web",
    "start": "172800",
    "end": "178760"
  },
  {
    "text": "hooks is like an extension to the API server I want the API server to do extra",
    "start": "178760",
    "end": "183840"
  },
  {
    "text": "um action on my manifest or um my the information of my application and I want",
    "start": "183840",
    "end": "189959"
  },
  {
    "text": "for example I want the API server to change from registry a to registry B um",
    "start": "189959",
    "end": "196360"
  },
  {
    "text": "another web hook that is not mentioned here is called the validating uh web hook for example you can enforce or",
    "start": "196360",
    "end": "203200"
  },
  {
    "text": "reject any uh request coming with a with a registry that you don't want to use",
    "start": "203200",
    "end": "208360"
  },
  {
    "text": "for example if um the ACT I forgot about them Suite is using katees GCR IO you",
    "start": "208360",
    "end": "215159"
  },
  {
    "text": "can U reject any Cube color apply or create in the cluster using validation web",
    "start": "215159",
    "end": "222040"
  },
  {
    "text": "hooks let's zoom in into the API server so what's happening behind the scenes is that whenever the request is coming",
    "start": "222519",
    "end": "228799"
  },
  {
    "text": "there's like multiple steps or layers involved before accessing atcd the first",
    "start": "228799",
    "end": "234560"
  },
  {
    "text": "one is authentication and authorization I want to know if you have the right to access the cluster and who you are and",
    "start": "234560",
    "end": "240400"
  },
  {
    "text": "whether you have um the permissions to do a specific action or not in the cluster which is Al also known as",
    "start": "240400",
    "end": "246799"
  },
  {
    "text": "arback the next step is called mutation um admission web hooks so once we know",
    "start": "246799",
    "end": "252159"
  },
  {
    "text": "who you are and that you have the permissions to do a specific action we're going to take that request and send it to a mutation web hook say like",
    "start": "252159",
    "end": "258519"
  },
  {
    "text": "hey do I have for example an old registry that I want to move to to a new registry and uh the web Hook is going to",
    "start": "258519",
    "end": "265400"
  },
  {
    "text": "send a new response and say like hey here's my new object I changed few fields in it go ahead and validate it",
    "start": "265400",
    "end": "271400"
  },
  {
    "text": "the next two steps they are mainly about validation and um the last one of them is going to be the validating admission",
    "start": "271400",
    "end": "277720"
  },
  {
    "text": "web so we want the API server to validate whether um my request is valid or not if all those four steps um are",
    "start": "277720",
    "end": "286000"
  },
  {
    "text": "executed successfully the object is going to be persistent in",
    "start": "286000",
    "end": "291840"
  },
  {
    "text": "SD um here we have two examples on the left you're going to see the validating",
    "start": "292280",
    "end": "297360"
  },
  {
    "text": "web hook configuration and we're going to have uh for example on line four you're going to see the name of the uh",
    "start": "297360",
    "end": "303360"
  },
  {
    "text": "validation web uh configuration you're going to see the rules on line seven I want only to Target the operations that",
    "start": "303360",
    "end": "309880"
  },
  {
    "text": "are like creating pods and the API version V1 I also like I'm giving",
    "start": "309880",
    "end": "315080"
  },
  {
    "text": "information about um the the web hook endpoints for example in line 13 I'm",
    "start": "315080",
    "end": "320440"
  },
  {
    "text": "like hey go call the web hook in the name um uh example service and namespace example",
    "start": "320440",
    "end": "326400"
  },
  {
    "text": "namespace on the right we have a very similar example but this one for mutation um web hook configuration is",
    "start": "326400",
    "end": "333160"
  },
  {
    "text": "not very complete but you can see it's very similar and it allows you to Target specific operations and a specific",
    "start": "333160",
    "end": "338840"
  },
  {
    "text": "workload in your cluster so as we can see there's a lot you can do with admission web hooks um",
    "start": "338840",
    "end": "345840"
  },
  {
    "text": "that was just one example however there's a lot of dangers that come with them and the reason for that is when you",
    "start": "345840",
    "end": "351479"
  },
  {
    "text": "use an admission web hook all the operations that that web hook targets um",
    "start": "351479",
    "end": "356880"
  },
  {
    "text": "are now your API server has a depend depy on your admission controller and that risk can be increased by failing",
    "start": "356880",
    "end": "364240"
  },
  {
    "text": "closed having too broad of scope or too long of a timeout so I'm going to talk about those three cases and what you",
    "start": "364240",
    "end": "370800"
  },
  {
    "text": "should do and should not do so failure policy determines whether you're going to fail closed or fail open it basically",
    "start": "370800",
    "end": "377360"
  },
  {
    "text": "says if there's any issues communicating to your web Hook from the API server uh how it should behave if it fails open",
    "start": "377360",
    "end": "383639"
  },
  {
    "text": "it'll let the request through if it fails closed it'll deny the request um",
    "start": "383639",
    "end": "388880"
  },
  {
    "text": "the default is fail so um what you should do is think through and consciously select a failure policy and",
    "start": "388880",
    "end": "396120"
  },
  {
    "text": "understand the risks and implications of that failure policy um there are valid",
    "start": "396120",
    "end": "401280"
  },
  {
    "text": "use cases for failing closed right say for security reasons I only want certain containers to run on my cluster maybe I",
    "start": "401280",
    "end": "408680"
  },
  {
    "text": "would rather have operations break than run an unsecure container um but don't",
    "start": "408680",
    "end": "413800"
  },
  {
    "text": "just go with the default value and not think about it um too long of time out so the",
    "start": "413800",
    "end": "419440"
  },
  {
    "text": "timeout seconds field defines the timeout when calling your web hook if a timeout occurs um your failure policy",
    "start": "419440",
    "end": "425680"
  },
  {
    "text": "will be invoked the default timeout is 10 seconds and you can use anything between 1 and 30 so do try to use a",
    "start": "425680",
    "end": "432919"
  },
  {
    "text": "short timeout as short as is reasonable um because your web Hook's going to be adding latency to the API server",
    "start": "432919",
    "end": "439520"
  },
  {
    "text": "validating web hooks will all go in parallel so that helps but mutating web hooks are executed one after another so",
    "start": "439520",
    "end": "445240"
  },
  {
    "text": "if you have five and they all have a timeout of 5 Seconds you can add 25 seconds of lat to your requests um and",
    "start": "445240",
    "end": "451800"
  },
  {
    "text": "that can be really detrimental to clusters especially at Large Scale um I've seen clusters with thousands of",
    "start": "451800",
    "end": "457919"
  },
  {
    "text": "PODS where GC isn't garbage collection isn't able to clean up the pods for",
    "start": "457919",
    "end": "463759"
  },
  {
    "text": "hours and that's because there were several web hooks with 10-second timeouts taking 10 seconds so every time",
    "start": "463759",
    "end": "470400"
  },
  {
    "text": "API server is trying to do GC and clean up pods because they're supposed to be scaled down um it it's taking hours it",
    "start": "470400",
    "end": "477080"
  },
  {
    "text": "can't it can't keep up because of that latency so one thing you definitely should not do is if you start seeing",
    "start": "477080",
    "end": "483599"
  },
  {
    "text": "like some timeouts try to just use a really long timeout um you should try to like root cause why your admission",
    "start": "483599",
    "end": "489479"
  },
  {
    "text": "controller is taking so long um and don't just try to extend the time out to get around",
    "start": "489479",
    "end": "495759"
  },
  {
    "text": "it and then to Broad of scope all of these risks are only only impact um what",
    "start": "495759",
    "end": "503479"
  },
  {
    "text": "you target with your rules so here's an example of two broad of scope right we have all wild cards this is going to",
    "start": "503479",
    "end": "509360"
  },
  {
    "text": "Target all mutating operations on the cluster this these rules are the blast radius of your web hook so do set the",
    "start": "509360",
    "end": "517959"
  },
  {
    "text": "scope as tight as possible and do it in the validation web hook layer suppose I",
    "start": "517959",
    "end": "523240"
  },
  {
    "text": "want to only target config maps for example I should not use wild cards and then in my application logic of the",
    "start": "523240",
    "end": "529959"
  },
  {
    "text": "admission controller say okay if it's not a config map just let it through otherwise do the validation make sure",
    "start": "529959",
    "end": "536040"
  },
  {
    "text": "all of this is in the web hook layer so now we're going to do a demo",
    "start": "536040",
    "end": "541320"
  },
  {
    "text": "and we'll do a live demo cuz that's a bit more fun of breaking a cluster using",
    "start": "541320",
    "end": "546680"
  },
  {
    "text": "web hooks so I just have a local kind cluster um running here have some",
    "start": "546680",
    "end": "552240"
  },
  {
    "text": "components in Cube system and um I'm just going to create a",
    "start": "552240",
    "end": "559320"
  },
  {
    "text": "deployment and this deployment has a service very very simple straight from",
    "start": "559320",
    "end": "567279"
  },
  {
    "text": "you know the basic kubernetes example of a deployment and it has three",
    "start": "567279",
    "end": "572680"
  },
  {
    "text": "replicas and we can go and look at our end points to make sure the service is working properly everything's good so",
    "start": "572680",
    "end": "580680"
  },
  {
    "text": "now what I'm going to do is I'm going to create a web hook and I'm going to simulate a",
    "start": "580680",
    "end": "586560"
  },
  {
    "text": "failure and do some bad things I'm going to Target everything um I'm not going to set the failure policy so it's going to",
    "start": "586560",
    "end": "591720"
  },
  {
    "text": "be fail and there is no example service at example namespace so I'm simulating a",
    "start": "591720",
    "end": "597120"
  },
  {
    "text": "failure um as if the admission controller was down so I'm going to",
    "start": "597120",
    "end": "602519"
  },
  {
    "text": "apply",
    "start": "602519",
    "end": "604959"
  },
  {
    "text": "this and now if I go and I try to create deployment two which is the same thing",
    "start": "608000",
    "end": "614480"
  },
  {
    "text": "just with to",
    "start": "614480",
    "end": "617480"
  },
  {
    "text": "appended Oops I did not apply the blocking web hook",
    "start": "620680",
    "end": "626000"
  },
  {
    "text": "first",
    "start": "628040",
    "end": "631040"
  },
  {
    "text": "that's for the next step okay now when I go and try to apply deployment 2 it all gets blocked this is",
    "start": "633640",
    "end": "641160"
  },
  {
    "text": "this is pretty easy to troubleshoot though this is pretty benign I guess you can't create things but um what's",
    "start": "641160",
    "end": "647519"
  },
  {
    "text": "happening here is you get the error message right away this will probably be happening in like a cicd pipeline or",
    "start": "647519",
    "end": "654079"
  },
  {
    "text": "Argo CD or something like that but if you go into the logs you'll see this and you'll know exactly what's wrong so now",
    "start": "654079",
    "end": "661120"
  },
  {
    "text": "suppose that I want to make sure that only our platform teams containers are running in Cube system so I'm going to",
    "start": "661120",
    "end": "667360"
  },
  {
    "text": "create a web hook that targets Cube system and I'm just going to do that by changing this web",
    "start": "667360",
    "end": "674800"
  },
  {
    "text": "hook okay so now that I created that web hook um now it's only targeting Cube",
    "start": "679240",
    "end": "684959"
  },
  {
    "text": "system and now my deployment should go through",
    "start": "684959",
    "end": "690959"
  },
  {
    "text": "um and there we go it did go through so I should have some pods but I don't have",
    "start": "692000",
    "end": "697079"
  },
  {
    "text": "any pods okay so something is wrong here let's go look at the",
    "start": "697079",
    "end": "702760"
  },
  {
    "text": "deployment there's deployment 2 and we have zero pods all right let's describe it let's look at the events and see",
    "start": "703440",
    "end": "709800"
  },
  {
    "text": "what's wrong okay there's no events all right this is kind of interesting to",
    "start": "709800",
    "end": "716200"
  },
  {
    "text": "troubleshoot now okay let's see if there's a replica set at least only for",
    "start": "716200",
    "end": "722040"
  },
  {
    "text": "deployment one and we have no pods interesting now I'm just going to try to create a pod directly maybe maybe",
    "start": "722040",
    "end": "728720"
  },
  {
    "text": "that'll",
    "start": "728720",
    "end": "731040"
  },
  {
    "text": "work okay the Pod went through but it's not scheduling anywhere the Pod is stuck",
    "start": "735600",
    "end": "742279"
  },
  {
    "text": "in pending okay so I can't even launch pods maybe I just need a new node let's",
    "start": "742279",
    "end": "747480"
  },
  {
    "text": "describe the Pod and see what it's unhappy",
    "start": "747480",
    "end": "751800"
  },
  {
    "text": "about and also no events okay great um not really sure what's going on there so",
    "start": "754720",
    "end": "760639"
  },
  {
    "text": "now I'm going to um now I'm going to try deleting the",
    "start": "760639",
    "end": "766320"
  },
  {
    "text": "deployment let's just start over",
    "start": "766320",
    "end": "769760"
  },
  {
    "text": "right all right we cleared out the deployment okay and all my pods are",
    "start": "772639",
    "end": "779000"
  },
  {
    "text": "still there this cluster just is not working at all um maybe I try to manually delete a pod let's see if that",
    "start": "779000",
    "end": "786800"
  },
  {
    "text": "works okay at least that worked so hopefully now that should be taken out of service so it's not still serving",
    "start": "786800",
    "end": "793360"
  },
  {
    "text": "traffic now that it's no longer",
    "start": "793360",
    "end": "796600"
  },
  {
    "text": "there okay um I should have uh deleted the",
    "start": "802639",
    "end": "812120"
  },
  {
    "text": "deployment all right um yeah so I can't create pods I can't create deployments",
    "start": "814560",
    "end": "820959"
  },
  {
    "text": "this this cluster is just hosed um and let's look at",
    "start": "820959",
    "end": "826519"
  },
  {
    "text": "why so if we look at Cube system we're going to see that the Schuler and the controller",
    "start": "835560",
    "end": "842680"
  },
  {
    "text": "manager both have a restart so something interesting happened there so let's go",
    "start": "842680",
    "end": "847800"
  },
  {
    "text": "and uh peek into them and see what happened I'm going to look at the previous logs to see why it crashed and",
    "start": "847800",
    "end": "853519"
  },
  {
    "text": "restarted um okay so leader election lost and shutting down so it looks like",
    "start": "853519",
    "end": "859680"
  },
  {
    "text": "it lost its leader election and now let's look at the current pod to see what's",
    "start": "859680",
    "end": "865800"
  },
  {
    "text": "happening",
    "start": "867680",
    "end": "870680"
  },
  {
    "text": "okay failing to update the lock so what happened is this web hook ended up blocking the leases and these components",
    "start": "873120",
    "end": "879880"
  },
  {
    "text": "crashed because they couldn't renew their lease and they could never grab it so now they're just sitting in standby mode trying to get a lease doing nothing",
    "start": "879880",
    "end": "887320"
  },
  {
    "text": "um as you can see this cluster is completely hosed I you can't really do anything with it um and those are some",
    "start": "887320",
    "end": "895440"
  },
  {
    "text": "of the risks you run with admission web hooks um there's a lot of other things that can happen too like for example if",
    "start": "895440",
    "end": "901839"
  },
  {
    "text": "you're blocking leases in Cube node lease you'll start to see your nodes going not ready um there can be issues",
    "start": "901839",
    "end": "909720"
  },
  {
    "text": "with API server startup if you're blocking flow schemas or Ro bindings API",
    "start": "909720",
    "end": "915000"
  },
  {
    "text": "Services um so those are some of the dangers now um part of the problem is if",
    "start": "915000",
    "end": "922079"
  },
  {
    "text": "you look at this web hook the rules are targeting everything but there's no negative selection so there's no way for",
    "start": "922079",
    "end": "928199"
  },
  {
    "text": "me to I want to Target everything except for leases until um some of these new features that we're going to talk about",
    "start": "928199",
    "end": "936800"
  },
  {
    "text": "next thank you eigor so now that we've seen examples on how to break your",
    "start": "946920",
    "end": "952639"
  },
  {
    "text": "cluster or your application overall using mutating web hooks we're going to jump ships and talk about completely",
    "start": "952639",
    "end": "958120"
  },
  {
    "text": "different topics uh there is what we call cell or common expression language um it's a it's a",
    "start": "958120",
    "end": "963560"
  },
  {
    "text": "language it's a new language created in the early 2020s by Google however it's not a programming language it is a",
    "start": "963560",
    "end": "969959"
  },
  {
    "text": "scripting language um is it quite as fast I was very impressed about how fast and very like close the to the",
    "start": "969959",
    "end": "976480"
  },
  {
    "text": "performance of just pure go uh it is very very easy to write and to understand um it's a little bit like",
    "start": "976480",
    "end": "983399"
  },
  {
    "text": "python or JavaScript overall is also easy to easy to extend and to embed let's say like you want to bring some",
    "start": "983399",
    "end": "989319"
  },
  {
    "text": "functions to this uh language or to embedded in JavaScript or Java it is it is pretty easy to do uh if I'm not",
    "start": "989319",
    "end": "996079"
  },
  {
    "text": "mistaken there is only one implementation it is Ino um but there is um no different implementation but",
    "start": "996079",
    "end": "1002920"
  },
  {
    "text": "correct me after I'm wrong I've never seen any um if you want to play with this language there is what we call the",
    "start": "1002920",
    "end": "1008720"
  },
  {
    "text": "cell playground uh it's a website created created by mat I don't know if he's here or not but um shout out to",
    "start": "1008720",
    "end": "1014800"
  },
  {
    "text": "that very cool tool and uh yeah without any more talk we're going to show you how it looks",
    "start": "1014800",
    "end": "1020040"
  },
  {
    "text": "like uh let's say I want to validate this yaml objects uh I want to say let's say I have this event um name cubec Con",
    "start": "1020040",
    "end": "1027240"
  },
  {
    "text": "location Chicago and I have a list of of snds um whether they have a coffee or have a funny hat um it's a bullan true",
    "start": "1027240",
    "end": "1033319"
  },
  {
    "text": "or false what I can do using cell is write an expression like this for example in",
    "start": "1033319",
    "end": "1039558"
  },
  {
    "text": "line one I can say like hey I want to validate that the even do name is cucon and that the event location is Chicago",
    "start": "1039559",
    "end": "1046558"
  },
  {
    "text": "and then I can Target for example the first element of mys list and say like hey do they have a do they have a coffee",
    "start": "1046559",
    "end": "1053000"
  },
  {
    "text": "and do they have a funny hat it is pretty simple it looks like python or JavaScript basically but it's not a",
    "start": "1053000",
    "end": "1058480"
  },
  {
    "text": "programming language it is only an expression language it means like you can only validate data with it and this",
    "start": "1058480",
    "end": "1064000"
  },
  {
    "text": "is where it comes um becomes very fun because we can use this kind of stuff in in um in web hooks if you want to learn",
    "start": "1064000",
    "end": "1070760"
  },
  {
    "text": "more about cell because we're going to stop here and start talking about web hooks again um please watch joob bit",
    "start": "1070760",
    "end": "1076320"
  },
  {
    "text": "talk U last year or the year before about web hook fatigue introducing cell into um the expression language features",
    "start": "1076320",
    "end": "1084520"
  },
  {
    "text": "and yeah I really recommend that yeah so um now we're going to talk",
    "start": "1084520",
    "end": "1090039"
  },
  {
    "text": "about how we can use cell and some new features that are coming out in kubernetes that we worked on with the",
    "start": "1090039",
    "end": "1095480"
  },
  {
    "text": "community to help make uh admission web hooks more usable and safer so there's",
    "start": "1095480",
    "end": "1101280"
  },
  {
    "text": "validating admission policies that are new beta API as of 128 and these are",
    "start": "1101280",
    "end": "1106440"
  },
  {
    "text": "cell-based policies so um rather than API server needing to",
    "start": "1106440",
    "end": "1111720"
  },
  {
    "text": "call out to a web hook um it can just use cell to do validations itself um and",
    "start": "1111720",
    "end": "1117919"
  },
  {
    "text": "their beta in 129 and we have mutating admission policies is planned for the",
    "start": "1117919",
    "end": "1123159"
  },
  {
    "text": "future um match conditions are a new beta feature as of 128 and they allow",
    "start": "1123159",
    "end": "1128280"
  },
  {
    "text": "for flexible selection of um your rules and the scope of your web hook you can",
    "start": "1128280",
    "end": "1133480"
  },
  {
    "text": "now with cell Define what your web hooks should and should not be targeting um",
    "start": "1133480",
    "end": "1138720"
  },
  {
    "text": "and these are beta feature and they're going to be on validating admission policies and um they're going to be on",
    "start": "1138720",
    "end": "1145520"
  },
  {
    "text": "admission policies and admission web Hooks and they're um beta but they're on",
    "start": "1145520",
    "end": "1150919"
  },
  {
    "text": "by on by default so you can start using those right now as of 128 um here's an example of a validating",
    "start": "1150919",
    "end": "1158400"
  },
  {
    "text": "admission policy it has a lot of similar Fields it looks a lot like a validating admission web hook that's by Design um",
    "start": "1158400",
    "end": "1166120"
  },
  {
    "text": "one of the things that you're going to see is different though is the validations instead of telling it a",
    "start": "1166120",
    "end": "1171679"
  },
  {
    "text": "service to call out to right and there I have a simple cell expression that says for deployments um I want all my",
    "start": "1171679",
    "end": "1178640"
  },
  {
    "text": "replicas to be less than or equal to five and then you use a policy binding",
    "start": "1178640",
    "end": "1183960"
  },
  {
    "text": "to apply that to in this example a certain name space and tell it to do a deny on failure um this allows your API",
    "start": "1183960",
    "end": "1192400"
  },
  {
    "text": "server to not take an external dependency and it's an inprocess alternative right so the benefits here",
    "start": "1192400",
    "end": "1198080"
  },
  {
    "text": "are less latency like we said sell is really fast and it doesn't have to make an external network call um there's no",
    "start": "1198080",
    "end": "1204679"
  },
  {
    "text": "external dependency there's a lot less overhead in setting this up as well um if you were to make a validating",
    "start": "1204679",
    "end": "1210720"
  },
  {
    "text": "validating admission web hook you would need to write some code containerize that code deploy a pod the code would",
    "start": "1210720",
    "end": "1216840"
  },
  {
    "text": "have to do TLS HTTP request handling a bunch of serialization and DC",
    "start": "1216840",
    "end": "1222840"
  },
  {
    "text": "realization just to do the simple um replicas less than or equal to five right",
    "start": "1222840",
    "end": "1229320"
  },
  {
    "text": "um and the other thing is you get immediate feedback if you do use a validated admission policy and you do something that breaks your cluster it'll",
    "start": "1229320",
    "end": "1235840"
  },
  {
    "text": "break it immediately and consistently whereas if you have a validated admission web hook it may it may be",
    "start": "1235840",
    "end": "1242880"
  },
  {
    "text": "running good for a year and you might be fine and then all of a sudden there's a bug in your controller and everything's",
    "start": "1242880",
    "end": "1250440"
  },
  {
    "text": "down um match conditions are the other example we talked about so this is where you can use fine grain conditions with",
    "start": "1250559",
    "end": "1257200"
  },
  {
    "text": "cell to to find the scope um these are only for negative selection and you can",
    "start": "1257200",
    "end": "1262240"
  },
  {
    "text": "have a list of them and they're it's an and operation so if one is false then",
    "start": "1262240",
    "end": "1267559"
  },
  {
    "text": "your web hook will not be called and invoked so now we're going to go back to",
    "start": "1267559",
    "end": "1273400"
  },
  {
    "text": "our broken cluster and fix it with the new cell",
    "start": "1273400",
    "end": "1278039"
  },
  {
    "text": "features so if we go back to our pods um that are not",
    "start": "1281120",
    "end": "1286720"
  },
  {
    "text": "running um yeah so there's",
    "start": "1286720",
    "end": "1293200"
  },
  {
    "text": "the um there's the deployment that should be gone the pod that's not scheduled and the deployment that is",
    "start": "1296919",
    "end": "1304559"
  },
  {
    "text": "not um available right so we're going to go back to our",
    "start": "1304559",
    "end": "1310600"
  },
  {
    "text": "web hook and we're going to take the same web hook and just apply",
    "start": "1310600",
    "end": "1316840"
  },
  {
    "text": "this match condition and this match condition is going to say if it's coordination K.O and the resources",
    "start": "1316840",
    "end": "1323799"
  },
  {
    "text": "leases we're going to ignore it with this knot so now if we apply this our cluster",
    "start": "1323799",
    "end": "1331799"
  },
  {
    "text": "should be back to a good",
    "start": "1331799",
    "end": "1336320"
  },
  {
    "text": "State and our pod is now scheduled um the scheduler comes back a little bit",
    "start": "1342240",
    "end": "1347679"
  },
  {
    "text": "quicker and we should see a cleanup of our deployment and our new deployment coming",
    "start": "1347679",
    "end": "1354200"
  },
  {
    "text": "in um and you can see that everything's",
    "start": "1354200",
    "end": "1360600"
  },
  {
    "text": "working the end points on this deployment have have their IPs now the",
    "start": "1360600",
    "end": "1366520"
  },
  {
    "text": "old ones are gone we're we're in a good State um okay so that's great we were",
    "start": "1366520",
    "end": "1373559"
  },
  {
    "text": "able to protect against we were able to make one one web hook safe right now I'm",
    "start": "1373559",
    "end": "1379679"
  },
  {
    "text": "going to transition do a quick demo of validated validating admission policies and then I'm going to wrap it all",
    "start": "1379679",
    "end": "1385880"
  },
  {
    "text": "together so here's a very simple validating admission policy um very",
    "start": "1385880",
    "end": "1391120"
  },
  {
    "text": "similar to our our example but we're going to say it has to have greater than five replicas um and we're going to start by",
    "start": "1391120",
    "end": "1397240"
  },
  {
    "text": "just showing the way um deny works so if we go and we apply",
    "start": "1397240",
    "end": "1405679"
  },
  {
    "text": "this um and we go and we try to apply the",
    "start": "1406880",
    "end": "1415640"
  },
  {
    "text": "deployment it'll say hey this isn't allowed and it'll give you the expression that is failing right um",
    "start": "1416480",
    "end": "1424159"
  },
  {
    "text": "there's a lot of other interesting uses here so for example you can do a Warn and audit so say I don't want to",
    "start": "1424159",
    "end": "1431840"
  },
  {
    "text": "actually block all the operations but I want to tell the user hey you shouldn't be doing this and I want my my cluster",
    "start": "1431840",
    "end": "1438400"
  },
  {
    "text": "admins to have an audit of everywhere this is being done um that's also supported so you can now update",
    "start": "1438400",
    "end": "1446200"
  },
  {
    "text": "this and now when I try to create the",
    "start": "1446200",
    "end": "1450600"
  },
  {
    "text": "deployment it'll go through but I'll get a warning and there will be an audit log",
    "start": "1451320",
    "end": "1456520"
  },
  {
    "text": "that we can go back and look at and see that hey this is failing validation and it's still being created maybe then you",
    "start": "1456520",
    "end": "1462679"
  },
  {
    "text": "go reach out to your application team or something and talk to them about why they're",
    "start": "1462679",
    "end": "1468360"
  },
  {
    "text": "uh doing something against the policy now that's all fine but my cluster still",
    "start": "1468360",
    "end": "1475640"
  },
  {
    "text": "isn't safe right I protected against one web hook um now how can I protect against all web",
    "start": "1475640",
    "end": "1482000"
  },
  {
    "text": "hooks well we can do that with validating admission policies so here I have um a more useful validating",
    "start": "1482000",
    "end": "1489440"
  },
  {
    "text": "admission policy maybe and it's going to Target admission registration and it's going to look at validating web hook",
    "start": "1489440",
    "end": "1495960"
  },
  {
    "text": "configurations and mutating web hook configurations um and another feature is",
    "start": "1495960",
    "end": "1501760"
  },
  {
    "text": "you can have this special message right so with this message um this this is",
    "start": "1501760",
    "end": "1507720"
  },
  {
    "text": "I'll walk you through this expression but this is a lot if you got a warning with that giant expression it may not be",
    "start": "1507720",
    "end": "1514960"
  },
  {
    "text": "clear to users on your cluster so you can have a special message and you can maybe link that to some documentation",
    "start": "1514960",
    "end": "1521279"
  },
  {
    "text": "that explains why and what um and then we're going to have this cell expression",
    "start": "1521279",
    "end": "1526320"
  },
  {
    "text": "and this one's a bit more complicated so I'll walk us through it um first we're going to say object. web hooks. all so",
    "start": "1526320",
    "end": "1533159"
  },
  {
    "text": "that's an iteration um operation in cell and as you can see the web hook",
    "start": "1533159",
    "end": "1538440"
  },
  {
    "text": "configuration you can Define multiple web hooks so we want to make sure for all of those web hooks that all of them",
    "start": "1538440",
    "end": "1544120"
  },
  {
    "text": "are safe so what this is going to do is it's going to say for all web hooks um",
    "start": "1544120",
    "end": "1549880"
  },
  {
    "text": "and then this is the iterator like if you say like four item and items or forx and items I'm calling it web hook",
    "start": "1549880",
    "end": "1556159"
  },
  {
    "text": "because that makes sense but um for all web hooks every single item in that list it has to have match",
    "start": "1556159",
    "end": "1563200"
  },
  {
    "text": "conditions and then for those match conditions we want to Loop through those as well and make sure that there's at",
    "start": "1563200",
    "end": "1569760"
  },
  {
    "text": "least one um so for all web hooks we want one match condition that has this",
    "start": "1569760",
    "end": "1576000"
  },
  {
    "text": "expression to block leases um and then we're going to run a deny there so if I go and apply",
    "start": "1576000",
    "end": "1585840"
  },
  {
    "text": "that",
    "start": "1586600",
    "end": "1589600"
  },
  {
    "text": "and we go to this web hook now if I take off the match",
    "start": "1591640",
    "end": "1598640"
  },
  {
    "text": "conditions I get a denial and I get a useful message um and then if I add",
    "start": "1606399",
    "end": "1612799"
  },
  {
    "text": "these match conditions back on it goes through so now suppose I want",
    "start": "1612799",
    "end": "1621480"
  },
  {
    "text": "I want my uh teams using this cluster I'm a cluster admin I want them to be able to use um web hooks but I want to",
    "start": "1621480",
    "end": "1628760"
  },
  {
    "text": "make sure they're safe and they can't take down my components now we have a mechanism for doing that",
    "start": "1628760",
    "end": "1635360"
  },
  {
    "text": "um admission policies are able to Target admission web hooks right admission web",
    "start": "1635360",
    "end": "1640840"
  },
  {
    "text": "hooks cannot Target other admission web hooks because then you can get into a state where you're locked out of your cluster um so that's that's blocked but",
    "start": "1640840",
    "end": "1648799"
  },
  {
    "text": "admission policies can Target admission web hooks however they cannot Target other admission policies but due to the",
    "start": "1648799",
    "end": "1655880"
  },
  {
    "text": "reasons we talked about this is still a much better State because admission policies are much safer it's not an",
    "start": "1655880",
    "end": "1661399"
  },
  {
    "text": "external dependency you get immediate feedback if it works today it's going to work tomorrow um",
    "start": "1661399",
    "end": "1668559"
  },
  {
    "text": "so yeah that that shows how we were able to safeguard this",
    "start": "1668559",
    "end": "1674240"
  },
  {
    "text": "cluster",
    "start": "1676519",
    "end": "1679519"
  },
  {
    "text": "thank you eigor uh that's pretty cool to see live the the demo gods are happy today so can't really complain um so now",
    "start": "1689760",
    "end": "1698919"
  },
  {
    "text": "that eor showed you how to use match conditions uh if you remark like observ",
    "start": "1698919",
    "end": "1704159"
  },
  {
    "text": "at some point he's using request do something um like hey what are the objects you can use cuz on the run time",
    "start": "1704159",
    "end": "1709960"
  },
  {
    "text": "of the API server you have few fields that you can access it's not always request this is got from the kubernetes",
    "start": "1709960",
    "end": "1717000"
  },
  {
    "text": "documentation and what a better place than kubernetes documentation to read about few things and here you have um",
    "start": "1717000",
    "end": "1722720"
  },
  {
    "text": "for example object old objects if you make an update operation you always have access to the new and the old one um you",
    "start": "1722720",
    "end": "1730279"
  },
  {
    "text": "can have access to the request the authorizer and the authorizer request um resource for example if you want access",
    "start": "1730279",
    "end": "1736960"
  },
  {
    "text": "um who who is the user that is making this request is the cube system is a cube you can have you can find those",
    "start": "1736960",
    "end": "1742640"
  },
  {
    "text": "information informations for example in in the authorizer anyways there's also",
    "start": "1742640",
    "end": "1748200"
  },
  {
    "text": "discussions about adding namespace I know you can find namespace in objects if you do object. metadata that",
    "start": "1748200",
    "end": "1753720"
  },
  {
    "text": "namespace you can find what is the name of the namespace but there's also some work happening in Upstream right now",
    "start": "1753720",
    "end": "1759000"
  },
  {
    "text": "trying to bring the namespace objects as a full thing for example I want to see the annotations of the namespace and",
    "start": "1759000",
    "end": "1765279"
  },
  {
    "text": "those few things that you might be able to access in 1.30 but I'm not sure it's going to make it to ABS or not there's a",
    "start": "1765279",
    "end": "1770679"
  },
  {
    "text": "lot of conversation about whether we should do it or not um but yeah maybe next year we're going to talk about",
    "start": "1770679",
    "end": "1776440"
  },
  {
    "text": "this um so for example you can see here the third element what did they",
    "start": "1776440",
    "end": "1784159"
  },
  {
    "text": "do the third element here was a request um if you want to know what what is really inside the request this is CAU",
    "start": "1787559",
    "end": "1793799"
  },
  {
    "text": "straight from uh cuberes Upstream admission V1 types .g go you can see all the fields you can access in the request",
    "start": "1793799",
    "end": "1801240"
  },
  {
    "text": "um eigor was using I think user and um the the the name of the object no the",
    "start": "1801240",
    "end": "1806399"
  },
  {
    "text": "kind sorry it was like the kind um to for example to Target the leases but those are all the objects you can access",
    "start": "1806399",
    "end": "1812320"
  },
  {
    "text": "from the admission request yeah so uh in conclusion",
    "start": "1812320",
    "end": "1819480"
  },
  {
    "text": "admission web hooks are super powerful we've had them for a long time but they also come with a set of dangers um but",
    "start": "1819480",
    "end": "1826600"
  },
  {
    "text": "now we have new cell features that make it easier to apply policies onto your cluster in a safer way and please if you",
    "start": "1826600",
    "end": "1834960"
  },
  {
    "text": "haven't uh go out try these features um you'll need to enable the beta apis for",
    "start": "1834960",
    "end": "1840240"
  },
  {
    "text": "validating admission policy but you can use the match conditions today on 128 plus clusters",
    "start": "1840240",
    "end": "1847640"
  },
  {
    "text": "um on admission web Hooks and please go try them out and provide feedback are there new features you want access to",
    "start": "1847640",
    "end": "1854440"
  },
  {
    "text": "different fields any issues you run into uh provide feedback so we can make it a",
    "start": "1854440",
    "end": "1859639"
  },
  {
    "text": "better experience and get these new features to ga",
    "start": "1859639",
    "end": "1865279"
  },
  {
    "text": "uh thank",
    "start": "1865279",
    "end": "1868480"
  },
  {
    "text": "you thank you all if you have any questions there are microphones there and there um if any any has",
    "start": "1872200",
    "end": "1879840"
  },
  {
    "text": "some go once",
    "start": "1883120",
    "end": "1888320"
  },
  {
    "text": "so if I do break my cluster because I have web hooks that don't let me do anything how do I Unbreak it yeah so um",
    "start": "1888320",
    "end": "1896360"
  },
  {
    "text": "you you just delete the web hook so uh I I touched on that a little bit but there",
    "start": "1896360",
    "end": "1902399"
  },
  {
    "text": "is um you're not able to Target other web hooks with a web hook in order to",
    "start": "1902399",
    "end": "1908080"
  },
  {
    "text": "avoid fully locking yourself out so you can either delete the web hook or I guess depending on what the web",
    "start": "1908080",
    "end": "1915559"
  },
  {
    "text": "Hook is blocking fix the admission controller um but if I was in a situation with a broken cluster I would",
    "start": "1915559",
    "end": "1921760"
  },
  {
    "text": "just nuke the web",
    "start": "1921760",
    "end": "1924480"
  },
  {
    "text": "hook any potential performance problems yeah so we've built in um some",
    "start": "1933480",
    "end": "1940360"
  },
  {
    "text": "monitoring um so you can tell how long these expressions are taking to evaluate um there are there is a potential",
    "start": "1940360",
    "end": "1946480"
  },
  {
    "text": "because as you saw we could do loops so you could like Loop and loop and loop and loop and cause issues that way um",
    "start": "1946480",
    "end": "1953600"
  },
  {
    "text": "there is a cut off in how much processing time an entire web Hook is",
    "start": "1953600",
    "end": "1959320"
  },
  {
    "text": "allowed to use and each match condition and how much compile time it's allowed to do so it actually compiles when it's",
    "start": "1959320",
    "end": "1965679"
  },
  {
    "text": "created and then there's compilation and evaluation with cell so there's there's limits on all of those and if you hit",
    "start": "1965679",
    "end": "1972919"
  },
  {
    "text": "the limit then the failure policy will be invoked um similar to like if you",
    "start": "1972919",
    "end": "1978399"
  },
  {
    "text": "can't talk to an admission controller I can add to that um we've",
    "start": "1978399",
    "end": "1983720"
  },
  {
    "text": "done some benchmarks regarding kerno cell Rego and pure go code and we were",
    "start": "1983720",
    "end": "1989000"
  },
  {
    "text": "like fascinated of how cell is very close to go performance it's it's very very fast it's so far from keno and",
    "start": "1989000",
    "end": "1995960"
  },
  {
    "text": "reggo so if you're worried about the performance of cell itself on like dealing with very very U uh huge objects",
    "start": "1995960",
    "end": "2002840"
  },
  {
    "text": "it's not it's not going to be really a problem it's really as close as to to Pure go code or compiled go",
    "start": "2002840",
    "end": "2010638"
  },
  {
    "text": "binaries um you said we shouldn't use wild cards but I kind of have to because",
    "start": "2015039",
    "end": "2020080"
  },
  {
    "text": "I have 600 name spaces and I don't know how to include 599 of them and there's",
    "start": "2020080",
    "end": "2025799"
  },
  {
    "text": "no negative yes I can't say star minus Cube",
    "start": "2025799",
    "end": "2032240"
  },
  {
    "text": "system right so so this is the tool that would allow us to do that yes exactly",
    "start": "2032240",
    "end": "2038679"
  },
  {
    "text": "okay yeah so you could use the match conditions and say if namespace is not Cube system then you're good bypass the",
    "start": "2038679",
    "end": "2046600"
  },
  {
    "text": "web hook thank you yeah you can basically access any field in your",
    "start": "2046600",
    "end": "2051638"
  },
  {
    "text": "object so name space annotations uh conditions as well if you want to really Target only I don't know",
    "start": "2051639",
    "end": "2058800"
  },
  {
    "text": "SPS with specific conditions and like specific uh messages in those conditions it is possible to",
    "start": "2058800",
    "end": "2065520"
  },
  {
    "text": "do any more",
    "start": "2065879",
    "end": "2072319"
  },
  {
    "text": "questions go in once going",
    "start": "2072839",
    "end": "2078398"
  },
  {
    "text": "twice and thank you so much for joining today I really appreciate it",
    "start": "2078399",
    "end": "2084280"
  },
  {
    "text": "vle",
    "start": "2085520",
    "end": "2088520"
  }
]