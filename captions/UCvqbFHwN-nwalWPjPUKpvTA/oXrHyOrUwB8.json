[
  {
    "text": "hi everyone uh he's Chris Crow I'm stepen Atwell we're here to talk about uh database devops and the benefits of",
    "start": "280",
    "end": "7359"
  },
  {
    "text": "leveraging uh continuous delivery for stateful applications yeah and I'm uh Chris Crow with uh with portworks and",
    "start": "7359",
    "end": "13880"
  },
  {
    "text": "Stephen and I have been working on a few different different talks just about integrating various data tests inside of",
    "start": "13880",
    "end": "20039"
  },
  {
    "text": "delivery pipelines uh using various tools and and all sorts of things it's kind of been a fun talk we uh gosh",
    "start": "20039",
    "end": "27400"
  },
  {
    "text": "started this a couple of years ago we were at on kubernetes Day last year but this um I guess project started a little",
    "start": "27400",
    "end": "34320"
  },
  {
    "text": "a little before that based on uh one of your previous employers and a particular problem that they had that I never quite",
    "start": "34320",
    "end": "40000"
  },
  {
    "text": "explained right for however many times we've done this yeah so at a past employer of mine um we were building a a",
    "start": "40000",
    "end": "46559"
  },
  {
    "text": "bi solution with a custom reporting layer and a custom database and very very very configurable",
    "start": "46559",
    "end": "54559"
  },
  {
    "text": "and the most important bugs in that product were also the hardest to find",
    "start": "54559",
    "end": "59760"
  },
  {
    "text": "and the only reliable way we ever found to find them uh basically amounted to copying down every customer's",
    "start": "59760",
    "end": "65720"
  },
  {
    "text": "configuration standing it up on the old version of the new version comparing the numbers and you know when I was there we",
    "start": "65720",
    "end": "72159"
  },
  {
    "text": "we we spent several years at one point going and getting that all automated and when Chris and I started talking uh he",
    "start": "72159",
    "end": "78040"
  },
  {
    "text": "he showed me how easy it is with kubernetes suddenly to go and automate the pieces of that that were the hardest",
    "start": "78040",
    "end": "84119"
  },
  {
    "text": "um and right after I I told him the story like two days later we had a meeting and he showed up with a working",
    "start": "84119",
    "end": "89200"
  },
  {
    "text": "version um and we've talking been talking about that and and variance of it ever since so I had more time on my",
    "start": "89200",
    "end": "95799"
  },
  {
    "text": "hands back then now I have a nine-month old at home so that's a whole yeah different different level of um yeah",
    "start": "95799",
    "end": "101280"
  },
  {
    "text": "time to be able to play with technology hence why uh Steven is running the the laptop this particular particular time",
    "start": "101280",
    "end": "106320"
  },
  {
    "text": "but yeah that's the thing I find the most interesting or one of the most fun things for me about kubernetes is being",
    "start": "106320",
    "end": "112079"
  },
  {
    "text": "able to have my entire app packaged on there and have it be uh have a lot of tools to actually make that portable and",
    "start": "112079",
    "end": "118719"
  },
  {
    "text": "it occurs to me if I'm going to look at any of the slides I have to look over your shoulder here CU this is going to get awkward so uh somebody dial 91 and",
    "start": "118719",
    "end": "125719"
  },
  {
    "text": "then uh if I fall down dial one again yeah so Chris and I like interacting",
    "start": "125719",
    "end": "130800"
  },
  {
    "text": "with the audience so let's do a quick poll who here likes barbecue put up your hand if you like barbecue okay we got we",
    "start": "130800",
    "end": "136879"
  },
  {
    "text": "got a few cool so so Chris and I on on the side have a hypothetical restaurant",
    "start": "136879",
    "end": "142280"
  },
  {
    "text": "chain that runs off uh some open source uh software and we're going to be using",
    "start": "142280",
    "end": "148200"
  },
  {
    "text": "uh some of the management software for our our restaurant uh as we talk through today so our our application is uh",
    "start": "148200",
    "end": "154280"
  },
  {
    "text": "basically tracks uh the inventory of available food across all of the restaurants and it's a fairly simple",
    "start": "154280",
    "end": "161159"
  },
  {
    "text": "architecture it's a web app with a with a front end written and JavaScript backend ritten and go uh talking to uh",
    "start": "161159",
    "end": "167640"
  },
  {
    "text": "Microsoft SQL server on the back end um and then storing it running inside kubernetes storing its data on a",
    "start": "167640",
    "end": "173360"
  },
  {
    "text": "persistent volume and simple applications very",
    "start": "173360",
    "end": "181120"
  },
  {
    "text": "quickly become complicated when you care about things like never taking any downtime so I told you the app this is",
    "start": "181120",
    "end": "188720"
  },
  {
    "text": "this is the environment we're actually running in um so we don't have one kubernetes cluster we've got two we're",
    "start": "188720",
    "end": "194200"
  },
  {
    "text": "going to use both during today's talk uh one's staging the other's production and",
    "start": "194200",
    "end": "199599"
  },
  {
    "text": "they're set up to be able to replicate uh all of the data between them uh leveraging uh the port Works storage",
    "start": "199599",
    "end": "207360"
  },
  {
    "text": "layer we also are leveraging Argo CD in order to go and uh deploy manifest to",
    "start": "207360",
    "end": "214360"
  },
  {
    "text": "these kubernetes clusters throughout the talk we're leveraging git because that's obviously when you're doing G Ops where",
    "start": "214360",
    "end": "219959"
  },
  {
    "text": "everything lives we're leveraging harness in order to orchestrate Argo CD and we're also leveraging uh harness",
    "start": "219959",
    "end": "226799"
  },
  {
    "text": "database devops in order to do database schema migrations one thing that is uh new this",
    "start": "226799",
    "end": "233519"
  },
  {
    "text": "year so last year when we talked about it we talked application changes we",
    "start": "233519",
    "end": "238760"
  },
  {
    "text": "talked up the version of the database inside the cicd pipeline the pipeline we're running",
    "start": "238760",
    "end": "244879"
  },
  {
    "text": "today can do both of those but what we're going to focus on today is actually migrating the database schema",
    "start": "244879",
    "end": "252200"
  },
  {
    "text": "um to add new columns which can also be done in the cicd pipeline and since been",
    "start": "252200",
    "end": "258000"
  },
  {
    "text": "somewhat of an evolving talk right this is a lot of the principles here are the main thing that um and maybe I should",
    "start": "258000",
    "end": "263759"
  },
  {
    "text": "ask was anybody at our data on kubernetes day talk in Chicago oh no one okay entirely new",
    "start": "263759",
    "end": "269479"
  },
  {
    "text": "audience all right so um the one of the most important things uh about these sorts of pipelines is no matter what the",
    "start": "269479",
    "end": "276360"
  },
  {
    "text": "change is and today we're going to be doing a schema change as well as an application change is that we're testing",
    "start": "276360",
    "end": "282560"
  },
  {
    "text": "the entire thing end to end so this could even be an infrastructure change or whatever the thing is and and",
    "start": "282560",
    "end": "289320"
  },
  {
    "text": "hopefully with this everything will go just fine and we won't have a have a problem um but this gives us a way of",
    "start": "289320",
    "end": "295720"
  },
  {
    "text": "ensuring that uh with as much vers similitude as possible that we have a functioning application",
    "start": "295720",
    "end": "303160"
  },
  {
    "text": "before we roll that in back into production or roll the change into production yeah and if you if you ever",
    "start": "303160",
    "end": "309160"
  },
  {
    "text": "want have a co-speaker and you want to make them nervous a cubec con tell them like a week beforehand that your home",
    "start": "309160",
    "end": "314680"
  },
  {
    "text": "lab where your talks running in has been tripping Breakers it uh it makes everyone feel good I've learned about uh",
    "start": "314680",
    "end": "320199"
  },
  {
    "text": "afci circuits apparently so my wife is actually uh by the circuit breaker right now in case that trips so when I was",
    "start": "320199",
    "end": "326759"
  },
  {
    "text": "checking my phone it wasn't being necessarily idle I was waiting for notification in case something had had tripped because yes this is actually",
    "start": "326759",
    "end": "333199"
  },
  {
    "text": "running uh out of my house in Tacoma Washington so because after all um why not have a live demo in front in front",
    "start": "333199",
    "end": "339680"
  },
  {
    "text": "of an an audience that that's that sounds like a good way to control blood",
    "start": "339680",
    "end": "345199"
  },
  {
    "text": "pressure so you know what's the process we're going to be running through on rccd Pipeline today um so we're going to",
    "start": "345199",
    "end": "352199"
  },
  {
    "text": "uh go and uh test with live production data in our staging environment so we're going to start by scaling down our stage",
    "start": "352199",
    "end": "359199"
  },
  {
    "text": "staging database and then triggering a copy of all the data in our persistent",
    "start": "359199",
    "end": "364400"
  },
  {
    "text": "volume from production to staging um that copy is triggered by deploying a uh",
    "start": "364400",
    "end": "370919"
  },
  {
    "text": "migration crd to the production cluster and I should say that this sort of migration can be uh because obviously um",
    "start": "370919",
    "end": "378160"
  },
  {
    "text": "I'm I'm using a a port workor crd in order to to trigger this migration but anything that can get data from from one",
    "start": "378160",
    "end": "384720"
  },
  {
    "text": "side to another uh can also be used to push this around the idea though is that",
    "start": "384720",
    "end": "390160"
  },
  {
    "text": "these PVC these persistent volumes are living inside of kubernetes and we're going to have an exact copy of them go",
    "start": "390160",
    "end": "396680"
  },
  {
    "text": "over to our staging environment after the the database comes",
    "start": "396680",
    "end": "402360"
  },
  {
    "text": "back up with our copy of production data we're then going to go ahead and change the database schema for the database",
    "start": "402360",
    "end": "408280"
  },
  {
    "text": "schema today we're going to be introducing a couple new columns I'll walk through the details of what the use case is and what the change we're making",
    "start": "408280",
    "end": "414199"
  },
  {
    "text": "is in just a couple of minutes after the database comes up we're then going to deploy a new version of the app appli that depends on those",
    "start": "414199",
    "end": "421080"
  },
  {
    "text": "database changes and we're then going to look make sure everything's working as expected and if it's not we'll roll",
    "start": "421080",
    "end": "428080"
  },
  {
    "text": "back so what's what what's the change for today so we mentioned that the",
    "start": "429800",
    "end": "435919"
  },
  {
    "text": "application we're using tracks food inventory across our barbecue restaurant",
    "start": "435919",
    "end": "441039"
  },
  {
    "text": "chain and our barbecue restaurant chain needs to open a new location it's",
    "start": "441039",
    "end": "447639"
  },
  {
    "text": "opening one in Boston Georgia unfortunately we already have a barbecue",
    "start": "447639",
    "end": "452720"
  },
  {
    "text": "restaurant in Boston Massachusetts and our data database schema only has a single column tracking",
    "start": "452720",
    "end": "460080"
  },
  {
    "text": "location and right now the word that's in there is Boston which is a bit of a problem it",
    "start": "460080",
    "end": "465840"
  },
  {
    "text": "seems like a bit shortsighted for uh yeah actually the data schema here for I don't know some reason almost like it",
    "start": "465840",
    "end": "472240"
  },
  {
    "text": "wasn't our day job when we built this so you know we we want to expand",
    "start": "472240",
    "end": "479080"
  },
  {
    "text": "that so we're what we're going to do as our change is we're going to introduce two new columns to our warehouses table",
    "start": "479080",
    "end": "486560"
  },
  {
    "text": "those two new columns are going to identify the city and the state we're going to keep the location column and",
    "start": "486560",
    "end": "492919"
  },
  {
    "text": "we're keeping location because it's currently used by our inventory tracking table as a forign key so we want to",
    "start": "492919",
    "end": "500360"
  },
  {
    "text": "still be able to do that join however we're no longer going to be displaying location we're going to be",
    "start": "500360",
    "end": "506240"
  },
  {
    "text": "displaying city and state this is fairly simple so far",
    "start": "506240",
    "end": "514320"
  },
  {
    "text": "but our our boss the the pig who owns our barbecue",
    "start": "514320",
    "end": "519719"
  },
  {
    "text": "chain his name is Frank yeah I'm not making this up there there's stuff we have FL dolls somewhere in uh in cubon",
    "start": "519719",
    "end": "526279"
  },
  {
    "text": "so if you see people around with the the plush that is Frank he doesn't let us take",
    "start": "526279",
    "end": "533240"
  },
  {
    "text": "downtime yes it's just a barbecue restaurant but we're open 247 365",
    "start": "533240",
    "end": "540120"
  },
  {
    "text": "and because of this we need the old version of the application and the new version of the application to be able to",
    "start": "540120",
    "end": "545760"
  },
  {
    "text": "run simultaneously because no matter how quickly we switch over if we're taking",
    "start": "545760",
    "end": "551000"
  },
  {
    "text": "no downtime they're both going to be running for at least a few milliseconds so because of that we've",
    "start": "551000",
    "end": "556480"
  },
  {
    "text": "also set up some triggers that are syncing the location column to the city and the state column in both directions",
    "start": "556480",
    "end": "562360"
  },
  {
    "text": "and thus if data is edited by the new version of the app it gets synced back to location to be seen by the old",
    "start": "562360",
    "end": "568399"
  },
  {
    "text": "version and similarly if it's edited by the old version of the app it will sync back to the",
    "start": "568399",
    "end": "574079"
  },
  {
    "text": "new when we get to production that's going to be really important that's that's this will be important",
    "start": "574079",
    "end": "580360"
  },
  {
    "text": "later so we're going to go go ahead and do a demo fingers crossed yeah send some",
    "start": "580360",
    "end": "586160"
  },
  {
    "text": "some good vibes back out to Tacoma yeah and I'm going to remember to edit the data in oh because after all since we're",
    "start": "586160",
    "end": "592560"
  },
  {
    "text": "using a production uh a copy of the production data let's actually add something to the production data you know so yeah you can see that we don't",
    "start": "592560",
    "end": "599519"
  },
  {
    "text": "have any tricks up our sleeves so cool this is this is the application we're using and I mentioned it's an inventory",
    "start": "599519",
    "end": "605040"
  },
  {
    "text": "tracking system so I'm going to come over and I'm going to add to our Barcelona location yes we're a very very",
    "start": "605040",
    "end": "612320"
  },
  {
    "text": "large barbecue restaurant chain we're International if anyone's wondering very good barbecue and West Coast style",
    "start": "612320",
    "end": "618720"
  },
  {
    "text": "barbecue actually I was told told today by one of the other employees you you know because everyone's heard of West",
    "start": "618720",
    "end": "625000"
  },
  {
    "text": "Coast barbecue right so we just added 20 units to",
    "start": "625000",
    "end": "631440"
  },
  {
    "text": "Barcelona of brisket so you'll notice in the tool tip there there's 165 units of brisket in Barcelona in PR if I go and I",
    "start": "631440",
    "end": "638760"
  },
  {
    "text": "look at the staging uh environment it's only got 145 units of brisket so we'll",
    "start": "638760",
    "end": "646040"
  },
  {
    "text": "look at that number again partway through our pipeline so that you can see that yes we're actually moving moving the data around and testing with",
    "start": "646040",
    "end": "652320"
  },
  {
    "text": "production data like we're saying over here in git I have a change",
    "start": "652320",
    "end": "658399"
  },
  {
    "text": "ready to commit that's going to add the",
    "start": "658399",
    "end": "663639"
  },
  {
    "text": "uh the database change I just walked through walking through this change um",
    "start": "663639",
    "end": "668959"
  },
  {
    "text": "it's broken down into a couple independent uh changes um the first one adds the two new columns that we talked",
    "start": "668959",
    "end": "675079"
  },
  {
    "text": "about to the warehouses Table after we've added those we then go and we set",
    "start": "675079",
    "end": "681560"
  },
  {
    "text": "the triggers that are going to sync the data and then after we set the triggers",
    "start": "681560",
    "end": "686600"
  },
  {
    "text": "we do a one-time copy of the data from the Loc column over to the city column for this onetime copy of the data we are",
    "start": "686600",
    "end": "694399"
  },
  {
    "text": "copying it one row at a time with a per row transaction to ensure we don't lock that whole table up during the copy",
    "start": "694399",
    "end": "700000"
  },
  {
    "text": "because as you've seen we have a lot of restaurants we've got a lot of inventory it takes some time to copy a billion",
    "start": "700000",
    "end": "705120"
  },
  {
    "text": "rows of data we don't have a full billion but you know again we're not allowed even a second of",
    "start": "705120",
    "end": "711639"
  },
  {
    "text": "downtime and then last but not least we're adding the new row for Boston Georgia to the warehouses table",
    "start": "711639",
    "end": "719440"
  },
  {
    "text": "when I made that change uh harness detected and kicked off a pipeline um on this on this UI all of these rows these",
    "start": "719440",
    "end": "726320"
  },
  {
    "text": "are VAR migrations I've run on my database all of the columns are various database instances so we're currently",
    "start": "726320",
    "end": "733279"
  },
  {
    "text": "deploying to the staging Argo instance and we're deploying the set of changes that we previously rolled",
    "start": "733279",
    "end": "739360"
  },
  {
    "text": "back hopping over here we can see our Pipeline and while we were talking it started by going and shutting down the",
    "start": "742920",
    "end": "749519"
  },
  {
    "text": "database in staging now that staging is offline we're going and migrating the data from",
    "start": "749519",
    "end": "756040"
  },
  {
    "text": "production to staging and this takes a little bit of time because again it's a real world database and we are actually you know",
    "start": "756040",
    "end": "763160"
  },
  {
    "text": "copynet between two kubernetes clusters either side of a bedroom in my house 56k modem between the two you know how it",
    "start": "763160",
    "end": "769680"
  },
  {
    "text": "goes you upgraded to a 56k i' I had a US robotics back from",
    "start": "769680",
    "end": "776319"
  },
  {
    "text": "1994 he used to be running these on some Haze 2600s it was took",
    "start": "776720",
    "end": "782600"
  },
  {
    "text": "forever so we're currently copying the data once the once the data is copied we're going to spin back up the database",
    "start": "782600",
    "end": "789120"
  },
  {
    "text": "and then we'll go through the rest of the migration uh this this takes a second so while we wait for the",
    "start": "789120",
    "end": "794600"
  },
  {
    "text": "migration did anyone have any questions on anything we we've shown you guys so far",
    "start": "794600",
    "end": "802480"
  },
  {
    "text": "cool have to stall long enough for time because yeah so we're just and in this particular case we're just taking the uh",
    "start": "802600",
    "end": "808720"
  },
  {
    "text": "persist volume in the PVC over because obviously we want to deploy uh new",
    "start": "808720",
    "end": "814000"
  },
  {
    "text": "versions of the applications over on the on the staging side so our staging database uh is back up the migration",
    "start": "814000",
    "end": "820880"
  },
  {
    "text": "finished so now we're going to go ahead and deploy the changes to the database schema what our pipeline's going to do",
    "start": "820880",
    "end": "827199"
  },
  {
    "text": "in order to do that is it's going to start by reaching out to git and cloning down the current desired state of the",
    "start": "827199",
    "end": "835120"
  },
  {
    "text": "database it's then going to query the production database to see which migrations have already been run",
    "start": "835120",
    "end": "841639"
  },
  {
    "text": "relative to what's in git to figure out which changes need to be applied which changes need to be rolled back",
    "start": "841639",
    "end": "847519"
  },
  {
    "text": "Etc once it's figured out those changes it's going to run it through a governance layer in order to ensure that",
    "start": "847519",
    "end": "853720"
  },
  {
    "text": "you know it's not doing anything Frank the pig has said we're not allowed to do such as dropping data in",
    "start": "853720",
    "end": "859360"
  },
  {
    "text": "production um assuming everything looks good we'll then move on to apply the changes on this right hand side you can",
    "start": "859360",
    "end": "866800"
  },
  {
    "text": "see all of the various database changes that have been deployed um these white rows these are the changes that were",
    "start": "866800",
    "end": "872199"
  },
  {
    "text": "deployed prior that uh is not quite expected so let me take a quick peek at",
    "start": "872199",
    "end": "878399"
  },
  {
    "text": "that this is why I love live demos I'm going to go ahead and just",
    "start": "878399",
    "end": "883759"
  },
  {
    "text": "rerun from importantly any of these sorts of of failures are only happening inside of the staging environment which",
    "start": "883759",
    "end": "890680"
  },
  {
    "text": "is why we're doing this exercise in the first place every time we go through um",
    "start": "890680",
    "end": "896320"
  },
  {
    "text": "uh every time we go through this pipeline yeah looked like uh looked like the staging database server might not have been quite back up yet",
    "start": "896320",
    "end": "904199"
  },
  {
    "text": "oh so we're going to go ahead and uh rerun that um but basically assuming all looks good with the changes we'll get",
    "start": "904199",
    "end": "910639"
  },
  {
    "text": "them applied there was a real test that I probably needed to add to make sure that database was actually back up instead of",
    "start": "910639",
    "end": "917320"
  },
  {
    "text": "the uh the sleep timer gry beard bash programmers suddenly you know it gets late at night",
    "start": "917320",
    "end": "923199"
  },
  {
    "text": "and yeah sleep timer is just as good as a real check right right no cool so so",
    "start": "923199",
    "end": "928680"
  },
  {
    "text": "so time all went good the database is running again life life is happy so uh we're currently going and running the",
    "start": "928680",
    "end": "935680"
  },
  {
    "text": "changes through our governance engine and as you can see on the right hand side these three changes just popped up in green so those are the the new",
    "start": "935680",
    "end": "941880"
  },
  {
    "text": "changes we're applying that we previously checked in to get um after they are applied we're going going to",
    "start": "941880",
    "end": "948800"
  },
  {
    "text": "add a tag to the database and what that tag is is it creates a roll back Point um so that if at any future point in",
    "start": "948800",
    "end": "954839"
  },
  {
    "text": "time we need to roll back to here we can um and you know have those kind of before and after every change is really",
    "start": "954839",
    "end": "960880"
  },
  {
    "text": "important so that you can undo that change and not being a DBA this is something that's pretty common to be able to uh because it yeah you want to",
    "start": "960880",
    "end": "967519"
  },
  {
    "text": "keep those around I guess longer than I expected in in talking about this yeah so like most databases once you commit a",
    "start": "967519",
    "end": "974040"
  },
  {
    "text": "transaction they don't have a way to roll back those changes natively um they don't have an equivalent of like Cube",
    "start": "974040",
    "end": "980120"
  },
  {
    "text": "CTL roll out undo um but most of the database change management Frameworks",
    "start": "980120",
    "end": "985759"
  },
  {
    "text": "have a way to keep track of which changes were applied and tag particular States uh in that so that you can then",
    "start": "985759",
    "end": "992279"
  },
  {
    "text": "go back to any of those past States very easily um cool so right now we've",
    "start": "992279",
    "end": "997600"
  },
  {
    "text": "deployed the new version of our schema we haven't yet deployed the new version of our application um and the reason for",
    "start": "997600",
    "end": "1003440"
  },
  {
    "text": "that is in order to not take downtime in prod it's really important that the old version of our application still works",
    "start": "1003440",
    "end": "1009720"
  },
  {
    "text": "with the new version of our schema so let's test that here I am in staging",
    "start": "1009720",
    "end": "1015360"
  },
  {
    "text": "before I refresh quantity of brisket is 145 now it's 165 so all right that worked we",
    "start": "1015360",
    "end": "1022959"
  },
  {
    "text": "actually have the production data Life's good and you know similarly if I click around a little bit like it it basically",
    "start": "1022959",
    "end": "1028558"
  },
  {
    "text": "looks like everything's working so let's go ahead and deploy the",
    "start": "1028559",
    "end": "1033839"
  },
  {
    "text": "new version of the application so a lot of the time when you're dealing with stateful",
    "start": "1033839",
    "end": "1039360"
  },
  {
    "text": "applications small minor features like adding a state column require you to",
    "start": "1039360",
    "end": "1044880"
  },
  {
    "text": "ship a new schema change and a new application version kind of in lock step because those changes are tightly",
    "start": "1044880",
    "end": "1050960"
  },
  {
    "text": "coupled so now we just reached out to Argo we told it to syn down the application manifest and that's going to",
    "start": "1050960",
    "end": "1058799"
  },
  {
    "text": "go ahead and give us the new version of the",
    "start": "1058799",
    "end": "1063600"
  },
  {
    "text": "application and you know clicking around life looks life looks reasonably good",
    "start": "1066039",
    "end": "1071760"
  },
  {
    "text": "except when I come over to manage inventory now I'm no longer seeing cities or states at all which is",
    "start": "1071760",
    "end": "1077600"
  },
  {
    "text": "probably not ideal and that's be really hard to change around inventory yeah and and and it",
    "start": "1077600",
    "end": "1083520"
  },
  {
    "text": "turns out that's that that's because of a bug bug in my UI where uh it doesn't automatically update the client to the",
    "start": "1083520",
    "end": "1089120"
  },
  {
    "text": "new version I should uh I should probably fix that before we reach prod but you know if I hold shift and I hit refresh now now I can see it but you",
    "start": "1089120",
    "end": "1097159"
  },
  {
    "text": "know only Boston Georgia has a state because I didn't in my change put in States for any of the other cities I",
    "start": "1097159",
    "end": "1103320"
  },
  {
    "text": "should probably fix that too yeah so you know maybe I'm not quite ready to take",
    "start": "1103320",
    "end": "1108919"
  },
  {
    "text": "all the way to prod so cool I've deployed this to a shared",
    "start": "1108919",
    "end": "1115880"
  },
  {
    "text": "environment it's not ready I want to go back to my Dev environment how do I get all of",
    "start": "1115880",
    "end": "1121280"
  },
  {
    "text": "this back so you know a lot of the uh a lot of the time when you're you're doing",
    "start": "1121280",
    "end": "1126840"
  },
  {
    "text": "database migrations um there is sometimes a way to roll back they're they're frequently referred to as undo",
    "start": "1126840",
    "end": "1132799"
  },
  {
    "text": "migrations and it's what's the inverse set of operations to do what you previously did and you want to be",
    "start": "1132799",
    "end": "1138400"
  },
  {
    "text": "careful when you're using them in prod because for example if you create a new table of data and you undo that you've",
    "start": "1138400",
    "end": "1145400"
  },
  {
    "text": "just deleted the table of data so certain operations create table create column it's often a good idea to not",
    "start": "1145400",
    "end": "1152039"
  },
  {
    "text": "roll back but most operations you can such as for example the triggers we set up and in this case we're actually in a",
    "start": "1152039",
    "end": "1157480"
  },
  {
    "text": "staging environment because there's a few different ways to handle a failure in the application um that happens right",
    "start": "1157480",
    "end": "1163960"
  },
  {
    "text": "we are syncing this data from production we could simply resync it um but it's",
    "start": "1163960",
    "end": "1169000"
  },
  {
    "text": "also valuable to make sure if this was actually in production to make sure that our roll backs would have actually",
    "start": "1169000",
    "end": "1174760"
  },
  {
    "text": "worked so that's the point of this entire staging environment so we can do as many tests uh on this database as",
    "start": "1174760",
    "end": "1181039"
  },
  {
    "text": "possible and granted uh a good portion of them here manual we asked last year for people to submit automated tests to",
    "start": "1181039",
    "end": "1186799"
  },
  {
    "text": "us and you know we got the uh a number somewhere hovering around between zero and one with a margin of error of one um",
    "start": "1186799",
    "end": "1194080"
  },
  {
    "text": "but eventually I'll get to it uh in between sleepless nights with a baby that sort of thing yeah so you know",
    "start": "1194080",
    "end": "1200640"
  },
  {
    "text": "where I'm doing these manual checks we could be running a test Suite um still accepting contributions of a test Suite",
    "start": "1200640",
    "end": "1207200"
  },
  {
    "text": "the window's still open so here I'm I'm just prompting hey do",
    "start": "1207200",
    "end": "1212440"
  },
  {
    "text": "you want to uh do you want to continue deploying or do you want to roll this back I'm going to go ahead and trigger a",
    "start": "1212440",
    "end": "1217480"
  },
  {
    "text": "roll back so we deployed our application we also deployed our database a lot of companies if they need to roll that back",
    "start": "1217480",
    "end": "1224320"
  },
  {
    "text": "that database roll back that's by hand the application roll back you know for a",
    "start": "1224320",
    "end": "1229480"
  },
  {
    "text": "stateless application that's really easy for a stateful application oftentimes that entire deployment because of the",
    "start": "1229480",
    "end": "1234559"
  },
  {
    "text": "database change companies have disabled the automated pipeline for so we started",
    "start": "1234559",
    "end": "1239679"
  },
  {
    "text": "by rolling back the application just you know effectively running a cube CTL roll out undue and then we went through and",
    "start": "1239679",
    "end": "1246880"
  },
  {
    "text": "we ran the uh well still running the undue migrations so we reached out to get pull down the the uh migration State",
    "start": "1246880",
    "end": "1255440"
  },
  {
    "text": "and then we're rolling back to that tag that existed at the beginning of the this demo so that we can get",
    "start": "1255440",
    "end": "1262600"
  },
  {
    "text": "back and as you can see we just rolled back so if I pull back up that summary screen that shows everywhere we deployed",
    "start": "1262919",
    "end": "1269640"
  },
  {
    "text": "we had deployed these changes out to staging we just rolled them back",
    "start": "1269640",
    "end": "1274278"
  },
  {
    "text": "again all right let's see how the application looks yeah so if I come back to the application and I and I refresh",
    "start": "1275440",
    "end": "1282240"
  },
  {
    "text": "well now my pick list doesn't work at all and that's because of that same client caching problem that I mentioned",
    "start": "1282240",
    "end": "1288159"
  },
  {
    "text": "so I really need to make my my web UI a little bit smarter when I deploy it but if I hold shift and I hit refresh again",
    "start": "1288159",
    "end": "1295159"
  },
  {
    "text": "you can see that now we're on the old version of the of the UI old version of the database schema everything's working",
    "start": "1295159",
    "end": "1301159"
  },
  {
    "text": "the same way it was the only thing we've changed since the beginning of this demo is hey we still copied the data from",
    "start": "1301159",
    "end": "1307320"
  },
  {
    "text": "production so if I come and I check Barcelona it's still going to be",
    "start": "1307320",
    "end": "1313840"
  },
  {
    "text": "165 so that's some of the power of the things you can do by in data inside your",
    "start": "1314480",
    "end": "1319520"
  },
  {
    "text": "cicd pipeline quick recap of what we've shown you we've shown you how you can deploy",
    "start": "1319520",
    "end": "1325400"
  },
  {
    "text": "and roll back changes to your application your database schema and your running database server version all",
    "start": "1325400",
    "end": "1332600"
  },
  {
    "text": "simultaneously when we were deploying and sinking the application manifest to get we were we were syncing and updating",
    "start": "1332600",
    "end": "1338600"
  },
  {
    "text": "all three we did a little bit of a deep dive into a real world database change",
    "start": "1338600",
    "end": "1344080"
  },
  {
    "text": "that database change was handling a real world situation where we needed toak break a single location column out into",
    "start": "1344080",
    "end": "1350520"
  },
  {
    "text": "two columns city and state we covered some of the considerations that you need to think",
    "start": "1350520",
    "end": "1356240"
  },
  {
    "text": "about when you're doing a schema change that are unique to stateful Applications if you want to ensure that you can",
    "start": "1356240",
    "end": "1362559"
  },
  {
    "text": "upgrade with zero downtime we rolled back our change and we covered how you can do database",
    "start": "1362559",
    "end": "1368799"
  },
  {
    "text": "rollbacks now this particular example was that schema change in the past in in some of these demos we have uh uh done",
    "start": "1368799",
    "end": "1376679"
  },
  {
    "text": " upgrades and um yeah had to fake the braking I can I'm I'm great at",
    "start": "1376679",
    "end": "1381880"
  },
  {
    "text": "breaking stuff so you have a quick script that that blows something up um but an example of an actual database",
    "start": "1381880",
    "end": "1387440"
  },
  {
    "text": "upgrade inside of kubernetes that was running out of a staging environment same thing with application upgrades but",
    "start": "1387440",
    "end": "1393120"
  },
  {
    "text": "for each of these changes being able to test everything end to end to ensure",
    "start": "1393120",
    "end": "1398480"
  },
  {
    "text": "that it all works before we roll this into production and to be able to do that",
    "start": "1398480",
    "end": "1403520"
  },
  {
    "text": "automatically instead of a bunch of manual tests with a release point because the faster we can have these",
    "start": "1403520",
    "end": "1410400"
  },
  {
    "text": "iterations and tests and results well the faster we can ship new features that",
    "start": "1410400",
    "end": "1415760"
  },
  {
    "text": "we can actually test things and and have a good assurance that it's going to work",
    "start": "1415760",
    "end": "1421840"
  },
  {
    "text": "uh for us yeah at the end of the day what's what's everyone trying to optimize with software delivery today",
    "start": "1421840",
    "end": "1427679"
  },
  {
    "text": "they're trying to decrease the amount of time between that feature being built and it reaching production and it re and",
    "start": "1427679",
    "end": "1434120"
  },
  {
    "text": "the longer your code sits on a branch somewhere the higher the likelihood is",
    "start": "1434120",
    "end": "1439600"
  },
  {
    "text": "something else in the app is going to change that's going to break you and the higher the cost of fixing that bug is because by the time you realize it's",
    "start": "1439600",
    "end": "1446080"
  },
  {
    "text": "broken the developer has switched on to something else and the more times you contact switch the slower you are yeah",
    "start": "1446080",
    "end": "1452720"
  },
  {
    "text": "so that's why you care about being able to leverage data in your cicd pipelines yeah so look at some of the the previous",
    "start": "1452720",
    "end": "1458480"
  },
  {
    "text": "talks there's other examples around tools I mentioned you know the uh the data mover we uh obviously used Argo",
    "start": "1458480",
    "end": "1464840"
  },
  {
    "text": "here to deploy the Manifest you can use other things uh having a workflow engine that can actually talk to multiple",
    "start": "1464840",
    "end": "1470799"
  },
  {
    "text": "clusters trigger the Argo syns uh is always always important I think I have one blog where I did it entirely with",
    "start": "1470799",
    "end": "1476760"
  },
  {
    "text": "Argo and it gets uh it gets a little a little complex so uh if you do a uh the",
    "start": "1476760",
    "end": "1482600"
  },
  {
    "text": "right Google search I'm sure you can find it or find me later I'll I'll get you get you a link to it cool so I think",
    "start": "1482600",
    "end": "1488200"
  },
  {
    "text": "that's pretty much everything we had we had planned I went ahead and kicked off the the pipeline again in case uh any why not any further question on it all",
    "start": "1488200",
    "end": "1495039"
  },
  {
    "text": "right questions any questions or thoughts ments death threats",
    "start": "1495039",
    "end": "1501440"
  },
  {
    "text": "Tomatoes oh we're we're really close",
    "start": "1505240",
    "end": "1510039"
  },
  {
    "text": "by yeah so that so the question was is there any risks of taking that snapshot",
    "start": "1519480",
    "end": "1524559"
  },
  {
    "text": "that we then used to to feed into um into the St staging environment absolutely so a few things to consider",
    "start": "1524559",
    "end": "1531399"
  },
  {
    "text": "first if you're taking the snapshot there should be some for way of quessing the database that usually involves some sort of freeze thaw uh pre- rule post",
    "start": "1531399",
    "end": "1538960"
  },
  {
    "text": "rule that is typically database specific you absolutely want to do that as as part of this keep in mind though that",
    "start": "1538960",
    "end": "1545320"
  },
  {
    "text": "what we are feeding is a staging environment so uh this is not being used for the purposes of the backup so you",
    "start": "1545320",
    "end": "1551600"
  },
  {
    "text": "take that how you want if it fails one time out of a 100 how much do you care but I would certainly keep that in mind",
    "start": "1551600",
    "end": "1557520"
  },
  {
    "text": "another question we got when we gave this talk uh Monday or version of it Monday was kind of related to that was",
    "start": "1557520",
    "end": "1564480"
  },
  {
    "text": "around well can I use database specific things for the delivery truck let's use",
    "start": "1564480",
    "end": "1569640"
  },
  {
    "text": "log shipping or something like that um and absolutely the reason that we we are",
    "start": "1569640",
    "end": "1575039"
  },
  {
    "text": "using uh actually moving it over on the PV level here though is because I can use the same workflow for any data type",
    "start": "1575039",
    "end": "1582640"
  },
  {
    "text": "that I may have because it's great if the only database I'm running is but if I also have postgress Microsoft",
    "start": "1582640",
    "end": "1589399"
  },
  {
    "text": "SQL and a lot of other things and less expertise in them being able to use the same pipeline structure to push things",
    "start": "1589399",
    "end": "1595360"
  },
  {
    "text": "around can sometimes be helpful so hopefully that that answers that and to give you an idea of just how generic",
    "start": "1595360",
    "end": "1601279"
  },
  {
    "text": "this pipeline is the only part of it that is specific to the database that we were using is literally the sequel of",
    "start": "1601279",
    "end": "1607960"
  },
  {
    "text": "the change um which you know was you know dependent on it being a relational",
    "start": "1607960",
    "end": "1614200"
  },
  {
    "text": "database um we have a different barbecue bookkeeper app that's on everything except for like add table add",
    "start": "1614200",
    "end": "1620399"
  },
  {
    "text": "column two table as Concepts works on  and there we just have to change it to you know add a required field",
    "start": "1620399",
    "end": "1627080"
  },
  {
    "text": "validator to a collection right great question any other",
    "start": "1627080",
    "end": "1634679"
  },
  {
    "text": "questions um yeah Mike I think there's mics around somewhere oh okay",
    "start": "1637559",
    "end": "1646080"
  },
  {
    "text": "oh maybe you know what they moved them back you know what I'm going to do",
    "start": "1650880",
    "end": "1655760"
  },
  {
    "text": "this thank you I appreciate it but you have the answer this whatever it is yeah",
    "start": "1658279",
    "end": "1663440"
  },
  {
    "text": "sounds good yeah in in my organization we personally use uh ephemeral",
    "start": "1663440",
    "end": "1668919"
  },
  {
    "text": "environments uh for a lot of things and we also have a pi and PCI restrictions",
    "start": "1668919",
    "end": "1675279"
  },
  {
    "text": "and databases so I I can just elaborate how could I do this using something a",
    "start": "1675279",
    "end": "1681640"
  },
  {
    "text": "little bit more custom uh instead of the PV migration but what are you like you know ideas",
    "start": "1681640",
    "end": "1689640"
  },
  {
    "text": "regarding this so so I mean one part of that is is definitely around security because we're taking a production copy",
    "start": "1689640",
    "end": "1695240"
  },
  {
    "text": "of the database you're not miked so let me take it do people really have a problem here",
    "start": "1695240",
    "end": "1701200"
  },
  {
    "text": "well it's not being recorded oh okay yeah um so so the question was hey I'm",
    "start": "1701200",
    "end": "1707159"
  },
  {
    "text": "in a PCI compliance environment so I need to keep all the pi in a very very",
    "start": "1707159",
    "end": "1712760"
  },
  {
    "text": "very specific operating Zone exactly um and there was a second part as well which at this point I forgot I'm sorry",
    "start": "1712760",
    "end": "1718760"
  },
  {
    "text": "uh ephemeral environments ephemeral environments um so uh I'm I'm going to do ephemeral environments first so for",
    "start": "1718760",
    "end": "1725559"
  },
  {
    "text": "everything we showed if we wanted to make this ephemeral the extent of what we would do is at the very very end we",
    "start": "1725559",
    "end": "1732519"
  },
  {
    "text": "would delete the name space for staging at that point even that name space is being deployed when we do the SN at the",
    "start": "1732519",
    "end": "1739159"
  },
  {
    "text": "very end and the entire thing would be torn down at the end yeah actually actually the femal environment part was",
    "start": "1739159",
    "end": "1745320"
  },
  {
    "text": "just um uh I I was just trying to put some emphasis in since we don't have",
    "start": "1745320",
    "end": "1750559"
  },
  {
    "text": "staging and normally stagings also can B PCI complying sometimes um but the the",
    "start": "1750559",
    "end": "1756760"
  },
  {
    "text": "stress I'm doing is since we use a femal environments we have like stricter policies on P and PCI so quick quick",
    "start": "1756760",
    "end": "1764200"
  },
  {
    "text": "follow-up question with that um because if the kubernetes environment is all running ephemeral uh containers your",
    "start": "1764200",
    "end": "1770320"
  },
  {
    "text": "data is living somewhere presumably outside of kubernetes right yeah let's say that just to make",
    "start": "1770320",
    "end": "1778039"
  },
  {
    "text": "it a little bit more complex let's say I'm using a fully managed database from a c writer this is actually one of the",
    "start": "1778039",
    "end": "1785200"
  },
  {
    "text": "the reasons for what's this uh this talk started as an as more of an advocacy of",
    "start": "1785200",
    "end": "1790799"
  },
  {
    "text": "why I would choose to run uh data uh services on top of kubernetes and myself",
    "start": "1790799",
    "end": "1796799"
  },
  {
    "text": "because it's very difficult to pull off the same sort of thing inside of a hosted environment if that makes sense for for",
    "start": "1796799",
    "end": "1804679"
  },
  {
    "text": "the PCI compliance side um the company that I did this with originally um had a",
    "start": "1804679",
    "end": "1811960"
  },
  {
    "text": "lot of very sensitive data um in our database the way we dealt with the",
    "start": "1811960",
    "end": "1817279"
  },
  {
    "text": "compliance concerns around it is we set up a a environment that had the same",
    "start": "1817279",
    "end": "1824320"
  },
  {
    "text": "security regulations in prod and we were as prod and we were testing in that so",
    "start": "1824320",
    "end": "1829399"
  },
  {
    "text": "like you definitely don't want to pull down to like a lab environment um but you can have a nonproduction environment",
    "start": "1829399",
    "end": "1836200"
  },
  {
    "text": "that has the same governance rules and you do all of this there we have also",
    "start": "1836200",
    "end": "1841399"
  },
  {
    "text": "had some people we've talked to who have done things like this where in the middle they do data anonymization um so",
    "start": "1841399",
    "end": "1849480"
  },
  {
    "text": "you know it's on our to-do list one of these days uh one one of the other apps has is an ordering app and it has the",
    "start": "1849480",
    "end": "1855600"
  },
  {
    "text": "name of the person who put in the order and one of these days I'm going to go write an anonymizer for it that changes",
    "start": "1855600",
    "end": "1861559"
  },
  {
    "text": "out every every uh occurrence of C Crow with C Raven um and you know you want to",
    "start": "1861559",
    "end": "1869559"
  },
  {
    "text": "do that anonymization in a nonpr environment and doing that anonymization",
    "start": "1869559",
    "end": "1876519"
  },
  {
    "text": "is going to be very application specific because you need to know which columns are the sensitive ones um but if you run",
    "start": "1876519",
    "end": "1883320"
  },
  {
    "text": "an anonymization like that you can then go and move it out of prod safely typically",
    "start": "1883320",
    "end": "1889000"
  },
  {
    "text": "does that answer your questions yeah actually and um I didn't thought too much before asking but then as I told",
    "start": "1889000",
    "end": "1895120"
  },
  {
    "text": "you at the beginning I could just elaborate they probably can find like a way that it's less messy than another",
    "start": "1895120",
    "end": "1901919"
  },
  {
    "text": "but it feels like um any type of a c CI processor CD processor for database is",
    "start": "1901919",
    "end": "1907919"
  },
  {
    "text": "really really it has to be really ergonomic to the nature of the application right it's not no way around",
    "start": "1907919",
    "end": "1915279"
  },
  {
    "text": "it so I would say the pieces that areaware so like hey if",
    "start": "1915279",
    "end": "1921399"
  },
  {
    "text": "you're adding an automated test Suite that's just like for your outside the database tests it's going to be app",
    "start": "1921399",
    "end": "1926559"
  },
  {
    "text": "specific uh the schema changes are going to be app specific but the actual pipeline logic doesn't need to be",
    "start": "1926559",
    "end": "1933679"
  },
  {
    "text": "um for dealing with the PCI stuff usually you basically just you add you add an extra hop to get to Dev um the",
    "start": "1933679",
    "end": "1940559"
  },
  {
    "text": "main reason we don't do that here is because then you have to wait for for two copies um which we don't want to",
    "start": "1940559",
    "end": "1946279"
  },
  {
    "text": "make you all sit around and do yeah yeah that's that's good and by the way if people want to continue the conversation",
    "start": "1946279",
    "end": "1952880"
  },
  {
    "text": "um uh you can find us at the portworks booth later or me at the portworks booth later today I can usually uh get a hold",
    "start": "1952880",
    "end": "1959360"
  },
  {
    "text": "of Steven his uh uh harnesses a a couple rows down from us and I think there are",
    "start": "1959360",
    "end": "1964799"
  },
  {
    "text": "tables and stuff around there uh yeah or we could talk over pickle ball you know I'm from Seattle so that's it's a whole",
    "start": "1964799",
    "end": "1970840"
  },
  {
    "text": "thing up there yeah so if any of you want to talk more uh we're we're talking about some of more of this stuff uh at",
    "start": "1970840",
    "end": "1977320"
  },
  {
    "text": "Pork works Booth later and then uh you can also stop by either their Booth or harness booth and and we're happy to set",
    "start": "1977320",
    "end": "1982960"
  },
  {
    "text": "up time to chat with you after if anyone else has any other questions we happy to take them otherwise we are down to one",
    "start": "1982960",
    "end": "1989679"
  },
  {
    "text": "minute left hi more of a pipeline question um",
    "start": "1989679",
    "end": "1997559"
  },
  {
    "text": "when you do the schema changes what happens to the downstream with the CDC right things plugged in",
    "start": "1997559",
    "end": "2004000"
  },
  {
    "text": "with the CDC for CFA related things listening to the CDC change or when you roll back how does how do",
    "start": "2004000",
    "end": "2011919"
  },
  {
    "text": "you make sure that it truly not impacting the CDC from a pipeline stand for do you care for it in the pipeline",
    "start": "2011919",
    "end": "2018360"
  },
  {
    "text": "or is it downstreams problem so um I believe you're you're uh to to",
    "start": "2018360",
    "end": "2026559"
  },
  {
    "text": "restate your question hey I'm running like an ETL process that's syncing data",
    "start": "2026559",
    "end": "2032279"
  },
  {
    "text": "from database a to database B the schema changed how do you handle my ETL process is that that could be one it could be uh",
    "start": "2032279",
    "end": "2040279"
  },
  {
    "text": "yes that could be Downstream jobs or it could be a simple Dr Data from a data",
    "start": "2040279",
    "end": "2045840"
  },
  {
    "text": "center to another data center going via the CDC right so yeah so so Dr like it's",
    "start": "2045840",
    "end": "2051440"
  },
  {
    "text": "it's just going to everything we showed you here is just going to automatically syn because it's taking a backup of the full schema and um sometimes people you",
    "start": "2051440",
    "end": "2059280"
  },
  {
    "text": "can also do processes like this instead of running off the live production database running off a backup um for uh",
    "start": "2059280",
    "end": "2066398"
  },
  {
    "text": "ETL if you're your ETL is copying specific columns you're going to need to go update those ETL scripts to look at",
    "start": "2066399",
    "end": "2073560"
  },
  {
    "text": "the new columns that include them if it's copying whole tables uh which is fairly common those new columns are going to come in for free but your ETL",
    "start": "2073560",
    "end": "2081878"
  },
  {
    "text": "and the applications built on the other end of your ETL are effectively a separate application so anytime you make",
    "start": "2081879",
    "end": "2087599"
  },
  {
    "text": "a database schema change you do you know if you're changing pieces that you're using in other systems you want to make",
    "start": "2087599",
    "end": "2093638"
  },
  {
    "text": "sure those other systems are getting updated as well and that's another great reason for having that backwards",
    "start": "2093639",
    "end": "2099079"
  },
  {
    "text": "compatibility in that trigger is a lot of databases especially ones",
    "start": "2099079",
    "end": "2105480"
  },
  {
    "text": "the predate microservices don't just have one app that runs against them that needs to be using the right schema so by",
    "start": "2105480",
    "end": "2111640"
  },
  {
    "text": "having that backwards compatibility layer your ETL could still be looking at that location column your new version of",
    "start": "2111640",
    "end": "2118560"
  },
  {
    "text": "the app is there you haven't deleted that old version you go update your ETL and you only delete that old schema",
    "start": "2118560",
    "end": "2125200"
  },
  {
    "text": "change and the triggers that are syncing them after that ETL is fully updated similarly i'",
    "start": "2125200",
    "end": "2131960"
  },
  {
    "text": "I've talked to some companies who have old monolithic apps where they've got you know 10 different Services all connecting back to the same databases",
    "start": "2131960",
    "end": "2137960"
  },
  {
    "text": "owned by different teams and they have to worry about breaking each other so again in that situation you don't remove",
    "start": "2137960",
    "end": "2144000"
  },
  {
    "text": "that compatibility layer until every app is using the new version did that answer",
    "start": "2144000",
    "end": "2149079"
  },
  {
    "text": "your question all right it looks like we are definitely out of time so thank you everybody really appreciate it",
    "start": "2149079",
    "end": "2158400"
  }
]