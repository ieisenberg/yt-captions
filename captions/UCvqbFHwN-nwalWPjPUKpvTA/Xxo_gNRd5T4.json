[
  {
    "start": "0",
    "end": "78000"
  },
  {
    "text": "hi everybody my name is shreyas and",
    "start": "0",
    "end": "2240"
  },
  {
    "text": "today we're here to",
    "start": "2240",
    "end": "3840"
  },
  {
    "text": "talk about how we can auto suggest and",
    "start": "3840",
    "end": "5759"
  },
  {
    "text": "auto generate recording rules",
    "start": "5759",
    "end": "8160"
  },
  {
    "text": "uh with the goal of kind of speeding up",
    "start": "8160",
    "end": "10559"
  },
  {
    "text": "dashboards and kind of in general the",
    "start": "10559",
    "end": "12480"
  },
  {
    "text": "speeding up query performance",
    "start": "12480",
    "end": "16160"
  },
  {
    "text": "my name is uh i'm a technical leader",
    "start": "16160",
    "end": "18560"
  },
  {
    "text": "chronosphere where we're building a",
    "start": "18560",
    "end": "19920"
  },
  {
    "text": "hosted metrics and monitoring platform",
    "start": "19920",
    "end": "22560"
  },
  {
    "text": "uh targeting large-scale high-throughput",
    "start": "22560",
    "end": "25119"
  },
  {
    "text": "use cases",
    "start": "25119",
    "end": "26640"
  },
  {
    "text": "uh the platform's built on m3 which is",
    "start": "26640",
    "end": "30000"
  },
  {
    "text": "open source kind of remote storage back",
    "start": "30000",
    "end": "32960"
  },
  {
    "text": "end",
    "start": "32960",
    "end": "34160"
  },
  {
    "text": "for prometheus prior to this i was an",
    "start": "34160",
    "end": "37520"
  },
  {
    "text": "uber",
    "start": "37520",
    "end": "38079"
  },
  {
    "text": "on the observation primarily working on",
    "start": "38079",
    "end": "40800"
  },
  {
    "text": "alerting and dashboarding",
    "start": "40800",
    "end": "42960"
  },
  {
    "text": "and yeah the agenda for today",
    "start": "42960",
    "end": "46559"
  },
  {
    "text": "is first kind of want to lay out the",
    "start": "46559",
    "end": "48640"
  },
  {
    "text": "problem statement",
    "start": "48640",
    "end": "49600"
  },
  {
    "text": "talking about high cardinality use cases",
    "start": "49600",
    "end": "52719"
  },
  {
    "text": "where",
    "start": "52719",
    "end": "53199"
  },
  {
    "text": "aggregation of metrics are useful uh",
    "start": "53199",
    "end": "56239"
  },
  {
    "text": "then we kind of talk about a couple of",
    "start": "56239",
    "end": "58000"
  },
  {
    "text": "different ways where we can actually",
    "start": "58000",
    "end": "59280"
  },
  {
    "text": "aggregate metrics",
    "start": "59280",
    "end": "60879"
  },
  {
    "text": "uh to speed dashboards up um",
    "start": "60879",
    "end": "63920"
  },
  {
    "text": "and speed querying up in general uh we",
    "start": "63920",
    "end": "65920"
  },
  {
    "text": "follow that up with a demo",
    "start": "65920",
    "end": "67280"
  },
  {
    "text": "of uh how we can make how how we can",
    "start": "67280",
    "end": "70320"
  },
  {
    "text": "make this possible",
    "start": "70320",
    "end": "72240"
  },
  {
    "text": "and finally kind of the goal is to just",
    "start": "72240",
    "end": "74799"
  },
  {
    "text": "show how we can make this",
    "start": "74799",
    "end": "76080"
  },
  {
    "text": "easy to use",
    "start": "76080",
    "end": "78720"
  },
  {
    "start": "78000",
    "end": "420000"
  },
  {
    "text": "so first kind of just setting up the",
    "start": "79119",
    "end": "80720"
  },
  {
    "text": "problem statement",
    "start": "80720",
    "end": "82640"
  },
  {
    "text": "high cardinality metrics is basically",
    "start": "82640",
    "end": "85680"
  },
  {
    "text": "kind of",
    "start": "85680",
    "end": "86159"
  },
  {
    "text": "uh like is is basically the area where",
    "start": "86159",
    "end": "89759"
  },
  {
    "text": "we",
    "start": "89759",
    "end": "90479"
  },
  {
    "text": "probably want aggregation uh c advisor",
    "start": "90479",
    "end": "93280"
  },
  {
    "text": "metrics are kind of a very",
    "start": "93280",
    "end": "94880"
  },
  {
    "text": "classic case of high quality metrics uh",
    "start": "94880",
    "end": "98000"
  },
  {
    "text": "c advisor basically",
    "start": "98000",
    "end": "100000"
  },
  {
    "text": "uh is a way to get resource usage and",
    "start": "100000",
    "end": "102399"
  },
  {
    "text": "performance metrics of running",
    "start": "102399",
    "end": "103840"
  },
  {
    "text": "containers",
    "start": "103840",
    "end": "105280"
  },
  {
    "text": "um so it's essentially like cpu",
    "start": "105280",
    "end": "109200"
  },
  {
    "text": "memory disk network traffic and kind of",
    "start": "109200",
    "end": "111680"
  },
  {
    "text": "all kind of the infrastructure level",
    "start": "111680",
    "end": "114159"
  },
  {
    "text": "uh things for containers uh this is kind",
    "start": "114159",
    "end": "116880"
  },
  {
    "text": "of a very simple",
    "start": "116880",
    "end": "118079"
  },
  {
    "text": "like c advisor dashboard which is kind",
    "start": "118079",
    "end": "120399"
  },
  {
    "text": "of monitoring like",
    "start": "120399",
    "end": "121759"
  },
  {
    "text": "5000 dot containers and has",
    "start": "121759",
    "end": "125119"
  },
  {
    "text": "various metrics on it if you kind of",
    "start": "125119",
    "end": "127920"
  },
  {
    "text": "look at the dashboard there's some",
    "start": "127920",
    "end": "129440"
  },
  {
    "text": "aggregate metrics and you also kind of",
    "start": "129440",
    "end": "131360"
  },
  {
    "text": "have like per",
    "start": "131360",
    "end": "132160"
  },
  {
    "text": "pod metrics uh where you kind of want to",
    "start": "132160",
    "end": "134400"
  },
  {
    "text": "look at like",
    "start": "134400",
    "end": "135520"
  },
  {
    "text": "the top usage information",
    "start": "135520",
    "end": "138560"
  },
  {
    "text": "so such a dashboard like just kind of",
    "start": "138560",
    "end": "141840"
  },
  {
    "text": "looking at the scale of the",
    "start": "141840",
    "end": "143360"
  },
  {
    "text": "carnality of data you realize that they",
    "start": "143360",
    "end": "145360"
  },
  {
    "text": "can come really slow really quickly",
    "start": "145360",
    "end": "149200"
  },
  {
    "text": "and this is where kind of like you can",
    "start": "149200",
    "end": "151519"
  },
  {
    "text": "make portions of the dashboard faster by",
    "start": "151519",
    "end": "153840"
  },
  {
    "text": "using kind of pre-aggregations an",
    "start": "153840",
    "end": "156959"
  },
  {
    "text": "example of kind of",
    "start": "156959",
    "end": "158400"
  },
  {
    "text": "how c like c advisor metrics are slow",
    "start": "158400",
    "end": "162400"
  },
  {
    "text": "is just looking at something simple like",
    "start": "162400",
    "end": "165040"
  },
  {
    "text": "container cpu usage",
    "start": "165040",
    "end": "168080"
  },
  {
    "text": "container cpu said just with kind of all",
    "start": "168080",
    "end": "170720"
  },
  {
    "text": "the",
    "start": "170720",
    "end": "171360"
  },
  {
    "text": "tags that get added by c advisor like",
    "start": "171360",
    "end": "174720"
  },
  {
    "text": "as the metrics are script uh",
    "start": "174720",
    "end": "177920"
  },
  {
    "text": "for the same for the same environment",
    "start": "177920",
    "end": "181040"
  },
  {
    "text": "you kind of have 16 000 series",
    "start": "181040",
    "end": "183599"
  },
  {
    "text": "and if you just want to kind of just",
    "start": "183599",
    "end": "184879"
  },
  {
    "text": "display all of these things it's going",
    "start": "184879",
    "end": "186640"
  },
  {
    "text": "to take 20 seconds to",
    "start": "186640",
    "end": "188000"
  },
  {
    "text": "just display them so any",
    "start": "188000",
    "end": "191280"
  },
  {
    "text": "simple kind of operation like doing a",
    "start": "191280",
    "end": "194800"
  },
  {
    "text": "sum on these or",
    "start": "194800",
    "end": "195920"
  },
  {
    "text": "doing a max of these is basically going",
    "start": "195920",
    "end": "198239"
  },
  {
    "text": "to be really reasonable",
    "start": "198239",
    "end": "199920"
  },
  {
    "text": "but you probably don't really care about",
    "start": "199920",
    "end": "201599"
  },
  {
    "text": "kind of the whole combination of all of",
    "start": "201599",
    "end": "203519"
  },
  {
    "text": "these metrics",
    "start": "203519",
    "end": "205040"
  },
  {
    "text": "so what you can do is this is an example",
    "start": "205040",
    "end": "207840"
  },
  {
    "text": "where you're going to just",
    "start": "207840",
    "end": "209120"
  },
  {
    "text": "taken the same metric and you've",
    "start": "209120",
    "end": "210560"
  },
  {
    "text": "aggregated them to just like a couple of",
    "start": "210560",
    "end": "212319"
  },
  {
    "text": "different labels",
    "start": "212319",
    "end": "213760"
  },
  {
    "text": "in this case a couple of labels we've",
    "start": "213760",
    "end": "215280"
  },
  {
    "text": "aggregated them are kind of the cluster",
    "start": "215280",
    "end": "217599"
  },
  {
    "text": "and kind of the name space the container",
    "start": "217599",
    "end": "219519"
  },
  {
    "text": "is in",
    "start": "219519",
    "end": "220720"
  },
  {
    "text": "uh if you're kind of using name spaces",
    "start": "220720",
    "end": "222879"
  },
  {
    "text": "as the place",
    "start": "222879",
    "end": "224480"
  },
  {
    "text": "like as a division of your services or",
    "start": "224480",
    "end": "226720"
  },
  {
    "text": "have like some",
    "start": "226720",
    "end": "227680"
  },
  {
    "text": "form of some form of division kind of",
    "start": "227680",
    "end": "230799"
  },
  {
    "text": "this gives you",
    "start": "230799",
    "end": "233439"
  },
  {
    "text": "like your cpu usage per customer or",
    "start": "233439",
    "end": "236959"
  },
  {
    "text": "tenant or",
    "start": "236959",
    "end": "238319"
  },
  {
    "text": "some yeah some notion of that",
    "start": "238319",
    "end": "241439"
  },
  {
    "text": "so this is probably good enough to tell",
    "start": "241439",
    "end": "243040"
  },
  {
    "text": "you how a particular like",
    "start": "243040",
    "end": "245519"
  },
  {
    "text": "portion of your uh code is actually",
    "start": "245519",
    "end": "247840"
  },
  {
    "text": "working",
    "start": "247840",
    "end": "248640"
  },
  {
    "text": "now this doesn't mean that we don't",
    "start": "248640",
    "end": "249920"
  },
  {
    "text": "actually want the underlying series",
    "start": "249920",
    "end": "251760"
  },
  {
    "text": "like when we actually have an issue uh",
    "start": "251760",
    "end": "254000"
  },
  {
    "text": "within a particular namespace and a",
    "start": "254000",
    "end": "255599"
  },
  {
    "text": "cluster you probably want those",
    "start": "255599",
    "end": "257120"
  },
  {
    "text": "underlying like individual series to",
    "start": "257120",
    "end": "259040"
  },
  {
    "text": "actually",
    "start": "259040",
    "end": "260160"
  },
  {
    "text": "uh go and like dig deep into that",
    "start": "260160",
    "end": "262000"
  },
  {
    "text": "namespace to see what's wrong",
    "start": "262000",
    "end": "264560"
  },
  {
    "text": "but just from a perspective kind of what",
    "start": "264560",
    "end": "266160"
  },
  {
    "text": "you want from the overview dashboard or",
    "start": "266160",
    "end": "268240"
  },
  {
    "text": "something you want to alert on this is",
    "start": "268240",
    "end": "270320"
  },
  {
    "text": "kind of what",
    "start": "270320",
    "end": "271840"
  },
  {
    "text": "you would want to see normally",
    "start": "271840",
    "end": "275840"
  },
  {
    "text": "so high quality metrics like as we see",
    "start": "275840",
    "end": "280720"
  },
  {
    "text": "it's just like have many dimensions and",
    "start": "280720",
    "end": "283680"
  },
  {
    "text": "can kind of be really",
    "start": "283680",
    "end": "285040"
  },
  {
    "text": "slow to query so really high quality",
    "start": "285040",
    "end": "288160"
  },
  {
    "text": "metrics are",
    "start": "288160",
    "end": "289440"
  },
  {
    "text": "something that just leads to slowing",
    "start": "289440",
    "end": "290960"
  },
  {
    "text": "dashboards uh the cardinality of",
    "start": "290960",
    "end": "293199"
  },
  {
    "text": "dimensions can keep increasing",
    "start": "293199",
    "end": "295759"
  },
  {
    "text": "as we add new instances roll out new",
    "start": "295759",
    "end": "297919"
  },
  {
    "text": "images",
    "start": "297919",
    "end": "298800"
  },
  {
    "text": "new instance tags show up new image tags",
    "start": "298800",
    "end": "301039"
  },
  {
    "text": "show up",
    "start": "301039",
    "end": "302479"
  },
  {
    "text": "these basically result in more number of",
    "start": "302479",
    "end": "304560"
  },
  {
    "text": "unique series",
    "start": "304560",
    "end": "306720"
  },
  {
    "text": "and as these new tags come up you just",
    "start": "306720",
    "end": "308960"
  },
  {
    "text": "keep having like an explosion of the",
    "start": "308960",
    "end": "310639"
  },
  {
    "text": "number of series",
    "start": "310639",
    "end": "312240"
  },
  {
    "text": "um if you want kind of craze which",
    "start": "312240",
    "end": "315680"
  },
  {
    "text": "are like spanning across time like",
    "start": "315680",
    "end": "318000"
  },
  {
    "text": "across days or",
    "start": "318000",
    "end": "319360"
  },
  {
    "text": "even like hours when like new rollouts",
    "start": "319360",
    "end": "321919"
  },
  {
    "text": "have happened",
    "start": "321919",
    "end": "323840"
  },
  {
    "text": "we just end up like crazy end up",
    "start": "323840",
    "end": "325680"
  },
  {
    "text": "capturing more and more underlying",
    "start": "325680",
    "end": "327039"
  },
  {
    "text": "series",
    "start": "327039",
    "end": "327840"
  },
  {
    "text": "eventually just leading to slowing",
    "start": "327840",
    "end": "329680"
  },
  {
    "text": "dashboards",
    "start": "329680",
    "end": "331840"
  },
  {
    "text": "so what we see as users is that this",
    "start": "331840",
    "end": "334560"
  },
  {
    "text": "dashboard which is really fast today",
    "start": "334560",
    "end": "336639"
  },
  {
    "text": "like over the next few weeks just keeps",
    "start": "336639",
    "end": "339199"
  },
  {
    "text": "on getting slower",
    "start": "339199",
    "end": "341120"
  },
  {
    "text": "eventually it leads to kind of a browser",
    "start": "341120",
    "end": "344639"
  },
  {
    "text": "like getting locked up uh and then",
    "start": "344639",
    "end": "348400"
  },
  {
    "text": "when you actually want to use these",
    "start": "348400",
    "end": "349680"
  },
  {
    "text": "dashboards and engineers then notices",
    "start": "349680",
    "end": "352080"
  },
  {
    "text": "this and then realizes",
    "start": "352080",
    "end": "353600"
  },
  {
    "text": "okay the dashboard needs to be optimized",
    "start": "353600",
    "end": "356960"
  },
  {
    "text": "so how do you actually kind of debug and",
    "start": "356960",
    "end": "359280"
  },
  {
    "text": "like approach this problem",
    "start": "359280",
    "end": "361120"
  },
  {
    "text": "uh the first step is to kind of figure",
    "start": "361120",
    "end": "362720"
  },
  {
    "text": "out which queries are the culprit",
    "start": "362720",
    "end": "365199"
  },
  {
    "text": "inspecting the requests from a dashboard",
    "start": "365199",
    "end": "368880"
  },
  {
    "text": "to look for these slow queries is a good",
    "start": "368880",
    "end": "370800"
  },
  {
    "text": "start you can do that in one of the",
    "start": "370800",
    "end": "373039"
  },
  {
    "text": "browser inspectors like chrome inspector",
    "start": "373039",
    "end": "375199"
  },
  {
    "text": "or firefox inspect",
    "start": "375199",
    "end": "377039"
  },
  {
    "text": "panel but even if you kind of know what",
    "start": "377039",
    "end": "380240"
  },
  {
    "text": "these queries are then kind of you have",
    "start": "380240",
    "end": "381680"
  },
  {
    "text": "to associate that back to the panels uh",
    "start": "381680",
    "end": "384000"
  },
  {
    "text": "on a last a large dashboard that's not",
    "start": "384000",
    "end": "385840"
  },
  {
    "text": "always easy",
    "start": "385840",
    "end": "387600"
  },
  {
    "text": "another option is to use the prometheus",
    "start": "387600",
    "end": "389680"
  },
  {
    "text": "query log",
    "start": "389680",
    "end": "391759"
  },
  {
    "text": "which kind of has information of all the",
    "start": "391759",
    "end": "393520"
  },
  {
    "text": "queries running in the system",
    "start": "393520",
    "end": "395440"
  },
  {
    "text": "uh if you're able to kind of parse that",
    "start": "395440",
    "end": "398240"
  },
  {
    "text": "information",
    "start": "398240",
    "end": "399039"
  },
  {
    "text": "then you can kind of associate that back",
    "start": "399039",
    "end": "401520"
  },
  {
    "text": "to a dashboard",
    "start": "401520",
    "end": "403440"
  },
  {
    "text": "but that again is kind of difficult",
    "start": "403440",
    "end": "406479"
  },
  {
    "text": "but once we figure out kind of which are",
    "start": "406479",
    "end": "408160"
  },
  {
    "text": "these which queries are actually the",
    "start": "408160",
    "end": "410000"
  },
  {
    "text": "culprit",
    "start": "410000",
    "end": "410720"
  },
  {
    "text": "uh we actually need to have a second",
    "start": "410720",
    "end": "412800"
  },
  {
    "text": "step and we need to decide that",
    "start": "412800",
    "end": "414560"
  },
  {
    "text": "we can actually pre-aggregate these",
    "start": "414560",
    "end": "416080"
  },
  {
    "text": "metrics uh to actually speed up the",
    "start": "416080",
    "end": "417919"
  },
  {
    "text": "queries",
    "start": "417919",
    "end": "419440"
  },
  {
    "text": "uh so let's kind of talk about like the",
    "start": "419440",
    "end": "422479"
  },
  {
    "start": "420000",
    "end": "580000"
  },
  {
    "text": "different options we have to kind of",
    "start": "422479",
    "end": "423919"
  },
  {
    "text": "aggregate metrics",
    "start": "423919",
    "end": "426400"
  },
  {
    "text": "so recording rules are probably the most",
    "start": "426400",
    "end": "429599"
  },
  {
    "text": "obvious option to",
    "start": "429599",
    "end": "430900"
  },
  {
    "text": "[Music]",
    "start": "430900",
    "end": "432240"
  },
  {
    "text": "aggregate metrics they basically are",
    "start": "432240",
    "end": "435199"
  },
  {
    "text": "supported by prometheus and allow",
    "start": "435199",
    "end": "436720"
  },
  {
    "text": "pre-computing like frequently needed",
    "start": "436720",
    "end": "438960"
  },
  {
    "text": "uh or like expensive queries",
    "start": "438960",
    "end": "442560"
  },
  {
    "text": "and they basically store back that great",
    "start": "442560",
    "end": "444960"
  },
  {
    "text": "time to restore the tstb",
    "start": "444960",
    "end": "446479"
  },
  {
    "text": "so if you actually want to like query",
    "start": "446479",
    "end": "449440"
  },
  {
    "text": "the information",
    "start": "449440",
    "end": "450720"
  },
  {
    "text": "you just make like simple queries which",
    "start": "450720",
    "end": "452800"
  },
  {
    "text": "just like pulls back a single time",
    "start": "452800",
    "end": "454400"
  },
  {
    "text": "series and so the queries get really",
    "start": "454400",
    "end": "456080"
  },
  {
    "text": "become really fast",
    "start": "456080",
    "end": "457919"
  },
  {
    "text": "uh once we do that you can just have",
    "start": "457919",
    "end": "459919"
  },
  {
    "text": "dashboards point back to kind of",
    "start": "459919",
    "end": "461919"
  },
  {
    "text": "pre-computer time series",
    "start": "461919",
    "end": "463599"
  },
  {
    "text": "uh the really cool thing about recording",
    "start": "463599",
    "end": "465199"
  },
  {
    "text": "rules is you basically have",
    "start": "465199",
    "end": "468080"
  },
  {
    "text": "the your you basically have the all of",
    "start": "468080",
    "end": "471120"
  },
  {
    "text": "like uh all of comql like functions",
    "start": "471120",
    "end": "474560"
  },
  {
    "text": "available to you",
    "start": "474560",
    "end": "475840"
  },
  {
    "text": "so you can do like anything as complex",
    "start": "475840",
    "end": "478319"
  },
  {
    "text": "as you want",
    "start": "478319",
    "end": "480400"
  },
  {
    "text": "to actually do your pre-computation an",
    "start": "480400",
    "end": "483440"
  },
  {
    "text": "example we give here",
    "start": "483440",
    "end": "484639"
  },
  {
    "text": "is we have these two metrics which is",
    "start": "484639",
    "end": "486560"
  },
  {
    "text": "kind of total and available bytes",
    "start": "486560",
    "end": "488879"
  },
  {
    "text": "but if you want a dashboard which is",
    "start": "488879",
    "end": "490560"
  },
  {
    "text": "just going to show you percentage used",
    "start": "490560",
    "end": "492960"
  },
  {
    "text": "then you can actually write a recording",
    "start": "492960",
    "end": "494479"
  },
  {
    "text": "rule which has does that",
    "start": "494479",
    "end": "496240"
  },
  {
    "text": "which basically has uh which is",
    "start": "496240",
    "end": "498800"
  },
  {
    "text": "basically doing a computation of like",
    "start": "498800",
    "end": "500639"
  },
  {
    "text": "total minus available divided by total",
    "start": "500639",
    "end": "502560"
  },
  {
    "text": "and then",
    "start": "502560",
    "end": "503120"
  },
  {
    "text": "kind of stores that back in this new",
    "start": "503120",
    "end": "505520"
  },
  {
    "text": "metric",
    "start": "505520",
    "end": "506319"
  },
  {
    "text": "and then the dashboard can just query",
    "start": "506319",
    "end": "507840"
  },
  {
    "text": "this individual metric",
    "start": "507840",
    "end": "510160"
  },
  {
    "text": "so recording rules basically they",
    "start": "510160",
    "end": "512240"
  },
  {
    "text": "execute and like",
    "start": "512240",
    "end": "513200"
  },
  {
    "text": "pre-compute the query at regular",
    "start": "513200",
    "end": "514479"
  },
  {
    "text": "intervals like as you define it",
    "start": "514479",
    "end": "516399"
  },
  {
    "text": "every minute 30 seconds you can probably",
    "start": "516399",
    "end": "519680"
  },
  {
    "text": "do it",
    "start": "519680",
    "end": "520240"
  },
  {
    "text": "at the same interval that things get",
    "start": "520240",
    "end": "522240"
  },
  {
    "text": "scraped so",
    "start": "522240",
    "end": "523279"
  },
  {
    "text": "all your metrics kind of can have the",
    "start": "523279",
    "end": "525040"
  },
  {
    "text": "same uh resolution",
    "start": "525040",
    "end": "527839"
  },
  {
    "text": "um the one kind of a couple of downsides",
    "start": "527839",
    "end": "532240"
  },
  {
    "text": "are like one probably downside with",
    "start": "532240",
    "end": "534480"
  },
  {
    "text": "recording rules is that",
    "start": "534480",
    "end": "536480"
  },
  {
    "text": "the underlying time series still need to",
    "start": "536480",
    "end": "538080"
  },
  {
    "text": "be stored in the tsdb",
    "start": "538080",
    "end": "539839"
  },
  {
    "text": "and the queries accessing many time",
    "start": "539839",
    "end": "541680"
  },
  {
    "text": "series can get expensive",
    "start": "541680",
    "end": "543279"
  },
  {
    "text": "so if we are actually aggregating across",
    "start": "543279",
    "end": "546480"
  },
  {
    "text": "many many time series then",
    "start": "546480",
    "end": "548480"
  },
  {
    "text": "the query itself may take tens of",
    "start": "548480",
    "end": "550160"
  },
  {
    "text": "seconds so",
    "start": "550160",
    "end": "552000"
  },
  {
    "text": "that kind of determines like how",
    "start": "552000",
    "end": "553600"
  },
  {
    "text": "frequently you can actually like",
    "start": "553600",
    "end": "556480"
  },
  {
    "text": "run your recording vocalize but there",
    "start": "556480",
    "end": "559440"
  },
  {
    "text": "are certain situations where",
    "start": "559440",
    "end": "561600"
  },
  {
    "text": "we do not necessarily need the",
    "start": "561600",
    "end": "563519"
  },
  {
    "text": "underlying metrics",
    "start": "563519",
    "end": "565040"
  },
  {
    "text": "uh and like the raw metrics can be",
    "start": "565040",
    "end": "567600"
  },
  {
    "text": "dropped and not stored",
    "start": "567600",
    "end": "569200"
  },
  {
    "text": "uh and we know we may not also care",
    "start": "569200",
    "end": "571519"
  },
  {
    "text": "about kind of the more complex queries",
    "start": "571519",
    "end": "573519"
  },
  {
    "text": "where recording rules are really",
    "start": "573519",
    "end": "574720"
  },
  {
    "text": "powerful",
    "start": "574720",
    "end": "575360"
  },
  {
    "text": "so for that kind of we want to go",
    "start": "575360",
    "end": "578480"
  },
  {
    "text": "i want to go over kind of the m3",
    "start": "578480",
    "end": "579839"
  },
  {
    "text": "aggregation tier",
    "start": "579839",
    "end": "581920"
  },
  {
    "start": "580000",
    "end": "1005000"
  },
  {
    "text": "which does not support kind of all the",
    "start": "581920",
    "end": "584399"
  },
  {
    "text": "functionality",
    "start": "584399",
    "end": "585279"
  },
  {
    "text": "that recording rules does but kind of",
    "start": "585279",
    "end": "587120"
  },
  {
    "text": "does it in a more",
    "start": "587120",
    "end": "588320"
  },
  {
    "text": "like does the aggregations in a",
    "start": "588320",
    "end": "589920"
  },
  {
    "text": "different style",
    "start": "589920",
    "end": "591519"
  },
  {
    "text": "uh so m3 basically is a remote storage",
    "start": "591519",
    "end": "594000"
  },
  {
    "text": "for prometheus",
    "start": "594000",
    "end": "595680"
  },
  {
    "text": "uh it basically kind of moves the",
    "start": "595680",
    "end": "598720"
  },
  {
    "text": "expensive recording rule computation",
    "start": "598720",
    "end": "600720"
  },
  {
    "text": "to a streaming aggregation tier so it's",
    "start": "600720",
    "end": "604000"
  },
  {
    "text": "not running the query engine itself but",
    "start": "604000",
    "end": "606480"
  },
  {
    "text": "rather",
    "start": "606480",
    "end": "607040"
  },
  {
    "text": "happens in a streaming aggregation tier",
    "start": "607040",
    "end": "608880"
  },
  {
    "text": "before metrics get persisted",
    "start": "608880",
    "end": "611440"
  },
  {
    "text": "uh the aggregator basically allows down",
    "start": "611440",
    "end": "613360"
  },
  {
    "text": "sampling dropping or aggregating metrics",
    "start": "613360",
    "end": "615760"
  },
  {
    "text": "prior to persisting them",
    "start": "615760",
    "end": "617120"
  },
  {
    "text": "to have remote storage in this case m3db",
    "start": "617120",
    "end": "621120"
  },
  {
    "text": "um the aggregation tier allows like",
    "start": "621120",
    "end": "624560"
  },
  {
    "text": "two types of uh aggregations uh one is",
    "start": "624560",
    "end": "627839"
  },
  {
    "text": "roll-up rules",
    "start": "627839",
    "end": "628720"
  },
  {
    "text": "which allow you to kind of aggregate",
    "start": "628720",
    "end": "631040"
  },
  {
    "text": "like a cross metrics",
    "start": "631040",
    "end": "632800"
  },
  {
    "text": "apply functions like sum max etc",
    "start": "632800",
    "end": "636000"
  },
  {
    "text": "and then mapping rules which have a",
    "start": "636000",
    "end": "638399"
  },
  {
    "text": "couple of different purposes for the",
    "start": "638399",
    "end": "639760"
  },
  {
    "text": "purpose of",
    "start": "639760",
    "end": "640880"
  },
  {
    "text": "this talk we're just going to talk about",
    "start": "640880",
    "end": "643440"
  },
  {
    "text": "them as",
    "start": "643440",
    "end": "644720"
  },
  {
    "text": "having the ability to drop metrics",
    "start": "644720",
    "end": "648319"
  },
  {
    "text": "so roll-up rules essentially they",
    "start": "648640",
    "end": "650560"
  },
  {
    "text": "contain a series of transforms",
    "start": "650560",
    "end": "652480"
  },
  {
    "text": "uh which are applied in order uh metrics",
    "start": "652480",
    "end": "655440"
  },
  {
    "text": "applied to them",
    "start": "655440",
    "end": "656800"
  },
  {
    "text": "like the metrics that that these roller",
    "start": "656800",
    "end": "659839"
  },
  {
    "text": "pools get applied on",
    "start": "659839",
    "end": "660959"
  },
  {
    "text": "kind of depends on a filter match uh now",
    "start": "660959",
    "end": "664240"
  },
  {
    "text": "roll-up rules kind of you have like",
    "start": "664240",
    "end": "665680"
  },
  {
    "text": "three different steps the first one is",
    "start": "665680",
    "end": "667440"
  },
  {
    "text": "to take a delta",
    "start": "667440",
    "end": "668480"
  },
  {
    "text": "the second one is kind of sum by like",
    "start": "668480",
    "end": "671040"
  },
  {
    "text": "the dimensions that you're interested in",
    "start": "671040",
    "end": "674160"
  },
  {
    "text": "and then finally kind of create a",
    "start": "674160",
    "end": "676560"
  },
  {
    "text": "monotonic uh",
    "start": "676560",
    "end": "678800"
  },
  {
    "text": "monotonic cumulative counter",
    "start": "678800",
    "end": "682720"
  },
  {
    "text": "so let's look at kind of what each of",
    "start": "683279",
    "end": "684720"
  },
  {
    "text": "these steps actually entail",
    "start": "684720",
    "end": "686800"
  },
  {
    "text": "the first step here which is called an",
    "start": "686800",
    "end": "689360"
  },
  {
    "text": "increased transform",
    "start": "689360",
    "end": "690560"
  },
  {
    "text": "is basically kind of taking the delta of",
    "start": "690560",
    "end": "692640"
  },
  {
    "text": "the underlying series",
    "start": "692640",
    "end": "694160"
  },
  {
    "text": "so the metrics which come in are",
    "start": "694160",
    "end": "696000"
  },
  {
    "text": "actually",
    "start": "696000",
    "end": "697279"
  },
  {
    "text": "monotonically increasing metrics as uh",
    "start": "697279",
    "end": "700320"
  },
  {
    "text": "all um as prometheus counters are",
    "start": "700320",
    "end": "704160"
  },
  {
    "text": "um so before they can actually be rolled",
    "start": "704160",
    "end": "706480"
  },
  {
    "text": "up we kind of need to get the deltas to",
    "start": "706480",
    "end": "708880"
  },
  {
    "text": "figure out kind of like",
    "start": "708880",
    "end": "710079"
  },
  {
    "text": "what the value is at the at the specific",
    "start": "710079",
    "end": "712959"
  },
  {
    "text": "times",
    "start": "712959",
    "end": "713680"
  },
  {
    "text": "so first step kind of like gives you",
    "start": "713680",
    "end": "715360"
  },
  {
    "text": "delta is for each of these",
    "start": "715360",
    "end": "717279"
  },
  {
    "text": "and these deltas are kind of sent over",
    "start": "717279",
    "end": "719040"
  },
  {
    "text": "to the roll-up",
    "start": "719040",
    "end": "720639"
  },
  {
    "text": "the roll-up basically now takes these",
    "start": "720639",
    "end": "722639"
  },
  {
    "text": "deltas and then",
    "start": "722639",
    "end": "723760"
  },
  {
    "text": "they sum by the unique dimensions",
    "start": "723760",
    "end": "726000"
  },
  {
    "text": "specified in the group by",
    "start": "726000",
    "end": "729120"
  },
  {
    "text": "for the container cpu usage we basically",
    "start": "729120",
    "end": "731680"
  },
  {
    "text": "want to",
    "start": "731680",
    "end": "732399"
  },
  {
    "text": "sum them up by container name and",
    "start": "732399",
    "end": "734000"
  },
  {
    "text": "namespace so we're going to just",
    "start": "734000",
    "end": "736320"
  },
  {
    "text": "like sum them up back into our name and",
    "start": "736320",
    "end": "738399"
  },
  {
    "text": "namespace and",
    "start": "738399",
    "end": "740079"
  },
  {
    "text": "we want to do an activation is just some",
    "start": "740079",
    "end": "742959"
  },
  {
    "text": "so that's what kind of this roll-up step",
    "start": "742959",
    "end": "744880"
  },
  {
    "text": "is",
    "start": "744880",
    "end": "745839"
  },
  {
    "text": "so once we have these kind of delta sums",
    "start": "745839",
    "end": "748160"
  },
  {
    "text": "or sums of deltas",
    "start": "748160",
    "end": "750320"
  },
  {
    "text": "the next step is kind of transform them",
    "start": "750320",
    "end": "752160"
  },
  {
    "text": "back into the monotonically increasing",
    "start": "752160",
    "end": "756319"
  },
  {
    "text": "format that to actually store them to",
    "start": "757120",
    "end": "759760"
  },
  {
    "text": "make them compatible prometheus again",
    "start": "759760",
    "end": "763200"
  },
  {
    "text": "so the last one does basically a",
    "start": "763200",
    "end": "765200"
  },
  {
    "text": "cumulative add of these metrics",
    "start": "765200",
    "end": "766959"
  },
  {
    "text": "uh to end up with like an aggregated",
    "start": "766959",
    "end": "769839"
  },
  {
    "text": "time series",
    "start": "769839",
    "end": "771040"
  },
  {
    "text": "uh this is basically sent to m3db um",
    "start": "771040",
    "end": "774800"
  },
  {
    "text": "and the namespace essentially identifies",
    "start": "774800",
    "end": "778240"
  },
  {
    "text": "like",
    "start": "778240",
    "end": "778639"
  },
  {
    "text": "where to actually store this with an m3b",
    "start": "778639",
    "end": "780880"
  },
  {
    "text": "it's a yeah",
    "start": "780880",
    "end": "783680"
  },
  {
    "text": "so the second thing is now we've been",
    "start": "783920",
    "end": "786639"
  },
  {
    "text": "able to roll these up",
    "start": "786639",
    "end": "788639"
  },
  {
    "text": "and we've actually been able to roll",
    "start": "788639",
    "end": "790000"
  },
  {
    "text": "these up before uh",
    "start": "790000",
    "end": "792240"
  },
  {
    "text": "persisting the raw metrics for storage",
    "start": "792240",
    "end": "795040"
  },
  {
    "text": "so",
    "start": "795040",
    "end": "795360"
  },
  {
    "text": "mapping rules now come in and they kind",
    "start": "795360",
    "end": "797440"
  },
  {
    "text": "of allow us to drop these metrics",
    "start": "797440",
    "end": "799519"
  },
  {
    "text": "based on a particular filter you don't",
    "start": "799519",
    "end": "802720"
  },
  {
    "text": "have to do this",
    "start": "802720",
    "end": "803760"
  },
  {
    "text": "but in the case where you kind of don't",
    "start": "803760",
    "end": "805200"
  },
  {
    "text": "want the original unaggregated series",
    "start": "805200",
    "end": "808320"
  },
  {
    "text": "this kind of can save a lot of storage",
    "start": "808320",
    "end": "810720"
  },
  {
    "text": "space so if you actually don't want the",
    "start": "810720",
    "end": "812320"
  },
  {
    "text": "per container",
    "start": "812320",
    "end": "815120"
  },
  {
    "text": "cpu information then like or",
    "start": "815120",
    "end": "818639"
  },
  {
    "text": "rather you don't want kind of the other",
    "start": "818639",
    "end": "820399"
  },
  {
    "text": "dimensions of the cpu information here",
    "start": "820399",
    "end": "823040"
  },
  {
    "text": "then you can kind of sum that metric has",
    "start": "823040",
    "end": "825440"
  },
  {
    "text": "already been stored",
    "start": "825440",
    "end": "827600"
  },
  {
    "text": "and you can say like with a similar",
    "start": "827600",
    "end": "829839"
  },
  {
    "text": "filter that i just want",
    "start": "829839",
    "end": "831360"
  },
  {
    "text": "all the original series to be dropped so",
    "start": "831360",
    "end": "833760"
  },
  {
    "text": "it's just a space-saving thing",
    "start": "833760",
    "end": "836079"
  },
  {
    "text": "the other kind of neat thing about doing",
    "start": "836079",
    "end": "838720"
  },
  {
    "text": "this",
    "start": "838720",
    "end": "839199"
  },
  {
    "text": "is that if we do something like this we",
    "start": "839199",
    "end": "841839"
  },
  {
    "text": "can actually",
    "start": "841839",
    "end": "842560"
  },
  {
    "text": "store the aggregate series with the same",
    "start": "842560",
    "end": "845360"
  },
  {
    "text": "name as the original metric",
    "start": "845360",
    "end": "847120"
  },
  {
    "text": "so depending on how the dashboard",
    "start": "847120",
    "end": "849440"
  },
  {
    "text": "queries are set up",
    "start": "849440",
    "end": "851279"
  },
  {
    "text": "you potentially can speed up dashboards",
    "start": "851279",
    "end": "853199"
  },
  {
    "text": "without even",
    "start": "853199",
    "end": "854639"
  },
  {
    "text": "making any changes to them",
    "start": "854639",
    "end": "858079"
  },
  {
    "text": "so quick summary of aggregation tier",
    "start": "858079",
    "end": "860079"
  },
  {
    "text": "essentially allows for ingestion time",
    "start": "860079",
    "end": "862079"
  },
  {
    "text": "streaming aggregation uh the metrics can",
    "start": "862079",
    "end": "864880"
  },
  {
    "text": "be aggregated rolled up based on defined",
    "start": "864880",
    "end": "866800"
  },
  {
    "text": "rules",
    "start": "866800",
    "end": "868639"
  },
  {
    "text": "and raw metrics can basically be dropped",
    "start": "868639",
    "end": "871760"
  },
  {
    "text": "based on like whatever matching filters",
    "start": "871760",
    "end": "874320"
  },
  {
    "text": "uh by using mapping rules",
    "start": "874320",
    "end": "877199"
  },
  {
    "text": "uh just a quick kind of uh comparison",
    "start": "877199",
    "end": "880480"
  },
  {
    "text": "between both of these",
    "start": "880480",
    "end": "882240"
  },
  {
    "text": "recording rules obviously the biggest",
    "start": "882240",
    "end": "884560"
  },
  {
    "text": "advantage really is that their general",
    "start": "884560",
    "end": "886560"
  },
  {
    "text": "purpose and kind of support full prom ql",
    "start": "886560",
    "end": "889680"
  },
  {
    "text": "uh they're a bit expensive um because",
    "start": "889680",
    "end": "892240"
  },
  {
    "text": "they run against the query engine so",
    "start": "892240",
    "end": "894160"
  },
  {
    "text": "they may affect other queries role pools",
    "start": "894160",
    "end": "896240"
  },
  {
    "text": "are also expensive but they just",
    "start": "896240",
    "end": "898399"
  },
  {
    "text": "can't happen to happen happen to",
    "start": "898399",
    "end": "902000"
  },
  {
    "text": "occur kind of at a different stage of",
    "start": "902000",
    "end": "903680"
  },
  {
    "text": "the pipeline so",
    "start": "903680",
    "end": "905120"
  },
  {
    "text": "they don't affect kind of queries",
    "start": "905120",
    "end": "906560"
  },
  {
    "text": "themselves",
    "start": "906560",
    "end": "908800"
  },
  {
    "text": "the one kind of thing is like all the",
    "start": "908800",
    "end": "911360"
  },
  {
    "text": "data",
    "start": "911360",
    "end": "912000"
  },
  {
    "text": "has to be stored so there's a higher",
    "start": "912000",
    "end": "914320"
  },
  {
    "text": "storage cost",
    "start": "914320",
    "end": "915680"
  },
  {
    "text": "um as against kind of roll-up rules",
    "start": "915680",
    "end": "918320"
  },
  {
    "text": "where",
    "start": "918320",
    "end": "919600"
  },
  {
    "text": "you don't necessarily need to store all",
    "start": "919600",
    "end": "921600"
  },
  {
    "text": "the data",
    "start": "921600",
    "end": "923440"
  },
  {
    "text": "scroll up rules in general are kind of",
    "start": "923440",
    "end": "925680"
  },
  {
    "text": "more efficient to run as an injection",
    "start": "925680",
    "end": "927440"
  },
  {
    "text": "time aggregation",
    "start": "927440",
    "end": "928560"
  },
  {
    "text": "or at least kind of it separates it out",
    "start": "928560",
    "end": "930560"
  },
  {
    "text": "into a separate",
    "start": "930560",
    "end": "932320"
  },
  {
    "text": "separate piece of software",
    "start": "932320",
    "end": "935360"
  },
  {
    "text": "it gives them really only strong",
    "start": "935360",
    "end": "936639"
  },
  {
    "text": "aggregates",
    "start": "936639",
    "end": "938639"
  },
  {
    "text": "if we only store the aggregates then you",
    "start": "938639",
    "end": "940880"
  },
  {
    "text": "can potentially speed up dashboards and",
    "start": "940880",
    "end": "942800"
  },
  {
    "text": "queries",
    "start": "942800",
    "end": "943920"
  },
  {
    "text": "uh because they can have the same metric",
    "start": "943920",
    "end": "945440"
  },
  {
    "text": "name but really the biggest downside is",
    "start": "945440",
    "end": "947440"
  },
  {
    "text": "it does not support full prompt ql",
    "start": "947440",
    "end": "949040"
  },
  {
    "text": "uh but only specific rate so if you have",
    "start": "949040",
    "end": "951360"
  },
  {
    "text": "a sam or a max then",
    "start": "951360",
    "end": "953040"
  },
  {
    "text": "yes this works really well uh",
    "start": "953040",
    "end": "956160"
  },
  {
    "text": "with kind of more complicated like",
    "start": "956160",
    "end": "958399"
  },
  {
    "text": "functions in prom ql",
    "start": "958399",
    "end": "959839"
  },
  {
    "text": "like you want to divide like two",
    "start": "959839",
    "end": "961440"
  },
  {
    "text": "different series",
    "start": "961440",
    "end": "962959"
  },
  {
    "text": "uh less in our example earlier then yeah",
    "start": "962959",
    "end": "966240"
  },
  {
    "text": "these don't really work",
    "start": "966240",
    "end": "968320"
  },
  {
    "text": "now but either of these cases um",
    "start": "968320",
    "end": "972399"
  },
  {
    "text": "there are challenges using them you kind",
    "start": "972399",
    "end": "974320"
  },
  {
    "text": "of need to figure out kind of what to",
    "start": "974320",
    "end": "975680"
  },
  {
    "text": "pre-compute",
    "start": "975680",
    "end": "977199"
  },
  {
    "text": "uh and for that you need to figure out",
    "start": "977199",
    "end": "979040"
  },
  {
    "text": "bad queries by analyzing dashboards",
    "start": "979040",
    "end": "982079"
  },
  {
    "text": "then you need to kind of configure the",
    "start": "982079",
    "end": "983519"
  },
  {
    "text": "aggregation rules",
    "start": "983519",
    "end": "985519"
  },
  {
    "text": "change the dashboard to query for",
    "start": "985519",
    "end": "986880"
  },
  {
    "text": "aggregated metrics",
    "start": "986880",
    "end": "989600"
  },
  {
    "text": "after you do all that",
    "start": "989600",
    "end": "991200"
  },
  {
    "text": "[Music]",
    "start": "991200",
    "end": "992720"
  },
  {
    "text": "you may have not gone and changed every",
    "start": "992720",
    "end": "994320"
  },
  {
    "text": "panel so what happens when metric",
    "start": "994320",
    "end": "996079"
  },
  {
    "text": "changes or a second panel becomes slow",
    "start": "996079",
    "end": "998480"
  },
  {
    "text": "you end up having to repeat the process",
    "start": "998480",
    "end": "1000079"
  },
  {
    "text": "all over again",
    "start": "1000079",
    "end": "1002160"
  },
  {
    "text": "so really is it possible to do this",
    "start": "1002160",
    "end": "1004480"
  },
  {
    "text": "automatically",
    "start": "1004480",
    "end": "1005360"
  },
  {
    "start": "1005000",
    "end": "1155000"
  },
  {
    "text": "and we're going to show you a way where",
    "start": "1005360",
    "end": "1007839"
  },
  {
    "text": "we can kind of do something",
    "start": "1007839",
    "end": "1009839"
  },
  {
    "text": "reasonably automatically",
    "start": "1009839",
    "end": "1012880"
  },
  {
    "text": "so to start with we have a couple of",
    "start": "1012880",
    "end": "1015199"
  },
  {
    "text": "graphs here",
    "start": "1015199",
    "end": "1017839"
  },
  {
    "text": "which which are continuously updating",
    "start": "1018399",
    "end": "1021120"
  },
  {
    "text": "now",
    "start": "1021120",
    "end": "1023199"
  },
  {
    "text": "they're generated using this tool or",
    "start": "1023199",
    "end": "1025120"
  },
  {
    "text": "prominent workbench which",
    "start": "1025120",
    "end": "1026558"
  },
  {
    "text": "just generates some synthetic metrics uh",
    "start": "1026559",
    "end": "1029520"
  },
  {
    "text": "one is kind of disk usage and the other",
    "start": "1029520",
    "end": "1031600"
  },
  {
    "text": "is a cpu usage metric",
    "start": "1031600",
    "end": "1033520"
  },
  {
    "text": "uh and uh have like two queries which",
    "start": "1033520",
    "end": "1036959"
  },
  {
    "text": "are kind of running",
    "start": "1036959",
    "end": "1038720"
  },
  {
    "text": "uh max of the disk",
    "start": "1038720",
    "end": "1041918"
  },
  {
    "text": "by a measurement type below we have two",
    "start": "1041919",
    "end": "1044798"
  },
  {
    "text": "panels recording rules and we'll show",
    "start": "1044799",
    "end": "1046400"
  },
  {
    "text": "you kind of how these recording rules",
    "start": "1046400",
    "end": "1047839"
  },
  {
    "text": "can get populated",
    "start": "1047839",
    "end": "1049200"
  },
  {
    "text": "automatically um it's coming here we",
    "start": "1049200",
    "end": "1053120"
  },
  {
    "text": "have prom remote bench running which is",
    "start": "1053120",
    "end": "1054640"
  },
  {
    "text": "like continuously",
    "start": "1054640",
    "end": "1055919"
  },
  {
    "text": "like emitting metrics which are scraped",
    "start": "1055919",
    "end": "1057760"
  },
  {
    "text": "by a prometheus instance we have here",
    "start": "1057760",
    "end": "1060320"
  },
  {
    "text": "and in this tab we kind of have a high",
    "start": "1060320",
    "end": "1062000"
  },
  {
    "text": "power analogy analyzer that",
    "start": "1062000",
    "end": "1064080"
  },
  {
    "text": "uh we can actually run uh so we have the",
    "start": "1064080",
    "end": "1068240"
  },
  {
    "text": "analyzer kind of set up to run in a loop",
    "start": "1068240",
    "end": "1071520"
  },
  {
    "text": "um it's gonna run the high chrono",
    "start": "1071520",
    "end": "1074559"
  },
  {
    "text": "analyzer",
    "start": "1074559",
    "end": "1075440"
  },
  {
    "text": "it's pointing to the query log that",
    "start": "1075440",
    "end": "1076880"
  },
  {
    "text": "prometheus is running with",
    "start": "1076880",
    "end": "1079440"
  },
  {
    "text": "uh has a couple of different parameters",
    "start": "1079440",
    "end": "1081280"
  },
  {
    "text": "here and it's indicating that you have",
    "start": "1081280",
    "end": "1082960"
  },
  {
    "text": "to",
    "start": "1082960",
    "end": "1083280"
  },
  {
    "text": "generate recording rules and push it",
    "start": "1083280",
    "end": "1086400"
  },
  {
    "text": "into",
    "start": "1086400",
    "end": "1086799"
  },
  {
    "text": "kind of the primitive cycle analogy",
    "start": "1086799",
    "end": "1088720"
  },
  {
    "text": "rules",
    "start": "1088720",
    "end": "1090160"
  },
  {
    "text": "and then it curls and kind of reloads",
    "start": "1090160",
    "end": "1091679"
  },
  {
    "text": "the prometheus config and",
    "start": "1091679",
    "end": "1093520"
  },
  {
    "text": "this kind of keeps doing it so",
    "start": "1093520",
    "end": "1097760"
  },
  {
    "text": "if you're on the analyzer what this is",
    "start": "1097760",
    "end": "1099360"
  },
  {
    "text": "going to do is it's going to look at the",
    "start": "1099360",
    "end": "1100720"
  },
  {
    "text": "parameters query log it's going to go",
    "start": "1100720",
    "end": "1102240"
  },
  {
    "text": "figure out kind of",
    "start": "1102240",
    "end": "1103440"
  },
  {
    "text": "which queries are things that it can",
    "start": "1103440",
    "end": "1105679"
  },
  {
    "text": "actually change",
    "start": "1105679",
    "end": "1107600"
  },
  {
    "text": "and then based on that it's going to go",
    "start": "1107600",
    "end": "1109120"
  },
  {
    "text": "and like generate recording rules",
    "start": "1109120",
    "end": "1111360"
  },
  {
    "text": "uh so if you can see like what this is",
    "start": "1111360",
    "end": "1113600"
  },
  {
    "text": "actually generated it's basically the",
    "start": "1113600",
    "end": "1115120"
  },
  {
    "text": "indirect recording",
    "start": "1115120",
    "end": "1116320"
  },
  {
    "text": "through python analyzer group uh",
    "start": "1116320",
    "end": "1119280"
  },
  {
    "text": "generated a couple of different rules",
    "start": "1119280",
    "end": "1122720"
  },
  {
    "text": "for kind of both the queries that we",
    "start": "1122720",
    "end": "1124400"
  },
  {
    "text": "have so if we kind of go back to the",
    "start": "1124400",
    "end": "1126400"
  },
  {
    "text": "dashboard",
    "start": "1126400",
    "end": "1127280"
  },
  {
    "text": "now we'll actually",
    "start": "1127280",
    "end": "1131039"
  },
  {
    "text": "very soon maybe let's kind of look at",
    "start": "1131039",
    "end": "1134240"
  },
  {
    "text": "the last five minutes you kind of see",
    "start": "1134240",
    "end": "1136559"
  },
  {
    "text": "these recording rules show up",
    "start": "1136559",
    "end": "1138400"
  },
  {
    "text": "uh so what this is basically done is",
    "start": "1138400",
    "end": "1140480"
  },
  {
    "text": "kind of taking the prometheus query log",
    "start": "1140480",
    "end": "1142000"
  },
  {
    "text": "figured out what to do and just",
    "start": "1142000",
    "end": "1143840"
  },
  {
    "text": "automatically kind of added these",
    "start": "1143840",
    "end": "1145440"
  },
  {
    "text": "recording rules",
    "start": "1145440",
    "end": "1146960"
  },
  {
    "text": "um so let's talk a bit about kind of how",
    "start": "1146960",
    "end": "1149840"
  },
  {
    "text": "this is actually possible",
    "start": "1149840",
    "end": "1151280"
  },
  {
    "text": "so let's kind of jump back uh to our",
    "start": "1151280",
    "end": "1153840"
  },
  {
    "text": "slides",
    "start": "1153840",
    "end": "1155200"
  },
  {
    "text": "um so fundamentally what we're doing is",
    "start": "1155200",
    "end": "1158960"
  },
  {
    "text": "we're basically analyzing the parameters",
    "start": "1158960",
    "end": "1160799"
  },
  {
    "text": "query log",
    "start": "1160799",
    "end": "1161520"
  },
  {
    "text": "um and making decisions on like",
    "start": "1161520",
    "end": "1165039"
  },
  {
    "text": "how to actually uh",
    "start": "1165039",
    "end": "1168400"
  },
  {
    "text": "speak like on making decisions and what",
    "start": "1168400",
    "end": "1170559"
  },
  {
    "text": "to actually speed up",
    "start": "1170559",
    "end": "1172080"
  },
  {
    "text": "uh so we want to log so premier's query",
    "start": "1172080",
    "end": "1174559"
  },
  {
    "text": "log basically logs",
    "start": "1174559",
    "end": "1176000"
  },
  {
    "text": "all queries run by the promptql engine",
    "start": "1176000",
    "end": "1179280"
  },
  {
    "text": "uh it provides like a bunch of times",
    "start": "1179280",
    "end": "1182559"
  },
  {
    "text": "like the total evaluation time the",
    "start": "1182559",
    "end": "1184320"
  },
  {
    "text": "amount of time it's",
    "start": "1184320",
    "end": "1185280"
  },
  {
    "text": "spent in the queue like the preparation",
    "start": "1185280",
    "end": "1187520"
  },
  {
    "text": "time for the query and kind of just the",
    "start": "1187520",
    "end": "1189679"
  },
  {
    "text": "evaluation of the inner kind of",
    "start": "1189679",
    "end": "1191840"
  },
  {
    "text": "expression",
    "start": "1191840",
    "end": "1193200"
  },
  {
    "text": "so it has detailed information about",
    "start": "1193200",
    "end": "1194880"
  },
  {
    "text": "kind of all steps of the actual curve",
    "start": "1194880",
    "end": "1197440"
  },
  {
    "text": "itself",
    "start": "1197440",
    "end": "1198080"
  },
  {
    "text": "on the right side is kind of a simple",
    "start": "1198080",
    "end": "1199600"
  },
  {
    "text": "example for a particular query kind of",
    "start": "1199600",
    "end": "1201520"
  },
  {
    "text": "like",
    "start": "1201520",
    "end": "1202240"
  },
  {
    "text": "how these timings end up showing up",
    "start": "1202240",
    "end": "1205280"
  },
  {
    "text": "so what the analyzer does is it's",
    "start": "1205280",
    "end": "1207440"
  },
  {
    "text": "basically an offline process",
    "start": "1207440",
    "end": "1209120"
  },
  {
    "text": "which helps us generate recording or",
    "start": "1209120",
    "end": "1210880"
  },
  {
    "text": "roll-up rules",
    "start": "1210880",
    "end": "1212240"
  },
  {
    "text": "uh uses the prometheus query log to find",
    "start": "1212240",
    "end": "1215039"
  },
  {
    "text": "different candidates for aggregation",
    "start": "1215039",
    "end": "1217760"
  },
  {
    "text": "and then it provides recommendations for",
    "start": "1217760",
    "end": "1219520"
  },
  {
    "text": "recording rules or",
    "start": "1219520",
    "end": "1221280"
  },
  {
    "text": "m3 aggregated roll up or mapping rules",
    "start": "1221280",
    "end": "1223440"
  },
  {
    "text": "to kind of speed up expensive queries",
    "start": "1223440",
    "end": "1226320"
  },
  {
    "text": "um how does it actually do this",
    "start": "1226320",
    "end": "1229520"
  },
  {
    "text": "uh it goes over like days of prometheus",
    "start": "1229520",
    "end": "1232480"
  },
  {
    "text": "query logs",
    "start": "1232480",
    "end": "1234000"
  },
  {
    "text": "um it kind of finds the most commonly",
    "start": "1234000",
    "end": "1237600"
  },
  {
    "text": "hit expensive queries",
    "start": "1237600",
    "end": "1239760"
  },
  {
    "text": "how it determines expensive queries is",
    "start": "1239760",
    "end": "1242000"
  },
  {
    "text": "basically",
    "start": "1242000",
    "end": "1242799"
  },
  {
    "text": "kind of evaluation time like how much",
    "start": "1242799",
    "end": "1244720"
  },
  {
    "text": "time it took to kind of evaluate the",
    "start": "1244720",
    "end": "1246400"
  },
  {
    "text": "query",
    "start": "1246400",
    "end": "1248799"
  },
  {
    "text": "if the query is expensive",
    "start": "1249120",
    "end": "1252159"
  },
  {
    "text": "then you kind of need to figure out if",
    "start": "1252159",
    "end": "1253679"
  },
  {
    "text": "it's a candidate for aggregation",
    "start": "1253679",
    "end": "1256159"
  },
  {
    "text": "that basically depends on the cost of",
    "start": "1256159",
    "end": "1259520"
  },
  {
    "text": "the query",
    "start": "1259520",
    "end": "1260080"
  },
  {
    "text": "is it due to the like so cost over is",
    "start": "1260080",
    "end": "1263520"
  },
  {
    "text": "probably due to the number of series",
    "start": "1263520",
    "end": "1265679"
  },
  {
    "text": "but if we're occurring like 10 000",
    "start": "1265679",
    "end": "1268240"
  },
  {
    "text": "series from the tsdb",
    "start": "1268240",
    "end": "1269840"
  },
  {
    "text": "and we're returning 10 000 series then",
    "start": "1269840",
    "end": "1272240"
  },
  {
    "text": "there's no aggregation really like",
    "start": "1272240",
    "end": "1274400"
  },
  {
    "text": "worthwhile aggregation to do there on",
    "start": "1274400",
    "end": "1276720"
  },
  {
    "text": "the other hand",
    "start": "1276720",
    "end": "1277440"
  },
  {
    "text": "if the query has a bunch of",
    "start": "1277440",
    "end": "1280799"
  },
  {
    "text": "sum max or different aggregation",
    "start": "1280799",
    "end": "1283200"
  },
  {
    "text": "functions or it's doing operations like",
    "start": "1283200",
    "end": "1285200"
  },
  {
    "text": "divides and multiplies",
    "start": "1285200",
    "end": "1288320"
  },
  {
    "text": "then there's kind of an additional cost",
    "start": "1288320",
    "end": "1290000"
  },
  {
    "text": "to this kind of like",
    "start": "1290000",
    "end": "1291520"
  },
  {
    "text": "other than just just retrieving the",
    "start": "1291520",
    "end": "1293760"
  },
  {
    "text": "series so",
    "start": "1293760",
    "end": "1294559"
  },
  {
    "text": "it kind of goes and looks at um",
    "start": "1294559",
    "end": "1298320"
  },
  {
    "text": "what gets returned from the query and",
    "start": "1298320",
    "end": "1300080"
  },
  {
    "text": "like how much how many are there",
    "start": "1300080",
    "end": "1301840"
  },
  {
    "text": "like how many series underlying series",
    "start": "1301840",
    "end": "1303919"
  },
  {
    "text": "is the query actually capturing",
    "start": "1303919",
    "end": "1305760"
  },
  {
    "text": "and based on that it determines if like",
    "start": "1305760",
    "end": "1308080"
  },
  {
    "text": "it's worthwhile to actually make this",
    "start": "1308080",
    "end": "1309919"
  },
  {
    "text": "and the application also",
    "start": "1309919",
    "end": "1312960"
  },
  {
    "text": "allows you to like put in a couple of",
    "start": "1312960",
    "end": "1315120"
  },
  {
    "text": "different parameters there",
    "start": "1315120",
    "end": "1316799"
  },
  {
    "text": "for example i think in the example we",
    "start": "1316799",
    "end": "1318320"
  },
  {
    "text": "had was we're looking for",
    "start": "1318320",
    "end": "1320480"
  },
  {
    "text": "at least like a couple of queries which",
    "start": "1320480",
    "end": "1322400"
  },
  {
    "text": "have taken more than a second to run",
    "start": "1322400",
    "end": "1324320"
  },
  {
    "text": "and that's when it like kicks off the",
    "start": "1324320",
    "end": "1327840"
  },
  {
    "text": "optimization",
    "start": "1327840",
    "end": "1330080"
  },
  {
    "text": "so goal for the tool is to kind of",
    "start": "1330080",
    "end": "1332000"
  },
  {
    "text": "provide proposals for recording a rollup",
    "start": "1332000",
    "end": "1334720"
  },
  {
    "text": "rules",
    "start": "1334720",
    "end": "1336000"
  },
  {
    "text": "and then users are kind of free to",
    "start": "1336000",
    "end": "1337679"
  },
  {
    "text": "configure these rules as necessary",
    "start": "1337679",
    "end": "1340320"
  },
  {
    "text": "uh if we do end up using recording rules",
    "start": "1340320",
    "end": "1343440"
  },
  {
    "text": "or roller crews and dashboards and other",
    "start": "1343440",
    "end": "1346000"
  },
  {
    "text": "places kind of need to be changed",
    "start": "1346000",
    "end": "1348720"
  },
  {
    "text": "they need to be changed after that but",
    "start": "1348720",
    "end": "1351840"
  },
  {
    "text": "the tool is kind of a baseline thing and",
    "start": "1351840",
    "end": "1353679"
  },
  {
    "text": "then like you're kind of free to go and",
    "start": "1353679",
    "end": "1355600"
  },
  {
    "text": "like extend it and kind of incorporate",
    "start": "1355600",
    "end": "1357520"
  },
  {
    "text": "it into kind of whatever workflows",
    "start": "1357520",
    "end": "1359520"
  },
  {
    "text": "that make sense to you um yeah so that's",
    "start": "1359520",
    "end": "1362799"
  },
  {
    "text": "kind of what the tool is",
    "start": "1362799",
    "end": "1364559"
  },
  {
    "text": "some resources this is a link to where",
    "start": "1364559",
    "end": "1367440"
  },
  {
    "text": "tool is hosted",
    "start": "1367440",
    "end": "1369440"
  },
  {
    "text": "like feel free to kind of take a look",
    "start": "1369440",
    "end": "1371360"
  },
  {
    "text": "and give us suggestions and help us",
    "start": "1371360",
    "end": "1373360"
  },
  {
    "text": "improve it",
    "start": "1373360",
    "end": "1374559"
  },
  {
    "text": "a couple of other resources are kind of",
    "start": "1374559",
    "end": "1376640"
  },
  {
    "text": "around like",
    "start": "1376640",
    "end": "1377760"
  },
  {
    "text": "what recording rules are and why they're",
    "start": "1377760",
    "end": "1379600"
  },
  {
    "text": "useful and",
    "start": "1379600",
    "end": "1381120"
  },
  {
    "text": "uh there's also a help here on kind of",
    "start": "1381120",
    "end": "1383440"
  },
  {
    "text": "the mt aggregator",
    "start": "1383440",
    "end": "1386240"
  },
  {
    "text": "and yeah thank you uh thanks a lot for",
    "start": "1386240",
    "end": "1389280"
  },
  {
    "text": "your time",
    "start": "1389280",
    "end": "1390559"
  },
  {
    "text": "and yeah uh thanks for being here and",
    "start": "1390559",
    "end": "1394159"
  },
  {
    "text": "uh we're open to questions now bye",
    "start": "1394159",
    "end": "1398960"
  }
]