[
  {
    "text": "yeah so hello everyone and thanks for",
    "start": "240",
    "end": "4000"
  },
  {
    "text": "coming to the talk and to the conference",
    "start": "4000",
    "end": "6480"
  },
  {
    "text": "so I'm",
    "start": "6480",
    "end": "7519"
  },
  {
    "text": "Martinez we are both long time celum",
    "start": "7519",
    "end": "10799"
  },
  {
    "text": "contributors and besides being",
    "start": "10799",
    "end": "12719"
  },
  {
    "text": "passionate about celum and ebpf we are",
    "start": "12719",
    "end": "15280"
  },
  {
    "text": "also passionate about skiing so yeah",
    "start": "15280",
    "end": "18400"
  },
  {
    "text": "today's talk is going to be about some",
    "start": "18400",
    "end": "21199"
  },
  {
    "text": "changes to the simus control plane also",
    "start": "21199",
    "end": "24039"
  },
  {
    "text": "known andum agent and in particular it's",
    "start": "24039",
    "end": "27000"
  },
  {
    "text": "about improving the resilience and fall",
    "start": "27000",
    "end": "29400"
  },
  {
    "text": "tolerant of selum agent which is one of",
    "start": "29400",
    "end": "32599"
  },
  {
    "text": "the most critical components in your",
    "start": "32599",
    "end": "34840"
  },
  {
    "text": "kubernetes clusters so let's start with",
    "start": "34840",
    "end": "37559"
  },
  {
    "text": "the",
    "start": "37559",
    "end": "39600"
  },
  {
    "text": "demo uh full screen okay uh yeah so we",
    "start": "39600",
    "end": "44600"
  },
  {
    "text": "have a kubernetes cluster basically",
    "start": "44600",
    "end": "47039"
  },
  {
    "text": "running some clients some server po all",
    "start": "47039",
    "end": "50079"
  },
  {
    "text": "of them communicating to Cluster IP and",
    "start": "50079",
    "end": "53079"
  },
  {
    "text": "all of a sudden you get",
    "start": "53079",
    "end": "55160"
  },
  {
    "text": "paged something is bro broken like some",
    "start": "55160",
    "end": "57920"
  },
  {
    "text": "apps are not working uh",
    "start": "57920",
    "end": "60920"
  },
  {
    "text": "you've start troubleshooting and I",
    "start": "60920",
    "end": "63760"
  },
  {
    "text": "highly suggest you don't do this bottom",
    "start": "63760",
    "end": "65478"
  },
  {
    "text": "up approach where you start",
    "start": "65479",
    "end": "67680"
  },
  {
    "text": "disassembling BPF programs or he",
    "start": "67680",
    "end": "69880"
  },
  {
    "text": "stomping BPF Maps but you start with",
    "start": "69880",
    "end": "72600"
  },
  {
    "text": "something more reasonable like top down",
    "start": "72600",
    "end": "74520"
  },
  {
    "text": "approach where you start looking into",
    "start": "74520",
    "end": "77119"
  },
  {
    "text": "cium dashboard and in this dashboard we",
    "start": "77119",
    "end": "80360"
  },
  {
    "text": "see that there are some drops happening",
    "start": "80360",
    "end": "82960"
  },
  {
    "text": "and the drops are happening because of",
    "start": "82960",
    "end": "85000"
  },
  {
    "text": "the service backend not found so",
    "start": "85000",
    "end": "87040"
  },
  {
    "text": "something related to service load",
    "start": "87040",
    "end": "88920"
  },
  {
    "text": "balancing",
    "start": "88920",
    "end": "90560"
  },
  {
    "text": "and then if we scroll down yeah we see",
    "start": "90560",
    "end": "93720"
  },
  {
    "text": "the metric is going up so then we scroll",
    "start": "93720",
    "end": "96360"
  },
  {
    "text": "down and we see that some agents are",
    "start": "96360",
    "end": "99159"
  },
  {
    "text": "reporting that the state is being uh",
    "start": "99159",
    "end": "101840"
  },
  {
    "text": "degraded so something is wrong and then",
    "start": "101840",
    "end": "105719"
  },
  {
    "text": "if we keep going through the dashboard",
    "start": "105719",
    "end": "108439"
  },
  {
    "text": "we see that some of the BPF Maps which",
    "start": "108439",
    "end": "111799"
  },
  {
    "text": "are responsible for services got full so",
    "start": "111799",
    "end": "115560"
  },
  {
    "text": "this is quite typical scenario and we",
    "start": "115560",
    "end": "117560"
  },
  {
    "text": "see this happening with policy Maps for",
    "start": "117560",
    "end": "120119"
  },
  {
    "text": "instance and sometimes with service",
    "start": "120119",
    "end": "122399"
  },
  {
    "text": "maps and then the component which is",
    "start": "122399",
    "end": "125280"
  },
  {
    "text": "responsible for writing to those ppf",
    "start": "125280",
    "end": "127920"
  },
  {
    "text": "Maps starts to report errors we see the",
    "start": "127920",
    "end": "131039"
  },
  {
    "text": "error counters going up over the time",
    "start": "131039",
    "end": "134360"
  },
  {
    "text": "and we see that there were recently some",
    "start": "134360",
    "end": "137040"
  },
  {
    "text": "up lots of update operations so this",
    "start": "137040",
    "end": "140400"
  },
  {
    "text": "operation duration for the service for",
    "start": "140400",
    "end": "143720"
  },
  {
    "text": "update and next we use a bit of a low",
    "start": "143720",
    "end": "149640"
  },
  {
    "text": "level tool we dive into one of the",
    "start": "149640",
    "end": "153680"
  },
  {
    "text": "nodes and we dump the status so the",
    "start": "153680",
    "end": "156959"
  },
  {
    "text": "health information and then we see that",
    "start": "156959",
    "end": "160319"
  },
  {
    "text": "one reconciler which is responsible for",
    "start": "160319",
    "end": "163599"
  },
  {
    "text": "service Maps updates reports a",
    "start": "163599",
    "end": "167400"
  },
  {
    "text": "failure and",
    "start": "167400",
    "end": "169720"
  },
  {
    "text": "then let's look into the state so",
    "start": "169720",
    "end": "174760"
  },
  {
    "text": "we'll be talking a lot about this new",
    "start": "174760",
    "end": "178159"
  },
  {
    "text": "components called stateb industry stock",
    "start": "178159",
    "end": "180840"
  },
  {
    "text": "and we can see that the desired state is",
    "start": "180840",
    "end": "185840"
  },
  {
    "text": "not being realized for the service Maps",
    "start": "185840",
    "end": "189480"
  },
  {
    "text": "so we clearly see that the BPF map is",
    "start": "189480",
    "end": "192640"
  },
  {
    "text": "full so this is this gives us a lot of",
    "start": "192640",
    "end": "196680"
  },
  {
    "text": "hints that this we might have too many",
    "start": "196680",
    "end": "200519"
  },
  {
    "text": "services in the cluster so either we",
    "start": "200519",
    "end": "203319"
  },
  {
    "text": "need to increase the BPF Map size or",
    "start": "203319",
    "end": "206120"
  },
  {
    "text": "delete some and for the demo for simp",
    "start": "206120",
    "end": "208879"
  },
  {
    "text": "simplicity let's delete some",
    "start": "208879",
    "end": "213519"
  },
  {
    "text": "Services yeah it's pre-recorded because",
    "start": "218879",
    "end": "221319"
  },
  {
    "text": "a lot of typing is",
    "start": "221319",
    "end": "224239"
  },
  {
    "text": "needed okay and then let's go back to",
    "start": "224239",
    "end": "229599"
  },
  {
    "text": "the dashboard and we see",
    "start": "229599",
    "end": "233000"
  },
  {
    "text": "that let's wait a",
    "start": "233000",
    "end": "236799"
  },
  {
    "text": "bit and we see that the Adrian are in",
    "start": "236840",
    "end": "240599"
  },
  {
    "text": "okay State and we see that the maps are",
    "start": "240599",
    "end": "243519"
  },
  {
    "text": "no longer full and we should see the",
    "start": "243519",
    "end": "246959"
  },
  {
    "text": "drops",
    "start": "246959",
    "end": "249959"
  },
  {
    "text": "decreasing yeah I should come yeah so",
    "start": "254640",
    "end": "259919"
  },
  {
    "text": "cluster is getting back to the healthy",
    "start": "259919",
    "end": "263120"
  },
  {
    "text": "State okay let's go back to the talk so",
    "start": "263120",
    "end": "265800"
  },
  {
    "text": "before we dive into the details how Pro",
    "start": "265800",
    "end": "269759"
  },
  {
    "text": "tip for next speaker charge your oh",
    "start": "269759",
    "end": "273560"
  },
  {
    "text": "man so okay so before we dive into the",
    "start": "273560",
    "end": "276720"
  },
  {
    "text": "details how this was implemented some",
    "start": "276720",
    "end": "280120"
  },
  {
    "text": "historical context so started as a",
    "start": "280120",
    "end": "283240"
  },
  {
    "text": "simple cni with observability and",
    "start": "283240",
    "end": "286160"
  },
  {
    "text": "Security in",
    "start": "286160",
    "end": "287400"
  },
  {
    "text": "mind and one differentiating technology",
    "start": "287400",
    "end": "290880"
  },
  {
    "text": "was BPF and with BPF we we were very",
    "start": "290880",
    "end": "297039"
  },
  {
    "text": "flexible what we can do we can basically",
    "start": "297039",
    "end": "299720"
  },
  {
    "text": "take any network packet and do any",
    "start": "299720",
    "end": "302360"
  },
  {
    "text": "modifications we want to do so then",
    "start": "302360",
    "end": "305120"
  },
  {
    "text": "after solving the cni",
    "start": "305120",
    "end": "307240"
  },
  {
    "text": "problems we started looking into",
    "start": "307240",
    "end": "309520"
  },
  {
    "text": "kubernetes generic networking problems",
    "start": "309520",
    "end": "312199"
  },
  {
    "text": "and you probably remember this picture",
    "start": "312199",
    "end": "314360"
  },
  {
    "text": "from a long time",
    "start": "314360",
    "end": "316039"
  },
  {
    "text": "ago",
    "start": "316039",
    "end": "317919"
  },
  {
    "text": "and what happened next is basically",
    "start": "317919",
    "end": "321160"
  },
  {
    "text": "imagine bunch of very curious and",
    "start": "321160",
    "end": "324240"
  },
  {
    "text": "motivated Engineers you give give to",
    "start": "324240",
    "end": "328039"
  },
  {
    "text": "them this powerful tool BPF and then",
    "start": "328039",
    "end": "331840"
  },
  {
    "text": "also give to them very interesting",
    "start": "331840",
    "end": "334319"
  },
  {
    "text": "problems in the networking space so of",
    "start": "334319",
    "end": "336479"
  },
  {
    "text": "course all of them will get eventually",
    "start": "336479",
    "end": "338560"
  },
  {
    "text": "solved so that what happened to",
    "start": "338560",
    "end": "341520"
  },
  {
    "text": " and I would probably yeah claim that",
    "start": "341520",
    "end": "347560"
  },
  {
    "text": "majority of networking problems are",
    "start": "347560",
    "end": "349840"
  },
  {
    "text": "solved today kubernetes networking",
    "start": "349840",
    "end": "351840"
  },
  {
    "text": "problems are solved today by and the",
    "start": "351840",
    "end": "355160"
  },
  {
    "text": "nice thing about it that in your cluster",
    "start": "355160",
    "end": "357199"
  },
  {
    "text": "you can just run a single component you",
    "start": "357199",
    "end": "359240"
  },
  {
    "text": "don't have multiple different components",
    "start": "359240",
    "end": "361560"
  },
  {
    "text": "and making sure that they nicely",
    "start": "361560",
    "end": "363240"
  },
  {
    "text": "interact with with each other but the",
    "start": "363240",
    "end": "366319"
  },
  {
    "text": "downside of that that the project became",
    "start": "366319",
    "end": "368680"
  },
  {
    "text": "quite",
    "start": "368680",
    "end": "369960"
  },
  {
    "text": "complex uh but if you look under the",
    "start": "369960",
    "end": "373720"
  },
  {
    "text": "hood of you see that's fairly like",
    "start": "373720",
    "end": "377479"
  },
  {
    "text": "the workflow is fairly simple so we have",
    "start": "377479",
    "end": "380240"
  },
  {
    "text": "this agent running on some host getting",
    "start": "380240",
    "end": "384199"
  },
  {
    "text": "updates from kubernetes API server from",
    "start": "384199",
    "end": "387919"
  },
  {
    "text": "some other components like s cluster",
    "start": "387919",
    "end": "390520"
  },
  {
    "text": "mesh parsing those updates and then",
    "start": "390520",
    "end": "393840"
  },
  {
    "text": "writing to a local BPF Maps which are",
    "start": "393840",
    "end": "396680"
  },
  {
    "text": "used for by selum BPF data plane and of",
    "start": "396680",
    "end": "401199"
  },
  {
    "text": "course many things can go wrong like we",
    "start": "401199",
    "end": "404479"
  },
  {
    "text": "can we might lose the",
    "start": "404479",
    "end": "406599"
  },
  {
    "text": "connectivity to API server API server",
    "start": "406599",
    "end": "409680"
  },
  {
    "text": "might get overloaded or even the CIS",
    "start": "409680",
    "end": "411680"
  },
  {
    "text": "calls to the BPF infr structure might",
    "start": "411680",
    "end": "414319"
  },
  {
    "text": "fail so for instance a host run outs of",
    "start": "414319",
    "end": "417000"
  },
  {
    "text": "memory for a short period of time so",
    "start": "417000",
    "end": "420160"
  },
  {
    "text": "yeah I'll give a microphone to yussi who",
    "start": "420160",
    "end": "422919"
  },
  {
    "text": "will talk about how we deal with those",
    "start": "422919",
    "end": "425639"
  },
  {
    "text": "failures all right so we're kind of",
    "start": "425639",
    "end": "427840"
  },
  {
    "text": "zooming into the uh bottommost picture",
    "start": "427840",
    "end": "430440"
  },
  {
    "text": "here how this stent U manage the",
    "start": "430440",
    "end": "432639"
  },
  {
    "text": "reconciliation into the ppf maps so",
    "start": "432639",
    "end": "435560"
  },
  {
    "text": "let's take a simple example of uh",
    "start": "435560",
    "end": "438240"
  },
  {
    "text": "kubernetes API server giving us an event",
    "start": "438240",
    "end": "440440"
  },
  {
    "text": "about a kubernetes service being created",
    "start": "440440",
    "end": "442960"
  },
  {
    "text": "and then we want to write it into the",
    "start": "442960",
    "end": "445440"
  },
  {
    "text": "services ppf map so one thing the agent",
    "start": "445440",
    "end": "448240"
  },
  {
    "text": "could be doing here is just directly",
    "start": "448240",
    "end": "450160"
  },
  {
    "text": "doing this is cool writing it in as res",
    "start": "450160",
    "end": "452599"
  },
  {
    "text": "to event but this doesn't really work",
    "start": "452599",
    "end": "454680"
  },
  {
    "text": "out since well the map might be full and",
    "start": "454680",
    "end": "456800"
  },
  {
    "text": "might not be able to do this operation",
    "start": "456800",
    "end": "459000"
  },
  {
    "text": "right then and there uh so we might need",
    "start": "459000",
    "end": "461240"
  },
  {
    "text": "need to retry it in the future so we",
    "start": "461240",
    "end": "463199"
  },
  {
    "text": "need something in between here so we",
    "start": "463199",
    "end": "465879"
  },
  {
    "text": "need to store the event and in some data",
    "start": "465879",
    "end": "468159"
  },
  {
    "text": "store and then Shadle the reconciliation",
    "start": "468159",
    "end": "472080"
  },
  {
    "text": "separately um so if you kind of look at",
    "start": "472080",
    "end": "475599"
  },
  {
    "text": "the architectural picture here so this",
    "start": "475599",
    "end": "478199"
  },
  {
    "text": "desired State kind of things into two we",
    "start": "478199",
    "end": "480680"
  },
  {
    "text": "have a on top uh control plane which",
    "start": "480680",
    "end": "483840"
  },
  {
    "text": "receives the events from different",
    "start": "483840",
    "end": "485560"
  },
  {
    "text": "sources API server clous APS of uh rest",
    "start": "485560",
    "end": "489879"
  },
  {
    "text": "API and so on um it digests the events",
    "start": "489879",
    "end": "494039"
  },
  {
    "text": "and computes the desired State and then",
    "start": "494039",
    "end": "496479"
  },
  {
    "text": "on the bottom we have the part that then",
    "start": "496479",
    "end": "498840"
  },
  {
    "text": "applies the Desir State um into the",
    "start": "498840",
    "end": "501919"
  },
  {
    "text": "system and many parts of the agent have",
    "start": "501919",
    "end": "504400"
  },
  {
    "text": "been like written in this pattern and in",
    "start": "504400",
    "end": "506919"
  },
  {
    "text": "many different ways so what we've been",
    "start": "506919",
    "end": "508800"
  },
  {
    "text": "exploring is like how do we unify this",
    "start": "508800",
    "end": "511280"
  },
  {
    "text": "and how do we get um observability out",
    "start": "511280",
    "end": "514680"
  },
  {
    "text": "of this how do we know things are",
    "start": "514680",
    "end": "516080"
  },
  {
    "text": "failing how do we uh extract Health um",
    "start": "516080",
    "end": "520039"
  },
  {
    "text": "so when so we're going to talk about how",
    "start": "520039",
    "end": "523159"
  },
  {
    "text": "to implement the desire state in a way",
    "start": "523159",
    "end": "524760"
  },
  {
    "text": "that we have uh good tools for",
    "start": "524760",
    "end": "527440"
  },
  {
    "text": "inspecting it and then we're going to",
    "start": "527440",
    "end": "529080"
  },
  {
    "text": "talk about later about the reconciler",
    "start": "529080",
    "end": "531440"
  },
  {
    "text": "and having a single implementation for",
    "start": "531440",
    "end": "533240"
  },
  {
    "text": "it allows us to extract health and",
    "start": "533240",
    "end": "535399"
  },
  {
    "text": "metrics out of it and get a better",
    "start": "535399",
    "end": "536760"
  },
  {
    "text": "picture of what's going on in the system",
    "start": "536760",
    "end": "539200"
  },
  {
    "text": "so so jumping into uh the desired State",
    "start": "539200",
    "end": "544079"
  },
  {
    "text": "how how you implement this so so it's an",
    "start": "544079",
    "end": "546640"
  },
  {
    "text": "inmemory database so instead of kind of",
    "start": "546640",
    "end": "549160"
  },
  {
    "text": "traditionally writing things write your",
    "start": "549160",
    "end": "551240"
  },
  {
    "text": "hashmap blcks uh your subscriber Buton",
    "start": "551240",
    "end": "554720"
  },
  {
    "text": "and so on uh from scratch instead we we",
    "start": "554720",
    "end": "557079"
  },
  {
    "text": "go for for a database approach uh that",
    "start": "557079",
    "end": "559760"
  },
  {
    "text": "does these things for you uh it's",
    "start": "559760",
    "end": "562120"
  },
  {
    "text": "transactional which allows doing rights",
    "start": "562120",
    "end": "564720"
  },
  {
    "text": "in a single transaction which can then",
    "start": "564720",
    "end": "566360"
  },
  {
    "text": "be observed as a batch um by the reader",
    "start": "566360",
    "end": "569680"
  },
  {
    "text": "which improves",
    "start": "569680",
    "end": "570959"
  },
  {
    "text": "trut um if everything stored immutable",
    "start": "570959",
    "end": "574320"
  },
  {
    "text": "in state DB uh in immutable trees which",
    "start": "574320",
    "end": "577519"
  },
  {
    "text": "allows for lockless readers so then once",
    "start": "577519",
    "end": "580399"
  },
  {
    "text": "we add more and more code into this",
    "start": "580399",
    "end": "582959"
  },
  {
    "text": "we're not worried about readers holding",
    "start": "582959",
    "end": "585000"
  },
  {
    "text": "holding locks too long or doing crazy",
    "start": "585000",
    "end": "586680"
  },
  {
    "text": "things in callbacks and um stopping",
    "start": "586680",
    "end": "588680"
  },
  {
    "text": "process Pro progress from",
    "start": "588680",
    "end": "590760"
  },
  {
    "text": "happening and everything is revisioned",
    "start": "590760",
    "end": "593240"
  },
  {
    "text": "so it can it allows us to query things",
    "start": "593240",
    "end": "596200"
  },
  {
    "text": "as they change over",
    "start": "596200",
    "end": "598160"
  },
  {
    "text": "time and then there's a way of of seeing",
    "start": "598160",
    "end": "601720"
  },
  {
    "text": "if things change so there's a channel",
    "start": "601720",
    "end": "603519"
  },
  {
    "text": "based notification mechanism uh which",
    "start": "603519",
    "end": "606079"
  },
  {
    "text": "tells us when something in changes and",
    "start": "606079",
    "end": "608600"
  },
  {
    "text": "can allow us to wake up the the reader",
    "start": "608600",
    "end": "611360"
  },
  {
    "text": "and and do more",
    "start": "611360",
    "end": "613040"
  },
  {
    "text": "work uh internally it looks like this so",
    "start": "613040",
    "end": "616079"
  },
  {
    "text": "you have uh registry things are kind of",
    "start": "616079",
    "end": "619880"
  },
  {
    "text": "uh uh",
    "start": "619880",
    "end": "622360"
  },
  {
    "text": "prefix uh indexed so then if you search",
    "start": "622360",
    "end": "625079"
  },
  {
    "text": "for something you do a bite wise look up",
    "start": "625079",
    "end": "627600"
  },
  {
    "text": "um and then on modifications you do a",
    "start": "627600",
    "end": "629519"
  },
  {
    "text": "clone of the change part of the tree so",
    "start": "629519",
    "end": "631959"
  },
  {
    "text": "then when you're inserting something",
    "start": "631959",
    "end": "633480"
  },
  {
    "text": "existing readers are never",
    "start": "633480",
    "end": "636320"
  },
  {
    "text": "affected so I'm going to take a give a",
    "start": "636320",
    "end": "639440"
  },
  {
    "text": "good example of quick example of how",
    "start": "639440",
    "end": "641519"
  },
  {
    "text": "does the code look like how to use it",
    "start": "641519",
    "end": "643480"
  },
  {
    "text": "from go um so to create a table you",
    "start": "643480",
    "end": "646720"
  },
  {
    "text": "first start by defining your data type",
    "start": "646720",
    "end": "649399"
  },
  {
    "text": "and this can be anything from structs to",
    "start": "649399",
    "end": "651440"
  },
  {
    "text": "anything more complicated um uh you",
    "start": "651440",
    "end": "654360"
  },
  {
    "text": "define your index you define two two",
    "start": "654360",
    "end": "657639"
  },
  {
    "text": "methods telling State DP how do you gr",
    "start": "657639",
    "end": "660399"
  },
  {
    "text": "from your custom data type into the",
    "start": "660399",
    "end": "663320"
  },
  {
    "text": "internal database key and keys here are",
    "start": "663320",
    "end": "666279"
  },
  {
    "text": "essentially Su spite slices and then the",
    "start": "666279",
    "end": "669399"
  },
  {
    "text": "second thing you define is how do you go",
    "start": "669399",
    "end": "671560"
  },
  {
    "text": "from a search key which can be again any",
    "start": "671560",
    "end": "674680"
  },
  {
    "text": "any data type you want um any type of",
    "start": "674680",
    "end": "677200"
  },
  {
    "text": "query you want how do you go from that",
    "start": "677200",
    "end": "679399"
  },
  {
    "text": "into a database key and then finally you",
    "start": "679399",
    "end": "682200"
  },
  {
    "text": "can create a table giving it a name and",
    "start": "682200",
    "end": "684399"
  },
  {
    "text": "the primary index and optionally any",
    "start": "684399",
    "end": "686600"
  },
  {
    "text": "number of secondary",
    "start": "686600",
    "end": "688079"
  },
  {
    "text": "indices um then with the cre table",
    "start": "688079",
    "end": "691000"
  },
  {
    "text": "created we can do",
    "start": "691000",
    "end": "692600"
  },
  {
    "text": "queries um so for example if we' have a",
    "start": "692600",
    "end": "696160"
  },
  {
    "text": "table of services and we've indexed it",
    "start": "696160",
    "end": "698760"
  },
  {
    "text": "by namespace uh we can do a querying",
    "start": "698760",
    "end": "701200"
  },
  {
    "text": "using the namespace index uh and get all",
    "start": "701200",
    "end": "704200"
  },
  {
    "text": "services in the default",
    "start": "704200",
    "end": "706680"
  },
  {
    "text": "namespace um and we get it back an",
    "start": "706680",
    "end": "709279"
  },
  {
    "text": "iterator which hopefully soon with range",
    "start": "709279",
    "end": "712079"
  },
  {
    "text": "Funk uh proposal gets even nicer um and",
    "start": "712079",
    "end": "716200"
  },
  {
    "text": "here we get our service object and we",
    "start": "716200",
    "end": "718320"
  },
  {
    "text": "get a revision so we can use the",
    "start": "718320",
    "end": "719800"
  },
  {
    "text": "revision to see if if something",
    "start": "719800",
    "end": "721959"
  },
  {
    "text": "changed and then we get a watch channel",
    "start": "721959",
    "end": "725440"
  },
  {
    "text": "which when it closes tells us that now",
    "start": "725440",
    "end": "727760"
  },
  {
    "text": "this query you did is invalidated",
    "start": "727760",
    "end": "729639"
  },
  {
    "text": "there's something changed in this index",
    "start": "729639",
    "end": "731560"
  },
  {
    "text": "and you need to query",
    "start": "731560",
    "end": "733560"
  },
  {
    "text": "again so with that we",
    "start": "733560",
    "end": "736120"
  },
  {
    "text": "have a common API for building all sort",
    "start": "736120",
    "end": "739519"
  },
  {
    "text": "of useful tools that are not dependent",
    "start": "739519",
    "end": "741880"
  },
  {
    "text": "on the data type itself and one of them",
    "start": "741880",
    "end": "744959"
  },
  {
    "text": "we can demoed there the the reconciler",
    "start": "744959",
    "end": "747680"
  },
  {
    "text": "so I'm going to jump into the",
    "start": "747680",
    "end": "749680"
  },
  {
    "text": "reconciliation topic now um so",
    "start": "749680",
    "end": "753680"
  },
  {
    "text": "reconciler is a as a reusable utility",
    "start": "753680",
    "end": "757000"
  },
  {
    "text": "you you point it at a state DV table um",
    "start": "757000",
    "end": "761120"
  },
  {
    "text": "and you tell it what kind of things to",
    "start": "761120",
    "end": "762920"
  },
  {
    "text": "do with the objects so for example um if",
    "start": "762920",
    "end": "766440"
  },
  {
    "text": "we have a backend object um we need to",
    "start": "766440",
    "end": "770240"
  },
  {
    "text": "define the update delete and prune",
    "start": "770240",
    "end": "772839"
  },
  {
    "text": "operations for it for the rec consolid",
    "start": "772839",
    "end": "774600"
  },
  {
    "text": "work so for example here an update",
    "start": "774600",
    "end": "777079"
  },
  {
    "text": "operation could be simply uh um a ppf",
    "start": "777079",
    "end": "780240"
  },
  {
    "text": "map update for example",
    "start": "780240",
    "end": "783720"
  },
  {
    "text": "and um and I delete just a map delete or",
    "start": "783720",
    "end": "787040"
  },
  {
    "text": "this could be more complicated",
    "start": "787040",
    "end": "788240"
  },
  {
    "text": "multi-step operations or it could be a",
    "start": "788240",
    "end": "790639"
  },
  {
    "text": "network call and so",
    "start": "790639",
    "end": "792399"
  },
  {
    "text": "on and let's look at how failures now",
    "start": "792399",
    "end": "796079"
  },
  {
    "text": "would be we handle so let's say our ppf",
    "start": "796079",
    "end": "798680"
  },
  {
    "text": "Map update fails we get an Enos space",
    "start": "798680",
    "end": "801959"
  },
  {
    "text": "from the",
    "start": "801959",
    "end": "802959"
  },
  {
    "text": "system this would be then propagated",
    "start": "802959",
    "end": "806079"
  },
  {
    "text": "upwards the update meth uh method would",
    "start": "806079",
    "end": "808160"
  },
  {
    "text": "fail Rec would then um shutle a retry at",
    "start": "808160",
    "end": "812440"
  },
  {
    "text": "a later time it would then update",
    "start": "812440",
    "end": "815800"
  },
  {
    "text": "metrics and health it would like we saw",
    "start": "815800",
    "end": "818199"
  },
  {
    "text": "in the demo at the beginning we saw the",
    "start": "818199",
    "end": "820079"
  },
  {
    "text": "error count going up there was something",
    "start": "820079",
    "end": "822399"
  },
  {
    "text": "failing then the agent Health would",
    "start": "822399",
    "end": "825120"
  },
  {
    "text": "would be reported as decorated the",
    "start": "825120",
    "end": "827000"
  },
  {
    "text": "reconciler cannot reconcile all the",
    "start": "827000",
    "end": "829079"
  },
  {
    "text": "objects and then finally the failing",
    "start": "829079",
    "end": "832519"
  },
  {
    "text": "status would be written back in the",
    "start": "832519",
    "end": "834639"
  },
  {
    "text": "state DP and that can be",
    "start": "834639",
    "end": "837320"
  },
  {
    "text": "inspected um we saw that quickly in the",
    "start": "837320",
    "end": "839680"
  },
  {
    "text": "demo and here is it again so we can",
    "start": "839680",
    "end": "844040"
  },
  {
    "text": "through S debach look at any of these",
    "start": "844040",
    "end": "846279"
  },
  {
    "text": "tables uh and dump them and and we can",
    "start": "846279",
    "end": "849079"
  },
  {
    "text": "watch it over time so that's also",
    "start": "849079",
    "end": "851839"
  },
  {
    "text": "something that revisioning gives us that",
    "start": "851839",
    "end": "853199"
  },
  {
    "text": "we can we can watch for for new things",
    "start": "853199",
    "end": "855240"
  },
  {
    "text": "to to arrive so in principle this is",
    "start": "855240",
    "end": "858720"
  },
  {
    "text": "like very very similar to to what you",
    "start": "858720",
    "end": "861399"
  },
  {
    "text": "get with CET well very similar Concepts",
    "start": "861399",
    "end": "863959"
  },
  {
    "text": "in apis just internally inter agent and",
    "start": "863959",
    "end": "866639"
  },
  {
    "text": "you have the same flexibility for for",
    "start": "866639",
    "end": "869199"
  },
  {
    "text": "adding new new compon components to it",
    "start": "869199",
    "end": "871199"
  },
  {
    "text": "and same guarantees that you are not",
    "start": "871199",
    "end": "873600"
  },
  {
    "text": "going to interact with other components",
    "start": "873600",
    "end": "875519"
  },
  {
    "text": "in the",
    "start": "875519",
    "end": "877800"
  },
  {
    "text": "system all right we're getting into",
    "start": "877959",
    "end": "881040"
  },
  {
    "text": "summary um so what we saw showed here",
    "start": "881040",
    "end": "884560"
  },
  {
    "text": "was uh example of the infastructure",
    "start": "884560",
    "end": "887279"
  },
  {
    "text": "um so we saw State DP and the ability to",
    "start": "887279",
    "end": "891079"
  },
  {
    "text": "inspect it we saw the reconcil in action",
    "start": "891079",
    "end": "894639"
  },
  {
    "text": "and we saw the agent Health which is",
    "start": "894639",
    "end": "896959"
  },
  {
    "text": "also a new component um and in 116 we're",
    "start": "896959",
    "end": "901079"
  },
  {
    "text": "going to have first use case for this so",
    "start": "901079",
    "end": "903360"
  },
  {
    "text": "a lot of work's been done around uh",
    "start": "903360",
    "end": "906000"
  },
  {
    "text": "device detection and uh node addresses",
    "start": "906000",
    "end": "908959"
  },
  {
    "text": "so a lot of the issues are are being",
    "start": "908959",
    "end": "912040"
  },
  {
    "text": "solved where agent wasn't reacting to",
    "start": "912040",
    "end": "914680"
  },
  {
    "text": "device and IP address changes so these",
    "start": "914680",
    "end": "916320"
  },
  {
    "text": "are now being solved with these tools um",
    "start": "916320",
    "end": "919240"
  },
  {
    "text": "and yeah new features are highly",
    "start": "919240",
    "end": "921320"
  },
  {
    "text": "encouraged to start leveraging this to",
    "start": "921320",
    "end": "923639"
  },
  {
    "text": "get better observability and and",
    "start": "923639",
    "end": "927959"
  },
  {
    "text": "resilience",
    "start": "927959",
    "end": "929720"
  },
  {
    "text": "all right thank",
    "start": "929720",
    "end": "932639"
  },
  {
    "text": "you and bottom there's a link if you're",
    "start": "938079",
    "end": "941040"
  },
  {
    "text": "interested in like how this is",
    "start": "941040",
    "end": "942959"
  },
  {
    "text": "implemented on the details uh you can",
    "start": "942959",
    "end": "945720"
  },
  {
    "text": "look at the repository and there's an",
    "start": "945720",
    "end": "947399"
  },
  {
    "text": "example there um that shows a fairly",
    "start": "947399",
    "end": "950399"
  },
  {
    "text": "complicated uh example",
    "start": "950399",
    "end": "953839"
  },
  {
    "text": "there all right any",
    "start": "953839",
    "end": "957480"
  },
  {
    "text": "questions",
    "start": "957920",
    "end": "960920"
  },
  {
    "text": "yep good morning good morning thank you",
    "start": "972440",
    "end": "975199"
  },
  {
    "text": "for the presentation um a question about",
    "start": "975199",
    "end": "977120"
  },
  {
    "text": "the state be uh new memory database and",
    "start": "977120",
    "end": "980399"
  },
  {
    "text": "yeah I'm interested to know how you can",
    "start": "980399",
    "end": "982360"
  },
  {
    "text": "guarantee say consistency or",
    "start": "982360",
    "end": "984440"
  },
  {
    "text": "availability of the the data that you",
    "start": "984440",
    "end": "986240"
  },
  {
    "text": "store in the uh the state be so so it's",
    "start": "986240",
    "end": "989920"
  },
  {
    "text": "really meant to",
    "start": "989920",
    "end": "991800"
  },
  {
    "text": "replace kind of handroll stores of state",
    "start": "991800",
    "end": "994319"
  },
  {
    "text": "within the agent so it's a replacement",
    "start": "994319",
    "end": "995680"
  },
  {
    "text": "for hashmaps and protected by mutexes",
    "start": "995680",
    "end": "998560"
  },
  {
    "text": "and and modifications mechanism around",
    "start": "998560",
    "end": "1000800"
  },
  {
    "text": "that so so we have the same same",
    "start": "1000800",
    "end": "1004000"
  },
  {
    "text": "requirements there so it's all in memory",
    "start": "1004000",
    "end": "1006199"
  },
  {
    "text": "so if the agent restarts it rebuilds the",
    "start": "1006199",
    "end": "1008600"
  },
  {
    "text": "the whole state from",
    "start": "1008600",
    "end": "1009920"
  },
  {
    "text": "scratch and we basically puras the state",
    "start": "1009920",
    "end": "1012800"
  },
  {
    "text": "in BPF maps and each time s agent",
    "start": "1012800",
    "end": "1015600"
  },
  {
    "text": "restores it restores the state from BPF",
    "start": "1015600",
    "end": "1018959"
  },
  {
    "text": "Maps QP API server and other",
    "start": "1018959",
    "end": "1023199"
  },
  {
    "text": "inputs so it's not meant to be durable",
    "start": "1023199",
    "end": "1028199"
  },
  {
    "text": "store how is the memory usage compared",
    "start": "1035720",
    "end": "1038760"
  },
  {
    "text": "to previous versions so it's going to be",
    "start": "1038760",
    "end": "1041918"
  },
  {
    "text": "very similar like if you look at for",
    "start": "1041919",
    "end": "1043798"
  },
  {
    "text": "example the kubernetes objects we",
    "start": "1043799",
    "end": "1045280"
  },
  {
    "text": "receive we're always unmarshalling a new",
    "start": "1045280",
    "end": "1047880"
  },
  {
    "text": "object when we receive it we always have",
    "start": "1047880",
    "end": "1049400"
  },
  {
    "text": "a have a new copy so where the",
    "start": "1049400",
    "end": "1051080"
  },
  {
    "text": "difference might come is if there's a",
    "start": "1051080",
    "end": "1053120"
  },
  {
    "text": "lot of readers holding on to old uh",
    "start": "1053120",
    "end": "1056360"
  },
  {
    "text": "snapshots of the database that's where",
    "start": "1056360",
    "end": "1058200"
  },
  {
    "text": "we might only holding on to or more data",
    "start": "1058200",
    "end": "1061280"
  },
  {
    "text": "um but it is comparable",
    "start": "1061280",
    "end": "1064880"
  },
  {
    "text": "so is",
    "start": "1073559",
    "end": "1076440"
  },
  {
    "text": "this what about consistency of the state",
    "start": "1076440",
    "end": "1080000"
  },
  {
    "text": "between Sly M how is that",
    "start": "1080000",
    "end": "1082919"
  },
  {
    "text": "done so that's all through C API server",
    "start": "1082919",
    "end": "1086320"
  },
  {
    "text": "KV store so so kind of none of those",
    "start": "1086320",
    "end": "1089000"
  },
  {
    "text": "mechanisms change so we're",
    "start": "1089000",
    "end": "1091280"
  },
  {
    "text": "still eventually consistent there we're",
    "start": "1091280",
    "end": "1093799"
  },
  {
    "text": "receiving events from outside and then",
    "start": "1093799",
    "end": "1095039"
  },
  {
    "text": "reconciling so there's there's no",
    "start": "1095039",
    "end": "1096760"
  },
  {
    "text": "requirement for uh like cross agent",
    "start": "1096760",
    "end": "1100440"
  },
  {
    "text": "transactions and things like",
    "start": "1100440",
    "end": "1103120"
  },
  {
    "text": "that although you could lug in raft into",
    "start": "1103120",
    "end": "1106559"
  },
  {
    "text": "it and and so on which is basically how",
    "start": "1106559",
    "end": "1109080"
  },
  {
    "text": "noite works so it's very similar to",
    "start": "1109080",
    "end": "1112280"
  },
  {
    "text": "that so inside the agent we didn't",
    "start": "1112280",
    "end": "1115480"
  },
  {
    "text": "mention we didn't emphasiz but basically",
    "start": "1115480",
    "end": "1118120"
  },
  {
    "text": "also allows us to establish some",
    "start": "1118120",
    "end": "1120799"
  },
  {
    "text": "communication patterns between different",
    "start": "1120799",
    "end": "1123200"
  },
  {
    "text": "component subcomponents and so",
    "start": "1123200",
    "end": "1126200"
  },
  {
    "text": "basically components can communicate",
    "start": "1126200",
    "end": "1128520"
  },
  {
    "text": "through the stateb so we have a bunch of",
    "start": "1128520",
    "end": "1131480"
  },
  {
    "text": "reconciler loops and they're just",
    "start": "1131480",
    "end": "1133480"
  },
  {
    "text": "watching some table updates and if one",
    "start": "1133480",
    "end": "1136440"
  },
  {
    "text": "component let's say I know let's take",
    "start": "1136440",
    "end": "1138880"
  },
  {
    "text": "the service example and for the service",
    "start": "1138880",
    "end": "1141799"
  },
  {
    "text": "we show the inputs are Cube API Ser Etc",
    "start": "1141799",
    "end": "1145039"
  },
  {
    "text": "but there might be I know some feedback",
    "start": "1145039",
    "end": "1146799"
  },
  {
    "text": "loop coming from Envoy so that feedback",
    "start": "1146799",
    "end": "1149720"
  },
  {
    "text": "loop can write into the database and the",
    "start": "1149720",
    "end": "1152960"
  },
  {
    "text": "service manager will see some updates",
    "start": "1152960",
    "end": "1155480"
  },
  {
    "text": "and react to it because right now like",
    "start": "1155480",
    "end": "1158400"
  },
  {
    "text": "we have bunch of components and they",
    "start": "1158400",
    "end": "1161080"
  },
  {
    "text": "they are communicating in quite",
    "start": "1161080",
    "end": "1162640"
  },
  {
    "text": "different ways like",
    "start": "1162640",
    "end": "1164840"
  },
  {
    "text": "locks go channels call backs and set ET",
    "start": "1164840",
    "end": "1169000"
  },
  {
    "text": "Etc so that could establish the",
    "start": "1169000",
    "end": "1171960"
  },
  {
    "text": "communication like big message bus for a",
    "start": "1171960",
    "end": "1174240"
  },
  {
    "start": "1174240",
    "end": "1176720"
  },
  {
    "text": "agent all right thanks a",
    "start": "1183840",
    "end": "1187000"
  },
  {
    "text": "lot",
    "start": "1187000",
    "end": "1190000"
  }
]