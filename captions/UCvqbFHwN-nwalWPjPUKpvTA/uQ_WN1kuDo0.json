[
  {
    "text": "hi everyone i'm glad to be here today my",
    "start": "480",
    "end": "3840"
  },
  {
    "text": "name is Clemon Bame i come from",
    "start": "3840",
    "end": "5680"
  },
  {
    "text": "Switzerland i'm a Swiss software",
    "start": "5680",
    "end": "7440"
  },
  {
    "text": "engineer working at Post Finance and fun",
    "start": "7440",
    "end": "10559"
  },
  {
    "text": "fact I live on a farm with my wife she's",
    "start": "10559",
    "end": "12320"
  },
  {
    "text": "a farmer and with her family and so I",
    "start": "12320",
    "end": "14320"
  },
  {
    "text": "get to see cows every day and then I get",
    "start": "14320",
    "end": "16400"
  },
  {
    "text": "to play with Kubernetes uh during the",
    "start": "16400",
    "end": "18400"
  },
  {
    "text": "day as well so I'm a lucky guy uh so",
    "start": "18400",
    "end": "21279"
  },
  {
    "text": "let's get started with this session",
    "start": "21279",
    "end": "23279"
  },
  {
    "text": "about our migration from Cubadium",
    "start": "23279",
    "end": "25760"
  },
  {
    "text": "Cubadom i'm not sure how you pronounce",
    "start": "25760",
    "end": "27279"
  },
  {
    "text": "that i will use Cubadium and towards",
    "start": "27279",
    "end": "30320"
  },
  {
    "text": "cluster API and Telos so how old can",
    "start": "30320",
    "end": "33600"
  },
  {
    "text": "your clusters get our oldest clusters",
    "start": "33600",
    "end": "36480"
  },
  {
    "text": "will soon turn six years old and today",
    "start": "36480",
    "end": "39920"
  },
  {
    "text": "it is now 299 days old which gives you",
    "start": "39920",
    "end": "43600"
  },
  {
    "text": "the title for this for for this session",
    "start": "43600",
    "end": "45600"
  },
  {
    "text": "actually uh why do we bother with",
    "start": "45600",
    "end": "48640"
  },
  {
    "text": "keeping cluster alive for so long why",
    "start": "48640",
    "end": "50640"
  },
  {
    "text": "don't we always recreate new clusters",
    "start": "50640",
    "end": "52160"
  },
  {
    "text": "and move application there for us the",
    "start": "52160",
    "end": "54480"
  },
  {
    "text": "choice is uh due to the way we work with",
    "start": "54480",
    "end": "57120"
  },
  {
    "text": "our clusters we use quite large shared",
    "start": "57120",
    "end": "59440"
  },
  {
    "text": "clusters on which there are lots of name",
    "start": "59440",
    "end": "61840"
  },
  {
    "text": "spaces for lots of application developer",
    "start": "61840",
    "end": "64158"
  },
  {
    "text": "teams so instead of moving 500",
    "start": "64159",
    "end": "66560"
  },
  {
    "text": "application teams to a new clusters to",
    "start": "66560",
    "end": "68640"
  },
  {
    "text": "new clusters everyone every time there's",
    "start": "68640",
    "end": "70080"
  },
  {
    "text": "a new release we prefer to just update",
    "start": "70080",
    "end": "72720"
  },
  {
    "text": "and upgrade the clusters in in place and",
    "start": "72720",
    "end": "75840"
  },
  {
    "text": "up up until now we've been quite",
    "start": "75840",
    "end": "77439"
  },
  {
    "text": "successful with that uh with Cubadm so",
    "start": "77439",
    "end": "81200"
  },
  {
    "text": "far",
    "start": "81200",
    "end": "82960"
  },
  {
    "text": "um Post Finance Post Finance is a small",
    "start": "82960",
    "end": "85200"
  },
  {
    "text": "bank or small it it's a it's a bank in",
    "start": "85200",
    "end": "87960"
  },
  {
    "text": "Switzerland uh we run uh 35 vanilla",
    "start": "87960",
    "end": "91439"
  },
  {
    "text": "Kubernetes cluster so the open source",
    "start": "91439",
    "end": "93280"
  },
  {
    "text": "distribution we just use Cubadn Cubadm",
    "start": "93280",
    "end": "96159"
  },
  {
    "text": "to to configure everything and run the",
    "start": "96159",
    "end": "98320"
  },
  {
    "text": "the multiple components of Kubernetes as",
    "start": "98320",
    "end": "101200"
  },
  {
    "text": "I said the oldest cluster will soon turn",
    "start": "101200",
    "end": "103280"
  },
  {
    "text": "six years old we run all we run all of",
    "start": "103280",
    "end": "105680"
  },
  {
    "text": "that on two on-prem data centers uh we",
    "start": "105680",
    "end": "108720"
  },
  {
    "text": "do visual v virtualization and then we",
    "start": "108720",
    "end": "110880"
  },
  {
    "text": "create the virtual machines that we need",
    "start": "110880",
    "end": "112560"
  },
  {
    "text": "for our nodes uh we run chaos monkey on",
    "start": "112560",
    "end": "115840"
  },
  {
    "text": "all clusters this is might be a fun fact",
    "start": "115840",
    "end": "118000"
  },
  {
    "text": "but it's really helpful for us because",
    "start": "118000",
    "end": "120159"
  },
  {
    "text": "up to the production clusters where we",
    "start": "120159",
    "end": "122399"
  },
  {
    "text": "run the card payment services we run",
    "start": "122399",
    "end": "124560"
  },
  {
    "text": "chaos monkey and this helps us a lot",
    "start": "124560",
    "end": "126880"
  },
  {
    "text": "when we have to do an an upgrade because",
    "start": "126880",
    "end": "129200"
  },
  {
    "text": "the application have to be able to",
    "start": "129200",
    "end": "130640"
  },
  {
    "text": "withstand a pod restart so that's that's",
    "start": "130640",
    "end": "133680"
  },
  {
    "text": "a little about what we do at post",
    "start": "133680",
    "end": "135200"
  },
  {
    "text": "finance and with Kubernetes and cloud",
    "start": "135200",
    "end": "136879"
  },
  {
    "text": "native",
    "start": "136879",
    "end": "138200"
  },
  {
    "text": "technologies that being said uh let me",
    "start": "138200",
    "end": "140720"
  },
  {
    "text": "explain how we currently provision our",
    "start": "140720",
    "end": "142480"
  },
  {
    "text": "clusters the starting point so for now",
    "start": "142480",
    "end": "145280"
  },
  {
    "text": "we provision uh DBN VMs with Terraform",
    "start": "145280",
    "end": "148000"
  },
  {
    "text": "and we boot those VMs on on our on prem",
    "start": "148000",
    "end": "150720"
  },
  {
    "text": "clouds on vSphere then we run a little a",
    "start": "150720",
    "end": "154720"
  },
  {
    "text": "series of puppet configuration not sure",
    "start": "154720",
    "end": "157760"
  },
  {
    "text": "how many of you know puppets um but",
    "start": "157760",
    "end": "160319"
  },
  {
    "text": "let's say I'm I'm looking forward to",
    "start": "160319",
    "end": "161920"
  },
  {
    "text": "working only with status um so we use",
    "start": "161920",
    "end": "164640"
  },
  {
    "text": "that and then we we have to manually",
    "start": "164640",
    "end": "167920"
  },
  {
    "text": "register those nodes in an inventory mml",
    "start": "167920",
    "end": "170080"
  },
  {
    "text": "file that we use to run the encel",
    "start": "170080",
    "end": "171840"
  },
  {
    "text": "playbook and then we run this mol",
    "start": "171840",
    "end": "174080"
  },
  {
    "text": "playbook and what it does it basically",
    "start": "174080",
    "end": "176080"
  },
  {
    "text": "renders the config files so the the",
    "start": "176080",
    "end": "178000"
  },
  {
    "text": "cubeadm config files the cube API server",
    "start": "178000",
    "end": "180160"
  },
  {
    "text": "manifest it calls cubeadm commands to",
    "start": "180160",
    "end": "182159"
  },
  {
    "text": "generate all those manifests so that the",
    "start": "182159",
    "end": "184400"
  },
  {
    "text": "control pane can actually start and then",
    "start": "184400",
    "end": "187680"
  },
  {
    "text": "um finally one of the last stage is to",
    "start": "187680",
    "end": "190159"
  },
  {
    "text": "configure Argo CD integration because we",
    "start": "190159",
    "end": "192319"
  },
  {
    "text": "we deploy everything with Argo CD or",
    "start": "192319",
    "end": "194640"
  },
  {
    "text": "almost everything including our own",
    "start": "194640",
    "end": "196879"
  },
  {
    "text": "workloads also infrastructure workloads",
    "start": "196879",
    "end": "198879"
  },
  {
    "text": "like we use application set for that we",
    "start": "198879",
    "end": "200879"
  },
  {
    "text": "deploy engineext with or selium with",
    "start": "200879",
    "end": "203599"
  },
  {
    "text": "with argod so that's what we do today",
    "start": "203599",
    "end": "206159"
  },
  {
    "text": "the last part we are happy with but the",
    "start": "206159",
    "end": "209120"
  },
  {
    "text": "first four step we are not so happy and",
    "start": "209120",
    "end": "211840"
  },
  {
    "text": "so that's why we want to move to cluster",
    "start": "211840",
    "end": "213760"
  },
  {
    "text": "API and I'm not sure how many of you are",
    "start": "213760",
    "end": "216319"
  },
  {
    "text": "currently using cluster",
    "start": "216319",
    "end": "218599"
  },
  {
    "text": "API okay so I would say 5% that's not",
    "start": "218599",
    "end": "221760"
  },
  {
    "text": "much but you might be using it without",
    "start": "221760",
    "end": "223760"
  },
  {
    "text": "knowing it but uh so cluster API in a",
    "start": "223760",
    "end": "226239"
  },
  {
    "text": "few words cluster API the idea is that",
    "start": "226239",
    "end": "228080"
  },
  {
    "text": "you have you use the declarative APIs of",
    "start": "228080",
    "end": "230319"
  },
  {
    "text": "Kubernetes to provision and to make your",
    "start": "230319",
    "end": "233120"
  },
  {
    "text": "cluster work so you have a management",
    "start": "233120",
    "end": "236319"
  },
  {
    "text": "clusters on which uh you create the CRDs",
    "start": "236319",
    "end": "239200"
  },
  {
    "text": "for cluster API and on this management",
    "start": "239200",
    "end": "241360"
  },
  {
    "text": "cluster you have a series of controllers",
    "start": "241360",
    "end": "243599"
  },
  {
    "text": "which will monitor monitor the CRDs that",
    "start": "243599",
    "end": "246560"
  },
  {
    "text": "you need to to instantiate the cluster",
    "start": "246560",
    "end": "248159"
  },
  {
    "text": "API cluster and the the clusters that",
    "start": "248159",
    "end": "251120"
  },
  {
    "text": "you create with cluster API they are",
    "start": "251120",
    "end": "253120"
  },
  {
    "text": "called workload cluster so here this",
    "start": "253120",
    "end": "255680"
  },
  {
    "text": "example is just for lab clusters in in",
    "start": "255680",
    "end": "257600"
  },
  {
    "text": "this in this drawing um so we have here",
    "start": "257600",
    "end": "260880"
  },
  {
    "text": "one management cluster which manages",
    "start": "260880",
    "end": "262560"
  },
  {
    "text": "three workload clusters but I have",
    "start": "262560",
    "end": "264560"
  },
  {
    "text": "another drawing right afterwards which",
    "start": "264560",
    "end": "266400"
  },
  {
    "text": "might explain that a little better um on",
    "start": "266400",
    "end": "269440"
  },
  {
    "text": "the right side you can see that cluster",
    "start": "269440",
    "end": "271440"
  },
  {
    "text": "API you can interact with it as you",
    "start": "271440",
    "end": "273199"
  },
  {
    "text": "would with any community CRD or resource",
    "start": "273199",
    "end": "276160"
  },
  {
    "text": "you can use scuttle for that uh you can",
    "start": "276160",
    "end": "278479"
  },
  {
    "text": "get machine deployments which is which",
    "start": "278479",
    "end": "280240"
  },
  {
    "text": "is the deployment for your worker nodes",
    "start": "280240",
    "end": "282320"
  },
  {
    "text": "you can get machines which is the which",
    "start": "282320",
    "end": "284479"
  },
  {
    "text": "will then through the controllers be we",
    "start": "284479",
    "end": "287919"
  },
  {
    "text": "instantiated as either a VM or an",
    "start": "287919",
    "end": "290080"
  },
  {
    "text": "infrastructure or any resource and that",
    "start": "290080",
    "end": "292639"
  },
  {
    "text": "that will in the end be your your nodes",
    "start": "292639",
    "end": "295440"
  },
  {
    "text": "so that's about cluster API in a",
    "start": "295440",
    "end": "297520"
  },
  {
    "text": "nutshell then Talos Linux how many users",
    "start": "297520",
    "end": "300880"
  },
  {
    "text": "of Talos Linux in the",
    "start": "300880",
    "end": "302680"
  },
  {
    "text": "room it's growing that's good I can only",
    "start": "302680",
    "end": "306000"
  },
  {
    "text": "recommend um it's referred to as the 12",
    "start": "306000",
    "end": "309039"
  },
  {
    "text": "12 binaries OS it's immutable minimal",
    "start": "309039",
    "end": "311199"
  },
  {
    "text": "ephemeral but For us the main point is",
    "start": "311199",
    "end": "313039"
  },
  {
    "text": "that it has a declarative configuration",
    "start": "313039",
    "end": "315720"
  },
  {
    "text": "interface so you don't interact with it",
    "start": "315720",
    "end": "318000"
  },
  {
    "text": "with SSH because there is no SSH on",
    "start": "318000",
    "end": "320000"
  },
  {
    "text": "Talos Linux instead you use um you",
    "start": "320000",
    "end": "323600"
  },
  {
    "text": "authenticate with MTLS to an API server",
    "start": "323600",
    "end": "326960"
  },
  {
    "text": "running on on on the operating system",
    "start": "326960",
    "end": "329840"
  },
  {
    "text": "which is called machine D which does",
    "start": "329840",
    "end": "331840"
  },
  {
    "text": "most of the configuration and so you you",
    "start": "331840",
    "end": "334720"
  },
  {
    "text": "use uh the Talos scuttle command line",
    "start": "334720",
    "end": "336720"
  },
  {
    "text": "tool to or directly you could also use",
    "start": "336720",
    "end": "339120"
  },
  {
    "text": "IPL requests to to to to configure the",
    "start": "339120",
    "end": "341919"
  },
  {
    "text": "operating system so you will configure",
    "start": "341919",
    "end": "343280"
  },
  {
    "text": "the network card the storage you will",
    "start": "343280",
    "end": "345440"
  },
  {
    "text": "configure everything with this",
    "start": "345440",
    "end": "346800"
  },
  {
    "text": "declarative API and forest that's that's",
    "start": "346800",
    "end": "349280"
  },
  {
    "text": "a game changer we we can go from uh",
    "start": "349280",
    "end": "352000"
  },
  {
    "text": "deploying DBN VMs and configuring some",
    "start": "352000",
    "end": "354880"
  },
  {
    "text": "tools with it on with puppet and then",
    "start": "354880",
    "end": "356800"
  },
  {
    "text": "running nible pipelines to just using a",
    "start": "356800",
    "end": "359120"
  },
  {
    "text": "declarative API to to configure the",
    "start": "359120",
    "end": "362160"
  },
  {
    "text": "operating system um that's about it for",
    "start": "362160",
    "end": "367160"
  },
  {
    "text": "Talos and now how do we migrate from",
    "start": "367160",
    "end": "370560"
  },
  {
    "text": "this kind of old uh nible cubadm way of",
    "start": "370560",
    "end": "374479"
  },
  {
    "text": "doing things to to tal and cluster API",
    "start": "374479",
    "end": "377600"
  },
  {
    "text": "so the first step that we have to to go",
    "start": "377600",
    "end": "379680"
  },
  {
    "text": "through is configuration matching as we",
    "start": "379680",
    "end": "381919"
  },
  {
    "text": "can imagine uh some some parameters",
    "start": "381919",
    "end": "384720"
  },
  {
    "text": "between cubeadm and and and mible might",
    "start": "384720",
    "end": "387199"
  },
  {
    "text": "not be the same so cubidm and talos",
    "start": "387199",
    "end": "389759"
  },
  {
    "text": "clust might not be exactly the same so",
    "start": "389759",
    "end": "391520"
  },
  {
    "text": "we have to match that the the second",
    "start": "391520",
    "end": "393759"
  },
  {
    "text": "step is that we need to import all the",
    "start": "393759",
    "end": "395440"
  },
  {
    "text": "existing PKI infrastructure so all the",
    "start": "395440",
    "end": "397680"
  },
  {
    "text": "existing certificates from our existing",
    "start": "397680",
    "end": "399680"
  },
  {
    "text": "clusters we need to import those so that",
    "start": "399680",
    "end": "402160"
  },
  {
    "text": "we can work with those uh in cluster API",
    "start": "402160",
    "end": "405360"
  },
  {
    "text": "and talos next we have to go to the",
    "start": "405360",
    "end": "408240"
  },
  {
    "text": "cluster API management cluster and there",
    "start": "408240",
    "end": "410080"
  },
  {
    "text": "we will start to create the CRDs that",
    "start": "410080",
    "end": "411840"
  },
  {
    "text": "are needed to create new machine new",
    "start": "411840",
    "end": "413680"
  },
  {
    "text": "nodes uh to join the existing",
    "start": "413680",
    "end": "417000"
  },
  {
    "text": "cluster the third step is to add cluster",
    "start": "417000",
    "end": "419759"
  },
  {
    "text": "API nodes and this will not go right the",
    "start": "419759",
    "end": "422479"
  },
  {
    "text": "first time that you try to do it but I",
    "start": "422479",
    "end": "424160"
  },
  {
    "text": "will give you a few um headers on what",
    "start": "424160",
    "end": "426639"
  },
  {
    "text": "not to do and how to interpret the error",
    "start": "426639",
    "end": "429039"
  },
  {
    "text": "that you might encounter along the way",
    "start": "429039",
    "end": "431280"
  },
  {
    "text": "and finally when everything goes well",
    "start": "431280",
    "end": "432880"
  },
  {
    "text": "you can remove the cubeadm nodes and you",
    "start": "432880",
    "end": "434880"
  },
  {
    "text": "have a cluster API and it could be any",
    "start": "434880",
    "end": "437360"
  },
  {
    "text": "other operating system but you have a",
    "start": "437360",
    "end": "438960"
  },
  {
    "text": "cluster API cluster at the end so we are",
    "start": "438960",
    "end": "441360"
  },
  {
    "text": "not there yet everything is ready",
    "start": "441360",
    "end": "443039"
  },
  {
    "text": "technically but uh we we are still in we",
    "start": "443039",
    "end": "445840"
  },
  {
    "text": "are in the process of migrating and",
    "start": "445840",
    "end": "447360"
  },
  {
    "text": "hopefully in a few weeks or months we'll",
    "start": "447360",
    "end": "449599"
  },
  {
    "text": "be able to publish a blog post about it",
    "start": "449599",
    "end": "451759"
  },
  {
    "text": "and how it",
    "start": "451759",
    "end": "453080"
  },
  {
    "text": "went so let's start with the",
    "start": "453080",
    "end": "456400"
  },
  {
    "text": "configuration matching um I will not go",
    "start": "456400",
    "end": "458800"
  },
  {
    "text": "into too many details but the main main",
    "start": "458800",
    "end": "461280"
  },
  {
    "text": "uh things to watch for are to match the",
    "start": "461280",
    "end": "463440"
  },
  {
    "text": "service account issuer that's what that",
    "start": "463440",
    "end": "465919"
  },
  {
    "text": "that's the name of the of the service",
    "start": "465919",
    "end": "467599"
  },
  {
    "text": "account that's the name of the issuer",
    "start": "467599",
    "end": "469919"
  },
  {
    "text": "that you get if you well if you dive in",
    "start": "469919",
    "end": "473360"
  },
  {
    "text": "the pod and you check the George token",
    "start": "473360",
    "end": "475120"
  },
  {
    "text": "that is in /var run secrets etc you will",
    "start": "475120",
    "end": "478319"
  },
  {
    "text": "see an issuer field and this issuer per",
    "start": "478319",
    "end": "480720"
  },
  {
    "text": "default is kubernetes defaults services",
    "start": "480720",
    "end": "482560"
  },
  {
    "text": "cluster local and with stalos this is",
    "start": "482560",
    "end": "484879"
  },
  {
    "text": "not the case with stalos they default to",
    "start": "484879",
    "end": "487360"
  },
  {
    "text": "the end points of the cluster so you",
    "start": "487360",
    "end": "489680"
  },
  {
    "text": "have to match that on the old cubeadm",
    "start": "489680",
    "end": "491919"
  },
  {
    "text": "cluster you have to already do this",
    "start": "491919",
    "end": "493360"
  },
  {
    "text": "small change but you can do that without",
    "start": "493360",
    "end": "495360"
  },
  {
    "text": "downtime that's fine and then this one",
    "start": "495360",
    "end": "498240"
  },
  {
    "text": "is really important you need to make",
    "start": "498240",
    "end": "499680"
  },
  {
    "text": "sure that the hd encryption key and the",
    "start": "499680",
    "end": "502160"
  },
  {
    "text": "key name are the same between talos and",
    "start": "502160",
    "end": "504720"
  },
  {
    "text": "and cubadm and so on the right hand side",
    "start": "504720",
    "end": "507280"
  },
  {
    "text": "you of the the Talos template file so",
    "start": "507280",
    "end": "509919"
  },
  {
    "text": "the file that they use to actually",
    "start": "509919",
    "end": "511680"
  },
  {
    "text": "create the encryption config file on",
    "start": "511680",
    "end": "513200"
  },
  {
    "text": "your Talos machine Talos system and you",
    "start": "513200",
    "end": "516719"
  },
  {
    "text": "see how they how they template it and",
    "start": "516719",
    "end": "519518"
  },
  {
    "text": "mainly you you see the the name line 11",
    "start": "519519",
    "end": "522240"
  },
  {
    "text": "or line 17 depending on which en HCD",
    "start": "522240",
    "end": "525279"
  },
  {
    "text": "encryption scheme you use ASBC or secret",
    "start": "525279",
    "end": "528399"
  },
  {
    "text": "box uh you see which name your key needs",
    "start": "528399",
    "end": "531200"
  },
  {
    "text": "to have on your Cubadm old cluster and",
    "start": "531200",
    "end": "534160"
  },
  {
    "text": "so you have to match that uh which means",
    "start": "534160",
    "end": "536480"
  },
  {
    "text": "that you have to basically re-encrypt",
    "start": "536480",
    "end": "538240"
  },
  {
    "text": "all secrets but this is quite a simple",
    "start": "538240",
    "end": "540560"
  },
  {
    "text": "operation as we can see on the third",
    "start": "540560",
    "end": "542640"
  },
  {
    "text": "step and it's all explained really in",
    "start": "542640",
    "end": "544640"
  },
  {
    "text": "super super detailed in the community's",
    "start": "544640",
    "end": "547640"
  },
  {
    "text": "documentation so that's for the first",
    "start": "547640",
    "end": "550080"
  },
  {
    "text": "step or the step zero the preparation",
    "start": "550080",
    "end": "552600"
  },
  {
    "text": "step then we have to import the existing",
    "start": "552600",
    "end": "555279"
  },
  {
    "text": "PKI and here Talos is quite helpful they",
    "start": "555279",
    "end": "558000"
  },
  {
    "text": "have a command called cube cuttle",
    "start": "558000",
    "end": "559560"
  },
  {
    "text": "genrets from Kubernetes PKI so you can",
    "start": "559560",
    "end": "563680"
  },
  {
    "text": "give this talos cuttle command line tool",
    "start": "563680",
    "end": "566640"
  },
  {
    "text": "the path to the existing communities PKI",
    "start": "566640",
    "end": "569040"
  },
  {
    "text": "folder in which there are all those uh",
    "start": "569040",
    "end": "571200"
  },
  {
    "text": "CA certificates HCD certificates service",
    "start": "571200",
    "end": "574160"
  },
  {
    "text": "account issuer key etc and it will",
    "start": "574160",
    "end": "577120"
  },
  {
    "text": "generate a secrets bundle file that you",
    "start": "577120",
    "end": "580480"
  },
  {
    "text": "can use later on to either provision a",
    "start": "580480",
    "end": "582880"
  },
  {
    "text": "new cluster without pro without cluster",
    "start": "582880",
    "end": "584880"
  },
  {
    "text": "API or that we will use just afterwards",
    "start": "584880",
    "end": "587519"
  },
  {
    "text": "to actually provision the new cluster",
    "start": "587519",
    "end": "589519"
  },
  {
    "text": "API cluster you also need to create a",
    "start": "589519",
    "end": "592640"
  },
  {
    "text": "new cubeadm bootstrap token or cubes",
    "start": "592640",
    "end": "595279"
  },
  {
    "text": "bootstrap token so that new nodes can",
    "start": "595279",
    "end": "597200"
  },
  {
    "text": "can join the existing",
    "start": "597200",
    "end": "599240"
  },
  {
    "text": "cluster so that's for the first step so",
    "start": "599240",
    "end": "602640"
  },
  {
    "text": "importing the existing PKI PKI and that",
    "start": "602640",
    "end": "606080"
  },
  {
    "text": "is how the secrets bundle look like so",
    "start": "606080",
    "end": "608959"
  },
  {
    "text": "we have uh the bootstrap token the",
    "start": "608959",
    "end": "611360"
  },
  {
    "text": "secret box encryion secrets and then the",
    "start": "611360",
    "end": "613920"
  },
  {
    "text": "key the core community certificates that",
    "start": "613920",
    "end": "617200"
  },
  {
    "text": "that constitute a cluster so the",
    "start": "617200",
    "end": "618800"
  },
  {
    "text": "kubernetes search line 10 11 the hcd 7",
    "start": "618800",
    "end": "622079"
  },
  {
    "text": "and 8 the service account and finally",
    "start": "622079",
    "end": "624480"
  },
  {
    "text": "line 15 and 16 this is not something",
    "start": "624480",
    "end": "626399"
  },
  {
    "text": "that is uh from kubernetunities itself",
    "start": "626399",
    "end": "628640"
  },
  {
    "text": "it's from talos it's the os key so",
    "start": "628640",
    "end": "631040"
  },
  {
    "text": "operating op operating system in this",
    "start": "631040",
    "end": "632560"
  },
  {
    "text": "case it's talos and so this this key",
    "start": "632560",
    "end": "636240"
  },
  {
    "text": "line 15 and 16 the OS key is the the",
    "start": "636240",
    "end": "639600"
  },
  {
    "text": "certificate that you use to authenticate",
    "start": "639600",
    "end": "641920"
  },
  {
    "text": "against the talos endpoint so the talos",
    "start": "641920",
    "end": "644480"
  },
  {
    "text": "API so you don't use an SSH key you use",
    "start": "644480",
    "end": "647279"
  },
  {
    "text": "a certificate And if that certificate",
    "start": "647279",
    "end": "649680"
  },
  {
    "text": "has the OS admin group then you're",
    "start": "649680",
    "end": "652240"
  },
  {
    "text": "allowed to do some operations on the",
    "start": "652240",
    "end": "654240"
  },
  {
    "text": "Talos nodes with the Talos cut command",
    "start": "654240",
    "end": "657440"
  },
  {
    "text": "so that's it for the for importing the",
    "start": "657440",
    "end": "660240"
  },
  {
    "text": "existing",
    "start": "660240",
    "end": "662640"
  },
  {
    "text": "PK and now we have to create some",
    "start": "663480",
    "end": "665920"
  },
  {
    "text": "cluster API CRDs i'm not sure if you can",
    "start": "665920",
    "end": "668399"
  },
  {
    "text": "read well in the bottom but I will soon",
    "start": "668399",
    "end": "670399"
  },
  {
    "text": "switch to a drawing because this is a",
    "start": "670399",
    "end": "672160"
  },
  {
    "text": "little in digest uh but the main point",
    "start": "672160",
    "end": "674480"
  },
  {
    "text": "is that you have a cluster CRD you have",
    "start": "674480",
    "end": "676640"
  },
  {
    "text": "a control plane CRD and uh maybe it's",
    "start": "676640",
    "end": "681360"
  },
  {
    "text": "simpler to to read it like that that's",
    "start": "681360",
    "end": "683279"
  },
  {
    "text": "how we structure our clusters so we",
    "start": "683279",
    "end": "686079"
  },
  {
    "text": "create one name space per workload",
    "start": "686079",
    "end": "688120"
  },
  {
    "text": "cluster so here the workload cluster is",
    "start": "688120",
    "end": "690880"
  },
  {
    "text": "called E1 communities lab F and so we",
    "start": "690880",
    "end": "693920"
  },
  {
    "text": "have uh we have a cluster CRD so that's",
    "start": "693920",
    "end": "696800"
  },
  {
    "text": "the one that you that you see on the",
    "start": "696800",
    "end": "698640"
  },
  {
    "text": "left hand side and then we have a",
    "start": "698640",
    "end": "700959"
  },
  {
    "text": "control plane CRD the one in",
    "start": "700959",
    "end": "703800"
  },
  {
    "text": "yellow another one is the machine",
    "start": "703800",
    "end": "706000"
  },
  {
    "text": "deployment then you have also an",
    "start": "706000",
    "end": "707120"
  },
  {
    "text": "infrastructure but you could have",
    "start": "707120",
    "end": "708399"
  },
  {
    "text": "multiple infrastructure provider it's up",
    "start": "708399",
    "end": "710240"
  },
  {
    "text": "to you and so uh all the CRDs are there",
    "start": "710240",
    "end": "713600"
  },
  {
    "text": "and nothing happens so far but the then",
    "start": "713600",
    "end": "716480"
  },
  {
    "text": "the cluster API controllers they start",
    "start": "716480",
    "end": "718480"
  },
  {
    "text": "to interact with those CRDs to provision",
    "start": "718480",
    "end": "720560"
  },
  {
    "text": "the nodes the machines to boot the VMs",
    "start": "720560",
    "end": "722800"
  },
  {
    "text": "if it is VMs to boot the bare metal",
    "start": "722800",
    "end": "725040"
  },
  {
    "text": "boxes if it's bare metal boxes with",
    "start": "725040",
    "end": "726800"
  },
  {
    "text": "metal cubed whatever and so that's how",
    "start": "726800",
    "end": "729519"
  },
  {
    "text": "cluster API works so you you have to",
    "start": "729519",
    "end": "732240"
  },
  {
    "text": "create those CRDs and then the",
    "start": "732240",
    "end": "734240"
  },
  {
    "text": "controller start to provision machines",
    "start": "734240",
    "end": "736240"
  },
  {
    "text": "and it can go extremely",
    "start": "736240",
    "end": "738839"
  },
  {
    "text": "quick so now we know we know how how all",
    "start": "738839",
    "end": "742720"
  },
  {
    "text": "of this works how we want to do the",
    "start": "742720",
    "end": "744160"
  },
  {
    "text": "migration the last step for the",
    "start": "744160",
    "end": "746240"
  },
  {
    "text": "migration is that we are going to add uh",
    "start": "746240",
    "end": "748480"
  },
  {
    "text": "cluster API nodes to our existing",
    "start": "748480",
    "end": "750720"
  },
  {
    "text": "cluster so on the left hand side in blue",
    "start": "750720",
    "end": "753200"
  },
  {
    "text": "you have the the cubadium nodes uh we",
    "start": "753200",
    "end": "756800"
  },
  {
    "text": "have more nodes than that but for the",
    "start": "756800",
    "end": "758240"
  },
  {
    "text": "drawing drawing it was much simpler like",
    "start": "758240",
    "end": "760079"
  },
  {
    "text": "that and in green on the right hand side",
    "start": "760079",
    "end": "762240"
  },
  {
    "text": "we start to add cluster API and talos",
    "start": "762240",
    "end": "764639"
  },
  {
    "text": "node and that's actually how we are",
    "start": "764639",
    "end": "766800"
  },
  {
    "text": "going to do the migration we have the",
    "start": "766800",
    "end": "768959"
  },
  {
    "text": "existing clusters with perhaps 100 nodes",
    "start": "768959",
    "end": "771360"
  },
  {
    "text": "and then we'll start to incrementally",
    "start": "771360",
    "end": "773200"
  },
  {
    "text": "add new talos nodes to the to the to the",
    "start": "773200",
    "end": "776240"
  },
  {
    "text": "cluster and we'll monitor close it",
    "start": "776240",
    "end": "778480"
  },
  {
    "text": "because it's almost no it's certain that",
    "start": "778480",
    "end": "780720"
  },
  {
    "text": "there will be some edge cases like some",
    "start": "780720",
    "end": "782959"
  },
  {
    "text": "fine-tuned cysal parameters that will",
    "start": "782959",
    "end": "785760"
  },
  {
    "text": "break some Java deployment somewhere",
    "start": "785760",
    "end": "787600"
  },
  {
    "text": "it's almost sure so we'll have to",
    "start": "787600",
    "end": "789600"
  },
  {
    "text": "monitor closely over the course of",
    "start": "789600",
    "end": "791600"
  },
  {
    "text": "several weeks to see which of those",
    "start": "791600",
    "end": "793360"
  },
  {
    "text": "parameters we have to fix but basically",
    "start": "793360",
    "end": "795279"
  },
  {
    "text": "the idea is that we have the old cluster",
    "start": "795279",
    "end": "797440"
  },
  {
    "text": "we we start new nodes new nodes in the",
    "start": "797440",
    "end": "800720"
  },
  {
    "text": "sense with cluster API we wait a little",
    "start": "800720",
    "end": "803360"
  },
  {
    "text": "and uh in the end the idea is to",
    "start": "803360",
    "end": "806000"
  },
  {
    "text": "completely replace the old cubadium",
    "start": "806000",
    "end": "807920"
  },
  {
    "text": "nodes and we will have then successfully",
    "start": "807920",
    "end": "810880"
  },
  {
    "text": "migrated without downtime all our",
    "start": "810880",
    "end": "812560"
  },
  {
    "text": "clusters in a few months if everything",
    "start": "812560",
    "end": "814800"
  },
  {
    "text": "goes well so that's the",
    "start": "814800",
    "end": "818320"
  },
  {
    "text": "idea so when you create cluster API",
    "start": "819720",
    "end": "823440"
  },
  {
    "text": "nodes a few things can go wrong uh I've",
    "start": "823440",
    "end": "826399"
  },
  {
    "text": "summarized it here uh we've encountered",
    "start": "826399",
    "end": "829279"
  },
  {
    "text": "that along the road um for example if",
    "start": "829279",
    "end": "832240"
  },
  {
    "text": "you do not match the service account",
    "start": "832240",
    "end": "833600"
  },
  {
    "text": "issuer then the new service account",
    "start": "833600",
    "end": "835760"
  },
  {
    "text": "token that you create they will not have",
    "start": "835760",
    "end": "837360"
  },
  {
    "text": "the proper service account issuer so it",
    "start": "837360",
    "end": "839440"
  },
  {
    "text": "will not be accepted by the old API",
    "start": "839440",
    "end": "841199"
  },
  {
    "text": "servers then in the authentication logs",
    "start": "841199",
    "end": "843360"
  },
  {
    "text": "you see that you have invalid beer token",
    "start": "843360",
    "end": "846040"
  },
  {
    "text": "errors um you could lack the encryption",
    "start": "846040",
    "end": "849600"
  },
  {
    "text": "key if you do not have it that's how the",
    "start": "849600",
    "end": "851920"
  },
  {
    "text": "the the error message looks like you",
    "start": "851920",
    "end": "854720"
  },
  {
    "text": "could have the wrongd encryption key and",
    "start": "854720",
    "end": "856959"
  },
  {
    "text": "this is a little more tricky because you",
    "start": "856959",
    "end": "858480"
  },
  {
    "text": "would expect well maybe another failure",
    "start": "858480",
    "end": "860680"
  },
  {
    "text": "or an error message which is more",
    "start": "860680",
    "end": "863279"
  },
  {
    "text": "verbose than output array was not large",
    "start": "863279",
    "end": "865519"
  },
  {
    "text": "enough for encryption but that's what",
    "start": "865519",
    "end": "866880"
  },
  {
    "text": "you get if you don't have the right",
    "start": "866880",
    "end": "868480"
  },
  {
    "text": "encryption key and finally um when you",
    "start": "868480",
    "end": "871839"
  },
  {
    "text": "start adding nodes to the to the cluster",
    "start": "871839",
    "end": "874639"
  },
  {
    "text": "if at some point you you you have some",
    "start": "874639",
    "end": "877279"
  },
  {
    "text": "nodes which are which are down and you",
    "start": "877279",
    "end": "878800"
  },
  {
    "text": "lose quarum then you have to to force",
    "start": "878800",
    "end": "882480"
  },
  {
    "text": "the new use the force new cluster flag",
    "start": "882480",
    "end": "884800"
  },
  {
    "text": "to recover your HCD cluster perhaps you",
    "start": "884800",
    "end": "887279"
  },
  {
    "text": "already have had to do",
    "start": "887279",
    "end": "889079"
  },
  {
    "text": "that so let's get to the demo let's hope",
    "start": "889079",
    "end": "892480"
  },
  {
    "text": "the demo gods are with me",
    "start": "892480",
    "end": "896560"
  },
  {
    "text": "um so let me explain a little so this",
    "start": "897800",
    "end": "901120"
  },
  {
    "text": "here are the manifests that we have in",
    "start": "901120",
    "end": "903519"
  },
  {
    "text": "our um that we that we'll provision for",
    "start": "903519",
    "end": "906480"
  },
  {
    "text": "the lab F cluster so that's the that's",
    "start": "906480",
    "end": "909120"
  },
  {
    "text": "the one I those are the manifests I",
    "start": "909120",
    "end": "911040"
  },
  {
    "text": "showed you before by the way is it big",
    "start": "911040",
    "end": "913040"
  },
  {
    "text": "enough at the bottom well I don't hear",
    "start": "913040",
    "end": "915839"
  },
  {
    "text": "anything so looks good i see some jobs",
    "start": "915839",
    "end": "918079"
  },
  {
    "text": "thanks so this is the manifest that we",
    "start": "918079",
    "end": "920399"
  },
  {
    "text": "use for this is the cluster manifest",
    "start": "920399",
    "end": "923120"
  },
  {
    "text": "basically the cluster name then the",
    "start": "923120",
    "end": "925519"
  },
  {
    "text": "endpoint for the cluster then you have",
    "start": "925519",
    "end": "927600"
  },
  {
    "text": "to refer the control plane and then the",
    "start": "927600",
    "end": "930920"
  },
  {
    "text": "infrastructure then you have the control",
    "start": "930920",
    "end": "933360"
  },
  {
    "text": "plane itself and here you see we use",
    "start": "933360",
    "end": "936480"
  },
  {
    "text": "Vsspere machine template we use Talos 94",
    "start": "936480",
    "end": "939760"
  },
  {
    "text": "this is like the the the image template",
    "start": "939760",
    "end": "942560"
  },
  {
    "text": "on Vsspere itself",
    "start": "942560",
    "end": "944800"
  },
  {
    "text": "and one important thing here we start",
    "start": "944800",
    "end": "947440"
  },
  {
    "text": "without any replicas and I will get to",
    "start": "947440",
    "end": "949279"
  },
  {
    "text": "that in an instance when we start the",
    "start": "949279",
    "end": "950800"
  },
  {
    "text": "migration uh but basically the thing is",
    "start": "950800",
    "end": "952959"
  },
  {
    "text": "that if you start if you create those",
    "start": "952959",
    "end": "954959"
  },
  {
    "text": "CRDs on the cluster API clusters and you",
    "start": "954959",
    "end": "958000"
  },
  {
    "text": "already start one replica um you you",
    "start": "958000",
    "end": "961199"
  },
  {
    "text": "first have to I will show you it's going",
    "start": "961199",
    "end": "963199"
  },
  {
    "text": "to be easier when when I show it okay so",
    "start": "963199",
    "end": "965360"
  },
  {
    "text": "this is the control plane CRD uh and",
    "start": "965360",
    "end": "968399"
  },
  {
    "text": "then we have a customization file here",
    "start": "968399",
    "end": "970880"
  },
  {
    "text": "which generates secrets and generates",
    "start": "970880",
    "end": "972639"
  },
  {
    "text": "all the CRDs that we need to to start uh",
    "start": "972639",
    "end": "975680"
  },
  {
    "text": "creating this uh workload cluster",
    "start": "975680",
    "end": "978519"
  },
  {
    "text": "nodes so I think that's it uh then I",
    "start": "978519",
    "end": "982000"
  },
  {
    "text": "have a few workspaces workspaces here",
    "start": "982000",
    "end": "985040"
  },
  {
    "text": "the second workspace so I'm switching to",
    "start": "985040",
    "end": "986959"
  },
  {
    "text": "it now the Talos cuttle workspace we",
    "start": "986959",
    "end": "989120"
  },
  {
    "text": "will use that one to retrieve the logs",
    "start": "989120",
    "end": "991759"
  },
  {
    "text": "of the of the Talos operating system",
    "start": "991759",
    "end": "994000"
  },
  {
    "text": "when it boots uh then the seventh",
    "start": "994000",
    "end": "997519"
  },
  {
    "text": "workspace here uh is the is one of the",
    "start": "997519",
    "end": "1000399"
  },
  {
    "text": "control plane of the old cubadm cluster",
    "start": "1000399",
    "end": "1003279"
  },
  {
    "text": "so you want mls 010 we will start to",
    "start": "1003279",
    "end": "1006000"
  },
  {
    "text": "watch on the kettle member list here",
    "start": "1006000",
    "end": "1009040"
  },
  {
    "text": "because if everything goes well we",
    "start": "1009040",
    "end": "1011279"
  },
  {
    "text": "should when we start the CRDs and when",
    "start": "1011279",
    "end": "1013360"
  },
  {
    "text": "we increase the number of replica we",
    "start": "1013360",
    "end": "1015440"
  },
  {
    "text": "should get a new member in this in this",
    "start": "1015440",
    "end": "1018560"
  },
  {
    "text": "uh workspace here then on the eight",
    "start": "1018560",
    "end": "1021680"
  },
  {
    "text": "workspace or we have the cluster API",
    "start": "1021680",
    "end": "1024720"
  },
  {
    "text": "management cluster so for now we don't",
    "start": "1024720",
    "end": "1027038"
  },
  {
    "text": "have a lab F cluster we'll soon have",
    "start": "1027039",
    "end": "1029120"
  },
  {
    "text": "that and we'll go inside this cluster",
    "start": "1029120",
    "end": "1030959"
  },
  {
    "text": "and see which CRDs are created and",
    "start": "1030959",
    "end": "1033600"
  },
  {
    "text": "finally the N tab is the the lab F nodes",
    "start": "1033600",
    "end": "1038000"
  },
  {
    "text": "tab so this is just an overview with",
    "start": "1038000",
    "end": "1039839"
  },
  {
    "text": "canines of the running nodes on the on",
    "start": "1039839",
    "end": "1042240"
  },
  {
    "text": "that cluster for the moment so we have",
    "start": "1042240",
    "end": "1043760"
  },
  {
    "text": "six nodes at the moment hopefully a",
    "start": "1043760",
    "end": "1045600"
  },
  {
    "text": "seventh one or even more if we have a",
    "start": "1045600",
    "end": "1047280"
  },
  {
    "text": "little more time",
    "start": "1047280",
    "end": "1049039"
  },
  {
    "text": "so let's get started",
    "start": "1049039",
    "end": "1051799"
  },
  {
    "text": "um",
    "start": "1051799",
    "end": "1053400"
  },
  {
    "text": "perhaps so the the file structure is",
    "start": "1053400",
    "end": "1055760"
  },
  {
    "text": "this one the one we see on the left hand",
    "start": "1055760",
    "end": "1058240"
  },
  {
    "text": "side so the first step that we have to",
    "start": "1058240",
    "end": "1060720"
  },
  {
    "text": "do we have to actually import the",
    "start": "1060720",
    "end": "1062960"
  },
  {
    "text": "existing PKI so for that we use uh this",
    "start": "1062960",
    "end": "1067919"
  },
  {
    "text": "script here so we gen I will run this",
    "start": "1067919",
    "end": "1072400"
  },
  {
    "text": "script with SSH on the on the target uh",
    "start": "1072400",
    "end": "1075840"
  },
  {
    "text": "control plane node so on the existing",
    "start": "1075840",
    "end": "1077280"
  },
  {
    "text": "control pane node so we will generate",
    "start": "1077280",
    "end": "1079280"
  },
  {
    "text": "the cubadm join token we generate the",
    "start": "1079280",
    "end": "1081520"
  },
  {
    "text": "talos secrets bundle the command that I",
    "start": "1081520",
    "end": "1083360"
  },
  {
    "text": "showed before then we'll generate or we",
    "start": "1083360",
    "end": "1085360"
  },
  {
    "text": "will read the sd encryption key",
    "start": "1085360",
    "end": "1086880"
  },
  {
    "text": "substitute that with a little yq command",
    "start": "1086880",
    "end": "1089280"
  },
  {
    "text": "and print the file out we'll directly",
    "start": "1089280",
    "end": "1091520"
  },
  {
    "text": "print the file out and save it to the",
    "start": "1091520",
    "end": "1093760"
  },
  {
    "text": "secrets folder secrets bundle file so to",
    "start": "1093760",
    "end": "1097679"
  },
  {
    "text": "do that we ssh on the node and we pipe",
    "start": "1097679",
    "end": "1103520"
  },
  {
    "text": "the script and that's it so now in the",
    "start": "1103520",
    "end": "1106080"
  },
  {
    "text": "secrets bundle file here we already have",
    "start": "1106080",
    "end": "1109039"
  },
  {
    "text": "a first step we have",
    "start": "1109039",
    "end": "1112879"
  },
  {
    "text": "the we have the secrets bundle file",
    "start": "1112919",
    "end": "1116160"
  },
  {
    "text": "which corresponds to our actual",
    "start": "1116160",
    "end": "1117919"
  },
  {
    "text": "communities existing cubadmium clusters",
    "start": "1117919",
    "end": "1120320"
  },
  {
    "text": "so with the right community certificates",
    "start": "1120320",
    "end": "1122640"
  },
  {
    "text": "certificates and everything so the first",
    "start": "1122640",
    "end": "1124880"
  },
  {
    "text": "step is done now we also need to create",
    "start": "1124880",
    "end": "1128640"
  },
  {
    "text": "some TLS files so I have created a small",
    "start": "1128640",
    "end": "1131679"
  },
  {
    "text": "script for that as well",
    "start": "1131679",
    "end": "1134400"
  },
  {
    "text": "uh it just reads the the CRT and key",
    "start": "1134400",
    "end": "1136960"
  },
  {
    "text": "file from this these lines here and it",
    "start": "1136960",
    "end": "1139840"
  },
  {
    "text": "saves that here so just some YQ commands",
    "start": "1139840",
    "end": "1143039"
  },
  {
    "text": "so let's review again the CRDs so here",
    "start": "1143039",
    "end": "1146880"
  },
  {
    "text": "we have the control plane zero replicas",
    "start": "1146880",
    "end": "1149200"
  },
  {
    "text": "this is important data plane zero",
    "start": "1149200",
    "end": "1151000"
  },
  {
    "text": "replicas and I think with that we should",
    "start": "1151000",
    "end": "1153360"
  },
  {
    "text": "be able to apply this",
    "start": "1153360",
    "end": "1155720"
  },
  {
    "text": "customization on the cluster API cluster",
    "start": "1155720",
    "end": "1159360"
  },
  {
    "text": "so no error so far the demo god seems to",
    "start": "1159360",
    "end": "1162080"
  },
  {
    "text": "be seem to be with me for now so we have",
    "start": "1162080",
    "end": "1164640"
  },
  {
    "text": "a new new name space capy one community",
    "start": "1164640",
    "end": "1166880"
  },
  {
    "text": "pfnet lab f capy is standing for cluster",
    "start": "1166880",
    "end": "1169720"
  },
  {
    "text": "API when we get into this name space we",
    "start": "1169720",
    "end": "1172720"
  },
  {
    "text": "don't see any pots because we are not",
    "start": "1172720",
    "end": "1174640"
  },
  {
    "text": "working with spots here we if we check",
    "start": "1174640",
    "end": "1177120"
  },
  {
    "text": "the clusters CRD we see that we have a",
    "start": "1177120",
    "end": "1180280"
  },
  {
    "text": "CRD so we have we have a cluster uh",
    "start": "1180280",
    "end": "1183360"
  },
  {
    "text": "cluster API cluster instance and then uh",
    "start": "1183360",
    "end": "1186799"
  },
  {
    "text": "we could check for machines but normally",
    "start": "1186799",
    "end": "1188640"
  },
  {
    "text": "there shouldn't be any machines because",
    "start": "1188640",
    "end": "1190400"
  },
  {
    "text": "we haven't increased the replica count",
    "start": "1190400",
    "end": "1192160"
  },
  {
    "text": "yet we can also check for Talos control",
    "start": "1192160",
    "end": "1195280"
  },
  {
    "text": "plane and this is an important resource",
    "start": "1195280",
    "end": "1197440"
  },
  {
    "text": "this one is the one that will be used by",
    "start": "1197440",
    "end": "1200320"
  },
  {
    "text": "uh the controller the Talos bootstrap",
    "start": "1200320",
    "end": "1202799"
  },
  {
    "text": "provider will use this uh instance to",
    "start": "1202799",
    "end": "1205200"
  },
  {
    "text": "create the the bootstrap data which is",
    "start": "1205200",
    "end": "1208880"
  },
  {
    "text": "the data that it needs to send to Talos",
    "start": "1208880",
    "end": "1210880"
  },
  {
    "text": "uh when it initializes the the node so",
    "start": "1210880",
    "end": "1215320"
  },
  {
    "text": "that's are the CDs that we currently",
    "start": "1215320",
    "end": "1217679"
  },
  {
    "text": "have on the cluster and now the next",
    "start": "1217679",
    "end": "1220400"
  },
  {
    "text": "step that we need to do uh I will run",
    "start": "1220400",
    "end": "1222559"
  },
  {
    "text": "this here it's not really important",
    "start": "1222559",
    "end": "1224000"
  },
  {
    "text": "where we run it we need to patch we need",
    "start": "1224000",
    "end": "1227520"
  },
  {
    "text": "to patch this talos control plane this",
    "start": "1227520",
    "end": "1229360"
  },
  {
    "text": "is the critical bit if you don't do that",
    "start": "1229360",
    "end": "1231840"
  },
  {
    "text": "if you don't patch it with the",
    "start": "1231840",
    "end": "1233200"
  },
  {
    "text": "bootstrapped equals true flag in the",
    "start": "1233200",
    "end": "1235360"
  },
  {
    "text": "status sub resource if you don't do that",
    "start": "1235360",
    "end": "1237679"
  },
  {
    "text": "then when you increase the replica count",
    "start": "1237679",
    "end": "1240000"
  },
  {
    "text": "tell us or the the controllers of",
    "start": "1240000",
    "end": "1242600"
  },
  {
    "text": "custo that that it is a new cluster",
    "start": "1242600",
    "end": "1245919"
  },
  {
    "text": "completely new cluster so they will send",
    "start": "1245919",
    "end": "1248240"
  },
  {
    "text": "a bootstrap command and then this new",
    "start": "1248240",
    "end": "1250559"
  },
  {
    "text": "node will not join the existing one it",
    "start": "1250559",
    "end": "1252400"
  },
  {
    "text": "will just create a new form a new",
    "start": "1252400",
    "end": "1254000"
  },
  {
    "text": "kubernetes cluster on its own so it will",
    "start": "1254000",
    "end": "1256159"
  },
  {
    "text": "not join a CD and then you just uh lose",
    "start": "1256159",
    "end": "1258640"
  },
  {
    "text": "some time but if you run this command",
    "start": "1258640",
    "end": "1261039"
  },
  {
    "text": "here if you patch the existing talos",
    "start": "1261039",
    "end": "1263600"
  },
  {
    "text": "control plane then it status of",
    "start": "1263600",
    "end": "1266159"
  },
  {
    "text": "bootstraps be bootstrapped becomes",
    "start": "1266159",
    "end": "1268720"
  },
  {
    "text": "becomes true and here we should be",
    "start": "1268720",
    "end": "1271919"
  },
  {
    "text": "seeing that in the status bootstrapped",
    "start": "1271919",
    "end": "1274000"
  },
  {
    "text": "is true and now that I've done that we",
    "start": "1274000",
    "end": "1277039"
  },
  {
    "text": "can start our first control plane",
    "start": "1277039",
    "end": "1278840"
  },
  {
    "text": "replica so let's do that",
    "start": "1278840",
    "end": "1282480"
  },
  {
    "text": "we could also directly edit",
    "start": "1282480",
    "end": "1284679"
  },
  {
    "text": "the the resource but it doesn't matter",
    "start": "1284679",
    "end": "1287280"
  },
  {
    "text": "so I apply this with one more",
    "start": "1287280",
    "end": "1290200"
  },
  {
    "text": "replica uh so now we see we have one",
    "start": "1290200",
    "end": "1292799"
  },
  {
    "text": "replica and if we check the machines we",
    "start": "1292799",
    "end": "1295600"
  },
  {
    "text": "should be having a new machine which is",
    "start": "1295600",
    "end": "1298679"
  },
  {
    "text": "provisioning good so it has been pro",
    "start": "1298679",
    "end": "1301280"
  },
  {
    "text": "provisioning for 13 seconds um we don't",
    "start": "1301280",
    "end": "1305039"
  },
  {
    "text": "have and member so far it should come in",
    "start": "1305039",
    "end": "1307520"
  },
  {
    "text": "around 40 seconds hopefully uh we might",
    "start": "1307520",
    "end": "1310720"
  },
  {
    "text": "be able to check the Talos logs uh I",
    "start": "1310720",
    "end": "1313600"
  },
  {
    "text": "have already prepared the IP address um",
    "start": "1313600",
    "end": "1317840"
  },
  {
    "text": "I first need to create a Talos config",
    "start": "1317840",
    "end": "1320120"
  },
  {
    "text": "file it's always a step that I forget",
    "start": "1320120",
    "end": "1322799"
  },
  {
    "text": "you need a Talos config file to to",
    "start": "1322799",
    "end": "1325200"
  },
  {
    "text": "actually interact with the nodes",
    "start": "1325200",
    "end": "1328780"
  },
  {
    "text": "[Music]",
    "start": "1328780",
    "end": "1332039"
  },
  {
    "text": "um this should be the one and we should",
    "start": "1332039",
    "end": "1335520"
  },
  {
    "text": "be able to watch the logs of the node so",
    "start": "1335520",
    "end": "1338480"
  },
  {
    "text": "we see on the Talos node is booting uh",
    "start": "1338480",
    "end": "1341440"
  },
  {
    "text": "and we see that the HCD service is",
    "start": "1341440",
    "end": "1343440"
  },
  {
    "text": "waiting to be up let's check the old",
    "start": "1343440",
    "end": "1345600"
  },
  {
    "text": "control plane nodes on the seventh",
    "start": "1345600",
    "end": "1347960"
  },
  {
    "text": "workspace we don't have it",
    "start": "1347960",
    "end": "1350200"
  },
  {
    "text": "yet it should soon come up and be alive",
    "start": "1350200",
    "end": "1354240"
  },
  {
    "text": "normally it's after 1 minute so I think",
    "start": "1354240",
    "end": "1356880"
  },
  {
    "text": "we can wait a little",
    "start": "1356880",
    "end": "1358600"
  },
  {
    "text": "more and here we have it so our new",
    "start": "1358600",
    "end": "1362799"
  },
  {
    "text": "cluster API node which has just booted",
    "start": "1362799",
    "end": "1365520"
  },
  {
    "text": "Talos just joined the existing HCD",
    "start": "1365520",
    "end": "1367960"
  },
  {
    "text": "cluster this is a good first step and",
    "start": "1367960",
    "end": "1370720"
  },
  {
    "text": "now that this is done the cube API",
    "start": "1370720",
    "end": "1372480"
  },
  {
    "text": "server on that control play node will",
    "start": "1372480",
    "end": "1374080"
  },
  {
    "text": "also be able to to to communicate with",
    "start": "1374080",
    "end": "1376159"
  },
  {
    "text": "HCD will be able to start and cubelet on",
    "start": "1376159",
    "end": "1379039"
  },
  {
    "text": "this new node will be able to to reach",
    "start": "1379039",
    "end": "1380960"
  },
  {
    "text": "that cube API server and register itself",
    "start": "1380960",
    "end": "1383600"
  },
  {
    "text": "in the existing cluster so now if we go",
    "start": "1383600",
    "end": "1386080"
  },
  {
    "text": "back to the nins tab where we have the",
    "start": "1386080",
    "end": "1388280"
  },
  {
    "text": "nodes we and if we wait a little more",
    "start": "1388280",
    "end": "1391200"
  },
  {
    "text": "for how long have we have been we have",
    "start": "1391200",
    "end": "1393360"
  },
  {
    "text": "we been waiting so far not sure so",
    "start": "1393360",
    "end": "1397360"
  },
  {
    "text": "almost two minutes so it should soon",
    "start": "1397360",
    "end": "1399039"
  },
  {
    "text": "come",
    "start": "1399039",
    "end": "1401159"
  },
  {
    "text": "up and so now the nice part is that I",
    "start": "1401159",
    "end": "1404559"
  },
  {
    "text": "could simply increase the number of",
    "start": "1404559",
    "end": "1405679"
  },
  {
    "text": "replica and there is then there will be",
    "start": "1405679",
    "end": "1407919"
  },
  {
    "text": "a new machine starting instantly and I",
    "start": "1407919",
    "end": "1410240"
  },
  {
    "text": "could do the same for the machine",
    "start": "1410240",
    "end": "1411919"
  },
  {
    "text": "deployments machine deployments is what",
    "start": "1411919",
    "end": "1413520"
  },
  {
    "text": "you use to provision uh worker nodes or",
    "start": "1413520",
    "end": "1416400"
  },
  {
    "text": "data plane nodes as we call those",
    "start": "1416400",
    "end": "1420520"
  },
  {
    "text": "so the suspense is",
    "start": "1420520",
    "end": "1425600"
  },
  {
    "text": "increasing let's check the talos kettle",
    "start": "1425799",
    "end": "1429120"
  },
  {
    "text": "so it's not yet happy about the cublet",
    "start": "1429120",
    "end": "1431280"
  },
  {
    "text": "endpoints and TLS internal error this is",
    "start": "1431280",
    "end": "1433440"
  },
  {
    "text": "normal because we haven't signed the",
    "start": "1433440",
    "end": "1435280"
  },
  {
    "text": "serving certificate yet",
    "start": "1435280",
    "end": "1438640"
  },
  {
    "text": "but if I continue talking normally the",
    "start": "1438640",
    "end": "1440240"
  },
  {
    "text": "node should",
    "start": "1440240",
    "end": "1441320"
  },
  {
    "text": "appear so",
    "start": "1441320",
    "end": "1443799"
  },
  {
    "text": "um before we continue um in the",
    "start": "1443799",
    "end": "1447200"
  },
  {
    "text": "description of the talk I had also",
    "start": "1447200",
    "end": "1449039"
  },
  {
    "text": "mentioned some Argo CD uh application",
    "start": "1449039",
    "end": "1452240"
  },
  {
    "text": "set uh uh parts i will not be covering",
    "start": "1452240",
    "end": "1455279"
  },
  {
    "text": "that because I don't think we have",
    "start": "1455279",
    "end": "1456559"
  },
  {
    "text": "enough time and it goes into too many",
    "start": "1456559",
    "end": "1458000"
  },
  {
    "text": "details i should prepare that for",
    "start": "1458000",
    "end": "1459600"
  },
  {
    "text": "another talk at some point but I put",
    "start": "1459600",
    "end": "1461919"
  },
  {
    "text": "those slides at the at the end of the",
    "start": "1461919",
    "end": "1464320"
  },
  {
    "text": "slides slide deck you have some some of",
    "start": "1464320",
    "end": "1466720"
  },
  {
    "text": "the templates that we use and it can be",
    "start": "1466720",
    "end": "1468480"
  },
  {
    "text": "quite helpful in managing the workload",
    "start": "1468480",
    "end": "1470440"
  },
  {
    "text": "clusters and so yeah here we have our",
    "start": "1470440",
    "end": "1472960"
  },
  {
    "text": "new node which has joined the existing",
    "start": "1472960",
    "end": "1474640"
  },
  {
    "text": "lab um F cubadm cluster uh we see selium",
    "start": "1474640",
    "end": "1479120"
  },
  {
    "text": "which is starting and uh yeah in a few",
    "start": "1479120",
    "end": "1482080"
  },
  {
    "text": "few seconds we should have all nodes uh",
    "start": "1482080",
    "end": "1484799"
  },
  {
    "text": "with the ready status and which means",
    "start": "1484799",
    "end": "1487200"
  },
  {
    "text": "that we will have uh actually migrated",
    "start": "1487200",
    "end": "1490080"
  },
  {
    "text": "or we we then we have done the first",
    "start": "1490080",
    "end": "1492320"
  },
  {
    "text": "step towards migrating there is still",
    "start": "1492320",
    "end": "1494480"
  },
  {
    "text": "some some work to be done to complete",
    "start": "1494480",
    "end": "1496640"
  },
  {
    "text": "the migration but the the first step at",
    "start": "1496640",
    "end": "1498880"
  },
  {
    "text": "least it's done we have a node which we",
    "start": "1498880",
    "end": "1502000"
  },
  {
    "text": "a control plane node which we integrated",
    "start": "1502000",
    "end": "1503919"
  },
  {
    "text": "with the existing cubeadm control plane",
    "start": "1503919",
    "end": "1506720"
  },
  {
    "text": "so it's not worth waiting for another",
    "start": "1506720",
    "end": "1508960"
  },
  {
    "text": "minute that it comes ready maybe I can",
    "start": "1508960",
    "end": "1511520"
  },
  {
    "text": "switch back to this one later so that",
    "start": "1511520",
    "end": "1514320"
  },
  {
    "text": "was for the live migration now um the",
    "start": "1514320",
    "end": "1516400"
  },
  {
    "text": "bootstrapping issue the chicken and egg",
    "start": "1516400",
    "end": "1518320"
  },
  {
    "text": "problem um so we want to manage our",
    "start": "1518320",
    "end": "1521919"
  },
  {
    "text": "clusters with kubernetes cluster but How",
    "start": "1521919",
    "end": "1525039"
  },
  {
    "text": "do we do when the in the disaster",
    "start": "1525039",
    "end": "1527279"
  },
  {
    "text": "recovery scenario if we lose everything",
    "start": "1527279",
    "end": "1529360"
  },
  {
    "text": "if we don't have any clusters how how do",
    "start": "1529360",
    "end": "1531120"
  },
  {
    "text": "we manage our workload clusters without",
    "start": "1531120",
    "end": "1532960"
  },
  {
    "text": "a management cluster API cluster and so",
    "start": "1532960",
    "end": "1536080"
  },
  {
    "text": "the idea that we had is to use an",
    "start": "1536080",
    "end": "1538080"
  },
  {
    "text": "ephemeral tool or and we we we have",
    "start": "1538080",
    "end": "1541520"
  },
  {
    "text": "written a a small go utility that we",
    "start": "1541520",
    "end": "1544320"
  },
  {
    "text": "might open source at some point and what",
    "start": "1544320",
    "end": "1546480"
  },
  {
    "text": "this utility does it it starts a kind",
    "start": "1546480",
    "end": "1548480"
  },
  {
    "text": "cluster locally uh it installs all the",
    "start": "1548480",
    "end": "1551360"
  },
  {
    "text": "cluster API CRDs and controller on the",
    "start": "1551360",
    "end": "1553600"
  },
  {
    "text": "on the cluster",
    "start": "1553600",
    "end": "1555200"
  },
  {
    "text": "And then it rest it checks on on an S3",
    "start": "1555200",
    "end": "1558480"
  },
  {
    "text": "endpoint whether we have already",
    "start": "1558480",
    "end": "1560240"
  },
  {
    "text": "existing manifests and for an existing",
    "start": "1560240",
    "end": "1562960"
  },
  {
    "text": "cluster or not and if those manifests",
    "start": "1562960",
    "end": "1565039"
  },
  {
    "text": "are there it just reimpports those and",
    "start": "1565039",
    "end": "1567039"
  },
  {
    "text": "then it can manage the the the cluster",
    "start": "1567039",
    "end": "1569760"
  },
  {
    "text": "and if those manifests are not there yet",
    "start": "1569760",
    "end": "1572000"
  },
  {
    "text": "what it does is just it will just",
    "start": "1572000",
    "end": "1574320"
  },
  {
    "text": "provision a new management cluster so",
    "start": "1574320",
    "end": "1577600"
  },
  {
    "text": "for only for the management cluster we",
    "start": "1577600",
    "end": "1579919"
  },
  {
    "text": "use this um ephemeral tool uh to",
    "start": "1579919",
    "end": "1583840"
  },
  {
    "text": "actually manage the management cluster",
    "start": "1583840",
    "end": "1585760"
  },
  {
    "text": "itself that's the solution that we found",
    "start": "1585760",
    "end": "1588240"
  },
  {
    "text": "we run that in a gitlab pipeline but we",
    "start": "1588240",
    "end": "1590720"
  },
  {
    "text": "could also run that on our laptop if we",
    "start": "1590720",
    "end": "1592400"
  },
  {
    "text": "needed we just need to collect all",
    "start": "1592400",
    "end": "1593679"
  },
  {
    "text": "secrets and have the right network",
    "start": "1593679",
    "end": "1595440"
  },
  {
    "text": "access but then we could really",
    "start": "1595440",
    "end": "1598400"
  },
  {
    "text": "provision a cluster from scratch in a",
    "start": "1598400",
    "end": "1600400"
  },
  {
    "text": "disaster disaster recovery scenario so",
    "start": "1600400",
    "end": "1603760"
  },
  {
    "text": "that's it for the that's our solution to",
    "start": "1603760",
    "end": "1606159"
  },
  {
    "text": "the bootstrap bootstrapping",
    "start": "1606159",
    "end": "1608200"
  },
  {
    "text": "issue so in conclusion we we have seen",
    "start": "1608200",
    "end": "1611200"
  },
  {
    "text": "how to match configuration import the",
    "start": "1611200",
    "end": "1613279"
  },
  {
    "text": "existing PKI add new nodes we saw what",
    "start": "1613279",
    "end": "1616159"
  },
  {
    "text": "could go wrong on the way and uh the the",
    "start": "1616159",
    "end": "1619600"
  },
  {
    "text": "last step that we'll be able to conduct",
    "start": "1619600",
    "end": "1621360"
  },
  {
    "text": "in a few months will be to remove the",
    "start": "1621360",
    "end": "1623520"
  },
  {
    "text": "cubadium",
    "start": "1623520",
    "end": "1625640"
  },
  {
    "text": "nodes so yeah I think that's it for for",
    "start": "1625640",
    "end": "1628559"
  },
  {
    "text": "my for this session uh I will end up",
    "start": "1628559",
    "end": "1630559"
  },
  {
    "text": "with um few words uh in PWA pwa is the",
    "start": "1630559",
    "end": "1634720"
  },
  {
    "text": "old dialect from from from the French",
    "start": "1634720",
    "end": "1637600"
  },
  {
    "text": "speaking pact of Switzerland and it",
    "start": "1637600",
    "end": "1639760"
  },
  {
    "text": "means uh take care so poi",
    "start": "1639760",
    "end": "1644240"
  },
  {
    "text": "thanks so if there are any questions I'm",
    "start": "1647880",
    "end": "1650400"
  },
  {
    "text": "happy to take questions right now or",
    "start": "1650400",
    "end": "1652640"
  },
  {
    "text": "after the session as you like",
    "start": "1652640",
    "end": "1656760"
  },
  {
    "text": "i don't see any question so I guess",
    "start": "1656880",
    "end": "1659760"
  },
  {
    "text": "that's it thanks",
    "start": "1659760",
    "end": "1663240"
  }
]