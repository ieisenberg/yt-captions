[
  {
    "text": "all right so um I'm going to be giving a",
    "start": "280",
    "end": "2720"
  },
  {
    "text": "talk about uh tuning The otel Collector",
    "start": "2720",
    "end": "5160"
  },
  {
    "text": "performance through profiling uh this is",
    "start": "5160",
    "end": "8200"
  },
  {
    "text": "specifically about some of the work I've",
    "start": "8200",
    "end": "9760"
  },
  {
    "text": "been doing using uh prpr built-in to go",
    "start": "9760",
    "end": "12840"
  },
  {
    "text": "to uh make some minor improvements or",
    "start": "12840",
    "end": "15480"
  },
  {
    "text": "analyze some performance problems with",
    "start": "15480",
    "end": "17000"
  },
  {
    "text": "the open lemetry collector uh this is",
    "start": "17000",
    "end": "19359"
  },
  {
    "text": "sort of a two-prong talk you know one of",
    "start": "19359",
    "end": "21119"
  },
  {
    "text": "is to sort of build excitement for the",
    "start": "21119",
    "end": "22560"
  },
  {
    "text": "profiling signal in general if you're",
    "start": "22560",
    "end": "23880"
  },
  {
    "text": "not familiar with it but also to show",
    "start": "23880",
    "end": "26039"
  },
  {
    "text": "that these tools already exist to start",
    "start": "26039",
    "end": "28519"
  },
  {
    "text": "getting into profiling if you're into",
    "start": "28519",
    "end": "30000"
  },
  {
    "text": "interested uh it's all very accessible",
    "start": "30000",
    "end": "32960"
  },
  {
    "text": "uh so I'm Braden KES uh you might know",
    "start": "32960",
    "end": "36280"
  },
  {
    "text": "me through GitHub as Braden K or if",
    "start": "36280",
    "end": "38280"
  },
  {
    "text": "you're a big meany head brayon uh I work",
    "start": "38280",
    "end": "42280"
  },
  {
    "text": "on the open Telemetry collector and",
    "start": "42280",
    "end": "43680"
  },
  {
    "text": "semantic conventions mainly focused on",
    "start": "43680",
    "end": "45879"
  },
  {
    "text": "uh system metrics since it's a we we",
    "start": "45879",
    "end": "48760"
  },
  {
    "text": "heavily use it on the Google Cloud Ops",
    "start": "48760",
    "end": "50399"
  },
  {
    "text": "agent which is uh my team's tool um so",
    "start": "50399",
    "end": "53719"
  },
  {
    "text": "I'm a code owner on the host metric",
    "start": "53719",
    "end": "55520"
  },
  {
    "text": "receiver and I'm a member of the system",
    "start": "55520",
    "end": "57239"
  },
  {
    "text": "metric semantic conventions working",
    "start": "57239",
    "end": "58519"
  },
  {
    "text": "group",
    "start": "58519",
    "end": "60640"
  },
  {
    "text": "uh I'm going to start by grossly",
    "start": "60640",
    "end": "62239"
  },
  {
    "text": "oversimplifying what a profile is to",
    "start": "62239",
    "end": "63920"
  },
  {
    "text": "sort of uh explain it if you've never",
    "start": "63920",
    "end": "65720"
  },
  {
    "text": "heard of it this is the analogy that",
    "start": "65720",
    "end": "68080"
  },
  {
    "text": "sort of cracked it for me um if you",
    "start": "68080",
    "end": "70320"
  },
  {
    "text": "think of a metric um usually it is a",
    "start": "70320",
    "end": "73119"
  },
  {
    "text": "Time series data point it's a",
    "start": "73119",
    "end": "74520"
  },
  {
    "text": "measurement of something at a period at",
    "start": "74520",
    "end": "78360"
  },
  {
    "text": "like a time stamp at a period of time if",
    "start": "78360",
    "end": "80799"
  },
  {
    "text": "you map that data over a span of time",
    "start": "80799",
    "end": "83119"
  },
  {
    "text": "you can start to paint a nice picture of",
    "start": "83119",
    "end": "85040"
  },
  {
    "text": "what was going on with that measurement",
    "start": "85040",
    "end": "86560"
  },
  {
    "text": "over that span of time uh the way I like",
    "start": "86560",
    "end": "89040"
  },
  {
    "text": "to think of profiling is kind of like",
    "start": "89040",
    "end": "90520"
  },
  {
    "text": "that except instead of a measurement",
    "start": "90520",
    "end": "92000"
  },
  {
    "text": "taken at a period of time it's a",
    "start": "92000",
    "end": "94920"
  },
  {
    "text": "measurement taken at a location in a",
    "start": "94920",
    "end": "96799"
  },
  {
    "text": "program and when you paint that over all",
    "start": "96799",
    "end": "98880"
  },
  {
    "text": "the locations available to the program",
    "start": "98880",
    "end": "100600"
  },
  {
    "text": "you can start to paint a picture of what",
    "start": "100600",
    "end": "102159"
  },
  {
    "text": "your program was doing with the",
    "start": "102159",
    "end": "103799"
  },
  {
    "text": "measurement you're taking whether that",
    "start": "103799",
    "end": "104960"
  },
  {
    "text": "be CPU or memory based um these are some",
    "start": "104960",
    "end": "108799"
  },
  {
    "text": "of the uh profiling uh some some of the",
    "start": "108799",
    "end": "112600"
  },
  {
    "text": "profiling formats you might be familiar",
    "start": "112600",
    "end": "113960"
  },
  {
    "text": "with my first time using profiling was",
    "start": "113960",
    "end": "115439"
  },
  {
    "text": "actually uh with a call grind this is a",
    "start": "115439",
    "end": "117799"
  },
  {
    "text": "tool under Val grind I had no idea what",
    "start": "117799",
    "end": "120159"
  },
  {
    "text": "any of it meant uh PPR is the format I'm",
    "start": "120159",
    "end": "123840"
  },
  {
    "text": "going to be talking about today and otel",
    "start": "123840",
    "end": "126039"
  },
  {
    "text": "profiles are uh an extension of PPR you",
    "start": "126039",
    "end": "128679"
  },
  {
    "text": "know the the current version to proposal",
    "start": "128679",
    "end": "132120"
  },
  {
    "text": "of the data model is actually just a",
    "start": "132120",
    "end": "133640"
  },
  {
    "text": "straight extension of PPR it's backwards",
    "start": "133640",
    "end": "135400"
  },
  {
    "text": "compatible with the old format um the",
    "start": "135400",
    "end": "138720"
  },
  {
    "text": "reason I'm going to be talking about P",
    "start": "138720",
    "end": "140160"
  },
  {
    "text": "today um mainly is that for one thing it",
    "start": "140160",
    "end": "144080"
  },
  {
    "text": "has uh support for multiple types of",
    "start": "144080",
    "end": "147040"
  },
  {
    "text": "signal signals and measurements uh you",
    "start": "147040",
    "end": "149480"
  },
  {
    "text": "can call grind for examples focused",
    "start": "149480",
    "end": "151360"
  },
  {
    "text": "specifically on CPU profiling and uh you",
    "start": "151360",
    "end": "154239"
  },
  {
    "text": "know kernel Linux kernel perf is another",
    "start": "154239",
    "end": "156319"
  },
  {
    "text": "popular one that's very focused on the",
    "start": "156319",
    "end": "158519"
  },
  {
    "text": "CPU side of things but PPR does both and",
    "start": "158519",
    "end": "161120"
  },
  {
    "text": "we're going to be looking at both today",
    "start": "161120",
    "end": "163519"
  },
  {
    "text": "um and I already mentioned that whoops",
    "start": "163519",
    "end": "165879"
  },
  {
    "text": "uh but yes it's the format that otel",
    "start": "165879",
    "end": "167599"
  },
  {
    "text": "profiles are based off of um the tools",
    "start": "167599",
    "end": "170080"
  },
  {
    "text": "to utilize it are actually built right",
    "start": "170080",
    "end": "172040"
  },
  {
    "text": "into go which the open Telemetry",
    "start": "172040",
    "end": "173680"
  },
  {
    "text": "collector is written in or you might",
    "start": "173680",
    "end": "175159"
  },
  {
    "text": "have applications written in it as well",
    "start": "175159",
    "end": "177159"
  },
  {
    "text": "uh and I'm going to be demonstrating a",
    "start": "177159",
    "end": "178120"
  },
  {
    "text": "little bit of that today as well uh to",
    "start": "178120",
    "end": "180000"
  },
  {
    "text": "use prpr with the otel collector uh you",
    "start": "180000",
    "end": "182360"
  },
  {
    "text": "can use the prpr extension um this",
    "start": "182360",
    "end": "186319"
  },
  {
    "text": "automatically configures the stuff that",
    "start": "186319",
    "end": "188440"
  },
  {
    "text": "you would need to manually configure",
    "start": "188440",
    "end": "189799"
  },
  {
    "text": "yourself which is not all that hard",
    "start": "189799",
    "end": "191480"
  },
  {
    "text": "really but it's even more convenient",
    "start": "191480",
    "end": "192760"
  },
  {
    "text": "that it's built in uh this will actually",
    "start": "192760",
    "end": "195200"
  },
  {
    "text": "spin up a PPR server that you can go",
    "start": "195200",
    "end": "198280"
  },
  {
    "text": "query yourself with the PPR tool to get",
    "start": "198280",
    "end": "200599"
  },
  {
    "text": "a profile at a specific time get a",
    "start": "200599",
    "end": "202319"
  },
  {
    "text": "specific type of profile at a certain",
    "start": "202319",
    "end": "203920"
  },
  {
    "text": "time uh you you do that with this",
    "start": "203920",
    "end": "206360"
  },
  {
    "text": "command uh if you have go installed this",
    "start": "206360",
    "end": "208640"
  },
  {
    "text": "is already here you don't have to do any",
    "start": "208640",
    "end": "210000"
  },
  {
    "text": "extra go install or anything like that",
    "start": "210000",
    "end": "211680"
  },
  {
    "text": "it's actually built into the",
    "start": "211680",
    "end": "213120"
  },
  {
    "text": "installation um and then that's it sort",
    "start": "213120",
    "end": "216439"
  },
  {
    "text": "of you have to install graph F to get",
    "start": "216439",
    "end": "218000"
  },
  {
    "text": "the graphs and stuff but for the most",
    "start": "218000",
    "end": "219519"
  },
  {
    "text": "part this is it uh and this is all you",
    "start": "219519",
    "end": "220959"
  },
  {
    "text": "need to do to get started with it uh so",
    "start": "220959",
    "end": "223200"
  },
  {
    "text": "I'm going to be looking at a couple of",
    "start": "223200",
    "end": "224239"
  },
  {
    "text": "case studies and because I know I'm",
    "start": "224239",
    "end": "226319"
  },
  {
    "text": "playing us into the break and",
    "start": "226319",
    "end": "227519"
  },
  {
    "text": "everybody's excited for coffee I'm going",
    "start": "227519",
    "end": "229680"
  },
  {
    "text": "to try and be a little bit brief with it",
    "start": "229680",
    "end": "232079"
  },
  {
    "text": "but I will try and hopefully get all the",
    "start": "232079",
    "end": "234519"
  },
  {
    "text": "information we need out of it this uh",
    "start": "234519",
    "end": "236879"
  },
  {
    "text": "issue came to my attention uh when I was",
    "start": "236879",
    "end": "239480"
  },
  {
    "text": "talking internally about Prometheus",
    "start": "239480",
    "end": "241360"
  },
  {
    "text": "receiver performance stuff that I was",
    "start": "241360",
    "end": "242560"
  },
  {
    "text": "trying to improve and this issue opened",
    "start": "242560",
    "end": "245120"
  },
  {
    "text": "by Enrique who you might be you might",
    "start": "245120",
    "end": "246560"
  },
  {
    "text": "know him from his uh YouTube channel is",
    "start": "246560",
    "end": "248840"
  },
  {
    "text": "it observable uh he was doing some uh",
    "start": "248840",
    "end": "251560"
  },
  {
    "text": "performance testing of different",
    "start": "251560",
    "end": "253319"
  },
  {
    "text": "Prometheus scrapers and he was having",
    "start": "253319",
    "end": "255000"
  },
  {
    "text": "issues with the Prometheus receiver",
    "start": "255000",
    "end": "256919"
  },
  {
    "text": "doing what it looked like it was leaking",
    "start": "256919",
    "end": "258759"
  },
  {
    "text": "memory because it was the memory was",
    "start": "258759",
    "end": "260479"
  },
  {
    "text": "constantly growing over time uh so I",
    "start": "260479",
    "end": "263080"
  },
  {
    "text": "opened up prpr to try and get some",
    "start": "263080",
    "end": "266560"
  },
  {
    "text": "information and oops there we go we go",
    "start": "266560",
    "end": "270720"
  },
  {
    "text": "uh when you open up uh the PPR web UI",
    "start": "270720",
    "end": "274120"
  },
  {
    "text": "this is sort of what you get um the",
    "start": "274120",
    "end": "278039"
  },
  {
    "text": "default view here is a graph which is um",
    "start": "278039",
    "end": "281800"
  },
  {
    "text": "pretty good for for memory maybe not so",
    "start": "281800",
    "end": "284520"
  },
  {
    "text": "much for CPU profiles but it's a pretty",
    "start": "284520",
    "end": "285960"
  },
  {
    "text": "good view for memory you can sort of see",
    "start": "285960",
    "end": "288240"
  },
  {
    "text": "that oh geez this is going to be tough",
    "start": "288240",
    "end": "290000"
  },
  {
    "text": "because I'm on a lower resolution uh but",
    "start": "290000",
    "end": "292960"
  },
  {
    "text": "you can sort of see what where different",
    "start": "292960",
    "end": "295720"
  },
  {
    "text": "allocations are happening and where",
    "start": "295720",
    "end": "297360"
  },
  {
    "text": "different spots are holding memory uh",
    "start": "297360",
    "end": "299400"
  },
  {
    "text": "for today we're actually going to be",
    "start": "299400",
    "end": "300479"
  },
  {
    "text": "looking specifically at the flame graph",
    "start": "300479",
    "end": "302919"
  },
  {
    "text": "visualization um oh it's so zoomed in",
    "start": "302919",
    "end": "305919"
  },
  {
    "text": "this is going to be fun uh This what I",
    "start": "305919",
    "end": "309080"
  },
  {
    "text": "had enre do was to take profiles at",
    "start": "309080",
    "end": "313120"
  },
  {
    "text": "every hour over a period of time since I",
    "start": "313120",
    "end": "315320"
  },
  {
    "text": "couldn't really replicate his setup so",
    "start": "315320",
    "end": "317520"
  },
  {
    "text": "well so it's sort of like budget",
    "start": "317520",
    "end": "319120"
  },
  {
    "text": "continuous profiling um this first",
    "start": "319120",
    "end": "321800"
  },
  {
    "text": "profile we're seeing we're working with",
    "start": "321800",
    "end": "323440"
  },
  {
    "text": "half a gig of Heap space when you look",
    "start": "323440",
    "end": "325800"
  },
  {
    "text": "at a PPR profile you're specifically",
    "start": "325800",
    "end": "327880"
  },
  {
    "text": "looking at the the Heap there is more",
    "start": "327880",
    "end": "330280"
  },
  {
    "text": "memory that ends up getting used if you",
    "start": "330280",
    "end": "331720"
  },
  {
    "text": "read the number from your system versus",
    "start": "331720",
    "end": "333720"
  },
  {
    "text": "the profile you're going to get a",
    "start": "333720",
    "end": "334840"
  },
  {
    "text": "different number because the Heap is",
    "start": "334840",
    "end": "336160"
  },
  {
    "text": "only one part of the memory map but it",
    "start": "336160",
    "end": "338199"
  },
  {
    "text": "is important for when we're talking",
    "start": "338199",
    "end": "339440"
  },
  {
    "text": "about memory leaks because memory leaks",
    "start": "339440",
    "end": "341919"
  },
  {
    "text": "are like the region of memory that's",
    "start": "341919",
    "end": "344120"
  },
  {
    "text": "growing is going to be the Heap usually",
    "start": "344120",
    "end": "346800"
  },
  {
    "text": "um if we look at this for an issue",
    "start": "346800",
    "end": "350560"
  },
  {
    "text": "called Prometheus receiver memory leak",
    "start": "350560",
    "end": "353199"
  },
  {
    "text": "this spot where the Prometheus receiver",
    "start": "353199",
    "end": "354560"
  },
  {
    "text": "is actually allocating memory is really",
    "start": "354560",
    "end": "356000"
  },
  {
    "text": "not that big and I was a bit surprised",
    "start": "356000",
    "end": "357720"
  },
  {
    "text": "by that but this is pretty early in the",
    "start": "357720",
    "end": "359120"
  },
  {
    "text": "measurement the biggest thing that we",
    "start": "359120",
    "end": "361360"
  },
  {
    "text": "see right now is actually the cumulative",
    "start": "361360",
    "end": "364000"
  },
  {
    "text": "to Delta processor uh this works by",
    "start": "364000",
    "end": "366759"
  },
  {
    "text": "storing an original point of of the",
    "start": "366759",
    "end": "370280"
  },
  {
    "text": "metric to do a Delta calculation against",
    "start": "370280",
    "end": "372319"
  },
  {
    "text": "because that's how uh Delta metrics work",
    "start": "372319",
    "end": "374400"
  },
  {
    "text": "so for the first profile early on in the",
    "start": "374400",
    "end": "376759"
  },
  {
    "text": "Run we kind of expect that this would be",
    "start": "376759",
    "end": "378280"
  },
  {
    "text": "relatively large if you're doing a lot",
    "start": "378280",
    "end": "379639"
  },
  {
    "text": "of metrics if you're converting a lot of",
    "start": "379639",
    "end": "381160"
  },
  {
    "text": "metrics there needs to be for each",
    "start": "381160",
    "end": "382919"
  },
  {
    "text": "metric identity you know an original",
    "start": "382919",
    "end": "385240"
  },
  {
    "text": "point to calculate against so maybe",
    "start": "385240",
    "end": "387520"
  },
  {
    "text": "that's okay for the first profile but I",
    "start": "387520",
    "end": "389800"
  },
  {
    "text": "kind of hoped that what what what I",
    "start": "389800",
    "end": "391960"
  },
  {
    "text": "would expect to see is in the later",
    "start": "391960",
    "end": "393319"
  },
  {
    "text": "profile I have another profile from like",
    "start": "393319",
    "end": "394680"
  },
  {
    "text": "5 hours later and that this region of",
    "start": "394680",
    "end": "396960"
  },
  {
    "text": "memory from the Prometheus receiver I",
    "start": "396960",
    "end": "398960"
  },
  {
    "text": "would expect to see it grow um if we go",
    "start": "398960",
    "end": "402400"
  },
  {
    "text": "and look at the from five hours later it",
    "start": "402400",
    "end": "405880"
  },
  {
    "text": "has grown quite a bit we're up to two",
    "start": "405880",
    "end": "407400"
  },
  {
    "text": "and a half gigs of Heap space but the",
    "start": "407400",
    "end": "409759"
  },
  {
    "text": "shape is basically the same the",
    "start": "409759",
    "end": "411680"
  },
  {
    "text": "cumulative to Delta processor uh is",
    "start": "411680",
    "end": "414039"
  },
  {
    "text": "still taking up the most and the numbers",
    "start": "414039",
    "end": "416440"
  },
  {
    "text": "themselves have continued to grow um and",
    "start": "416440",
    "end": "420199"
  },
  {
    "text": "when I thought I had more time I was",
    "start": "420199",
    "end": "421400"
  },
  {
    "text": "going to take on us all on an adventure",
    "start": "421400",
    "end": "423080"
  },
  {
    "text": "through how this all works in the",
    "start": "423080",
    "end": "424560"
  },
  {
    "text": "cumulative to Delta processor but we",
    "start": "424560",
    "end": "426000"
  },
  {
    "text": "don't have time so basically what this",
    "start": "426000",
    "end": "428800"
  },
  {
    "text": "what this led me to believe is that",
    "start": "428800",
    "end": "430319"
  },
  {
    "text": "there are some manner of cardinality",
    "start": "430319",
    "end": "432759"
  },
  {
    "text": "leakage um this sync map loader store",
    "start": "432759",
    "end": "436000"
  },
  {
    "text": "this map is a storage of uh different",
    "start": "436000",
    "end": "438599"
  },
  {
    "text": "metric identities where it's like the",
    "start": "438599",
    "end": "440319"
  },
  {
    "text": "name the labels and the label values so",
    "start": "440319",
    "end": "443120"
  },
  {
    "text": "that every unique time Series has its",
    "start": "443120",
    "end": "444680"
  },
  {
    "text": "own original data point stored um this",
    "start": "444680",
    "end": "447840"
  },
  {
    "text": "region of memory continues to grow and",
    "start": "447840",
    "end": "449639"
  },
  {
    "text": "even through through every profile this",
    "start": "449639",
    "end": "451560"
  },
  {
    "text": "was consistently the one that was",
    "start": "451560",
    "end": "452840"
  },
  {
    "text": "growing which led me to believe that one",
    "start": "452840",
    "end": "454639"
  },
  {
    "text": "of the metric pipelines there has some",
    "start": "454639",
    "end": "457000"
  },
  {
    "text": "manner of cardinality leakage um but the",
    "start": "457000",
    "end": "460720"
  },
  {
    "text": "the Prometheus endpoints he was scraping",
    "start": "460720",
    "end": "462360"
  },
  {
    "text": "were popular like community exporters",
    "start": "462360",
    "end": "464479"
  },
  {
    "text": "and I don't really know which one is the",
    "start": "464479",
    "end": "465879"
  },
  {
    "text": "culprit we haven't figured that out yet",
    "start": "465879",
    "end": "467960"
  },
  {
    "text": "um but there is a feature in the",
    "start": "467960",
    "end": "469199"
  },
  {
    "text": "communative to Delta processor that will",
    "start": "469199",
    "end": "471080"
  },
  {
    "text": "evict old entries if it hasn't seen it",
    "start": "471080",
    "end": "472879"
  },
  {
    "text": "in a certain amount of time so I am",
    "start": "472879",
    "end": "475319"
  },
  {
    "text": "having him configure that to hopefully",
    "start": "475319",
    "end": "477039"
  },
  {
    "text": "see that that region of memory not grow",
    "start": "477039",
    "end": "480560"
  },
  {
    "text": "too much if we have cardinality leakage",
    "start": "480560",
    "end": "482240"
  },
  {
    "text": "in one of the pipelines but that's a",
    "start": "482240",
    "end": "484319"
  },
  {
    "text": "good lesson about using cumulative to",
    "start": "484319",
    "end": "485639"
  },
  {
    "text": "Delta make sure you're not leaking",
    "start": "485639",
    "end": "486840"
  },
  {
    "text": "cardinality too much because this can",
    "start": "486840",
    "end": "489080"
  },
  {
    "text": "this can happen or at least make sure",
    "start": "489080",
    "end": "490360"
  },
  {
    "text": "you configure the cache eviction um oops",
    "start": "490360",
    "end": "495120"
  },
  {
    "text": "that's the wrong one the second case",
    "start": "495120",
    "end": "498280"
  },
  {
    "text": "study that we're going to be looking at",
    "start": "498280",
    "end": "500280"
  },
  {
    "text": "um I'm a host metrics code owner um and",
    "start": "500280",
    "end": "503159"
  },
  {
    "text": "one of the Crusades that I've been on is",
    "start": "503159",
    "end": "505080"
  },
  {
    "text": "to make process metric collection more",
    "start": "505080",
    "end": "508000"
  },
  {
    "text": "efficient because process metrics are",
    "start": "508000",
    "end": "510560"
  },
  {
    "text": "very high cardinality and to get a lot",
    "start": "510560",
    "end": "512360"
  },
  {
    "text": "of the information you need you need to",
    "start": "512360",
    "end": "513719"
  },
  {
    "text": "make system calls and that's very",
    "start": "513719",
    "end": "515518"
  },
  {
    "text": "expensive uh and we had these two issues",
    "start": "515519",
    "end": "518640"
  },
  {
    "text": "we're only going to be looking at one of",
    "start": "518640",
    "end": "519599"
  },
  {
    "text": "them today I don't have time if you want",
    "start": "519599",
    "end": "520800"
  },
  {
    "text": "to talk about the first one where uh we",
    "start": "520800",
    "end": "524720"
  },
  {
    "text": "were looking at uh host metric receiver",
    "start": "524720",
    "end": "526880"
  },
  {
    "text": "on Linux uh the fix for that has",
    "start": "526880",
    "end": "529120"
  },
  {
    "text": "actually landed so if you want to talk",
    "start": "529120",
    "end": "530320"
  },
  {
    "text": "about it come find me after um but I'm",
    "start": "530320",
    "end": "532640"
  },
  {
    "text": "going to be looking at the slightly more",
    "start": "532640",
    "end": "533720"
  },
  {
    "text": "interesting one which is the second",
    "start": "533720",
    "end": "535360"
  },
  {
    "text": "issue related to uh process scraping on",
    "start": "535360",
    "end": "537920"
  },
  {
    "text": "Windows uh of course the the challenge",
    "start": "537920",
    "end": "539839"
  },
  {
    "text": "of the host metrics receiver is that the",
    "start": "539839",
    "end": "542640"
  },
  {
    "text": "a lot of the process metrics are the",
    "start": "542640",
    "end": "544000"
  },
  {
    "text": "same or across platforms but the",
    "start": "544000",
    "end": "545800"
  },
  {
    "text": "implementation of how you get them is",
    "start": "545800",
    "end": "547079"
  },
  {
    "text": "completely different uh so we're I'm",
    "start": "547079",
    "end": "549600"
  },
  {
    "text": "going to look at two profiles this first",
    "start": "549600",
    "end": "552440"
  },
  {
    "text": "one um is this now we're into CPU",
    "start": "552440",
    "end": "555120"
  },
  {
    "text": "profiles the last one was a memory",
    "start": "555120",
    "end": "556360"
  },
  {
    "text": "profile this is a uh CPU profile of one",
    "start": "556360",
    "end": "559920"
  },
  {
    "text": "scrape I I time you when you take a CPU",
    "start": "559920",
    "end": "562640"
  },
  {
    "text": "profile you time it over a certain",
    "start": "562640",
    "end": "563959"
  },
  {
    "text": "amount of time uh and pre- profile",
    "start": "563959",
    "end": "566640"
  },
  {
    "text": "sample at a certain rate for events",
    "start": "566640",
    "end": "570120"
  },
  {
    "text": "uh and you can get the 740 milliseconds",
    "start": "570120",
    "end": "573560"
  },
  {
    "text": "we see here that is how much on CPU work",
    "start": "573560",
    "end": "577160"
  },
  {
    "text": "was sampled uh and this is",
    "start": "577160",
    "end": "579079"
  },
  {
    "text": "representative of one process scrape",
    "start": "579079",
    "end": "581240"
  },
  {
    "text": "scrapes all the processes on the system",
    "start": "581240",
    "end": "582560"
  },
  {
    "text": "records all the metrics for it and that",
    "start": "582560",
    "end": "584200"
  },
  {
    "text": "usually happens on an interval it was",
    "start": "584200",
    "end": "585920"
  },
  {
    "text": "happening on interval but of about a",
    "start": "585920",
    "end": "587360"
  },
  {
    "text": "minute in this case and I sampled for 40",
    "start": "587360",
    "end": "589519"
  },
  {
    "text": "seconds so that's what we're looking at",
    "start": "589519",
    "end": "591760"
  },
  {
    "text": "um Beware of the jump",
    "start": "591760",
    "end": "594120"
  },
  {
    "text": "scare uh the width of these uh each",
    "start": "594120",
    "end": "600079"
  },
  {
    "text": "section is how much like What proportion",
    "start": "600079",
    "end": "602560"
  },
  {
    "text": "of the of the work essentially was being",
    "start": "602560",
    "end": "605360"
  },
  {
    "text": "taken here and because I'm I'm a little",
    "start": "605360",
    "end": "607360"
  },
  {
    "text": "squished because of the zoom in you",
    "start": "607360",
    "end": "608440"
  },
  {
    "text": "can't see but 88% of time was spent",
    "start": "608440",
    "end": "611600"
  },
  {
    "text": "getting the parent process ID for every",
    "start": "611600",
    "end": "613519"
  },
  {
    "text": "process in the scrape and when I saw",
    "start": "613519",
    "end": "614959"
  },
  {
    "text": "this I near jumped out of my chair uh",
    "start": "614959",
    "end": "617640"
  },
  {
    "text": "because it really shouldn't be that",
    "start": "617640",
    "end": "619240"
  },
  {
    "text": "ridiculous uh but it turns out with the",
    "start": "619240",
    "end": "621600"
  },
  {
    "text": "win32 API this call create tool help 32",
    "start": "621600",
    "end": "625519"
  },
  {
    "text": "snapshot is as far as I can see and as",
    "start": "625519",
    "end": "628600"
  },
  {
    "text": "far as the go PS util maintainers can",
    "start": "628600",
    "end": "630600"
  },
  {
    "text": "see the best way to get the parent",
    "start": "630600",
    "end": "632519"
  },
  {
    "text": "process ID for a process but this",
    "start": "632519",
    "end": "635399"
  },
  {
    "text": "snapshot snaps tons and tons of",
    "start": "635399",
    "end": "638480"
  },
  {
    "text": "information including Heap and thread",
    "start": "638480",
    "end": "640560"
  },
  {
    "text": "space for the entire process and it's",
    "start": "640560",
    "end": "642600"
  },
  {
    "text": "doing this for every process uh so that",
    "start": "642600",
    "end": "645120"
  },
  {
    "text": "is extremely expensive uh and I was on a",
    "start": "645120",
    "end": "648279"
  },
  {
    "text": "hunt for a better way to do it um",
    "start": "648279",
    "end": "650760"
  },
  {
    "text": "there's a lot of Microsoft people here",
    "start": "650760",
    "end": "652040"
  },
  {
    "text": "so they're going to kind of know this",
    "start": "652040",
    "end": "653399"
  },
  {
    "text": "part um but the the best other way that",
    "start": "653399",
    "end": "656519"
  },
  {
    "text": "I can see to get uh the parent process",
    "start": "656519",
    "end": "659600"
  },
  {
    "text": "ID was Through the Windows management",
    "start": "659600",
    "end": "661160"
  },
  {
    "text": "interface uh it has a SQL query type of",
    "start": "661160",
    "end": "664120"
  },
  {
    "text": "language where you can query information",
    "start": "664120",
    "end": "665800"
  },
  {
    "text": "about the system and specifically about",
    "start": "665800",
    "end": "668040"
  },
  {
    "text": "processes and I'm already using it on an",
    "start": "668040",
    "end": "670440"
  },
  {
    "text": "old metric that I implemented to get the",
    "start": "670440",
    "end": "672440"
  },
  {
    "text": "process uh handles uh process the",
    "start": "672440",
    "end": "675959"
  },
  {
    "text": "handles belonging to a process getting",
    "start": "675959",
    "end": "677760"
  },
  {
    "text": "that information the only really good",
    "start": "677760",
    "end": "680160"
  },
  {
    "text": "way I could see in the win32 API was",
    "start": "680160",
    "end": "682920"
  },
  {
    "text": "using an unsupported nquery system",
    "start": "682920",
    "end": "685200"
  },
  {
    "text": "information query process information I",
    "start": "685200",
    "end": "687560"
  },
  {
    "text": "forget what it's called but it's an",
    "start": "687560",
    "end": "688839"
  },
  {
    "text": "unsupported win32 API and the we weren't",
    "start": "688839",
    "end": "691720"
  },
  {
    "text": "really super excited about using that uh",
    "start": "691720",
    "end": "694560"
  },
  {
    "text": "so I started using the Windows",
    "start": "694560",
    "end": "696839"
  },
  {
    "text": "management interface to query get the",
    "start": "696839",
    "end": "699040"
  },
  {
    "text": "information for every process in one",
    "start": "699040",
    "end": "700959"
  },
  {
    "text": "query and then sort of organize that",
    "start": "700959",
    "end": "703000"
  },
  {
    "text": "information as we're scraping process uh",
    "start": "703000",
    "end": "705440"
  },
  {
    "text": "scrap doing this get process metadata",
    "start": "705440",
    "end": "707600"
  },
  {
    "text": "work uh and that led to this second",
    "start": "707600",
    "end": "711200"
  },
  {
    "text": "profile of the new version that I came",
    "start": "711200",
    "end": "712920"
  },
  {
    "text": "up with um and we are down to uh only",
    "start": "712920",
    "end": "716839"
  },
  {
    "text": "220 milliseconds of work roughly cut",
    "start": "716839",
    "end": "719519"
  },
  {
    "text": "quite a bit of work out of a single",
    "start": "719519",
    "end": "721040"
  },
  {
    "text": "scrape uh by doing this in a wmi query",
    "start": "721040",
    "end": "724480"
  },
  {
    "text": "uh the query is the most expensive part",
    "start": "724480",
    "end": "726600"
  },
  {
    "text": "of the process scrape still um but this",
    "start": "726600",
    "end": "729040"
  },
  {
    "text": "actually has a sort of a back door",
    "start": "729040",
    "end": "730320"
  },
  {
    "text": "improvement too which is if you use the",
    "start": "730320",
    "end": "732399"
  },
  {
    "text": "process. handle metric already if you've",
    "start": "732399",
    "end": "734560"
  },
  {
    "text": "enabled that um then the information all",
    "start": "734560",
    "end": "737560"
  },
  {
    "text": "comes in one query and it's not more",
    "start": "737560",
    "end": "739160"
  },
  {
    "text": "expensive to get that second metric so",
    "start": "739160",
    "end": "741560"
  },
  {
    "text": "this is a pretty good Improvement the pr",
    "start": "741560",
    "end": "743199"
  },
  {
    "text": "for it is open I haven't got it merged",
    "start": "743199",
    "end": "745199"
  },
  {
    "text": "yet but I'm hoping we can get that",
    "start": "745199",
    "end": "746639"
  },
  {
    "text": "merged um and the other thing that I did",
    "start": "746639",
    "end": "749440"
  },
  {
    "text": "was I made it so that if you disable the",
    "start": "749440",
    "end": "751399"
  },
  {
    "text": "parent PID like if you just don't really",
    "start": "751399",
    "end": "753079"
  },
  {
    "text": "care about that resource attribute uh",
    "start": "753079",
    "end": "755120"
  },
  {
    "text": "you can delete it and essentially what",
    "start": "755120",
    "end": "757360"
  },
  {
    "text": "you get is",
    "start": "757360",
    "end": "759920"
  },
  {
    "text": "just um let's see it was you ignore this",
    "start": "760279",
    "end": "764800"
  },
  {
    "text": "yeah you get down to 90 milliseconds so",
    "start": "764800",
    "end": "766800"
  },
  {
    "text": "if you don't if you don't want the",
    "start": "766800",
    "end": "769160"
  },
  {
    "text": "parent pit in your scraping processes on",
    "start": "769160",
    "end": "771279"
  },
  {
    "text": "Windows you don't care about that then",
    "start": "771279",
    "end": "772560"
  },
  {
    "text": "you can get much more efficient just by",
    "start": "772560",
    "end": "774360"
  },
  {
    "text": "disabling it after the pr is merged",
    "start": "774360",
    "end": "776040"
  },
  {
    "text": "hopefully that will get merged soon um",
    "start": "776040",
    "end": "780320"
  },
  {
    "text": "so I'm pretty close to being out of time",
    "start": "780320",
    "end": "782440"
  },
  {
    "text": "I'm sure uh so I'm just going to go",
    "start": "782440",
    "end": "784440"
  },
  {
    "text": "quickly through sort of some of the",
    "start": "784440",
    "end": "785720"
  },
  {
    "text": "conclusions we come here uh mainly the",
    "start": "785720",
    "end": "787839"
  },
  {
    "text": "main thing I want to take away is that",
    "start": "787839",
    "end": "789120"
  },
  {
    "text": "like this isn't Magic you know anybody",
    "start": "789120",
    "end": "791639"
  },
  {
    "text": "has the power to understand this if I",
    "start": "791639",
    "end": "793399"
  },
  {
    "text": "have the power to understand this uh and",
    "start": "793399",
    "end": "795320"
  },
  {
    "text": "the tools are readily available to",
    "start": "795320",
    "end": "796600"
  },
  {
    "text": "everyone so if you're an otel collector",
    "start": "796600",
    "end": "798440"
  },
  {
    "text": "developer or really if you're in any",
    "start": "798440",
    "end": "800440"
  },
  {
    "text": "language there's probably similar",
    "start": "800440",
    "end": "801800"
  },
  {
    "text": "solutions for this you know we don't",
    "start": "801800",
    "end": "803279"
  },
  {
    "text": "have to wait for otel profiling to be",
    "start": "803279",
    "end": "804880"
  },
  {
    "text": "ready to start solving some of the",
    "start": "804880",
    "end": "806199"
  },
  {
    "text": "problems that profiling is good at um",
    "start": "806199",
    "end": "808480"
  },
  {
    "text": "and if you have you know if you have a",
    "start": "808480",
    "end": "809920"
  },
  {
    "text": "collector even if you're not a developer",
    "start": "809920",
    "end": "811480"
  },
  {
    "text": "of The Collector but you want to",
    "start": "811480",
    "end": "812880"
  },
  {
    "text": "understand a little bit more about what",
    "start": "812880",
    "end": "813680"
  },
  {
    "text": "your collector's doing or you want to",
    "start": "813680",
    "end": "815480"
  },
  {
    "text": "you know report a GitHub issue uh using",
    "start": "815480",
    "end": "818320"
  },
  {
    "text": "the PPR extension and sort of",
    "start": "818320",
    "end": "819839"
  },
  {
    "text": "understanding how to like show either",
    "start": "819839",
    "end": "821519"
  },
  {
    "text": "show screenshots or send profiles along",
    "start": "821519",
    "end": "823560"
  },
  {
    "text": "to maintainers that stuff is very",
    "start": "823560",
    "end": "825440"
  },
  {
    "text": "useful um the profiling is in this CA in",
    "start": "825440",
    "end": "829920"
  },
  {
    "text": "this case I was looking at individual",
    "start": "829920",
    "end": "831600"
  },
  {
    "text": "problems you know I was trying to Target",
    "start": "831600",
    "end": "833120"
  },
  {
    "text": "specific specific issues at specific",
    "start": "833120",
    "end": "835360"
  },
  {
    "text": "times manually taking profiles but there",
    "start": "835360",
    "end": "838160"
  },
  {
    "text": "are a lot of solutions out there for",
    "start": "838160",
    "end": "840000"
  },
  {
    "text": "continuous profiling you know I tried to",
    "start": "840000",
    "end": "841639"
  },
  {
    "text": "focus this talk only on generic",
    "start": "841639",
    "end": "843759"
  },
  {
    "text": "Solutions not nothing vendor specific",
    "start": "843759",
    "end": "846160"
  },
  {
    "text": "but lots of vendors have lots of uh to",
    "start": "846160",
    "end": "849480"
  },
  {
    "text": "Great tools for you know even better",
    "start": "849480",
    "end": "851680"
  },
  {
    "text": "flame graph views uh continuous",
    "start": "851680",
    "end": "854120"
  },
  {
    "text": "profiling over time so if you want to",
    "start": "854120",
    "end": "856279"
  },
  {
    "text": "look at us at it use basically you can",
    "start": "856279",
    "end": "858519"
  },
  {
    "text": "use it a lot like tracing uh but get you",
    "start": "858519",
    "end": "861120"
  },
  {
    "text": "know more granular information about",
    "start": "861120",
    "end": "862560"
  },
  {
    "text": "your program instead of like about your",
    "start": "862560",
    "end": "864040"
  },
  {
    "text": "whole",
    "start": "864040",
    "end": "864839"
  },
  {
    "text": "system um and just I'm excited for otel",
    "start": "864839",
    "end": "868759"
  },
  {
    "text": "profile in basically that's the that's",
    "start": "868759",
    "end": "870519"
  },
  {
    "text": "the end of it I'm really excited for",
    "start": "870519",
    "end": "871759"
  },
  {
    "text": "this to sort of uh proliferate through",
    "start": "871759",
    "end": "874279"
  },
  {
    "text": "other tooling and so that we can use",
    "start": "874279",
    "end": "876079"
  },
  {
    "text": "this the profiling standard but be able",
    "start": "876079",
    "end": "879880"
  },
  {
    "text": "to Tool it the same way across different",
    "start": "879880",
    "end": "881480"
  },
  {
    "text": "languages I think that's very exciting",
    "start": "881480",
    "end": "883680"
  },
  {
    "text": "uh that's everything I got and uh I",
    "start": "883680",
    "end": "885800"
  },
  {
    "text": "don't know if there's time for questions",
    "start": "885800",
    "end": "887079"
  },
  {
    "text": "if we're on break but you can come find",
    "start": "887079",
    "end": "888440"
  },
  {
    "text": "me afterwards thanks",
    "start": "888440",
    "end": "890930"
  },
  {
    "text": "[Applause]",
    "start": "890930",
    "end": "893830"
  }
]