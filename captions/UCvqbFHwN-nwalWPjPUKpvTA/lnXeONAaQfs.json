[
  {
    "start": "0",
    "end": "80000"
  },
  {
    "text": "hello everyone",
    "start": "2320",
    "end": "3600"
  },
  {
    "text": "i'm an engineer from pincap the company",
    "start": "3600",
    "end": "5920"
  },
  {
    "text": "that made kv",
    "start": "5920",
    "end": "7680"
  },
  {
    "text": "and i'm here to share with you our",
    "start": "7680",
    "end": "9679"
  },
  {
    "text": "experience with",
    "start": "9679",
    "end": "10719"
  },
  {
    "text": "implementing distributed event streaming",
    "start": "10719",
    "end": "12639"
  },
  {
    "text": "from ipv",
    "start": "12639",
    "end": "14960"
  },
  {
    "text": "before we get to business here's some",
    "start": "14960",
    "end": "17119"
  },
  {
    "text": "background about myself",
    "start": "17119",
    "end": "18720"
  },
  {
    "text": "i'm jishin liu a software engineer at",
    "start": "18720",
    "end": "21279"
  },
  {
    "text": "pincap",
    "start": "21279",
    "end": "22000"
  },
  {
    "text": "and i'm part of the data migration team",
    "start": "22000",
    "end": "25039"
  },
  {
    "text": "i'm a contributor to tkv and one of the",
    "start": "25039",
    "end": "27359"
  },
  {
    "text": "maintainers of thai cdc",
    "start": "27359",
    "end": "29199"
  },
  {
    "text": "but in the field of computer science my",
    "start": "29199",
    "end": "30960"
  },
  {
    "text": "interests are databases",
    "start": "30960",
    "end": "32558"
  },
  {
    "text": "operating systems distributed systems",
    "start": "32559",
    "end": "34960"
  },
  {
    "text": "and for education",
    "start": "34960",
    "end": "36480"
  },
  {
    "text": "i'm an alumnus of the university of",
    "start": "36480",
    "end": "38719"
  },
  {
    "text": "chicago and that was part of the class",
    "start": "38719",
    "end": "41040"
  },
  {
    "text": "of 2018.",
    "start": "41040",
    "end": "44559"
  },
  {
    "text": "now let's go over today's agenda first",
    "start": "44559",
    "end": "47200"
  },
  {
    "text": "i'll give a brief introduction to techyv",
    "start": "47200",
    "end": "49760"
  },
  {
    "text": "and then i'll talk about the high level",
    "start": "49760",
    "end": "52160"
  },
  {
    "text": "design",
    "start": "52160",
    "end": "52879"
  },
  {
    "text": "of our distributed event streaming",
    "start": "52879",
    "end": "55920"
  },
  {
    "text": "project",
    "start": "55920",
    "end": "57520"
  },
  {
    "text": "then i'll talk mainly two aspects",
    "start": "57520",
    "end": "60800"
  },
  {
    "text": "of the detailed design and then",
    "start": "60800",
    "end": "64720"
  },
  {
    "text": "i'll also talk about",
    "start": "64720",
    "end": "68080"
  },
  {
    "text": "our use of edcp and the",
    "start": "68080",
    "end": "71439"
  },
  {
    "text": "higher bit high availability we",
    "start": "71439",
    "end": "73520"
  },
  {
    "text": "implemented with it",
    "start": "73520",
    "end": "76560"
  },
  {
    "start": "80000",
    "end": "188000"
  },
  {
    "text": "okay now let me talk a little bit about",
    "start": "81119",
    "end": "84640"
  },
  {
    "text": "that kv to give you some background for",
    "start": "84640",
    "end": "86560"
  },
  {
    "text": "the main topic of this talk",
    "start": "86560",
    "end": "88799"
  },
  {
    "text": "av is a distributed transactional",
    "start": "88799",
    "end": "92240"
  },
  {
    "text": "key value database and it is a graduated",
    "start": "92240",
    "end": "95759"
  },
  {
    "text": "project",
    "start": "95759",
    "end": "96560"
  },
  {
    "text": "of the cncf this diagram shows the",
    "start": "96560",
    "end": "100079"
  },
  {
    "text": "overall",
    "start": "100079",
    "end": "100640"
  },
  {
    "text": "architecture of thai kv so this is a",
    "start": "100640",
    "end": "104560"
  },
  {
    "text": "tech heavy cluster with four machines we",
    "start": "104560",
    "end": "107600"
  },
  {
    "text": "use",
    "start": "107600",
    "end": "107920"
  },
  {
    "text": "shared nothing architecture so that",
    "start": "107920",
    "end": "109600"
  },
  {
    "text": "techie can run on commodity hardware",
    "start": "109600",
    "end": "111920"
  },
  {
    "text": "with no special equipment needed",
    "start": "111920",
    "end": "114079"
  },
  {
    "text": "each machine can hold multiple regions",
    "start": "114079",
    "end": "117040"
  },
  {
    "text": "the number of regions on each machine",
    "start": "117040",
    "end": "118880"
  },
  {
    "text": "can be quite high",
    "start": "118880",
    "end": "119920"
  },
  {
    "text": "like more than ten thousand these",
    "start": "119920",
    "end": "122719"
  },
  {
    "text": "regions",
    "start": "122719",
    "end": "123280"
  },
  {
    "text": "are replicated by raft protocol and are",
    "start": "123280",
    "end": "126079"
  },
  {
    "text": "regulated",
    "start": "126079",
    "end": "127119"
  },
  {
    "text": "by placement driver which is a component",
    "start": "127119",
    "end": "130399"
  },
  {
    "text": "that runs out",
    "start": "130399",
    "end": "131599"
  },
  {
    "text": "outside of the tachyv processes and",
    "start": "131599",
    "end": "133840"
  },
  {
    "text": "communicates with",
    "start": "133840",
    "end": "135040"
  },
  {
    "text": "thai tv by grpc",
    "start": "135040",
    "end": "143360"
  },
  {
    "text": "here i summarize four points that are",
    "start": "143360",
    "end": "146160"
  },
  {
    "text": "helpful to understand before we proceed",
    "start": "146160",
    "end": "149040"
  },
  {
    "text": "first take av is a transactional key",
    "start": "149040",
    "end": "152080"
  },
  {
    "text": "value storage",
    "start": "152080",
    "end": "153440"
  },
  {
    "text": "where you can manipulate multiple keys",
    "start": "153440",
    "end": "155840"
  },
  {
    "text": "within the transaction",
    "start": "155840",
    "end": "158080"
  },
  {
    "text": "second the keys are sharded",
    "start": "158080",
    "end": "161120"
  },
  {
    "text": "into multiple regions well you can",
    "start": "161120",
    "end": "163760"
  },
  {
    "text": "regard the region",
    "start": "163760",
    "end": "164720"
  },
  {
    "text": "as a replicated key value store",
    "start": "164720",
    "end": "168720"
  },
  {
    "text": "third the regions are replicated by",
    "start": "168720",
    "end": "171440"
  },
  {
    "text": "using left protocol",
    "start": "171440",
    "end": "173360"
  },
  {
    "text": "which provides strong consistency among",
    "start": "173360",
    "end": "176080"
  },
  {
    "text": "the replicas",
    "start": "176080",
    "end": "177599"
  },
  {
    "text": "and the fourth point is that regions can",
    "start": "177599",
    "end": "180800"
  },
  {
    "text": "merge and split",
    "start": "180800",
    "end": "182400"
  },
  {
    "text": "while being regulated by the placement",
    "start": "182400",
    "end": "184400"
  },
  {
    "text": "driver",
    "start": "184400",
    "end": "186799"
  },
  {
    "text": "in order to demonstrate the rationale",
    "start": "190080",
    "end": "191920"
  },
  {
    "text": "behind the design choices we made when",
    "start": "191920",
    "end": "193840"
  },
  {
    "text": "implementing data streaming",
    "start": "193840",
    "end": "195360"
  },
  {
    "text": "it's important to go over the abstract",
    "start": "195360",
    "end": "198000"
  },
  {
    "text": "layers of",
    "start": "198000",
    "end": "198800"
  },
  {
    "text": "ipv first on the top of everything",
    "start": "198800",
    "end": "201840"
  },
  {
    "text": "is the transaction layer the transaction",
    "start": "201840",
    "end": "203840"
  },
  {
    "text": "layer is where our concurrency control",
    "start": "203840",
    "end": "206000"
  },
  {
    "text": "protocol is implemented",
    "start": "206000",
    "end": "207920"
  },
  {
    "text": "we use a percolator like protocol but",
    "start": "207920",
    "end": "210879"
  },
  {
    "text": "i'll not go into detail of that",
    "start": "210879",
    "end": "213599"
  },
  {
    "text": "our protocol requires a multi-version",
    "start": "213599",
    "end": "216319"
  },
  {
    "text": "key value",
    "start": "216319",
    "end": "217280"
  },
  {
    "text": "data store and that's our second layer",
    "start": "217280",
    "end": "220959"
  },
  {
    "text": "the third layer is called reptv which is",
    "start": "220959",
    "end": "223840"
  },
  {
    "text": "where",
    "start": "223840",
    "end": "224159"
  },
  {
    "text": "replication comes into play and we use",
    "start": "224159",
    "end": "226799"
  },
  {
    "text": "left to maintain consistent replicas of",
    "start": "226799",
    "end": "229200"
  },
  {
    "text": "regions",
    "start": "229200",
    "end": "230000"
  },
  {
    "text": "if you recall at the bottom is the",
    "start": "230000",
    "end": "233200"
  },
  {
    "text": "roxdb that we use to persist data onto",
    "start": "233200",
    "end": "236400"
  },
  {
    "text": "the disk",
    "start": "236400",
    "end": "237920"
  },
  {
    "text": "now with these layers in mind let me",
    "start": "237920",
    "end": "240480"
  },
  {
    "text": "introduce",
    "start": "240480",
    "end": "241280"
  },
  {
    "text": "you to the main goal that we want to",
    "start": "241280",
    "end": "243439"
  },
  {
    "text": "achieve here",
    "start": "243439",
    "end": "246080"
  },
  {
    "text": "so on a high level our goal is to create",
    "start": "248480",
    "end": "251680"
  },
  {
    "text": "connectivity from ikv",
    "start": "251680",
    "end": "253519"
  },
  {
    "text": "this is what the development of the data",
    "start": "253519",
    "end": "255840"
  },
  {
    "text": "processing ecosystem",
    "start": "255840",
    "end": "257120"
  },
  {
    "text": "is demanding and the real-time data",
    "start": "257120",
    "end": "259759"
  },
  {
    "text": "capture is meaningful",
    "start": "259759",
    "end": "261120"
  },
  {
    "text": "in that it creates connectivity to other",
    "start": "261120",
    "end": "264000"
  },
  {
    "text": "parts of the ecosystem",
    "start": "264000",
    "end": "265919"
  },
  {
    "text": "for example we can capture all data",
    "start": "265919",
    "end": "268320"
  },
  {
    "text": "changes",
    "start": "268320",
    "end": "269120"
  },
  {
    "text": "in taikivi to kafka and from there the",
    "start": "269120",
    "end": "272400"
  },
  {
    "text": "data can be",
    "start": "272400",
    "end": "273360"
  },
  {
    "text": "processed by flink etc",
    "start": "273360",
    "end": "276639"
  },
  {
    "text": "so this project is actually a step",
    "start": "276639",
    "end": "280560"
  },
  {
    "text": "towards using kv",
    "start": "280560",
    "end": "282000"
  },
  {
    "text": "as a hub for data exchange this is",
    "start": "282000",
    "end": "284080"
  },
  {
    "text": "something very",
    "start": "284080",
    "end": "285759"
  },
  {
    "text": "very significant and we also have other",
    "start": "285759",
    "end": "288400"
  },
  {
    "text": "projects that",
    "start": "288400",
    "end": "289680"
  },
  {
    "text": "include the beta imports from other",
    "start": "289680",
    "end": "294000"
  },
  {
    "text": "sources",
    "start": "294840",
    "end": "297840"
  },
  {
    "text": "the most basic goal is to be able to",
    "start": "299040",
    "end": "301840"
  },
  {
    "text": "capture new rights to kv",
    "start": "301840",
    "end": "304000"
  },
  {
    "text": "this is basically what we mean when we",
    "start": "304000",
    "end": "306240"
  },
  {
    "text": "talk about event streaming",
    "start": "306240",
    "end": "308000"
  },
  {
    "text": "but only the new data is not enough",
    "start": "308000",
    "end": "311039"
  },
  {
    "text": "because from time to time we'll need to",
    "start": "311039",
    "end": "313039"
  },
  {
    "text": "really historical data from",
    "start": "313039",
    "end": "314639"
  },
  {
    "text": "roxdb because as a user of",
    "start": "314639",
    "end": "317759"
  },
  {
    "text": "because as a user of a change data",
    "start": "317759",
    "end": "319680"
  },
  {
    "text": "capture tool you may want to",
    "start": "319680",
    "end": "321440"
  },
  {
    "text": "get a little bit back into the history",
    "start": "321440",
    "end": "324880"
  },
  {
    "text": "and retrieve",
    "start": "324880",
    "end": "325680"
  },
  {
    "text": "say a data stream that starts from five",
    "start": "325680",
    "end": "328880"
  },
  {
    "text": "minutes",
    "start": "328880",
    "end": "329440"
  },
  {
    "text": "before present the most important",
    "start": "329440",
    "end": "333280"
  },
  {
    "text": "and also the most challenging sub goal",
    "start": "333280",
    "end": "335759"
  },
  {
    "text": "is to preserve the ethnicity",
    "start": "335759",
    "end": "337759"
  },
  {
    "text": "and consistency of transactions the",
    "start": "337759",
    "end": "340240"
  },
  {
    "text": "consumer of the change log should be",
    "start": "340240",
    "end": "342000"
  },
  {
    "text": "able to retrieve the transactions in",
    "start": "342000",
    "end": "344000"
  },
  {
    "text": "exactly",
    "start": "344000",
    "end": "345039"
  },
  {
    "text": "the order in which they were applied to",
    "start": "345039",
    "end": "347919"
  },
  {
    "text": "the database",
    "start": "347919",
    "end": "349440"
  },
  {
    "text": "such an order must exist because we",
    "start": "349440",
    "end": "351440"
  },
  {
    "text": "support snapshot isolation",
    "start": "351440",
    "end": "353520"
  },
  {
    "text": "we'll talk more about transactions later",
    "start": "353520",
    "end": "357840"
  },
  {
    "text": "and when we got started we first needed",
    "start": "361199",
    "end": "364479"
  },
  {
    "text": "to decide",
    "start": "364479",
    "end": "365360"
  },
  {
    "text": "where we should capture the data we",
    "start": "365360",
    "end": "368240"
  },
  {
    "text": "wanted to choose an",
    "start": "368240",
    "end": "369520"
  },
  {
    "text": "appropriate abstraction level where we",
    "start": "369520",
    "end": "372880"
  },
  {
    "text": "intercept the data rights first",
    "start": "372880",
    "end": "376080"
  },
  {
    "text": "we skip the transaction layer",
    "start": "376080",
    "end": "378080"
  },
  {
    "text": "implementing data capture at the",
    "start": "378080",
    "end": "379600"
  },
  {
    "text": "transaction layer basically means that",
    "start": "379600",
    "end": "381440"
  },
  {
    "text": "we are",
    "start": "381440",
    "end": "382160"
  },
  {
    "text": "or we would have to record each api",
    "start": "382160",
    "end": "384880"
  },
  {
    "text": "calls",
    "start": "384880",
    "end": "386080"
  },
  {
    "text": "this means that we would need to do a",
    "start": "386080",
    "end": "388000"
  },
  {
    "text": "lot of extra bookkeeping to achieve the",
    "start": "388000",
    "end": "390240"
  },
  {
    "text": "level of consistency that we wanted",
    "start": "390240",
    "end": "393680"
  },
  {
    "text": "so we went down one level and look at",
    "start": "393680",
    "end": "397120"
  },
  {
    "text": "the",
    "start": "397120",
    "end": "397520"
  },
  {
    "text": "mvcc layer this is not a good level to",
    "start": "397520",
    "end": "401440"
  },
  {
    "text": "work with because",
    "start": "401440",
    "end": "402400"
  },
  {
    "text": "um well it's a distributed multi-version",
    "start": "402400",
    "end": "405919"
  },
  {
    "text": "giveaway store and there's no",
    "start": "405919",
    "end": "407840"
  },
  {
    "text": "centralized data structure",
    "start": "407840",
    "end": "409280"
  },
  {
    "text": "that we can monitor so we needed to",
    "start": "409280",
    "end": "412400"
  },
  {
    "text": "go further down and uh let's take a look",
    "start": "412400",
    "end": "415360"
  },
  {
    "text": "at",
    "start": "415360",
    "end": "415680"
  },
  {
    "text": "ref kb the red kv is a system",
    "start": "415680",
    "end": "419360"
  },
  {
    "text": "of replicated state machines meaning",
    "start": "419360",
    "end": "421599"
  },
  {
    "text": "that we can monitor the state",
    "start": "421599",
    "end": "423039"
  },
  {
    "text": "transaction",
    "start": "423039",
    "end": "423840"
  },
  {
    "text": "state transitions on each of these",
    "start": "423840",
    "end": "426800"
  },
  {
    "text": "machines",
    "start": "426800",
    "end": "428560"
  },
  {
    "text": "we also need it to make use of the roxtv",
    "start": "428560",
    "end": "432240"
  },
  {
    "text": "even though it's not good for listening",
    "start": "432240",
    "end": "435199"
  },
  {
    "text": "for changes",
    "start": "435199",
    "end": "436880"
  },
  {
    "text": "from time to time we need to read from",
    "start": "436880",
    "end": "439440"
  },
  {
    "text": "it and",
    "start": "439440",
    "end": "440000"
  },
  {
    "text": "get some data that's written in the past",
    "start": "440000",
    "end": "443280"
  },
  {
    "text": "well it is actually possible to capture",
    "start": "443280",
    "end": "446080"
  },
  {
    "text": "rock stevie's right ahead log but since",
    "start": "446080",
    "end": "448240"
  },
  {
    "text": "regions are moving constantly",
    "start": "448240",
    "end": "450400"
  },
  {
    "text": "here and there across the nodes and the",
    "start": "450400",
    "end": "452160"
  },
  {
    "text": "taikevi can go down and up at any time",
    "start": "452160",
    "end": "454800"
  },
  {
    "text": "it's hard to",
    "start": "454800",
    "end": "456160"
  },
  {
    "text": "circumvent the concept of the legion and",
    "start": "456160",
    "end": "458720"
  },
  {
    "text": "the capture rocks tv changes directly",
    "start": "458720",
    "end": "465840"
  },
  {
    "start": "465000",
    "end": "808000"
  },
  {
    "text": "now since there's a one-to-one",
    "start": "467520",
    "end": "469280"
  },
  {
    "text": "correspondence between the",
    "start": "469280",
    "end": "471120"
  },
  {
    "text": "ref-tv state machine and the kv region",
    "start": "471120",
    "end": "473840"
  },
  {
    "text": "we decided on an",
    "start": "473840",
    "end": "474960"
  },
  {
    "text": "architecture where we captured data on",
    "start": "474960",
    "end": "477199"
  },
  {
    "text": "each region and then we do something to",
    "start": "477199",
    "end": "479199"
  },
  {
    "text": "combine the data streams from all",
    "start": "479199",
    "end": "481120"
  },
  {
    "text": "regions",
    "start": "481120",
    "end": "482960"
  },
  {
    "text": "i'm gonna walk you through the thought",
    "start": "482960",
    "end": "484639"
  },
  {
    "text": "process for which we arrived at the",
    "start": "484639",
    "end": "486560"
  },
  {
    "text": "current design of the algorithm that we",
    "start": "486560",
    "end": "488319"
  },
  {
    "text": "used to combine the",
    "start": "488319",
    "end": "490840"
  },
  {
    "text": "data",
    "start": "490840",
    "end": "493840"
  },
  {
    "text": "the high level design is this first",
    "start": "502000",
    "end": "505599"
  },
  {
    "text": "we will receive data from all regions",
    "start": "505599",
    "end": "508560"
  },
  {
    "text": "you can think of this as an",
    "start": "508560",
    "end": "510319"
  },
  {
    "text": "as receiving from multiple streams",
    "start": "510319",
    "end": "512000"
  },
  {
    "text": "simultaneously and then",
    "start": "512000",
    "end": "513839"
  },
  {
    "text": "we decide that and when we decide",
    "start": "513839",
    "end": "517919"
  },
  {
    "text": "that all regions are done with sending",
    "start": "517919",
    "end": "521279"
  },
  {
    "text": "transactions whose",
    "start": "521279",
    "end": "522320"
  },
  {
    "text": "commit yes is less than or equal to some",
    "start": "522320",
    "end": "525200"
  },
  {
    "text": "value",
    "start": "525200",
    "end": "525920"
  },
  {
    "text": "we produce a watermark",
    "start": "525920",
    "end": "529920"
  },
  {
    "text": "this would be a watermark in the",
    "start": "530880",
    "end": "533279"
  },
  {
    "text": "conventional sense for the",
    "start": "533279",
    "end": "534720"
  },
  {
    "text": "forced streaming system then we store",
    "start": "534720",
    "end": "538000"
  },
  {
    "text": "the",
    "start": "538000",
    "end": "538399"
  },
  {
    "text": "data and restore the transactions that",
    "start": "538399",
    "end": "540880"
  },
  {
    "text": "are",
    "start": "540880",
    "end": "541600"
  },
  {
    "text": "earlier than that latest watermark",
    "start": "541600",
    "end": "546640"
  },
  {
    "text": "with this high level idea in mind let's",
    "start": "546640",
    "end": "548880"
  },
  {
    "text": "continue",
    "start": "548880",
    "end": "551360"
  },
  {
    "text": "this is an overview of the types of",
    "start": "552240",
    "end": "554640"
  },
  {
    "text": "events that we receive from each region",
    "start": "554640",
    "end": "557040"
  },
  {
    "text": "we have pre-write which has the stack",
    "start": "557040",
    "end": "560720"
  },
  {
    "text": "yes of the",
    "start": "560720",
    "end": "561600"
  },
  {
    "text": "transaction the key and the value and we",
    "start": "561600",
    "end": "563920"
  },
  {
    "text": "have commit",
    "start": "563920",
    "end": "564640"
  },
  {
    "text": "which is paired with prewrite and it",
    "start": "564640",
    "end": "566800"
  },
  {
    "text": "contains both start yes the committee s",
    "start": "566800",
    "end": "569760"
  },
  {
    "text": "and the key",
    "start": "569760",
    "end": "571200"
  },
  {
    "text": "and we have lock which contains the cs",
    "start": "571200",
    "end": "574160"
  },
  {
    "text": "and the key",
    "start": "574160",
    "end": "574800"
  },
  {
    "text": "and we have unlock",
    "start": "574800",
    "end": "578160"
  },
  {
    "text": "now we know the four types of events",
    "start": "579760",
    "end": "582240"
  },
  {
    "text": "let's take a look at the first attempt",
    "start": "582240",
    "end": "584160"
  },
  {
    "text": "of",
    "start": "584160",
    "end": "585040"
  },
  {
    "text": "making an algorithm to produce the final",
    "start": "585040",
    "end": "587600"
  },
  {
    "text": "data stream here i use the",
    "start": "587600",
    "end": "591200"
  },
  {
    "text": "pseudocode with a syntax that's similar",
    "start": "591200",
    "end": "593120"
  },
  {
    "text": "to that of rus since ikv is written in",
    "start": "593120",
    "end": "595440"
  },
  {
    "text": "rest",
    "start": "595440",
    "end": "596800"
  },
  {
    "text": "we assume a data type that's called",
    "start": "596800",
    "end": "600399"
  },
  {
    "text": "a tx an event that represents the items",
    "start": "600399",
    "end": "603040"
  },
  {
    "text": "of the stream that has watermarks in it",
    "start": "603040",
    "end": "606079"
  },
  {
    "text": "we have a special name for this",
    "start": "606079",
    "end": "608000"
  },
  {
    "text": "watermark and we",
    "start": "608000",
    "end": "609440"
  },
  {
    "text": "call it the result yes but",
    "start": "609440",
    "end": "613680"
  },
  {
    "text": "quickly we ran into a problem what",
    "start": "613680",
    "end": "616640"
  },
  {
    "text": "should",
    "start": "616640",
    "end": "617040"
  },
  {
    "text": "the result us be we didn't really have",
    "start": "617040",
    "end": "620079"
  },
  {
    "text": "enough information here",
    "start": "620079",
    "end": "621519"
  },
  {
    "text": "the locks are being tracked and it's",
    "start": "621519",
    "end": "623680"
  },
  {
    "text": "it's easy to know the start yeses of the",
    "start": "623680",
    "end": "626079"
  },
  {
    "text": "transactions that have been",
    "start": "626079",
    "end": "627839"
  },
  {
    "text": "that have placed at least one lock",
    "start": "627839",
    "end": "631120"
  },
  {
    "text": "but the problem here is that we don't",
    "start": "631120",
    "end": "633200"
  },
  {
    "text": "know if there is a transaction",
    "start": "633200",
    "end": "636079"
  },
  {
    "text": "that hasn't earlier started yes that is",
    "start": "636079",
    "end": "638880"
  },
  {
    "text": "so being processed",
    "start": "638880",
    "end": "641040"
  },
  {
    "text": "yet to write a lock",
    "start": "641040",
    "end": "646720"
  },
  {
    "text": "carrie summarize the problem the events",
    "start": "646720",
    "end": "649680"
  },
  {
    "text": "themselves say nothing about whether a",
    "start": "649680",
    "end": "651519"
  },
  {
    "text": "region has a pending transaction whose",
    "start": "651519",
    "end": "653519"
  },
  {
    "text": "committee as is",
    "start": "653519",
    "end": "654800"
  },
  {
    "text": "smaller than the minimum of all current",
    "start": "654800",
    "end": "657440"
  },
  {
    "text": "log start yes",
    "start": "657440",
    "end": "659839"
  },
  {
    "text": "possible for such transactions to commit",
    "start": "659839",
    "end": "662160"
  },
  {
    "text": "if there's no conflict",
    "start": "662160",
    "end": "665279"
  },
  {
    "text": "to resolve this problem we'll need the",
    "start": "665279",
    "end": "667600"
  },
  {
    "text": "placement drivers assistance",
    "start": "667600",
    "end": "670959"
  },
  {
    "text": "now let's take a second try we no longer",
    "start": "672399",
    "end": "674880"
  },
  {
    "text": "try to generate a watermark from the",
    "start": "674880",
    "end": "676800"
  },
  {
    "text": "same thread as the one that processes",
    "start": "676800",
    "end": "678480"
  },
  {
    "text": "the region's data",
    "start": "678480",
    "end": "679839"
  },
  {
    "text": "notice that we still need to check the",
    "start": "679839",
    "end": "681839"
  },
  {
    "text": "logs because the stock pieces of the",
    "start": "681839",
    "end": "683760"
  },
  {
    "text": "locks provide a lower bound of the",
    "start": "683760",
    "end": "686000"
  },
  {
    "text": "committee assets of the running",
    "start": "686000",
    "end": "687680"
  },
  {
    "text": "transactions",
    "start": "687680",
    "end": "690399"
  },
  {
    "text": "in addition to the function show",
    "start": "692560",
    "end": "696079"
  },
  {
    "text": "shown in the previous slide we are we",
    "start": "696079",
    "end": "699120"
  },
  {
    "text": "need to",
    "start": "699120",
    "end": "699839"
  },
  {
    "text": "launch another thread and the reason is",
    "start": "699839",
    "end": "702640"
  },
  {
    "text": "that we",
    "start": "702640",
    "end": "704240"
  },
  {
    "text": "we need a barrier here we need at least",
    "start": "704240",
    "end": "707760"
  },
  {
    "text": "two concurrent threads",
    "start": "707760",
    "end": "709600"
  },
  {
    "text": "because a barrier is needed to wait for",
    "start": "709600",
    "end": "712880"
  },
  {
    "text": "all pending rights to be observed",
    "start": "712880",
    "end": "715360"
  },
  {
    "text": "in this piece of code we first read the",
    "start": "715360",
    "end": "717760"
  },
  {
    "text": "latest",
    "start": "717760",
    "end": "718800"
  },
  {
    "text": "logical commit logical timestamp from td",
    "start": "718800",
    "end": "721920"
  },
  {
    "text": "and then we enforce what we could call a",
    "start": "721920",
    "end": "724560"
  },
  {
    "text": "barrier here",
    "start": "724560",
    "end": "725440"
  },
  {
    "text": "so that when we read the logs here",
    "start": "725440",
    "end": "728880"
  },
  {
    "text": "all previous writes would have already",
    "start": "728880",
    "end": "731120"
  },
  {
    "text": "been processed",
    "start": "731120",
    "end": "732720"
  },
  {
    "text": "this way we can generate a watermark for",
    "start": "732720",
    "end": "734639"
  },
  {
    "text": "a single region",
    "start": "734639",
    "end": "737120"
  },
  {
    "text": "next i'll show how to further process",
    "start": "737120",
    "end": "739120"
  },
  {
    "text": "the data",
    "start": "739120",
    "end": "744880"
  },
  {
    "text": "but before getting into detail i'll",
    "start": "744880",
    "end": "747120"
  },
  {
    "text": "introduce you to another distributed",
    "start": "747120",
    "end": "749360"
  },
  {
    "text": "component separate from thai kv",
    "start": "749360",
    "end": "752480"
  },
  {
    "text": "thai cdc cdc is designed with three",
    "start": "752480",
    "end": "756480"
  },
  {
    "text": "goals",
    "start": "756480",
    "end": "756959"
  },
  {
    "text": "in mind first from the management point",
    "start": "756959",
    "end": "760000"
  },
  {
    "text": "of view",
    "start": "760000",
    "end": "760720"
  },
  {
    "text": "we want we wanted the data streaming",
    "start": "760720",
    "end": "763120"
  },
  {
    "text": "component to iterate separately from",
    "start": "763120",
    "end": "765200"
  },
  {
    "text": "thai kv",
    "start": "765200",
    "end": "766800"
  },
  {
    "text": "and the second goal is that we aim to",
    "start": "766800",
    "end": "770000"
  },
  {
    "text": "design a fully distributed component",
    "start": "770000",
    "end": "772399"
  },
  {
    "text": "to eliminate every single point of",
    "start": "772399",
    "end": "775600"
  },
  {
    "text": "failure in the stream processing",
    "start": "775600",
    "end": "778720"
  },
  {
    "text": "process and the",
    "start": "778720",
    "end": "782639"
  },
  {
    "text": "third we wanted a component that is",
    "start": "782639",
    "end": "785360"
  },
  {
    "text": "separate from thai kv",
    "start": "785360",
    "end": "787680"
  },
  {
    "text": "because we'd like to we'd like it to",
    "start": "787680",
    "end": "790000"
  },
  {
    "text": "work with thai db",
    "start": "790000",
    "end": "791839"
  },
  {
    "text": "which is a relational database project",
    "start": "791839",
    "end": "795519"
  },
  {
    "text": "that we built upon techyv but",
    "start": "795519",
    "end": "799200"
  },
  {
    "text": "teddy b is managed independent",
    "start": "799200",
    "end": "801440"
  },
  {
    "text": "independently from thai kv so we wanted",
    "start": "801440",
    "end": "803519"
  },
  {
    "text": "high cdc",
    "start": "803519",
    "end": "804320"
  },
  {
    "text": "to be independent too",
    "start": "804320",
    "end": "807680"
  },
  {
    "start": "808000",
    "end": "1158000"
  },
  {
    "text": "this is the what the architecture looks",
    "start": "809440",
    "end": "811600"
  },
  {
    "text": "like with thai cdc",
    "start": "811600",
    "end": "813040"
  },
  {
    "text": "this diagram did not show the takeaway",
    "start": "813040",
    "end": "815279"
  },
  {
    "text": "nodes because",
    "start": "815279",
    "end": "816160"
  },
  {
    "text": "those are no longer important here icdc",
    "start": "816160",
    "end": "818800"
  },
  {
    "text": "communicates directly with the regions",
    "start": "818800",
    "end": "820720"
  },
  {
    "text": "that",
    "start": "820720",
    "end": "821760"
  },
  {
    "text": "that can be migrated from nodes node to",
    "start": "821760",
    "end": "824320"
  },
  {
    "text": "node",
    "start": "824320",
    "end": "825360"
  },
  {
    "text": "so you don't need to think about",
    "start": "825360",
    "end": "826959"
  },
  {
    "text": "actually nodes when we design the high",
    "start": "826959",
    "end": "829120"
  },
  {
    "text": "level logic of",
    "start": "829120",
    "end": "830480"
  },
  {
    "text": "type cdc",
    "start": "830480",
    "end": "833279"
  },
  {
    "text": "there are two concepts that we need to",
    "start": "834079",
    "end": "836800"
  },
  {
    "text": "clarify a little bit",
    "start": "836800",
    "end": "838639"
  },
  {
    "text": "spans and regions spans are just the",
    "start": "838639",
    "end": "841680"
  },
  {
    "text": "intervals in the key space",
    "start": "841680",
    "end": "843440"
  },
  {
    "text": "the keys in ikv are totally ordered so",
    "start": "843440",
    "end": "846240"
  },
  {
    "text": "it's possible to define",
    "start": "846240",
    "end": "847600"
  },
  {
    "text": "ring json and the placement driver can",
    "start": "847600",
    "end": "850880"
  },
  {
    "text": "be queried",
    "start": "850880",
    "end": "852240"
  },
  {
    "text": "to find out which regions correspond to",
    "start": "852240",
    "end": "855360"
  },
  {
    "text": "what span",
    "start": "855360",
    "end": "857680"
  },
  {
    "text": "cdc then schedules grpc connections to",
    "start": "857680",
    "end": "861920"
  },
  {
    "text": "take divisions",
    "start": "861920",
    "end": "862880"
  },
  {
    "text": "with the knowledge of this spanned",
    "start": "862880",
    "end": "864800"
  },
  {
    "text": "region mapping",
    "start": "864800",
    "end": "867040"
  },
  {
    "text": "when regions merge or split like cdc",
    "start": "867040",
    "end": "870399"
  },
  {
    "text": "will reschedule",
    "start": "870399",
    "end": "871360"
  },
  {
    "text": "the effective span based on the new span",
    "start": "871360",
    "end": "874079"
  },
  {
    "text": "to region mapping",
    "start": "874079",
    "end": "875600"
  },
  {
    "text": "and",
    "start": "875600",
    "end": "877759"
  },
  {
    "text": "another way why spans are important is",
    "start": "880000",
    "end": "882800"
  },
  {
    "text": "that they are used as",
    "start": "882800",
    "end": "884399"
  },
  {
    "text": "keys into a segment tree which is",
    "start": "884399",
    "end": "887600"
  },
  {
    "text": "used to track the watermarks of the",
    "start": "887600",
    "end": "889839"
  },
  {
    "text": "regions",
    "start": "889839",
    "end": "892320"
  },
  {
    "text": "here is an example it",
    "start": "896320",
    "end": "899760"
  },
  {
    "text": "shows the uh house type cdc connects",
    "start": "899760",
    "end": "902880"
  },
  {
    "text": "to the regions and they receive the push",
    "start": "902880",
    "end": "905199"
  },
  {
    "text": "stream from each of them",
    "start": "905199",
    "end": "907120"
  },
  {
    "text": "and uh highlighted are the result yes's",
    "start": "907120",
    "end": "911279"
  },
  {
    "text": "that are being produced from each of the",
    "start": "911279",
    "end": "914480"
  },
  {
    "text": "regions",
    "start": "914480",
    "end": "915680"
  },
  {
    "text": "this example is a little bit complicated",
    "start": "915680",
    "end": "917920"
  },
  {
    "text": "so you guys can",
    "start": "917920",
    "end": "919680"
  },
  {
    "text": "take a close look at it when you",
    "start": "919680",
    "end": "922399"
  },
  {
    "text": "download the slides",
    "start": "922399",
    "end": "926480"
  },
  {
    "text": "and there are a few more points that we",
    "start": "926480",
    "end": "928880"
  },
  {
    "text": "need to mention",
    "start": "928880",
    "end": "930079"
  },
  {
    "text": "uh for you to get the complete picture",
    "start": "930079",
    "end": "934320"
  },
  {
    "text": "first now",
    "start": "934320",
    "end": "937519"
  },
  {
    "text": "now that we have a stream events",
    "start": "937519",
    "end": "939519"
  },
  {
    "text": "separated by watermarks",
    "start": "939519",
    "end": "941519"
  },
  {
    "text": "it's very easy to sort the stream and",
    "start": "941519",
    "end": "943759"
  },
  {
    "text": "combine the events to",
    "start": "943759",
    "end": "945440"
  },
  {
    "text": "produce a stream of transactions second",
    "start": "945440",
    "end": "949279"
  },
  {
    "text": "we implemented high availability using",
    "start": "949279",
    "end": "951360"
  },
  {
    "text": "ebcd to distribute it",
    "start": "951360",
    "end": "953120"
  },
  {
    "text": "by cvc",
    "start": "953120",
    "end": "954420"
  },
  {
    "text": "[Music]",
    "start": "954420",
    "end": "957360"
  },
  {
    "text": "third to make pisces a useful",
    "start": "957360",
    "end": "961600"
  },
  {
    "text": "product we made it support decoding",
    "start": "961600",
    "end": "964880"
  },
  {
    "text": "thaidb records",
    "start": "964880",
    "end": "967440"
  },
  {
    "text": "so it can be used to capture changes",
    "start": "967440",
    "end": "969759"
  },
  {
    "text": "from type db",
    "start": "969759",
    "end": "970959"
  },
  {
    "text": "what we have implemented is similar to",
    "start": "970959",
    "end": "973199"
  },
  {
    "text": "mysql bin log but",
    "start": "973199",
    "end": "974800"
  },
  {
    "text": "icdc is capable of writing the events",
    "start": "974800",
    "end": "977519"
  },
  {
    "text": "directly to various kinds of downstream",
    "start": "977519",
    "end": "979759"
  },
  {
    "text": "such as mqs",
    "start": "979759",
    "end": "981040"
  },
  {
    "text": "f3 files and mysql compatible relational",
    "start": "981040",
    "end": "984720"
  },
  {
    "text": "databases",
    "start": "984720",
    "end": "985600"
  },
  {
    "text": "such as mysql itself and idb",
    "start": "985600",
    "end": "989920"
  },
  {
    "text": "one important point in our",
    "start": "992639",
    "end": "993920"
  },
  {
    "text": "implementation is that we make its",
    "start": "993920",
    "end": "996079"
  },
  {
    "text": "extensive use of type of we make",
    "start": "996079",
    "end": "999120"
  },
  {
    "text": "extensive use of utcd we make use of it",
    "start": "999120",
    "end": "1002240"
  },
  {
    "text": "mainly in two ways",
    "start": "1002240",
    "end": "1003759"
  },
  {
    "text": "first we use it as a persistent state",
    "start": "1003759",
    "end": "1007120"
  },
  {
    "text": "storage for",
    "start": "1007120",
    "end": "1008079"
  },
  {
    "text": "fault tolerance and recovery this makes",
    "start": "1008079",
    "end": "1011120"
  },
  {
    "text": "thai cdc a stateless service and makes",
    "start": "1011120",
    "end": "1013839"
  },
  {
    "text": "it very easy",
    "start": "1013839",
    "end": "1014800"
  },
  {
    "text": "to deploy and maintain it second",
    "start": "1014800",
    "end": "1018639"
  },
  {
    "text": "we use etcd as a consensus service",
    "start": "1018639",
    "end": "1022000"
  },
  {
    "text": "to maintain the current state of the cdc",
    "start": "1022000",
    "end": "1025360"
  },
  {
    "text": "cluster",
    "start": "1025360",
    "end": "1026558"
  },
  {
    "text": "that all nodes can agree on this is",
    "start": "1026559",
    "end": "1029678"
  },
  {
    "text": "crucial",
    "start": "1029679",
    "end": "1031199"
  },
  {
    "text": "because if you want to implement it",
    "start": "1031199",
    "end": "1034400"
  },
  {
    "text": "if implement high availability you need",
    "start": "1034400",
    "end": "1036640"
  },
  {
    "text": "to know which nodes are",
    "start": "1036640",
    "end": "1038000"
  },
  {
    "text": "alive and what they are doing",
    "start": "1038000",
    "end": "1041600"
  },
  {
    "text": "now i'll show you an example of how",
    "start": "1045760",
    "end": "1048799"
  },
  {
    "text": "high availability works",
    "start": "1048799",
    "end": "1053039"
  },
  {
    "text": "first we add a node we add another node",
    "start": "1053039",
    "end": "1058080"
  },
  {
    "text": "the first node is now elected the owner",
    "start": "1058080",
    "end": "1060559"
  },
  {
    "text": "of the cluster",
    "start": "1060559",
    "end": "1061520"
  },
  {
    "text": "the owner is the node that's in charge",
    "start": "1061520",
    "end": "1063679"
  },
  {
    "text": "of actively",
    "start": "1063679",
    "end": "1064640"
  },
  {
    "text": "manipulating the state of edcd to",
    "start": "1064640",
    "end": "1066880"
  },
  {
    "text": "coordinate the nodes",
    "start": "1066880",
    "end": "1070160"
  },
  {
    "text": "and the owner decides what tasks need to",
    "start": "1070720",
    "end": "1073200"
  },
  {
    "text": "be run",
    "start": "1073200",
    "end": "1073840"
  },
  {
    "text": "and assign the tables that are to be",
    "start": "1073840",
    "end": "1076799"
  },
  {
    "text": "replicated to each node",
    "start": "1076799",
    "end": "1078480"
  },
  {
    "text": "that is available",
    "start": "1078480",
    "end": "1081840"
  },
  {
    "text": "we can add new nodes at any time",
    "start": "1082000",
    "end": "1086240"
  },
  {
    "text": "when the owner discovers a new node",
    "start": "1088640",
    "end": "1092080"
  },
  {
    "text": "it will initiate table migration if",
    "start": "1092080",
    "end": "1095039"
  },
  {
    "text": "there is significant imbalance",
    "start": "1095039",
    "end": "1097679"
  },
  {
    "text": "in the workload",
    "start": "1097679",
    "end": "1100480"
  },
  {
    "text": "now the table migration is completed",
    "start": "1101120",
    "end": "1105200"
  },
  {
    "text": "in the event of note faders the owner",
    "start": "1105200",
    "end": "1107200"
  },
  {
    "text": "will reassign the tables previously",
    "start": "1107200",
    "end": "1109600"
  },
  {
    "text": "being replicated by the dead node",
    "start": "1109600",
    "end": "1113280"
  },
  {
    "text": "now as you can see a surviving node",
    "start": "1114880",
    "end": "1116960"
  },
  {
    "text": "takes the table",
    "start": "1116960",
    "end": "1119760"
  },
  {
    "text": "and the owner itself can go down too",
    "start": "1120160",
    "end": "1123760"
  },
  {
    "text": "in this case a new owner will be elected",
    "start": "1123760",
    "end": "1127679"
  },
  {
    "text": "and the new owner will compare the",
    "start": "1127679",
    "end": "1129600"
  },
  {
    "text": "current state of the cluster",
    "start": "1129600",
    "end": "1131840"
  },
  {
    "text": "with the desired state and it will",
    "start": "1131840",
    "end": "1134559"
  },
  {
    "text": "assign the tables that are",
    "start": "1134559",
    "end": "1136080"
  },
  {
    "text": "not being replicated to a surviving node",
    "start": "1136080",
    "end": "1138799"
  },
  {
    "text": "including itself",
    "start": "1138799",
    "end": "1141679"
  },
  {
    "text": "that is all i plan to share today if you",
    "start": "1145120",
    "end": "1148160"
  },
  {
    "text": "have any questions",
    "start": "1148160",
    "end": "1149120"
  },
  {
    "text": "or want to join us please visit our",
    "start": "1149120",
    "end": "1151440"
  },
  {
    "text": "website or",
    "start": "1151440",
    "end": "1152720"
  },
  {
    "text": "contact us in the slack channel here are",
    "start": "1152720",
    "end": "1155840"
  },
  {
    "text": "some useful links",
    "start": "1155840",
    "end": "1160159"
  }
]