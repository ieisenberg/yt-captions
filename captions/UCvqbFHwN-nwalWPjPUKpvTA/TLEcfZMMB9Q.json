[
  {
    "start": "0",
    "end": "58000"
  },
  {
    "text": "hi welcome to my kubecon talk my name is dan garfield i'm going to be talking about the quest for the ultimate kubernetes home lab and",
    "start": "719",
    "end": "8240"
  },
  {
    "text": "ultimate slight caveat we're going to try to do it as cheap as possible so we'll see how that goes uh we'll we're going to talk about the",
    "start": "8240",
    "end": "14639"
  },
  {
    "text": "goal of what we're what i'm trying to what i was trying to build we'll go through the build and of course we'll talk about what's next what i'd",
    "start": "14639",
    "end": "20240"
  },
  {
    "text": "like to do next and hopefully at the end we'll have some time for some questions so my name is dan garfield i'm the chief",
    "start": "20240",
    "end": "27359"
  },
  {
    "text": "technology evangelist for code fresh but this is more of a hobby talk talking about something i built in my house",
    "start": "27359",
    "end": "33280"
  },
  {
    "text": "you can follow me on twitter at today was awesome just remember how you felt about the day and if it was awesome then today was",
    "start": "33280",
    "end": "39840"
  },
  {
    "text": "awesome easy i am a member of the forbes technology council as well as a google developer expert",
    "start": "39840",
    "end": "45440"
  },
  {
    "text": "and so i like to talk about kubernetes i talk about devops i like to talk about cloud",
    "start": "45440",
    "end": "50480"
  },
  {
    "text": "and today i'm going to be talking about home lab which is actually kubernetes bare metal at your house",
    "start": "50480",
    "end": "58320"
  },
  {
    "start": "58000",
    "end": "86000"
  },
  {
    "text": "i love doing these at home projects i love raspberry pies love home labs i built a raspberry pi chicken",
    "start": "58480",
    "end": "65040"
  },
  {
    "text": "coop powered chicken coop a few years ago which of course had a linear actuator that opened and closed automatically",
    "start": "65040",
    "end": "71600"
  },
  {
    "text": "based on the time of the day which was a lot of fun a coated game box you know all the standard stuff that you see people do with pies",
    "start": "71600",
    "end": "76880"
  },
  {
    "text": "so i love doing that kind of stuff i love having something at my house that actually provides a lot of value",
    "start": "76880",
    "end": "82479"
  },
  {
    "text": "love flexing those tech muscles at home and that's what i try to do here so my",
    "start": "82479",
    "end": "87759"
  },
  {
    "start": "86000",
    "end": "135000"
  },
  {
    "text": "first goal with my kubernetes home lab is i basically want to run the services for my house and that means that i need",
    "start": "87759",
    "end": "93119"
  },
  {
    "text": "to be able to run x86 now when i say run real workloads this isn't meant as a dig at all to arm i love arm great",
    "start": "93119",
    "end": "100560"
  },
  {
    "text": "architecture of course it's on my phone of course i've got a lot of these raspberry pi powered stuff but the truth is that a",
    "start": "100560",
    "end": "106159"
  },
  {
    "text": "lot of the workloads that i work with every day and most cloud workloads happen to run on x86 that may change",
    "start": "106159",
    "end": "112320"
  },
  {
    "text": "you know apple's coming out with that uh their arm-based chips for their laptops and that might force a",
    "start": "112320",
    "end": "118000"
  },
  {
    "text": "a change in how people are developing software but in the meantime i need to be able to run some x86 stuff which is going to be",
    "start": "118000",
    "end": "125119"
  },
  {
    "text": "a pretty big limiting factor on what i can choose to build my cluster out of",
    "start": "125119",
    "end": "130319"
  },
  {
    "text": "my second goal was to oh my second goal is that i need to",
    "start": "130319",
    "end": "136560"
  },
  {
    "start": "135000",
    "end": "171000"
  },
  {
    "text": "reduce toil and the truth is that i'm the only person that can work on this so i can't have something that's really",
    "start": "136560",
    "end": "143760"
  },
  {
    "text": "complex and difficult to manage i can't have something that's breaking all the time because i frankly don't have time i've got three kids i don't have time to go",
    "start": "143760",
    "end": "149840"
  },
  {
    "text": "be chasing around broken down servers and i've run you know nice servers in the past at home and i end up",
    "start": "149840",
    "end": "156160"
  },
  {
    "text": "re compiling kernels and fixing storage pools and it's just not something i want to spend",
    "start": "156160",
    "end": "162400"
  },
  {
    "text": "my time on i need to have something that is fairly automated i can invest a lot of upfront time to get rid of",
    "start": "162400",
    "end": "168319"
  },
  {
    "text": "any long-term toil so we're going to be using those principles as well i also wanted to have something that was",
    "start": "168319",
    "end": "174319"
  },
  {
    "text": "multi-node now why do i want multi-node well one of the things that i noticed about working with docker desktop or even a",
    "start": "174319",
    "end": "180560"
  },
  {
    "text": "kind cluster is i don't really get the sense of how workloads perform over time",
    "start": "180560",
    "end": "186159"
  },
  {
    "text": "nor how they react when a node failure happens or they migrate or i'm trying to scale it up",
    "start": "186159",
    "end": "191840"
  },
  {
    "text": "you just can't really simulate those things very well and so having a cluster",
    "start": "191840",
    "end": "197040"
  },
  {
    "text": "with a couple of nodes gives me the chance to see how different pods perform when they when",
    "start": "197040",
    "end": "202159"
  },
  {
    "text": "they move when they maybe migrate if they get if they get evicted or that kind of thing and it really just",
    "start": "202159",
    "end": "207360"
  },
  {
    "text": "changes the way you think about kubernetes a little bit when you're using it on your home cluster now when you're",
    "start": "207360",
    "end": "212879"
  },
  {
    "text": "sitting in production you can invest a lot of time to make sure that everything runs perfectly and smoothly but uh you know this is a hobby project",
    "start": "212879",
    "end": "220080"
  },
  {
    "text": "so i do want to have multi-node i do want to have scale and i also want to have something that's modular so if i'm running a lot of services and",
    "start": "220080",
    "end": "226480"
  },
  {
    "text": "i can't you know i don't have enough room for something else i don't want to replace my entire stack i want to be able to like",
    "start": "226480",
    "end": "231840"
  },
  {
    "text": "maybe just grab a cheap node and throw it into the pool and call it a day i think that would be really cool",
    "start": "231840",
    "end": "237920"
  },
  {
    "start": "237000",
    "end": "263000"
  },
  {
    "text": "number four i wanted to be able to support stateful services and you know if i want to this is a home",
    "start": "237920",
    "end": "244400"
  },
  {
    "text": "lab right so i'm going to be running plex i'd be running maybe home assistant or minecraft server or something like that",
    "start": "244400",
    "end": "249840"
  },
  {
    "text": "all of those services require stateful they're all stateful applications they all require me to maintain",
    "start": "249840",
    "end": "256560"
  },
  {
    "text": "persistent volumes and so that's going to be super important for me for us to solve",
    "start": "256560",
    "end": "261919"
  },
  {
    "text": "in this build or for me to solve and finally i want to be able to support hardware transcoding",
    "start": "261919",
    "end": "266960"
  },
  {
    "text": "that means i want gpu access for all my nodes and if i if i throw a pod up that's going to be",
    "start": "266960",
    "end": "272160"
  },
  {
    "text": "transcoding a video file or something like that i want to be able to take advantage of the gpu to do that so",
    "start": "272160",
    "end": "278240"
  },
  {
    "text": "that i can actually you know have it perform quickly and of course this is important too since i'm",
    "start": "278240",
    "end": "283680"
  },
  {
    "text": "doing it on the cheap that means that i have to be really careful with uh with my choices here",
    "start": "283680",
    "end": "288960"
  },
  {
    "text": "and that of course is the final requirement is that this whole thing needs to be cheap i can't break the bank on this anybody",
    "start": "288960",
    "end": "295120"
  },
  {
    "text": "could go and spend ten thousand dollars buy a bunch of high performance nodes throw them in a rack and expect it to",
    "start": "295120",
    "end": "300479"
  },
  {
    "text": "run pretty well um not an option for me and uh it's also a hobby project so i want to be able to uh",
    "start": "300479",
    "end": "307280"
  },
  {
    "text": "you know throw a note away if i if i uh mess it up or something i don't want it to be too costly",
    "start": "307280",
    "end": "313280"
  },
  {
    "text": "uh both in terms of my time and in terms of the resources that i expend and of course the power usage",
    "start": "313280",
    "end": "318639"
  },
  {
    "text": "you know i like many of you mined some bitcoin back in the day and of course anybody that does that",
    "start": "318639",
    "end": "325120"
  },
  {
    "text": "realizes very quickly that power consumption is costly and in this case i don't want to be paying out the nose",
    "start": "325120",
    "end": "331840"
  },
  {
    "text": "for power consumption on this server uh because at that point it's like well i may as well just you know throw a",
    "start": "331840",
    "end": "337840"
  },
  {
    "text": "cloud service up but of course then i'm not getting the on-prem like the the bare metal experience",
    "start": "337840",
    "end": "343039"
  },
  {
    "text": "that i'm looking for uh",
    "start": "343039",
    "end": "347600"
  },
  {
    "start": "349000",
    "end": "409000"
  },
  {
    "text": "oops so um whoops so that means that there are a couple of things that aren't options",
    "start": "349120",
    "end": "355600"
  },
  {
    "text": "the raspberry pi as great as it is as much as i love it it's not an option they have this really kick-ass turing",
    "start": "355600",
    "end": "361840"
  },
  {
    "text": "pie board that you can put seven compute modules on too it's got 28 cores",
    "start": "361840",
    "end": "366880"
  },
  {
    "text": "super cool onboard networking they're sold out everywhere really cool board i remember when it",
    "start": "366880",
    "end": "372000"
  },
  {
    "text": "came out i really wanted one but it doesn't actually meet any of the criteria all the criteria that i put out",
    "start": "372000",
    "end": "378639"
  },
  {
    "text": "likewise the uh ryzen thread ripper you could buy that thing and you could have you know maybe 64 cores to throw at",
    "start": "378639",
    "end": "385759"
  },
  {
    "text": "kubernetes how cool would that be but of course this is pricey pricey we're talking uh i think it's over like 1500 bucks but",
    "start": "385759",
    "end": "392800"
  },
  {
    "text": "for the 64 core version i think it's more like three thousand dollars so this is a pricey uh cpu and of course you also have to",
    "start": "392800",
    "end": "398080"
  },
  {
    "text": "build a whole machine around it so uh and it's also not scalable right so this one",
    "start": "398080",
    "end": "403280"
  },
  {
    "text": "uh unfortunately isn't gonna be the fit now what is gonna be the fit is",
    "start": "403280",
    "end": "408400"
  },
  {
    "text": "the atomic pie and this thing is a little known board it's kind of a gem they're",
    "start": "408400",
    "end": "414720"
  },
  {
    "start": "409000",
    "end": "457000"
  },
  {
    "text": "only 35 for one of these boards and they have an intel atom processor with four cores",
    "start": "414720",
    "end": "421039"
  },
  {
    "text": "they have come with two gigs of ram and they have 16 gigs of emmc memory and they only draw max about three amps",
    "start": "421039",
    "end": "428479"
  },
  {
    "text": "of power usually less so we're talking about something that's usually drawing uh quite a bit less power than um",
    "start": "428479",
    "end": "436160"
  },
  {
    "text": "than you know anything standard that you'd be looking at very similar to raspberry pi a little bit more power consumption than a raspberry pi i think",
    "start": "436160",
    "end": "442880"
  },
  {
    "text": "but basically another you know five volt kind of kind of setup this thing is sweet and and we can even",
    "start": "442880",
    "end": "448479"
  },
  {
    "text": "do hardware transcoding on it which is really cool so uh they are chunky they are they're bigger than a raspberry pi which you'll",
    "start": "448479",
    "end": "454880"
  },
  {
    "text": "see in a minute but um people have built some really cool stuff with these this this build way over to my",
    "start": "454880",
    "end": "460560"
  },
  {
    "start": "457000",
    "end": "546000"
  },
  {
    "text": "my side here uh is actually i think it's 32 nodes and so they have 32 times four",
    "start": "460560",
    "end": "467680"
  },
  {
    "text": "cores to handle um all the different jobs they have and they actually put up benchmarks that",
    "start": "467680",
    "end": "473199"
  },
  {
    "text": "show that they were actually able to complete their workloads faster than a ryzen 9 which they spent",
    "start": "473199",
    "end": "480240"
  },
  {
    "text": "uh you know 750 bucks on all these nodes um and uh they have something that performs",
    "start": "480240",
    "end": "485680"
  },
  {
    "text": "as well as maybe a 750 an 800 processor which of course then requires a whole other system built",
    "start": "485680",
    "end": "490879"
  },
  {
    "text": "on top of it so they were able to cut you know 30 to 40 percent of the cost off of this thing plus it's modular plus you can add",
    "start": "490879",
    "end": "496560"
  },
  {
    "text": "components there's also some cool stuff on the thingiverse you can grab and this one right behind me is actually",
    "start": "496560",
    "end": "501919"
  },
  {
    "text": "a server rack that someone has put i think 24 nodes into and they've stuffed it into their rack so they can",
    "start": "501919",
    "end": "508160"
  },
  {
    "text": "i don't know what they're doing with it running builds or whatever but there is actually a pretty cool community around these boards uh they're not they're not nearly as",
    "start": "508160",
    "end": "514240"
  },
  {
    "text": "popular as the raspberry pi um for a couple of reasons you do have to manage the power on board unlike a",
    "start": "514240",
    "end": "519279"
  },
  {
    "text": "raspberry pi where you just you know plug in a usb you basically just have pins and you got to use some uh some dupont",
    "start": "519279",
    "end": "525600"
  },
  {
    "text": "you know wires to actually wire it up to a power supply you have to buy a separate power supply um and i didn't know these you know",
    "start": "525600",
    "end": "532080"
  },
  {
    "text": "these server power supplies you actually have to like tunes you have to get on a screwdriver and like a volt meter to actually get them to the right voltage",
    "start": "532080",
    "end": "538080"
  },
  {
    "text": "sounds a little intense but once you do it it's not that hard once you try it once it's fairly easy so",
    "start": "538080",
    "end": "544320"
  },
  {
    "text": "you can do it now they do like i mentioned they do support hardware transcoding there is",
    "start": "544320",
    "end": "549760"
  },
  {
    "start": "546000",
    "end": "573000"
  },
  {
    "text": "a cool uh benchmark that somebody did where they actually for they showed four hardware trans codes on",
    "start": "549760",
    "end": "555120"
  },
  {
    "text": "one of these boards uh they do support x264 transcoding not x265 transcoding but they do have x265",
    "start": "555120",
    "end": "562240"
  },
  {
    "text": "decoding so you could still potentially get some performance benefit from using this board and it is supported by the kubernetes",
    "start": "562240",
    "end": "568399"
  },
  {
    "text": "intel gpu plug-in and supporters in parentheses we'll get into that in a minute so this met all my criteria and when i",
    "start": "568399",
    "end": "575040"
  },
  {
    "text": "started off i drew this out of what i wanted to do i had a raspberry pi 3 as my master node",
    "start": "575040",
    "end": "581200"
  },
  {
    "text": "of course this and running my my uh my nas and of course this actually didn't work well because it's usb",
    "start": "581200",
    "end": "586880"
  },
  {
    "text": "2. terrible idea very bad read write speeds so i upgraded that to a pi 4 for my",
    "start": "586880",
    "end": "592320"
  },
  {
    "text": "masternode and then i had originally planned to throw a relay into here so i could",
    "start": "592320",
    "end": "597839"
  },
  {
    "text": "switch nodes on and off using the raspberry pi's io",
    "start": "597839",
    "end": "603360"
  },
  {
    "text": "but uh i haven't needed to do that and um even though like auto scaling that",
    "start": "603360",
    "end": "608720"
  },
  {
    "text": "would be really cool to get to maybe that's something i'll do in the future and then it's all sitting on a gigabit switch",
    "start": "608720",
    "end": "613839"
  },
  {
    "text": "and there's a i think it's a 200 watt power supply supplying power to my um my four atomic pi nodes",
    "start": "613839",
    "end": "621200"
  },
  {
    "text": "so uh that's that's the basic setup this is what i started with and i'll show you in a second what i've built",
    "start": "621200",
    "end": "627120"
  },
  {
    "start": "627000",
    "end": "689000"
  },
  {
    "text": "um as far as setup goes it's pretty straightforward i basically installed ubuntu 1804 server threw a static ip on there i did",
    "start": "627120",
    "end": "634959"
  },
  {
    "text": "need to install an nfs package which i forgot to mention just so that my pods could actually access nfs",
    "start": "634959",
    "end": "641360"
  },
  {
    "text": "services and then i installed k3s and if you don't know k3s and some people call it k3s",
    "start": "641360",
    "end": "647360"
  },
  {
    "text": "just like it's k8s or or cates or whatever but k3s uh is brilliant i mean we're talking",
    "start": "647360",
    "end": "653279"
  },
  {
    "text": "about kubernetes in 40 migs it's super super small super slim super efficient it supports",
    "start": "653279",
    "end": "658959"
  },
  {
    "text": "both arm and x86 and i am going to have a mixed cluster because i have my arm master node as well as my atomic",
    "start": "658959",
    "end": "665920"
  },
  {
    "text": "pi uh worker nodes and then there is basically no step three the the",
    "start": "665920",
    "end": "670959"
  },
  {
    "text": "installation for k3s is super simple you're looking at the whole thing right there so getting these set up uh even doing it",
    "start": "670959",
    "end": "677200"
  },
  {
    "text": "manually is actually really really quick and easy and the nodes are basically blank there's nothing really special about",
    "start": "677200",
    "end": "682640"
  },
  {
    "text": "them i could lose one tomorrow and i'm not going to worry about it i can add another one in and it's going to be super easy to",
    "start": "682640",
    "end": "687839"
  },
  {
    "text": "provision as far as the networking goes this is a home network and i don't have a managed",
    "start": "687839",
    "end": "693600"
  },
  {
    "start": "689000",
    "end": "847000"
  },
  {
    "text": "switch i don't have something fancy going on i basically have i do have google fiber which is fancy but",
    "start": "693600",
    "end": "699279"
  },
  {
    "text": "basically on my router all i did is i reserved 100 addresses in my dhcp so that i could give that to",
    "start": "699279",
    "end": "706399"
  },
  {
    "text": "the cluster to actually manage the k3s cluster actually has onboard",
    "start": "706399",
    "end": "711440"
  },
  {
    "text": "networking that's included i don't know if it's calico or whatever it is under the hood but it just works and i haven't had to mess with it so that's great",
    "start": "711440",
    "end": "718800"
  },
  {
    "text": "and then i did install metal lb a metal load balancer which is a kubernetes project i think it's in the cncf it's",
    "start": "718800",
    "end": "725440"
  },
  {
    "text": "pretty rad and basically gave it around 40 addresses that it could allocate to",
    "start": "725440",
    "end": "730720"
  },
  {
    "text": "ingress or service load balancers or whatever it needs and so this this setup from a",
    "start": "730720",
    "end": "737040"
  },
  {
    "text": "networking perspective was pretty easy when i first did this i actually was doing it with a wireless network",
    "start": "737040",
    "end": "744880"
  },
  {
    "text": "bridge in between which is a whole nother load of malarkey but now i've i've reworked all my",
    "start": "744880",
    "end": "750240"
  },
  {
    "text": "networking in my house so i have everything just connected through a switch up into my uh up into my router and and so it's",
    "start": "750240",
    "end": "757120"
  },
  {
    "text": "actually very simple networking it's nothing that's uh super fancy that you know",
    "start": "757120",
    "end": "762320"
  },
  {
    "text": "that requires any brilliance on my part um which is good because i don't have a whole lot uh so",
    "start": "762320",
    "end": "768880"
  },
  {
    "text": "i want to show you really quick how the server looks and for that i'm going to switch my view",
    "start": "768880",
    "end": "774000"
  },
  {
    "text": "to the atomic view this is the live view of the cluster let me get up and look over here and i'll point out some stuff you can see",
    "start": "774000",
    "end": "780000"
  },
  {
    "text": "all my nodes here and node one two three and four and then for scale of course you do have the",
    "start": "780000",
    "end": "786079"
  },
  {
    "text": "raspberry pi uh this is my master node or my primary node that's",
    "start": "786079",
    "end": "792880"
  },
  {
    "text": "actually running the the main part of the cluster hopefully i didn't crash it just by touching it",
    "start": "792880",
    "end": "798000"
  },
  {
    "text": "and then you can see i've actually um spliced out the networking cables so they all fit nicely and they all go up",
    "start": "798000",
    "end": "803440"
  },
  {
    "text": "into a switch that's just sitting above it and back here we've got our power supply which runs this whole length the power",
    "start": "803440",
    "end": "809200"
  },
  {
    "text": "supply is is actually as big as probably two nodes and then i do have a usb 3 drive sitting in here in the",
    "start": "809200",
    "end": "815839"
  },
  {
    "text": "cluster i'm actually not using this for storage anymore for some reasons that we'll talk about in a minute but it did fit in here",
    "start": "815839",
    "end": "822399"
  },
  {
    "text": "nicely with the legos and eventually i'd like to put this into maybe a rack or something but i still consider this",
    "start": "822399",
    "end": "827440"
  },
  {
    "text": "kind of a work in progress so i'm not quite ready to to get um you know fancy with the storage yet",
    "start": "827440",
    "end": "833600"
  },
  {
    "text": "so that's the atomic pie and it's the atomic cluster in other",
    "start": "833600",
    "end": "839279"
  },
  {
    "text": "words and so far it's working pretty great um so we're gonna talk a little bit more about the setup and then i'll get into a",
    "start": "839279",
    "end": "845040"
  },
  {
    "text": "little bit more demo action here in a second first of all k3s actually comes with a system upgrade",
    "start": "845040",
    "end": "850560"
  },
  {
    "start": "847000",
    "end": "968000"
  },
  {
    "text": "controller for kubernetes which is bloody brilliant because otherwise i would have to figure out how",
    "start": "850560",
    "end": "856079"
  },
  {
    "text": "to keep these things updated with the latest version of kubernetes in this case i can actually create a plan and you can see the plan up here",
    "start": "856079",
    "end": "862560"
  },
  {
    "text": "basically i specify for my master node how many concurrency can i change so i",
    "start": "862560",
    "end": "867680"
  },
  {
    "text": "can actually do ha k3s here and then for my worker nodes",
    "start": "867680",
    "end": "872880"
  },
  {
    "text": "how many concurrency updates can i run and basically i just took the boilerplate here stuck",
    "start": "872880",
    "end": "877920"
  },
  {
    "text": "in the version i wanted right there and applied it and it upgraded all my nodes for me so this is actually super",
    "start": "877920",
    "end": "883440"
  },
  {
    "text": "friendly with ci cd i actually have it hooked up to both argo and code fresh for my my devops kind of reducing toil",
    "start": "883440",
    "end": "890720"
  },
  {
    "text": "project so this is super slick great keeps my kubernetes nodes updated",
    "start": "890720",
    "end": "896639"
  },
  {
    "text": "and it works both for arm and for x86 because again i have a raspberry pi",
    "start": "896639",
    "end": "902480"
  },
  {
    "text": "for my master node and all my worker nodes are x86 so as what basically the way this works",
    "start": "902480",
    "end": "907839"
  },
  {
    "text": "is uh argo does the sync so so code fresh can do some testing but argo does the sync",
    "start": "907839",
    "end": "914399"
  },
  {
    "text": "that actually uh sends the uh plan to the system upgrade controller",
    "start": "914399",
    "end": "921199"
  },
  {
    "text": "basically it sends it to kubernetes records these crd plans and then the upgrade controller actually takes the",
    "start": "921199",
    "end": "927760"
  },
  {
    "text": "work to make sure that those are applied and it it will migrate itself to another",
    "start": "927760",
    "end": "932959"
  },
  {
    "text": "node if it needs to i believe so that it doesn't uh you know have any issues when it's upgrading nodes",
    "start": "932959",
    "end": "938560"
  },
  {
    "text": "and i found that this works really well it doesn't take a node offline until it's ready to upgrade it so the",
    "start": "938560",
    "end": "945360"
  },
  {
    "text": "first time i tried to do it i actually had selected like the wrong tag or something for my version and it",
    "start": "945360",
    "end": "951440"
  },
  {
    "text": "it just said oh well i can't upgrade this with this current this current plan so i didn't have any downtime i didn't lose the note or anything",
    "start": "951440",
    "end": "957680"
  },
  {
    "text": "uh so this thing's brilliant and i basically just make it uh make a change to the version do i get",
    "start": "957680",
    "end": "962720"
  },
  {
    "text": "commit and push and then it automatically rolls out through argo which i'll show you in a second",
    "start": "962720",
    "end": "969040"
  },
  {
    "start": "968000",
    "end": "1024000"
  },
  {
    "text": "there's the intel quick sync device plug-in for kubernetes which i also installed and this is",
    "start": "969040",
    "end": "974800"
  },
  {
    "text": "designed to support opencl which is not supported by the atomic pi but we only need the va api which",
    "start": "974800",
    "end": "981519"
  },
  {
    "text": "is supported by this plugin so installing this exposes the onboard",
    "start": "981519",
    "end": "987120"
  },
  {
    "text": "gpu for hardware hardware transcoding and um i the only thing i actually did make a",
    "start": "987120",
    "end": "993040"
  },
  {
    "text": "pull request to this thing that they accepted which was to make it so that it didn't try to roll out to arm nodes",
    "start": "993040",
    "end": "998399"
  },
  {
    "text": "so i think intel was more than happy to get rid of that and then in kubernetes and see if i can move out",
    "start": "998399",
    "end": "1003920"
  },
  {
    "text": "of the way a little bit this is uh basically all you need to add to your kubernetes pods once you've installed this you just make a resource",
    "start": "1003920",
    "end": "1009920"
  },
  {
    "text": "limit and request the gpu intel and then it will only deploy those pods",
    "start": "1009920",
    "end": "1015920"
  },
  {
    "text": "onto nodes that are capable of doing hardware transcoding and this was actually pretty slick works",
    "start": "1015920",
    "end": "1022959"
  },
  {
    "text": "really well i also mentioned that i have git ops running here so i have",
    "start": "1022959",
    "end": "1028880"
  },
  {
    "start": "1024000",
    "end": "1102000"
  },
  {
    "text": "the code fresh runner installed the code fresh runner is basically an on-prem component that you can throw",
    "start": "1028880",
    "end": "1034798"
  },
  {
    "text": "onto a cluster it can run builds it can access your cluster behind the firewall i haven't opened up any of my ports from",
    "start": "1034799",
    "end": "1039839"
  },
  {
    "text": "my home network to code fresh or anything like that but it all it basically sits on my cluster everything stays private to my",
    "start": "1039839",
    "end": "1046640"
  },
  {
    "text": "cluster but i can manage it from the code fresh ui so no matter where i am i can actually run builds against the",
    "start": "1046640",
    "end": "1051840"
  },
  {
    "text": "cluster or anything like that and they happen automatically so i can actually execute both pipelines and excess",
    "start": "1051840",
    "end": "1056960"
  },
  {
    "text": "resources behind the firewall well not not necessarily access resources behind the firewall but that's a whole other ball",
    "start": "1056960",
    "end": "1063440"
  },
  {
    "text": "of wax but it works really well and it's very scalable so as i add more nodes i can run more builds",
    "start": "1063440",
    "end": "1070000"
  },
  {
    "text": "i also have argo cd used for sync so once i'm ready to make a deployment i do a git",
    "start": "1070000",
    "end": "1075200"
  },
  {
    "text": "commit and push in some cases that triggers a code fresh flow that actually does builds and tests before triggering",
    "start": "1075200",
    "end": "1081200"
  },
  {
    "text": "a deployment and in other cases it just uh it just goes directly to argo cd to just sync",
    "start": "1081200",
    "end": "1086400"
  },
  {
    "text": "onto the cluster and you can follow my project at github.com today it was awesome atomic cluster so you can actually see",
    "start": "1086400",
    "end": "1093120"
  },
  {
    "text": "how i've got most of this stuff set up and i have a little bit of a write up and i'll add a shopping list before this errors",
    "start": "1093120",
    "end": "1098559"
  },
  {
    "text": "so that you can actually see all the components in my board now storage i mentioned we're going to",
    "start": "1098559",
    "end": "1104080"
  },
  {
    "start": "1102000",
    "end": "1307000"
  },
  {
    "text": "talk about this earlier storage in kubernetes everybody knows is a bit rough and i have to say it is a",
    "start": "1104080",
    "end": "1110960"
  },
  {
    "text": "bit rough uh it's tough so i ended up going with a separate nas for",
    "start": "1110960",
    "end": "1116480"
  },
  {
    "text": "nfs to do my networking to provide my storage um and it's serving it over nfs the",
    "start": "1116480",
    "end": "1123200"
  },
  {
    "text": "reason that i didn't keep it on my atomic sorry on my raspberry pi is that",
    "start": "1123200",
    "end": "1128799"
  },
  {
    "text": "that usb drive just goes dormant sometimes and so as service i try to",
    "start": "1128799",
    "end": "1133840"
  },
  {
    "text": "access a service and it would take a long time to basically warm up the usb mount it remount it get it provided over",
    "start": "1133840",
    "end": "1141679"
  },
  {
    "text": "the network and by the time that that's happened you know maybe you have a pod failing things aren't working well it's just",
    "start": "1141679",
    "end": "1147679"
  },
  {
    "text": "slow and clunky and and didn't work super well it worked fine for the proof of concept",
    "start": "1147679",
    "end": "1152799"
  },
  {
    "text": "but not a good long-term solution so i moved this over to a dedicated nfs which is uh probably the background fan",
    "start": "1152799",
    "end": "1159679"
  },
  {
    "text": "word that you hear and uh it's a little noisy so i'd like to do something else there but",
    "start": "1159679",
    "end": "1164799"
  },
  {
    "text": "in this case it's basically running a bunch of uh a bunch of hard drives that have a ton of storage on them",
    "start": "1164799",
    "end": "1170240"
  },
  {
    "text": "and the nfs is very very fast so this does work better but a lot of these services were not",
    "start": "1170240",
    "end": "1175600"
  },
  {
    "text": "designed to work in a kubernetes environment and so i've noticed that they",
    "start": "1175600",
    "end": "1181280"
  },
  {
    "text": "do sometimes get a little finicky i'm looking into rook as a storage provider which",
    "start": "1181280",
    "end": "1187280"
  },
  {
    "text": "supports ceph which is a distributed file system i think that's really interesting but i probably need to do some",
    "start": "1187280",
    "end": "1192720"
  },
  {
    "text": "different things with my cluster before i can have uh distributed storage working on it",
    "start": "1192720",
    "end": "1198080"
  },
  {
    "text": "because right now my my nodes are all throwaway right they're not special but once i start to throw storage on there",
    "start": "1198080",
    "end": "1203760"
  },
  {
    "text": "i now have to be thinking about redundancy and how that works so i think that's very promising and might work",
    "start": "1203760",
    "end": "1208960"
  },
  {
    "text": "really well for just the kind of config data portions of what i'm doing maybe the plex configuration that kind of thing",
    "start": "1208960",
    "end": "1215280"
  },
  {
    "text": "that is more expectant of running on a local file system a lot of these",
    "start": "1215280",
    "end": "1220400"
  },
  {
    "text": "services use sqlite which works great when it's sitting on a desktop but boy howdy it does not like running",
    "start": "1220400",
    "end": "1226960"
  },
  {
    "text": "off of a network file storage so i have had to repair a number of sqlite databases while i've been using",
    "start": "1226960",
    "end": "1233200"
  },
  {
    "text": "this maybe a pod goes down before the lock is removed from the database something like",
    "start": "1233200",
    "end": "1238320"
  },
  {
    "text": "that i actually did use lose data several times which is this is a good exercise right this is what home labs are for",
    "start": "1238320",
    "end": "1244559"
  },
  {
    "text": "so that's been a big learning experience for me and looking into the future i am planning on getting some 10",
    "start": "1244559",
    "end": "1251120"
  },
  {
    "text": "gig uh networking going where my my nas i'd actually like to have",
    "start": "1251120",
    "end": "1258159"
  },
  {
    "text": "a 10 gig ethernet connection to that that i then distribute to all my one gigabit a second nodes and that way i could have",
    "start": "1258159",
    "end": "1265360"
  },
  {
    "text": "very high read write uh throughput and 10 gig isn't necessarily super expensive you can actually find cards",
    "start": "1265360",
    "end": "1271679"
  },
  {
    "text": "for pcs for like 20 30 bucks the switches are a little bit more tricky you can",
    "start": "1271679",
    "end": "1277039"
  },
  {
    "text": "find switches that aren't too pricey that have 10 gig copper ethernet connections and if you can actually use a regular cable if",
    "start": "1277039",
    "end": "1283039"
  },
  {
    "text": "you're going over a very short distance but they are very pricey once you get into the 24",
    "start": "1283039",
    "end": "1289120"
  },
  {
    "text": "poor range but now i'm talking more home networking stuff so anyway that's that's more future thinking but storage",
    "start": "1289120",
    "end": "1294880"
  },
  {
    "text": "does remain a little bit of a problem i can use my cluster ready it does work but i am a i notice the storage is a little bit",
    "start": "1294880",
    "end": "1301039"
  },
  {
    "text": "finicky so i have to watch it um so i'm gonna that's something i'm gonna have to invest a little bit more time into fixing and addressing",
    "start": "1301039",
    "end": "1307760"
  },
  {
    "start": "1307000",
    "end": "1367000"
  },
  {
    "text": "um there once you start doing this you will find there are a ton of community maintained images on linux server.io",
    "start": "1307760",
    "end": "1314640"
  },
  {
    "text": "uh so they have everything from home lab basically all your home lab stuff and",
    "start": "1314640",
    "end": "1320799"
  },
  {
    "text": "they are pretty nice images they usually include things like user permissions mapping which is important when you're",
    "start": "1320799",
    "end": "1326480"
  },
  {
    "text": "using a your your storage you want to be able to put the right permissions mask on it",
    "start": "1326480",
    "end": "1332880"
  },
  {
    "text": "um but they were really all designed for working with docker compose on a local machine",
    "start": "1332880",
    "end": "1338159"
  },
  {
    "text": "and actually when i showed this setup to a friend of mine he said hey these are really cool this is really cool that you're running all these services but i do all this on",
    "start": "1338159",
    "end": "1344559"
  },
  {
    "text": "my desktop and i just do docker compose up and it seems like you've done a lot more work than that to get all those kubernetes working",
    "start": "1344559",
    "end": "1350000"
  },
  {
    "text": "to which i would say yes yes i have yes i've done a lot more work than that but i have something modular and scalable so",
    "start": "1350000",
    "end": "1355840"
  },
  {
    "text": "it's and and and actually cheaper than what uh what he's he's designed and built so",
    "start": "1355840",
    "end": "1360880"
  },
  {
    "text": "um you know i'm happy with the choice in that case uh so check these images out they have pretty good maintenance and upgrades",
    "start": "1360880",
    "end": "1367280"
  },
  {
    "text": "um i'm gonna jump into another demo here let's actually just browse around the cluster and i'll show you a few things",
    "start": "1367280",
    "end": "1373919"
  },
  {
    "text": "of note here so i'm actually sitting inside my git repo here i have some uncommitted changes so if i commit those it'll actually trigger a",
    "start": "1373919",
    "end": "1380080"
  },
  {
    "text": "sync to the cluster but before i do that i want to show you some interesting things when i'm looking",
    "start": "1380080",
    "end": "1386640"
  },
  {
    "text": "at my services you'll notice that i actually have two plex services here one is for udp and one is for not udp",
    "start": "1386640",
    "end": "1394799"
  },
  {
    "text": "it's for tcp i have the same thing going with netboot xyz which is a um which is a uh a net boot provider so",
    "start": "1394799",
    "end": "1403039"
  },
  {
    "text": "you can boot machines up over over uh your lan network um the reason i have to have two",
    "start": "1403039",
    "end": "1408159"
  },
  {
    "text": "is because kubernetes load balancers do not support both udp and tcp at the same time so what i've",
    "start": "1408159",
    "end": "1415039"
  },
  {
    "text": "done is these actually use and uh let me let me resize this window",
    "start": "1415039",
    "end": "1421840"
  },
  {
    "text": "slightly so you can see hang on let me let me bring it down just a little bit",
    "start": "1421840",
    "end": "1429200"
  },
  {
    "text": "just a little bit so you can see a little bit more what's going on here there we go so",
    "start": "1429200",
    "end": "1435840"
  },
  {
    "text": "uh you'll actually notice that those load balancers for the same service actually share ips",
    "start": "1435840",
    "end": "1442400"
  },
  {
    "text": "so see this net boot one actually has 2 is as 1025 and the other one above it is 1025.",
    "start": "1442400",
    "end": "1447760"
  },
  {
    "text": "so this is actually a feature of metal load balancer where you can actually put annotations on a service to tell it that you can",
    "start": "1447760",
    "end": "1454159"
  },
  {
    "text": "actually share an ip address so this was a little bit of a gotcha to figure out how to serve udp and tcp",
    "start": "1454159",
    "end": "1460320"
  },
  {
    "text": "and this is important for a couple of services for netboot it's important just because of the way netboot works and it has to have a tftp server that",
    "start": "1460320",
    "end": "1467360"
  },
  {
    "text": "that things can access which works over udp plex was the one that was a surprise to me",
    "start": "1467360",
    "end": "1472480"
  },
  {
    "text": "everywhere i looked people just had plex images that were serving up tcp and a lot of local devices don't work",
    "start": "1472480",
    "end": "1479679"
  },
  {
    "text": "well if you don't have udp so if i got like a roku tv it couldn't see plex most of the time it",
    "start": "1479679",
    "end": "1485840"
  },
  {
    "text": "couldn't see it reliably until i added the udp load balancer and advertise",
    "start": "1485840",
    "end": "1491120"
  },
  {
    "text": "those services and of course i have to keep it on the same ip address otherwise i think the whole thing would get confused and funky so that's something",
    "start": "1491120",
    "end": "1497440"
  },
  {
    "text": "to watch out for you do have to care about udp and tcp and again this goes towards the home lab",
    "start": "1497440",
    "end": "1503120"
  },
  {
    "text": "the truth is most stuff is not designed to work with the home lab the other thing that i ran into and",
    "start": "1503120",
    "end": "1509919"
  },
  {
    "text": "learned very quickly is of course and and most people know this i think if you're seasoned but",
    "start": "1509919",
    "end": "1515279"
  },
  {
    "text": "um all of my uh my volumes and volume claims are",
    "start": "1515279",
    "end": "1521919"
  },
  {
    "text": "actually immutable so when i'm working with these things if i make a change they won't",
    "start": "1521919",
    "end": "1528400"
  },
  {
    "text": "automatically get configured it'll basically throw an error and say hey i can't i can't deploy that",
    "start": "1528400",
    "end": "1534000"
  },
  {
    "text": "so today i was rolling out a new change uh which went through argo cd",
    "start": "1534000",
    "end": "1539520"
  },
  {
    "text": "and code fresh and it couldn't complete the rollout because one of the pvcs was",
    "start": "1539520",
    "end": "1544880"
  },
  {
    "text": "different and i actually had to go and delete the pvc and the the only issue with that",
    "start": "1544880",
    "end": "1550559"
  },
  {
    "text": "and again let me resize my window here is for some reason and this is something else that i i",
    "start": "1550559",
    "end": "1556159"
  },
  {
    "text": "probably need to look into um i typically run into issues when i'm",
    "start": "1556159",
    "end": "1561360"
  },
  {
    "text": "trying to delete these pvcs because they basically have some protection on them",
    "start": "1561360",
    "end": "1566559"
  },
  {
    "text": "so if i look at these pvcs let's say that i wanted to delete this minecraft dur one it probably won't delete when i",
    "start": "1566559",
    "end": "1575440"
  },
  {
    "text": "try to delete it",
    "start": "1575440",
    "end": "1578240"
  },
  {
    "text": "so yeah it says it's deleted but it's hanging and it's hanging because there are finalizers on it which",
    "start": "1581919",
    "end": "1587679"
  },
  {
    "text": "is i think it's just a feature built into kubernetes so if i pull this open again it will say that it's terminating and",
    "start": "1587679",
    "end": "1593120"
  },
  {
    "text": "that thing will sit there forever it will never die and so you actually have to do something a little gross and this is all like",
    "start": "1593120",
    "end": "1599360"
  },
  {
    "text": "pretty like i'm not telling you'd ever do this with production obviously i'm like i'm like just i'm the",
    "start": "1599360",
    "end": "1605600"
  },
  {
    "text": "only user here right so it's uh so i'm i'm violating some principles here but basically the only way i've figured",
    "start": "1605600",
    "end": "1612240"
  },
  {
    "text": "out how to get these to actually delete is to go in and remove this protection",
    "start": "1612240",
    "end": "1617279"
  },
  {
    "text": "finalizer and once i do that this thing will delete right away and and so you can see that it's been",
    "start": "1617279",
    "end": "1623679"
  },
  {
    "text": "edited and if i get pvc it'll be gone so i just killed my minecraft instance not a big deal because i'll just",
    "start": "1623679",
    "end": "1629760"
  },
  {
    "text": "reapply the config or i can actually just do it through argo and that'll just work smoothly there'll",
    "start": "1629760",
    "end": "1635520"
  },
  {
    "text": "be no problems there so this this actually you can see you know just looking around my cluster here",
    "start": "1635520",
    "end": "1640559"
  },
  {
    "text": "for a second you can see i've got a number of different name spaces here i've got the argo cd namespace i have a system",
    "start": "1640559",
    "end": "1646159"
  },
  {
    "text": "upgrade namespace which is where that system upgrade controller is working and if we look at that uh",
    "start": "1646159",
    "end": "1652480"
  },
  {
    "text": "let's get um yeah just just that",
    "start": "1652480",
    "end": "1658320"
  },
  {
    "text": "uh you can see that we actually just have a single pod there running for the controller and then if i look in the argo",
    "start": "1660320",
    "end": "1669840"
  },
  {
    "text": "what you'll be able to see is that i have all my argo stuff running and then i also have a cf argo cd agent",
    "start": "1675039",
    "end": "1681760"
  },
  {
    "text": "and basically what that does is it sits between code fresh and argo and keeps all the information up to date",
    "start": "1681760",
    "end": "1687600"
  },
  {
    "text": "and code fresh so that all my build information is annotated and associated with what deployments and rollouts are happening which is a really",
    "start": "1687600",
    "end": "1693760"
  },
  {
    "text": "useful view to have i'm not going to get super deep into that demo but if you want to check it out go to codefresh.io we'll have some",
    "start": "1693760",
    "end": "1699200"
  },
  {
    "text": "videos up there so that's pretty slick and then of course i actually run a lot of stuff out",
    "start": "1699200",
    "end": "1705120"
  },
  {
    "text": "of my default namespace i know it's a little silly i've got my ingress in there and all that kind of stuff so works pretty smoothly i'm pretty happy with it",
    "start": "1705120",
    "end": "1712080"
  },
  {
    "text": "um and overall i'd have to say that this this whole setup runs fairly smoothly",
    "start": "1712080",
    "end": "1718000"
  },
  {
    "text": "and uh is pretty rad so i'm gonna go back over here for a second",
    "start": "1718000",
    "end": "1723360"
  },
  {
    "text": "um now i'm happy to take questions and uh you can follow progress at github.com",
    "start": "1723360",
    "end": "1728559"
  },
  {
    "text": "today was awesome atomic cluster i wanted to show you just for a second um over here",
    "start": "1728559",
    "end": "1734880"
  },
  {
    "text": "in my let's actually look at the argo dashboard here so here you can see actually the the",
    "start": "1734880",
    "end": "1740000"
  },
  {
    "text": "different services that i have set up with argo and you can you can see it they're all synced and if",
    "start": "1740000",
    "end": "1745200"
  },
  {
    "text": "i go over to code fresh i'll actually get the same view my browser crashed because i've got obs",
    "start": "1745200",
    "end": "1750480"
  },
  {
    "text": "running and it just tanks all of my processor power um",
    "start": "1750480",
    "end": "1757039"
  },
  {
    "text": "oh man not loading come on there we go so so this view actually will give me",
    "start": "1757200",
    "end": "1764159"
  },
  {
    "text": "all the information now like i mentioned in the future i think i need to solve the storage issues",
    "start": "1764159",
    "end": "1770080"
  },
  {
    "text": "and i also wanted to set up automated node provisioning using ansible so that when i plug in a node",
    "start": "1770080",
    "end": "1775600"
  },
  {
    "text": "these actually these nodes actually have pxe boot enabled by default so they will actually they will actually",
    "start": "1775600",
    "end": "1782799"
  },
  {
    "text": "automatically uh boot to the netboot server and install something now",
    "start": "1782799",
    "end": "1789919"
  },
  {
    "text": "one of the things that i actually looked into was uh there is a way to set up",
    "start": "1789919",
    "end": "1795360"
  },
  {
    "text": "these nodes so that they boot an image and just run that so you don't actually",
    "start": "1795360",
    "end": "1801039"
  },
  {
    "text": "install anything on the node it just runs the image from the network and i actually ruled that out because i",
    "start": "1801039",
    "end": "1808960"
  },
  {
    "text": "lose power sometimes and i want to have cold start easy and i don't want to have some separate services or anything i actually",
    "start": "1808960",
    "end": "1814880"
  },
  {
    "text": "want to run everything on my kubernetes cluster anything that's sitting outside of the kubernetes cluster besides the nfs",
    "start": "1814880",
    "end": "1822080"
  },
  {
    "text": "and even that is a little bit suspect anything that's running outside of the kubernetes cluster is another point of failure that i have to maintain i don't",
    "start": "1822080",
    "end": "1828320"
  },
  {
    "text": "want to have to maintain it so yeah you can see here that in code fresh i've got all these apps uh sitting here as well and if i look at",
    "start": "1828320",
    "end": "1837039"
  },
  {
    "text": "let's see which one would be interesting so this one actually has a couple failures on it because i had to delete",
    "start": "1837039",
    "end": "1843360"
  },
  {
    "text": "my pvc because it wasn't able to sync so that was the the issue that i was talking about earlier",
    "start": "1843360",
    "end": "1848480"
  },
  {
    "text": "but it is in sync right now so everything's fine um in this view actually this one doesn't have builds associated",
    "start": "1848480",
    "end": "1854320"
  },
  {
    "text": "with it but if it did i would actually see the build information here and of course my pull requests any issues in jira that i would have created",
    "start": "1854320",
    "end": "1860480"
  },
  {
    "text": "which again i'm not doing because clearly this is overkill for my home cluster but it's just kind",
    "start": "1860480",
    "end": "1865840"
  },
  {
    "text": "of rad to be able to use the the clean devops stuff so with that i want to thank you for coming to my",
    "start": "1865840",
    "end": "1871600"
  },
  {
    "text": "kubecon talk i hope that this was interesting maybe it'll inspire you to build your own kubernetes cluster your own home lab",
    "start": "1871600",
    "end": "1877600"
  },
  {
    "text": "your own atomic cluster and hopefully it works really well i was really happy with mine",
    "start": "1877600",
    "end": "1883039"
  },
  {
    "text": "like i said check out the repo i will throw a shopping list in there i think this whole build what did i",
    "start": "1883039",
    "end": "1890080"
  },
  {
    "text": "spend i spent 140 bucks on 40 bucks on atomic pies because i have four of them i spent 30 bucks on the raspberry pi and",
    "start": "1890080",
    "end": "1897519"
  },
  {
    "text": "then i spent maybe 20 bucks on the other thing so we're talking about sub 200",
    "start": "1897519",
    "end": "1902720"
  },
  {
    "text": "for this kubernetes cluster and let me tell you what for a pc that i could buy for 200 bucks",
    "start": "1902720",
    "end": "1908480"
  },
  {
    "text": "there's no way it would come close to the amount of power and scalability i get out of this thing so",
    "start": "1908480",
    "end": "1913919"
  },
  {
    "text": "like i mentioned i run plex on this thing i got a minecraft server i've got a couple other things that i'm running on it i'm going to be adding more as i",
    "start": "1913919",
    "end": "1919200"
  },
  {
    "text": "go along and i'm not worried about running out of space or storage because i can always throw another node in and uh so i have",
    "start": "1919200",
    "end": "1926240"
  },
  {
    "text": "this scalable kubernetes cluster it's running great and i'm pretty happy with it so feel free to ask me questions on twitter at",
    "start": "1926240",
    "end": "1932480"
  },
  {
    "text": "today was awesome and of course if you're watching this at kubecon live i will be hanging out in the chat and having conversation there so look",
    "start": "1932480",
    "end": "1939600"
  },
  {
    "text": "forward to hearing your questions and thanks again i hope you enjoyed this i hope it was interesting",
    "start": "1939600",
    "end": "1944640"
  },
  {
    "text": "i don't know if you feel like it was the ultimate cluster let me know if you feel like this was the ultimate kubernetes home lab or if you feel like",
    "start": "1944640",
    "end": "1952640"
  },
  {
    "text": "maybe it's a little too far on the cheap side maybe you're looking for something a little bit more beefy but at least it's accessible all right",
    "start": "1952640",
    "end": "1959760"
  },
  {
    "text": "have a good one thank you",
    "start": "1959760",
    "end": "1963760"
  }
]