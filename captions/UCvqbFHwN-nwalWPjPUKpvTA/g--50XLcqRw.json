[
  {
    "text": "all right thank you so much for making the trek all the way back over here again i'm sure everybody was here this",
    "start": "80",
    "end": "5680"
  },
  {
    "text": "morning uh it's good to see everybody back in here um thanks for coming to",
    "start": "5680",
    "end": "10800"
  },
  {
    "text": "sign sealed and delivered sign and verify all the things my name is Jeremy",
    "start": "10800",
    "end": "16080"
  },
  {
    "text": "Rickard i am a principal software engineer at Microsoft Azure um and also a co-chair of SIG release in the",
    "start": "16080",
    "end": "22000"
  },
  {
    "text": "Kubernetes project today we're going to talk um a little bit about container supply chain",
    "start": "22000",
    "end": "27920"
  },
  {
    "text": "security with a large focus on um signing images and doing verification for that and how we can use that to",
    "start": "27920",
    "end": "34320"
  },
  {
    "text": "verify the authenticity of our resources some of what we're going to cover today",
    "start": "34320",
    "end": "39360"
  },
  {
    "text": "uh are things that I've picked up uh in my day job in my day job I help build and publish a lot of CNCF projects for",
    "start": "39360",
    "end": "45920"
  },
  {
    "text": "use inside of Azure and Microsoft as a whole also things from SIG release and other things I've I've seen and learned",
    "start": "45920",
    "end": "51680"
  },
  {
    "text": "about in other projects but let's start off uh taking a minute",
    "start": "51680",
    "end": "57120"
  },
  {
    "text": "to reminisce about the early days maybe the easier days of computing uh with",
    "start": "57120",
    "end": "62280"
  },
  {
    "text": "containers for me I found containers probably around 2017ish uh and I was",
    "start": "62280",
    "end": "68560"
  },
  {
    "text": "kind of drawn to it because I found that it was really easy for me to package up my application and get it to run in a",
    "start": "68560",
    "end": "74159"
  },
  {
    "text": "really similar way to how it did on my my desktop you were basically a Docker push away from getting something up and",
    "start": "74159",
    "end": "80799"
  },
  {
    "text": "running and and a lot of things were free in that time you know in 2017 i could push something to DockerHub and",
    "start": "80799",
    "end": "86479"
  },
  {
    "text": "then I could deploy it to production and it was just kind of free and it worked and it was really cool it made demos at",
    "start": "86479",
    "end": "92320"
  },
  {
    "text": "CubeCon or other conferences really really easy as long as the Wi-Fi was working and just kind of gave you this",
    "start": "92320",
    "end": "98320"
  },
  {
    "text": "kind of carefree experience so with that in mind and reminiscing I thought that I would try",
    "start": "98320",
    "end": "105119"
  },
  {
    "text": "to deploy an application as part of this talk we're going to talk about supply chain security and how it applies to deploying an application so I thought I",
    "start": "105119",
    "end": "111360"
  },
  {
    "text": "would find something kind of old um here we have the emoji vote app it's uh I think it was published by Buoyant in 2017 so we're we're coming up on a long",
    "start": "111360",
    "end": "118240"
  },
  {
    "text": "time on this thing and yesterday there was an election in my my home of",
    "start": "118240",
    "end": "123439"
  },
  {
    "text": "Colorado uh that was almost entirely pointless so having this as a voting app seems like a really good idea uh I found",
    "start": "123439",
    "end": "131039"
  },
  {
    "text": "this thing on the internet uh it's from 2017 it's probably going to be completely fine and and all right right we're going to we're going to deploy it",
    "start": "131039",
    "end": "136720"
  },
  {
    "text": "there will be no issues whatsoever i should just be able to deploy this and hopefully at the end we'll get a cluster IP for this thing and everybody can pull",
    "start": "136720",
    "end": "143120"
  },
  {
    "text": "up their phone and try to vote but actually things aren't so carefree now uh who has had uh a a rate",
    "start": "143120",
    "end": "152160"
  },
  {
    "text": "limit from Docker um yeah almost the entire crowd so DockerHub was that",
    "start": "152160",
    "end": "157680"
  },
  {
    "text": "ubiquitous registry right everybody used it it was free and we just all kind of grew to depend on it open source",
    "start": "157680",
    "end": "163040"
  },
  {
    "text": "projects published there teams used it you you may have had a a paid account for it but you were still you know using",
    "start": "163040",
    "end": "168080"
  },
  {
    "text": "it because it was just so ubiquitous uh but now there are rate limits that are put in place and for",
    "start": "168080",
    "end": "173760"
  },
  {
    "text": "free accounts they're pretty strict and pretty limiting i ran into this running getting",
    "start": "173760",
    "end": "180800"
  },
  {
    "text": "ready for this application or for this demo because these images uh are originally are in DockerHub but in production you may end up getting hit",
    "start": "180800",
    "end": "187599"
  },
  {
    "text": "with a rate limit when you're trying to do a scale operation or spin up a new application and that's just kind of painful you can also lose access to",
    "start": "187599",
    "end": "194959"
  },
  {
    "text": "these things when registries go away who had to migrate to registry.k.io for",
    "start": "194959",
    "end": "200239"
  },
  {
    "text": "their Kubernetes use few hands that was pretty disruptive",
    "start": "200239",
    "end": "205519"
  },
  {
    "text": "too a lot of people had dependency on the on the GCR instance that we used upstream when those go away you lose",
    "start": "205519",
    "end": "210879"
  },
  {
    "text": "control of that as well then there's the everpresent problem of vulnerabilities in containers",
    "start": "210879",
    "end": "216640"
  },
  {
    "text": "who has spent some time in the last year remediating vulnerabilities in a container again like almost all the",
    "start": "216640",
    "end": "221920"
  },
  {
    "text": "hands super fun if you have regulatory concerns you're probably fighting this day by day by day and if you're pulling",
    "start": "221920",
    "end": "228159"
  },
  {
    "text": "all your images from a thirdparty registry or you know maybe for just your dependencies you're still going to be stuck with that situation where you're",
    "start": "228159",
    "end": "234480"
  },
  {
    "text": "going to be dependent really on that upstream project or that vendor to fix those things for you if you're running",
    "start": "234480",
    "end": "240400"
  },
  {
    "text": "in your own registry there are some things that you can do and we'll take a look at that in this case we're looking at one of the images from the emoji uh",
    "start": "240400",
    "end": "246959"
  },
  {
    "text": "voting app it's got 394 high 61 critical vulnerabilities",
    "start": "246959",
    "end": "252400"
  },
  {
    "text": "probably shouldn't run this in production if I did this at Microsoft I'd get a lot of S360 alerts and then a third category and",
    "start": "252400",
    "end": "259600"
  },
  {
    "text": "there are a lot more but a third category is that sometimes uh maybe a registry's credentials get compromised",
    "start": "259600",
    "end": "265520"
  },
  {
    "text": "and somebody's able to push a uh compromised version of Kong that has um",
    "start": "265520",
    "end": "271520"
  },
  {
    "text": "some maybe nefarious things baked inside of it if you're depending on these third-party registries and you're pulling things without the ability to",
    "start": "271520",
    "end": "278080"
  },
  {
    "text": "really validate who's doing it so in our buoyant or our vote voting example was buoyant who actually pushed that image",
    "start": "278080",
    "end": "284960"
  },
  {
    "text": "you can potentially get things like crypto miners or other bad things running in your production workloads and",
    "start": "284960",
    "end": "290720"
  },
  {
    "text": "this is also true of your deployment manifests and other resources that you're going to use to deploy your application somebody could make a change",
    "start": "290720",
    "end": "297440"
  },
  {
    "text": "in uh say a Helm chart that you're deploying and suddenly you've got some bad defaults changed or there's a sec a",
    "start": "297440",
    "end": "304000"
  },
  {
    "text": "configuration change that now exposes a security vulnerability to you so we've moved on from that carefree world to now",
    "start": "304000",
    "end": "310320"
  },
  {
    "text": "we're all really aware of this and I at least as a person trying to",
    "start": "310320",
    "end": "315440"
  },
  {
    "text": "deploy the voting app um I'm a little frustrated it's not a happy experience in the container land it's full of sharp",
    "start": "315440",
    "end": "321320"
  },
  {
    "text": "edges there's danger around every corner it's kind of an angry experience it's definitely not carefree and it's",
    "start": "321320",
    "end": "327199"
  },
  {
    "text": "probably going to cost me a lot of money and time to fix this and to keep it healthy over time so what can we do we can sit there",
    "start": "327199",
    "end": "335280"
  },
  {
    "text": "and be frustrated um and not know what to do or we can start to apply some some",
    "start": "335280",
    "end": "341199"
  },
  {
    "text": "well-known practices to our container secure supply chain and start to take control of that and if we put those",
    "start": "341199",
    "end": "347360"
  },
  {
    "text": "practices in place centrally for all of our teams then we're going to get some shared efficiencies for that and be able",
    "start": "347360",
    "end": "352880"
  },
  {
    "text": "to make um everybody kind of fall into that golden path and hopefully for new projects we'll get them off on the right",
    "start": "352880",
    "end": "358280"
  },
  {
    "text": "start some of these again are loosely defined or inspired by things that we're doing at Microsoft some of them come",
    "start": "358280",
    "end": "364400"
  },
  {
    "text": "from other projects in the ecosystem some of them are from uh just blog posts",
    "start": "364400",
    "end": "369520"
  },
  {
    "text": "and and other things we've seen um and there are a ton of practices you can follow um the tech security has a a",
    "start": "369520",
    "end": "375919"
  },
  {
    "text": "white paper around um software supply chain security that's really good to read a lot of good ideas inside of that",
    "start": "375919",
    "end": "381039"
  },
  {
    "text": "um and there's a few sessions throughout the week if you go to sketch you'll be able to find some cool things uh around",
    "start": "381039",
    "end": "386240"
  },
  {
    "text": "this topic right before this there was something talking about uh applying some of these to AI models in registries kind",
    "start": "386240",
    "end": "391360"
  },
  {
    "text": "of cool so we talk about container supply chain security but what we're really",
    "start": "391360",
    "end": "397440"
  },
  {
    "text": "talking about now is supply chain security for our OCI artifacts uh because essentially anything can live in",
    "start": "397440",
    "end": "404000"
  },
  {
    "text": "a registry now who has pushed something other than a container to a registry pretty decent size that's uh",
    "start": "404000",
    "end": "410720"
  },
  {
    "text": "that's a lot um the OCI spec was evolved uh over the last couple years to provide",
    "start": "410720",
    "end": "416560"
  },
  {
    "text": "guidance on how to store non-container uh images non-container artifacts in registries it's really cool because you",
    "start": "416560",
    "end": "423280"
  },
  {
    "text": "get the same kind of distribution mechanism that you get for container images you get the same kind of immutable references as you get to",
    "start": "423280",
    "end": "428400"
  },
  {
    "text": "container images and you can apply some of the same tooling to that you also get side effects like everything's condensed",
    "start": "428400",
    "end": "433840"
  },
  {
    "text": "into one place i can take advantage of a central authentication and authorization scheme for those things and deal with",
    "start": "433840",
    "end": "439840"
  },
  {
    "text": "everything kind of in the same way these could be things like Helm charts they could be flux configurations they could",
    "start": "439840",
    "end": "445199"
  },
  {
    "text": "be sbombs they could be vulnerability reports practically anything can get pushed to a registry there's a number of",
    "start": "445199",
    "end": "450479"
  },
  {
    "text": "tools that can do this if it's an OCI uh compatible registry or us is one that we're going to take a look look at",
    "start": "450479",
    "end": "457000"
  },
  {
    "text": "today so what are a couple of things we can do here so first we can mirror all",
    "start": "457000",
    "end": "462319"
  },
  {
    "text": "of our images to an internal registry all those external dependencies we're going to put them into an internal registry and then we're going to sign",
    "start": "462319",
    "end": "468160"
  },
  {
    "text": "them so we know that we put them there and we intended for them to get there and as part of that process we could scan them we could look for malware do a",
    "start": "468160",
    "end": "474479"
  },
  {
    "text": "lot of other things potentially patch them as well with the project like Copa and then make sure that those are",
    "start": "474479",
    "end": "480639"
  },
  {
    "text": "available in our registry then in our clusters we can enforce that images only come from that registry to lock things",
    "start": "480639",
    "end": "486720"
  },
  {
    "text": "down even more to ensure that we're not going to have any problems um from third party stuff then we can start to verify",
    "start": "486720",
    "end": "493360"
  },
  {
    "text": "our containers on deployment and we can start to verify our deployment manifests on deployment we're also going to stick",
    "start": "493360",
    "end": "499520"
  },
  {
    "text": "our our manifest and stuff in that registry as well so what do we mean by verification well by verification I'm",
    "start": "499520",
    "end": "505120"
  },
  {
    "text": "talking about uh the chain of custody for that so going back to voting uh the election in my town uh it was yesterday",
    "start": "505120",
    "end": "512719"
  },
  {
    "text": "Colorado where I'm from has 100% male voting it's pretty cool so you think there's probably going to be like you",
    "start": "512719",
    "end": "518479"
  },
  {
    "text": "know fraud or questions about the authenticity of ballots what starts with a signature uh just like we want to",
    "start": "518479",
    "end": "524480"
  },
  {
    "text": "think about for containers once you sign that that um you're making a self attestation that I produce this image",
    "start": "524480",
    "end": "530560"
  },
  {
    "text": "and I am delivering it to the registry or the Dropbox where I'm going to put it",
    "start": "530560",
    "end": "535760"
  },
  {
    "text": "then as somebody picks it up and moves it along the stage you get additional signatures kind of co-signing that along",
    "start": "535760",
    "end": "540800"
  },
  {
    "text": "the way then when it's finally time to validate it goes through a manual and an",
    "start": "540800",
    "end": "545839"
  },
  {
    "text": "automated process where your signature is compared to that of another certificate uh something like your",
    "start": "545839",
    "end": "551120"
  },
  {
    "text": "driver's license your voting record other things the state has on file and when your signature does not match it is",
    "start": "551120",
    "end": "557200"
  },
  {
    "text": "rejected uh there's a a process for you to fix it but it's it's not counted right away right it's rejected from",
    "start": "557200",
    "end": "563040"
  },
  {
    "text": "admission into that voting system so containers are the same thing",
    "start": "563040",
    "end": "568640"
  },
  {
    "text": "how do we verify containers there's a number of tools that are in the ecosystem um there's an old version of",
    "start": "568640",
    "end": "573680"
  },
  {
    "text": "notary we have a new thing called notation uh cosign exists in the space um there's other things that are in the",
    "start": "573680",
    "end": "579680"
  },
  {
    "text": "ecosystem but they essentially work the same way right we are going to sign that we have produced this image generate a",
    "start": "579680",
    "end": "586160"
  },
  {
    "text": "signature object that goes along with that that's going to sign some of the metadata for the container and produce another artifact that we can store in",
    "start": "586160",
    "end": "592959"
  },
  {
    "text": "the registry alongside of it it's discoverable in a known place and then we can use tooling like verno or um",
    "start": "592959",
    "end": "600080"
  },
  {
    "text": "gatekeeper to verify that that thing was signed how we expect it so here we are we're going to run um an image here test",
    "start": "600080",
    "end": "606399"
  },
  {
    "text": "verify image that it was signed by somebody else our policy is configured to to reject that and we can see there's",
    "start": "606399",
    "end": "611760"
  },
  {
    "text": "an error message so it was prevented from coming into the cluster but we can do that for anything that is in a",
    "start": "611760",
    "end": "617360"
  },
  {
    "text": "registry right so here we go uh use the oras tool um I pushed an image uh it's",
    "start": "617360",
    "end": "622959"
  },
  {
    "text": "an image image to dockerhub um called lepernetes if you ran this command right now you would get a picture of my cat",
    "start": "622959",
    "end": "629440"
  },
  {
    "text": "who was the 120 kubernetes release mascot and then using something like notation you can verify that signature",
    "start": "629440",
    "end": "636560"
  },
  {
    "text": "so notation verify um it'll verify against a trust policy and I'll show you that in a little bit okay so at a high",
    "start": "636560",
    "end": "643920"
  },
  {
    "text": "level what we want to do is take our images from DockerHub or GCHR put them",
    "start": "643920",
    "end": "649440"
  },
  {
    "text": "into an internal registry then we want to make sure that Kubernetes only pulls from that registry then we want to",
    "start": "649440",
    "end": "654720"
  },
  {
    "text": "publish our app config to the same registry and then when we deploy that application we want to verify the",
    "start": "654720",
    "end": "660240"
  },
  {
    "text": "signature verify the deployment and hopefully everything is happy there's a lot of stuff in the in commercial",
    "start": "660240",
    "end": "666640"
  },
  {
    "text": "opportunities for this a lot of um products a lot of open source things but I was curious could we do this and maybe",
    "start": "666640",
    "end": "672000"
  },
  {
    "text": "patch them could we do all of this from just the CNCF ecosystem from the the",
    "start": "672000",
    "end": "677279"
  },
  {
    "text": "landscape and it turns out yes there are projects that cover all of these things um across just the CNCF and I'm going to",
    "start": "677279",
    "end": "684160"
  },
  {
    "text": "use the stack of them now we're going to do a demo i'm going to switch over to that right after this but the projects",
    "start": "684160",
    "end": "689600"
  },
  {
    "text": "we're going to use uh for a registry we're going to use a project called Zot another option here might be Harbor um",
    "start": "689600",
    "end": "695279"
  },
  {
    "text": "we're going to use Flux to do deployments because I know that I'm going to use notation as the signing",
    "start": "695279",
    "end": "700720"
  },
  {
    "text": "piece because that's the one that's in the CNCF and Flux has really great support for notation and it's got",
    "start": "700720",
    "end": "705760"
  },
  {
    "text": "support for OCI based artifacts i'm going to try to patch the image when I'm retagging it uh with Copa i'm going to",
    "start": "705760",
    "end": "712640"
  },
  {
    "text": "use ORAS as a register client to move things around and then I'm going to enforce things inside of the cluster using Kyverno so all CNCF projects uh",
    "start": "712640",
    "end": "720640"
  },
  {
    "text": "all these things we should be able to make play together okay we're going to do a demo now um I have a QR code here",
    "start": "720640",
    "end": "726320"
  },
  {
    "text": "if anybody wants the repo you can scan it and I'll get leave it up for a second and then we will uh we'll jump over and",
    "start": "726320",
    "end": "731680"
  },
  {
    "text": "start to take a look at a couple things so I'm I'm causing trouble for the AV people so give me just a",
    "start": "731680",
    "end": "739560"
  },
  {
    "text": "second [Music]",
    "start": "739560",
    "end": "743880"
  },
  {
    "text": "here good to go okay so I'm going to bounce over to a VS Code window and I'm",
    "start": "744680",
    "end": "751040"
  },
  {
    "text": "going to make this a little bit bigger we're going to start by looking at what a trust policy is so a trust policy is a",
    "start": "751040",
    "end": "756160"
  },
  {
    "text": "thing for notation and it's really going to say um what trust store do I want to use and this can be this is where my",
    "start": "756160",
    "end": "762399"
  },
  {
    "text": "certificates are going to get stored and what identities from that trust store i could do multiple identities here and",
    "start": "762399",
    "end": "767839"
  },
  {
    "text": "really limit it down um in this case it's going to be a certificate that I generated that's an Azure key vault uh",
    "start": "767839",
    "end": "773120"
  },
  {
    "text": "for my domain jereard.com um and all the stuff that goes along with that i can",
    "start": "773120",
    "end": "778720"
  },
  {
    "text": "also limit this down to certain scopes inside of the registry so these could be individual registry or repos like uh",
    "start": "778720",
    "end": "784320"
  },
  {
    "text": "cube proxy or I could wild card it like this probably less secure to do this but easier to see on the screen okay so what",
    "start": "784320",
    "end": "790880"
  },
  {
    "text": "we're going to do next is run a GitHub action and I already started",
    "start": "790880",
    "end": "797120"
  },
  {
    "text": "here we are going to retag some",
    "start": "797240",
    "end": "801680"
  },
  {
    "text": "images run it again while we are waiting oh it's the wrong repo that's",
    "start": "808279",
    "end": "815120"
  },
  {
    "text": "why here we go this is the right one sorry about",
    "start": "818040",
    "end": "823040"
  },
  {
    "text": "that okay we're going to run this this um and retry tag stuff so what this is",
    "start": "823240",
    "end": "828399"
  },
  {
    "text": "going to do um I'm going to run it and we can see it is uh I have a list of all of the images that I'm going to use for",
    "start": "828399",
    "end": "834800"
  },
  {
    "text": "this demo and all of these images exist in DockerHub or they exist in GCHR so",
    "start": "834800",
    "end": "840240"
  },
  {
    "text": "while that's running um what I did was some some homework ahead of time and I found all the images that we need to use",
    "start": "840240",
    "end": "846560"
  },
  {
    "text": "for all the components we're going to deploy here including Flux and including Kybero i made a little YAML file and",
    "start": "846560",
    "end": "852399"
  },
  {
    "text": "wrote a really small Go program to spit out a GitHub uh matrix but really what",
    "start": "852399",
    "end": "858399"
  },
  {
    "text": "I'm going to do is use ORAS to copy everything so I made a a GitHub action take a look at that and this GitHub",
    "start": "858399",
    "end": "865399"
  },
  {
    "text": "action is going to run my little retag command that's going to spit out a matrix right so one of the cool things",
    "start": "865399",
    "end": "870560"
  },
  {
    "text": "you can do in in GitHub actions is generate a matrix of all the things you want to run and run run all these jobs",
    "start": "870560",
    "end": "876000"
  },
  {
    "text": "kind of simultaneously so I am going to start by running that and then I'm going",
    "start": "876000",
    "end": "881600"
  },
  {
    "text": "to install ORAS so there's the GitHub action for installing ORAS pretty cool um I'm going to log into my Docker",
    "start": "881600",
    "end": "887600"
  },
  {
    "text": "registry there's a GitHub action for that this is super easy because almost all of this I just used GitHub actions",
    "start": "887600",
    "end": "892639"
  },
  {
    "text": "that existed already um once I have everything set up I'm going to use the ORAS command to run a",
    "start": "892639",
    "end": "899360"
  },
  {
    "text": "copy so get that out of the way um what we've got here is oras copy uh from the",
    "start": "899360",
    "end": "904800"
  },
  {
    "text": "source to the destination essentially that's going to run for all of the images that are in there and then I'm",
    "start": "904800",
    "end": "910560"
  },
  {
    "text": "going to log into Azure because my stuff is in Azure i'm going to install Notary and I'm going to use the AKV plugin for",
    "start": "910560",
    "end": "917920"
  },
  {
    "text": "notation and run notation sign so we can see we're going to run notation sign we're going to tell it what to sign",
    "start": "917920",
    "end": "923839"
  },
  {
    "text": "we're going to sign registry destination matrix the key IDs and all that good stuff then I'm going to scan it because",
    "start": "923839",
    "end": "930160"
  },
  {
    "text": "I want to know if it has any vulnerabilities so I'm going to use an action from Trivy to or from Aqua to run Trivy then I'm going to check and see if",
    "start": "930160",
    "end": "937519"
  },
  {
    "text": "it has vulnerabilities and if it does I'm going to run Copa which is another CNCF project that does container",
    "start": "937519",
    "end": "942560"
  },
  {
    "text": "patching pretty cool it'll take your container it'll scan it uh it'll take a result from from Trivy it'll generate a",
    "start": "942560",
    "end": "948720"
  },
  {
    "text": "patch layer and pass that on for you um and then I'm going to just push it to the registry so this should be running",
    "start": "948720",
    "end": "954120"
  },
  {
    "text": "now it's waiting for me to approve it because I made this",
    "start": "954120",
    "end": "960120"
  },
  {
    "text": "public okay so we're let that run for a second and I will come back to it once it's done so once these images are all",
    "start": "960120",
    "end": "968000"
  },
  {
    "text": "in the registry the next thing we're going to need to do is have a Kubernetes cluster right so I've got one already",
    "start": "968000",
    "end": "973839"
  },
  {
    "text": "didn't want to wait for that we've got a Kubernetes cluster that is an AKS cluster because I wanted to make it",
    "start": "973839",
    "end": "979199"
  },
  {
    "text": "public for everybody so we've got let's see cubectl get",
    "start": "979199",
    "end": "985360"
  },
  {
    "text": "nodes two node pools there we also have our Zot server already running and",
    "start": "985399",
    "end": "991040"
  },
  {
    "text": "that's right here um okay we can see that it's running um",
    "start": "991040",
    "end": "998480"
  },
  {
    "text": "it's also available uh actually it's getting stuff pushed to it already if we go to to Zot here",
    "start": "998480",
    "end": "1006920"
  },
  {
    "text": "browser doesn't have images yet but this GitHub action should be running for",
    "start": "1006920",
    "end": "1013199"
  },
  {
    "text": "us and it's copying things with uh with notation right now so or with oras right now and you can see that it's going to",
    "start": "1015639",
    "end": "1021600"
  },
  {
    "text": "set up the notation CLI it's going to sign everything it's going to generate a T report and do all the things that it needs to do okay so if we refresh that",
    "start": "1021600",
    "end": "1028480"
  },
  {
    "text": "again hopefully we've got images live demo yes so we have uh image reflector",
    "start": "1028480",
    "end": "1035839"
  },
  {
    "text": "controller Kyivero Kyiverno a few other things um and we can see that right now they are not signed because that GitHub",
    "start": "1035839",
    "end": "1043360"
  },
  {
    "text": "action is still running to do the signatures okay so while this is all going we'll come back to it couple other",
    "start": "1043360",
    "end": "1049600"
  },
  {
    "text": "things that are in this repo that are interesting to us first here are a bunch of manifests that",
    "start": "1049600",
    "end": "1056400"
  },
  {
    "text": "we're going to use for our application it's going to take some work to use mirrored images right we're not going to be able to just take an off-the-shelf",
    "start": "1056400",
    "end": "1062240"
  },
  {
    "text": "Helm chart and just run it as is uh if we have YAML files we might need to um to do something to them so we're going",
    "start": "1062240",
    "end": "1068240"
  },
  {
    "text": "to use customize to do almost all of this so we've got um definitions for all of these things here we've got our our",
    "start": "1068240",
    "end": "1073840"
  },
  {
    "text": "voting app we've got Flux we've got some Flux repos that we'll talk about um Kyivero and then some policies we're",
    "start": "1073840",
    "end": "1078880"
  },
  {
    "text": "going to put in place while that's all running the first thing we can do is install Flux right so",
    "start": "1078880",
    "end": "1086880"
  },
  {
    "text": "we'll do that hopefully the Flux images are all across so it looks like they are not all across yet but we'll run it",
    "start": "1086880",
    "end": "1094919"
  },
  {
    "text": "anyway okay so we're going to sure we're in this",
    "start": "1094919",
    "end": "1102000"
  },
  {
    "text": "project all right so again here's the directory um manifest is where everything is so let's do a cubectl",
    "start": "1107559",
    "end": "1114960"
  },
  {
    "text": "apply we're use customize so dash k manifest",
    "start": "1114960",
    "end": "1120120"
  },
  {
    "text": "flux it's the first thing we'll do for this cluster so it's going to create everything and if it hasn't mirrored all",
    "start": "1120120",
    "end": "1127280"
  },
  {
    "text": "the images we should be able to see some errors and that'll be",
    "start": "1127280",
    "end": "1131440"
  },
  {
    "text": "cool okay let's get",
    "start": "1134840",
    "end": "1139880"
  },
  {
    "text": "Okay so um all the older stuff is is running looks like our Flux stuff is coming up right now so that's cool next",
    "start": "1142080",
    "end": "1148799"
  },
  {
    "text": "um how about we install um Kyivero we'll get that out of the way too okay so",
    "start": "1148799",
    "end": "1154000"
  },
  {
    "text": "we're going to use Helm for that just because they have a Helm chart already and I want to show you how to customize with that so we're going to install Helm",
    "start": "1154000",
    "end": "1161520"
  },
  {
    "text": "with Helm okay and you can see here that for this I basically had to overwrite all of",
    "start": "1161520",
    "end": "1168320"
  },
  {
    "text": "the images in the the chart so it's not the easiest thing to do but um it makes you kind of aware of what you're doing",
    "start": "1168320",
    "end": "1174640"
  },
  {
    "text": "okay so we're going to run Helm install Kyverno um set the namespace set the registry all those good",
    "start": "1174640",
    "end": "1181120"
  },
  {
    "text": "things",
    "start": "1181960",
    "end": "1184960"
  },
  {
    "text": "run while we're waiting let's check on our GitHub action looks like they're all done so",
    "start": "1188200",
    "end": "1193840"
  },
  {
    "text": "for each one of these things now we saw that we ran that retag operation we signed everything we we scanned it with",
    "start": "1193840",
    "end": "1200080"
  },
  {
    "text": "trivia to see if there were any any issues and if we go to our registry now and refresh it now we see that it's",
    "start": "1200080",
    "end": "1206880"
  },
  {
    "text": "actually signed that's pretty cool so we could pull these images you could pull them from uh from zot.jerecorder.com and you' see that",
    "start": "1206880",
    "end": "1213360"
  },
  {
    "text": "there are notary signatures associated with each one of those things okay so now we've got Flux",
    "start": "1213360",
    "end": "1218799"
  },
  {
    "text": "installed and we've got Kyiverno installed let's uh let's make sure everything's looking",
    "start": "1218799",
    "end": "1224880"
  },
  {
    "text": "good okay all of our pods are now running okay so we've got Flux installed",
    "start": "1225559",
    "end": "1231440"
  },
  {
    "text": "we've got Kyiverno installed um what we really need to do now is handle the policies right so let's look take a look",
    "start": "1231440",
    "end": "1238240"
  },
  {
    "text": "at um what we've got under policies so we've got two Kyerno policies we could have done this first and enforced it for",
    "start": "1238240",
    "end": "1244640"
  },
  {
    "text": "Flux as well but we have two policies we want to install the first is that we want to restrict images this is a really",
    "start": "1244640",
    "end": "1250480"
  },
  {
    "text": "basic thing you could use this um anywhere uh and all it's really going to do is ensure that everything is coming",
    "start": "1250480",
    "end": "1256159"
  },
  {
    "text": "from zot.jeremyreicker.com um and you will get an error if you don't the second one",
    "start": "1256159",
    "end": "1261280"
  },
  {
    "text": "though is the more interesting one for this use case because we are going to use uh the built-in verifier for",
    "start": "1261280",
    "end": "1266880"
  },
  {
    "text": "notation so here we go again it's a cluster policy for Kyivero we're going to verify signature notary on on",
    "start": "1266880",
    "end": "1273919"
  },
  {
    "text": "resources of of type pod right that's where the containers will be any image reference we want to be signed with this",
    "start": "1273919",
    "end": "1281400"
  },
  {
    "text": "certificate this public yeah so behind the scenes this will generate a trust policy for us and do all the good stuff",
    "start": "1281400",
    "end": "1286960"
  },
  {
    "text": "so we're gonna run that now and apply it apply -f manifest policies let's put",
    "start": "1286960",
    "end": "1292320"
  },
  {
    "text": "them both in place okay cool so now we've got both of",
    "start": "1292320",
    "end": "1297919"
  },
  {
    "text": "those things ready to go the last step that we really have here is to use Flux to install our application right we have",
    "start": "1297919",
    "end": "1304400"
  },
  {
    "text": "a pipeline for that too so let's go take a look at that GitHub action so again we said we wanted everything to",
    "start": "1304400",
    "end": "1309520"
  },
  {
    "text": "be inside of the registry right so we're going to do the publish flux config",
    "start": "1309520",
    "end": "1315519"
  },
  {
    "text": "now let's take a look at what that pipeline looks like or sorry that GitHub action looks like it's pretty",
    "start": "1315559",
    "end": "1323280"
  },
  {
    "text": "simple it is going to log into the registry because it needs a push it's going to install the flux CLI because it",
    "start": "1323720",
    "end": "1329840"
  },
  {
    "text": "needs flux it's going to install notation because we're going to sign it and then uh it's going to call flux push",
    "start": "1329840",
    "end": "1335200"
  },
  {
    "text": "artifact and you can see the arguments that are going to get passed to it so flesh push artifact all those good things and then we're going to sign it",
    "start": "1335200",
    "end": "1341120"
  },
  {
    "text": "and this is exactly the same configuration with just a different um target artifact so is it running is it running",
    "start": "1341120",
    "end": "1348240"
  },
  {
    "text": "we have to approve it right yep so let's prove that view",
    "start": "1348240",
    "end": "1355039"
  },
  {
    "text": "deployments okay so this will put it into the container registry or the oh sorry the OCI registry it's not actually",
    "start": "1357000",
    "end": "1362960"
  },
  {
    "text": "deploying it to Flux what we're going to need to do to Flux is give it another configuration that says to install that",
    "start": "1362960",
    "end": "1368559"
  },
  {
    "text": "resource if you've ever used Flux this is exactly the same way as specifying that you're going to use a GitHub repository instead of the OCI registry",
    "start": "1368559",
    "end": "1376000"
  },
  {
    "text": "um the big difference is that it's going to pull it from that source instead and again that's a cool kind of side benefit",
    "start": "1376000",
    "end": "1382159"
  },
  {
    "text": "because you no longer have two paths that you have to control access to right maybe you want to lock your clusters",
    "start": "1382159",
    "end": "1387200"
  },
  {
    "text": "down putting them all in one registry might be a good way to do that so let's take a look at what happened here we",
    "start": "1387200",
    "end": "1393200"
  },
  {
    "text": "push this flux configuration it's called CubeCon manifests so if we go to Zot I wonder if we can find",
    "start": "1393200",
    "end": "1400400"
  },
  {
    "text": "that yeah CubeCon manifest emoji voting and we can see that it's signed right that's pretty pretty cool you would see",
    "start": "1401640",
    "end": "1407760"
  },
  {
    "text": "this with cosign or the other things as well so we've got that installed now so",
    "start": "1407760",
    "end": "1412880"
  },
  {
    "text": "our last real thing to do is to cubectl apply-k",
    "start": "1412880",
    "end": "1419320"
  },
  {
    "text": "manifests emoji voting",
    "start": "1419320",
    "end": "1423799"
  },
  {
    "text": "oh actually that's the wrong thing to do let's delete",
    "start": "1428000",
    "end": "1432158"
  },
  {
    "text": "that sorry okay so it's deleting that so what",
    "start": "1441240",
    "end": "1446400"
  },
  {
    "text": "we really need to do is we need to use Flux to do that",
    "start": "1446400",
    "end": "1453039"
  },
  {
    "text": "so in manifests let's take a look and see what we've got uh we have flux repos right so let's go to flux",
    "start": "1453200",
    "end": "1460200"
  },
  {
    "text": "repos and we've got two things in here uh we have emoji vote and we've got something called notation config but",
    "start": "1460200",
    "end": "1466000"
  },
  {
    "text": "let's ignore that for a second and let's just apply this",
    "start": "1466000",
    "end": "1470400"
  },
  {
    "text": "one okay so we are going to create two flux configurations right so we've got a",
    "start": "1472679",
    "end": "1478640"
  },
  {
    "text": "OCI repository source and a customization for Flux the two resources are going to help us define our",
    "start": "1478640",
    "end": "1484440"
  },
  {
    "text": "application let's take a look at them in VS Code because it's a little easier to read and here we've got this so we can",
    "start": "1484440",
    "end": "1492720"
  },
  {
    "text": "see in this um we've defined an OCI repository uh type right the spec for",
    "start": "1492720",
    "end": "1498559"
  },
  {
    "text": "this is going to reference that object or that resource that we pushed to the OCI registry which is going to be our",
    "start": "1498559",
    "end": "1504480"
  },
  {
    "text": "collection of manifests and then we define a customization that uses that as a",
    "start": "1504480",
    "end": "1509559"
  },
  {
    "text": "source the interesting thing here though is that there's a verifier so we're going to verify that thing with notation",
    "start": "1509559",
    "end": "1517679"
  },
  {
    "text": "with the notation config secret guess what I didn't create in the cluster that secret so if we get",
    "start": "1517679",
    "end": "1528080"
  },
  {
    "text": "pods I don't see anything running for our voting app that's kind of a bummer i wonder why well let's take a look at the",
    "start": "1533799",
    "end": "1539440"
  },
  {
    "text": "source controller for Flux and see if there's any logs",
    "start": "1539440",
    "end": "1544278"
  },
  {
    "text": "it failed to verify the signature using the provider notation mostly because the the secret wasn't there but that's the",
    "start": "1550960",
    "end": "1556320"
  },
  {
    "text": "easiest thing to do for the demo so if I create that",
    "start": "1556320",
    "end": "1561039"
  },
  {
    "text": "secret we are going to now have that secret present so as reconciliation starts to happen",
    "start": "1564120",
    "end": "1571120"
  },
  {
    "text": "here there it goes it's applying that thing it was able to verify the signature because we said that it had to",
    "start": "1572200",
    "end": "1577440"
  },
  {
    "text": "be verifiable and now it is ready to go okay so moment of",
    "start": "1577440",
    "end": "1586960"
  },
  {
    "text": "truth i see all the emoji voting apps cool",
    "start": "1590679",
    "end": "1597000"
  },
  {
    "text": "and there is our service looks like the IP address is",
    "start": "1602960",
    "end": "1609840"
  },
  {
    "text": "172.206.153.116 let's see if we can pull that up in the",
    "start": "1612760",
    "end": "1617039"
  },
  {
    "text": "browser all right it's there let's view the leaderboard",
    "start": "1623400",
    "end": "1629559"
  },
  {
    "text": "oh I don't think it's working all the way that's a bummer but it's deployed it's running so we've got we've got our",
    "start": "1630640",
    "end": "1637120"
  },
  {
    "text": "cool app from 2017 now deployed with some kind of modern supply chain",
    "start": "1637120",
    "end": "1642320"
  },
  {
    "text": "security best practices let's uh that's kind of fun um let's let's look one more",
    "start": "1642320",
    "end": "1648000"
  },
  {
    "text": "time just just kind of refresh our mind so we were able to push u an OCI",
    "start": "1648000",
    "end": "1655039"
  },
  {
    "text": "packaged set of manifests to a repo or registry that's running as it's a CNCF",
    "start": "1655039",
    "end": "1661440"
  },
  {
    "text": "project called Zot we were able to verify that thing using a CNCF project called notation we're doing all this",
    "start": "1661440",
    "end": "1667840"
  },
  {
    "text": "deployment with a tool called Flux which is a CNCF project we were able to restrict images here from a CNCF project",
    "start": "1667840",
    "end": "1676320"
  },
  {
    "text": "called Kyivero and if we go to um look at those cluster policies I bet we can see what it's telling",
    "start": "1676320",
    "end": "1683520"
  },
  {
    "text": "us yep see let's let's get one and see what it",
    "start": "1684840",
    "end": "1690720"
  },
  {
    "text": "says okay so um there's the certificate that's",
    "start": "1700760",
    "end": "1706640"
  },
  {
    "text": "included just like we saw in the log looks like a normal normal document",
    "start": "1706640",
    "end": "1714799"
  },
  {
    "text": "normal object let's see if",
    "start": "1714799",
    "end": "1718480"
  },
  {
    "text": "um",
    "start": "1730440",
    "end": "1733440"
  },
  {
    "text": "Here we go um so there's some policy violations oh I put this in warn mode because I didn't actually want to copy",
    "start": "1748520",
    "end": "1755039"
  },
  {
    "text": "all of the cluster images because some of them are coming from AKS but we can see there are some things there uh like",
    "start": "1755039",
    "end": "1761520"
  },
  {
    "text": "Kubernetes metric server that was built by my team it's not signed with notation oh it's not signed with this uh this",
    "start": "1761520",
    "end": "1767520"
  },
  {
    "text": "trusted signature it it does have a signature it just did not get signed by the signature we're looking for cool",
    "start": "1767520",
    "end": "1774559"
  },
  {
    "text": "thing with this is that your trust policies allow you to define exactly the level of trust so I could go back and I",
    "start": "1774559",
    "end": "1780720"
  },
  {
    "text": "could add this public to my trust policy and I could allow these registries and clean this all up maybe allow for things",
    "start": "1780720",
    "end": "1786320"
  },
  {
    "text": "to come from another registry as well but don't really need to do that all right well that is the end so let me",
    "start": "1786320",
    "end": "1793120"
  },
  {
    "text": "bounce back to PowerPoint here i'll give you the feedback thing so you can take that i would love to have any feedback",
    "start": "1793120",
    "end": "1799760"
  },
  {
    "text": "that you might have and I will hang out to the side if anybody wants to chat about anything after",
    "start": "1799760",
    "end": "1807600"
  },
  {
    "text": "this okay back to the",
    "start": "1810039",
    "end": "1815720"
  },
  {
    "text": "Oh a couple of things real quick um these are three talks that I thought were really interesting uh they're two are tomorrow and one is on Friday u go",
    "start": "1818159",
    "end": "1825279"
  },
  {
    "text": "check out the project booths as well i think there's some really interesting stuff there and there's the QR code for feedback thanks again for coming all the",
    "start": "1825279",
    "end": "1831360"
  },
  {
    "text": "way over here it was really cool to see so many people in here thanks",
    "start": "1831360",
    "end": "1836520"
  }
]