[
  {
    "text": "hello everyone my name is Kate thank you for coming today I'm gonna be talking about audit logging and kubernetes",
    "start": "30",
    "end": "6379"
  },
  {
    "text": "specifically the goal of this talk is to talk about what audit logging actually is go over a couple of the challenges",
    "start": "6379",
    "end": "12420"
  },
  {
    "text": "with it and then talk about how we can address those challenges before I get into it quickly introduce myself my name",
    "start": "12420",
    "end": "18930"
  },
  {
    "text": "is Kate Cochin I am a software engineer and help to you although as you may have heard literally a few minutes ago hep",
    "start": "18930",
    "end": "25590"
  },
  {
    "text": "geo has ceased to exist so as of 1 p.m. I am officially a senior member of the",
    "start": "25590",
    "end": "30990"
  },
  {
    "text": "technical staff at VMware I'm super excited to keep working on a lot of the problems we've been trying to solve a",
    "start": "30990",
    "end": "36690"
  },
  {
    "text": "hefty at VMware and George up there he's excited about everything so he's amped to add hep to yo and now",
    "start": "36690",
    "end": "44910"
  },
  {
    "text": "VMware I work with a great group of humans a lot of them were here right now and we're focused on building products",
    "start": "44910",
    "end": "50399"
  },
  {
    "text": "that make kubernetes easier to adopt easier to use easier to bug easier to just generally derive value from for",
    "start": "50399",
    "end": "57270"
  },
  {
    "text": "both cluster operators and app developers my team consists of some lovely back-end focused engineers those",
    "start": "57270",
    "end": "64470"
  },
  {
    "text": "of us focused on the front end a manager Eric he's great and of course my dog",
    "start": "64470",
    "end": "69600"
  },
  {
    "text": "Helen she's the MVP of the team so what does this group of humans been working",
    "start": "69600",
    "end": "74909"
  },
  {
    "text": "on the lot of us and working on a project that's designed to empower",
    "start": "74909",
    "end": "80280"
  },
  {
    "text": "cluster operators to more easily manage their multi cluster multi-cloud fleets the motivation here is that we as we",
    "start": "80280",
    "end": "86880"
  },
  {
    "text": "start seeing more and more workloads migrated onto kubernetes in the public cloud fleet the clusters are becoming",
    "start": "86880",
    "end": "92159"
  },
  {
    "text": "more fragmented so some people in your company might be running on Prem some might be using ATS some might be using",
    "start": "92159",
    "end": "98189"
  },
  {
    "text": "GAE or Azure because they want to use cosmos and data bricks and cluster operators need a way to manage all of",
    "start": "98189",
    "end": "104189"
  },
  {
    "text": "these at once audit logging is this super powerful tool that grants operators more insight into their",
    "start": "104189",
    "end": "109829"
  },
  {
    "text": "clusters they can tell us what happened in our clusters who did it when it happened and what resources were",
    "start": "109829",
    "end": "116460"
  },
  {
    "text": "affected the problem is that it's kind of hard to set up an even one fairly stagnant cluster generates literally",
    "start": "116460",
    "end": "122759"
  },
  {
    "text": "millions of audit logs each week so if you're running multiple clusters across multiple clouds you know it's certainly",
    "start": "122759",
    "end": "128670"
  },
  {
    "text": "not unheard of for companies to have hundreds or even thousands of clusters suddenly in each of these is spitting",
    "start": "128670",
    "end": "134340"
  },
  {
    "text": "out a million audit logs a day it's gonna be pretty difficult to isolate logs that actually matter so that's what",
    "start": "134340",
    "end": "140849"
  },
  {
    "text": "we're trying to help operators and app developers do so those are some of the things where my team at happy has been working on just working solve and we'll",
    "start": "140849",
    "end": "146939"
  },
  {
    "text": "continue to be working on the VMware I'll do a little demo of what we've been working on at the end of this talk I",
    "start": "146939",
    "end": "152280"
  },
  {
    "text": "don't think you want to watch me like use a website for very long so it's gonna be quick but if you're interested in seeing more head over there after you",
    "start": "152280",
    "end": "159030"
  },
  {
    "text": "booth we've got these very fancy iPads I'm happy to go more in-depth all right I'm a firm believer that you should",
    "start": "159030",
    "end": "165209"
  },
  {
    "text": "never attend or schedule a meeting without an agenda the same goes for this talk so briefly here's what I'll be talking about first we'll be going over",
    "start": "165209",
    "end": "172139"
  },
  {
    "text": "what kubernetes audit logging actually is we'll talk about what six questions",
    "start": "172139",
    "end": "177419"
  },
  {
    "text": "and answers will talk about Auto stages and we'll talk about audit levels then we'll talk about configuring on it and",
    "start": "177419",
    "end": "182939"
  },
  {
    "text": "some of the pain points there as well as a new feature in 113 alpha dynamic audit configuration which alleviates some of",
    "start": "182939",
    "end": "188969"
  },
  {
    "text": "these pain points we'll talk about it's something my buddy and teammate Pat has been working on upstream for a few months and it's pretty cool I'll do a",
    "start": "188969",
    "end": "195719"
  },
  {
    "text": "quick little demo just to show how easy it is to get dynamic on it set up and from here we'll talk about making sense",
    "start": "195719",
    "end": "202229"
  },
  {
    "text": "of the data like I mentioned earlier every cluster generates like a lot a lot a lot of data and extracting meaning for",
    "start": "202229",
    "end": "208889"
  },
  {
    "text": "millions of logs can be pretty tricky finally we'll move on to a technical preview of this thing that we've been",
    "start": "208889",
    "end": "214500"
  },
  {
    "text": "working on chat a little bit about the kinds of problems we have to solve with it and then if I've left enough time I will answer questions if there are any",
    "start": "214500",
    "end": "221189"
  },
  {
    "text": "and if you're nice to me all right next up let's get started so what does",
    "start": "221189",
    "end": "227239"
  },
  {
    "text": "kubernetes audit logging I'm just gonna say Auto logging from now on because that's a mouthful and why should you care",
    "start": "227239",
    "end": "233090"
  },
  {
    "text": "simply put audit logs report all the requests made to the kubernetes api server by admins",
    "start": "233090",
    "end": "239009"
  },
  {
    "text": "users and components of the system itself that means anytime you apply some llamó to a cube cuddle get a cube cuddle",
    "start": "239009",
    "end": "245609"
  },
  {
    "text": "watch you're gonna get some audit logs but it also means that every time the system does everything which is spoiler",
    "start": "245609",
    "end": "251579"
  },
  {
    "text": "literally all the time you're also going to get audit logs what we're left with",
    "start": "251579",
    "end": "256650"
  },
  {
    "text": "is a chronological set of records that document pretty much every activity that's affected the system so why should",
    "start": "256650",
    "end": "262079"
  },
  {
    "text": "you care like what good is this audit logs can be or number things I liked about them",
    "start": "262079",
    "end": "267990"
  },
  {
    "text": "generally into three categories compliance anomaly detection and event attribution a kind of classic use of",
    "start": "267990",
    "end": "274380"
  },
  {
    "text": "Auto logging not just for kubernetes but for all systems is compliance so if you are a financial institution you need to",
    "start": "274380",
    "end": "280350"
  },
  {
    "text": "be compliant with certain regulations and you can send your auto logs off to some external auditor will make sure you're not doing anything sketchy I'm",
    "start": "280350",
    "end": "286800"
  },
  {
    "text": "not going to talk too much about this also because audit logs record every",
    "start": "286800",
    "end": "291900"
  },
  {
    "text": "request to the kubernetes api server we get a trail of who acts on what when by watching this state a kind of like",
    "start": "291900",
    "end": "298140"
  },
  {
    "text": "normality can be understood right so we have a baseline and we can potentially detect what anomalies exist so if you're",
    "start": "298140",
    "end": "304560"
  },
  {
    "text": "used to seeing a certain number of a certain kind of events and that number ticks up that could be an issue or perhaps you want a geo map all of the",
    "start": "304560",
    "end": "311580"
  },
  {
    "text": "requests to the API server if you're used to seeing things from Oakland and from Seattle and from Kansas City and",
    "start": "311580",
    "end": "316620"
  },
  {
    "text": "suddenly someone is accessing the cluster from Italy and like no one's on vacation you probably know something is",
    "start": "316620",
    "end": "322470"
  },
  {
    "text": "going on there maybe you're seeing a lot of four or three requests a lot of 403",
    "start": "322470",
    "end": "327870"
  },
  {
    "text": "responses to anonymous requests like that could be an indication that there's bots crawling around looking for vulnerabilities this is a little",
    "start": "327870",
    "end": "335040"
  },
  {
    "text": "trickier than it sounds like we're talking about one or a few suspicious logs amongst tens of thousands generated",
    "start": "335040",
    "end": "340980"
  },
  {
    "text": "per hour so most anomalies are not gonna be immediately apparent and finally the",
    "start": "340980",
    "end": "346560"
  },
  {
    "text": "most basic concept of audit logging is simply saying who did what when this is sort of the core value that audit logs",
    "start": "346560",
    "end": "352680"
  },
  {
    "text": "provide but we could but we can expand on a little further than what you get from just a trail of audit logs we can",
    "start": "352680",
    "end": "358770"
  },
  {
    "text": "display audit logs in a more digestible way we can filter out the system events we could even start doing things like",
    "start": "358770",
    "end": "364530"
  },
  {
    "text": "event tracing where you can follow a chain of cause a chain of causation and audit logs to get to the root cause of",
    "start": "364530",
    "end": "369840"
  },
  {
    "text": "something so if an application goes offline we could investigate audit logs and see that the pod",
    "start": "369840",
    "end": "375660"
  },
  {
    "text": "running the app container was still a divided a system but if we dig a little deeper we can see that someone either",
    "start": "375660",
    "end": "381090"
  },
  {
    "text": "maliciously or accidentally deleted the deployment that was deleting the pod that was controlling the pod so because",
    "start": "381090",
    "end": "387780"
  },
  {
    "text": "we have a record of every single event that happened up until the pod was deleted we can trace the action through",
    "start": "387780",
    "end": "393090"
  },
  {
    "text": "the server and understand exactly what happened who did it when it and and with that data we can hopefully",
    "start": "393090",
    "end": "398169"
  },
  {
    "text": "understand a little bit more about why it happened okay that was sort of a high-level overview",
    "start": "398169",
    "end": "403539"
  },
  {
    "text": "I'm gonna go a little bit deeper into what audit logs actually look like so weak a little deeper understanding about",
    "start": "403539",
    "end": "409300"
  },
  {
    "text": "how we do all of those things with them each audit log should answer six",
    "start": "409300",
    "end": "414639"
  },
  {
    "text": "questions what happened when did it happen who did it from where was it initiated what did it happen on",
    "start": "414639",
    "end": "420669"
  },
  {
    "text": "and where was it observed this is generally what we can expect an audit log to look like I don't expect you to",
    "start": "420669",
    "end": "426699"
  },
  {
    "text": "read it but depending on the level and the stage the request is that this blob",
    "start": "426699",
    "end": "434139"
  },
  {
    "text": "is going to be bigger or smaller but all six of these questions are gonna be answered in every log and we'll talk about stages and levels after we go",
    "start": "434139",
    "end": "440979"
  },
  {
    "text": "through an audit event so let's break down this event so how do we know what happened we have a verb get if you're",
    "start": "440979",
    "end": "447699"
  },
  {
    "text": "used to interacting with kubernetes like you cuddle these are things you know get watch patch create that's usually what",
    "start": "447699",
    "end": "454150"
  },
  {
    "text": "the verb is gonna be when did it happen we got a lot of information about when it happened we had bunch of timestamps",
    "start": "454150",
    "end": "459819"
  },
  {
    "text": "about the current stage it's in when it was created when the request was received and we also know this stage of the audit log who did it again a lot of",
    "start": "459819",
    "end": "468339"
  },
  {
    "text": "insight here we get a user and a username and what groups they're a member of so we can see here that this",
    "start": "468339",
    "end": "474520"
  },
  {
    "text": "is a system user it's a node and it's a member of a couple of groups again we can find out a",
    "start": "474520",
    "end": "481300"
  },
  {
    "text": "little bit more about who did it by knowing where was initiated and this is just an array of source IPS and what did",
    "start": "481300",
    "end": "486909"
  },
  {
    "text": "it happen on so right now we know we're looking at a system note event it's a get it happened like three weeks ago",
    "start": "486909",
    "end": "493300"
  },
  {
    "text": "whenever I made that slide and we now know that it was on a pod so it's a get",
    "start": "493300",
    "end": "499449"
  },
  {
    "text": "of a pod in the default namespace with the name populate er5 whatever and whatever and finally where was it",
    "start": "499449",
    "end": "507219"
  },
  {
    "text": "observed this is the same for every single auto log it's literally always the API server",
    "start": "507219",
    "end": "513399"
  },
  {
    "text": "every single autolog occurs on the API server if you don't interact with the API server you're not gonna get an auto",
    "start": "513399",
    "end": "518779"
  },
  {
    "text": "log so if you are malicious user ssh into a node and create some binary",
    "start": "518779",
    "end": "524089"
  },
  {
    "text": "that's mining Bitcoin or whatever other threat model we're using these days it's not gonna get recorded an auto log",
    "start": "524089",
    "end": "529820"
  },
  {
    "text": "because no one has interacted with the API server okay so it's briefly what an",
    "start": "529820",
    "end": "535220"
  },
  {
    "text": "auto log is let's look at the different stages of when these logs are generated we have a request received which is when",
    "start": "535220",
    "end": "540380"
  },
  {
    "text": "the audit handler receives the request response started we only get those for things like watch longer running",
    "start": "540380",
    "end": "545480"
  },
  {
    "text": "requests response complete that's when the reserver is done and no more bytes are gonna be sent this is aa blur we've",
    "start": "545480",
    "end": "551329"
  },
  {
    "text": "dealt with it and then panic occurs when a panic is generated on the server let's just walk through this quickly to go",
    "start": "551329",
    "end": "557600"
  },
  {
    "text": "through the life cycle so this is roughly what we can expect it to look like it also kicks off with a request to",
    "start": "557600",
    "end": "563269"
  },
  {
    "text": "the API server again I get a watch a create something like that at that point we get an audit log with the stage",
    "start": "563269",
    "end": "569329"
  },
  {
    "text": "request received from here we can see what the server response is gonna be it can either be a no-go and the server",
    "start": "569329",
    "end": "575360"
  },
  {
    "text": "could panic and would get a panic log or if it's a longer running request like watch will get a response started and",
    "start": "575360",
    "end": "580880"
  },
  {
    "text": "when it's done response complete for a lot of logs like gets you would likely see just two of these the respond the",
    "start": "580880",
    "end": "586820"
  },
  {
    "text": "requests received in response complete but the key takeaway here is that for every every event you're not gonna get",
    "start": "586820",
    "end": "593270"
  },
  {
    "text": "just one the log you're likely gonna get a couple of these okay alright so I",
    "start": "593270",
    "end": "600350"
  },
  {
    "text": "mentioned Auto levels briefly I just want to go into what those are because audit levels basically could is how we",
    "start": "600350",
    "end": "605540"
  },
  {
    "text": "can figure how much data we want each audit log to consists of so we can look",
    "start": "605540",
    "end": "610610"
  },
  {
    "text": "at so we can do none which means we don't want to log anything about certain resources if you're just not interested",
    "start": "610610",
    "end": "617180"
  },
  {
    "text": "you can do metadata this is really interesting for things like secrets because you probably don't want to be",
    "start": "617180",
    "end": "622279"
  },
  {
    "text": "sending like the full body of secrets across the wire because they are a secret request this is the full request",
    "start": "622279",
    "end": "628970"
  },
  {
    "text": "body and then the most robust is request response so this is you get both the full request body and the response body",
    "start": "628970",
    "end": "634930"
  },
  {
    "text": "response object in your logging so if I were to set a policy it might look",
    "start": "634930",
    "end": "640190"
  },
  {
    "text": "something like this you can see this is just a kubernetes object with the kind policy I'm going omit the stage request received I'm only",
    "start": "640190",
    "end": "646900"
  },
  {
    "text": "interested in metadata and I'm only interested in secrets so what that would come out to is a log that looks",
    "start": "646900",
    "end": "653110"
  },
  {
    "text": "something like this and even though this is a fairly restrictive policy we can see that it answers all six of those questions we talked about earlier what",
    "start": "653110",
    "end": "660040"
  },
  {
    "text": "happened if this was a we look at the verb it's a get when did it happen you got a bunch of timestamps you can see",
    "start": "660040",
    "end": "665710"
  },
  {
    "text": "all those um who did it it looks like someone named Delores robot or a human I",
    "start": "665710",
    "end": "671680"
  },
  {
    "text": "don't know and then it looks like it's coming from a source IP of 1001 four",
    "start": "671680",
    "end": "676990"
  },
  {
    "text": "three and this happened on a secret and the default namespace if you're",
    "start": "676990",
    "end": "683110"
  },
  {
    "text": "interested in kind of going into a deeper dive of what I just flew through there is a talk tomorrow on auditing",
    "start": "683110",
    "end": "688360"
  },
  {
    "text": "it's up and on the sixth floor it's at 11:40 in the morning I don't have time to fully go into it but that's just a",
    "start": "688360",
    "end": "694150"
  },
  {
    "text": "high high level overview and that talk is by a much hand stuffing all right so",
    "start": "694150",
    "end": "699790"
  },
  {
    "text": "now that we hopefully kind of know what auditing is let's go over we know what",
    "start": "699790",
    "end": "706600"
  },
  {
    "text": "other thing is and it gives this so it gives us insight into who did what when which is super useful for things like compliance anomaly detection and event",
    "start": "706600",
    "end": "713710"
  },
  {
    "text": "attribution so we like it we want it let's do it all right for the bad news first you've",
    "start": "713710",
    "end": "719800"
  },
  {
    "text": "got to try to configure on it before first if you've tried to configure out it before you know it's a pain right and second once you have it configured",
    "start": "719800",
    "end": "726100"
  },
  {
    "text": "you're left with this massive amount of law because you need to somehow make sense of so how do we solve these problems let's start with configuration",
    "start": "726100",
    "end": "734130"
  },
  {
    "text": "currently if you want to configure Auto on your cluster you have to have a really good understanding of how your Cooper Nettie's installer works you have",
    "start": "734130",
    "end": "740980"
  },
  {
    "text": "to know where your kubernetes installer looks for manifests and then SSH into that spot and copy up some files which",
    "start": "740980",
    "end": "746980"
  },
  {
    "text": "brings us to the second issue even if you have a handle on how your installer handles these types of updates like you",
    "start": "746980",
    "end": "752110"
  },
  {
    "text": "know the cubelet looks for manifests and Etsy / kubernetes / manifests on the master node you still have to do some",
    "start": "752110",
    "end": "757840"
  },
  {
    "text": "pretty precise and often frustrating configuration you have to set some flags and then you have to copy up multiple",
    "start": "757840",
    "end": "763420"
  },
  {
    "text": "files to the master node like your Odyssey pal audit policy file we just talked about and finally once you've got",
    "start": "763420",
    "end": "769450"
  },
  {
    "text": "all that sorted out you have to restart the API server to apply the changes what's super annoying about this is even",
    "start": "769450",
    "end": "775210"
  },
  {
    "text": "if you made any mistakes which if you're like me definitely did you're gonna have to go back and do it again and restart the API",
    "start": "775210",
    "end": "781150"
  },
  {
    "text": "server again if you've done this before I would bet I would guess you got frustrated otherwise you're much better",
    "start": "781150",
    "end": "788050"
  },
  {
    "text": "than I am at this stuff okay so what's the problem with this beyond its annoying which is the big problem",
    "start": "788050",
    "end": "794790"
  },
  {
    "text": "so cluster operators you know they have to copy up files the master node and then restart the API server on every",
    "start": "794790",
    "end": "801010"
  },
  {
    "text": "single iteration of an odyssey pod a policy file so if they want to ever update their auto policy they have to SI",
    "start": "801010",
    "end": "806920"
  },
  {
    "text": "say SS ssh into the master node figure out what file they need to update hope",
    "start": "806920",
    "end": "812230"
  },
  {
    "text": "they don't make any indentation errors restart the API server and then do it again if it's not configured exactly",
    "start": "812230",
    "end": "817780"
  },
  {
    "text": "right it's not a trivial task and it's definitely harder than it needs to be for actives it's even more frustrating",
    "start": "817780",
    "end": "823960"
  },
  {
    "text": "because we're often stuck with the configuration that's been set by cluster operators so if I'm trying to debug it",
    "start": "823960",
    "end": "829960"
  },
  {
    "text": "debug an application and I want more than metadata figure out what's going on in the request body I can't turn up the",
    "start": "829960",
    "end": "835750"
  },
  {
    "text": "audit logging level without doing the whole SSH restart the API server song-and-dance it's not exactly an ideal",
    "start": "835750",
    "end": "841810"
  },
  {
    "text": "workflow for third-party app devs like me who want to build applications for",
    "start": "841810",
    "end": "847960"
  },
  {
    "text": "people to use audit we can't drop audit facilities into other clusters unless we",
    "start": "847960",
    "end": "853210"
  },
  {
    "text": "know that they have audit configured in exactly the way we need it configured on the masternode so if it's not like that",
    "start": "853210",
    "end": "859660"
  },
  {
    "text": "you're pretty much out of luck and you can't have like these really cool third-party apps which brings us to",
    "start": "859660",
    "end": "866440"
  },
  {
    "text": "dynamic audit configuration this is brand-new in 113 and it's still in alpha but it is super cool and it alleviates a",
    "start": "866440",
    "end": "872800"
  },
  {
    "text": "lot of the problems we just talked about so what is it dynamic audit config is a",
    "start": "872800",
    "end": "879040"
  },
  {
    "text": "set of objects some API server flags and an audit sync up and audit sync objects",
    "start": "879040",
    "end": "884590"
  },
  {
    "text": "that allow you to configure auditing features dynamically it's a good name",
    "start": "884590",
    "end": "889750"
  },
  {
    "text": "I'm sorry I couldn't come up with a better definition so to enable audit on your 113 cluster all you need to do is",
    "start": "889750",
    "end": "895690"
  },
  {
    "text": "set these three flags on your API server one of them is just turning on alpha one is enabling the feature gate and one is",
    "start": "895690",
    "end": "903100"
  },
  {
    "text": "actually saying yeah I want audit dynamic configuration when this goes to GA you're only gonna need the one flag",
    "start": "903100",
    "end": "909440"
  },
  {
    "text": "this might even be a default flag so you won't have to worry about that the other thing you need is an audit sync and I",
    "start": "909440",
    "end": "915350"
  },
  {
    "text": "would think is just a kubernetes object like a deployment like a pod like anything it's just some ammo and you can",
    "start": "915350",
    "end": "920870"
  },
  {
    "text": "do it with your coop and you can apply it we think you could all apply or create so the audit sink sets the logging policy and defines the end point",
    "start": "920870",
    "end": "927650"
  },
  {
    "text": "for where you want to send the logs a couple of things to note here you have to use a web hook for dynamic auditing",
    "start": "927650",
    "end": "932930"
  },
  {
    "text": "you can't just write it to a log file so you will need a URL or a service to send it to the other thing to note is that",
    "start": "932930",
    "end": "938990"
  },
  {
    "text": "stages are defined slightly differently I don't know if you remember but in the other policy I showed you it said omit stages this week for this new policy",
    "start": "938990",
    "end": "945530"
  },
  {
    "text": "definition we just say stages so as a whitelist of stages you want to receive",
    "start": "945530",
    "end": "950620"
  },
  {
    "text": "so how does this help everyone out cluster operators once it's set up they can just create audit syncs to their",
    "start": "950620",
    "end": "956570"
  },
  {
    "text": "heart content arts content to set new audit policies they can update them they can create new ones they can enable third nuclear party applications super",
    "start": "956570",
    "end": "963140"
  },
  {
    "text": "easily actives can easily also just create an audit sync once it's turned on and they can turn up audit love audit",
    "start": "963140",
    "end": "969290"
  },
  {
    "text": "logs so that they can debug their applications more easily and third-party app doves can write an application that",
    "start": "969290",
    "end": "975050"
  },
  {
    "text": "includes an audit sync in its definition so they don't need to worry about if the cluster is configured properly that",
    "start": "975050",
    "end": "980570"
  },
  {
    "text": "they're dropping their application in to okay super quickly I'm gonna do a demo of it in a second but just to make sure",
    "start": "980570",
    "end": "986420"
  },
  {
    "text": "everyone's aware of a few things this is still an alpha so maybe you don't go flipping it on and prod quite yet there",
    "start": "986420",
    "end": "992840"
  },
  {
    "text": "will be an increase in CPU and memory this is because every audit sync creates a buffer of 5000 events it's fine if you",
    "start": "992840",
    "end": "999560"
  },
  {
    "text": "got a few it's pretty nominal but if you're doing like a hundred syncs it's not gonna be nominal so don't do that",
    "start": "999560",
    "end": "1004600"
  },
  {
    "text": "they are working on that though right now so creating an auto sync means you",
    "start": "1004600",
    "end": "1009730"
  },
  {
    "text": "can pipe logs at any level to anywhere so it should be a cluster admin level coverage like you don't want people",
    "start": "1009730",
    "end": "1015520"
  },
  {
    "text": "piping secrets to themselves or whatever if you don't trust them it doesn't support off but they are working on that",
    "start": "1015520",
    "end": "1021460"
  },
  {
    "text": "so you will need to get a cert from the API server and that's sort of difficult",
    "start": "1021460",
    "end": "1026470"
  },
  {
    "text": "so I'm not doing it in this demo it's a very insecure demo don't do what I am doing and policy is scoped down for now",
    "start": "1026470",
    "end": "1033730"
  },
  {
    "text": "because and so you'll need to handle we need to handle a lot of like the resource filtering by proxy",
    "start": "1033730",
    "end": "1039928"
  },
  {
    "text": "the reason for that is that they're introducing a new thing call audit classes which is gonna make audit",
    "start": "1039929",
    "end": "1045399"
  },
  {
    "text": "seems composable it's very cool I'm happy to talk to you about it after the talk all right so let's do this really",
    "start": "1045399",
    "end": "1052090"
  },
  {
    "text": "quickly so we can see how easy it is I used kind for this kubernetes and docker it's really easy if you haven't",
    "start": "1052090",
    "end": "1058720"
  },
  {
    "text": "tried it out I recommend it very outside of the scope of this talk but it's cool so it's just a super easy way to get a",
    "start": "1058720",
    "end": "1066039"
  },
  {
    "text": "cluster up on your local machine and all you need to stalker so what I need to do is I just need to create a kind Kuster",
    "start": "1066039",
    "end": "1072369"
  },
  {
    "text": "so this command right here I am building a node image this isn't always necessary but kind is currently at 112 and I need",
    "start": "1072369",
    "end": "1078460"
  },
  {
    "text": "a 113 cluster so I had to build it from source after that I'm just gonna run kind create cluster and set this image",
    "start": "1078460",
    "end": "1084220"
  },
  {
    "text": "tag for this image flag to use the image I just built and then we also have this other flag that's config and this is the",
    "start": "1084220",
    "end": "1091269"
  },
  {
    "text": "kind config dot yamo this is where you're going to set your API flag so you",
    "start": "1091269",
    "end": "1096700"
  },
  {
    "text": "have audit enabled this is roughly what the kind config yema would look like you",
    "start": "1096700",
    "end": "1102279"
  },
  {
    "text": "can see here there's some indented llamó that's what that pipe thing is it's really ugly but that's what it looks like and underneath the pipe that's the",
    "start": "1102279",
    "end": "1109840"
  },
  {
    "text": "Yambol in the yeah mole that is exactly how you would set this up on cube ATM because kind is running qadian under the",
    "start": "1109840",
    "end": "1115690"
  },
  {
    "text": "hood so you can see there's a PII server object with some extra args and those three things below extra args those are",
    "start": "1115690",
    "end": "1121600"
  },
  {
    "text": "the three flags we were talking about earlier alright so let's do it I'm not",
    "start": "1121600",
    "end": "1127059"
  },
  {
    "text": "gonna build it for you because it's I'm gonna spare you but let's go ahead and",
    "start": "1127059",
    "end": "1132210"
  },
  {
    "text": "run it is it going No",
    "start": "1132210",
    "end": "1137190"
  },
  {
    "text": "okay I might not be able to do a demo I don't know how to make this play all",
    "start": "1143049",
    "end": "1150770"
  },
  {
    "text": "right well I'll just talk to three what's gonna happen um so once I've got my cute so sorry",
    "start": "1150770",
    "end": "1158780"
  },
  {
    "text": "okay so basically I'm gonna run that command I'm gonna create a kind create cluster image and then I'm gonna set it",
    "start": "1158780",
    "end": "1165440"
  },
  {
    "text": "config and we'll see it spin up and watch you can kind of see what's happening in the screenshot and then it'll spit out a cute config that I can",
    "start": "1165440",
    "end": "1174559"
  },
  {
    "text": "copy paste and then I can interact with the cluster using cube cuddle it is",
    "start": "1174559",
    "end": "1180289"
  },
  {
    "text": "going now okay sorry so now it's doing all that stuff great so we've got that",
    "start": "1180289",
    "end": "1187000"
  },
  {
    "text": "so once I have my cute pickle my cute config copy pasted I can interact with this cluster now directly through cue",
    "start": "1187000",
    "end": "1193280"
  },
  {
    "text": "cuddle so I'm gonna quickly build a pod this is the sketchy pod I was telling you about earlier that I'm gonna spit",
    "start": "1193280",
    "end": "1199039"
  },
  {
    "text": "like send my logs to this is not something you would actually do you would normally send your logs to something like a Cabana dashboard but",
    "start": "1199039",
    "end": "1205130"
  },
  {
    "text": "for the purposes of this demo I'm just spinning up another pod in my cluster to send the logs to that's gonna spit out",
    "start": "1205130",
    "end": "1210260"
  },
  {
    "text": "all the logs that audit is producing so we'll do that okay so that's me getting",
    "start": "1210260",
    "end": "1219409"
  },
  {
    "text": "my cute config all right so now what I'm gonna do is I'm just getting the IP that",
    "start": "1219409",
    "end": "1225950"
  },
  {
    "text": "I need to send the logs to then I'm gonna check in my audits sink once I have that IP and make sure that that IP",
    "start": "1225950",
    "end": "1231620"
  },
  {
    "text": "that's at my URL matches the IP that the pot is expecting pretty simple and then",
    "start": "1231620",
    "end": "1238429"
  },
  {
    "text": "from here I'm just gonna tail the logs of that endpoint pod I believe that's what's happening oh no that was me",
    "start": "1238429",
    "end": "1246049"
  },
  {
    "text": "creating the audit sink now I'm gonna tail the logs voila",
    "start": "1246049",
    "end": "1251630"
  },
  {
    "text": "we have a bunch of audit logs so this is like what raw audit data would look like in your cluster there's a lot of them",
    "start": "1251630",
    "end": "1259940"
  },
  {
    "text": "and we can see pre immediately that this is like just a lot this is like a small",
    "start": "1259940",
    "end": "1265700"
  },
  {
    "text": "cluster on my local machine that has been out for 30 seconds at this point and we already have a ton of logs to go",
    "start": "1265700",
    "end": "1271760"
  },
  {
    "text": "through so you can kind of imagine like how out of and this would get on a cluster of using in production every day okay so there's",
    "start": "1271760",
    "end": "1280830"
  },
  {
    "text": "some great work going up going on upstream to help alleviate the pain of configuring on it but how can we make",
    "start": "1280830",
    "end": "1286620"
  },
  {
    "text": "sense of the audit data once we have it set up I've mentioned this a few times but I just really want to emphasize like",
    "start": "1286620",
    "end": "1292230"
  },
  {
    "text": "how much data we're talking about it's a lot it's like a preposterous amount of data as an anecdote when we first",
    "start": "1292230",
    "end": "1298410"
  },
  {
    "text": "started building this building out this feature I'm gonna show off in a minute ross or designer design this view with",
    "start": "1298410",
    "end": "1304110"
  },
  {
    "text": "something like 142 logs per hour and we're like oh yeah cool that looks good great graph uh-huh seems reasonable but",
    "start": "1304110",
    "end": "1310560"
  },
  {
    "text": "once we hooked it up to a real cluster and realized like just like how aggressively wrong we all were we were",
    "start": "1310560",
    "end": "1316410"
  },
  {
    "text": "seeing something like a million events every day and we had to pretty seriously rethink how we wanted to display that",
    "start": "1316410",
    "end": "1321630"
  },
  {
    "text": "data so I just just to give that some color I wanted to give an example of one interaction with the API server so if",
    "start": "1321630",
    "end": "1328410"
  },
  {
    "text": "I'm a developer and I just want to create a simple deployment assuming this command successfully creates you can",
    "start": "1328410",
    "end": "1335610"
  },
  {
    "text": "expect to get at least three logs that are attributed to me again that's checking to make sure the deployment I'm trying to create doesn't already exist",
    "start": "1335610",
    "end": "1341940"
  },
  {
    "text": "that's gonna fail I'll create the actual creation of the planet and then a list just making sure the deployment is there",
    "start": "1341940",
    "end": "1348210"
  },
  {
    "text": "and everything's copasetic so three events for that one action meanwhile the system generates around 40",
    "start": "1348210",
    "end": "1354660"
  },
  {
    "text": "events for that one action kubernetes has been up a replica set the pods do gets updates I know there's like a bunch",
    "start": "1354660",
    "end": "1361350"
  },
  {
    "text": "of gets that happen at the end it's a lot and I couldn't even fit all 40 on one slide but these do actually",
    "start": "1361350",
    "end": "1366930"
  },
  {
    "text": "represent like a real engine X deployment that I spun up to give it a little more color I've got a pretty",
    "start": "1366930",
    "end": "1373740"
  },
  {
    "text": "stagnant cluster I keep up that has awed it enabled on it I really don't interact with this cluster at all so the logs it generates",
    "start": "1373740",
    "end": "1379800"
  },
  {
    "text": "are just logs generated by the system to keep the cluster healthy so this is the cluster that pretty much like exists in",
    "start": "1379800",
    "end": "1385770"
  },
  {
    "text": "my heart and on my AWS bill and that's it and it is still spitting out 60,000",
    "start": "1385770",
    "end": "1391410"
  },
  {
    "text": "out of events per hour so that deployment that generates 40 events that seemed like a lot in comparison to the",
    "start": "1391410",
    "end": "1397290"
  },
  {
    "text": "three but when your wait waiting through 60,000 events in an hour like isolating those 40 events much less",
    "start": "1397290",
    "end": "1403080"
  },
  {
    "text": "than three events becomes pretty difficult unless you know exactly what you're for which brings us to what we've been",
    "start": "1403080",
    "end": "1409690"
  },
  {
    "text": "working on and have to you so our team has been working on a product if it's aiming to make audit logs something more",
    "start": "1409690",
    "end": "1415990"
  },
  {
    "text": "than just a lot of data about your cluster we think there's a ton of value that can be derived from audit if you",
    "start": "1415990",
    "end": "1421090"
  },
  {
    "text": "just know to where to look so our goal is to start surfacing information to cluster operators that is about it readily available in audit logs but",
    "start": "1421090",
    "end": "1428230"
  },
  {
    "text": "isn't easily findable unless you know you're looking for in a lot of ways here audit is just a piece of the puzzle if",
    "start": "1428230",
    "end": "1433480"
  },
  {
    "text": "we don't know something is wrong or we don't know what we're looking for audit logs aren't going to alert you to the fact that something's amiss in your",
    "start": "1433480",
    "end": "1439450"
  },
  {
    "text": "cluster this isn't like an extra layer of security but what you do know something is wrong we can use audit to",
    "start": "1439450",
    "end": "1444940"
  },
  {
    "text": "figure out why it's wrong okay I'm gonna have to hope this works all right so this is the project that we",
    "start": "1444940",
    "end": "1452230"
  },
  {
    "text": "have been working on you can see here I've got a fleet of clusters like I should see we've got some gke clusters",
    "start": "1452230",
    "end": "1459850"
  },
  {
    "text": "we got some PKS clusters they have this AWS cluster that has a warning that there's a disk pressure so I click into",
    "start": "1459850",
    "end": "1466030"
  },
  {
    "text": "that and then I would see this cluster overview page or I can see yep I've got two notes and one of them appears to",
    "start": "1466030",
    "end": "1472240"
  },
  {
    "text": "have some kind of warning at that point I could investigate a little bit further go look at some nodes and yep that",
    "start": "1472240",
    "end": "1479470"
  },
  {
    "text": "doesn't look great just pressure a little bit higher than I'd expect for the allocated CPU so at this point once",
    "start": "1479470",
    "end": "1485440"
  },
  {
    "text": "I know there's something up I could go into audit and try to figure out why it's up so they're taking my time on",
    "start": "1485440",
    "end": "1493180"
  },
  {
    "text": "this one all right okay so this is the audit page and right off the bat we can see that there are 37,000 events in the",
    "start": "1493180",
    "end": "1499780"
  },
  {
    "text": "last hour and that looks like even with some sort of dip in the API server there might have been an outage which is why it's a little lower than 60 but it's",
    "start": "1499780",
    "end": "1506320"
  },
  {
    "text": "still pretty consistent like there's not really a lot you can tell there's like a little bit of a spike here and there but",
    "start": "1506320",
    "end": "1511570"
  },
  {
    "text": "nothing that would necessarily bring off any alarm bells so at that point I would just toggle off system events and get",
    "start": "1511570",
    "end": "1517270"
  },
  {
    "text": "only user created events this is a little more useful right like suddenly",
    "start": "1517270",
    "end": "1522280"
  },
  {
    "text": "we're seeing a couple of spikes and like that could very well be the problem that's going on the spikes before are me",
    "start": "1522280",
    "end": "1527710"
  },
  {
    "text": "messing up the demo the first time but those last spike is the one that will go in and look at so if we scroll down we",
    "start": "1527710",
    "end": "1534670"
  },
  {
    "text": "can see this overview of all of the auto logs so this is the same exact data I just showed there was like blobs of JSON on determine",
    "start": "1534670",
    "end": "1540130"
  },
  {
    "text": "but it's just displayed a little more nicely so we can see we've got some very bad scary app stuff going on that",
    "start": "1540130",
    "end": "1546640"
  },
  {
    "text": "doesn't sound good so I'm gonna click into that and see if I can answer those six questions we talked about earlier you know I can see here that it's a",
    "start": "1546640",
    "end": "1553660"
  },
  {
    "text": "create I can see who created it Fabio typical Fabio and I can see what",
    "start": "1553660",
    "end": "1561640"
  },
  {
    "text": "it what namespace it's in so I'm you know where to go look for it I can see the source IPO is created for I can figure out all of these things I need to",
    "start": "1561640",
    "end": "1567430"
  },
  {
    "text": "do I need to know as a cluster operator to go and actually fix it so at that",
    "start": "1567430",
    "end": "1573280"
  },
  {
    "text": "point you know this is I could go into my terminal and just really quickly do a",
    "start": "1573280",
    "end": "1579370"
  },
  {
    "text": "get of my pods the namespace a lot of typos in this I don't feel like we're doing it there they are very bad scary",
    "start": "1579370",
    "end": "1586750"
  },
  {
    "text": "app 52 seconds old and I'm just gonna delete that pod because I'm pretty sure it's suspicious and so once I deleted it",
    "start": "1586750",
    "end": "1594850"
  },
  {
    "text": "I could go back to HQ go back to the project and see that the cluster is",
    "start": "1594850",
    "end": "1603970"
  },
  {
    "text": "healthy again there was a little green dot next to the cluster name and I can go in and I can filter by very bad scary",
    "start": "1603970",
    "end": "1609310"
  },
  {
    "text": "app and see not just the events that Fabio created and the system created but also the events that I created when I",
    "start": "1609310",
    "end": "1615130"
  },
  {
    "text": "went and deleted the deleted that pod so",
    "start": "1615130",
    "end": "1622720"
  },
  {
    "text": "you have like a full picture of what happened like when it started who resolved it and you've got all of that",
    "start": "1622720",
    "end": "1628300"
  },
  {
    "text": "traced and you've got it traced in a way that you can actually understand okay",
    "start": "1628300",
    "end": "1633700"
  },
  {
    "text": "I'm about done so when I was preparing for this talk I had people ask me what",
    "start": "1633700",
    "end": "1638890"
  },
  {
    "text": "I'd be talking about when I reply with audit logging yeah I pretty universally be met with either it's very blank",
    "start": "1638890",
    "end": "1645130"
  },
  {
    "text": "stares or something along the lines that oh that sounds like really boring I think both of these reactions kind of",
    "start": "1645130",
    "end": "1652000"
  },
  {
    "text": "capture the two problems we have with audit right the blank stare comes from what on earth is audit logging drive and have that do I want that how do I",
    "start": "1652000",
    "end": "1657850"
  },
  {
    "text": "configure that and the abject boredom comes from people who have audit logging or it's like okay like that mountain of",
    "start": "1657850",
    "end": "1663280"
  },
  {
    "text": "JSON I literally never look at so hopefully you all come away from this talk feeling like you can get on it set",
    "start": "1663280",
    "end": "1669250"
  },
  {
    "text": "up an understanding why you might actually want to look at that pile of juice and one of our goals for the next few",
    "start": "1669250",
    "end": "1674500"
  },
  {
    "text": "months both upstream and and the things we're gonna be building it VMware is to keep addressing these problems when",
    "start": "1674500",
    "end": "1681040"
  },
  {
    "text": "dynamic thought it gets to GA for instance and maybe it will maybe even be enabled by default it really will just",
    "start": "1681040",
    "end": "1686530"
  },
  {
    "text": "be as simple as creating audit sinks to get auto policies set up and once",
    "start": "1686530",
    "end": "1691720"
  },
  {
    "text": "they're flowing we hope to keep building out solutions like what I just showed you to make them useful and hopefully a little bit less boring so with that",
    "start": "1691720",
    "end": "1699100"
  },
  {
    "text": "thank you all for coming I will be over the fgo booth for a few hours or if you prefer you can find me on Twitter where",
    "start": "1699100",
    "end": "1704170"
  },
  {
    "text": "my DMS are not and never will be open but you can at me thanks again",
    "start": "1704170",
    "end": "1710670"
  },
  {
    "text": "I think we have a few minutes for questions if there are any I don't think I quite hit it yeah",
    "start": "1715950",
    "end": "1723470"
  },
  {
    "text": "yeah",
    "start": "1734860",
    "end": "1737460"
  },
  {
    "text": "so the question was in large-scale fleets running hundreds thousands of",
    "start": "1754929",
    "end": "1759980"
  },
  {
    "text": "clusters what are potential pitfalls we've seen is that correct you know I'm",
    "start": "1759980",
    "end": "1767659"
  },
  {
    "text": "not sure that I'm qualified answer that question to be perfectly honest there",
    "start": "1767659",
    "end": "1773120"
  },
  {
    "text": "are many I'm sure but that if you want to come to you booth the field engineers like definitely have experience with",
    "start": "1773120",
    "end": "1779390"
  },
  {
    "text": "that I just I'm I'm not one of them takes a question though yeah mm-hmm none yeah",
    "start": "1779390",
    "end": "1793370"
  },
  {
    "text": "so if the API server finds that we're talking about end up being enabled by default then maybe we will be able to use things like the project I showed but",
    "start": "1793370",
    "end": "1800529"
  },
  {
    "text": "it'll be up to the cloud providers if they're gonna flip them on or not yeah",
    "start": "1800529",
    "end": "1808120"
  },
  {
    "text": "yeah no dynamic autoconfig itself won't",
    "start": "1812600",
    "end": "1817930"
  },
  {
    "text": "eliminate the system events you will still have to have some sort of proxy to filter those out",
    "start": "1817930",
    "end": "1824970"
  },
  {
    "text": "there's they'll still be there yeah yeah",
    "start": "1825240",
    "end": "1834840"
  },
  {
    "text": "and is there way you configure the kind of logs you receive to limit the number of",
    "start": "1847950",
    "end": "1854480"
  },
  {
    "text": "logs yeah so you use something like an audit policy that I showed at the beginning of the talk so you could",
    "start": "1854480",
    "end": "1859910"
  },
  {
    "text": "filter it down by resources you could filter it down by the stage of the log",
    "start": "1859910",
    "end": "1865150"
  },
  {
    "text": "you couldn't do something like filter out anything by a system user though",
    "start": "1865150",
    "end": "1870200"
  },
  {
    "text": "that's currently not in the scope of policy but you could do it by resources and by stage yeah all right thank you",
    "start": "1870200",
    "end": "1883730"
  },
  {
    "text": "everyone",
    "start": "1883730",
    "end": "1885940"
  }
]