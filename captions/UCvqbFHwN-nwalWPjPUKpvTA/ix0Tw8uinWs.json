[
  {
    "start": "0",
    "end": "60000"
  },
  {
    "text": "hello good morning welcome to day two of",
    "start": "0",
    "end": "3859"
  },
  {
    "text": "koukaon I'm really excited to be here in",
    "start": "3859",
    "end": "7319"
  },
  {
    "text": "beautiful Barcelona and I'm grateful to",
    "start": "7319",
    "end": "10349"
  },
  {
    "text": "the CN CF for giving me this chance to",
    "start": "10349",
    "end": "12480"
  },
  {
    "text": "tell you about how we had Spotify like",
    "start": "12480",
    "end": "15210"
  },
  {
    "text": "Brian said deleted our production",
    "start": "15210",
    "end": "17460"
  },
  {
    "text": "kubernetes clusters accidentally twice",
    "start": "17460",
    "end": "19859"
  },
  {
    "text": "but with little to no end user impact",
    "start": "19859",
    "end": "22910"
  },
  {
    "text": "now I actually just am curious raise",
    "start": "22910",
    "end": "25949"
  },
  {
    "text": "your hand if you have accidentally",
    "start": "25949",
    "end": "29220"
  },
  {
    "text": "deleted a production cluster just want",
    "start": "29220",
    "end": "31439"
  },
  {
    "text": "to get a sense cool yeah look at that",
    "start": "31439",
    "end": "33989"
  },
  {
    "text": "elite club out there yes I see you",
    "start": "33989",
    "end": "36290"
  },
  {
    "text": "alright",
    "start": "36290",
    "end": "38370"
  },
  {
    "text": "briefly just about myself and Spotify",
    "start": "38370",
    "end": "40640"
  },
  {
    "text": "I'm an infrastructure engineer Spotify",
    "start": "40640",
    "end": "44430"
  },
  {
    "text": "is a music streaming company with over",
    "start": "44430",
    "end": "46020"
  },
  {
    "text": "100 million subscribers and over 200",
    "start": "46020",
    "end": "48539"
  },
  {
    "text": "million monthly active users and inside",
    "start": "48539",
    "end": "52230"
  },
  {
    "text": "the company we have over a thousand",
    "start": "52230",
    "end": "53730"
  },
  {
    "text": "developers that are continuously",
    "start": "53730",
    "end": "55140"
  },
  {
    "text": "deploying code to over 10,000 virtual",
    "start": "55140",
    "end": "58140"
  },
  {
    "text": "machines and a little bit more about on",
    "start": "58140",
    "end": "61710"
  },
  {
    "start": "60000",
    "end": "60000"
  },
  {
    "text": "contexts of Spotify is compute",
    "start": "61710",
    "end": "63420"
  },
  {
    "text": "environment that you're gonna need to",
    "start": "63420",
    "end": "66240"
  },
  {
    "text": "understand some of the stories that I'm",
    "start": "66240",
    "end": "67590"
  },
  {
    "text": "going to tell you",
    "start": "67590",
    "end": "68840"
  },
  {
    "text": "so Spotify uses Google cloud platform",
    "start": "68840",
    "end": "71689"
  },
  {
    "text": "and for the purposes of this talk we",
    "start": "71689",
    "end": "74400"
  },
  {
    "text": "have two types of engineering teams that",
    "start": "74400",
    "end": "76170"
  },
  {
    "text": "Spotify teams that build infrastructure",
    "start": "76170",
    "end": "78150"
  },
  {
    "text": "and teams that use this infrastructure",
    "start": "78150",
    "end": "80100"
  },
  {
    "text": "to build their features that you would",
    "start": "80100",
    "end": "82530"
  },
  {
    "text": "see if you open the app and we'll call",
    "start": "82530",
    "end": "84210"
  },
  {
    "text": "the former infrastructure teams and",
    "start": "84210",
    "end": "86250"
  },
  {
    "text": "we'll call the latter feature teams my",
    "start": "86250",
    "end": "90060"
  },
  {
    "text": "team builds infrastructure related to",
    "start": "90060",
    "end": "92009"
  },
  {
    "text": "google kubernetes engine and for the",
    "start": "92009",
    "end": "94650"
  },
  {
    "text": "purposes of this talk again",
    "start": "94650",
    "end": "95909"
  },
  {
    "text": "we'll call my team the cluster operators",
    "start": "95909",
    "end": "98579"
  },
  {
    "text": "and we'll call the feature teams the",
    "start": "98579",
    "end": "100229"
  },
  {
    "text": "cluster users so currently as Spotify",
    "start": "100229",
    "end": "104009"
  },
  {
    "text": "we're helping all stateless back-end",
    "start": "104009",
    "end": "107159"
  },
  {
    "text": "services migrated over to gke and at the",
    "start": "107159",
    "end": "111930"
  },
  {
    "text": "time of these incidents we were only",
    "start": "111930",
    "end": "114780"
  },
  {
    "text": "running a subset of services and",
    "start": "114780",
    "end": "117180"
  },
  {
    "text": "partially each on gke I'll tell you a",
    "start": "117180",
    "end": "121259"
  },
  {
    "text": "little bit more about what that means",
    "start": "121259",
    "end": "122100"
  },
  {
    "text": "later so we have three production",
    "start": "122100",
    "end": "125460"
  },
  {
    "text": "clusters at the time of the stories one",
    "start": "125460",
    "end": "127619"
  },
  {
    "text": "in each of three regions us Europe and",
    "start": "127619",
    "end": "130289"
  },
  {
    "text": "Asia and we were backing up each of them",
    "start": "130289",
    "end": "132599"
  },
  {
    "text": "one",
    "start": "132599",
    "end": "133349"
  },
  {
    "text": "every hour story time all right so I",
    "start": "133349",
    "end": "137790"
  },
  {
    "text": "love stories I'm going to tell you two",
    "start": "137790",
    "end": "138989"
  },
  {
    "text": "of them and the first one is about how I",
    "start": "138989",
    "end": "143359"
  },
  {
    "text": "accidentally deleted this cluster and",
    "start": "143359",
    "end": "146480"
  },
  {
    "text": "the other is about how my co-workers",
    "start": "146480",
    "end": "149069"
  },
  {
    "text": "when trying to prevent that from ever",
    "start": "149069",
    "end": "151920"
  },
  {
    "text": "happening again",
    "start": "151920",
    "end": "153799"
  },
  {
    "text": "they accidentally deleted this cluster",
    "start": "153799",
    "end": "156389"
  },
  {
    "text": "and it gets better because in the",
    "start": "156389",
    "end": "159689"
  },
  {
    "text": "process of trying to recreate this",
    "start": "159689",
    "end": "161519"
  },
  {
    "text": "cluster in Asia that happened okay so",
    "start": "161519",
    "end": "166379"
  },
  {
    "text": "how exactly did this happen and how did",
    "start": "166379",
    "end": "168840"
  },
  {
    "text": "we prevent any end user impacts so that",
    "start": "168840",
    "end": "170519"
  },
  {
    "text": "people could keep listening to the music",
    "start": "170519",
    "end": "171780"
  },
  {
    "text": "that they loved so it was November 2018",
    "start": "171780",
    "end": "175290"
  },
  {
    "text": "and I wanted to test the gke feature so",
    "start": "175290",
    "end": "180480"
  },
  {
    "text": "I create a new GK test cluster in a test",
    "start": "180480",
    "end": "182849"
  },
  {
    "text": "project and I wanted to have the same",
    "start": "182849",
    "end": "185849"
  },
  {
    "text": "configuration as our production clusters",
    "start": "185849",
    "end": "187699"
  },
  {
    "text": "so I opened two browser tabs one for the",
    "start": "187699",
    "end": "190620"
  },
  {
    "text": "production one one for the testing one I",
    "start": "190620",
    "end": "193019"
  },
  {
    "text": "finished my test and I wanted to delete",
    "start": "193019",
    "end": "196169"
  },
  {
    "text": "that test cluster and I had the wrong",
    "start": "196169",
    "end": "199259"
  },
  {
    "text": "tab open so I was freaking out and on",
    "start": "199259",
    "end": "205049"
  },
  {
    "text": "slacker I remember asking my colleague",
    "start": "205049",
    "end": "206909"
  },
  {
    "text": "how do you how do you stop this is there",
    "start": "206909",
    "end": "208680"
  },
  {
    "text": "any way to stop this I had deleted a 50",
    "start": "208680",
    "end": "212009"
  },
  {
    "text": "node production cluster running dozens",
    "start": "212009",
    "end": "214709"
  },
  {
    "text": "of workloads so with GK it's actually",
    "start": "214709",
    "end": "219000"
  },
  {
    "text": "really easy to create a cluster that's",
    "start": "219000",
    "end": "221009"
  },
  {
    "text": "what's really awesome about it you click",
    "start": "221009",
    "end": "222750"
  },
  {
    "text": "one button you get everything masters",
    "start": "222750",
    "end": "225120"
  },
  {
    "text": "nodes you get networking all set up you",
    "start": "225120",
    "end": "228509"
  },
  {
    "text": "get authorization unfortunately with GK",
    "start": "228509",
    "end": "232049"
  },
  {
    "text": "it's also really easy to delete an",
    "start": "232049",
    "end": "233970"
  },
  {
    "text": "entire cluster so with one click of a",
    "start": "233970",
    "end": "236040"
  },
  {
    "text": "button everything goes away",
    "start": "236040",
    "end": "237959"
  },
  {
    "text": "masters nodes authorization networking",
    "start": "237959",
    "end": "240840"
  },
  {
    "text": "and so is there a way to stop it and I",
    "start": "240840",
    "end": "243000"
  },
  {
    "text": "learned the hard way that no there's",
    "start": "243000",
    "end": "244650"
  },
  {
    "text": "there's just no way to stop it you just",
    "start": "244650",
    "end": "246540"
  },
  {
    "text": "wait for it to clean up all of the",
    "start": "246540",
    "end": "248340"
  },
  {
    "text": "compute instances and then you kind of",
    "start": "248340",
    "end": "251340"
  },
  {
    "text": "like hold your breath and hopefully",
    "start": "251340",
    "end": "252719"
  },
  {
    "text": "nothing too bad happened you try to",
    "start": "252719",
    "end": "254159"
  },
  {
    "text": "recreate it so let's talk about how we",
    "start": "254159",
    "end": "257370"
  },
  {
    "start": "255000",
    "end": "255000"
  },
  {
    "text": "recreated this cluster it took us three",
    "start": "257370",
    "end": "259829"
  },
  {
    "text": "hours and twenty five three hours and 15",
    "start": "259829",
    "end": "262079"
  },
  {
    "text": "minutes to restore it fix all of our",
    "start": "262079",
    "end": "264330"
  },
  {
    "text": "integrations with it",
    "start": "264330",
    "end": "266590"
  },
  {
    "text": "the restoration time took this long",
    "start": "266590",
    "end": "268960"
  },
  {
    "text": "because we found bugs in our cluster",
    "start": "268960",
    "end": "271660"
  },
  {
    "text": "creation scripts that we hadn't",
    "start": "271660",
    "end": "273220"
  },
  {
    "text": "exercised a lot our documentation was",
    "start": "273220",
    "end": "277000"
  },
  {
    "text": "incomplete and sometimes just had",
    "start": "277000",
    "end": "278410"
  },
  {
    "text": "mistakes in it and our cluster creation",
    "start": "278410",
    "end": "281860"
  },
  {
    "text": "process wasn't resumable so sometimes",
    "start": "281860",
    "end": "284320"
  },
  {
    "text": "would fail halfway and we had to restart",
    "start": "284320",
    "end": "287770"
  },
  {
    "text": "from the very top we didn't design it to",
    "start": "287770",
    "end": "289780"
  },
  {
    "text": "be resumable from the middle so this",
    "start": "289780",
    "end": "292120"
  },
  {
    "text": "wasted a lot of time okay so we thought",
    "start": "292120",
    "end": "296080"
  },
  {
    "start": "294000",
    "end": "294000"
  },
  {
    "text": "about how would we you know human",
    "start": "296080",
    "end": "297820"
  },
  {
    "text": "mistakes happen how are we going to",
    "start": "297820",
    "end": "298840"
  },
  {
    "text": "prevent this from happening again and we",
    "start": "298840",
    "end": "302410"
  },
  {
    "text": "wanted to we decided to use an",
    "start": "302410",
    "end": "305410"
  },
  {
    "text": "open-source tool for putting your",
    "start": "305410",
    "end": "309010"
  },
  {
    "text": "infrastructure in code this was called",
    "start": "309010",
    "end": "310990"
  },
  {
    "text": "terraform just one of the many out there",
    "start": "310990",
    "end": "313090"
  },
  {
    "text": "and basically allows you to codify your",
    "start": "313090",
    "end": "317440"
  },
  {
    "text": "infrastructure you can write down your",
    "start": "317440",
    "end": "318729"
  },
  {
    "text": "clusters declaratively you can version",
    "start": "318729",
    "end": "320950"
  },
  {
    "text": "it you can review changes and while",
    "start": "320950",
    "end": "323950"
  },
  {
    "text": "trying to adopt terraform unfortunately",
    "start": "323950",
    "end": "325570"
  },
  {
    "text": "we we accidentally deleted not one but",
    "start": "325570",
    "end": "327280"
  },
  {
    "text": "two clusters so how did this happen this",
    "start": "327280",
    "end": "331720"
  },
  {
    "text": "is the second story and I'll give you",
    "start": "331720",
    "end": "333729"
  },
  {
    "text": "some context about how we configured our",
    "start": "333729",
    "end": "335800"
  },
  {
    "text": "clusters and how terraform works so you",
    "start": "335800",
    "end": "337630"
  },
  {
    "text": "understand the details of it so we have",
    "start": "337630",
    "end": "341200"
  },
  {
    "text": "a shared git repository where we define",
    "start": "341200",
    "end": "344110"
  },
  {
    "text": "all of our cluster level configuration",
    "start": "344110",
    "end": "346479"
  },
  {
    "text": "and resources on for every cluster and",
    "start": "346479",
    "end": "350050"
  },
  {
    "text": "this repository is used by both cluster",
    "start": "350050",
    "end": "352539"
  },
  {
    "text": "users and by my team the cluster",
    "start": "352539",
    "end": "354400"
  },
  {
    "text": "operators so it's all mixed together",
    "start": "354400",
    "end": "358199"
  },
  {
    "text": "when we started using terraform we we",
    "start": "358620",
    "end": "363550"
  },
  {
    "text": "realized that there was like a state",
    "start": "363550",
    "end": "364720"
  },
  {
    "text": "file that terraform wrote to the kind of",
    "start": "364720",
    "end": "368050"
  },
  {
    "text": "like know about the state of your",
    "start": "368050",
    "end": "370690"
  },
  {
    "text": "infrastructure but we weren't very",
    "start": "370690",
    "end": "372970"
  },
  {
    "text": "familiar with it",
    "start": "372970",
    "end": "374830"
  },
  {
    "text": "terraform actually uses the state file",
    "start": "374830",
    "end": "376600"
  },
  {
    "text": "to decide what it's going to do so first",
    "start": "376600",
    "end": "379479"
  },
  {
    "text": "my team when trying to get terraform and",
    "start": "379479",
    "end": "382330"
  },
  {
    "text": "manage these clusters we created a pull",
    "start": "382330",
    "end": "384550"
  },
  {
    "text": "request to import the asia cluster into",
    "start": "384550",
    "end": "387940"
  },
  {
    "text": "the state file and this state file",
    "start": "387940",
    "end": "390280"
  },
  {
    "text": "actually effects what's going to happen",
    "start": "390280",
    "end": "392229"
  },
  {
    "text": "in production but we ran review builds",
    "start": "392229",
    "end": "396099"
  },
  {
    "text": "that actually modified the state file",
    "start": "396099",
    "end": "398620"
  },
  {
    "text": "during a during the",
    "start": "398620",
    "end": "399700"
  },
  {
    "text": "view bill so let's think about that we",
    "start": "399700",
    "end": "402250"
  },
  {
    "text": "modified a global state file that",
    "start": "402250",
    "end": "405100"
  },
  {
    "text": "affects what happens in production",
    "start": "405100",
    "end": "406450"
  },
  {
    "text": "during a review build we didn't merge",
    "start": "406450",
    "end": "410590"
  },
  {
    "text": "this PR yet though and then a few",
    "start": "410590",
    "end": "413350"
  },
  {
    "text": "minutes later a cluster user who knows",
    "start": "413350",
    "end": "416680"
  },
  {
    "text": "nothing about terraform and shouldn't",
    "start": "416680",
    "end": "418030"
  },
  {
    "text": "need to know anything about it",
    "start": "418030",
    "end": "419140"
  },
  {
    "text": "they made a pull request to add three",
    "start": "419140",
    "end": "422650"
  },
  {
    "text": "more users to an hour back file an",
    "start": "422650",
    "end": "425860"
  },
  {
    "text": "existing rule binding file and they they",
    "start": "425860",
    "end": "429250"
  },
  {
    "text": "asked us to review it and it looked very",
    "start": "429250",
    "end": "430720"
  },
  {
    "text": "innocuous it was just three extra users",
    "start": "430720",
    "end": "432580"
  },
  {
    "text": "on an existing game space but what was",
    "start": "432580",
    "end": "435540"
  },
  {
    "text": "important what wasn't what was in the PR",
    "start": "435540",
    "end": "438910"
  },
  {
    "text": "or the change file it was what was",
    "start": "438910",
    "end": "440980"
  },
  {
    "text": "missing and it was missing the",
    "start": "440980",
    "end": "443410"
  },
  {
    "text": "definition for the Asia cluster and",
    "start": "443410",
    "end": "446040"
  },
  {
    "text": "these two pull requests were merged out",
    "start": "446040",
    "end": "448840"
  },
  {
    "text": "of order so that one was merged to",
    "start": "448840",
    "end": "453970"
  },
  {
    "text": "master first can you guess what happens",
    "start": "453970",
    "end": "455770"
  },
  {
    "text": "next and that's what happened",
    "start": "455770",
    "end": "459340"
  },
  {
    "text": "so terraform looked at this emerged it",
    "start": "459340",
    "end": "461860"
  },
  {
    "text": "in it's like oh I don't see the Asia",
    "start": "461860",
    "end": "463630"
  },
  {
    "text": "cluster defined I'm just gonna this this",
    "start": "463630",
    "end": "466150"
  },
  {
    "text": "shouldn't be here I'm just gonna get rid",
    "start": "466150",
    "end": "467110"
  },
  {
    "text": "of it so this way we thought okay well",
    "start": "467110",
    "end": "470290"
  },
  {
    "start": "468000",
    "end": "468000"
  },
  {
    "text": "it can't you can't get any worse right",
    "start": "470290",
    "end": "473910"
  },
  {
    "text": "we still have that unmerged PR oh and",
    "start": "473910",
    "end": "477370"
  },
  {
    "text": "when you think that it can't get any",
    "start": "477370",
    "end": "479080"
  },
  {
    "text": "worse it can always get worse it's",
    "start": "479080",
    "end": "480760"
  },
  {
    "text": "always like I know it's like one of",
    "start": "480760",
    "end": "482170"
  },
  {
    "text": "those phrases like I'll do the dishes",
    "start": "482170",
    "end": "484420"
  },
  {
    "text": "later you know it's not gonna happen so",
    "start": "484420",
    "end": "487660"
  },
  {
    "text": "we still have that emerged PR from the",
    "start": "487660",
    "end": "489160"
  },
  {
    "text": "previous slide that declared the age of",
    "start": "489160",
    "end": "491890"
  },
  {
    "text": "cluster so we thought okay we'll just",
    "start": "491890",
    "end": "493210"
  },
  {
    "text": "merge that one in and it will recreate",
    "start": "493210",
    "end": "495760"
  },
  {
    "text": "it so our cluster creation script",
    "start": "495760",
    "end": "501640"
  },
  {
    "text": "actually fails halfway because it didn't",
    "start": "501640",
    "end": "504880"
  },
  {
    "text": "have the right permissions so before we",
    "start": "504880",
    "end": "507220"
  },
  {
    "text": "were using terraform each of us were",
    "start": "507220",
    "end": "509140"
  },
  {
    "text": "just running a few terraform commands",
    "start": "509140",
    "end": "512080"
  },
  {
    "text": "locally and our on our work laptops with",
    "start": "512080",
    "end": "515050"
  },
  {
    "text": "our personal GCP accounts and those",
    "start": "515050",
    "end": "517990"
  },
  {
    "text": "personal accounts had they were owners",
    "start": "517990",
    "end": "520780"
  },
  {
    "text": "of the project so we had all the",
    "start": "520780",
    "end": "522490"
  },
  {
    "text": "permissions we needed but now we're",
    "start": "522490",
    "end": "523750"
  },
  {
    "text": "using a service account to run these",
    "start": "523750",
    "end": "525130"
  },
  {
    "text": "terraform commands and they didn't have",
    "start": "525130",
    "end": "526540"
  },
  {
    "text": "all the permissions so we gave it we",
    "start": "526540",
    "end": "529870"
  },
  {
    "text": "kind of just like gave it all the",
    "start": "529870",
    "end": "531280"
  },
  {
    "text": "permissions it needed but these actual",
    "start": "531280",
    "end": "533980"
  },
  {
    "text": "were different permissions in terraform",
    "start": "533980",
    "end": "535829"
  },
  {
    "text": "originally used to import the clusters",
    "start": "535829",
    "end": "538540"
  },
  {
    "text": "and when you have different permissions",
    "start": "538540",
    "end": "540430"
  },
  {
    "text": "and you call the Google API s you get",
    "start": "540430",
    "end": "543910"
  },
  {
    "text": "different attributes so now when",
    "start": "543910",
    "end": "547029"
  },
  {
    "text": "terraform gets a list of clusters from",
    "start": "547029",
    "end": "548470"
  },
  {
    "text": "GCP they have different properties",
    "start": "548470",
    "end": "550690"
  },
  {
    "text": "because it can see more and so these",
    "start": "550690",
    "end": "553120"
  },
  {
    "text": "properties have changed depending on",
    "start": "553120",
    "end": "555130"
  },
  {
    "text": "their permissions so we use one set of",
    "start": "555130",
    "end": "556779"
  },
  {
    "text": "permissions to import the clusters and",
    "start": "556779",
    "end": "559000"
  },
  {
    "text": "now we're using another set of",
    "start": "559000",
    "end": "560440"
  },
  {
    "text": "permissions to kind of manage them and",
    "start": "560440",
    "end": "565139"
  },
  {
    "text": "now the clusters look different to",
    "start": "565139",
    "end": "567639"
  },
  {
    "text": "terraform so that happened because if i",
    "start": "567639",
    "end": "571510"
  },
  {
    "text": "don't know about this cluster this must",
    "start": "571510",
    "end": "572800"
  },
  {
    "text": "be different so at this point we have",
    "start": "572800",
    "end": "575350"
  },
  {
    "text": "deleted 2/3 of our production clusters",
    "start": "575350",
    "end": "578459"
  },
  {
    "text": "from the face of the earth so this was",
    "start": "578459",
    "end": "582010"
  },
  {
    "text": "pretty bad thankfully didn't get any",
    "start": "582010",
    "end": "584139"
  },
  {
    "text": "worse than this we didn't delete like",
    "start": "584139",
    "end": "585760"
  },
  {
    "text": "all three this time but this was pretty",
    "start": "585760",
    "end": "588459"
  },
  {
    "text": "bad still ok let's talk about the impact",
    "start": "588459",
    "end": "591750"
  },
  {
    "start": "590000",
    "end": "590000"
  },
  {
    "text": "so the developer impact one team had to",
    "start": "591750",
    "end": "595540"
  },
  {
    "text": "create more non kerbin IDs VMs they were",
    "start": "595540",
    "end": "598120"
  },
  {
    "text": "actually running half-and-half so",
    "start": "598120",
    "end": "599380"
  },
  {
    "text": "they're running some other capacity on",
    "start": "599380",
    "end": "600760"
  },
  {
    "text": "kubernetes and some on our existing just",
    "start": "600760",
    "end": "603730"
  },
  {
    "text": "straight-up compute so they had to",
    "start": "603730",
    "end": "605980"
  },
  {
    "text": "create more to handle the load my team",
    "start": "605980",
    "end": "608800"
  },
  {
    "text": "realized all the places we had",
    "start": "608800",
    "end": "610060"
  },
  {
    "text": "hard-coded the old clusters master IPS",
    "start": "610060",
    "end": "613920"
  },
  {
    "text": "so we had to go in and like update all",
    "start": "613920",
    "end": "616569"
  },
  {
    "text": "of those and kind of minor annoyance but",
    "start": "616569",
    "end": "621100"
  },
  {
    "text": "everyone using coop CTL had to refresh",
    "start": "621100",
    "end": "624670"
  },
  {
    "text": "their cluster credentials when we",
    "start": "624670",
    "end": "626319"
  },
  {
    "text": "recreated the clusters that had new",
    "start": "626319",
    "end": "627730"
  },
  {
    "text": "certificates but otherwise our user",
    "start": "627730",
    "end": "630910"
  },
  {
    "text": "support slack channel internally was",
    "start": "630910",
    "end": "633670"
  },
  {
    "text": "quiet it was like you're really quiet",
    "start": "633670",
    "end": "635470"
  },
  {
    "text": "and no one paged us so let's talk about",
    "start": "635470",
    "end": "640209"
  },
  {
    "text": "the end user impact like the sky who's",
    "start": "640209",
    "end": "643000"
  },
  {
    "text": "listening to Spotify while you know on",
    "start": "643000",
    "end": "645010"
  },
  {
    "text": "his jog he kept running",
    "start": "645010",
    "end": "647110"
  },
  {
    "text": "we had no reports of either cluster",
    "start": "647110",
    "end": "649660"
  },
  {
    "text": "deletion affecting our end users so",
    "start": "649660",
    "end": "653760"
  },
  {
    "start": "653000",
    "end": "653000"
  },
  {
    "text": "first a summary of how we did this and",
    "start": "653760",
    "end": "657160"
  },
  {
    "text": "what we did right that prevented any end",
    "start": "657160",
    "end": "659949"
  },
  {
    "text": "user impact so from day one of doing",
    "start": "659949",
    "end": "664510"
  },
  {
    "text": "this complex migration we plan for",
    "start": "664510",
    "end": "666910"
  },
  {
    "text": "failure",
    "start": "666910",
    "end": "667870"
  },
  {
    "text": "because you know things happen things",
    "start": "667870",
    "end": "670510"
  },
  {
    "text": "are not always going to be reliable and",
    "start": "670510",
    "end": "671860"
  },
  {
    "text": "there's gonna be lots of mistakes on the",
    "start": "671860",
    "end": "673270"
  },
  {
    "text": "way and also we when we were migrating",
    "start": "673270",
    "end": "677200"
  },
  {
    "text": "large-scale complex infrastructure we",
    "start": "677200",
    "end": "680410"
  },
  {
    "text": "did it gradually and this is very",
    "start": "680410",
    "end": "682060"
  },
  {
    "text": "important because it gives you time",
    "start": "682060",
    "end": "683890"
  },
  {
    "text": "again it gave us time to build",
    "start": "683890",
    "end": "685930"
  },
  {
    "text": "redundancy into our systems and to give",
    "start": "685930",
    "end": "689620"
  },
  {
    "text": "us a chance to rollback in case anything",
    "start": "689620",
    "end": "691810"
  },
  {
    "text": "went wrong during the migration process",
    "start": "691810",
    "end": "693910"
  },
  {
    "text": "and last but not least we have a culture",
    "start": "693910",
    "end": "698740"
  },
  {
    "text": "of learning that's Spotify so you know",
    "start": "698740",
    "end": "701950"
  },
  {
    "text": "we try to figure out what have we",
    "start": "701950",
    "end": "704110"
  },
  {
    "text": "learned from this and how do we prevent",
    "start": "704110",
    "end": "706060"
  },
  {
    "text": "the same type of mistake from happening",
    "start": "706060",
    "end": "707770"
  },
  {
    "text": "in the future so that we only have it",
    "start": "707770",
    "end": "708970"
  },
  {
    "text": "once I'm gonna go into more details on",
    "start": "708970",
    "end": "711160"
  },
  {
    "text": "each of these now so how did we plan for",
    "start": "711160",
    "end": "715780"
  },
  {
    "start": "713000",
    "end": "713000"
  },
  {
    "text": "failure we originally while migrating we",
    "start": "715780",
    "end": "719800"
  },
  {
    "text": "told each team to migrate their services",
    "start": "719800",
    "end": "722980"
  },
  {
    "text": "just partially to kubernetes don't put",
    "start": "722980",
    "end": "725830"
  },
  {
    "text": "100% of it on do half and half gradually",
    "start": "725830",
    "end": "729070"
  },
  {
    "text": "ramp up we were still building",
    "start": "729070",
    "end": "730870"
  },
  {
    "text": "confidence in our ability to manage",
    "start": "730870",
    "end": "732430"
  },
  {
    "text": "these clusters and to scale them up and",
    "start": "732430",
    "end": "735010"
  },
  {
    "text": "to test out all of our custom",
    "start": "735010",
    "end": "737440"
  },
  {
    "text": "integrations with it the second way that",
    "start": "737440",
    "end": "741220"
  },
  {
    "text": "saved us the second thing that saved us",
    "start": "741220",
    "end": "742750"
  },
  {
    "text": "was how we registered these services",
    "start": "742750",
    "end": "745060"
  },
  {
    "text": "running on kubernetes and the results of",
    "start": "745060",
    "end": "748840"
  },
  {
    "text": "these two is that the the failover to",
    "start": "748840",
    "end": "751150"
  },
  {
    "text": "non communities instances happened as we",
    "start": "751150",
    "end": "754510"
  },
  {
    "text": "expected when the clusters were deleted",
    "start": "754510",
    "end": "756010"
  },
  {
    "text": "so let me be clear these three things",
    "start": "756010",
    "end": "758320"
  },
  {
    "text": "were not accidents but they were",
    "start": "758320",
    "end": "760450"
  },
  {
    "text": "deliberate choices we made to make our",
    "start": "760450",
    "end": "762250"
  },
  {
    "text": "infrastructure more reliable and our",
    "start": "762250",
    "end": "764200"
  },
  {
    "text": "migration process reversible and now",
    "start": "764200",
    "end": "767020"
  },
  {
    "text": "going to go into a little more details",
    "start": "767020",
    "end": "768820"
  },
  {
    "text": "on each of these three and how we did",
    "start": "768820",
    "end": "770770"
  },
  {
    "text": "that so for the partial migration on a",
    "start": "770770",
    "end": "773770"
  },
  {
    "start": "772000",
    "end": "772000"
  },
  {
    "text": "per service level kubernetes usage is",
    "start": "773770",
    "end": "776620"
  },
  {
    "text": "Spotify at the time was marked as beta",
    "start": "776620",
    "end": "779430"
  },
  {
    "text": "and what this means is that we",
    "start": "779430",
    "end": "782680"
  },
  {
    "text": "recommended teams only migrate some but",
    "start": "782680",
    "end": "785680"
  },
  {
    "text": "not all of each of their services",
    "start": "785680",
    "end": "787480"
  },
  {
    "text": "capacity to kubernetes and meanwhile we",
    "start": "787480",
    "end": "791110"
  },
  {
    "text": "were continue working on integrations",
    "start": "791110",
    "end": "792630"
  },
  {
    "text": "reliability and managing multiple",
    "start": "792630",
    "end": "794980"
  },
  {
    "text": "clusters at once and we actually",
    "start": "794980",
    "end": "799030"
  },
  {
    "text": "registered our",
    "start": "799030",
    "end": "800860"
  },
  {
    "text": "our services on kubernetes in a kind of",
    "start": "800860",
    "end": "803800"
  },
  {
    "text": "different way the non Kerber Nettie's",
    "start": "803800",
    "end": "805270"
  },
  {
    "text": "way due to interoperable",
    "start": "805270",
    "end": "807970"
  },
  {
    "text": "interoperability reasons so our",
    "start": "807970",
    "end": "810340"
  },
  {
    "text": "internals service discovery uses pot IPs",
    "start": "810340",
    "end": "813400"
  },
  {
    "text": "it doesn't use the service at all and",
    "start": "813400",
    "end": "816480"
  },
  {
    "text": "this internal service discovery pulls",
    "start": "816480",
    "end": "820300"
  },
  {
    "text": "the services endpoints and then it",
    "start": "820300",
    "end": "822190"
  },
  {
    "text": "updates it's it's pretty much it's",
    "start": "822190",
    "end": "826030"
  },
  {
    "text": "updates its internal state with the pot",
    "start": "826030",
    "end": "828070"
  },
  {
    "text": "IPS and then when it noticed that it",
    "start": "828070",
    "end": "831910"
  },
  {
    "text": "couldn't reach a cluster our team was",
    "start": "831910",
    "end": "834100"
  },
  {
    "text": "paged and so we would have to go and",
    "start": "834100",
    "end": "836200"
  },
  {
    "text": "actually remove that cluster from the",
    "start": "836200",
    "end": "838000"
  },
  {
    "text": "configuration so that that service",
    "start": "838000",
    "end": "839920"
  },
  {
    "text": "discovery mechanism would no longer pull",
    "start": "839920",
    "end": "842200"
  },
  {
    "text": "that non-existent cluster anymore",
    "start": "842200",
    "end": "844330"
  },
  {
    "text": "and then what happened was that we",
    "start": "844330",
    "end": "846910"
  },
  {
    "text": "failed over to the non kurby Nettie's",
    "start": "846910",
    "end": "849910"
  },
  {
    "text": "instances so we would restart service",
    "start": "849910",
    "end": "852550"
  },
  {
    "text": "discovery our internal service discovery",
    "start": "852550",
    "end": "854410"
  },
  {
    "text": "system and then the pot IPS would be",
    "start": "854410",
    "end": "857350"
  },
  {
    "text": "removed and then downstream clients that",
    "start": "857350",
    "end": "860950"
  },
  {
    "text": "had a list you would gradually refresh",
    "start": "860950",
    "end": "863770"
  },
  {
    "text": "their list of backends and it would just",
    "start": "863770",
    "end": "866800"
  },
  {
    "text": "you know those pod IPS wood from",
    "start": "866800",
    "end": "868600"
  },
  {
    "text": "kubernetes would go away and it would",
    "start": "868600",
    "end": "870040"
  },
  {
    "text": "use the kind of legacy instances that",
    "start": "870040",
    "end": "874360"
  },
  {
    "text": "weren't on kubernetes anymore and now I",
    "start": "874360",
    "end": "878710"
  },
  {
    "start": "877000",
    "end": "877000"
  },
  {
    "text": "want to describe some of the best",
    "start": "878710",
    "end": "879670"
  },
  {
    "text": "practices that we followed when",
    "start": "879670",
    "end": "881260"
  },
  {
    "text": "migrating complex infrastructure to make",
    "start": "881260",
    "end": "883180"
  },
  {
    "text": "sure that we did it gradually we could",
    "start": "883180",
    "end": "884620"
  },
  {
    "text": "always have a chance to reverse it if we",
    "start": "884620",
    "end": "886420"
  },
  {
    "text": "needed to so number one thing to do and",
    "start": "886420",
    "end": "890710"
  },
  {
    "text": "also a huge part of what saved us was we",
    "start": "890710",
    "end": "892630"
  },
  {
    "text": "backed up these clusters from day one we",
    "start": "892630",
    "end": "896110"
  },
  {
    "text": "codify that infrastructure or started to",
    "start": "896110",
    "end": "898210"
  },
  {
    "text": "after the first cluster was lead 'add we",
    "start": "898210",
    "end": "901060"
  },
  {
    "text": "started performing disaster recovery",
    "start": "901060",
    "end": "902470"
  },
  {
    "text": "tests and we made sure that we practiced",
    "start": "902470",
    "end": "905380"
  },
  {
    "text": "these drills we practice these scenarios",
    "start": "905380",
    "end": "907660"
  },
  {
    "text": "and actually ran through them so our",
    "start": "907660",
    "end": "911650"
  },
  {
    "text": "cluster backups they were essential we",
    "start": "911650",
    "end": "914290"
  },
  {
    "text": "had already tested restoring from these",
    "start": "914290",
    "end": "916690"
  },
  {
    "text": "because if you have backups but you've",
    "start": "916690",
    "end": "919900"
  },
  {
    "text": "never tested restoring from your backups",
    "start": "919900",
    "end": "922390"
  },
  {
    "text": "I'm sorry you don't have backups",
    "start": "922390",
    "end": "924550"
  },
  {
    "text": "right you just never tested them",
    "start": "924550",
    "end": "927720"
  },
  {
    "text": "codifying your infrastructure so we were",
    "start": "927720",
    "end": "931210"
  },
  {
    "start": "928000",
    "end": "928000"
  },
  {
    "text": "trying to introduce terraform gradually",
    "start": "931210",
    "end": "932920"
  },
  {
    "text": "and it was you",
    "start": "932920",
    "end": "934130"
  },
  {
    "text": "better than what we had even though it",
    "start": "934130",
    "end": "935570"
  },
  {
    "text": "you know there were some hiccups along",
    "start": "935570",
    "end": "936800"
  },
  {
    "text": "the way terraform and tools like this",
    "start": "936800",
    "end": "940310"
  },
  {
    "text": "help us standardize our workflow and the",
    "start": "940310",
    "end": "942470"
  },
  {
    "text": "change management of infrastructure code",
    "start": "942470",
    "end": "944530"
  },
  {
    "text": "we added linters and validators to make",
    "start": "944530",
    "end": "947840"
  },
  {
    "text": "sure that the configs that we're writing",
    "start": "947840",
    "end": "949310"
  },
  {
    "text": "were correct we also added other things",
    "start": "949310",
    "end": "952340"
  },
  {
    "text": "like adding the output of the dry run to",
    "start": "952340",
    "end": "955700"
  },
  {
    "text": "the comments in the pull requests so",
    "start": "955700",
    "end": "957680"
  },
  {
    "text": "that it was very obvious what it was",
    "start": "957680",
    "end": "959360"
  },
  {
    "text": "going to do and we use github so we can",
    "start": "959360",
    "end": "962180"
  },
  {
    "text": "have status checks that are required to",
    "start": "962180",
    "end": "964220"
  },
  {
    "text": "pass before merging one of these status",
    "start": "964220",
    "end": "966530"
  },
  {
    "text": "checks is that the branch must be up to",
    "start": "966530",
    "end": "970220"
  },
  {
    "text": "date if you get a dry run based on an",
    "start": "970220",
    "end": "973100"
  },
  {
    "text": "old master commit it's not really what's",
    "start": "973100",
    "end": "975680"
  },
  {
    "text": "going to happen so that we turn that on",
    "start": "975680",
    "end": "977630"
  },
  {
    "text": "so you have to do the review build again",
    "start": "977630",
    "end": "979910"
  },
  {
    "text": "based on the latest master of course we",
    "start": "979910",
    "end": "983030"
  },
  {
    "text": "require approving pull request reviews",
    "start": "983030",
    "end": "985460"
  },
  {
    "text": "and we would just immediately fail",
    "start": "985460",
    "end": "988990"
  },
  {
    "text": "reviews if we detected certain keywords",
    "start": "988990",
    "end": "992090"
  },
  {
    "text": "like destroy you probably don't want to",
    "start": "992090",
    "end": "994670"
  },
  {
    "text": "destroy something we still do those",
    "start": "994670",
    "end": "996530"
  },
  {
    "text": "destructions of clusters manually but",
    "start": "996530",
    "end": "998390"
  },
  {
    "text": "not not in this repository so disaster",
    "start": "998390",
    "end": "1003310"
  },
  {
    "start": "1002000",
    "end": "1002000"
  },
  {
    "text": "recovery tests disasters will happen",
    "start": "1003310",
    "end": "1006250"
  },
  {
    "text": "whether you plan for them or not so it's",
    "start": "1006250",
    "end": "1008890"
  },
  {
    "text": "always good to just plan for them we",
    "start": "1008890",
    "end": "1011050"
  },
  {
    "text": "schedule them in advance and we announce",
    "start": "1011050",
    "end": "1014880"
  },
  {
    "text": "widely to operators and users when we're",
    "start": "1014880",
    "end": "1018790"
  },
  {
    "text": "gonna do them you also want to test",
    "start": "1018790",
    "end": "1021790"
  },
  {
    "text": "different failure conditions you maybe",
    "start": "1021790",
    "end": "1025060"
  },
  {
    "text": "you want to test cluster going away or",
    "start": "1025060",
    "end": "1026770"
  },
  {
    "text": "something not as catastrophic like the",
    "start": "1026770",
    "end": "1029560"
  },
  {
    "text": "control plane going down or node not",
    "start": "1029560",
    "end": "1031688"
  },
  {
    "text": "being able to be added or pod not being",
    "start": "1031689",
    "end": "1033730"
  },
  {
    "text": "able to be scheduled and as you're going",
    "start": "1033730",
    "end": "1036280"
  },
  {
    "text": "through these exercises as you do them",
    "start": "1036280",
    "end": "1038560"
  },
  {
    "text": "just record each little issue you see",
    "start": "1038560",
    "end": "1040720"
  },
  {
    "text": "and fix them accordingly if it's",
    "start": "1040720",
    "end": "1043000"
  },
  {
    "text": "something like typos and a documentation",
    "start": "1043000",
    "end": "1045760"
  },
  {
    "text": "or just some some kind of tool that",
    "start": "1045760",
    "end": "1048970"
  },
  {
    "text": "wasn't automated the right way and",
    "start": "1048970",
    "end": "1051120"
  },
  {
    "start": "1051000",
    "end": "1051000"
  },
  {
    "text": "practice makes perfect so it took me",
    "start": "1051120",
    "end": "1054790"
  },
  {
    "text": "three and a quarter hours to restore the",
    "start": "1054790",
    "end": "1056650"
  },
  {
    "text": "first cluster I had deleted along with",
    "start": "1056650",
    "end": "1058120"
  },
  {
    "text": "all its integrations with the help from",
    "start": "1058120",
    "end": "1059410"
  },
  {
    "text": "my team and the second cluster deletion",
    "start": "1059410",
    "end": "1062560"
  },
  {
    "text": "that actually lasted from 8:00 at night",
    "start": "1062560",
    "end": "1065050"
  },
  {
    "text": "till 5:00 in the morning",
    "start": "1065050",
    "end": "1067429"
  },
  {
    "text": "but now we can actually restore clusters",
    "start": "1067429",
    "end": "1070679"
  },
  {
    "text": "that are way bigger than the ones we",
    "start": "1070679",
    "end": "1073139"
  },
  {
    "text": "deleted before in one hour so I think",
    "start": "1073139",
    "end": "1075450"
  },
  {
    "text": "that's a huge improvement and most very",
    "start": "1075450",
    "end": "1080100"
  },
  {
    "text": "grateful and thankful that Spotify has",
    "start": "1080100",
    "end": "1081749"
  },
  {
    "text": "engineering teams have a great culture",
    "start": "1081749",
    "end": "1084299"
  },
  {
    "text": "of learning not blame so I was freaking",
    "start": "1084299",
    "end": "1087869"
  },
  {
    "text": "out when I deleted that cluster my team",
    "start": "1087869",
    "end": "1091919"
  },
  {
    "text": "though was very supportive and you know",
    "start": "1091919",
    "end": "1094200"
  },
  {
    "text": "they said things like it's better now",
    "start": "1094200",
    "end": "1096119"
  },
  {
    "text": "than never you know this would have",
    "start": "1096119",
    "end": "1097409"
  },
  {
    "text": "happened anyways and Ashley said we",
    "start": "1097409",
    "end": "1099419"
  },
  {
    "text": "learned so much from doing this they",
    "start": "1099419",
    "end": "1101669"
  },
  {
    "text": "stopped short of like thank you for",
    "start": "1101669",
    "end": "1103019"
  },
  {
    "text": "deleting it on a Friday but you know it",
    "start": "1103019",
    "end": "1105480"
  },
  {
    "text": "was still good that that happened before",
    "start": "1105480",
    "end": "1106889"
  },
  {
    "text": "we got too many users on so we're all",
    "start": "1106889",
    "end": "1109529"
  },
  {
    "text": "human and we've all made mistakes what",
    "start": "1109529",
    "end": "1113159"
  },
  {
    "text": "is important isn't who made the mistake",
    "start": "1113159",
    "end": "1115470"
  },
  {
    "text": "but what you learned and how you can",
    "start": "1115470",
    "end": "1117179"
  },
  {
    "text": "prevent making that same type of mistake",
    "start": "1117179",
    "end": "1118830"
  },
  {
    "text": "in the future",
    "start": "1118830",
    "end": "1120289"
  },
  {
    "text": "so to recap what prevented that end user",
    "start": "1120289",
    "end": "1122730"
  },
  {
    "text": "impact we plan for failure from the very",
    "start": "1122730",
    "end": "1125249"
  },
  {
    "text": "beginning we migrated large-scale",
    "start": "1125249",
    "end": "1128549"
  },
  {
    "text": "infrastructure very gradually that gave",
    "start": "1128549",
    "end": "1130619"
  },
  {
    "text": "us time to build redundancy reliability",
    "start": "1130619",
    "end": "1132539"
  },
  {
    "text": "and reversibility into that process and",
    "start": "1132539",
    "end": "1136529"
  },
  {
    "text": "we have a culture of learning so the",
    "start": "1136529",
    "end": "1139649"
  },
  {
    "text": "next steps for us using kubernetes as",
    "start": "1139649",
    "end": "1142080"
  },
  {
    "text": "Spotify I'm very happy to say that as of",
    "start": "1142080",
    "end": "1145679"
  },
  {
    "text": "last Monday we kind of flipped the",
    "start": "1145679",
    "end": "1148470"
  },
  {
    "text": "switch",
    "start": "1148470",
    "end": "1149029"
  },
  {
    "text": "kubernetes is available for everyone to",
    "start": "1149029",
    "end": "1151470"
  },
  {
    "text": "use and it's marked as generally",
    "start": "1151470",
    "end": "1153179"
  },
  {
    "text": "available at Spotify which means that",
    "start": "1153179",
    "end": "1154619"
  },
  {
    "text": "we've kind of lifted that recommendation",
    "start": "1154619",
    "end": "1156509"
  },
  {
    "text": "against running your service entirely on",
    "start": "1156509",
    "end": "1158639"
  },
  {
    "text": "kubernetes we feel confident enough that",
    "start": "1158639",
    "end": "1161309"
  },
  {
    "text": "you can take your mission-critical",
    "start": "1161309",
    "end": "1162330"
  },
  {
    "text": "service and run it a hundred percent on",
    "start": "1162330",
    "end": "1164249"
  },
  {
    "text": "kubernetes and we now have - we are in",
    "start": "1164249",
    "end": "1169739"
  },
  {
    "text": "the process of figuring out or have",
    "start": "1169739",
    "end": "1171090"
  },
  {
    "text": "already kind of made good progress on",
    "start": "1171090",
    "end": "1174109"
  },
  {
    "text": "managing configuration around how do we",
    "start": "1174109",
    "end": "1176399"
  },
  {
    "text": "distribute workloads among multiple",
    "start": "1176399",
    "end": "1178440"
  },
  {
    "text": "clusters this is we have five in each",
    "start": "1178440",
    "end": "1180419"
  },
  {
    "text": "region now and how do we create more",
    "start": "1180419",
    "end": "1183330"
  },
  {
    "text": "redundancy for services maybe we want to",
    "start": "1183330",
    "end": "1185340"
  },
  {
    "text": "deploy these services to multiple",
    "start": "1185340",
    "end": "1187529"
  },
  {
    "text": "clusters within a single region so",
    "start": "1187529",
    "end": "1191309"
  },
  {
    "text": "that's my talk I want to again thank the",
    "start": "1191309",
    "end": "1194039"
  },
  {
    "text": "CN CF and Spotify for this opportunity I",
    "start": "1194039",
    "end": "1196980"
  },
  {
    "text": "want to thank my team for all their hard",
    "start": "1196980",
    "end": "1198419"
  },
  {
    "text": "work for making kubernetes a reality in",
    "start": "1198419",
    "end": "1200279"
  },
  {
    "text": "production",
    "start": "1200279",
    "end": "1201010"
  },
  {
    "text": "and I want to thank all of you here for",
    "start": "1201010",
    "end": "1202840"
  },
  {
    "text": "attending Spotify is a great place to",
    "start": "1202840",
    "end": "1205150"
  },
  {
    "text": "work",
    "start": "1205150",
    "end": "1205660"
  },
  {
    "text": "if you're looking we're hiring we're",
    "start": "1205660",
    "end": "1208240"
  },
  {
    "text": "also using the latest cloud native",
    "start": "1208240",
    "end": "1210280"
  },
  {
    "text": "technologies to make the entire music",
    "start": "1210280",
    "end": "1213220"
  },
  {
    "text": "ecosystem of work better for everyone so",
    "start": "1213220",
    "end": "1216220"
  },
  {
    "text": "my name is David you can find me on",
    "start": "1216220",
    "end": "1217540"
  },
  {
    "text": "Twitter here thank you so much",
    "start": "1217540",
    "end": "1219520"
  },
  {
    "text": "[Applause]",
    "start": "1219520",
    "end": "1223950"
  }
]