[
  {
    "text": "hello Can you guys hear me okay Okay",
    "start": "160",
    "end": "3520"
  },
  {
    "text": "Welcome everyone Uh what a wonderful day",
    "start": "3520",
    "end": "5759"
  },
  {
    "text": "today at London I hope you all are",
    "start": "5759",
    "end": "8160"
  },
  {
    "text": "having a good time Uh I'm here to talk",
    "start": "8160",
    "end": "10880"
  },
  {
    "text": "about how we scaled observability uh",
    "start": "10880",
    "end": "14160"
  },
  {
    "text": "with Loki at Dropbox Uh so for next 20",
    "start": "14160",
    "end": "17520"
  },
  {
    "text": "25 minutes uh this is what we are going",
    "start": "17520",
    "end": "19920"
  },
  {
    "text": "to talk about I'll introduce the problem",
    "start": "19920",
    "end": "22880"
  },
  {
    "text": "space uh why those problems were",
    "start": "22880",
    "end": "26000"
  },
  {
    "text": "pertinent at our scale Then I will walk",
    "start": "26000",
    "end": "29119"
  },
  {
    "text": "you through evaluation metric we had uh",
    "start": "29119",
    "end": "33200"
  },
  {
    "text": "using which we evaluated different",
    "start": "33200",
    "end": "34719"
  },
  {
    "text": "logging solutions Uh then why we arrived",
    "start": "34719",
    "end": "37520"
  },
  {
    "text": "at Graphfana Uh how we made it",
    "start": "37520",
    "end": "40079"
  },
  {
    "text": "operational at our scale What what we",
    "start": "40079",
    "end": "41920"
  },
  {
    "text": "have made different I mean what what",
    "start": "41920",
    "end": "43360"
  },
  {
    "text": "what changes we made with graphana And",
    "start": "43360",
    "end": "46320"
  },
  {
    "text": "uh finally I'll leave some time at the",
    "start": "46320",
    "end": "48160"
  },
  {
    "text": "end of uh uh of this uh presentation for",
    "start": "48160",
    "end": "52000"
  },
  {
    "text": "some uh Q&A",
    "start": "52000",
    "end": "54399"
  },
  {
    "text": "So with that uh before I dive in let me",
    "start": "54399",
    "end": "57680"
  },
  {
    "text": "give you an intro about myself Uh my",
    "start": "57680",
    "end": "59840"
  },
  {
    "text": "name is Aloc Ranjen Um I am the",
    "start": "59840",
    "end": "62480"
  },
  {
    "text": "engineering manager of storage platform",
    "start": "62480",
    "end": "64720"
  },
  {
    "text": "team Uh my team primarily deals with uh",
    "start": "64720",
    "end": "68240"
  },
  {
    "text": "all storage services and I worked at in",
    "start": "68240",
    "end": "70960"
  },
  {
    "text": "Loki when I was working in my previous",
    "start": "70960",
    "end": "72560"
  },
  {
    "text": "team uh in telemetry team Prior to",
    "start": "72560",
    "end": "75200"
  },
  {
    "text": "Dropbox I have worked at uh big switch",
    "start": "75200",
    "end": "77360"
  },
  {
    "text": "networks It's it was a startup uh VMware",
    "start": "77360",
    "end": "80080"
  },
  {
    "text": "and Cisco Primary my focus has been uh",
    "start": "80080",
    "end": "83159"
  },
  {
    "text": "infrastructure and you know building",
    "start": "83159",
    "end": "85119"
  },
  {
    "text": "scalable uh distributed systems Uh a",
    "start": "85119",
    "end": "88799"
  },
  {
    "text": "particular interest of mine is how AI",
    "start": "88799",
    "end": "90960"
  },
  {
    "text": "and ML infrastructure you know are",
    "start": "90960",
    "end": "93439"
  },
  {
    "text": "scaling Uh but that is something we can",
    "start": "93439",
    "end": "95680"
  },
  {
    "text": "talk uh some other time Today we are",
    "start": "95680",
    "end": "97280"
  },
  {
    "text": "going to talk about how we solve logging",
    "start": "97280",
    "end": "99119"
  },
  {
    "text": "challenges at Dropbox",
    "start": "99119",
    "end": "102400"
  },
  {
    "text": "uh to appreciate uh why this problem was",
    "start": "102400",
    "end": "105280"
  },
  {
    "text": "so challenging uh let's look at look at",
    "start": "105280",
    "end": "107360"
  },
  {
    "text": "the scale at which we operate to to",
    "start": "107360",
    "end": "109920"
  },
  {
    "text": "those who don't know Dropbox is a cloud",
    "start": "109920",
    "end": "111680"
  },
  {
    "text": "storage company we were founded in 2007",
    "start": "111680",
    "end": "115360"
  },
  {
    "text": "uh today we have more than 700 million",
    "start": "115360",
    "end": "117840"
  },
  {
    "text": "users out of which 18 plus million users",
    "start": "117840",
    "end": "120479"
  },
  {
    "text": "are paying users we upload I mean we we",
    "start": "120479",
    "end": "123759"
  },
  {
    "text": "manage more than a trillion piece of",
    "start": "123759",
    "end": "125920"
  },
  {
    "text": "content uh that is user data and we are",
    "start": "125920",
    "end": "129440"
  },
  {
    "text": "supporting billions of files uploaded",
    "start": "129440",
    "end": "131280"
  },
  {
    "text": "every single",
    "start": "131280",
    "end": "133760"
  },
  {
    "text": "So uh up until you know 2 3 years I'm",
    "start": "134800",
    "end": "139800"
  },
  {
    "text": "sorry did I okay so before we uh delve",
    "start": "139800",
    "end": "143599"
  },
  {
    "text": "into the problem statement uh let's look",
    "start": "143599",
    "end": "145840"
  },
  {
    "text": "at what unstructured log is uh",
    "start": "145840",
    "end": "149280"
  },
  {
    "text": "unstructured log is the raw data the",
    "start": "149280",
    "end": "152319"
  },
  {
    "text": "output produced by any application uh it",
    "start": "152319",
    "end": "155360"
  },
  {
    "text": "doesn't have any schema it's it's a very",
    "start": "155360",
    "end": "157360"
  },
  {
    "text": "free form way of uh you know printing",
    "start": "157360",
    "end": "159840"
  },
  {
    "text": "out something because of is it gives",
    "start": "159840",
    "end": "162400"
  },
  {
    "text": "immense flexibility to uh application",
    "start": "162400",
    "end": "165120"
  },
  {
    "text": "owners uh to dump anything and also look",
    "start": "165120",
    "end": "168000"
  },
  {
    "text": "for things In contrast things like hive",
    "start": "168000",
    "end": "171760"
  },
  {
    "text": "uh or traces are structured logs where",
    "start": "171760",
    "end": "173840"
  },
  {
    "text": "there is a predefined schema Uh the",
    "start": "173840",
    "end": "176080"
  },
  {
    "text": "sources for these logs is any you know",
    "start": "176080",
    "end": "178720"
  },
  {
    "text": "first party application code that is",
    "start": "178720",
    "end": "180239"
  },
  {
    "text": "code we as a Dropbox write as well as",
    "start": "180239",
    "end": "183120"
  },
  {
    "text": "any third party debug files be it any",
    "start": "183120",
    "end": "185440"
  },
  {
    "text": "library uh be it anything we have",
    "start": "185440",
    "end": "188159"
  },
  {
    "text": "integrated in Dropbox uh the primary use",
    "start": "188159",
    "end": "191040"
  },
  {
    "text": "case of uh these logs are real-time",
    "start": "191040",
    "end": "195200"
  },
  {
    "text": "troubleshooting Prior to uh I'll say",
    "start": "195480",
    "end": "198560"
  },
  {
    "text": "2021",
    "start": "198560",
    "end": "200239"
  },
  {
    "text": "uh we didn't have a a uh a way of",
    "start": "200239",
    "end": "203440"
  },
  {
    "text": "looking at these unstructured logs All",
    "start": "203440",
    "end": "205440"
  },
  {
    "text": "these logs were stored in war logs",
    "start": "205440",
    "end": "208080"
  },
  {
    "text": "Developers had to SSH into individual",
    "start": "208080",
    "end": "210159"
  },
  {
    "text": "boxes and they would go and do cat or",
    "start": "210159",
    "end": "212799"
  },
  {
    "text": "tail of the log file they were",
    "start": "212799",
    "end": "214400"
  },
  {
    "text": "interested in One challenge here was we",
    "start": "214400",
    "end": "216959"
  },
  {
    "text": "had a host rotation policy of 7 days",
    "start": "216959",
    "end": "219200"
  },
  {
    "text": "That means every 7 days your host will",
    "start": "219200",
    "end": "221200"
  },
  {
    "text": "get rotated out and your logs are gone",
    "start": "221200",
    "end": "224319"
  },
  {
    "text": "Uh not only that even within that 7 days",
    "start": "224319",
    "end": "226879"
  },
  {
    "text": "window u if you if you know how logs",
    "start": "226879",
    "end": "229280"
  },
  {
    "text": "work uh logs are getting constantly",
    "start": "229280",
    "end": "231840"
  },
  {
    "text": "compressed right Uh so if you have to",
    "start": "231840",
    "end": "234400"
  },
  {
    "text": "find something in the current log file",
    "start": "234400",
    "end": "236000"
  },
  {
    "text": "which is being logged it's very easy to",
    "start": "236000",
    "end": "238400"
  },
  {
    "text": "just search in it Otherwise we had built",
    "start": "238400",
    "end": "240799"
  },
  {
    "text": "you know a lot of tooling around it",
    "start": "240799",
    "end": "242000"
  },
  {
    "text": "where we would just go ahead and look",
    "start": "242000",
    "end": "243519"
  },
  {
    "text": "through different uh zip files But",
    "start": "243519",
    "end": "245519"
  },
  {
    "text": "beyond seven days that host is gone",
    "start": "245519",
    "end": "247439"
  },
  {
    "text": "entire log is gone We were also",
    "start": "247439",
    "end": "250080"
  },
  {
    "text": "migrating to uh Kubernetes around the",
    "start": "250080",
    "end": "252560"
  },
  {
    "text": "same time Uh now these containers were",
    "start": "252560",
    "end": "255519"
  },
  {
    "text": "even more ephemereral Uh there was no",
    "start": "255519",
    "end": "257280"
  },
  {
    "text": "guarantee of even 7 days anymore Plus uh",
    "start": "257280",
    "end": "260959"
  },
  {
    "text": "logging or sshing into Kubernetes was",
    "start": "260959",
    "end": "264320"
  },
  {
    "text": "not as easy as logging into host right",
    "start": "264320",
    "end": "266720"
  },
  {
    "text": "so that even exaggerated the problem So",
    "start": "266720",
    "end": "270000"
  },
  {
    "text": "this was our uh problem statement From",
    "start": "270000",
    "end": "272160"
  },
  {
    "text": "here we came up uh came up with a high",
    "start": "272160",
    "end": "275520"
  },
  {
    "text": "level requirement We wanted to provide a",
    "start": "275520",
    "end": "278240"
  },
  {
    "text": "user-friendly way of uh you know uh",
    "start": "278240",
    "end": "281120"
  },
  {
    "text": "managing users uh logs We wanted to make",
    "start": "281120",
    "end": "284080"
  },
  {
    "text": "it secure that only so that only",
    "start": "284080",
    "end": "285919"
  },
  {
    "text": "authorized people can uh access it We",
    "start": "285919",
    "end": "288400"
  },
  {
    "text": "wanted to completely replace our manual",
    "start": "288400",
    "end": "290960"
  },
  {
    "text": "onhost as such because that was",
    "start": "290960",
    "end": "293240"
  },
  {
    "text": "errorprone It posed security risk as",
    "start": "293240",
    "end": "296320"
  },
  {
    "text": "well Uh third thing was we wanted to",
    "start": "296320",
    "end": "299360"
  },
  {
    "text": "ingest entirety of Dropbox logs like",
    "start": "299360",
    "end": "302400"
  },
  {
    "text": "without and and we didn't want to bother",
    "start": "302400",
    "end": "305040"
  },
  {
    "text": "application owners to rewrite their logs",
    "start": "305040",
    "end": "307680"
  },
  {
    "text": "We wanted to make it as seamless as",
    "start": "307680",
    "end": "309600"
  },
  {
    "text": "possible because we were already going",
    "start": "309600",
    "end": "311199"
  },
  {
    "text": "through so many different migrations",
    "start": "311199",
    "end": "312800"
  },
  {
    "text": "that application owners were already",
    "start": "312800",
    "end": "314479"
  },
  {
    "text": "tired of all these migrations and we",
    "start": "314479",
    "end": "316800"
  },
  {
    "text": "wanted to make sure whatever we do today",
    "start": "316800",
    "end": "319759"
  },
  {
    "text": "lays the groundwork for future uh as",
    "start": "319759",
    "end": "321919"
  },
  {
    "text": "well So that whenever we acquire a",
    "start": "321919",
    "end": "323759"
  },
  {
    "text": "company the logs for those services are",
    "start": "323759",
    "end": "326160"
  },
  {
    "text": "also automatically",
    "start": "326160",
    "end": "328960"
  },
  {
    "text": "ingested Uh so from there uh uh we came",
    "start": "329160",
    "end": "333199"
  },
  {
    "text": "up with some reliability and security",
    "start": "333199",
    "end": "335320"
  },
  {
    "text": "requirement Uh we wanted to have at",
    "start": "335320",
    "end": "338000"
  },
  {
    "text": "least one week log storage Again this",
    "start": "338000",
    "end": "340639"
  },
  {
    "text": "come this came this requirement came",
    "start": "340639",
    "end": "342160"
  },
  {
    "text": "from the fact that there was 7-day uh",
    "start": "342160",
    "end": "344240"
  },
  {
    "text": "host rotation period We looked at",
    "start": "344240",
    "end": "346400"
  },
  {
    "text": "different metrics to figure out uh what",
    "start": "346400",
    "end": "348800"
  },
  {
    "text": "was our throughput for logs around that",
    "start": "348800",
    "end": "350960"
  },
  {
    "text": "time and we came up with this number 150",
    "start": "350960",
    "end": "352960"
  },
  {
    "text": "terabyte per day Uh today it is way more",
    "start": "352960",
    "end": "355680"
  },
  {
    "text": "than that We wanted to have a uh",
    "start": "355680",
    "end": "358639"
  },
  {
    "text": "injection latency of uh P99 injection",
    "start": "358639",
    "end": "361600"
  },
  {
    "text": "latency of less than 30 seconds and we",
    "start": "361600",
    "end": "363840"
  },
  {
    "text": "wanted our queries to return within 10",
    "start": "363840",
    "end": "366160"
  },
  {
    "text": "seconds Uh we also wanted 99% of uh log",
    "start": "366160",
    "end": "369520"
  },
  {
    "text": "durability and access Uh from day one we",
    "start": "369520",
    "end": "372560"
  },
  {
    "text": "wanted MTLS We wanted to have uh you",
    "start": "372560",
    "end": "374960"
  },
  {
    "text": "know end to-end security We wanted to",
    "start": "374960",
    "end": "377120"
  },
  {
    "text": "maintain access control Uh prior to Loki",
    "start": "377120",
    "end": "381120"
  },
  {
    "text": "this was guarded by you know guarding",
    "start": "381120",
    "end": "382639"
  },
  {
    "text": "SSH access to hosts Uh so we wanted to",
    "start": "382639",
    "end": "385280"
  },
  {
    "text": "have something similar like only the",
    "start": "385280",
    "end": "386720"
  },
  {
    "text": "authorized owner service owner should be",
    "start": "386720",
    "end": "388479"
  },
  {
    "text": "able to access their logs We wanted to",
    "start": "388479",
    "end": "391039"
  },
  {
    "text": "have uh some way of uh some key",
    "start": "391039",
    "end": "393440"
  },
  {
    "text": "management so that you know logs are",
    "start": "393440",
    "end": "395120"
  },
  {
    "text": "encrypted at rest And we wanted uh to",
    "start": "395120",
    "end": "397759"
  },
  {
    "text": "have some PIA protection like in case of",
    "start": "397759",
    "end": "399440"
  },
  {
    "text": "PII leak we wanted ability of detection",
    "start": "399440",
    "end": "402639"
  },
  {
    "text": "uh filtering and and",
    "start": "402639",
    "end": "405680"
  },
  {
    "text": "redaction We also called out some non-",
    "start": "406120",
    "end": "409199"
  },
  {
    "text": "goals specifically Uh in hindsight this",
    "start": "409199",
    "end": "412080"
  },
  {
    "text": "helped us a lot and that that probably",
    "start": "412080",
    "end": "414080"
  },
  {
    "text": "that's why I have put it here We we uh",
    "start": "414080",
    "end": "417199"
  },
  {
    "text": "explicitly said we are not going to",
    "start": "417199",
    "end": "418800"
  },
  {
    "text": "mandate any log format That means no one",
    "start": "418800",
    "end": "421199"
  },
  {
    "text": "has to change their logs uh we wanted to",
    "start": "421199",
    "end": "424319"
  },
  {
    "text": "call this out that this is not this",
    "start": "424319",
    "end": "426639"
  },
  {
    "text": "logging solution is not going to replace",
    "start": "426639",
    "end": "428800"
  },
  {
    "text": "any of the existing tools like if you're",
    "start": "428800",
    "end": "430639"
  },
  {
    "text": "relying on metrics for aggregation keep",
    "start": "430639",
    "end": "433520"
  },
  {
    "text": "doing that don't use this tool for other",
    "start": "433520",
    "end": "435599"
  },
  {
    "text": "purposes than just logging uh we didn't",
    "start": "435599",
    "end": "439360"
  },
  {
    "text": "want to build it for any batching or",
    "start": "439360",
    "end": "440720"
  },
  {
    "text": "historical analysis so analytics was not",
    "start": "440720",
    "end": "442720"
  },
  {
    "text": "going to be supported and we didn't want",
    "start": "442720",
    "end": "444639"
  },
  {
    "text": "to enforce anything like it was up to",
    "start": "444639",
    "end": "446639"
  },
  {
    "text": "the application developers to use it the",
    "start": "446639",
    "end": "449280"
  },
  {
    "text": "way they",
    "start": "449280",
    "end": "451680"
  },
  {
    "text": "it Uh this is the evaluation metric uh",
    "start": "451800",
    "end": "455360"
  },
  {
    "text": "we used u we had five criterias of",
    "start": "455360",
    "end": "459360"
  },
  {
    "text": "course topmost was cost We wanted the",
    "start": "459360",
    "end": "461520"
  },
  {
    "text": "total cost of ownership uh be it opex",
    "start": "461520",
    "end": "463840"
  },
  {
    "text": "capex maintenance overhead to be as",
    "start": "463840",
    "end": "466319"
  },
  {
    "text": "minimum as possible Uh at our scale",
    "start": "466319",
    "end": "469120"
  },
  {
    "text": "performance mattered a lot So our",
    "start": "469120",
    "end": "470960"
  },
  {
    "text": "injection rate was quite high So we",
    "start": "470960",
    "end": "472880"
  },
  {
    "text": "wanted to support our current injection",
    "start": "472880",
    "end": "474479"
  },
  {
    "text": "rate We wanted to make sure the query",
    "start": "474479",
    "end": "476479"
  },
  {
    "text": "query latency was was minimum and we",
    "start": "476479",
    "end": "479280"
  },
  {
    "text": "wanted to make sure the solution",
    "start": "479280",
    "end": "480960"
  },
  {
    "text": "whichever we arrive at is scalable Uh",
    "start": "480960",
    "end": "484160"
  },
  {
    "text": "our engineers were already used to",
    "start": "484160",
    "end": "485680"
  },
  {
    "text": "graphana uh because our in-house metrics",
    "start": "485680",
    "end": "488400"
  },
  {
    "text": "uh tool uses graphana So we wanted to",
    "start": "488400",
    "end": "490639"
  },
  {
    "text": "build something which is at least on par",
    "start": "490639",
    "end": "492319"
  },
  {
    "text": "with it So that's why UX was one of the",
    "start": "492319",
    "end": "495479"
  },
  {
    "text": "criterias Uh we wanted to make sure uh",
    "start": "495479",
    "end": "499199"
  },
  {
    "text": "whatever logging solution we choose",
    "start": "499199",
    "end": "501120"
  },
  {
    "text": "integrates with other tools uh but uh we",
    "start": "501120",
    "end": "503520"
  },
  {
    "text": "have been operating in this space for a",
    "start": "503520",
    "end": "504879"
  },
  {
    "text": "while and we we we have seen value of",
    "start": "504879",
    "end": "507199"
  },
  {
    "text": "correlation So we wanted to make sure",
    "start": "507199",
    "end": "509120"
  },
  {
    "text": "there was uh integration possibility and",
    "start": "509120",
    "end": "512159"
  },
  {
    "text": "um the last but not the least security",
    "start": "512159",
    "end": "514240"
  },
  {
    "text": "like we wanted to have data protection",
    "start": "514240",
    "end": "515839"
  },
  {
    "text": "we wanted to make sure in case if PII",
    "start": "515839",
    "end": "518240"
  },
  {
    "text": "data is leaked or if sensitive data is",
    "start": "518240",
    "end": "521039"
  },
  {
    "text": "leaked uh we have the ability to redact",
    "start": "521039",
    "end": "523120"
  },
  {
    "text": "it we have the ability to protect",
    "start": "523120",
    "end": "526279"
  },
  {
    "text": "it So the best option at that I mean not",
    "start": "526279",
    "end": "529680"
  },
  {
    "text": "best option the easiest option to do at",
    "start": "529680",
    "end": "531360"
  },
  {
    "text": "that time was just do nothing maintain",
    "start": "531360",
    "end": "533200"
  },
  {
    "text": "what whatever we had been doing right",
    "start": "533200",
    "end": "535120"
  },
  {
    "text": "continue existing SSH based uh log",
    "start": "535120",
    "end": "538200"
  },
  {
    "text": "analysis no additional in uh investment",
    "start": "538200",
    "end": "540959"
  },
  {
    "text": "right but of course it was manual",
    "start": "540959",
    "end": "543160"
  },
  {
    "text": "non-scalable and uh it was you know very",
    "start": "543160",
    "end": "546000"
  },
  {
    "text": "poor user experience",
    "start": "546000",
    "end": "548120"
  },
  {
    "text": "uh so of course uh we set out and we",
    "start": "548120",
    "end": "551839"
  },
  {
    "text": "evaluated bunch of services I have I've",
    "start": "551839",
    "end": "553839"
  },
  {
    "text": "tried to cram everything here I I'll",
    "start": "553839",
    "end": "555279"
  },
  {
    "text": "just go rowby row The first solution we",
    "start": "555279",
    "end": "558399"
  },
  {
    "text": "examined was externally managed SAS Uh",
    "start": "558399",
    "end": "562320"
  },
  {
    "text": "here everything will be fully managed uh",
    "start": "562320",
    "end": "564720"
  },
  {
    "text": "by third party service Pros were you",
    "start": "564720",
    "end": "567440"
  },
  {
    "text": "know we'll pretty much have no overhead",
    "start": "567440",
    "end": "570320"
  },
  {
    "text": "uh of managing it in house Uh but of",
    "start": "570320",
    "end": "573200"
  },
  {
    "text": "course pro uh cons were uh very high",
    "start": "573200",
    "end": "575600"
  },
  {
    "text": "cost potential security risk because we",
    "start": "575600",
    "end": "577920"
  },
  {
    "text": "are sending everything to to a third",
    "start": "577920",
    "end": "579440"
  },
  {
    "text": "party company Uh so that's why we",
    "start": "579440",
    "end": "581519"
  },
  {
    "text": "rejected it like both for cost and and",
    "start": "581519",
    "end": "583600"
  },
  {
    "text": "security concern The other option was",
    "start": "583600",
    "end": "585760"
  },
  {
    "text": "manage cloud logging So uh we looked at",
    "start": "585760",
    "end": "588640"
  },
  {
    "text": "bunch of you know managed search and",
    "start": "588640",
    "end": "590399"
  },
  {
    "text": "logging on a cloud uh framework Uh the",
    "start": "590399",
    "end": "593360"
  },
  {
    "text": "pros were these technologies are mature",
    "start": "593360",
    "end": "595920"
  },
  {
    "text": "Uh they are scalable but at our scale",
    "start": "595920",
    "end": "598959"
  },
  {
    "text": "the cost was still significantly higher",
    "start": "598959",
    "end": "601519"
  },
  {
    "text": "Uh in for some cases the UX was not that",
    "start": "601519",
    "end": "604320"
  },
  {
    "text": "great So you know eventually I mean this",
    "start": "604320",
    "end": "607519"
  },
  {
    "text": "was rejected primly for these two",
    "start": "607519",
    "end": "609040"
  },
  {
    "text": "reasons Uh the third thing was we could",
    "start": "609040",
    "end": "611200"
  },
  {
    "text": "have self-hosted uh some some of these",
    "start": "611200",
    "end": "613519"
  },
  {
    "text": "enterprisegrade solutions right uh they",
    "start": "613519",
    "end": "615920"
  },
  {
    "text": "had they provide very rich feature set",
    "start": "615920",
    "end": "618160"
  },
  {
    "text": "Uh they have very good uh vendor support",
    "start": "618160",
    "end": "620959"
  },
  {
    "text": "but then again uh it came down to",
    "start": "620959",
    "end": "623200"
  },
  {
    "text": "pricing The licensing was going to be",
    "start": "623200",
    "end": "625760"
  },
  {
    "text": "very expensive for us and we will still",
    "start": "625760",
    "end": "628160"
  },
  {
    "text": "be maintaining our own infrastructure",
    "start": "628160",
    "end": "629600"
  },
  {
    "text": "which means we'll have still have a team",
    "start": "629600",
    "end": "632480"
  },
  {
    "text": "uh managing it So that's why uh for",
    "start": "632480",
    "end": "634880"
  },
  {
    "text": "these two reasons we we rejected it The",
    "start": "634880",
    "end": "637440"
  },
  {
    "text": "fourth one was the favorite among",
    "start": "637440",
    "end": "638720"
  },
  {
    "text": "engineers We wanted to build our own",
    "start": "638720",
    "end": "640560"
  },
  {
    "text": "logging solution Yay who doesn't want",
    "start": "640560",
    "end": "643920"
  },
  {
    "text": "but then uh that did not make sense",
    "start": "643920",
    "end": "645680"
  },
  {
    "text": "because that is not Dropbox's core",
    "start": "645680",
    "end": "647680"
  },
  {
    "text": "competency uh open source and other",
    "start": "647680",
    "end": "650480"
  },
  {
    "text": "companies are doing fantastic job Uh why",
    "start": "650480",
    "end": "652959"
  },
  {
    "text": "not just you know leverage them uh so",
    "start": "652959",
    "end": "655440"
  },
  {
    "text": "that's why we rejected that as well So",
    "start": "655440",
    "end": "658240"
  },
  {
    "text": "here comes uh our final choice Loki U it",
    "start": "658240",
    "end": "662399"
  },
  {
    "text": "is open source uh so the total cost of",
    "start": "662399",
    "end": "664720"
  },
  {
    "text": "ownership is very low It is optimized",
    "start": "664720",
    "end": "667200"
  },
  {
    "text": "for high scale uh you know log injection",
    "start": "667200",
    "end": "670320"
  },
  {
    "text": "So it was perfect for our our use case",
    "start": "670320",
    "end": "672800"
  },
  {
    "text": "Uh the quering uh I mean the the read",
    "start": "672800",
    "end": "676160"
  },
  {
    "text": "path is equally performant uh with",
    "start": "676160",
    "end": "678399"
  },
  {
    "text": "graphana uh with Loki I'm sorry Uh it",
    "start": "678399",
    "end": "681519"
  },
  {
    "text": "has native graphana support because it",
    "start": "681519",
    "end": "683519"
  },
  {
    "text": "was built by graphana graphana Uh so it",
    "start": "683519",
    "end": "686160"
  },
  {
    "text": "was able to you know integrate with our",
    "start": "686160",
    "end": "688240"
  },
  {
    "text": "uh other tools as well And the",
    "start": "688240",
    "end": "690000"
  },
  {
    "text": "architecture is pretty scalable like you",
    "start": "690000",
    "end": "691519"
  },
  {
    "text": "can scale individual components",
    "start": "691519",
    "end": "693200"
  },
  {
    "text": "separately uh u there is good uh failure",
    "start": "693200",
    "end": "696480"
  },
  {
    "text": "mode if if things fail there are other",
    "start": "696480",
    "end": "698320"
  },
  {
    "text": "ways to recover uh so that's why we",
    "start": "698320",
    "end": "700959"
  },
  {
    "text": "chose Loki so what is Loki uh it's a",
    "start": "700959",
    "end": "704560"
  },
  {
    "text": "open-source uh software released under",
    "start": "704560",
    "end": "706800"
  },
  {
    "text": "Apache 2.0 O license which means it is",
    "start": "706800",
    "end": "709360"
  },
  {
    "text": "free to use and uh they encourage",
    "start": "709360",
    "end": "712399"
  },
  {
    "text": "community contribution Uh it is built to",
    "start": "712399",
    "end": "715279"
  },
  {
    "text": "scale Uh it is built to scale across",
    "start": "715279",
    "end": "717440"
  },
  {
    "text": "multiple nodes and uh uh it is designed",
    "start": "717440",
    "end": "721279"
  },
  {
    "text": "with high ability in mind So it remains",
    "start": "721279",
    "end": "723440"
  },
  {
    "text": "resilient even if individual component",
    "start": "723440",
    "end": "725519"
  },
  {
    "text": "fails Loki supports multi-tenency by",
    "start": "725519",
    "end": "728399"
  },
  {
    "text": "default uh meaning it can isolate logs",
    "start": "728399",
    "end": "732079"
  },
  {
    "text": "uh for each team or you know each",
    "start": "732079",
    "end": "734160"
  },
  {
    "text": "category of users Uh it is Prometheus",
    "start": "734160",
    "end": "736959"
  },
  {
    "text": "inspired uh uh pretty much it is uh like",
    "start": "736959",
    "end": "742000"
  },
  {
    "text": "I mean it is Prometheus uh for for",
    "start": "742000",
    "end": "744160"
  },
  {
    "text": "logging Uh at the core of it Loki is a",
    "start": "744160",
    "end": "746720"
  },
  {
    "text": "log aggregation system which uh which",
    "start": "746720",
    "end": "750000"
  },
  {
    "text": "scales very well uh which scales and you",
    "start": "750000",
    "end": "752320"
  },
  {
    "text": "know secures your log uh logs pretty",
    "start": "752320",
    "end": "756040"
  },
  {
    "text": "efficiently Uh let's look at a high",
    "start": "756040",
    "end": "760079"
  },
  {
    "text": "level architecture of",
    "start": "760079",
    "end": "762360"
  },
  {
    "text": "Loki like Prometheus Each node gets an",
    "start": "762360",
    "end": "766240"
  },
  {
    "text": "agent Uh in this case it is called",
    "start": "766240",
    "end": "768160"
  },
  {
    "text": "promptail It sits on each node It",
    "start": "768160",
    "end": "770000"
  },
  {
    "text": "collects logs But unlike Prometheus",
    "start": "770000",
    "end": "772320"
  },
  {
    "text": "which is a pull model Loki pushes uh uh",
    "start": "772320",
    "end": "775440"
  },
  {
    "text": "the prompt node pushes the logs to Loki",
    "start": "775440",
    "end": "777760"
  },
  {
    "text": "Uh why it does so you would ask uh",
    "start": "777760",
    "end": "780240"
  },
  {
    "text": "primly because the way uh logs are",
    "start": "780240",
    "end": "782320"
  },
  {
    "text": "generated the amount of logs which are",
    "start": "782320",
    "end": "784000"
  },
  {
    "text": "generated compared to metrics is quite",
    "start": "784000",
    "end": "785760"
  },
  {
    "text": "different At such high scale uh the push",
    "start": "785760",
    "end": "787920"
  },
  {
    "text": "model works better Once the log logs are",
    "start": "787920",
    "end": "790399"
  },
  {
    "text": "ingested in Loki Loki takes care of",
    "start": "790399",
    "end": "792079"
  },
  {
    "text": "indexing it and then it exposes two ways",
    "start": "792079",
    "end": "795040"
  },
  {
    "text": "of uh quering it Either you can use",
    "start": "795040",
    "end": "797000"
  },
  {
    "text": "graphana or it also provides log CLI if",
    "start": "797000",
    "end": "799680"
  },
  {
    "text": "you are a CLI person and that's it Uh at",
    "start": "799680",
    "end": "802959"
  },
  {
    "text": "high level this is the uh simple",
    "start": "802959",
    "end": "805200"
  },
  {
    "text": "architecture",
    "start": "805200",
    "end": "807920"
  },
  {
    "text": "Uh one significant difference uh Loki",
    "start": "807920",
    "end": "810959"
  },
  {
    "text": "has uh with other uh logging solutions",
    "start": "810959",
    "end": "813360"
  },
  {
    "text": "is uh is its ability to manage the cost",
    "start": "813360",
    "end": "817360"
  },
  {
    "text": "down and it does that by not indexing",
    "start": "817360",
    "end": "821040"
  },
  {
    "text": "entirety of the log Loki only indexes",
    "start": "821040",
    "end": "823279"
  },
  {
    "text": "your metadata uh because of that the",
    "start": "823279",
    "end": "827120"
  },
  {
    "text": "size of metadata is less uh the qu I",
    "start": "827120",
    "end": "830000"
  },
  {
    "text": "mean the range of space where it has to",
    "start": "830000",
    "end": "831680"
  },
  {
    "text": "look for a log is less and and that's",
    "start": "831680",
    "end": "833920"
  },
  {
    "text": "how it is able to uh that is how it is",
    "start": "833920",
    "end": "836079"
  },
  {
    "text": "able to scale uh the log Loki logs are",
    "start": "836079",
    "end": "839440"
  },
  {
    "text": "grouped as uh into streams and these",
    "start": "839440",
    "end": "842160"
  },
  {
    "text": "streams are what are",
    "start": "842160",
    "end": "844959"
  },
  {
    "text": "indexed so let's look at an example Loki",
    "start": "846680",
    "end": "850079"
  },
  {
    "text": "log",
    "start": "850079",
    "end": "851720"
  },
  {
    "text": "u actually it is any logi break takes",
    "start": "851720",
    "end": "854639"
  },
  {
    "text": "down a log into three component Time",
    "start": "854639",
    "end": "857040"
  },
  {
    "text": "stamp which is the time at which the log",
    "start": "857040",
    "end": "859440"
  },
  {
    "text": "was generated uh down to nancond and the",
    "start": "859440",
    "end": "862560"
  },
  {
    "text": "second part is the key value pair It's",
    "start": "862560",
    "end": "864800"
  },
  {
    "text": "Prometheus inspired key value pair and",
    "start": "864800",
    "end": "867680"
  },
  {
    "text": "the third part is the content Uh as I",
    "start": "867680",
    "end": "869920"
  },
  {
    "text": "told you uh the key value part is the",
    "start": "869920",
    "end": "872160"
  },
  {
    "text": "metadata which gets indexed remaining",
    "start": "872160",
    "end": "874480"
  },
  {
    "text": "everything content uh is not indexed and",
    "start": "874480",
    "end": "876639"
  },
  {
    "text": "it is stored separately",
    "start": "876639",
    "end": "880199"
  },
  {
    "text": "uh a log stream uh uh a log stream is a",
    "start": "881120",
    "end": "884079"
  },
  {
    "text": "stream of log entries with exact same",
    "start": "884079",
    "end": "886320"
  },
  {
    "text": "label set So in this case let's say you",
    "start": "886320",
    "end": "888560"
  },
  {
    "text": "have two applications running on two",
    "start": "888560",
    "end": "890480"
  },
  {
    "text": "different nodes Uh so uh the stream from",
    "start": "890480",
    "end": "894160"
  },
  {
    "text": "one node example node one will be all",
    "start": "894160",
    "end": "896720"
  },
  {
    "text": "collected together because the label set",
    "start": "896720",
    "end": "898959"
  },
  {
    "text": "is same Service equals dummy node and",
    "start": "898959",
    "end": "901199"
  },
  {
    "text": "node ID equals example node one All of",
    "start": "901199",
    "end": "903839"
  },
  {
    "text": "these will form uh one log stream",
    "start": "903839",
    "end": "906000"
  },
  {
    "text": "whereas no uh logs being generated by",
    "start": "906000",
    "end": "908399"
  },
  {
    "text": "second node log uh example node two is",
    "start": "908399",
    "end": "910880"
  },
  {
    "text": "your second uh log stream",
    "start": "910880",
    "end": "914519"
  },
  {
    "text": "here Uh now now let's talk about how",
    "start": "914519",
    "end": "917440"
  },
  {
    "text": "Loki stores logs efficiently Uh logs in",
    "start": "917440",
    "end": "920800"
  },
  {
    "text": "Loki are grouped into chunks Each log",
    "start": "920800",
    "end": "923760"
  },
  {
    "text": "stream is separate stored in a separate",
    "start": "923760",
    "end": "925760"
  },
  {
    "text": "chunk and these chunks are sorted in",
    "start": "925760",
    "end": "928639"
  },
  {
    "text": "time stamp order A chunk continues",
    "start": "928639",
    "end": "931680"
  },
  {
    "text": "collecting logs until it reaches either",
    "start": "931680",
    "end": "933519"
  },
  {
    "text": "a target size or a timeout occurs Once a",
    "start": "933519",
    "end": "937040"
  },
  {
    "text": "chunk is full uh Loki will compress it",
    "start": "937040",
    "end": "939680"
  },
  {
    "text": "and flush it to an object store The",
    "start": "939680",
    "end": "941920"
  },
  {
    "text": "object store could be anything It could",
    "start": "941920",
    "end": "943360"
  },
  {
    "text": "be uh S3 Uh that is what we started",
    "start": "943360",
    "end": "946079"
  },
  {
    "text": "using It could be Google cloud as your",
    "start": "946079",
    "end": "948079"
  },
  {
    "text": "blobs or it even it could be you know",
    "start": "948079",
    "end": "950240"
  },
  {
    "text": "your own homegrown object store or even",
    "start": "950240",
    "end": "952720"
  },
  {
    "text": "file system Uh as long as it has the",
    "start": "952720",
    "end": "955360"
  },
  {
    "text": "interface uh doesn't matter where you",
    "start": "955360",
    "end": "956880"
  },
  {
    "text": "are storing it",
    "start": "956880",
    "end": "959839"
  },
  {
    "text": "So uh how does uh how do we retrieve",
    "start": "959839",
    "end": "962880"
  },
  {
    "text": "Loki logs uh I mean how does it retrieve",
    "start": "962880",
    "end": "965360"
  },
  {
    "text": "logs",
    "start": "965360",
    "end": "966279"
  },
  {
    "text": "efficiently uh when a query comes like",
    "start": "966279",
    "end": "969279"
  },
  {
    "text": "uh in this example let's say this one",
    "start": "969279",
    "end": "971040"
  },
  {
    "text": "dummy service node ID 1 it will first",
    "start": "971040",
    "end": "974160"
  },
  {
    "text": "try to figure out where that chunk is",
    "start": "974160",
    "end": "976079"
  },
  {
    "text": "stored in this case the top query is in",
    "start": "976079",
    "end": "978480"
  },
  {
    "text": "the top chunk the second one is in the",
    "start": "978480",
    "end": "980160"
  },
  {
    "text": "second one so Loki instead of looking",
    "start": "980160",
    "end": "982240"
  },
  {
    "text": "through all of the chunks it will just",
    "start": "982240",
    "end": "983839"
  },
  {
    "text": "try to hash this uh query figure out",
    "start": "983839",
    "end": "986399"
  },
  {
    "text": "where the chunk is stored and just look",
    "start": "986399",
    "end": "988800"
  },
  {
    "text": "through those",
    "start": "988800",
    "end": "990360"
  },
  {
    "text": "chunks Uh so in uh uh so in this example",
    "start": "990360",
    "end": "994399"
  },
  {
    "text": "let's say if you are just looking for a",
    "start": "994399",
    "end": "995920"
  },
  {
    "text": "dummy service you're not specifying",
    "start": "995920",
    "end": "997600"
  },
  {
    "text": "which node you wanted and you are",
    "start": "997600",
    "end": "999279"
  },
  {
    "text": "specifying a time stamp from T5 to T7 So",
    "start": "999279",
    "end": "1001680"
  },
  {
    "text": "in this case Loki knows that uh the the",
    "start": "1001680",
    "end": "1004880"
  },
  {
    "text": "label service is stored in these two",
    "start": "1004880",
    "end": "1006720"
  },
  {
    "text": "chunks So it will start going through uh",
    "start": "1006720",
    "end": "1008959"
  },
  {
    "text": "chunks one and two It will start looking",
    "start": "1008959",
    "end": "1011279"
  },
  {
    "text": "for time stamp range uh uh as per the",
    "start": "1011279",
    "end": "1014160"
  },
  {
    "text": "query and figure out which all chunks it",
    "start": "1014160",
    "end": "1015839"
  },
  {
    "text": "needs to pull out Uh now one one thing",
    "start": "1015839",
    "end": "1017839"
  },
  {
    "text": "to note here is uh the the time stamp in",
    "start": "1017839",
    "end": "1020240"
  },
  {
    "text": "both the chunks are different The first",
    "start": "1020240",
    "end": "1022000"
  },
  {
    "text": "one has T1 to 5 as first chunk Second",
    "start": "1022000",
    "end": "1024798"
  },
  {
    "text": "one has t1 to3 The reason for that is",
    "start": "1024799",
    "end": "1027760"
  },
  {
    "text": "different uh different nodes can produce",
    "start": "1027760",
    "end": "1030640"
  },
  {
    "text": "logs at different rate And depending on",
    "start": "1030640",
    "end": "1032959"
  },
  {
    "text": "when a particular bucket is full uh that",
    "start": "1032959",
    "end": "1035038"
  },
  {
    "text": "is what is get uh getting stored in the",
    "start": "1035039",
    "end": "1037199"
  },
  {
    "text": "chunk So in this case Loki looks for",
    "start": "1037199",
    "end": "1040240"
  },
  {
    "text": "first and second chunks in the first one",
    "start": "1040240",
    "end": "1041839"
  },
  {
    "text": "and second and third chunk in the second",
    "start": "1041839",
    "end": "1043760"
  },
  {
    "text": "one and combines them together filters",
    "start": "1043760",
    "end": "1045839"
  },
  {
    "text": "out the time stamp which was not needed",
    "start": "1045839",
    "end": "1048000"
  },
  {
    "text": "and it will return back the uh the",
    "start": "1048000",
    "end": "1050320"
  },
  {
    "text": "result to",
    "start": "1050320",
    "end": "1051240"
  },
  {
    "text": "graphfana Now one thing to note here",
    "start": "1051240",
    "end": "1054600"
  },
  {
    "text": "is in this case since we node ID had two",
    "start": "1054600",
    "end": "1058480"
  },
  {
    "text": "different values we have two chunks If",
    "start": "1058480",
    "end": "1061120"
  },
  {
    "text": "node ID had multiple such values we'll",
    "start": "1061120",
    "end": "1064080"
  },
  {
    "text": "have multiple chunks Basically what I'm",
    "start": "1064080",
    "end": "1065840"
  },
  {
    "text": "talking about is cardality right in this",
    "start": "1065840",
    "end": "1067840"
  },
  {
    "text": "case service has only one value and node",
    "start": "1067840",
    "end": "1069840"
  },
  {
    "text": "ID has two value so one into two we have",
    "start": "1069840",
    "end": "1071760"
  },
  {
    "text": "two streams but for uh but if we had",
    "start": "1071760",
    "end": "1074880"
  },
  {
    "text": "multiple such values uh it just",
    "start": "1074880",
    "end": "1077200"
  },
  {
    "text": "multiplies like for example the last",
    "start": "1077200",
    "end": "1079280"
  },
  {
    "text": "point let's say you were using log level",
    "start": "1079280",
    "end": "1081520"
  },
  {
    "text": "as one of your keys and it has four",
    "start": "1081520",
    "end": "1083440"
  },
  {
    "text": "different values status has three values",
    "start": "1083440",
    "end": "1085760"
  },
  {
    "text": "and path has three value that means 4",
    "start": "1085760",
    "end": "1088160"
  },
  {
    "text": "into 3 into 3 is 36 unique stream so",
    "start": "1088160",
    "end": "1091039"
  },
  {
    "text": "when you are defining these key value",
    "start": "1091039",
    "end": "1092640"
  },
  {
    "text": "pairs it is very important that you pay",
    "start": "1092640",
    "end": "1094559"
  },
  {
    "text": "close attention to it because this is",
    "start": "1094559",
    "end": "1096080"
  },
  {
    "text": "what drives your query performance Uh so",
    "start": "1096080",
    "end": "1099360"
  },
  {
    "text": "just be mindful of label selection Uh",
    "start": "1099360",
    "end": "1101520"
  },
  {
    "text": "avoid you know high cardality like",
    "start": "1101520",
    "end": "1104000"
  },
  {
    "text": "tracing trace ID user ID or or status Uh",
    "start": "1104000",
    "end": "1108400"
  },
  {
    "text": "uh the other side would be use cluster",
    "start": "1108400",
    "end": "1111200"
  },
  {
    "text": "app or file name uh as your",
    "start": "1111200",
    "end": "1115640"
  },
  {
    "text": "keys So uh with that brief introduction",
    "start": "1115640",
    "end": "1118480"
  },
  {
    "text": "about Loki let's talk about what we have",
    "start": "1118480",
    "end": "1120320"
  },
  {
    "text": "done at Dropbox",
    "start": "1120320",
    "end": "1122559"
  },
  {
    "text": "This diagram gives a high level",
    "start": "1122559",
    "end": "1124559"
  },
  {
    "text": "architecture of how how Loki operates Uh",
    "start": "1124559",
    "end": "1127679"
  },
  {
    "text": "on top we have the uh yellow boxes with",
    "start": "1127679",
    "end": "1130799"
  },
  {
    "text": "write and read paths Uh in the bottom",
    "start": "1130799",
    "end": "1133280"
  },
  {
    "text": "the green one is the object store Right",
    "start": "1133280",
    "end": "1135280"
  },
  {
    "text": "side blue one is the shared service like",
    "start": "1135280",
    "end": "1137360"
  },
  {
    "text": "memcache used by everyone and bottom is",
    "start": "1137360",
    "end": "1140080"
  },
  {
    "text": "clusterwide things like compactor and",
    "start": "1140080",
    "end": "1142080"
  },
  {
    "text": "the distributed uh key value store So",
    "start": "1142080",
    "end": "1144480"
  },
  {
    "text": "when a log comes to distributor uh it",
    "start": "1144480",
    "end": "1147440"
  },
  {
    "text": "keeps accepting logs uh uh till it fills",
    "start": "1147440",
    "end": "1150480"
  },
  {
    "text": "a val uh till a target size is reached",
    "start": "1150480",
    "end": "1152799"
  },
  {
    "text": "From there it starts hashing those logs",
    "start": "1152799",
    "end": "1156080"
  },
  {
    "text": "and tries to figure out where uh the",
    "start": "1156080",
    "end": "1158080"
  },
  {
    "text": "ingesttor is located This information",
    "start": "1158080",
    "end": "1160400"
  },
  {
    "text": "this membership is stored in hash ring",
    "start": "1160400",
    "end": "1162799"
  },
  {
    "text": "which is typically uh stored in scd So",
    "start": "1162799",
    "end": "1166160"
  },
  {
    "text": "once it identifies which injector this",
    "start": "1166160",
    "end": "1168400"
  },
  {
    "text": "log has to go to it writes to injester",
    "start": "1168400",
    "end": "1170960"
  },
  {
    "text": "Similarly at ing injester you keep",
    "start": "1170960",
    "end": "1172400"
  },
  {
    "text": "ingesting n uh logs till it reaches a",
    "start": "1172400",
    "end": "1175039"
  },
  {
    "text": "sufficient value From there you compress",
    "start": "1175039",
    "end": "1177360"
  },
  {
    "text": "it and store it in your object store",
    "start": "1177360",
    "end": "1180000"
  },
  {
    "text": "Compactor works uh behind the scene It",
    "start": "1180000",
    "end": "1182400"
  },
  {
    "text": "it keeps an eye on uh on logs which can",
    "start": "1182400",
    "end": "1184720"
  },
  {
    "text": "be merged together And frequently it",
    "start": "1184720",
    "end": "1186880"
  },
  {
    "text": "will you know just uh look for logs",
    "start": "1186880",
    "end": "1188720"
  },
  {
    "text": "which can be merged together merge it",
    "start": "1188720",
    "end": "1190640"
  },
  {
    "text": "compress it and store it in in the",
    "start": "1190640",
    "end": "1192160"
  },
  {
    "text": "object store On the read path when a",
    "start": "1192160",
    "end": "1194400"
  },
  {
    "text": "query comes to query front end it",
    "start": "1194400",
    "end": "1195919"
  },
  {
    "text": "divides it into uh separate subqueries",
    "start": "1195919",
    "end": "1198880"
  },
  {
    "text": "uh gives it to quer quer will look into",
    "start": "1198880",
    "end": "1201760"
  },
  {
    "text": "in-memory cache for recent logs or",
    "start": "1201760",
    "end": "1204400"
  },
  {
    "text": "object store for older logs and then it",
    "start": "1204400",
    "end": "1206320"
  },
  {
    "text": "will combine those results and send it",
    "start": "1206320",
    "end": "1208160"
  },
  {
    "text": "back to uh uh back to",
    "start": "1208160",
    "end": "1212240"
  },
  {
    "text": "graphana Uh for a sense of the scale of",
    "start": "1213000",
    "end": "1216320"
  },
  {
    "text": "our Loki deployment here are some top",
    "start": "1216320",
    "end": "1217919"
  },
  {
    "text": "level metric Uh we are processing 10 GB",
    "start": "1217919",
    "end": "1221039"
  },
  {
    "text": "of logs per second Our 30 days of logs",
    "start": "1221039",
    "end": "1225120"
  },
  {
    "text": "is equaling around 10 pabyte uh of data",
    "start": "1225120",
    "end": "1228559"
  },
  {
    "text": "stored in our object store Right now we",
    "start": "1228559",
    "end": "1230400"
  },
  {
    "text": "are supporting 30 days of log retention",
    "start": "1230400",
    "end": "1233360"
  },
  {
    "text": "We have close to,000 tenants and our",
    "start": "1233360",
    "end": "1236400"
  },
  {
    "text": "read query is very less like less than",
    "start": "1236400",
    "end": "1238400"
  },
  {
    "text": "one one query per second That's why most",
    "start": "1238400",
    "end": "1240559"
  },
  {
    "text": "of the things we have done is on the",
    "start": "1240559",
    "end": "1242240"
  },
  {
    "text": "injection side not so much on the uh on",
    "start": "1242240",
    "end": "1245200"
  },
  {
    "text": "the read path",
    "start": "1245200",
    "end": "1248000"
  },
  {
    "text": "Uh with Dropbox being a storage company",
    "start": "1248000",
    "end": "1250640"
  },
  {
    "text": "one thing we did uh is use our internal",
    "start": "1250640",
    "end": "1253360"
  },
  {
    "text": "object store uh as a drop-in replacement",
    "start": "1253360",
    "end": "1255520"
  },
  {
    "text": "for S3 Uh this significantly lowered our",
    "start": "1255520",
    "end": "1258559"
  },
  {
    "text": "cost Uh uh it uh not only uh because it",
    "start": "1258559",
    "end": "1262799"
  },
  {
    "text": "uh reduced our cost we were able to",
    "start": "1262799",
    "end": "1264640"
  },
  {
    "text": "increase the retention Now we have gone",
    "start": "1264640",
    "end": "1266480"
  },
  {
    "text": "to 4 weeks Our object store is built on",
    "start": "1266480",
    "end": "1269280"
  },
  {
    "text": "top of Magic Pocket Uh if you don't know",
    "start": "1269280",
    "end": "1271600"
  },
  {
    "text": "about Magic Pocket it's our you know",
    "start": "1271600",
    "end": "1273280"
  },
  {
    "text": "Xabyte scale uh key value uh storage",
    "start": "1273280",
    "end": "1276640"
  },
  {
    "text": "system uh this is where your files are",
    "start": "1276640",
    "end": "1279039"
  },
  {
    "text": "stored So we have built our object store",
    "start": "1279039",
    "end": "1280960"
  },
  {
    "text": "on top of it Object mega magic pocket is",
    "start": "1280960",
    "end": "1283679"
  },
  {
    "text": "optimized for 4 megabyte block So our",
    "start": "1283679",
    "end": "1286080"
  },
  {
    "text": "object store works very well for small",
    "start": "1286080",
    "end": "1288080"
  },
  {
    "text": "object and that's when we that's where",
    "start": "1288080",
    "end": "1290400"
  },
  {
    "text": "we saw uh that in comparison to S3 not",
    "start": "1290400",
    "end": "1292799"
  },
  {
    "text": "only we were storing our files uh at a",
    "start": "1292799",
    "end": "1296880"
  },
  {
    "text": "at a cheaper price but uh uh I'm sorry I",
    "start": "1296880",
    "end": "1300640"
  },
  {
    "text": "got distracted uh we were not only",
    "start": "1300640",
    "end": "1303280"
  },
  {
    "text": "storing it at cheaper cost but our",
    "start": "1303280",
    "end": "1305280"
  },
  {
    "text": "performance was also better for smaller",
    "start": "1305280",
    "end": "1307120"
  },
  {
    "text": "object for larger object we are still",
    "start": "1307120",
    "end": "1309200"
  },
  {
    "text": "using uh uh S3 and since object store is",
    "start": "1309200",
    "end": "1312799"
  },
  {
    "text": "in our hand we are able to reserve",
    "start": "1312799",
    "end": "1314159"
  },
  {
    "text": "capacity for it we are able to add",
    "start": "1314159",
    "end": "1315600"
  },
  {
    "text": "emergency capacity to it so uh it has",
    "start": "1315600",
    "end": "1318480"
  },
  {
    "text": "worked out very well for",
    "start": "1318480",
    "end": "1320600"
  },
  {
    "text": "us Loki uh supports multi-tenency by",
    "start": "1320600",
    "end": "1324320"
  },
  {
    "text": "default uh what that means for us is uh",
    "start": "1324320",
    "end": "1327919"
  },
  {
    "text": "for us tenant is service uh and uh It it",
    "start": "1327919",
    "end": "1331440"
  },
  {
    "text": "it works very well for for our existing",
    "start": "1331440",
    "end": "1333440"
  },
  {
    "text": "model because earlier service owners",
    "start": "1333440",
    "end": "1335440"
  },
  {
    "text": "will have SSH access to a to a",
    "start": "1335440",
    "end": "1337520"
  },
  {
    "text": "particular host Now they have access to",
    "start": "1337520",
    "end": "1340159"
  },
  {
    "text": "same accesses transferred to uh uh to",
    "start": "1340159",
    "end": "1343600"
  },
  {
    "text": "Loki logs Uh there are some pro some",
    "start": "1343600",
    "end": "1346080"
  },
  {
    "text": "services which produce ton of ton of",
    "start": "1346080",
    "end": "1347760"
  },
  {
    "text": "logs So we have divided them by uh",
    "start": "1347760",
    "end": "1349679"
  },
  {
    "text": "project and the ownership is at project",
    "start": "1349679",
    "end": "1352520"
  },
  {
    "text": "level Uh as I said previously uh O was",
    "start": "1352520",
    "end": "1356400"
  },
  {
    "text": "based on SSH access Now it is on log",
    "start": "1356400",
    "end": "1358559"
  },
  {
    "text": "viewing",
    "start": "1358559",
    "end": "1359880"
  },
  {
    "text": "uh we what we did uh one thing we did",
    "start": "1359880",
    "end": "1362799"
  },
  {
    "text": "here was we wrote our own custom query o",
    "start": "1362799",
    "end": "1365120"
  },
  {
    "text": "proxy because of this uh we don't have",
    "start": "1365120",
    "end": "1368000"
  },
  {
    "text": "we we are avoiding graphana's complex",
    "start": "1368000",
    "end": "1370159"
  },
  {
    "text": "arbback model and also uh in order to",
    "start": "1370159",
    "end": "1372880"
  },
  {
    "text": "use graphana's model we would have to",
    "start": "1372880",
    "end": "1374720"
  },
  {
    "text": "get uh graphfana enterprise so we were",
    "start": "1374720",
    "end": "1376799"
  },
  {
    "text": "able to avoid that as well",
    "start": "1376799",
    "end": "1380320"
  },
  {
    "text": "uh now uh one interesting thing here is",
    "start": "1380320",
    "end": "1383240"
  },
  {
    "text": "u how do teams share their uh logs let's",
    "start": "1383240",
    "end": "1386640"
  },
  {
    "text": "say team a wants to share their logs",
    "start": "1386640",
    "end": "1388240"
  },
  {
    "text": "with team B uh our way is uh uh",
    "start": "1388240",
    "end": "1391840"
  },
  {
    "text": "permission is owned by team A Team B",
    "start": "1391840",
    "end": "1393520"
  },
  {
    "text": "will request it Team A will authorize it",
    "start": "1393520",
    "end": "1395360"
  },
  {
    "text": "and we'll roll it out It works very well",
    "start": "1395360",
    "end": "1398000"
  },
  {
    "text": "uh for most cases except when you are in",
    "start": "1398000",
    "end": "1400400"
  },
  {
    "text": "SEV Uh during that time even this small",
    "start": "1400400",
    "end": "1403280"
  },
  {
    "text": "delay is expensive So that's why we have",
    "start": "1403280",
    "end": "1406080"
  },
  {
    "text": "introduced a concept called break glass",
    "start": "1406080",
    "end": "1408080"
  },
  {
    "text": "Uh it basically allows any user with a",
    "start": "1408080",
    "end": "1410400"
  },
  {
    "text": "justified reason to get access to any uh",
    "start": "1410400",
    "end": "1412880"
  },
  {
    "text": "any services log Of course it is heavily",
    "start": "1412880",
    "end": "1415280"
  },
  {
    "text": "audited uh we have lot of safeguards in",
    "start": "1415280",
    "end": "1418000"
  },
  {
    "text": "place to make sure unauthorized access",
    "start": "1418000",
    "end": "1420159"
  },
  {
    "text": "doesn't",
    "start": "1420159",
    "end": "1421000"
  },
  {
    "text": "happen U we we run Loki in multiple data",
    "start": "1421000",
    "end": "1424320"
  },
  {
    "text": "center at Dropbox we call it uh",
    "start": "1424320",
    "end": "1426600"
  },
  {
    "text": "multihoming Uh we use same object store",
    "start": "1426600",
    "end": "1429200"
  },
  {
    "text": "in both both regions and uh and and we",
    "start": "1429200",
    "end": "1432799"
  },
  {
    "text": "you know reroute the requests based on",
    "start": "1432799",
    "end": "1434720"
  },
  {
    "text": "DNS I mean standard",
    "start": "1434720",
    "end": "1439120"
  },
  {
    "text": "stuff Okay By default uh Loki has this",
    "start": "1441159",
    "end": "1444720"
  },
  {
    "text": "concept of uh wall write ahead log and u",
    "start": "1444720",
    "end": "1449200"
  },
  {
    "text": "it is used to recover logs when injust",
    "start": "1449200",
    "end": "1451360"
  },
  {
    "text": "exit u injector exits before flushing it",
    "start": "1451360",
    "end": "1454799"
  },
  {
    "text": "Uh at Dropbox we we disabled it because",
    "start": "1454799",
    "end": "1458159"
  },
  {
    "text": "we wanted to prioritize availability",
    "start": "1458159",
    "end": "1460159"
  },
  {
    "text": "over",
    "start": "1460159",
    "end": "1462480"
  },
  {
    "text": "durability Uh in order to avoid in order",
    "start": "1462840",
    "end": "1465919"
  },
  {
    "text": "to avoid uh noisy neighbor problem uh we",
    "start": "1465919",
    "end": "1469200"
  },
  {
    "text": "have implemented we have added I think",
    "start": "1469200",
    "end": "1470640"
  },
  {
    "text": "Loki supports it by default We have",
    "start": "1470640",
    "end": "1472080"
  },
  {
    "text": "added per tenant rate limits Uh so you",
    "start": "1472080",
    "end": "1475440"
  },
  {
    "text": "know but these are all configurables If",
    "start": "1475440",
    "end": "1477520"
  },
  {
    "text": "if a if a team reaches out to us uh if",
    "start": "1477520",
    "end": "1480159"
  },
  {
    "text": "they are alerted by by a page uh uh this",
    "start": "1480159",
    "end": "1483120"
  },
  {
    "text": "can be modified and we we roll it out uh",
    "start": "1483120",
    "end": "1486159"
  },
  {
    "text": "the changes Uh one important thing is uh",
    "start": "1486159",
    "end": "1489200"
  },
  {
    "text": "hashing Uh Loki uses hashing to track",
    "start": "1489200",
    "end": "1492720"
  },
  {
    "text": "which ingesttor is ingesting which part",
    "start": "1492720",
    "end": "1495360"
  },
  {
    "text": "of the chunk uh and uh the way it works",
    "start": "1495360",
    "end": "1498320"
  },
  {
    "text": "is injester will keep announcing hey I",
    "start": "1498320",
    "end": "1500640"
  },
  {
    "text": "own this hash ring and periodically they",
    "start": "1500640",
    "end": "1503200"
  },
  {
    "text": "will also announce that hey I'm alive so",
    "start": "1503200",
    "end": "1505360"
  },
  {
    "text": "this is my heartbeat uh and typically",
    "start": "1505360",
    "end": "1507679"
  },
  {
    "text": "this is stored in a distributed key",
    "start": "1507679",
    "end": "1509600"
  },
  {
    "text": "value store we were using for it so",
    "start": "1509600",
    "end": "1512080"
  },
  {
    "text": "something like this",
    "start": "1512080",
    "end": "1515080"
  },
  {
    "text": "u and uh you know is widely used for",
    "start": "1515080",
    "end": "1518799"
  },
  {
    "text": "coordination and configuration uh uh",
    "start": "1518799",
    "end": "1521200"
  },
  {
    "text": "systems it is very widely used at",
    "start": "1521200",
    "end": "1523039"
  },
  {
    "text": "Dropbox so it was our choice as well but",
    "start": "1523039",
    "end": "1525200"
  },
  {
    "text": "something we faced with it was a right",
    "start": "1525200",
    "end": "1527039"
  },
  {
    "text": "contention Since uh these updates are",
    "start": "1527039",
    "end": "1529679"
  },
  {
    "text": "sent so frequently and HCD was storing",
    "start": "1529679",
    "end": "1532559"
  },
  {
    "text": "this entire information as one giant",
    "start": "1532559",
    "end": "1535600"
  },
  {
    "text": "binary blob and uh this blob oper uh",
    "start": "1535600",
    "end": "1538559"
  },
  {
    "text": "would be updated using read plus compare",
    "start": "1538559",
    "end": "1540799"
  },
  {
    "text": "and swap operation Uh this was giving us",
    "start": "1540799",
    "end": "1543200"
  },
  {
    "text": "a lot of issues Uh you know with just",
    "start": "1543200",
    "end": "1545720"
  },
  {
    "text": "replication factor of three and 67",
    "start": "1545720",
    "end": "1548480"
  },
  {
    "text": "ingestion uh ingesters we were looking",
    "start": "1548480",
    "end": "1550880"
  },
  {
    "text": "at 201t total injusters So because of",
    "start": "1550880",
    "end": "1553760"
  },
  {
    "text": "this uh you know our deployment was slow",
    "start": "1553760",
    "end": "1556559"
  },
  {
    "text": "uh during deployment there will be",
    "start": "1556559",
    "end": "1558000"
  },
  {
    "text": "availability alerts because of which",
    "start": "1558000",
    "end": "1559600"
  },
  {
    "text": "deployment will be uh paused or we'll",
    "start": "1559600",
    "end": "1561440"
  },
  {
    "text": "have to roll it back and was uh turning",
    "start": "1561440",
    "end": "1564320"
  },
  {
    "text": "out to be a single point of failure for",
    "start": "1564320",
    "end": "1566360"
  },
  {
    "text": "us Luckily graphana made member list uh",
    "start": "1566360",
    "end": "1569760"
  },
  {
    "text": "as the default uh distributed key value",
    "start": "1569760",
    "end": "1572080"
  },
  {
    "text": "store for Loki Uh member list is a key",
    "start": "1572080",
    "end": "1575440"
  },
  {
    "text": "to key uh peer-to-peer uh gossip",
    "start": "1575440",
    "end": "1577919"
  },
  {
    "text": "protocol So there is no centralized",
    "start": "1577919",
    "end": "1579679"
  },
  {
    "text": "entity",
    "start": "1579679",
    "end": "1581360"
  },
  {
    "text": "uh and also uh the updates are sent in",
    "start": "1581360",
    "end": "1583760"
  },
  {
    "text": "delta instead of entire blob being",
    "start": "1583760",
    "end": "1586200"
  },
  {
    "text": "replaced But the drawback here is it is",
    "start": "1586200",
    "end": "1589120"
  },
  {
    "text": "eventually consistent So that means our",
    "start": "1589120",
    "end": "1592240"
  },
  {
    "text": "deployments are still you know",
    "start": "1592240",
    "end": "1594760"
  },
  {
    "text": "sequential Uh our deployments are still",
    "start": "1594760",
    "end": "1597080"
  },
  {
    "text": "sequential but that means uh you know",
    "start": "1597080",
    "end": "1600159"
  },
  {
    "text": "the the pros out heavily outweigh the",
    "start": "1600159",
    "end": "1602640"
  },
  {
    "text": "cons So we we are pretty happy with it",
    "start": "1602640",
    "end": "1604960"
  },
  {
    "text": "In fact for the past one and a half year",
    "start": "1604960",
    "end": "1606960"
  },
  {
    "text": "we have not faced any issues and we have",
    "start": "1606960",
    "end": "1608720"
  },
  {
    "text": "been able to double the number of",
    "start": "1608720",
    "end": "1609840"
  },
  {
    "text": "ingesters we have Uh one last slide Uh",
    "start": "1609840",
    "end": "1614640"
  },
  {
    "text": "you know the log indexes are you know",
    "start": "1614640",
    "end": "1616720"
  },
  {
    "text": "determine your query plan Uh they",
    "start": "1616720",
    "end": "1618880"
  },
  {
    "text": "determine how many log chunks has to be",
    "start": "1618880",
    "end": "1621120"
  },
  {
    "text": "fetched uh previously we are using bold",
    "start": "1621120",
    "end": "1623440"
  },
  {
    "text": "DB but uh recently Grafana introduced",
    "start": "1623440",
    "end": "1626559"
  },
  {
    "text": "TSDB which is like uh Prometheus's uh uh",
    "start": "1626559",
    "end": "1630000"
  },
  {
    "text": "you know uh database and it it is more",
    "start": "1630000",
    "end": "1633120"
  },
  {
    "text": "suited for key value uh type of uh",
    "start": "1633120",
    "end": "1635520"
  },
  {
    "text": "objects Uh so this has uh massively",
    "start": "1635520",
    "end": "1638799"
  },
  {
    "text": "helped us with our query performance Uh",
    "start": "1638799",
    "end": "1641120"
  },
  {
    "text": "with that u the summary of what I have",
    "start": "1641120",
    "end": "1644799"
  },
  {
    "text": "been talking our our goal was to scale",
    "start": "1644799",
    "end": "1646960"
  },
  {
    "text": "and enhance observability at Dropbox uh",
    "start": "1646960",
    "end": "1649440"
  },
  {
    "text": "we wanted to eliminate manual SSH",
    "start": "1649440",
    "end": "1651440"
  },
  {
    "text": "analysis of uh of the logs We our",
    "start": "1651440",
    "end": "1655120"
  },
  {
    "text": "approach basically was evaluating all",
    "start": "1655120",
    "end": "1657120"
  },
  {
    "text": "the solutions and uh we came to the",
    "start": "1657120",
    "end": "1659440"
  },
  {
    "text": "conclusion that Loki was the most",
    "start": "1659440",
    "end": "1661520"
  },
  {
    "text": "cost-ffective and high performance",
    "start": "1661520",
    "end": "1662960"
  },
  {
    "text": "logging solution and now uh you know the",
    "start": "1662960",
    "end": "1666720"
  },
  {
    "text": "the entire observability experience at",
    "start": "1666720",
    "end": "1668960"
  },
  {
    "text": "Dropbox has improved We have improved",
    "start": "1668960",
    "end": "1670640"
  },
  {
    "text": "retention We have reduced cost and we",
    "start": "1670640",
    "end": "1673120"
  },
  {
    "text": "have we have we have a multi-",
    "start": "1673120",
    "end": "1674720"
  },
  {
    "text": "multi-tenant uh logging solution in",
    "start": "1674720",
    "end": "1676960"
  },
  {
    "text": "place right now So that is all I have",
    "start": "1676960",
    "end": "1679120"
  },
  {
    "text": "Thank you",
    "start": "1679120",
    "end": "1682360"
  },
  {
    "text": "[Applause]",
    "start": "1683630",
    "end": "1686149"
  }
]