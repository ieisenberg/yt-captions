[
  {
    "text": "all right why don't we go ahead and get started good afternoon again and welcome to the ops track thank you for for",
    "start": "1010",
    "end": "8460"
  },
  {
    "text": "joining us the session is enforcing service measure structure using gatekeeper and so Cindy from Google",
    "start": "8460",
    "end": "14309"
  },
  {
    "text": "Cloud take it away you'll hear me okay that's good all right all right thanks",
    "start": "14309",
    "end": "21150"
  },
  {
    "text": "for joining thanks for coming out this is enforcing service mesh using OPA gatekeeper or one of the last sessions",
    "start": "21150",
    "end": "29039"
  },
  {
    "text": "between you and a long nap so I'll try to keep it lively but this is probably",
    "start": "29039",
    "end": "35610"
  },
  {
    "text": "not a terribly exciting topic right who's really psyched about IT governance and applying controls to kubernetes",
    "start": "35610",
    "end": "42110"
  },
  {
    "text": "right yeah good all right",
    "start": "42110",
    "end": "47129"
  },
  {
    "text": "my name is sun dip I work at Google cloud you can find me on github or Twitter at circus monkey - the vowels",
    "start": "47129",
    "end": "53719"
  },
  {
    "text": "feel free to tweet awesome things about this talk throughout it'll be great all",
    "start": "53719",
    "end": "59190"
  },
  {
    "text": "right so let's start with policies what are policies well policies are rules",
    "start": "59190",
    "end": "64198"
  },
  {
    "text": "right we are attempting to sort of define a set of rules that tell us whether we can make changes to a",
    "start": "64199",
    "end": "70619"
  },
  {
    "text": "resource that's really it when you boil it all down well then what's policy",
    "start": "70619",
    "end": "75630"
  },
  {
    "text": "management right it's really the act of authoring developing deploying and you",
    "start": "75630",
    "end": "82439"
  },
  {
    "text": "know using those policies in a you know in a cluster environment or in in kind of a deployment of some type so when I",
    "start": "82439",
    "end": "93509"
  },
  {
    "text": "talk about policy management there's often this kind of mental overlap with something like config management and the",
    "start": "93509",
    "end": "98820"
  },
  {
    "text": "two are pretty closely related but they're definitely distinct right ultimately config management is about",
    "start": "98820",
    "end": "104670"
  },
  {
    "text": "how you store control govern resources or objects right there's typically a",
    "start": "104670",
    "end": "110610"
  },
  {
    "text": "process around who can do config management right and usually we would do that with like kubernetes are back",
    "start": "110610",
    "end": "115799"
  },
  {
    "text": "controls and there's a process around who can do it I'm sorry a process around how to do it so something like get-ups right that's",
    "start": "115799",
    "end": "122640"
  },
  {
    "text": "typically the approach with config management policy management again is about the rules that's about what you",
    "start": "122640",
    "end": "128550"
  },
  {
    "text": "can change and whether or let them make that change in some cases it could be something where you say I'll allow a change but I'm gonna audit",
    "start": "128550",
    "end": "135180"
  },
  {
    "text": "any potential violation outside of the balance I've kind of set up there's a",
    "start": "135180",
    "end": "141870"
  },
  {
    "text": "little bit of again mental overlap as well between policy management and some",
    "start": "141870",
    "end": "146910"
  },
  {
    "text": "of what kubernetes Arabic offers but the distinction really comes down to our back is about who can do something and",
    "start": "146910",
    "end": "153770"
  },
  {
    "text": "policy management is about what you're trying to change right the change you're trying to make right so that's a good",
    "start": "153770",
    "end": "159570"
  },
  {
    "text": "way to sort of balance out the difference as you sort of think about it",
    "start": "159570",
    "end": "164180"
  },
  {
    "text": "what we found and I think everybody in the room probably agree kubernetes is an incredibly powerful and complex",
    "start": "164870",
    "end": "171900"
  },
  {
    "text": "distributed system which means it does need some level of guardrails and level",
    "start": "171900",
    "end": "177750"
  },
  {
    "text": "of controls right you need to be able to exert some kind of manageability around it because you want to watch out for",
    "start": "177750",
    "end": "183000"
  },
  {
    "text": "things like overexposed services that are open to the world or open to every other service within the cluster right",
    "start": "183000",
    "end": "189360"
  },
  {
    "text": "you're gonna worry about things like data exfiltration right you don't want your data where your customers data",
    "start": "189360",
    "end": "194550"
  },
  {
    "text": "leaving your cluster right those are things that can happen with an improperly configured and and maybe even",
    "start": "194550",
    "end": "200130"
  },
  {
    "text": "get configured it correctly at the starting point but over time the configuration is drifted in some meaningful way and you've got to watch",
    "start": "200130",
    "end": "206340"
  },
  {
    "text": "out for that sort of thing but the controls that we put on to sort of lock",
    "start": "206340",
    "end": "211440"
  },
  {
    "text": "things down and exert some some sort of manageability really do need to be agile and flexible they've got to be easy to",
    "start": "211440",
    "end": "217440"
  },
  {
    "text": "work with otherwise no one's gonna adopt them right so you want to make sure that",
    "start": "217440",
    "end": "223320"
  },
  {
    "text": "you've got the right people who are writing somebody's policies you want the people who have the visibility the",
    "start": "223320",
    "end": "229170"
  },
  {
    "text": "services know the api's understand the software that's running on there - right these sorts of policies they should be",
    "start": "229170",
    "end": "235590"
  },
  {
    "text": "the ones that are driving the rules right that's a really important component you want to be able to scope",
    "start": "235590",
    "end": "241080"
  },
  {
    "text": "those policies very narrowly you want them to only apply to the stuff you care about you don't want them broadly",
    "start": "241080",
    "end": "247050"
  },
  {
    "text": "applicable unless that's the way you designed it but in most cases you're trying to say I just want to focus on one object and make sure that object",
    "start": "247050",
    "end": "253800"
  },
  {
    "text": "doesn't change all right I want to make sure that the metadata of a particular object doesn't change or I only want to",
    "start": "253800",
    "end": "259709"
  },
  {
    "text": "restrict any changes you know airing violations to this one particular namespace so scoping is also really",
    "start": "259709",
    "end": "265140"
  },
  {
    "text": "important because at the end of the day you're trying to make sure things in production stay safe you're trying to avoid",
    "start": "265140",
    "end": "271729"
  },
  {
    "text": "breakage once it's out of your hands mm-hmm excuse me all right so how do you",
    "start": "271729",
    "end": "278060"
  },
  {
    "text": "enforce structure in a kubernetes deployment so you start with open policy",
    "start": "278060",
    "end": "283940"
  },
  {
    "text": "agent OPA is part of the CCF it is a general-purpose sort of rules evaluation",
    "start": "283940",
    "end": "290569"
  },
  {
    "text": "rules engine it's got all the typical things you'd expect to be part of the CN you know the cloud native ecosystem one",
    "start": "290569",
    "end": "297470"
  },
  {
    "text": "it's obviously declarative you know - it sort of unifies and distinguishes to a",
    "start": "297470",
    "end": "303590"
  },
  {
    "text": "degree right the development of applications and the guardrails that you need to put on those applications right",
    "start": "303590",
    "end": "309710"
  },
  {
    "text": "it distinguishes between the configuration of the cluster and again the guard rows we want to put around the",
    "start": "309710",
    "end": "315620"
  },
  {
    "text": "configuration of the cluster and it's aware of everything that's going on within that environment as well right",
    "start": "315620",
    "end": "322490"
  },
  {
    "text": "it's context aware - what's happening so this is a good powerful place to start and and OPA is again like I said very",
    "start": "322490",
    "end": "330020"
  },
  {
    "text": "general purpose right it's it's not actually a part of kubernetes as a standalone it's just a mechanism for",
    "start": "330020",
    "end": "336349"
  },
  {
    "text": "evaluating so you can layer this into a number of different ways right there's even actually ways to make OPA an",
    "start": "336349",
    "end": "342830"
  },
  {
    "text": "admission controller just by itself but we'll get to how that kind of fits in the broader term but but ultimately any",
    "start": "342830",
    "end": "348610"
  },
  {
    "text": "service can talk to open policy agent and query against it and open policy agent is is kind of satisfy cruel xand",
    "start": "348610",
    "end": "356960"
  },
  {
    "text": "configuration objects that it has access to and then it can answer that query back based on the rules you've given it",
    "start": "356960",
    "end": "364120"
  },
  {
    "text": "so we're just gatekeeper Fitness so gate keeper takes OPA takes open policy agent",
    "start": "364840",
    "end": "370009"
  },
  {
    "text": "and essentially wraps it into a cooperage controller and specifically a",
    "start": "370009",
    "end": "375169"
  },
  {
    "text": "kubernetes admission controller so it puts itself right in the critical path of when objects are entering into the",
    "start": "375169",
    "end": "381770"
  },
  {
    "text": "cluster so it gives you the opportunity to potentially evaluate anything that's",
    "start": "381770",
    "end": "387650"
  },
  {
    "text": "coming in anything that the API is going to accept and make a decision about what's going to happen to that and so",
    "start": "387650",
    "end": "393320"
  },
  {
    "text": "because gatekeeper makes OPA part of kubernetes at that point all of the",
    "start": "393320",
    "end": "399260"
  },
  {
    "text": "standard kubernetes tooling that you would typically use to talk to your environment stays the same Coop's ETL CI CD get-ups generic API",
    "start": "399260",
    "end": "408379"
  },
  {
    "text": "clients whatever the case may be what gatekeeper does right again it kind",
    "start": "408379",
    "end": "415250"
  },
  {
    "text": "of extends the approach that that open policy agent gives you so with OPA you write your rules in rego and then you",
    "start": "415250",
    "end": "422449"
  },
  {
    "text": "just give that to OPI now and it executes those rules based on inbound queries mm-hmm with gatekeeper you have",
    "start": "422449",
    "end": "429289"
  },
  {
    "text": "to do a little bit more work you take that rule object that rego code and you embed it inside a custom resource and",
    "start": "429289",
    "end": "436250"
  },
  {
    "text": "then you give that to gatekeeper so now gatekeeper knows about a new CR in the",
    "start": "436250",
    "end": "441500"
  },
  {
    "text": "cluster and then it can build constraints based on that rule you just gave it and we'll go into more depth as",
    "start": "441500",
    "end": "447590"
  },
  {
    "text": "we kind of make our way through here so what does a policy object look like and",
    "start": "447590",
    "end": "452870"
  },
  {
    "text": "before I go too far into this the way policies work the way they're managed",
    "start": "452870",
    "end": "458690"
  },
  {
    "text": "the way they're enforced there's two parts to this one is the set of rules that you're that you're writing and the",
    "start": "458690",
    "end": "465590"
  },
  {
    "text": "second part is the enforcement so the first part the rules section is called a constraint template and that's an",
    "start": "465590",
    "end": "471740"
  },
  {
    "text": "example I've got up here oops so this this policy object if you look about a",
    "start": "471740",
    "end": "478279"
  },
  {
    "text": "third of the way down up up to top there you'll see there's a kind so what that's actually saying is we're gonna create a",
    "start": "478279",
    "end": "484639"
  },
  {
    "text": "new CR and it's going to incorporate the rule the rego code that's underneath at the bottom there so when I apply this to",
    "start": "484639",
    "end": "496940"
  },
  {
    "text": "gatekeeper what's going to happen is out there is a new top-level type right if you do coop CTL and get crts you'll see",
    "start": "496940",
    "end": "503960"
  },
  {
    "text": "that there's a new one called destination rule TLS enabled and so the",
    "start": "503960",
    "end": "509120"
  },
  {
    "text": "reason that you separate this idea between the policy and the enforcement of that policy is because depending on",
    "start": "509120",
    "end": "515750"
  },
  {
    "text": "the type of policy you have it may be parameterised right you may be able to say things like for a particular",
    "start": "515750",
    "end": "521930"
  },
  {
    "text": "namespace I need to have these three labels on every incoming deployment object well depending on the namespace",
    "start": "521930",
    "end": "528440"
  },
  {
    "text": "you want you may want to change what that looks like so in that case you may have a single constraint",
    "start": "528440",
    "end": "533510"
  },
  {
    "text": "plate right a single set of rules that does the actual checking but then in each namespace you care about scoped to",
    "start": "533510",
    "end": "539660"
  },
  {
    "text": "each namespace you care about you may have a new individual constraint object that lets you again operate and scope it",
    "start": "539660",
    "end": "546770"
  },
  {
    "text": "to those parameters in particular so the second half as I mentioned is a",
    "start": "546770",
    "end": "552890"
  },
  {
    "text": "constraint object a constraint just takes that CR you created it creates that same top-level type and this is",
    "start": "552890",
    "end": "559280"
  },
  {
    "text": "where you get to define the enforcement and the scoping of that rule you just created so in this example we have an",
    "start": "559280",
    "end": "569030"
  },
  {
    "text": "enforcement action of deny so that's going to tell the admission controller that if any object comes in that",
    "start": "569030",
    "end": "574880"
  },
  {
    "text": "violates the rule in the previous slide just kick it right back out give it a nice error message and then send it on",
    "start": "574880",
    "end": "580310"
  },
  {
    "text": "its way but you also have the opportunity to audit incoming objects and say look this is a soft guardrail",
    "start": "580310",
    "end": "587540"
  },
  {
    "text": "it's not something that's gonna break production but it's something we might want to know about later on so you can change this and change it to auto mode",
    "start": "587540",
    "end": "594020"
  },
  {
    "text": "so it'll accept those objects and then you have the ability to go and check audit violations or status violations",
    "start": "594020",
    "end": "599510"
  },
  {
    "text": "later on the bottom half down here or the bottom section is where we scope it",
    "start": "599510",
    "end": "605300"
  },
  {
    "text": "so we say we know we're telling it now this is where you apply this constraint to or this crits right in this set of",
    "start": "605300",
    "end": "611060"
  },
  {
    "text": "rules so in this case I'm scoping it to a destination rule which is one of the",
    "start": "611060",
    "end": "616160"
  },
  {
    "text": "api's that are part of SEO and I'm gonna say it's only gonna focus on the default namespace but just like a lot of the",
    "start": "616160",
    "end": "624110"
  },
  {
    "text": "great tools we have in the ecosystem you can get a lot more fine-grained here we can actually specify a specific",
    "start": "624110",
    "end": "629210"
  },
  {
    "text": "namespace selector based on things like labels so I can't actually say something to the effect of hey I only want to",
    "start": "629210",
    "end": "635990"
  },
  {
    "text": "focus on namespaces where this particular metadata set or in this example that's commented out only",
    "start": "635990",
    "end": "642920"
  },
  {
    "text": "namespaces where is to injection is enabled so you have that ability to really focus down where you want to",
    "start": "642920",
    "end": "648830"
  },
  {
    "text": "apply that enforcement which is good you don't want to have too many objects that are applying to every single thing",
    "start": "648830",
    "end": "654740"
  },
  {
    "text": "coming through because they're probably not fine-grained enough they're probably not really going to give you the constraint you're looking for",
    "start": "654740",
    "end": "662320"
  },
  {
    "text": "so there's one more piece to this puzzle when you're talking about gatekeepers that you've got to actually tell gatekeeper how to capture some of these",
    "start": "663360",
    "end": "670529"
  },
  {
    "text": "objects and so to use the namespace selector that I just showed in the previous slide you've got to make sure",
    "start": "670529",
    "end": "676499"
  },
  {
    "text": "that you're synchronizing your synching the data about namespaces into the gatekeeper system namespace so the",
    "start": "676499",
    "end": "682259"
  },
  {
    "text": "gatekeeper controller is basically caching the metadata about any of these objects and the reason you do this is",
    "start": "682259",
    "end": "688980"
  },
  {
    "text": "because you may have one for the namespace selector as I mentioned so it's got to know about all the namespaces and all those metadata but",
    "start": "688980",
    "end": "696389"
  },
  {
    "text": "for any objects that may have multi object policies or for any situations",
    "start": "696389",
    "end": "702029"
  },
  {
    "text": "where you may want to audit something after it's a bit admitted to the cluster gatekeeper system needs to know about it",
    "start": "702029",
    "end": "708209"
  },
  {
    "text": "or the gatekeeper configuration needs to know about it so this this file is pretty pretty typical most of the time",
    "start": "708209",
    "end": "714540"
  },
  {
    "text": "in the examples you'll see something I just got you know name space service pods deployments that sort of thing in this case I added a few extra lines for",
    "start": "714540",
    "end": "721709"
  },
  {
    "text": "some of the ACU api's that I was concerned with alright so how do we",
    "start": "721709",
    "end": "728970"
  },
  {
    "text": "apply enforcement to misty or to service mesh who's familiar with the service",
    "start": "728970",
    "end": "734850"
  },
  {
    "text": "mesh in the room good all right how about Sto okay awesome awesome whose get",
    "start": "734850",
    "end": "742169"
  },
  {
    "text": "instant production side accuracy okay",
    "start": "742169",
    "end": "746989"
  },
  {
    "text": "okay [Laughter] so typically a service mesh right has a",
    "start": "747410",
    "end": "754290"
  },
  {
    "text": "sidecar it's it's you know right next to your services and it helps create kind of this approach where you can",
    "start": "754290",
    "end": "760879"
  },
  {
    "text": "independent of those services independent of the code that's running in your applications you know automate network functionality right that's",
    "start": "760879",
    "end": "766980"
  },
  {
    "text": "essentially it lets you apply sort of network automation across the board to a large to a large kind of pool of",
    "start": "766980",
    "end": "772439"
  },
  {
    "text": "applications and services specifically with Sto right out of the box you get a",
    "start": "772439",
    "end": "779730"
  },
  {
    "text": "pretty decent amount of observer ability so telemetry logs tracing you get",
    "start": "779730",
    "end": "786389"
  },
  {
    "text": "traffic controls which I think I've called operational agility because that sounded really cool and then you also",
    "start": "786389",
    "end": "792480"
  },
  {
    "text": "get like a policy driven security approach and I apologize that there is an it's Oh object called policy in here that I",
    "start": "792480",
    "end": "798580"
  },
  {
    "text": "will be referencing several times so you're confused between which policy thing I'm talking about feel free to",
    "start": "798580",
    "end": "804370"
  },
  {
    "text": "find me after and I will help try and disambiguate ever so slightly so if you",
    "start": "804370",
    "end": "811570"
  },
  {
    "text": "kind of dig in a little bit in depth with this do observability I mentioned logs tracing you know telemetry and",
    "start": "811570",
    "end": "818080"
  },
  {
    "text": "monitoring data for traffic you get to do anything to those services as it",
    "start": "818080",
    "end": "823540"
  },
  {
    "text": "relates to the flow of traffic coming in or out of your services that's what that sidecar does and it also includes things",
    "start": "823540",
    "end": "829030"
  },
  {
    "text": "like the ability to do rate limiting circuit breaking Canaries all that sort of good stuff",
    "start": "829030",
    "end": "834160"
  },
  {
    "text": "traffic steering and then with security there's a pretty solid authentication",
    "start": "834160",
    "end": "839500"
  },
  {
    "text": "and authorization model and the authentication component includes the ability to encrypt all the traffic",
    "start": "839500",
    "end": "845830"
  },
  {
    "text": "between services as well so it ends up being a pretty powerful mechanism as I",
    "start": "845830",
    "end": "851590"
  },
  {
    "text": "mentioned earlier I often like to think of service mesh and specifically sto as ultimately network automation at scale",
    "start": "851590",
    "end": "858870"
  },
  {
    "text": "but for any again complex powerful",
    "start": "858870",
    "end": "863950"
  },
  {
    "text": "distributed system and I think sto quad opening service mission general sort of qualifies people typically have really",
    "start": "863950",
    "end": "870610"
  },
  {
    "text": "good intentions right you're trying to do something compelling but you have to watch out for problems right things",
    "start": "870610",
    "end": "877270"
  },
  {
    "text": "happen you can't always control what's gonna happen right you may have pushed a good config in to get that maybe the",
    "start": "877270",
    "end": "884200"
  },
  {
    "text": "config that got synced to the cluster but somebody in the room may have cluster admin access and may have",
    "start": "884200",
    "end": "890530"
  },
  {
    "text": "patched that configure maybe have changed something or maybe they pushed an object and maybe they broke something",
    "start": "890530",
    "end": "895540"
  },
  {
    "text": "right breakage can happen anywhere it's not just gonna happen with one team at the you know all the way shifted left it",
    "start": "895540",
    "end": "901480"
  },
  {
    "text": "could happen anywhere along that pipeline because ultimately teams have you know a mix of declarative and paired",
    "start": "901480",
    "end": "908200"
  },
  {
    "text": "of access to kubernetes so you've got to watch out for that sort of thing and that's really what we're trying to enforce it's not just you know potential",
    "start": "908200",
    "end": "915700"
  },
  {
    "text": "breakage on the far right but it's also shifting left over time all right so I'm",
    "start": "915700",
    "end": "924130"
  },
  {
    "text": "gonna talk through a few examples of sort of structural problems you could run into with this do some of these are",
    "start": "924130",
    "end": "930940"
  },
  {
    "text": "sort of self-inflicted and some are guardrails you might want to set up in advance of you know again deploying to",
    "start": "930940",
    "end": "938470"
  },
  {
    "text": "production so one of the first ones is there's a requirement in SEO today and",
    "start": "938470",
    "end": "943810"
  },
  {
    "text": "I'll talk about that a little later but today there's a requirement isseo that if you want your pods and services to be",
    "start": "943810",
    "end": "949150"
  },
  {
    "text": "picked up by the service mesh you have to follow a very specific port naming convention right in your service port so",
    "start": "949150",
    "end": "957040"
  },
  {
    "text": "you can see down here I didn't follow that convention right you have to actually labeled with the protocol as the prefix you have to tell it HTTP G",
    "start": "957040",
    "end": "964330"
  },
  {
    "text": "RPC TCP what-have-you so in this case if I were to deploy this service",
    "start": "964330",
    "end": "969520"
  },
  {
    "text": "it actually would not be able to route traffic to it it would route traffic to it but it wouldn't use any sto routing",
    "start": "969520",
    "end": "975430"
  },
  {
    "text": "rules I should say so this is something that we want to catch this might not be something we deny admission into the",
    "start": "975430",
    "end": "980980"
  },
  {
    "text": "cluster for but it's certainly something we want to be able to audit and again trace it back as a potential problem in",
    "start": "980980",
    "end": "986650"
  },
  {
    "text": "our deployment over time all right so the next one is enforcing M TLS so you",
    "start": "986650",
    "end": "995110"
  },
  {
    "text": "can write a top-level sort of sto policy object that says hey for everything in",
    "start": "995110",
    "end": "1000480"
  },
  {
    "text": "the namespace that I apply this policy object to all the services they must only accept M TLS connections but there",
    "start": "1000480",
    "end": "1009210"
  },
  {
    "text": "is actually an ability to override this at the host level you can say again within that same namespace where I've",
    "start": "1009210",
    "end": "1015180"
  },
  {
    "text": "said all services must accept M TLS I can write another policy that says hey listen I'm special my service is special",
    "start": "1015180",
    "end": "1022470"
  },
  {
    "text": "I don't want to accept M TLS connections I want to go permissive right so you can actually do this and now that service at",
    "start": "1022470",
    "end": "1030930"
  },
  {
    "text": "back-end will actually accept unencrypted connections or are not the indicated connections I should say so",
    "start": "1030930",
    "end": "1037170"
  },
  {
    "text": "this is another thing you want to build to catch right and this isn't really a structural problem it's more of something where you may have a corporate",
    "start": "1037170",
    "end": "1043290"
  },
  {
    "text": "policy that says hey listen we're only do an M TLS right its compliance its regulatory what have you right it's",
    "start": "1043290",
    "end": "1049830"
  },
  {
    "text": "about safety someone can still override that another",
    "start": "1049830",
    "end": "1056400"
  },
  {
    "text": "one is a mismatched M TLS situation we've seen this before in the field as well where you may have something in",
    "start": "1056400",
    "end": "1062580"
  },
  {
    "text": "again a situation where in a host you've told you're told services only accept em TLS connections",
    "start": "1062580",
    "end": "1069270"
  },
  {
    "text": "but then a destination rule which controls what clients do in sto a destination rule comes in and says I'm",
    "start": "1069270",
    "end": "1076050"
  },
  {
    "text": "gonna disable I'm TLS right I'm telling clients that they don't have to use em TLS and now the problem is that service",
    "start": "1076050",
    "end": "1082950"
  },
  {
    "text": "is expecting an authenticated connection clients aren't supplying one so then",
    "start": "1082950",
    "end": "1088290"
  },
  {
    "text": "what happens you end up with five or threes right this is the situation where and even like the previous one you",
    "start": "1088290",
    "end": "1094650"
  },
  {
    "text": "probably want to deny admission to objects that do this sort of thing right not even just because it's about",
    "start": "1094650",
    "end": "1100140"
  },
  {
    "text": "security but this is gonna be something that's end user facing right if you break some of these empty LS",
    "start": "1100140",
    "end": "1106050"
  },
  {
    "text": "settings in your deployment its impacted by your end users it's another one is",
    "start": "1106050",
    "end": "1114380"
  },
  {
    "text": "authorization controls so it's got a pretty rich authorization model and in",
    "start": "1114380",
    "end": "1120000"
  },
  {
    "text": "fact this is now a deprecated approach as of this week so thanks sto team we",
    "start": "1120000",
    "end": "1127620"
  },
  {
    "text": "switched from using the service role service role binding to a much cleaner and sort of tighter authorization policy",
    "start": "1127620",
    "end": "1133440"
  },
  {
    "text": "object but that's okay I left the example in there the point is that with the authorization model you can do",
    "start": "1133440",
    "end": "1138870"
  },
  {
    "text": "interesting things like service a can talk to service B a can talk to see but",
    "start": "1138870",
    "end": "1144570"
  },
  {
    "text": "B can't talk to C right you can write that easy config in your deployment and you may have a situation where you say",
    "start": "1144570",
    "end": "1150060"
  },
  {
    "text": "hey there's a front-end and it's got to talk to its back-end but no one else should talk to that back-end right you",
    "start": "1150060",
    "end": "1155820"
  },
  {
    "text": "may want to lock that access down and maybe you did your rope that config the right way and then someone was debugging",
    "start": "1155820",
    "end": "1162570"
  },
  {
    "text": "or trying to open up service and they changed something and they took out that source principle and they said hey we",
    "start": "1162570",
    "end": "1168180"
  },
  {
    "text": "don't care about that service account we'll let anybody connect to this back-end right that's one just a potentially bad idea",
    "start": "1168180",
    "end": "1176160"
  },
  {
    "text": "because you may not be prepared for the extra connections worse yet it could be something where you need to lock down",
    "start": "1176160",
    "end": "1181260"
  },
  {
    "text": "access you don't want other parties talking to it from inside the deployment",
    "start": "1181260",
    "end": "1187070"
  },
  {
    "text": "so I think this is the last one virtual services so virtual services are what control some of the east-west traffic",
    "start": "1189240",
    "end": "1197410"
  },
  {
    "text": "within a deployment this is actually telling traffic essentially how to go from you know sort of point A to point B",
    "start": "1197410",
    "end": "1203620"
  },
  {
    "text": "in a cluster well virtual services are really powerful except we don't check",
    "start": "1203620",
    "end": "1208870"
  },
  {
    "text": "them for you on the way in so what might happen is someone may actually have a you are eyes that are clobbering all",
    "start": "1208870",
    "end": "1215470"
  },
  {
    "text": "over each other so if you were to push both of these objects into the cluster you're only going to technically wrap traffic to one",
    "start": "1215470",
    "end": "1221440"
  },
  {
    "text": "host because these files look very similar these objects look very similar right I'm saying for all hosts you know",
    "start": "1221440",
    "end": "1227110"
  },
  {
    "text": "and if the URI matches /hello send it to version 1 or version 2 well which one of",
    "start": "1227110",
    "end": "1233110"
  },
  {
    "text": "these is actually gonna work sort of fundin it's not gonna unknown right depending on the day it might be the first one to the second one so that's",
    "start": "1233110",
    "end": "1239350"
  },
  {
    "text": "not a really great use case because now different teams may be wondering why their traffic is getting you know picked",
    "start": "1239350",
    "end": "1245830"
  },
  {
    "text": "up by some other service so that's another thing you want to watch out for all of these examples are things that we",
    "start": "1245830",
    "end": "1253510"
  },
  {
    "text": "can catch in advance we can either reject admission to the cluster if they violate again a corporate policy",
    "start": "1253510",
    "end": "1259990"
  },
  {
    "text": "regulatory compliance security or they could just be good things for us to audit and capture and be able to check",
    "start": "1259990",
    "end": "1266470"
  },
  {
    "text": "up on and fix later on so some other interesting I think policies and this",
    "start": "1266470",
    "end": "1272020"
  },
  {
    "text": "gets into more of the the sort of guardrails and governance stuff but I talked about requiring strict m TLS",
    "start": "1272020",
    "end": "1277210"
  },
  {
    "text": "between clients and services in a specific namespace locking down that fine-grained authorization control to",
    "start": "1277210",
    "end": "1283900"
  },
  {
    "text": "make sure that you're not allowing anyone to talk to your services but only a very specific sort of source or",
    "start": "1283900",
    "end": "1289300"
  },
  {
    "text": "destination you may have policies that are specific about telemetry settings",
    "start": "1289300",
    "end": "1294730"
  },
  {
    "text": "because you don't want to lose telemetry it may be very important for your own businesses audit controls right it may",
    "start": "1294730",
    "end": "1301300"
  },
  {
    "text": "be really important for you to make sure that logging is always turned on or that you're getting certain metrics so that you know when things are going down or",
    "start": "1301300",
    "end": "1308590"
  },
  {
    "text": "when you need to you know adjust resources so there's a whole bunch of these and we're not going to talk through all of them right now but",
    "start": "1308590",
    "end": "1314340"
  },
  {
    "text": "there's a lot you can do with gatekeeper I can't stress that enough it is an incredibly powerful mechanism right and",
    "start": "1314340",
    "end": "1320380"
  },
  {
    "text": "it's a really powerful tool to me sure things don't break and that's really what you're trying to avoid",
    "start": "1320380",
    "end": "1326740"
  },
  {
    "text": "so if we add gatekeeper do we get that strong structural approach so now I'm",
    "start": "1326740",
    "end": "1334670"
  },
  {
    "text": "gonna try to do a couple of demos for you I've got five demonstrations anybody's seen a demo of an admission",
    "start": "1334670",
    "end": "1341810"
  },
  {
    "text": "controller before yeah it's not terribly exciting because you push something and",
    "start": "1341810",
    "end": "1346820"
  },
  {
    "text": "then it doesn't get a minute in a cluster that's pretty much the end of it so you know hopefully I don't lose any",
    "start": "1346820",
    "end": "1352430"
  },
  {
    "text": "of you while I'm doing this but we'll see how it looks so let's see the first",
    "start": "1352430",
    "end": "1360950"
  },
  {
    "text": "thing we're gonna do here is I'm just gonna run me a little demo script all right so the first thing we'll do is we're gonna check and see what's in the",
    "start": "1360950",
    "end": "1366350"
  },
  {
    "text": "cluster just so I can show y'all in advance and I just now realized that I left a bunch of stuff running in the",
    "start": "1366350",
    "end": "1372230"
  },
  {
    "text": "cluster that's alright we'll figure it out let's check some pod so there's just a couple of there's a couple little",
    "start": "1372230",
    "end": "1379370"
  },
  {
    "text": "services running here nothing nothing important I'll show some of the services",
    "start": "1379370",
    "end": "1385370"
  },
  {
    "text": "that are running right this is just basic stuff but now let's look at what's in the entire thing so this is actually",
    "start": "1385370",
    "end": "1391280"
  },
  {
    "text": "what's deployed in the cluster so I've got sto deployed in the sto system namespace obviously there's a bunch of",
    "start": "1391280",
    "end": "1396860"
  },
  {
    "text": "GK and kubernetes stuff in there and at the very top the second line is gatekeeper so gatekeepers installed just",
    "start": "1396860",
    "end": "1404150"
  },
  {
    "text": "by using the normal instructions that are on github and it installs in its own namespace gatekeeper system",
    "start": "1404150",
    "end": "1410740"
  },
  {
    "text": "and so if you remember earlier when I talked about there are two parts to a",
    "start": "1414190",
    "end": "1419260"
  },
  {
    "text": "policy right there's the rule and then there's the enforcement of that rule so",
    "start": "1419260",
    "end": "1424570"
  },
  {
    "text": "what I've done in advance is I've actually pushed all my rules into the cluster so I'm actually showing all that",
    "start": "1424570",
    "end": "1430450"
  },
  {
    "text": "constraint templates I've already pushed those into the cluster because in production in the real world what you may be doing is you",
    "start": "1430450",
    "end": "1437200"
  },
  {
    "text": "may already have those templates living in the cluster right some somebody from like security ops may have written all",
    "start": "1437200",
    "end": "1442930"
  },
  {
    "text": "these rules for you and then push them in the cluster and they're ready and waiting for any service team or any you",
    "start": "1442930",
    "end": "1448090"
  },
  {
    "text": "know platform team that wants to actually use them by writing a constraint to enforce them alright so",
    "start": "1448090",
    "end": "1457480"
  },
  {
    "text": "the first one will do is can we check for bad port naming conventions right that was an example I mentioned earlier",
    "start": "1457480",
    "end": "1462750"
  },
  {
    "text": "so let me take a look at what that template looks like so this is a bad port naming template and if I page down",
    "start": "1462750",
    "end": "1471820"
  },
  {
    "text": "here you'll see the rego code at the bottom or in that bottom half I'm not gonna read through this line by line for",
    "start": "1471820",
    "end": "1478150"
  },
  {
    "text": "you but effectively what I'm doing is I'm pulling out the service that came in and I'm checking I'm just kind of going",
    "start": "1478150",
    "end": "1484390"
  },
  {
    "text": "through the object and I'm trying to figure out what the port name starts with and if I can compare it against a",
    "start": "1484390",
    "end": "1490150"
  },
  {
    "text": "known set of input parameters so let's",
    "start": "1490150",
    "end": "1499270"
  },
  {
    "text": "take a look at the course of a corresponding constraint object so you'll see this one the enforcement",
    "start": "1499270",
    "end": "1504730"
  },
  {
    "text": "action here on what is the line six it's set to dry run dry run is essentially",
    "start": "1504730",
    "end": "1510520"
  },
  {
    "text": "saying allow admission to a service that might violate this constraint and audit",
    "start": "1510520",
    "end": "1515800"
  },
  {
    "text": "any breakage right audit any pension violations and then you'll see down there as well the namespaces I've chosen",
    "start": "1515800",
    "end": "1521740"
  },
  {
    "text": "for this are the sto system I'm sorry any namespace we're sto injection is enabled which in my case is just the",
    "start": "1521740",
    "end": "1528580"
  },
  {
    "text": "default namespace and then I've got a set of parameters that I need it to correspond to right these are my in",
    "start": "1528580",
    "end": "1534130"
  },
  {
    "text": "parameter so I'm saying ports must start with one of these names",
    "start": "1534130",
    "end": "1539730"
  },
  {
    "text": "so let's push the constraint into their cluster alright that was already in there because like I said I just ran",
    "start": "1542460",
    "end": "1548850"
  },
  {
    "text": "this about 30 minutes ago that's okay and let's take a look at a bad port name object so if you look over here at the",
    "start": "1548850",
    "end": "1556409"
  },
  {
    "text": "very top this is an example I showed earlier in the slides but the port name is hello port right I don't have any of",
    "start": "1556409",
    "end": "1562860"
  },
  {
    "text": "those well-known prefixes so this well this deployment will actually get a sidecar proxy as part of ISTE oh but it",
    "start": "1562860",
    "end": "1570720"
  },
  {
    "text": "won't actually respond to traffic rules because I've got a bad port name so now let's see what happens if I push that",
    "start": "1570720",
    "end": "1578610"
  },
  {
    "text": "into their cluster that's gonna go in alright well that was already there",
    "start": "1578610",
    "end": "1584070"
  },
  {
    "text": "and the next thing is let's take a look at the constraint object that I created",
    "start": "1584070",
    "end": "1591299"
  },
  {
    "text": "so it ends up being a little bit long right because you actually have to refer the entire full path of it so what I'm",
    "start": "1591299",
    "end": "1596789"
  },
  {
    "text": "saying is I want to get the that CR that container that customer resource allowed",
    "start": "1596789",
    "end": "1601950"
  },
  {
    "text": "service port name constraints gate keeper data SH get the specific port name constraint I gave it take a look at",
    "start": "1601950",
    "end": "1608399"
  },
  {
    "text": "it when ya mo and I'm gonna watch it for any status changes because in the status field down here in the lower third of",
    "start": "1608399",
    "end": "1615419"
  },
  {
    "text": "the screen you'll see there's a couple of violations noted alright we actually have a situation where it says well the",
    "start": "1615419",
    "end": "1621629"
  },
  {
    "text": "kubernetes service by itself already it's the wrong one as well but the service hello world the default port",
    "start": "1621629",
    "end": "1626759"
  },
  {
    "text": "name is it's missing a prefix right so this is an example of one where we did dry run this was we're gonna block",
    "start": "1626759",
    "end": "1632700"
  },
  {
    "text": "admission to the cluster for this but we wanted to be able to audit because this could be a reason that things aren't",
    "start": "1632700",
    "end": "1638009"
  },
  {
    "text": "working like we expected",
    "start": "1638009",
    "end": "1641269"
  },
  {
    "text": "alright so the next one I want to talk through is mismatched MPLS settings and this one is interesting because if you",
    "start": "1647130",
    "end": "1655240"
  },
  {
    "text": "look about see line 17 that's kinda the templates kind of start to blend",
    "start": "1655240",
    "end": "1660580"
  },
  {
    "text": "together for a while and again I'm not gonna go through the Rigo code in depth but this template is a good example of",
    "start": "1660580",
    "end": "1665830"
  },
  {
    "text": "I'm evaluating a destination rule coming in but before I can evaluate that",
    "start": "1665830",
    "end": "1671500"
  },
  {
    "text": "destination rule I need to check for a corresponding sto policy object that might already be in the cluster so the",
    "start": "1671500",
    "end": "1678340"
  },
  {
    "text": "first thing I'm going to do is I'm actually gonna pull out of the sort of inventory I'm gonna pull out any policy",
    "start": "1678340",
    "end": "1684850"
  },
  {
    "text": "objects and make sure I kind of iterate through them and check for any places where the policy object specifies a",
    "start": "1684850",
    "end": "1691630"
  },
  {
    "text": "hostname and that it's strict MPLS you know and the destination rule is saying",
    "start": "1691630",
    "end": "1697840"
  },
  {
    "text": "the same hostname but it might be saying disable MPLS so that's what this policy is doing so now if we take a look at",
    "start": "1697840",
    "end": "1708850"
  },
  {
    "text": "that constraint this one's not as exciting because it's very simple but ultimately the distinction here is that",
    "start": "1708850",
    "end": "1714970"
  },
  {
    "text": "again in line 6 I want to deny admission to this object I don't want to allow a destination rule",
    "start": "1714970",
    "end": "1721840"
  },
  {
    "text": "that attempts to turn off MPLS we can",
    "start": "1721840",
    "end": "1728769"
  },
  {
    "text": "push that constraint into the cluster and then we can try ok so this is what",
    "start": "1728769",
    "end": "1736059"
  },
  {
    "text": "the the policy and destination rule look like as I mentioned the policy on the bottom says strict for that particular",
    "start": "1736059",
    "end": "1741429"
  },
  {
    "text": "target and then the destination rules trying to disable MPLS here now let's",
    "start": "1741429",
    "end": "1753279"
  },
  {
    "text": "see what happens policy goes in - nation rule gets",
    "start": "1753279",
    "end": "1760049"
  },
  {
    "text": "okay well that didn't work so I apologize I will check on that later that one I think is already in there",
    "start": "1765700",
    "end": "1772790"
  },
  {
    "text": "because I broke it earlier so I will double check it so the next one and we",
    "start": "1772790",
    "end": "1778250"
  },
  {
    "text": "will make our way through here so here's another good example this is one where",
    "start": "1778250",
    "end": "1785090"
  },
  {
    "text": "we might want to say hey I have a corporate policy that says M TLS must be on in a particular namespace for all",
    "start": "1785090",
    "end": "1791270"
  },
  {
    "text": "services now what's interesting about this policy is that you can see that the sort of violation conditions kind of go",
    "start": "1791270",
    "end": "1798170"
  },
  {
    "text": "on and on here and there's a reason for that so one the way it works in Rego is",
    "start": "1798170",
    "end": "1803180"
  },
  {
    "text": "if you have multiple different ways that a violation can be thrown you need to specify them in sort of different",
    "start": "1803180",
    "end": "1808370"
  },
  {
    "text": "violation you know functions or sort of groupings and what happens is if any of",
    "start": "1808370",
    "end": "1814790"
  },
  {
    "text": "the and when you when you do it this way where you have you know separate separate blocks of violations they get Ord together so if any one of these",
    "start": "1814790",
    "end": "1820940"
  },
  {
    "text": "throws it'll throw a violation and so in this case I've got three different options here because the way you specify",
    "start": "1820940",
    "end": "1828320"
  },
  {
    "text": "em TLS in an sto policy object is a little weird you actually have two",
    "start": "1828320",
    "end": "1834380"
  },
  {
    "text": "specific like I'm specifically checking for different combinations of the API",
    "start": "1834380",
    "end": "1839660"
  },
  {
    "text": "object to make sure that it's gonna qualify here right I need to check for for example in in this if you don't",
    "start": "1839660",
    "end": "1846590"
  },
  {
    "text": "specify this spec peers field then it's actually turning off M TLS all right if you don't if SPECT up here's is just an",
    "start": "1846590",
    "end": "1854060"
  },
  {
    "text": "empty array it also attempts to turn off M TLS and then finally if it's set to permissive that's obviously explicitly",
    "start": "1854060",
    "end": "1860840"
  },
  {
    "text": "turning it off but they're basically there are a couple implicit ways and turn it off so you need to make sure you check for all possible conditions",
    "start": "1860840",
    "end": "1868480"
  },
  {
    "text": "all right so let's push that constraint in this one looks very similar to the last one where we're just denying",
    "start": "1873280",
    "end": "1878450"
  },
  {
    "text": "admission to the cluster so let's try that let's see if this one works all",
    "start": "1878450",
    "end": "1886400"
  },
  {
    "text": "right so the constraints in there and we're gonna take a look at a bad policy object here so this is one that we're",
    "start": "1886400",
    "end": "1894050"
  },
  {
    "text": "trying to catch so good it's trying to try to push this one in and let's see what happens all right so here's an",
    "start": "1894050",
    "end": "1901220"
  },
  {
    "text": "example where the admission control had caught it and said sorry gate keeper said no thanks you can't get in here",
    "start": "1901220",
    "end": "1906710"
  },
  {
    "text": "because you're violating this rule then I'm not gonna read out to you but it's basically a bunch of error message now",
    "start": "1906710",
    "end": "1912830"
  },
  {
    "text": "what's also interesting about this one this constraint in particular is that",
    "start": "1912830",
    "end": "1917890"
  },
  {
    "text": "there was already a bad policy object in the cluster that I left there from",
    "start": "1917890",
    "end": "1923990"
  },
  {
    "text": "earlier on purpose so this is a good example of a constraint that again I",
    "start": "1923990",
    "end": "1929720"
  },
  {
    "text": "wanted to deny admission but denying admission that that enforcement action deny also does the audit for you as well",
    "start": "1929720",
    "end": "1936290"
  },
  {
    "text": "so on the off chance someone was somehow able to bypass the admission controller or had a pre-existing object it'll still",
    "start": "1936290",
    "end": "1943100"
  },
  {
    "text": "get picked up in the violation field so you can still go track this back down and say who over here owns this object",
    "start": "1943100",
    "end": "1948440"
  },
  {
    "text": "and let me go tell them to pull it or let me pull it down or change it because they're violating again corporate policy",
    "start": "1948440",
    "end": "1954140"
  },
  {
    "text": "here all right so I'm gonna stop here",
    "start": "1954140",
    "end": "1959740"
  },
  {
    "text": "and I want to finish up on the slides",
    "start": "1959740",
    "end": "1964240"
  },
  {
    "text": "all right so we didn't cover all of them preventing virtual service hostname collisions recording services the",
    "start": "1967120",
    "end": "1973990"
  },
  {
    "text": "disabled unauthorized access I apologize we're gonna run out of time so what I would say though is I have a",
    "start": "1973990",
    "end": "1979510"
  },
  {
    "text": "link to the github repo where all of these are with kind of a little bit more example and more a little more information please take a look at them",
    "start": "1979510",
    "end": "1985770"
  },
  {
    "text": "hoping to eventually push them into the gatekeeper sort of contribute so that we",
    "start": "1985770",
    "end": "1992920"
  },
  {
    "text": "can start creating a large base of these things to share with everybody so one",
    "start": "1992920",
    "end": "1998440"
  },
  {
    "text": "more thing I did want to mention is policy controller right what is policy control well so policy controller is",
    "start": "1998440",
    "end": "2005880"
  },
  {
    "text": "actually part of anthos config management right anthos is google's sort",
    "start": "2005880",
    "end": "2010950"
  },
  {
    "text": "of hybrid kubernetes multi cloud software right it's a giant package of stuff in there particularly is one",
    "start": "2010950",
    "end": "2017400"
  },
  {
    "text": "component called anthos config management so Anthes config management does get ops right that's actually what",
    "start": "2017400",
    "end": "2023430"
  },
  {
    "text": "it is for your clusters and for your deployments as if I think anthos one dot once or a couple of months ago we",
    "start": "2023430",
    "end": "2029970"
  },
  {
    "text": "included something called policy controller policy controller is based on gatekeeper right and the reason I",
    "start": "2029970",
    "end": "2035910"
  },
  {
    "text": "mentioned this is because gatekeeper is growing in its popularity in its usage",
    "start": "2035910",
    "end": "2041340"
  },
  {
    "text": "we are now including it as a core part of one of our biggest you know products as well and cloud so that you're gonna",
    "start": "2041340",
    "end": "2047220"
  },
  {
    "text": "see a lot more of these policies and objects I strongly urge you all if you",
    "start": "2047220",
    "end": "2052770"
  },
  {
    "text": "have any kind of IT governance regulatory compliance if you just have people who are freewheeling and like to",
    "start": "2052770",
    "end": "2058889"
  },
  {
    "text": "push objects in your cluster all day long I need to set some rules take a look at gatekeeper it's incredibly powerful before I leave you I do want to",
    "start": "2058890",
    "end": "2066870"
  },
  {
    "text": "mention there's a handful of links here these are all the slides oh if you download with the slides already do it again because I changed a bunch of stuff",
    "start": "2066870",
    "end": "2072270"
  },
  {
    "text": "in the last two days so grab them again from the link there but you can check my github repo for now that's where those",
    "start": "2072270",
    "end": "2077970"
  },
  {
    "text": "policies are once I get him into the gatekeeper contribute and do all that stuff there's a link to gatekeeper",
    "start": "2077970",
    "end": "2085500"
  },
  {
    "text": "there's a link to the rego policy language and then a link to the ACM Docs page if you want to dig into it the",
    "start": "2085500",
    "end": "2091500"
  },
  {
    "text": "other thing I would mention is there anybody from styro in the room real quick no hands",
    "start": "2091500",
    "end": "2096679"
  },
  {
    "text": "okay there's a couple people back there awesome listen if you're gonna write rego they had this great tool called the rego",
    "start": "2096680",
    "end": "2103500"
  },
  {
    "text": "playground which makes life so much easier you get to just write your code and test it in a browser it's really",
    "start": "2103500",
    "end": "2109320"
  },
  {
    "text": "handy and I strongly recommend you do it if you want to ask me any questions I'm probably gonna get booted here right now",
    "start": "2109320",
    "end": "2115620"
  },
  {
    "text": "so I will be out in the hallway come find me I'm happy to hang out and answer anything for you thank you very much",
    "start": "2115620",
    "end": "2121540"
  },
  {
    "text": "[Applause]",
    "start": "2121540",
    "end": "2125150"
  }
]