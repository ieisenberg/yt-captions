[
  {
    "text": "so welcome everyone to is uh this is very exciting uh so my name is Arthur this is",
    "start": "160",
    "end": "7319"
  },
  {
    "text": "Budan uh we are both sres at pigment uh for those of us who don't know you we",
    "start": "7319",
    "end": "12679"
  },
  {
    "text": "don't blame you uh we're a young company and pigment is a French software company",
    "start": "12679",
    "end": "17840"
  },
  {
    "text": "and so we've been using stto in production since the very beginning of pigment uh so four years ago",
    "start": "17840",
    "end": "25240"
  },
  {
    "text": "and I am not this talk is not about explaining how it's works because we",
    "start": "25240",
    "end": "30400"
  },
  {
    "text": "don't fully understand it but more about how we use it uh at pigment so brief aside I'm not going to",
    "start": "30400",
    "end": "36920"
  },
  {
    "text": "pitch you pigment but uh what you need to know is that pigment is a web application uh that stores user data uh",
    "start": "36920",
    "end": "43960"
  },
  {
    "text": "they can use our application to import their data transform it visualize it and do that you know make business decisions",
    "start": "43960",
    "end": "50640"
  },
  {
    "text": "based on that so there are zero pigment users in this room well two because we",
    "start": "50640",
    "end": "55760"
  },
  {
    "text": "do food a little bit but that's it so the way this is going to go uh is",
    "start": "55760",
    "end": "61559"
  },
  {
    "text": "we're going to start with why uh we actually set up a global request",
    "start": "61559",
    "end": "66759"
  },
  {
    "text": "routing uh to achieve seamless data locality um and then how we did it which",
    "start": "66759",
    "end": "72040"
  },
  {
    "text": "is the interesting part and then we'll conclude with you know some next steps that we can see uh in the near",
    "start": "72040",
    "end": "79200"
  },
  {
    "text": "future so um why did we do this uh why do we care about data locality why do we",
    "start": "79200",
    "end": "85479"
  },
  {
    "text": "care about where data is and the fact is that we're all tech people here we care about where our data is and the fact is",
    "start": "85479",
    "end": "91759"
  },
  {
    "text": "that most organizations are starting to care as well uh there's legislation in place like gdpr CCPA um that actually",
    "start": "91759",
    "end": "100159"
  },
  {
    "text": "enforces rules on data and how it is managed depending on where it is geographically and so companies",
    "start": "100159",
    "end": "108000"
  },
  {
    "text": "uh companies we want to sell pigment to um they are starting to care a lot about",
    "start": "108000",
    "end": "114000"
  },
  {
    "text": "where their data is and so we need to have a response with the that and so so our response was well I",
    "start": "114000",
    "end": "121920"
  },
  {
    "text": "mean when we talked about with our users uh potential users uh we wanted to sell Pigman to um what we figured was there",
    "start": "121920",
    "end": "130720"
  },
  {
    "text": "are three things that are important to them the first one is that they want their data to be stored and processed in a specific region right uh we call this",
    "start": "130720",
    "end": "137680"
  },
  {
    "text": "a location um in our implementation um and basically European users they want",
    "start": "137680",
    "end": "143040"
  },
  {
    "text": "their data to stay in the EU American users sometimes they're okay with EU but sometimes they want their data to be in",
    "start": "143040",
    "end": "148680"
  },
  {
    "text": "the US uh etc etc uh so they want to be able to choose um the second thing is",
    "start": "148680",
    "end": "154920"
  },
  {
    "text": "that we users want a single platform uh users don't want on your login p on our",
    "start": "154920",
    "end": "160200"
  },
  {
    "text": "login page to have to choose EU US Canada whatever uh they don't want to do",
    "start": "160200",
    "end": "166840"
  },
  {
    "text": "that they just want to click log in and be logged in and for it to work so it needs to be seamless somehow the fact is",
    "start": "166840",
    "end": "172959"
  },
  {
    "text": "organizations care about where the data is but users do not right users just want to use the app they don't care care",
    "start": "172959",
    "end": "180159"
  },
  {
    "text": "about what data center they're using and finally uh they care about",
    "start": "180159",
    "end": "185680"
  },
  {
    "text": "their data so we have to protect it we are stewards are their data and so security is",
    "start": "185680",
    "end": "192040"
  },
  {
    "text": "important but then on top of that uh we at pigment R&D we added some requirements to that um so first of all",
    "start": "192040",
    "end": "200640"
  },
  {
    "text": "this multi-regional this Global infrastructure has to be reliable uh buo and I were sres reliability matters to",
    "start": "200640",
    "end": "208040"
  },
  {
    "text": "us um and also when we're extending this infrastructure so we're going from a",
    "start": "208040",
    "end": "213720"
  },
  {
    "text": "single region application to a multi- region application we don't want this",
    "start": "213720",
    "end": "219319"
  },
  {
    "text": "extension to actually require downtime right we don't want to break our application even temporarily to be like",
    "start": "219319",
    "end": "224439"
  },
  {
    "text": "okay well hold on like pigment is down for two hours because you know we're migrating uh we don't want to do",
    "start": "224439",
    "end": "230799"
  },
  {
    "text": "that uh third we want our infrastructure to be Cloud agnostic So today we're",
    "start": "230799",
    "end": "236040"
  },
  {
    "text": "running on Google Cloud but we want to be able to extend elsewhere uh mostly because we have some potential users who",
    "start": "236040",
    "end": "244239"
  },
  {
    "text": "don't really like that we're they're giving they don't like to give us money that we then give to Google because",
    "start": "244239",
    "end": "249519"
  },
  {
    "text": "they're also working in advertising or something like that so we want to be able to move to or extend to other Cloud",
    "start": "249519",
    "end": "255360"
  },
  {
    "text": "providers later which is why we use kubernetes which is why we use ISO um it's really nice to manage your own",
    "start": "255360",
    "end": "261560"
  },
  {
    "text": "stack and finally we don't want to compromise our productivity um as",
    "start": "261560",
    "end": "268759"
  },
  {
    "text": "engineers because we're managing uh multiple regions we don't want to deploy",
    "start": "268759",
    "end": "274520"
  },
  {
    "text": "more slowly we don't have want to have more operational load and these are things that are important to us and so",
    "start": "274520",
    "end": "280479"
  },
  {
    "text": "I'm going to pass uh to bang who's going to talk about how we did it so um at a",
    "start": "280479",
    "end": "286639"
  },
  {
    "text": "very high level uh pigmon infrastructure is a quite common pattern we so we're h",
    "start": "286639",
    "end": "292600"
  },
  {
    "text": "on kubernetes we have a set of databases a set of backend Services gateways",
    "start": "292600",
    "end": "298320"
  },
  {
    "text": "managed by EO and that's pretty much it and with that project what we wanted to",
    "start": "298320",
    "end": "303479"
  },
  {
    "text": "do is do the exact same infrastructure but in the US separate set of services",
    "start": "303479",
    "end": "309800"
  },
  {
    "text": "separate set of databases and so came the question of the user",
    "start": "309800",
    "end": "315400"
  },
  {
    "text": "experience um so what we could have done and didn't want to do was to have each",
    "start": "315400",
    "end": "322160"
  },
  {
    "text": "infrastructure uh behind a different host name that's the quickest um but uh",
    "start": "322160",
    "end": "328240"
  },
  {
    "text": "as AR mentioned we wanted something similar for users so we did not go that way instead uh what we decided to do was",
    "start": "328240",
    "end": "337840"
  },
  {
    "text": "to rout users to the correct location at the Gateway level uh leveraging ISO and",
    "start": "337840",
    "end": "345120"
  },
  {
    "text": "so American users uh would use the same H name host name as the European users",
    "start": "345120",
    "end": "350960"
  },
  {
    "text": "and the Gateway would redirect their request to the correct location so",
    "start": "350960",
    "end": "356360"
  },
  {
    "text": "pretty simple and this setup work as is so",
    "start": "356360",
    "end": "361919"
  },
  {
    "text": "perfect small problem however small detail is that for American users that",
    "start": "361919",
    "end": "367319"
  },
  {
    "text": "want to access uh the Us location that would be an uned back and force so not a",
    "start": "367319",
    "end": "374720"
  },
  {
    "text": "big issue uh with gns they resolve to the closest location and that's fine and",
    "start": "374720",
    "end": "381680"
  },
  {
    "text": "in all different scenarios um well they will still get rooted to the correct",
    "start": "381680",
    "end": "387199"
  },
  {
    "text": "location and so p effect no problem here so now comes the question how do we do",
    "start": "387199",
    "end": "393960"
  },
  {
    "text": "that with ISO exactly um so for that we",
    "start": "393960",
    "end": "399160"
  },
  {
    "text": "leverage virtual Services um so our gateways will um uh serve uh two host",
    "start": "399160",
    "end": "406120"
  },
  {
    "text": "names one public used by users and another one internal used by gateways to route to each others so what the Gateway",
    "start": "406120",
    "end": "414360"
  },
  {
    "text": "will do it will first um check the presence of a HTTP header or query",
    "start": "414360",
    "end": "419720"
  },
  {
    "text": "parameter to determine if the request that it's processing is meant for the",
    "start": "419720",
    "end": "425160"
  },
  {
    "text": "current location or another one if it's meant for another location then it will",
    "start": "425160",
    "end": "430560"
  },
  {
    "text": "send that traffic to that Gateway uh to the Gateway of the other location and if",
    "start": "430560",
    "end": "435960"
  },
  {
    "text": "the request is meant for this location then other matching rules uh will be",
    "start": "435960",
    "end": "441879"
  },
  {
    "text": "used and the and it will be then delegated to another ISO virtual service",
    "start": "441879",
    "end": "448000"
  },
  {
    "text": "that will handle the rooting and all the details to root to the correct endpoint of our services so overall this looks",
    "start": "448000",
    "end": "455960"
  },
  {
    "text": "great it's simple but there is a DA side is that it's a lot of virtual services",
    "start": "455960",
    "end": "462400"
  },
  {
    "text": "to maintain and update and keep tracks off we have a lot of services lots of",
    "start": "462400",
    "end": "468159"
  },
  {
    "text": "environment and this number is increasing every day it's eror prone and tedious especially for developers so to",
    "start": "468159",
    "end": "476440"
  },
  {
    "text": "tackle that we decided to generate the V ual Services um from a configuration",
    "start": "476440",
    "end": "482680"
  },
  {
    "text": "file with the listing the end points for each service so we don't have to modify by hand uh hundreds of files anymore",
    "start": "482680",
    "end": "490280"
  },
  {
    "text": "it's uh much quicker and less eror prone and deaths are much happier so I mean",
    "start": "490280",
    "end": "496440"
  },
  {
    "text": "everything looks good um but is it enough not exactly there are a few HKS",
    "start": "496440",
    "end": "502280"
  },
  {
    "text": "we still have to uh address the first one is uh the global",
    "start": "502280",
    "end": "508240"
  },
  {
    "text": "user Authentication with that pattern um because really um since a ticated user",
    "start": "508240",
    "end": "515399"
  },
  {
    "text": "can log in from anywhere we have to be able to um um do this login and find the",
    "start": "515399",
    "end": "522120"
  },
  {
    "text": "location from anywhere to um so to do that uh we went for the simplest way um",
    "start": "522120",
    "end": "528760"
  },
  {
    "text": "so we share the database for authentication um it's hosted in Europe",
    "start": "528760",
    "end": "534160"
  },
  {
    "text": "it's a simple caching uh there is a simple cach in the application layer for performances",
    "start": "534160",
    "end": "540440"
  },
  {
    "text": "but uh the it user cannot log in from any location the data of the company",
    "start": "540440",
    "end": "546200"
  },
  {
    "text": "still say stay on different infrastructure and it's just the only",
    "start": "546200",
    "end": "551519"
  },
  {
    "text": "piece of the of data that is shared across location and I will let heru talk about",
    "start": "551519",
    "end": "558320"
  },
  {
    "text": "the second uh Edge case thanks um okay so now let's talk about requests from",
    "start": "558320",
    "end": "564240"
  },
  {
    "text": "third parties because this is where it gets exotic um so as B mentioned um we",
    "start": "564240",
    "end": "569839"
  },
  {
    "text": "if we have a request coming in from our front end the front end has authenticated the user and so it knows",
    "start": "569839",
    "end": "575880"
  },
  {
    "text": "where that user's data is and it can set a header that our virtual services use to Route correctly the issue is with",
    "start": "575880",
    "end": "583920"
  },
  {
    "text": "requests that don't come from us uh so these are requests for instance import calls that come from our user systems uh",
    "start": "583920",
    "end": "591800"
  },
  {
    "text": "oo callbacks that come from you know whatever single sign on provider they have uh or web books for instance you",
    "start": "591800",
    "end": "598720"
  },
  {
    "text": "know we have slack integration so we get web books from slack um and most of these third parties they don't allow",
    "start": "598720",
    "end": "605079"
  },
  {
    "text": "setting request heads right we can't configure them to say well for you know this rule like if it's this slack",
    "start": "605079",
    "end": "611959"
  },
  {
    "text": "Channel please set this header to like production eu1 please um they're not going to do that and also requiring this",
    "start": "611959",
    "end": "619279"
  },
  {
    "text": "header would actually break API compatibility for our own users right those that already have already been",
    "start": "619279",
    "end": "624839"
  },
  {
    "text": "using our import API we don't want to send them an email being like okay you have one month month to start adding",
    "start": "624839",
    "end": "630240"
  },
  {
    "text": "this header or your Imports AR going to break right we don't want to do that so what we did is we used an Envoy",
    "start": "630240",
    "end": "637120"
  },
  {
    "text": "middleware and so this is where ISO comes in because none of what we've been talking about up until now is very you",
    "start": "637120",
    "end": "643720"
  },
  {
    "text": "know ISO ISO specific and now we're getting into it uh and so the middleware basically when a request comes in the",
    "start": "643720",
    "end": "649440"
  },
  {
    "text": "middleware runs and its job is to determine the Target location of that request and it can do so by",
    "start": "649440",
    "end": "656440"
  },
  {
    "text": "communicating with the backend to get information and when it DET once it's determined the the Target location it",
    "start": "656440",
    "end": "662240"
  },
  {
    "text": "sets the header and then our routing logic from before uh happens and proxies",
    "start": "662240",
    "end": "668440"
  },
  {
    "text": "to the correct Gateway so to inject a middleware in",
    "start": "668440",
    "end": "673600"
  },
  {
    "text": "stto I use an Envoy filter custom resource uh I'm not going to go into the details but basically you tell it where",
    "start": "673600",
    "end": "680079"
  },
  {
    "text": "in envoice filter chain you want to inject the middleware and then you just inline the code at the bottom um that's",
    "start": "680079",
    "end": "686399"
  },
  {
    "text": "pretty much it so what does this middleware look like",
    "start": "686399",
    "end": "691720"
  },
  {
    "text": "uh first things first it's written in Lua which is pretty high level language and surprisingly fast uh we really",
    "start": "691720",
    "end": "699360"
  },
  {
    "text": "impressed by the performance here uh and basically what our middleware to write a middleware what you need to do is you",
    "start": "699360",
    "end": "704839"
  },
  {
    "text": "need to implement a Handler this is the envoy on request function and what our Handler does is determines if it",
    "start": "704839",
    "end": "712040"
  },
  {
    "text": "actually needs to do anything if it doesn't it returns early then it communicates with the backend to",
    "start": "712040",
    "end": "717680"
  },
  {
    "text": "determine the target location for the requests uh that it's processing and",
    "start": "717680",
    "end": "722839"
  },
  {
    "text": "then finally once it has that Target location it sets the X pigment location header so that our virtual Services can",
    "start": "722839",
    "end": "729320"
  },
  {
    "text": "do their job so to get the the loc Target",
    "start": "729320",
    "end": "736000"
  },
  {
    "text": "location um our middleware doesn't really know like if it get gets a request with an API key in it it doesn't",
    "start": "736000",
    "end": "742800"
  },
  {
    "text": "have access to our database of API keys right so how does it know the Target location the way we do it is we take all",
    "start": "742800",
    "end": "750199"
  },
  {
    "text": "of the requests metadata and data uh so headers query string body and we send",
    "start": "750199",
    "end": "755600"
  },
  {
    "text": "all that to the back end to a specific endpoint asking the back end hey where is this request supposed to go and so we",
    "start": "755600",
    "end": "761800"
  },
  {
    "text": "send this to a special endpoint in our backend that has Global Knowledge right so that knows about all API Keys uh in",
    "start": "761800",
    "end": "768880"
  },
  {
    "text": "pigment EU and pigment us uh that knows all about that and the back end can look",
    "start": "768880",
    "end": "774839"
  },
  {
    "text": "at these headers parse them look at the query string parse the body make database calls and then return a Target",
    "start": "774839",
    "end": "784120"
  },
  {
    "text": "location but if there are any people srees among you you may have heard that",
    "start": "784120",
    "end": "789800"
  },
  {
    "text": "I am proxying I'm sending the body to the back end which means I'm buffering it um I'm reading the entire body from",
    "start": "789800",
    "end": "796399"
  },
  {
    "text": "the caller keeping it memory sending it to the back end and then once I have a response from the back end actually and",
    "start": "796399",
    "end": "802880"
  },
  {
    "text": "I can actually forward that body to the correct location and so I'm keeping this",
    "start": "802880",
    "end": "808440"
  },
  {
    "text": "body in memory and so if an attack if an attacker if somebody sends me a body that's one tab big my Gateway is not",
    "start": "808440",
    "end": "815920"
  },
  {
    "text": "going to like that um and so we actually need to put a cap on the size of the body we're willing to read um and this",
    "start": "815920",
    "end": "823160"
  },
  {
    "text": "is where Envoy is really great because you can just read the content length header to determine the size of the body",
    "start": "823160",
    "end": "831240"
  },
  {
    "text": "and if the caller lied about the size of the body in the header and voy will just kill the connection the instant the",
    "start": "831240",
    "end": "837560"
  },
  {
    "text": "caller just sends too many bites this is amazing so this is actually really easy to do but you got to think about it uh and if the body's too big we",
    "start": "837560",
    "end": "844480"
  },
  {
    "text": "just don't send it to the back end um which is enough for our use case because the only time we need the body is for",
    "start": "844480",
    "end": "850360"
  },
  {
    "text": "slack callbacks and the body is like 200 bytes so how do you test something like",
    "start": "850360",
    "end": "856920"
  },
  {
    "text": "this um the fact is there's this middleware integrates heavily with Envoy",
    "start": "856920",
    "end": "863440"
  },
  {
    "text": "uh it integrates heavily with our virtual Services logic it integrates heavily with um our backend and so",
    "start": "863440",
    "end": "870600"
  },
  {
    "text": "actually unit testing is pretty hard uh so what we opted for was blackbox end to end testing so what we have is a few",
    "start": "870600",
    "end": "878120"
  },
  {
    "text": "agents uh different places in the world that send at regular intervals they send",
    "start": "878120",
    "end": "883880"
  },
  {
    "text": "requests to our system uh these requests um to a specific endpoint on our back",
    "start": "883880",
    "end": "889360"
  },
  {
    "text": "end which is conf that back that endpoint's code is basically just respond with the backends location and",
    "start": "889360",
    "end": "897320"
  },
  {
    "text": "that way we can send a battery of requests and check okay where are these requests Landing are they Landing in",
    "start": "897320",
    "end": "902519"
  },
  {
    "text": "Europe are they Landing in the US and we can make sure that they're Landing in the correct place so for instance in",
    "start": "902519",
    "end": "907880"
  },
  {
    "text": "this example uh the top API is belongs to an EU organization and so it should",
    "start": "907880",
    "end": "914440"
  },
  {
    "text": "be routed to the EU and the bottom API key belongs to us organization so it should be routed to the US and so we can",
    "start": "914440",
    "end": "921480"
  },
  {
    "text": "continuously run this and the the idea is that if the middleware ever breaks in production or",
    "start": "921480",
    "end": "929240"
  },
  {
    "text": "production uh we get an alert and so we know so basically if we want to change the middleware we deploy it to staging",
    "start": "929240",
    "end": "935759"
  },
  {
    "text": "we wait for 10 minutes and if we didn't get a message on slack we're",
    "start": "935759",
    "end": "940800"
  },
  {
    "text": "good and so at this point um we have the basic logic with the virtual Services we",
    "start": "940880",
    "end": "946680"
  },
  {
    "text": "have the um we've handled the edge cases of",
    "start": "946680",
    "end": "951800"
  },
  {
    "text": "authentication and third party requests and so we've met our requirements at this point uh our user data is stored",
    "start": "951800",
    "end": "958160"
  },
  {
    "text": "and processed in in specific locations right we have separate databases we have separate backend instances uh and we",
    "start": "958160",
    "end": "963880"
  },
  {
    "text": "have a single platform right there's single authentication uh they just go to pigment. apppp and it works and there",
    "start": "963880",
    "end": "970480"
  },
  {
    "text": "seamless routing users don't even like areu users they didn't even know when we",
    "start": "970480",
    "end": "976240"
  },
  {
    "text": "made the US platform go live right they just didn't need to know it just worked some of them actually saw decreased",
    "start": "976240",
    "end": "981800"
  },
  {
    "text": "latency they were like wait things are faster now um and regarding security uh well we",
    "start": "981800",
    "end": "988319"
  },
  {
    "text": "encrypt the data in transit when it's in transit between gateways that was important to us um but we also have",
    "start": "988319",
    "end": "993360"
  },
  {
    "text": "regular pent test and a bug Bounty program so now we have like 200 people who know how it works uh if you find a",
    "start": "993360",
    "end": "999040"
  },
  {
    "text": "bug please call us uh there's money on the line if you want it and regarding our internal",
    "start": "999040",
    "end": "1006319"
  },
  {
    "text": "requirements uh well the extended infrastructure is very reliable we've had no issues so far uh we were able to",
    "start": "1006319",
    "end": "1013399"
  },
  {
    "text": "add the US infrastructure piece by piece and so this actually required no downtime on the EU infrastructure we",
    "start": "1013399",
    "end": "1019480"
  },
  {
    "text": "deploy the cluster and then the Gateway and then configure DNS Etc uh the extend infrastructure is",
    "start": "1019480",
    "end": "1024918"
  },
  {
    "text": "cloud agnostic we use no cloud provider specific uh functionality here uh it's",
    "start": "1024919",
    "end": "1030000"
  },
  {
    "text": "just stto pure pure sto config um and deploying to multiple",
    "start": "1030000",
    "end": "1036160"
  },
  {
    "text": "locations is seamless uh and I'll let B go into more detail about this",
    "start": "1036160",
    "end": "1042558"
  },
  {
    "text": "seamlessness yes so at you mentioned non um some technical requirements that we",
    "start": "1043319",
    "end": "1050440"
  },
  {
    "text": "had to address um one was that uh it was it had to be really seamless and not",
    "start": "1050440",
    "end": "1056559"
  },
  {
    "text": "impact the rest of pigma R&D um and it's a case uh firstly for",
    "start": "1056559",
    "end": "1062679"
  },
  {
    "text": "backend Services um our backend Services most of them are not aware of the",
    "start": "1062679",
    "end": "1067720"
  },
  {
    "text": "concept of location they do not need it to do their job and also they if we want",
    "start": "1067720",
    "end": "1073880"
  },
  {
    "text": "to add a new location we don't need to do any cut changes uh and there is a not",
    "start": "1073880",
    "end": "1079480"
  },
  {
    "text": "on time as AR mentioned um so pretty simple on that matter also for",
    "start": "1079480",
    "end": "1085440"
  },
  {
    "text": "developers so we did not want to decrease developer velocity uh it's es especially important uh in a growing",
    "start": "1085440",
    "end": "1092559"
  },
  {
    "text": "startup so we have cicd test and and they deploy to all location in parallel",
    "start": "1092559",
    "end": "1099159"
  },
  {
    "text": "so developers they did not add any complexity to the job um and also we",
    "start": "1099159",
    "end": "1105720"
  },
  {
    "text": "just made sure to had um location TXS to dashboard and alerts uh to make sure",
    "start": "1105720",
    "end": "1111200"
  },
  {
    "text": "that uh developers especially on and on calls would have the necessary information for",
    "start": "1111200",
    "end": "1117919"
  },
  {
    "text": "troubleshooting and there is also sres to think about after all SRS put this",
    "start": "1117919",
    "end": "1123640"
  },
  {
    "text": "system in place um the cross location routing can be uh bypassed easily for",
    "start": "1123640",
    "end": "1130360"
  },
  {
    "text": "testing thanks to the internal or names um thanks to the blackb testing that AR",
    "start": "1130360",
    "end": "1136159"
  },
  {
    "text": "mentioned uh were alerted when the set up breaks even partially and we've had no major outage",
    "start": "1136159",
    "end": "1144320"
  },
  {
    "text": "due to this system in production since the go live so pretty exciting for",
    "start": "1144320",
    "end": "1149919"
  },
  {
    "text": "us um and well even if everything turn not great we still learned some lessons",
    "start": "1149919",
    "end": "1156520"
  },
  {
    "text": "and made some mistakes along the way uh so a couple of them uh first is that uh",
    "start": "1156520",
    "end": "1163480"
  },
  {
    "text": "we managed to self do ourselves um so we pushed uh faulty manual configuration",
    "start": "1163480",
    "end": "1171600"
  },
  {
    "text": "did a network loop network loop between our two gateways and they just crashed",
    "start": "1171600",
    "end": "1176720"
  },
  {
    "text": "thankfully it was in staging and since it was due to a manual config error now",
    "start": "1176720",
    "end": "1181840"
  },
  {
    "text": "we generate this configuration and as long as the logic in the code is good this should not happen again and Al",
    "start": "1181840",
    "end": "1189880"
  },
  {
    "text": "something else also um uh we use the virtual service delegation pattern where",
    "start": "1189880",
    "end": "1195480"
  },
  {
    "text": "um parent virtual service would delegate the rest of the process to a delegate virtual service and we find out that for",
    "start": "1195480",
    "end": "1202799"
  },
  {
    "text": "our use case uh it was not perhaps not such a great fit um so it's a pattern",
    "start": "1202799",
    "end": "1209000"
  },
  {
    "text": "that can be eror prone so you have to keep that in mind when you use it because it's easy to have a mismatch",
    "start": "1209000",
    "end": "1214360"
  },
  {
    "text": "between the parent and delegate virtual service let's say for example you're matching traffic on a certain prefix uh",
    "start": "1214360",
    "end": "1221559"
  },
  {
    "text": "at the parent level and you make a mistake a developer modify just one chart uh and the at match another",
    "start": "1221559",
    "end": "1230120"
  },
  {
    "text": "slightly different prefix then traffic will get dropped um so you have to keep that in mind when you use that pattern",
    "start": "1230120",
    "end": "1237960"
  },
  {
    "text": "and something else also it's there is only one level of nesting you cannot a delegate virtual service cannot delegate",
    "start": "1237960",
    "end": "1244640"
  },
  {
    "text": "to third virtual service and for our use case and the image we have of",
    "start": "1244640",
    "end": "1249760"
  },
  {
    "text": "infrastructure we would have liked to be able to really separate uh virtual service for location routing for backing",
    "start": "1249760",
    "end": "1257039"
  },
  {
    "text": "service routing Etc it's not possible so it's something that for our specific use",
    "start": "1257039",
    "end": "1263240"
  },
  {
    "text": "case um is uh well would have like to be able to leverage it and we're thinking",
    "start": "1263240",
    "end": "1269200"
  },
  {
    "text": "of going back to one big generated virtual service instead of uh uh a lot",
    "start": "1269200",
    "end": "1276360"
  },
  {
    "text": "of them so we're getting close to the end of this talk um we're happy to be able",
    "start": "1276360",
    "end": "1284400"
  },
  {
    "text": "to share this experience with you with peers like all of you uh um but the",
    "start": "1284400",
    "end": "1289559"
  },
  {
    "text": "question is now now we're looking to the Future like this works this has been in production for 9 months now um we've had",
    "start": "1289559",
    "end": "1295679"
  },
  {
    "text": "I haven't had any maor major issues and we've kind of moved on to other stuff because the company keeps growing um but",
    "start": "1295679",
    "end": "1303200"
  },
  {
    "text": "regarding this setup like what is next what is what can we see in the near",
    "start": "1303200",
    "end": "1308840"
  },
  {
    "text": "future um or what do we want to do in the near future I think the first thing we want to do is we want to replace the",
    "start": "1308840",
    "end": "1315720"
  },
  {
    "text": "authentication database like as ban said ly it's hosted in the EU and the US",
    "start": "1315720",
    "end": "1321080"
  },
  {
    "text": "authentication Service uses that database directly uh the issue here is",
    "start": "1321080",
    "end": "1326120"
  },
  {
    "text": "one of reliability if the EU region goes down the E region doesn't work anymore",
    "start": "1326120",
    "end": "1332640"
  },
  {
    "text": "uh the opposite isn't true like if the US region goes down the EU region keeps working um and we'd like to split these",
    "start": "1332640",
    "end": "1340679"
  },
  {
    "text": "failure domains um and so we'd like to have a global highly",
    "start": "1340679",
    "end": "1346480"
  },
  {
    "text": "available database for Authentication we'd also like more tests on the middleware uh not because we think it's",
    "start": "1346480",
    "end": "1353159"
  },
  {
    "text": "buggy for now it works right um but more but actually because as we add more",
    "start": "1353159",
    "end": "1360480"
  },
  {
    "text": "Integrations from third parties into our system uh we keep adding more endpoints",
    "start": "1360480",
    "end": "1365919"
  },
  {
    "text": "uh to the middleware uh didn't show them the Code but manages some endpoints slightly differently",
    "start": "1365919",
    "end": "1373000"
  },
  {
    "text": "and the thing is today the feedback loop is basically will deploy the change to staging wait a bit and if it works",
    "start": "1373000",
    "end": "1380279"
  },
  {
    "text": "you're fine but if it doesn't work like the feedback loop is pretty slow and so we'd like to have some form of unit or",
    "start": "1380279",
    "end": "1386600"
  },
  {
    "text": "integration testing like in our C so that you know we can quickly CH uh check if something works or",
    "start": "1386600",
    "end": "1393799"
  },
  {
    "text": "not we'd also like to extend this setup to uh other locations uh on the same",
    "start": "1393799",
    "end": "1399400"
  },
  {
    "text": "cloud provider so a different country or different Cloud providers uh as we said",
    "start": "1399400",
    "end": "1404480"
  },
  {
    "text": "we made the conscious choice of making this setup Cloud agnostic and we'd like to put that to the test so that would be",
    "start": "1404480",
    "end": "1411159"
  },
  {
    "text": "pretty exciting uh we're eager to do it um it's not IM in like an immediate future but we can see it coming in like",
    "start": "1411159",
    "end": "1417400"
  },
  {
    "text": "the next couple years and finally we'd like more cross- location features in the pigment app",
    "start": "1417400",
    "end": "1423360"
  },
  {
    "text": "itself um today like there are a few Global features the main one is",
    "start": "1423360",
    "end": "1430080"
  },
  {
    "text": "authentication um but there are other features in pigment that makes sense to be Global um and we're working uh in",
    "start": "1430080",
    "end": "1438720"
  },
  {
    "text": "collaboration with our uh deer backend Engineers to actually make this work and",
    "start": "1438720",
    "end": "1444200"
  },
  {
    "text": "the fact is our network setup isn't perfect for instance like in this setup Services can send each other like HTTP",
    "start": "1444200",
    "end": "1450520"
  },
  {
    "text": "calls via the gateways but currently they can't send grpc calls but the back",
    "start": "1450520",
    "end": "1455600"
  },
  {
    "text": "end mostly communicates using JPC so this is an issue and we need to keep",
    "start": "1455600",
    "end": "1461240"
  },
  {
    "text": "working to improve pigment on this so thank you for your attention uh",
    "start": "1461240",
    "end": "1467039"
  },
  {
    "text": "and if you want to join us uh we are hiring thank [Applause]",
    "start": "1467039",
    "end": "1475539"
  },
  {
    "text": "you all right and we've got a few minutes for questions as well uh so if anybody has questions go and raise your",
    "start": "1475840",
    "end": "1481520"
  },
  {
    "text": "hand and I'll bring the mic over sorry I cross the room",
    "start": "1481520",
    "end": "1489440"
  },
  {
    "text": "here uh so it seems like U you are kind of a duplicating you can correct me if",
    "start": "1492399",
    "end": "1497919"
  },
  {
    "text": "I'm wrong uh what I have understood like you kind of are duplicating the whole infrastructure for us and EU uh like",
    "start": "1497919",
    "end": "1504880"
  },
  {
    "text": "redirecting the request just on the basis of the Gateway so do you like in",
    "start": "1504880",
    "end": "1509919"
  },
  {
    "text": "the whole process have you thought about like putting some micros servic as a central because these things we do",
    "start": "1509919",
    "end": "1516039"
  },
  {
    "text": "because we have a pii data or these kind of regulations so have you thought of uh",
    "start": "1516039",
    "end": "1521600"
  },
  {
    "text": "like binding up few microservices which has no relation with uh like storing the data and Pi data and just processing it",
    "start": "1521600",
    "end": "1528760"
  },
  {
    "text": "centrally and then just restricting the reason based things to the Pia data or",
    "start": "1528760",
    "end": "1533960"
  },
  {
    "text": "the data where we are storing or processing on everything um that's a good question uh",
    "start": "1533960",
    "end": "1541080"
  },
  {
    "text": "we thought about it uh thing is in our case it's not really Pi data it's business data and just just so it",
    "start": "1541080",
    "end": "1547640"
  },
  {
    "text": "happens that our sometimes there's Pi data but we don't know about it right um",
    "start": "1547640",
    "end": "1553080"
  },
  {
    "text": "sometimes users put uh Pi data in our system um so we kind of need to assume that everything is",
    "start": "1553080",
    "end": "1560000"
  },
  {
    "text": "sensitive um today most like I'd say like more than half of",
    "start": "1560000",
    "end": "1566279"
  },
  {
    "text": "the pigment app itself is about processing this data um fundamentally",
    "start": "1566279",
    "end": "1571360"
  },
  {
    "text": "it's a data processing application and so I don't think it would make sense for",
    "start": "1571360",
    "end": "1577080"
  },
  {
    "text": "us to just extract like a third of our microservices and put them and consider like okay these Services aren't",
    "start": "1577080",
    "end": "1583320"
  },
  {
    "text": "sensitive and so they're separate I think we we kind of like having this",
    "start": "1583320",
    "end": "1588480"
  },
  {
    "text": "sort of Monolithic uh infrastructure today now we have two I guess um I mean",
    "start": "1588480",
    "end": "1595960"
  },
  {
    "text": "we we considered it and I think it's just a matter of preference that we went this",
    "start": "1595960",
    "end": "1601679"
  },
  {
    "text": "way awesome is there a question over here more",
    "start": "1602039",
    "end": "1607398"
  },
  {
    "text": "questions yeah I was wondering if you could clarify um you know for with stdo for the gate way what where does it",
    "start": "1612880",
    "end": "1621000"
  },
  {
    "text": "overlap or you know what to what degree are you dependent on",
    "start": "1621000",
    "end": "1626880"
  },
  {
    "text": "um sto for what you're offering and then",
    "start": "1626880",
    "end": "1632279"
  },
  {
    "text": "when where does solo pick up or what was really cool about solo that you opted to use that to",
    "start": "1632279",
    "end": "1640320"
  },
  {
    "text": "extend uh what you're doing um Gateway side I imagine yeah a",
    "start": "1640320",
    "end": "1646159"
  },
  {
    "text": "couple things um well first first thing is we don't we mostly use stto for the",
    "start": "1646159",
    "end": "1651559"
  },
  {
    "text": "service smesh uh we just happen to already have the gateways and inv",
    "start": "1651559",
    "end": "1656720"
  },
  {
    "text": "envoice capabilities at our disposal when we start to do work on this project um and to answer your question about",
    "start": "1656720",
    "end": "1662960"
  },
  {
    "text": "solo we don't use solo right any other questions otherwise",
    "start": "1662960",
    "end": "1670600"
  },
  {
    "text": "I have one I have one quick one while I'm walking over which is uh so for the Middle where you you implemented that in",
    "start": "1670600",
    "end": "1676519"
  },
  {
    "text": "Lua did y'all look at Wasa was there or not or was there any kind of debate or",
    "start": "1676519",
    "end": "1681760"
  },
  {
    "text": "decision uh between those two uh there was a discussion uh we opted for Lua",
    "start": "1681760",
    "end": "1687200"
  },
  {
    "text": "initially because the middleware isn't that big uh like I only showed like the gist of it but overall it's maybe 300",
    "start": "1687200",
    "end": "1694159"
  },
  {
    "text": "lines of Lua so it's not a big thing so we figured like a scripting language was fine but we may consider a wasm for more",
    "start": "1694159",
    "end": "1701840"
  },
  {
    "text": "compliment use case later okay thanks for sharing if I",
    "start": "1701840",
    "end": "1707279"
  },
  {
    "text": "understood it you have two regions like the US and Europe and have you thought about scaling these up I mean imagine",
    "start": "1707279",
    "end": "1715000"
  },
  {
    "text": "you have um 20 30 points of presence for example you have zones in I know Germany",
    "start": "1715000",
    "end": "1721799"
  },
  {
    "text": "France uh UK several in Asia like I don't know have you thought about",
    "start": "1721799",
    "end": "1728720"
  },
  {
    "text": "scaling this infrastructure I mean it's expensive to keep um the full set of",
    "start": "1728720",
    "end": "1734159"
  },
  {
    "text": "your applications in each um Zone own yeah and now you have to create",
    "start": "1734159",
    "end": "1741440"
  },
  {
    "text": "something I know to put some services in Germany some services are deployed in",
    "start": "1741440",
    "end": "1748559"
  },
  {
    "text": "France some of them are in the UK and you have to split the traffic to root it",
    "start": "1748559",
    "end": "1754240"
  },
  {
    "text": "across these regions across these zones have you thought about this I mean when",
    "start": "1754240",
    "end": "1759799"
  },
  {
    "text": "you have not two regions but a lot of them uh we have thought about it like",
    "start": "1759799",
    "end": "1765080"
  },
  {
    "text": "how does this scale uh basically uh um there what we're mostly worried about is",
    "start": "1765080",
    "end": "1770720"
  },
  {
    "text": "the operational load of actually operating all these clusters from a uh Financial like a cost standpoint uh it's",
    "start": "1770720",
    "end": "1778360"
  },
  {
    "text": "not really an issue uh the core of our cost is our databases and the fact is if",
    "start": "1778360",
    "end": "1784000"
  },
  {
    "text": "we deploy a cluster and there's nobody on it then it doesn't cause very much relative to the others okay",
    "start": "1784000",
    "end": "1792559"
  },
  {
    "text": "thanks hey hello um you mentioned having issues with delegated viritual services",
    "start": "1792679",
    "end": "1798039"
  },
  {
    "text": "have you considered using the gayway API uh kind of what's if you know the pros and cons um we haven't uh for the simple",
    "start": "1798039",
    "end": "1807240"
  },
  {
    "text": "reason so we're using ISO for four years now and so we already had the gateways",
    "start": "1807240",
    "end": "1812399"
  },
  {
    "text": "managed through IO so we didn't really when we started the project wanted to take care of the",
    "start": "1812399",
    "end": "1818200"
  },
  {
    "text": "migration um something we may revisit some place in the future but as of now",
    "start": "1818200",
    "end": "1824240"
  },
  {
    "text": "it works um but yeah it's definitely something we see a lot of uh work being",
    "start": "1824240",
    "end": "1830880"
  },
  {
    "text": "done there yeah I'll just add one thing uh as B said like we we already had",
    "start": "1830880",
    "end": "1836000"
  },
  {
    "text": "virtual Services everywhere and what we only needed well kind of like to to add",
    "start": "1836000",
    "end": "1842000"
  },
  {
    "text": "a little bit of functionality to them so we didn't figure like moving to the Gateway API was what we wanted to do it",
    "start": "1842000",
    "end": "1848000"
  },
  {
    "text": "seemed like a big thing for just this small feature um but we are definitely",
    "start": "1848000",
    "end": "1854039"
  },
  {
    "text": "keeping an eye on it uh it is probably something we'll do relatively soon",
    "start": "1854039",
    "end": "1859919"
  }
]