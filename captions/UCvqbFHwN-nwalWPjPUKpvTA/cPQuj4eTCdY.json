[
  {
    "text": "welcome everyone to this breakout session we are live in Detroit at kubecon n a",
    "start": "1460",
    "end": "8519"
  },
  {
    "text": "and welcome also to our virtual audience today we will be talking about with us",
    "start": "8519",
    "end": "16940"
  },
  {
    "text": "my name is deepti sigredi I am the tech lead and a maintainer of with us",
    "start": "19740",
    "end": "26039"
  },
  {
    "text": "I'm Rohit Naik I'm also a middle of fitness Matt was supposed to join us but he",
    "start": "26039",
    "end": "31560"
  },
  {
    "text": "wasn't able to travel at the last minute we'll start with an overview of witness",
    "start": "31560",
    "end": "39320"
  },
  {
    "text": "is a cncf graduated project it became a",
    "start": "39680",
    "end": "44820"
  },
  {
    "text": "cncf project in January of 2018 at the incubating level and in November of 2019",
    "start": "44820",
    "end": "51059"
  },
  {
    "text": "britus became the eighth project to graduate from cncf wittus is a cloud native database",
    "start": "51059",
    "end": "57539"
  },
  {
    "text": "what does it mean to be Cloud native it means that for a very long time now",
    "start": "57539",
    "end": "63680"
  },
  {
    "text": "bitus has been able to run in kubernetes uh Witnesses massively scalable it was",
    "start": "63680",
    "end": "70860"
  },
  {
    "text": "originally created at YouTube to create to solve YouTube's scaling problems with mySQL and uh witness is also highly",
    "start": "70860",
    "end": "79020"
  },
  {
    "text": "available and the way witters achieves scalability partly is through sharing and that will",
    "start": "79020",
    "end": "85740"
  },
  {
    "text": "be a focus of our talk today I already mentioned with mySQL but I",
    "start": "85740",
    "end": "92400"
  },
  {
    "text": "just want to reiterate that with us is built around MySQL and it's compatible with both 5.7 and 8.0",
    "start": "92400",
    "end": "101240"
  },
  {
    "text": "witness works with database Frameworks orms any MySQL clients that you already",
    "start": "102000",
    "end": "108720"
  },
  {
    "text": "have Legacy code that's using MySQL pretty much anything that works with",
    "start": "108720",
    "end": "115740"
  },
  {
    "text": "mySQL will work with with us what we test does is that it gives a",
    "start": "115740",
    "end": "123119"
  },
  {
    "text": "logical database view to clients behind the scenes there may be many many",
    "start": "123119",
    "end": "128640"
  },
  {
    "text": "physical databases there are people who are running thousands of MySQL instances",
    "start": "128640",
    "end": "134940"
  },
  {
    "text": "behind wittus and wittest can provide this logical view across all of those",
    "start": "134940",
    "end": "141060"
  },
  {
    "text": "it takes care of doing the query routing to the appropriate backend databases",
    "start": "141060",
    "end": "146760"
  },
  {
    "text": "wittest supports both grpc and MySQL clients and it gives a single connection",
    "start": "146760",
    "end": "152040"
  },
  {
    "text": "view to clients this is the witness architecture uh",
    "start": "152040",
    "end": "159180"
  },
  {
    "text": "queries come in to with us and first hit the vtgate component which is a proxy",
    "start": "159180",
    "end": "164940"
  },
  {
    "text": "layer and what vtgate will do is based on the query it will figure out where to",
    "start": "164940",
    "end": "170819"
  },
  {
    "text": "Route the queries and behind the scenes especially if uh you're running with us",
    "start": "170819",
    "end": "176940"
  },
  {
    "text": "in a sharded environment there are multiple shards and each Shard will consist of a primary and one or more",
    "start": "176940",
    "end": "184920"
  },
  {
    "text": "replicas people run anywhere from two to ten",
    "start": "184920",
    "end": "190620"
  },
  {
    "text": "in the most extreme case 85 replicas the primary and replicas the primary and",
    "start": "190620",
    "end": "199200"
  },
  {
    "text": "replica instances of MySQL form MySQL replication group and each of those",
    "start": "199200",
    "end": "204840"
  },
  {
    "text": "MySQL instances is managed by a witness component called BT tablet",
    "start": "204840",
    "end": "210360"
  },
  {
    "text": "so a BT tablet is the one which receives queries from BT gate and then sends them",
    "start": "210360",
    "end": "217440"
  },
  {
    "text": "down to mySQL and by doing this one of the things we are able to do is that",
    "start": "217440",
    "end": "223140"
  },
  {
    "text": "connections to bitters are much lighter weight than MySQL connections",
    "start": "223140",
    "end": "229680"
  },
  {
    "text": "so you can have hundreds of thousands of connections to VT Gates which in the",
    "start": "229680",
    "end": "234959"
  },
  {
    "text": "backend translate to a much smaller number of MySQL connections through connection pooling so we do connection",
    "start": "234959",
    "end": "241500"
  },
  {
    "text": "pooling at the VT tablet level so that the same MySQL connections can be shared",
    "start": "241500",
    "end": "247799"
  },
  {
    "text": "across clients so this is the query serving path what",
    "start": "247799",
    "end": "252840"
  },
  {
    "text": "happens when a query comes to witness there is also the control plane which includes a topology server which can be",
    "start": "252840",
    "end": "259620"
  },
  {
    "text": "at CD or console or zookeeper and there is a control Daemon bitter control",
    "start": "259620",
    "end": "266400"
  },
  {
    "text": "Daemon which accepts administrative commands through a command line interface and sends them to the",
    "start": "266400",
    "end": "273300"
  },
  {
    "text": "appropriate components there's VT Arc which we spoke about yesterday we did a talk on video arc",
    "start": "273300",
    "end": "280199"
  },
  {
    "text": "yesterday VT Arc is the automatic failure detection and Recovery mechanism",
    "start": "280199",
    "end": "285240"
  },
  {
    "text": "in Vitus so if the primary MySQL for any given",
    "start": "285240",
    "end": "291720"
  },
  {
    "text": "Shard a particular Shard or key space is down VTR is the one that detects and fails over to a replica with minimal",
    "start": "291720",
    "end": "298620"
  },
  {
    "text": "downtime uh VT admin is our new web UI API",
    "start": "298620",
    "end": "304800"
  },
  {
    "text": "component and there is a web UI as well so that's a an overview of the",
    "start": "304800",
    "end": "311639"
  },
  {
    "text": "architecture of with us witness is in production at many places",
    "start": "311639",
    "end": "317699"
  },
  {
    "text": "this is just a sample subset of all the companies that are running and with",
    "start": "317699",
    "end": "322979"
  },
  {
    "text": "running with us in production many of them run on kubernetes some of them still run on VMS and basically",
    "start": "322979",
    "end": "329580"
  },
  {
    "text": "non-kubernetes environments uh some of the key adopters of witness",
    "start": "329580",
    "end": "337139"
  },
  {
    "text": "are slack which is 100 on with us GitHub which uh has started their migration to",
    "start": "337139",
    "end": "343259"
  },
  {
    "text": "with us but are still in the process of completing that migration so right now",
    "start": "343259",
    "end": "348300"
  },
  {
    "text": "they have a mix of witness managed and non-bitis managed uh databases",
    "start": "348300",
    "end": "353639"
  },
  {
    "text": "jd.com a Chinese retailer they are running 10 000 plus databases behind",
    "start": "353639",
    "end": "360419"
  },
  {
    "text": "Bitters and a planet scale has a database service that runs with us behind the scenes and",
    "start": "360419",
    "end": "367620"
  },
  {
    "text": "now has tens of thousands of witness clusters running",
    "start": "367620",
    "end": "373100"
  },
  {
    "text": "here are some uh testimonials from current witness users uh",
    "start": "374699",
    "end": "380340"
  },
  {
    "text": "Etsy and nozzle I'll give you a minute to read those",
    "start": "380340",
    "end": "386240"
  },
  {
    "text": "we have a Vibrant Community uh for the calendar years 2021 2020 to 2021",
    "start": "393840",
    "end": "402060"
  },
  {
    "text": "I gathered some statistics from Dev stats which is hosted by cncf we had 21",
    "start": "402060",
    "end": "407940"
  },
  {
    "text": "maintainers over 400 contributors of whom 214 were PR authors so we are",
    "start": "407940",
    "end": "414539"
  },
  {
    "text": "counting non-code contributions as well website uh docs issues",
    "start": "414539",
    "end": "421100"
  },
  {
    "text": "comments on issues reviews all of those things and our contributors came from 63",
    "start": "421100",
    "end": "427080"
  },
  {
    "text": "distinct companies and PR authors came from 30 distinct companies",
    "start": "427080",
    "end": "433080"
  },
  {
    "text": "now I'll hand off to Rohit to talk about weed application",
    "start": "433080",
    "end": "438620"
  },
  {
    "text": "hi wittest has always been",
    "start": "441360",
    "end": "447560"
  },
  {
    "text": "Shard aware so all the components are inbuilt understanding of sharding",
    "start": "447599",
    "end": "453419"
  },
  {
    "text": "architecture of witness for example query serving cluster management backups Etc",
    "start": "453419",
    "end": "459840"
  },
  {
    "text": "we have had tools to support Shadi right from the beginning but around four years ago our witness",
    "start": "459840",
    "end": "467400"
  },
  {
    "text": "co-creator and co-founder of Planet skills Suga Suga Martin had a sort of aha moment where he came up with this",
    "start": "467400",
    "end": "472919"
  },
  {
    "text": "weird application algorithm which works not just for sharding but for several other day Zero and day two",
    "start": "472919",
    "end": "480360"
  },
  {
    "text": "tasks that are required in at scale systems",
    "start": "480360",
    "end": "486259"
  },
  {
    "text": "so weird application is essentially a framework for creating and managing data pipelines these are",
    "start": "489000",
    "end": "496800"
  },
  {
    "text": "Shard aware pipelines to perform particular actions at an abstract level what it does is if",
    "start": "496800",
    "end": "503460"
  },
  {
    "text": "it matches a criteria that you define and then executes a defined workflow when we look at some of these workflows",
    "start": "503460",
    "end": "510240"
  },
  {
    "text": "you'll get a better understanding of this diff definition um",
    "start": "510240",
    "end": "515880"
  },
  {
    "text": "there are short-lived workflows which perform a particular task and then they are done",
    "start": "515880",
    "end": "521159"
  },
  {
    "text": "such as importing data into vitess sharding doing online schema changes for when",
    "start": "521159",
    "end": "529140"
  },
  {
    "text": "you're running ddls on large databases you don't need to bring your database down and there are long-lived workflows which",
    "start": "529140",
    "end": "537360"
  },
  {
    "text": "are used for continuous materialization and for a change that capture",
    "start": "537360",
    "end": "544100"
  },
  {
    "text": "we take a slightly deeper look into some of these when you migrate into a test let's say",
    "start": "544320",
    "end": "549600"
  },
  {
    "text": "you want to just try it out or you decided that it's you want to move it into move your MySQL cluster",
    "start": "549600",
    "end": "555720"
  },
  {
    "text": "into production we would first of course create the witness cluster in this case we have",
    "start": "555720",
    "end": "561660"
  },
  {
    "text": "created a sharded cluster but you could start with Uncharted as well that's the target the source is the existing database",
    "start": "561660",
    "end": "569040"
  },
  {
    "text": "which is in your data center it could be RDS Aurora Maria DB or vanilla MySQL",
    "start": "569040",
    "end": "576360"
  },
  {
    "text": "uh you would start an unmanaged tablet so in bites",
    "start": "576360",
    "end": "581940"
  },
  {
    "text": "typical witness clusters which has also the VT tablet also manages the database",
    "start": "581940",
    "end": "587160"
  },
  {
    "text": "in this case of course the database is external so it's called an unmanaged tablet and we start the move tables workflow",
    "start": "587160",
    "end": "595500"
  },
  {
    "text": "in this case all tables are moved from source to the Target the way the algorithm works is initially",
    "start": "595500",
    "end": "603140"
  },
  {
    "text": "we do a bulk copy that's bulk inserts into the target from the source and once",
    "start": "603140",
    "end": "609959"
  },
  {
    "text": "we are close we start streaming the bin logs it's a little more complicated than that but at",
    "start": "609959",
    "end": "616380"
  },
  {
    "text": "high level this is the algorithm this results in a very highly rapid eventually consistent system",
    "start": "616380",
    "end": "623820"
  },
  {
    "text": "and we're able to get uh like Shard hundreds of terabytes uh in",
    "start": "623820",
    "end": "630060"
  },
  {
    "text": "days or up to a week now once the workflow is running realize",
    "start": "630060",
    "end": "636180"
  },
  {
    "text": "that you're still online in all these workflows you're still online of course sourcing uh",
    "start": "636180",
    "end": "641820"
  },
  {
    "text": "serving your data from the source so the target is not yet serving",
    "start": "641820",
    "end": "648300"
  },
  {
    "text": "so when your application lag between the source and the target is low let us say about under a second or so you can start",
    "start": "648300",
    "end": "656279"
  },
  {
    "text": "switching traffic over into a test you have the choice of switching all traffic in the beginning or just reads into uh",
    "start": "656279",
    "end": "663540"
  },
  {
    "text": "with tests and still serving the rights from your source and then switching rights later on",
    "start": "663540",
    "end": "671640"
  },
  {
    "text": "now when the rights are switched we also by default start a reverse replication",
    "start": "671640",
    "end": "677880"
  },
  {
    "text": "into the source from the target so that at any time you can roll back if",
    "start": "677880",
    "end": "683459"
  },
  {
    "text": "you like for whatever reason",
    "start": "683459",
    "end": "687019"
  },
  {
    "text": "the same move tables workflow can also be used to move some tables into a different database",
    "start": "690120",
    "end": "697200"
  },
  {
    "text": "here for example we are moving the product related tables into products",
    "start": "697200",
    "end": "702839"
  },
  {
    "text": "and Order related tables into orders this works well",
    "start": "702839",
    "end": "708180"
  },
  {
    "text": "if you have services that have subsets of tables that are fairly independent",
    "start": "708180",
    "end": "714260"
  },
  {
    "text": "you of course have common tables there's another flow to support that",
    "start": "714260",
    "end": "719880"
  },
  {
    "text": "ah note that wittest will treat all of this as a logical database so even though internally there",
    "start": "719880",
    "end": "727800"
  },
  {
    "text": "is a separate mySQL database that is hosting some of the tables using vtgates",
    "start": "727800",
    "end": "734000"
  },
  {
    "text": "MySQL adapter you will still address the tables in the same way so the application doesn't need to change",
    "start": "734000",
    "end": "740899"
  },
  {
    "text": "now say you just have a very large table right a transaction table or a message table",
    "start": "744660",
    "end": "750779"
  },
  {
    "text": "so and that your current Hardware cannot manage that",
    "start": "750779",
    "end": "756720"
  },
  {
    "text": "either due to storage restrictions or read or write QPS cannot be increased",
    "start": "756720",
    "end": "761880"
  },
  {
    "text": "even though you have thrown Hardware with the problem so in that case you can do horizontal",
    "start": "761880",
    "end": "768240"
  },
  {
    "text": "charting where the table gets distributed across the shards in our example we already had a sharded",
    "start": "768240",
    "end": "775940"
  },
  {
    "text": "cluster but here we are showing that we can increase the number of shards here",
    "start": "775940",
    "end": "781139"
  },
  {
    "text": "we're just showing uh two to four but it could go like 2 to 50 something if you",
    "start": "781139",
    "end": "787019"
  },
  {
    "text": "want right the Richard workflow will support this in all cases of sharding you can go up",
    "start": "787019",
    "end": "795120"
  },
  {
    "text": "or go down I mean so the same workflow works for doing both for example in the",
    "start": "795120",
    "end": "800579"
  },
  {
    "text": "holiday season you might just want to Shard higher so that you can serve the traffic better at the end of it just go",
    "start": "800579",
    "end": "806279"
  },
  {
    "text": "back for cost reasons",
    "start": "806279",
    "end": "809899"
  },
  {
    "text": "now these the previous workflows we discussed were short-lived workflows",
    "start": "813120",
    "end": "819000"
  },
  {
    "text": "once the particular action is done the sharding action or the import action the workflow is complete these uh the next",
    "start": "819000",
    "end": "825959"
  },
  {
    "text": "two we are talking about are long running workflows",
    "start": "825959",
    "end": "831000"
  },
  {
    "text": "now you probably have heard of materialize views we test supports materialized views at",
    "start": "831720",
    "end": "837660"
  },
  {
    "text": "scale which sharded uh databases being backed by sharded databases sharded tables",
    "start": "837660",
    "end": "845279"
  },
  {
    "text": "you can create a materialized workflow with your query to",
    "start": "845279",
    "end": "852300"
  },
  {
    "text": "for example denormalize tables or to create aggregations for your",
    "start": "852300",
    "end": "858139"
  },
  {
    "text": "analytics data warehouse reporting Etc anonymization of data is a very",
    "start": "858139",
    "end": "864360"
  },
  {
    "text": "important application that several users are using when you want to move your data into",
    "start": "864360",
    "end": "869459"
  },
  {
    "text": "your Warehouse or into staging or Dev you might want to redact certain information",
    "start": "869459",
    "end": "875959"
  },
  {
    "text": "charted systems there are always common tables that are required across shards",
    "start": "877380",
    "end": "883019"
  },
  {
    "text": "like lookup tables country codes product catalog language tables for example",
    "start": "883019",
    "end": "891000"
  },
  {
    "text": "so it's possible to have a single table which has the master information",
    "start": "891000",
    "end": "897060"
  },
  {
    "text": "and all that can be uh materialized into each Shard so that all",
    "start": "897060",
    "end": "903959"
  },
  {
    "text": "the queries are local and not cross shot",
    "start": "903959",
    "end": "909260"
  },
  {
    "text": "queries that's not a problem but it's just a matter of performance so vtk knows where the data is located",
    "start": "909260",
    "end": "915180"
  },
  {
    "text": "and it will make the appropriate cross shot queries are required but using",
    "start": "915180",
    "end": "920459"
  },
  {
    "text": "something like local copies reduces that requirement for scattering the queries",
    "start": "920459",
    "end": "927259"
  },
  {
    "text": "the last uh application of weed application that I'll discuss is not a workflow per se but it's a API that is",
    "start": "933540",
    "end": "942899"
  },
  {
    "text": "available at vtgate it's a grpc API which will give you a event stream of",
    "start": "942899",
    "end": "950820"
  },
  {
    "text": "changes it can also give you snapshots or changes or both right you can start",
    "start": "950820",
    "end": "957000"
  },
  {
    "text": "saying that you want to stream the entire database and then keep streaming the changes this is extremely useful",
    "start": "957000",
    "end": "963779"
  },
  {
    "text": "and many users are using this for moving the data into a data warehouse",
    "start": "963779",
    "end": "969060"
  },
  {
    "text": "for example or for real-time notifications updating your elasticsearch stuff like",
    "start": "969060",
    "end": "975600"
  },
  {
    "text": "that you can stream either the complete database",
    "start": "975600",
    "end": "981060"
  },
  {
    "text": "or a subset of tables or you can filter certain tables for any special use",
    "start": "981060",
    "end": "988100"
  },
  {
    "text": "now there is a division adapter which is open source and available there are also users who have built a they're not yet",
    "start": "988199",
    "end": "995519"
  },
  {
    "text": "open sourced but adapters for Stitch and air byte just want to give an example of what's possible with this",
    "start": "995519",
    "end": "1003459"
  },
  {
    "text": "I'll now move to a demo of a few of these workflows",
    "start": "1004699",
    "end": "1011259"
  },
  {
    "text": "first I'm going to show how vertical sharding is done here we are starting with a single key",
    "start": "1013459",
    "end": "1019699"
  },
  {
    "text": "space which has these three tables so we're going to",
    "start": "1019699",
    "end": "1025339"
  },
  {
    "text": "move the order related tables customer and order into a different key space",
    "start": "1025339",
    "end": "1033279"
  },
  {
    "text": "and we're going to use move tables",
    "start": "1034760",
    "end": "1038500"
  },
  {
    "text": "now I created the cluster earlier because it takes a few seconds so at this point",
    "start": "1041839",
    "end": "1048319"
  },
  {
    "text": "I'll show you using so this MySQL CLI client is connected to",
    "start": "1048319",
    "end": "1054559"
  },
  {
    "text": "vtgate as you can see it is currently running on 5.7 and uh",
    "start": "1054559",
    "end": "1061179"
  },
  {
    "text": "um yeah so essentially it will act as a",
    "start": "1061520",
    "end": "1069679"
  },
  {
    "text": "MySQL CLI",
    "start": "1069679",
    "end": "1072460"
  },
  {
    "text": "this is the initial uh key space",
    "start": "1075020",
    "end": "1079660"
  },
  {
    "text": "So currently this is empty right so now I'm going to run",
    "start": "1083299",
    "end": "1088760"
  },
  {
    "text": "this command so it's a fairly simple command um which essentially just say which key",
    "start": "1088760",
    "end": "1095360"
  },
  {
    "text": "space you want and which tables you want to transfer a copy over to another case space you give the workflow a name so",
    "start": "1095360",
    "end": "1102140"
  },
  {
    "text": "that you can refer to it later on in this case uh we have not only started the workflow but we have checked that",
    "start": "1102140",
    "end": "1108200"
  },
  {
    "text": "it's complete that the lag is low and we also switched both reads and writes at the same time",
    "start": "1108200",
    "end": "1116120"
  },
  {
    "text": "now if I go back to the client",
    "start": "1116120",
    "end": "1120880"
  },
  {
    "text": "I see that the order tables no longer exist here and then move to customer so",
    "start": "1121160",
    "end": "1128440"
  },
  {
    "text": "so what I did here is essentially those tables have moved now to a different database so if you had a",
    "start": "1131600",
    "end": "1136940"
  },
  {
    "text": "service that was serving the customers uh service separately suddenly now you have",
    "start": "1136940",
    "end": "1143360"
  },
  {
    "text": "uh your data spread across these different databases",
    "start": "1143360",
    "end": "1149679"
  },
  {
    "text": "uh the restart demo so from the current key space which we already moved the",
    "start": "1150740",
    "end": "1156080"
  },
  {
    "text": "previous tables into these are the number of rows that are present",
    "start": "1156080",
    "end": "1160660"
  },
  {
    "text": "so this will start setting up the shards right what we are going to do is",
    "start": "1164299",
    "end": "1171320"
  },
  {
    "text": "we're going to set up two shards slash zero is basically unshared so the",
    "start": "1171320",
    "end": "1177380"
  },
  {
    "text": "single database we're going to create these two shards essentially we're splitting the key space the space of all",
    "start": "1177380",
    "end": "1184340"
  },
  {
    "text": "IDs into two the lower and the top I'm showing it in Gray because they are not yet serving traffic the traffic is",
    "start": "1184340",
    "end": "1190340"
  },
  {
    "text": "only being sold by slash zero",
    "start": "1190340",
    "end": "1194440"
  },
  {
    "text": "and then we're going to run the restart command",
    "start": "1195559",
    "end": "1200080"
  },
  {
    "text": "setting up um this is a quick name of the VT admin API that this is a",
    "start": "1201559",
    "end": "1209240"
  },
  {
    "text": "ga in the latest version and you can see that",
    "start": "1209240",
    "end": "1215500"
  },
  {
    "text": "only one Shard the zero Shard is serving right now the others are coming up as",
    "start": "1215960",
    "end": "1221960"
  },
  {
    "text": "you can see only one replica has come up which it will take a little bit of time",
    "start": "1221960",
    "end": "1230080"
  },
  {
    "text": "so by default we recommend one primary and two replicas and the VTR component which we",
    "start": "1231080",
    "end": "1239720"
  },
  {
    "text": "had a talk yesterday about will automatically select one of them as a primary",
    "start": "1239720",
    "end": "1245080"
  },
  {
    "text": "yeah this is why I started the previous clusters a bit earlier so because this VG tablet starts both",
    "start": "1256940",
    "end": "1264679"
  },
  {
    "text": "itself and the MySQL instance as well which is connected to it okay so now",
    "start": "1264679",
    "end": "1269900"
  },
  {
    "text": "let's look at VT admin and check yeah so we have both the other",
    "start": "1269900",
    "end": "1275360"
  },
  {
    "text": "shots created a primaries have been elected and uh",
    "start": "1275360",
    "end": "1280400"
  },
  {
    "text": "we are going to now run the restart Command right",
    "start": "1280400",
    "end": "1285520"
  },
  {
    "text": "so again it's a simple command um of course we just have very few rows",
    "start": "1286400",
    "end": "1291620"
  },
  {
    "text": "here this restart can run for hours and days ah it is resumable in case there are",
    "start": "1291620",
    "end": "1297440"
  },
  {
    "text": "network errors etcetera it will automatically resume and even if there's a different primary",
    "start": "1297440",
    "end": "1303620"
  },
  {
    "text": "gets selected because of failovers all that is handled by the workflows",
    "start": "1303620",
    "end": "1309100"
  },
  {
    "text": "yeah if you look at VT admin now we see that the Uncharted shot zero is",
    "start": "1310640",
    "end": "1318140"
  },
  {
    "text": "no longer serving and the other two are now serving so BT gate will be connecting to these shards it knows",
    "start": "1318140",
    "end": "1325280"
  },
  {
    "text": "um where each row is located by the sharding key so when you define",
    "start": "1325280",
    "end": "1332840"
  },
  {
    "text": "sharding a sharded table you define a sharding key which could be",
    "start": "1332840",
    "end": "1338780"
  },
  {
    "text": "just the identity of your auto increment or a hash of it if you want better distribution across the space or a",
    "start": "1338780",
    "end": "1344299"
  },
  {
    "text": "tenant ID or a Geo ID for if you want to localize your data for legal reasons",
    "start": "1344299",
    "end": "1352179"
  },
  {
    "text": "so whenever queries are made this we call it a Windex within bites so the",
    "start": "1353419",
    "end": "1359600"
  },
  {
    "text": "Windex is looked up by vtgate and it figures out whether it can go to A Single Shard or it has to do a crossword",
    "start": "1359600",
    "end": "1365360"
  },
  {
    "text": "query so what I've shown you just to recap was",
    "start": "1365360",
    "end": "1371840"
  },
  {
    "text": "that we",
    "start": "1371840",
    "end": "1378620"
  },
  {
    "text": "did the restart but we had not yet done the cut over once the cutover is done that's you do switch traffic the switch",
    "start": "1378620",
    "end": "1384740"
  },
  {
    "text": "traffic command the shards on the right start serving",
    "start": "1384740",
    "end": "1391640"
  },
  {
    "text": "the last thing I'll show is uh the materialization I'm showing two things here one is",
    "start": "1391640",
    "end": "1399140"
  },
  {
    "text": "reduction of data for pii in case this the credit card",
    "start": "1399140",
    "end": "1404840"
  },
  {
    "text": "and we want to do normalization I'm going to move this into a facts table for your data",
    "start": "1404840",
    "end": "1411740"
  },
  {
    "text": "warehouse and I want let's say the month and the year right just examples so",
    "start": "1411740",
    "end": "1418299"
  },
  {
    "text": "so what is important here is the query that is being run so you can look at the query you can use MySQL functions",
    "start": "1423740",
    "end": "1430880"
  },
  {
    "text": "um foreign and do computations Etc you can have a where clause in this case",
    "start": "1430880",
    "end": "1436400"
  },
  {
    "text": "we have removed all rows for a particular skew and for a particular price",
    "start": "1436400",
    "end": "1441500"
  },
  {
    "text": "so just to give a idea of what is possible we have for example One customer doing pii who's running about 600 workflows on",
    "start": "1441500",
    "end": "1449120"
  },
  {
    "text": "different tables when they are moving it into the data warehouse and they're all running on a single video tablet just to",
    "start": "1449120",
    "end": "1455840"
  },
  {
    "text": "give the idea of scale and it's a fairly commodity Hardware",
    "start": "1455840",
    "end": "1460880"
  },
  {
    "text": "here you see that the credit card has been masked uh and we have like the total price computation",
    "start": "1460880",
    "end": "1467600"
  },
  {
    "text": "month and the year the last thing here I will show is the",
    "start": "1467600",
    "end": "1474320"
  },
  {
    "text": "aggregation which is very useful for reporting purposes you could so the thing is this real uh it's happening in",
    "start": "1474320",
    "end": "1480500"
  },
  {
    "text": "real time right as changes are happening the views are updated in real time the usual lags are extremely small so",
    "start": "1480500",
    "end": "1487460"
  },
  {
    "text": "you can use it for reporting purposes or for read purposes without having to have a separate uh",
    "start": "1487460",
    "end": "1494600"
  },
  {
    "text": "like a data warehouse system or so so this is a simple aggregate query that",
    "start": "1494600",
    "end": "1501919"
  },
  {
    "text": "is going to run here again what's the use here is the SQL",
    "start": "1501919",
    "end": "1507919"
  },
  {
    "text": "query it's a very simple Group by count star some Etc",
    "start": "1507919",
    "end": "1512960"
  },
  {
    "text": "so this is what I wanted to demo a quick demo to give you a flavor of how",
    "start": "1512960",
    "end": "1518000"
  },
  {
    "text": "it works how easy it is to run um",
    "start": "1518000",
    "end": "1523400"
  },
  {
    "text": "we are now going to look at the new features in vitess 15 and deeply is going to talk about that",
    "start": "1523400",
    "end": "1530500"
  },
  {
    "text": "thank you we did the we did the 15 Auto uh GA",
    "start": "1532580",
    "end": "1540260"
  },
  {
    "text": "release this week on Wednesday and uh there are a couple of things which are GA in this release the first is BTR",
    "start": "1540260",
    "end": "1548059"
  },
  {
    "text": "which gives us the automatic failure detection and handling and it does it in",
    "start": "1548059",
    "end": "1553400"
  },
  {
    "text": "such a way that the desired durability policies are respected",
    "start": "1553400",
    "end": "1558620"
  },
  {
    "text": "the other thing that went GA in 15 is VT admin this is the web UI that rohith",
    "start": "1558620",
    "end": "1564679"
  },
  {
    "text": "included in his demo and this uses a structured grpc API to the witness",
    "start": "1564679",
    "end": "1571400"
  },
  {
    "text": "control Daemon and this is a more intuitive easier to",
    "start": "1571400",
    "end": "1577520"
  },
  {
    "text": "use web UI than what we used to have in addition to BTR and VT admin we also",
    "start": "1577520",
    "end": "1585380"
  },
  {
    "text": "added support for a whole bunch of compression and decompression algorithms during backup and restore previously",
    "start": "1585380",
    "end": "1591980"
  },
  {
    "text": "there was only gzip that was supported and anyone who wanted to use something different like zstd or lz4 had to write",
    "start": "1591980",
    "end": "1600020"
  },
  {
    "text": "some custom hooks that's no longer required uh there are a couple of features that",
    "start": "1600020",
    "end": "1606380"
  },
  {
    "text": "went GA in 14 which happened in June but since that is f",
    "start": "1606380",
    "end": "1612080"
  },
  {
    "text": "that happened after our previous update uh I just wanted to include that so",
    "start": "1612080",
    "end": "1617299"
  },
  {
    "text": "there is a new query planner and Optimizer which we are calling Gen 4 the previous one was called V3 uh this query",
    "start": "1617299",
    "end": "1624740"
  },
  {
    "text": "planner is able to support more my SQL features and is able to plan more",
    "start": "1624740",
    "end": "1631039"
  },
  {
    "text": "complex queries schema tracking is also GA what schema tracking does is that when new columns",
    "start": "1631039",
    "end": "1639320"
  },
  {
    "text": "are added to existing sharded tables previously that metadata had to be provided separately to vtk it's no",
    "start": "1639320",
    "end": "1646460"
  },
  {
    "text": "longer necessary vtk can discover those new columns by talking to VT tablets",
    "start": "1646460",
    "end": "1652580"
  },
  {
    "text": "which are connected to the MySQL we have a native View support in",
    "start": "1652580",
    "end": "1659120"
  },
  {
    "text": "progress so it will be available in a future release",
    "start": "1659120",
    "end": "1664299"
  },
  {
    "text": "next up we replication uh one thing that is new in 15 is Shard",
    "start": "1665419",
    "end": "1671900"
  },
  {
    "text": "level migrations it's possible to migrate a key space from one witness cluster to another one Shard at a time",
    "start": "1671900",
    "end": "1678919"
  },
  {
    "text": "previously the migration had to be done for all of the shards at the same time",
    "start": "1678919",
    "end": "1685480"
  },
  {
    "text": "we also have a better throttling for weed application workflows",
    "start": "1685520",
    "end": "1691580"
  },
  {
    "text": "in order that the databases that are serving production traffic are not",
    "start": "1691580",
    "end": "1698000"
  },
  {
    "text": "negatively impacted by some of these uh sharding and materialization type of",
    "start": "1698000",
    "end": "1703700"
  },
  {
    "text": "workflows still on V replication there is a tool",
    "start": "1703700",
    "end": "1709400"
  },
  {
    "text": "called rediff which can be used to verify that we replication actually did",
    "start": "1709400",
    "end": "1714500"
  },
  {
    "text": "its job correctly so for example if you're doing a resharding you want to make sure that the that the sum of the",
    "start": "1714500",
    "end": "1722539"
  },
  {
    "text": "targets is equal to the source or the sum of the sources is equal to the Target depending on how the sharding is",
    "start": "1722539",
    "end": "1730100"
  },
  {
    "text": "structured so V diff V2 is resumable it will start",
    "start": "1730100",
    "end": "1736039"
  },
  {
    "text": "restart itself if the error is recoverable and it provides progress and ETA on the",
    "start": "1736039",
    "end": "1744200"
  },
  {
    "text": "process native online ddl was GA in 14 so wittus",
    "start": "1744200",
    "end": "1750980"
  },
  {
    "text": "has built-in support for zero downtime schema changes and that is also built on",
    "start": "1750980",
    "end": "1757279"
  },
  {
    "text": "the replication the other thing that is nice about the",
    "start": "1757279",
    "end": "1763640"
  },
  {
    "text": "native online ddl support or online schema change support in bites is",
    "start": "1763640",
    "end": "1769520"
  },
  {
    "text": "that these schema changes are revertible",
    "start": "1769520",
    "end": "1773500"
  },
  {
    "text": "we are also working on incremental backups and point-in-time Recovery",
    "start": "1774679",
    "end": "1780919"
  },
  {
    "text": "in a future release we already have a point in time recovery workflow but what",
    "start": "1780919",
    "end": "1786380"
  },
  {
    "text": "is coming up will support more use cases",
    "start": "1786380",
    "end": "1791020"
  },
  {
    "text": "next up is Q and A but before we do that here are some resources for anyone who",
    "start": "1792640",
    "end": "1801559"
  },
  {
    "text": "wants to learn more we have our website which includes docs and tutorials",
    "start": "1801559",
    "end": "1806720"
  },
  {
    "text": "there's also a link to the source code which is just with sio Slash with us on",
    "start": "1806720",
    "end": "1812720"
  },
  {
    "text": "GitHub we have a slack workspace there is a link to it from our website as well and",
    "start": "1812720",
    "end": "1820039"
  },
  {
    "text": "we'd love to get feedback on what you thought of the stock so that QR code",
    "start": "1820039",
    "end": "1825440"
  },
  {
    "text": "will let you leave feedback for us so now we are ready to take questions",
    "start": "1825440",
    "end": "1832059"
  },
  {
    "text": "so it's on top of my sequel but you mentioned you have your own query planner and Optimizer correct so how",
    "start": "1848299",
    "end": "1855919"
  },
  {
    "text": "does that work we try to push down as much of the SQL computation to uh MySQL",
    "start": "1855919",
    "end": "1862820"
  },
  {
    "text": "as possible but for complex queries for example you may have a complex join for",
    "start": "1862820",
    "end": "1868820"
  },
  {
    "text": "which you have to fetch data from one Shard and then combine it with data from",
    "start": "1868820",
    "end": "1874340"
  },
  {
    "text": "another Shard or you fetch one row from one chart and then you filter",
    "start": "1874340",
    "end": "1879380"
  },
  {
    "text": "across all of the shards based on the value that you get back from that so those types of complex queries require",
    "start": "1879380",
    "end": "1885919"
  },
  {
    "text": "in-memory computation and those are the things that vtgate is doing so when a query comes in vitigate will figure out",
    "start": "1885919",
    "end": "1893000"
  },
  {
    "text": "do I need to just send this to one Shard or do I need to scatter it or do I need",
    "start": "1893000",
    "end": "1899840"
  },
  {
    "text": "to send it to a subset of the shards do I need to break it up into multiple round trips depending on the complexity",
    "start": "1899840",
    "end": "1906559"
  },
  {
    "text": "of the query so that's the sort of planning and optimization that's happening at the VT gate level",
    "start": "1906559",
    "end": "1913240"
  },
  {
    "text": "yes so I would say that that test Suite may not be comprehensive but we do have",
    "start": "1920500",
    "end": "1926960"
  },
  {
    "text": "a test Suite where we compare the results between sending it directly to my SQL versus going through vtgate yeah",
    "start": "1926960",
    "end": "1934840"
  },
  {
    "text": "so we in fact added support for a lot of functions in I think 13 but there are",
    "start": "1934940",
    "end": "1942620"
  },
  {
    "text": "still a few MySQL functions that we have not completed support for uh",
    "start": "1942620",
    "end": "1949700"
  },
  {
    "text": "we have a relfx intern who's working on that right now",
    "start": "1949700",
    "end": "1955419"
  },
  {
    "text": "yes to uh carry on on that uh on that query processing on the on the v test",
    "start": "1965120",
    "end": "1971840"
  },
  {
    "text": "layer um does it give you also some insight of",
    "start": "1971840",
    "end": "1977179"
  },
  {
    "text": "the quality of your sharding decisions well depending on",
    "start": "1977179",
    "end": "1983059"
  },
  {
    "text": "some history of queries okay um",
    "start": "1983059",
    "end": "1988720"
  },
  {
    "text": "tells you what plan was produced by vtgate whether it was a select unique",
    "start": "1992620",
    "end": "1999620"
  },
  {
    "text": "meaning it went to one shot was a scatter so we do produce that query log so it's possible to process that",
    "start": "1999620",
    "end": "2008260"
  },
  {
    "text": "outside of it a sweaters doesn't do that as part of The Suite of functionality we produce but it's possible to do that",
    "start": "2008260",
    "end": "2016539"
  },
  {
    "text": "foreign",
    "start": "2016539",
    "end": "2019539"
  },
  {
    "text": "have any questions about the different types of sharding keys we support",
    "start": "2037799",
    "end": "2044580"
  },
  {
    "text": "sorry just expanding on the optimization and uh so I guess it has its own explain",
    "start": "2047520",
    "end": "2053679"
  },
  {
    "text": "plan would show the vitessa's query plan yes yes okay so uh we extend the explain",
    "start": "2053679",
    "end": "2061060"
  },
  {
    "text": "syntax and we have an explain format equals Json and format equals BT explain",
    "start": "2061060",
    "end": "2068320"
  },
  {
    "text": "so there are a couple of them harshit can answer that yeah so I'm from the query serving team from Witness so yes",
    "start": "2068320",
    "end": "2075339"
  },
  {
    "text": "we do have basically we have a explain plan for witness where you can understand that if you use this if you",
    "start": "2075339",
    "end": "2081520"
  },
  {
    "text": "basically what we do is like you have to give uh like for this table what is your sharding key and stuff so you give that",
    "start": "2081520",
    "end": "2087220"
  },
  {
    "text": "initially now you're running your queries so you want to know what kind of plan is going to get executed by the",
    "start": "2087220",
    "end": "2092378"
  },
  {
    "text": "vtkit so you can do explain format equal to a test and your query so it will tell you what is the plan that is going to be",
    "start": "2092379",
    "end": "2099820"
  },
  {
    "text": "generated by VT git and it will tell you whether it's going to be a select like if you're given us suppose a select",
    "start": "2099820",
    "end": "2105640"
  },
  {
    "text": "query so it will tell you whether it will go to a single chart we'll go to multi-sharp whether it's a select any kind of query so you'll you'll",
    "start": "2105640",
    "end": "2112180"
  },
  {
    "text": "understand whether it's using uh the right sharding key or not if it's not then you can add uh more shading so",
    "start": "2112180",
    "end": "2118960"
  },
  {
    "text": "basically there's one thing called sharding key and then you can have secondary when indexing on it so we call",
    "start": "2118960",
    "end": "2124720"
  },
  {
    "text": "Windex and so you can add more and more Windex according to your query so suppose you have given your sharding key",
    "start": "2124720",
    "end": "2130599"
  },
  {
    "text": "as suppose as ID but in your where Clause you are not using ID you have using some other column so you can",
    "start": "2130599",
    "end": "2136180"
  },
  {
    "text": "create secondary index on that column so that then it doesn't go to all the shards because your data is distributed",
    "start": "2136180",
    "end": "2142480"
  },
  {
    "text": "across multiple charts so you don't want a query to become expensive so you'll create a secondary Windex on it so that",
    "start": "2142480",
    "end": "2149020"
  },
  {
    "text": "now the btkit can plan your query better and so it goes only to the subset of the charts where your data is actually",
    "start": "2149020",
    "end": "2154599"
  },
  {
    "text": "residing to",
    "start": "2154599",
    "end": "2157560"
  },
  {
    "text": "uh so yes so lower level performance is lfnoids only at the MySQL level so you",
    "start": "2164859",
    "end": "2170320"
  },
  {
    "text": "can only what queries goes down you can evaluate it but at the VT gate level",
    "start": "2170320",
    "end": "2175420"
  },
  {
    "text": "what we give you is actually a streamable API which will tell you that",
    "start": "2175420",
    "end": "2181000"
  },
  {
    "text": "for this query how much time it took like and uh where where it has gone to",
    "start": "2181000",
    "end": "2186700"
  },
  {
    "text": "which shot this has gone to and what tables is just and how much time it takes at the MySQL level at the VT gate",
    "start": "2186700",
    "end": "2192820"
  },
  {
    "text": "level so those informations are available at the VT gate level not a full performance MySQL that you like",
    "start": "2192820",
    "end": "2200200"
  },
  {
    "text": "what you see at the MySQL level but you can query the MySQL levels performance how should let me add to that so uh",
    "start": "2200200",
    "end": "2208000"
  },
  {
    "text": "with witness you will use both sources to tune the performance of your system",
    "start": "2208000",
    "end": "2213040"
  },
  {
    "text": "so you have the metrics and the statistics coming out of vtk but you will also then see how each of those",
    "start": "2213040",
    "end": "2220540"
  },
  {
    "text": "individual queries is performing at the bicycle level so you will need to do that so it's possible that the query",
    "start": "2220540",
    "end": "2226900"
  },
  {
    "text": "sweety gate is coming up with are inefficient in which case the VT gate planning has to be improved and it's",
    "start": "2226900",
    "end": "2233800"
  },
  {
    "text": "possible that btgate is coming up with the right queries but you don't have the right indexes on the underlying tables",
    "start": "2233800",
    "end": "2239380"
  },
  {
    "text": "which is also fixable so it's a com it becomes a combination 50 days",
    "start": "2239380",
    "end": "2247380"
  },
  {
    "text": "uh no not really but you can override means like I told you right like if you",
    "start": "2247980",
    "end": "2253960"
  },
  {
    "text": "have missing uh indexes at the BT gate level you can add it and then you will start having those if if your if the",
    "start": "2253960",
    "end": "2261220"
  },
  {
    "text": "planner itself is producing wrong bad plans then you you have to just create an issue and then someone from the query",
    "start": "2261220",
    "end": "2266980"
  },
  {
    "text": "serving will get a better plan for that query okay so while you can't overwrite",
    "start": "2266980",
    "end": "2272020"
  },
  {
    "text": "the query plan directly like harshit said you can add secondary indexes which can uh produce a more efficient query",
    "start": "2272020",
    "end": "2280599"
  },
  {
    "text": "plan",
    "start": "2280599",
    "end": "2282839"
  },
  {
    "text": "the other thing that we support is if you know that this query has to go only in this particular shot you can do chart",
    "start": "2290880",
    "end": "2296740"
  },
  {
    "text": "targeting and stuff like that so then it doesn't go through the planar phase of vtk it just directly pushes to my SQL so",
    "start": "2296740",
    "end": "2303220"
  },
  {
    "text": "what we do with we ticket level is we try to the plans that we generate at vtk level we try to push as much as to the",
    "start": "2303220",
    "end": "2310119"
  },
  {
    "text": "MySQL so that we have to do less things on the in-memory stuff and let the MySQL handles more and more so like uh even if",
    "start": "2310119",
    "end": "2317920"
  },
  {
    "text": "like we have to do aggregation side we try to so we try to push those like if you have to do just count stuff you try",
    "start": "2317920",
    "end": "2323619"
  },
  {
    "text": "to push all the concepts till the MySQL and we then we just combine the counselor again at the VT gate level so",
    "start": "2323619",
    "end": "2329440"
  },
  {
    "text": "we don't have to get full data we just need counselor from all the shards and then do it for you so those kind of",
    "start": "2329440",
    "end": "2335140"
  },
  {
    "text": "things we try to push as much as push down approach on the MySQL",
    "start": "2335140",
    "end": "2340680"
  },
  {
    "text": "to do the MySQL monitoring tools work on top of the test also yes yes they do so",
    "start": "2340720",
    "end": "2348220"
  },
  {
    "text": "uh witness also comes with a sample grafana dashboard that was contributed by one of our contributors that you can",
    "start": "2348220",
    "end": "2355960"
  },
  {
    "text": "use to monitor the cluster",
    "start": "2355960",
    "end": "2360960"
  },
  {
    "text": "well you you will okay I'll repeat that question the question was uh does the",
    "start": "2364540",
    "end": "2370020"
  },
  {
    "text": "sample grafana dashboard include metrics at the query level yes it does because",
    "start": "2370020",
    "end": "2375820"
  },
  {
    "text": "in BT gate we do track the amount of time taken in VT gate but also the",
    "start": "2375820",
    "end": "2381160"
  },
  {
    "text": "amount of time taken at the MySQL level but we do not export all of the",
    "start": "2381160",
    "end": "2387220"
  },
  {
    "text": "performance schema metrics so those are probably not available in the sample grafana dashboard",
    "start": "2387220",
    "end": "2394380"
  },
  {
    "text": "any other questions",
    "start": "2402160",
    "end": "2405299"
  },
  {
    "text": "all right thank you everybody for showing up",
    "start": "2407740",
    "end": "2412980"
  }
]