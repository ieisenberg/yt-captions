[
  {
    "text": "selium at scale um high scale networking",
    "start": "320",
    "end": "3600"
  },
  {
    "text": "for ML workload um with Celium",
    "start": "3600",
    "end": "8358"
  },
  {
    "text": "well thank you very much all for coming",
    "start": "8559",
    "end": "11040"
  },
  {
    "text": "um my name is Luigi i work is a senior",
    "start": "11040",
    "end": "14400"
  },
  {
    "text": "Kubernetes platform engineer at G",
    "start": "14400",
    "end": "16278"
  },
  {
    "text": "Research uh we are quantitative uh",
    "start": "16279",
    "end": "18960"
  },
  {
    "text": "research and technology firm um we",
    "start": "18960",
    "end": "21600"
  },
  {
    "text": "essentially use large scale compute big",
    "start": "21600",
    "end": "24080"
  },
  {
    "text": "data and machine learning to try and",
    "start": "24080",
    "end": "26320"
  },
  {
    "text": "predict financial markets so now I'm",
    "start": "26320",
    "end": "29519"
  },
  {
    "text": "presenting this talk solo uh but this",
    "start": "29519",
    "end": "31599"
  },
  {
    "text": "was very much a joint effort uh I work",
    "start": "31599",
    "end": "34000"
  },
  {
    "text": "closely on this with James Lavar as you",
    "start": "34000",
    "end": "36160"
  },
  {
    "text": "can see from the slide uh he's a",
    "start": "36160",
    "end": "38320"
  },
  {
    "text": "principal customer success architect at",
    "start": "38320",
    "end": "40079"
  },
  {
    "text": "ISO valent and well he's authoring uh",
    "start": "40079",
    "end": "42960"
  },
  {
    "text": "one of the on the upcoming book selium",
    "start": "42960",
    "end": "46239"
  },
  {
    "text": "up and running uh Jim has worked closely",
    "start": "46239",
    "end": "49680"
  },
  {
    "text": "with us over the last year as we scale",
    "start": "49680",
    "end": "52000"
  },
  {
    "text": "at research uh and a lot of the insights",
    "start": "52000",
    "end": "54800"
  },
  {
    "text": "uh here and the result uh are result of",
    "start": "54800",
    "end": "56879"
  },
  {
    "text": "that",
    "start": "56879",
    "end": "58120"
  },
  {
    "text": "collaboration so um well with",
    "start": "58120",
    "end": "60399"
  },
  {
    "text": "introductions out of the way let's get",
    "start": "60399",
    "end": "63159"
  },
  {
    "text": "started i hope you know most of you",
    "start": "63159",
    "end": "65360"
  },
  {
    "text": "knows what selium is at this point um",
    "start": "65360",
    "end": "68000"
  },
  {
    "text": "well um if you don't selium is a",
    "start": "68000",
    "end": "70799"
  },
  {
    "text": "container network solutions for",
    "start": "70799",
    "end": "72439"
  },
  {
    "text": "kubernetes uh this talk is not an",
    "start": "72439",
    "end": "75520"
  },
  {
    "text": "introduction or a technical deep dive um",
    "start": "75520",
    "end": "78320"
  },
  {
    "text": "we're going to cover specific use cases",
    "start": "78320",
    "end": "81200"
  },
  {
    "text": "production issues that we have faced and",
    "start": "81200",
    "end": "83600"
  },
  {
    "text": "some real solutions that we have",
    "start": "83600",
    "end": "86759"
  },
  {
    "text": "implemented and before we dive into some",
    "start": "86759",
    "end": "89040"
  },
  {
    "text": "of the stories I'm going to share um",
    "start": "89040",
    "end": "90720"
  },
  {
    "text": "well you know why should you care about",
    "start": "90720",
    "end": "92240"
  },
  {
    "text": "what I have to say so at G research",
    "start": "92240",
    "end": "95280"
  },
  {
    "text": "we've rolled out Celium to over tens of",
    "start": "95280",
    "end": "97520"
  },
  {
    "text": "thousands of nodes uh bare metal nodes",
    "start": "97520",
    "end": "99920"
  },
  {
    "text": "and some of our clusters uh reach over a",
    "start": "99920",
    "end": "102079"
  },
  {
    "text": "thousand nodes individually these are",
    "start": "102079",
    "end": "104560"
  },
  {
    "text": "not test environment these are",
    "start": "104560",
    "end": "106079"
  },
  {
    "text": "production clusters they run mission",
    "start": "106079",
    "end": "108000"
  },
  {
    "text": "mission critical applications that",
    "start": "108000",
    "end": "110159"
  },
  {
    "text": "support our",
    "start": "110159",
    "end": "111640"
  },
  {
    "text": "business and uh well the point is that",
    "start": "111640",
    "end": "114560"
  },
  {
    "text": "uh we hit the kinds of edge cases you",
    "start": "114560",
    "end": "117280"
  },
  {
    "text": "can only run into when you're operating",
    "start": "117280",
    "end": "119360"
  },
  {
    "text": "at this scale and uh that's what I'm",
    "start": "119360",
    "end": "122240"
  },
  {
    "text": "going to be uh sharing so it's not just",
    "start": "122240",
    "end": "124960"
  },
  {
    "text": "what about Celium can do but also what",
    "start": "124960",
    "end": "127759"
  },
  {
    "text": "it looks like uh when it breaks and how",
    "start": "127759",
    "end": "130239"
  },
  {
    "text": "we fixed it",
    "start": "130239",
    "end": "133440"
  },
  {
    "text": "so I'm going to um well give a bit of an",
    "start": "133440",
    "end": "136319"
  },
  {
    "text": "overview of u research our",
    "start": "136319",
    "end": "138400"
  },
  {
    "text": "infrastructures to give you a bit of an",
    "start": "138400",
    "end": "140000"
  },
  {
    "text": "idea of uh the scale we at which we",
    "start": "140000",
    "end": "142400"
  },
  {
    "text": "operate and uh well the um challenges",
    "start": "142400",
    "end": "146400"
  },
  {
    "text": "that we have to sort of resolve um and",
    "start": "146400",
    "end": "148879"
  },
  {
    "text": "then I'm going to be sharing three",
    "start": "148879",
    "end": "150160"
  },
  {
    "text": "stories one about my pressures one about",
    "start": "150160",
    "end": "152879"
  },
  {
    "text": "contract and then I'll leave uh bonus",
    "start": "152879",
    "end": "155040"
  },
  {
    "text": "stories towards the end on how we",
    "start": "155040",
    "end": "157200"
  },
  {
    "text": "managed to make sidium use one tab of",
    "start": "157200",
    "end": "160680"
  },
  {
    "text": "memory a bit of a disclaimer uh we at G",
    "start": "160680",
    "end": "164160"
  },
  {
    "text": "research run an enterprise edition of um",
    "start": "164160",
    "end": "167040"
  },
  {
    "text": "well Celium but everything that I'm",
    "start": "167040",
    "end": "169280"
  },
  {
    "text": "going to discuss today is applicable to",
    "start": "169280",
    "end": "171200"
  },
  {
    "text": "the open source uh version as well so I",
    "start": "171200",
    "end": "173760"
  },
  {
    "text": "hope that um you know no matter uh what",
    "start": "173760",
    "end": "175840"
  },
  {
    "text": "version of Celium you guys are running",
    "start": "175840",
    "end": "177440"
  },
  {
    "text": "uh you'll be able to learn something uh",
    "start": "177440",
    "end": "179280"
  },
  {
    "text": "new today or",
    "start": "179280",
    "end": "181879"
  },
  {
    "text": "useful so let's just get started with",
    "start": "181879",
    "end": "185120"
  },
  {
    "text": "the deployment overview",
    "start": "185120",
    "end": "187440"
  },
  {
    "text": "uh we run uh a high performance",
    "start": "187440",
    "end": "190080"
  },
  {
    "text": "computing environment in G research",
    "start": "190080",
    "end": "192239"
  },
  {
    "text": "entirely in an airgapped on-prem uh",
    "start": "192239",
    "end": "194879"
  },
  {
    "text": "environment this is on top of our",
    "start": "194879",
    "end": "196800"
  },
  {
    "text": "private cloud um our Kubernetes clusters",
    "start": "196800",
    "end": "199840"
  },
  {
    "text": "run directly on top of bare metal",
    "start": "199840",
    "end": "201920"
  },
  {
    "text": "servers uh that are fully uh operated",
    "start": "201920",
    "end": "204080"
  },
  {
    "text": "and managed by uh us we deploy pure",
    "start": "204080",
    "end": "206959"
  },
  {
    "text": "upstream Kubernetes so we don't make use",
    "start": "206959",
    "end": "208879"
  },
  {
    "text": "of any external distributions and we",
    "start": "208879",
    "end": "211360"
  },
  {
    "text": "rely on our own fully custom automation",
    "start": "211360",
    "end": "213840"
  },
  {
    "text": "framework to well that was built from",
    "start": "213840",
    "end": "216720"
  },
  {
    "text": "scratch to uh run and manage our",
    "start": "216720",
    "end": "219360"
  },
  {
    "text": "clusters at this",
    "start": "219360",
    "end": "221720"
  },
  {
    "text": "scale we use Kubernetes among various",
    "start": "221720",
    "end": "225040"
  },
  {
    "text": "different things to operate our calc uh",
    "start": "225040",
    "end": "227360"
  },
  {
    "text": "which is a large set of scale clusters",
    "start": "227360",
    "end": "229680"
  },
  {
    "text": "uh with thousands of nodes uh and we run",
    "start": "229680",
    "end": "231920"
  },
  {
    "text": "a diverse mix of machine learning uh",
    "start": "231920",
    "end": "233760"
  },
  {
    "text": "workloads uh some of these workloads",
    "start": "233760",
    "end": "235599"
  },
  {
    "text": "last a few minutes while others can run",
    "start": "235599",
    "end": "238000"
  },
  {
    "text": "for multiple days um the cloud farm uh",
    "start": "238000",
    "end": "241200"
  },
  {
    "text": "to these days well we process currently",
    "start": "241200",
    "end": "243760"
  },
  {
    "text": "um about 4 to 5 million jobs per day on",
    "start": "243760",
    "end": "246720"
  },
  {
    "text": "average um and we sometime peak at 11",
    "start": "246720",
    "end": "249000"
  },
  {
    "text": "million um we use a batchuler we",
    "start": "249000",
    "end": "252560"
  },
  {
    "text": "developed uh and donated to the CNCF",
    "start": "252560",
    "end": "254640"
  },
  {
    "text": "foundations called Armada uh we actually",
    "start": "254640",
    "end": "256880"
  },
  {
    "text": "have a booth here in CubeCon so feel",
    "start": "256880",
    "end": "258400"
  },
  {
    "text": "free to say hello",
    "start": "258400",
    "end": "262040"
  },
  {
    "text": "and well some of our challenges uh we",
    "start": "262800",
    "end": "265440"
  },
  {
    "text": "for security and compliance reasons we",
    "start": "265440",
    "end": "267440"
  },
  {
    "text": "segregate uh some of our workloads based",
    "start": "267440",
    "end": "269680"
  },
  {
    "text": "on the type of data that they um well",
    "start": "269680",
    "end": "272400"
  },
  {
    "text": "operate on and initially uh we address",
    "start": "272400",
    "end": "276000"
  },
  {
    "text": "these by running entirely separate",
    "start": "276000",
    "end": "278639"
  },
  {
    "text": "physical network uh separate compute",
    "start": "278639",
    "end": "280880"
  },
  {
    "text": "resources and uh kubernetes clusters for",
    "start": "280880",
    "end": "283919"
  },
  {
    "text": "each level of data segregations and as",
    "start": "283919",
    "end": "286560"
  },
  {
    "text": "we grew of course maintaining these uh",
    "start": "286560",
    "end": "288800"
  },
  {
    "text": "started to become quite inefficient uh",
    "start": "288800",
    "end": "291120"
  },
  {
    "text": "any kind of changes that we had to roll",
    "start": "291120",
    "end": "292800"
  },
  {
    "text": "out had we had to do it twice or more um",
    "start": "292800",
    "end": "295280"
  },
  {
    "text": "and it was quite expensive as well um as",
    "start": "295280",
    "end": "298320"
  },
  {
    "text": "you know we will have to leave compute",
    "start": "298320",
    "end": "300000"
  },
  {
    "text": "cycles on the ground if no one was",
    "start": "300000",
    "end": "301919"
  },
  {
    "text": "running that specific type of workload",
    "start": "301919",
    "end": "304639"
  },
  {
    "text": "um so now uh we run everything in what",
    "start": "304639",
    "end": "307360"
  },
  {
    "text": "we call merge clusters uh we enforce",
    "start": "307360",
    "end": "309680"
  },
  {
    "text": "network segregations at the namespace",
    "start": "309680",
    "end": "311280"
  },
  {
    "text": "level using Celium and uh while we have",
    "start": "311280",
    "end": "314400"
  },
  {
    "text": "therefore thousands of namespaces um all",
    "start": "314400",
    "end": "316880"
  },
  {
    "text": "isolated from a networking perspective",
    "start": "316880",
    "end": "318639"
  },
  {
    "text": "we manage this way to maximize our uh",
    "start": "318639",
    "end": "321840"
  },
  {
    "text": "hardware utilizations uh while m",
    "start": "321840",
    "end": "323680"
  },
  {
    "text": "maintaining um our security requirements",
    "start": "323680",
    "end": "325919"
  },
  {
    "text": "and enabling",
    "start": "325919",
    "end": "327240"
  },
  {
    "text": "research this setup of course introduces",
    "start": "327240",
    "end": "330160"
  },
  {
    "text": "um you know a set of complexity and",
    "start": "330160",
    "end": "331520"
  },
  {
    "text": "challenges and some of these topics I'm",
    "start": "331520",
    "end": "333360"
  },
  {
    "text": "going to be sharing today and but before",
    "start": "333360",
    "end": "336880"
  },
  {
    "text": "I get there um just wanted to quickly",
    "start": "336880",
    "end": "339199"
  },
  {
    "text": "mention why um you know why did I pick",
    "start": "339199",
    "end": "342000"
  },
  {
    "text": "why did we pick",
    "start": "342000",
    "end": "343320"
  },
  {
    "text": "selium and uh well in a nutshell right",
    "start": "343320",
    "end": "346080"
  },
  {
    "text": "we we really like it um personally I",
    "start": "346080",
    "end": "349199"
  },
  {
    "text": "love the observability you get from",
    "start": "349199",
    "end": "350560"
  },
  {
    "text": "selium uh you can see so much more uh",
    "start": "350560",
    "end": "353520"
  },
  {
    "text": "you can actually get some context uh to",
    "start": "353520",
    "end": "355600"
  },
  {
    "text": "some of the packet flow that you see",
    "start": "355600",
    "end": "356800"
  },
  {
    "text": "instead of you know just seeing packet",
    "start": "356800",
    "end": "358560"
  },
  {
    "text": "on the wire this kind of visibility",
    "start": "358560",
    "end": "360479"
  },
  {
    "text": "really makes a huge difference when you",
    "start": "360479",
    "end": "362800"
  },
  {
    "text": "know you have to try and troubleshoot",
    "start": "362800",
    "end": "364400"
  },
  {
    "text": "some issues in production and at the",
    "start": "364400",
    "end": "366800"
  },
  {
    "text": "same time we try and future proof our",
    "start": "366800",
    "end": "369280"
  },
  {
    "text": "platform uh we are always thinking about",
    "start": "369280",
    "end": "371440"
  },
  {
    "text": "how Kubernetes is evolving and how work",
    "start": "371440",
    "end": "374560"
  },
  {
    "text": "workloads are changing um and so um for",
    "start": "374560",
    "end": "379039"
  },
  {
    "text": "us EVPF based networking felt like uh",
    "start": "379039",
    "end": "381440"
  },
  {
    "text": "where Kubernetes is heading um it gives",
    "start": "381440",
    "end": "383680"
  },
  {
    "text": "us performance flexibility and room to",
    "start": "383680",
    "end": "386199"
  },
  {
    "text": "innovate um all baked into the kernel so",
    "start": "386199",
    "end": "389600"
  },
  {
    "text": "that's why we decided to go with Celium",
    "start": "389600",
    "end": "391360"
  },
  {
    "text": "uh it's not just the right tool for",
    "start": "391360",
    "end": "393280"
  },
  {
    "text": "today it's also setting us up for what's",
    "start": "393280",
    "end": "395199"
  },
  {
    "text": "coming",
    "start": "395199",
    "end": "397080"
  },
  {
    "text": "next so after I talked about all the",
    "start": "397080",
    "end": "399600"
  },
  {
    "text": "good things about Celium let me just",
    "start": "399600",
    "end": "400880"
  },
  {
    "text": "talk about how everything went wrong uh",
    "start": "400880",
    "end": "403199"
  },
  {
    "text": "starting with map pressure",
    "start": "403199",
    "end": "406080"
  },
  {
    "text": "so setting up the scene uh it was half",
    "start": "406080",
    "end": "408479"
  },
  {
    "text": "past in the morning I invited James uh",
    "start": "408479",
    "end": "410639"
  },
  {
    "text": "into our offices to work together on",
    "start": "410639",
    "end": "412400"
  },
  {
    "text": "scaling our clusters from a few hundred",
    "start": "412400",
    "end": "414479"
  },
  {
    "text": "nodes uh to a thousands of nodes and uh",
    "start": "414479",
    "end": "418560"
  },
  {
    "text": "well before we got started I thought it",
    "start": "418560",
    "end": "420479"
  },
  {
    "text": "would be a good idea a good idea to go",
    "start": "420479",
    "end": "422479"
  },
  {
    "text": "and check uh some metrics you know",
    "start": "422479",
    "end": "424319"
  },
  {
    "text": "before adding more nodes",
    "start": "424319",
    "end": "427440"
  },
  {
    "text": "first thing we saw uh was a huge spike",
    "start": "427440",
    "end": "429759"
  },
  {
    "text": "on errors u map operations error",
    "start": "429759",
    "end": "432160"
  },
  {
    "text": "specifically um the number is not uh",
    "start": "432160",
    "end": "434560"
  },
  {
    "text": "fake at all it's 110,000 error per",
    "start": "434560",
    "end": "437160"
  },
  {
    "text": "second um yeah I did not expect that at",
    "start": "437160",
    "end": "442039"
  },
  {
    "text": "all so yeah next we looked at the map",
    "start": "442039",
    "end": "445120"
  },
  {
    "text": "pressure given the type of error right",
    "start": "445120",
    "end": "447199"
  },
  {
    "text": "and uh we saw that most of the nodes if",
    "start": "447199",
    "end": "449280"
  },
  {
    "text": "not all of them were hitting 100% of map",
    "start": "449280",
    "end": "452960"
  },
  {
    "text": "pressure",
    "start": "452960",
    "end": "455960"
  },
  {
    "text": "this wasn't a new problem uh I did",
    "start": "456960",
    "end": "459840"
  },
  {
    "text": "started seeing these uh the days prior",
    "start": "459840",
    "end": "461840"
  },
  {
    "text": "to um that day um it was increasing for",
    "start": "461840",
    "end": "464400"
  },
  {
    "text": "the past few days but I saw that it was",
    "start": "464400",
    "end": "465840"
  },
  {
    "text": "kind of settling in um you know the map",
    "start": "465840",
    "end": "468960"
  },
  {
    "text": "pressure utilization was going down um",
    "start": "468960",
    "end": "471680"
  },
  {
    "text": "and I think well my suspicion there is",
    "start": "471680",
    "end": "474160"
  },
  {
    "text": "uh you know jobs uh kind of running to",
    "start": "474160",
    "end": "476080"
  },
  {
    "text": "completions we were freeing resources",
    "start": "476080",
    "end": "478240"
  },
  {
    "text": "and so it didn't feel you know such a",
    "start": "478240",
    "end": "480319"
  },
  {
    "text": "didn't felt such a urgent thing to uh",
    "start": "480319",
    "end": "482879"
  },
  {
    "text": "address at the time and um yeah when I",
    "start": "482879",
    "end": "486720"
  },
  {
    "text": "saw what was going on I really didn't",
    "start": "486720",
    "end": "488240"
  },
  {
    "text": "have any coffee yet uh much like today",
    "start": "488240",
    "end": "490160"
  },
  {
    "text": "to be honest",
    "start": "490160",
    "end": "493039"
  },
  {
    "text": "um as an aside um you might be wondering",
    "start": "493039",
    "end": "495919"
  },
  {
    "text": "what is a map uh well map is an ebpf",
    "start": "495919",
    "end": "499840"
  },
  {
    "text": "internal data structure um it's used to",
    "start": "499840",
    "end": "502080"
  },
  {
    "text": "store data and share informations",
    "start": "502080",
    "end": "503520"
  },
  {
    "text": "between you know different ebpf programs",
    "start": "503520",
    "end": "505440"
  },
  {
    "text": "or applications also in user space and",
    "start": "505440",
    "end": "508639"
  },
  {
    "text": "uh well when you think of a map as a",
    "start": "508639",
    "end": "510960"
  },
  {
    "text": "software engineer programmer you might",
    "start": "510960",
    "end": "512880"
  },
  {
    "text": "be thinking um you know key value map",
    "start": "512880",
    "end": "515279"
  },
  {
    "text": "they're not always like that sometimes",
    "start": "515279",
    "end": "516719"
  },
  {
    "text": "they are sometimes they're not and well",
    "start": "516719",
    "end": "519120"
  },
  {
    "text": "uses map for all sort of things um",
    "start": "519120",
    "end": "521120"
  },
  {
    "text": "hubble contract policy anything else you",
    "start": "521120",
    "end": "523200"
  },
  {
    "text": "can think of it's probably using a",
    "start": "523200",
    "end": "526279"
  },
  {
    "text": "map and so what's map pressure um well",
    "start": "526279",
    "end": "530240"
  },
  {
    "text": "this is just how um much a map is full",
    "start": "530240",
    "end": "533440"
  },
  {
    "text": "in percentage um so 100% or over that",
    "start": "533440",
    "end": "536720"
  },
  {
    "text": "essentially means um well it's full and",
    "start": "536720",
    "end": "539360"
  },
  {
    "text": "you cannot uh feel any more element in",
    "start": "539360",
    "end": "541519"
  },
  {
    "text": "it",
    "start": "541519",
    "end": "544320"
  },
  {
    "text": "so at this point we know the policy map",
    "start": "544320",
    "end": "546720"
  },
  {
    "text": "is full um well or a map to be honest at",
    "start": "546720",
    "end": "550480"
  },
  {
    "text": "that point we just knew map was full and",
    "start": "550480",
    "end": "552800"
  },
  {
    "text": "naturally the first thought was can we",
    "start": "552800",
    "end": "554880"
  },
  {
    "text": "make the map bigger",
    "start": "554880",
    "end": "557279"
  },
  {
    "text": "um well this was happening early in the",
    "start": "557279",
    "end": "558880"
  },
  {
    "text": "morning in a production cluster so we",
    "start": "558880",
    "end": "560399"
  },
  {
    "text": "were not in ideal spot to experiment uh",
    "start": "560399",
    "end": "562880"
  },
  {
    "text": "and we were trying to patch things up",
    "start": "562880",
    "end": "564560"
  },
  {
    "text": "quickly without causing more chaos and",
    "start": "564560",
    "end": "566800"
  },
  {
    "text": "we knew about these settings we could",
    "start": "566800",
    "end": "568160"
  },
  {
    "text": "set the BPF uh map dynamic size ratio uh",
    "start": "568160",
    "end": "571680"
  },
  {
    "text": "which control the size of some EVPF maps",
    "start": "571680",
    "end": "574320"
  },
  {
    "text": "and so we bumped that up to 0.1 uh but",
    "start": "574320",
    "end": "577760"
  },
  {
    "text": "unfortunately it did not help um what we",
    "start": "577760",
    "end": "581360"
  },
  {
    "text": "didn't realize at the time was that this",
    "start": "581360",
    "end": "583040"
  },
  {
    "text": "setting doesn't actually affect the",
    "start": "583040",
    "end": "584240"
  },
  {
    "text": "policy map itself it just applies to uh",
    "start": "584240",
    "end": "586880"
  },
  {
    "text": "other map types and the one we should",
    "start": "586880",
    "end": "588959"
  },
  {
    "text": "have changed was the BPF policy map",
    "start": "588959",
    "end": "593920"
  },
  {
    "text": "max so um as another quick aside what is",
    "start": "594440",
    "end": "598800"
  },
  {
    "text": "a policy map um and why you know being",
    "start": "598800",
    "end": "602880"
  },
  {
    "text": "dabbing full is a problem well every",
    "start": "602880",
    "end": "605279"
  },
  {
    "text": "silium managed pod uh on a node has its",
    "start": "605279",
    "end": "607920"
  },
  {
    "text": "own policy map uh it stores the",
    "start": "607920",
    "end": "610000"
  },
  {
    "text": "calculated policy for that pod based on",
    "start": "610000",
    "end": "612240"
  },
  {
    "text": "identities of other endpoints in the",
    "start": "612240",
    "end": "614320"
  },
  {
    "text": "clusters so you can think of it uh you",
    "start": "614320",
    "end": "616320"
  },
  {
    "text": "know as a for each P identity in the",
    "start": "616320",
    "end": "618560"
  },
  {
    "text": "clusters what should they do if they try",
    "start": "618560",
    "end": "620160"
  },
  {
    "text": "to talk to me right allow drop on which",
    "start": "620160",
    "end": "622640"
  },
  {
    "text": "port which directions uh it's all",
    "start": "622640",
    "end": "624720"
  },
  {
    "text": "encoded there um and the table on the",
    "start": "624720",
    "end": "627360"
  },
  {
    "text": "right uh is a simplified view uh but you",
    "start": "627360",
    "end": "629760"
  },
  {
    "text": "can see how it works right you see",
    "start": "629760",
    "end": "631360"
  },
  {
    "text": "identity uh the directions protocol port",
    "start": "631360",
    "end": "634079"
  },
  {
    "text": "verdict so when what happens when this",
    "start": "634079",
    "end": "636320"
  },
  {
    "text": "fills up uh well selium the selium agent",
    "start": "636320",
    "end": "639440"
  },
  {
    "text": "won't be able to insert any new entries",
    "start": "639440",
    "end": "642240"
  },
  {
    "text": "uh which means that policy updates for",
    "start": "642240",
    "end": "644640"
  },
  {
    "text": "silently starts to fail and this is uh",
    "start": "644640",
    "end": "647680"
  },
  {
    "text": "really bad because if you change a",
    "start": "647680",
    "end": "649440"
  },
  {
    "text": "policy but it cannot be written to the",
    "start": "649440",
    "end": "651519"
  },
  {
    "text": "map um then well it doesn't make it into",
    "start": "651519",
    "end": "654800"
  },
  {
    "text": "the data path and so what you might",
    "start": "654800",
    "end": "656560"
  },
  {
    "text": "think um you know if you think your pod",
    "start": "656560",
    "end": "658880"
  },
  {
    "text": "is protected by a certain policy it",
    "start": "658880",
    "end": "660880"
  },
  {
    "text": "might not be um so yeah this is um not",
    "start": "660880",
    "end": "666160"
  },
  {
    "text": "great it was not a wait and see",
    "start": "666160",
    "end": "668600"
  },
  {
    "text": "situation and we were watching this it",
    "start": "668600",
    "end": "670800"
  },
  {
    "text": "was actually happening yeah uh the worst",
    "start": "670800",
    "end": "673040"
  },
  {
    "text": "policy map pressure per node",
    "start": "673040",
    "end": "675160"
  },
  {
    "text": "um",
    "start": "675160",
    "end": "677160"
  },
  {
    "text": "terrible things are starting to break",
    "start": "677160",
    "end": "679120"
  },
  {
    "text": "down so why was the map full um let's",
    "start": "679120",
    "end": "683519"
  },
  {
    "text": "zoom out for a cap for a second um and",
    "start": "683519",
    "end": "685600"
  },
  {
    "text": "recap our environment so these clusters",
    "start": "685600",
    "end": "687680"
  },
  {
    "text": "has over a thousand Kubernetes",
    "start": "687680",
    "end": "689480"
  },
  {
    "text": "namespaces um and that's not unusual for",
    "start": "689480",
    "end": "692079"
  },
  {
    "text": "us um security is enforced at the net",
    "start": "692079",
    "end": "694800"
  },
  {
    "text": "the namespace level and we apply",
    "start": "694800",
    "end": "696880"
  },
  {
    "text": "essentially one network policy per",
    "start": "696880",
    "end": "698959"
  },
  {
    "text": "namespace so we end up with about a",
    "start": "698959",
    "end": "701040"
  },
  {
    "text": "thousand network policy object in total",
    "start": "701040",
    "end": "703680"
  },
  {
    "text": "uh that might sounds like a lot but in",
    "start": "703680",
    "end": "706560"
  },
  {
    "text": "isolations it's not a problem really",
    "start": "706560",
    "end": "708399"
  },
  {
    "text": "selium handles that um you know that",
    "start": "708399",
    "end": "711120"
  },
  {
    "text": "scale just fine so we started asking",
    "start": "711120",
    "end": "713120"
  },
  {
    "text": "ourself why is the map full uh if this",
    "start": "713120",
    "end": "715760"
  },
  {
    "text": "is any anything out of the ordinary and",
    "start": "715760",
    "end": "718640"
  },
  {
    "text": "that's when James asked uh a key",
    "start": "718640",
    "end": "721120"
  },
  {
    "text": "question what what does this cluster do",
    "start": "721120",
    "end": "723480"
  },
  {
    "text": "again well it's running machine learning",
    "start": "723480",
    "end": "725920"
  },
  {
    "text": "jobs um and so far so good right but",
    "start": "725920",
    "end": "728959"
  },
  {
    "text": "here's the twist uh those machine",
    "start": "728959",
    "end": "731040"
  },
  {
    "text": "learning jobs are actually well",
    "start": "731040",
    "end": "732720"
  },
  {
    "text": "scheduled by Armada again the job",
    "start": "732720",
    "end": "734560"
  },
  {
    "text": "scheduler I was I mentioned earlier and",
    "start": "734560",
    "end": "737040"
  },
  {
    "text": "entirely reasonably Armada adds a unique",
    "start": "737040",
    "end": "740399"
  },
  {
    "text": "uh job ID label to each",
    "start": "740399",
    "end": "742600"
  },
  {
    "text": "pod and that question really led us to",
    "start": "742600",
    "end": "745120"
  },
  {
    "text": "what the real issue was um the number of",
    "start": "745120",
    "end": "747519"
  },
  {
    "text": "identities um and not just the number of",
    "start": "747519",
    "end": "749360"
  },
  {
    "text": "policies uh was what was blowing up the",
    "start": "749360",
    "end": "752600"
  },
  {
    "text": "map as an aside um you might be asking",
    "start": "752600",
    "end": "755760"
  },
  {
    "text": "yourself what is an identity actually I",
    "start": "755760",
    "end": "757760"
  },
  {
    "text": "probably was um I mentioned earlier in",
    "start": "757760",
    "end": "760320"
  },
  {
    "text": "talk before mine uh but yeah essentially",
    "start": "760320",
    "end": "762880"
  },
  {
    "text": "selium identities and uh are based on",
    "start": "762880",
    "end": "765120"
  },
  {
    "text": "pot and name space labels uh if two pods",
    "start": "765120",
    "end": "767920"
  },
  {
    "text": "have the same label they get the same",
    "start": "767920",
    "end": "769279"
  },
  {
    "text": "identity so uh our model in G research",
    "start": "769279",
    "end": "772079"
  },
  {
    "text": "was simple one identity per name space",
    "start": "772079",
    "end": "774560"
  },
  {
    "text": "shared by all pods in that same name",
    "start": "774560",
    "end": "776720"
  },
  {
    "text": "space um our model was doing nothing",
    "start": "776720",
    "end": "779279"
  },
  {
    "text": "wrong at all uh it was adding its own",
    "start": "779279",
    "end": "780880"
  },
  {
    "text": "unique job ID to track their um the job",
    "start": "780880",
    "end": "783680"
  },
  {
    "text": "across all different clusters but that",
    "start": "783680",
    "end": "785600"
  },
  {
    "text": "meant that every pot had a different set",
    "start": "785600",
    "end": "787360"
  },
  {
    "text": "of labels uh seldium saw that and",
    "start": "787360",
    "end": "790000"
  },
  {
    "text": "obviously it thought well cool I guess",
    "start": "790000",
    "end": "792000"
  },
  {
    "text": "you won't have different identities for",
    "start": "792000",
    "end": "793920"
  },
  {
    "text": "every pot uh but these clusters was",
    "start": "793920",
    "end": "796560"
  },
  {
    "text": "running uh well thousand tens of",
    "start": "796560",
    "end": "798639"
  },
  {
    "text": "thousands of pod um especially during",
    "start": "798639",
    "end": "800600"
  },
  {
    "text": "spikes and uh well here's the critical",
    "start": "800600",
    "end": "803360"
  },
  {
    "text": "part um each endpoint policy map needing",
    "start": "803360",
    "end": "806079"
  },
  {
    "text": "an entry for every identity might talk",
    "start": "806079",
    "end": "808120"
  },
  {
    "text": "to so if you suddenly go from one",
    "start": "808120",
    "end": "810800"
  },
  {
    "text": "identity per name space to tens of",
    "start": "810800",
    "end": "812800"
  },
  {
    "text": "thousands unique identities you can",
    "start": "812800",
    "end": "814560"
  },
  {
    "text": "imagine what happens the policy map has",
    "start": "814560",
    "end": "817440"
  },
  {
    "text": "about 16,000 uh entries by default so",
    "start": "817440",
    "end": "821040"
  },
  {
    "text": "once we hit that number well boom uh we",
    "start": "821040",
    "end": "823519"
  },
  {
    "text": "couldn't insert any more policies so",
    "start": "823519",
    "end": "825680"
  },
  {
    "text": "that's where things starts to break and",
    "start": "825680",
    "end": "828079"
  },
  {
    "text": "then when that's when it all clicked we",
    "start": "828079",
    "end": "829839"
  },
  {
    "text": "weren't running too many policies we",
    "start": "829839",
    "end": "831200"
  },
  {
    "text": "were just running too many identities",
    "start": "831200",
    "end": "832800"
  },
  {
    "text": "and the map just couldn't handle it",
    "start": "832800",
    "end": "836000"
  },
  {
    "text": "luckily this is one of those situations",
    "start": "836000",
    "end": "838240"
  },
  {
    "text": "where when you understand the problem",
    "start": "838240",
    "end": "840079"
  },
  {
    "text": "and you know what's going on the fix is",
    "start": "840079",
    "end": "842079"
  },
  {
    "text": "fairly easy um Selium lets you define a",
    "start": "842079",
    "end": "844959"
  },
  {
    "text": "set of labels that are actually relevant",
    "start": "844959",
    "end": "846480"
  },
  {
    "text": "for you so instead of using every label",
    "start": "846480",
    "end": "849519"
  },
  {
    "text": "um like those unique as well for Armada",
    "start": "849519",
    "end": "851680"
  },
  {
    "text": "jobs uh we just told it to consider a",
    "start": "851680",
    "end": "854480"
  },
  {
    "text": "specific subset uh we went ahead and",
    "start": "854480",
    "end": "856959"
  },
  {
    "text": "excluded the Armada specific labels and",
    "start": "856959",
    "end": "859279"
  },
  {
    "text": "just like that the identity count",
    "start": "859279",
    "end": "861360"
  },
  {
    "text": "dropped back to expected levels and so",
    "start": "861360",
    "end": "863600"
  },
  {
    "text": "did the pressure on the policy maps so",
    "start": "863600",
    "end": "866959"
  },
  {
    "text": "this is what it looked like after we",
    "start": "866959",
    "end": "868160"
  },
  {
    "text": "applied the fix um we were previously",
    "start": "868160",
    "end": "870959"
  },
  {
    "text": "running at the edge um and now the",
    "start": "870959",
    "end": "872880"
  },
  {
    "text": "policy map usage went all the way down",
    "start": "872880",
    "end": "874720"
  },
  {
    "text": "actually these are not even the value",
    "start": "874720",
    "end": "876480"
  },
  {
    "text": "for the policy maps itself the one you",
    "start": "876480",
    "end": "878800"
  },
  {
    "text": "can see here I think related to contract",
    "start": "878800",
    "end": "881120"
  },
  {
    "text": "um I might be wrong but essentially what",
    "start": "881120",
    "end": "883519"
  },
  {
    "text": "I mean is the problem the problem just",
    "start": "883519",
    "end": "885320"
  },
  {
    "text": "disappeared it's worth pointing out",
    "start": "885320",
    "end": "887279"
  },
  {
    "text": "right the we didn't have to reduce pod",
    "start": "887279",
    "end": "888959"
  },
  {
    "text": "counts we didn't have to rewrite",
    "start": "888959",
    "end": "890399"
  },
  {
    "text": "policies we just had to get the",
    "start": "890399",
    "end": "891839"
  },
  {
    "text": "identities uh",
    "start": "891839",
    "end": "893560"
  },
  {
    "text": "right so key takeaway um we at the time",
    "start": "893560",
    "end": "897360"
  },
  {
    "text": "we already considered the name space to",
    "start": "897360",
    "end": "898880"
  },
  {
    "text": "be security boundary we just didn't tell",
    "start": "898880",
    "end": "901519"
  },
  {
    "text": "Selium um and selium just doesn't guess",
    "start": "901519",
    "end": "904320"
  },
  {
    "text": "it uses all the label it sees if you",
    "start": "904320",
    "end": "905839"
  },
  {
    "text": "don't tell it uh to not do it and this",
    "start": "905839",
    "end": "908320"
  },
  {
    "text": "mismatch was what was causing the",
    "start": "908320",
    "end": "911480"
  },
  {
    "text": "issue so uh with that behind us let's",
    "start": "911480",
    "end": "915199"
  },
  {
    "text": "talk about the next fun surprise we run",
    "start": "915199",
    "end": "917120"
  },
  {
    "text": "into",
    "start": "917120",
    "end": "919399"
  },
  {
    "text": "contract so as we scale the cluster a",
    "start": "919399",
    "end": "922880"
  },
  {
    "text": "bit further uh we started noticing",
    "start": "922880",
    "end": "925040"
  },
  {
    "text": "another issue uh selium was throwing",
    "start": "925040",
    "end": "927279"
  },
  {
    "text": "more and more errors um we started we",
    "start": "927279",
    "end": "930160"
  },
  {
    "text": "filtered the selium API limiter process",
    "start": "930160",
    "end": "932160"
  },
  {
    "text": "request total matrix for failure and saw",
    "start": "932160",
    "end": "935279"
  },
  {
    "text": "a rising trend uh these are not",
    "start": "935279",
    "end": "938000"
  },
  {
    "text": "consistent um you know just sometimes",
    "start": "938000",
    "end": "940000"
  },
  {
    "text": "the operations were failing and uh these",
    "start": "940000",
    "end": "942399"
  },
  {
    "text": "are not you know these are not low-level",
    "start": "942399",
    "end": "944320"
  },
  {
    "text": "packet drops or latency blips uh we're",
    "start": "944320",
    "end": "946480"
  },
  {
    "text": "talking about let's say error in the",
    "start": "946480",
    "end": "948160"
  },
  {
    "text": "plumbings uh the selium agent was",
    "start": "948160",
    "end": "950240"
  },
  {
    "text": "failing to clean up properly during pod",
    "start": "950240",
    "end": "954120"
  },
  {
    "text": "deletion so this led us to dive into",
    "start": "954120",
    "end": "957360"
  },
  {
    "text": "logs and we spotted something well quite",
    "start": "957360",
    "end": "959759"
  },
  {
    "text": "telling um there was an error and the",
    "start": "959759",
    "end": "962079"
  },
  {
    "text": "middle says it was unable to remove",
    "start": "962079",
    "end": "963839"
  },
  {
    "text": "proxy redirect with a context deadline",
    "start": "963839",
    "end": "966000"
  },
  {
    "text": "exceeded",
    "start": "966000",
    "end": "966959"
  },
  {
    "text": "In other words there was something that",
    "start": "966959",
    "end": "968320"
  },
  {
    "text": "was timing out um during endpoint",
    "start": "968320",
    "end": "970720"
  },
  {
    "text": "deletion so we had a suspicions as to",
    "start": "970720",
    "end": "974160"
  },
  {
    "text": "where to look next",
    "start": "974160",
    "end": "977160"
  },
  {
    "text": "um we um you know we looked a bit deeper",
    "start": "977160",
    "end": "980160"
  },
  {
    "text": "and found you know another suspicious",
    "start": "980160",
    "end": "982079"
  },
  {
    "text": "metrics lighting up the data path",
    "start": "982079",
    "end": "983839"
  },
  {
    "text": "contract GC situation seconds again that",
    "start": "983839",
    "end": "986320"
  },
  {
    "text": "was peaking at over 10 seconds uh at",
    "start": "986320",
    "end": "988800"
  },
  {
    "text": "times which is quite long um if you you",
    "start": "988800",
    "end": "991040"
  },
  {
    "text": "know consider uh this is happening",
    "start": "991040",
    "end": "993920"
  },
  {
    "text": "during a a critical CNI operation now",
    "start": "993920",
    "end": "997199"
  },
  {
    "text": "when you see timeouts like this you",
    "start": "997199",
    "end": "998800"
  },
  {
    "text": "naturally want to understand you know",
    "start": "998800",
    "end": "1000000"
  },
  {
    "text": "why is it taking so long um and you know",
    "start": "1000000",
    "end": "1002560"
  },
  {
    "text": "we started diving a little bit into the",
    "start": "1002560",
    "end": "1004720"
  },
  {
    "text": "into the code um of selium itself and um",
    "start": "1004720",
    "end": "1008399"
  },
  {
    "text": "well we found a line uh in the selium",
    "start": "1008399",
    "end": "1010800"
  },
  {
    "text": "source where you know when uh deleting",
    "start": "1010800",
    "end": "1013519"
  },
  {
    "text": "an endpoint uh could trigger a contract",
    "start": "1013519",
    "end": "1015600"
  },
  {
    "text": "garbage collection so suddenly something",
    "start": "1015600",
    "end": "1018639"
  },
  {
    "text": "that we usually think as you know as",
    "start": "1018639",
    "end": "1020079"
  },
  {
    "text": "happening in the background um GC namely",
    "start": "1020079",
    "end": "1023519"
  },
  {
    "text": "is now in the path of a critical",
    "start": "1023519",
    "end": "1025038"
  },
  {
    "text": "operations and that's not great",
    "start": "1025039",
    "end": "1029639"
  },
  {
    "text": "just taking a second to explain contract",
    "start": "1029839",
    "end": "1032558"
  },
  {
    "text": "uh if you haven't heard uh it's a short",
    "start": "1032559",
    "end": "1034160"
  },
  {
    "text": "of for connection tracking uh it's how",
    "start": "1034160",
    "end": "1036079"
  },
  {
    "text": "selium tracks ongoing connections for",
    "start": "1036079",
    "end": "1038400"
  },
  {
    "text": "example if you allowing egress to port",
    "start": "1038400",
    "end": "1040959"
  },
  {
    "text": "53 for the NS selium needs to remember",
    "start": "1040959",
    "end": "1042880"
  },
  {
    "text": "that the request was allowed u so you",
    "start": "1042880",
    "end": "1045120"
  },
  {
    "text": "can permit the response um it does this",
    "start": "1045120",
    "end": "1047199"
  },
  {
    "text": "with an ebpf map um this you know store",
    "start": "1047199",
    "end": "1050320"
  },
  {
    "text": "metadata about active flows and as you",
    "start": "1050320",
    "end": "1052400"
  },
  {
    "text": "can imagine they can grow over time uh",
    "start": "1052400",
    "end": "1054559"
  },
  {
    "text": "but they don't grow forever uh that's",
    "start": "1054559",
    "end": "1056559"
  },
  {
    "text": "where garbage collections comes",
    "start": "1056559",
    "end": "1060159"
  },
  {
    "text": "And um well the contract maps have a",
    "start": "1060320",
    "end": "1062960"
  },
  {
    "text": "finite size like everything else um and",
    "start": "1062960",
    "end": "1064880"
  },
  {
    "text": "to keep them under control selium",
    "start": "1064880",
    "end": "1066320"
  },
  {
    "text": "perform garbage collections um removing",
    "start": "1066320",
    "end": "1070160"
  },
  {
    "text": "still entries uh the GC um runs on a",
    "start": "1070160",
    "end": "1073919"
  },
  {
    "text": "dynamic interval um after each run",
    "start": "1073919",
    "end": "1076559"
  },
  {
    "text": "decides uh when to run the next one",
    "start": "1076559",
    "end": "1078799"
  },
  {
    "text": "based on how many entries it removed",
    "start": "1078799",
    "end": "1080960"
  },
  {
    "text": "before so in theory uh this works well",
    "start": "1080960",
    "end": "1084080"
  },
  {
    "text": "uh it adapts to how dirty the map is but",
    "start": "1084080",
    "end": "1087520"
  },
  {
    "text": "in practice when the GC gets the fur for",
    "start": "1087520",
    "end": "1090480"
  },
  {
    "text": "um in practice when the GC gets the fur",
    "start": "1090480",
    "end": "1093039"
  },
  {
    "text": "for hours the next run might have a huge",
    "start": "1093039",
    "end": "1095720"
  },
  {
    "text": "backlog and so if the GC happens to be",
    "start": "1095720",
    "end": "1098080"
  },
  {
    "text": "triggered during a pod deletion well",
    "start": "1098080",
    "end": "1099840"
  },
  {
    "text": "you're now waiting 10 to 20 seconds for",
    "start": "1099840",
    "end": "1101919"
  },
  {
    "text": "that cleanup to finish which breaks the",
    "start": "1101919",
    "end": "1104480"
  },
  {
    "text": "CNI expectations",
    "start": "1104480",
    "end": "1107360"
  },
  {
    "text": "so taking a look at what some of um what",
    "start": "1107360",
    "end": "1110640"
  },
  {
    "text": "the metrics were telling us uh you can",
    "start": "1110640",
    "end": "1112160"
  },
  {
    "text": "see at the top graph here um it shows",
    "start": "1112160",
    "end": "1114320"
  },
  {
    "text": "the contract GC durations in quantiles u",
    "start": "1114320",
    "end": "1117600"
  },
  {
    "text": "and you can see the P95 uh the GC",
    "start": "1117600",
    "end": "1119919"
  },
  {
    "text": "duration is consistently off hovering",
    "start": "1119919",
    "end": "1121600"
  },
  {
    "text": "between two to three seconds um that",
    "start": "1121600",
    "end": "1124080"
  },
  {
    "text": "doesn't seem too bad on its own and it",
    "start": "1124080",
    "end": "1126240"
  },
  {
    "text": "wouldn't be a problem if all operations",
    "start": "1126240",
    "end": "1128240"
  },
  {
    "text": "were distributed evenly uh but you know",
    "start": "1128240",
    "end": "1130720"
  },
  {
    "text": "looking at the bottom chart instead uh",
    "start": "1130720",
    "end": "1132559"
  },
  {
    "text": "it shows individual agent GC durations",
    "start": "1132559",
    "end": "1135200"
  },
  {
    "text": "uh grouped by node you can see there's a",
    "start": "1135200",
    "end": "1137679"
  },
  {
    "text": "huge spread uh with occasional spikes",
    "start": "1137679",
    "end": "1140000"
  },
  {
    "text": "sitting 10 15 even 20 seconds so even",
    "start": "1140000",
    "end": "1143520"
  },
  {
    "text": "though the overall cluster looked okay",
    "start": "1143520",
    "end": "1145280"
  },
  {
    "text": "some agents were occasionally doing",
    "start": "1145280",
    "end": "1146880"
  },
  {
    "text": "really expensive GC runs and those were",
    "start": "1146880",
    "end": "1148960"
  },
  {
    "text": "the ones triggering timeouts during",
    "start": "1148960",
    "end": "1150640"
  },
  {
    "text": "endpoint deletes this is a classic case",
    "start": "1150640",
    "end": "1154000"
  },
  {
    "text": "of the media looking healthy uh while",
    "start": "1154000",
    "end": "1156080"
  },
  {
    "text": "the tail causes real issues",
    "start": "1156080",
    "end": "1159279"
  },
  {
    "text": "So um let's take stock uh what do we",
    "start": "1159600",
    "end": "1162480"
  },
  {
    "text": "know well we know that contract GC now",
    "start": "1162480",
    "end": "1164480"
  },
  {
    "text": "has been triggered with CNI deletes uh",
    "start": "1164480",
    "end": "1166400"
  },
  {
    "text": "most of the time it's quick um even at",
    "start": "1166400",
    "end": "1168720"
  },
  {
    "text": "the P95 um you know it stays under 3",
    "start": "1168720",
    "end": "1171440"
  },
  {
    "text": "seconds but sometimes on some nodes it",
    "start": "1171440",
    "end": "1174080"
  },
  {
    "text": "takes you know 10 to 20 seconds and if",
    "start": "1174080",
    "end": "1176400"
  },
  {
    "text": "that happens to end up with a CNI call",
    "start": "1176400",
    "end": "1178320"
  },
  {
    "text": "like deleting a pod that's where we get",
    "start": "1178320",
    "end": "1180200"
  },
  {
    "text": "timeout uh this wasn't theoretical we",
    "start": "1180200",
    "end": "1182559"
  },
  {
    "text": "saw it happen um errors in the logs",
    "start": "1182559",
    "end": "1184400"
  },
  {
    "text": "matched exactly uh with the long GC",
    "start": "1184400",
    "end": "1186160"
  },
  {
    "text": "durations we were seeing in the metrics",
    "start": "1186160",
    "end": "1187919"
  },
  {
    "text": "so at that point we just had a good good",
    "start": "1187919",
    "end": "1189840"
  },
  {
    "text": "hunch uh so we looked at the logs some",
    "start": "1189840",
    "end": "1192919"
  },
  {
    "text": "more and uh yeah that's what we finally",
    "start": "1192919",
    "end": "1196000"
  },
  {
    "text": "found um a quite telling log message uh",
    "start": "1196000",
    "end": "1200320"
  },
  {
    "text": "we could see that the next interval that",
    "start": "1200320",
    "end": "1202320"
  },
  {
    "text": "was calculated was uh 7 hours um 7 hours",
    "start": "1202320",
    "end": "1205919"
  },
  {
    "text": "between GC runs you know which um during",
    "start": "1205919",
    "end": "1208480"
  },
  {
    "text": "which the map can grow uh unchecked and",
    "start": "1208480",
    "end": "1211919"
  },
  {
    "text": "uh if the GC finally runs during a pod",
    "start": "1211919",
    "end": "1214080"
  },
  {
    "text": "delete yeah it takes 10 20 seconds and",
    "start": "1214080",
    "end": "1216480"
  },
  {
    "text": "then yes they timeouts exactly what",
    "start": "1216480",
    "end": "1218480"
  },
  {
    "text": "we're",
    "start": "1218480",
    "end": "1220120"
  },
  {
    "text": "seeing fortunately there was a Helm",
    "start": "1220120",
    "end": "1222640"
  },
  {
    "text": "setting for this as well um contract GC",
    "start": "1222640",
    "end": "1225039"
  },
  {
    "text": "max interval uh electric cap the uh GC",
    "start": "1225039",
    "end": "1227919"
  },
  {
    "text": "interval uh while still allowing ing it",
    "start": "1227919",
    "end": "1229919"
  },
  {
    "text": "to scale dynamically um we set hours to",
    "start": "1229919",
    "end": "1233360"
  },
  {
    "text": "10 minutes uh which is an arbitrary",
    "start": "1233360",
    "end": "1235120"
  },
  {
    "text": "number we picked um that way even if",
    "start": "1235120",
    "end": "1237440"
  },
  {
    "text": "selium you know thinks it can wait",
    "start": "1237440",
    "end": "1239039"
  },
  {
    "text": "longer uh it won't be delayed um beyond",
    "start": "1239039",
    "end": "1242080"
  },
  {
    "text": "that point since then we haven't seen",
    "start": "1242080",
    "end": "1245360"
  },
  {
    "text": "this class of timeouts",
    "start": "1245360",
    "end": "1248039"
  },
  {
    "text": "again and so here how things um well",
    "start": "1248039",
    "end": "1251440"
  },
  {
    "text": "look like after we apply the fix uh",
    "start": "1251440",
    "end": "1253280"
  },
  {
    "text": "again we're looking at the same metric",
    "start": "1253280",
    "end": "1254559"
  },
  {
    "text": "as before the quant at the top um you",
    "start": "1254559",
    "end": "1257600"
  },
  {
    "text": "can you can immediately see a difference",
    "start": "1257600",
    "end": "1259200"
  },
  {
    "text": "uh the P95GC durations dropped uh",
    "start": "1259200",
    "end": "1262000"
  },
  {
    "text": "staying consistently low this time and",
    "start": "1262000",
    "end": "1264480"
  },
  {
    "text": "in the bottom panel uh we now started to",
    "start": "1264480",
    "end": "1266960"
  },
  {
    "text": "see well uh still a bit of noise um some",
    "start": "1266960",
    "end": "1270000"
  },
  {
    "text": "agents were still taking longer but the",
    "start": "1270000",
    "end": "1272280"
  },
  {
    "text": "outliers were far fewer and they didn't",
    "start": "1272280",
    "end": "1275679"
  },
  {
    "text": "take um 10 to 20 second",
    "start": "1275679",
    "end": "1278120"
  },
  {
    "text": "anymore um and yeah that's because we",
    "start": "1278120",
    "end": "1280559"
  },
  {
    "text": "kept the interval at 10 minutes making",
    "start": "1280559",
    "end": "1282320"
  },
  {
    "text": "it GC run a bit more aggressively um you",
    "start": "1282320",
    "end": "1285120"
  },
  {
    "text": "know it was a bit of a trade-off of",
    "start": "1285120",
    "end": "1286400"
  },
  {
    "text": "course there's a bit of a cost in terms",
    "start": "1286400",
    "end": "1287840"
  },
  {
    "text": "of CPU usage uh but yeah this confirmed",
    "start": "1287840",
    "end": "1290720"
  },
  {
    "text": "our theory and showed that tuning GC",
    "start": "1290720",
    "end": "1292400"
  },
  {
    "text": "frequency can have a direct uh",
    "start": "1292400",
    "end": "1294480"
  },
  {
    "text": "operational",
    "start": "1294480",
    "end": "1295880"
  },
  {
    "text": "impact a key takeaway from here keep an",
    "start": "1295880",
    "end": "1298720"
  },
  {
    "text": "eye on your contract times and table",
    "start": "1298720",
    "end": "1300480"
  },
  {
    "text": "sizes um you may need to tune contract",
    "start": "1300480",
    "end": "1304000"
  },
  {
    "text": "especially if your workloads are not",
    "start": "1304000",
    "end": "1305440"
  },
  {
    "text": "consistent in their size and network",
    "start": "1305440",
    "end": "1307280"
  },
  {
    "text": "usage",
    "start": "1307280",
    "end": "1310280"
  },
  {
    "text": "now coming towards an end of my",
    "start": "1311200",
    "end": "1313360"
  },
  {
    "text": "presentations this is a bonus story",
    "start": "1313360",
    "end": "1315039"
  },
  {
    "text": "about um how we managed to make selium",
    "start": "1315039",
    "end": "1317440"
  },
  {
    "text": "use one terabyte of",
    "start": "1317440",
    "end": "1320679"
  },
  {
    "text": "memory this is a much more recent story",
    "start": "1320679",
    "end": "1323600"
  },
  {
    "text": "um I think it happened maybe last month",
    "start": "1323600",
    "end": "1325520"
  },
  {
    "text": "or two months ago uh it happened on a",
    "start": "1325520",
    "end": "1327520"
  },
  {
    "text": "newer version of selium um we were",
    "start": "1327520",
    "end": "1329440"
  },
  {
    "text": "deploying a fix for you know memory",
    "start": "1329440",
    "end": "1331120"
  },
  {
    "text": "issues that we saw in enterprise",
    "start": "1331120",
    "end": "1333039"
  },
  {
    "text": "features uh we were confident in the fix",
    "start": "1333039",
    "end": "1335520"
  },
  {
    "text": "but after the roll out memory usage",
    "start": "1335520",
    "end": "1337840"
  },
  {
    "text": "started to climb it really was weird we",
    "start": "1337840",
    "end": "1340320"
  },
  {
    "text": "couldn't really understand it and this",
    "start": "1340320",
    "end": "1342559"
  },
  {
    "text": "is what we were seeing uh selium pods",
    "start": "1342559",
    "end": "1344720"
  },
  {
    "text": "using up to one terabyte of memory what",
    "start": "1344720",
    "end": "1346400"
  },
  {
    "text": "was going on really but if you see on",
    "start": "1346400",
    "end": "1348720"
  },
  {
    "text": "the other side um the selium CPU usage",
    "start": "1348720",
    "end": "1351840"
  },
  {
    "text": "was quite low it's still 10% it seems",
    "start": "1351840",
    "end": "1355039"
  },
  {
    "text": "like everything was normal for selium",
    "start": "1355039",
    "end": "1356880"
  },
  {
    "text": "it's just memory that just went crazy",
    "start": "1356880",
    "end": "1360720"
  },
  {
    "text": "and after an agent restart um we now",
    "start": "1360720",
    "end": "1364159"
  },
  {
    "text": "started observing how the user started",
    "start": "1364159",
    "end": "1366000"
  },
  {
    "text": "to slowly and slowly build up over time",
    "start": "1366000",
    "end": "1369120"
  },
  {
    "text": "um this kind of behavior uh was very",
    "start": "1369120",
    "end": "1372720"
  },
  {
    "text": "well it might it might be familiar for",
    "start": "1372720",
    "end": "1374480"
  },
  {
    "text": "some of you um I have some colleagues",
    "start": "1374480",
    "end": "1377200"
  },
  {
    "text": "who actually ask me uh what is even",
    "start": "1377200",
    "end": "1379280"
  },
  {
    "text": "written in is it C is it a C type memory",
    "start": "1379280",
    "end": "1382000"
  },
  {
    "text": "leak or something well this was a bit of",
    "start": "1382000",
    "end": "1385120"
  },
  {
    "text": "a low moment for me when I had to tell",
    "start": "1385120",
    "end": "1387000"
  },
  {
    "text": "James that for debugging purposes we had",
    "start": "1387000",
    "end": "1390159"
  },
  {
    "text": "GoC set to",
    "start": "1390159",
    "end": "1392760"
  },
  {
    "text": "off so key takeaway from these don't do",
    "start": "1392760",
    "end": "1397710"
  },
  {
    "text": "[Laughter]",
    "start": "1397710",
    "end": "1399080"
  },
  {
    "text": "that thank you very much for listening",
    "start": "1399080",
    "end": "1401679"
  },
  {
    "text": "to my talk uh yeah",
    "start": "1401679",
    "end": "1405500"
  },
  {
    "text": "[Music]",
    "start": "1405500",
    "end": "1406350"
  },
  {
    "text": "[Applause]",
    "start": "1406350",
    "end": "1411200"
  }
]