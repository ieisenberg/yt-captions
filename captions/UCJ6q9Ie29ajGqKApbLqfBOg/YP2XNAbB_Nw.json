[
  {
    "text": "hey everyone thank you so much for being",
    "start": "2520",
    "end": "4080"
  },
  {
    "text": "here welcome to my talk on bypassing",
    "start": "4080",
    "end": "6080"
  },
  {
    "text": "adus cloud trail my name is Nick Fett",
    "start": "6080",
    "end": "8960"
  },
  {
    "text": "I'm a security researcher over at data",
    "start": "8960",
    "end": "10639"
  },
  {
    "text": "dog where I work on our Cloud security",
    "start": "10639",
    "end": "12360"
  },
  {
    "text": "products I spend a lot of time coming up",
    "start": "12360",
    "end": "15040"
  },
  {
    "text": "with ways that adversaries can more",
    "start": "15040",
    "end": "16640"
  },
  {
    "text": "effectively compromise and exploit adus",
    "start": "16640",
    "end": "19119"
  },
  {
    "text": "resources and from that how do we detect",
    "start": "19119",
    "end": "21560"
  },
  {
    "text": "that behavior or hopefully prevent it",
    "start": "21560",
    "end": "23560"
  },
  {
    "text": "entirely as a result of that research",
    "start": "23560",
    "end": "26000"
  },
  {
    "text": "sometimes I find vulnerabilities in the",
    "start": "26000",
    "end": "27679"
  },
  {
    "text": "underlying AWS Services some of which",
    "start": "27679",
    "end": "30119"
  },
  {
    "text": "we'll be talking about",
    "start": "30119",
    "end": "31640"
  },
  {
    "text": "today in terms of content for this",
    "start": "31640",
    "end": "34559"
  },
  {
    "text": "session we have quite a lot to get",
    "start": "34559",
    "end": "35840"
  },
  {
    "text": "through uh as mentioned we'll likely use",
    "start": "35840",
    "end": "38120"
  },
  {
    "text": "the full 30 minute time slot so if you",
    "start": "38120",
    "end": "40160"
  },
  {
    "text": "have any questions feel free to see me",
    "start": "40160",
    "end": "41559"
  },
  {
    "text": "in the wrap-up room I'd be happy to",
    "start": "41559",
    "end": "42960"
  },
  {
    "text": "answer them or feel free to reach out",
    "start": "42960",
    "end": "44920"
  },
  {
    "text": "through the social media links I'll have",
    "start": "44920",
    "end": "46600"
  },
  {
    "text": "at the end uh for this session we'll",
    "start": "46600",
    "end": "49719"
  },
  {
    "text": "dive into just a quick recap on what",
    "start": "49719",
    "end": "51800"
  },
  {
    "text": "cloud trail is and why we care about it",
    "start": "51800",
    "end": "54160"
  },
  {
    "text": "both from a defensive perspective and an",
    "start": "54160",
    "end": "56600"
  },
  {
    "text": "offensive one as well then we'll take a",
    "start": "56600",
    "end": "59000"
  },
  {
    "text": "look at the internals of the ads API",
    "start": "59000",
    "end": "61480"
  },
  {
    "text": "learn a little bit more about it so then",
    "start": "61480",
    "end": "63199"
  },
  {
    "text": "we can then apply that knowledge to",
    "start": "63199",
    "end": "64720"
  },
  {
    "text": "start bypassing cloud trail uh over time",
    "start": "64720",
    "end": "67960"
  },
  {
    "text": "I found a number of vulnerabilities that",
    "start": "67960",
    "end": "69600"
  },
  {
    "text": "have allowed me to bypass cloud tril in",
    "start": "69600",
    "end": "71640"
  },
  {
    "text": "some way everything from simple",
    "start": "71640",
    "end": "74080"
  },
  {
    "text": "permission enumeration up to and",
    "start": "74080",
    "end": "76080"
  },
  {
    "text": "including interacting with a given",
    "start": "76080",
    "end": "77840"
  },
  {
    "text": "service well completely avoiding all",
    "start": "77840",
    "end": "80040"
  },
  {
    "text": "logging now really quick it's important",
    "start": "80040",
    "end": "82400"
  },
  {
    "text": "to note that when we describe a cloud",
    "start": "82400",
    "end": "84560"
  },
  {
    "text": "trail bypass this is not a",
    "start": "84560",
    "end": "87280"
  },
  {
    "text": "misconfiguration this is not something",
    "start": "87280",
    "end": "89200"
  },
  {
    "text": "we can account for with our cloud trail",
    "start": "89200",
    "end": "91520"
  },
  {
    "text": "setup uh it's not something silly like",
    "start": "91520",
    "end": "93960"
  },
  {
    "text": "if we disable cloud trail now we've",
    "start": "93960",
    "end": "95960"
  },
  {
    "text": "we've bypassed it a cloud trail bypass",
    "start": "95960",
    "end": "98880"
  },
  {
    "text": "is very much so a flaw on the AWS side",
    "start": "98880",
    "end": "101920"
  },
  {
    "text": "of the shared responsibility model and",
    "start": "101920",
    "end": "103840"
  },
  {
    "text": "as a result it's ultimately up to Amazon",
    "start": "103840",
    "end": "106240"
  },
  {
    "text": "to fix remediate or otherwise mitigate",
    "start": "106240",
    "end": "109079"
  },
  {
    "text": "these issues and as I'm sure you can",
    "start": "109079",
    "end": "111640"
  },
  {
    "text": "imagine ews has a vested interest in",
    "start": "111640",
    "end": "114000"
  },
  {
    "text": "ensuring the security of their platform",
    "start": "114000",
    "end": "116280"
  },
  {
    "text": "which as a result since I've disclosed",
    "start": "116280",
    "end": "118119"
  },
  {
    "text": "these issues to them almost all the",
    "start": "118119",
    "end": "119640"
  },
  {
    "text": "things things we're going to be talking",
    "start": "119640",
    "end": "120560"
  },
  {
    "text": "about today have since been fixed by AWS",
    "start": "120560",
    "end": "123560"
  },
  {
    "text": "so think about this talk less from the",
    "start": "123560",
    "end": "125479"
  },
  {
    "text": "perspective of if you're a pentester or",
    "start": "125479",
    "end": "127240"
  },
  {
    "text": "a red teamer here are some specific",
    "start": "127240",
    "end": "129080"
  },
  {
    "text": "things you can do and much more from the",
    "start": "129080",
    "end": "131039"
  },
  {
    "text": "perspective of what can we learn from",
    "start": "131039",
    "end": "132800"
  },
  {
    "text": "these vulnerabilities that we can apply",
    "start": "132800",
    "end": "134599"
  },
  {
    "text": "to Future bypasses and indeed we'll show",
    "start": "134599",
    "end": "136959"
  },
  {
    "text": "there is still a ton of opportunity to",
    "start": "136959",
    "end": "139200"
  },
  {
    "text": "evade detection from cloud trail while",
    "start": "139200",
    "end": "141760"
  },
  {
    "text": "these specific vulnerabilities have been",
    "start": "141760",
    "end": "143360"
  },
  {
    "text": "fixed the highlevel archetypes and",
    "start": "143360",
    "end": "146040"
  },
  {
    "text": "categories are still susceptible and the",
    "start": "146040",
    "end": "148560"
  },
  {
    "text": "ones we'll be talking about today our",
    "start": "148560",
    "end": "150360"
  },
  {
    "text": "protocol mutation undocumented apis and",
    "start": "150360",
    "end": "153239"
  },
  {
    "text": "abusing nonproduction endpoints so with",
    "start": "153239",
    "end": "156400"
  },
  {
    "text": "all that out of the way let's get",
    "start": "156400",
    "end": "157959"
  },
  {
    "text": "started first what is AWS cloud trail",
    "start": "157959",
    "end": "161840"
  },
  {
    "text": "cloud trail is a fundamental security",
    "start": "161840",
    "end": "164040"
  },
  {
    "text": "logging service offered by AWS and it is",
    "start": "164040",
    "end": "167400"
  },
  {
    "text": "responsible for login calls to the AWS",
    "start": "167400",
    "end": "170840"
  },
  {
    "text": "API under most circumstances when an",
    "start": "170840",
    "end": "173959"
  },
  {
    "text": "identity in an AWS environment performs",
    "start": "173959",
    "end": "176200"
  },
  {
    "text": "a call to the AWS API that invocation",
    "start": "176200",
    "end": "179360"
  },
  {
    "text": "will generate a cloud trail event which",
    "start": "179360",
    "end": "181720"
  },
  {
    "text": "will contain all the relevant metadata",
    "start": "181720",
    "end": "184239"
  },
  {
    "text": "around that invocation the identity that",
    "start": "184239",
    "end": "187000"
  },
  {
    "text": "performed it the date and time that it",
    "start": "187000",
    "end": "188760"
  },
  {
    "text": "occurred the specific API service and",
    "start": "188760",
    "end": "191640"
  },
  {
    "text": "action the IP address and user agent of",
    "start": "191640",
    "end": "194319"
  },
  {
    "text": "the client as well as all of the",
    "start": "194319",
    "end": "196239"
  },
  {
    "text": "relevant request parameters as a result",
    "start": "196239",
    "end": "199280"
  },
  {
    "text": "as you can imagine cloud tril is a",
    "start": "199280",
    "end": "201239"
  },
  {
    "text": "fantastic tool for security teams it",
    "start": "201239",
    "end": "203480"
  },
  {
    "text": "helps answer the question of who did",
    "start": "203480",
    "end": "205799"
  },
  {
    "text": "what win in an AWS environment and this",
    "start": "205799",
    "end": "209360"
  },
  {
    "text": "combined with the log aggregation",
    "start": "209360",
    "end": "211560"
  },
  {
    "text": "platform of your choosing makes it very",
    "start": "211560",
    "end": "213560"
  },
  {
    "text": "easy to do automated threat detection of",
    "start": "213560",
    "end": "215879"
  },
  {
    "text": "suspicious activities now security teams",
    "start": "215879",
    "end": "219560"
  },
  {
    "text": "love cloud trail and it's very helpful",
    "start": "219560",
    "end": "222159"
  },
  {
    "text": "but by that exact same notion cloud",
    "start": "222159",
    "end": "223959"
  },
  {
    "text": "trail is a substantial problem for",
    "start": "223959",
    "end": "226560"
  },
  {
    "text": "adversaries for an attacker there is a",
    "start": "226560",
    "end": "229080"
  },
  {
    "text": "significant draw to use stolen imem",
    "start": "229080",
    "end": "231560"
  },
  {
    "text": "credentials because with those",
    "start": "231560",
    "end": "233360"
  },
  {
    "text": "credentials they open up the possibility",
    "start": "233360",
    "end": "235439"
  },
  {
    "text": "for things like privilege escalation",
    "start": "235439",
    "end": "237799"
  },
  {
    "text": "lateral movement maintaining persist",
    "start": "237799",
    "end": "240360"
  },
  {
    "text": "accessing resources and so much more but",
    "start": "240360",
    "end": "244159"
  },
  {
    "text": "they run the risk that just about",
    "start": "244159",
    "end": "245599"
  },
  {
    "text": "anything they would do with those",
    "start": "245599",
    "end": "247120"
  },
  {
    "text": "credentials will ultimately get it",
    "start": "247120",
    "end": "249000"
  },
  {
    "text": "logged to cloud trail and later on",
    "start": "249000",
    "end": "250959"
  },
  {
    "text": "analyze by a sim a data l or something",
    "start": "250959",
    "end": "253239"
  },
  {
    "text": "else getting them",
    "start": "253239",
    "end": "255079"
  },
  {
    "text": "caught so this is the motivation behind",
    "start": "255079",
    "end": "257720"
  },
  {
    "text": "the research we'll be talking about",
    "start": "257720",
    "end": "259000"
  },
  {
    "text": "today adversaries want to cover their",
    "start": "259000",
    "end": "261359"
  },
  {
    "text": "tracks as best as they can to avoid",
    "start": "261359",
    "end": "263479"
  },
  {
    "text": "detection and if an adversary can",
    "start": "263479",
    "end": "266120"
  },
  {
    "text": "perform calls to the ads API without",
    "start": "266120",
    "end": "268800"
  },
  {
    "text": "leaving a trace in CL Trail they are",
    "start": "268800",
    "end": "270880"
  },
  {
    "text": "fundamentally invisible security teams",
    "start": "270880",
    "end": "273680"
  },
  {
    "text": "have no way of knowing that this",
    "start": "273680",
    "end": "275400"
  },
  {
    "text": "activity has occurred now to get started",
    "start": "275400",
    "end": "279759"
  },
  {
    "text": "on the internals of the AWS API it's",
    "start": "279759",
    "end": "282759"
  },
  {
    "text": "important to note that AWS is very big",
    "start": "282759",
    "end": "285120"
  },
  {
    "text": "on what they refer to as model first",
    "start": "285120",
    "end": "287759"
  },
  {
    "text": "design and what this means is when they",
    "start": "287759",
    "end": "290160"
  },
  {
    "text": "create a new service before they write a",
    "start": "290160",
    "end": "292880"
  },
  {
    "text": "single line of code they first create a",
    "start": "292880",
    "end": "295160"
  },
  {
    "text": "model that describes everything about",
    "start": "295160",
    "end": "297039"
  },
  {
    "text": "that service what its operations are",
    "start": "297039",
    "end": "299320"
  },
  {
    "text": "what parameters will be and so on now",
    "start": "299320",
    "end": "302600"
  },
  {
    "text": "this model first design carries over",
    "start": "302600",
    "end": "304960"
  },
  {
    "text": "well into production and as a result we",
    "start": "304960",
    "end": "307520"
  },
  {
    "text": "can actually extract out the models from",
    "start": "307520",
    "end": "310960"
  },
  {
    "text": "the AWS sdks what you see on the slide",
    "start": "310960",
    "end": "314280"
  },
  {
    "text": "here is an example of the top portion of",
    "start": "314280",
    "end": "316919"
  },
  {
    "text": "a model for the secrets manager service",
    "start": "316919",
    "end": "319120"
  },
  {
    "text": "that I've pulled from the bodic cor",
    "start": "319120",
    "end": "320880"
  },
  {
    "text": "python",
    "start": "320880",
    "end": "322199"
  },
  {
    "text": "library now these models are important",
    "start": "322199",
    "end": "325000"
  },
  {
    "text": "because they contain basically all the",
    "start": "325000",
    "end": "327280"
  },
  {
    "text": "information that we need in order to",
    "start": "327280",
    "end": "328919"
  },
  {
    "text": "start inter ING with the AWS API when it",
    "start": "328919",
    "end": "332280"
  },
  {
    "text": "comes to things like undocumented apis",
    "start": "332280",
    "end": "335199"
  },
  {
    "text": "finding these models is basically half",
    "start": "335199",
    "end": "337800"
  },
  {
    "text": "the",
    "start": "337800",
    "end": "338919"
  },
  {
    "text": "battle now there's a lot of important",
    "start": "338919",
    "end": "341360"
  },
  {
    "text": "information here for our purposes today",
    "start": "341360",
    "end": "343520"
  },
  {
    "text": "by far the most important part is",
    "start": "343520",
    "end": "345560"
  },
  {
    "text": "something called the",
    "start": "345560",
    "end": "347639"
  },
  {
    "text": "protocol uh the protocol of an adus API",
    "start": "347639",
    "end": "350880"
  },
  {
    "text": "is the format by which we will serialize",
    "start": "350880",
    "end": "353520"
  },
  {
    "text": "our requests on the client so they can",
    "start": "353520",
    "end": "355479"
  },
  {
    "text": "be properly deserialized on the server",
    "start": "355479",
    "end": "358280"
  },
  {
    "text": "as you can see here secrets manager uses",
    "start": "358280",
    "end": "360199"
  },
  {
    "text": "the Json protocol specifically Json",
    "start": "360199",
    "end": "362479"
  },
  {
    "text": "version",
    "start": "362479",
    "end": "363639"
  },
  {
    "text": "1.1 there are six total protocols that",
    "start": "363639",
    "end": "366680"
  },
  {
    "text": "are currently in use by the ads API and",
    "start": "366680",
    "end": "369520"
  },
  {
    "text": "again these are simply the format for",
    "start": "369520",
    "end": "371919"
  },
  {
    "text": "our requests so to continue our secrets",
    "start": "371919",
    "end": "374560"
  },
  {
    "text": "manager example because I know that it",
    "start": "374560",
    "end": "376880"
  },
  {
    "text": "uses Json version 1.1 that tells me that",
    "start": "376880",
    "end": "379599"
  },
  {
    "text": "it'll always be a post request it'll",
    "start": "379599",
    "end": "381759"
  },
  {
    "text": "always go to the base path not like/ API",
    "start": "381759",
    "end": "384599"
  },
  {
    "text": "or anything like that I know that it",
    "start": "384599",
    "end": "386360"
  },
  {
    "text": "will send its content as Json I know",
    "start": "386360",
    "end": "388680"
  },
  {
    "text": "there'll be an Amazon Target header",
    "start": "388680",
    "end": "390639"
  },
  {
    "text": "which is made up of terms from the model",
    "start": "390639",
    "end": "393000"
  },
  {
    "text": "as well as for our purposes the most",
    "start": "393000",
    "end": "395120"
  },
  {
    "text": "important part the content type header",
    "start": "395120",
    "end": "397759"
  },
  {
    "text": "specifically to specific to the Json",
    "start": "397759",
    "end": "400080"
  },
  {
    "text": "family of protocols the content type",
    "start": "400080",
    "end": "402720"
  },
  {
    "text": "header is the version of Json that is",
    "start": "402720",
    "end": "405599"
  },
  {
    "text": "used and this takes us to our first",
    "start": "405599",
    "end": "407960"
  },
  {
    "text": "potential for cloud trail bypass because",
    "start": "407960",
    "end": "410560"
  },
  {
    "text": "the Adis API uses this very rigid",
    "start": "410560",
    "end": "413560"
  },
  {
    "text": "well-defined structure for its formats",
    "start": "413560",
    "end": "416560"
  },
  {
    "text": "what happens if we were to start",
    "start": "416560",
    "end": "418280"
  },
  {
    "text": "mutating our request or maling our",
    "start": "418280",
    "end": "421280"
  },
  {
    "text": "inputs could we cause the Eds API to",
    "start": "421280",
    "end": "424120"
  },
  {
    "text": "behave in such a way that is",
    "start": "424120",
    "end": "425879"
  },
  {
    "text": "advantageous to an attacker well an",
    "start": "425879",
    "end": "428919"
  },
  {
    "text": "interesting place to get started with",
    "start": "428919",
    "end": "430199"
  },
  {
    "text": "this is simply if there's two versions",
    "start": "430199",
    "end": "432440"
  },
  {
    "text": "of the Json API what happens if I send",
    "start": "432440",
    "end": "435280"
  },
  {
    "text": "the wrong version to a particular API",
    "start": "435280",
    "end": "437479"
  },
  {
    "text": "endpoint for instance sending a 1.0",
    "start": "437479",
    "end": "440440"
  },
  {
    "text": "header to a 1.1 API well as it turns out",
    "start": "440440",
    "end": "444680"
  },
  {
    "text": "we got some interesting Behavior",
    "start": "444680",
    "end": "446960"
  },
  {
    "text": "depending on if an identity did or did",
    "start": "446960",
    "end": "449520"
  },
  {
    "text": "not have permission to perform a certain",
    "start": "449520",
    "end": "451400"
  },
  {
    "text": "API operation you would get back a",
    "start": "451400",
    "end": "453560"
  },
  {
    "text": "different HTTP Response Code if it did",
    "start": "453560",
    "end": "456599"
  },
  {
    "text": "have permission to perform that",
    "start": "456599",
    "end": "457720"
  },
  {
    "text": "operation you get back a 404 and if it",
    "start": "457720",
    "end": "460080"
  },
  {
    "text": "did not you would get back a 403 and",
    "start": "460080",
    "end": "463039"
  },
  {
    "text": "critical to all of this because we are",
    "start": "463039",
    "end": "465000"
  },
  {
    "text": "Mal forming our input none of it got",
    "start": "465000",
    "end": "468159"
  },
  {
    "text": "logged to cloud trail and so it was",
    "start": "468159",
    "end": "470520"
  },
  {
    "text": "through this method that an adversary",
    "start": "470520",
    "end": "472120"
  },
  {
    "text": "could steal imem credentials and by",
    "start": "472120",
    "end": "474599"
  },
  {
    "text": "changing a single character in a header",
    "start": "474599",
    "end": "476960"
  },
  {
    "text": "enumerate whether or not they could",
    "start": "476960",
    "end": "478560"
  },
  {
    "text": "perform an AP operation completely",
    "start": "478560",
    "end": "481039"
  },
  {
    "text": "silently avoiding cloud trail and at the",
    "start": "481039",
    "end": "483759"
  },
  {
    "text": "time this affected over 645 actions",
    "start": "483759",
    "end": "486800"
  },
  {
    "text": "across over 40",
    "start": "486800",
    "end": "489120"
  },
  {
    "text": "Services now for a real world",
    "start": "489120",
    "end": "491120"
  },
  {
    "text": "perspective on how we would use this",
    "start": "491120",
    "end": "492919"
  },
  {
    "text": "it's important to note that for",
    "start": "492919",
    "end": "494120"
  },
  {
    "text": "adversaries who have gained a foothold",
    "start": "494120",
    "end": "495759"
  },
  {
    "text": "in an 80s account they often have no way",
    "start": "495759",
    "end": "498159"
  },
  {
    "text": "of knowing what level of privilege",
    "start": "498159",
    "end": "499800"
  },
  {
    "text": "they've just compromised the keys that",
    "start": "499800",
    "end": "502000"
  },
  {
    "text": "they found could belong to the root user",
    "start": "502000",
    "end": "504080"
  },
  {
    "text": "and thus have access to everything in",
    "start": "504080",
    "end": "505800"
  },
  {
    "text": "that adabas account or they could have",
    "start": "505800",
    "end": "508759"
  },
  {
    "text": "literally no privilege at all and so a",
    "start": "508759",
    "end": "511120"
  },
  {
    "text": "common method by which adversaries deal",
    "start": "511120",
    "end": "512760"
  },
  {
    "text": "with this situation is Brute Force try",
    "start": "512760",
    "end": "515159"
  },
  {
    "text": "and see what works if you perform an API",
    "start": "515159",
    "end": "517120"
  },
  {
    "text": "call and it succeeds you have that",
    "start": "517120",
    "end": "519159"
  },
  {
    "text": "permission if it fails then you don't",
    "start": "519159",
    "end": "522399"
  },
  {
    "text": "and there's even a handy tool to",
    "start": "522399",
    "end": "523760"
  },
  {
    "text": "automate this for you called enumerate",
    "start": "523760",
    "end": "525519"
  },
  {
    "text": "IM which allows you to very quickly",
    "start": "525519",
    "end": "527880"
  },
  {
    "text": "Brute Force what permissions you have",
    "start": "527880",
    "end": "530000"
  },
  {
    "text": "access to now the good news for",
    "start": "530000",
    "end": "532760"
  },
  {
    "text": "Defenders is that this behavior is",
    "start": "532760",
    "end": "534880"
  },
  {
    "text": "incredibly noisy and is fairly easy to",
    "start": "534880",
    "end": "537480"
  },
  {
    "text": "detect it presents itself as as a sudden",
    "start": "537480",
    "end": "540000"
  },
  {
    "text": "increase in access denied errors for a",
    "start": "540000",
    "end": "542000"
  },
  {
    "text": "particular Identity or it can also be",
    "start": "542000",
    "end": "544160"
  },
  {
    "text": "identified through a identity performing",
    "start": "544160",
    "end": "546959"
  },
  {
    "text": "API operations it has no history of ever",
    "start": "546959",
    "end": "549240"
  },
  {
    "text": "doing so which as a result this serves",
    "start": "549240",
    "end": "551600"
  },
  {
    "text": "as an amazing golden opportunity for",
    "start": "551600",
    "end": "553880"
  },
  {
    "text": "Defenders to detect suspicious behavior",
    "start": "553880",
    "end": "556200"
  },
  {
    "text": "and kick an adversary out of an",
    "start": "556200",
    "end": "558880"
  },
  {
    "text": "environment but if we change just a",
    "start": "558880",
    "end": "562160"
  },
  {
    "text": "single character in a header Defenders",
    "start": "562160",
    "end": "564959"
  },
  {
    "text": "now lose out on that golden opportunity",
    "start": "564959",
    "end": "568000"
  },
  {
    "text": "because none of our activity would show",
    "start": "568000",
    "end": "570079"
  },
  {
    "text": "up in cloud trail Defenders have no way",
    "start": "570079",
    "end": "571959"
  },
  {
    "text": "of knowing that this activity has",
    "start": "571959",
    "end": "573680"
  },
  {
    "text": "occurred and as a result an adversary",
    "start": "573680",
    "end": "575800"
  },
  {
    "text": "could enumerate permissions for hundreds",
    "start": "575800",
    "end": "577839"
  },
  {
    "text": "of actions over tens of services",
    "start": "577839",
    "end": "580320"
  },
  {
    "text": "completely silently if you're interested",
    "start": "580320",
    "end": "582880"
  },
  {
    "text": "in this topic I have a ton of additional",
    "start": "582880",
    "end": "585120"
  },
  {
    "text": "resources uh information and proof of",
    "start": "585120",
    "end": "587200"
  },
  {
    "text": "concept scripts at that URL there um for",
    "start": "587200",
    "end": "589600"
  },
  {
    "text": "its time this was an incredible way for",
    "start": "589600",
    "end": "592160"
  },
  {
    "text": "pentesters and red teamers to enumerate",
    "start": "592160",
    "end": "594399"
  },
  {
    "text": "permissions completely",
    "start": "594399",
    "end": "597160"
  },
  {
    "text": "silently next let's talk a little bit",
    "start": "597160",
    "end": "599320"
  },
  {
    "text": "about undocumented apis um undocumented",
    "start": "599320",
    "end": "602000"
  },
  {
    "text": "apis have been sort of a Hot Topic in",
    "start": "602000",
    "end": "603920"
  },
  {
    "text": "the AWS security research Community",
    "start": "603920",
    "end": "605600"
  },
  {
    "text": "lately as they have been they've led to",
    "start": "605600",
    "end": "607880"
  },
  {
    "text": "some fairly significant vulnerabilities",
    "start": "607880",
    "end": "609880"
  },
  {
    "text": "and the potential for platal bypass for",
    "start": "609880",
    "end": "612680"
  },
  {
    "text": "our purposes we'll Define an",
    "start": "612680",
    "end": "614160"
  },
  {
    "text": "undocumented API as an API that exists",
    "start": "614160",
    "end": "616519"
  },
  {
    "text": "within AWS that does not appear in the",
    "start": "616519",
    "end": "619040"
  },
  {
    "text": "public documentation or in the sdks Now",
    "start": "619040",
    "end": "622760"
  },
  {
    "text": "by that same notion the question becomes",
    "start": "622760",
    "end": "625320"
  },
  {
    "text": "how do we find undocumented",
    "start": "625320",
    "end": "628040"
  },
  {
    "text": "apis because they are undocumented",
    "start": "628040",
    "end": "631360"
  },
  {
    "text": "there's no single Source or way for us",
    "start": "631360",
    "end": "633760"
  },
  {
    "text": "to really find out about what apis AWS",
    "start": "633760",
    "end": "636320"
  },
  {
    "text": "might have",
    "start": "636320",
    "end": "637480"
  },
  {
    "text": "hidden uh personally the best way that I",
    "start": "637480",
    "end": "639920"
  },
  {
    "text": "have found has been to use the AWS",
    "start": "639920",
    "end": "642079"
  },
  {
    "text": "console in order for your browser to",
    "start": "642079",
    "end": "644560"
  },
  {
    "text": "know what all options it has how to",
    "start": "644560",
    "end": "646800"
  },
  {
    "text": "properly sign and format these requests",
    "start": "646800",
    "end": "649320"
  },
  {
    "text": "your browser needs to have those very",
    "start": "649320",
    "end": "651399"
  },
  {
    "text": "same models that we described previously",
    "start": "651399",
    "end": "653959"
  },
  {
    "text": "and as a result you can actually crawl",
    "start": "653959",
    "end": "655880"
  },
  {
    "text": "through the ads console and extract out",
    "start": "655880",
    "end": "658720"
  },
  {
    "text": "those models and interestingly the",
    "start": "658720",
    "end": "661320"
  },
  {
    "text": "models present within the Adis console",
    "start": "661320",
    "end": "663720"
  },
  {
    "text": "are not the same ones that appear in the",
    "start": "663720",
    "end": "666560"
  },
  {
    "text": "sdks they often include internal only",
    "start": "666560",
    "end": "669680"
  },
  {
    "text": "and undocumented apis so as an example",
    "start": "669680",
    "end": "673519"
  },
  {
    "text": "of this there is an undocumented API",
    "start": "673519",
    "end": "676160"
  },
  {
    "text": "called imem admin which is interesting",
    "start": "676160",
    "end": "678880"
  },
  {
    "text": "aside from the fact that its name isem",
    "start": "678880",
    "end": "681760"
  },
  {
    "text": "admin uh one of the neat things about it",
    "start": "681760",
    "end": "684440"
  },
  {
    "text": "is that the names of its operations",
    "start": "684440",
    "end": "686720"
  },
  {
    "text": "sound Vaguely Familiar to to the normal",
    "start": "686720",
    "end": "690160"
  },
  {
    "text": "IM ones but not quite so as an example",
    "start": "690160",
    "end": "693079"
  },
  {
    "text": "IM IM admin has an operation titled list",
    "start": "693079",
    "end": "695399"
  },
  {
    "text": "access keys for multiple users which",
    "start": "695399",
    "end": "697360"
  },
  {
    "text": "sounds Vaguely Familiar to imem list",
    "start": "697360",
    "end": "699959"
  },
  {
    "text": "access",
    "start": "699959",
    "end": "700920"
  },
  {
    "text": "Keys now again we can crawl the adus",
    "start": "700920",
    "end": "703360"
  },
  {
    "text": "console extract out through the",
    "start": "703360",
    "end": "704800"
  },
  {
    "text": "JavaScript to pull a list of all",
    "start": "704800",
    "end": "707040"
  },
  {
    "text": "possible operations that we can invoke",
    "start": "707040",
    "end": "709200"
  },
  {
    "text": "against this imem admin service now from",
    "start": "709200",
    "end": "712320"
  },
  {
    "text": "here a common technique used by security",
    "start": "712320",
    "end": "714720"
  },
  {
    "text": "researchers specializing in AWS is if",
    "start": "714720",
    "end": "717600"
  },
  {
    "text": "you find a sketchy AP I perform that API",
    "start": "717600",
    "end": "721079"
  },
  {
    "text": "call with a user or role who has no",
    "start": "721079",
    "end": "723600"
  },
  {
    "text": "permissions at all and the reason you do",
    "start": "723600",
    "end": "725920"
  },
  {
    "text": "this is because the relationship between",
    "start": "725920",
    "end": "728560"
  },
  {
    "text": "the API uh that you're invoking and what",
    "start": "728560",
    "end": "731560"
  },
  {
    "text": "actually gets called on the back end is",
    "start": "731560",
    "end": "733639"
  },
  {
    "text": "not always a one to one relationship so",
    "start": "733639",
    "end": "736360"
  },
  {
    "text": "as an example if we were to perform the",
    "start": "736360",
    "end": "738920"
  },
  {
    "text": "the I IM admin method list access keys",
    "start": "738920",
    "end": "741079"
  },
  {
    "text": "for multiple users and the resulting",
    "start": "741079",
    "end": "743240"
  },
  {
    "text": "error message we would get back the",
    "start": "743240",
    "end": "745480"
  },
  {
    "text": "quote user is not authorized to perform",
    "start": "745480",
    "end": "748519"
  },
  {
    "text": "I.E M list access keys and that is a",
    "start": "748519",
    "end": "752360"
  },
  {
    "text": "normal documented API so it's through",
    "start": "752360",
    "end": "756320"
  },
  {
    "text": "this method of using an undocumented API",
    "start": "756320",
    "end": "759160"
  },
  {
    "text": "essentially as a proxy that we can",
    "start": "759160",
    "end": "761560"
  },
  {
    "text": "invoke and get results from normal",
    "start": "761560",
    "end": "764040"
  },
  {
    "text": "documented ones like imem now if we",
    "start": "764040",
    "end": "767120"
  },
  {
    "text": "repeat that process for all of the",
    "start": "767120",
    "end": "769600"
  },
  {
    "text": "operations that we found in the previous",
    "start": "769600",
    "end": "771160"
  },
  {
    "text": "step we eventually create a map between",
    "start": "771160",
    "end": "774040"
  },
  {
    "text": "the undocumented I am admin methods and",
    "start": "774040",
    "end": "777519"
  },
  {
    "text": "the documented M",
    "start": "777519",
    "end": "780880"
  },
  {
    "text": "ones now the question here becomes what",
    "start": "780880",
    "end": "783920"
  },
  {
    "text": "does this look like in cloud trail does",
    "start": "783920",
    "end": "785839"
  },
  {
    "text": "it show up as I IM AB does it show up as",
    "start": "785839",
    "end": "788360"
  },
  {
    "text": "I am does it show up as",
    "start": "788360",
    "end": "791240"
  },
  {
    "text": "both Well turns out it showed up as",
    "start": "791240",
    "end": "795160"
  },
  {
    "text": "neither because it didn't show up at all",
    "start": "795160",
    "end": "798320"
  },
  {
    "text": "none of the invocations made against",
    "start": "798320",
    "end": "800360"
  },
  {
    "text": "theem admin service would show up in",
    "start": "800360",
    "end": "803120"
  },
  {
    "text": "cloud trail and so it's through this",
    "start": "803120",
    "end": "805240"
  },
  {
    "text": "method of using an undocumented API that",
    "start": "805240",
    "end": "808920"
  },
  {
    "text": "adversary could make calls to the IM",
    "start": "808920",
    "end": "810959"
  },
  {
    "text": "service completely silently and avoid",
    "start": "810959",
    "end": "813920"
  },
  {
    "text": "detection now the reason this matters is",
    "start": "813920",
    "end": "816360"
  },
  {
    "text": "again this is a commonly detected",
    "start": "816360",
    "end": "818480"
  },
  {
    "text": "Behavior a ton of commercial Sims have",
    "start": "818480",
    "end": "821360"
  },
  {
    "text": "out of thebox default detection rules",
    "start": "821360",
    "end": "824000"
  },
  {
    "text": "for suspicious calls to list access Keys",
    "start": "824000",
    "end": "826480"
  },
  {
    "text": "list groups and things like that and",
    "start": "826480",
    "end": "828760"
  },
  {
    "text": "even aw's own guard Duty which is a",
    "start": "828760",
    "end": "831079"
  },
  {
    "text": "managed threat detection service offered",
    "start": "831079",
    "end": "833000"
  },
  {
    "text": "by AWS has a detection rule for what",
    "start": "833000",
    "end": "835639"
  },
  {
    "text": "they refer to as anomalous Behavior",
    "start": "835639",
    "end": "837800"
  },
  {
    "text": "that's designed to pick up on this exact",
    "start": "837800",
    "end": "840000"
  },
  {
    "text": "Behavior but because none of this ends",
    "start": "840000",
    "end": "842880"
  },
  {
    "text": "up in cloud trail all these tools lose",
    "start": "842880",
    "end": "845120"
  },
  {
    "text": "out on the opportunity to see that this",
    "start": "845120",
    "end": "847079"
  },
  {
    "text": "Behavior has occurred and attackers can",
    "start": "847079",
    "end": "849160"
  },
  {
    "text": "operate with free",
    "start": "849160",
    "end": "850560"
  },
  {
    "text": "reign uh now this specific vulnerability",
    "start": "850560",
    "end": "853440"
  },
  {
    "text": "has since been fixed by ews anytime you",
    "start": "853440",
    "end": "855880"
  },
  {
    "text": "invoke imem admin the imem admin service",
    "start": "855880",
    "end": "859040"
  },
  {
    "text": "the equivalent IEM method shows up in",
    "start": "859040",
    "end": "861440"
  },
  {
    "text": "cloud trail but dear due to the sheer",
    "start": "861440",
    "end": "864399"
  },
  {
    "text": "number of thousands of undocumented apis",
    "start": "864399",
    "end": "867279"
  },
  {
    "text": "certainly makes you wonder what other",
    "start": "867279",
    "end": "869000"
  },
  {
    "text": "apis May behave in a similar",
    "start": "869000",
    "end": "871880"
  },
  {
    "text": "manner next let's talk a little bit",
    "start": "871880",
    "end": "873920"
  },
  {
    "text": "about nonproduction endpoints um I think",
    "start": "873920",
    "end": "876560"
  },
  {
    "text": "this is a fairly exciting field in ads",
    "start": "876560",
    "end": "879000"
  },
  {
    "text": "security research currently and is the",
    "start": "879000",
    "end": "880959"
  },
  {
    "text": "most likely to return future cloud trail",
    "start": "880959",
    "end": "882720"
  },
  {
    "text": "bypasses with relatively little effort",
    "start": "882720",
    "end": "885199"
  },
  {
    "text": "and we'll talk a little bit about why",
    "start": "885199",
    "end": "886440"
  },
  {
    "text": "that is in just a moment first a quick",
    "start": "886440",
    "end": "889279"
  },
  {
    "text": "recap on the structure of the endpoints",
    "start": "889279",
    "end": "892759"
  },
  {
    "text": "um typically when you interact with the",
    "start": "892759",
    "end": "894959"
  },
  {
    "text": "ads API the endpoint that you're",
    "start": "894959",
    "end": "897440"
  },
  {
    "text": "interacting with Will differ on a",
    "start": "897440",
    "end": "899560"
  },
  {
    "text": "service by service basis and a region by",
    "start": "899560",
    "end": "902440"
  },
  {
    "text": "region basis and typically the format",
    "start": "902440",
    "end": "905320"
  },
  {
    "text": "for that endpoint is service. region.",
    "start": "905320",
    "end": "909399"
  },
  {
    "text": "amazonaws.com it's not always the case",
    "start": "909399",
    "end": "912160"
  },
  {
    "text": "but in the vast majority of",
    "start": "912160",
    "end": "913320"
  },
  {
    "text": "circumstances that is the general format",
    "start": "913320",
    "end": "915040"
  },
  {
    "text": "that they use so to continue our secrets",
    "start": "915040",
    "end": "917480"
  },
  {
    "text": "manager example if you want to talk to",
    "start": "917480",
    "end": "919279"
  },
  {
    "text": "Secrets manager in the US east1 region",
    "start": "919279",
    "end": "922160"
  },
  {
    "text": "that would be the endpoint that you",
    "start": "922160",
    "end": "923279"
  },
  {
    "text": "would",
    "start": "923279",
    "end": "924079"
  },
  {
    "text": "use now this is an example of a",
    "start": "924079",
    "end": "927959"
  },
  {
    "text": "production endpoint this is what the CLI",
    "start": "927959",
    "end": "931079"
  },
  {
    "text": "SDK the console all use and what you're",
    "start": "931079",
    "end": "933920"
  },
  {
    "text": "expected to use it may surprise you to",
    "start": "933920",
    "end": "936440"
  },
  {
    "text": "know that there are thousands of",
    "start": "936440",
    "end": "938839"
  },
  {
    "text": "nonproduction endpoints that we may be",
    "start": "938839",
    "end": "941279"
  },
  {
    "text": "able to reach over the internet and we",
    "start": "941279",
    "end": "943360"
  },
  {
    "text": "may be able to authenticate against",
    "start": "943360",
    "end": "945399"
  },
  {
    "text": "using our normal AWS account now these",
    "start": "945399",
    "end": "949199"
  },
  {
    "text": "non-production endpoints exist for a",
    "start": "949199",
    "end": "951639"
  },
  {
    "text": "variety of reasons there are",
    "start": "951639",
    "end": "954000"
  },
  {
    "text": "pre-production environments uh Alpha",
    "start": "954000",
    "end": "956120"
  },
  {
    "text": "Beta gamma which is a part of the adus",
    "start": "956120",
    "end": "958079"
  },
  {
    "text": "deployment pip pipeline there's staging",
    "start": "958079",
    "end": "960600"
  },
  {
    "text": "preview builds uh Legacy alphabetical",
    "start": "960600",
    "end": "963839"
  },
  {
    "text": "ones and a pretty wide",
    "start": "963839",
    "end": "965959"
  },
  {
    "text": "variety now you may be wondering okay",
    "start": "965959",
    "end": "969199"
  },
  {
    "text": "there are these nonproduction endpoints",
    "start": "969199",
    "end": "970600"
  },
  {
    "text": "we can interact with but how do we",
    "start": "970600",
    "end": "972199"
  },
  {
    "text": "actually do so would we have to manually",
    "start": "972199",
    "end": "974279"
  },
  {
    "text": "sign our requests using sigv4 well as it",
    "start": "974279",
    "end": "977519"
  },
  {
    "text": "turns out the ad CLI can be a huge help",
    "start": "977519",
    "end": "980160"
  },
  {
    "text": "here as within the CLI there is a",
    "start": "980160",
    "end": "982800"
  },
  {
    "text": "built-in argument for endpoint URL",
    "start": "982800",
    "end": "985279"
  },
  {
    "text": "simply pass in the uh endpoint that",
    "start": "985279",
    "end": "987800"
  },
  {
    "text": "you're interested in inter acting with",
    "start": "987800",
    "end": "989040"
  },
  {
    "text": "then it'll work just about as well as",
    "start": "989040",
    "end": "990959"
  },
  {
    "text": "you'd expect now nonproduction endpoints",
    "start": "990959",
    "end": "993800"
  },
  {
    "text": "have a ton of interesting potential for",
    "start": "993800",
    "end": "996120"
  },
  {
    "text": "a wide variety of Defense evasion",
    "start": "996120",
    "end": "998000"
  },
  {
    "text": "purposes including outside of pure cloud",
    "start": "998000",
    "end": "1000319"
  },
  {
    "text": "trail bypasses to sort of get us started",
    "start": "1000319",
    "end": "1004040"
  },
  {
    "text": "here sort of introduce the topic I'd",
    "start": "1004040",
    "end": "1005839"
  },
  {
    "text": "like to introduce the base case of km- a",
    "start": "1005839",
    "end": "1009959"
  },
  {
    "text": "this is a non-production endpoint that",
    "start": "1009959",
    "end": "1012800"
  },
  {
    "text": "has access to production resources and",
    "start": "1012800",
    "end": "1015639"
  },
  {
    "text": "does report to cloud trail now what I",
    "start": "1015639",
    "end": "1017720"
  },
  {
    "text": "mean by that is is if you were to",
    "start": "1017720",
    "end": "1019519"
  },
  {
    "text": "interact with this endpoint you would",
    "start": "1019519",
    "end": "1021000"
  },
  {
    "text": "see all the the credentials and KMS keys",
    "start": "1021000",
    "end": "1023480"
  },
  {
    "text": "that you would normally see anything you",
    "start": "1023480",
    "end": "1025400"
  },
  {
    "text": "create modify or delete via that",
    "start": "1025400",
    "end": "1027558"
  },
  {
    "text": "endpoint will also carry over into the",
    "start": "1027559",
    "end": "1029880"
  },
  {
    "text": "production endpoint it'll appear in the",
    "start": "1029880",
    "end": "1031480"
  },
  {
    "text": "console and so on the reason I'm being",
    "start": "1031480",
    "end": "1034880"
  },
  {
    "text": "so specific that this is an example of a",
    "start": "1034880",
    "end": "1037079"
  },
  {
    "text": "nonproduction endpoint that has access",
    "start": "1037079",
    "end": "1039079"
  },
  {
    "text": "to production resources and does log to",
    "start": "1039079",
    "end": "1041079"
  },
  {
    "text": "cloud trail is because it's possible for",
    "start": "1041079",
    "end": "1043360"
  },
  {
    "text": "the inverse to be true there are",
    "start": "1043360",
    "end": "1046360"
  },
  {
    "text": "nonproduction endpoints that do not log",
    "start": "1046360",
    "end": "1048679"
  },
  {
    "text": "to cloud trail and do not have access to",
    "start": "1048679",
    "end": "1051400"
  },
  {
    "text": "production resources so to demonstrate",
    "start": "1051400",
    "end": "1053679"
  },
  {
    "text": "this we have a little bit of a test set",
    "start": "1053679",
    "end": "1054880"
  },
  {
    "text": "up uh here we're performing two adous",
    "start": "1054880",
    "end": "1057600"
  },
  {
    "text": "API calls uh first we're calling SNS",
    "start": "1057600",
    "end": "1060600"
  },
  {
    "text": "list topics in the US 2 region and you",
    "start": "1060600",
    "end": "1063559"
  },
  {
    "text": "see that there is a topic we get a",
    "start": "1063559",
    "end": "1065840"
  },
  {
    "text": "result because there is one we then",
    "start": "1065840",
    "end": "1068200"
  },
  {
    "text": "perform the exact same operation but",
    "start": "1068200",
    "end": "1071600"
  },
  {
    "text": "this time against the non-production",
    "start": "1071600",
    "end": "1073440"
  },
  {
    "text": "endpoint SNS D gamma and you see that we",
    "start": "1073440",
    "end": "1077640"
  },
  {
    "text": "don't get a result it's empty presumably",
    "start": "1077640",
    "end": "1080240"
  },
  {
    "text": "this is because that non-production",
    "start": "1080240",
    "end": "1081720"
  },
  {
    "text": "endpoint is in a siloed environment from",
    "start": "1081720",
    "end": "1084200"
  },
  {
    "text": "the production environment uh hopefully",
    "start": "1084200",
    "end": "1086360"
  },
  {
    "text": "in the same way that your uh hopefully",
    "start": "1086360",
    "end": "1088000"
  },
  {
    "text": "that your pre-pro environment doesn't",
    "start": "1088000",
    "end": "1089320"
  },
  {
    "text": "have access to your production database",
    "start": "1089320",
    "end": "1091799"
  },
  {
    "text": "now this is all a bit of a bummer",
    "start": "1091799",
    "end": "1093400"
  },
  {
    "text": "because that nonproduction inpoint",
    "start": "1093400",
    "end": "1095320"
  },
  {
    "text": "doesn't log to cloud trail and so if it",
    "start": "1095320",
    "end": "1097520"
  },
  {
    "text": "did have access to production resources",
    "start": "1097520",
    "end": "1099880"
  },
  {
    "text": "that'd be great we'd be able to interact",
    "start": "1099880",
    "end": "1101559"
  },
  {
    "text": "with the SNS service completely silently",
    "start": "1101559",
    "end": "1103600"
  },
  {
    "text": "create modifi delete things about as",
    "start": "1103600",
    "end": "1105240"
  },
  {
    "text": "easily as you'd",
    "start": "1105240",
    "end": "1106919"
  },
  {
    "text": "expect but",
    "start": "1106919",
    "end": "1109240"
  },
  {
    "text": "just because it doesn't have access to",
    "start": "1109240",
    "end": "1110919"
  },
  {
    "text": "production resources doesn't mean it's",
    "start": "1110919",
    "end": "1113240"
  },
  {
    "text": "completely worthless to us if you'll",
    "start": "1113240",
    "end": "1115960"
  },
  {
    "text": "notice we still got back a response it's",
    "start": "1115960",
    "end": "1119159"
  },
  {
    "text": "empty so we didn't get the resources but",
    "start": "1119159",
    "end": "1121520"
  },
  {
    "text": "we still got the the uh the successful",
    "start": "1121520",
    "end": "1125120"
  },
  {
    "text": "invocation somewhere along the line IEM",
    "start": "1125120",
    "end": "1128039"
  },
  {
    "text": "took a look at the permissions of the",
    "start": "1128039",
    "end": "1129640"
  },
  {
    "text": "identity performing this operation and",
    "start": "1129640",
    "end": "1131559"
  },
  {
    "text": "said yeah you're allowed to do this and",
    "start": "1131559",
    "end": "1133760"
  },
  {
    "text": "let it go through and crucially it",
    "start": "1133760",
    "end": "1136440"
  },
  {
    "text": "didn't appear in cloud trail we have one",
    "start": "1136440",
    "end": "1139039"
  },
  {
    "text": "event showing because we performed one",
    "start": "1139039",
    "end": "1140799"
  },
  {
    "text": "event totally normally it completely",
    "start": "1140799",
    "end": "1143200"
  },
  {
    "text": "misses the second one and so it's",
    "start": "1143200",
    "end": "1145440"
  },
  {
    "text": "through this method of using a",
    "start": "1145440",
    "end": "1147720"
  },
  {
    "text": "nonproduction endpoint very similar to",
    "start": "1147720",
    "end": "1150200"
  },
  {
    "text": "what I describ with protocol mutation",
    "start": "1150200",
    "end": "1152000"
  },
  {
    "text": "that we can silently enumerate",
    "start": "1152000",
    "end": "1153679"
  },
  {
    "text": "permissions while avoiding detection and",
    "start": "1153679",
    "end": "1156480"
  },
  {
    "text": "this raises the question if you're an",
    "start": "1156480",
    "end": "1158200"
  },
  {
    "text": "adversary who's just stolen IM IM",
    "start": "1158200",
    "end": "1159679"
  },
  {
    "text": "credentials and you're trying to figure",
    "start": "1159679",
    "end": "1160799"
  },
  {
    "text": "out what you have access to why would",
    "start": "1160799",
    "end": "1162440"
  },
  {
    "text": "you ever use the normal production",
    "start": "1162440",
    "end": "1164520"
  },
  {
    "text": "endpoints that are logged to cloud trail",
    "start": "1164520",
    "end": "1166480"
  },
  {
    "text": "and probably get you caught when you",
    "start": "1166480",
    "end": "1168520"
  },
  {
    "text": "might be able to take advantage of a",
    "start": "1168520",
    "end": "1170280"
  },
  {
    "text": "non-production in point that does not",
    "start": "1170280",
    "end": "1172159"
  },
  {
    "text": "log to cloud trail and get yourself the",
    "start": "1172159",
    "end": "1174280"
  },
  {
    "text": "exact same",
    "start": "1174280",
    "end": "1176280"
  },
  {
    "text": "information now uh for my pentest and",
    "start": "1176280",
    "end": "1179039"
  },
  {
    "text": "Red Team friends it's worth noting this",
    "start": "1179039",
    "end": "1181159"
  },
  {
    "text": "technique still works today not just for",
    "start": "1181159",
    "end": "1184280"
  },
  {
    "text": "this endpoint but for a variety of",
    "start": "1184280",
    "end": "1186080"
  },
  {
    "text": "endpoints across a variety of services I",
    "start": "1186080",
    "end": "1189159"
  },
  {
    "text": "did disclose this technique to AWS who",
    "start": "1189159",
    "end": "1191200"
  },
  {
    "text": "responded that they're not interested in",
    "start": "1191200",
    "end": "1192600"
  },
  {
    "text": "changing this Behavior right now which",
    "start": "1192600",
    "end": "1194360"
  },
  {
    "text": "as a result makes it fair game to abuse",
    "start": "1194360",
    "end": "1196640"
  },
  {
    "text": "and in a few weeks I intend to release a",
    "start": "1196640",
    "end": "1198000"
  },
  {
    "text": "Blog post with some additional details",
    "start": "1198000",
    "end": "1200200"
  },
  {
    "text": "along with the full data set of",
    "start": "1200200",
    "end": "1202760"
  },
  {
    "text": "nonproduction endpoints that behave this",
    "start": "1202760",
    "end": "1204559"
  },
  {
    "text": "way and their Associated",
    "start": "1204559",
    "end": "1207919"
  },
  {
    "text": "service um next another potential use",
    "start": "1207919",
    "end": "1210520"
  },
  {
    "text": "case for non-production endpoints is",
    "start": "1210520",
    "end": "1212240"
  },
  {
    "text": "something I've been Loosely referring to",
    "start": "1212240",
    "end": "1213960"
  },
  {
    "text": "as Event Source obfuscation and to be",
    "start": "1213960",
    "end": "1216799"
  },
  {
    "text": "clear this combination of behaviors is",
    "start": "1216799",
    "end": "1219360"
  },
  {
    "text": "certainly the most rare um but here's an",
    "start": "1219360",
    "end": "1222640"
  },
  {
    "text": "example of it working uh for our demo we",
    "start": "1222640",
    "end": "1225159"
  },
  {
    "text": "have a very similar setup to what we did",
    "start": "1225159",
    "end": "1226799"
  },
  {
    "text": "before we're performing two API calls",
    "start": "1226799",
    "end": "1229400"
  },
  {
    "text": "the first one is IVs list channels in",
    "start": "1229400",
    "end": "1231720"
  },
  {
    "text": "the AP Northeast one region and you see",
    "start": "1231720",
    "end": "1234159"
  },
  {
    "text": "we get a channel because there is one in",
    "start": "1234159",
    "end": "1235880"
  },
  {
    "text": "that region we then perform the exact",
    "start": "1235880",
    "end": "1238840"
  },
  {
    "text": "same API call a second time but this",
    "start": "1238840",
    "end": "1241360"
  },
  {
    "text": "time against the nonproduction endpoint",
    "start": "1241360",
    "end": "1244280"
  },
  {
    "text": "iv- gamma and you see we get back the",
    "start": "1244280",
    "end": "1247880"
  },
  {
    "text": "exact same result so presumably this",
    "start": "1247880",
    "end": "1251559"
  },
  {
    "text": "nonproduction endpoint has access to",
    "start": "1251559",
    "end": "1254559"
  },
  {
    "text": "production resources great what does it",
    "start": "1254559",
    "end": "1257679"
  },
  {
    "text": "look like in cloud trail well",
    "start": "1257679",
    "end": "1259640"
  },
  {
    "text": "unfortunately we see two events so yes",
    "start": "1259640",
    "end": "1262159"
  },
  {
    "text": "it does log to cloud trail but it does",
    "start": "1262159",
    "end": "1264200"
  },
  {
    "text": "so in sort of a weird way if you'll",
    "start": "1264200",
    "end": "1266559"
  },
  {
    "text": "notice the first invocation that we did",
    "start": "1266559",
    "end": "1269159"
  },
  {
    "text": "completely normally and occurred at the",
    "start": "1269159",
    "end": "1270720"
  },
  {
    "text": "19th 2nd has an event source of ibs.",
    "start": "1270720",
    "end": "1274120"
  },
  {
    "text": "Amazon aws.com now this is normal this",
    "start": "1274120",
    "end": "1277400"
  },
  {
    "text": "is exactly what we would expect from an",
    "start": "1277400",
    "end": "1279760"
  },
  {
    "text": "event source for a cloud trail event but",
    "start": "1279760",
    "end": "1282880"
  },
  {
    "text": "the second invocation the one that used",
    "start": "1282880",
    "end": "1285279"
  },
  {
    "text": "that non-production endpoint and",
    "start": "1285279",
    "end": "1286840"
  },
  {
    "text": "occurred at the 25th SE",
    "start": "1286840",
    "end": "1288799"
  },
  {
    "text": "has an event source of gamma-",
    "start": "1288799",
    "end": "1291799"
  },
  {
    "text": "starfruit now I don't know what gamma-",
    "start": "1291799",
    "end": "1294799"
  },
  {
    "text": "starfruit is I presume it's an internal",
    "start": "1294799",
    "end": "1297320"
  },
  {
    "text": "code name or service name something like",
    "start": "1297320",
    "end": "1299480"
  },
  {
    "text": "that and worth noting not all",
    "start": "1299480",
    "end": "1301559"
  },
  {
    "text": "nonproduction endpoints that have Event",
    "start": "1301559",
    "end": "1303520"
  },
  {
    "text": "Source Opus report an event source of",
    "start": "1303520",
    "end": "1306080"
  },
  {
    "text": "gamma- starfruit instead by far the more",
    "start": "1306080",
    "end": "1308360"
  },
  {
    "text": "common thing that I've seen is gamma-",
    "start": "1308360",
    "end": "1310520"
  },
  {
    "text": "service name but starf fruit is",
    "start": "1310520",
    "end": "1312480"
  },
  {
    "text": "certainly the most interesting now Event",
    "start": "1312480",
    "end": "1314960"
  },
  {
    "text": "Source obfuscation matters for two key",
    "start": "1314960",
    "end": "1316960"
  },
  {
    "text": "reasons the first is it's important to",
    "start": "1316960",
    "end": "1319240"
  },
  {
    "text": "note there are a ton of commercial Sims",
    "start": "1319240",
    "end": "1322200"
  },
  {
    "text": "that use the Event Source as a part of",
    "start": "1322200",
    "end": "1324240"
  },
  {
    "text": "their detection Rule and if there was a",
    "start": "1324240",
    "end": "1326760"
  },
  {
    "text": "detection rule for the IVs Service as an",
    "start": "1326760",
    "end": "1329320"
  },
  {
    "text": "example when that Sim goes to evaluate",
    "start": "1329320",
    "end": "1332279"
  },
  {
    "text": "that event against the rule it's going",
    "start": "1332279",
    "end": "1334400"
  },
  {
    "text": "to compare two strings and those strings",
    "start": "1334400",
    "end": "1335960"
  },
  {
    "text": "aren't going to match as a result you",
    "start": "1335960",
    "end": "1338120"
  },
  {
    "text": "can potentially evade detection from",
    "start": "1338120",
    "end": "1340039"
  },
  {
    "text": "things like Sims by using eventsource",
    "start": "1340039",
    "end": "1342679"
  },
  {
    "text": "obfuscation the second reason this",
    "start": "1342679",
    "end": "1344600"
  },
  {
    "text": "matters is for forensic scenarios it's",
    "start": "1344600",
    "end": "1347279"
  },
  {
    "text": "totally reasonable to want to pull all",
    "start": "1347279",
    "end": "1349039"
  },
  {
    "text": "the logs for an affected service during",
    "start": "1349039",
    "end": "1350919"
  },
  {
    "text": "a given time frame the way that you do",
    "start": "1350919",
    "end": "1353360"
  },
  {
    "text": "that is by the Event Source and if you",
    "start": "1353360",
    "end": "1356039"
  },
  {
    "text": "were to do that uh for this specific",
    "start": "1356039",
    "end": "1358480"
  },
  {
    "text": "example you would miss out on the event",
    "start": "1358480",
    "end": "1360720"
  },
  {
    "text": "that has the Event Source",
    "start": "1360720",
    "end": "1363120"
  },
  {
    "text": "opusc now uh the final uh potential use",
    "start": "1363120",
    "end": "1366679"
  },
  {
    "text": "case for non-production endpoints that",
    "start": "1366679",
    "end": "1368159"
  },
  {
    "text": "we'll be sharing today is there's a",
    "start": "1368159",
    "end": "1370320"
  },
  {
    "text": "combination that is I'm sure you",
    "start": "1370320",
    "end": "1371640"
  },
  {
    "text": "expected uh of having access to",
    "start": "1371640",
    "end": "1373880"
  },
  {
    "text": "production resource and does not log to",
    "start": "1373880",
    "end": "1376080"
  },
  {
    "text": "cloud trail and that's exactly what we",
    "start": "1376080",
    "end": "1377960"
  },
  {
    "text": "we saw was service catalog by changing",
    "start": "1377960",
    "end": "1380520"
  },
  {
    "text": "the endpoint we were interacting with we",
    "start": "1380520",
    "end": "1382919"
  },
  {
    "text": "would be able to both perform both read",
    "start": "1382919",
    "end": "1385440"
  },
  {
    "text": "and write operations to the service",
    "start": "1385440",
    "end": "1387159"
  },
  {
    "text": "catalog service completely silently",
    "start": "1387159",
    "end": "1389720"
  },
  {
    "text": "avoiding cloud trail now this is",
    "start": "1389720",
    "end": "1392760"
  },
  {
    "text": "especially concerning for a service like",
    "start": "1392760",
    "end": "1394960"
  },
  {
    "text": "service catalog whose entire purpose is",
    "start": "1394960",
    "end": "1397320"
  },
  {
    "text": "to be a Consolidated central location to",
    "start": "1397320",
    "end": "1399760"
  },
  {
    "text": "store your infrastructures code",
    "start": "1399760",
    "end": "1401120"
  },
  {
    "text": "templates that you can then deploy out",
    "start": "1401120",
    "end": "1402919"
  },
  {
    "text": "across your Enterprise imagine a",
    "start": "1402919",
    "end": "1404840"
  },
  {
    "text": "scenario in which an adversary has",
    "start": "1404840",
    "end": "1406480"
  },
  {
    "text": "gained a foothold in that account with",
    "start": "1406480",
    "end": "1408120"
  },
  {
    "text": "sufficient privilege they simply could",
    "start": "1408120",
    "end": "1409880"
  },
  {
    "text": "have changed the endpoint they were",
    "start": "1409880",
    "end": "1411240"
  },
  {
    "text": "interacting with and now they could",
    "start": "1411240",
    "end": "1412960"
  },
  {
    "text": "backo or modify those applications and",
    "start": "1412960",
    "end": "1415840"
  },
  {
    "text": "portfolios completely",
    "start": "1415840",
    "end": "1417919"
  },
  {
    "text": "silently as another example of this uh a",
    "start": "1417919",
    "end": "1421039"
  },
  {
    "text": "very similar finding for the event",
    "start": "1421039",
    "end": "1423000"
  },
  {
    "text": "Bridge service again changing the",
    "start": "1423000",
    "end": "1424919"
  },
  {
    "text": "endpoint we're interacting with we still",
    "start": "1424919",
    "end": "1426960"
  },
  {
    "text": "have access to all the production",
    "start": "1426960",
    "end": "1428480"
  },
  {
    "text": "resources that would normally exist but",
    "start": "1428480",
    "end": "1430360"
  },
  {
    "text": "now none of it gets logged to cloud",
    "start": "1430360",
    "end": "1433039"
  },
  {
    "text": "trail you're probably wondering cool how",
    "start": "1433039",
    "end": "1436200"
  },
  {
    "text": "do I find these nonproduction",
    "start": "1436200",
    "end": "1438919"
  },
  {
    "text": "endpoints um this is something that I",
    "start": "1438919",
    "end": "1441279"
  },
  {
    "text": "tackled uh myself I've tried a number of",
    "start": "1441279",
    "end": "1443520"
  },
  {
    "text": "things everything from just brute force",
    "start": "1443520",
    "end": "1446120"
  },
  {
    "text": "uh looking at subject alternative names",
    "start": "1446120",
    "end": "1447960"
  },
  {
    "text": "in tlss uh looking at passive DNS uh",
    "start": "1447960",
    "end": "1451320"
  },
  {
    "text": "asking AWS very nicely uh before",
    "start": "1451320",
    "end": "1454039"
  },
  {
    "text": "eventually settling on what I thought",
    "start": "1454039",
    "end": "1455840"
  },
  {
    "text": "was the best method which is using",
    "start": "1455840",
    "end": "1457600"
  },
  {
    "text": "certificate transparency logging um",
    "start": "1457600",
    "end": "1460000"
  },
  {
    "text": "there is an amazing open source tool",
    "start": "1460000",
    "end": "1462320"
  },
  {
    "text": "called sear spotter that allows you to",
    "start": "1462320",
    "end": "1464480"
  },
  {
    "text": "monitor specific domains and subdomains",
    "start": "1464480",
    "end": "1467480"
  },
  {
    "text": "and what I have set up is a ton of",
    "start": "1467480",
    "end": "1469480"
  },
  {
    "text": "automation that basically every time a",
    "start": "1469480",
    "end": "1471799"
  },
  {
    "text": "new CT is generated we check and see if",
    "start": "1471799",
    "end": "1474559"
  },
  {
    "text": "it does actually respond similar to how",
    "start": "1474559",
    "end": "1476520"
  },
  {
    "text": "an ads API responds and if it does try",
    "start": "1476520",
    "end": "1479120"
  },
  {
    "text": "and fingerprint what service It's",
    "start": "1479120",
    "end": "1481120"
  },
  {
    "text": "associated with and it's through this",
    "start": "1481120",
    "end": "1483520"
  },
  {
    "text": "automation that we still have running",
    "start": "1483520",
    "end": "1485399"
  },
  {
    "text": "every time it finds a new Cloud TR",
    "start": "1485399",
    "end": "1486799"
  },
  {
    "text": "bypass I hand it off to AWS so that it",
    "start": "1486799",
    "end": "1488559"
  },
  {
    "text": "can be fixed or if it finds another",
    "start": "1488559",
    "end": "1490279"
  },
  {
    "text": "endpoint we could use for permission",
    "start": "1490279",
    "end": "1491960"
  },
  {
    "text": "enumeration I add it to a little",
    "start": "1491960",
    "end": "1494520"
  },
  {
    "text": "database now uh that has been a look at",
    "start": "1494520",
    "end": "1497480"
  },
  {
    "text": "all the techniques we'll share publicly",
    "start": "1497480",
    "end": "1499120"
  },
  {
    "text": "today on ways to bypass cloud trail",
    "start": "1499120",
    "end": "1501960"
  },
  {
    "text": "there is still a ton of opportunity here",
    "start": "1501960",
    "end": "1504240"
  },
  {
    "text": "to find more ways and more services that",
    "start": "1504240",
    "end": "1506559"
  },
  {
    "text": "can be",
    "start": "1506559",
    "end": "1507440"
  },
  {
    "text": "affected for today's talk we took a look",
    "start": "1507440",
    "end": "1509960"
  },
  {
    "text": "at protocol mutation abusing the rigid",
    "start": "1509960",
    "end": "1512600"
  },
  {
    "text": "structure and format of the Adis API to",
    "start": "1512600",
    "end": "1515000"
  },
  {
    "text": "leak whether or not we had sufficient PR",
    "start": "1515000",
    "end": "1517159"
  },
  {
    "text": "privileges we took a look at",
    "start": "1517159",
    "end": "1519080"
  },
  {
    "text": "undocumented apis using them essentially",
    "start": "1519080",
    "end": "1521360"
  },
  {
    "text": "as a proxy to invoke a normal API",
    "start": "1521360",
    "end": "1523840"
  },
  {
    "text": "operation completely silently and then",
    "start": "1523840",
    "end": "1526320"
  },
  {
    "text": "we took a look at nonproduction end",
    "start": "1526320",
    "end": "1528120"
  },
  {
    "text": "points which offers a world of",
    "start": "1528120",
    "end": "1530000"
  },
  {
    "text": "opportunity for defense evasion but",
    "start": "1530000",
    "end": "1532039"
  },
  {
    "text": "specifically by changing a single",
    "start": "1532039",
    "end": "1534360"
  },
  {
    "text": "endpoint that we're interacting with we",
    "start": "1534360",
    "end": "1536080"
  },
  {
    "text": "could simply ignore cloud trail entirely",
    "start": "1536080",
    "end": "1539559"
  },
  {
    "text": "if you're a security researcher I",
    "start": "1539559",
    "end": "1541279"
  },
  {
    "text": "strongly encourage you to take a look at",
    "start": "1541279",
    "end": "1542520"
  },
  {
    "text": "some of these techniques so that you can",
    "start": "1542520",
    "end": "1543919"
  },
  {
    "text": "apply them to your own bypasses or",
    "start": "1543919",
    "end": "1545919"
  },
  {
    "text": "perhaps you'll find an entirely new way",
    "start": "1545919",
    "end": "1548039"
  },
  {
    "text": "to evade cloud trail and with that thank",
    "start": "1548039",
    "end": "1550279"
  },
  {
    "text": "you so much I'd be happy to answer any",
    "start": "1550279",
    "end": "1551520"
  },
  {
    "text": "questions the wrapup",
    "start": "1551520",
    "end": "1554240"
  },
  {
    "text": "room",
    "start": "1556679",
    "end": "1559679"
  }
]