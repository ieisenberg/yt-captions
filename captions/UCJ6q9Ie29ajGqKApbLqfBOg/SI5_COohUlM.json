[
  {
    "text": "hello everyone thank you for joining me today and welcome to my talk today I'm",
    "start": "2639",
    "end": "7680"
  },
  {
    "text": "going to share with you my journey of researching downgrade attacks on Windows and their severe implications on",
    "start": "7680",
    "end": "13320"
  },
  {
    "text": "windows's platform security my name is Alon and I'm a security researcher at safe Bri I'm 22",
    "start": "13320",
    "end": "20000"
  },
  {
    "text": "years old and M self thought my main focus reside in operating system internals reverse engineering and",
    "start": "20000",
    "end": "25920"
  },
  {
    "text": "vulnerability research and before joining the security field I was a Prof professor Brazilian jiu-jitsu athlete",
    "start": "25920",
    "end": "31840"
  },
  {
    "text": "where I won several world and European titles this is what I will be talking",
    "start": "31840",
    "end": "37320"
  },
  {
    "text": "about today we have a lot of interesting topics to cover so let's Jump Right In starting with the research",
    "start": "37320",
    "end": "44480"
  },
  {
    "text": "background so first things first what are downgrade attacks downgrade attack is the act of downgrading immune and",
    "start": "44480",
    "end": "51320"
  },
  {
    "text": "fully upto-date software to old and vulnerable software and this act allows an attacker to expose bu vulnerabilities",
    "start": "51320",
    "end": "57800"
  },
  {
    "text": "in updated software and then exploit such vulnerabilities my research first",
    "start": "57800",
    "end": "64000"
  },
  {
    "text": "started from studying the black L UI bootkits and what got to mind and everyone else's attention with black lus",
    "start": "64000",
    "end": "70360"
  },
  {
    "text": "was the fact that he was able to bypass secure boot on a fully updated Windows 11 but in fact Black Lotus did not",
    "start": "70360",
    "end": "77560"
  },
  {
    "text": "exploit a new zero day vulnerability instead it exploited already known and batch vulnerability and that was of",
    "start": "77560",
    "end": "84960"
  },
  {
    "text": "course done by employing a downgrade attack to give you a better",
    "start": "84960",
    "end": "90119"
  },
  {
    "text": "understanding of how black lotus's DW was formed to bypass secure boot you first need to know what is secure boot",
    "start": "90119",
    "end": "96079"
  },
  {
    "text": "so simply put secure boot is a feature security feature that is responsible to verify that each component in the boot",
    "start": "96079",
    "end": "102280"
  },
  {
    "text": "chain is digitally signed so it is very simple if you're not signed you're not loaded the days of loading a custom boot",
    "start": "102280",
    "end": "108479"
  },
  {
    "text": "kit by replacing the boot manager or gun instead what black L did was to",
    "start": "108479",
    "end": "114759"
  },
  {
    "text": "downgrade the windows W manager to signed but vulnerable version of it and this allowed to then exploit a all V",
    "start": "114759",
    "end": "121159"
  },
  {
    "text": "vulnerability sourced in the vulnerable boot manager to then bypass secure",
    "start": "121159",
    "end": "126920"
  },
  {
    "text": "boot Microsoft's mitigation against secure boot downgrades included multiple actions with the main one being revoking",
    "start": "126920",
    "end": "133760"
  },
  {
    "text": "vulnerable boot managers and boot applications and revoked images are of course not allowed to be",
    "start": "133760",
    "end": "140239"
  },
  {
    "text": "loaded But Here Comes the question are there any other components othered than",
    "start": "140239",
    "end": "145400"
  },
  {
    "text": "secure boot that may be vulnerable to dri attacks my goal in this research was to",
    "start": "145400",
    "end": "151160"
  },
  {
    "text": "evaluate the state of downgrade attacks in Windows and to find if components other than secure boot may have been",
    "start": "151160",
    "end": "158879"
  },
  {
    "text": "overlooked now I'm sure you're all familiar with bringer own vulnerable driver attacks targeting third party",
    "start": "158879",
    "end": "164239"
  },
  {
    "text": "drivers my vision was to Target first party entities not only drivers but even",
    "start": "164239",
    "end": "169599"
  },
  {
    "text": "entities residing in a lower level than the colonel itself my vision was to create a new category of bringer own",
    "start": "169599",
    "end": "176480"
  },
  {
    "text": "vulnerable Windows to keep kick off my research I first had to form a reliable downgrade",
    "start": "176480",
    "end": "183480"
  },
  {
    "text": "ability which led me to Define what would be considered a perfect downgrade attack so first the downgrade must be",
    "start": "183480",
    "end": "190440"
  },
  {
    "text": "fully undetectable so that edrs will not block the downgrade and thus I aimed to perform the downgrade in the most",
    "start": "190440",
    "end": "196400"
  },
  {
    "text": "legitimate way possible second the downgrade must be invisible and so the downgraded",
    "start": "196400",
    "end": "201840"
  },
  {
    "text": "components should appear up to date even if technically downgraded third the downgrade must be",
    "start": "201840",
    "end": "208560"
  },
  {
    "text": "persistent so that future the software updates are not overriding it and fourth the downgrade must be irreversible so",
    "start": "208560",
    "end": "215879"
  },
  {
    "text": "that scanning and repairing tools are not able to detect or repair the",
    "start": "215879",
    "end": "221120"
  },
  {
    "text": "downgrade having the downgrade requirements defined I then looked for suitable component but before I expose",
    "start": "221120",
    "end": "226879"
  },
  {
    "text": "the target component I want to ask you what what would be the least expected",
    "start": "226879",
    "end": "232000"
  },
  {
    "text": "entity to perform downgrades that would be of course",
    "start": "232000",
    "end": "237159"
  },
  {
    "text": "Windows updates so let's take a look at Windows updates and see if they can be abused to perform",
    "start": "237159",
    "end": "245280"
  },
  {
    "text": "downgrades the Windows update architecture is as follows we have an update client and an update server and",
    "start": "245319",
    "end": "250799"
  },
  {
    "text": "they communicate over com for those of you who are unfamiliar with com this is just an interpr communication method in",
    "start": "250799",
    "end": "256239"
  },
  {
    "text": "Windows and this is how the client and the server communicate administrator is usually forced on the client side and",
    "start": "256239",
    "end": "262040"
  },
  {
    "text": "trusted his Soler is always enforced on the server side now the last piece and the most important one in the windows",
    "start": "262040",
    "end": "268199"
  },
  {
    "text": "appit architecture is that plus once owned by Windows updates are only accessible to trusted installer so even",
    "start": "268199",
    "end": "275080"
  },
  {
    "text": "administrator or ENT system cannot direct directly modify these system files owned by trusted in",
    "start": "275080",
    "end": "282280"
  },
  {
    "text": "solar and this is where I found the first design problem in Windows updates administrator to trusted installer is",
    "start": "282280",
    "end": "288720"
  },
  {
    "text": "not considered a security boundary and there are multiple working public proof of concepts of such",
    "start": "288720",
    "end": "293880"
  },
  {
    "text": "elevation so the Windows update team attempted to secure the update process by enforcing trusted in solar",
    "start": "293880",
    "end": "300360"
  },
  {
    "text": "however since updates are only accessible to administrators trusted in solar is rendered completely",
    "start": "300360",
    "end": "306680"
  },
  {
    "text": "ineffective the only issue here is that administrators trusted in solar elevations are considered malicious and",
    "start": "306680",
    "end": "312759"
  },
  {
    "text": "blocked by edrs which of course contradicts my first downward principle which is being fully undetected now I",
    "start": "312759",
    "end": "319400"
  },
  {
    "text": "could of course try to bypass the elevation detection which may have been possible but then I would have to implement the dowr process myself which",
    "start": "319400",
    "end": "326600"
  },
  {
    "text": "could still be seen as malicious and so the best option for me was to find the flow in the update",
    "start": "326600",
    "end": "332400"
  },
  {
    "text": "process which solves all of those problems so let's take a look on a",
    "start": "332400",
    "end": "337759"
  },
  {
    "text": "simplified flow of the update process first the client ask the server to perform an update given an update folder",
    "start": "337759",
    "end": "344880"
  },
  {
    "text": "the update folder is supplied by the client second the server validates the",
    "start": "344880",
    "end": "350639"
  },
  {
    "text": "Integrity of the client supplied update folder third following the the verification the server operates on the",
    "start": "350639",
    "end": "357960"
  },
  {
    "text": "update folder to finalize the update files and these update files are saved to a server control folder one that is",
    "start": "357960",
    "end": "364160"
  },
  {
    "text": "not accessible to the client and so the client cannot at at this point directly modify these update",
    "start": "364160",
    "end": "370080"
  },
  {
    "text": "files fourth the server saves an action list to a server control folder as well not accessible to the client as well",
    "start": "370080",
    "end": "377080"
  },
  {
    "text": "this action list is named pending.xml and it contains the update actions to perform so for example it contains which",
    "start": "377080",
    "end": "383160"
  },
  {
    "text": "files the updates The Source destination fast Etc lastly when the operating system is",
    "start": "383160",
    "end": "389599"
  },
  {
    "text": "rebooted the update uh the action list uh is operated on and the update actions are performed during the",
    "start": "389599",
    "end": "397280"
  },
  {
    "text": "reboot now the client only controls the initial update folder and so I decided to look at this folder first and see",
    "start": "397280",
    "end": "403960"
  },
  {
    "text": "maybe I can modify it resulting in custom downgrading update files as we already know integr verifications are",
    "start": "403960",
    "end": "411400"
  },
  {
    "text": "are performed on the update folder so let's see how well they're",
    "start": "411400",
    "end": "417280"
  },
  {
    "text": "implemented the update folder contains contains update components and each update component contain a manifest M",
    "start": "417280",
    "end": "424280"
  },
  {
    "text": "differential and catalog files theand files are Microsoft update metadata and they contain metadata",
    "start": "424280",
    "end": "430919"
  },
  {
    "text": "information so component dependencies installation order Etc the Manifest files contain",
    "start": "430919",
    "end": "437520"
  },
  {
    "text": "installation specific information such as pa pa PS registry keys um which insts",
    "start": "437520",
    "end": "443120"
  },
  {
    "text": "to execut part of the insolation in more the differential files or Delta",
    "start": "443120",
    "end": "448599"
  },
  {
    "text": "files from the base files and so a base file plus a Delta file would result in the full update",
    "start": "448599",
    "end": "455840"
  },
  {
    "text": "file and lastly we have the catalog files which are the digital signatures of the m and manifest files so catalogs",
    "start": "455840",
    "end": "463599"
  },
  {
    "text": "allow signing multiple files at once instead of having the file that we want to sign embed its digital signature",
    "start": "463599",
    "end": "469120"
  },
  {
    "text": "inside of it in addition the catalog files are digitally signed themselves which makes it impossible to modify them",
    "start": "469120",
    "end": "476199"
  },
  {
    "text": "or the files that they sign so to recap only the catalog files are",
    "start": "476199",
    "end": "482120"
  },
  {
    "text": "digitally signed the Manifest and m files are not explicitly signed but they are signed in the catalog files the",
    "start": "482120",
    "end": "489080"
  },
  {
    "text": "differential files are not signed and the differential files also control the final update file content which is very",
    "start": "489080",
    "end": "495360"
  },
  {
    "text": "very interesting is there any chance that differential files were left behind in",
    "start": "495360",
    "end": "500840"
  },
  {
    "text": "terms of verification no luck because the expected update file hash is hardcoded",
    "start": "500840",
    "end": "507199"
  },
  {
    "text": "in the Manifest and again the man cannot be changed since it will break its signature in the",
    "start": "507199",
    "end": "514399"
  },
  {
    "text": "catalog at that point I decided to look at the action list I knew that I cannot change its contents directly because",
    "start": "514399",
    "end": "520959"
  },
  {
    "text": "because it is trusted in solar en Force but I also knew that the update process is performed over multiple reboots and",
    "start": "520959",
    "end": "526680"
  },
  {
    "text": "so I'm I assumed that the state of this list is saved somewhere and if I could modify the state maybe I could control",
    "start": "526680",
    "end": "532920"
  },
  {
    "text": "the update actions and so I then search the action paff in the registry and I found the",
    "start": "532920",
    "end": "539440"
  },
  {
    "text": "this very interesting key named pqxx CMD line it holds the executable that parces the least and the least PF and they then",
    "start": "539440",
    "end": "547240"
  },
  {
    "text": "looked at the security attributes of this key and I was extremely surprised to find that this key is not trusted",
    "start": "547240",
    "end": "553000"
  },
  {
    "text": "installer infor and this allowed me to control all of the update",
    "start": "553000",
    "end": "558640"
  },
  {
    "text": "actions this is how the action list looks like in practice it is an XML file that gives the functionality of creating",
    "start": "558640",
    "end": "564959"
  },
  {
    "text": "files deleting files moving files hardlinking files creating registeration values deleting keys and values and much",
    "start": "564959",
    "end": "571480"
  },
  {
    "text": "much more in order to downgrade we can use the hardlink file action and the source",
    "start": "571480",
    "end": "577440"
  },
  {
    "text": "will replace the destination to initiate an update all that is needed is to set the trusted in",
    "start": "577440",
    "end": "584440"
  },
  {
    "text": "solar Service as auto start and add the action list and this identifier in the registry the identifier is a dynamic",
    "start": "584440",
    "end": "591680"
  },
  {
    "text": "number which is compared with with the action list identifier so the identifier is needed for integrity purposes but",
    "start": "591680",
    "end": "597440"
  },
  {
    "text": "since we control both the identifier in the registry and in the action list we can just adjust them accordingly and the",
    "start": "597440",
    "end": "604600"
  },
  {
    "text": "most important thing is that none of these three actions is trusted in slaugher and forc and this allowed me to",
    "start": "604600",
    "end": "610920"
  },
  {
    "text": "update the system with the custom downgrading action list all of the integrative verifications are bypassed",
    "start": "610920",
    "end": "616880"
  },
  {
    "text": "since the action list is assumed verified as it is created post verification there is no need to reform",
    "start": "616880",
    "end": "623160"
  },
  {
    "text": "the malicious trusted in solar elevation instead Windows updates does all of the work for me and this is a complete",
    "start": "623160",
    "end": "629320"
  },
  {
    "text": "Windows update takeover revisiting the downgrade principles of course the downgrade is",
    "start": "629320",
    "end": "635639"
  },
  {
    "text": "fully undetectable there is no better way to downgrade Windows in terms of invisibility the",
    "start": "635639",
    "end": "641279"
  },
  {
    "text": "system will appear up to date after the attack as we basically update updated the system and we didn't uninstall",
    "start": "641279",
    "end": "648240"
  },
  {
    "text": "anything in terms of persistency of the downgraded component I found that the actually sper is not digitally signed",
    "start": "648240",
    "end": "655279"
  },
  {
    "text": "and so I patched it as part of the downgrade and as a result even after downgrades um even even after the",
    "start": "655279",
    "end": "662880"
  },
  {
    "text": "downgrade when new updates are available they will be falsely installed um so the patch version will basically ignore the",
    "start": "662880",
    "end": "668160"
  },
  {
    "text": "action list and install empty updates and in terms of recovery the",
    "start": "668160",
    "end": "673320"
  },
  {
    "text": "integrity and repair utility is not digitally signed as well so a pach it as well is part of the downgrade and the",
    "start": "673320",
    "end": "679200"
  },
  {
    "text": "patched version will no longer detect any Corruptions with that let's see the",
    "start": "679200",
    "end": "684920"
  },
  {
    "text": "first demo of the day this demo will demonstrates downgrading a colonel d driver named afd.sys to an old and",
    "start": "684920",
    "end": "691680"
  },
  {
    "text": "vulnerable version of it by using the Windows update cover and then we will see how the same kernel driver is",
    "start": "691680",
    "end": "697040"
  },
  {
    "text": "exploited to achieve kernel code execution so first of all we check the windows version and then we make sure",
    "start": "697040",
    "end": "703480"
  },
  {
    "text": "that we're fully up to date and that we have no missing updates which you can see we'll then use S Check utility to",
    "start": "703480",
    "end": "710000"
  },
  {
    "text": "check what is the current version of the driver that we are targeting which is afd dois and you can see that it is fully",
    "start": "710000",
    "end": "716440"
  },
  {
    "text": "updated with the version of 3672 and just to make make sure that it is fully updated let's try to exploit a",
    "start": "716440",
    "end": "721760"
  },
  {
    "text": "vulnerability sourced that was fixed and sourced in this driver this exploit gets a process ID and tries to elevate the",
    "start": "721760",
    "end": "728440"
  },
  {
    "text": "system by executing the kernel you can see that it failed and that is because the driver is patched so we'll now use Windows Down dat with a config file that",
    "start": "728440",
    "end": "735120"
  },
  {
    "text": "will say downgrade the afd C driver to its vulnerable version you can see the uh the",
    "start": "735120",
    "end": "742959"
  },
  {
    "text": "downgraded files all we need to do is to restart the machine in order for the update to take place we fast forward a",
    "start": "742959",
    "end": "748399"
  },
  {
    "text": "bit we log back into the machine and we'll launch CMD again now",
    "start": "748399",
    "end": "753560"
  },
  {
    "text": "we'll use S Check once more to see if the driver got updated because the update was performed",
    "start": "753560",
    "end": "760480"
  },
  {
    "text": "right and you can see that the driver is now in its base version which should be vulnerable to the vulnerability that we",
    "start": "760480",
    "end": "766399"
  },
  {
    "text": "tried to exploit before if we check who we are we're not currently system we'll try to exploit the vulnerability once",
    "start": "766399",
    "end": "771880"
  },
  {
    "text": "more we get the process ID of the current process and then we will execute the exploit you can see the exploit",
    "start": "771880",
    "end": "777639"
  },
  {
    "text": "succeeded and we are now empty of system now thank you",
    "start": "777639",
    "end": "784279"
  },
  {
    "text": "all if we check for updates just to make sure that everything looks correct you can see that we are still fully up to",
    "start": "784279",
    "end": "790560"
  },
  {
    "text": "date which is very very interesting so what did we achieve so",
    "start": "790560",
    "end": "797199"
  },
  {
    "text": "far we gained a perfect downgrade ability and we gained colel code execution our starting point was",
    "start": "797199",
    "end": "802720"
  },
  {
    "text": "administrator so that was an administrator to Kernel elevation now administrator to Kernel is not",
    "start": "802720",
    "end": "808320"
  },
  {
    "text": "considered a security monitor in Windows but getting kernel code execution is still a threat and of course it gives",
    "start": "808320",
    "end": "814720"
  },
  {
    "text": "much more functionality than administrator functionality although it is not a",
    "start": "814720",
    "end": "820320"
  },
  {
    "text": "boundary admin to Kernel is still a threat and the serious one because nowadays lots of users are still running",
    "start": "820320",
    "end": "826440"
  },
  {
    "text": "as administrators and running as administrator is the default on Windows and as a result many users could easily",
    "start": "826440",
    "end": "832519"
  },
  {
    "text": "compromise the kernel this is an issue that Microsoft aimed to",
    "start": "832519",
    "end": "837560"
  },
  {
    "text": "solve Microsoft solution was to De privilege the kernel to make kernel access less valuable than previously was",
    "start": "837560",
    "end": "845040"
  },
  {
    "text": "and this depr privileging was done by introducing a feature called virtualization based security or VBS in",
    "start": "845040",
    "end": "852320"
  },
  {
    "text": "short VBS so what is VBS first of all BBS is a secure and isolated virtual",
    "start": "852320",
    "end": "857920"
  },
  {
    "text": "environment powered by the hyperb hypervisor for the isolation and again the reason that VBS",
    "start": "857920",
    "end": "864560"
  },
  {
    "text": "was introduced is because the kernel is assumed compromised and can no longer be trusted there was a need for a secure",
    "start": "864560",
    "end": "870759"
  },
  {
    "text": "place to implement critical security features and store secret",
    "start": "870759",
    "end": "875959"
  },
  {
    "text": "Keys VBS features include the famous credential guard HCI system gr secure",
    "start": "876120",
    "end": "881199"
  },
  {
    "text": "launch um shielded VMS and much much more security features that really improved the security of Windows and now",
    "start": "881199",
    "end": "888399"
  },
  {
    "text": "that I have praised VBS so much you may wonder how all of this actually",
    "start": "888399",
    "end": "893440"
  },
  {
    "text": "works so before BBS this is how Windows architecture looked like we've had user mode in ring 3 we've had kernel mode in",
    "start": "893440",
    "end": "900160"
  },
  {
    "text": "ring zero and then we've had the hypervisor running in ring minus one and with BBs the hypervisor",
    "start": "900160",
    "end": "906480"
  },
  {
    "text": "introduces virtual trust levels or vtls and the higher the vtl the more",
    "start": "906480",
    "end": "911720"
  },
  {
    "text": "privileged it is so simply put vtls are like virtual machines lower vtls should not be able",
    "start": "911720",
    "end": "919160"
  },
  {
    "text": "to access memory or compromise higher vtls currently on Windows only two vtls",
    "start": "919160",
    "end": "925360"
  },
  {
    "text": "exist we have vtl Z known as normal mode and ptl1 known as secure",
    "start": "925360",
    "end": "931519"
  },
  {
    "text": "mode normal mode contains the original operating system and secure mode contains only the critical security",
    "start": "931519",
    "end": "937560"
  },
  {
    "text": "features and mitigations as well as key isolation Technologies and everything that is implemented in the secure mode",
    "start": "937560",
    "end": "943839"
  },
  {
    "text": "should not be compromised from the normal mode even if we talk about normal mode",
    "start": "943839",
    "end": "950000"
  },
  {
    "text": "scarel now when looking at security features and mitigations the first thing to do is of course to check if the",
    "start": "950199",
    "end": "956199"
  },
  {
    "text": "security features can be easily turned off I wondered if VBS features could be",
    "start": "956199",
    "end": "961240"
  },
  {
    "text": "easily turned off since they protect from administrator configuration modifiable by administrators would be",
    "start": "961240",
    "end": "968160"
  },
  {
    "text": "ineffective because then an attacker would just turn off VBS instead of dealing with it the way that VBS",
    "start": "968160",
    "end": "974600"
  },
  {
    "text": "protects such disablements is by implementing a feature called a UI look this u f look is basically a ufi",
    "start": "974600",
    "end": "982600"
  },
  {
    "text": "boot service variable that holds the BBS configuration if BBS is configured with the Lo the Lo is the source of",
    "start": "982600",
    "end": "988560"
  },
  {
    "text": "configuration duration instead of the Windows registry and then changing the registry will have no effect the u5",
    "start": "988560",
    "end": "995319"
  },
  {
    "text": "variable is the source of Truth and of course the boot service variable can only cannot be accessed in",
    "start": "995319",
    "end": "1002199"
  },
  {
    "text": "runtime from the operating system but only during boot so if you think about it this is a very simple and reliable",
    "start": "1002199",
    "end": "1010759"
  },
  {
    "text": "protection now if the user really wants to disable VBS he must load a custom EFI",
    "start": "1010800",
    "end": "1016759"
  },
  {
    "text": "application signed by Microsoft and this EFI would then ask the user during boot to physically approve the disablement",
    "start": "1016759",
    "end": "1023680"
  },
  {
    "text": "and only if the user approves then VBS is disabled now the key element here is",
    "start": "1023680",
    "end": "1028798"
  },
  {
    "text": "that all of this is performed during Boot and the Assumption here is that only signed code is allowed to run",
    "start": "1028799",
    "end": "1034160"
  },
  {
    "text": "because of secure boot the only signed code that touches the variable requires",
    "start": "1034160",
    "end": "1039720"
  },
  {
    "text": "physical approval so without physical access to the Target machine it should not be",
    "start": "1039720",
    "end": "1045678"
  },
  {
    "text": "possible to disable VBS with the ability to control any file on",
    "start": "1045679",
    "end": "1051280"
  },
  {
    "text": "the operating system I wondered what will happen if I try to replace the secure kernel or the hypervisor powering",
    "start": "1051280",
    "end": "1057320"
  },
  {
    "text": "VBS with invalid files so for examples files that are not digitally signed attacker controled files and I believed",
    "start": "1057320",
    "end": "1065080"
  },
  {
    "text": "that the result would be the machine booting into the recovery environment and that is because invalid files are a",
    "start": "1065080",
    "end": "1070480"
  },
  {
    "text": "sign of compromise instead I was extremely",
    "start": "1070480",
    "end": "1075760"
  },
  {
    "text": "surprised to find that if the operating system loader first to validate one of VBS as files it will just boot normally",
    "start": "1075760",
    "end": "1082320"
  },
  {
    "text": "abandoning VBS I repeat if the operating system loader fails to validate one of VBS as fil it will just put normally",
    "start": "1082320",
    "end": "1089919"
  },
  {
    "text": "abandoning VBS and this can be used to disable VBS by passing the U Phu as far as I know",
    "start": "1089919",
    "end": "1096679"
  },
  {
    "text": "this is the first bypass of bbs's UA Phu it's also a very simple one all we need to do is to replace the secure Cel or",
    "start": "1096679",
    "end": "1103240"
  },
  {
    "text": "the hypervisor with invalid fast and it will work now it is time for another demo of",
    "start": "1103240",
    "end": "1110280"
  },
  {
    "text": "chaining all the capabilities gain so far together in this demo I will show credential extraction against the most",
    "start": "1110280",
    "end": "1116440"
  },
  {
    "text": "restrictive settings and those settings will be PPL enabled for elas with UA follow protecting elas dumps well then",
    "start": "1116440",
    "end": "1123600"
  },
  {
    "text": "uh the the next setting will be credential guard enabled with UA F protecting secrets in vtl one and",
    "start": "1123600",
    "end": "1129919"
  },
  {
    "text": "Windows Defender up and running and the way that all of this will be bypassed is by first reverting the PPL fault patch",
    "start": "1129919",
    "end": "1136159"
  },
  {
    "text": "to allow PPL bypass second disabling credential guard by passing the UA F and third turning Windows Defender",
    "start": "1136159",
    "end": "1142440"
  },
  {
    "text": "unfunctional by invalidating the main Defender executable msmp engine now just before I show you the",
    "start": "1142440",
    "end": "1148760"
  },
  {
    "text": "demo it is important to understand that credential guard and PPL for LSS are complimentary if only credential guard",
    "start": "1148760",
    "end": "1155400"
  },
  {
    "text": "is bypassed elas cannot be dumped and if only PPL is bypassed credentials are",
    "start": "1155400",
    "end": "1161000"
  },
  {
    "text": "encrypted and not usable so this is what you will see if you try to dump secrets",
    "start": "1161000",
    "end": "1166520"
  },
  {
    "text": "with a credential guard with credential guard on as you can see the secrets are encrypted so let's see the demo of",
    "start": "1166520",
    "end": "1172559"
  },
  {
    "text": "bypassing credential guard PPL and Windows Defender Allin once by utilizing the downgrades and the u f loock",
    "start": "1172559",
    "end": "1180200"
  },
  {
    "text": "bypass so first we check the window Windows version and then we make sure that we are fully up to date and that we",
    "start": "1180400",
    "end": "1186200"
  },
  {
    "text": "have no missing updates as you can see we'll then launch SK Tool which is a",
    "start": "1186200",
    "end": "1191400"
  },
  {
    "text": "tool provided by Microsoft to see which VBS security features are running you can see VBS is uh protected with the UA",
    "start": "1191400",
    "end": "1197919"
  },
  {
    "text": "F and it is locked in ufi and also credential guard and key guard are currently running protecting Secrets",
    "start": "1197919",
    "end": "1204520"
  },
  {
    "text": "we'll now use system Informer to see what is the current state of elas you can see that elas is running its",
    "start": "1204520",
    "end": "1210120"
  },
  {
    "text": "PPL lastly we will try to copy malicious files outside of an exuded directory you",
    "start": "1210120",
    "end": "1215600"
  },
  {
    "text": "can see that it doesn't work because Windows Defender is up and running and we can't use these files so now it's",
    "start": "1215600",
    "end": "1221880"
  },
  {
    "text": "time to perform the downgrade and perform the attack we will use Windows Down dat and",
    "start": "1221880",
    "end": "1228200"
  },
  {
    "text": "we will apply it with a config file that will say downgrade the PPL fault patch",
    "start": "1228200",
    "end": "1233640"
  },
  {
    "text": "this bypass uh the U file Lo to disable VBS and turn Windows Defender",
    "start": "1233640",
    "end": "1239159"
  },
  {
    "text": "unfunctional tool is currently running you can see all of the files that is it",
    "start": "1239159",
    "end": "1244280"
  },
  {
    "text": "is going to downgrade all of the update files all we need to do is to restart the machine in order for the update to",
    "start": "1244280",
    "end": "1249320"
  },
  {
    "text": "take place restore the machine you can see that updates are",
    "start": "1249320",
    "end": "1254679"
  },
  {
    "text": "underway or should we say downgrades are underway we fast forward we log back into the",
    "start": "1254679",
    "end": "1260520"
  },
  {
    "text": "machine and now let's launch SK Tool again to see what is the current state of EBS should have been protected by UA",
    "start": "1260520",
    "end": "1267080"
  },
  {
    "text": "FOC let's see if it is still on and it is not the secure colel is not",
    "start": "1267080",
    "end": "1273000"
  },
  {
    "text": "running credential guard is not running as both so secrets are not protected in bt1 anymore let's use system Informer to",
    "start": "1273000",
    "end": "1279559"
  },
  {
    "text": "see what is the current state of elas we can see that elas is still running as SP so this is something that we really need",
    "start": "1279559",
    "end": "1284679"
  },
  {
    "text": "to bypass and if we check what is the state of Windows Defender we'll try to copy malicious files outside of the",
    "start": "1284679",
    "end": "1290279"
  },
  {
    "text": "exuded directory and you can see that the files are copied successfully and we can now use them in order to complete",
    "start": "1290279",
    "end": "1296080"
  },
  {
    "text": "the attack so we'll now try to uh bypass PPL",
    "start": "1296080",
    "end": "1301480"
  },
  {
    "text": "by using the PPL fault PPL bypass we'll get the uh process ID of Els and we will",
    "start": "1301480",
    "end": "1307360"
  },
  {
    "text": "execute it with PPL fault and PPL fault should have been patched in this system let's see if it is still",
    "start": "1307360",
    "end": "1315919"
  },
  {
    "text": "patched so the tool is running and you can see that it worked successfully and the dam file was created in the dam",
    "start": "1317080",
    "end": "1325320"
  },
  {
    "text": "folder if you now use mimik cats to try to extract credentials from this down",
    "start": "1325320",
    "end": "1330799"
  },
  {
    "text": "file we'll use the Logan passwords command and credentials are extracted these credentials should have been",
    "start": "1330799",
    "end": "1336440"
  },
  {
    "text": "protected by credential guard you can see that they are not encrypted now lastly just to make sure that everything",
    "start": "1336440",
    "end": "1342880"
  },
  {
    "text": "is uh working as expected we will check for updates we will see if Windows suspect anything",
    "start": "1342880",
    "end": "1350360"
  },
  {
    "text": "and it does not thank you very",
    "start": "1350520",
    "end": "1358360"
  },
  {
    "text": "much okay so we bypass the U FS we defeated VBS we disabled it but now it's",
    "start": "1360679",
    "end": "1366799"
  },
  {
    "text": "time to talk about real security boundaries the security boundaries that VBS introduces are any vtl 0 to vtl 1",
    "start": "1366799",
    "end": "1373799"
  },
  {
    "text": "transition is considered as an elevation of privilege no vtl Zer code should be able to compromise vl1",
    "start": "1373799",
    "end": "1379760"
  },
  {
    "text": "code and another boundary is ring three or ring zero to ring minus one so any user mode or kernel to hypervisor is",
    "start": "1379760",
    "end": "1386120"
  },
  {
    "text": "considered an elevation of prision as well due to the way that VBS is implemented compromising the hypervisor",
    "start": "1386120",
    "end": "1392200"
  },
  {
    "text": "gives complete control over all of the btls when looking at VBS downgrades my",
    "start": "1392200",
    "end": "1399039"
  },
  {
    "text": "main goal was to understand if there was a downgrade mitigation such as versioning checks or revocation",
    "start": "1399039",
    "end": "1404559"
  },
  {
    "text": "mechanism if no dowr mitigation was found regardless of of how far I could",
    "start": "1404559",
    "end": "1409919"
  },
  {
    "text": "go with the downgrade I considered this as a vulnerability and that is because when new vulnerabilities will get",
    "start": "1409919",
    "end": "1415880"
  },
  {
    "text": "patched in the Target component it will make the exploitation much easier and even if not immediately",
    "start": "1415880",
    "end": "1423679"
  },
  {
    "text": "immediately exploitable it is trly something that needs to get fixed so firstly I targeted secure modes",
    "start": "1423679",
    "end": "1431480"
  },
  {
    "text": "isolated user mode processes and the most known one is credential guard and so I decided to Target it credential",
    "start": "1431480",
    "end": "1437799"
  },
  {
    "text": "guard is implemented mented as an isolated user mode process named LSC ISO which stands for LSA isolated with",
    "start": "1437799",
    "end": "1444159"
  },
  {
    "text": "credential guard running secrets are stored in LSC ISO in vl1 instead of in the original elas process and this is",
    "start": "1444159",
    "end": "1451000"
  },
  {
    "text": "why dumping elas is no longer valuable because elas only contains the encrypted blobs and the real secrets are not",
    "start": "1451000",
    "end": "1457600"
  },
  {
    "text": "accessible to any VT zero code as you saw before I decided to Target the downgrade",
    "start": "1457600",
    "end": "1463840"
  },
  {
    "text": "with CV 2022 3479 which is a fixed elevation of privilege in credential guard I found",
    "start": "1463840",
    "end": "1470640"
  },
  {
    "text": "both the vulnerable module which is Curly insured and the vulnerable version of it and downgrading the vulnerable",
    "start": "1470640",
    "end": "1476039"
  },
  {
    "text": "module using the Windows update cover worked well on a fully patched machine and this allowed to escalate",
    "start": "1476039",
    "end": "1482760"
  },
  {
    "text": "privileges from ring 3 vtl 0 to ring 3 BTL 1 compromising credential guard and",
    "start": "1482760",
    "end": "1488279"
  },
  {
    "text": "all of the secrets it protects there was no downgrade detection on BTL one isolated user",
    "start": "1488279",
    "end": "1495440"
  },
  {
    "text": "mode now isolated user mode privileges are great but I wanted to gain even higher privileges so I then moved on to",
    "start": "1495480",
    "end": "1501919"
  },
  {
    "text": "Target the secure modes kernel which is more privileged than the isolated user",
    "start": "1501919",
    "end": "1507600"
  },
  {
    "text": "mode the kernel of secure mode is called secure kernel and it is a minimal kernel",
    "start": "1507600",
    "end": "1512880"
  },
  {
    "text": "minimal kernel that only implements the critical security features such as hbci hyper gard and",
    "start": "1512880",
    "end": "1518960"
  },
  {
    "text": "more I decided to Target this downgrade with CV 20121 27090 which is a fixed",
    "start": "1518960",
    "end": "1524919"
  },
  {
    "text": "elevation of privilege in Secure kernel the vol vulnerable module here could only be the secure kernel itself but in",
    "start": "1524919",
    "end": "1532000"
  },
  {
    "text": "this case downgrading only the secure kernel did not work for me and it didn't work I've had to downgrade dependency",
    "start": "1532000",
    "end": "1538880"
  },
  {
    "text": "modules as well and only then it worked on a fully patched machine and this allowed escalating privileges from ring",
    "start": "1538880",
    "end": "1545279"
  },
  {
    "text": "three from ring 3 vl0 to ring0 vtl 1 compromising the entire vtl and any of",
    "start": "1545279",
    "end": "1551399"
  },
  {
    "text": "the mitigations that it implements including HCI hyper guard and more and there was no dowr mitigation on vl1",
    "start": "1551399",
    "end": "1559120"
  },
  {
    "text": "secure kernel either now secure kernel privileges are",
    "start": "1559120",
    "end": "1564320"
  },
  {
    "text": "awesome but I wanted to gain even higher privileges so I then moved on to Target the most privileged entity of VBS which",
    "start": "1564320",
    "end": "1571559"
  },
  {
    "text": "is the hyperv hypervisor the hypervisor is hbx on nle",
    "start": "1571559",
    "end": "1576840"
  },
  {
    "text": "system on Nal systems and hbx on MD systems and the hypervisor is a standalone microc kernel which makes it",
    "start": "1576840",
    "end": "1583159"
  },
  {
    "text": "a valuable Target for downgrade with the hypervisor though it",
    "start": "1583159",
    "end": "1588440"
  },
  {
    "text": "was more challenging to Target a specific vulnerability that is because many vulnerabilities titled hyperv",
    "start": "1588440",
    "end": "1594279"
  },
  {
    "text": "elevation or privilege um were fixed over the last few years but hyperv is a very large component and in CB",
    "start": "1594279",
    "end": "1601399"
  },
  {
    "text": "descriptions Microsoft do not share which component in the hyperv stock is the vulnerable one so it could be an",
    "start": "1601399",
    "end": "1607039"
  },
  {
    "text": "elevated user REM process it could be um a kernel driver or it could be the hypervisor itself which is the only",
    "start": "1607039",
    "end": "1613440"
  },
  {
    "text": "component that I'm targeting Doug rning uh so so I decided",
    "start": "1613440",
    "end": "1618720"
  },
  {
    "text": "to go two years backward to prove the vulnerability and two years is old enough to be confident that there was at",
    "start": "1618720",
    "end": "1624520"
  },
  {
    "text": "least one hypervisor elevation of privilege vulnerability in uh unfixed in the old",
    "start": "1624520",
    "end": "1630080"
  },
  {
    "text": "hypervisor ding the hypervisor and the hypervisor loader worked well and the cross boundary here was Ring 3 btl0 to",
    "start": "1630080",
    "end": "1637559"
  },
  {
    "text": "ring minus one potentially compromising the entire virtualization stack this rendered the entire",
    "start": "1637559",
    "end": "1644159"
  },
  {
    "text": "realization stack vulnerable to downgrade attacks so let's see a quick demo of the",
    "start": "1644159",
    "end": "1649760"
  },
  {
    "text": "hypervisor downgrade so first of all we check the windows version as usual and we make",
    "start": "1649760",
    "end": "1655559"
  },
  {
    "text": "sure that we're fully up to date we'll check for updates you can see",
    "start": "1655559",
    "end": "1661080"
  },
  {
    "text": "that we are fully up to date we have no missing updates we'll then use SK Tool this time we want to see what is the current state of the hypervisor you can",
    "start": "1661080",
    "end": "1667480"
  },
  {
    "text": "see that the Microsoft hypervisor has been detected current version is 22621 you can also see that VBS is",
    "start": "1667480",
    "end": "1673600"
  },
  {
    "text": "running as usual we'll use Windows downed with the config file that will say downgrade a hypervisor to two years old",
    "start": "1673600",
    "end": "1679720"
  },
  {
    "text": "version to um finish the execute all we need to do is to Reser the machine for the update to take",
    "start": "1679720",
    "end": "1685880"
  },
  {
    "text": "place with fast forward a bit you will see that updates are currently",
    "start": "1685880",
    "end": "1691399"
  },
  {
    "text": "underway under the hood the hypervisor is currently downgraded we'll log back into the",
    "start": "1691399",
    "end": "1697440"
  },
  {
    "text": "machine and we launch SK Tool again let's see what is the version of",
    "start": "1697440",
    "end": "1702760"
  },
  {
    "text": "the hypervisor and if it has been down if it has been updated you can see that it has been downgraded to the version",
    "start": "1702760",
    "end": "1709600"
  },
  {
    "text": "22000 which is a based version of a two years old hypervisor you can also see that VBS features are running as usual",
    "start": "1709600",
    "end": "1715480"
  },
  {
    "text": "just with an old hypervisor if we check for updates you will see that we're still fully up to",
    "start": "1715480",
    "end": "1724240"
  },
  {
    "text": "date okay so overall I found no dowr mitigation in any component of the",
    "start": "1725760",
    "end": "1731640"
  },
  {
    "text": "virtualization stack the entire stack was found to be vulnerable to",
    "start": "1731640",
    "end": "1736880"
  },
  {
    "text": "downgrades now now let's talk about one last vulnerability that expose all of the attack vectors to unprivileged",
    "start": "1736880",
    "end": "1742279"
  },
  {
    "text": "attackers in certain scenarios so it all started with this windows at Old folder um which I came",
    "start": "1742279",
    "end": "1748880"
  },
  {
    "text": "across in some of my machines and looking at it and Googling it I found that this is the old Windows operating system and it is saved for restoration",
    "start": "1748880",
    "end": "1755519"
  },
  {
    "text": "purposes so when you install a quality update the old Windows operating system is saved to see Windows old and of course the first thing I did",
    "start": "1755519",
    "end": "1762799"
  },
  {
    "text": "was try to modify files inside windows old but I noticed that access lists are copied from the old operating system and",
    "start": "1762799",
    "end": "1769240"
  },
  {
    "text": "so it was impossible to temper with files that can not be previously tempered with the next thing I did was to check",
    "start": "1769240",
    "end": "1776360"
  },
  {
    "text": "for the window to check access for the windows. old folder itself they found that as an unprivileged user I have full",
    "start": "1776360",
    "end": "1782600"
  },
  {
    "text": "access to this folder and so the exploitation strategy is very straightforward here first",
    "start": "1782600",
    "end": "1788159"
  },
  {
    "text": "renaming the original Windows old folder to any name and then creating an attacker controlled windows at all folder and the attacko Control operating",
    "start": "1788159",
    "end": "1795279"
  },
  {
    "text": "system will be used in case uh of update res restoration so in the restoration scenario triggered by administrator the",
    "start": "1795279",
    "end": "1802080"
  },
  {
    "text": "attacker controlled operating system will be used instead of the backup operating system so this is another way to perform the same downgrades from an",
    "start": "1802080",
    "end": "1808480"
  },
  {
    "text": "unprivileged user in a restoration scenario closing remarks let's talk",
    "start": "1808480",
    "end": "1814559"
  },
  {
    "text": "about the disclosure process the next steps and takeaways starting from the disclosure",
    "start": "1814559",
    "end": "1820640"
  },
  {
    "text": "process we're responsibly uh disclosed everything and we notified Microsoft of our research findings in February 2024",
    "start": "1820640",
    "end": "1826720"
  },
  {
    "text": "Microsoft issued CV 2024 21302 this is Microsoft's official",
    "start": "1826720",
    "end": "1832960"
  },
  {
    "text": "response to our research and I would like to thank Microsoft here for the great cooperation and effort on these",
    "start": "1832960",
    "end": "1840279"
  },
  {
    "text": "cases now for those of you who want to further research the topic that we explore today here are some of the",
    "start": "1840440",
    "end": "1846080"
  },
  {
    "text": "things that I recommend looking at first and foremost the critical question still arises are there additional Windows",
    "start": "1846080",
    "end": "1852919"
  },
  {
    "text": "features vulnerable to downgrade attacks so far both secure Boot and the",
    "start": "1852919",
    "end": "1858000"
  },
  {
    "text": "possession stock was found vulnerable do you have in mind additional critical features that you think may be",
    "start": "1858000",
    "end": "1863919"
  },
  {
    "text": "vulnerable to downgrades another interesting feature introduced not too long ago is Linux",
    "start": "1863919",
    "end": "1869799"
  },
  {
    "text": "virtualization based security and this is a game changer for Linux security would the same design",
    "start": "1869799",
    "end": "1875919"
  },
  {
    "text": "issues exist in the Linux implementation lastly other any other",
    "start": "1875919",
    "end": "1881080"
  },
  {
    "text": "operating systems that such as Mac OS or Linux that may be vulnerable to downgrades make the same implications on",
    "start": "1881080",
    "end": "1887679"
  },
  {
    "text": "those operating systems be similar to the windows",
    "start": "1887679",
    "end": "1892559"
  },
  {
    "text": "implications so what are the takeaways of this St first the cyber security industry should raise its awareness of",
    "start": "1893559",
    "end": "1900360"
  },
  {
    "text": "always downgrade attacks and the danger that they pose I found no mitigation",
    "start": "1900360",
    "end": "1905440"
  },
  {
    "text": "preventing the downgrade of critical operating system components suggesting that downgrades were not a focal point",
    "start": "1905440",
    "end": "1911720"
  },
  {
    "text": "perior to my research the significant implications of This research emphasize the danger posed by dowr",
    "start": "1911720",
    "end": "1918639"
  },
  {
    "text": "and again while Windows is currently affected could Mac OS or Linux be next we need to address these questions",
    "start": "1918639",
    "end": "1924519"
  },
  {
    "text": "before real attackers do second design should always be",
    "start": "1924519",
    "end": "1930039"
  },
  {
    "text": "reviewed and regarded as a relevant attack surface the downgrade attack on the fertilization stack was possible due",
    "start": "1930039",
    "end": "1935960"
  },
  {
    "text": "to a design flow that permits less privileged vtls or rings to update components living in more privileged VTS",
    "start": "1935960",
    "end": "1942159"
  },
  {
    "text": "or rings so while VBS has became popular",
    "start": "1942159",
    "end": "1947200"
  },
  {
    "text": "among security researchers in recent years with some really great research papers in the subject this downg attack",
    "start": "1947200",
    "end": "1953159"
  },
  {
    "text": "surface has existed since the beginning of VBS when VBS when Microsoft first announced it few years ago this",
    "start": "1953159",
    "end": "1959799"
  },
  {
    "text": "indicates that this that the design was probably not thoroughly examined third in the wild attacks",
    "start": "1959799",
    "end": "1967720"
  },
  {
    "text": "should always be thoroughly examined and expended upon whenever possible with the black L of Fifi boot kit employing",
    "start": "1967720",
    "end": "1974240"
  },
  {
    "text": "downgrade attacks we realized that the concept of downgrade attacks was right under under our noses although a year has passed it",
    "start": "1974240",
    "end": "1981519"
  },
  {
    "text": "seems that this time we were able to study and expand upon dward attacks before attackers did so we expend the",
    "start": "1981519",
    "end": "1986919"
  },
  {
    "text": "securable downgrades to the viralization stack but this is not always guaranteed emphasizing the importance of studying",
    "start": "1986919",
    "end": "1993039"
  },
  {
    "text": "in the wild attacks and always considering what other components or areas may also be affected by an",
    "start": "1993039",
    "end": "2000320"
  },
  {
    "text": "attack before we wrap everything up I would like to credit these talented people for their work",
    "start": "2000320",
    "end": "2008960"
  },
  {
    "text": "it was a pleasure for me to share with you my journey of researching dowr attacks on Windows and there are severe implications on Windows as platform",
    "start": "2009760",
    "end": "2016840"
  },
  {
    "text": "security using the findings that are revealed today you can bring back to life thousands of old and fixed",
    "start": "2016840",
    "end": "2022919"
  },
  {
    "text": "vulnerabilities windows down dat essentially makes the term fully patched meaningless across any Windows machine",
    "start": "2022919",
    "end": "2029360"
  },
  {
    "text": "worldwide if you have any questions please catch me in the wrap-up room and feel free to reach out on social media",
    "start": "2029360",
    "end": "2035480"
  },
  {
    "text": "and with that I would like to thank you all for joining me today and have a great day",
    "start": "2035480",
    "end": "2041919"
  }
]