[
  {
    "text": "welcome to flying a false-flag advanced si to trust conflicts and domain",
    "start": "30",
    "end": "5670"
  },
  {
    "text": "takeover we're in the Jasmine room and the speaker is Nick Landers a couple of",
    "start": "5670",
    "end": "10920"
  },
  {
    "text": "notes before we begin stop by the business hall located in Mandalay Bay Oceanside and shoreline ballrooms on",
    "start": "10920",
    "end": "18000"
  },
  {
    "text": "level 2 during the day and for the Welcome Reception at 5:30 tonight the blackhat Arsenal who's in the business",
    "start": "18000",
    "end": "24600"
  },
  {
    "text": "hall in level 2 also join us for the pony Awards in lagoon JKL at 6:30 p.m. please put your cell phones",
    "start": "24600",
    "end": "33780"
  },
  {
    "text": "on silent make sure that you're not disturbing your neighbors and if you",
    "start": "33780",
    "end": "40379"
  },
  {
    "text": "have questions at the end please make sure that you use the microphones that are located on either side here and here",
    "start": "40379",
    "end": "45980"
  },
  {
    "text": "with that I want to go ahead and invite Nick up to the stage thank you thanks thank you guys that was",
    "start": "45980",
    "end": "62039"
  },
  {
    "text": "really nice hahaha so it's my first black hat talk you'll have to forgive me for any nervousness but first I want to",
    "start": "62039",
    "end": "69150"
  },
  {
    "text": "start by introducing myself so classic bio page some might recognize me from Twitter I have the scared looking out or",
    "start": "69150",
    "end": "76890"
  },
  {
    "text": "whatever emotion it's showing I'm a technical lead at silent break security you can find us up at the front row in",
    "start": "76890",
    "end": "82799"
  },
  {
    "text": "black I do primarily research and development offensive operations with",
    "start": "82799",
    "end": "88350"
  },
  {
    "text": "the focus I do a lot of consulting as well so this presentation is really gonna be centered around you know the",
    "start": "88350",
    "end": "93630"
  },
  {
    "text": "offensive applications of c2 and sort of taking that a little bit further than it has before",
    "start": "93630",
    "end": "98869"
  },
  {
    "text": "some might recognize our dark side ops training which we give at blackhat every year or the shellcode RTI project or Red",
    "start": "98869",
    "end": "105210"
  },
  {
    "text": "Team toolkit so I'll start with a quick agenda we'll begin with some c2",
    "start": "105210",
    "end": "110759"
  },
  {
    "text": "methodology and channels concepts so we're just gonna kind of get everybody caught up to you know what do I mean",
    "start": "110759",
    "end": "116250"
  },
  {
    "text": "when I say command and control and where are we at now following that we'll tackle some trust",
    "start": "116250",
    "end": "121320"
  },
  {
    "text": "conflicts and discuss that and then cloud abuse and take over so the death of the IP sort of the transition that",
    "start": "121320",
    "end": "127530"
  },
  {
    "text": "we're making into that realm and then we'll close up some final thoughts and hopefully some questions if I can talk fast enough so",
    "start": "127530",
    "end": "133590"
  },
  {
    "text": "first command and control and at heart I'm actually a software developer",
    "start": "133590",
    "end": "139080"
  },
  {
    "text": "I don't like fixing code or debugging it much so that's why I write malware instead of software but in a software",
    "start": "139080",
    "end": "145800"
  },
  {
    "text": "model the concepts of command and control exists you know and have existed for a really long time you have a client",
    "start": "145800",
    "end": "152220"
  },
  {
    "text": "and a server with some channel between them and usually a perimeter boundary that you're crossing so part of that",
    "start": "152220",
    "end": "157519"
  },
  {
    "text": "includes channel selection the redundancy of the server endpoints they might worry about obfuscation to protect",
    "start": "157519",
    "end": "163739"
  },
  {
    "text": "IP or serialization encryption and the trust of the server itself now what's interesting is we often times feel",
    "start": "163739",
    "end": "169799"
  },
  {
    "text": "isolated in our realm but all of these problems are not unique to malware either we struggle with the same qualities we have to worry about",
    "start": "169799",
    "end": "176340"
  },
  {
    "text": "serialization and encryption and Trust so you can effectively think of an implant or a military jargon as a",
    "start": "176340",
    "end": "182040"
  },
  {
    "text": "listening post or LPS you'll hear me refer to it as as a client and server there's really really no difference",
    "start": "182040",
    "end": "187560"
  },
  {
    "text": "between them and before I go any further I want to also define what I mean when I talk about c2 it's a broad concept and",
    "start": "187560",
    "end": "194099"
  },
  {
    "text": "its fans everything - everything from you know the agent and the commands you execute the functionality it has and the",
    "start": "194099",
    "end": "200430"
  },
  {
    "text": "transits that you use but generally when I talk about c2 I'm talking about three primary layers where you're taking some",
    "start": "200430",
    "end": "206400"
  },
  {
    "text": "binary data transiting across a network boundary and then deserializing it on the far side and further I think we can",
    "start": "206400",
    "end": "213599"
  },
  {
    "text": "break this down into two larger concepts one is c2 is a technique which is a",
    "start": "213599",
    "end": "218639"
  },
  {
    "text": "strategy of execution so that's like any other strategy we have you know a particular methodology we apply to our",
    "start": "218639",
    "end": "224549"
  },
  {
    "text": "c2 the second one is the channel so that's the medium that we work across that could be TCP or UDP we'll talk",
    "start": "224549",
    "end": "230160"
  },
  {
    "text": "about a bunch of them throughout the slides and to start I want to begin with a technique so this is our strategy and",
    "start": "230160",
    "end": "235889"
  },
  {
    "text": "this covers a lot of concepts I'm gonna diagram this out on sort of an implant a",
    "start": "235889",
    "end": "241049"
  },
  {
    "text": "naught and LP relationship and first we'll talk about orientation so when we",
    "start": "241049",
    "end": "247200"
  },
  {
    "text": "think about c2 we can think about a reverse shell or a bind shell as it's commonly referred to where the operator is connecting back into the implant",
    "start": "247200",
    "end": "253380"
  },
  {
    "text": "those both have to do with the strategy of our c2 in practice this looks like port knocking web shells buying shells",
    "start": "253380",
    "end": "260419"
  },
  {
    "text": "you know all of the classic I compromised a web server and I'm sending it a command in real time",
    "start": "260419",
    "end": "266389"
  },
  {
    "text": "is extremely efficient and it has benefits with attribution because when we are a client we can obfuscate our",
    "start": "266389",
    "end": "272120"
  },
  {
    "text": "true identity a little bit easier than we can with a server it's a bit conditional though you can't always use",
    "start": "272120",
    "end": "277460"
  },
  {
    "text": "things like you know web shells on assessments where there's gnat or firewall rules enabled so usually we",
    "start": "277460",
    "end": "283129"
  },
  {
    "text": "resort to the opposite where it's a reverse shell and we have to deal with things like intervals so you know the",
    "start": "283129",
    "end": "288169"
  },
  {
    "text": "beaconing process that an agent might do or alternatively the classic you know shell in quotes term where we open up a",
    "start": "288169",
    "end": "294590"
  },
  {
    "text": "socket and we transit data back and forth over the same socket beaconing is very traditional particularly in red",
    "start": "294590",
    "end": "301430"
  },
  {
    "text": "teaming we have stuff like cobalt strike where you have an interval time that decides how quickly you can take actions",
    "start": "301430",
    "end": "307219"
  },
  {
    "text": "so I like to call this concept action delay the nice part about beaconing is it's simple and consistent so it's",
    "start": "307219",
    "end": "313759"
  },
  {
    "text": "really easy to code and we always have an expectation for when an agent is gonna call back to us we obviously have the disadvantage of it being inefficient",
    "start": "313759",
    "end": "320360"
  },
  {
    "text": "and we get dry beacons that aren't doing anything so the agent is just checking in with us and we're always making this trade-off between setting a really short",
    "start": "320360",
    "end": "326990"
  },
  {
    "text": "beginning time to reduce action delay or setting a really long beaconing time to improve stealth a slight alternative",
    "start": "326990",
    "end": "334009"
  },
  {
    "text": "this would be something like long polling which you don't necessarily see all that often in Offensive malware this",
    "start": "334009",
    "end": "339080"
  },
  {
    "text": "is where you sort of blend the responsiveness of classic beaconing system with the stealth of you know sort",
    "start": "339080",
    "end": "345560"
  },
  {
    "text": "of long-term beaconing so a connection is made from a victim to a server and the server doesn't have to reply",
    "start": "345560",
    "end": "350629"
  },
  {
    "text": "immediately this concept is applied to web all the time we simply hold the thread open for some period of time and",
    "start": "350629",
    "end": "355939"
  },
  {
    "text": "serve tasks back down when the operator decides to actually type them in assuming we reached some you know 30",
    "start": "355939",
    "end": "361879"
  },
  {
    "text": "second or 45 second interval we're probably gonna let the connection reset anyways this is also because",
    "start": "361879",
    "end": "367069"
  },
  {
    "text": "gateways who might man in the middle of the connection would cause us issues in this situation distribution is another",
    "start": "367069",
    "end": "373129"
  },
  {
    "text": "quality for anybody to set up Red Team infrastructure you're working with you know usually multiple servers with some",
    "start": "373129",
    "end": "378529"
  },
  {
    "text": "sort of round-robin system and you usually have a failover system so if domains can't be accessed because of",
    "start": "378529",
    "end": "383629"
  },
  {
    "text": "perimeter controls or they can't be accessed because of you buying a cheap VPS which we've had happen plenty of",
    "start": "383629",
    "end": "389089"
  },
  {
    "text": "times hopefully you have at least one connection that's successful then the last concept is routing which introduces",
    "start": "389089",
    "end": "395360"
  },
  {
    "text": "some really complex strategies one being you pushing traffic through if there and your orientation maintains that an",
    "start": "395360",
    "end": "402220"
  },
  {
    "text": "implant is shoveling data to a listening post you can also blend this with distribution and this is the classic Red",
    "start": "402220",
    "end": "407860"
  },
  {
    "text": "Team set up where we have Bastion hosts we're not interested in loading our tools onto lots of servers on the web we",
    "start": "407860",
    "end": "413470"
  },
  {
    "text": "load them onto a single server and a back-end and we distribute bastions across the web to collect traffic you can invert",
    "start": "413470",
    "end": "419560"
  },
  {
    "text": "this same strategy blending sort of that orientation and routing piece to get sort of what I like to call a dead drop",
    "start": "419560",
    "end": "426370"
  },
  {
    "text": "system this is where you have some third-party application and there's a client agent checking for tasking",
    "start": "426370",
    "end": "432370"
  },
  {
    "text": "against that third party and then attacker can plant callback data into that service and the agent can pull it",
    "start": "432370",
    "end": "438670"
  },
  {
    "text": "back and push results so this improves our stealth wildly obviously the third party becomes the only thing that most",
    "start": "438670",
    "end": "445210"
  },
  {
    "text": "defenders would see in terms of perimeter defenses but it also introduces a lot of complexity for our",
    "start": "445210",
    "end": "450820"
  },
  {
    "text": "code and an action delay that's at least n times - in terms of you know what a traditional requests round trip would be",
    "start": "450820",
    "end": "457240"
  },
  {
    "text": "to that third party cuz we have to place data there and then have another agent coming to retrieve data from there all right so abstract stuff out of the",
    "start": "457240",
    "end": "463990"
  },
  {
    "text": "way let's get to sort of the second half of our formula and talk about some basic channels and some of the popular ones for anybody who's familiar with maybe",
    "start": "463990",
    "end": "470830"
  },
  {
    "text": "modern malware samples sockets are still surprisingly popular which is funny because I don't think red teamers use",
    "start": "470830",
    "end": "476830"
  },
  {
    "text": "them all that often they're responsive and simple which have huge advantages for us and you can imagine in this scenario you know an implant is just",
    "start": "476830",
    "end": "483010"
  },
  {
    "text": "posting back some host data to a server we might add encryption to that help improve the stealth or the track ability",
    "start": "483010",
    "end": "489490"
  },
  {
    "text": "we also might add ssl a bit unnecessarily considering we just added encryption but we might do this to blend",
    "start": "489490",
    "end": "496060"
  },
  {
    "text": "in with other protocols that use SSL as well we could also add chunking to reduce the total volume of any single",
    "start": "496060",
    "end": "501610"
  },
  {
    "text": "request at the end of the day though any observer will one probably look at the destination of the traffic and assess",
    "start": "501610",
    "end": "507640"
  },
  {
    "text": "the fact that that destination either isn't trusted or is unknown - they could look at the protocol or other words lack",
    "start": "507640",
    "end": "513940"
  },
  {
    "text": "thereof and say well this traffic is interested because it's unknown in terms of you know the style or the actual",
    "start": "513940",
    "end": "520360"
  },
  {
    "text": "content two or three would be the volume so in total regardless of how many requests we send can this be detected",
    "start": "520360",
    "end": "527290"
  },
  {
    "text": "this is common in like detecting DNS traffic DNS traffic is super stealthy until you need to get volume out of it",
    "start": "527290",
    "end": "533170"
  },
  {
    "text": "it falls apart because DNS just isn't good at carrying large volume and the lastly would be parameter controls so",
    "start": "533170",
    "end": "539230"
  },
  {
    "text": "you know our implants might not be able to communicate or a defender might set up a perimeter control that blocks a particular port or protocol and port",
    "start": "539230",
    "end": "545649"
  },
  {
    "text": "combination from this we can start to extract attacker priorities when we when it comes to c2 so the first one is trust",
    "start": "545649",
    "end": "552190"
  },
  {
    "text": "and we talked about this a lot usually we're referring to trust repositories where we look at categorization or black",
    "start": "552190",
    "end": "557980"
  },
  {
    "text": "lists we want to avoid being blacklisted while being categorized as as good as we can there also takeover primitives and",
    "start": "557980",
    "end": "564339"
  },
  {
    "text": "piggybacking that come and play here so if we can piggyback off of traffic or domains that are already trusted then we",
    "start": "564339",
    "end": "569860"
  },
  {
    "text": "don't have to gain that trust ourselves which is pretty big to would be our content so we are interested in making our content match what's expected for a",
    "start": "569860",
    "end": "576639"
  },
  {
    "text": "particular traffic signature this is like the character set the frequency the pure volume of that and lastly the",
    "start": "576639",
    "end": "582550"
  },
  {
    "text": "vector so the protocol the port and there are these like abstraction details that start to occur on top of that you",
    "start": "582550",
    "end": "588459"
  },
  {
    "text": "think of like DNS over HTTP that's technically HTTP traffic but now we have an entirely new protocol being",
    "start": "588459",
    "end": "594339"
  },
  {
    "text": "implemented on top of it it's almost like an entirely new layer to our model we also have orientation structure and",
    "start": "594339",
    "end": "600430"
  },
  {
    "text": "then just the limitations of you know what that particular method looks like so we might not be able to pack data",
    "start": "600430",
    "end": "606459"
  },
  {
    "text": "past a certain size you might have to encode it in a specific way and it's with this that Comp Sci strikes back and",
    "start": "606459",
    "end": "613120"
  },
  {
    "text": "we return to the OSI model which I've gone ahead and taken the bottom two layers off and we start to think about",
    "start": "613120",
    "end": "618190"
  },
  {
    "text": "how defenses are implemented against this model whereby there's coverage against any particular you know",
    "start": "618190",
    "end": "623410"
  },
  {
    "text": "horizontal set of this model so if you don't have a layer seven firewall you're not getting any insight and anything",
    "start": "623410",
    "end": "628449"
  },
  {
    "text": "passed TCP traffic there's also a vertical piece to this as well where you can think of you having insight into TCP",
    "start": "628449",
    "end": "635529"
  },
  {
    "text": "and UDP but you allowing ICMP completely those technically exist at the same layer but your layer seven firewall",
    "start": "635529",
    "end": "641620"
  },
  {
    "text": "doesn't mean anything if it can't analyze a particular layer beneath it and then like I said I think there's",
    "start": "641620",
    "end": "646899"
  },
  {
    "text": "becoming this higher layer like a layer eight I played with an in cloud layer but I'm sure that the hub review boards",
    "start": "646899",
    "end": "652959"
  },
  {
    "text": "wouldn't go for that but it's these abstractions that are on top of protocols where like HTTP is being used to do all sorts of nonsense now so",
    "start": "652959",
    "end": "660550"
  },
  {
    "text": "breaking this down kind of diving into each of them HTTP super common in malicious tooling we usually have some",
    "start": "660550",
    "end": "666430"
  },
  {
    "text": "sort of Qwest where we're basics before encoding data it's extremely common at the perimeter which is great for us it's",
    "start": "666430",
    "end": "672790"
  },
  {
    "text": "layered on TCP which means we get great reliability it has complex dialect and usage this is probably something most",
    "start": "672790",
    "end": "678730"
  },
  {
    "text": "people don't think about the fact that encoded binary data or mass amounts of binary data that have been encoded is",
    "start": "678730",
    "end": "684490"
  },
  {
    "text": "not rare in HTTP that's extremely common HTTP is used for all sorts of stuff so we can blend in easily even if we look",
    "start": "684490",
    "end": "691149"
  },
  {
    "text": "really obscure it's also well supported in languages which as a developer is a huge piece for me one of the big reasons",
    "start": "691149",
    "end": "696430"
  },
  {
    "text": "people don't build the crazy c2 systems that you can think of in your head is because nobody wants to figure out how",
    "start": "696430",
    "end": "701560"
  },
  {
    "text": "to build an HTTP to library by themselves or a WebSockets integration so beefing this up we're trying to",
    "start": "701560",
    "end": "709209"
  },
  {
    "text": "masquerade our content a little more we'll probably switch the request to maybe a post request there are trade-offs here but we're interested in",
    "start": "709209",
    "end": "714730"
  },
  {
    "text": "maybe getting our callback data out of web blogs we might use sensitive domains like medical or banking domains to avoid",
    "start": "714730",
    "end": "721269"
  },
  {
    "text": "the fact that the domain would get logged at all or the traffic would get logged at all and we might embed ourselves in special headers like the",
    "start": "721269",
    "end": "726790"
  },
  {
    "text": "authenticate header which are explicitly denied analysis because of the sensitive data that they carry so there are all",
    "start": "726790",
    "end": "732639"
  },
  {
    "text": "these nuances to the protocol and really what I'm getting at is when you think about a layer 7 firewall you think about",
    "start": "732639",
    "end": "738309"
  },
  {
    "text": "oh it can detect HTTP traffic but what about HTTP traffic can it detect inside",
    "start": "738309",
    "end": "744040"
  },
  {
    "text": "or or Canada extract from HTTP can it can it extract particular interesting headers or kind of know the difference",
    "start": "744040",
    "end": "749800"
  },
  {
    "text": "between a fake masquerading domain or a real medical domain pushing this further the domain itself besides malware com",
    "start": "749800",
    "end": "757089"
  },
  {
    "text": "probably want to get categorized we could purchase expired domains this is a common thing for anybody who's not familiar with it in fact there are some",
    "start": "757089",
    "end": "763480"
  },
  {
    "text": "amazing tools that have been released that effectively look at a categorization of any given domain",
    "start": "763480",
    "end": "769139"
  },
  {
    "text": "they're a bunch of providers and really the trust repository is somewhat combined I get questions a lot like well",
    "start": "769139",
    "end": "775809"
  },
  {
    "text": "if I knew exactly what trust provide our client was using what I just submit the domain to that provider but the idea is",
    "start": "775809",
    "end": "781689"
  },
  {
    "text": "we're collecting these domains for the long term so if we're using HTTP that domain name is sort of everything and the trust we have with it is everything",
    "start": "781689",
    "end": "787720"
  },
  {
    "text": "so part of what we talked about is is keeping them and holding them and really building them up in the eyes of all of",
    "start": "787720",
    "end": "792790"
  },
  {
    "text": "these trust repositories and once again I mentioned some some great automated tooling like domain check or chameleon",
    "start": "792790",
    "end": "798220"
  },
  {
    "text": "for analyzing the status of a particular domain or tracking them long term also suspect",
    "start": "798220",
    "end": "803880"
  },
  {
    "text": "drops guys just released a platform management tool that does some similar work pushing it even farther than that",
    "start": "803880",
    "end": "810180"
  },
  {
    "text": "anybody's ever heard of HTTP pipelining it's this idea that we might shovel multiple HTTP requests down a single",
    "start": "810180",
    "end": "815880"
  },
  {
    "text": "socket without waiting for a response so this has been looked at to effectively create or or push forward a benign",
    "start": "815880",
    "end": "822750"
  },
  {
    "text": "request in front of your callback data it's an interesting blog that talks about this as an alternative to domain",
    "start": "822750",
    "end": "828420"
  },
  {
    "text": "fronting and it's something I think worth thinking about past that WebSockets there are some great",
    "start": "828420",
    "end": "834630"
  },
  {
    "text": "integrations for cobalt strike external situ and once again here we're aiming for less inspection in terms of trust so",
    "start": "834630",
    "end": "841890"
  },
  {
    "text": "we gain trust by the fact that nobody's checking our traffic it's kind of an inverted approach and in terms of the",
    "start": "841890",
    "end": "847140"
  },
  {
    "text": "vector we add speed and sort of these push-pull systems which really optimize our action delay remembers an operator",
    "start": "847140",
    "end": "852420"
  },
  {
    "text": "I'm most interested in the tool matching my style of operating so the c2 just becomes this big complexity that I have",
    "start": "852420",
    "end": "858570"
  },
  {
    "text": "to deal with if I had it my way I would have the tool be async and effect it would be connected to me all the time so",
    "start": "858570",
    "end": "863970"
  },
  {
    "text": "I could run whatever I wanted on it and then in a similar vein of WebSockets HTTP 2 is coming out so if anybody is",
    "start": "863970",
    "end": "869970"
  },
  {
    "text": "not thought of that in terms of malware or malicious use you definitely should once again less inspection here you",
    "start": "869970",
    "end": "876450"
  },
  {
    "text": "transfer size reductions encoding is a big part of HTTP C 2 it's what makes it so complex so the fact that that",
    "start": "876450",
    "end": "882720"
  },
  {
    "text": "protocol is moving to a binary standard really really adds a lot of benefit for us as attackers Merlyn is a cool c2",
    "start": "882720",
    "end": "888630"
  },
  {
    "text": "framework that actually already uses and implements HTTP 2 and golang so if you want to look at that and it's with that",
    "start": "888630",
    "end": "895140"
  },
  {
    "text": "that I transition to the second probably most popular layer 7 protocol which is DNS also you don't have to worry we're not gonna go through all these in case",
    "start": "895140",
    "end": "901230"
  },
  {
    "text": "anybody was stressing out so DNS used most commonly to you know transfer data",
    "start": "901230",
    "end": "908550"
  },
  {
    "text": "over links that you effectively don't have a direct access to so DNS has this amazing property of I can push data to",
    "start": "908550",
    "end": "915240"
  },
  {
    "text": "somebody's server and that packet will just sort of find its way to where it needs to be this is a really neat property and I think what makes DNS so",
    "start": "915240",
    "end": "922020"
  },
  {
    "text": "popular for abuse despite the fact that it's actually kind of a pain to use it's really difficult regardless of request",
    "start": "922020",
    "end": "927930"
  },
  {
    "text": "type to get decent data out you can sometimes pull good data back but usually you're working like sub KB and",
    "start": "927930",
    "end": "934080"
  },
  {
    "text": "that realm and even in that it's really easy to detect just based on volume name length or the fact that there's been",
    "start": "934080",
    "end": "940470"
  },
  {
    "text": "some number of unique subdomains per particular top-level domain if we wanted to approach or improve this we prefer a",
    "start": "940470",
    "end": "946770"
  },
  {
    "text": "blended situ approach so we like to mix things like DNS with HTTP so those",
    "start": "946770",
    "end": "951840"
  },
  {
    "text": "beaconing systems that were those dead beacons that are wasted on HTTP are set and sort of well-groomed for DNS because",
    "start": "951840",
    "end": "959520"
  },
  {
    "text": "we don't need them to transfer a lot of data there's also DNS over HTTP as I've mentioned before we look at implementing",
    "start": "959520",
    "end": "965400"
  },
  {
    "text": "DNS SEC just to evade some stuff or we could trade thorough put for trusted net locks so you know the fact that DNS",
    "start": "965400",
    "end": "972150"
  },
  {
    "text": "resolution might get blocked because the IP belongs to a particular country's IP space so we might effectively reduce the",
    "start": "972150",
    "end": "978690"
  },
  {
    "text": "total of number of data we could transfer to just improve the reliability of it and the last segue I want to make",
    "start": "978690",
    "end": "984300"
  },
  {
    "text": "before we move into the good stuff is ICMP this has actually been around forever a bit like DNS I think once",
    "start": "984300",
    "end": "990840"
  },
  {
    "text": "again the complexities of implementing it maybe make people shy away but there are you know samples in the wild that",
    "start": "990840",
    "end": "996300"
  },
  {
    "text": "use this one nice thing about like an echo request did you get arbitrary payload size which once again as a",
    "start": "996300",
    "end": "1001610"
  },
  {
    "text": "developer is an important thing for me we can effectively extract data and tack arbitrary data onto the packet without",
    "start": "1001610",
    "end": "1008000"
  },
  {
    "text": "worrying about you know protocol syntax limitation limitations stuff like that",
    "start": "1008000",
    "end": "1013360"
  },
  {
    "text": "in terms of improvements we could use alternate codes so a lot of people use",
    "start": "1013360",
    "end": "1018380"
  },
  {
    "text": "an echo request and reply but that's not the only code that ICMP supports in fact time exceeded messages are almost as",
    "start": "1018380",
    "end": "1024050"
  },
  {
    "text": "popular and not as well monitored although they can't transfer as much data but like in a time exceeded packet",
    "start": "1024050",
    "end": "1029390"
  },
  {
    "text": "you can easily get you know to 32 bit blocks which is pretty decent smaller",
    "start": "1029390",
    "end": "1034880"
  },
  {
    "text": "payloads with more volume as another strategy we employ both with DNS and ICMP so you'll have to make trade-offs",
    "start": "1034880",
    "end": "1040130"
  },
  {
    "text": "there and usually you're aiming for you know maybe you might try a higher packet volume for just smaller packets in",
    "start": "1040130",
    "end": "1046280"
  },
  {
    "text": "general also the fact that ICMP is connectionless means that you start pushing really large packets and you're",
    "start": "1046280",
    "end": "1051320"
  },
  {
    "text": "just gonna run into deliverability issues and then lastly I want to do a",
    "start": "1051320",
    "end": "1057170"
  },
  {
    "text": "shout out to Samy Kamkar is project pal net where he demonstrates a really neat way to discover IP addresses for a UDP",
    "start": "1057170",
    "end": "1063650"
  },
  {
    "text": "NAT bypass or effectively you have an agent behind an app while making a type 8 echo request out",
    "start": "1063650",
    "end": "1070240"
  },
  {
    "text": "to a known IP address and then at some point a server requests in and responds to that echo request saying hey whatever",
    "start": "1070240",
    "end": "1076870"
  },
  {
    "text": "that packet was it never reached the server the TTL was exceeded the nice part is B these are connectionless",
    "start": "1076870",
    "end": "1082030"
  },
  {
    "text": "packets but the NAT on the perimeter will let that packet in and back to the agent because it just assumes that it",
    "start": "1082030",
    "end": "1087970"
  },
  {
    "text": "was a reply from a server trying to help out I really recommend you go and look at his tools then UDP NAT punch thing is",
    "start": "1087970",
    "end": "1093730"
  },
  {
    "text": "an entirely different beast and really neat alright so with that then we transition to trust conflicts so we've",
    "start": "1093730",
    "end": "1100720"
  },
  {
    "text": "covered a couple of you know basic protocols I think HTTP most people in here familiar with that DNS maybe if",
    "start": "1100720",
    "end": "1106870"
  },
  {
    "text": "you've used some advanced tooling or more advanced tooling but now we're sorta gonna move into the realm of HTTP",
    "start": "1106870",
    "end": "1113200"
  },
  {
    "text": "layered on top of trusted assets so there are a lot of different assets we might look at for this and I kind of",
    "start": "1113200",
    "end": "1118690"
  },
  {
    "text": "loosely grouped them into categories although I'm sure these categories aren't entirely accurate we might look at email assets or chat assets these",
    "start": "1118690",
    "end": "1126460"
  },
  {
    "text": "systems are generally dead drop so if you remember talking about that if we are going to abuse a trusted asset or use a third party we're usually having",
    "start": "1126460",
    "end": "1133030"
  },
  {
    "text": "some system where we drop data and pull that data back out on the far side we get a lot of inherent stealth with this",
    "start": "1133030",
    "end": "1139450"
  },
  {
    "text": "obviously parameter exclusions and whitelisting or just the fact that the domains familiar to a particular analyst",
    "start": "1139450",
    "end": "1144850"
  },
  {
    "text": "these projects have been coming out for a long time and as you guys will see there's no shortage of examples of",
    "start": "1144850",
    "end": "1149950"
  },
  {
    "text": "really cool third-party c-2 so in terms of abuse just in the social category there's been a couple examples of people",
    "start": "1149950",
    "end": "1156070"
  },
  {
    "text": "abusing Twitter there's also been some nice multi-site the hammer toss agent does some crazy stuff with like three or",
    "start": "1156070",
    "end": "1161080"
  },
  {
    "text": "four different providers and the social media c2 is a POC for a similar thing I've obviously included links in the",
    "start": "1161080",
    "end": "1167350"
  },
  {
    "text": "bottom of these slides for anybody and they will be distributed so don't stress out too much about it beyond that chat",
    "start": "1167350",
    "end": "1173830"
  },
  {
    "text": "slack super popular thing there's three projects out right now and I'm sure more that are in private hands that",
    "start": "1173830",
    "end": "1179470"
  },
  {
    "text": "effectively perform c2 over slack agents once again there's no shortage of sites",
    "start": "1179470",
    "end": "1184750"
  },
  {
    "text": "that we could use to perform abuse really what it comes down to is what does it take to implement that so you",
    "start": "1184750",
    "end": "1190030"
  },
  {
    "text": "know we might trade the complexities of slack for just the sheer benefit that slack has high volumes of traffic people",
    "start": "1190030",
    "end": "1196179"
  },
  {
    "text": "chatting all day long so just keep that in mind as you think about all of the opportunities for for using these providers in terms of email",
    "start": "1196179",
    "end": "1203940"
  },
  {
    "text": "there's G cat and G dog which represented or which demonstrated that for Gmail if I say Gmail anyways email G",
    "start": "1203940",
    "end": "1212820"
  },
  {
    "text": "cat G dog and then the light neuron compromise showed a lot of cool stuff for exchange servers so sort of poked",
    "start": "1212820",
    "end": "1219450"
  },
  {
    "text": "the hole at using email for c2 they did some really neat and demography stuff I highly recommend reading about it if",
    "start": "1219450",
    "end": "1225120"
  },
  {
    "text": "you're interested ants with this that we reached sort of the first PLC that I'm gonna release this is what is something I called post office it's effectively a",
    "start": "1225120",
    "end": "1231900"
  },
  {
    "text": "mail see to proof of concept that runs over EWS so it doesn't count piggybacking I got thinking about this",
    "start": "1231900",
    "end": "1238080"
  },
  {
    "text": "idea that you compromised an individual host that user is gonna have an outlook box open and they're effectively gonna",
    "start": "1238080",
    "end": "1244350"
  },
  {
    "text": "be doing email all day long so if we were on the client side and we had code execution we could effectively steal",
    "start": "1244350",
    "end": "1250110"
  },
  {
    "text": "their credentials because many people store their outlook credentials in the windows vault or we could simply reuse ntlm Athene when ina and then we could",
    "start": "1250110",
    "end": "1257520"
  },
  {
    "text": "post messages to the EWS endpoint and effectively send messages through their mailbox out to our server the nice part",
    "start": "1257520",
    "end": "1264000"
  },
  {
    "text": "about this is we're never actually contacting our own mail server and we can do some neat things like hide our situ data in X headers so that the",
    "start": "1264000",
    "end": "1270809"
  },
  {
    "text": "message itself doesn't actually have any content in it that looks malicious so you might still have to deal with spam filters I'm implemented using SendGrid",
    "start": "1270809",
    "end": "1277770"
  },
  {
    "text": "for this I'm sure you could do it a bunch of different ways if you wanted to do SMTP yourself I kind of preferred that just for the integration piece but first",
    "start": "1277770",
    "end": "1284910"
  },
  {
    "text": "we land on a host we pull endpoint settings and the credentials and then we would configure an auto hide rule so",
    "start": "1284910",
    "end": "1290880"
  },
  {
    "text": "this is just prepping for the ultimate reply that we're gonna get from the you know the attacker box we don't want that",
    "start": "1290880",
    "end": "1296730"
  },
  {
    "text": "email to be loaded into the inbox and then afterwards we send an email and we really put our c2 data in an email",
    "start": "1296730",
    "end": "1303870"
  },
  {
    "text": "header SendGrid parses it using an inbound web hook and forwards us the content this whole process effectively",
    "start": "1303870",
    "end": "1310320"
  },
  {
    "text": "runs in Reverse we would post the email back and and have the agent use it in terms of configuration somewhat simple",
    "start": "1310320",
    "end": "1317580"
  },
  {
    "text": "send grids rather nice you can set up a subdomain on a particular trusted domain",
    "start": "1317580",
    "end": "1324090"
  },
  {
    "text": "that you have configured and tell it any email that you receive here should be sent to you know HTTP my public server",
    "start": "1324090",
    "end": "1330840"
  },
  {
    "text": "comm and then the MX records are pretty simple as well we just say any may going to see to the dark side I Oh goes",
    "start": "1330840",
    "end": "1337440"
  },
  {
    "text": "to the SendGrid servers so I'll try to show a video here if you guys can see it but effectively I have the visual studio",
    "start": "1337440",
    "end": "1343860"
  },
  {
    "text": "project it's a C++ agent side and I have the server loaded up see agents effectively booting and it's gonna be",
    "start": "1343860",
    "end": "1350280"
  },
  {
    "text": "combate to server and the server is gonna print out all the email data but if we scroll down effectively it just as",
    "start": "1350280",
    "end": "1356130"
  },
  {
    "text": "we loaded a new agent so this is an agent like via email and we're just gonna tell it to exactly command so",
    "start": "1356130",
    "end": "1362490"
  },
  {
    "text": "we're gonna tell it to run Who am i / all with like system and you can see in the new window this is it waiting and",
    "start": "1362490",
    "end": "1368160"
  },
  {
    "text": "it's continually checking the Inbox and it's got the tasking from the server so it received the email parse the email",
    "start": "1368160",
    "end": "1374400"
  },
  {
    "text": "and then effectively returned the tasking and you can see in our new shell we got the output for the Who am I command oh so I guess closed up here man",
    "start": "1374400",
    "end": "1388200"
  },
  {
    "text": "even when you video your demos they still don't go well I really tried to prevent this yeah probably",
    "start": "1388200",
    "end": "1396890"
  },
  {
    "text": "all right where we at that good cool so in terms of out our additional items",
    "start": "1397880",
    "end": "1405800"
  },
  {
    "text": "operations we have like SAS services MWR Labs has done a blog post about using office 365 for C - there's the Ken",
    "start": "1405800",
    "end": "1413610"
  },
  {
    "text": "Caniff Ruffus can this breakfast they I apologize for botching the name for",
    "start": "1413610",
    "end": "1419730"
  },
  {
    "text": "performing github and there's Google Drive as well there's also a lot of internal situ concepts so Active",
    "start": "1419730",
    "end": "1424740"
  },
  {
    "text": "Directory it's been proven that we can do c2 via that we can also do c2 via MS sequel the power-up sequel project",
    "start": "1424740",
    "end": "1431010"
  },
  {
    "text": "demonstrates a lot of neat stuff there and the out plain guys have also looked at external cobalt strike c2 for file",
    "start": "1431010",
    "end": "1436500"
  },
  {
    "text": "server or file shares and sort of an isolated sense and then some additional ones Wikipedia there's a project for",
    "start": "1436500",
    "end": "1443250"
  },
  {
    "text": "that and paste bin the agha campaign abused paste bin for transferring data",
    "start": "1443250",
    "end": "1448550"
  },
  {
    "text": "but what about trust repos this is something I haven't seen a lot of what if you wanted to get data in and out of",
    "start": "1448550",
    "end": "1453870"
  },
  {
    "text": "a network using a repository that was dedicated to analyzing malware so what I came up with is a project I'm calling",
    "start": "1453870",
    "end": "1459960"
  },
  {
    "text": "addendum which is effectively a virus total situ project where it stuffs data into document properties and then",
    "start": "1459960",
    "end": "1466380"
  },
  {
    "text": "uploads that document as a sample virustotal is very kind about this because it wants samples and it will go",
    "start": "1466380",
    "end": "1471660"
  },
  {
    "text": "ahead and parse that sample although the analysis can take a while and then when that sample is parsed the metadata will",
    "start": "1471660",
    "end": "1477690"
  },
  {
    "text": "be extracted and available on the response of the page assuming you know the hash so we tracked sample uploads",
    "start": "1477690",
    "end": "1483120"
  },
  {
    "text": "using comments and we handle large payloads or handles large payloads gracefully because of how much we can",
    "start": "1483120",
    "end": "1488910"
  },
  {
    "text": "stuff in the particular properties I think it's ideal for static stages or downloads so if you were looking for",
    "start": "1488910",
    "end": "1493950"
  },
  {
    "text": "something where you could preload a URL into an agent and if it checked or bypassed a sandbox check it could then",
    "start": "1493950",
    "end": "1499530"
  },
  {
    "text": "go pull this item from virustotal I think full-blown dynamic situ is a little bit tricky not not just because",
    "start": "1499530",
    "end": "1506790"
  },
  {
    "text": "the analysis time can take a while but the diagram for this is one we packed callback data into an office doc we",
    "start": "1506790",
    "end": "1512130"
  },
  {
    "text": "upload it and we effectively wait for the sample analysis to finish once it's done we make a comment on that sample",
    "start": "1512130",
    "end": "1517170"
  },
  {
    "text": "the nice part is is anybody who comes along and knows our user name can view our comment history that's public as",
    "start": "1517170",
    "end": "1522630"
  },
  {
    "text": "well so they can see the list of the files that we made comments on and then pull out the hashes and go and browse to",
    "start": "1522630",
    "end": "1527730"
  },
  {
    "text": "that so the let's see playing up there",
    "start": "1527730",
    "end": "1538130"
  },
  {
    "text": "maybe man really I was hoping that the video demos would go well history going",
    "start": "1544640",
    "end": "1552559"
  },
  {
    "text": "hell alright well we might have to skip",
    "start": "1552559",
    "end": "1561080"
  },
  {
    "text": "this demo but effectively what the tool does is just like what we said packs a bunch of data in a sample uploads it",
    "start": "1561080",
    "end": "1567620"
  },
  {
    "text": "waits for the analysis to finish which can take a while and then pulls back the data and validates that it matches I didn't go full-blown",
    "start": "1567620",
    "end": "1574090"
  },
  {
    "text": "interactive shell like the EWS one primarily because I find this technique a bit more you know fun and games than",
    "start": "1574090",
    "end": "1580100"
  },
  {
    "text": "it is legitimate but if you wanted to take an Internet of that you're obviously welcome alright and it's with",
    "start": "1580100",
    "end": "1585950"
  },
  {
    "text": "that that we come into our cloud abuse and takeover realm so this is kind of the final leg of our entire c2 and first",
    "start": "1585950",
    "end": "1595370"
  },
  {
    "text": "I'll establish in my mind what I mean when I say cloud so cloud very",
    "start": "1595370",
    "end": "1600980"
  },
  {
    "text": "distributed obviously tons of providers but there's really pride through four primary ones that represent the largest market share specifically I'm gonna",
    "start": "1600980",
    "end": "1607730"
  },
  {
    "text": "leave my items primarily focused on AWS Azure and a little bit of GCP together",
    "start": "1607730",
    "end": "1613429"
  },
  {
    "text": "they you know represent with Alibaba eighty-four percent of of all the cloud provider markets so I think it's",
    "start": "1613429",
    "end": "1618679"
  },
  {
    "text": "probably what attackers are gonna aim for anyways there's a ton of functionality in the cloud but I'm gonna",
    "start": "1618679",
    "end": "1623750"
  },
  {
    "text": "keep this talk focused on C two primitives we're not gonna talk a lot about you know abusing AWS secret keys",
    "start": "1623750",
    "end": "1629809"
  },
  {
    "text": "or anything like that although that's you know obviously related so I break down the cloud problem into two primary",
    "start": "1629809",
    "end": "1636740"
  },
  {
    "text": "issues one is we have trust boundary problems the cloud represents sort of a",
    "start": "1636740",
    "end": "1641870"
  },
  {
    "text": "break in our classic ideas of trust boundaries and to the assets that the cloud have are very dynamic and the",
    "start": "1641870",
    "end": "1648559"
  },
  {
    "text": "traditional protocols and would you call it the systems that we have in place now",
    "start": "1648559",
    "end": "1654770"
  },
  {
    "text": "aren't set up to handle them effectively so in terms of trust boundaries once again we have a client connecting to a",
    "start": "1654770",
    "end": "1660410"
  },
  {
    "text": "server and if we install a perimeter there the perimeter can use some reference for trust repository to say well this traffic is or this particular",
    "start": "1660410",
    "end": "1667490"
  },
  {
    "text": "endpoint is benign or it's malicious but once we install cloud in there it gets kind of complicated right now we have",
    "start": "1667490",
    "end": "1673790"
  },
  {
    "text": "traffic leaving our perimeter towards some generalized cloud and we might be able to make some",
    "start": "1673790",
    "end": "1680770"
  },
  {
    "text": "distinction of the traffic based on qualities of the domain or maybe the URL but at the end of the day these become",
    "start": "1680770",
    "end": "1687200"
  },
  {
    "text": "really high complexity sitting on top of HTTP things that we're not really ready to deal with I'll give some examples if",
    "start": "1687200",
    "end": "1692540"
  },
  {
    "text": "any of these domains look familiar like as your website's Amazon AWS com probably one of the more popular ones",
    "start": "1692540",
    "end": "1697840"
  },
  {
    "text": "Akamai Dannette or you know the popular cloud front done out that was used for",
    "start": "1697840",
    "end": "1703310"
  },
  {
    "text": "fronting and the second half of our issue is once again dynamic assets so we",
    "start": "1703310",
    "end": "1708770"
  },
  {
    "text": "have trust problems but also we have this problem with you know how will TLS scale with the cloud and we've actually",
    "start": "1708770",
    "end": "1713900"
  },
  {
    "text": "already ran into this before this is why S&I exists so you know before we just had a server and an IP and they were",
    "start": "1713900",
    "end": "1719930"
  },
  {
    "text": "linked together like a domain name and everything was fine now we have front planes all over the world and we're like",
    "start": "1719930",
    "end": "1725390"
  },
  {
    "text": "abusing DNS in a way to reduce effectively the transfer time of the",
    "start": "1725390",
    "end": "1730970"
  },
  {
    "text": "round-trip time to any particular server but what that meant is that servers needed to break TLS or have some ability",
    "start": "1730970",
    "end": "1736400"
  },
  {
    "text": "to look at TLS which we'll talk about in just a second the additional thing we're going to talk about is DNS so DNS is",
    "start": "1736400",
    "end": "1742820"
  },
  {
    "text": "kind of a protocol that hasn't taken the hit yet but how does it deal with you know the reallocation of assets the",
    "start": "1742820",
    "end": "1747920"
  },
  {
    "text": "redistribution of assets to a particular agent or person how can we represent",
    "start": "1747920",
    "end": "1752960"
  },
  {
    "text": "ownership and how can we prevent Mis configuration especially when that Mis configuration is so isolated when it's",
    "start": "1752960",
    "end": "1758450"
  },
  {
    "text": "so easy to miss configure cloud assets and then on top of that the cloud assets are so easy to look for because they're",
    "start": "1758450",
    "end": "1763520"
  },
  {
    "text": "in just one spot on the internet we have a serious problem with making people sure keeping people responsible for the",
    "start": "1763520",
    "end": "1769280"
  },
  {
    "text": "assets they have control over so this all came about in sort of the first round of cloud getting its punch in",
    "start": "1769280",
    "end": "1776180"
  },
  {
    "text": "domain fronting if anybody's heard of that in a classic sense we make some HTTP requests to kittens calm which",
    "start": "1776180",
    "end": "1782120"
  },
  {
    "text": "resolves to a quick IP effectively the closest server to us we'll call it 1 2 3 4 s and I happens where we effectively",
    "start": "1782120",
    "end": "1788450"
  },
  {
    "text": "tell the server hey we're looking for kittens calm by the way but the get request is made against that server with",
    "start": "1788450",
    "end": "1793820"
  },
  {
    "text": "the host header set to Azure edge net then we might go to puppy's calm and the",
    "start": "1793820",
    "end": "1799070"
  },
  {
    "text": "same process happens again and you'll note the bottom request is effectively the same we're making the same request to the same server and the only thing",
    "start": "1799070",
    "end": "1805040"
  },
  {
    "text": "that changes is the host header so attackers obviously figured out how to abuse this by making a web request to",
    "start": "1805040",
    "end": "1810800"
  },
  {
    "text": "one host kittens calm win that packet or when that request leaves the network it gets put in the web logs as kittens calm but",
    "start": "1810800",
    "end": "1818240"
  },
  {
    "text": "we forged the host header - puppies to Azure dot net and the DNS resolution happens the same way ultimately the end",
    "start": "1818240",
    "end": "1824750"
  },
  {
    "text": "of it we get to connect to a website that the perimeter never thought we were connecting to and once again this is these are the the intricacies of the",
    "start": "1824750",
    "end": "1831080"
  },
  {
    "text": "protocol that I'm talking about we never assumed that a host header could make that much difference in terms of the website content that you load but",
    "start": "1831080",
    "end": "1837110"
  },
  {
    "text": "it does now an IP means nothing it's just an IP on a cloud front plane somewhere so in terms of abuse beyond",
    "start": "1837110",
    "end": "1845780"
  },
  {
    "text": "Des Moines domain fronting or sort of what's next file hosting we can host static payloads and containers that's",
    "start": "1845780",
    "end": "1851150"
  },
  {
    "text": "been demonstrated before as well as shoveling dynamic data via those same containers so an AWS these look like s3",
    "start": "1851150",
    "end": "1857179"
  },
  {
    "text": "buckets GCP has its cloud storage which sort of same the same terminology and Azure has blob storage it's kind of got",
    "start": "1857179",
    "end": "1865160"
  },
  {
    "text": "a bunch of nuances to it but generally the links look like SAS links and they're a little bit larger but I will",
    "start": "1865160",
    "end": "1871309"
  },
  {
    "text": "have you note that the bucket ID can actually go to different places depending on how you load it so you can",
    "start": "1871309",
    "end": "1876470"
  },
  {
    "text": "have the bucket ID that is specific to you get put into the DNS name or you can have the bucket name get put into the",
    "start": "1876470",
    "end": "1881990"
  },
  {
    "text": "URL and I think a lot of people maybe assume that well we could detect you using an s3 bucket because it identifies",
    "start": "1881990",
    "end": "1887870"
  },
  {
    "text": "you it says my bucket mr. evil bucket s3 Amazon AWS but if",
    "start": "1887870",
    "end": "1893330"
  },
  {
    "text": "your web gateways I'm prepared to extract the bucket name from the URL then how would you know the difference between any s3 to Amazon to AWS link and",
    "start": "1893330",
    "end": "1900950"
  },
  {
    "text": "another we can also look at serverless code so you know pass through traffic",
    "start": "1900950",
    "end": "1906380"
  },
  {
    "text": "redirection was a big part of domain fronting for the Google cloud platform specifically so this is where we have",
    "start": "1906380",
    "end": "1912440"
  },
  {
    "text": "you know some code that gets loaded into an engine and when we receive a web request we just forward that request on",
    "start": "1912440",
    "end": "1918250"
  },
  {
    "text": "App engines look like appspot URLs and lambda obviously has the unique IDs to",
    "start": "1918250",
    "end": "1923450"
  },
  {
    "text": "execute api's I think you know just that once again an important thing to extract is how many people are looking for these",
    "start": "1923450",
    "end": "1929840"
  },
  {
    "text": "how many people are even familiar with what these URLs look like you know if a sim analyst saw these URLs and a log",
    "start": "1929840",
    "end": "1935540"
  },
  {
    "text": "would they know the difference between one particular Azure website's URL or an appspot URL or even an AMSA or AWS",
    "start": "1935540",
    "end": "1942920"
  },
  {
    "text": "lambda endpoint and it's with that that I want to get into the takeover primitives so this is",
    "start": "1942920",
    "end": "1948960"
  },
  {
    "text": "really my attack on DNS in a way once again TLS has had it's beating in terms of you",
    "start": "1948960",
    "end": "1956310"
  },
  {
    "text": "know s and I and having to deal with dynamic cloud infrastructure and now we're looking at the way that DNS has",
    "start": "1956310",
    "end": "1962340"
  },
  {
    "text": "sort of hanging records that get left out the orphaned records scene is becoming pretty intense at any given",
    "start": "1962340",
    "end": "1967650"
  },
  {
    "text": "time and organization now has to maybe manage you know hundred domain names or hundreds of domain names or even thousands in a records file and those",
    "start": "1967650",
    "end": "1974550"
  },
  {
    "text": "records are static they just get implemented and they point to a cloud asset that assets now very dynamic there's been a ton of research in this",
    "start": "1974550",
    "end": "1981270"
  },
  {
    "text": "area patrick Hudak or haddock jr. I'm very sorry I'm ruined your name he",
    "start": "1981270",
    "end": "1986460"
  },
  {
    "text": "actually did an entire thesis paper on the analysis of DNS in cyber security he also is the second link down the AWS",
    "start": "1986460",
    "end": "1992700"
  },
  {
    "text": "route 3 or route 53 name server takeovers and you guys haven't read the stuff you definitely should these people",
    "start": "1992700",
    "end": "1999030"
  },
  {
    "text": "have been screaming this for ages like these cloud providers are vulnerable to like thousands of domains being taken over and it really is the truth these",
    "start": "1999030",
    "end": "2005840"
  },
  {
    "text": "these DNS records are not prepped to handle this sort of stuff generally when",
    "start": "2005840",
    "end": "2011510"
  },
  {
    "text": "I started looking at the DNS takeover I started organizing it at a two primary schools of thought so one is you would",
    "start": "2011510",
    "end": "2017660"
  },
  {
    "text": "go after a cname record cname records might commonly be used in bug bounty programs where you're trying to identify",
    "start": "2017660",
    "end": "2023720"
  },
  {
    "text": "a URL that or at a domain that points to say github where they've since removed their github account is there a",
    "start": "2023720",
    "end": "2030890"
  },
  {
    "text": "frequently called sub domain takeovers although I think what I'll show actually you know opens up the idea that",
    "start": "2030890",
    "end": "2036380"
  },
  {
    "text": "subdomain takeover could mean something different the alternative is going after name server records so you know if you",
    "start": "2036380",
    "end": "2041870"
  },
  {
    "text": "were interested in taking over an entire domain that's sort of where the route 53 research comes in but what about others I started asking myself you know is",
    "start": "2041870",
    "end": "2048290"
  },
  {
    "text": "there any way for us to target IP based records instead of domain name records that point to other domain names so I",
    "start": "2048290",
    "end": "2053419"
  },
  {
    "text": "came up with two problems that we kinda have to solve before before we go into this one is how quickly could we",
    "start": "2053420",
    "end": "2059240"
  },
  {
    "text": "actually collect new addresses it's kind of a big problem right it's like beforehand you would have to go to a VPS",
    "start": "2059240",
    "end": "2065240"
  },
  {
    "text": "provider and buy a server and maybe they would give you one address and you had to like claw at them to give you a",
    "start": "2065240",
    "end": "2070280"
  },
  {
    "text": "second address and maybe like pay more money and now cloud providers are like and there's an API endpoint for it",
    "start": "2070280",
    "end": "2075770"
  },
  {
    "text": "yes cycle that thing you know multi ten threads a minute and the second question is how would we accurately",
    "start": "2075770",
    "end": "2081540"
  },
  {
    "text": "check for any orphan record this is actually the larger problem in the scream of things DNS doesn't really work",
    "start": "2081540",
    "end": "2086908"
  },
  {
    "text": "the same way backwards so we're trying to find hanging orphaned records from an IP address and there's not a lot of",
    "start": "2086909",
    "end": "2092819"
  },
  {
    "text": "great repositories for this but here's the concept so the concept is we would",
    "start": "2092819",
    "end": "2098010"
  },
  {
    "text": "communicate with some cloud provider and we collect a random IP that IP is now ours the cloud provider just gave it to",
    "start": "2098010",
    "end": "2103650"
  },
  {
    "text": "us we own it it belongs to us and now we have to find out is that record interesting if we go to a particular you",
    "start": "2103650",
    "end": "2110790"
  },
  {
    "text": "know records authority or or some sort of DNS record repository and say you know is a DNS name associated with this",
    "start": "2110790",
    "end": "2116970"
  },
  {
    "text": "IP and they say yes well then perfect we can now sort of keep the IP and use that DNS name the DNS will resolve you know",
    "start": "2116970",
    "end": "2124260"
  },
  {
    "text": "it goes through a zone file that we don't even own and we just hope that that record stays alive for you know as long as possible and we'd probably just",
    "start": "2124260",
    "end": "2130589"
  },
  {
    "text": "repeat this process for as many records as we wanted or to handle failure conditions so about this record",
    "start": "2130589",
    "end": "2136530"
  },
  {
    "text": "repository we can't really use pointer records that's kind of the idea of reversing a DNS IP but there's a problem",
    "start": "2136530",
    "end": "2142980"
  },
  {
    "text": "with that in that they're not necessarily accurate they probably point to a domain record that belongs to like",
    "start": "2142980",
    "end": "2148079"
  },
  {
    "text": "the provider that hosts the infrastructure it doesn't really point to the true domain that we would be interested in rapid7 has a great project",
    "start": "2148079",
    "end": "2154290"
  },
  {
    "text": "called open DNS as a bunch of you know data repositories for a records and MX records you can definitely use that the",
    "start": "2154290",
    "end": "2161339"
  },
  {
    "text": "de JSON files are massive so you'd have to figure out a way to parse them but it's probably the route one of the routes I would go long term three would",
    "start": "2161339",
    "end": "2168270"
  },
  {
    "text": "be getting access to the top-level zone file actually went through this process that's not too hard Verisign is charged",
    "start": "2168270",
    "end": "2173700"
  },
  {
    "text": "with keeping the global top-level zone file that that effectively shows all of the domains that exist in the dot-com",
    "start": "2173700",
    "end": "2179430"
  },
  {
    "text": "namespace and the name servers that handle those domains so this is more relevant to the name server takeover but",
    "start": "2179430",
    "end": "2185220"
  },
  {
    "text": "if you are looking at that sort of strategy and I think the blog before about the hundred and twenty thousand",
    "start": "2185220",
    "end": "2190790"
  },
  {
    "text": "domain name takeovers used that that top-level file there is a public",
    "start": "2190790",
    "end": "2196049"
  },
  {
    "text": "database who has XML while it's not public it's private but it's paid and you can find it on their website they",
    "start": "2196049",
    "end": "2201690"
  },
  {
    "text": "don't really post a price for that I never inquired I don't really know what they would charge to get access to that database or if they provide an API",
    "start": "2201690",
    "end": "2207530"
  },
  {
    "text": "luckily though the folks at security trails of sort of helped us out here this is a new website",
    "start": "2207530",
    "end": "2212550"
  },
  {
    "text": "that is just what we need it's a repository of DNS information and they provide api's and we can query all sorts",
    "start": "2212550",
    "end": "2218760"
  },
  {
    "text": "of stuff from it so with that we have the final piece to the puzzle and I'm sort of releasing today a thing I'm",
    "start": "2218760",
    "end": "2225480"
  },
  {
    "text": "calling cloud racoon because it's digging through the trash of the Internet but it hunts for IP is linked",
    "start": "2225480",
    "end": "2230970"
  },
  {
    "text": "to orphaned DNS records and it uses cloud IPs for the fast cycling bit now this varies depending on provider I",
    "start": "2230970",
    "end": "2237420"
  },
  {
    "text": "found AWS to be clearly the best it's superior not only in the speed at which you can request IPs",
    "start": "2237420",
    "end": "2243240"
  },
  {
    "text": "but also the fact that the azured are",
    "start": "2243240",
    "end": "2248520"
  },
  {
    "text": "the AWS would you call it Network space has been around a lot longer so there's just more DNS records pointing to that",
    "start": "2248520",
    "end": "2255060"
  },
  {
    "text": "space as err is pretty good it's slow I think you multi thread it out I'm not sure if I tried that and GCP pulls",
    "start": "2255060",
    "end": "2261390"
  },
  {
    "text": "things from a pool it's a bit weird it's like they carry a pool forward so if you continually request IPS at some point",
    "start": "2261390",
    "end": "2267000"
  },
  {
    "text": "you'll start to get the same ip's back so the script I wrote to do it effectively tracks that and it'll it'll target you know a particular percentage",
    "start": "2267000",
    "end": "2273630"
  },
  {
    "text": "of IPs at which it feels like it's seen enough of them before it gives up and then you just sort of wait a day and try again but we'll hope that this video",
    "start": "2273630",
    "end": "2281220"
  },
  {
    "text": "plays excellent cool so I would say I recorded this actually recorded this in",
    "start": "2281220",
    "end": "2287040"
  },
  {
    "text": "the lift right over here but this is it hunting through AWS so it's pulling IPS the first IP it saw was not good enough",
    "start": "2287040",
    "end": "2294990"
  },
  {
    "text": "so you can set up whitelist and all that effectively letting you know that it saw it but it gave it up and it's continually searching eventually here it",
    "start": "2294990",
    "end": "2302130"
  },
  {
    "text": "should hit another record for I know some some top-level server it's kind of",
    "start": "2302130",
    "end": "2309750"
  },
  {
    "text": "soothing",
    "start": "2309750",
    "end": "2312050"
  },
  {
    "text": "nice I could feel your guys's excitement you wanted it happen so bad anyways now we effectively have an IP with the",
    "start": "2316900",
    "end": "2323890"
  },
  {
    "text": "domain record that is a splint server or at some point they had a Splunk instance this is a proof-of-concept but this is",
    "start": "2323890",
    "end": "2332440"
  },
  {
    "text": "actually a bit unique in comparison to the other two projects and that operationally we've been using this for about six to eight months all of our",
    "start": "2332440",
    "end": "2339099"
  },
  {
    "text": "production infrastructure uses this strategy and we just cycle IPs we have you know 20 of them at this point and we",
    "start": "2339099",
    "end": "2345309"
  },
  {
    "text": "use them for real-world operations so I would be surprised that this isn't you know being performed by real world actors at this point but you can get",
    "start": "2345309",
    "end": "2352630"
  },
  {
    "text": "top-level domains for some crazy things we found antivirus vendors we found research institutes government agencies",
    "start": "2352630",
    "end": "2358779"
  },
  {
    "text": "obviously that you'll hear the same thing echoed in the blogs I posted about you know these takeover primitives but",
    "start": "2358779",
    "end": "2364359"
  },
  {
    "text": "this is extremely accessible like said this is not contrived at all this is literally the first run in the lift right over here if we sat here and ran",
    "start": "2364359",
    "end": "2371829"
  },
  {
    "text": "them I bet you we would have ten or fifteen in a five minute period so some",
    "start": "2371829",
    "end": "2376900"
  },
  {
    "text": "final thoughts I think the key points to take away from this talk is c2 is a very",
    "start": "2376900",
    "end": "2383049"
  },
  {
    "text": "complex discipline the implementations vary greatly and not always for you know",
    "start": "2383049",
    "end": "2388420"
  },
  {
    "text": "great reasons but usually the particular design decisions are aren't random you know these people are choosing HTTP for",
    "start": "2388420",
    "end": "2394930"
  },
  {
    "text": "reasons they're choosing ICMP for reasons I think the more we can understand that c2 is a discipline that",
    "start": "2394930",
    "end": "2400119"
  },
  {
    "text": "you know has been crafted over a long time and people are sort of in these molds now the better a but we're gonna",
    "start": "2400119",
    "end": "2405460"
  },
  {
    "text": "be able to handle the changes coming soon there's a ton of public research already available that's really one",
    "start": "2405460",
    "end": "2410499"
  },
  {
    "text": "thing I wanted to point out in this talk is you know I didn't come here to show off my proof of concepts and say that oh they're so awesome you guys should only",
    "start": "2410499",
    "end": "2416440"
  },
  {
    "text": "use those but the reality situation is people have been releasing these for years and I don't really feel like they're getting the credit they deserve",
    "start": "2416440",
    "end": "2421989"
  },
  {
    "text": "I think it's because people think it's still theoretical or it's not really easy to operationalize but I think we",
    "start": "2421989",
    "end": "2427839"
  },
  {
    "text": "need to start solving these new problems you know I think domain fronting was just the first crack in a long series of",
    "start": "2427839",
    "end": "2433690"
  },
  {
    "text": "cracks and this DNS takeover thing is going to be the next third party boost is growing and cloud is representing",
    "start": "2433690",
    "end": "2440170"
  },
  {
    "text": "some very unique challenges for us so next I just want to cover what wasn't covered I obviously I'm a guy who likes",
    "start": "2440170",
    "end": "2447609"
  },
  {
    "text": "to give information I didn't touch it all about offensive structure which is its own discipline but related discipline this would",
    "start": "2447609",
    "end": "2453849"
  },
  {
    "text": "include like asset collection traffic redirection stage segmentation you know there are a bunch of great people who",
    "start": "2453849",
    "end": "2459880"
  },
  {
    "text": "all post links to that they give this sort of stuff out for free and give you all the resources you need for it but",
    "start": "2459880",
    "end": "2465940"
  },
  {
    "text": "really all of these individual primitives can't work without that knowledge either so you know that's",
    "start": "2465940",
    "end": "2471489"
  },
  {
    "text": "really where I think people lose the connection as they can see okay I use virustotal for c2 but how it actually",
    "start": "2471489",
    "end": "2476739"
  },
  {
    "text": "build it the second is the specific architecture details so like language choice the details surrounding encoding",
    "start": "2476739",
    "end": "2483279"
  },
  {
    "text": "or encryption sort of the deep complexities obviously the source code will you know be in your hand so if you want to take a look at it but that also",
    "start": "2483279",
    "end": "2489970"
  },
  {
    "text": "the implementation costs as well you know none of this stuff is free I'll post some additional resources so you",
    "start": "2489970",
    "end": "2496720"
  },
  {
    "text": "nose area Labs has a good blog sort of detailing a bunch of basic c2 mitre attack framework they have a documented",
    "start": "2496720",
    "end": "2504039"
  },
  {
    "text": "or a documented wiki of a bunch of you know different samples and all of the c2 styles that they used I I use that a lot",
    "start": "2504039",
    "end": "2511150"
  },
  {
    "text": "for referencing material in this presentation blue screen of Jeff has an amazing read to new infrastructure wiki",
    "start": "2511150",
    "end": "2516369"
  },
  {
    "text": "that actually has many of the links I've put in the slideshow on there as well so if you were to visit one link after this",
    "start": "2516369",
    "end": "2522249"
  },
  {
    "text": "presentation it should be that link there's domain fronting lists and also a bunch of tools for sub domain takeover",
    "start": "2522249",
    "end": "2528099"
  },
  {
    "text": "you know in the classic sense where you're looking for cname records that that are abusable and with that you know",
    "start": "2528099",
    "end": "2534640"
  },
  {
    "text": "I want to thank everyone for coming I actually finished early which is pretty good I have my Twitter handles up there",
    "start": "2534640",
    "end": "2540309"
  },
  {
    "text": "and honestly as you couldn't tell by me recording demos in the car ID on the way over here I will upload code soon",
    "start": "2540309",
    "end": "2546339"
  },
  {
    "text": "probably tonight but I couldn't if you want to just monitor my github they'll probably be under there as like you know",
    "start": "2546339",
    "end": "2552730"
  },
  {
    "text": "github.com slash addendum something like that and i guess i want to open the floor for any questions people have I'm",
    "start": "2552730",
    "end": "2558309"
  },
  {
    "text": "you know told to tell you there are microphones if you guys want to line up on the microphones or you were saying",
    "start": "2558309",
    "end": "2570069"
  },
  {
    "text": "that when you were polling the GCP address spaces it caused it to retain",
    "start": "2570069",
    "end": "2576369"
  },
  {
    "text": "the pool and add you maybe use that as a denial of service and basically force it to never give up pools so yeah that's",
    "start": "2576369",
    "end": "2582640"
  },
  {
    "text": "kind of interesting I'm not really sure what there and looks like that might be a possibility my assumption is that",
    "start": "2582640",
    "end": "2588319"
  },
  {
    "text": "they're effectively designing a floating pool for almost a caching reason for anybody who didn't hear his question was",
    "start": "2588319",
    "end": "2593630"
  },
  {
    "text": "effectively in GCP what is the pool mech really mean and could it be used for a",
    "start": "2593630",
    "end": "2598670"
  },
  {
    "text": "denial of service I would assume that they would just expand the pool as necessary there's also a count",
    "start": "2598670",
    "end": "2604220"
  },
  {
    "text": "limitation so by default Google cloud platform only lets you have a certain number of right keys at a time the same",
    "start": "2604220",
    "end": "2609980"
  },
  {
    "text": "thing goes for AWS and Hatcher you can boost those quotas but I'd be surprised if the quotas ever exceeded the pool",
    "start": "2609980",
    "end": "2617230"
  },
  {
    "text": "yeah do you see any advantage to adopting HTTP 3 which is based on UDP",
    "start": "2618730",
    "end": "2624829"
  },
  {
    "text": "instead of TCP oh you know honestly I'm not that familiar with it I can't think",
    "start": "2624829",
    "end": "2629990"
  },
  {
    "text": "of any but I also don't want to say the opposite either oh okay thank you much",
    "start": "2629990",
    "end": "2641030"
  },
  {
    "text": "thank you so much everyone [Applause]",
    "start": "2641030",
    "end": "2646078"
  }
]