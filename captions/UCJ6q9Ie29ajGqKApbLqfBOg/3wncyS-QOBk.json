[
  {
    "start": "0",
    "end": "98000"
  },
  {
    "text": "welcome to he-said she-said poisoned our DP offense and defense by Donna Burrell",
    "start": "30",
    "end": "8069"
  },
  {
    "text": "and I'll get Caen in South Seas a b e before we begin a few brief notes stop",
    "start": "8069",
    "end": "16680"
  },
  {
    "text": "by the business hall located in mandalay bay Oceanside and shoreline ballrooms on",
    "start": "16680",
    "end": "22529"
  },
  {
    "text": "level two during the day and for the Welcome Reception at 5:30 tonight the",
    "start": "22529",
    "end": "28170"
  },
  {
    "text": "black hat Arsenal is in the business hall on level two join us for the pony awards in lagoon JKL",
    "start": "28170",
    "end": "35370"
  },
  {
    "text": "at 18:30 thanks for putting your phones on vibrate it makes it easier for the",
    "start": "35370",
    "end": "41250"
  },
  {
    "text": "rest of us to ignore the ringing while you wait for your voicemail to pick it up for the question and answer session",
    "start": "41250",
    "end": "46710"
  },
  {
    "text": "afterwards please remember to use the microphones available in the ions and with that let us welcome our speakers hi",
    "start": "46710",
    "end": "59609"
  },
  {
    "text": "thank you for joining our session about poisoned our DP offense and defense before we start we would like to",
    "start": "59609",
    "end": "66180"
  },
  {
    "text": "introduce ourselves so my name is Dan auroral I'm a security software engineer working for Microsoft Defender ATP my",
    "start": "66180",
    "end": "74760"
  },
  {
    "text": "job is to investigate new tracks and develop new detections all right thanks",
    "start": "74760",
    "end": "84090"
  },
  {
    "text": "so hi I'm Ellie Kim I'm Avenue ability research other checkpoints this is cool",
    "start": "84090",
    "end": "89820"
  },
  {
    "text": "in this joint research I was focusing on the offensive part and now what we'll",
    "start": "89820",
    "end": "95369"
  },
  {
    "text": "finish with the introduction let's begin as you probably understood from the title of our talk we're going to talk",
    "start": "95369",
    "end": "101640"
  },
  {
    "start": "98000",
    "end": "151000"
  },
  {
    "text": "about a modest of oracle or RTP which raises the question about okay so are",
    "start": "101640",
    "end": "107670"
  },
  {
    "text": "you going to talk about blue key no block Eve is a different vendor ability in the mode d'stefano call it's an",
    "start": "107670",
    "end": "115140"
  },
  {
    "text": "honest allocated remote code execution and vulnerability in Microsoft Store repeat servals this critical",
    "start": "115140",
    "end": "122189"
  },
  {
    "text": "vulnerability was disclosed to Microsoft the UK's national cert in May this year it's gained a lot of media attention and",
    "start": "122189",
    "end": "129890"
  },
  {
    "text": "many security researchers feel that it might be used if my doctor is to initiate a new wave",
    "start": "129890",
    "end": "136090"
  },
  {
    "text": "of wanna cry like ransom however in this talk we're going to",
    "start": "136090",
    "end": "141250"
  },
  {
    "text": "represent and focus on a different attack vector which focuses on clients",
    "start": "141250",
    "end": "147190"
  },
  {
    "text": "not the server itself let's begin no",
    "start": "147190",
    "end": "152380"
  },
  {
    "start": "151000",
    "end": "227000"
  },
  {
    "text": "motivation for our research lies in what we define as lazy lateral movement",
    "start": "152380",
    "end": "157860"
  },
  {
    "text": "usually an attack on an organization starts in a way that the threat doctor",
    "start": "157860",
    "end": "164530"
  },
  {
    "text": "already has one computer but was already compromised via a USB or phishing email",
    "start": "164530",
    "end": "170800"
  },
  {
    "text": "or anything like it and once it has a single compromised machine in the core boy network it will use it to start the",
    "start": "170800",
    "end": "178600"
  },
  {
    "text": "second phase of the attack which is called lateral movement in the lateral movement phase the attacker will use",
    "start": "178600",
    "end": "183970"
  },
  {
    "text": "initial foothold inside the organization and will try to exploit multiple",
    "start": "183970",
    "end": "190030"
  },
  {
    "text": "vulnerabilities to spread throughout the network to compromised computers and servers alike in order to harvest as",
    "start": "190030",
    "end": "196540"
  },
  {
    "text": "many credentials as it could and essentially hoping to take over the",
    "start": "196540",
    "end": "202360"
  },
  {
    "text": "entire an organizational network however we're thinking about what if our threat",
    "start": "202360",
    "end": "208299"
  },
  {
    "text": "actor doesn't have such a large variety of vulnerabilities therefore we define a",
    "start": "208299",
    "end": "213549"
  },
  {
    "text": "new attack vector called lazy lateral moving and this time attacker will want",
    "start": "213549",
    "end": "218680"
  },
  {
    "text": "a strong users inside a network to somehow connect the act to the already",
    "start": "218680",
    "end": "224019"
  },
  {
    "text": "compromised single machine inside a network if we could ambush privileged",
    "start": "224019",
    "end": "230560"
  },
  {
    "text": "users and allow them to connect to our machine maybe we could leverage this",
    "start": "230560",
    "end": "235690"
  },
  {
    "text": "connection and exploit vulnerabilities over the connection to take over the connecting client this could be",
    "start": "235690",
    "end": "242200"
  },
  {
    "text": "applicable for IT staff for example we would want to harvest and collect a strong credentials such as domain admin",
    "start": "242200",
    "end": "249970"
  },
  {
    "text": "password inside the network and from my day to day life it could be applicable also for my",
    "start": "249970",
    "end": "256989"
  },
  {
    "text": "researchers my researchers tend to execute marrow samples on a daily basis in isolated virtual machines",
    "start": "256989",
    "end": "263860"
  },
  {
    "text": "and once in a while the male researcher will back to the machine and check up on the status of the EMR well if the model",
    "start": "263860",
    "end": "270819"
  },
  {
    "text": "could leverage this connection and exploit a vulnerability in a software it",
    "start": "270819",
    "end": "276430"
  },
  {
    "text": "could escape the isolated virtual machine and infect the computer of the Marvel researcher so essentially our",
    "start": "276430",
    "end": "284940"
  },
  {
    "text": "motivation is we want to lure people to specific machines and check if it would",
    "start": "284940",
    "end": "292509"
  },
  {
    "text": "hijack the incoming connection once we define this motivation the goal and the subject for the research was quite clear",
    "start": "292509",
    "end": "299199"
  },
  {
    "start": "299000",
    "end": "352000"
  },
  {
    "text": "which was the focus on RDP whenever remote desktop protocol for those of you",
    "start": "299199",
    "end": "304930"
  },
  {
    "text": "who are not familiar with RDP RDP is used to connect to remote Windows machines the basic terms of the protocol",
    "start": "304930",
    "end": "310840"
  },
  {
    "text": "are that a client is going to connect into a remote Windows Server although",
    "start": "310840",
    "end": "316360"
  },
  {
    "text": "it's called silver it could be a remote cooperate standard computer it could be a physical server and it could also be a",
    "start": "316360",
    "end": "323560"
  },
  {
    "text": "local or remote virtual machine if probably know RDP also as NSPS see after",
    "start": "323560",
    "end": "330909"
  },
  {
    "text": "Microsoft's built in an RDP client called mstc dot xn and just as a side",
    "start": "330909",
    "end": "336580"
  },
  {
    "text": "note all of the attacks were going to present in this talk a done require elevated privileges or admin privileges",
    "start": "336580",
    "end": "343419"
  },
  {
    "text": "any user could perform the attack we're going to present now that we talked",
    "start": "343419",
    "end": "348789"
  },
  {
    "text": "about RDP what is poison or even in a",
    "start": "348789",
    "end": "354009"
  },
  {
    "start": "352000",
    "end": "437000"
  },
  {
    "text": "poison RDP attack scenario we already said that if a doctor has an initial foothold inside the corporate computer",
    "start": "354009",
    "end": "359529"
  },
  {
    "text": "and it wants to infect the IT staff instead of the marvelous tank stealth as",
    "start": "359529",
    "end": "365050"
  },
  {
    "text": "usually mud will do we will try to do exactly the opposite we will pop up",
    "start": "365050",
    "end": "370630"
  },
  {
    "text": "randomly all messages slow down the computer and essentially do the maximum we can to make the life of the cooperate",
    "start": "370630",
    "end": "377409"
  },
  {
    "text": "user as miserable as possible this is so that the corporate user will open up a",
    "start": "377409",
    "end": "382479"
  },
  {
    "text": "ticket to the help desk saying please help me something is wrong with my computer hey hopefully after the waco to",
    "start": "382479",
    "end": "388810"
  },
  {
    "text": "someone from help desk will actually handle the ticket and connect back to our machines we are already people this",
    "start": "388810",
    "end": "396490"
  },
  {
    "text": "is where the attack starts we will hope to find vulnerabilities in a particle itself or in the RDP client exploit",
    "start": "396490",
    "end": "403310"
  },
  {
    "text": "these vulnerabilities and take over the computer of the connecting IT staff we",
    "start": "403310",
    "end": "409190"
  },
  {
    "text": "could try to collect strong credentials from the victim but our main goal will be to attack and takeover the computer",
    "start": "409190",
    "end": "416120"
  },
  {
    "text": "of the IT staff because we want to laterally move inside the network now",
    "start": "416120",
    "end": "421490"
  },
  {
    "text": "that I define what is poison RDP it's quite clear but we're going to focus on party P clients for this visit ok so we",
    "start": "421490",
    "end": "439190"
  },
  {
    "start": "437000",
    "end": "479000"
  },
  {
    "text": "have several RDP clients we have first of all we have open source clients the first client is our desktop it's a quite",
    "start": "439190",
    "end": "446510"
  },
  {
    "text": "basic RDP client it doesn't support a lot of features but it's the built-in RDP client in Kali Linux for example",
    "start": "446510",
    "end": "453460"
  },
  {
    "text": "after that we have we are deep in therapy is way more mature it supports",
    "start": "453460",
    "end": "458690"
  },
  {
    "text": "many more features and it's way more popular in Geeta as you can see over there and last but not least we have a",
    "start": "458690",
    "end": "465920"
  },
  {
    "text": "Microsoft built-in RDP client called MSDS C dot X which is by far the most",
    "start": "465920",
    "end": "471550"
  },
  {
    "text": "widely used RDP client out there having free clients we had to decide ok where",
    "start": "471550",
    "end": "477980"
  },
  {
    "text": "should we start and we decided to focus on the easiest target to begin with and",
    "start": "477980",
    "end": "483080"
  },
  {
    "start": "479000",
    "end": "571000"
  },
  {
    "text": "this is hardest on our desktop is open source it supports the least amount of",
    "start": "483080",
    "end": "488930"
  },
  {
    "text": "features and it has least amount of code lines when we check it up so our desktop",
    "start": "488930",
    "end": "495380"
  },
  {
    "text": "was a clear choice to begin with when we want to start with the easiest target being of it so we could audit the code",
    "start": "495380",
    "end": "502370"
  },
  {
    "text": "and actually learn how RDP works because up until now no one described to me how the protocol actually works and for my",
    "start": "502370",
    "end": "509990"
  },
  {
    "text": "personal experience auditing the code and learning the form the code about the protocol is much more useful when",
    "start": "509990",
    "end": "516950"
  },
  {
    "text": "reading the standards because you can only see features with someone actually implemented and you hope that people",
    "start": "516950",
    "end": "523130"
  },
  {
    "text": "actually use these features but if you read standards you can find in a future annex or an appendix but no one actually",
    "start": "523130",
    "end": "530060"
  },
  {
    "text": "implemented by the industry so auditing the code is my preferred weapon of choice and so",
    "start": "530060",
    "end": "536730"
  },
  {
    "text": "we started already in the code and learning how our DP works the goal was to focus on potentially",
    "start": "536730",
    "end": "543120"
  },
  {
    "text": "vulnerable features and models so hopefully we will have a specific feature that is bound to also",
    "start": "543120",
    "end": "549810"
  },
  {
    "text": "vulnerabilities and maybe it will include vulnerabilities in multiple RDP clients and not only in Odessa gradually",
    "start": "549810",
    "end": "557460"
  },
  {
    "text": "when we audit the code we gain confidence and once we think we finished covering off this specific client we'll",
    "start": "557460",
    "end": "563910"
  },
  {
    "text": "move on to the next client and continue on with our research auditing the code",
    "start": "563910",
    "end": "569730"
  },
  {
    "text": "we learned a few things about RDP and this is the protocol consists of logical",
    "start": "569730",
    "end": "575310"
  },
  {
    "start": "571000",
    "end": "648000"
  },
  {
    "text": "channels this is a modular design that means you have a channel for audio a channel for video and a channel even for",
    "start": "575310",
    "end": "582360"
  },
  {
    "text": "clipboard so we have a channel for everything in the code audit you just need to know that you covered each of",
    "start": "582360",
    "end": "588870"
  },
  {
    "text": "the channels just as a side note blue key will exploit vulnerabilities in the internal MST a 120 channel which was",
    "start": "588870",
    "end": "597120"
  },
  {
    "text": "supposed to be private what was a public and accessible to clients as well in",
    "start": "597120",
    "end": "603330"
  },
  {
    "text": "addition RDP have a support for multiple authentication methods it's not really",
    "start": "603330",
    "end": "608520"
  },
  {
    "text": "an interesting from our side because in our case the silver will exploit vulnerabilities in the client and the",
    "start": "608520",
    "end": "614910"
  },
  {
    "text": "client is supposed to authenticate itself against the server so the server could essentially say yeah ok please",
    "start": "614910",
    "end": "620700"
  },
  {
    "text": "connect and then exploit the client in addition we have screen updates when you",
    "start": "620700",
    "end": "626430"
  },
  {
    "text": "see a screen you have several updates and each updates is represented as bitmap not a PNG file or the JPEG image",
    "start": "626430",
    "end": "633360"
  },
  {
    "text": "playing all bitmaps and that's it and as I mentioned earlier we also have",
    "start": "633360",
    "end": "638580"
  },
  {
    "text": "basically four types that are shared between the client and the server computer now that we learned about the",
    "start": "638580",
    "end": "645660"
  },
  {
    "text": "RDP protocol we audited the code of our desktop we actually found out that our desktop users really naive the C code",
    "start": "645660",
    "end": "652500"
  },
  {
    "start": "648000",
    "end": "715000"
  },
  {
    "text": "with less than minimal checks most of the times most of the times out even now",
    "start": "652500",
    "end": "657870"
  },
  {
    "text": "checks that minimal input was received before someone actually parses a packet which is quite a common mistake in",
    "start": "657870",
    "end": "664730"
  },
  {
    "text": "implementations of network protocols and we find a few interesting vulnerabilities and according to this",
    "start": "664730",
    "end": "670620"
  },
  {
    "text": "specific bug overall we found 11 critical vulnerabilities in this",
    "start": "670620",
    "end": "677400"
  },
  {
    "text": "specific client and 19 Vernor abilities overall which was quite high here you",
    "start": "677400",
    "end": "683010"
  },
  {
    "text": "can see the list of the CVA DS and if you'll do the math fast enough you can see we have only 10 CV IDs in this list",
    "start": "683010",
    "end": "690000"
  },
  {
    "text": "then that's mainly because we weren't planning on finding so many vulnerabilities in our desktops so we ran out of CVA DS we had to ask",
    "start": "690000",
    "end": "697590"
  },
  {
    "text": "Mitel for additional cv IDs for this research we got an additional a bulk of",
    "start": "697590",
    "end": "702840"
  },
  {
    "text": "cv ids and here the full list of vulnerabilities for this specific client",
    "start": "702840",
    "end": "709670"
  },
  {
    "text": "we found much more vulnerabilities when we when we hope for and we hope this is",
    "start": "709670",
    "end": "715830"
  },
  {
    "start": "715000",
    "end": "801000"
  },
  {
    "text": "a good start for the next clients as well in addition we'll also find a complicated feature and it turns out",
    "start": "715830",
    "end": "722160"
  },
  {
    "text": "parsing bitmaps is actually complex when you send a bitmap bitmap update it has",
    "start": "722160",
    "end": "728040"
  },
  {
    "text": "its own width height and amount of bits per pixel the attacker can control each",
    "start": "728040",
    "end": "733320"
  },
  {
    "text": "of these fields which are 16 bits in length afterwards all these field will be",
    "start": "733320",
    "end": "739890"
  },
  {
    "text": "multiplied to allocate a heap buffer that will contain the decompressed",
    "start": "739890",
    "end": "745380"
  },
  {
    "text": "bitmap that was sent over the channel however since we as an attackers control",
    "start": "745380",
    "end": "750780"
  },
  {
    "text": "each of these fields if you position these specific values in each of the",
    "start": "750780",
    "end": "756150"
  },
  {
    "text": "fields upon and multiply which will overflow the 32 bits of the variables",
    "start": "756150",
    "end": "763860"
  },
  {
    "text": "and will get truncated down to the value we can see over here this means that the logical size of the allocated buffer",
    "start": "763860",
    "end": "771210"
  },
  {
    "text": "will be smaller than the actual size of the allocated buffer will be smaller than the logical size with the",
    "start": "771210",
    "end": "777480"
  },
  {
    "text": "decompression will try to use so we're actually going to write more bytes over the he buffer essentially giving us a he",
    "start": "777480",
    "end": "784500"
  },
  {
    "text": "base buffer overflow when decompressing the bitmap so among this thing up as a complicated",
    "start": "784500",
    "end": "790140"
  },
  {
    "text": "feature and hoping we'll find it again in several our RDP clients afterwards",
    "start": "790140",
    "end": "796100"
  },
  {
    "text": "okay we finish P bar desktop which weren't quite good time to check if we have",
    "start": "796100",
    "end": "801180"
  },
  {
    "text": "with three OTP as well and faeo DP was a tough target the C code looks better way",
    "start": "801180",
    "end": "807720"
  },
  {
    "text": "it still has a few cracks when you look deep enough but it has no checks it more documented it supports more features it",
    "start": "807720",
    "end": "815850"
  },
  {
    "text": "has better code quality however it's still vulnerable to the exact same bitmap our scene with Justine so we had",
    "start": "815850",
    "end": "823200"
  },
  {
    "text": "a good start we found five critical vulnerabilities in this client and sixth",
    "start": "823200",
    "end": "828240"
  },
  {
    "text": "a vulnerability overall and here are the CV ideas for Theo DP so we found",
    "start": "828240",
    "end": "835350"
  },
  {
    "text": "vulnerabilities in our desktop we found vulnerabilities in few DP time to check if you have more luck with Microsoft's",
    "start": "835350",
    "end": "841830"
  },
  {
    "text": "client st0 text and in short no we had",
    "start": "841830",
    "end": "858420"
  },
  {
    "start": "857000",
    "end": "915000"
  },
  {
    "text": "less luck with MSDS seeded excellent we tried out of the PhDs from the previous vulnerabilities simply executing the",
    "start": "858420",
    "end": "864870"
  },
  {
    "text": "script and checking if they work and RDP client simply closed itself you've no crash no warning nothing so all the",
    "start": "864870",
    "end": "872400"
  },
  {
    "text": "previous vulnerabilities don't work so I started reverse engineering MCC dodeca",
    "start": "872400",
    "end": "878940"
  },
  {
    "text": "and we can even see that the code is more robust they actually use smart",
    "start": "878940",
    "end": "884670"
  },
  {
    "text": "buffers to check for parsing the hellos which is quite a good protection against most parts and whenever it is and you",
    "start": "884670",
    "end": "892230"
  },
  {
    "text": "can actually see when you order the code but you see see that X includes many more features it's way more complex and",
    "start": "892230",
    "end": "900570"
  },
  {
    "text": "it's in several orders of magnitude better than the open source clients we previously audited it's gonna be a tough",
    "start": "900570",
    "end": "907740"
  },
  {
    "text": "target and at this point were kinda stuck because all previous leads fellows",
    "start": "907740",
    "end": "913910"
  },
  {
    "text": "so essentially it's back to the drawing board and so it was actually back to the",
    "start": "913910",
    "end": "922350"
  },
  {
    "start": "915000",
    "end": "1014000"
  },
  {
    "text": "clipboard because up until now the clipboard shared basic text types we had CF decks for ASCII and CF Unicode x4",
    "start": "922350",
    "end": "929730"
  },
  {
    "text": "well for Unicode because Linux machines have to specifically support",
    "start": "929730",
    "end": "934889"
  },
  {
    "text": "it's support each format when connecting to the remote Windows server but when you have a Windows machine connecting to",
    "start": "934889",
    "end": "942029"
  },
  {
    "text": "a Windows machine you could essentially synchronize the same clipboard on both machines so microcell supports many more",
    "start": "942029",
    "end": "948269"
  },
  {
    "text": "formats now and we have a much broader attack crypto in the clipboard so so",
    "start": "948269",
    "end": "954209"
  },
  {
    "text": "let's dig in on how the clipboard actually works you'll probably be familiar the clipboard uses it on a daily basis",
    "start": "954209",
    "end": "960389"
  },
  {
    "text": "it's a kernel data structure that stores well data you have one clipboard per",
    "start": "960389",
    "end": "965519"
  },
  {
    "text": "session from our perspective it's in 1/3 board per RDP connection and it's shared",
    "start": "965519",
    "end": "971879"
  },
  {
    "text": "between processes because usually a copy of our new password from notepad or text to Chrome",
    "start": "971879",
    "end": "979189"
  },
  {
    "text": "so it's shared between the processes the data itself is told by an ID or by name",
    "start": "979189",
    "end": "985470"
  },
  {
    "text": "you have a format ID or format name for each format and you should really be",
    "start": "985470",
    "end": "991529"
  },
  {
    "text": "cautious when using the clipboard and clipboard a that should not be trusted which really parts the data carefully before you use it in your own",
    "start": "991529",
    "end": "998009"
  },
  {
    "text": "application and if you think with only me saying that that's absolutely a quote",
    "start": "998009",
    "end": "1003049"
  },
  {
    "text": "for - DM immediately when we saw this quote we knew we're going to find",
    "start": "1003049",
    "end": "1008059"
  },
  {
    "text": "vulnerabilities because that's a good quote - ok no one will check the data we're going",
    "start": "1008059",
    "end": "1013369"
  },
  {
    "text": "to be fine but we are interested on the clipboard over the RDP and protocol and",
    "start": "1013369",
    "end": "1020179"
  },
  {
    "start": "1014000",
    "end": "1089000"
  },
  {
    "text": "everything in the clipboard is going to be synchronized automatically and the Clifford is defined as a shared resource",
    "start": "1020179",
    "end": "1025548"
  },
  {
    "text": "and it's shared by default and this means Microsoft only uses blacklists to",
    "start": "1025549",
    "end": "1031308"
  },
  {
    "text": "filter out specific formats but they're using blacklist instead of widely so it's not a good security perspective but",
    "start": "1031309",
    "end": "1039199"
  },
  {
    "text": "from an attackers perspective that's good news we're probably going to handle these",
    "start": "1039199",
    "end": "1044720"
  },
  {
    "text": "black lists so you have a black list for a formats but it won't be discarded by",
    "start": "1044720",
    "end": "1049789"
  },
  {
    "text": "their ID and a blacklist for formats will will be discarded by the name and",
    "start": "1049789",
    "end": "1055269"
  },
  {
    "text": "one final note on RDP you have something called delayed rendering this means what",
    "start": "1055269",
    "end": "1062389"
  },
  {
    "text": "when you copy is something you only get the list of available formats but another content because it could be",
    "start": "1062389",
    "end": "1068990"
  },
  {
    "text": "heavy to copy all of the data if you're not going to paste anything this means that if you copy a password",
    "start": "1068990",
    "end": "1074390"
  },
  {
    "text": "and close the OTP connection you won't be able to paste the password you only know was something of text but",
    "start": "1074390",
    "end": "1081380"
  },
  {
    "text": "you don't know what's the text because no one sent it to you and here's where",
    "start": "1081380",
    "end": "1087290"
  },
  {
    "text": "it becomes really interesting because essentially you have also dragon block",
    "start": "1087290",
    "end": "1092690"
  },
  {
    "start": "1089000",
    "end": "1204000"
  },
  {
    "text": "diagonal Bob is the internal name Microsoft uses to copy files and file copy operation uses multiple clipboard",
    "start": "1092690",
    "end": "1099650"
  },
  {
    "text": "formats you have one format called cfh blob which lists the file names an",
    "start": "1099650",
    "end": "1105040"
  },
  {
    "text": "additional format called file group descriptor with all of them a full metadata of all of the copying files and",
    "start": "1105040",
    "end": "1111800"
  },
  {
    "text": "you have additional many many more and formats for file copy operations let us",
    "start": "1111800",
    "end": "1118220"
  },
  {
    "text": "now see how it actually works in practice we have a user on the right going to copy a file form the RDP server",
    "start": "1118220",
    "end": "1124610"
  },
  {
    "text": "on the Left when it and when our user is going to initiate the copy operation it",
    "start": "1124610",
    "end": "1130280"
  },
  {
    "text": "will populate the clipboard on the server with all of the format's necessary to copy files the server will",
    "start": "1130280",
    "end": "1136190"
  },
  {
    "text": "then want to notify the client about each of the available formats so the first format is cfh swap but it's going",
    "start": "1136190",
    "end": "1143990"
  },
  {
    "text": "to be filled out by the blacklist and we have all social ID and essentially only",
    "start": "1143990",
    "end": "1151640"
  },
  {
    "text": "five of the script will pass the blacklist invert it only this specific format and since we have delayed",
    "start": "1151640",
    "end": "1157850"
  },
  {
    "text": "rendering the client only knows was an available file group descriptor but not if contact once the client was started",
    "start": "1157850",
    "end": "1165590"
  },
  {
    "text": "pasted it will request the file descriptor form the silver the silver for some unknown reason will intercept",
    "start": "1165590",
    "end": "1172880"
  },
  {
    "text": "this request and exchange it with the request for cfh table and requests if Israel format form its own report once",
    "start": "1172880",
    "end": "1181130"
  },
  {
    "text": "it gets the data it will manually convert it back to in fact of the script over the client initially asked for and",
    "start": "1181130",
    "end": "1187130"
  },
  {
    "text": "will send the data itself to the client now the client knows which files were actually being copied on the server",
    "start": "1187130",
    "end": "1193910"
  },
  {
    "text": "itself so we could query for the file content of each file and get the copied file that",
    "start": "1193910",
    "end": "1199860"
  },
  {
    "text": "computer and that essentially how you copy files over our DP the main",
    "start": "1199860",
    "end": "1207150"
  },
  {
    "start": "1204000",
    "end": "1234000"
  },
  {
    "text": "structure inside this process is file descriptor 5 of descriptor is a",
    "start": "1207150",
    "end": "1212970"
  },
  {
    "text": "proprietary blob structure it contains the list of filer codes and in each record we can see we have a meta",
    "start": "1212970",
    "end": "1219270"
  },
  {
    "text": "data for example time stamps and the files path and in our examples it should",
    "start": "1219270",
    "end": "1224549"
  },
  {
    "text": "always be the file name of the copied file the client will get the data from",
    "start": "1224549",
    "end": "1231330"
  },
  {
    "text": "the server and happily pass it on to the clipboard at this point of the result one of the main team members or mode I",
    "start": "1231330",
    "end": "1238080"
  },
  {
    "text": "told me to try to find out where the sanitized the received F so I tried I really really really tried but I",
    "start": "1238080",
    "end": "1245669"
  },
  {
    "text": "couldn't find anywhere where they sanitized the path so I told the server to send a file name of dot dot slash",
    "start": "1245669",
    "end": "1251730"
  },
  {
    "text": "file name dot txt and the client happily received this file stored it in the",
    "start": "1251730",
    "end": "1257250"
  },
  {
    "text": "clipboard and even explore dot except happily notifies us that he is now going to copy a file name called dot dot slash",
    "start": "1257250",
    "end": "1264330"
  },
  {
    "text": "file named dot txt and this essentially means we found a path level cell over",
    "start": "1264330",
    "end": "1270150"
  },
  {
    "start": "1267000",
    "end": "1297000"
  },
  {
    "text": "the RDP protocol we notified Microsoft received an official CV for this venerable VL frequency and to break this",
    "start": "1270150",
    "end": "1278250"
  },
  {
    "text": "down when using copy and paste over RTP a malicious server can block arbitrary",
    "start": "1278250",
    "end": "1283470"
  },
  {
    "text": "files to arbitrary file occasions on the clients file system you can simply drop",
    "start": "1283470",
    "end": "1289200"
  },
  {
    "text": "your marvel into the startup folder of the client and that's it upon reboot you have code execution on",
    "start": "1289200",
    "end": "1294600"
  },
  {
    "text": "the client but we wanted more if you take it one step further the clipboards",
    "start": "1294600",
    "end": "1301110"
  },
  {
    "start": "1297000",
    "end": "1315000"
  },
  {
    "text": "are fully synchronized this means that when you copy you update a clipboard this sends a clipboard er format list",
    "start": "1301110",
    "end": "1308100"
  },
  {
    "text": "message to the other side and the other side will update its clipboard accordingly but what does it mean the",
    "start": "1308100",
    "end": "1315780"
  },
  {
    "start": "1315000",
    "end": "1336000"
  },
  {
    "text": "first scenario is eavesdropping if you copy a password I get it too and that's",
    "start": "1315780",
    "end": "1321000"
  },
  {
    "text": "not a bug that's an actual feature because the clip words are fully synchronized but it also means that if",
    "start": "1321000",
    "end": "1328800"
  },
  {
    "text": "the client is copying a file I know about it too so this leads us to the second scenario",
    "start": "1328800",
    "end": "1335760"
  },
  {
    "text": "being pasted on the attacks in a paste on e attack we once again ambushed the",
    "start": "1335760",
    "end": "1341040"
  },
  {
    "start": "1336000",
    "end": "1371000"
  },
  {
    "text": "client when a client is going to copy a file we will start up on attack we will send an update message until the client",
    "start": "1341040",
    "end": "1348000"
  },
  {
    "text": "but we also copied something and send him our malicious file descriptor with the path of L so when the client will",
    "start": "1348000",
    "end": "1354450"
  },
  {
    "text": "unknowingly paste the data it will trigger the path over sir we initially propell did we break them all we find",
    "start": "1354450",
    "end": "1363810"
  },
  {
    "text": "only realities in the three most popular or AP clients so it's probably yes but",
    "start": "1363810",
    "end": "1369120"
  },
  {
    "text": "no we didn't like them all yet time to move on to hyper-v I never use type of",
    "start": "1369120",
    "end": "1375150"
  },
  {
    "start": "1371000",
    "end": "1406000"
  },
  {
    "text": "it till now but Microsoft allows you to use virtual machines on your Windows operating systems using a hyper-v",
    "start": "1375150",
    "end": "1382230"
  },
  {
    "text": "technology this means I install hyper-v on my Windows machine started a Windows",
    "start": "1382230",
    "end": "1388890"
  },
  {
    "text": "virtual machine try to connect to it using the hyper-v GUI manager and I saw",
    "start": "1388890",
    "end": "1394170"
  },
  {
    "text": "this suspicious-looking dialog box this is the exact same dialog box form RDP",
    "start": "1394170",
    "end": "1400200"
  },
  {
    "text": "but I used hyper-v manager not Arabic line and you can even see that the clipboard is shirt behind the scenes",
    "start": "1400200",
    "end": "1408360"
  },
  {
    "start": "1406000",
    "end": "1458000"
  },
  {
    "text": "Microsoft uses RDP for accessing the virtual machines even when you use hyper-v on your machine in fact mainly",
    "start": "1408360",
    "end": "1415680"
  },
  {
    "text": "because Microsoft already implemented the code needed for seeing the screen",
    "start": "1415680",
    "end": "1420750"
  },
  {
    "text": "sending keystrokes sharing the clipboard so there's no real need to reemployment",
    "start": "1420750",
    "end": "1426750"
  },
  {
    "text": "and implement again all of these features Microsoft decided to simply use RDP for the GUI connection in your hype",
    "start": "1426750",
    "end": "1433710"
  },
  {
    "text": "of a manager when you use hybl vzm so behind the scenes we actually have",
    "start": "1433710",
    "end": "1439530"
  },
  {
    "text": "RDP once I saw this dialog I simply ran again the same plc i had earlier for RDP",
    "start": "1439530",
    "end": "1445980"
  },
  {
    "text": "and it worked on the first attempt and actually this means that the same part of the cell over RDP",
    "start": "1445980",
    "end": "1452730"
  },
  {
    "text": "is now a guest to host vm escape for my hype of the virtual machine so let's see",
    "start": "1452730",
    "end": "1458130"
  },
  {
    "start": "1458000",
    "end": "1525000"
  },
  {
    "text": "a video this is a video over the hyper-v and test case when we start we can see",
    "start": "1458130",
    "end": "1466500"
  },
  {
    "text": "that the clients are folder is empty now we'll try to connect",
    "start": "1466500",
    "end": "1472889"
  },
  {
    "text": "to the a hyper-v machine using a hyper-v manager initiating the connection just a",
    "start": "1472889",
    "end": "1483419"
  },
  {
    "text": "plain old VM that's it and as you can see it's a plain old VM it's a malicious",
    "start": "1483419",
    "end": "1489299"
  },
  {
    "text": "VM but the client doesn't know it yet and now when the client is going to copy an innocent text file from his local",
    "start": "1489299",
    "end": "1496499"
  },
  {
    "text": "computer will hijack this operation",
    "start": "1496499",
    "end": "1503070"
  },
  {
    "text": "prepare a malicious v of the script oh and when the client will paste the same file his computer or startup the startup",
    "start": "1503070",
    "end": "1510359"
  },
  {
    "text": "folder of the client will contain our malicious script inside it because we hijacked the copy operation we will",
    "start": "1510359",
    "end": "1516119"
  },
  {
    "text": "paste only attack invert it after the reboot the client will execute all",
    "start": "1516119",
    "end": "1521190"
  },
  {
    "text": "Marwell from his startup one last note w da g WD d stands for",
    "start": "1521190",
    "end": "1529679"
  },
  {
    "start": "1525000",
    "end": "1582000"
  },
  {
    "text": "Windows Defender application guard this essentially means you have a virtualized edge puzzle you could use to browse",
    "start": "1529679",
    "end": "1536609"
  },
  {
    "text": "risky websites safely you need to see",
    "start": "1536609",
    "end": "1542460"
  },
  {
    "text": "your at Basel so once again use already P to connect to the remote VM this time",
    "start": "1542460",
    "end": "1548519"
  },
  {
    "text": "we use H psi RDP client instead of MCC detects this change means that Microsoft",
    "start": "1548519",
    "end": "1554669"
  },
  {
    "text": "decided to once in this case use whitelists instead of necklace and the",
    "start": "1554669",
    "end": "1559919"
  },
  {
    "text": "clipboard starts off by default and when you use it you can only use two foreign",
    "start": "1559919",
    "end": "1565230"
  },
  {
    "text": "types for text or images and that's it and this whitelist blocks our attack and",
    "start": "1565230",
    "end": "1571320"
  },
  {
    "text": "we it means essentially it stops our vulnerability you can't use it on WDET",
    "start": "1571320",
    "end": "1577679"
  },
  {
    "text": "that's good news Microsoft and time to move on to the defense part by Donna so",
    "start": "1577679",
    "end": "1586379"
  },
  {
    "start": "1582000",
    "end": "1629000"
  },
  {
    "text": "they are reported he's finding to Microsoft through the bug bounty program and then Microsoft started to analyze",
    "start": "1586379",
    "end": "1595310"
  },
  {
    "text": "oh it's finding and started to work on a patch and this is where I stepped in",
    "start": "1595310",
    "end": "1601880"
  },
  {
    "text": "because I was thinking to myself you know this moment where a new path is",
    "start": "1601880",
    "end": "1608720"
  },
  {
    "text": "released and a new owner ability is published and everyone are freaking out",
    "start": "1608720",
    "end": "1614630"
  },
  {
    "text": "trying to install the patch as fast as they can in order to stay safe I try to",
    "start": "1614630",
    "end": "1623570"
  },
  {
    "text": "find a solution for this scenario and this is where I realized that a patch is not enough because user remain",
    "start": "1623570",
    "end": "1630800"
  },
  {
    "start": "1629000",
    "end": "1741000"
  },
  {
    "text": "vulnerable until they install the patch so I was looking for a way to protect",
    "start": "1630800",
    "end": "1636470"
  },
  {
    "text": "the users without any installation without any need to install the patch so",
    "start": "1636470",
    "end": "1642700"
  },
  {
    "text": "what I try to do is to develop a new detection based on existing telemetry",
    "start": "1642700",
    "end": "1649330"
  },
  {
    "text": "that already exists in Windows 10 versions so this way customer can stay",
    "start": "1649330",
    "end": "1656570"
  },
  {
    "text": "secured without updating to the new patch so I have a few ground rules when",
    "start": "1656570",
    "end": "1663830"
  },
  {
    "text": "I started to work on my decoction logic so my first of all was yes I should use",
    "start": "1663830",
    "end": "1669890"
  },
  {
    "text": "only existing telemetry in Windows 10 that are already available to the users",
    "start": "1669890",
    "end": "1676630"
  },
  {
    "text": "my second run rule was that I should be able to detect this bridge from the",
    "start": "1676630",
    "end": "1683000"
  },
  {
    "text": "victim side from the victim machine so as I mentioned before we have two",
    "start": "1683000",
    "end": "1688340"
  },
  {
    "text": "machines here one machine that is already compromised which we mostly refer as the server machine and one",
    "start": "1688340",
    "end": "1695210"
  },
  {
    "text": "machine which is the client machine and this is where the attack is moving forward to so I've tried to develop a",
    "start": "1695210",
    "end": "1703340"
  },
  {
    "text": "detection from the client side and protect the client from this threat my",
    "start": "1703340",
    "end": "1712330"
  },
  {
    "text": "initial instinct was maybe to use an RDP anomaly detection but unfortunately for",
    "start": "1712330",
    "end": "1719450"
  },
  {
    "text": "this attack scenario this detection won't work the reason it won't work because we don't have any RDP unusual behavior in",
    "start": "1719450",
    "end": "1727070"
  },
  {
    "text": "this scenario the user is initiating the connection and",
    "start": "1727070",
    "end": "1732529"
  },
  {
    "text": "therefore we won't expect to see any abnormal behavior in this case so I had",
    "start": "1732529",
    "end": "1740240"
  },
  {
    "text": "to work harder I decided to use existing telemetry from Windows 10 which call etw",
    "start": "1740240",
    "end": "1747549"
  },
  {
    "start": "1741000",
    "end": "1799000"
  },
  {
    "text": "it stands for event tracing for Windows and this is a built-in tool so in",
    "start": "1747549",
    "end": "1753980"
  },
  {
    "text": "Windows for all Windows 10 versions this is basically a Windows API that allows",
    "start": "1753980",
    "end": "1759490"
  },
  {
    "text": "Windows applications developer to trace their application so this way they can",
    "start": "1759490",
    "end": "1767210"
  },
  {
    "text": "track the different flows they can see which exceptions were thrown in this application they can see the performance",
    "start": "1767210",
    "end": "1774350"
  },
  {
    "text": "so they can basically get information about the usage of their application so",
    "start": "1774350",
    "end": "1780830"
  },
  {
    "text": "as you can see the ATW events are not originally created for security",
    "start": "1780830",
    "end": "1787279"
  },
  {
    "text": "perspective however we can find them very useful for many for many scenarios",
    "start": "1787279",
    "end": "1793809"
  },
  {
    "text": "so for this attack scenario I use two different if UW providers the first",
    "start": "1793809",
    "end": "1800629"
  },
  {
    "start": "1799000",
    "end": "1834000"
  },
  {
    "text": "provider is the RDP connection provider the RDP connection provider includes",
    "start": "1800629",
    "end": "1807470"
  },
  {
    "text": "multiple events I decided to use two specific events the first event is event 131 which is triggered when a new RDP",
    "start": "1807470",
    "end": "1816320"
  },
  {
    "text": "connection is accepted the second event is event 132 which is triggered when",
    "start": "1816320",
    "end": "1823519"
  },
  {
    "text": "which is basically a keepalive event so it is triggered every once in a while notifying that the connection is still",
    "start": "1823519",
    "end": "1830840"
  },
  {
    "text": "alive the second provider used is the clipboard provider",
    "start": "1830840",
    "end": "1836929"
  },
  {
    "start": "1834000",
    "end": "1958000"
  },
  {
    "text": "this is a unique provider since this is a non manifested provider the meaning of",
    "start": "1836929",
    "end": "1843529"
  },
  {
    "text": "non manifester provider is that we don't have a manifest file that includes all",
    "start": "1843529",
    "end": "1848990"
  },
  {
    "text": "the information and all the events that this provider provides so in order to",
    "start": "1848990",
    "end": "1854179"
  },
  {
    "text": "understand which events are included in this provider we actually have to check the code so then the clipboard provide",
    "start": "1854179",
    "end": "1863090"
  },
  {
    "text": "includes multiple events I specifically used specific event that includes the",
    "start": "1863090",
    "end": "1869000"
  },
  {
    "text": "API name so it basically triggered every time an API from the clipboard is called it",
    "start": "1869000",
    "end": "1874730"
  },
  {
    "text": "includes the API that is called so it could be get data say that other clipboard api's it includes some",
    "start": "1874730",
    "end": "1881540"
  },
  {
    "text": "information about the format that was copied and the medium that it was copied to I think clothes information about the",
    "start": "1881540",
    "end": "1888320"
  },
  {
    "text": "weather the API call was successful or not as you can see I was surprised as well",
    "start": "1888320",
    "end": "1894440"
  },
  {
    "text": "we don't have here the clipboard content information so we don't know which file",
    "start": "1894440",
    "end": "1899720"
  },
  {
    "text": "was copied we don't know Stax was copied and initially I was surprised but after",
    "start": "1899720",
    "end": "1907400"
  },
  {
    "text": "I was thinking about it for a while it actually makes sense there are multiple reason why we don't have the clipboard",
    "start": "1907400",
    "end": "1913130"
  },
  {
    "text": "content in this event one reason should is focus more about the size I mean we don't know what's the",
    "start": "1913130",
    "end": "1919940"
  },
  {
    "text": "size of the text or the file we're copying and therefore what we don't want to parse that but I",
    "start": "1919940",
    "end": "1926720"
  },
  {
    "text": "think the major reason we don't have the clipboard content in the clipboard events is because we want to make sure",
    "start": "1926720",
    "end": "1933320"
  },
  {
    "text": "the users remain the users data remain private so if the user for example",
    "start": "1933320",
    "end": "1938480"
  },
  {
    "text": "copies a password we don't want this password to be available in clear test text in the logs right so it actually",
    "start": "1938480",
    "end": "1946280"
  },
  {
    "text": "makes sense and I can understand this boundary why we don't have the clipboard content in the clipboard event so before",
    "start": "1946280",
    "end": "1953660"
  },
  {
    "text": "we can talk about the detection logic I worked with we should see a demo so I",
    "start": "1953660",
    "end": "1961070"
  },
  {
    "start": "1958000",
    "end": "2009000"
  },
  {
    "text": "basically run the same scenario that a y'all showed before the only difference",
    "start": "1961070",
    "end": "1966860"
  },
  {
    "text": "is that we're gonna have an additional windows and the bottom and this window is a tracer so you can see all the",
    "start": "1966860",
    "end": "1974690"
  },
  {
    "text": "different ECW events that are triggered during the attack scenarios from the victim side perspective so we initiate",
    "start": "1974690",
    "end": "1982550"
  },
  {
    "text": "the RDP connection and then we can see that the new RDP event is triggered and",
    "start": "1982550",
    "end": "1988570"
  },
  {
    "text": "then I copy a file and when I face the file on the client machine we can see",
    "start": "1988570",
    "end": "1995390"
  },
  {
    "text": "that multi all clipboard events are triggered the reason we have multiple events and not",
    "start": "1995390",
    "end": "2001179"
  },
  {
    "text": "only one event is because multiple files were pasted behind the sin as you could",
    "start": "2001179",
    "end": "2007179"
  },
  {
    "text": "see before so I took this telemetry and",
    "start": "2007179",
    "end": "2012669"
  },
  {
    "start": "2009000",
    "end": "2087000"
  },
  {
    "text": "try to work on a very basic detection logic using only those etw events so my",
    "start": "2012669",
    "end": "2020110"
  },
  {
    "text": "initial detection logic was okay so I can recognize that I am using that the",
    "start": "2020110",
    "end": "2025360"
  },
  {
    "text": "client machine is in RDP session you can use event 131 or even 132 to recognize",
    "start": "2025360",
    "end": "2031330"
  },
  {
    "text": "an RDP connection and then we considered if during RDP connections we are placing",
    "start": "2031330",
    "end": "2036610"
  },
  {
    "text": "multiple files to the victim machine in a short period of time we should suspect",
    "start": "2036610",
    "end": "2042669"
  },
  {
    "text": "this case we should say okay so multiple files were pasted to the victim machine so maybe we are vulnerable to this",
    "start": "2042669",
    "end": "2050020"
  },
  {
    "text": "vulnerability maybe it was exploited on our machine and we should basically define this machine and suspicious the",
    "start": "2050020",
    "end": "2056349"
  },
  {
    "text": "reason I defined this machine as suspicious and not as already compromised is because I'm not sure if",
    "start": "2056349",
    "end": "2061358"
  },
  {
    "text": "this is the attack scenario or not I mean maybe the user pasted multiple files maybe it's an actual user behavior",
    "start": "2061359",
    "end": "2066849"
  },
  {
    "text": "so my recommendation in this case will be we should maybe trigger scans should scan the machines can different files",
    "start": "2066849",
    "end": "2072790"
  },
  {
    "text": "and see if we find anything suspicious so as you can see this detection logic",
    "start": "2072790",
    "end": "2078520"
  },
  {
    "text": "is very basic and I was looking for a way to improve it so in order to improve",
    "start": "2078520",
    "end": "2084638"
  },
  {
    "text": "it I needed more data so I decided to use a file creation event file creation",
    "start": "2084639",
    "end": "2092560"
  },
  {
    "start": "2087000",
    "end": "2136000"
  },
  {
    "text": "events are very popular every almost every security vendors are using file",
    "start": "2092560",
    "end": "2097900"
  },
  {
    "text": "creation events and there are multiple way to implement them the the basic idea",
    "start": "2097900",
    "end": "2104560"
  },
  {
    "text": "here is that we trigger an event or any other indication every time a new file is created in the machine in order to",
    "start": "2104560",
    "end": "2113200"
  },
  {
    "text": "implement my improved detection I decided to rely on two very basic data",
    "start": "2113200",
    "end": "2120089"
  },
  {
    "text": "properties from the file creation events and this is the file name the file that",
    "start": "2120089",
    "end": "2125800"
  },
  {
    "text": "was basically created and the file creation when the file was created so now I have",
    "start": "2125800",
    "end": "2132059"
  },
  {
    "text": "more data and I can create an improved detection logic so when you detect",
    "start": "2132059",
    "end": "2138180"
  },
  {
    "start": "2136000",
    "end": "2209000"
  },
  {
    "text": "geologic starts right like the basic detection logic so we recognize it on an RDP session and we recognize that",
    "start": "2138180",
    "end": "2145290"
  },
  {
    "text": "multiple files were copied but now with the new data I can correlate the file creation time with the pasting operation",
    "start": "2145290",
    "end": "2153299"
  },
  {
    "text": "timestamps so this way I can actually extract the file name so I can recognize",
    "start": "2153299",
    "end": "2158490"
  },
  {
    "text": "which files were pasted and I can see the directories and this way I can see",
    "start": "2158490",
    "end": "2164010"
  },
  {
    "text": "if play rectory is are different so if basically multiple files were pasted to different directories it means that it",
    "start": "2164010",
    "end": "2171180"
  },
  {
    "text": "we have where basically we were breached using this role ability so in this case we would like to alert and react",
    "start": "2171180",
    "end": "2179069"
  },
  {
    "text": "accordingly so yes I covered the scenario I have a detection logic where",
    "start": "2179069",
    "end": "2185490"
  },
  {
    "text": "- all right so no so as an experience defender I knew at this point that this",
    "start": "2185490",
    "end": "2192960"
  },
  {
    "text": "detection is not enough this detection is custom-made for this specific attack",
    "start": "2192960",
    "end": "2198089"
  },
  {
    "text": "scenario today I'll describe but there are moves there are many attacks and oils out there that are very similar and",
    "start": "2198089",
    "end": "2203640"
  },
  {
    "text": "I was worried that if the attacker will change just a minor step I won't be able to detect it anymore so the way we like",
    "start": "2203640",
    "end": "2211950"
  },
  {
    "start": "2209000",
    "end": "2333000"
  },
  {
    "text": "to think about detection in those scenarios we try to learn the different malicious behaviors that we can",
    "start": "2211950",
    "end": "2218339"
  },
  {
    "text": "recognize in the attack scenario and cover them by detection that are",
    "start": "2218339",
    "end": "2223770"
  },
  {
    "text": "covering the behaviors and all the specific steps the effect scenarios so I",
    "start": "2223770",
    "end": "2230099"
  },
  {
    "text": "looked back on a house attack scenario I try to recognize behaviors I recognized through three malicious behaviors the",
    "start": "2230099",
    "end": "2237869"
  },
  {
    "text": "first behavior recognized was the start of folder as a destination so the the",
    "start": "2237869",
    "end": "2243210"
  },
  {
    "text": "idea in his attack was basically dropping file in the startup folder that was the goal of the attack so I tried to",
    "start": "2243210",
    "end": "2249240"
  },
  {
    "text": "look final approach how to detect this malicious behavior so there are multiple",
    "start": "2249240",
    "end": "2254369"
  },
  {
    "text": "ways to do so one way would be maybe in a normal detection we can basically",
    "start": "2254369",
    "end": "2259470"
  },
  {
    "text": "record a basically tray new files are created in the Start folders recognize anomaly detection",
    "start": "2259470",
    "end": "2266420"
  },
  {
    "text": "based on multiple features from the file creation events and the other way is a",
    "start": "2266420",
    "end": "2272880"
  },
  {
    "text": "more rule-based detection which basically scanning and analyzing each new file that is created under the",
    "start": "2272880",
    "end": "2279030"
  },
  {
    "text": "startup folder so this is the first behavior I recognize another behavior which is",
    "start": "2279030",
    "end": "2284970"
  },
  {
    "text": "the clipboard as an attack scenario or it's an attack vector in this case we",
    "start": "2284970",
    "end": "2291150"
  },
  {
    "text": "can cover it or detect this scenario using file pasting and normally we can",
    "start": "2291150",
    "end": "2297299"
  },
  {
    "text": "use features like the number of files that are pasted or the directories of the files and recognize and normally",
    "start": "2297299",
    "end": "2304650"
  },
  {
    "text": "scenarios the last behavior are recognize is that malicious basically",
    "start": "2304650",
    "end": "2312059"
  },
  {
    "text": "just general malicious file dropping so the goal is to drop malicious files to the victim machine and the best way to",
    "start": "2312059",
    "end": "2319470"
  },
  {
    "text": "write to detect those in this case this behavior is basically by file creation anomaly we can use features like the",
    "start": "2319470",
    "end": "2326010"
  },
  {
    "text": "file name the file path the file creation time and so on and now when I",
    "start": "2326010",
    "end": "2335670"
  },
  {
    "start": "2333000",
    "end": "2402000"
  },
  {
    "text": "feel that our customer our users are safe and can actually keep working",
    "start": "2335670",
    "end": "2342240"
  },
  {
    "text": "without any update we can talk about the update so Microsoft released and OS",
    "start": "2342240",
    "end": "2348569"
  },
  {
    "text": "patch to Windows 10 in last July Tuesday patch which includes this fix",
    "start": "2348569",
    "end": "2355980"
  },
  {
    "text": "for this vulnerability that they are reported and actually the fix was very simple so basically a new method was",
    "start": "2355980",
    "end": "2365400"
  },
  {
    "text": "called in the clipboard flow and you can see here in the in the binaries that",
    "start": "2365400",
    "end": "2371400"
  },
  {
    "text": "this new validate file pass was called and this new method basically verifies",
    "start": "2371400",
    "end": "2377670"
  },
  {
    "text": "before every pasting operation but extracting the file the canonical file",
    "start": "2377670",
    "end": "2384920"
  },
  {
    "text": "extracting all the file paths comparing it to the file name and making sure that",
    "start": "2384920",
    "end": "2390150"
  },
  {
    "text": "they are aligned so basically before every pasting operation we verify that the file we're",
    "start": "2390150",
    "end": "2396760"
  },
  {
    "text": "pasting is actually the one we meant to paste so the size I would like to share",
    "start": "2396760",
    "end": "2406030"
  },
  {
    "start": "2402000",
    "end": "2537000"
  },
  {
    "text": "with you the lessons we've learned during this research the first lesson is about connecting different models so as",
    "start": "2406030",
    "end": "2415569"
  },
  {
    "text": "they all mentioned earlier today the Clippers were designed initially to be",
    "start": "2415569",
    "end": "2420760"
  },
  {
    "text": "used locally and they were not designed to be trusted because multiple applications can access the data in the",
    "start": "2420760",
    "end": "2426819"
  },
  {
    "text": "clipboard but the user behaved and interacted with the clipboard as a safe clipboard as a trusted clipboard when",
    "start": "2426819",
    "end": "2435460"
  },
  {
    "text": "Microsoft introduced a new feature for sharing multiple machines it made sense",
    "start": "2435460",
    "end": "2440890"
  },
  {
    "text": "to make the clipboard shared between those machines it basically it is very",
    "start": "2440890",
    "end": "2446319"
  },
  {
    "text": "very basic user experience and therefore it was natural to have this feature available for RDP connections",
    "start": "2446319",
    "end": "2453119"
  },
  {
    "text": "however this expose machine to a clipboard they can no longer trust and",
    "start": "2453119",
    "end": "2458140"
  },
  {
    "text": "this is how basically this vulnerability was introduced the second lesson we have",
    "start": "2458140",
    "end": "2464380"
  },
  {
    "text": "learned it about Windows Dimitri we realize that Windows telemetry is an important tool in the defender",
    "start": "2464380",
    "end": "2470020"
  },
  {
    "text": "steelbooks it is very useful for defending for defending scenarios for",
    "start": "2470020",
    "end": "2476770"
  },
  {
    "text": "defending models but we actually see attackers using the windows telemetry",
    "start": "2476770",
    "end": "2482950"
  },
  {
    "text": "into considerations when they perform new attack techniques so for example we see many attackers clearing the windows",
    "start": "2482950",
    "end": "2490270"
  },
  {
    "text": "event logs before they start after they finish their malicious activity in order",
    "start": "2490270",
    "end": "2495670"
  },
  {
    "text": "to cover the traces the last lesson we've learned is about our how our",
    "start": "2495670",
    "end": "2501760"
  },
  {
    "text": "industry can benefit from this cross community collaboration so thanks to the",
    "start": "2501760",
    "end": "2507339"
  },
  {
    "text": "trust and the transparency between the security community we could find new",
    "start": "2507339",
    "end": "2514450"
  },
  {
    "text": "vulnerabilities we could effectively protect users and we can fix them and",
    "start": "2514450",
    "end": "2520750"
  },
  {
    "text": "share it with everyone here before we move to the questions part I",
    "start": "2520750",
    "end": "2527150"
  },
  {
    "text": "just want to say that Al and I wrote a very detailed white paper that includes",
    "start": "2527150",
    "end": "2532310"
  },
  {
    "text": "all the information about our research and we would like to share it with everyone thank you we have time for",
    "start": "2532310",
    "end": "2550190"
  },
  {
    "start": "2537000",
    "end": "2961000"
  },
  {
    "text": "about two questions so you have a mic on",
    "start": "2550190",
    "end": "2558260"
  },
  {
    "text": "the right on the left use the microphone",
    "start": "2558260",
    "end": "2565970"
  },
  {
    "text": "use the mic so people could hear the question since you fix it in Windows 10",
    "start": "2565970",
    "end": "2576380"
  },
  {
    "text": "how does that relate to Windows Server editions or two toward Windows 8 that's still supported the patch was released",
    "start": "2576380",
    "end": "2584840"
  },
  {
    "text": "on and July's Patch Tuesday and it covers practically all of the OS",
    "start": "2584840",
    "end": "2590300"
  },
  {
    "text": "versions for Windows because it was applicable for the RDP client in all",
    "start": "2590300",
    "end": "2595670"
  },
  {
    "text": "versions so the pets covers Windows 10 but it also covers Windows servers",
    "start": "2595670",
    "end": "2601430"
  },
  {
    "text": "Windows 7 and so on also you have a Mac client have you shared this with your",
    "start": "2601430",
    "end": "2606830"
  },
  {
    "text": "Mac team to work with them at all with your Apple team did you get closer to the mic I'm sorry you have an apple",
    "start": "2606830",
    "end": "2613330"
  },
  {
    "text": "party client have you shared this with them so they can fix it on their end as well when I tested it it seems that on",
    "start": "2613330",
    "end": "2622840"
  },
  {
    "text": "Apple products they tend to use a free RDP or custom version of geography and",
    "start": "2622840",
    "end": "2628610"
  },
  {
    "text": "philippi patched all of the vulnerabilities roughly at January this",
    "start": "2628610",
    "end": "2634790"
  },
  {
    "text": "year so they should be ok same thing for the stock which Petra",
    "start": "2634790",
    "end": "2640400"
  },
  {
    "text": "Township worried this year all of the vulnerabilities we've shown in the presentation were touched and the",
    "start": "2640400",
    "end": "2646190"
  },
  {
    "text": "patches were already released to clients in your detection scheme you saw you",
    "start": "2646190",
    "end": "2653180"
  },
  {
    "text": "shown that pasting into the startup directory is Bish's activity but how about dropping",
    "start": "2653180",
    "end": "2660119"
  },
  {
    "text": "files to other directories yes so as I said in the last malicious behavior that",
    "start": "2660119",
    "end": "2667050"
  },
  {
    "text": "I recognized basically file dropping to new machines so we basically would like to detect different cases of file",
    "start": "2667050",
    "end": "2674369"
  },
  {
    "text": "creation on the machine by a normal detection so this is how we cover this",
    "start": "2674369",
    "end": "2679530"
  },
  {
    "text": "scenario you have another question for you in the Microsoft version of the MS",
    "start": "2679530",
    "end": "2686400"
  },
  {
    "text": "TSC there is a check box for enable remote level or network level authentication did you turn that on or",
    "start": "2686400",
    "end": "2692760"
  },
  {
    "text": "use it or that change the outcome of what you've been doing the vulnerability",
    "start": "2692760",
    "end": "2699060"
  },
  {
    "text": "is when you have a sync clipboard and it uses the clipboard channel and the clip",
    "start": "2699060",
    "end": "2705930"
  },
  {
    "text": "with channel is the most internal logical module inside the RDP connection",
    "start": "2705930",
    "end": "2712020"
  },
  {
    "text": "this means that it has nothing to do with the indication or anything you use",
    "start": "2712020",
    "end": "2717180"
  },
  {
    "text": "encryption compression anything about the RDP protocol which even makes it harder for a network based product to",
    "start": "2717180",
    "end": "2725930"
  },
  {
    "text": "filter out this attack scenario and have an IPS detection for example the only",
    "start": "2725930",
    "end": "2732480"
  },
  {
    "text": "thing you can do for your RDP client to be safe if you're not catch is you can simply disable the clipboard sharing",
    "start": "2732480",
    "end": "2740160"
  },
  {
    "text": "synchronization and this means you won't have your clipboard but you won't be vulnerable to anything otherwise will",
    "start": "2740160",
    "end": "2747990"
  },
  {
    "text": "stay the same the vulnerability will stay it will be exploited exactly the same it won't change nothing you need to",
    "start": "2747990",
    "end": "2755640"
  },
  {
    "text": "know thank you you mentioned there was a white paper where can we find that in",
    "start": "2755640",
    "end": "2763080"
  },
  {
    "text": "blackhat website I'm not sure exactly when it's gonna be released but it will be there pregnant thank you",
    "start": "2763080",
    "end": "2769640"
  },
  {
    "text": "hi over here and the other mic yes great",
    "start": "2769640",
    "end": "2775140"
  },
  {
    "text": "presentation by the way I wanted to know it was unclear to me how you perform the",
    "start": "2775140",
    "end": "2780359"
  },
  {
    "text": "attack how did you inject the column by a slash or backslash whatever Windows",
    "start": "2780359",
    "end": "2785640"
  },
  {
    "text": "uses so was it true OS DLL modification like hard coding that things in there or did",
    "start": "2785640",
    "end": "2791740"
  },
  {
    "text": "you use some process and men in the middle or did you use like clipboard like something constantly changing the",
    "start": "2791740",
    "end": "2797440"
  },
  {
    "text": "clipboard how did you perform the attack okay it's a good question we have all of the details in the white paper with it",
    "start": "2797440",
    "end": "2804010"
  },
  {
    "text": "it's actually not plainly obvious what happens is onions the server you have an",
    "start": "2804010",
    "end": "2811650"
  },
  {
    "text": "but I told you but the vulnerability could be exploited without elevated privileges so without touching the",
    "start": "2811650",
    "end": "2817960"
  },
  {
    "text": "service and it seemed that the service is using an additional process called the RDP clip and are typically is a bowl",
    "start": "2817960",
    "end": "2825730"
  },
  {
    "text": "kill for the clipboard so I text our DP clip to load my own DLL and when I see",
    "start": "2825730",
    "end": "2832420"
  },
  {
    "text": "someone copies a file or pasting a file it will redirect the logic to my dear",
    "start": "2832420",
    "end": "2839170"
  },
  {
    "text": "and my DLL will replace the files path with dot dot slash after our DP clip was",
    "start": "2839170",
    "end": "2846070"
  },
  {
    "text": "supposed to verify the path on its own actually our DP clips verifies the",
    "start": "2846070",
    "end": "2852430"
  },
  {
    "text": "content of the clipboard so if you manually change the clip or and that's it the attack won't work you can think",
    "start": "2852430",
    "end": "2858340"
  },
  {
    "text": "of it on a client-side verification on the server so attached are typically are",
    "start": "2858340",
    "end": "2863920"
  },
  {
    "text": "typically simply sends the file group descriptor to the service to the service it will later on be sent to the client",
    "start": "2863920",
    "end": "2869980"
  },
  {
    "text": "and that's it so eventually we had a catch Nelson that exploits the vulnerability when you copy files",
    "start": "2869980",
    "end": "2878070"
  },
  {
    "text": "excellent thank you hello so we mentioned that this detection was",
    "start": "2878070",
    "end": "2883630"
  },
  {
    "text": "based on the logs and the events which are being generated on the client-side and they were probably being sent to",
    "start": "2883630",
    "end": "2889150"
  },
  {
    "text": "Microsoft the mothership so like are these events sent to Microsoft even if the user has turned off the Diagnostics",
    "start": "2889150",
    "end": "2896290"
  },
  {
    "text": "or sending out a diagnostic events so I mean my question is like is this detection gonna cover all the clients",
    "start": "2896290",
    "end": "2903370"
  },
  {
    "text": "are only those clients which have enabled the diagnostic events to be sent to Microsoft so yeah this is a very",
    "start": "2903370",
    "end": "2910720"
  },
  {
    "text": "simple detection technique by the way I didn't mention but 94% of the pasting",
    "start": "2910720",
    "end": "2916720"
  },
  {
    "text": "operations includes only one item so these operate this actually detection is actually very useful you can use it",
    "start": "2916720",
    "end": "2924440"
  },
  {
    "text": "on your own machine without any security vendor installed on your machine you can",
    "start": "2924440",
    "end": "2929479"
  },
  {
    "text": "just basically implement it by yourself using the etw event providers I",
    "start": "2929479",
    "end": "2935739"
  },
  {
    "text": "specifically work on Microsoft Defender ATP so if I implement everything",
    "start": "2935739",
    "end": "2941569"
  },
  {
    "text": "yourself in our product thank you it can be used by any security vendors since it",
    "start": "2941569",
    "end": "2948499"
  },
  {
    "text": "is used it we used only built-in telemetry cool thank you cool thanks for",
    "start": "2948499",
    "end": "2959059"
  },
  {
    "text": "coming [Applause]",
    "start": "2959059",
    "end": "2963630"
  }
]