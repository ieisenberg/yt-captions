[
  {
    "text": "thank you for joining our talk after lunch hope you have good food and good time at blackhat my name is Alex we also",
    "start": "30",
    "end": "8250"
  },
  {
    "text": "have here Mick and Jesse they are from Eclipse iam doing firm and harder security as a result of our daily work",
    "start": "8250",
    "end": "16170"
  },
  {
    "text": "we were releasing the research quite often in this area for them in couple of recent example so like where is the",
    "start": "16170",
    "end": "24150"
  },
  {
    "text": "system from runner abilities in Super Micro pretty interesting us and from updates we releasing the even made",
    "start": "24150",
    "end": "31289"
  },
  {
    "text": "attack without open in the case or use beauty backup abilities also we release",
    "start": "31289",
    "end": "36989"
  },
  {
    "text": "it like how to apply Spector in our ability to the system former and special to the SMM runtime part of the system",
    "start": "36989",
    "end": "43260"
  },
  {
    "text": "for month but today here we want to present some really new research from us",
    "start": "43260",
    "end": "49940"
  },
  {
    "text": "remote that I can system from man in this research we will focus on what kind",
    "start": "49940",
    "end": "55649"
  },
  {
    "text": "of new capability system from I have and what kind of new risk this capability adds to the system from already stock we",
    "start": "55649",
    "end": "62969"
  },
  {
    "text": "will go over over the list of the remote vectors as an industry problem with",
    "start": "62969",
    "end": "69150"
  },
  {
    "text": "example from the US research and our own research done in this area there will go",
    "start": "69150",
    "end": "75390"
  },
  {
    "text": "details about the executive findings which we have in the system from inner",
    "start": "75390",
    "end": "80729"
  },
  {
    "text": "mode vectors go or exploit having the demo of the exploit and we will talk a",
    "start": "80729",
    "end": "86729"
  },
  {
    "text": "little bit about mitigations and the detection capability switch which is we can apply for this type of problem if",
    "start": "86729",
    "end": "94860"
  },
  {
    "text": "you think about technology stack there is a bunch of good application running in a user mode like browsers office and",
    "start": "94860",
    "end": "102570"
  },
  {
    "text": "other applications and then you have the kernel mode or incurring 0 when you have",
    "start": "102570",
    "end": "108030"
  },
  {
    "text": "the operation system and drivers which is managed for the resources to provide the the boot there are the capabilities",
    "start": "108030",
    "end": "114270"
  },
  {
    "text": "to the application and they have a lot of good security here we have like internal teams which is validating these",
    "start": "114270",
    "end": "120570"
  },
  {
    "text": "products we have the bug bounty program we have a bunch of exploit prevention",
    "start": "120570",
    "end": "126560"
  },
  {
    "text": "capabilities like SEFI on our other capabilities which has recent years who",
    "start": "126560",
    "end": "132660"
  },
  {
    "text": "is to this to this step 2 the user modern kernel which is raising the bar for the",
    "start": "132660",
    "end": "140040"
  },
  {
    "text": "attacker for attacker to compromise the system they Nitin when the remote code",
    "start": "140040",
    "end": "145080"
  },
  {
    "text": "execution then they excape from sandbox and on local field escalation tie a bunch of exploits so pretty pretty",
    "start": "145080",
    "end": "151769"
  },
  {
    "text": "complicated work to compromise the system and pretty expensive so but there",
    "start": "151769",
    "end": "157650"
  },
  {
    "text": "is another part of the technology which is hardware from server to desktop to to",
    "start": "157650",
    "end": "163290"
  },
  {
    "text": "a network gear ATM machine Adi system so there is a bunch of card bra and historically we think about Hardware in",
    "start": "163290",
    "end": "170430"
  },
  {
    "text": "monolithic trusted block but recent recent decades last decades the",
    "start": "170430",
    "end": "178980"
  },
  {
    "text": "situation is change it harder become much more complicated so this is the lower end example of the server a",
    "start": "178980",
    "end": "185190"
  },
  {
    "text": "motherboard which has between 10 10 and 20 different component are called",
    "start": "185190",
    "end": "190380"
  },
  {
    "text": "controllers and these components communicate which has over the buses which was designed 20 years ago and that",
    "start": "190380",
    "end": "197370"
  },
  {
    "text": "these components may run a software called the firmer domain to manage to management capabilities of this device",
    "start": "197370",
    "end": "205139"
  },
  {
    "text": "of this controller this former can be from different vendors the components can be from different vendors it can be",
    "start": "205139",
    "end": "211980"
  },
  {
    "text": "really old and the code was may not be updated long time this may be compile it",
    "start": "211980",
    "end": "219720"
  },
  {
    "text": "with all compilers which may have a bunch of which may not have the exploit prevention capabilities like in some of",
    "start": "219720",
    "end": "226290"
  },
  {
    "text": "the example could build stack executable some of the example there is no as where NDP and so and so on in many cases this",
    "start": "226290",
    "end": "235590"
  },
  {
    "text": "framer may not be updatable so if not update the from and these devices so this one are vulnerabilities there that",
    "start": "235590",
    "end": "241560"
  },
  {
    "text": "will live forever and there of course many vulnerabilities and that components because the code is not updating often",
    "start": "241560",
    "end": "248030"
  },
  {
    "text": "in some cases if it is updatable the update may not be silent so you basically can use legitimate interface",
    "start": "248030",
    "end": "254970"
  },
  {
    "text": "to update the firm on that devices and attacker can do it without any any",
    "start": "254970",
    "end": "261450"
  },
  {
    "text": "problems and another last point is that in many of this Fromer there's no read interface",
    "start": "261450",
    "end": "269050"
  },
  {
    "text": "so you cannot make a monetary no you cannot monitor this device at at the runtime so that's showing us them",
    "start": "269050",
    "end": "276189"
  },
  {
    "text": "overall the problem about the formula card for the modern system as a blind",
    "start": "276189",
    "end": "281229"
  },
  {
    "text": "spot as an area when the security researchers should get more and more",
    "start": "281229",
    "end": "286300"
  },
  {
    "text": "attention and if we're talking about what kind of hardened former vectors of",
    "start": "286300",
    "end": "292509"
  },
  {
    "text": "attack we have we can split it for two categories one is which is require physical access like yo meta tag which",
    "start": "292509",
    "end": "299680"
  },
  {
    "text": "was released in a couple weeks ago and to demonstrate how what you can do with five minutes of the access to the",
    "start": "299680",
    "end": "305710"
  },
  {
    "text": "enterprise laptop so can basically in fact that was there the stealth implant but there's not the",
    "start": "305710",
    "end": "313180"
  },
  {
    "text": "parts off to attacks and the software part may may have different vectors",
    "start": "313180",
    "end": "318960"
  },
  {
    "text": "itself like me it might be software attacks from the person system it may be",
    "start": "318960",
    "end": "324069"
  },
  {
    "text": "sort of attacks or a different components and so on so forth those come",
    "start": "324069",
    "end": "329229"
  },
  {
    "text": "many examples for them for the reason for the last years about all of the software attacks for the system from a",
    "start": "329229",
    "end": "334599"
  },
  {
    "text": "traumatic from other companies as well but there is also remote attacks and",
    "start": "334599",
    "end": "339699"
  },
  {
    "text": "usually we think about remote attacks where the format is something which is not really often because there is not",
    "start": "339699",
    "end": "345039"
  },
  {
    "text": "many network stack implementation there is not many network interfaces there but in reality it's not that in reality many",
    "start": "345039",
    "end": "352419"
  },
  {
    "text": "of the formal components has the network stack here's couple example for example in Intel meam team has some own",
    "start": "352419",
    "end": "361839"
  },
  {
    "text": "implementation of the network stack which which has an example of the vulnerability released in 2013 being",
    "start": "361839",
    "end": "370509"
  },
  {
    "text": "seen being sits itself it's that component which is responsible for management capabilities for the servers",
    "start": "370509",
    "end": "377669"
  },
  {
    "text": "which is basically run in entire us with all the capabilities like OS including",
    "start": "377669",
    "end": "383680"
  },
  {
    "text": "Network step and there was a couple Vernor ability found in HP and Dell",
    "start": "383680",
    "end": "390690"
  },
  {
    "text": "servers in the BMC and one of them will be presented and this black hat or in the recommended to take a look but",
    "start": "390690",
    "end": "398170"
  },
  {
    "text": "this also showing us that there is a remote vector for the BMC to compromise service and nowadays for the last couple",
    "start": "398170",
    "end": "406480"
  },
  {
    "text": "years for 2015 we start we start see",
    "start": "406480",
    "end": "411640"
  },
  {
    "text": "that system from also incorporating the network stack like we have IP DCP HTTP",
    "start": "411640",
    "end": "420850"
  },
  {
    "text": "implementation in the ufi basis from in the system from energy on a current",
    "start": "420850",
    "end": "425950"
  },
  {
    "text": "limit a reference implementation why we need these capabilities we need these capabilities because we want to put our",
    "start": "425950",
    "end": "433240"
  },
  {
    "text": "OS from HTTP for example and there is another part of them of the remote",
    "start": "433240",
    "end": "440370"
  },
  {
    "text": "remote capabilities remote management capabilities in the modern part platform",
    "start": "440370",
    "end": "445600"
  },
  {
    "text": "which is vendor specific so think about this so there is a reference implementation part which implements some functionality and there is vendor",
    "start": "445600",
    "end": "452200"
  },
  {
    "text": "specific part which is also may employ meant additional features and may have",
    "start": "452200",
    "end": "457780"
  },
  {
    "text": "them own tools for that man them own service and in this talk we will focus",
    "start": "457780",
    "end": "463420"
  },
  {
    "text": "for this vector for the vector for vector for the system from in a",
    "start": "463420",
    "end": "469150"
  },
  {
    "text": "management functionality of them of the platform and specifically which is",
    "start": "469150",
    "end": "477160"
  },
  {
    "text": "vendor specific features implemented in some of the vendors with this I will",
    "start": "477160",
    "end": "482830"
  },
  {
    "text": "switch to to make here to continue this more details about this vectors Thank",
    "start": "482830",
    "end": "492280"
  },
  {
    "text": "You ax for that review I'm gonna go into a little bit a further detail into the overview that Alex went in and we're",
    "start": "492280",
    "end": "499390"
  },
  {
    "text": "gonna start with BMC BMC is is an",
    "start": "499390",
    "end": "504520"
  },
  {
    "text": "acronym stands for base board management control in case you don't know it is used in server boards for management",
    "start": "504520",
    "end": "512370"
  },
  {
    "text": "obviously in the picture in the slide you can see is zoomed in photo from the",
    "start": "512370",
    "end": "518229"
  },
  {
    "text": "previous slide this is the the BMC complex on the motherboard as you can",
    "start": "518230",
    "end": "523960"
  },
  {
    "text": "see it has its own CPU SRAM and flash it's an independent computing system the motherboard it does not require a",
    "start": "523960",
    "end": "530689"
  },
  {
    "text": "CPU or RAM or any other peripheral to to work from the host the moment you plug",
    "start": "530689",
    "end": "536059"
  },
  {
    "text": "in a power cable it will boot up and it is from that point on susceptible for attacks the BMC's are",
    "start": "536059",
    "end": "546589"
  },
  {
    "text": "designed for out-of-band server management some of the things you can do with them are KVM which allows you to",
    "start": "546589",
    "end": "552889"
  },
  {
    "text": "VNC over the network to the host which I need a server and configure bios or",
    "start": "552889",
    "end": "559179"
  },
  {
    "text": "install an operating system by showing an ISO image to the host or flash the",
    "start": "559179",
    "end": "565129"
  },
  {
    "text": "BIOS remotely power on or off the platform or even reset it they come in",
    "start": "565129",
    "end": "571040"
  },
  {
    "text": "different flavors of licensing some though in a paper feature model some go",
    "start": "571040",
    "end": "577459"
  },
  {
    "text": "by tears for example dell idrac have the basic Express and enterprise tier so you pay more you get more features in Super",
    "start": "577459",
    "end": "585230"
  },
  {
    "text": "Micro we have paper feature we have an example we have personal experience with",
    "start": "585230",
    "end": "590449"
  },
  {
    "text": "that when we accidentally brick to one of our extant servers and we couldn't physically flash it we didn't succeed",
    "start": "590449",
    "end": "598189"
  },
  {
    "text": "for some electrical reason and we had to go purchase a license from Super Micro to go through the BMC and flash a",
    "start": "598189",
    "end": "606230"
  },
  {
    "text": "recovery image that worked from an attack surface perspective over the",
    "start": "606230",
    "end": "612920"
  },
  {
    "text": "network when you look at the BMC you see the IP mi the the IP my protocol the VNC",
    "start": "612920",
    "end": "619610"
  },
  {
    "text": "port and the web interface it is very very hard to scan BMC as it takes a long",
    "start": "619610",
    "end": "627559"
  },
  {
    "text": "time but if you look at a little bit more detail sorry for the horrible slide",
    "start": "627559",
    "end": "635290"
  },
  {
    "text": "they there's more than network on a BMC alright we have the land or the NIC",
    "start": "635290",
    "end": "643819"
  },
  {
    "text": "where the BMC shares a network port with the host or has its own dedicated network port and the serial connection",
    "start": "643819",
    "end": "652100"
  },
  {
    "text": "the IP MB and the ICMP bridges as well as other connections going to the host",
    "start": "652100",
    "end": "658419"
  },
  {
    "text": "for example the system interface between the BMC and the hosts think about it as two",
    "start": "658419",
    "end": "665929"
  },
  {
    "text": "computers the BMC is one computer the host is another computer and they communicate between each other now if I",
    "start": "665929",
    "end": "672589"
  },
  {
    "text": "were an attacker and I would want to hop from the host to the BMC I would use",
    "start": "672589",
    "end": "679459"
  },
  {
    "text": "this connection usually what happens is in data centers and enterprises you'd",
    "start": "679459",
    "end": "687379"
  },
  {
    "text": "have the BMC on one network segment and you have the hosts connected to a different network server so you have a management networking on non management",
    "start": "687379",
    "end": "694459"
  },
  {
    "text": "network as an attacker jumping from a non management network to a management network is ideal the short history of",
    "start": "694459",
    "end": "705819"
  },
  {
    "text": "IPMI 1998 the IPM I spake out the spec comes out 2001 it bit it gets its land",
    "start": "705819",
    "end": "713569"
  },
  {
    "text": "editions in 2004 yeah it's a few more editions with VLAN and firewall and then",
    "start": "713569",
    "end": "719059"
  },
  {
    "text": "we start seeing vulnerabilities if 2013 2014 the of the famous ones are HD more",
    "start": "719059",
    "end": "725480"
  },
  {
    "text": "than a farmer where they scan the internet and found 300,000 bmc's and 53 thousand of them were vulnerable to",
    "start": "725480",
    "end": "731329"
  },
  {
    "text": "cyber zero authentication bypass and most recently they vulnerabilities which",
    "start": "731329",
    "end": "737119"
  },
  {
    "text": "i think should win the pony Awards is the HP ILO for authentication progress with 29 or 27 days the Mema am team",
    "start": "737119",
    "end": "750009"
  },
  {
    "text": "unlike the previous zoom in picture I cannot show you the CPU it has a",
    "start": "750009",
    "end": "755540"
  },
  {
    "text": "dedicated CPU it's in there it says its own SRAM it also shares ram",
    "start": "755540",
    "end": "761839"
  },
  {
    "text": "with the host it steals a little bit and it loads its code from the main platform flash if BMC is management for servers",
    "start": "761839",
    "end": "771799"
  },
  {
    "text": "than a Mt AME is management for enterprise clients think of it as an equivalent platform in functionality but",
    "start": "771799",
    "end": "778879"
  },
  {
    "text": "not the same physically enterprises use these to provision systems to allow IT",
    "start": "778879",
    "end": "785269"
  },
  {
    "text": "professionals to install OS s remotely configure BIOS and hardware and firmware",
    "start": "785269",
    "end": "793209"
  },
  {
    "text": "attack surface from a web perspective if you look at the open ports AMT has a web interface we all know the famous",
    "start": "794260",
    "end": "800500"
  },
  {
    "text": "vulnerability from a year and a half ago will allow you authenticate bypass and",
    "start": "800500",
    "end": "807610"
  },
  {
    "text": "the standard ones VNC in zero over land and there's all so many features we're not gonna go into it a little brief",
    "start": "807610",
    "end": "813550"
  },
  {
    "text": "history of that first encounter day we first encountered AMT in 2006 2007 added",
    "start": "813550",
    "end": "820030"
  },
  {
    "text": "wireless support 2008 provisioning over the network 2010 remote KVM and 2017 is",
    "start": "820030",
    "end": "828310"
  },
  {
    "text": "when we see the first major vulnerability a brief recap of that",
    "start": "828310",
    "end": "835420"
  },
  {
    "text": "vulnerability in case you've never heard of it it was a an authentication bypass",
    "start": "835420",
    "end": "841330"
  },
  {
    "text": "where you could send a an empty digest to the AMT and he lets you authenticate",
    "start": "841330",
    "end": "847930"
  },
  {
    "text": "and login and there's a few more in 2018 we haven't had event but Intel released",
    "start": "847930",
    "end": "854080"
  },
  {
    "text": "of a month ago advisories explaining they found few a few more",
    "start": "854080",
    "end": "860410"
  },
  {
    "text": "vulnerabilities that they dispatched internally which is nice who the stand tall for disclosing",
    "start": "860410",
    "end": "866110"
  },
  {
    "text": "publicly things they found internally BIOS ok if you don't know what BIOS is",
    "start": "866110",
    "end": "875200"
  },
  {
    "text": "I'll go briefly over that it is essentially the early code that configures the hardware before loading",
    "start": "875200",
    "end": "882640"
  },
  {
    "text": "and transitioning execution to the operating system what I mean is by configuring Hardware is it is setting",
    "start": "882640",
    "end": "890860"
  },
  {
    "text": "registers configuring memory memory protections sitting SMM locking down the",
    "start": "890860",
    "end": "897760"
  },
  {
    "text": "configurations with bits that you write once to them and after you write once",
    "start": "897760",
    "end": "902830"
  },
  {
    "text": "they're set and you have to power cycle the platform to change them it also sets protections on its own flash so no one",
    "start": "902830",
    "end": "910750"
  },
  {
    "text": "other than itself can write and read from it yeah right to it read from it it can the code is main CPU",
    "start": "910750",
    "end": "918630"
  },
  {
    "text": "flash main flash around mainframe it's part of the main up main platform",
    "start": "918630",
    "end": "923639"
  },
  {
    "text": "bass is the cute of trust that everything that works afterwards relies",
    "start": "923639",
    "end": "929800"
  },
  {
    "text": "on so if you compromise BIOS you win",
    "start": "929800",
    "end": "935370"
  },
  {
    "text": "BIOS in the early days everyone had their own version in 1998 Intel said",
    "start": "937290",
    "end": "944259"
  },
  {
    "text": "let's that's the other heads together and do something about it they they",
    "start": "944259",
    "end": "949749"
  },
  {
    "text": "wrote efi 1.0 in 2002 it evolved into a",
    "start": "949749",
    "end": "955180"
  },
  {
    "text": "forum and more and more company started to adapt it 2007 they added cryptography",
    "start": "955180",
    "end": "961300"
  },
  {
    "text": "network authentication more of that 2015 is interesting more functionality starts",
    "start": "961300",
    "end": "967449"
  },
  {
    "text": "to pop up Wi-Fi Bluetooth support HTTP HTTP ads in 2016 with the with the",
    "start": "967449",
    "end": "973480"
  },
  {
    "text": "introduction open SSL and in 2016 we we have a publicly disclosed vulnerability",
    "start": "973480",
    "end": "979660"
  },
  {
    "text": "in the core code which also is called Tiano core where Topher Timson has",
    "start": "979660",
    "end": "984970"
  },
  {
    "text": "discovered there is a missing size check in a DHCP packet the interesting fact",
    "start": "984970",
    "end": "990309"
  },
  {
    "text": "about that is there was a check it wasn't an assert they fixed that let's",
    "start": "990309",
    "end": "998829"
  },
  {
    "text": "look at the the reference implementation for the you fight 2.4 spec there's an example you can see that there is a lot",
    "start": "998829",
    "end": "1005819"
  },
  {
    "text": "of functionality here for if you want to do up pixie boots over v4 v ipv4 ipv6 is",
    "start": "1005819",
    "end": "1011579"
  },
  {
    "text": "cozy as well you see there's TCP UDP IP for ie6 and DHCP and so on and so forth",
    "start": "1011579",
    "end": "1019069"
  },
  {
    "text": "on top of that that's what the reference code gives you as a is a vendors and as",
    "start": "1019069",
    "end": "1024329"
  },
  {
    "text": "an independent bios vendor or ibv HP in 2015 saw that reference code and decided",
    "start": "1024329",
    "end": "1032970"
  },
  {
    "text": "ok we need to add more so they based on that implementation they added their own",
    "start": "1032970",
    "end": "1038428"
  },
  {
    "text": "implementation for HTTP boot so what you see in blue is HP's addition in tinted",
    "start": "1038429",
    "end": "1043949"
  },
  {
    "text": "green is what the reference code offers and the pink bottom is the harbor layer",
    "start": "1043949",
    "end": "1050329"
  },
  {
    "text": "this is a perfect example of what vendors would do when when the reference code does not fit their needs for the",
    "start": "1050370",
    "end": "1057870"
  },
  {
    "text": "market they're targeting another example",
    "start": "1057870",
    "end": "1065610"
  },
  {
    "text": "today for that is am i a dish am eyes addition for the Bluetooth stack in BIOS",
    "start": "1065610",
    "end": "1072200"
  },
  {
    "text": "the reference core code does not have support for it has some support for Bluetooth nowadays but in 2017 am I",
    "start": "1072290",
    "end": "1080790"
  },
  {
    "text": "decided to implement their own Bluetooth stack basically it's Bluetooth in BIOS I",
    "start": "1080790",
    "end": "1088710"
  },
  {
    "text": "don't know of any use case for this but it allows you to connect to it before",
    "start": "1088710",
    "end": "1094650"
  },
  {
    "text": "the OS base we did actually find a Dixie module module in a production laptop",
    "start": "1094650",
    "end": "1101130"
  },
  {
    "text": "that is Bluetooth as a memo so it is used in the wild another great example",
    "start": "1101130",
    "end": "1109740"
  },
  {
    "text": "for adding to an existing functionality is ami again where UEFI the reference",
    "start": "1109740",
    "end": "1117090"
  },
  {
    "text": "code offers a Wi-Fi stack but it's not complete so they would have open network",
    "start": "1117090",
    "end": "1122760"
  },
  {
    "text": "connections and wpa2 connections but they didn't apply EAP so ami came along",
    "start": "1122760",
    "end": "1128460"
  },
  {
    "text": "and implemented their parallel driver for the Wi-Fi stack so you get these two",
    "start": "1128460",
    "end": "1133830"
  },
  {
    "text": "ecosystems one I have to run next to each other and that's something that is worth knowing and with that oh so not to",
    "start": "1133830",
    "end": "1143520"
  },
  {
    "text": "Jesse thanks Mickey so I'll take over a",
    "start": "1143520",
    "end": "1151890"
  },
  {
    "text": "little bit and this is an example of a feature that has been added like HP had",
    "start": "1151890",
    "end": "1157290"
  },
  {
    "text": "their own version of HTTP boot and it eventually was a similar functionality",
    "start": "1157290",
    "end": "1163140"
  },
  {
    "text": "pulled into the official UEFI specification so the UEFI specification",
    "start": "1163140",
    "end": "1168510"
  },
  {
    "text": "and reference implementation now has HTTP boot also this was basically done",
    "start": "1168510",
    "end": "1174750"
  },
  {
    "text": "to replace pixie which was the older version of remote network boot this",
    "start": "1174750",
    "end": "1182410"
  },
  {
    "text": "actually allows you to configure a URL and download a UEFI application that's",
    "start": "1182410",
    "end": "1189460"
  },
  {
    "text": "run as a boot loader or even like a complete ISO image over HTTP or HTTPS it",
    "start": "1189460",
    "end": "1197380"
  },
  {
    "text": "will mount it basically has a ram disk functionality where it will download the",
    "start": "1197380",
    "end": "1203050"
  },
  {
    "text": "ISO mount the Ram disk and look for the UEFI boot loader in this I so that it",
    "start": "1203050",
    "end": "1209650"
  },
  {
    "text": "downloaded which is kind of cool it does do signature verification before executing this UEFI there's there's",
    "start": "1209650",
    "end": "1217210"
  },
  {
    "text": "basically a policy bits that specify if a UF application that comes from this",
    "start": "1217210",
    "end": "1223870"
  },
  {
    "text": "location check signature if it's coming from an internal thermoball um-- don't bother checking signature but",
    "start": "1223870",
    "end": "1229750"
  },
  {
    "text": "because it's from a remote source it does check that signature verification in order to maintain the secure boot",
    "start": "1229750",
    "end": "1235660"
  },
  {
    "text": "chain at this point so intelligent provisioning is kind of an interesting",
    "start": "1235660",
    "end": "1241390"
  },
  {
    "text": "feature that we ran into this is a feature in HP servers and it it",
    "start": "1241390",
    "end": "1249550"
  },
  {
    "text": "essentially is kind of an embedded system in HP where BIOS can go and",
    "start": "1249550",
    "end": "1257260"
  },
  {
    "text": "transition into this alternate environment that it can download firmware updates can apply the firmware",
    "start": "1257260",
    "end": "1264309"
  },
  {
    "text": "updates it can actually download drivers for your hardware from the internet and",
    "start": "1264309",
    "end": "1270630"
  },
  {
    "text": "inject those into your previously installed operating system so it all mount file systems that have already",
    "start": "1270630",
    "end": "1278260"
  },
  {
    "text": "been installed and inject new drivers into the system which is it's kind of cool but makes me a little nervous also",
    "start": "1278260",
    "end": "1285660"
  },
  {
    "text": "it also has some functionality where it's kind of like this wizard version of simple configuration and provisioning of",
    "start": "1285660",
    "end": "1293050"
  },
  {
    "text": "the operating system so you can configure a bunch of different devices use this provisioning capability and",
    "start": "1293050",
    "end": "1300309"
  },
  {
    "text": "it'll install windows or SUSE Linux or different operating systems from a",
    "start": "1300309",
    "end": "1307470"
  },
  {
    "text": "configuration file instead of manually going through the operating system insulin",
    "start": "1307470",
    "end": "1312570"
  },
  {
    "text": "and steps so what one other thing that we ran into is SMTP from UEFI so this is",
    "start": "1312570",
    "end": "1320909"
  },
  {
    "text": "a feature that from BIOS it will bring up the network connection get a dhcp",
    "start": "1320909",
    "end": "1327720"
  },
  {
    "text": "address and connect to remote email servers to send email for you in this",
    "start": "1327720",
    "end": "1335250"
  },
  {
    "text": "particular example it was designed to be used for a diagnostic tool where you can report an issue back to the to the bios",
    "start": "1335250",
    "end": "1342419"
  },
  {
    "text": "vendors a technical support team a really interesting feature this",
    "start": "1342419",
    "end": "1347460"
  },
  {
    "text": "particular feature is that they have an NTFS driver in this bios that this",
    "start": "1347460",
    "end": "1355710"
  },
  {
    "text": "feature can use that ntfs driver to mount your hard drive partition you can",
    "start": "1355710",
    "end": "1361620"
  },
  {
    "text": "browse to any file in the file system and attach it as an email as long as",
    "start": "1361620",
    "end": "1367679"
  },
  {
    "text": "it's left for three Meg's and send that from BIOS before the operating system ever loads which is it's kind of neat",
    "start": "1367679",
    "end": "1375330"
  },
  {
    "text": "this this feature and functionality is there present in the operating in the in",
    "start": "1375330",
    "end": "1381210"
  },
  {
    "text": "the BIOS so if someone is able to compromise BIOS all this framework is",
    "start": "1381210",
    "end": "1386429"
  },
  {
    "text": "there you could take advantage of and potentially use it maliciously another",
    "start": "1386429",
    "end": "1393240"
  },
  {
    "text": "feature that we ran into it's pretty interesting is HP has a remote diagnostic download function where in",
    "start": "1393240",
    "end": "1401039"
  },
  {
    "text": "BIOS you can configure this functionality that will when you reboot",
    "start": "1401039",
    "end": "1408539"
  },
  {
    "text": "it will bring up the network connection before it even loads the operating system go out to a remote server",
    "start": "1408539",
    "end": "1415549"
  },
  {
    "text": "download and executable from that remote server in this case it does check the",
    "start": "1415549",
    "end": "1421200"
  },
  {
    "text": "signature before executing it like the other like the HTTP boot it basically",
    "start": "1421200",
    "end": "1428490"
  },
  {
    "text": "does a similar signature verification check and then executes this executable that you downloaded off the internet you",
    "start": "1428490",
    "end": "1435149"
  },
  {
    "text": "can either specify downloading it officially from HP's website or you can have your own custom URL where you put",
    "start": "1435149",
    "end": "1443190"
  },
  {
    "text": "this diagnostic tool or random signed efi",
    "start": "1443190",
    "end": "1448780"
  },
  {
    "text": "binary somewhere else on the Internet and it'll download it from there and run it there is the ability to take the",
    "start": "1448780",
    "end": "1455860"
  },
  {
    "text": "results that are take that are output from this tool and upload it back to a different website on the Internet you",
    "start": "1455860",
    "end": "1463210"
  },
  {
    "text": "can specify using a password if it's behind is something that's like a FTP server specially protected but that that",
    "start": "1463210",
    "end": "1469450"
  },
  {
    "text": "functionality is all there in the system and it's interesting because this one you can schedule it automatically so",
    "start": "1469450",
    "end": "1477960"
  },
  {
    "text": "every climate reach so it doesn't run at run time after the operating system has",
    "start": "1477960",
    "end": "1483220"
  },
  {
    "text": "run up but every time you reboot it it will check and see if if it has if",
    "start": "1483220",
    "end": "1489940"
  },
  {
    "text": "enough time since the last check has happened so if you have it scheduled every week and you reboot your system",
    "start": "1489940",
    "end": "1495190"
  },
  {
    "text": "after a week in half it'll run again connect to the internet download this and upload the results somewhere else so",
    "start": "1495190",
    "end": "1501730"
  },
  {
    "text": "it's kind of an interesting feature and so another thing that we ran into is",
    "start": "1501730",
    "end": "1508649"
  },
  {
    "text": "historically BIOS has been kind of difficult to update so a lot of people",
    "start": "1509220",
    "end": "1515980"
  },
  {
    "text": "don't update BIOS I got I know I have been kind of laxed and gotten better at",
    "start": "1515980",
    "end": "1522280"
  },
  {
    "text": "updating BIOS I started working on this kind of research but because it's been such a difficult thing to do multiple",
    "start": "1522280",
    "end": "1530440"
  },
  {
    "text": "vendors have started adding functionality so they can basically check if there's a new BIOS update",
    "start": "1530440",
    "end": "1536770"
  },
  {
    "text": "available before even loading the operating system so from BIOS it will",
    "start": "1536770",
    "end": "1541830"
  },
  {
    "text": "bring up the network connection make requests out to remote servers on the internet potentially download those",
    "start": "1541830",
    "end": "1548200"
  },
  {
    "text": "updates and apply them and there there isn't a standard way to do this in UEFI",
    "start": "1548200",
    "end": "1554530"
  },
  {
    "text": "so the different vendors have just all made their own implementation and",
    "start": "1554530",
    "end": "1559680"
  },
  {
    "text": "everybody's done it differently so there might be some problems with that here's",
    "start": "1559680",
    "end": "1566290"
  },
  {
    "text": "an example of this is what as rocks implementation looks like it's basically",
    "start": "1566290",
    "end": "1571860"
  },
  {
    "text": "goes out it connects to the internet and shows you if there's an update allows",
    "start": "1571860",
    "end": "1576889"
  },
  {
    "text": "you to update that if a new update is available asus has a similar functionality it's",
    "start": "1576889",
    "end": "1584690"
  },
  {
    "text": "it's basically exactly the same functionality it just looks different and it's it's all built on top of those",
    "start": "1584690",
    "end": "1591049"
  },
  {
    "text": "core UEFI Network primitives like TCP for Dixie the DHCP primitives but",
    "start": "1591049",
    "end": "1598429"
  },
  {
    "text": "because all the extra update functionality is custom it's just",
    "start": "1598429",
    "end": "1603679"
  },
  {
    "text": "implemented differently HP has a similar feature where you can basically do the",
    "start": "1603679",
    "end": "1610549"
  },
  {
    "text": "same thing you can configure your your update source directly from bio so you",
    "start": "1610549",
    "end": "1615589"
  },
  {
    "text": "can have it point at hp.com and this one is interesting because",
    "start": "1615589",
    "end": "1622609"
  },
  {
    "text": "it'll also you can you can schedule dynamic it'll automatically download and",
    "start": "1622609",
    "end": "1629690"
  },
  {
    "text": "apply those updates if a new update is available and this is kind of a difference between like this is more of",
    "start": "1629690",
    "end": "1635389"
  },
  {
    "text": "like a enterprise feature or focused feature where it's like it'll go do it",
    "start": "1635389",
    "end": "1640519"
  },
  {
    "text": "for you the other ones were like more consumer focus where it's like in the foot the feature is there but it you",
    "start": "1640519",
    "end": "1647299"
  },
  {
    "text": "can't have to go do it yourself so we as part of our research we",
    "start": "1647299",
    "end": "1653149"
  },
  {
    "text": "basically discovered that both asus and asrock we're doing this in securely and",
    "start": "1653149",
    "end": "1659570"
  },
  {
    "text": "they had basic buffer overflows in there their update process so to show this off",
    "start": "1659570",
    "end": "1665029"
  },
  {
    "text": "we basically wrote a demo to exploit this and and see what we can do and we",
    "start": "1665029",
    "end": "1672229"
  },
  {
    "text": "can show what it what that looks like right now",
    "start": "1672229",
    "end": "1675639"
  },
  {
    "text": "so as the the tradition is to a Papa",
    "start": "1678309",
    "end": "1684200"
  },
  {
    "text": "shell when you are exploiting stuff we figure or a pop calc we figured we might as well do that so this is like the BIOS",
    "start": "1684200",
    "end": "1691609"
  },
  {
    "text": "what it looks like we're gonna go and launch the internet flash function and and see what it looks like",
    "start": "1691609",
    "end": "1701200"
  },
  {
    "text": "so this got triggered just by checking if an update was available we didn't",
    "start": "1702099",
    "end": "1707179"
  },
  {
    "text": "have to go say okay go apply the update and actually apply it basically apply",
    "start": "1707179",
    "end": "1714470"
  },
  {
    "text": "the update it's it's just just checking is enough to it to trigger this so we",
    "start": "1714470",
    "end": "1719630"
  },
  {
    "text": "can also have like a bigger payload that's a little bit more elaborate like that was a pretty small payload it's not",
    "start": "1719630",
    "end": "1727130"
  },
  {
    "text": "that interesting but you basically have complete you can run much bigger code in",
    "start": "1727130",
    "end": "1737030"
  },
  {
    "text": "your in your exploit so this one is actually a popping shell instead so like",
    "start": "1737030",
    "end": "1744140"
  },
  {
    "text": "the this the the shell application isn't included in this UEFI binary but we can",
    "start": "1744140",
    "end": "1750110"
  },
  {
    "text": "just include it in our payload and it takes a little bit longer but you get a complete interactive shell you can",
    "start": "1750110",
    "end": "1756110"
  },
  {
    "text": "basically run any arbitrary UEFI application that you want at this point you don't have to have any kind of",
    "start": "1756110",
    "end": "1764020"
  },
  {
    "text": "visual like you you don't have to show anything on the screen we we did this",
    "start": "1764020",
    "end": "1770630"
  },
  {
    "text": "just so that you could actually see that something's happening but you can have it be completely silent and then inject",
    "start": "1770630",
    "end": "1778580"
  },
  {
    "text": "something and then continue booting up if you want to so so once we reported",
    "start": "1778580",
    "end": "1793520"
  },
  {
    "text": "this as rock was like well oh they basically provided firmware updates for",
    "start": "1793520",
    "end": "1799460"
  },
  {
    "text": "all effective systems that just disabled the functionality and it was almost 300",
    "start": "1799460",
    "end": "1805700"
  },
  {
    "text": "different motherboard models that were affected by this basically the last two",
    "start": "1805700",
    "end": "1811040"
  },
  {
    "text": "generations of Intel processors basically from Haswell onward and then",
    "start": "1811040",
    "end": "1816470"
  },
  {
    "text": "AMD processors were also affected but there's I think three different",
    "start": "1816470",
    "end": "1821510"
  },
  {
    "text": "generations of AMD using the m4 socket has rocks response was they basically",
    "start": "1821510",
    "end": "1829460"
  },
  {
    "text": "said it's this is only happening before the operating system boots so it doesn't",
    "start": "1829460",
    "end": "1835730"
  },
  {
    "text": "really matter this isn't a problem and we went back and forth with them a little bit and tried to explain no you",
    "start": "1835730",
    "end": "1841220"
  },
  {
    "text": "actually really should fix this they didn't seem to understand why so",
    "start": "1841220",
    "end": "1847410"
  },
  {
    "text": "this actually hasn't been fixed so let's",
    "start": "1847410",
    "end": "1852760"
  },
  {
    "text": "take a look at what the exploit actually looks like it's it's a little bit different so well some things will look",
    "start": "1852760",
    "end": "1860350"
  },
  {
    "text": "very similar so the way this works is here's the example of asrock where it",
    "start": "1860350",
    "end": "1866410"
  },
  {
    "text": "basically does a plain HTTP request out to the Internet at asrock com2 this live",
    "start": "1866410",
    "end": "1873400"
  },
  {
    "text": "update a sv page it does include the specific model of the motherboard that's",
    "start": "1873400",
    "end": "1878470"
  },
  {
    "text": "running so if you need to return a different exploit for a particular motherboard you can totally do that also",
    "start": "1878470",
    "end": "1884740"
  },
  {
    "text": "but it is plain HTTP and that's it's possible the man in the middle of that",
    "start": "1884740",
    "end": "1890799"
  },
  {
    "text": "so let's take a look at what the response looks like it's basically just a xml document that has some urls region",
    "start": "1890799",
    "end": "1900850"
  },
  {
    "text": "information and then a list of what BIOS updates are actually available and as",
    "start": "1900850",
    "end": "1907660"
  },
  {
    "text": "you can see like we made our description like this is a malicious BIOS and if you",
    "start": "1907660",
    "end": "1913210"
  },
  {
    "text": "actually run this the description shows up in the in the in the UI and gives you",
    "start": "1913210",
    "end": "1921790"
  },
  {
    "text": "the ability to go and update that BIOS but we figured out that if you basically",
    "start": "1921790",
    "end": "1926919"
  },
  {
    "text": "just make some of these fields much longer like if we put a bunch of A's in",
    "start": "1926919",
    "end": "1933669"
  },
  {
    "text": "the URL field when you're checking this when you're checking for the update it",
    "start": "1933669",
    "end": "1939880"
  },
  {
    "text": "just hangs and you're wondering what happened it's like I'm not sure what",
    "start": "1939880",
    "end": "1945610"
  },
  {
    "text": "happened here but we can take a look at this and figure out what's happening and I'll talk a little bit more about how",
    "start": "1945610",
    "end": "1951730"
  },
  {
    "text": "specifically to figure that out in a second but first let's take a look at the Asus one it's it's a very very",
    "start": "1951730",
    "end": "1957700"
  },
  {
    "text": "similar situation where it's it's also making plain HTTP requests to a Seuss's",
    "start": "1957700",
    "end": "1964870"
  },
  {
    "text": "website and this the structure of the request is slightly different where instead of a an ASP page with the model",
    "start": "1964870",
    "end": "1971590"
  },
  {
    "text": "they have a specific path that they're requesting for this specific motherboard and here's the response from the server",
    "start": "1971590",
    "end": "1978870"
  },
  {
    "text": "saying here's your update that's available for this motherboard in this case it's not XML it's like XML but a",
    "start": "1978870",
    "end": "1986400"
  },
  {
    "text": "little bit different and it has similar issue it's like if you put long strings",
    "start": "1986400",
    "end": "1992310"
  },
  {
    "text": "and in these fields you get the same behavior where the update just hangs in",
    "start": "1992310",
    "end": "2000110"
  },
  {
    "text": "order to figure out what actually happens at that point and what actually happened like in an operating system or",
    "start": "2000110",
    "end": "2006370"
  },
  {
    "text": "application like applet user mode applications even kernel mode apps you",
    "start": "2006370",
    "end": "2011930"
  },
  {
    "text": "have gdb kernel debugging tools when you're debugging BIOS you don't have",
    "start": "2011930",
    "end": "2017570"
  },
  {
    "text": "those capabilities yet so you need to use some hardware debug interfaces instead if you look at these three",
    "start": "2017570",
    "end": "2024520"
  },
  {
    "text": "xtp is the really old expensive one old",
    "start": "2024520",
    "end": "2029600"
  },
  {
    "text": "systems basically had a socket on the motherboard that was marked sometimes it's even on the silkscreen of",
    "start": "2029600",
    "end": "2035900"
  },
  {
    "text": "production system saying CPU XDP or PCH XDP that you literally had to open the",
    "start": "2035900",
    "end": "2042140"
  },
  {
    "text": "case plug this into and then you had this debug capability and you can see",
    "start": "2042140",
    "end": "2049429"
  },
  {
    "text": "what's going on they've moved to what's called called a closed chassis adapter which basically allows you to do debug",
    "start": "2049429",
    "end": "2057470"
  },
  {
    "text": "through a USB port and figure out what's going on without opening the case and",
    "start": "2057470",
    "end": "2063040"
  },
  {
    "text": "there there's also so there's the clothes chassis adapter and then there's also just a native debug key USB 3 debug",
    "start": "2063040",
    "end": "2071360"
  },
  {
    "text": "capability which uses this cable on the the right here which it's essentially",
    "start": "2071360",
    "end": "2077330"
  },
  {
    "text": "just a USB 3 a to a cable where the V bus line has been removed they all like",
    "start": "2077330",
    "end": "2082940"
  },
  {
    "text": "the the two on the right are essentially equivalent and you can use those on systems from skylake and newer all three",
    "start": "2082940",
    "end": "2090080"
  },
  {
    "text": "of these were made for debugging the hardware and there they're sold to OEMs",
    "start": "2090080",
    "end": "2097040"
  },
  {
    "text": "and bios manufacturers so that they can figure out what's going on when they're implementing BIOS and bringing up",
    "start": "2097040",
    "end": "2102950"
  },
  {
    "text": "platforms before they sell them to customers the two on the left you in order to get those you can buy those",
    "start": "2102950",
    "end": "2109680"
  },
  {
    "text": "if you're an external customer but you need to sign sign up basically get an",
    "start": "2109680",
    "end": "2116040"
  },
  {
    "text": "account with intel sign an NDA the one on the right if you have a new a new and",
    "start": "2116040",
    "end": "2121200"
  },
  {
    "text": "uh platform you can just buy that from third-party vendors and go go use that with a newer platform so it's also a lot",
    "start": "2121200",
    "end": "2128550"
  },
  {
    "text": "cheaper but basically those you can then use with what's called Intel system",
    "start": "2128550",
    "end": "2133890"
  },
  {
    "text": "debugger it's part of the Intel system studio package it essentially gives you capabilities that are similar to gdb",
    "start": "2133890",
    "end": "2141000"
  },
  {
    "text": "where you can examine memory you can look at register state you can look at",
    "start": "2141000",
    "end": "2146940"
  },
  {
    "text": "CPU structures like the GD T table you can set breakpoints it's a little bit",
    "start": "2146940",
    "end": "2154890"
  },
  {
    "text": "cumbersome to use sometimes and also you run into interesting things like when",
    "start": "2154890",
    "end": "2161880"
  },
  {
    "text": "since this is basically like JTAG so you you might need to halt the system enable",
    "start": "2161880",
    "end": "2168869"
  },
  {
    "text": "your breakpoints your hardware breakpoints and then go do your tests so it's there's a little bit more work and",
    "start": "2168869",
    "end": "2176460"
  },
  {
    "text": "it's not quite as as simple as just running gdb on a user mode out this freshing so there's also what's called",
    "start": "2176460",
    "end": "2182790"
  },
  {
    "text": "the Intel the debug abstraction layer which is essentially it's part of this Intel system debugger and an adult",
    "start": "2182790",
    "end": "2189059"
  },
  {
    "text": "system studio there there's essentially a framework that you can write Python",
    "start": "2189059",
    "end": "2194430"
  },
  {
    "text": "scripts in order to go do things and script your analysis and debugging of",
    "start": "2194430",
    "end": "2201839"
  },
  {
    "text": "the system so once you get into what's",
    "start": "2201839",
    "end": "2207900"
  },
  {
    "text": "going on UEFI is a little bit of a different environment just because",
    "start": "2207900",
    "end": "2215000"
  },
  {
    "text": "obviously your normal show kill won't work because there is no operating system yet like syscalls don't work none",
    "start": "2215000",
    "end": "2222510"
  },
  {
    "text": "of that framework has been loaded yet but there are some things that help us out a lot so first you're running is",
    "start": "2222510",
    "end": "2229589"
  },
  {
    "text": "ring 0 there there's none of these protections are present so there's no address randomization things are at",
    "start": "2229589",
    "end": "2235700"
  },
  {
    "text": "relatively predictable locations there's an executable stack it's basically",
    "start": "2235700",
    "end": "2242770"
  },
  {
    "text": "easy at that point once you know what your environment looks like there's",
    "start": "2242770",
    "end": "2248619"
  },
  {
    "text": "there's some other things is that you don't have operating system like Windows",
    "start": "2248619",
    "end": "2253839"
  },
  {
    "text": "or Linux or whatever functions yet but there is something called UEFI boot",
    "start": "2253839",
    "end": "2260200"
  },
  {
    "text": "services that those are present and you can call you fi boot services functions up until the point where exit boot",
    "start": "2260200",
    "end": "2267609"
  },
  {
    "text": "services is called and the operating system boot loader is launched so all of that is still present but you need to",
    "start": "2267609",
    "end": "2274030"
  },
  {
    "text": "know how UEFI works internally to actually take advantage of that and how to use these functions so a pretty key",
    "start": "2274030",
    "end": "2281740"
  },
  {
    "text": "point of how UEFI works is it's all built on top of this concept of UEFI",
    "start": "2281740",
    "end": "2287859"
  },
  {
    "text": "protocols and protocol interfaces and these are essentially human inter",
    "start": "2287859",
    "end": "2293080"
  },
  {
    "text": "component mechanisms for communication it's essentially like an object-oriented programming class where there's you can",
    "start": "2293080",
    "end": "2300310"
  },
  {
    "text": "have one piece of code published an interface using that's identified by",
    "start": "2300310",
    "end": "2306190"
  },
  {
    "text": "this gooood which is a globally unique identifier of course and you can you can",
    "start": "2306190",
    "end": "2312820"
  },
  {
    "text": "basically specify here's an interface that provides these capabilities and I",
    "start": "2312820",
    "end": "2318130"
  },
  {
    "text": "want to publish that by a go ahead and then some completely other different piece of code says I want to go use that",
    "start": "2318130",
    "end": "2324580"
  },
  {
    "text": "piece of capability so tell me where that that capability that protocol is",
    "start": "2324580",
    "end": "2330760"
  },
  {
    "text": "and then you can look up the protocol by go ahead and call functions in it it's it's essentially you look up this object",
    "start": "2330760",
    "end": "2337930"
  },
  {
    "text": "and then call functions in the object and it has built-in function pointers and then it's and private data exactly",
    "start": "2337930",
    "end": "2342940"
  },
  {
    "text": "like a class so some of the really critical boot services functions that",
    "start": "2342940",
    "end": "2348670"
  },
  {
    "text": "are useful are locate protocol that's the that's the mechanism by which you can go find some other part of UEFI so",
    "start": "2348670",
    "end": "2357430"
  },
  {
    "text": "like all of the functionality that we talked about before with the the network",
    "start": "2357430",
    "end": "2362589"
  },
  {
    "text": "stack that functionality to send email the functionality to use the D ntfs",
    "start": "2362589",
    "end": "2369970"
  },
  {
    "text": "driver to look at your file system all of that is is published all of those",
    "start": "2369970",
    "end": "2375730"
  },
  {
    "text": "interfaces published by doing so your shellcode can actually just do a locate protocol call",
    "start": "2375730",
    "end": "2381769"
  },
  {
    "text": "from boot services in order to go find the gooood for NTFS and then call",
    "start": "2381769",
    "end": "2386900"
  },
  {
    "text": "functions and that and do some interesting things some other really key",
    "start": "2386900",
    "end": "2391999"
  },
  {
    "text": "useful things for our purposes are load image this is essentially the key",
    "start": "2391999",
    "end": "2397430"
  },
  {
    "text": "function that's used to load a UEFI executable in the first place and you",
    "start": "2397430",
    "end": "2402470"
  },
  {
    "text": "can either specify a device path to a particular firmware volume or source",
    "start": "2402470",
    "end": "2408019"
  },
  {
    "text": "that you want to load this if I execute able from or you can give it a buffered",
    "start": "2408019",
    "end": "2414980"
  },
  {
    "text": "in memory and a size which is really nice for what we want to do and start",
    "start": "2414980",
    "end": "2420289"
  },
  {
    "text": "image basically takes the handle that's returned from load image and runs it as",
    "start": "2420289",
    "end": "2425299"
  },
  {
    "text": "an executable and launches yet launches the executable so putting this all",
    "start": "2425299",
    "end": "2430579"
  },
  {
    "text": "together our payload layout ends up looking a little bit like this where we",
    "start": "2430579",
    "end": "2436400"
  },
  {
    "text": "have a limited amount of size on that field that we talked about that's overflowed it turns out that if you have",
    "start": "2436400",
    "end": "2443089"
  },
  {
    "text": "too many bytes there you cause a pointer to reference that crashes before you",
    "start": "2443089",
    "end": "2449779"
  },
  {
    "text": "even get to the return address so you only have a limited amount of space on in that overflow on the stack itself but",
    "start": "2449779",
    "end": "2458559"
  },
  {
    "text": "we found that the entire XML document that was downloaded from the remote site is also in memory it's basically sitting",
    "start": "2458559",
    "end": "2466819"
  },
  {
    "text": "on the heap and we just in our in our exploit that actually goes on the stack in the overflow we just have a little",
    "start": "2466819",
    "end": "2473239"
  },
  {
    "text": "egg hunter shell code to go search for the heap search the heap to go find the rest of the exploit and basically jump",
    "start": "2473239",
    "end": "2481819"
  },
  {
    "text": "there one thing that we ran into though is that the XML document with the rest",
    "start": "2481819",
    "end": "2488150"
  },
  {
    "text": "of our exploit is sitting in the heap so",
    "start": "2488150",
    "end": "2493180"
  },
  {
    "text": "when when it was right before we we hit the return instruction and returned to",
    "start": "2493480",
    "end": "2500450"
  },
  {
    "text": "our overflowed return address they called a free function so our data is on",
    "start": "2500450",
    "end": "2505940"
  },
  {
    "text": "the heap but it's in no longer allocated space so if we trigger allocations it's gonna corrupt our our",
    "start": "2505940",
    "end": "2513690"
  },
  {
    "text": "buffer that we want to preserve and we want to execute our malicious code out of so it turns out that we basically",
    "start": "2513690",
    "end": "2519600"
  },
  {
    "text": "need to copy ourselves out of the heap into a different location and then from",
    "start": "2519600",
    "end": "2525960"
  },
  {
    "text": "there we can call the the load image and start image functions and basically",
    "start": "2525960",
    "end": "2532260"
  },
  {
    "text": "provide whatever arbitrary UEFI applications we want after that we could we could go use some functionality",
    "start": "2532260",
    "end": "2539430"
  },
  {
    "text": "that's built into the system we could bring up network connections we could use the NTFS driver but we could",
    "start": "2539430",
    "end": "2545220"
  },
  {
    "text": "basically do whatever we want at this point I imagined the NTFS driver a couple of",
    "start": "2545220",
    "end": "2553740"
  },
  {
    "text": "times and the interesting thing about that one is that if you've looked at the hacking team rip kit they actually as",
    "start": "2553740",
    "end": "2562320"
  },
  {
    "text": "part of the recs way they packaged up the NTFS driver with their exploit so",
    "start": "2562320",
    "end": "2568020"
  },
  {
    "text": "that they could use that functionality to rather than read a file out of the",
    "start": "2568020",
    "end": "2573060"
  },
  {
    "text": "operating system they would persistently inject their agent into the operating system using the NTFS driver and that",
    "start": "2573060",
    "end": "2579270"
  },
  {
    "text": "was an interesting at UEFI rootkit that you that you can do essentially that",
    "start": "2579270",
    "end": "2584640"
  },
  {
    "text": "from this exploit except you don't even need to bring the NTFS driver with you because it's already on the system so",
    "start": "2584640",
    "end": "2592830"
  },
  {
    "text": "what can we do about this there is there's been some talk in the UEFI forum about hardening you if I like doing",
    "start": "2592830",
    "end": "2601440"
  },
  {
    "text": "hardening page in configuration actually randomizing the stack making it a non",
    "start": "2601440",
    "end": "2607320"
  },
  {
    "text": "executable sack but none of that have actually been implemented yet so we're hoping that this will go in but it's",
    "start": "2607320",
    "end": "2614940"
  },
  {
    "text": "it's not even in the reference code and even once it goes into the reference code it'll take a while before it shows",
    "start": "2614940",
    "end": "2621030"
  },
  {
    "text": "up in real vendor biases that are being shipped into production devices so",
    "start": "2621030",
    "end": "2628130"
  },
  {
    "text": "that's what so we if you are concerned about detecting this we can we can",
    "start": "2628130",
    "end": "2634680"
  },
  {
    "text": "detect it with a fairly simple Yara rule if you have an IDs that can feed your network data through your aware it's",
    "start": "2634680",
    "end": "2640470"
  },
  {
    "text": "like we just need to look for our an extra-long URL field and it's a",
    "start": "2640470",
    "end": "2645530"
  },
  {
    "text": "pretty simple rule so we can detect the asrock buffer overflow live on the network with this Asics one is basically",
    "start": "2645530",
    "end": "2653990"
  },
  {
    "text": "very similar it's just a different field so if somebody has already modified your",
    "start": "2653990",
    "end": "2665030"
  },
  {
    "text": "bios a useful way to detect modifications to the system after the",
    "start": "2665030",
    "end": "2670940"
  },
  {
    "text": "fact is you can use the the chipset tool which is a really useful framework for",
    "start": "2670940",
    "end": "2676670"
  },
  {
    "text": "exploring hardware interfaces in the system you can use it to check for known miss configuration so like there's a",
    "start": "2676670",
    "end": "2682580"
  },
  {
    "text": "there's a lot of bits and locks and hardware configuration that needs to be set properly in order for a system to be",
    "start": "2682580",
    "end": "2690290"
  },
  {
    "text": "secure once it boots up and we found many many issues where biases were not",
    "start": "2690290",
    "end": "2697160"
  },
  {
    "text": "setting everything that they needed to set or they were setting one part and not setting it in other places so I",
    "start": "2697160",
    "end": "2705320"
  },
  {
    "text": "totally recommend trying out chips like it's also a good frame it's basically there's a kernel driver to go get the",
    "start": "2705320",
    "end": "2714020"
  },
  {
    "text": "rep Hardware access then it's all written in Python so it's really easy to to build new tests and framework so you",
    "start": "2714020",
    "end": "2720890"
  },
  {
    "text": "can use it to explore the system you can also use it to build build exploits and",
    "start": "2720890",
    "end": "2726020"
  },
  {
    "text": "proof of concept to try things out but there's basically some built-in",
    "start": "2726020",
    "end": "2731360"
  },
  {
    "text": "functionality that's been added to chip sack to be able to extract the spy image",
    "start": "2731360",
    "end": "2736880"
  },
  {
    "text": "from the running system and then check it against the whitelist that you've built previously so if you've if you",
    "start": "2736880",
    "end": "2745280"
  },
  {
    "text": "think you've been hacked or somebody has implanted a system in your implanted",
    "start": "2745280",
    "end": "2752450"
  },
  {
    "text": "your bios made some modification maliciously maybe somebody managed to",
    "start": "2752450",
    "end": "2758770"
  },
  {
    "text": "find a runtime vulnerability or there's a vulnerability and how it sets up the system so the spy right protection is",
    "start": "2758770",
    "end": "2764960"
  },
  {
    "text": "not correctly configured and somebody the a is able to modify that and they're able you can basically extract",
    "start": "2764960",
    "end": "2772490"
  },
  {
    "text": "the spy and then check it against the whitelist you can also generate a whitelist so like when you buy a new",
    "start": "2772490",
    "end": "2779930"
  },
  {
    "text": "system if you if you believe it hasn't been tampered with yet hopefully you didn't have a supply chain compromised",
    "start": "2779930",
    "end": "2786080"
  },
  {
    "text": "and along the way but if you think it's in a known good state you can generate a whitelist using this second command line",
    "start": "2786080",
    "end": "2792770"
  },
  {
    "text": "here which will basically parse all of the firmware volumes generate hashes for",
    "start": "2792770",
    "end": "2799130"
  },
  {
    "text": "all of the images in the in the EFI binary and then later maybe once you've",
    "start": "2799130",
    "end": "2806390"
  },
  {
    "text": "traveled to Vegas with a bunch of other hackers maybe you think something happened you can then go go back and",
    "start": "2806390",
    "end": "2812110"
  },
  {
    "text": "check your generator your you can check your system against this but this",
    "start": "2812110",
    "end": "2817760"
  },
  {
    "text": "whitelist that you generated previously so it's a really useful bit of functionality so some basic concepts is",
    "start": "2817760",
    "end": "2827630"
  },
  {
    "text": "the system firmware is really big it's complex it's highly privileged software",
    "start": "2827630",
    "end": "2832700"
  },
  {
    "text": "it runs before the operating system loads also BIOS has about has had a",
    "start": "2832700",
    "end": "2840380"
  },
  {
    "text": "bunch of issues where it's like it's been kind of a mess and it's it's getting better like the update process",
    "start": "2840380",
    "end": "2845620"
  },
  {
    "text": "it still is a mess it's hard to update a lot of people don't update BIOS but this",
    "start": "2845620",
    "end": "2852830"
  },
  {
    "text": "this remote attack surface it's it keeps showing up in new places and new places",
    "start": "2852830",
    "end": "2859130"
  },
  {
    "text": "that didn't have a network remote attack service now suddenly do and part of that",
    "start": "2859130",
    "end": "2864500"
  },
  {
    "text": "is just because of like trying to fix the problem of doing system updates in the first place people are adding new",
    "start": "2864500",
    "end": "2869900"
  },
  {
    "text": "exploit vectors and adding new vulnerabilities to the system that didn't exist in the first place",
    "start": "2869900",
    "end": "2875090"
  },
  {
    "text": "so I think we've reached our end of a time so anybody have any questions do",
    "start": "2875090",
    "end": "2882740"
  },
  {
    "text": "you have a time for questions okay [Applause]",
    "start": "2882740",
    "end": "2890828"
  }
]