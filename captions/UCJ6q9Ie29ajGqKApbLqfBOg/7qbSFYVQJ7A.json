[
  {
    "start": "0",
    "end": "0"
  },
  {
    "text": "thank you very much for coming here today for our talk watching the Watchdog protecting caros with network",
    "start": "199",
    "end": "8040"
  },
  {
    "text": "monitoring and my name is tberry and my colleague here is Michael churny we both",
    "start": "8040",
    "end": "15000"
  },
  {
    "text": "work for Microsoft we work on the research team of the Microsoft Advanced",
    "start": "15000",
    "end": "20119"
  },
  {
    "text": "threat analytics a product that analyzes attacker's movement over the network and",
    "start": "20119",
    "end": "28240"
  },
  {
    "text": "how many of you have been here for the keynote please raise hands if you were here so many of you great so I hope this",
    "start": "28240",
    "end": "37320"
  },
  {
    "text": "presentation ER will be in the standard that the speaker Haron suggested for",
    "start": "37320",
    "end": "43960"
  },
  {
    "text": "security H talks which means hopefully uh we will",
    "start": "43960",
    "end": "50520"
  },
  {
    "text": "be able to give you something to work on a to convince you that we are working on",
    "start": "50520",
    "end": "56800"
  },
  {
    "text": "a tangible problem a problem which is concrete and happens in real life and we",
    "start": "56800",
    "end": "63320"
  },
  {
    "text": "will take a a deeper look into the Cabos",
    "start": "63320",
    "end": "68439"
  },
  {
    "text": "protocol and a new breed of attacks against it and also a new attack that we",
    "start": "68439",
    "end": "74280"
  },
  {
    "text": "will expose but also come with a Solutions of network monitoring and we",
    "start": "74280",
    "end": "81560"
  },
  {
    "text": "will also release a tool that you can try H when you get back to your homes and your uh",
    "start": "81560",
    "end": "89920"
  },
  {
    "text": "internal networks so what are we going to talk about today we'll start uh with",
    "start": "89920",
    "end": "96880"
  },
  {
    "text": "discussing the ATT motivation why is this problem of attacks against caros",
    "start": "96880",
    "end": "103600"
  },
  {
    "text": "even matter we'll talk about the details of the caros authentication and caros",
    "start": "103600",
    "end": "109759"
  },
  {
    "text": "protocol and we will talk about new attackers Paradigm of switching from",
    "start": "109759",
    "end": "116039"
  },
  {
    "text": "stealing attacks to forgery attacks and what the attackers achieved by that",
    "start": "116039",
    "end": "121799"
  },
  {
    "text": "we'll talk a little bit about what it means to do network monitoring of the Careo protocol and this is in the",
    "start": "121799",
    "end": "128000"
  },
  {
    "text": "introduction then we'll take the really deep dive into four different attacks",
    "start": "128000",
    "end": "134440"
  },
  {
    "text": "and finally we will have a we will wrap it up with some H what we think action",
    "start": "134440",
    "end": "142800"
  },
  {
    "text": "actionable recommendations and a new tool that we are",
    "start": "142800",
    "end": "147879"
  },
  {
    "text": "releasing so let's start with the start why do attackers attack the Cabos",
    "start": "147879",
    "end": "155480"
  },
  {
    "start": "149000",
    "end": "149000"
  },
  {
    "text": "protocol because attackers need access attackers usually infect one",
    "start": "155480",
    "end": "162760"
  },
  {
    "text": "machine within your network but it's some random arbitrary machine it's",
    "start": "162760",
    "end": "169080"
  },
  {
    "text": "not it's not where the data they want to get to resides so they need to travel H",
    "start": "169080",
    "end": "176360"
  },
  {
    "text": "through your network until they reach their destination and to do that they need access and",
    "start": "176360",
    "end": "182959"
  },
  {
    "text": "access requires both authentications which means verifying the user identity",
    "start": "182959",
    "end": "188840"
  },
  {
    "text": "and authorization they need a user with just enough privileges to do what they need",
    "start": "188840",
    "end": "195360"
  },
  {
    "text": "to access the data that they want and since caros is the default auth",
    "start": "195360",
    "end": "201640"
  },
  {
    "text": "authentication and authorization protocol of the windows networks it means attacker must attack the Kos",
    "start": "201640",
    "end": "208959"
  },
  {
    "text": "protocol in order to get the access they desperately needs so they have no choice",
    "start": "208959",
    "end": "214519"
  },
  {
    "text": "they have to attack or at least abuse the Kos protocol and here is a quick H review of",
    "start": "214519",
    "end": "224640"
  },
  {
    "text": "the keos protocol of the authentication and authorization so what happens on a",
    "start": "224640",
    "end": "230120"
  },
  {
    "text": "Windows machine when you input your password so let's say and these Graphics",
    "start": "230120",
    "end": "235879"
  },
  {
    "text": "are by Benjamin Delp the author of a Mim",
    "start": "235879",
    "end": "241239"
  },
  {
    "text": "when the user inputs his password let's say Wasa 2 34 slash then the elas H",
    "start": "241239",
    "end": "248840"
  },
  {
    "text": "process within the computer H deres keys from that password",
    "start": "248840",
    "end": "254760"
  },
  {
    "text": "encryption keys that are derived from this specific password then it sends an",
    "start": "254760",
    "end": "261320"
  },
  {
    "text": "as request you request authentication",
    "start": "261320",
    "end": "266919"
  },
  {
    "text": "Service H from the KDC the KDC is the Kos server and I will use call it KDC or",
    "start": "266919",
    "end": "274520"
  },
  {
    "text": "a DC for domain controller or active directory but anytime I say it it means",
    "start": "274520",
    "end": "280320"
  },
  {
    "text": "the same the Cabos server so the user send something encrypted with the key",
    "start": "280320",
    "end": "287199"
  },
  {
    "text": "that is derived from the password on stage one with as request the",
    "start": "287199",
    "end": "292720"
  },
  {
    "text": "KDC tries to decrypt it with the users key because the DC has all the keys if",
    "start": "292720",
    "end": "299639"
  },
  {
    "text": "if they are success if the server is successful in decrypting it it returns a",
    "start": "299639",
    "end": "305280"
  },
  {
    "text": "TGT ticket granting ticket to H back to the user and from there from that point",
    "start": "305280",
    "end": "314120"
  },
  {
    "text": "onwards the user does not have to Reino uh their password they use that ticket",
    "start": "314120",
    "end": "320800"
  },
  {
    "text": "to request specific access to the servers to the services they want say",
    "start": "320800",
    "end": "325880"
  },
  {
    "text": "they want to access a file server then they present the TGT in step three they",
    "start": "325880",
    "end": "333000"
  },
  {
    "text": "send it again to the DC and the DC looks at the TGT and deres a relevant TGs a",
    "start": "333000",
    "end": "341400"
  },
  {
    "text": "service ticket H which is a specific to the resource the user want to use and",
    "start": "341400",
    "end": "349680"
  },
  {
    "text": "we'll go into uh deeper details uh in coming",
    "start": "349680",
    "end": "355360"
  },
  {
    "text": "slides let's repeat again on the process what happens H in the kpost protocol",
    "start": "355360",
    "end": "361560"
  },
  {
    "text": "when user input credentials so the user inputs",
    "start": "361560",
    "end": "367039"
  },
  {
    "text": "their credential right there and a key is derived and this key is used to lock",
    "start": "367039",
    "end": "375240"
  },
  {
    "text": "a box or in reality to encrypt a time stamp that locked box ER is coming to",
    "start": "375240",
    "end": "383240"
  },
  {
    "text": "the DC this triangle the DC try to open it with the key of the user and if it's",
    "start": "383240",
    "end": "391319"
  },
  {
    "text": "successful then it put in the same box which means it encrypts with the same key the ticket and the this ticket this",
    "start": "391319",
    "end": "399160"
  },
  {
    "text": "TGT comes back to the user so there are very obvious attacks",
    "start": "399160",
    "end": "405440"
  },
  {
    "text": "against this scheme and it's stealing attacks attacker which is based on the",
    "start": "405440",
    "end": "411960"
  },
  {
    "text": "endpoint can ke can steal either the credentials the key or the ticket that",
    "start": "411960",
    "end": "420479"
  },
  {
    "text": "comes in the end of it and there are specific names credential stealing overpass the hash and for key stealing",
    "start": "420479",
    "end": "429960"
  },
  {
    "text": "and ticket stealing is calling passing the ticket so it's very obvious you can",
    "start": "429960",
    "end": "435039"
  },
  {
    "text": "Ste any of these ingredients and disguise yourself as the user that whose",
    "start": "435039",
    "end": "441759"
  },
  {
    "text": "identity you had stolen but stealing will only take the attackers so",
    "start": "441759",
    "end": "448080"
  },
  {
    "text": "far because you can steal and attackers can steal only what is present you cannot steal",
    "start": "448080",
    "end": "454520"
  },
  {
    "text": "what is isn't there and therefore they have to wait for the right user the user",
    "start": "454520",
    "end": "461720"
  },
  {
    "text": "with enough privileges the user Which is less Monitor and so on so forth and they",
    "start": "461720",
    "end": "467240"
  },
  {
    "text": "have to wait but waiting is boring and time is money from the attacker",
    "start": "467240",
    "end": "472720"
  },
  {
    "text": "perspective that don't want to wait with their operation until some Er",
    "start": "472720",
    "end": "478360"
  },
  {
    "text": "administrator logs in into the machine they",
    "start": "478360",
    "end": "483520"
  },
  {
    "text": "control and and steing things is the tokens are",
    "start": "483520",
    "end": "490319"
  },
  {
    "text": "unpredict unreliable in some sense because they can expire tickets Kos",
    "start": "490319",
    "end": "496400"
  },
  {
    "text": "ticket expires usually after 10 hours passwords and keys can change so ATT attacker don't want to start their",
    "start": "496400",
    "end": "504440"
  },
  {
    "text": "campaign and in the middle ER understand that they pass and access is no longer",
    "start": "504440",
    "end": "511520"
  },
  {
    "text": "valid and go back to square one and for some scenarios there",
    "start": "511520",
    "end": "516959"
  },
  {
    "text": "basically there is no Mr right there isn't a right a user that just does not",
    "start": "516959",
    "end": "522880"
  },
  {
    "text": "exist for example if a attacker wants a user with administrative privileges so",
    "start": "522880",
    "end": "528839"
  },
  {
    "text": "they can access everything but yet that this user won't be listed as",
    "start": "528839",
    "end": "535399"
  },
  {
    "text": "administrator so it wouldn't be monitored by some ER some uh monitoring",
    "start": "535399",
    "end": "541959"
  },
  {
    "text": "tools then there isn't such so you cannot steal it but if you use if",
    "start": "541959",
    "end": "548560"
  },
  {
    "text": "attackers uses forgery and they are forging H the relevant C tokens and they",
    "start": "548560",
    "end": "555040"
  },
  {
    "text": "are fiddling with the protocol they can get an ond demand privilege and access",
    "start": "555040",
    "end": "560560"
  },
  {
    "text": "as they want so so they move on attackers from",
    "start": "560560",
    "end": "565640"
  },
  {
    "start": "562000",
    "end": "562000"
  },
  {
    "text": "for from stealing to forgery and we will talk about four specific attacks H the",
    "start": "565640",
    "end": "572399"
  },
  {
    "text": "forge key the skeleton key and Forge H ticket the golden ticket and two",
    "start": "572399",
    "end": "579640"
  },
  {
    "text": "variants of Forge pack and we will explain what this pack ms1 1468 and the",
    "start": "579640",
    "end": "585360"
  },
  {
    "text": "new attack we develop the diamond Pack Attack and just before we go on to the",
    "start": "585360",
    "end": "592839"
  },
  {
    "text": "specifics of this attack uh we said that everything can be H protect detected and",
    "start": "592839",
    "end": "599600"
  },
  {
    "text": "detected using network monitoring what do we mean by that we mean that all of",
    "start": "599600",
    "end": "607640"
  },
  {
    "text": "these devices every device that wants to access resource within the network must pick Kos H with the active",
    "start": "607640",
    "end": "616320"
  },
  {
    "text": "directory so regardless of H the operating system this could be an iOS windows or",
    "start": "616320",
    "end": "624760"
  },
  {
    "text": "or Linux and this protocol messages are flowing to the active directory and",
    "start": "624760",
    "end": "631720"
  },
  {
    "text": "security device that passively monitors that traffic just Port mirroring on the",
    "start": "631720",
    "end": "637440"
  },
  {
    "text": "switch in front of er the active directory the C server we will show that",
    "start": "637440",
    "end": "644560"
  },
  {
    "text": "it is enough to mitigate and detect all of these attacks and very importantly",
    "start": "644560",
    "end": "650839"
  },
  {
    "text": "without knowing any of the active directory Secrets this device does not need to know any of H the passwords",
    "start": "650839",
    "end": "658560"
  },
  {
    "text": "within the domain with that let's start with the first attack the skeleton key",
    "start": "658560",
    "end": "663600"
  },
  {
    "text": "Michael this yours thank you T so let's talk about skeleton key what",
    "start": "663600",
    "end": "670399"
  },
  {
    "text": "is skeleton key skeleton key is actually really cool malware attackers installing a malware",
    "start": "670399",
    "end": "677279"
  },
  {
    "start": "671000",
    "end": "671000"
  },
  {
    "text": "on DC to be able to authenticate as any user by using one unique",
    "start": "677279",
    "end": "682440"
  },
  {
    "text": "uh secret password the result is result is amazing iter can now log on",
    "start": "682440",
    "end": "689480"
  },
  {
    "text": "to any workstation or any server either via terminal or over the network using that single use secret",
    "start": "689480",
    "end": "698000"
  },
  {
    "text": "password but the original user experience is not humed they can it still looks and feels the same so let's",
    "start": "698000",
    "end": "705040"
  },
  {
    "text": "just experience that and see how this looks like let's say we have an administrator whose password is admin1",
    "start": "705040",
    "end": "712760"
  },
  {
    "text": "123 and the secret password an attackers configured to be",
    "start": "712760",
    "end": "717959"
  },
  {
    "text": "password so now administrator approaches the his administrative station enters",
    "start": "717959",
    "end": "724880"
  },
  {
    "text": "his password logs in just like it should and then uh by mistake he enters the",
    "start": "724880",
    "end": "732000"
  },
  {
    "text": "wrong password and again just as he should he or she the where is a failure",
    "start": "732000",
    "end": "738519"
  },
  {
    "text": "but now when an attacker enters his secret password boom he also succeed to log",
    "start": "738519",
    "end": "745600"
  },
  {
    "text": "in uh so after The Skeleton Key malware was work was published by DC cure Works",
    "start": "745600",
    "end": "753639"
  },
  {
    "text": "Benjamin Delp also added support to mimicat uh for the skeleton key and now",
    "start": "753639",
    "end": "760839"
  },
  {
    "text": "it's product I fall everybody can try it now let's see how the scalon key",
    "start": "760839",
    "end": "768639"
  },
  {
    "text": "works first let's focus on the fact that caros supports multiple encryption types",
    "start": "768639",
    "end": "774560"
  },
  {
    "text": "from this fact we can conclude that client and the server the main controller need to negotiate to know",
    "start": "774560",
    "end": "780240"
  },
  {
    "text": "which of the encryptions to be to use how this negotiation",
    "start": "780240",
    "end": "785639"
  },
  {
    "text": "happens uh user at the client machine enters his username password and the",
    "start": "785639",
    "end": "791160"
  },
  {
    "text": "client sends uh the client machine sends to The Domain what are the encrypted what the supported encrypted ties from",
    "start": "791160",
    "end": "797839"
  },
  {
    "text": "his perspective the domain controller uh",
    "start": "797839",
    "end": "803040"
  },
  {
    "text": "takes this and uh cuts it with uh what it can and what are the keys type of",
    "start": "803040",
    "end": "810399"
  },
  {
    "text": "keys this user have in a active directory database so in this case it",
    "start": "810399",
    "end": "816079"
  },
  {
    "text": "has rc4 and as keys so it will respond okay we I can talk with you r rc4 or",
    "start": "816079",
    "end": "823639"
  },
  {
    "text": "as uh the client hopefully will choose the more secure one calculate the hashes",
    "start": "823639",
    "end": "830959"
  },
  {
    "text": "from the user password accordingly encrypt the time stamp and send it to",
    "start": "830959",
    "end": "836800"
  },
  {
    "text": "the domain controller domain controller will try to decrypt it with recording uh key type of that user and if a",
    "start": "836800",
    "end": "843199"
  },
  {
    "text": "decryption is successful it will send back the ticket Grant and ticket the",
    "start": "843199",
    "end": "848600"
  },
  {
    "text": "TGT now this is how it looks always the wire from The Wire Shar perspective client sends all the encryption types it",
    "start": "849000",
    "end": "856959"
  },
  {
    "text": "supports the the main clor answers with what it can do as and rc4 and the client",
    "start": "856959",
    "end": "862959"
  },
  {
    "text": "response with a time stamp encrypted with as now what the difference between as",
    "start": "862959",
    "end": "869880"
  },
  {
    "start": "868000",
    "end": "868000"
  },
  {
    "text": "and rc4 and how it's related to this malware uh we said that uh client sends",
    "start": "869880",
    "end": "876279"
  },
  {
    "text": "the time stamp encrypted with a derivative of the user's password so if an attacker would",
    "start": "876279",
    "end": "883240"
  },
  {
    "text": "sniff that time stamp attacker could attempt a Brute Force attack to make",
    "start": "883240",
    "end": "888880"
  },
  {
    "text": "those Brute Force attacks more difficult there's two known technical one is salting it's goal that for two different",
    "start": "888880",
    "end": "896120"
  },
  {
    "text": "users even if their password is the same the key the hash would be different it's done by painting a Sal",
    "start": "896120",
    "end": "903639"
  },
  {
    "text": "string to the password while deriving the the hash as is using the",
    "start": "903639",
    "end": "909600"
  },
  {
    "text": "username as a salt making it unique for each user rc4 on the other hand doesn't",
    "start": "909600",
    "end": "915519"
  },
  {
    "text": "use any salting another technique here is a key stretching its goal is to",
    "start": "915519",
    "end": "923959"
  },
  {
    "text": "increase the amount of CPU required to check where a single password is correct one or not",
    "start": "923959",
    "end": "929279"
  },
  {
    "text": "uh therefore uh drawing the mass Brute Force attack invasible as is using",
    "start": "929279",
    "end": "935120"
  },
  {
    "text": "pbkdf2 standard which is a password based key derivation function two standard which is basically performing",
    "start": "935120",
    "end": "940959"
  },
  {
    "text": "thousand of sha rounds in case of windows it's 4K rounds by default rc4 again doesn't do any",
    "start": "940959",
    "end": "949160"
  },
  {
    "text": "keyring how it's relevant to our attack to the attackers and skeleton key",
    "start": "949160",
    "end": "954560"
  },
  {
    "start": "951000",
    "end": "951000"
  },
  {
    "text": "attackers in this case La C4 why because due to salting I identical password",
    "start": "954560",
    "end": "959600"
  },
  {
    "text": "would create different a ke for different users and therefore that uh one unique password which uh secret",
    "start": "959600",
    "end": "965880"
  },
  {
    "text": "password which attack is configured we would have to either calculate it for each user authentication in real time",
    "start": "965880",
    "end": "972399"
  },
  {
    "text": "which would require a lot of CPU or pre precalculate it and store in memory",
    "start": "972399",
    "end": "978240"
  },
  {
    "text": "which require a lot of memory what attacker do in this case we just cause domain C to downgrade to rc4",
    "start": "978240",
    "end": "986199"
  },
  {
    "text": "and how they do it I said that the malware is schol what it does it actually patches in memory the code of",
    "start": "986199",
    "end": "992240"
  },
  {
    "text": "the main controller one function which is the patches is the function which checks whether the user have what it's",
    "start": "992240",
    "end": "1000160"
  },
  {
    "text": "called carus new keys which is basically as keys and a turn false where drawing",
    "start": "1000160",
    "end": "1005440"
  },
  {
    "text": "those keys practically non-existent and another one is the cryp function decrypt",
    "start": "1005440",
    "end": "1011360"
  },
  {
    "text": "function is that same function which tries to decrypt the time stamp and uh",
    "start": "1011360",
    "end": "1016839"
  },
  {
    "text": "therefore check whether the the user is uh what he claims it",
    "start": "1016839",
    "end": "1022040"
  },
  {
    "text": "is it's patch in a way so that the original uh decrypt it's first calls the original decrypt function and if it",
    "start": "1022040",
    "end": "1029120"
  },
  {
    "text": "fails it calls it again with a hash of the secret uh password so if the",
    "start": "1029120",
    "end": "1036600"
  },
  {
    "text": "password if the user entered the password correct it will still it will work as expected user will be",
    "start": "1036600",
    "end": "1042438"
  },
  {
    "text": "authenticated if the secret password will be entered again it will be authenticated if it's neither of them where for wrong password it will",
    "start": "1042439",
    "end": "1050400"
  },
  {
    "text": "fail so this is how it looks like the user",
    "start": "1050400",
    "end": "1055039"
  },
  {
    "start": "1051000",
    "end": "1051000"
  },
  {
    "text": "enters the the demon controller is uh infected with skeleton malare this means that",
    "start": "1055799",
    "end": "1064039"
  },
  {
    "text": "practically or effectively each user now have two rc4 uh Keys one the original one which",
    "start": "1064039",
    "end": "1072080"
  },
  {
    "text": "is derivative of his own password and another one is the derivative of the skeleton key configured password and",
    "start": "1072080",
    "end": "1078480"
  },
  {
    "text": "another effect is that as keys are now not accessible they practically does not do not exist so now then the user enters",
    "start": "1078480",
    "end": "1085120"
  },
  {
    "text": "the skeleton password uh client is not affected this",
    "start": "1085120",
    "end": "1090520"
  },
  {
    "text": "is very important notion here client is not affected by this malware this malware only exist on the on the domain",
    "start": "1090520",
    "end": "1096600"
  },
  {
    "text": "controller but domain controller now looks and says Ah I only have an rc4 key for this user so the only one I support",
    "start": "1096600",
    "end": "1103960"
  },
  {
    "text": "now is the rc4 and the client will calculate rc4",
    "start": "1103960",
    "end": "1109240"
  },
  {
    "text": "hash encrypt the time stamp with rc4 the demon cler will check that uh uh the",
    "start": "1109240",
    "end": "1117640"
  },
  {
    "text": "encryption is correct either with original password or again with skeleton key and return the DT back to the client",
    "start": "1117640",
    "end": "1123960"
  },
  {
    "text": "and to the user so this is how it works this is how it looks over the wire",
    "start": "1123960",
    "end": "1130240"
  },
  {
    "text": "this is before the uh the domain Coler was infected with",
    "start": "1130240",
    "end": "1136240"
  },
  {
    "text": "the skeleton key client sends all the encryption types domain CL responds with",
    "start": "1136240",
    "end": "1141559"
  },
  {
    "text": "all of them and the client sends the time stamp incor with as after it was",
    "start": "1141559",
    "end": "1148799"
  },
  {
    "text": "infected client as we said is not affected so it s just the same all the encrypted tie on thetion types it",
    "start": "1148799",
    "end": "1155320"
  },
  {
    "text": "supports but now the domain controller responds only with rc4 and therefore",
    "start": "1155320",
    "end": "1160480"
  },
  {
    "text": "client will also encrypt the time St C4 and send it back to the domain",
    "start": "1160480",
    "end": "1166600"
  },
  {
    "text": "controller so how can we detected we said that the essence of the",
    "start": "1166600",
    "end": "1171919"
  },
  {
    "text": "skeleton key malware is to downgrade to rc4 so therefore we can",
    "start": "1171919",
    "end": "1176960"
  },
  {
    "text": "detected this Behavior because it's also manifest itself over the network we can know that the user should",
    "start": "1176960",
    "end": "1184400"
  },
  {
    "text": "be offered as by DC how because either we saw in the past and learned that DC",
    "start": "1184400",
    "end": "1190440"
  },
  {
    "text": "the was offering as to the user in a previous access or by judging by the main conf function level and the user",
    "start": "1190440",
    "end": "1197840"
  },
  {
    "text": "capability is so if it should be or was as before why it's only rc4",
    "start": "1197840",
    "end": "1203960"
  },
  {
    "text": "now the Microsoft Advanced F analytic uh monitor the domain and detects the",
    "start": "1203960",
    "end": "1209960"
  },
  {
    "start": "1205000",
    "end": "1205000"
  },
  {
    "text": "downgrade activity this is the screenshot of the alert and alerts on it saying it's probably the Skeleton",
    "start": "1209960",
    "end": "1216000"
  },
  {
    "text": "Key T also wrote uh the script which can actively check where the main St is",
    "start": "1216000",
    "end": "1224159"
  },
  {
    "text": "infected There's the link here to down to download this script and try it",
    "start": "1224159",
    "end": "1230158"
  },
  {
    "text": "and this screenshot is the screenshot of the mimik cats which infects the DOR",
    "start": "1230280",
    "end": "1235400"
  },
  {
    "text": "with scalon key and the script TCP which runs and detects that it indeed",
    "start": "1235400",
    "end": "1242559"
  },
  {
    "text": "infected now we return to the T to talk about golden ticket thank you",
    "start": "1242559",
    "end": "1248960"
  },
  {
    "text": "Michael let's move on to the next attack and REM remind oursel again what is",
    "start": "1249280",
    "end": "1255200"
  },
  {
    "text": "karos and we only we said the keos is the default authentication and authorization protocol but we only",
    "start": "1255200",
    "end": "1261559"
  },
  {
    "text": "talked about authentication which means verifying the identity of the user we didn't speak about authorization at all",
    "start": "1261559",
    "end": "1268360"
  },
  {
    "text": "which means how H this system assigns privileges H to the",
    "start": "1268360",
    "end": "1274880"
  },
  {
    "text": "user so let's do that and in Windows networks ER authorization is realized",
    "start": "1274880",
    "end": "1282919"
  },
  {
    "start": "1275000",
    "end": "1275000"
  },
  {
    "text": "and implemented with a Pac privilege attribute certificate which holds all",
    "start": "1282919",
    "end": "1289320"
  },
  {
    "text": "the authorization data you can see here which means basically all the groups you",
    "start": "1289320",
    "end": "1295240"
  },
  {
    "text": "are member with so this user the administrator is member of domain admins",
    "start": "1295240",
    "end": "1302400"
  },
  {
    "text": "Enterprise admins schema admins and so on and so forth and if you can think the",
    "start": "1302400",
    "end": "1310279"
  },
  {
    "text": "brick and mortar analogy for a authentication authorization is ID card",
    "start": "1310279",
    "end": "1316919"
  },
  {
    "text": "so the your picture and name is your uh is the authentication part and",
    "start": "1316919",
    "end": "1323679"
  },
  {
    "text": "authorization is the part that say what you are allowed to do with this card maybe to drive some vehicle or enter",
    "start": "1323679",
    "end": "1330720"
  },
  {
    "text": "some place so this is authentication and authorization and the pack is not",
    "start": "1330720",
    "end": "1337279"
  },
  {
    "text": "only contain does not only contains H groups but also has some security",
    "start": "1337279",
    "end": "1342799"
  },
  {
    "text": "measures within it h of H H signatures and we talk about",
    "start": "1342799",
    "end": "1348720"
  },
  {
    "text": "that H so how is the Pack Go enters the game of caros so when",
    "start": "1348720",
    "end": "1357240"
  },
  {
    "text": "the user authenticates to the DC and assuming that the key was indeed the",
    "start": "1357240",
    "end": "1362480"
  },
  {
    "text": "right one the DC calculates H this pack which again this is all the groups that",
    "start": "1362480",
    "end": "1369720"
  },
  {
    "text": "the user is member in and sends it along the TGT and embedded",
    "start": "1369720",
    "end": "1376960"
  },
  {
    "text": "Within then when er the user request",
    "start": "1376960",
    "end": "1382200"
  },
  {
    "text": "access to a specific resource that pack is being copied from the TGT into the",
    "start": "1382200",
    "end": "1388919"
  },
  {
    "text": "service ticket and that's the way that authorization is implemented in windows",
    "start": "1388919",
    "end": "1395520"
  },
  {
    "text": "with care Bros protocol a quick word and reminder what",
    "start": "1395520",
    "end": "1401440"
  },
  {
    "text": "is dig digital signature specifically hmark so this is the Wikipedia",
    "start": "1401440",
    "end": "1407360"
  },
  {
    "text": "definition message authentication code Mac a short piece of information used to",
    "start": "1407360",
    "end": "1412600"
  },
  {
    "text": "authenticate a message and HMK is just a hash ma a ma that uses a hash and we can",
    "start": "1412600",
    "end": "1418960"
  },
  {
    "text": "see in this diagram again from Wikipedia that the algorithm the hashm algorithm",
    "start": "1418960",
    "end": "1424679"
  },
  {
    "text": "takes a key and does some calculation with the message and the key and the",
    "start": "1424679",
    "end": "1430520"
  },
  {
    "text": "receiver which has also has the key can verify H that indeed this uh message has",
    "start": "1430520",
    "end": "1438039"
  },
  {
    "text": "not been tempered with because the H signatures remain the same so this is",
    "start": "1438039",
    "end": "1443320"
  },
  {
    "text": "the basics of a digital signature and so what promises that the",
    "start": "1443320",
    "end": "1450279"
  },
  {
    "start": "1446000",
    "end": "1446000"
  },
  {
    "text": "TGT is in is indeed untouched and its",
    "start": "1450279",
    "end": "1455400"
  },
  {
    "text": "Integrity is not ER has no problems so",
    "start": "1455400",
    "end": "1461039"
  },
  {
    "text": "ticket Integrity is guaranteed by the fact that the ticket itself is encrypted",
    "start": "1461039",
    "end": "1466480"
  },
  {
    "text": "and it's encrypted with the K TGT key K TGT is the internal Kos account and",
    "start": "1466480",
    "end": "1474640"
  },
  {
    "text": "therefore since this is encrypted attacker cannot simply edit the TGT because they don't know the C TGT and on",
    "start": "1474640",
    "end": "1482279"
  },
  {
    "text": "top of that the pack Integrity itself even though that is embedded within the",
    "start": "1482279",
    "end": "1488200"
  },
  {
    "text": "C within the TGT or or service ticket itself and and as a result it's",
    "start": "1488200",
    "end": "1495640"
  },
  {
    "text": "encrypted too it's also Al being signed twice by the C TGT as you can see in the",
    "start": "1495640",
    "end": "1503840"
  },
  {
    "text": "bottom of the of the P illustration there are two signatures of H the server",
    "start": "1503840",
    "end": "1511640"
  },
  {
    "text": "on on it again using the ctgt key as we can see the cgt key here is a single",
    "start": "1511640",
    "end": "1519080"
  },
  {
    "text": "point of failure everything depends on on it so if the attackers are able to",
    "start": "1519080",
    "end": "1525520"
  },
  {
    "text": "obtain the Capt key then create can create the famous or the notorious golden ticket attack which",
    "start": "1525520",
    "end": "1533200"
  },
  {
    "text": "mean if they steal the cgt key from active directory they can create",
    "start": "1533200",
    "end": "1539679"
  },
  {
    "text": "arbitrary tickets and again this was H implemented in mimik cats in Benjamin",
    "start": "1539679",
    "end": "1546000"
  },
  {
    "text": "Delp mimik cats and they I like this quote a golden ticket is a homemade",
    "start": "1546000",
    "end": "1551159"
  },
  {
    "text": "ticket it's done with a lot of love and the cgt",
    "start": "1551159",
    "end": "1556240"
  },
  {
    "text": "key so what happens here and this is the attacker's uh how attacker's H request",
    "start": "1556240",
    "end": "1564679"
  },
  {
    "text": "for a specific service looks like with the golden ticket the attacker ER gives",
    "start": "1564679",
    "end": "1572480"
  },
  {
    "text": "H its exploits say mimik cats the CT key and the ticket details the groups that",
    "start": "1572480",
    "end": "1579200"
  },
  {
    "text": "the attacker wants the H their user to be member in and that exploit kit bakes",
    "start": "1579200",
    "end": "1588559"
  },
  {
    "text": "a TGT and injects it either inject it to elas or has its own implementation of",
    "start": "1588559",
    "end": "1596520"
  },
  {
    "text": "caros and from that TGT the user is able to the attacker is able to request H",
    "start": "1596520",
    "end": "1603880"
  },
  {
    "text": "access to specific resources as in before so let's play a little game let's",
    "start": "1603880",
    "end": "1610279"
  },
  {
    "start": "1609000",
    "end": "1609000"
  },
  {
    "text": "play Spot the Difference so this is how regular authentication authorization",
    "start": "1610279",
    "end": "1617360"
  },
  {
    "text": "look look like that five steps that we had seen earlier and this is how H",
    "start": "1617360",
    "end": "1626279"
  },
  {
    "text": "malware using golden ticket H authentication looks like um Can you spot the",
    "start": "1626279",
    "end": "1635039"
  },
  {
    "text": "differences well yeah exactly there is a missing step there",
    "start": "1635039",
    "end": "1641240"
  },
  {
    "text": "again this is not by mistake this is the essence of the attack the attacker try to skip the first Authentication",
    "start": "1641240",
    "end": "1648039"
  },
  {
    "text": "step and start from the middle already with a c with a I'm sorry TGT",
    "start": "1648039",
    "end": "1656760"
  },
  {
    "text": "that they baked in advance using the C TGT",
    "start": "1656760",
    "end": "1661919"
  },
  {
    "text": "key and how does it look over the network so this is again a normal",
    "start": "1661919",
    "end": "1668000"
  },
  {
    "text": "authentication you can see here in the S reply which is the second step of the five steps you can see here in the red",
    "start": "1668000",
    "end": "1676399"
  },
  {
    "text": "box the the this is the ticket that goes back ER to uh to the user you can uh I'm",
    "start": "1676399",
    "end": "1685120"
  },
  {
    "text": "not sure you can see it but it's it's a blob it's a long buffer long encrypted buffer and it's encrypted we network",
    "start": "1685120",
    "end": "1693799"
  },
  {
    "text": "monitoring cannot see the contents of it but they don't we don't need to because",
    "start": "1693799",
    "end": "1701039"
  },
  {
    "text": "what is important it that the user quotes this buffer verbatim by for bite",
    "start": "1701039",
    "end": "1708760"
  },
  {
    "text": "in the TGs request as you can see here and if you don't see you can believe it",
    "start": "1708760",
    "end": "1714880"
  },
  {
    "text": "that the encrypted part that ank part in this H screenshot is the same between",
    "start": "1714880",
    "end": "1721399"
  },
  {
    "text": "the S reply and the TGs request and in the H the screenshot at the bottom you",
    "start": "1721399",
    "end": "1728080"
  },
  {
    "text": "can see a typical session of Cabos which contains again a a single s reply with a",
    "start": "1728080",
    "end": "1736519"
  },
  {
    "text": "ticket in the an part and then a series of TGs requests H asking access to",
    "start": "1736519",
    "end": "1743559"
  },
  {
    "text": "various resources all has the same ER encrypted ticket information encrypted",
    "start": "1743559",
    "end": "1751159"
  },
  {
    "text": "TGT information er in them so the network based detection is",
    "start": "1751159",
    "end": "1758279"
  },
  {
    "text": "Trivial from that the security device tried to recouple the dgt and TGs",
    "start": "1758279",
    "end": "1763559"
  },
  {
    "text": "request with its parent in the as reply and",
    "start": "1763559",
    "end": "1769279"
  },
  {
    "text": "if ER this security device is unable to find the TGT the TGs request a parent",
    "start": "1769279",
    "end": "1777840"
  },
  {
    "text": "the S reply that created it it alerts on possible golden ticket",
    "start": "1777840",
    "end": "1784640"
  },
  {
    "start": "1784000",
    "end": "1784000"
  },
  {
    "text": "attack and and this is just to show you that this is not a only",
    "start": "1784640",
    "end": "1791519"
  },
  {
    "text": "theoretical issue you can see here this is a slide from crowd strike from RSA uh",
    "start": "1791519",
    "end": "1797000"
  },
  {
    "text": "this year and this is a threat actor I think hurricane Panda they named it and",
    "start": "1797000",
    "end": "1803679"
  },
  {
    "text": "this threat actor one of the steps in establishing access to the network was",
    "start": "1803679",
    "end": "1809399"
  },
  {
    "text": "create a golden ticket so this is a very H valid attack and it is using the wild",
    "start": "1809399",
    "end": "1818200"
  },
  {
    "text": "let's move on to another attack another forgery attack that again was found in",
    "start": "1818200",
    "end": "1824240"
  },
  {
    "text": "the wild Ms 1468 I like this tweet by Gavin Millard giving a real world",
    "start": "1824240",
    "end": "1831399"
  },
  {
    "text": "analogy to this attack it says ms1 1468 is like buying a a regular ticket ER to",
    "start": "1831399",
    "end": "1839919"
  },
  {
    "text": "an air flight writing I'm the pilot on the ticket and then the steart says",
    "start": "1839919",
    "end": "1846039"
  },
  {
    "text": "welcome Captain how how would you like your coffee so you you you start as a",
    "start": "1846039",
    "end": "1851880"
  },
  {
    "text": "regular passengers and end up within the cockpit as the captain and again this is",
    "start": "1851880",
    "end": "1857760"
  },
  {
    "text": "not a theoretical attack this is the way that the kaspari attackers were able to",
    "start": "1857760",
    "end": "1865360"
  },
  {
    "text": "breach kaspari kasperski internal Network so this is indeed something that",
    "start": "1865360",
    "end": "1871480"
  },
  {
    "text": "advanced attackers actually do and let's talk about the technical",
    "start": "1871480",
    "end": "1877000"
  },
  {
    "text": "details of this attack so this is the pack that we remember uh from the golden",
    "start": "1877000",
    "end": "1883240"
  },
  {
    "text": "ticket attack and it's embedded with in the encrypted ticket H let's talk about what",
    "start": "1883240",
    "end": "1890880"
  },
  {
    "text": "happens when H the user sends uh the TGT and request a TGs what happens to the",
    "start": "1890880",
    "end": "1898399"
  },
  {
    "text": "pack so what happens to the pack the KDC first verifies uh the signatures and if",
    "start": "1898399",
    "end": "1906519"
  },
  {
    "text": "the signature is found to be valid which means the pack was not tempered with it",
    "start": "1906519",
    "end": "1911720"
  },
  {
    "text": "just copies the pack from ER the TGT into the service ticket and resigns it",
    "start": "1911720",
    "end": "1920080"
  },
  {
    "text": "once with the server key so the server will be able to validate that indeed",
    "start": "1920080",
    "end": "1925240"
  },
  {
    "text": "this is a valid pack and sence again with again with his C with its curos TGT",
    "start": "1925240",
    "end": "1934279"
  },
  {
    "text": "ER ctgt Key so if the server for some reason want to extra validation to do",
    "start": "1934279",
    "end": "1941120"
  },
  {
    "text": "extra validation they can it can send the uh this pack back to",
    "start": "1941120",
    "end": "1947679"
  },
  {
    "text": "DC and ask ask it if indeed this is properly",
    "start": "1947679",
    "end": "1954158"
  },
  {
    "text": "signed and here is the essence of the attack the vulnerability the vulnerability was that keyless",
    "start": "1954240",
    "end": "1960080"
  },
  {
    "text": "signatures were allowed So in theory in this",
    "start": "1960080",
    "end": "1966080"
  },
  {
    "text": "specification only hmark which means a hash with a key should be used to sign",
    "start": "1966080",
    "end": "1971639"
  },
  {
    "text": "but the vulnerability was that erroneously the KDC accept kless hashes as signatures for example example you",
    "start": "1971639",
    "end": "1977639"
  },
  {
    "text": "can sign this pack with md5 which means that anyone can sign because there is no",
    "start": "1977639",
    "end": "1985440"
  },
  {
    "text": "key no secret element in this process therefore there is no point in this",
    "start": "1985440",
    "end": "1990760"
  },
  {
    "text": "signature anyone can sign it but is it really that serious because we said that",
    "start": "1990760",
    "end": "1998480"
  },
  {
    "text": "the ticket itself is encrypted so attackers cannot just override the pack",
    "start": "1998480",
    "end": "2005679"
  },
  {
    "text": "in a valid C ticket with the pack they signed on with md5 because it wouldn't",
    "start": "2005679",
    "end": "2011440"
  },
  {
    "text": "work it wouldn't be decrypted properly and if they can encrypt it and they",
    "start": "2011440",
    "end": "2016760"
  },
  {
    "text": "already have the cap GT key so why bother with it they can just uh do",
    "start": "2016760",
    "end": "2024600"
  },
  {
    "text": "whatever okay so but there is a way to exploit it without knowing the care TGT",
    "start": "2024600",
    "end": "2032360"
  },
  {
    "text": "key so here is how it works for the attackers the attackers request an as",
    "start": "2032360",
    "end": "2038639"
  },
  {
    "text": "request authentication request but they ask for a packless TT please give me a TGT without a pack this",
    "start": "2038639",
    "end": "2045960"
  },
  {
    "text": "is this field include pack equals false then the attacker request with the TGs",
    "start": "2045960",
    "end": "2052480"
  },
  {
    "text": "request a service ticket with a fake pack so they quote that packless",
    "start": "2052480",
    "end": "2059638"
  },
  {
    "text": "TGT but they have a new field there called anization data which is optional",
    "start": "2059639",
    "end": "2067320"
  },
  {
    "text": "and in that field they fill in their uh ER their md5 signed",
    "start": "2067320",
    "end": "2077679"
  },
  {
    "text": "pack so this is an interim summary of what's going on for the attacker the attacker still",
    "start": "2078040",
    "end": "2085878"
  },
  {
    "text": "needs thank you needs a a password so a",
    "start": "2085879",
    "end": "2090919"
  },
  {
    "text": "regular s request is performed ER but the attacker request",
    "start": "2090919",
    "end": "2096440"
  },
  {
    "text": "requested to be without a pack then the attacker uses that ank",
    "start": "2096440",
    "end": "2102480"
  },
  {
    "text": "authorization data thank",
    "start": "2102480",
    "end": "2105920"
  },
  {
    "text": "you the taker uses that anization data H filled in order to put in the pack that",
    "start": "2109560",
    "end": "2118560"
  },
  {
    "text": "they signed with md5 and send it to the DC the DC just embeds that Park into the",
    "start": "2118560",
    "end": "2127200"
  },
  {
    "text": "service ticket that is used to access the specific resource that the attacker wants but it does not really work",
    "start": "2127200",
    "end": "2136240"
  },
  {
    "text": "because servers this the DC before the patch was",
    "start": "2136240",
    "end": "2142480"
  },
  {
    "text": "a was able and they accepted H packs that are signed with",
    "start": "2142480",
    "end": "2149599"
  },
  {
    "text": "md5 but servers were P already patched and they do not accept pack that is",
    "start": "2149599",
    "end": "2156440"
  },
  {
    "text": "signed with with md5 and therefore they would reject that uh ticket because it's",
    "start": "2156440",
    "end": "2162359"
  },
  {
    "text": "not properly",
    "start": "2162359",
    "end": "2165240"
  },
  {
    "text": "signed but the attackers does not quit do not quit and they introduce another stage in",
    "start": "2168960",
    "end": "2176880"
  },
  {
    "text": "their attack that fixes that situation so in that attack instead of directly",
    "start": "2176880",
    "end": "2184560"
  },
  {
    "text": "requesting access to the resource that they want they have another round in stat three and",
    "start": "2184560",
    "end": "2190240"
  },
  {
    "text": "four they send the TGs requests they want specific access to the K's internal",
    "start": "2190240",
    "end": "2199119"
  },
  {
    "text": "service the K TGT and usually it is used to renew a ticket if you have a ticket",
    "start": "2199119",
    "end": "2205480"
  },
  {
    "text": "that is about to expire you create you create a TGs reord to C TGT",
    "start": "2205480",
    "end": "2214160"
  },
  {
    "text": "and you get a new one so that's what they do they request ER ke request access to ctgt the",
    "start": "2214160",
    "end": "2223640"
  },
  {
    "text": "KDC just embeds ER the the pack they specifying",
    "start": "2223640",
    "end": "2229200"
  },
  {
    "text": "the anization data into the service ticket in stage four and then in stage",
    "start": "2229200",
    "end": "2236520"
  },
  {
    "text": "five they request an access to the res they",
    "start": "2236520",
    "end": "2242040"
  },
  {
    "text": "actually want to access to by then they have a t they have a GT with a fake pack",
    "start": "2242040",
    "end": "2249119"
  },
  {
    "text": "within it but what happens on the server we can see in the next Slide",
    "start": "2249119",
    "end": "2255119"
  },
  {
    "text": "the the KDC follows its usual H flow",
    "start": "2255119",
    "end": "2261280"
  },
  {
    "text": "first it verifies the signature the signature is md5 but since the Ser the",
    "start": "2261280",
    "end": "2267800"
  },
  {
    "text": "KDC is vulnerable and it's willing to accept a pack signed with md5 he said",
    "start": "2267800",
    "end": "2274520"
  },
  {
    "text": "that's okay and copies the pack information the Privileges and then it",
    "start": "2274520",
    "end": "2279800"
  },
  {
    "text": "resigns but this time properly it signs it with MD which hm shaan and hm md5",
    "start": "2279800",
    "end": "2287800"
  },
  {
    "text": "with its key with C GT key and server key okay and using this stage attackers",
    "start": "2287800",
    "end": "2295960"
  },
  {
    "text": "are able to get a valid eoser ticket",
    "start": "2295960",
    "end": "2301800"
  },
  {
    "text": "sorry sorry so this is how a regular passenger",
    "start": "2301800",
    "end": "2308480"
  },
  {
    "text": "a regular domain user now becomes the domain admin if they like to and can",
    "start": "2308480",
    "end": "2314800"
  },
  {
    "text": "Bridge the kasperski internal",
    "start": "2314800",
    "end": "2319319"
  },
  {
    "text": "Network so let's discuss network-based detection so for unpatch Server the way",
    "start": "2320599",
    "end": "2327400"
  },
  {
    "text": "to detect is detect an S request with pack request equals",
    "start": "2327400",
    "end": "2333599"
  },
  {
    "text": "false because theak wants a ticket with without a pack so can so they can bring",
    "start": "2333599",
    "end": "2338880"
  },
  {
    "text": "their own pack into the game then see an an authorization data field which is not",
    "start": "2338880",
    "end": "2345480"
  },
  {
    "text": "null which contains some authorization data that is used by the attackers to put their pack in and",
    "start": "2345480",
    "end": "2354040"
  },
  {
    "text": "finally that verify that the tager server indeed needs a pack which uh it's",
    "start": "2354040",
    "end": "2361200"
  },
  {
    "text": "another field in the active directory so even though that some of these fields can be",
    "start": "2361200",
    "end": "2367760"
  },
  {
    "text": "ER can be can normally have this value but having all three of them together",
    "start": "2367760",
    "end": "2375359"
  },
  {
    "text": "does just that doesn't make sense and we can alert on that and detect this this",
    "start": "2375359",
    "end": "2381319"
  },
  {
    "text": "attack for patch server it's even easier to detect this attack and the point of",
    "start": "2381319",
    "end": "2387280"
  },
  {
    "text": "detecting a attack against patch servers even if it wouldn't work because you want to know that you were under attack",
    "start": "2387280",
    "end": "2394760"
  },
  {
    "text": "attack even if it wasn't successful uccessful is that the KDC will return an error which very indicative H to this",
    "start": "2394760",
    "end": "2402079"
  },
  {
    "text": "situation that the signature type is not supported because it's patch and it's no longer H willing to accept md5 as a",
    "start": "2402079",
    "end": "2410720"
  },
  {
    "text": "signature sorry I have to stop doing that and this is how it looks a network",
    "start": "2410720",
    "end": "2416480"
  },
  {
    "text": "based detection of ms14 of a a fake pack exactly based on the criteria we had",
    "start": "2416480",
    "end": "2423599"
  },
  {
    "text": "mentioned before and now we move on for the last attack Forge pack the diamond",
    "start": "2423599",
    "end": "2431160"
  },
  {
    "text": "pack here you go Michael thank you thank you so let's talk about Diamond",
    "start": "2431160",
    "end": "2437160"
  },
  {
    "text": "pack this is Diamond pack is a novel attack variant which is on Offspring off",
    "start": "2437160",
    "end": "2444720"
  },
  {
    "text": "offspring of two attacks it takes the idea of stealing the KT from the golden ticket and it",
    "start": "2444720",
    "end": "2452280"
  },
  {
    "text": "takes an attack flow to embed that the pack from the fake pack and the result",
    "start": "2452280",
    "end": "2458200"
  },
  {
    "text": "is a diamond pack so how the attacks go for the attacker the attacker would",
    "start": "2458200",
    "end": "2463359"
  },
  {
    "start": "2459000",
    "end": "2459000"
  },
  {
    "text": "obtain CT and then it will create theog pack with whatever privileges an attacker",
    "start": "2463359",
    "end": "2470839"
  },
  {
    "text": "needs but it will sign it not like in a fake Pack Attack with md5 it will sign",
    "start": "2470839",
    "end": "2476880"
  },
  {
    "text": "it just like the car the main cler would with the c GT",
    "start": "2476880",
    "end": "2482640"
  },
  {
    "text": "key and it will use the fake Pack Attack flow to embed but to push this Rog pack to the",
    "start": "2482640",
    "end": "2492760"
  },
  {
    "text": "TGT and then to the TG TGs the exploit from the stage looks",
    "start": "2492760",
    "end": "2500200"
  },
  {
    "text": "very similar the same practically as a fake pack with one major difference attacker first baks the pack",
    "start": "2500200",
    "end": "2508280"
  },
  {
    "text": "signs it with K GT which is signed with diamond this is a diamond pack then it goes and and doing notification quest to",
    "start": "2508280",
    "end": "2515160"
  },
  {
    "text": "the active director and say give me the TGT without a pack no pack",
    "start": "2515160",
    "end": "2521599"
  },
  {
    "text": "op return receives back the TGT without the pack it goes again to the caros the",
    "start": "2521599",
    "end": "2529960"
  },
  {
    "text": "to active directory with and asks again for the TGT it's cap TGT service this",
    "start": "2529960",
    "end": "2536480"
  },
  {
    "text": "time inide of anization data there is a diamond pack pack signed by",
    "start": "2536480",
    "end": "2544680"
  },
  {
    "text": "cgd the main returns uh TGT with copied pack and then",
    "start": "2544680",
    "end": "2551839"
  },
  {
    "text": "when attacker now will go and ask to the access to specific resource basically asking doing a TGs request the spack",
    "start": "2551839",
    "end": "2558960"
  },
  {
    "text": "will be copied over to the uh ticket to the service ticket but since that the",
    "start": "2558960",
    "end": "2565160"
  },
  {
    "text": "pack is signed correctly with the K GT the domain will accept it and it will",
    "start": "2565160",
    "end": "2570200"
  },
  {
    "text": "pass verification we'll Reign it with KT and with Service uh password",
    "start": "2570200",
    "end": "2576800"
  },
  {
    "text": "and return the ticket the service ticket this means that even if the",
    "start": "2576800",
    "end": "2582319"
  },
  {
    "text": "server the even if active directory is paged against a fake pack the",
    "start": "2582319",
    "end": "2588480"
  },
  {
    "text": "ms4 68 this diamond pack will still",
    "start": "2588480",
    "end": "2594280"
  },
  {
    "text": "work so the obvious question is why to use the the son the diamond pack instead of",
    "start": "2594280",
    "end": "2601640"
  },
  {
    "text": "the parents but we just explained it because the golden ticket is easily",
    "start": "2601640",
    "end": "2608040"
  },
  {
    "text": "detectable over the network because and all not only over the network because there's recoupling of tication response",
    "start": "2608040",
    "end": "2615160"
  },
  {
    "text": "the authentication request response ntgs request fake pack is patched it's not",
    "start": "2615160",
    "end": "2622119"
  },
  {
    "text": "long no longer life so we have a diamond Pack Attack which gives us an Unbound privileges just like a golden ticket but",
    "start": "2622119",
    "end": "2630520"
  },
  {
    "text": "with legitimate uh fam Tre legitimate flow of the network but fortunately L",
    "start": "2630520",
    "end": "2637880"
  },
  {
    "text": "since uh the flow is just like the fake Pack Flow the same logic which detects",
    "start": "2637880",
    "end": "2643520"
  },
  {
    "text": "the fake pack will detect the diamond pack uh the diamond pack yes sorry and",
    "start": "2643520",
    "end": "2649280"
  },
  {
    "text": "uh again the the same alert will be in advanced F",
    "start": "2649280",
    "end": "2655839"
  },
  {
    "text": "analytics so here we finish and we will conclude the first conclusion is that",
    "start": "2656559",
    "end": "2661760"
  },
  {
    "text": "attackers no longer stop at stealing existing identities just not enough we",
    "start": "2661760",
    "end": "2667520"
  },
  {
    "text": "are walking to subvert we must subvert the inner walking of the care system to be able to forge identities and",
    "start": "2667520",
    "end": "2673119"
  },
  {
    "text": "privileges which know which previously didn't exist but network monitoring we can",
    "start": "2673119",
    "end": "2678800"
  },
  {
    "text": "protect against both of those paradigms so let's put a network monting",
    "start": "2678800",
    "end": "2685359"
  },
  {
    "text": "glitch on that caros dog and uh you can",
    "start": "2685359",
    "end": "2690400"
  },
  {
    "text": "download the scanner against the skeleton key from the link on this slide",
    "start": "2690400",
    "end": "2696119"
  },
  {
    "text": "you can also evaluate the advanced F analytics if you like and thank you very much any",
    "start": "2696119",
    "end": "2704040"
  },
  {
    "start": "2700000",
    "end": "2700000"
  },
  {
    "text": "questions put that slide back up which one this one",
    "start": "2704040",
    "end": "2712599"
  },
  {
    "text": "yes we will the presentation will be on a blackhead side so you can you know",
    "start": "2712599",
    "end": "2718880"
  },
  {
    "text": "just click it from there if you want if you",
    "start": "2718880",
    "end": "2723160"
  },
  {
    "text": "like any other",
    "start": "2724880",
    "end": "2728440"
  },
  {
    "text": "questions okay so the question was is this monitoring approach only good",
    "start": "2738359",
    "end": "2744680"
  },
  {
    "text": "against the tax with shown here or is it something more General generic so the",
    "start": "2744680",
    "end": "2751599"
  },
  {
    "text": "the short answer yes it's a general solution generic solution you can detect all kinds of other tech for example",
    "start": "2751599",
    "end": "2758520"
  },
  {
    "text": "stealing a Tex it's easy to detect when network monitoring for example pass the ticket you see that a ticket was",
    "start": "2758520",
    "end": "2765960"
  },
  {
    "text": "assigned to a certain computer and all of a sudden you see it from another",
    "start": "2765960",
    "end": "2771040"
  },
  {
    "text": "computer so from the network perspective it's very easily to see this anomaly but",
    "start": "2771040",
    "end": "2777119"
  },
  {
    "text": "if you don't have network monitoring how can you spot it it everything works out",
    "start": "2777119",
    "end": "2782359"
  },
  {
    "text": "perfectly so this is a very generic uh approach to detecting this kind of",
    "start": "2782359",
    "end": "2788440"
  },
  {
    "text": "attack and not only the one that we had shown you thank you yes",
    "start": "2788440",
    "end": "2795720"
  },
  {
    "text": "please so what are the question was what is our recommendation ER if you were",
    "start": "2797200",
    "end": "2803920"
  },
  {
    "text": "already infected attacker was able to obtain the kgt H key and what do you do now so",
    "start": "2803920",
    "end": "2813720"
  },
  {
    "text": "obviously you need to change that kep ggt key and look for it at TechNet",
    "start": "2813720",
    "end": "2820000"
  },
  {
    "text": "Microsoft TechNet is a way how to change it in fact you have to change it twice because one generation older cap GT key",
    "start": "2820000",
    "end": "2828480"
  },
  {
    "text": "is still valid and in fact there is also if you want to go the extra mile there",
    "start": "2828480",
    "end": "2834079"
  },
  {
    "text": "is a script you can download from TechNet that periodically rotates your",
    "start": "2834079",
    "end": "2839640"
  },
  {
    "text": "ctgt keys so even if you are not aware and that someone stole your golden ticket because typically what it used to",
    "start": "2839640",
    "end": "2847520"
  },
  {
    "text": "be is that administrator never change cap TGT key in fact they weren't even",
    "start": "2847520",
    "end": "2854480"
  },
  {
    "text": "very aware that it existed so you stole attacker stole it once and got access to",
    "start": "2854480",
    "end": "2860680"
  },
  {
    "text": "the network forever but now there is a a the script that rotates that Capt key so",
    "start": "2860680",
    "end": "2868880"
  },
  {
    "text": "even if you if your domain controll had been exposed and attacker obtained cap G",
    "start": "2868880",
    "end": "2876119"
  },
  {
    "text": "so it's only good for a few days and not forever as it used to",
    "start": "2876119",
    "end": "2882640"
  },
  {
    "text": "be",
    "start": "2882839",
    "end": "2885839"
  },
  {
    "text": "yes so the question was if the Kos",
    "start": "2891520",
    "end": "2896599"
  },
  {
    "text": "protocol is so vulnerable why don't we start with something else something new",
    "start": "2896599",
    "end": "2902240"
  },
  {
    "text": "H the short answer is impossible very much because let's take for example the",
    "start": "2902240",
    "end": "2908440"
  },
  {
    "text": "ntlm protocol the older Authentication Protocol that Microsoft had used and",
    "start": "2908440",
    "end": "2914160"
  },
  {
    "text": "tried to and in fact from Windows 2000 so 15 years ago a Microsoft ER",
    "start": "2914160",
    "end": "2921040"
  },
  {
    "text": "default Authentication Protocol was the K not ntlm but still even Windows 10",
    "start": "2921040",
    "end": "2929240"
  },
  {
    "text": "still supports ntlm H because of backw compatibility",
    "start": "2929240",
    "end": "2934319"
  },
  {
    "text": "and all their applications and so on so forth because this is a protocol it's not something on your computer it's on",
    "start": "2934319",
    "end": "2941079"
  },
  {
    "text": "computer it's on the DC it's on the application you H you access so it's",
    "start": "2941079",
    "end": "2946640"
  },
  {
    "text": "very hard to change that protocol and even though Microsoft is trying for 15 years to get rid of ntlm and it's able",
    "start": "2946640",
    "end": "2954440"
  },
  {
    "text": "to limit its use from version to version it still cannot ER get rid of it Al",
    "start": "2954440",
    "end": "2960880"
  },
  {
    "text": "together so even if we changed Kos which is a good protocol but has some attacks",
    "start": "2960880",
    "end": "2966760"
  },
  {
    "text": "on it h it will take us at least 15 years to get rid of all of",
    "start": "2966760",
    "end": "2973480"
  },
  {
    "text": "the all the all the ecosphere of it so",
    "start": "2973480",
    "end": "2978920"
  },
  {
    "text": "it wouldn't so the I think the best strategy would be to have monitoring on",
    "start": "2978920",
    "end": "2986920"
  },
  {
    "text": "it and and strengthen it and not replace it with something else",
    "start": "2986920",
    "end": "2993960"
  },
  {
    "text": "okay okay if there aren't further questions uh thank you for coming today",
    "start": "2994520",
    "end": "3000240"
  },
  {
    "text": "you can find out you can there is some Twitter handles for us and you can reach",
    "start": "3000240",
    "end": "3005720"
  },
  {
    "text": "us and ask anything you want and we'll be here after the talk so thank you very much thank",
    "start": "3005720",
    "end": "3013039"
  },
  {
    "text": "you",
    "start": "3013839",
    "end": "3016839"
  }
]