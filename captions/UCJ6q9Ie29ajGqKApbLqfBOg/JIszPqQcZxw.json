[
  {
    "text": "good morning attendees welcome to the first briefing on the first day of blackout USA",
    "start": "2560",
    "end": "9759"
  },
  {
    "text": "2024 uh you're here to uh see an awesome talk called um tunnel vision exploring",
    "start": "9759",
    "end": "16920"
  },
  {
    "text": "BPM post exploitation techniques uh presented by aie David so uh without",
    "start": "16920",
    "end": "23279"
  },
  {
    "text": "further Ado please welcome aie to the stage [Applause]",
    "start": "23279",
    "end": "32300"
  },
  {
    "text": "hi everyone thanks for the introduction James uh I'm very excited to be here today and before we get started I wanted",
    "start": "33480",
    "end": "42520"
  },
  {
    "text": "to ask you a question do you trust your VPN server",
    "start": "42520",
    "end": "50160"
  },
  {
    "text": "this machine that sits at the edge of your organization and determines who can get",
    "start": "50160",
    "end": "55399"
  },
  {
    "text": "in well surely not right you you know",
    "start": "55399",
    "end": "61000"
  },
  {
    "text": "better you don't trust anyone you have zero",
    "start": "61000",
    "end": "67720"
  },
  {
    "text": "trust well the name of this talk may suggest that we're going to be talking about VPN post exploitation which we are",
    "start": "67720",
    "end": "75240"
  },
  {
    "text": "also going to be doing I believe that on a deeper level today we're going to be",
    "start": "75240",
    "end": "80759"
  },
  {
    "text": "talking about relationships and specifically your relationship with your",
    "start": "80759",
    "end": "86439"
  },
  {
    "text": "VPN I believe that by the end of this talk you make come to realize that you trust your VPN way more than you thought",
    "start": "86439",
    "end": "94479"
  },
  {
    "text": "and probably way more than you should so as you can probably guess by",
    "start": "94479",
    "end": "100040"
  },
  {
    "text": "now our agenda for today is going to be VPN servers we'll start by discussing VPN exploitation how and why attackers",
    "start": "100040",
    "end": "108079"
  },
  {
    "text": "choose to Target these devices and we'll then go on to the main topic of this talk VPN post exploitation a relatively",
    "start": "108079",
    "end": "115560"
  },
  {
    "text": "overlooked aspect of VPN security that I hope to shed a light on today and hopefully raise awareness too and we",
    "start": "115560",
    "end": "122840"
  },
  {
    "text": "will then go on to discuss some principles and best practices that I believe should be followed to minimize",
    "start": "122840",
    "end": "129319"
  },
  {
    "text": "the associated associated risks from the techniques that we will detail today um so a brief introduction my name",
    "start": "129319",
    "end": "136920"
  },
  {
    "text": "is Ora viid I'm a security researcher at Akamai based in Israel H my background",
    "start": "136920",
    "end": "142360"
  },
  {
    "text": "is in red teaming and fret hunting and today I cover a wide variety of research Topics in the Akamai security research",
    "start": "142360",
    "end": "148680"
  },
  {
    "text": "team and really for the last few months of my life I kind of dedicated myself to",
    "start": "148680",
    "end": "154360"
  },
  {
    "text": "VPN security but even if you haven't been paying Too Close of an attention to",
    "start": "154360",
    "end": "159519"
  },
  {
    "text": "these devices you likely heard them about them recently so last year has",
    "start": "159519",
    "end": "166000"
  },
  {
    "text": "been a pretty rough year for VPN security it seemed like literally every",
    "start": "166000",
    "end": "171239"
  },
  {
    "text": "other month a critical security vulnerability was discovered in one of the top VPN servers on the market and",
    "start": "171239",
    "end": "177400"
  },
  {
    "text": "these vulnerabilities often led to massive exploitation campaigns affecting thousands of",
    "start": "177400",
    "end": "183360"
  },
  {
    "text": "organizations now while this trend saw a significant rise this year it is certainly not new attackers have been",
    "start": "183360",
    "end": "189920"
  },
  {
    "text": "targeting H these devices for many years and I believe that the main reason for",
    "start": "189920",
    "end": "195159"
  },
  {
    "text": "this would be their very nature so vpns are intended to provide access to the",
    "start": "195159",
    "end": "201480"
  },
  {
    "text": "internal network from the internet while this is very useful from an IT",
    "start": "201480",
    "end": "206799"
  },
  {
    "text": "perspective it can be it can also be a pretty interesting opportunity for attackers as well uh so couple this with",
    "start": "206799",
    "end": "214319"
  },
  {
    "text": "the fact that these devices have not exactly excelled with security over the years and you get yourself Prime targets",
    "start": "214319",
    "end": "221599"
  },
  {
    "text": "for exploitation so as to what attackers after actually do after compromising a",
    "start": "221599",
    "end": "228200"
  },
  {
    "text": "VPN server so typically what we see is that attackers abuse vpns for one main",
    "start": "228200",
    "end": "234480"
  },
  {
    "text": "goal and that is to gain initial access to the network H the attacker will compromise the VPN through a",
    "start": "234480",
    "end": "240959"
  },
  {
    "text": "vulnerability and then we'll use this access to Pivot into the internal Network essentially starting their",
    "start": "240959",
    "end": "247040"
  },
  {
    "text": "intrusion from there now while this is obviously very useful and seems to be",
    "start": "247040",
    "end": "252879"
  },
  {
    "text": "working for them I kind of wondered is that really it should we only treat VPN",
    "start": "252879",
    "end": "259720"
  },
  {
    "text": "servers as gateways to the network I wanted to explore the concept of VPN post exploitation what can an",
    "start": "259720",
    "end": "267720"
  },
  {
    "text": "attacker do on a VPN server after compromising it in addition to just getting access to the network to",
    "start": "267720",
    "end": "275560"
  },
  {
    "text": "understand this let's look at a similar example let's say that an attacker sends a fishing email to a Windows machine and",
    "start": "275560",
    "end": "282240"
  },
  {
    "text": "successfully compromises it one thing that they may do is simply treat this",
    "start": "282240",
    "end": "287280"
  },
  {
    "text": "machine as a gateway to the network they can tunnel Communications through it begin scanning additional hosts in the",
    "start": "287280",
    "end": "293280"
  },
  {
    "text": "network and again begin their intrusion from there well in practice we know that",
    "start": "293280",
    "end": "298800"
  },
  {
    "text": "they do much more than that for example they will employ a persistency mechanism on the machine to ensure long-term",
    "start": "298800",
    "end": "305320"
  },
  {
    "text": "access they will attempt to gather credentials to access additional resources and move laterally and really",
    "start": "305320",
    "end": "312160"
  },
  {
    "text": "I can go on here there are entire Frameworks dedicated to Windows post",
    "start": "312160",
    "end": "318000"
  },
  {
    "text": "exploitation but with vpns we don't really talk about these types of techniques that often I wondered why",
    "start": "318000",
    "end": "325400"
  },
  {
    "text": "that's the case and I think that I have a theory so I did not invent a VPN post",
    "start": "325400",
    "end": "331919"
  },
  {
    "text": "exploitation attackers are doing it they have been doing it for many years a great recent example came with the",
    "start": "331919",
    "end": "338720"
  },
  {
    "text": "mandiant report which released a few months ago about the ivanti ianti VPN",
    "start": "338720",
    "end": "344000"
  },
  {
    "text": "exploitation campaign from last year and in this report mandant detailed a few",
    "start": "344000",
    "end": "349479"
  },
  {
    "text": "very interesting post exploitation techniques used by the attackers so for examples the attacker employed a",
    "start": "349479",
    "end": "356199"
  },
  {
    "text": "persistency mechanism on the evanti VPN after compromising it they tampered with log files to evade",
    "start": "356199",
    "end": "362240"
  },
  {
    "text": "detection we we have previously seen these types of techniques similar types of techniques being implemented by",
    "start": "362240",
    "end": "368880"
  },
  {
    "text": "attackers and what's interesting is that in pretty much all all cases these",
    "start": "368880",
    "end": "374680"
  },
  {
    "text": "techniques shared a a common theme and that is they were implemented by using an",
    "start": "374680",
    "end": "380800"
  },
  {
    "text": "implant the idea is that attackers after gaining a remote code execution capability on the VPN will use it to",
    "start": "380800",
    "end": "388520"
  },
  {
    "text": "install a custom implant to run on the device OS itself at this point they're",
    "start": "388520",
    "end": "393800"
  },
  {
    "text": "free to modify system files hook functions and essentially Implement anything that they want any technique",
    "start": "393800",
    "end": "399599"
  },
  {
    "text": "that they want this approach has a significant upside because as we just",
    "start": "399599",
    "end": "405120"
  },
  {
    "text": "said the attackers can do anything they can they have full control over the device functionality and they can",
    "start": "405120",
    "end": "410840"
  },
  {
    "text": "Implement any technique that they want the major downside to this approach",
    "start": "410840",
    "end": "416599"
  },
  {
    "text": "is that it is expensive vpns are these undocumented black boxes that really don't want you",
    "start": "416599",
    "end": "422840"
  },
  {
    "text": "to interact with their inside so in order to be able to develop and maintain",
    "start": "422840",
    "end": "429000"
  },
  {
    "text": "such a tool an attacker will need to dedicate a lot of time into research and",
    "start": "429000",
    "end": "434440"
  },
  {
    "text": "development because of this um we typically only see one type of red",
    "start": "434440",
    "end": "440319"
  },
  {
    "text": "actors performing these types of techniques and that would be your top tier nation state threat actors for your",
    "start": "440319",
    "end": "447720"
  },
  {
    "text": "more mid-range APS and financially motivated threat groups we don't really see them going through the effort",
    "start": "447720",
    "end": "454120"
  },
  {
    "text": "because they simply have simpler things that they can do and seems to be working now because of this it may seem",
    "start": "454120",
    "end": "462199"
  },
  {
    "text": "that this type of risk is simply not that relevant for a lot of organizations",
    "start": "462199",
    "end": "467919"
  },
  {
    "text": "at the end of the day only a very small subset of organizations are going to be",
    "start": "467919",
    "end": "472960"
  },
  {
    "text": "targeted by these top tier nation states and for the rest of us H it may seem",
    "start": "472960",
    "end": "478800"
  },
  {
    "text": "that there are more urgent things that we should worry about that are more likely to actually affect",
    "start": "478800",
    "end": "484479"
  },
  {
    "text": "us I wanted to try to challenge this assumption I wanted to try to see if",
    "start": "484479",
    "end": "490199"
  },
  {
    "text": "there might be an easier way to perform VPN post exploitation that might be more",
    "start": "490199",
    "end": "495639"
  },
  {
    "text": "accessible to less sophisticated threat actors as well the approach that I went with is",
    "start": "495639",
    "end": "501840"
  },
  {
    "text": "what I call living off the VPN and it's PR simple so instead of going through",
    "start": "501840",
    "end": "508440"
  },
  {
    "text": "this very hard route of that we just described of going deep into the OS and",
    "start": "508440",
    "end": "513919"
  },
  {
    "text": "developing this custom implant to do to implement the techniques that we want",
    "start": "513919",
    "end": "519080"
  },
  {
    "text": "why not instead follow the principle of living off the land and instead abuse",
    "start": "519080",
    "end": "524519"
  },
  {
    "text": "existing functionality in the VPN what I chose to do was to Target the management",
    "start": "524519",
    "end": "530560"
  },
  {
    "text": "interface of the VPN and see what might be possible to achieve from this interface so this approach has two main",
    "start": "530560",
    "end": "539480"
  },
  {
    "text": "advantages already first it is much more easier to perform so again instead of",
    "start": "539480",
    "end": "545200"
  },
  {
    "text": "writing this custom code on this a hardened OS we are clicking buttons in",
    "start": "545200",
    "end": "550720"
  },
  {
    "text": "the UI which is much easier um and the second thing is that this type of access",
    "start": "550720",
    "end": "556120"
  },
  {
    "text": "can actually be easier to obtain to gain access to the OS to run an implant you will need a full RC vulnerability",
    "start": "556120",
    "end": "563079"
  },
  {
    "text": "whereas to access the management interface you can gain this type of access through an rce but also through",
    "start": "563079",
    "end": "569560"
  },
  {
    "text": "an authentication bypass vulnerability or even by compromising credentials so the idea is that this type of approach",
    "start": "569560",
    "end": "575839"
  },
  {
    "text": "can be more accessible to less sophisticated threat actors as well to test this I chose to Target two",
    "start": "575839",
    "end": "583320"
  },
  {
    "text": "of the most popular VPN providers on the market ianti and foret and again the",
    "start": "583320",
    "end": "589320"
  },
  {
    "text": "idea was let's assume that we have access to the management interface of these devices and let's see what we",
    "start": "589320",
    "end": "596680"
  },
  {
    "text": "might be able to do from there when it upen covering a set of very interesting techniques that can allow an attacker to",
    "start": "596680",
    "end": "604360"
  },
  {
    "text": "gain access to additional critical resources inside the network immediately after compromising the VPN in some cases",
    "start": "604360",
    "end": "612360"
  },
  {
    "text": "a VPN compromise can very easily become a full Network compromise so I guess",
    "start": "612360",
    "end": "619600"
  },
  {
    "text": "let's get to the findings themselves starting with abusing remote",
    "start": "619600",
    "end": "624760"
  },
  {
    "text": "authentication servers so let's first understand what that means",
    "start": "624760",
    "end": "629839"
  },
  {
    "text": "in order to access the network through a VPN a user a remote client will need to authenticate to the VPN somehow the most",
    "start": "629839",
    "end": "637040"
  },
  {
    "text": "basic way to do this would be to use a local user so we create a set of credential on the VPN the the client can",
    "start": "637040",
    "end": "644279"
  },
  {
    "text": "then provides provide them the VPN looks them up locally and approves or rejects authentication pretty simple stuff the",
    "start": "644279",
    "end": "651040"
  },
  {
    "text": "problem with this approach is that it doesn't really scale well when we have thousands of users and multiple separate",
    "start": "651040",
    "end": "657040"
  },
  {
    "text": "VPN servers H we can run into problems so what we will actually see being used",
    "start": "657040",
    "end": "662240"
  },
  {
    "text": "in most networks are remote authentication servers instead of relying on the VPN server to manage the",
    "start": "662240",
    "end": "669440"
  },
  {
    "text": "identities them themselves we rely on an an existing third party a authentication",
    "start": "669440",
    "end": "675959"
  },
  {
    "text": "server an identity provider it could be cloud-based or an on-prem A identity provider and now the VPN excuse me the",
    "start": "675959",
    "end": "684120"
  },
  {
    "text": "client provides their normal credentials to the VPN which then reaches out to the",
    "start": "684120",
    "end": "689320"
  },
  {
    "text": "authentication server to validate them and then approves or reject the user based on the response again pretty",
    "start": "689320",
    "end": "695760"
  },
  {
    "text": "simple stuff well it turns out that if an attacker is at the position of a post",
    "start": "695760",
    "end": "702440"
  },
  {
    "text": "exploitation on the VPN we can actually do some pretty interesting things here let's start with abusing L up",
    "start": "702440",
    "end": "709320"
  },
  {
    "text": "authentication one very common authentication method is going to be El up in most cases active directory and it",
    "start": "709320",
    "end": "716240"
  },
  {
    "text": "is a pretty convenient choice because users can use their Norm mobile domain credentials to access the VPN so let's",
    "start": "716240",
    "end": "723040"
  },
  {
    "text": "start with forgate and understand how it operates this process so for forgate",
    "start": "723040",
    "end": "729160"
  },
  {
    "text": "exactly as we described we have this s very simple flow here the user provides their credentials to the VPN the VPN",
    "start": "729160",
    "end": "736920"
  },
  {
    "text": "validates them and approves or reject the user now I want you to try to think",
    "start": "736920",
    "end": "743600"
  },
  {
    "text": "what is the worst possible way this could be implemented if you guessed that the",
    "start": "743600",
    "end": "750600"
  },
  {
    "text": "password is sent in clear text to the Lup server congratulations you are correct H yeah so I was shocked when I",
    "start": "750600",
    "end": "758000"
  },
  {
    "text": "initially saw this in order to validate the credentials supplied by the user what forgate does is it performs a",
    "start": "758000",
    "end": "765160"
  },
  {
    "text": "simple Elda bind H which in English means sends the password in clear text",
    "start": "765160",
    "end": "770639"
  },
  {
    "text": "to the El up server in order to validate them H this is the default Behavior so this H is pretty bad and it",
    "start": "770639",
    "end": "779320"
  },
  {
    "text": "actually exposes two sets of credentials so first to configure such a server a",
    "start": "779320",
    "end": "785560"
  },
  {
    "text": "remote Lup authentication server H we will need to specify credentials for the",
    "start": "785560",
    "end": "790600"
  },
  {
    "text": "Lop server that for a service account that will be used to query information from the server so these credentials are",
    "start": "790600",
    "end": "796959"
  },
  {
    "text": "sent in clear text and of course the credentials that were just entered by the user will also be sent in clear",
    "start": "796959",
    "end": "804560"
  },
  {
    "text": "text luckily lups L up over TLS is supported but is not the default option",
    "start": "804560",
    "end": "812240"
  },
  {
    "text": "and in addition to that in many cases the Lup server itself will not support lups by default so in a lot of cases we",
    "start": "812240",
    "end": "819720"
  },
  {
    "text": "will see the normal Lup server being used okay moving on to evanti so with",
    "start": "819720",
    "end": "827120"
  },
  {
    "text": "ianti we had a slightly different scenario um this time we have two types of ELD up authentication server we have",
    "start": "827120",
    "end": "834040"
  },
  {
    "text": "a generic uh Lup and a dedicated active directory uh server let's understand how",
    "start": "834040",
    "end": "840279"
  },
  {
    "text": "each of them works so with the normal El UPS Sero we have pretty much the same",
    "start": "840279",
    "end": "845519"
  },
  {
    "text": "process H we had with 4ate where a an Elda bind is performed but this time the",
    "start": "845519",
    "end": "851079"
  },
  {
    "text": "default setting uses TLS so if you use simply the default settings you should be H secured from this threat but again",
    "start": "851079",
    "end": "861040"
  },
  {
    "text": "if LS is not supported on the remote server and you use normal elap a simple bind is again being performed and the",
    "start": "861040",
    "end": "867959"
  },
  {
    "text": "credential of both the service account on evanti and the credentials of the user will be sent in clear",
    "start": "867959",
    "end": "875240"
  },
  {
    "text": "text the second option an active directory authentication server relies on the fact that we have active",
    "start": "875240",
    "end": "880759"
  },
  {
    "text": "directory to perform curos authentication um and while ceros can be",
    "start": "880759",
    "end": "885959"
  },
  {
    "text": "attacked in certain ways it will at least not send your password in clear text not that I know of um so it should",
    "start": "885959",
    "end": "893360"
  },
  {
    "text": "be the better option okay so H let's now put on our",
    "start": "893360",
    "end": "899560"
  },
  {
    "text": "post exploitation hat and let's understand what can we actually do here so as we just saw if normal Lup is used",
    "start": "899560",
    "end": "908399"
  },
  {
    "text": "clear text credentials will be sent from the server but what if a secure protocol is used Lup s or ceros well because we",
    "start": "908399",
    "end": "917000"
  },
  {
    "text": "control the VPN there's nothing stopping us from changing the configuration to normal Lup H this should be transparent",
    "start": "917000",
    "end": "924440"
  },
  {
    "text": "to users it will not break anything as long as there's no specific firewall policy blocking Lup to the Lup server H",
    "start": "924440",
    "end": "931279"
  },
  {
    "text": "which I find unlikely um yeah and as soon as we do that clear text credentials begin to flow from the",
    "start": "931279",
    "end": "937759"
  },
  {
    "text": "server the only thing left to answer is how can we actually compromise these credentials remember our scenario here",
    "start": "937759",
    "end": "944959"
  },
  {
    "text": "is that we control the management interface um so how can we uh capture these credentials luckily for us both",
    "start": "944959",
    "end": "952600"
  },
  {
    "text": "4ate and ventti come with a built-in packet capture utility so what we can do is simply start a packet cap",
    "start": "952600",
    "end": "959480"
  },
  {
    "text": "filter Lup packets come back after a few hours to what would be likely a very",
    "start": "959480",
    "end": "964639"
  },
  {
    "text": "long list of clear text credentials so to summarize this section",
    "start": "964639",
    "end": "971800"
  },
  {
    "text": "if an attacker controls your vpm they will be able to trivially compromise any Lup credential being sent to it this",
    "start": "971800",
    "end": "979399"
  },
  {
    "text": "should not be news it makes sense that if an attacker compromises your VPN they will be able to capture credentials H",
    "start": "979399",
    "end": "986680"
  },
  {
    "text": "going back to the implant uh scenario where we described previously an attacker can simply hook the appropriate",
    "start": "986680",
    "end": "992399"
  },
  {
    "text": "function and extract a clear text credential I think that the point here is that they don't have to work that",
    "start": "992399",
    "end": "998399"
  },
  {
    "text": "hard as we just saw this technique which is very easy to implement can allow an",
    "start": "998399",
    "end": "1004120"
  },
  {
    "text": "attacker to immediately compromise all the El up credentials being sent to the",
    "start": "1004120",
    "end": "1009399"
  },
  {
    "text": "VPN okay so this was El up but there are other types of remote authentication",
    "start": "1009399",
    "end": "1015519"
  },
  {
    "text": "servers that could be used by vpns and I wanted to kind of see if it might be possible to capture additional types of",
    "start": "1015519",
    "end": "1022440"
  },
  {
    "text": "credentials well it is possible and let's understand how we can do something like this and to understand it we will",
    "start": "1022440",
    "end": "1029600"
  },
  {
    "text": "first detail some uh describe some details H re revolving around the usage",
    "start": "1029600",
    "end": "1035038"
  },
  {
    "text": "of multiple authentication servers so H let's start with fortigate forgate manages authentication",
    "start": "1035039",
    "end": "1042918"
  },
  {
    "text": "using user groups so the idea is you can H create separate groups h of users and",
    "start": "1042919",
    "end": "1048640"
  },
  {
    "text": "Prov provide them with different permissions and also different authentication mechanisms for example we",
    "start": "1048640",
    "end": "1054720"
  },
  {
    "text": "can have one user one group of users authenticating using local credentials and a separate group authenticating",
    "start": "1054720",
    "end": "1060840"
  },
  {
    "text": "using a remote Lup server an interesting note is that a single user group can",
    "start": "1060840",
    "end": "1066640"
  },
  {
    "text": "have more than one authentication server configured for it for example if we have two separate domains and we want to",
    "start": "1066640",
    "end": "1074280"
  },
  {
    "text": "include members from both of them in our group we can actually do this um so we have two Lup servers configured in one",
    "start": "1074280",
    "end": "1081159"
  },
  {
    "text": "group now let's say that a user from domain one authenticates a two",
    "start": "1081159",
    "end": "1087080"
  },
  {
    "text": "forgate what we would expect is that forgate will determine the appropriate authentication server and validate the",
    "start": "1087080",
    "end": "1094000"
  },
  {
    "text": "credentials using this server well that's not actually the case forgate",
    "start": "1094000",
    "end": "1099640"
  },
  {
    "text": "will perform authentication against all the configured servers so even though",
    "start": "1099640",
    "end": "1105039"
  },
  {
    "text": "that the second Lop server here has no idea who this user is even is they will still receive their credentials so we'll",
    "start": "1105039",
    "end": "1112840"
  },
  {
    "text": "come back in a minute to this Behavior but first let's H describe something similar that we can do it",
    "start": "1112840",
    "end": "1118520"
  },
  {
    "text": "evanti so with evti this time we can only have one authentication server per",
    "start": "1118520",
    "end": "1123880"
  },
  {
    "text": "group we can't have this scenario that we just saw of two separate Lup servers",
    "start": "1123880",
    "end": "1129280"
  },
  {
    "text": "but what we can have is what is called a secondary authentication server this type of server is meant to H support",
    "start": "1129280",
    "end": "1136400"
  },
  {
    "text": "certain SSO configurations where more than one server is required to authenticate the user and when we use",
    "start": "1136400",
    "end": "1142799"
  },
  {
    "text": "this H type of server what happens is that after ianti validates the user credentials we can configure it in such",
    "start": "1142799",
    "end": "1149240"
  },
  {
    "text": "a way that it will also validate the same credentials on the secondary server as well so how can we actually abuse",
    "start": "1149240",
    "end": "1157600"
  },
  {
    "text": "both of these behaviors so again from a post exploitation point of view there's",
    "start": "1157600",
    "end": "1163400"
  },
  {
    "text": "nothing stopping us from adding an additional attack your controlled authentication server to the conf",
    "start": "1163400",
    "end": "1168720"
  },
  {
    "text": "configuration of forgate or ianti this will be either an additional server for forgate or a secondary authentication",
    "start": "1168720",
    "end": "1175559"
  },
  {
    "text": "server for ianti doesn't matter at the end of the day the result will be the same whenever a user authenticates to",
    "start": "1175559",
    "end": "1181880"
  },
  {
    "text": "the VPN no matter using what method any method that is going to be used the",
    "start": "1181880",
    "end": "1188840"
  },
  {
    "text": "credentials will be validating us the using the normal authentication server but they will also at the background",
    "start": "1188840",
    "end": "1195919"
  },
  {
    "text": "will be sent to our attacker control server this very very simple technique can",
    "start": "1195919",
    "end": "1202480"
  },
  {
    "text": "allow us to capture any credentials sent to the VPN this will work for local VPN",
    "start": "1202480",
    "end": "1207799"
  },
  {
    "text": "credentials Lop credentials radius authentication any scenario where a",
    "start": "1207799",
    "end": "1213520"
  },
  {
    "text": "credential is sent to the VPN an attacker can simply hijack this and capture the",
    "start": "1213520",
    "end": "1220400"
  },
  {
    "text": "credential okay so this was remote authentication servers and we'll now",
    "start": "1220400",
    "end": "1225799"
  },
  {
    "text": "explore another interesting scenario which is EXT rting configuration passwords so VPN rely on a variety of",
    "start": "1225799",
    "end": "1234159"
  },
  {
    "text": "Secrets for the operation that are stored in the device configuration for example we have local user passwords SSH",
    "start": "1234159",
    "end": "1241880"
  },
  {
    "text": "keys and most interestingly for us today thirdparty integration accounts VPN can",
    "start": "1241880",
    "end": "1248320"
  },
  {
    "text": "integrate with a variety of services and applications and to enable these Integrations H we will need to specify",
    "start": "1248320",
    "end": "1255280"
  },
  {
    "text": "some sort of credential this can be a password an API key key or a certificate and these secrets will be",
    "start": "1255280",
    "end": "1262960"
  },
  {
    "text": "stored in the device configuration now if we control the VPN what we can do is",
    "start": "1262960",
    "end": "1268880"
  },
  {
    "text": "we can simply export the device configuration containing these secrets but it's not that easy because secrets",
    "start": "1268880",
    "end": "1276880"
  },
  {
    "text": "are stored encrypted and in order to protect them they will not be stored in clear text h but rather in an encrypted",
    "start": "1276880",
    "end": "1283679"
  },
  {
    "text": "form importantly though they are not hashed they're stored using reversible",
    "start": "1283679",
    "end": "1289400"
  },
  {
    "text": "encryption algorithm so naturally our next step is going to be decrypting some",
    "start": "1289400",
    "end": "1296559"
  },
  {
    "text": "secrets we will again start with 4ate so for many years no one really knew how",
    "start": "1296559",
    "end": "1303720"
  },
  {
    "text": "forgate and secrets were being encrypted if you looked up online there was no information it was kind of a",
    "start": "1303720",
    "end": "1310080"
  },
  {
    "text": "secret this changed in 2019 when a security researcher named Bart doid",
    "start": "1310080",
    "end": "1316240"
  },
  {
    "text": "decided to dig into this process and and what he did was he dumped the code from a forgate instance and after reverse",
    "start": "1316240",
    "end": "1323400"
  },
  {
    "text": "engineering it he was able to determine that forgate encrypts all passwords using a hardcoded key now when I say",
    "start": "1323400",
    "end": "1332080"
  },
  {
    "text": "hardcoded key I mean one hardcoded key shared across all 40G devices in the",
    "start": "1332080",
    "end": "1338320"
  },
  {
    "text": "world and this key let me tell you it's not a good one",
    "start": "1338320",
    "end": "1345200"
  },
  {
    "text": "let's just say that it might be the first sentence of a very famous children",
    "start": "1345200",
    "end": "1351520"
  },
  {
    "text": "poem about a little girl and her little lamb so yeah not too good and because we",
    "start": "1351520",
    "end": "1359840"
  },
  {
    "text": "have a known a reversible encryption algorithm with a known key what this means is that anyone in the world can",
    "start": "1359840",
    "end": "1366320"
  },
  {
    "text": "trivially decrypt these secrets they are no not actually protected in any way 48",
    "start": "1366320",
    "end": "1371880"
  },
  {
    "text": "acknowledged this risk and they implemented a fix what they did was they",
    "start": "1371880",
    "end": "1377039"
  },
  {
    "text": "now allow users to to specify a custom encryption key to be used instead of the default one so this is better but we",
    "start": "1377039",
    "end": "1385320"
  },
  {
    "text": "still have some problems here first the feature is disabled by default unless",
    "start": "1385320",
    "end": "1390520"
  },
  {
    "text": "your admin actually goes out and reads the best practices for forgate there's a pretty good chance that this feature",
    "start": "1390520",
    "end": "1396159"
  },
  {
    "text": "will not be used and the same key will still encrypt all the secrets on forgate",
    "start": "1396159",
    "end": "1401880"
  },
  {
    "text": "but even if you have the best admin in the world who actually did this and configured H the custom key you're still",
    "start": "1401880",
    "end": "1408520"
  },
  {
    "text": "still not really safe because if an attacker controls fortigate there is",
    "start": "1408520",
    "end": "1413760"
  },
  {
    "text": "actually a very easy way to bypass this feature what an attacker can do is they can disable it this doesn't require",
    "start": "1413760",
    "end": "1421480"
  },
  {
    "text": "knowledge of the S of the of the secret that was provided previously and attacker can simply disable the feature",
    "start": "1421480",
    "end": "1428200"
  },
  {
    "text": "as soon as they do that encryption of all secrets reverts back to the default key so what this means is that if an",
    "start": "1428200",
    "end": "1435640"
  },
  {
    "text": "attacker compromises forgate no matter what but it will be trivial for them to extract any secret stored on",
    "start": "1435640",
    "end": "1443279"
  },
  {
    "text": "it okay moving on to Eventing with evti we had a similar scenario where we knew",
    "start": "1443279",
    "end": "1449320"
  },
  {
    "text": "that passwords were being saved and encrypted but this time there was really no information online about how this",
    "start": "1449320",
    "end": "1455600"
  },
  {
    "text": "encryption was being performed so having no other choice I had to dump the code",
    "start": "1455600",
    "end": "1460880"
  },
  {
    "text": "from an Evan instance myself and take a look um so after really not that long of",
    "start": "1460880",
    "end": "1467720"
  },
  {
    "text": "an exploration I encountered this piece of code which again initializes a hardcoded key used to encrypt all",
    "start": "1467720",
    "end": "1474200"
  },
  {
    "text": "secrets or ianti again the key is not good I will not share the full content",
    "start": "1474200",
    "end": "1480480"
  },
  {
    "text": "uh of it here but if we take a pick at the beginning of it Juniper last owned connect secure",
    "start": "1480480",
    "end": "1488279"
  },
  {
    "text": "this VPN that was last obtained by ianti in 2015 so this key was likely not changed",
    "start": "1488279",
    "end": "1494679"
  },
  {
    "text": "in a while so again what we have here we have a known a a excuse me a reversible",
    "start": "1494679",
    "end": "1502320"
  },
  {
    "text": "encryption algorithm using a known key which means that it should be tral to decrypt any password stored on",
    "start": "1502320",
    "end": "1509039"
  },
  {
    "text": "ivanti my initial approach was to reverse engineer this process ivanti implemented a an a a custom as-based",
    "start": "1509039",
    "end": "1516240"
  },
  {
    "text": "encryption routine to protect these secrets now after looking at this type",
    "start": "1516240",
    "end": "1521440"
  },
  {
    "text": "of code for a few hours or days I remember that I'm not that good of a",
    "start": "1521440",
    "end": "1527000"
  },
  {
    "text": "reverse engineer and that I have better things to do with my life and I decided to go with a different approach so",
    "start": "1527000",
    "end": "1534120"
  },
  {
    "text": "remembering that all evanti instances use the same encryption key for both",
    "start": "1534120",
    "end": "1539480"
  },
  {
    "text": "encryption and decryption I decided why not let ianti do the heavy lifting for me so let's say I was to obtain an",
    "start": "1539480",
    "end": "1547279"
  },
  {
    "text": "encrypted evanti secret what an attacker can do is they can set up in their own",
    "start": "1547279",
    "end": "1553000"
  },
  {
    "text": "environment and their own Evan instance controlled by them at this point Point",
    "start": "1553000",
    "end": "1558720"
  },
  {
    "text": "what they can do is they can insert the encrypted password into their own configuration specifically they can",
    "start": "1558720",
    "end": "1565960"
  },
  {
    "text": "insert it to the as the password of the Lup service account for",
    "start": "1565960",
    "end": "1571240"
  },
  {
    "text": "evanti why would I do something as random as that if you recall from quite",
    "start": "1571240",
    "end": "1576760"
  },
  {
    "text": "a few slides ago when ianti performs Lup authentication it will send the service account password in clear text so if we",
    "start": "1576760",
    "end": "1584559"
  },
  {
    "text": "set our encrypted password as this secret and Trigger L up authentication we simply cause evanti to decrypt a",
    "start": "1584559",
    "end": "1591200"
  },
  {
    "text": "password for us and send it at this point we can simply H capture the traffic and we have the decrypted secret",
    "start": "1591200",
    "end": "1598440"
  },
  {
    "text": "so this H pretty simple solution that I found found will work for any secret",
    "start": "1598440",
    "end": "1604320"
  },
  {
    "text": "stored on ivanti it is not limited just to Elda passwords all secrets are encrypted using exactly the same process",
    "start": "1604320",
    "end": "1610880"
  },
  {
    "text": "so H yeah this will allow you to access any secret but this is just kind of a proof of concept it is surely possible",
    "start": "1610880",
    "end": "1617399"
  },
  {
    "text": "to recreate create this in a python script as well okay so H our final little finding",
    "start": "1617399",
    "end": "1625039"
  },
  {
    "text": "here H for evti H revolves around MDM servers MDM mobile device management",
    "start": "1625039",
    "end": "1631240"
  },
  {
    "text": "server is another type of remote authentication server that can be used by ianti and H we'll not go too deep",
    "start": "1631240",
    "end": "1637919"
  },
  {
    "text": "into H what these are but basically they are used to allow mobile devices to",
    "start": "1637919",
    "end": "1643000"
  },
  {
    "text": "authenticate to the VPN so in order to configure such an Authentication",
    "start": "1643000",
    "end": "1648159"
  },
  {
    "text": "communication server again we need a set of credentials for the MDM server so we",
    "start": "1648159",
    "end": "1654559"
  },
  {
    "text": "configured this type of server and we took a look at the configuration file in it we found two very interesting",
    "start": "1654559",
    "end": "1662640"
  },
  {
    "text": "fields we have password encrypted and password clear text now do not worry",
    "start": "1662640",
    "end": "1670320"
  },
  {
    "text": "because the names here are misleading both the passwords are stored in clear text",
    "start": "1670320",
    "end": "1676799"
  },
  {
    "text": "um which means that if you were to compromise an evanti server using this",
    "start": "1676799",
    "end": "1682960"
  },
  {
    "text": "type of authentication server you don't even have to bother decrypting the secrets it is already there for you",
    "start": "1682960",
    "end": "1689840"
  },
  {
    "text": "twice okay so let's summarize a configuration passwords if an attacker",
    "start": "1689840",
    "end": "1695120"
  },
  {
    "text": "compromises your VPN they will be able to trivially obtain any secret stored on",
    "start": "1695120",
    "end": "1700640"
  },
  {
    "text": "it I included here a list of possible Integrations h on 4ate for example we",
    "start": "1700640",
    "end": "1707240"
  },
  {
    "text": "have here things like kubernetes esxi active directory all the major Cloud",
    "start": "1707240",
    "end": "1712760"
  },
  {
    "text": "providers and what you need to understand is that if you are using any of these Integrations the second an",
    "start": "1712760",
    "end": "1719120"
  },
  {
    "text": "attacker compromises your VPN they can potentially pivot to these other resources in your",
    "start": "1719120",
    "end": "1726559"
  },
  {
    "text": "network okay so H let's get to vendor responses and then we'll summarize so",
    "start": "1726600",
    "end": "1733240"
  },
  {
    "text": "first of all some of these findings cannot really be fixed H we disclosed any everything that we H talked about",
    "start": "1733240",
    "end": "1739679"
  },
  {
    "text": "here to the vendors and additional time additional things that I didn't have time to cover and they did decide to H",
    "start": "1739679",
    "end": "1747679"
  },
  {
    "text": "fix some of them so let's get to uh H the responses themselves so forgate",
    "start": "1747679",
    "end": "1753519"
  },
  {
    "text": "acknowledged the problem with h the Lup clear text L up authentication H they do not plan to",
    "start": "1753519",
    "end": "1760159"
  },
  {
    "text": "change it they it will still be performed in a using a simple Elda bind",
    "start": "1760159",
    "end": "1765760"
  },
  {
    "text": "and their suggest their suggestion would be simply to not use plain El up I think that the main problem here is that when",
    "start": "1765760",
    "end": "1772640"
  },
  {
    "text": "you configure an Lup authentication server I bet you don't consider that your password will be sending clear text",
    "start": "1772640",
    "end": "1779200"
  },
  {
    "text": "so for foret will update their tentation to strongly discourage this type of a",
    "start": "1779200",
    "end": "1785120"
  },
  {
    "text": "authentication server and the second thing um fate initially considered a the custom key",
    "start": "1785120",
    "end": "1794399"
  },
  {
    "text": "bypass that I detailed here as a vulnerability H but event decided that it it doesn't cross a security boundary",
    "start": "1794399",
    "end": "1801960"
  },
  {
    "text": "and will not fix it so what this means is that again as we just saw it will be trivial and it is not going to be fixed",
    "start": "1801960",
    "end": "1808919"
  },
  {
    "text": "anyone who compromises forgate can very easily extract any secret stored on",
    "start": "1808919",
    "end": "1814000"
  },
  {
    "text": "it as for ianti ivanti plans to fix two",
    "start": "1814000",
    "end": "1819080"
  },
  {
    "text": "of the problems that we highlighted here in an upcoming uh patch uh scheduled for",
    "start": "1819080",
    "end": "1826000"
  },
  {
    "text": "October so first the static encryption key that is used to encrypt all secrets",
    "start": "1826000",
    "end": "1831279"
  },
  {
    "text": "on ianti they plan to fix it I don't have any additional details about what they intend to do but they plan to fix",
    "start": "1831279",
    "end": "1838000"
  },
  {
    "text": "it and MDM password should no longer be saved in clear",
    "start": "1838000",
    "end": "1843279"
  },
  {
    "text": "text okay so before we finish I wanted to emphasize something the techniques",
    "start": "1843279",
    "end": "1849799"
  },
  {
    "text": "that I've detailed here are not like something in theory attackers are already using them going back again to",
    "start": "1849799",
    "end": "1855919"
  },
  {
    "text": "the H mandant report that I previously mentioned in this report it is detailed how attackers were able to move",
    "start": "1855919",
    "end": "1862320"
  },
  {
    "text": "laterally to active directory after compromising ivanti by extracting the Lup service account configured on evanti",
    "start": "1862320",
    "end": "1870200"
  },
  {
    "text": "now I the the report doesn't share exactly how the attackers were able to do this um but as we just saw here we",
    "start": "1870200",
    "end": "1877320"
  },
  {
    "text": "have two very trivial ways to do this either by decrypting the event configuration file or by sniffing",
    "start": "1877320",
    "end": "1884320"
  },
  {
    "text": "packets and extracting the password from there so I think that my point here is",
    "start": "1884320",
    "end": "1889639"
  },
  {
    "text": "that attackers are already using this type of techniques and I think it is only a matter of time before less",
    "start": "1889639",
    "end": "1895760"
  },
  {
    "text": "sophisticated threat actors catch up okay so let's talk a bit about",
    "start": "1895760",
    "end": "1902480"
  },
  {
    "text": "detection and mitigation what can and should we do about these types of risks first I want to say today we focused on",
    "start": "1902480",
    "end": "1909720"
  },
  {
    "text": "40 foret and ivanti but I believe that variations of what we just saw H we're",
    "start": "1909720",
    "end": "1915320"
  },
  {
    "text": "going to be seeing similar things in other prods as well um so it is relevant",
    "start": "1915320",
    "end": "1920960"
  },
  {
    "text": "for you if you use a VPN I believe let's start with detection I",
    "start": "1920960",
    "end": "1926279"
  },
  {
    "text": "would say that the best advantage that we as Defenders have here is that vpns tend to be relatively static espe",
    "start": "1926279",
    "end": "1933519"
  },
  {
    "text": "especially when compared to something like an endpoint vpns don't change that often and any change should stick out so",
    "start": "1933519",
    "end": "1941480"
  },
  {
    "text": "we have pretty basic things here collect and analyze logs these devices in many cases have pretty",
    "start": "1941480",
    "end": "1948279"
  },
  {
    "text": "detailed logs for a lot of events that occur on them and you should collect and analyze them in an attempt to identify",
    "start": "1948279",
    "end": "1954279"
  },
  {
    "text": "anomalies which again should stick out another thing that I would recommend would be to keep an eye on your",
    "start": "1954279",
    "end": "1960760"
  },
  {
    "text": "configuration files a lot of the attacks that I detail here and in general will",
    "start": "1960760",
    "end": "1966159"
  },
  {
    "text": "result in changes to the device configuration again VPN configuration likely doesn't change on a daily basis",
    "start": "1966159",
    "end": "1973120"
  },
  {
    "text": "so if you periodically pull these files and compare them to a golden image for example you can potentially identify",
    "start": "1973120",
    "end": "1980919"
  },
  {
    "text": "anomalies as for mitigation which I think is even more critical here so the",
    "start": "1980919",
    "end": "1986080"
  },
  {
    "text": "first thing that I would recommend is to limit service account permissions as we just saw Here If You com if you",
    "start": "1986080",
    "end": "1992320"
  },
  {
    "text": "configure a service account on your VPN it will be trivial for an attacker to compromise it even if it's not trivial",
    "start": "1992320",
    "end": "1998480"
  },
  {
    "text": "it will be possible there's no uh there's no way around this if the credentials are there and attacker will be able to get them so understand this",
    "start": "1998480",
    "end": "2006360"
  },
  {
    "text": "and limit service account missions as much as possible H understand that if an",
    "start": "2006360",
    "end": "2011760"
  },
  {
    "text": "attacker compromises your VPN they can potentially immediately compromise additional resources if you use too",
    "start": "2011760",
    "end": "2017960"
  },
  {
    "text": "strong of permissions the second one which I believe is going to be harder but is",
    "start": "2017960",
    "end": "2023240"
  },
  {
    "text": "critical and that is to use dedicated identities for VPN authentication if you",
    "start": "2023240",
    "end": "2028880"
  },
  {
    "text": "use the same identities to authenticate to your VPN and to other all other resources in your network what happens",
    "start": "2028880",
    "end": "2035840"
  },
  {
    "text": "is that you create a central point of exposed to the internet which runs on software that tends to be vulnerable",
    "start": "2035840",
    "end": "2042120"
  },
  {
    "text": "from time to time because as we just saw if an attacker compromises the VPN it",
    "start": "2042120",
    "end": "2047399"
  },
  {
    "text": "will be trivial for them to compromise any identity used to authenticate to this VPN if you use the same identities",
    "start": "2047399",
    "end": "2055398"
  },
  {
    "text": "a VPN compromise can become an entire network compromise to mitigate this I",
    "start": "2055399",
    "end": "2060720"
  },
  {
    "text": "would recommend to use separate identities meant specifically for VPN",
    "start": "2060720",
    "end": "2066560"
  },
  {
    "text": "authentication and and finally I would recommend following uh the principles of zero trust network access do not provide",
    "start": "2066560",
    "end": "2073638"
  },
  {
    "text": "excessive network access either to your users or to your VPN server itself there's I believe in most cases there's",
    "start": "2073639",
    "end": "2080720"
  },
  {
    "text": "probably no reason to provide a the VPN server itself with excessive network",
    "start": "2080720",
    "end": "2086200"
  },
  {
    "text": "access there are usually a very a small amount of applications that are going to be used through the VPN so limit the",
    "start": "2086200",
    "end": "2093480"
  },
  {
    "text": "network permissions of the server and the users to limit potential bra Blas radius from these",
    "start": "2093480",
    "end": "2100200"
  },
  {
    "text": "breaches okay so uh to wrap things up a few",
    "start": "2100200",
    "end": "2105440"
  },
  {
    "text": "points threat actors are coming for your VPN this may sound a bit dramatic but I",
    "start": "2105440",
    "end": "2111760"
  },
  {
    "text": "do believe that's the case we are seeing them Time After Time targeting these devices to Great results for them so it",
    "start": "2111760",
    "end": "2119200"
  },
  {
    "text": "is important to understand that your VPN might be targeted one day you need to understand that a",
    "start": "2119200",
    "end": "2126000"
  },
  {
    "text": "compromised VPN can provide much more than network access as we just saw here",
    "start": "2126000",
    "end": "2131280"
  },
  {
    "text": "there are many other things that an attacker can achieve after compromising your VPN and finally going back to the",
    "start": "2131280",
    "end": "2138400"
  },
  {
    "text": "question which opened the stock do not trust your VPN assume that an attacker",
    "start": "2138400",
    "end": "2144640"
  },
  {
    "text": "will Bridge or already have breached it and kind try to act accordingly in order",
    "start": "2144640",
    "end": "2150240"
  },
  {
    "text": "to minimize the risks from this type of bridge before I finish I just wanted to",
    "start": "2150240",
    "end": "2156599"
  },
  {
    "text": "say that there are addition additional details and techniques that I didn't have time to cover which we will publish to akamai's blog today h which you can",
    "start": "2156599",
    "end": "2163839"
  },
  {
    "text": "check out here um if you have any questions I will be at the wrap room after the talk and that's it thank you",
    "start": "2163839",
    "end": "2170680"
  },
  {
    "text": "very much",
    "start": "2170680",
    "end": "2173838"
  }
]