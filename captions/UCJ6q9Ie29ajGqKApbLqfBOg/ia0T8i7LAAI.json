[
  {
    "start": "0",
    "end": "62000"
  },
  {
    "text": "[Music]",
    "start": "4000",
    "end": "13800"
  },
  {
    "text": "all right welcome everyone to our talk my cloud is apt's cloud attacking and defending office 365.",
    "start": "15280",
    "end": "22240"
  },
  {
    "text": "my name is doug beanstalk and i am a incident response manager at mandia so i spend most of my time leading",
    "start": "22240",
    "end": "28640"
  },
  {
    "text": "incident response engagements out of our new york city office for our clients there but i also do a little bit of dabbling",
    "start": "28640",
    "end": "34160"
  },
  {
    "text": "in red teaming and some research as well and i've developed a pretty strong love-hate relationship with office 365",
    "start": "34160",
    "end": "41120"
  },
  {
    "text": "over the past few years and i hope that after this talk you'll understand a little bit why",
    "start": "41120",
    "end": "46160"
  },
  {
    "text": "outside of infosec i'm a huge green bay packers fan so if during the qa you want to ask me anything about aaron rodgers",
    "start": "46160",
    "end": "51920"
  },
  {
    "text": "it might not be the best use of our time but i say go for it now i'm going to turn it over to my co-speaker josh who will introduce",
    "start": "51920",
    "end": "58000"
  },
  {
    "text": "himself and get us started with some content josh thanks doug my name is josh madeley i'm",
    "start": "58000",
    "end": "64878"
  },
  {
    "start": "62000",
    "end": "100000"
  },
  {
    "text": "an incident response manager at mandiant based out of our boston office and i've been with the company for about four and a half years",
    "start": "64879",
    "end": "72799"
  },
  {
    "text": "i like to think of myself as a bit of a cloud connoisseur since i do love all things cloud and i",
    "start": "72799",
    "end": "78880"
  },
  {
    "text": "genuinely believe that it is the solution to many modern i.t problems but with that comes",
    "start": "78880",
    "end": "84960"
  },
  {
    "text": "the realization that it has its own unique security implications uh outside of infosec i'm a die-hard",
    "start": "84960",
    "end": "91680"
  },
  {
    "text": "rugby fan and you know based out of boston i've had to adopt the new england patriots as my",
    "start": "91680",
    "end": "97759"
  },
  {
    "text": "american football team of choice so today we're going to be talking about",
    "start": "97759",
    "end": "103439"
  },
  {
    "start": "100000",
    "end": "133000"
  },
  {
    "text": "how targeted threat actors attack office 365. to do that we're going to give you a",
    "start": "103439",
    "end": "109040"
  },
  {
    "text": "crash course overview of office 365 then talk about how attackers gain",
    "start": "109040",
    "end": "114159"
  },
  {
    "text": "their initial access to a tenant and finally how they complete their mission and steal data",
    "start": "114159",
    "end": "119680"
  },
  {
    "text": "we want all of you to walk away from this presentation with the understanding that targeted threat groups are",
    "start": "119680",
    "end": "125520"
  },
  {
    "text": "investing a lot of time and money into understanding office 365 and understanding how to attack it",
    "start": "125520",
    "end": "131520"
  },
  {
    "text": "and that means that you need to as well now one of the major misconceptions",
    "start": "131520",
    "end": "136640"
  },
  {
    "text": "about office 365 is that it is just email well that may",
    "start": "136640",
    "end": "141920"
  },
  {
    "text": "be true for some small organizations for many it is their entire authentication and collaboration",
    "start": "141920",
    "end": "148160"
  },
  {
    "text": "platform this includes exchange online active directory online microsoft teams",
    "start": "148160",
    "end": "155680"
  },
  {
    "text": "sharepoint online word online you get the point microsoft has moved",
    "start": "155680",
    "end": "162400"
  },
  {
    "text": "their traditionally on-premise applications into the cloud",
    "start": "162400",
    "end": "167519"
  },
  {
    "text": "and provided them as a software as a service model now one of the important features of",
    "start": "167519",
    "end": "172879"
  },
  {
    "text": "office 365 is that it is accessible from anywhere in the world there are no access restrictions unless",
    "start": "172879",
    "end": "179440"
  },
  {
    "text": "your organization intentionally implements them this means that identity and its",
    "start": "179440",
    "end": "185760"
  },
  {
    "text": "corresponding metadata are used to determine if a user has rights to access their",
    "start": "185760",
    "end": "191280"
  },
  {
    "text": "email or a word document from a hotel wi-fi or an airplane",
    "start": "191280",
    "end": "196959"
  },
  {
    "text": "no vpn required with that though we want to spend a few minutes talking",
    "start": "196959",
    "end": "202400"
  },
  {
    "start": "197000",
    "end": "324000"
  },
  {
    "text": "about authentication and the two common hybrid identity models that we see organizations using",
    "start": "202400",
    "end": "208879"
  },
  {
    "text": "and it is very likely that your organization is using one of these now first there's managed authentication",
    "start": "208879",
    "end": "216879"
  },
  {
    "text": "and this is when azure ad handles the authentication process by using a cloud stored hashed version",
    "start": "216879",
    "end": "224239"
  },
  {
    "text": "of your password known as a password hash synchronization or it will send the credentials to an",
    "start": "224239",
    "end": "231280"
  },
  {
    "text": "on-premise software agent to authenticate against your local active directory server it's called pass-through authentication",
    "start": "231280",
    "end": "238080"
  },
  {
    "text": "it's model simple easy to use and maintain and it is microsoft's preferred mechanism",
    "start": "238080",
    "end": "245120"
  },
  {
    "text": "for authentication they would prefer to use password hash synchronization because it gives you access to advanced",
    "start": "245120",
    "end": "252400"
  },
  {
    "text": "azure ad security features such as identity protection the second model is federated",
    "start": "252400",
    "end": "257759"
  },
  {
    "text": "authentication and this is where authentication is passed off to a trusted third party",
    "start": "257759",
    "end": "262880"
  },
  {
    "text": "such as adfs octa ping identity and we're going to spend a little bit of",
    "start": "262880",
    "end": "268080"
  },
  {
    "text": "time talking today about what that trusted third party actually means in practice",
    "start": "268080",
    "end": "274560"
  },
  {
    "text": "now when a user logs in they're redirected to a login page",
    "start": "274560",
    "end": "280160"
  },
  {
    "text": "for that particular organization this is often an adfs proxy server sitting in a dmz in your network",
    "start": "280160",
    "end": "288560"
  },
  {
    "text": "the user presents their credentials which are validated against the internal ad database a",
    "start": "288560",
    "end": "295040"
  },
  {
    "text": "successful authentication results in a signed saml token being sent to the cloud to assert that",
    "start": "295040",
    "end": "301759"
  },
  {
    "text": "the users provided the appropriate username password and if configured satisfied the mfa requirements now as",
    "start": "301759",
    "end": "309120"
  },
  {
    "text": "you can imagine this is a little harder to manage and maintain but it does give some",
    "start": "309120",
    "end": "314639"
  },
  {
    "text": "organizations added flexibility federated authentication is",
    "start": "314639",
    "end": "320000"
  },
  {
    "text": "generally used by large enterprises now that we understand the basics of how",
    "start": "320000",
    "end": "326240"
  },
  {
    "start": "324000",
    "end": "400000"
  },
  {
    "text": "authentication is handled we need to discuss the two types of authentication there's modern authentication which is the default and",
    "start": "326240",
    "end": "333199"
  },
  {
    "text": "recommended sign in method and effectively behind the scenes it is oauth this with this comes support",
    "start": "333199",
    "end": "341039"
  },
  {
    "text": "for some advanced security features such as multi-factor authentication and conditional access policies you can",
    "start": "341039",
    "end": "348080"
  },
  {
    "text": "even use metadata about the device or location or the location of the user to determine",
    "start": "348080",
    "end": "356560"
  },
  {
    "text": "if additional verification is required such as a mobile push legacy authentication is used by you",
    "start": "356560",
    "end": "363360"
  },
  {
    "text": "guessed it legacy protocols such as pop imap older versions of powershell and",
    "start": "363360",
    "end": "370560"
  },
  {
    "text": "autodiscover it does not support multi-factor authentication because it is essentially http",
    "start": "370560",
    "end": "376720"
  },
  {
    "text": "basic auth and the reason we have to talk about this is that it is enabled by default and you",
    "start": "376720",
    "end": "383280"
  },
  {
    "text": "as administrators and defenders need to proactively turn it off attackers know this and they extensively target it",
    "start": "383280",
    "end": "390800"
  },
  {
    "text": "now microsoft will eventually disable this but they've already extended the",
    "start": "390800",
    "end": "395840"
  },
  {
    "text": "deadline once so your guess is as good as mine when that will actually occur",
    "start": "395840",
    "end": "401440"
  },
  {
    "start": "400000",
    "end": "615000"
  },
  {
    "text": "now once the user has successfully authenticated you as defenders need to know where this",
    "start": "401440",
    "end": "409120"
  },
  {
    "text": "authentication is recorded and where the subsequent actions are recorded",
    "start": "409120",
    "end": "414479"
  },
  {
    "text": "now you're going to be given three core logs you've got the unified mailbox and admin audit logs along with",
    "start": "414479",
    "end": "421599"
  },
  {
    "text": "azure ad logs mail trace logs and the security and compliance reports",
    "start": "421599",
    "end": "426960"
  },
  {
    "text": "the unified log is the centralized solution for various office 365 applications it",
    "start": "426960",
    "end": "433280"
  },
  {
    "text": "records it's sorry the data it records varies by application",
    "start": "433280",
    "end": "439039"
  },
  {
    "text": "and in most cases it will record it timestamp username operation source ip address and the",
    "start": "439039",
    "end": "445360"
  },
  {
    "text": "associ sorry and this and the associated parameters for that request",
    "start": "445360",
    "end": "450720"
  },
  {
    "text": "the date is stored for 90 days by default and can be accessed via powershell or a web ui",
    "start": "450720",
    "end": "457039"
  },
  {
    "text": "we strongly recommend that you have this data forwarded to some sort of log aggregation tool so that you're not limited by the",
    "start": "457039",
    "end": "463919"
  },
  {
    "text": "powershell interface um and if you have e5 an e5 license you",
    "start": "463919",
    "end": "469360"
  },
  {
    "text": "can extend the retention period uh the native search capabilities are pretty limited so",
    "start": "469360",
    "end": "474879"
  },
  {
    "text": "if you want to have some robust interactions and robust detection you're going to have to forward it to a",
    "start": "474879",
    "end": "480080"
  },
  {
    "text": "sim the mailbox audit logs record certain data that occur by",
    "start": "480080",
    "end": "485919"
  },
  {
    "text": "owners delegates and administrators within a specific mailbox this is not",
    "start": "485919",
    "end": "491919"
  },
  {
    "text": "centrally indexed and these would include log ons message binds folder binds and mail items at mail item",
    "start": "491919",
    "end": "498720"
  },
  {
    "text": "access events whether the event is logged depends entirely on the license level",
    "start": "498720",
    "end": "505360"
  },
  {
    "text": "and the type of access to the object whether it was done with valid credentials or the user was delegated access",
    "start": "505360",
    "end": "513039"
  },
  {
    "text": "to the the object now defenders need to be familiar with this type of auditing",
    "start": "513039",
    "end": "518479"
  },
  {
    "text": "we're not going to go over the details of it today but unless you're paying money for",
    "start": "518479",
    "end": "525200"
  },
  {
    "text": "advanced auditing if an attacker logs in with valid credentials you will not know what objects they interacted with what emails",
    "start": "525200",
    "end": "532000"
  },
  {
    "text": "they viewed another important point is that the data",
    "start": "532000",
    "end": "538080"
  },
  {
    "text": "is stored in the individual mailboxes themselves so if you want to search the data that",
    "start": "538080",
    "end": "544080"
  },
  {
    "text": "is not if you want to search the data within the mailbox audit logs",
    "start": "544080",
    "end": "549279"
  },
  {
    "text": "you're going to have to do it on a per mailbox basis and you have to think that this is likely going to be an unfortunate loop",
    "start": "549279",
    "end": "556320"
  },
  {
    "text": "with a powershell script unless you forward it to a sim proactively",
    "start": "556320",
    "end": "561360"
  },
  {
    "text": "uh finally there's the admin audit log and this is going to record the execution and the corresponding",
    "start": "561360",
    "end": "566880"
  },
  {
    "text": "parameters of administrative commandlets within the tenant majority of these are searchable within the unified audit log so you don't",
    "start": "566880",
    "end": "573440"
  },
  {
    "text": "generally need to interact with it if you are an e5 licensed subscriber",
    "start": "573440",
    "end": "579440"
  },
  {
    "text": "uh you're going to have access to the asia at the azure ad audit logs and they'll be stored for 30 days and",
    "start": "579440",
    "end": "584640"
  },
  {
    "text": "they contain additional data about the authentications such as the mfa type used a little bit",
    "start": "584640",
    "end": "591120"
  },
  {
    "text": "more detail about the applications etc uh mail flow logs are going to give you access to you know",
    "start": "591120",
    "end": "597360"
  },
  {
    "text": "which how which direction individual mail items are transiting the the tenant so who's receiving which",
    "start": "597360",
    "end": "603360"
  },
  {
    "text": "messages and who's sending them and then you can also use the security",
    "start": "603360",
    "end": "608880"
  },
  {
    "text": "and compliance reports to search for content of the messages to see what they contain",
    "start": "608880",
    "end": "615040"
  },
  {
    "start": "615000",
    "end": "689000"
  },
  {
    "text": "now that we're all experts on how office 365 works let's briefly talk about the attack",
    "start": "617200",
    "end": "623760"
  },
  {
    "text": "lifecycle and how it relates to office 365. as we mentioned earlier identity is the",
    "start": "623760",
    "end": "630399"
  },
  {
    "text": "most important access control within office 365. so when we think",
    "start": "630399",
    "end": "636240"
  },
  {
    "text": "about the attack life cycle we need to keep it tightly coupled to the compromise credentials and the",
    "start": "636240",
    "end": "642880"
  },
  {
    "text": "authentication providers each request to an object needs to be authenticated",
    "start": "642880",
    "end": "649279"
  },
  {
    "text": "today we're going to focus on how attackers initially compromise an environment",
    "start": "649279",
    "end": "655279"
  },
  {
    "text": "using valid credentials how they maintain their persistence by modifying or circumventing the federated",
    "start": "655279",
    "end": "661040"
  },
  {
    "text": "authentication providers and how they use the built-in administrative and security tooling to",
    "start": "661040",
    "end": "667279"
  },
  {
    "text": "steal mass amounts of data all of the techniques today that doug and i are going to talk about",
    "start": "667279",
    "end": "672720"
  },
  {
    "text": "we've observed attackers using through investigating real live incidents",
    "start": "672720",
    "end": "678399"
  },
  {
    "text": "we are not going to be talking about penetration testing techniques um but instead focus on the ttps we",
    "start": "678399",
    "end": "684959"
  },
  {
    "text": "we have observed advanced adversaries using in the real world all right thanks josh so our first case",
    "start": "684959",
    "end": "692079"
  },
  {
    "start": "689000",
    "end": "710000"
  },
  {
    "text": "studies are going to talk about initial access what are the ways that targeted threat actors are finding their way",
    "start": "692079",
    "end": "697120"
  },
  {
    "text": "into office 365. after that we'll talk a little bit about some of the ways that they're maintaining their access how are",
    "start": "697120",
    "end": "703279"
  },
  {
    "text": "they establishing persistence so they can access a tenant for days weeks months maybe even years if they're",
    "start": "703279",
    "end": "709279"
  },
  {
    "text": "lucky our first case study is going to walk us through an mfa bypass",
    "start": "709279",
    "end": "715040"
  },
  {
    "start": "710000",
    "end": "885000"
  },
  {
    "text": "using powershell so josh has talked about conditional access and i'm going to talk about it even more",
    "start": "715040",
    "end": "720480"
  },
  {
    "text": "it's a really strong way to ensure that you are securing your tenant and these clients that we were assisting",
    "start": "720480",
    "end": "727200"
  },
  {
    "text": "they were all using conditional access to enforce mfa for all logons but somehow the attacker",
    "start": "727200",
    "end": "733120"
  },
  {
    "text": "was actually managing to get around this and through some initial testing we couldn't exactly figure out how",
    "start": "733120",
    "end": "738880"
  },
  {
    "text": "until we started looking at the azure ad audit logs and the unified audit log we found that the attacker was using a",
    "start": "738880",
    "end": "745519"
  },
  {
    "text": "powershell module called azure active directory powershell or azure ad now this module is going to give us",
    "start": "745519",
    "end": "751600"
  },
  {
    "text": "programmatic access to azure active directory and as josh just finished telling us it",
    "start": "751600",
    "end": "756639"
  },
  {
    "text": "has a lot of sensitive information in there so obviously our users but also groups that they're in and",
    "start": "756639",
    "end": "762000"
  },
  {
    "text": "other overarching information about the organization and what's",
    "start": "762000",
    "end": "767040"
  },
  {
    "text": "interesting about this particular powershell module for office 365 is that any user even an unlicensed user",
    "start": "767040",
    "end": "774639"
  },
  {
    "text": "can access it and you actually can't disable it so with exchange online powershell there's a setting you can use",
    "start": "774639",
    "end": "780399"
  },
  {
    "text": "to disable it that setting does not apply to this powershell module and what's even more interesting to us but also to the",
    "start": "780399",
    "end": "787040"
  },
  {
    "text": "attacker at the time was that this module did not go through conditional access so it would",
    "start": "787040",
    "end": "792240"
  },
  {
    "text": "completely bypass conditional access policies the attacker found this out and they used it to",
    "start": "792240",
    "end": "797360"
  },
  {
    "text": "access a number of organizations that we assisted now microsoft has recently fixed this",
    "start": "797360",
    "end": "802399"
  },
  {
    "text": "bug you can no longer bypass conditional access using this powershell module we're just not exactly sure when",
    "start": "802399",
    "end": "808320"
  },
  {
    "text": "they put the fix in because there were no release notes or patch notes that we could find so the",
    "start": "808320",
    "end": "814240"
  },
  {
    "text": "first investigation that we were working involved a citrix netscaler compromise the attacker had accessed this netscaler",
    "start": "814240",
    "end": "820880"
  },
  {
    "text": "using the vulnerability that i'm sure we all know about and that netscaler device contained the username",
    "start": "820880",
    "end": "826560"
  },
  {
    "text": "and password for what the client was calling an ldap connector account now this account was an ad account and",
    "start": "826560",
    "end": "832720"
  },
  {
    "text": "so it was also being synced into azure active directory which meant the attacker could use it to connect to azure active directory using",
    "start": "832720",
    "end": "839680"
  },
  {
    "text": "the powershell module they did that and then they exported the full list of users so about 50 000 users",
    "start": "839680",
    "end": "846399"
  },
  {
    "text": "and conducted a massive password spray attack now inevitably they got some more credentials out of that",
    "start": "846399",
    "end": "851519"
  },
  {
    "text": "and then further accessed this victim organization's environment now some other case studies we were also",
    "start": "851519",
    "end": "857600"
  },
  {
    "text": "investigating password sprays these were much smaller in scope so likely the attacker had conducted some",
    "start": "857600",
    "end": "863040"
  },
  {
    "text": "osint or had bought some lists and was using that to try and authenticate to azure ad powershell",
    "start": "863040",
    "end": "869519"
  },
  {
    "text": "now once they successfully got in they exported as much information as they could turned that information around and used",
    "start": "869519",
    "end": "876160"
  },
  {
    "text": "it to export all of these organizations so threatening to sell this information to criminals if the organization didn't buy",
    "start": "876160",
    "end": "882480"
  },
  {
    "text": "it from them first now our next case study our next ttp",
    "start": "882480",
    "end": "888000"
  },
  {
    "start": "885000",
    "end": "927000"
  },
  {
    "text": "also involves powershell also involves a conditional access bypass so this organization was using",
    "start": "888000",
    "end": "893680"
  },
  {
    "text": "conditional access to enforce mfa for all science but the attacker also found a way around conditional",
    "start": "893680",
    "end": "899440"
  },
  {
    "text": "access using a different technique in this case we could see in the azure ad audit logs",
    "start": "899440",
    "end": "905040"
  },
  {
    "text": "that the attacker was using an application called the microsoft online syndication partner portal or the mos",
    "start": "905040",
    "end": "910880"
  },
  {
    "text": "pp and the user agent contained a windows binary called the msoid svc now we had never heard of this",
    "start": "910880",
    "end": "918079"
  },
  {
    "text": "before neither had the client and furthermore the client was not using a partner to manage their tenant so the",
    "start": "918079",
    "end": "924079"
  },
  {
    "text": "partner portal thing just didn't make sense to us after some digging we found",
    "start": "924079",
    "end": "929199"
  },
  {
    "text": "that the msmonsoidsvc excuse me was the microsoft online",
    "start": "929199",
    "end": "935360"
  },
  {
    "text": "services sign-in assistant which is basically an authentication broker that helps other desktop apps",
    "start": "935360",
    "end": "941440"
  },
  {
    "text": "connect to office 365 and this was actually a requirement for some applications and",
    "start": "941440",
    "end": "946720"
  },
  {
    "text": "even powershell modules in the earlier days of office 365.",
    "start": "946720",
    "end": "951839"
  },
  {
    "text": "and that mospp that partner portal not a partner portal it was actually a",
    "start": "951839",
    "end": "956880"
  },
  {
    "text": "very early version of the microsoft exchange online powershell module a version from i think 2016 that you can actually",
    "start": "956880",
    "end": "964320"
  },
  {
    "text": "no longer download from an official microsoft website and for context we were conducting this investigation",
    "start": "964320",
    "end": "969920"
  },
  {
    "text": "very early 2020 and now it turns out this combination of tools the sign in assistant",
    "start": "969920",
    "end": "975440"
  },
  {
    "text": "and this old version of powershell completely bypassed conditional access so the attacker somehow figured this out",
    "start": "975440",
    "end": "981759"
  },
  {
    "text": "and was using it to access the tenant now this has also been fixed again we're not sure exactly when because there are",
    "start": "981759",
    "end": "987360"
  },
  {
    "text": "no release notes but sometime the last few months you this was closed and you can no longer use these tools to bypass conditional",
    "start": "987360",
    "end": "994839"
  },
  {
    "text": "access now the last technique i want to talk about for initial access is oauth abuse",
    "start": "994839",
    "end": "1000240"
  },
  {
    "text": "i've already talked about this at some other conferences as well as a pretty good fireeye blog post and a tool that i've created",
    "start": "1000240",
    "end": "1006560"
  },
  {
    "text": "and some of my peers in the infosec industry have blogged about this and created their own tools but what it's boiling down to is the",
    "start": "1006560",
    "end": "1013040"
  },
  {
    "text": "fact that office 365 just like any cloud platform is going to give third-party developers the ability",
    "start": "1013040",
    "end": "1020000"
  },
  {
    "text": "to create applications that then access data on a user's behalf so think about your calendar plugins",
    "start": "1020000",
    "end": "1026079"
  },
  {
    "text": "your salesforce integration maybe boomerang for email all of these are our oauth applications",
    "start": "1026079",
    "end": "1032558"
  },
  {
    "text": "and they're attractive to attackers for a few reasons the first is they're using a legitimate microsoft framework so you can see the image here",
    "start": "1032559",
    "end": "1039918"
  },
  {
    "text": "is the only thing that a user really sees and it's a pretty simple yes or no prompt for them to allow an app now these applications are designed",
    "start": "1039919",
    "end": "1047438"
  },
  {
    "text": "to bypass mfa because i don't want my calendar plugin to prompt me for mfa every day or every week or whatever they",
    "start": "1047439",
    "end": "1054400"
  },
  {
    "text": "also can access the user's data for 90 days if not longer so very attractive to attackers and in fact we've seen a",
    "start": "1054400",
    "end": "1060799"
  },
  {
    "text": "number of campaigns since around 2018 of varying levels of sophistication and microsoft actually just recently",
    "start": "1060799",
    "end": "1067440"
  },
  {
    "text": "took down a number of domains that were hosting oauth abuse applications that attackers were using to conduct bec",
    "start": "1067440",
    "end": "1074000"
  },
  {
    "text": "attacks so how can we stop this from happening well first off we should remove the",
    "start": "1074000",
    "end": "1079520"
  },
  {
    "start": "1075000",
    "end": "1106000"
  },
  {
    "text": "ability for users to consent to apps right just like we're not allowing our end users or shouldn't be allowing our",
    "start": "1079520",
    "end": "1085360"
  },
  {
    "text": "end users to install applications on their laptops we should not be allowing them to consent to",
    "start": "1085360",
    "end": "1090559"
  },
  {
    "text": "applications in office 365 just doesn't make sense now if you have an e5 license or cloud app security you",
    "start": "1090559",
    "end": "1096799"
  },
  {
    "text": "can go a little further you can have a little more control you can do some hunting you can look for prevalence",
    "start": "1096799",
    "end": "1102400"
  },
  {
    "text": "you just basically have some more options available now that we understand initial access",
    "start": "1102400",
    "end": "1108880"
  },
  {
    "start": "1106000",
    "end": "1125000"
  },
  {
    "text": "let's move into persistence how are attackers ensuring they have long-term access to office 365",
    "start": "1108880",
    "end": "1115120"
  },
  {
    "text": "and it's important to note that all of these techniques require global admin privileges so the attacker",
    "start": "1115120",
    "end": "1120400"
  },
  {
    "text": "has already somehow escalated their privileges that's out of scope for now",
    "start": "1120400",
    "end": "1125760"
  },
  {
    "start": "1125000",
    "end": "1227000"
  },
  {
    "text": "our first technique is a conditional access policy modification so we've talked a lot about conditional access",
    "start": "1125760",
    "end": "1131600"
  },
  {
    "text": "and it's very important obviously and attackers know that and they spend a lot of time",
    "start": "1131600",
    "end": "1137039"
  },
  {
    "text": "understanding how conditional access works and so in this case we had an attacker that was accessing office 365 from the vpn",
    "start": "1137039",
    "end": "1145919"
  },
  {
    "text": "this vpn did not require mfa now however the victim organization was still using",
    "start": "1145919",
    "end": "1151600"
  },
  {
    "text": "conditional access to enforce mfa as long as you were coming from somewhere else from a starbucks for example",
    "start": "1151600",
    "end": "1158400"
  },
  {
    "text": "and to kind of set up this level of configuration conditional access has a couple of tools available to us right",
    "start": "1158400",
    "end": "1165039"
  },
  {
    "text": "so what the attacker was was using and what this client was using is a ip based exclusion list so the client",
    "start": "1165039",
    "end": "1172880"
  },
  {
    "text": "was calling it their mfa trusted ips the list of ip addresses that don't need mfa",
    "start": "1172880",
    "end": "1178480"
  },
  {
    "text": "the attacker found this list and they added an additional ip address to it that ip address was actually a microsoft",
    "start": "1178480",
    "end": "1184559"
  },
  {
    "text": "ip address because the attacker's plan was to proxy all of their network traffic through an azure vm",
    "start": "1184559",
    "end": "1190799"
  },
  {
    "text": "this had the added benefit that when an investigator when an analyst is looking through the logs they'll just",
    "start": "1190799",
    "end": "1196320"
  },
  {
    "text": "see microsoft ips and they'll probably think it's legitimate and the other thing for us to think",
    "start": "1196320",
    "end": "1201360"
  },
  {
    "text": "about is monitoring and alerting right when you're monitoring or learning you",
    "start": "1201360",
    "end": "1206559"
  },
  {
    "text": "probably want to know about configuration changes to your environment you probably have scom alerts for when a",
    "start": "1206559",
    "end": "1212159"
  },
  {
    "text": "new domain administrator gets created for example there's nothing out of the box that we can really do here though in office 365.",
    "start": "1212159",
    "end": "1218720"
  },
  {
    "text": "we can't receive an alert any time a new mfa trusted ip is added you need some additional logging",
    "start": "1218720",
    "end": "1224400"
  },
  {
    "text": "or monitoring to do that now moving on in sophistication we had",
    "start": "1224400",
    "end": "1230240"
  },
  {
    "start": "1227000",
    "end": "1322000"
  },
  {
    "text": "another victim organization where the attacker was managing to access office 365 even",
    "start": "1230240",
    "end": "1235600"
  },
  {
    "text": "though the attacker had didn't have mfa obviously and even though the victim",
    "start": "1235600",
    "end": "1240960"
  },
  {
    "text": "was enforcing password resets and enforcing mfa and we didn't see any of the other hallmarks of those conditional access",
    "start": "1240960",
    "end": "1247679"
  },
  {
    "text": "bypasses that we have just finished talking about it turns out what was happening is the attacker was using a",
    "start": "1247679",
    "end": "1252960"
  },
  {
    "text": "bug in office 365 as well as some very particular knowledge about how federated",
    "start": "1252960",
    "end": "1258159"
  },
  {
    "text": "authentication works so that bug was that you could add a new domain to a tenant",
    "start": "1258159",
    "end": "1264080"
  },
  {
    "text": "and use it for federated auth even if you don't own that domain so i could add google.com for example",
    "start": "1264080",
    "end": "1269919"
  },
  {
    "text": "and the knowledge was the attacker knew specifically that azure active directory is really only",
    "start": "1269919",
    "end": "1275520"
  },
  {
    "text": "checking two pieces of information with those federated authentication tokens the first one is obvious they're",
    "start": "1275520",
    "end": "1281440"
  },
  {
    "text": "checking that the digital signature is valid and the second one is looking for a piece of information in those tokens",
    "start": "1281440",
    "end": "1288159"
  },
  {
    "text": "called an immutable id the mutable id is basically just a grid which can map back to a user in the",
    "start": "1288159",
    "end": "1294480"
  },
  {
    "text": "azure active directory or in the office 365 tenant and so what the attacker was doing is",
    "start": "1294480",
    "end": "1300799"
  },
  {
    "text": "they were creating authentication tokens for valid users in that tenant",
    "start": "1300799",
    "end": "1307200"
  },
  {
    "text": "and then authenticating regardless of the fact that they have just added this new federated",
    "start": "1307200",
    "end": "1312400"
  },
  {
    "text": "domain called evil.com but they were trying to authenticate to users called victim.org",
    "start": "1312400",
    "end": "1318080"
  },
  {
    "text": "that doesn't matter because those two domains were within the same tenant so by setting a new additional",
    "start": "1318080",
    "end": "1324480"
  },
  {
    "start": "1322000",
    "end": "1414000"
  },
  {
    "text": "unverified domain as a federated authentication provider the attacker was basically telling azure",
    "start": "1324480",
    "end": "1329600"
  },
  {
    "text": "active directory hey i'm going to send you authentication tokens from this domain",
    "start": "1329600",
    "end": "1334720"
  },
  {
    "text": "and you can trust them for any user in the tenant regardless of their domain",
    "start": "1334720",
    "end": "1340320"
  },
  {
    "text": "and because the attacker already had access to office 365 to azure active directory they could",
    "start": "1340320",
    "end": "1346400"
  },
  {
    "text": "export the full list of immutable ids for all of the users which now meant that they had all of the information they needed to",
    "start": "1346400",
    "end": "1352720"
  },
  {
    "text": "create an authentication token for any user in the entire tenant and this is going to bypass",
    "start": "1352720",
    "end": "1357840"
  },
  {
    "text": "mfa because the attacker can add something to those authentication tokens that say hey this is a trusted authentication",
    "start": "1357840",
    "end": "1364400"
  },
  {
    "text": "from a trusted location don't worry about mfa now this bug has somewhat been fixed so",
    "start": "1364400",
    "end": "1370480"
  },
  {
    "text": "you can no longer set up an unverified domain a domain you don't own as a federated authentication provider",
    "start": "1370480",
    "end": "1377200"
  },
  {
    "text": "but if we think about it it would be fairly trivial for an attacker to create a typo squad domain validate that they",
    "start": "1377200",
    "end": "1383360"
  },
  {
    "text": "own it because they're going to register it and then add it as a new federated authentication provider and conduct",
    "start": "1383360",
    "end": "1388720"
  },
  {
    "text": "the same attack and just like with modifying conditional access there are no alerts set up out of the box",
    "start": "1388720",
    "end": "1394640"
  },
  {
    "text": "to tell us when a new domain gets added when a new federated authentication provider gets added",
    "start": "1394640",
    "end": "1399760"
  },
  {
    "text": "and actually this technique has been blogged about as far back as 2018 as a way for it administrators to",
    "start": "1399760",
    "end": "1405919"
  },
  {
    "text": "backdoor their own tenant in case they're worried that some cloud multi-factor provider maybe azure mfa",
    "start": "1405919",
    "end": "1411600"
  },
  {
    "text": "fails and locks them out so the last technique i'm going to talk about is gold and saml and i've talked",
    "start": "1411600",
    "end": "1418240"
  },
  {
    "start": "1414000",
    "end": "1476000"
  },
  {
    "text": "about this a lot at my troopers talk back last year in 2019 and some tools that i released but what",
    "start": "1418240",
    "end": "1424720"
  },
  {
    "text": "it's boiling down to is the fact that the digital signature that adfs servers create is relying on a",
    "start": "1424720",
    "end": "1431279"
  },
  {
    "text": "signing key that sits in a database on that server now it is encrypted but that encryption",
    "start": "1431279",
    "end": "1436640"
  },
  {
    "text": "key sits within active directory and can easily be exported by a domain administrator",
    "start": "1436640",
    "end": "1442240"
  },
  {
    "text": "so what we now have is a way for an attacker to export a valid signing key and then create their own valid",
    "start": "1442240",
    "end": "1449039"
  },
  {
    "text": "authentication tokens from anywhere in the world and just feed those to azure active directory",
    "start": "1449039",
    "end": "1454400"
  },
  {
    "text": "and in fact we've seen this in the wild we've seen kate a case where a attacker was on premise so they were",
    "start": "1454400",
    "end": "1460640"
  },
  {
    "text": "domain admin running around the network they connected to an adfs server and from smb flow logs that were",
    "start": "1460640",
    "end": "1466960"
  },
  {
    "text": "available to us we could see that they copied off the entire adfs database back to their c2 server presumably with",
    "start": "1466960",
    "end": "1473600"
  },
  {
    "text": "the goal of conducting a golden sample attack so how can we make sure gold and saml doesn't happen well we need to protect",
    "start": "1473600",
    "end": "1480480"
  },
  {
    "text": "adfs as a tier zero device so just like we're protecting our domain controllers we're hardening them",
    "start": "1480480",
    "end": "1486720"
  },
  {
    "text": "we are enforcing least privilege we're segmenting them the same must be done for our adfs servers",
    "start": "1486720",
    "end": "1492880"
  },
  {
    "text": "we also need to be prepared to reset that adfs signing to signing key so just like when we think",
    "start": "1492880",
    "end": "1499360"
  },
  {
    "text": "an attacker accesses a domain controller we're going to reset the krb tgt twice when we think an attacker accesses",
    "start": "1499360",
    "end": "1506320"
  },
  {
    "text": "the adfs server we're going to reset that certificate only once though so we need to make sure that's in our",
    "start": "1506320",
    "end": "1511760"
  },
  {
    "text": "irp our incident response plan we need to make sure our it teams have practiced that and that they recognize how to do",
    "start": "1511760",
    "end": "1517279"
  },
  {
    "text": "it so that's it for persistence and initial access i'm now going to turn it over to",
    "start": "1517279",
    "end": "1522400"
  },
  {
    "text": "josh and he's going to talk about what we see targeted threat actors do to actually achieve their mess",
    "start": "1522400",
    "end": "1527440"
  },
  {
    "text": "achieve their mission attackers don't compromise office 365 for the fun of it there is",
    "start": "1527440",
    "end": "1534480"
  },
  {
    "text": "purpose they are there to complete a mission it may be reconnaissance and maybe trying to gain access to your partner networks",
    "start": "1534480",
    "end": "1541520"
  },
  {
    "start": "1535000",
    "end": "1690000"
  },
  {
    "text": "they may be trying to steal data that is contained within your tenant and the simplest mechanism that we see",
    "start": "1541520",
    "end": "1548799"
  },
  {
    "text": "both targeted and opportunistic attackers employ are mail forwarding rules",
    "start": "1548799",
    "end": "1554000"
  },
  {
    "text": "the two most common ways we see attackers configure this is through the use of smtp forwarding",
    "start": "1554000",
    "end": "1559919"
  },
  {
    "text": "rules or inbox rules the smtp rules forward all received messages to the",
    "start": "1559919",
    "end": "1567360"
  },
  {
    "text": "specified mailbox they're easy to detect both retroactively and real time",
    "start": "1567360",
    "end": "1572880"
  },
  {
    "text": "by monitoring the unified audit log for the set mailbox commandlet or by reviewing the forwarding address",
    "start": "1572880",
    "end": "1578880"
  },
  {
    "text": "and forwarding smtp address attribute of the mailbox configuration we often see attackers configure this",
    "start": "1578880",
    "end": "1587039"
  },
  {
    "text": "these forwarding rules so that when they lose access when the user resets their password they continue to",
    "start": "1587039",
    "end": "1593760"
  },
  {
    "text": "get the data out of the mailbox inbox rules are more versatile and a bit",
    "start": "1593760",
    "end": "1599919"
  },
  {
    "text": "harder to retroactively detect they allow the attacker to configure rules",
    "start": "1599919",
    "end": "1605200"
  },
  {
    "text": "that target messages with specific keywords or between key personnel we've seen targeted attackers ensure",
    "start": "1605200",
    "end": "1611679"
  },
  {
    "text": "that all password reset emails were forwarded to an attacker controlled email address",
    "start": "1611679",
    "end": "1618159"
  },
  {
    "text": "this allowed the attacker to reset the password for services that relied on the corporate email",
    "start": "1618159",
    "end": "1623279"
  },
  {
    "text": "address as the username but weren't integrated into active directory and because a lot of",
    "start": "1623279",
    "end": "1630240"
  },
  {
    "text": "users legitimately configure inbox rules they're challenging to detect and monitor",
    "start": "1630240",
    "end": "1635919"
  },
  {
    "text": "as sim tuning can be a challenge you're going to be facing a lot of false positives on a fairly regular basis and you tend",
    "start": "1635919",
    "end": "1642240"
  },
  {
    "text": "to become numb to those types of alerts uh they're also difficult to hunt within the environment because they are",
    "start": "1642240",
    "end": "1647840"
  },
  {
    "text": "configured within the mailbox itself um which means you need to interrogate each individual mailbox as opposed to",
    "start": "1647840",
    "end": "1655120"
  },
  {
    "text": "just looking at the metadata about the mailbox now in addition to",
    "start": "1655120",
    "end": "1660799"
  },
  {
    "text": "forwarding and inbox rules we have seen on a handful of occasions attackers configure",
    "start": "1660799",
    "end": "1665919"
  },
  {
    "text": "flow rules and this way they can use the microsoft automation framework",
    "start": "1665919",
    "end": "1671679"
  },
  {
    "text": "to take action on particular messages generally forwarding them to an external address",
    "start": "1671679",
    "end": "1676799"
  },
  {
    "text": "these are much harder to detect because none of the configurations are are contained within the mailbox itself",
    "start": "1676799",
    "end": "1683760"
  },
  {
    "text": "you have to be looking in the unified audit log for uh suspicious flow entries being",
    "start": "1683760",
    "end": "1689039"
  },
  {
    "text": "created rights delegation is another tactic that attackers use",
    "start": "1689039",
    "end": "1694720"
  },
  {
    "start": "1690000",
    "end": "1742000"
  },
  {
    "text": "i mean we're going to stick with the boring but effective category for this one we've seen attackers delegate rights to",
    "start": "1694720",
    "end": "1701679"
  },
  {
    "text": "the compromised accounts for content within mailboxes that they're interested in the attacker will gain access to a",
    "start": "1701679",
    "end": "1707679"
  },
  {
    "text": "service account possibly a directory sync account or a maintenance account that never",
    "start": "1707679",
    "end": "1713520"
  },
  {
    "text": "changes its password and assign it privileges to read the content of over 100 mailboxes that they're targeting",
    "start": "1713520",
    "end": "1719679"
  },
  {
    "text": "well it's not uncommon well it's well this is not an uncommon practice in organizations",
    "start": "1719679",
    "end": "1724880"
  },
  {
    "text": "um you know there's there's legitimate reasons for delegation",
    "start": "1724880",
    "end": "1730640"
  },
  {
    "text": "your security monitoring team should be looking out for the add mailbox permission event um and following that up with some sort",
    "start": "1730640",
    "end": "1737360"
  },
  {
    "text": "of change request or positive affirmation from the users that they did configure it",
    "start": "1737360",
    "end": "1743440"
  },
  {
    "start": "1742000",
    "end": "1831000"
  },
  {
    "text": "now we want to get into a little bit more complicated mechanisms that attackers use and these can be mail flow or transport",
    "start": "1743440",
    "end": "1750080"
  },
  {
    "text": "rules these rules i identify and act on all messages that flow through exchange online",
    "start": "1750080",
    "end": "1757039"
  },
  {
    "text": "they're commonly used by organizations to block attachments bypass clutter",
    "start": "1757039",
    "end": "1762799"
  },
  {
    "text": "or block messages with unacceptable language",
    "start": "1762799",
    "end": "1769120"
  },
  {
    "text": "attackers can use these same rules to inspect messages for content that",
    "start": "1769120",
    "end": "1774880"
  },
  {
    "text": "they're interested in that's relevant to their mission and send it outside of the tenant via a",
    "start": "1774880",
    "end": "1780640"
  },
  {
    "text": "bcc rule now we've seen fin 7 employ this technique to target gift card processing in an",
    "start": "1780640",
    "end": "1787360"
  },
  {
    "text": "organization each time that a legitimate gift card was created",
    "start": "1787360",
    "end": "1793520"
  },
  {
    "text": "within the organization fin7 received a copy of that gift card and this resulted in thousands of gift cards being cashed out",
    "start": "1793520",
    "end": "1801440"
  },
  {
    "text": "prior to the legitimate users receiving them now because organizations can have a lot",
    "start": "1801440",
    "end": "1808880"
  },
  {
    "text": "of mail flow rules malicious entries are difficult to find",
    "start": "1808880",
    "end": "1814720"
  },
  {
    "text": "so the new transport rule event needs to be monitored in your by your security operations team",
    "start": "1814720",
    "end": "1820960"
  },
  {
    "text": "and i'd recommend having some sort of change process to go along with this so you can again positively affirm that administrators",
    "start": "1820960",
    "end": "1827440"
  },
  {
    "text": "are making these changes and that it's not an attacker now attackers like to automate things as",
    "start": "1827440",
    "end": "1835200"
  },
  {
    "start": "1831000",
    "end": "1901000"
  },
  {
    "text": "well so we have seen attackers leverage the graph api and this is a restful web api",
    "start": "1835200",
    "end": "1841600"
  },
  {
    "text": "that enables you or administrators to access",
    "start": "1841600",
    "end": "1846799"
  },
  {
    "text": "the microsoft cloud services and its resources you can read emails create events",
    "start": "1846799",
    "end": "1853200"
  },
  {
    "text": "administer users effectively do everything advanced attackers have registered oauth",
    "start": "1853200",
    "end": "1858960"
  },
  {
    "text": "applications like doug talked about earlier and convinced those users to consent to",
    "start": "1858960",
    "end": "1864880"
  },
  {
    "text": "access we've also seen them consent to tenant wide admin access",
    "start": "1864880",
    "end": "1870080"
  },
  {
    "text": "now because password changes don't remove the oauth the",
    "start": "1870080",
    "end": "1876640"
  },
  {
    "text": "the oauth application the attackers can maintain their persistence in the environment and make these api requests to read your",
    "start": "1876640",
    "end": "1883440"
  },
  {
    "text": "mailbox to search your documents and download you know your onenote files or your updated contracts",
    "start": "1883440",
    "end": "1890000"
  },
  {
    "text": "or your secret project development information all through a web api that's",
    "start": "1890000",
    "end": "1895120"
  },
  {
    "text": "proxied through anywhere in the world with no need for multi-factor authentication",
    "start": "1895120",
    "end": "1901039"
  },
  {
    "start": "1901000",
    "end": "2013000"
  },
  {
    "text": "and finally i want to talk about e-discovery abuse",
    "start": "1901760",
    "end": "1906799"
  },
  {
    "text": "this is where attackers have access to all the things it's a gold mine for them it lets them",
    "start": "1906799",
    "end": "1913360"
  },
  {
    "text": "search and download content in exchange online microsoft teams",
    "start": "1913360",
    "end": "1919840"
  },
  {
    "text": "sharepoint online onedrive for business skype for the three of you that are still using skype",
    "start": "1919840",
    "end": "1926480"
  },
  {
    "text": "and yammer i guess if you're microsoft you use yammer",
    "start": "1926480",
    "end": "1931919"
  },
  {
    "text": "and the corresponding event log entries are missing some critical data like a session id",
    "start": "1932159",
    "end": "1937519"
  },
  {
    "text": "or ip addresses so when you search the unified audit log for evidence of an attacker accessing or",
    "start": "1937519",
    "end": "1944399"
  },
  {
    "text": "making a malicious search based on the indicators of compromise you've developed namely an ip address",
    "start": "1944399",
    "end": "1950399"
  },
  {
    "text": "you will miss these events and you will potentially miss hundreds of gigabytes of data theft and",
    "start": "1950399",
    "end": "1956559"
  },
  {
    "text": "we've seen apt-35 leverage this capability with great success",
    "start": "1956559",
    "end": "1962399"
  },
  {
    "text": "uh they will log in gain administrative access to a network they will create an e-discovery search",
    "start": "1962399",
    "end": "1969760"
  },
  {
    "text": "find all the data they were interested in in most cases it's the rs are these rsa seed files for soft",
    "start": "1969760",
    "end": "1976320"
  },
  {
    "text": "tokens that are mailed to users or emailed to users during provisioning",
    "start": "1976320",
    "end": "1981360"
  },
  {
    "text": "they will download the data and they will then delete the results and this all happens in the span of a couple of",
    "start": "1981360",
    "end": "1987120"
  },
  {
    "text": "hours and once they're once they delete the results when a legitimate e-discovery user logs into the console all evidence of it",
    "start": "1987120",
    "end": "1995039"
  },
  {
    "text": "has disappeared so it's a particularly insidious way to gain access to your entire",
    "start": "1995039",
    "end": "2000880"
  },
  {
    "text": "tenant and it's critical that you as defenders micromanage the searches and exports of",
    "start": "2000880",
    "end": "2008399"
  },
  {
    "text": "data that occur within e-discovery",
    "start": "2008399",
    "end": "2012720"
  },
  {
    "start": "2013000",
    "end": "2096000"
  },
  {
    "text": "so on that happy note i wanted to leave you guys with some closing thoughts one enforce mfa for everyone just do it",
    "start": "2013840",
    "end": "2021919"
  },
  {
    "text": "now there's no reason to wait um ensure that you're sending your office 365 logs",
    "start": "2021919",
    "end": "2029039"
  },
  {
    "text": "to a sim and you have alerts configured that detect what attackers are actually doing",
    "start": "2029039",
    "end": "2036480"
  },
  {
    "text": "and you need to understand the types of information that is in your o365 tenant it's not just email",
    "start": "2036480",
    "end": "2044240"
  },
  {
    "text": "your developers are sharing api keys within teams chats whether you like it or not",
    "start": "2044240",
    "end": "2049760"
  },
  {
    "text": "and using ediscovery they can find those api keys and gain access to a variety of other services and use this",
    "start": "2049760",
    "end": "2056560"
  },
  {
    "text": "data as an easy hop point and finally",
    "start": "2056560",
    "end": "2061599"
  },
  {
    "text": "it's important to understand that the apt groups are aware of how office 365",
    "start": "2061599",
    "end": "2066720"
  },
  {
    "text": "works and they're investing considerable effort into learning how to use it so much so that they're not even afraid",
    "start": "2066720",
    "end": "2073358"
  },
  {
    "text": "to make tenant-wide modifications like mail flow rules or modifying conditional access policies",
    "start": "2073359",
    "end": "2081040"
  },
  {
    "text": "for your entire cloud infrastructure well you might have a change control",
    "start": "2081040",
    "end": "2086720"
  },
  {
    "text": "process the attacker is not going to respect that thanks for listening we appreciate the",
    "start": "2086720",
    "end": "2091919"
  },
  {
    "text": "you guys tuning in",
    "start": "2091919",
    "end": "2094720"
  },
  {
    "start": "2096000",
    "end": "2442000"
  },
  {
    "text": "i think we're live",
    "start": "2098240",
    "end": "2103839"
  },
  {
    "text": "all right guys uh thanks for and girls thanks for listening to our talk um i think most of the questions that",
    "start": "2107760",
    "end": "2114400"
  },
  {
    "text": "were in the chat we answered so i don't really know how this is supposed to work but i guess if there are any",
    "start": "2114400",
    "end": "2120160"
  },
  {
    "text": "other questions we'll answer them as they come in",
    "start": "2120160",
    "end": "2124480"
  },
  {
    "text": "uh should the sim be outside of the ad tenant it's",
    "start": "2129119",
    "end": "2134560"
  },
  {
    "text": "monitoring i don't really think it matters i assume this is a question of alluding to like",
    "start": "2134560",
    "end": "2140560"
  },
  {
    "text": "uh sentinel and the other uh stuff inside azure active directory inside office 365",
    "start": "2140560",
    "end": "2146079"
  },
  {
    "text": "i don't think it really matters uh there's probably not really a question of like a",
    "start": "2146079",
    "end": "2152160"
  },
  {
    "text": "dos attack or anything like that if you're trying to get it and i think sentinel is a pretty good platform",
    "start": "2152160",
    "end": "2159839"
  },
  {
    "text": "in regards to the the miter attack framework question i'll confess i'm not an expert on the",
    "start": "2169920",
    "end": "2176560"
  },
  {
    "text": "miter attack framework and i don't know how any of these techniques map to it",
    "start": "2176560",
    "end": "2183599"
  },
  {
    "text": "i don't know doug if you have any thoughts on that",
    "start": "2183680",
    "end": "2188078"
  },
  {
    "text": "nope um the question let's see office 365 has built-in alerts are those adequate",
    "start": "2190640",
    "end": "2196160"
  },
  {
    "text": "i think those are a really great start but you know part of what josh and i have talked",
    "start": "2196160",
    "end": "2201200"
  },
  {
    "text": "about here are a lot of ways that attackers are using legitimate features within office 365 to",
    "start": "2201200",
    "end": "2207040"
  },
  {
    "text": "their benefit right and so there there certainly are some alerts for um like new e-discovery cases being",
    "start": "2207040",
    "end": "2213920"
  },
  {
    "text": "launched new forwarding rules being put in those are certainly good something an organization wants to",
    "start": "2213920",
    "end": "2220800"
  },
  {
    "text": "uh be monitoring but some of the more nuanced things like someone modifying a conditional access",
    "start": "2220800",
    "end": "2227040"
  },
  {
    "text": "policy for example or someone adding a new authentication provider those i don't believe have any sort of",
    "start": "2227040",
    "end": "2233760"
  },
  {
    "text": "default alerts and it's something you really want to be monitoring right it's something that probably happens",
    "start": "2233760",
    "end": "2238880"
  },
  {
    "text": "infrequently enough that it's okay to generate an alert for your sock or for your uh cert team",
    "start": "2238880",
    "end": "2245599"
  },
  {
    "text": "and that to my knowledge does not have any default within uh office 360.",
    "start": "2245599",
    "end": "2251359"
  },
  {
    "text": "microsoft does have sentinel which i have limited experience with it um but anybody that i've talked to",
    "start": "2251359",
    "end": "2258480"
  },
  {
    "text": "that's worked with it has come away with a fairly positive um uh impression of the tool you can also",
    "start": "2258480",
    "end": "2265520"
  },
  {
    "text": "build in these custom alerts into your existing sim if you integrate the two",
    "start": "2265520",
    "end": "2271040"
  },
  {
    "text": "and like doug said when attackers are leveraging existing functionality or legitimate",
    "start": "2271040",
    "end": "2276320"
  },
  {
    "text": "functionality you need to pay close attention to how your alerts are being configured and how you're following up on them and what the",
    "start": "2276320",
    "end": "2282000"
  },
  {
    "text": "playbooks are for each alert because you don't want to end up generating an alert for every",
    "start": "2282000",
    "end": "2288320"
  },
  {
    "text": "e-discovery search that's done in your tenant when you have a fairly active legal team",
    "start": "2288320",
    "end": "2293520"
  },
  {
    "text": "it's just gonna you're gonna become numb to those those alerts very quickly so it's just a matter of",
    "start": "2293520",
    "end": "2299440"
  },
  {
    "text": "building or developing solid workflows inside and outside of office 365 to make",
    "start": "2299440",
    "end": "2304800"
  },
  {
    "text": "your alerts more effective josh there's a question about the graph api because the video was chopping in",
    "start": "2304800",
    "end": "2310560"
  },
  {
    "text": "and out do you want to briefly go over what attackers have used the graph api for yeah so at a really simple",
    "start": "2310560",
    "end": "2316960"
  },
  {
    "text": "level the attackers are using it to read mailbox or message content for um",
    "start": "2316960",
    "end": "2322560"
  },
  {
    "text": "mailboxes they're interested in so the the case that we worked on um the attacker had granted themselves",
    "start": "2322560",
    "end": "2328560"
  },
  {
    "text": "or made an oauth consent for an individual user's mailbox this wasn't a tenant-wide access that is",
    "start": "2328560",
    "end": "2335520"
  },
  {
    "text": "possible but that's not what we saw uh the attacker then made repeated api requests",
    "start": "2335520",
    "end": "2341920"
  },
  {
    "text": "to access content within the mailbox i think it was close to 90 days before",
    "start": "2341920",
    "end": "2348560"
  },
  {
    "text": "we were able to detect it and identify it",
    "start": "2348560",
    "end": "2355839"
  },
  {
    "text": "okay let's see yeah are there any powershell services",
    "start": "2356240",
    "end": "2362240"
  },
  {
    "text": "allowing abuse similar to what we described you know i think that's kind of a we'll have to see question that you know",
    "start": "2362240",
    "end": "2368000"
  },
  {
    "text": "from from my understanding of how these all worked it's they all were using legacy",
    "start": "2368000",
    "end": "2374079"
  },
  {
    "text": "authentication right which doesn't support mfa and however our victim organizations",
    "start": "2374079",
    "end": "2380000"
  },
  {
    "text": "that we were working with were using conditional access policies to block legacy authentication",
    "start": "2380000",
    "end": "2386079"
  },
  {
    "text": "but i guess under the hood the way it worked it was trying to block it based on the specific",
    "start": "2386079",
    "end": "2393280"
  },
  {
    "text": "application service principle and these service principles",
    "start": "2393280",
    "end": "2398320"
  },
  {
    "text": "azure ad powershell and then the older version the mospp powershell weren't included in that",
    "start": "2398320",
    "end": "2404880"
  },
  {
    "text": "block list that now has been fixed but what i don't know because i you know i don't know the code right is",
    "start": "2404880",
    "end": "2410560"
  },
  {
    "text": "has the model shifted to use some sort of different metadata or could there be other service principle grids out there",
    "start": "2410560",
    "end": "2417440"
  },
  {
    "text": "that may bypass the kind of logic and the conditional",
    "start": "2417440",
    "end": "2422839"
  },
  {
    "text": "access there's a question about",
    "start": "2422839",
    "end": "2428880"
  },
  {
    "text": "okay perfect there's a couple good questions i want",
    "start": "2430319",
    "end": "2435359"
  },
  {
    "text": "to get to all right yeah thanks guys we'll we'll answer uh in the chat",
    "start": "2435359",
    "end": "2444079"
  }
]