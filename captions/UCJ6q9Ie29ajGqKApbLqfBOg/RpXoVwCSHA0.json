[
  {
    "text": "[Music] foreign",
    "start": "1730",
    "end": "6720"
  },
  {
    "text": "okay good afternoon everybody Welcome Aboard my train uh this talk uh will",
    "start": "10980",
    "end": "18359"
  },
  {
    "text": "take you to deep Waters of mqtt protocol",
    "start": "18359",
    "end": "23460"
  },
  {
    "text": "which is not a new topic but I will try to present the kind of a new point of",
    "start": "23460",
    "end": "28680"
  },
  {
    "text": "view how the mqtt can be misused in an unusual kind of ways how many of you",
    "start": "28680",
    "end": "35700"
  },
  {
    "text": "know mqtt protocol just yeah great so",
    "start": "35700",
    "end": "42120"
  },
  {
    "text": "I will be your train operator today my name is Martin um I used to work for Avast for 12 years",
    "start": "42120",
    "end": "48480"
  },
  {
    "text": "and now I'm independent researcher my domain of expertise is mainly like",
    "start": "48480",
    "end": "54059"
  },
  {
    "text": "everything glow level that means from Chip and for a few last years also to",
    "start": "54059",
    "end": "60539"
  },
  {
    "text": "Cloud I have a few YC's myself I'm a pretty heavy coffee addict",
    "start": "60539",
    "end": "67380"
  },
  {
    "text": "and with that comes also my hobby which is breaking the coffee machines and",
    "start": "67380",
    "end": "73740"
  },
  {
    "text": "reversing them uh and if you want to ask my age I can",
    "start": "73740",
    "end": "79020"
  },
  {
    "text": "tell you I remember the BBS bulletin board system and that's all the",
    "start": "79020",
    "end": "84420"
  },
  {
    "text": "information I'm going to present you today uh came from oh just kidding so",
    "start": "84420",
    "end": "90360"
  },
  {
    "text": "let's make a plan for our journey or for our trip today uh at the first stop uh we will do some",
    "start": "90360",
    "end": "97799"
  },
  {
    "text": "planning so I will try to explain a bit what the mqtt is for those who don't",
    "start": "97799",
    "end": "103500"
  },
  {
    "text": "know and also to map the landscape so how is the situation with the mqtt protocol out",
    "start": "103500",
    "end": "110280"
  },
  {
    "text": "there is specifically like the publicly facing mqtt servers that means like the",
    "start": "110280",
    "end": "117000"
  },
  {
    "text": "servers connected to the internet and available in the next station we'll hop on a train",
    "start": "117000",
    "end": "123560"
  },
  {
    "text": "and I will show you a few use cases of misconfiguration and security mishaps I",
    "start": "123560",
    "end": "130560"
  },
  {
    "text": "would say that come with the mqtt protocol and mqtt brokers",
    "start": "130560",
    "end": "137160"
  },
  {
    "text": "then in the next stop we'll change the train and I would like to show you how it is",
    "start": "137160",
    "end": "144959"
  },
  {
    "text": "possible basically from okay like Hope from the mqtt and ethernet internet",
    "start": "144959",
    "end": "152099"
  },
  {
    "text": "protocols to a different technology so for example zigbee Bluetooth low energy",
    "start": "152099",
    "end": "157980"
  },
  {
    "text": "then before I'll leave you at the Terminus we will do a short demo which",
    "start": "157980",
    "end": "164640"
  },
  {
    "text": "is probably the cherry on top of this presentation when I'll show you how you can misuse the",
    "start": "164640",
    "end": "171420"
  },
  {
    "text": "mqtt to break the whole perimeter from the inside out and at the terminals I will leave you",
    "start": "171420",
    "end": "178260"
  },
  {
    "text": "with few thoughts you can you can ask questions if there is going to be a time",
    "start": "178260",
    "end": "184019"
  },
  {
    "text": "left so usually my talks about iot and iot",
    "start": "184019",
    "end": "189540"
  },
  {
    "text": "security itself starts with the like iot rant about how bad the situation is how",
    "start": "189540",
    "end": "195300"
  },
  {
    "text": "how the S stands for security in iot abbreviation uh I will skip that this",
    "start": "195300",
    "end": "201300"
  },
  {
    "text": "time because that could be pretty pretty long talking I will leave you with this",
    "start": "201300",
    "end": "206940"
  },
  {
    "text": "quote that for me is like uh just on point with the computer security and",
    "start": "206940",
    "end": "212819"
  },
  {
    "text": "specifically with the iot security that's just that's how it is",
    "start": "212819",
    "end": "219480"
  },
  {
    "text": "and to prove it I will show you how bad the situation is now",
    "start": "219480",
    "end": "224760"
  },
  {
    "text": "So speaking of mqtt like I have this naive model for you who don't know what",
    "start": "224760",
    "end": "231900"
  },
  {
    "text": "the mqtt is it's very handy lightweight protocol uh that is based on a publisher",
    "start": "231900",
    "end": "237299"
  },
  {
    "text": "subscriber model so you can basically publish to some topic on the other side there are subscribers that subscribe to",
    "start": "237299",
    "end": "243900"
  },
  {
    "text": "a topic and the broker itself which is the implementation of the mqtt uh",
    "start": "243900",
    "end": "249780"
  },
  {
    "text": "realize the messages to be more versatile it allows you to",
    "start": "249780",
    "end": "255720"
  },
  {
    "text": "subscribe as a subscriber to wild cards uh topics or for example the last",
    "start": "255720",
    "end": "261540"
  },
  {
    "text": "subscriber here on the picture uh basically consumes all the news from either the weather or or sport news",
    "start": "261540",
    "end": "270360"
  },
  {
    "text": "so this is basically very simple model this is this is how it is in terms of",
    "start": "270360",
    "end": "276300"
  },
  {
    "text": "some specifications as I said it's a publisher subscriber model it's spelled agnostic so it really",
    "start": "276300",
    "end": "283259"
  },
  {
    "text": "doesn't matter what the payload is it's just for for the implementation it's like a binary blob so whatever you put",
    "start": "283259",
    "end": "289860"
  },
  {
    "text": "in there it got transmitted the topics are organized into real life structure",
    "start": "289860",
    "end": "295380"
  },
  {
    "text": "what we've already seen uh when subscribing the wild cards can be used there are actually two wild",
    "start": "295380",
    "end": "301919"
  },
  {
    "text": "cards the one is Hash time which stands similarly to file system for asterisk so",
    "start": "301919",
    "end": "307919"
  },
  {
    "text": "anything and then there is a plus sign which means like one letter in in terms of for example",
    "start": "307919",
    "end": "315540"
  },
  {
    "text": "the file system and file names in this case it means like one level in a tree one",
    "start": "315540",
    "end": "321780"
  },
  {
    "text": "and exactly one uh usually it operates through TCP port on 1883 if there is a TLS implementation",
    "start": "321780",
    "end": "331639"
  },
  {
    "text": "it uses 8080 83 two distinctive features of the mqtt",
    "start": "331639",
    "end": "337860"
  },
  {
    "text": "itself are last will and the retained topics last wheel is basically used in",
    "start": "337860",
    "end": "345360"
  },
  {
    "text": "an environment where the connection is not very reliable and it's used in a way that when the broker loses the",
    "start": "345360",
    "end": "352740"
  },
  {
    "text": "connection with the client it's able to publish on behalf of a disconnected client some payload on some topic which",
    "start": "352740",
    "end": "361020"
  },
  {
    "text": "is set during the collection so that's typically being used for notifying all",
    "start": "361020",
    "end": "367199"
  },
  {
    "text": "the other subscribers that the client went offline for example the return topic is just the flag when you're",
    "start": "367199",
    "end": "375360"
  },
  {
    "text": "publishing you can say this is a retain content and the content stays at the",
    "start": "375360",
    "end": "380520"
  },
  {
    "text": "topic so whenever new it's like a last state of the topic so whenever any new",
    "start": "380520",
    "end": "385860"
  },
  {
    "text": "subscriber subscribes uh to a retain topic it gets immediately late latest",
    "start": "385860",
    "end": "391979"
  },
  {
    "text": "status or the last things sorry in terms of implementations of the of",
    "start": "391979",
    "end": "399300"
  },
  {
    "text": "this protocol the most prominent and probably most famous one is mosquito if",
    "start": "399300",
    "end": "404880"
  },
  {
    "text": "you crunch a bit of data you will see that like 80 percent coverage or 80",
    "start": "404880",
    "end": "410100"
  },
  {
    "text": "percent of mqtt servers around the internet are based on mosquito server",
    "start": "410100",
    "end": "416000"
  },
  {
    "text": "uh this particle implementation supports ACL list which is very important part",
    "start": "416000",
    "end": "422940"
  },
  {
    "text": "you can set basically like fine-grained access to topics and clients so you can",
    "start": "422940",
    "end": "428160"
  },
  {
    "text": "say this client can exist this topic this coin can write read only or write",
    "start": "428160",
    "end": "433440"
  },
  {
    "text": "only so it's it's very useful feature then the implementation supports",
    "start": "433440",
    "end": "439319"
  },
  {
    "text": "obviously the plain text transport which is over TCP then TLS and also websockets",
    "start": "439319",
    "end": "446280"
  },
  {
    "text": "uh in terms of authorization and authentication you can have like the username password combination client",
    "start": "446280",
    "end": "453240"
  },
  {
    "text": "certificate you can even basically do a kind of authorization by by just name of the",
    "start": "453240",
    "end": "461520"
  },
  {
    "text": "client so when the client connects it specifies its own ID and that could be used as well",
    "start": "461520",
    "end": "467099"
  },
  {
    "text": "but it allows on top of that is like you can create multiple listeners that's",
    "start": "467099",
    "end": "472800"
  },
  {
    "text": "handy for a situation when you for example have I don't know you have you have clients",
    "start": "472800",
    "end": "479280"
  },
  {
    "text": "that are not uh let's say computational able to support TLS so you have like a",
    "start": "479280",
    "end": "485160"
  },
  {
    "text": "segment of network when there is no TLS supported and then you have another segment when you can connect the clients",
    "start": "485160",
    "end": "490919"
  },
  {
    "text": "using the TLs that's why the multiple listeners are uh",
    "start": "490919",
    "end": "496259"
  },
  {
    "text": "supported so speaking of my ycs and my diagnosis in",
    "start": "496259",
    "end": "502560"
  },
  {
    "text": "the beginning I didn't say that I have a slight OCD and that is basically why",
    "start": "502560",
    "end": "508860"
  },
  {
    "text": "this talk uh it will happen because",
    "start": "508860",
    "end": "514640"
  },
  {
    "text": "I intend to return to previous things I've done and I've done this research before",
    "start": "514640",
    "end": "520580"
  },
  {
    "text": "specifically in 2018 we published the article that there are almost 32 000 of",
    "start": "520580",
    "end": "527760"
  },
  {
    "text": "mqtt servers openly available on the internet and by misusing them you can",
    "start": "527760",
    "end": "535100"
  },
  {
    "text": "ship the data from home automations out there on even control some of them",
    "start": "535100",
    "end": "542760"
  },
  {
    "text": "so I written back and the whole thing uh is because of the out of the box problem",
    "start": "542760",
    "end": "549620"
  },
  {
    "text": "that's the term I came up maybe maybe it's it's like uh normally uh used but",
    "start": "549620",
    "end": "557760"
  },
  {
    "text": "the thing is uh almost 60 percent of installation of mqtt servers have never",
    "start": "557760",
    "end": "564480"
  },
  {
    "text": "been set up so that that's a common problem you know with with everything basically not just the software packages",
    "start": "564480",
    "end": "570180"
  },
  {
    "text": "and devices like if you leave default credentials or actually if you install anything and it works and you don't need",
    "start": "570180",
    "end": "577800"
  },
  {
    "text": "to set up anything it stays like that uh any guesses what the default credentials for mqtt server is or are",
    "start": "577800",
    "end": "587300"
  },
  {
    "text": "none the axis is completely Anonymous that's the way how you install the mqtd server",
    "start": "588060",
    "end": "594240"
  },
  {
    "text": "just to prove it I'll have this very short demo recorded recorded So up",
    "start": "594240",
    "end": "600060"
  },
  {
    "text": "there there is a VPS server publicly facing the internet and by just issuing the APT get",
    "start": "600060",
    "end": "607019"
  },
  {
    "text": "installed mosquito you'll install the mosquito server the demon",
    "start": "607019",
    "end": "612420"
  },
  {
    "text": "starts and it just works it's open and you've created in 11 seconds instance of",
    "start": "612420",
    "end": "618899"
  },
  {
    "text": "mqtt server that is widely open to the internet so that's the probably main problem why",
    "start": "618899",
    "end": "625680"
  },
  {
    "text": "there is so many servers out there so since 2018 it got better a bit so we've",
    "start": "625680",
    "end": "635160"
  },
  {
    "text": "been in a situation where the defaults if you don't specify the anonymous",
    "start": "635160",
    "end": "641100"
  },
  {
    "text": "access in a configuration file what's the true so you had this implementation",
    "start": "641100",
    "end": "646680"
  },
  {
    "text": "that is able to do all this kind of stuff like such as TLS ACL authorization",
    "start": "646680",
    "end": "652980"
  },
  {
    "text": "authentication but Nev like nobody ever",
    "start": "652980",
    "end": "658560"
  },
  {
    "text": "use that so it improved a bit so fast forward to 2022",
    "start": "658560",
    "end": "665240"
  },
  {
    "text": "in a new version of mosquito implementation uh the defaults is to",
    "start": "665240",
    "end": "670260"
  },
  {
    "text": "false so the no Anonymous access is available anymore but still uh nobody",
    "start": "670260",
    "end": "676920"
  },
  {
    "text": "uses the ACL lists which is a huge problem and I will show you why",
    "start": "676920",
    "end": "682519"
  },
  {
    "text": "If We Run The Showdown query on and most prevalent mqtt versions nowadays this is",
    "start": "683899",
    "end": "691140"
  },
  {
    "text": "like a really fresh data you can see still the version 1.48 which is full of",
    "start": "691140",
    "end": "697560"
  },
  {
    "text": "vulnerabilities is out there and it's on the top what's more",
    "start": "697560",
    "end": "702720"
  },
  {
    "text": "interesting here is these are the sir or these are the servers that are openly",
    "start": "702720",
    "end": "709019"
  },
  {
    "text": "available on the internet with no authentication and you can see there are even the versions 2.0 so that's kind of",
    "start": "709019",
    "end": "718579"
  },
  {
    "text": "interesting fact and the the reason for that is obviously because it inherited the configurations",
    "start": "718579",
    "end": "724800"
  },
  {
    "text": "and also sometimes you know you know the the feeling you",
    "start": "724800",
    "end": "730320"
  },
  {
    "text": "upgrade something and it slowly works it's not working so you just change the configuration and",
    "start": "730320",
    "end": "736740"
  },
  {
    "text": "allow all again if we speak",
    "start": "736740",
    "end": "743060"
  },
  {
    "text": "these 32 000 of servers on the internet open then it went up in 2020 there was",
    "start": "744600",
    "end": "753240"
  },
  {
    "text": "like 85 000 already and then I got lazy and in 2021 a lot of",
    "start": "753240",
    "end": "760500"
  },
  {
    "text": "things happened for me so I skipped that year to simple so I did that this year",
    "start": "760500",
    "end": "768060"
  },
  {
    "text": "wow if I were a marketing person I would say see I told you so but this is this",
    "start": "768060",
    "end": "775680"
  },
  {
    "text": "is not possible right I was digging into a data why is this even possible",
    "start": "775680",
    "end": "782279"
  },
  {
    "text": "and the thing is there is one country causing this",
    "start": "782279",
    "end": "787320"
  },
  {
    "text": "anomaly and that's a South Korea that's interesting",
    "start": "787320",
    "end": "792660"
  },
  {
    "text": "uh particularly One ESP and also the versions of the mqt are",
    "start": "792660",
    "end": "800399"
  },
  {
    "text": "actually the brands of mqtt implementation uh is just mqtt because there is no fingerprint and The Showdown",
    "start": "800399",
    "end": "807060"
  },
  {
    "text": "can't tell you what kind of mqtt server it is and it it turned out actually that",
    "start": "807060",
    "end": "812160"
  },
  {
    "text": "this can be another research for uh for us or at least for me because",
    "start": "812160",
    "end": "819240"
  },
  {
    "text": "that's interesting they are selling uh kind of all in one box for fiber optics",
    "start": "819240",
    "end": "825240"
  },
  {
    "text": "to homes and that box implements the mqtt server for unknown reasons because",
    "start": "825240",
    "end": "832139"
  },
  {
    "text": "if you connect to it there is no data flowing it just sits there it's open but",
    "start": "832139",
    "end": "837600"
  },
  {
    "text": "you can publish to it you can subscribe to it you can store to it so you can possibly store your own data there",
    "start": "837600",
    "end": "846380"
  },
  {
    "text": "so I fixed the chart so I subtracted the South Korea and now it makes more sense",
    "start": "846420",
    "end": "852720"
  },
  {
    "text": "you can see it keeps the trend but what's more interesting is that there is a slight",
    "start": "852720",
    "end": "860820"
  },
  {
    "text": "shift in open servers on the internet so it went actually a bit down and that's",
    "start": "860820",
    "end": "866399"
  },
  {
    "text": "maybe because of the mosquito version 2. so let's hop on the train uh I will show",
    "start": "866399",
    "end": "873540"
  },
  {
    "text": "you few use cases which are bad but",
    "start": "873540",
    "end": "879120"
  },
  {
    "text": "at least you'll get the feeling why the situation is bad so this is like a typical implementation if you have some",
    "start": "879120",
    "end": "885600"
  },
  {
    "text": "mqtt broker for example in home automation it sits just in the middle",
    "start": "885600",
    "end": "890820"
  },
  {
    "text": "there is some business logic which is usually the automation itself so very popular is for example home assistant",
    "start": "890820",
    "end": "897360"
  },
  {
    "text": "probably many of you know and then there is done some bridging so the idea is to",
    "start": "897360",
    "end": "904260"
  },
  {
    "text": "bridge all the devices you have from different vendors or even data from from cloud services into mqtt so everything",
    "start": "904260",
    "end": "911160"
  },
  {
    "text": "speaks and qtt and it's easy for the devices and cloud services to cooperate",
    "start": "911160",
    "end": "916320"
  },
  {
    "text": "in case of a devices so that would be smart light bulb or switch",
    "start": "916320",
    "end": "922160"
  },
  {
    "text": "it even Bridges the technology so Bluetooth low energy",
    "start": "922160",
    "end": "928220"
  },
  {
    "text": "zigbee whatever comes to your mind so this is like a typical typical model",
    "start": "928220",
    "end": "933720"
  },
  {
    "text": "and implementation but there is one problem if you don't",
    "start": "933720",
    "end": "939420"
  },
  {
    "text": "set up the mqtt properly if you don't use the ACL list you are creating a huge",
    "start": "939420",
    "end": "945959"
  },
  {
    "text": "huge security hole because you are basically breaking the borders between the parameters because if if anything",
    "start": "945959",
    "end": "952860"
  },
  {
    "text": "can speak to anything there is no borders we've seen also this implementation so",
    "start": "952860",
    "end": "960000"
  },
  {
    "text": "the mqtt server is running on some public-facing VPS servers and everything is connected to it it from the security",
    "start": "960000",
    "end": "967320"
  },
  {
    "text": "standpoint it really doesn't matter because all these two situations are are pretty bad",
    "start": "967320",
    "end": "974160"
  },
  {
    "text": "so this would be my first recommendation always set credentials",
    "start": "974160",
    "end": "980519"
  },
  {
    "text": "always use ACL in the case of mqtt and if possible use TLS",
    "start": "980519",
    "end": "987120"
  },
  {
    "text": "you will see this slide once more maybe twice more",
    "start": "987120",
    "end": "992220"
  },
  {
    "text": "so this is one use case for example and it's a case of what we call data",
    "start": "992220",
    "end": "998100"
  },
  {
    "text": "poisoning uh actually there is there is no issue this is some BTS station somewhere in Serbia",
    "start": "998100",
    "end": "1005139"
  },
  {
    "text": "spinning out the data or a Telemetry data through the mqtt server to Republic internet like",
    "start": "1005139",
    "end": "1011839"
  },
  {
    "text": "I know it's bad it's leaking data for example uh part of the data is uh like",
    "start": "1011839",
    "end": "1017959"
  },
  {
    "text": "numbers of key cards being used to access the BTS station through the electric Rock",
    "start": "1017959",
    "end": "1024140"
  },
  {
    "text": "but still it's just like Telemetry you can't really control anything through that open mqtt server but the problem is",
    "start": "1024140",
    "end": "1031339"
  },
  {
    "text": "if you don't set up ACL the data is still read write so if an",
    "start": "1031339",
    "end": "1037100"
  },
  {
    "text": "attacker connects to This Server he can easily poison the data he can change the",
    "start": "1037100",
    "end": "1044540"
  },
  {
    "text": "Telemetry and that could be a huge problem for example the snapshot from the camera is updated By The Station",
    "start": "1044540",
    "end": "1050840"
  },
  {
    "text": "once a minute if you going to update it every second",
    "start": "1050840",
    "end": "1056840"
  },
  {
    "text": "you can overwrite basically and poison poison the data on the telemetry",
    "start": "1056840",
    "end": "1062480"
  },
  {
    "text": "another application or another use case is application called ontracks that's Android iOS application often used by",
    "start": "1062480",
    "end": "1070700"
  },
  {
    "text": "home automation or just to basically share your geolocation with the rest members of your family or or with the",
    "start": "1070700",
    "end": "1078440"
  },
  {
    "text": "whole automation so the automation knows where you are that's all good the",
    "start": "1078440",
    "end": "1084200"
  },
  {
    "text": "problem is it speaks to mqtt and many users connected to mqtt that is open to",
    "start": "1084200",
    "end": "1090260"
  },
  {
    "text": "the internet in that case you have a life stream or live feed as an attacker about",
    "start": "1090260",
    "end": "1097640"
  },
  {
    "text": "when the user is and you can easily record it over a period of week in this",
    "start": "1097640",
    "end": "1104240"
  },
  {
    "text": "case and deduce some let's say Behavior you can find out where his house is so",
    "start": "1104240",
    "end": "1112160"
  },
  {
    "text": "this is this is really bad as well if you look Showdown and basically search for ontracks topics you",
    "start": "1112160",
    "end": "1120200"
  },
  {
    "text": "will you will see a lot of devices or a lot of mqtt servers out there with this",
    "start": "1120200",
    "end": "1125299"
  },
  {
    "text": "topic a pretty unique thing is this application that's again for Android iOS",
    "start": "1125299",
    "end": "1130880"
  },
  {
    "text": "I think maybe just for Android and the idea here is you can create your own",
    "start": "1130880",
    "end": "1136100"
  },
  {
    "text": "dashboard to control something through mqtt but what is unique in this case is that",
    "start": "1136100",
    "end": "1142460"
  },
  {
    "text": "the configuration of the dashboard including all the scripts all the basically tweaking you did it stored",
    "start": "1142460",
    "end": "1150440"
  },
  {
    "text": "into a one big Json file which is published to the same mqtt server and stored there as a result topic so if you",
    "start": "1150440",
    "end": "1158299"
  },
  {
    "text": "are attacker you just connect to a server consume these topics or consume",
    "start": "1158299",
    "end": "1164000"
  },
  {
    "text": "this topic and you will have the exact copy of the dashboard of someone else",
    "start": "1164000",
    "end": "1169280"
  },
  {
    "text": "and you can really use it right so again all these things all these use",
    "start": "1169280",
    "end": "1176900"
  },
  {
    "text": "cases can be mitigated just by setting the credentials and using ACLs possibly",
    "start": "1176900",
    "end": "1183260"
  },
  {
    "text": "use TLS as well now let's see how we can change the train so how we can actually reach out",
    "start": "1183260",
    "end": "1190820"
  },
  {
    "text": "to devices that are not connected to ethernet or Wi-Fi I prepared I didn't want to mess with",
    "start": "1190820",
    "end": "1199220"
  },
  {
    "text": "someone's devices so I prepared a short demo uh we will be speaking about the",
    "start": "1199220",
    "end": "1204620"
  },
  {
    "text": "open source firmware which is quite common as well in home automation the",
    "start": "1204620",
    "end": "1210080"
  },
  {
    "text": "idea behind this open source firmware is that you can create your own device which speaks mqtt on one side that's",
    "start": "1210080",
    "end": "1219380"
  },
  {
    "text": "handy for the home automation systems and different Technologies on the other",
    "start": "1219380",
    "end": "1224780"
  },
  {
    "text": "side so Bluetooth low energy Laura GSM GPRS however you can configure the",
    "start": "1224780",
    "end": "1230059"
  },
  {
    "text": "firmware and the problem here is usually with the",
    "start": "1230059",
    "end": "1235700"
  },
  {
    "text": "Bluetooth low energy it's used for a kind of and how to call it it's like a",
    "start": "1235700",
    "end": "1244059"
  },
  {
    "text": "presence control or presence detection so it basically scans its surroundings",
    "start": "1244059",
    "end": "1249860"
  },
  {
    "text": "with the ble and uses that for uh for",
    "start": "1249860",
    "end": "1255320"
  },
  {
    "text": "the automation to know that the particle person or device is in the reach so you",
    "start": "1255320",
    "end": "1260780"
  },
  {
    "text": "are at home or you are in some room that's that's basically the idea behind it but the advanced future feature of of",
    "start": "1260780",
    "end": "1268340"
  },
  {
    "text": "this firmware is also that it's able or capable to write and if anything is able to write what",
    "start": "1268340",
    "end": "1275840"
  },
  {
    "text": "could go wrong right it's done in a kind of",
    "start": "1275840",
    "end": "1282140"
  },
  {
    "text": "not very intuitive way but this alone is just enough to write to",
    "start": "1282140",
    "end": "1288320"
  },
  {
    "text": "some ble device so you just need to send to a topic which ends with Slash config",
    "start": "1288320",
    "end": "1294140"
  },
  {
    "text": "that's the counter-intuitive part Json which includes the address the Bluetooth",
    "start": "1294140",
    "end": "1300320"
  },
  {
    "text": "address or Mac address if you wish then The UU IDs of the service and the ID of",
    "start": "1300320",
    "end": "1306080"
  },
  {
    "text": "the particle property you you want to write and then the payload and that's it so if",
    "start": "1306080",
    "end": "1312380"
  },
  {
    "text": "you find this topic on the internet on the open server you can scan the the surrounding of the",
    "start": "1312380",
    "end": "1320659"
  },
  {
    "text": "device and you can even control the devices so meet a unicorn board that's a that's",
    "start": "1320659",
    "end": "1327140"
  },
  {
    "text": "a toy I brought back from us when I was there uh it's a Lego like toy uh it has",
    "start": "1327140",
    "end": "1336260"
  },
  {
    "text": "a RGB horn few servos and it speaks ble",
    "start": "1336260",
    "end": "1341360"
  },
  {
    "text": "so let's put aside that I had to reverse the communication protocol before but",
    "start": "1341360",
    "end": "1348919"
  },
  {
    "text": "I will show you on this toy how easy is to control the ble device using that qtt",
    "start": "1348919",
    "end": "1355880"
  },
  {
    "text": "through that Gateway so you can see the Unicorn bolt sitting on the table and next to it there is",
    "start": "1355880",
    "end": "1362480"
  },
  {
    "text": "kind of a monitor of what's going on on a mqtt topic open mqtt Gateway BH",
    "start": "1362480",
    "end": "1369400"
  },
  {
    "text": "so we can see how the data is flowing",
    "start": "1369400",
    "end": "1374480"
  },
  {
    "text": "and a terminal down there or fell so I prepared few payloads that I'm",
    "start": "1374480",
    "end": "1382280"
  },
  {
    "text": "going to send through just the mqtt through that open nqtt gateway to ble",
    "start": "1382280",
    "end": "1388220"
  },
  {
    "text": "device so you you can see the data flowing",
    "start": "1388220",
    "end": "1393980"
  },
  {
    "text": "through the mqtt and the Unicorn bot reacts that funny case and it's it's uh it's",
    "start": "1393980",
    "end": "1403340"
  },
  {
    "text": "let's say not nothing serious but I can tell you that for",
    "start": "1403340",
    "end": "1409400"
  },
  {
    "text": "example this story is also able to update a firmware uh over the ble and",
    "start": "1409400",
    "end": "1415340"
  },
  {
    "text": "there is no check",
    "start": "1415340",
    "end": "1417940"
  },
  {
    "text": "now let's move to another open source framework which is like widely adopted",
    "start": "1421039",
    "end": "1426620"
  },
  {
    "text": "around around the globe and that's a task go down like the transmoda firmware itself it's an open source it's a great",
    "start": "1426620",
    "end": "1433100"
  },
  {
    "text": "firmware it supports a lot of devices and basic idea is to replace a firmware",
    "start": "1433100",
    "end": "1439520"
  },
  {
    "text": "or to be able to replace a firm virus on iot devices to break them free from",
    "start": "1439520",
    "end": "1444919"
  },
  {
    "text": "their original cloud so usually you buy a bunch of devices from different vendors all these devices they have like",
    "start": "1444919",
    "end": "1452299"
  },
  {
    "text": "their own cloud and the problem is to control them or even to keep your data",
    "start": "1452299",
    "end": "1458720"
  },
  {
    "text": "private so break the ties between the clouds you need to somehow modify them and that's when the test motor comes in",
    "start": "1458720",
    "end": "1467539"
  },
  {
    "text": "actually it supports pretty impressive number of iot devices it's right now",
    "start": "1467539",
    "end": "1473000"
  },
  {
    "text": "it's like two and a half thousand devices from different vendors and the support means you can Flash the firmware",
    "start": "1473000",
    "end": "1479960"
  },
  {
    "text": "uh over the original one and then you'll get a lot of new features the smaller",
    "start": "1479960",
    "end": "1485780"
  },
  {
    "text": "itself has a rest API and also speaks mqtt",
    "start": "1485780",
    "end": "1491799"
  },
  {
    "text": "and there are a few interesting comments and features of the dasmata one of them",
    "start": "1492200",
    "end": "1497480"
  },
  {
    "text": "could be group topic so basically when you install the firmware every device is",
    "start": "1497480",
    "end": "1503360"
  },
  {
    "text": "by default in a its name like a like by a group topic which is tasmatas so you can ask",
    "start": "1503360",
    "end": "1511159"
  },
  {
    "text": "all tasmodas in your network to update the firmware for example or to turn on",
    "start": "1511159",
    "end": "1516620"
  },
  {
    "text": "and because it's a default group topic it stays like that",
    "start": "1516620",
    "end": "1521440"
  },
  {
    "text": "again short demonstration I found out one server this is a real server so I",
    "start": "1521780",
    "end": "1528260"
  },
  {
    "text": "I was trying to hide the IP address and it has a lot of transmoga devices on it",
    "start": "1528260",
    "end": "1536260"
  },
  {
    "text": "the application I'm using it's mqtt Explorer it's a very handy tool so you",
    "start": "1536679",
    "end": "1542659"
  },
  {
    "text": "can see there are the topics and the start topic is actually a transmitter topic on which the task model publishes",
    "start": "1542659",
    "end": "1550039"
  },
  {
    "text": "statuses of devices you can see there is around 57 topics under under that node",
    "start": "1550039",
    "end": "1557299"
  },
  {
    "text": "and if I issue the command status for cosmopas with zero that means give me",
    "start": "1557299",
    "end": "1562820"
  },
  {
    "text": "all statuses for all devices and right now you have all the configurations uh from the devices in",
    "start": "1562820",
    "end": "1571039"
  },
  {
    "text": "the whole network or actually in all devices that are connected and for example part of the configuration is",
    "start": "1571039",
    "end": "1578600"
  },
  {
    "text": "IP address of default gateway DNS server ssids and so on",
    "start": "1578600",
    "end": "1584900"
  },
  {
    "text": "so this is how how easy is to use the group topic to animation of all the devices",
    "start": "1584900",
    "end": "1592580"
  },
  {
    "text": "there is one particularly interesting command which is website that has been replaced by a web query which is even",
    "start": "1592580",
    "end": "1599059"
  },
  {
    "text": "more powerful in new versions and the basic idea is to be able from the device",
    "start": "1599059",
    "end": "1604159"
  },
  {
    "text": "create a HTTP get the request to control something else so the original idea was",
    "start": "1604159",
    "end": "1612039"
  },
  {
    "text": "another device using rest API but there is no check you can ask any server for",
    "start": "1612039",
    "end": "1620419"
  },
  {
    "text": "for HTTP request so if you combine these two features",
    "start": "1620419",
    "end": "1625580"
  },
  {
    "text": "you can easily create a DDOS right this is just a details on a small scale",
    "start": "1625580",
    "end": "1630799"
  },
  {
    "text": "so I'm running the HTTP server on my own server and then using the previous",
    "start": "1630799",
    "end": "1637000"
  },
  {
    "text": "mqtt server I found with a lot of transmitters by just issuing one command",
    "start": "1637000",
    "end": "1642860"
  },
  {
    "text": "I'm getting all requests from all the devices at the same time",
    "start": "1642860",
    "end": "1650440"
  },
  {
    "text": "so this is example how you can misuse just open mqtt connection",
    "start": "1651500",
    "end": "1659360"
  },
  {
    "text": "and we are getting uh to the end of the presentation and now I will show you how",
    "start": "1659360",
    "end": "1666380"
  },
  {
    "text": "easy is to misuse the m just the mqtt with anything else to break someone's",
    "start": "1666380",
    "end": "1674419"
  },
  {
    "text": "perimeter to get inside the perimeter for that we will need a transmitter any",
    "start": "1674419",
    "end": "1681620"
  },
  {
    "text": "transmute a device you can find on like hanging on on imqtd server there are",
    "start": "1681620",
    "end": "1688340"
  },
  {
    "text": "actually two commands and because there is no fine-grained access control uh you",
    "start": "1688340",
    "end": "1693799"
  },
  {
    "text": "can easily issue a comment through mqtt which sets the URL",
    "start": "1693799",
    "end": "1698900"
  },
  {
    "text": "from where the device will take the update of firmware that's the OTA URL then you can issue",
    "start": "1698900",
    "end": "1707179"
  },
  {
    "text": "the upgrade comment as well which basically is the trigger to do the update if you put there one as a payload",
    "start": "1707179",
    "end": "1714919"
  },
  {
    "text": "it ignores the version check so it basically downloads whatever you set in",
    "start": "1714919",
    "end": "1720200"
  },
  {
    "text": "a first instance and like happily update the the whole device",
    "start": "1720200",
    "end": "1727179"
  },
  {
    "text": "so let's make some plan uh we are going to misuse one Infamous device which is",
    "start": "1727220",
    "end": "1734480"
  },
  {
    "text": "the microtic routers probably you heard many cves around",
    "start": "1734480",
    "end": "1740059"
  },
  {
    "text": "um microtic and research we are going to misuse the one particle CDE which is",
    "start": "1740059",
    "end": "1746059"
  },
  {
    "text": "able to enumerate all the user accounts and the passwords from the device and",
    "start": "1746059",
    "end": "1752600"
  },
  {
    "text": "because the router in this case is closed from the outside like from the internet we will do that from the inside",
    "start": "1752600",
    "end": "1761360"
  },
  {
    "text": "we have the mqtt server in this perimeter it really doesn't matter if it's out of the perimeter or if it's",
    "start": "1761360",
    "end": "1767720"
  },
  {
    "text": "inside and then we have one smart switch which runs the model",
    "start": "1767720",
    "end": "1774039"
  },
  {
    "text": "so the whole thing works like this we upload the Rogue firmware remember",
    "start": "1774320",
    "end": "1781159"
  },
  {
    "text": "it's an open source it's very easy to create your own firmware because it's open source you can just change few",
    "start": "1781159",
    "end": "1787279"
  },
  {
    "text": "lines and create a new version which you can upload wherever you want",
    "start": "1787279",
    "end": "1793580"
  },
  {
    "text": "then through the mqtt these two commands I've shown you on on a previous slide we",
    "start": "1793580",
    "end": "1800779"
  },
  {
    "text": "will trigger the over-the-air update that leads to a device getting its",
    "start": "1800779",
    "end": "1808760"
  },
  {
    "text": "update from our server or from server that we control and it gets extended with the new",
    "start": "1808760",
    "end": "1815419"
  },
  {
    "text": "functionality so we have a transmuta that is able to speak generic TCP mqtt",
    "start": "1815419",
    "end": "1822500"
  },
  {
    "text": "to TCP proxy then we run at the at the computer of",
    "start": "1822500",
    "end": "1828380"
  },
  {
    "text": "attacker the counterpart which transforms the TCP to mqtt decrements",
    "start": "1828380",
    "end": "1835039"
  },
  {
    "text": "the tunnel is created and then we can happily run the CV",
    "start": "1835039",
    "end": "1841039"
  },
  {
    "text": "exploit through the tunnel that's pretty easy",
    "start": "1841039",
    "end": "1846380"
  },
  {
    "text": "and actually it is less easy these are the devices we are going to",
    "start": "1846380",
    "end": "1851600"
  },
  {
    "text": "exploit just as just for you to have like the physical",
    "start": "1851600",
    "end": "1856960"
  },
  {
    "text": "uh physical look of the devices so that's the switch",
    "start": "1856960",
    "end": "1862100"
  },
  {
    "text": "and the microtic router and this is the only thing we had to do",
    "start": "1862100",
    "end": "1867500"
  },
  {
    "text": "in a firmware we added three new commands TCP connect TCP send and TCP",
    "start": "1867500",
    "end": "1873320"
  },
  {
    "text": "close then we modified the main Loop which processes the data and that was it it's like 20 lines of",
    "start": "1873320",
    "end": "1881960"
  },
  {
    "text": "code maybe altogether and this is a demo of uh the first step",
    "start": "1881960",
    "end": "1890419"
  },
  {
    "text": "updating the firmware so the our Rogue server where the",
    "start": "1890419",
    "end": "1898640"
  },
  {
    "text": "dasmota and the Rogue firmware is located then using again just the",
    "start": "1898640",
    "end": "1906559"
  },
  {
    "text": "mqtt to publish into open mqtt server which resides inside the perimeter",
    "start": "1906559",
    "end": "1913659"
  },
  {
    "text": "we are going to issue the demo switch which is the name of the device and the",
    "start": "1913659",
    "end": "1920120"
  },
  {
    "text": "command OTA URL without any payload that gets us",
    "start": "1920120",
    "end": "1925179"
  },
  {
    "text": "a current configuration so this is the default configuration for dust mode",
    "start": "1925179",
    "end": "1930320"
  },
  {
    "text": "affirmware update URL now we issue the same command and as a",
    "start": "1930320",
    "end": "1935840"
  },
  {
    "text": "payload we'll put our malicious URL so if everything works we should get a",
    "start": "1935840",
    "end": "1945440"
  },
  {
    "text": "kind of result from the test motor or which which says that that the address",
    "start": "1945440",
    "end": "1952940"
  },
  {
    "text": "changed",
    "start": "1952940",
    "end": "1955600"
  },
  {
    "text": "okay so here we go you can see replied that the result is the new OTA",
    "start": "1959480",
    "end": "1968480"
  },
  {
    "text": "URL now I'm running the server to actually serve that file from the server",
    "start": "1968480",
    "end": "1976039"
  },
  {
    "text": "and now I'm going to issue the command to upgrade as I said we need to provide",
    "start": "1976039",
    "end": "1981380"
  },
  {
    "text": "the payload with one which means take whatever is there no version checks",
    "start": "1981380",
    "end": "1988600"
  },
  {
    "text": "yeah and you can see the request is being made from the task motor to a",
    "start": "1991940",
    "end": "1996980"
  },
  {
    "text": "rogue server for the firmware the device goes offline now the update is taking place so it shortly goes online again",
    "start": "1996980",
    "end": "2004860"
  },
  {
    "text": "and do the final restart so from now on the device",
    "start": "2004860",
    "end": "2010860"
  },
  {
    "text": "you you would probably even notice that the device restart restarted itself",
    "start": "2010860",
    "end": "2017080"
  },
  {
    "text": "so from now on the device is extended with that functionality that talks mqtt to TCP",
    "start": "2017080",
    "end": "2024360"
  },
  {
    "text": "the next stage is actually to to attack the router we",
    "start": "2024640",
    "end": "2030340"
  },
  {
    "text": "need to know the IP address of it and we can Leverage The plasmoda again we can leverage the command for getting the",
    "start": "2030340",
    "end": "2037600"
  },
  {
    "text": "status of the device which contains the the configuration of a network",
    "start": "2037600",
    "end": "2044200"
  },
  {
    "text": "from there there will be probably a default gateway and we can assume that the default gateway will be the router",
    "start": "2044200",
    "end": "2050858"
  },
  {
    "text": "IP address so let's do that",
    "start": "2050859",
    "end": "2055319"
  },
  {
    "text": "so now you can see the dasmota replied back and there is a gateway address",
    "start": "2063580",
    "end": "2068980"
  },
  {
    "text": "which is presumably the IP address of the of the microtic router",
    "start": "2068980",
    "end": "2074858"
  },
  {
    "text": "so now the only thing we need to do is run our proxy script which takes the",
    "start": "2074859",
    "end": "2083740"
  },
  {
    "text": "mqtt server then the local Port it we will listen on which is 10 000 in this",
    "start": "2083740",
    "end": "2089500"
  },
  {
    "text": "case then the target IP address and the Target Port in case of the windbox vulnerability the Target Port is 8291",
    "start": "2089500",
    "end": "2097300"
  },
  {
    "text": "which is the interface for the winbox management protocol and the name of the plasmota device again",
    "start": "2097300",
    "end": "2103780"
  },
  {
    "text": "so we are ready and the only thing we need to issue is now is to run the exploit I have the version for python",
    "start": "2103780",
    "end": "2111700"
  },
  {
    "text": "here so it's pretty easy you run the exploit with the target of localhost and",
    "start": "2111700",
    "end": "2117040"
  },
  {
    "text": "the local board the proxy is listening on",
    "start": "2117040",
    "end": "2121680"
  },
  {
    "text": "so now you can you will see that the exchange of data is happening and we",
    "start": "2124180",
    "end": "2129820"
  },
  {
    "text": "successfully run the exploit and we've got all the usernames and passwords for",
    "start": "2129820",
    "end": "2136060"
  },
  {
    "text": "that particular router which is inside the perimeter we didn't like access anything from the outside",
    "start": "2136060",
    "end": "2142960"
  },
  {
    "text": "and using the same proxy we can now leverage all we know already",
    "start": "2142960",
    "end": "2148720"
  },
  {
    "text": "to actually connect to the router through that proxy",
    "start": "2148720",
    "end": "2153540"
  },
  {
    "text": "so you can say I'm again connecting to localhost Port 10 000 and I'm using the",
    "start": "2158619",
    "end": "2165280"
  },
  {
    "text": "already exposed credentials to connect to the router",
    "start": "2165280",
    "end": "2170579"
  },
  {
    "text": "the exchange of data is happening through the mqtt",
    "start": "2172180",
    "end": "2176640"
  },
  {
    "text": "and you can see I have a full control of the router and I can do whatever I want",
    "start": "2180940",
    "end": "2186640"
  },
  {
    "text": "to open the parts or add user whatever so that's how easy it is to proxate",
    "start": "2186640",
    "end": "2194920"
  },
  {
    "text": "traffic in someone's perimeter just using the mqtt",
    "start": "2194920",
    "end": "2199680"
  },
  {
    "text": "so what to say uh at the end [Music]",
    "start": "2203079",
    "end": "2209920"
  },
  {
    "text": "I promised you will see this often uh in case of mqtt this is really",
    "start": "2209920",
    "end": "2215140"
  },
  {
    "text": "crucial and especially the part using the ACL because nobody really sets the",
    "start": "2215140",
    "end": "2221440"
  },
  {
    "text": "fine-grained access control in mqtt servers and it's a mess and it's a huge",
    "start": "2221440",
    "end": "2227380"
  },
  {
    "text": "security risk because you can update firmware for example that's not only the case",
    "start": "2227380",
    "end": "2235359"
  },
  {
    "text": "always secure your mqtt ideally don't put it on the internet use VPN if you if",
    "start": "2235359",
    "end": "2241900"
  },
  {
    "text": "you must because the risk would be sometimes High",
    "start": "2241900",
    "end": "2248400"
  },
  {
    "text": "it's turned out that that the mqtt is very very well suited for automation of",
    "start": "2249220",
    "end": "2255400"
  },
  {
    "text": "your garden okay so that's it thank you for your",
    "start": "2255400",
    "end": "2262480"
  },
  {
    "text": "attention I'm ready to take questions actually it went pretty good we still",
    "start": "2262480",
    "end": "2268660"
  },
  {
    "text": "have like six minutes if if I sit correctly so there is a GitHub report that's going",
    "start": "2268660",
    "end": "2275619"
  },
  {
    "text": "to be the part of of the website of blackheads or you can",
    "start": "2275619",
    "end": "2282460"
  },
  {
    "text": "you can go there uh I put there all the scripts I've used for for the demo uh",
    "start": "2282460",
    "end": "2288220"
  },
  {
    "text": "the only thing I didn't put there is the source code for the modification of a tasmota I don't want to get in any",
    "start": "2288220",
    "end": "2296320"
  },
  {
    "text": "trouble but there is a binary if you wish so any questions",
    "start": "2296320",
    "end": "2304140"
  },
  {
    "text": "so in that case thank you for your attention [Applause]",
    "start": "2307780",
    "end": "2318540"
  },
  {
    "text": "[Music]",
    "start": "2318540",
    "end": "2321659"
  },
  {
    "text": "[Music]",
    "start": "2325510",
    "end": "2328599"
  }
]