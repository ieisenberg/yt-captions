[
  {
    "text": "all right awesome yeah thank you all for coming uh we're going to talk about some cool Hardware hacks today um let's start",
    "start": "2520",
    "end": "9240"
  },
  {
    "text": "with myself who am I my name is Thomas Roth AKA stack smashing um I'm a security researcher with a lot of focus",
    "start": "9240",
    "end": "16000"
  },
  {
    "text": "on hardware and firmware uh and I'm also a CO co-founder at hack street. where we",
    "start": "16000",
    "end": "21160"
  },
  {
    "text": "try to teach you know Hardware hacking and other security stuff you can find me on Twitter at gidra ninja and also on",
    "start": "21160",
    "end": "28759"
  },
  {
    "text": "YouTube and as always you know when you do research you buildt on top of others",
    "start": "28759",
    "end": "34840"
  },
  {
    "text": "right and so there are a ton of people that I need to thank whose work I'm I'm basing this off and so for example seusa",
    "start": "34840",
    "end": "41840"
  },
  {
    "text": "uh OE who built the Thunderbolt Patcher the aahi Linux team with without whose work this would all not be possible",
    "start": "41840",
    "end": "49039"
  },
  {
    "text": "Carlo Marano my my partner in crime and essentially the guy that I just vent to when something doesn't work yka Fabian",
    "start": "49039",
    "end": "55840"
  },
  {
    "text": "andaro um Mark Zen who built the central suit scrutinizer and also the t812 dev",
    "start": "55840",
    "end": "62879"
  },
  {
    "text": "team who laid a lot of the groundwork for what you're about to see now as always with research there's",
    "start": "62879",
    "end": "69439"
  },
  {
    "text": "a bit of a backstory and so essentially the iPhone used to have this you know",
    "start": "69439",
    "end": "75119"
  },
  {
    "text": "proprietary connector called lightning and lightning was you know nice for some",
    "start": "75119",
    "end": "80240"
  },
  {
    "text": "obvious stuff you could do charging via it you could transfer your photos via USB you could do video audio all that",
    "start": "80240",
    "end": "86119"
  },
  {
    "text": "kind of stuff um what what a lot of people don't know is that like lightning also does a lot of cool stuff so for",
    "start": "86119",
    "end": "92320"
  },
  {
    "text": "example you can do jte via lightning uart and also a protocol called sdq",
    "start": "92320",
    "end": "97880"
  },
  {
    "text": "which controls all of this and a couple of years ago I guess like two years by now we uh created an open source adapter",
    "start": "97880",
    "end": "104719"
  },
  {
    "text": "that lets you talk all of these things via lightning and we called it The Tamarind cable and so essentially it's a",
    "start": "104719",
    "end": "111360"
  },
  {
    "text": "small raspberry pipe PECO firmware you just solder on a lightning extension and then you can play with you know um",
    "start": "111360",
    "end": "118719"
  },
  {
    "text": "lightning and jtech and all that kind of stuff unfortunately uh Apple decided to",
    "start": "118719",
    "end": "124320"
  },
  {
    "text": "throw all of my work into the garbage because they USBC to iPhone",
    "start": "124320",
    "end": "130399"
  },
  {
    "text": "15 it enables charging transferring data playing audio and",
    "start": "130400",
    "end": "136040"
  },
  {
    "text": "video Unfortunately they didn't list all the cool stuff you could do with lightning right like what about jtech",
    "start": "136040",
    "end": "142480"
  },
  {
    "text": "what about Ur like who cares about data um but I mean if you think about it USB",
    "start": "142480",
    "end": "150040"
  },
  {
    "text": "has a ton of pins right like there's a ton of pins and it's likely that you can somehow still get some alternative",
    "start": "150040",
    "end": "156800"
  },
  {
    "text": "functionality on one of those pins and you know the YouTube comments were",
    "start": "156800",
    "end": "162200"
  },
  {
    "text": "harassing me to try this on the iPhone 15 with USBC and this got me thinking",
    "start": "162200",
    "end": "167640"
  },
  {
    "text": "like essentially the iPhone 15 is not the first Apple device with USBC right the laptops the iPads and so on they've",
    "start": "167640",
    "end": "174519"
  },
  {
    "text": "been USBC for years and USBC is a complex Beast essentially when you you",
    "start": "174519",
    "end": "179959"
  },
  {
    "text": "plug in a charger the USB controller in your MacBook and a chip in your charger",
    "start": "179959",
    "end": "187560"
  },
  {
    "text": "they communicate and they try to determine okay what voltage how much power and so on can you accept and this",
    "start": "187560",
    "end": "193560"
  },
  {
    "text": "is done over the configuration Channel pins on the USBC connector and the all",
    "start": "193560",
    "end": "199799"
  },
  {
    "text": "this communication is handled by a chip in your laptop it's the called the USBC",
    "start": "199799",
    "end": "205480"
  },
  {
    "text": "Port controller and if you open up your Macbook you can see them nicely very",
    "start": "205480",
    "end": "210879"
  },
  {
    "text": "close to all the USBC ports now microcontrollers run firmware and so",
    "start": "210879",
    "end": "216159"
  },
  {
    "text": "somebody on the uh on the old Intel MacBook still managed to dump that",
    "start": "216159",
    "end": "221439"
  },
  {
    "text": "firmware by just sold soldering on a couple of wires connecting a debugger and dumping the firmware uh This was",
    "start": "221439",
    "end": "227239"
  },
  {
    "text": "done by the tad2 de team and they didn't just dump the firmware they also reverse engineered it and they uncovered that on",
    "start": "227239",
    "end": "235400"
  },
  {
    "text": "this port controller there are a lot of Secrets and so essentially by using something called vdm or vendor defined",
    "start": "235400",
    "end": "242519"
  },
  {
    "text": "messages we can send custom commands to that microcontroller proprietary commands and they even reverse",
    "start": "242519",
    "end": "250319"
  },
  {
    "text": "engineered the protocol and so for example they found out that we can send the command hex 10 to get a list of all",
    "start": "250319",
    "end": "257160"
  },
  {
    "text": "actions um that that microcontroller supports and those actions are kind of cool because for example there's an",
    "start": "257160",
    "end": "263199"
  },
  {
    "text": "action with which we can switch some of the sideband use pins To Be A Serial",
    "start": "263199",
    "end": "268560"
  },
  {
    "text": "console and so suddenly we can just send a command to the USBC controller namely the command 3006 and then we get a",
    "start": "268560",
    "end": "276039"
  },
  {
    "text": "Serial console on USBC so that's pretty neat and on the MacBook itself that's",
    "start": "276039",
    "end": "282639"
  },
  {
    "text": "implemented in the following way we have the typc controller which we call Ace um",
    "start": "282639",
    "end": "288759"
  },
  {
    "text": "that's just the name that's in the firmware everywhere and there are different versions of Ace and so for example the Intel Max had an ace2 and",
    "start": "288759",
    "end": "296199"
  },
  {
    "text": "then the new uh the very new Max like the M3 Max and the iPhone they have the Ace",
    "start": "296199",
    "end": "302039"
  },
  {
    "text": "3 and there's there are a lot of connections between the system on a chip and the ace there's for example USB and",
    "start": "302039",
    "end": "308720"
  },
  {
    "text": "Thunderbolt obviously for USB data there's the seral console but then there's also jtec and so on engineering",
    "start": "308720",
    "end": "315479"
  },
  {
    "text": "devices you can actually JTAG the main CPU of the computer via USBC and there",
    "start": "315479",
    "end": "320880"
  },
  {
    "text": "are a lot more other protocols and so for example on the iPhone we even found spmi on the New Mex there's some new",
    "start": "320880",
    "end": "327160"
  },
  {
    "text": "stuff and so on and so forth the problem is how can we send those vdm messages if",
    "start": "327160",
    "end": "333280"
  },
  {
    "text": "we want to uh to play with this because essentially vdm is completely separate",
    "start": "333280",
    "end": "338479"
  },
  {
    "text": "from the regular USB communication and so we can't just you know use lip USB or whatever instead we need to use special",
    "start": "338479",
    "end": "346280"
  },
  {
    "text": "tooling and some very clever people figured out that the back left port on the MacBook Pro can actually send vdm",
    "start": "346280",
    "end": "353240"
  },
  {
    "text": "commands two other MacBooks and so you can actually debug one MacBook with another uh and so they built this tool",
    "start": "353240",
    "end": "359479"
  },
  {
    "text": "called called Mac vdm Tool which is really useful and also Mark Zen built a tool called the central scrutinizer",
    "start": "359479",
    "end": "365919"
  },
  {
    "text": "which is essentially a hardware adapter that sends those USB commands and allows you to then access the serial console",
    "start": "365919",
    "end": "372599"
  },
  {
    "text": "they use this for kernel development on the MacBook and so on and so forth now",
    "start": "372599",
    "end": "378240"
  },
  {
    "text": "we wanted a bit more than just seral we wanted to be able to B directionally talk to the hardware in the iPhone and",
    "start": "378240",
    "end": "384360"
  },
  {
    "text": "so on and so we forked the central scrutin ARA and built Tamarind C which is a central",
    "start": "384360",
    "end": "390400"
  },
  {
    "text": "a bidirectional apple USBC you know protocol Explorer it has a full jtech",
    "start": "390400",
    "end": "396240"
  },
  {
    "text": "probe integrated and so you can actually speak jtec without additional tooling it",
    "start": "396240",
    "end": "401319"
  },
  {
    "text": "can dump SPN spmi it can talk serial and all that kind of stuff and it works both",
    "start": "401319",
    "end": "407080"
  },
  {
    "text": "on the new MacBooks and on the iPhone and so this is how it looks on the iPhone 15 I've got my logic analyzer",
    "start": "407080",
    "end": "412919"
  },
  {
    "text": "connected here for debugging for more cables and so now we can using Tamarin C",
    "start": "412919",
    "end": "418680"
  },
  {
    "text": "we can for example will uh reset the device and get a Serial console and now",
    "start": "418680",
    "end": "424000"
  },
  {
    "text": "you can see on the right hand side that we get the boot output of the iPhone vs",
    "start": "424000",
    "end": "429360"
  },
  {
    "text": "serial and this is all open source and you can you know build your own or if you convince me I have a couple of pcvs",
    "start": "429360",
    "end": "435759"
  },
  {
    "text": "with me and I'm happy to to give you one now on Old MacBooks all of this was",
    "start": "435759",
    "end": "441120"
  },
  {
    "text": "handled by a chip called the ace2 now the A2 was essentially a Texas",
    "start": "441120",
    "end": "446319"
  },
  {
    "text": "Instruments WID labeled microcontroller and it's it has an arm core it's connected to the main CPU by",
    "start": "446319",
    "end": "452720"
  },
  {
    "text": "squ C and you can find it on all MacBooks starting with the t2 now the",
    "start": "452720",
    "end": "457840"
  },
  {
    "text": "ace2 is proprietary like it says CD 3217 on it but it's actually a custom version",
    "start": "457840",
    "end": "464919"
  },
  {
    "text": "of another Texas Instruments microcontroller essentially just with a different ROM in it and so luckily we",
    "start": "464919",
    "end": "471400"
  },
  {
    "text": "can find those data sheets and there's even some accidentally published material that explains a lot of the",
    "start": "471400",
    "end": "476919"
  },
  {
    "text": "commands and so on that you have um but but to really understand what's going on I had to again dump the firmware cuz you",
    "start": "476919",
    "end": "483639"
  },
  {
    "text": "know um I essentially opened up my M1 MacBook dump the firmware and started",
    "start": "483639",
    "end": "488879"
  },
  {
    "text": "reverse engineering it similar to what t812 team did but on new",
    "start": "488879",
    "end": "494280"
  },
  {
    "text": "hardware and after staring at all of this for a while I identified the",
    "start": "494280",
    "end": "499560"
  },
  {
    "text": "command Handler structure essentially we can send commands to the ace chip and",
    "start": "499560",
    "end": "506080"
  },
  {
    "text": "then it will do certain things and there are some interesting command here so for example there are commands such as",
    "start": "506080",
    "end": "511840"
  },
  {
    "text": "memory read memory write memory modify and so on that could potentially allow us to get code execution on this chip",
    "start": "511840",
    "end": "519159"
  },
  {
    "text": "unfortunately those are locked on a lot of um on a on all production systems essentially and so we can't use them",
    "start": "519159",
    "end": "525959"
  },
  {
    "text": "they are there but we can't use them so we need to do uh other stuff now this communication between the",
    "start": "525959",
    "end": "533519"
  },
  {
    "text": "ace and the system on a chip is on the hardware level i squ c but on MEC",
    "start": "533519",
    "end": "539200"
  },
  {
    "text": "there's actually an interface called Apple HPM bus or hostport microcontroller bus that we can use to",
    "start": "539200",
    "end": "545640"
  },
  {
    "text": "communicate with the Chip And so this is used by a couple of tools such as HPM",
    "start": "545640",
    "end": "551200"
  },
  {
    "text": "diagnos and so on and the commands that we can send to the a are so-called 4cc",
    "start": "551200",
    "end": "557720"
  },
  {
    "text": "commands so essentially we send a short four-digit string and then the chip will do something and so we actually open",
    "start": "557720",
    "end": "564800"
  },
  {
    "text": "source a tool for this called Ace Tool that allows you to communicate with these chips and so on",
    "start": "564800",
    "end": "569880"
  },
  {
    "text": "the reason I'm telling you this is because we get very important information from this tool which is the",
    "start": "569880",
    "end": "575640"
  },
  {
    "text": "boot status so we can measure whether the ace booted successfully whether it's stuck in boot",
    "start": "575640",
    "end": "581720"
  },
  {
    "text": "loader or whether it's corrupted and went into dfu mode this will be important later when we try to attack",
    "start": "581720",
    "end": "588000"
  },
  {
    "text": "the chip now the chip as mentioned has an integrated rum that it boots from and so",
    "start": "588000",
    "end": "594320"
  },
  {
    "text": "on but it also has an external spy Flash and the one we can dump",
    "start": "594320",
    "end": "600160"
  },
  {
    "text": "interestingly when you have multiple USBC ports you also will have multiple Ace chips and it turns out that they",
    "start": "600160",
    "end": "606399"
  },
  {
    "text": "actually boot from each other and so they are essentially chained together so only one has a flashh and then it sends",
    "start": "606399",
    "end": "611920"
  },
  {
    "text": "its firmware to the others but the Spy flashh does not actually contain the",
    "start": "611920",
    "end": "617279"
  },
  {
    "text": "full firmware instead it just contains small patches for the internal ROM and this makes reverse engineering this",
    "start": "617279",
    "end": "623640"
  },
  {
    "text": "firmware terribly annoying and so for example if you have a function call in",
    "start": "623640",
    "end": "628680"
  },
  {
    "text": "the disassem simply then that function call goes to another function that function then",
    "start": "628680",
    "end": "635240"
  },
  {
    "text": "retrieves a pointer from Ram that determines whether it's patched or not and and then we actually go to the",
    "start": "635240",
    "end": "643040"
  },
  {
    "text": "actual function that we jump to either in a patched version or in the ROM and if you have this loaded in binary ninja",
    "start": "643040",
    "end": "649639"
  },
  {
    "text": "it essentially breaks all cross references and so on and so forth It's terribly annoying so we also published a",
    "start": "649639",
    "end": "655040"
  },
  {
    "text": "couple of scripts to make this easier and fix all of that um but there are thousands of of these types of functions",
    "start": "655040",
    "end": "662240"
  },
  {
    "text": "and so it's really really a pain to work with now this chip is also getting",
    "start": "662240",
    "end": "668240"
  },
  {
    "text": "updates in the field and so if you have an M1 Mac for example you can find a tool called USB firmware flasher uh on",
    "start": "668240",
    "end": "675160"
  },
  {
    "text": "your device unfortunately these updates are protected using RSA uh",
    "start": "675160",
    "end": "682720"
  },
  {
    "text": "372 however there's one thing here that signature is only checked during updates",
    "start": "682720",
    "end": "688720"
  },
  {
    "text": "and so there's no actual CQ boot so if you find code execution you get",
    "start": "688720",
    "end": "693959"
  },
  {
    "text": "persistence for free because you can just patch the external flash and then you're in and we indeed found an attack",
    "start": "693959",
    "end": "700839"
  },
  {
    "text": "it's a mix of cool software and Hardware it's abusable if you have root and it actually survives a full restore so even",
    "start": "700839",
    "end": "708120"
  },
  {
    "text": "if you completely wipe your device the chip will still be compromised we have that vulnerability",
    "start": "708120",
    "end": "714839"
  },
  {
    "text": "Apple committed to fixing it in Fall so I'm not going to drop it just yet but there there will be some cool stuff",
    "start": "714839",
    "end": "720079"
  },
  {
    "text": "later in the year however this is all the ace2 and ace2 is on its way out it",
    "start": "720079",
    "end": "725279"
  },
  {
    "text": "doesn't do a whole lot of interesting stuff and the iPhone 15 which is what everyone is interested in uses the",
    "start": "725279",
    "end": "731320"
  },
  {
    "text": "successor the Ace 3 now the ace3 is again from Texas",
    "start": "731320",
    "end": "738480"
  },
  {
    "text": "Instruments but this time there's zero public information you can't find a a chip with the same package you can't",
    "start": "738480",
    "end": "744760"
  },
  {
    "text": "find a chip that looks compatible to this instead it looks like it's either custom or maybe a product that is yet to",
    "start": "744760",
    "end": "751320"
  },
  {
    "text": "be released and so on and so forth in fact when I started you couldn't find a single hit for the labeling on the chip",
    "start": "751320",
    "end": "758800"
  },
  {
    "text": "so so yeah um but what's interesting is that on the iPhone 15 this ace3 chip",
    "start": "758800",
    "end": "764839"
  },
  {
    "text": "exists and it has access to a lot of uh embedded buses so for example spmi jtec",
    "start": "764839",
    "end": "770880"
  },
  {
    "text": "uart and so on but some of these are are read only essentially and so if we can",
    "start": "770880",
    "end": "776279"
  },
  {
    "text": "get code execution on this chip maybe we can actually start to modify the buses in the system and so that makes it",
    "start": "776279",
    "end": "782800"
  },
  {
    "text": "pretty interesting it also runs a full USB stack and so this tiny chip your USB",
    "start": "782800",
    "end": "789760"
  },
  {
    "text": "controller can itself run a full USB stack and this makes it pretty",
    "start": "789760",
    "end": "794880"
  },
  {
    "text": "interesting because if you if you imagine you manag to compromise the A3 and you have a Checkmate style attack",
    "start": "794880",
    "end": "801079"
  },
  {
    "text": "for the processor then you could essentially hide it in the ace3 and get persistence for your jailbreak without",
    "start": "801079",
    "end": "807560"
  },
  {
    "text": "actually having persistence on the main so and so it's an interesting Target I",
    "start": "807560",
    "end": "813160"
  },
  {
    "text": "know that a couple of people were looking at it and so that made it interesting to me too unfortunately the Ace 3 updated",
    "start": "813160",
    "end": "820959"
  },
  {
    "text": "everything that has to do with interacting with the ace it doesn't use this USBC firmware flashy anymore it has",
    "start": "820959",
    "end": "827680"
  },
  {
    "text": "a different upgrade mechanism between the iPhone and the MacBook and even worse the updates are personalized and",
    "start": "827680",
    "end": "833160"
  },
  {
    "text": "cryptographically signed but I still had this vulnerability for the A2 and so I was really curious whether I could uh",
    "start": "833160",
    "end": "839880"
  },
  {
    "text": "get it to work on the new uh MacBook and so I ordered a Macbook M3 Max I didn't",
    "start": "839880",
    "end": "845560"
  },
  {
    "text": "go for the iPhone because the MacBook actually has multiple A3 and so you get more a for your buck um but the main",
    "start": "845560",
    "end": "853880"
  },
  {
    "text": "reason is in a Macbook you have you have much more space you have debugging pads you can actually probe you can solder",
    "start": "853880",
    "end": "860040"
  },
  {
    "text": "it's much easier than fiddling with an iPhone and you don't need a jailbreak to get started if you want to do something",
    "start": "860040",
    "end": "866199"
  },
  {
    "text": "on the iPhone 15 you first need a jailbreak before you can actually do anything with the a so I did all of this",
    "start": "866199",
    "end": "872560"
  },
  {
    "text": "I ordered it it arrived and my vulnerability doesn't work damn it so",
    "start": "872560",
    "end": "878480"
  },
  {
    "text": "simple choice either I send it back or as a hardware hacker you",
    "start": "878480",
    "end": "883560"
  },
  {
    "text": "know open it up so um I decided to open up the",
    "start": "883560",
    "end": "890199"
  },
  {
    "text": "MacBook and once we look inside we can actually find the ace chips one is very",
    "start": "890199",
    "end": "896040"
  },
  {
    "text": "nicely located over here and the other one is over here now",
    "start": "896040",
    "end": "901680"
  },
  {
    "text": "you will notice that the debugging connectors that we used on the M1 MacBook are still there like these",
    "start": "901680",
    "end": "907399"
  },
  {
    "text": "silver pads are unpopulated Molex connectors and on the ace2 these gave us",
    "start": "907399",
    "end": "912759"
  },
  {
    "text": "access to jtech and so on and so was obvious we try to maybe get access to jtec now we have the A3 here and we",
    "start": "912759",
    "end": "920759"
  },
  {
    "text": "again have an external spy Flash and then as mentioned these debug connectors so I started using a needle",
    "start": "920759",
    "end": "928399"
  },
  {
    "text": "probe to probe all of these CD activity mapped out the flash uh pin out and so on you can all find that online now",
    "start": "928399",
    "end": "935279"
  },
  {
    "text": "unfortunately it seems that on the A3 the debug Port is disabled so what do we",
    "start": "935279",
    "end": "941120"
  },
  {
    "text": "do instead we dump the flash nice Apple was nicely enough to put the debug",
    "start": "941120",
    "end": "946920"
  },
  {
    "text": "headers for the flash nicely Exposed on there and so you can just use a couple of needle probes to get them now I",
    "start": "946920",
    "end": "953199"
  },
  {
    "text": "didn't want to solder in this MacBook cuz I was still in the 30-day Amazon return window and so you know",
    "start": "953199",
    "end": "960199"
  },
  {
    "text": "um who knows and so a few dozen attempts later I had a flash dump of The ace3",
    "start": "960199",
    "end": "968240"
  },
  {
    "text": "Flash unfortunately this means we have random bytes and it's reversing",
    "start": "968240",
    "end": "974839"
  },
  {
    "text": "time the results were essentially the chip is very different",
    "start": "974839",
    "end": "979880"
  },
  {
    "text": "peripheral wise everything has different offsets as far as I can tell it's it just seems to be like the even the CC",
    "start": "979880",
    "end": "986440"
  },
  {
    "text": "peripheral as far as I can tell is at a different address and so on on and so there's not a whole lot that we actually know also it's again just patches it's",
    "start": "986440",
    "end": "993800"
  },
  {
    "text": "again just patches for the embedded firmware and there were some weird regions with high entropy that look a",
    "start": "993800",
    "end": "999120"
  },
  {
    "text": "lot like cryptographic Keys unfortunately however I was able to",
    "start": "999120",
    "end": "1004160"
  },
  {
    "text": "reverse engineer a lot of the firmware headers of the external flesh and one of the things that I found were CC",
    "start": "1004160",
    "end": "1011440"
  },
  {
    "text": "addresses now I know this was naive but I thought hey I found the CRC maybe they",
    "start": "1011440",
    "end": "1016480"
  },
  {
    "text": "don't actually do any secq boot and so let's try to flip a bit in a $3,000",
    "start": "1016480",
    "end": "1022519"
  },
  {
    "text": "MacBook and it doesn't work I can't get it to boot I modify the firmware I fixed",
    "start": "1022519",
    "end": "1028120"
  },
  {
    "text": "all crcs that I knew of but it doesn't boot but at least I didn't fully brick",
    "start": "1028120",
    "end": "1033319"
  },
  {
    "text": "it you know I was able to restore it by just flashing it back so at least it doesn't Breck itself once you temper with",
    "start": "1033319",
    "end": "1038720"
  },
  {
    "text": "it however at this point I don't know have I just missed another CSC or is",
    "start": "1038720",
    "end": "1044120"
  },
  {
    "text": "their actual Seeker Boot and so on so essentially either I'm B at reversing or",
    "start": "1044120",
    "end": "1049559"
  },
  {
    "text": "apple is good at engineering or maybe even both um but",
    "start": "1049559",
    "end": "1055919"
  },
  {
    "text": "yeah what else can we try now I've mentioned before that we have multiple Ace chips in the MacBook and so one of",
    "start": "1055919",
    "end": "1063000"
  },
  {
    "text": "the things we can do is we can dump all of them and we can compare the differences and it turns out that they",
    "start": "1063000",
    "end": "1068880"
  },
  {
    "text": "all run different firmware they uh the back left Port has the biggest patch set",
    "start": "1068880",
    "end": "1074160"
  },
  {
    "text": "and even worse they all have um small updates and they all have changes to",
    "start": "1074160",
    "end": "1080159"
  },
  {
    "text": "this High entropy area indicating that we have some kind of secq boot with hashing signatures and so on and so",
    "start": "1080159",
    "end": "1085799"
  },
  {
    "text": "forth now one of the things I was curious about is can I run the ace firmware of one ace on another one and",
    "start": "1085799",
    "end": "1093960"
  },
  {
    "text": "so I just dumped it flash it on the other one and it doesn't boot and this is interesting because if transplanting",
    "start": "1093960",
    "end": "1100360"
  },
  {
    "text": "firmware doesn't work it indicates that we potentially have personalized firmware per chip so Apple signs every",
    "start": "1100360",
    "end": "1106880"
  },
  {
    "text": "update for each single chip so let's continue reversing",
    "start": "1106880",
    "end": "1112039"
  },
  {
    "text": "unfortunately I tried to find the software vulnerability I tried swd",
    "start": "1112039",
    "end": "1117280"
  },
  {
    "text": "access I tried modifying flash Contents I tried fuzzing and I even found a small",
    "start": "1117280",
    "end": "1122360"
  },
  {
    "text": "timing site channel to to find all the commands that the chip implements but I couldn't I wasn't lucky",
    "start": "1122360",
    "end": "1129280"
  },
  {
    "text": "so we have a completely undocumented chip we have no firmware and we only have a couple of simple commands that I",
    "start": "1129280",
    "end": "1135080"
  },
  {
    "text": "at least can't get code execution with time to give up well I'm a hardware hacker and I'm",
    "start": "1135080",
    "end": "1142679"
  },
  {
    "text": "really into fault injection and so let's try to hack the chip via fault injection and the idea of",
    "start": "1142679",
    "end": "1149840"
  },
  {
    "text": "fault injection is that we introduce faults into the chip and this can allow",
    "start": "1149840",
    "end": "1154880"
  },
  {
    "text": "us to modify the behavior of the software that is running on the chip so for example we might be able to corrupt",
    "start": "1154880",
    "end": "1160240"
  },
  {
    "text": "memory we might be able to corrupt registers we might even be able to skip instructions and there are a lot of",
    "start": "1160240",
    "end": "1166200"
  },
  {
    "text": "different ways to do this there's voltage fault injection laser BBI electromagnetic fault injection and so",
    "start": "1166200",
    "end": "1171960"
  },
  {
    "text": "on and they all have one thing in in common it's very easy to destroy chips",
    "start": "1171960",
    "end": "1177280"
  },
  {
    "text": "by using them and so yeah I was still in the 30-day return window though so just",
    "start": "1177280",
    "end": "1184360"
  },
  {
    "text": "kidding um mostly now voltage fault injection",
    "start": "1184360",
    "end": "1189919"
  },
  {
    "text": "essentially works by dropping the power supply to the chip for a very short amount of time at just the right point",
    "start": "1189919",
    "end": "1196960"
  },
  {
    "text": "in time and with just the right pulse length and this can allow us to again",
    "start": "1196960",
    "end": "1202280"
  },
  {
    "text": "skip instructions and so on it's very easy to do but the problem is that it pretty much requires soldering right and",
    "start": "1202280",
    "end": "1208760"
  },
  {
    "text": "so removal of capacitors it's best performed when you when you you know remove a lot of capacitors but we don't",
    "start": "1208760",
    "end": "1215080"
  },
  {
    "text": "even know what pin is the core voltage we don't know what capacitor is the actual voltage Supply that we interested",
    "start": "1215080",
    "end": "1220760"
  },
  {
    "text": "in and it's even more difficult because the voltage rails seem to be shared across a lot of stuff and so we don't",
    "start": "1220760",
    "end": "1226799"
  },
  {
    "text": "only glitch the ace we also glitch everything everything else but there's this other other cool technology that's",
    "start": "1226799",
    "end": "1232640"
  },
  {
    "text": "called electromagnetic fault injection the idea is that we create a very high voltage pulse into a small coil and this",
    "start": "1232640",
    "end": "1240880"
  },
  {
    "text": "lets us inject current in a very precise location directly into the chip and again we can skip instructions and so on",
    "start": "1240880",
    "end": "1247520"
  },
  {
    "text": "and so forth and it doesn't require any preparation essentially we just you know",
    "start": "1247520",
    "end": "1253039"
  },
  {
    "text": "point the thing at the chip like this we zap it and the chip is hacked easy",
    "start": "1253039",
    "end": "1260360"
  },
  {
    "text": "enough however the problem is to do this we actually need Super precise timing",
    "start": "1260360",
    "end": "1266960"
  },
  {
    "text": "because we need to know exactly when in time the the check fails but we don't know anything about the chip we don't",
    "start": "1266960",
    "end": "1273159"
  },
  {
    "text": "even know what check we are trying to skip right because we don't have the firmware so what do we do we use site",
    "start": "1273159",
    "end": "1280480"
  },
  {
    "text": "channels and so essentially my idea was I use a cheap SDR normally you would do",
    "start": "1280480",
    "end": "1287600"
  },
  {
    "text": "this with an oscilloscope scope uh with a very fancy oscilloscope and so I wanted to do it much cheaper and so I",
    "start": "1287600",
    "end": "1293760"
  },
  {
    "text": "wanted to use a hacker F SDR and then we just take a very uh shitty coil and we",
    "start": "1293760",
    "end": "1300080"
  },
  {
    "text": "just drop it on the Chip And we capture the magic chip waves now from the computer using Ace",
    "start": "1300080",
    "end": "1307200"
  },
  {
    "text": "Tool we can actually restart the Chip And when we do that we can if we look at the radio spectrum we can see very clear",
    "start": "1307200",
    "end": "1313720"
  },
  {
    "text": "signals at around 50 MHz or 48 MHz and and so easy idea we record the",
    "start": "1313720",
    "end": "1322000"
  },
  {
    "text": "Spectrum on the hackrf we reboot the A3 and then we look at the EM recording and",
    "start": "1322000",
    "end": "1328440"
  },
  {
    "text": "then we do some very simple DSP I mean it's going to be so simple and so after",
    "start": "1328440",
    "end": "1333760"
  },
  {
    "text": "two days of debugging my signal processing chain I eventually was left with",
    "start": "1333760",
    "end": "1340559"
  },
  {
    "text": "something that I think looks like it could tell us something but this could be anything",
    "start": "1340559",
    "end": "1347360"
  },
  {
    "text": "this could just be the power power regulator but maybe we get lucky and it actually means something and so we have",
    "start": "1347360",
    "end": "1353279"
  },
  {
    "text": "a nice trace the problem is for power analysis or overall side Channel analysis we want to take a lot of traces",
    "start": "1353279",
    "end": "1360400"
  },
  {
    "text": "and calculate the averages because then we get a uh like all the noise removed but each recording was at a",
    "start": "1360400",
    "end": "1367880"
  },
  {
    "text": "slightly different offset and aligning those is you know you can do this in DSP",
    "start": "1367880",
    "end": "1373799"
  },
  {
    "text": "but first off I'm not very good at that and second of it's just a lot of work the hacker F however has a hardware",
    "start": "1373799",
    "end": "1381240"
  },
  {
    "text": "trigger input and we can configure that uh that input to essentially start the recording as soon as it gets a rising",
    "start": "1381240",
    "end": "1389159"
  },
  {
    "text": "Edge however this doesn't actually work in the latest firmware and so I spent a day just like trying different hacker",
    "start": "1389159",
    "end": "1394799"
  },
  {
    "text": "firmwar until I could get it to work and now we just need a trigger signal and it",
    "start": "1394799",
    "end": "1400480"
  },
  {
    "text": "turns out that if we look at the flashh communication of the chip the chip select",
    "start": "1400480",
    "end": "1406799"
  },
  {
    "text": "line will give us the perfect Edge just as the chip starts loading our firmware",
    "start": "1406799",
    "end": "1411960"
  },
  {
    "text": "so we get a perfect timing signal that tells us when our firmware is is getting loaded and then from there we can offset",
    "start": "1411960",
    "end": "1417880"
  },
  {
    "text": "our glitch and also our measurement because the firmware will obviously be loaded before the signature check",
    "start": "1417880",
    "end": "1423640"
  },
  {
    "text": "happens and so hopefully we can determine when we need to glitch so easy",
    "start": "1423640",
    "end": "1428919"
  },
  {
    "text": "enough start recording uh on the chip select trigger on Heck reboot the A3 and",
    "start": "1428919",
    "end": "1435000"
  },
  {
    "text": "we get a perfectly aligned recording and and then your setup looks like this there's also a trigger",
    "start": "1435000",
    "end": "1441200"
  },
  {
    "text": "inverter off screen because we actually can't use a falling trigger now this is",
    "start": "1441200",
    "end": "1446760"
  },
  {
    "text": "how it looks when you take pictures for blackhead this is how it looks when you actually do it in your office it's a",
    "start": "1446760",
    "end": "1453120"
  },
  {
    "text": "mess but you know it works we have just a needle Probe on the chip select line",
    "start": "1453120",
    "end": "1459159"
  },
  {
    "text": "we just literally by gravity hold the probe in place um yeah no soldering",
    "start": "1459159",
    "end": "1465279"
  },
  {
    "text": "still in the Amazon return window perfect and then we get perfectly aligned recordings in fact they are so",
    "start": "1465279",
    "end": "1472080"
  },
  {
    "text": "perfect that if you look at them in like a visualization you can see there's a lot of noise on the frequency spectrum",
    "start": "1472080",
    "end": "1477960"
  },
  {
    "text": "but timing wise we are spot on now one thing I noticed is that these",
    "start": "1477960",
    "end": "1484559"
  },
  {
    "text": "Peaks at the start I've seen them before in fact they perfectly correlate with the flash activity on the Chip And so we",
    "start": "1484559",
    "end": "1492200"
  },
  {
    "text": "already know that we we see something that is related to the activity of the chip if we are unlucky unlucky we are",
    "start": "1492200",
    "end": "1498200"
  },
  {
    "text": "just measuring the noise of The Flash lines but we'll see now we have this fancy measurement",
    "start": "1498200",
    "end": "1505520"
  },
  {
    "text": "but how do we use this to actually time our glitch well the idea is easy we",
    "start": "1505520",
    "end": "1510600"
  },
  {
    "text": "change the flash contents to be invalid we again take a recording and then we",
    "start": "1510600",
    "end": "1516080"
  },
  {
    "text": "compare the differences sounds easy enough in real life it means hooking in the needle probes try",
    "start": "1516080",
    "end": "1523720"
  },
  {
    "text": "fleshing until it works which can easily take an hour then you put your em measurement back back you do the",
    "start": "1523720",
    "end": "1528840"
  },
  {
    "text": "measurement and you start over because you forgot something but eventually you have a measurement of the original",
    "start": "1528840",
    "end": "1534600"
  },
  {
    "text": "firmware and then the modified firmware and we can see that there's a very clear difference in the Spectrum at this point",
    "start": "1534600",
    "end": "1541640"
  },
  {
    "text": "in time now we could try to glitch here however we have a couple of more tricks",
    "start": "1541640",
    "end": "1547200"
  },
  {
    "text": "that we can do because remember that we found the CRC values and so if this side",
    "start": "1547200",
    "end": "1553120"
  },
  {
    "text": "channel was working and what was telling us something we can check that by measuring with original firmware then",
    "start": "1553120",
    "end": "1560279"
  },
  {
    "text": "only having one of the three csc's correct then trying with two csc's correct and unfortunately there's no",
    "start": "1560279",
    "end": "1565880"
  },
  {
    "text": "difference between those two and then with all three crc's correct we can see that the signal looks much different and",
    "start": "1565880",
    "end": "1572760"
  },
  {
    "text": "that we actually get the difference in the emissions much much later in time",
    "start": "1572760",
    "end": "1579360"
  },
  {
    "text": "and so why not try to glitch here maybe that",
    "start": "1579360",
    "end": "1584760"
  },
  {
    "text": "works and so with that we have a timing and you know next problem is how do we",
    "start": "1584760",
    "end": "1590919"
  },
  {
    "text": "position the chip shouter normally you would put the chip shouter on a CNC and you would scan the chip the problem is",
    "start": "1590919",
    "end": "1598320"
  },
  {
    "text": "that just before I did this research I accidentally got 330 volts on the ground",
    "start": "1598320",
    "end": "1603600"
  },
  {
    "text": "line of my CNC destroying my computer my CNC and everything else connected to it",
    "start": "1603600",
    "end": "1608679"
  },
  {
    "text": "and so I didn't have a CNC at hand at that point in time so I just used the biggest probe I had that's as large as",
    "start": "1608679",
    "end": "1614760"
  },
  {
    "text": "the chip and put it on there if if it's stupid and it's it works it's not stupid I guess and so",
    "start": "1614760",
    "end": "1623159"
  },
  {
    "text": "yeah essentially then we have this setup where we have a chip shouter we have the chip whisper Husky which does the",
    "start": "1623159",
    "end": "1629159"
  },
  {
    "text": "triggering and so on uh we have the trigger connection and the ground connection so that everything you know",
    "start": "1629159",
    "end": "1634520"
  },
  {
    "text": "runs at the same potential and not shown uh days of debugging again this picture",
    "start": "1634520",
    "end": "1639919"
  },
  {
    "text": "is bogus uh this is how it actually looked on my desk very messy and constantly stuff falling off the desk um",
    "start": "1639919",
    "end": "1646840"
  },
  {
    "text": "but we are ready to actually attack the Chip And so what do we do first we just changeed the version string essentially",
    "start": "1646840",
    "end": "1653760"
  },
  {
    "text": "from Mac OS we can see the version that our Ace is running at um on my this was",
    "start": "1653760",
    "end": "1660399"
  },
  {
    "text": "2.45 and so I just changed that in the flash flashed that on there and then we",
    "start": "1660399",
    "end": "1665519"
  },
  {
    "text": "just arm the arm the Husky and the chip shouter we reboot the A3 we wait for the",
    "start": "1665519",
    "end": "1671760"
  },
  {
    "text": "glitch and then remember how we can check whether the chip booted successfully we can check whether our",
    "start": "1671760",
    "end": "1677519"
  },
  {
    "text": "glitch was success uccessful depending on whether the chip is stuck in the boot loader adfu or whether it made it",
    "start": "1677519",
    "end": "1683320"
  },
  {
    "text": "through into the app code and so I build a very simple jupyter notebook for this that just essentially runs the glitch",
    "start": "1683320",
    "end": "1690880"
  },
  {
    "text": "over and over again you can see that we get like 1.6 attempts per second and so this was running for",
    "start": "1690880",
    "end": "1698000"
  },
  {
    "text": "hours and that's also where the trouble start sometimes the ace completely stops",
    "start": "1698000",
    "end": "1703720"
  },
  {
    "text": "responding and then we need to autore reboot the entire MacBook but if we you reboot the MacBook the MacBook stops",
    "start": "1703720",
    "end": "1710000"
  },
  {
    "text": "charging because we just reflashed the charging controller and so then you have eight hours to try to get the attack",
    "start": "1710000",
    "end": "1715880"
  },
  {
    "text": "working then you have to restore everything by you know putting the probes back on reflashing rebooting",
    "start": "1715880",
    "end": "1720960"
  },
  {
    "text": "waiting till the MacBook is charged and then you start again but eventually you get success and indeed uh",
    "start": "1720960",
    "end": "1729159"
  },
  {
    "text": "we managed to change the version string to 42 we glitch the A3 yay but",
    "start": "1729159",
    "end": "1737170"
  },
  {
    "text": "[Applause]",
    "start": "1737170",
    "end": "1742360"
  },
  {
    "text": "but we can only modify patches right and we don't know what these patches patch",
    "start": "1742360",
    "end": "1747799"
  },
  {
    "text": "we don't know when they are called and even if we and we have no input and output even if we get code execution how",
    "start": "1747799",
    "end": "1754480"
  },
  {
    "text": "do we get data out of the chip so we can replace functions we just don't know what those functions do and even if we",
    "start": "1754480",
    "end": "1761080"
  },
  {
    "text": "were if we knew what they do we have no way to get data back to our computer however remember that earlier on there",
    "start": "1761080",
    "end": "1768399"
  },
  {
    "text": "were these commands me read me write me modify and so on and these are all these",
    "start": "1768399",
    "end": "1773880"
  },
  {
    "text": "four CC codes and we can just search in the patches for these four CC codes",
    "start": "1773880",
    "end": "1780399"
  },
  {
    "text": "unfortunately there are a lot of them and so for example here you can see there's like dis ufpf DF UF and so on in",
    "start": "1780399",
    "end": "1787039"
  },
  {
    "text": "a single function however we also have the ace2 firmware and the ace2 firmware",
    "start": "1787039",
    "end": "1792159"
  },
  {
    "text": "we understand the full command handling we reversed everything already and luckily enough there was a very similar",
    "start": "1792159",
    "end": "1797760"
  },
  {
    "text": "function function in the A2 firmware that told us okay this is the usw command Handler and we can replace",
    "start": "1797760",
    "end": "1805799"
  },
  {
    "text": "it but what do we replace it with well we can build a payload but again each",
    "start": "1805799",
    "end": "1812399"
  },
  {
    "text": "attempt of debugging that payload takes hours to days to test and there's zero debug information Beyond well it doesn't",
    "start": "1812399",
    "end": "1818600"
  },
  {
    "text": "work you did something wrong so you better get it right the first time which obviously I didn't however uh then it",
    "start": "1818600",
    "end": "1825519"
  },
  {
    "text": "occur to me that I can just use the memory read implementation of the ace2",
    "start": "1825519",
    "end": "1830600"
  },
  {
    "text": "and I put it on the ace3 um and essentially replace this USB",
    "start": "1830600",
    "end": "1835679"
  },
  {
    "text": "W Handler with the read function from the A2 I reduced it in size a bit um and",
    "start": "1835679",
    "end": "1841919"
  },
  {
    "text": "essentially built a trivial memory reader and so we can now send a 4 byte address to the chip and it will will",
    "start": "1841919",
    "end": "1848760"
  },
  {
    "text": "return the four bytes at that address so attemp two uh replace USB W",
    "start": "1848760",
    "end": "1853799"
  },
  {
    "text": "command again start glitching debugging waiting recharging and so on and so for forth um but eventually we got",
    "start": "1853799",
    "end": "1861159"
  },
  {
    "text": "successful and um we changed Ace Tool to be able to send over an address and so",
    "start": "1861159",
    "end": "1868360"
  },
  {
    "text": "we just execute Ace Tool USB W with the address zero and we got this value back now if",
    "start": "1868360",
    "end": "1875440"
  },
  {
    "text": "you reverse that value you see that it's 20600 uh and he already Nots he knows",
    "start": "1875440",
    "end": "1882679"
  },
  {
    "text": "what it is uh this is the stack pointer reset value we can read and write right",
    "start": "1882679",
    "end": "1888159"
  },
  {
    "text": "arbitrary memory in the ace3",
    "start": "1888159",
    "end": "1892279"
  },
  {
    "text": "[Applause] yay time to dump the Flesh and we can",
    "start": "1893780",
    "end": "1899559"
  },
  {
    "text": "dump four bites at a time so this took literally hours in in fact it took so",
    "start": "1899559",
    "end": "1905039"
  },
  {
    "text": "long that I the battery ran out and I had to ref Flash and do the whole thing again um so yeah lots of time to dump",
    "start": "1905039",
    "end": "1912639"
  },
  {
    "text": "but in the end we have the full dump of the ace3 ROM and RAM enance",
    "start": "1912639",
    "end": "1918639"
  },
  {
    "text": "and that's really awesome because it means that dumping unknown silicon is essentially possible right it's not",
    "start": "1918639",
    "end": "1923679"
  },
  {
    "text": "super difficult it just takes a lot of persistence we can get code execution without having the actual full firmware",
    "start": "1923679",
    "end": "1930440"
  },
  {
    "text": "and we can now starting start researching the ace3 in fact we have already some emulation and so on for it",
    "start": "1930440",
    "end": "1936039"
  },
  {
    "text": "going on and so on now I also finally got a new CNC and so I was able to do",
    "start": "1936039",
    "end": "1941399"
  },
  {
    "text": "some some new measurements and on my chips this area is actually um the one",
    "start": "1941399",
    "end": "1947240"
  },
  {
    "text": "that I get most successful with and with a smaller um smaller coil you actually can get much more precision and it's",
    "start": "1947240",
    "end": "1953919"
  },
  {
    "text": "everything is much better if you do it right we also have some nice chip scans coming soon so hopefully we can actually",
    "start": "1953919",
    "end": "1960000"
  },
  {
    "text": "see what's going on inside of the chip if you want to reproduce this we",
    "start": "1960000",
    "end": "1965120"
  },
  {
    "text": "actually releasing all the tools that we use to do this so HPM explore the tool to send custom messages with arguments",
    "start": "1965120",
    "end": "1971080"
  },
  {
    "text": "and so on Ace enumerate the timing site Channel um which is pretty useless to be honest but it's there because we canot",
    "start": "1971080",
    "end": "1977320"
  },
  {
    "text": "get the firmware and we are also releasing all the timings and the Jupiter notebook so I can't give you the",
    "start": "1977320",
    "end": "1982480"
  },
  {
    "text": "firmware because it's not mine but I can give you all the tools that you need to to dump it um with that said thanks a",
    "start": "1982480",
    "end": "1989200"
  },
  {
    "text": "lot for coming and you know if you have questions feel free to line up at the the microphones and yeah thank you",
    "start": "1989200",
    "end": "1998399"
  }
]