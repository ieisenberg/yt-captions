[
  {
    "text": "uh today we're going to talk a little bit about uh electromatic fault injection uh we spent some time",
    "start": "2480",
    "end": "8400"
  },
  {
    "text": "glitching the giga device uh GD32F uh 407 uh my name is Jonathan Anderson i",
    "start": "8400",
    "end": "15920"
  },
  {
    "text": "manage the um advanced security research team at Trend Micro uh we work a lot uh",
    "start": "15920",
    "end": "21359"
  },
  {
    "text": "in conjunction with ZDI we do a lot of hardware research uh helping to support the program um today uh I have my",
    "start": "21359",
    "end": "28480"
  },
  {
    "text": "colleague here uh Thanos Kanakis and he's going to assist also with this",
    "start": "28480",
    "end": "33559"
  },
  {
    "text": "presentation so jumping in uh here we have a picture of the uh part itself and",
    "start": "33559",
    "end": "39920"
  },
  {
    "text": "what you see there is the probe tip of the Pico EMP um and this is kind of a",
    "start": "39920",
    "end": "44960"
  },
  {
    "text": "close-up view of how the glitching actually works um Thanos is going to kind of go through an introduction give",
    "start": "44960",
    "end": "50800"
  },
  {
    "text": "you a little background um he'll talk about how to get started in glitching um",
    "start": "50800",
    "end": "56239"
  },
  {
    "text": "the attack we designed and then I'll jump in and talk about actually executing the attack how you can go",
    "start": "56239",
    "end": "62079"
  },
  {
    "text": "about calibrating your system and optimizing it we'll talk about some of the results and some mitigations and",
    "start": "62079",
    "end": "68320"
  },
  {
    "text": "come to some conclusions so I'm going to hand it over to Thanos here and he's going to give you a little bit of intro",
    "start": "68320",
    "end": "73840"
  },
  {
    "text": "and background thank you thank you Jonathan and welcome everyone",
    "start": "73840",
    "end": "79600"
  },
  {
    "text": "i want to start off quickly talking about some of the motivations we had going into this project why we chose",
    "start": "79600",
    "end": "84960"
  },
  {
    "text": "this particular part uh Trend Micro ZDI uh operates uh several pun events",
    "start": "84960",
    "end": "90880"
  },
  {
    "text": "throughout the year at the last automotive event uh the Autel Maxi charger was featured one as one of the",
    "start": "90880",
    "end": "97960"
  },
  {
    "text": "targets uh inside that device is where the GD32F47 device is and why would we",
    "start": "97960",
    "end": "105840"
  },
  {
    "text": "choose fault injection the uh uh we wanted to understand the experience our contestants were having with the part",
    "start": "105840",
    "end": "112159"
  },
  {
    "text": "it's locked and we want to understand any difficulties they they encountered uh firsthand uh specifically why EMI EM",
    "start": "112159",
    "end": "122079"
  },
  {
    "text": "uh fault injection uh we we did not have read readily have access to any of the",
    "start": "122079",
    "end": "129280"
  },
  {
    "text": "internal uh voltage regulation inside the part uh nothing was exposed so we",
    "start": "129280",
    "end": "135360"
  },
  {
    "text": "felt em fault injection was the most likely to succeed for this",
    "start": "135360",
    "end": "142400"
  },
  {
    "text": "part uh so here we see a picture of two die chip die on the right is the S ST",
    "start": "142440",
    "end": "149280"
  },
  {
    "text": "micro uh device and on the on the left is the giga devices device uh these are",
    "start": "149280",
    "end": "154800"
  },
  {
    "text": "software compatible devices however you could clearly see there's several differences uh where the ST micro is is",
    "start": "154800",
    "end": "162319"
  },
  {
    "text": "single die device the GD device is uh actually consists of the main die plus a",
    "start": "162319",
    "end": "168160"
  },
  {
    "text": "a flash chiplet so the implementation is different even though they're functionally similar uh the reason I",
    "start": "168160",
    "end": "174400"
  },
  {
    "text": "bring this up is because we uh found a bit of prior research on fault injection",
    "start": "174400",
    "end": "180879"
  },
  {
    "text": "of the ST micro part and nothing on the GD part so we're hoping to leverage some of that uh in part of our our",
    "start": "180879",
    "end": "187599"
  },
  {
    "text": "experiments uh brief word about the readout protection levels uh I I'll only mention",
    "start": "187599",
    "end": "194640"
  },
  {
    "text": "the RDP1 because that's the mode the part is in uh flash is accessible in",
    "start": "194640",
    "end": "200800"
  },
  {
    "text": "flash boot mode uh and when the flash the flash is disabled when the debugger is attached so there's some limitations",
    "start": "200800",
    "end": "208680"
  },
  {
    "text": "there uh let's talk about the rig uh on the right there is the a picture of our",
    "start": "208680",
    "end": "214239"
  },
  {
    "text": "particular rig uh on the left is is the obviously the the main components uh",
    "start": "214239",
    "end": "219680"
  },
  {
    "text": "came in at about $600 uh not including the controller PC and I'll go a little",
    "start": "219680",
    "end": "225840"
  },
  {
    "text": "more in depth on those so uh controller PC on the left and the target itself on",
    "start": "225840",
    "end": "231120"
  },
  {
    "text": "the right uh you may recognize this recognize this as a an inexpensive",
    "start": "231120",
    "end": "237040"
  },
  {
    "text": "desktop CNC machine that we we leveraged for our XYZ platform uh we removed the",
    "start": "237040",
    "end": "243040"
  },
  {
    "text": "spindle spindle and mounted the PCMP which creates the EM pulses for the uh",
    "start": "243040",
    "end": "248959"
  },
  {
    "text": "to attack the target uh of note as well is the power supply what's special about",
    "start": "248959",
    "end": "254159"
  },
  {
    "text": "this one it's programmable uh through software but it also can u measure the",
    "start": "254159",
    "end": "259680"
  },
  {
    "text": "the current draw of the target uh both critical factors in this testing uh also",
    "start": "259680",
    "end": "265680"
  },
  {
    "text": "of note is the managed USB hub the special thing about this one is that each port can be power cycled",
    "start": "265680",
    "end": "271639"
  },
  {
    "text": "independently uh very important when you're having any uh flakiness in any of",
    "start": "271639",
    "end": "276720"
  },
  {
    "text": "your components you can power cycle it and resume the test that you don't abort the entire test",
    "start": "276720",
    "end": "283639"
  },
  {
    "text": "run uh some some purchase links for later reference on the main",
    "start": "283639",
    "end": "289000"
  },
  {
    "text": "components uh bit about the 3D printed parts uh uh obviously the the Pico EMP",
    "start": "289000",
    "end": "295759"
  },
  {
    "text": "mount uh uh it's it's it like I said it replaces where the spindle would go and",
    "start": "295759",
    "end": "301360"
  },
  {
    "text": "some handy uh platforms for the uh the target PCB itself and then we also",
    "start": "301360",
    "end": "307520"
  },
  {
    "text": "leverage Thingiverse for some switch limit switch mounts uh that our machine didn't have for our our our components",
    "start": "307520",
    "end": "315199"
  },
  {
    "text": "they'll be in the blog posted in the blog soon",
    "start": "315199",
    "end": "320639"
  },
  {
    "text": "um the the chip shouter itself uh some of you may be aware of it but it's actually it's an open source project uh",
    "start": "320639",
    "end": "327680"
  },
  {
    "text": "hardware and software unfortunately you can't just always purchase it complete",
    "start": "327680",
    "end": "332720"
  },
  {
    "text": "and you may end up having to do what we did is put it together ourselves uh we included uh the bombs here for some",
    "start": "332720",
    "end": "339160"
  },
  {
    "text": "convenience um and the we do have uh the PCBs are relatively easy to to order and",
    "start": "339160",
    "end": "346400"
  },
  {
    "text": "not expensive but we do have a few spares if anybody's interested in in getting one after the",
    "start": "346400",
    "end": "352520"
  },
  {
    "text": "talk uh as for the firmware for this uh Pico MP uh we added uh we augmented it",
    "start": "352520",
    "end": "359440"
  },
  {
    "text": "with an all-in-one command to speed up some of the sequencing that we do uh and",
    "start": "359440",
    "end": "366560"
  },
  {
    "text": "uh we we utilize this PIO block for more deterministic timing and for triggering",
    "start": "366560",
    "end": "372880"
  },
  {
    "text": "and uh so these are some of the improvements that we made on on that and we'll we'll try to post that to the",
    "start": "372880",
    "end": "378720"
  },
  {
    "text": "original git as well so what do you do to get started in",
    "start": "378720",
    "end": "384479"
  },
  {
    "text": "in a project like this uh fortunately it's it's some homework you're going to be doing some reading understanding the",
    "start": "384479",
    "end": "390880"
  },
  {
    "text": "intricacies of the part especially when it comes to to security features",
    "start": "390880",
    "end": "396440"
  },
  {
    "text": "um prior research certainly is very helpful the more you know the the easier",
    "start": "396440",
    "end": "402000"
  },
  {
    "text": "it'll be for you to understand how what the behavior of the part is is at least",
    "start": "402000",
    "end": "407120"
  },
  {
    "text": "characterize the behavior of the part uh after you educate yourself then you'll",
    "start": "407120",
    "end": "412240"
  },
  {
    "text": "want to actually test that knowledge and uh it's very important to look at edge cases um look at different modes try",
    "start": "412240",
    "end": "419840"
  },
  {
    "text": "everything that maybe not necessarily standard operation just to see if there's any conditions that you can",
    "start": "419840",
    "end": "426720"
  },
  {
    "text": "exploit later uh then you'll have to decide which dimensions to control uh by far",
    "start": "426720",
    "end": "433680"
  },
  {
    "text": "the most important element will be the the trigger uh and we'll talk more",
    "start": "433680",
    "end": "438960"
  },
  {
    "text": "detail later about the which aspects are the important ones uh and then the rest of the parameters um are fairly typical",
    "start": "438960",
    "end": "446400"
  },
  {
    "text": "for this EM type setup EMP fault injection setup",
    "start": "446400",
    "end": "453000"
  },
  {
    "text": "um so and then what do we collect after we do the controlling obviously",
    "start": "453000",
    "end": "459520"
  },
  {
    "text": "everything everything you've controlled you're going to want to also log and collect as well as any uh information",
    "start": "459520",
    "end": "465759"
  },
  {
    "text": "you can gather from the target uh current draw any IO or clock out",
    "start": "465759",
    "end": "470880"
  },
  {
    "text": "measurements you can take uh if you have access to the uh to a debugger uh in",
    "start": "470880",
    "end": "476479"
  },
  {
    "text": "that mode that it's it's in uh any any information from that is helpful console output is helpful so those are the type",
    "start": "476479",
    "end": "483280"
  },
  {
    "text": "of things you want to collect uh also don't neglect to instrument your glitch loop the code that you're using to run",
    "start": "483280",
    "end": "489680"
  },
  {
    "text": "all this on um it's important to keep your glitch rate up and we'll talk about that",
    "start": "489680",
    "end": "495160"
  },
  {
    "text": "later but uh having good way to u monitor your",
    "start": "495160",
    "end": "501759"
  },
  {
    "text": "your performance in the glitch loop is important so you can optimize it and finally uh use a scope and other lab",
    "start": "501759",
    "end": "507759"
  },
  {
    "text": "equipment as much as possible uh to validate everything uh you're going to have some hard new hardware new new",
    "start": "507759",
    "end": "514240"
  },
  {
    "text": "software running together there's it's going to help a lot and don't just take it off just leave it on if you can",
    "start": "514240",
    "end": "519760"
  },
  {
    "text": "because you'll want to be able to uh make sure that it's still operating to",
    "start": "519760",
    "end": "524800"
  },
  {
    "text": "form uh as you as you progress through your testing uh very quick work word on",
    "start": "524800",
    "end": "531519"
  },
  {
    "text": "coding and ops most of these are just be uh best practice type recommendations",
    "start": "531519",
    "end": "536959"
  },
  {
    "text": "uh for good logging and tracking you'll be dealing with a lot of data and uh a lot of test runs with subtle differences",
    "start": "536959",
    "end": "544480"
  },
  {
    "text": "and you're looking for a needle in a hay stack uh so if you're not keeping good",
    "start": "544480",
    "end": "549680"
  },
  {
    "text": "track of these things you may miss some important information that could help you and it'll extend the time you're",
    "start": "549680",
    "end": "556560"
  },
  {
    "text": "testing so let's talk about the attack uh from prior research we uh suspected",
    "start": "556839",
    "end": "565200"
  },
  {
    "text": "that the uh the giga devices uh device was susceptible to being attacked in",
    "start": "565200",
    "end": "571680"
  },
  {
    "text": "bootloadader mode uh because the SD micro uh showed that it could be uh so",
    "start": "571680",
    "end": "577760"
  },
  {
    "text": "we extracted the bootloadader uh code from from the device we reversed it in gedra uh and then we verified that the",
    "start": "577760",
    "end": "586000"
  },
  {
    "text": "command set in the bootloadader matched the st micro so the the same readmemory command existed and and operated in the",
    "start": "586000",
    "end": "593920"
  },
  {
    "text": "same way uh so the attack was to boot into bootloadader issue the readmemory",
    "start": "593920",
    "end": "599600"
  },
  {
    "text": "command perform our our fault injection and then wait for a knack or an act this",
    "start": "599600",
    "end": "606000"
  },
  {
    "text": "case a hex79 to affirm that we could access the firmware",
    "start": "606000",
    "end": "612080"
  },
  {
    "text": "what this looks like in the code was uh over here on the right uh the readmemory command would be transmitted to the to",
    "start": "612080",
    "end": "619440"
  },
  {
    "text": "the target uh it would be decoded and call the readmemory command function uh just above the blue arrow is where the",
    "start": "619440",
    "end": "626399"
  },
  {
    "text": "the lock bits are stored in the device and then the condition will check to to",
    "start": "626399",
    "end": "631519"
  },
  {
    "text": "see if the device is locked and if the glitch which would be line where the blue arrow is was successful it would",
    "start": "631519",
    "end": "638560"
  },
  {
    "text": "fall through to the the act the hex79 message and then we would see we'd have",
    "start": "638560",
    "end": "644399"
  },
  {
    "text": "access to the flash so that's that's what it looked like in",
    "start": "644399",
    "end": "649959"
  },
  {
    "text": "code uh what this appears like in time uh starting from the yellow up in the",
    "start": "649959",
    "end": "656480"
  },
  {
    "text": "left the readmemory command being transmitted to the target uh the picomp",
    "start": "656480",
    "end": "661920"
  },
  {
    "text": "here is monitoring the signal and will trigger at that last edge",
    "start": "661920",
    "end": "667360"
  },
  {
    "text": "uh and then initiate its programmable delay which will vary from glitch run to or glitch to glitch uh and then at some",
    "start": "667360",
    "end": "674720"
  },
  {
    "text": "program delay the glitch would happen here in green um and then the conclusion",
    "start": "674720",
    "end": "679920"
  },
  {
    "text": "of the cycle would be uh the response from the target in red which would be in",
    "start": "679920",
    "end": "685519"
  },
  {
    "text": "this case it's a knack but what this clearly defines here is the the the",
    "start": "685519",
    "end": "690560"
  },
  {
    "text": "ultimate window of uh where the RDP check would be happening so the blue blue arrow there indicates the um the",
    "start": "690560",
    "end": "698680"
  },
  {
    "text": "maximum uh range of the the the RDB check",
    "start": "698680",
    "end": "705320"
  },
  {
    "text": "so me hand it back over to Jonathan he'll continue with the process that we used thanks so we talked a little bit",
    "start": "705320",
    "end": "713839"
  },
  {
    "text": "about the rig um how to get started and what the attack is like so let's talk",
    "start": "713839",
    "end": "718880"
  },
  {
    "text": "about um actually implementing the attack how to how to begin how to get your rig basically functioning and then",
    "start": "718880",
    "end": "724480"
  },
  {
    "text": "we'll move on to some optimizations and results so here in the bottom left uh you can see a picture of our probe uh we",
    "start": "724480",
    "end": "731680"
  },
  {
    "text": "kind of constructed the probe following the instructions that are in the open source repo for Pico EMP so you can",
    "start": "731680",
    "end": "737040"
  },
  {
    "text": "follow those as well um you can see we sharpened the tip as uh they recommend as optional seemed to work for us we",
    "start": "737040",
    "end": "743839"
  },
  {
    "text": "also added this uh red wire here we just hot glued it on and the reason we did this of course Thanos mentioned that you",
    "start": "743839",
    "end": "750240"
  },
  {
    "text": "might be uh building your own picomp you might be soldering it yourself and you don't want to uh spend a lot of time uh",
    "start": "750240",
    "end": "756639"
  },
  {
    "text": "wasted if the picomp isn't working so this is an easy way hey if you hook this wire to your scope you can validate that",
    "start": "756639",
    "end": "763120"
  },
  {
    "text": "you're actually getting glitches when you expect to be and we ran it that way for a while until we got confidence on",
    "start": "763120",
    "end": "768320"
  },
  {
    "text": "our system um then in order to calibrate and continue kind of get your system set",
    "start": "768320",
    "end": "773360"
  },
  {
    "text": "up you're going to want to find sensitive spots on the chip and this helps you learn which areas can be most",
    "start": "773360",
    "end": "779839"
  },
  {
    "text": "susceptible to useful glitches um and the way you're going to do that um scan in a spiral um and you're going to want",
    "start": "779839",
    "end": "786639"
  },
  {
    "text": "to hit the chip as hard as you can uh using strong glitches and kind of what we define as strong glitches is where",
    "start": "786639",
    "end": "792880"
  },
  {
    "text": "you have a minimum distance between the pulse uh probe tip and the device itself",
    "start": "792880",
    "end": "798320"
  },
  {
    "text": "um as well you should have the maximum pulse power which is the longest time that the EMP switch is open so the",
    "start": "798320",
    "end": "804959"
  },
  {
    "text": "capacitor bank can dump all of its energy into the probe um and then it's",
    "start": "804959",
    "end": "810000"
  },
  {
    "text": "also important to use and this is less obvious but important to use the minimum VCC that you can with the chip and in",
    "start": "810000",
    "end": "816720"
  },
  {
    "text": "order to do that you're going to need to remove brownout protections from your target chip um and the way we did this",
    "start": "816720",
    "end": "823120"
  },
  {
    "text": "on the giga devices is there's a single pin uh which allows you to do so so we lifted that pin and then brownout",
    "start": "823120",
    "end": "828959"
  },
  {
    "text": "protections were removed so this puts the chip in the most vulnerable state the most pliable state and hits it as",
    "start": "828959",
    "end": "834880"
  },
  {
    "text": "hard as you can and then as mentioned you're going to go in a spiral glitch many times at each point and collect",
    "start": "834880",
    "end": "841279"
  },
  {
    "text": "data and what you're looking for um as you log all of this data is any response",
    "start": "841279",
    "end": "846639"
  },
  {
    "text": "from the chip at all and then you log all this data to create your map now one",
    "start": "846639",
    "end": "851680"
  },
  {
    "text": "of the fastest ways to see if you're having an influence on the chip is to measure its current draw and so it's",
    "start": "851680",
    "end": "857360"
  },
  {
    "text": "recommended here so if you see the current normally operates at around 65 milliamps if you glitch the part and see",
    "start": "857360",
    "end": "863360"
  },
  {
    "text": "that it drops to two milliamps 1 milliamps zero milliamps you know your glitch had an influence and you know",
    "start": "863360",
    "end": "868880"
  },
  {
    "text": "that's a sensitive spot so log it and keep going um other things you can look for if the part resets you can also",
    "start": "868880",
    "end": "875279"
  },
  {
    "text": "connect the debugger and log the uh program counter um you can look for um",
    "start": "875279",
    "end": "880639"
  },
  {
    "text": "like clock output signals if it has a clock out and the clock out um becomes malformed or stops operating completely",
    "start": "880639",
    "end": "887920"
  },
  {
    "text": "that's a good sign if you have external memory buses that are present and they stop functioning you can also consider",
    "start": "887920",
    "end": "894399"
  },
  {
    "text": "that influence so scan the chip map all this influence here you can see an example of one of our early on scans and",
    "start": "894399",
    "end": "901279"
  },
  {
    "text": "this is when we f found the first sensitive area here in",
    "start": "901279",
    "end": "906600"
  },
  {
    "text": "red so let's talk about why spirals well after we did some work we kind of came",
    "start": "906600",
    "end": "911680"
  },
  {
    "text": "to these observations we haven't seen really other people talk about it um but you can see here on the left that um is",
    "start": "911680",
    "end": "918160"
  },
  {
    "text": "a a picture of the dye in the chip which has been chemically exposed um and so",
    "start": "918160",
    "end": "924399"
  },
  {
    "text": "that's again a smaller version of the picture that Thanos showed earlier then in the middle here you can see an",
    "start": "924399",
    "end": "930000"
  },
  {
    "text": "example picture of what it would look like if we took away all the plastic from the part and what you're seeing there is called the lead frame and",
    "start": "930000",
    "end": "936320"
  },
  {
    "text": "that's um in a QFP in a quad flat pack device part um the D is mounted in the",
    "start": "936320",
    "end": "942560"
  },
  {
    "text": "center you have bond wires which connect to each one of these leads and then extends out to the pins on the edges",
    "start": "942560",
    "end": "949279"
  },
  {
    "text": "then what you see on the far right here is the result of one of our scans and there's some things we started to",
    "start": "949279",
    "end": "955279"
  },
  {
    "text": "observe once we were started uh scanning you can see that these sensitive regions pictured here kind of have alignment",
    "start": "955279",
    "end": "961759"
  },
  {
    "text": "with the edge of the leads in the lead frame and it kind of makes sense you know with electromagnetic glitching",
    "start": "961759",
    "end": "967519"
  },
  {
    "text": "you're kind of inducing currents in the leads um which kind of align with the edges of the lead frame so these were",
    "start": "967519",
    "end": "973360"
  },
  {
    "text": "interesting observations a couple of other things to note here are the colors of the dots",
    "start": "973360",
    "end": "979040"
  },
  {
    "text": "matter um it's kind of the pallet of a f a flame meaning the darker colors are",
    "start": "979040",
    "end": "984639"
  },
  {
    "text": "low current draw um as it goes to orange and red it's more current and white and bright yellow is even more current so",
    "start": "984639",
    "end": "991440"
  },
  {
    "text": "you can see there's a unique region here in the upper right uh where the current draw or the glitches typically cause a",
    "start": "991440",
    "end": "997600"
  },
  {
    "text": "brown out in other areas it's different it just so happens that there's some oscillator in pins here which probably",
    "start": "997600",
    "end": "1004480"
  },
  {
    "text": "cause the part to just crash so how do we further uh calibrate",
    "start": "1004480",
    "end": "1011759"
  },
  {
    "text": "and move forward with our attack so in the initial phase we're scanning we're look for any any sensitive spot and like",
    "start": "1011759",
    "end": "1017360"
  },
  {
    "text": "I said we're punching the chip really hard we're causing it to crash but if you cause the chip to crash you're not going to get any continuation so your",
    "start": "1017360",
    "end": "1023519"
  },
  {
    "text": "glitch is not really going to be useful so the second part of calibration is you know seeking to one particular sensitive",
    "start": "1023519",
    "end": "1029199"
  },
  {
    "text": "spot and then kind of dialing it back um you want to reduce the glitching power",
    "start": "1029199",
    "end": "1034480"
  },
  {
    "text": "so that you do get continuation and um the way to do that is to you know decrease the pulse power",
    "start": "1034480",
    "end": "1042000"
  },
  {
    "text": "and increase uh the voltage and kind of see what working ranges that you can uh come up with and those will be the",
    "start": "1042000",
    "end": "1049120"
  },
  {
    "text": "ranges that you use in your brute force attack it's also useful to find a minimum",
    "start": "1049120",
    "end": "1055840"
  },
  {
    "text": "voltage the minimum VCC so here we saw that the chip can operate barely down to",
    "start": "1055840",
    "end": "1062080"
  },
  {
    "text": "1.5 volts with u brownout protections removed um and at that uh at that",
    "start": "1062080",
    "end": "1067840"
  },
  {
    "text": "voltage any almost anytime we glitch it 98% of the time when we glitch it the debugger is unable to connect at that",
    "start": "1067840",
    "end": "1074160"
  },
  {
    "text": "point and read the PC so the part is definitely locking up or at least portions of it are also at that voltage",
    "start": "1074160",
    "end": "1080240"
  },
  {
    "text": "about half the time the current drops to zero browns out raising it even a tenth of a volt",
    "start": "1080240",
    "end": "1087280"
  },
  {
    "text": "those numbers drop down to 30% and another hundth of a volt above that the",
    "start": "1087280",
    "end": "1092320"
  },
  {
    "text": "chip starts to mostly have some some influence but it doesn't always brown out which is useful so this is kind of a",
    "start": "1092320",
    "end": "1098559"
  },
  {
    "text": "boundary where the chip is very susceptible and is a good place to glitch and here I call it a balance mix",
    "start": "1098559",
    "end": "1105760"
  },
  {
    "text": "but it's kind of like the borderline between an operation and uh you know glitch always causing a failure and I",
    "start": "1105760",
    "end": "1112320"
  },
  {
    "text": "want to point out too that each sensitive area might have a different uh calibration between pulse power and VCC",
    "start": "1112320",
    "end": "1118720"
  },
  {
    "text": "um so if you move to a new area you might find it useful to recalibrate let's also talk about um",
    "start": "1118720",
    "end": "1125919"
  },
  {
    "text": "other ways of characterizing the level of glitch influence if you connect the debugger after the glitch you can read",
    "start": "1125919",
    "end": "1132960"
  },
  {
    "text": "the PC and kind of learn something from that right if the PC is unreadable at we as we mentioned you might consider that",
    "start": "1132960",
    "end": "1139200"
  },
  {
    "text": "extreme in influence the parts locked if the glitch is in an ISR maybe",
    "start": "1139200",
    "end": "1144799"
  },
  {
    "text": "it jumps to a hard fault or a bus fault and just loops there and draw and and you can see that as well that's more of",
    "start": "1144799",
    "end": "1151200"
  },
  {
    "text": "like a medium level influence or maybe the PC is still in the expected code loop in our case we were attacking the",
    "start": "1151200",
    "end": "1157280"
  },
  {
    "text": "bootloadader so it was in a serial receive loop so if it's still in that loop maybe it only jumped one and two",
    "start": "1157280",
    "end": "1162880"
  },
  {
    "text": "instructions or maybe it jumped no instructions so that's kind of a low or an optimum influence in some",
    "start": "1162880",
    "end": "1169240"
  },
  {
    "text": "ways by reading the PC you can also see other useful things did it jump to RAM",
    "start": "1169240",
    "end": "1174480"
  },
  {
    "text": "did it jump to other memory addresses that are useful so it's it's also useful for other reasons",
    "start": "1174480",
    "end": "1180960"
  },
  {
    "text": "so once you have kind of a calibration you've picked a sensitive spot um you're progressing in your attack let's talk",
    "start": "1180960",
    "end": "1187760"
  },
  {
    "text": "about things you can do to optimize it and have better results faster you know as Thanos mentioned a stable trigger is",
    "start": "1187760",
    "end": "1194400"
  },
  {
    "text": "really important um you know you're going to need hard timing between your trigger your delay and your glitch and",
    "start": "1194400",
    "end": "1201360"
  },
  {
    "text": "it needs to be on the nancond scale you know in the order of clock cycles if you",
    "start": "1201360",
    "end": "1206480"
  },
  {
    "text": "don't have this you're not likely to be successful you know don't try to read from an IO pin then issue a trigger then",
    "start": "1206480",
    "end": "1213120"
  },
  {
    "text": "issue a glitch over USB or something it's not likely to be uh",
    "start": "1213120",
    "end": "1218280"
  },
  {
    "text": "successful and for certain attacks you know glitching sooner in the boot process is definitely better you know",
    "start": "1218280",
    "end": "1224799"
  },
  {
    "text": "once you uh get multitasking going multiprocessing you're going to have a lot of complexity there it's going to be",
    "start": "1224799",
    "end": "1229919"
  },
  {
    "text": "really hard to kind of understand what's going on and place your glitch",
    "start": "1229919",
    "end": "1235520"
  },
  {
    "text": "another thing that can be really useful is ARM fault status registers um if you",
    "start": "1235520",
    "end": "1240799"
  },
  {
    "text": "do have a fault there's registers in ARM which will record the location of the faulting program counter so if you use a",
    "start": "1240799",
    "end": "1248240"
  },
  {
    "text": "strong glitch and you get a fault you can then connect the debugger and find out exactly where that glitch was in",
    "start": "1248240",
    "end": "1254640"
  },
  {
    "text": "time which is very useful it helps calibrate your glitch point to your exact code that was running at the time",
    "start": "1254640",
    "end": "1260320"
  },
  {
    "text": "um and this can help to reduce uh the delay window down from the large one that kind of um Thanos was describing",
    "start": "1260320",
    "end": "1267679"
  },
  {
    "text": "down to one which is much much smaller and it's a huge optimization i will point out that",
    "start": "1267679",
    "end": "1273840"
  },
  {
    "text": "there's also a blog by Memfalt um he'll explain all about",
    "start": "1273840",
    "end": "1279000"
  },
  {
    "text": "it and if you can't read these registers again you're kind of reduced to a much wider brute force uh",
    "start": "1279000",
    "end": "1286200"
  },
  {
    "text": "range and again we're still talking glitch rate optimization is key um we talked about correlated parameters",
    "start": "1286200",
    "end": "1293120"
  },
  {
    "text": "correlated dimensions with voltage and VCC and your Z distance um but what might not be obvious is you don't need",
    "start": "1293120",
    "end": "1299600"
  },
  {
    "text": "to vary all of them in your brute force loop you know you can kind of fix at a you can kind of fix that one VCC um and",
    "start": "1299600",
    "end": "1307039"
  },
  {
    "text": "then uh vary the pulse uh power and also kind of leave Z where it is we didn't",
    "start": "1307039",
    "end": "1312559"
  },
  {
    "text": "really find it useful to vary Z and as mentioned also um classify",
    "start": "1312559",
    "end": "1318880"
  },
  {
    "text": "glitch results as fast as you can if in our case we're using a a attack to the",
    "start": "1318880",
    "end": "1324320"
  },
  {
    "text": "bootloader which is over a serial protocol so we issue a command and wait for a response right now if we issue a",
    "start": "1324320",
    "end": "1330880"
  },
  {
    "text": "command perform our glitch and we can see that there's zero current draw from the part why would we wait another",
    "start": "1330880",
    "end": "1337360"
  },
  {
    "text": "second or two to see that the protocol doesn't respond at the time the current drops to zero we already know the part's",
    "start": "1337360",
    "end": "1343360"
  },
  {
    "text": "incapable of responding so at that point you should terminate the glitch glitch loop and go to the next glitch this is",
    "start": "1343360",
    "end": "1349360"
  },
  {
    "text": "also a big optimization we also found that um minimizing the EMP",
    "start": "1349360",
    "end": "1356480"
  },
  {
    "text": "charging time was another big one um out of the box uh the open source code the",
    "start": "1356480",
    "end": "1362320"
  },
  {
    "text": "Pico EMP can take like one and a half to two seconds to charge so I did a little fuzzing to figure out the optimum charge",
    "start": "1362320",
    "end": "1369039"
  },
  {
    "text": "rate the the uh PWM charge frequency and",
    "start": "1369039",
    "end": "1374240"
  },
  {
    "text": "duty cycle that worked well um so we kind of found a couple parameter sets that we were using here to take the time",
    "start": "1374240",
    "end": "1380720"
  },
  {
    "text": "down from like one and a half two seconds to a third of a second or a quarter of a second so another huge",
    "start": "1380720",
    "end": "1387000"
  },
  {
    "text": "optimization definitely try to parallelize things um you know move while you're charging it's kind of",
    "start": "1387000",
    "end": "1392480"
  },
  {
    "text": "obvious and again Thanos already mentioned keep track of your uh timing of your code loops in your logs um you",
    "start": "1392480",
    "end": "1399600"
  },
  {
    "text": "can see if they start increasing if you add one small thing in code sometimes it's not obvious that it's going to add a lot of time to your glitch",
    "start": "1399600",
    "end": "1407520"
  },
  {
    "text": "loop so with analysis in the beginning we were looking at a lot of textbased",
    "start": "1407960",
    "end": "1414559"
  },
  {
    "text": "logs and trying to make decisions and that became very challenging over time and eventually we broke down and like",
    "start": "1414559",
    "end": "1420159"
  },
  {
    "text": "okay let's start graphing and analyzing it from different perspectives um and",
    "start": "1420159",
    "end": "1425280"
  },
  {
    "text": "it's a must we'll show you some analysis in a couple of slides um and you'll kind of see",
    "start": "1425280",
    "end": "1431159"
  },
  {
    "text": "that also when you're making decisions consider if your observation is",
    "start": "1431159",
    "end": "1436480"
  },
  {
    "text": "unambiguous and don't be too rigid in how you're doing your analysis and especially try to frame it in the",
    "start": "1436480",
    "end": "1442880"
  },
  {
    "text": "context of the sock subsystems that are available on your chip for instance if you have a reset is that because you",
    "start": "1442880",
    "end": "1449840"
  },
  {
    "text": "triggered a brownout circuit is it because you jumped to an ISR and then a watchdog triggered um is it because",
    "start": "1449840",
    "end": "1456000"
  },
  {
    "text": "there's a clock monitoring circuit and you glitched a clock line and that caused the reset so the same thing can",
    "start": "1456000",
    "end": "1462000"
  },
  {
    "text": "you know have actually different causes and we definitely use an unlock development board not only to get",
    "start": "1462000",
    "end": "1467919"
  },
  {
    "text": "firmware but to compare sensitive regions and things like that so that was also",
    "start": "1467919",
    "end": "1473640"
  },
  {
    "text": "useful so what if you get stuck or you get lost you know try a new sensitive region jump from the one you've been",
    "start": "1473640",
    "end": "1479919"
  },
  {
    "text": "working on to a new one recalibrate rescan you know definitely also do",
    "start": "1479919",
    "end": "1485159"
  },
  {
    "text": "this if you see no influence or things change unexpectedly if you change the",
    "start": "1485159",
    "end": "1491279"
  },
  {
    "text": "probe tip or change the EMP pulser itself um you know a good time to",
    "start": "1491279",
    "end": "1496880"
  },
  {
    "text": "recalibrate and if you're completely stuck you know it's kind of hard to give advice on a",
    "start": "1496880",
    "end": "1502799"
  },
  {
    "text": "program um problem I don't have a lot of details about but in general controlling variables precisely is really important",
    "start": "1502799",
    "end": "1509039"
  },
  {
    "text": "in EMFI including timing target voltage and things of this nature so make sure",
    "start": "1509039",
    "end": "1514480"
  },
  {
    "text": "you're controlling them accurately and measuring accurately so let's talk about uh the",
    "start": "1514480",
    "end": "1522159"
  },
  {
    "text": "results so there's a lot going on here um but from the top of the slide is the",
    "start": "1522159",
    "end": "1527440"
  },
  {
    "text": "file name of our log um there's about 200,000 glitches in this particular run",
    "start": "1527440",
    "end": "1532799"
  },
  {
    "text": "um we were running at um looks like 1.62 volts um there's some delay and uh pulse",
    "start": "1532799",
    "end": "1539600"
  },
  {
    "text": "power um counters there uh D and P and those are in increments of 8 nonds",
    "start": "1539600",
    "end": "1546880"
  },
  {
    "text": "so looking more closely at the graphs um each square in the center you have in",
    "start": "1546880",
    "end": "1552960"
  },
  {
    "text": "the blue the main die and the flash chiplet and then around the edge you have the part pins um and then with pin",
    "start": "1552960",
    "end": "1559760"
  },
  {
    "text": "one being in the top right so some things of note you know starting at the bottom right you can see",
    "start": "1559760",
    "end": "1566400"
  },
  {
    "text": "you know there were quite a bit of brownouts but we also had modified code flows so we had a mix of you know uh",
    "start": "1566400",
    "end": "1572799"
  },
  {
    "text": "part crashes and continuations so we can tell that we're kind of operating in a sweet",
    "start": "1572799",
    "end": "1579159"
  },
  {
    "text": "spot additionally you can see um we had dead beefs and dead beef is when we",
    "start": "1579159",
    "end": "1584640"
  },
  {
    "text": "connected the debugger and couldn't read the PC at all um we had some times where we jumped to SRAMM um we had times when",
    "start": "1584640",
    "end": "1591840"
  },
  {
    "text": "we jumped to other ISRs um again as mentioned modified code flows so we were",
    "start": "1591840",
    "end": "1597600"
  },
  {
    "text": "still running but we were not in the original serial receive loop as we expected um and then probably most",
    "start": "1597600",
    "end": "1603520"
  },
  {
    "text": "importantly um we had some actual acts so here's 48 that we had over this",
    "start": "1603520",
    "end": "1609360"
  },
  {
    "text": "particular run um and they weren't all necessarily continuation meaning it",
    "start": "1609360",
    "end": "1614640"
  },
  {
    "text": "might have returned an act but crashed sometimes after or had memory corruption after and crashed something like this um",
    "start": "1614640",
    "end": "1620640"
  },
  {
    "text": "but that's at least um 48 that passed the initial check",
    "start": "1620640",
    "end": "1627679"
  },
  {
    "text": "so you know 10 million glitches later we were successful right um from the",
    "start": "1627679",
    "end": "1633200"
  },
  {
    "text": "beginning to this point we spent about four months but we had never done it before we built it from scratch we",
    "start": "1633200",
    "end": "1638960"
  },
  {
    "text": "programmed it from scratch um and we were at least happy to get to this uh point unfortunately after we got",
    "start": "1638960",
    "end": "1646440"
  },
  {
    "text": "continuation further when it tried to read the flash we had some hard hard faults and this is described in the data",
    "start": "1646440",
    "end": "1652960"
  },
  {
    "text": "sheet it wasn't unexpected but we felt like we wanted to check this so the flash is disabled um even with the",
    "start": "1652960",
    "end": "1658240"
  },
  {
    "text": "debugger disconnected in bootloadader mode so what do we do next well from our",
    "start": "1658240",
    "end": "1664760"
  },
  {
    "text": "experimentation we had observed that the SRAMM contents of this part are persistent after hardware reset so if",
    "start": "1664760",
    "end": "1671039"
  },
  {
    "text": "you do a pin reset the SRAM stays so we thought all right well that's at least a starting point uh we had also noticed",
    "start": "1671039",
    "end": "1677360"
  },
  {
    "text": "that um you know we had logged some jumps to PCRAM um as we saw before so",
    "start": "1677360",
    "end": "1684480"
  },
  {
    "text": "let's combine those two right so for the second attack we decided to inject a knops slide into SRAMM followed by a",
    "start": "1684480",
    "end": "1691919"
  },
  {
    "text": "dump routine and then reset and glitch early during reboot as we kind of talked about and see what happens",
    "start": "1691919",
    "end": "1699440"
  },
  {
    "text": "and I will point out that um there are several important regions to uh save not only the flash region and this part has",
    "start": "1699440",
    "end": "1706240"
  },
  {
    "text": "a batterybacked SRAMM region which is locked as well as some um PC RTC",
    "start": "1706240",
    "end": "1711679"
  },
  {
    "text": "registers which have some user data you could store and we wanted to make sure we captured those in case there was key",
    "start": "1711679",
    "end": "1717279"
  },
  {
    "text": "material or something there so this is a little bit of a nod to prior research you know brute forcing",
    "start": "1717279",
    "end": "1723919"
  },
  {
    "text": "is a big waiting game you know it can feel like this um but hopefully some of the things we mentioned in this talk can",
    "start": "1723919",
    "end": "1729440"
  },
  {
    "text": "help you minimize this part um and I will say um from the beginning to the",
    "start": "1729440",
    "end": "1735679"
  },
  {
    "text": "first attack again took the bulk of the time and then about two days later after the pivot um we were actually successful",
    "start": "1735679",
    "end": "1742159"
  },
  {
    "text": "in extracting the flash and so here you can see this is the log line we're operating at 2 volts these are the",
    "start": "1742159",
    "end": "1749200"
  },
  {
    "text": "coordinates of the glitch uh in XYZ um we're using a delay of 7.8 8",
    "start": "1749200",
    "end": "1755960"
  },
  {
    "text": "milliseconds and the um EMP switch was open for 288 nconds um and we were able",
    "start": "1755960",
    "end": "1762640"
  },
  {
    "text": "to get it to jump to our knop slide slide down to our firmware extraction routine and extract the firmware so we",
    "start": "1762640",
    "end": "1768640"
  },
  {
    "text": "were happy to get to this point after such a long effort also a bonus to everyone um",
    "start": "1768640",
    "end": "1776080"
  },
  {
    "text": "during this time we found a simple bypass so while we were developing the",
    "start": "1776080",
    "end": "1781520"
  },
  {
    "text": "um code uh for firmware extraction in SRAMM we kept um you know copying it to",
    "start": "1781520",
    "end": "1787120"
  },
  {
    "text": "SRAMM changing it debugging it and doing this so at one point when we copied the",
    "start": "1787120",
    "end": "1792240"
  },
  {
    "text": "SRAMM we set the PC um to the SRAMM as well we disconnected the debugger and we",
    "start": "1792240",
    "end": "1797760"
  },
  {
    "text": "found out that the part started running free and then spit the flash out so um",
    "start": "1797760",
    "end": "1803120"
  },
  {
    "text": "nice bonus for for that um and you know clearly it's something that uh shouldn't happen but you know kind of going back",
    "start": "1803120",
    "end": "1809760"
  },
  {
    "text": "to the beginning it's important to try all your edge cases and exercise everything don't believe what the data",
    "start": "1809760",
    "end": "1815200"
  },
  {
    "text": "sheet says for sure so let's talk about some mitigation so uh giga devices probably can patch",
    "start": "1815200",
    "end": "1823200"
  },
  {
    "text": "this in a follow on tape out at least the bypass um maybe they can uh change a few things without a lot of redesign and",
    "start": "1823200",
    "end": "1829760"
  },
  {
    "text": "cost and expense it's possible um but I think um applying additional hardware to",
    "start": "1829760",
    "end": "1836000"
  },
  {
    "text": "do EMFI mitigations is not so easy and it seems unlikely so even if they do",
    "start": "1836000",
    "end": "1841600"
  },
  {
    "text": "patch the bypass probably still have a route in through EMFI another interesting thing to note",
    "start": "1841600",
    "end": "1848159"
  },
  {
    "text": "is at one point when we were researching we decided to up um update our JLink um",
    "start": "1848159",
    "end": "1854799"
  },
  {
    "text": "we applied new firmware and then the next thing you know we saw this dialogue in the bottom um and basically the",
    "start": "1854799",
    "end": "1860960"
  },
  {
    "text": "dialogue is saying you're not allowed to connect to the part at all anymore um you must erase the part and and as a",
    "start": "1860960",
    "end": "1867760"
  },
  {
    "text": "result of unracing it also unlocks it and then you can use a blank part so we were like hey this used to work before",
    "start": "1867760",
    "end": "1874240"
  },
  {
    "text": "what happened um we rolled the application firmware back um while",
    "start": "1874240",
    "end": "1879360"
  },
  {
    "text": "leaving the JLink firmware in the latest version and once we rolled the application firmware back um this uh",
    "start": "1879360",
    "end": "1885840"
  },
  {
    "text": "dialogue went away and we were able to use the part so in effect this is a pseudo mitigation is this something that",
    "start": "1885840",
    "end": "1891679"
  },
  {
    "text": "Segre did on purpose in terms of security did they work with Giga devices we don't know the answer to any of that",
    "start": "1891679",
    "end": "1897519"
  },
  {
    "text": "um but long story short it does block research and to lock parts and it's not",
    "start": "1897519",
    "end": "1902799"
  },
  {
    "text": "cool and it's offiscation so if you're going to do re this kind of research either don't use the latest version of",
    "start": "1902799",
    "end": "1908799"
  },
  {
    "text": "JLink or um you know yeah just don't so you know overall what have we",
    "start": "1908799",
    "end": "1915440"
  },
  {
    "text": "learned you know fault injection is brute force course it can take a lot of time um but hopefully we've given you",
    "start": "1915440",
    "end": "1920799"
  },
  {
    "text": "guys a lot of tips and things that can help reduce the time you know as we talked about the PZ VCC correlation the",
    "start": "1920799",
    "end": "1928480"
  },
  {
    "text": "charge rate optimization we also optimize commands inside the Pico EMP um",
    "start": "1928480",
    "end": "1934720"
  },
  {
    "text": "and certainly the ARM fault status registers as well are very useful for reducing your overall brute force uh",
    "start": "1934720",
    "end": "1941600"
  },
  {
    "text": "kind of space and helping you get uh results faster so prepare yourself for brute force don't get discouraged this",
    "start": "1941600",
    "end": "1948159"
  },
  {
    "text": "was our first time but we got it to work so in the end you know again we",
    "start": "1948159",
    "end": "1954559"
  },
  {
    "text": "have a simple bypass even if it's patched you probably still have a way in through glitching um and we feel like",
    "start": "1954559",
    "end": "1961440"
  },
  {
    "text": "with EMFI there's kind of a a basic process you can use in terms of um you",
    "start": "1961440",
    "end": "1966880"
  },
  {
    "text": "know calibration scanning for sensitive areas do some tuning to optimize make sure you're analyzing your",
    "start": "1966880",
    "end": "1974000"
  },
  {
    "text": "data as you're going you know graph it from multiple angles make sure you're documenting your data um keep tabs on",
    "start": "1974000",
    "end": "1981519"
  },
  {
    "text": "your glitch rate um and you can also be successful so I don't know if there's",
    "start": "1981519",
    "end": "1987039"
  },
  {
    "text": "any questions um [Applause]",
    "start": "1987039",
    "end": "1996480"
  }
]