[
  {
    "text": "[Music]",
    "start": "1130",
    "end": "14690"
  },
  {
    "text": "hi everyone thanks for tuning in to this black hat briefing my name is colin estep",
    "start": "18800",
    "end": "24320"
  },
  {
    "text": "and i'm a senior security researcher at netskope threat labs today i'm going to be talking about",
    "start": "24320",
    "end": "29920"
  },
  {
    "text": "permission mining in gcp so first i want to go through a concept",
    "start": "29920",
    "end": "34960"
  },
  {
    "text": "i'm calling i am exposure which is the risk related to the identity and access management in our",
    "start": "34960",
    "end": "41760"
  },
  {
    "text": "cloud environments then i'm going to go into a little bit of detail about how",
    "start": "41760",
    "end": "46800"
  },
  {
    "text": "identity and access management works in gcp specifically since our project is related to gcp",
    "start": "46800",
    "end": "54320"
  },
  {
    "text": "then i'm going to present a real example that we found in a production gcp environment and walk you through how",
    "start": "54320",
    "end": "60960"
  },
  {
    "text": "we found that example by showing you our permission mining solution which is a project that we're",
    "start": "60960",
    "end": "67200"
  },
  {
    "text": "going to be releasing to the open source community along with this talk lastly i'll be",
    "start": "67200",
    "end": "72799"
  },
  {
    "text": "going through some results that we produce from our solution remediation steps that we've seen and",
    "start": "72799",
    "end": "78720"
  },
  {
    "text": "future enhancements for the project",
    "start": "78720",
    "end": "82400"
  },
  {
    "text": "data exposure for cloud environments has been in the news quite a bit i think we've all seen these headlines",
    "start": "83840",
    "end": "89439"
  },
  {
    "text": "that talk about some kind of a data breach or data leak from a storage bucket we",
    "start": "89439",
    "end": "94640"
  },
  {
    "text": "don't see the same amount of coverage in the media about i am exposure but it's an important topic that i think",
    "start": "94640",
    "end": "100000"
  },
  {
    "text": "deserves consideration from any organization that might be using the cloud",
    "start": "100000",
    "end": "105840"
  },
  {
    "text": "so what do i mean by i am exposure mainly it's the risk associated with",
    "start": "105840",
    "end": "111759"
  },
  {
    "text": "each user in your environment if you knew what each of your users were capable of",
    "start": "111759",
    "end": "117439"
  },
  {
    "text": "then this would be an easy thing to evaluate unfortunately i think most organizations",
    "start": "117439",
    "end": "123280"
  },
  {
    "text": "are not able to answer that question and we have seen incidents related to this happening in the wild",
    "start": "123280",
    "end": "129280"
  },
  {
    "text": "the most egregious example happened to a company named codespaces they ran their business from aws and",
    "start": "129280",
    "end": "136879"
  },
  {
    "text": "an attacker was able to gain access to the environment the attacker demanded a ransom from the",
    "start": "136879",
    "end": "142000"
  },
  {
    "text": "company and instead of giving in code spaces attempted to evict the attacker",
    "start": "142000",
    "end": "148560"
  },
  {
    "text": "they did not have a great insight into how strong of a foothold the attacker had so their",
    "start": "148560",
    "end": "154319"
  },
  {
    "text": "attempts were unsuccessful and unfortunately the attacker ended up deleting",
    "start": "154319",
    "end": "159840"
  },
  {
    "text": "all of their data and their resources so it got to a point where code spaces",
    "start": "159840",
    "end": "164879"
  },
  {
    "text": "couldn't recover and had to go out of business even if you're confident that an attack",
    "start": "164879",
    "end": "170400"
  },
  {
    "text": "like this would not happen to that extent within your organization it's extremely important to monitor and",
    "start": "170400",
    "end": "176239"
  },
  {
    "text": "audit the risk your users pose i think we all want to be able to answer some simple questions",
    "start": "176239",
    "end": "181920"
  },
  {
    "text": "like what can all of my users do and what is the likelihood that any compromised credential",
    "start": "181920",
    "end": "187920"
  },
  {
    "text": "could result in administrator level access to my environment",
    "start": "187920",
    "end": "193440"
  },
  {
    "text": "as cloud customers it's our responsibility to figure out what kind of permissions to grant to each user this is part of the shared",
    "start": "193840",
    "end": "201120"
  },
  {
    "text": "responsibility model that we adopt when we become a cloud customer",
    "start": "201120",
    "end": "207200"
  },
  {
    "text": "so unfortunately there's some factors that lead to us not being able to do this successfully every time some examples",
    "start": "207200",
    "end": "214400"
  },
  {
    "text": "may be hey there's a project that really needs to get off the ground quick",
    "start": "214400",
    "end": "219920"
  },
  {
    "text": "and we're under a time crunch to provision the right privileges so that",
    "start": "219920",
    "end": "225200"
  },
  {
    "text": "there's no friction there so we may provision too many privileges in advance and think oh we'll come back and tune it",
    "start": "225200",
    "end": "231840"
  },
  {
    "text": "later but later never comes also we may have some confusion about",
    "start": "231840",
    "end": "237439"
  },
  {
    "text": "the capability that we're granting when we provision these permissions i borrowed",
    "start": "237439",
    "end": "242799"
  },
  {
    "text": "this diagram on the slide from aws's documentation and as you can tell from looking at this",
    "start": "242799",
    "end": "248319"
  },
  {
    "text": "diagram determining whether or not something will be allowed isn't always a simple process so",
    "start": "248319",
    "end": "254239"
  },
  {
    "text": "it's easy to get confused and even if we are able to provision our permissions successfully",
    "start": "254239",
    "end": "261919"
  },
  {
    "text": "the first time around and in a way that we're confident it's difficult to audit",
    "start": "261919",
    "end": "267600"
  },
  {
    "text": "indirect permissions or the implication of these permissions at scale",
    "start": "267600",
    "end": "273600"
  },
  {
    "text": "since cloud environments are really dynamic the implications can change over time",
    "start": "273600",
    "end": "280160"
  },
  {
    "text": "so now that i've given you a brief overview of the problem let's talk a little bit more about im",
    "start": "280400",
    "end": "285680"
  },
  {
    "text": "and gcp specifically there's four different identity types in",
    "start": "285680",
    "end": "290720"
  },
  {
    "text": "gcp which are called members users and groups are pretty straightforward it's similar to any",
    "start": "290720",
    "end": "296479"
  },
  {
    "text": "other system you might deal with a domain is related to what you find in g suite",
    "start": "296479",
    "end": "303360"
  },
  {
    "text": "where you set up say netscope.com and then all of your users have a netscope.com",
    "start": "303360",
    "end": "308560"
  },
  {
    "text": "email address so if you're using g suite and then you want to give everyone in gcp a baseline permission",
    "start": "308560",
    "end": "316400"
  },
  {
    "text": "you can grant that to the domain and then lastly service accounts",
    "start": "316400",
    "end": "321680"
  },
  {
    "text": "are what you use if you want to provide programmatic access to an app or a resource since",
    "start": "321680",
    "end": "329680"
  },
  {
    "text": "all these are different you might think that you have to do something differently for each one but actually the permissions are",
    "start": "329680",
    "end": "336479"
  },
  {
    "text": "assigned to them in the same way now let's go through some terminology",
    "start": "336479",
    "end": "342560"
  },
  {
    "text": "especially around how these permissions are assigned so in gcp they call a permission",
    "start": "342560",
    "end": "348960"
  },
  {
    "text": "basically allowing a specific api call so in this diagram on the slide i'm showing an example of",
    "start": "348960",
    "end": "355680"
  },
  {
    "text": "some permissions and you'll see compute instance delete compute instances get and some other ones these",
    "start": "355680",
    "end": "362240"
  },
  {
    "text": "are actual api calls that are being allowed but we don't want to go one by one and",
    "start": "362240",
    "end": "367280"
  },
  {
    "text": "assigned individual api calls to a user so instead we use a role and a role is",
    "start": "367280",
    "end": "373919"
  },
  {
    "text": "just a collection of these permissions but that's what we need in order to be able to assign the permissions",
    "start": "373919",
    "end": "379680"
  },
  {
    "text": "to a particular member when we when we end up assigning",
    "start": "379680",
    "end": "385840"
  },
  {
    "text": "permissions to a member that's called a binding so that's the relationship between a",
    "start": "385840",
    "end": "391919"
  },
  {
    "text": "role and a member and a collection of bindings is called an i am policy in gcp",
    "start": "391919",
    "end": "399600"
  },
  {
    "text": "so there's also different types of roles that we're going to be referring to throughout this talk",
    "start": "399600",
    "end": "405199"
  },
  {
    "text": "the first one is called a basic rule and these roles are pre-packaged in every",
    "start": "405199",
    "end": "410479"
  },
  {
    "text": "gcp environment however google recommends that you don't use them unless you really know how they",
    "start": "410479",
    "end": "416160"
  },
  {
    "text": "work and that's because they're very permissive they're very broad and so they could give a member too many",
    "start": "416160",
    "end": "424080"
  },
  {
    "text": "privileges if you don't understand them well the second type of role is called predefined",
    "start": "424080",
    "end": "429599"
  },
  {
    "text": "roles and these are also provided by google out of the box in every gcp environment",
    "start": "429599",
    "end": "435360"
  },
  {
    "text": "and they're more job-based so the example i had in the previous slide was the role of compute instance admin",
    "start": "435360",
    "end": "442080"
  },
  {
    "text": "this is an example of one of the predefined roles that they come out with that's a little more granular than the basic rules so they do",
    "start": "442080",
    "end": "449199"
  },
  {
    "text": "recommend using pre-defined roles and then lastly if you're an advanced customer and you really understand",
    "start": "449199",
    "end": "455840"
  },
  {
    "text": "how these permissions work and where you want them you can create your own custom roles to give members",
    "start": "455840",
    "end": "464000"
  },
  {
    "text": "another thing we need to understand is that there's a hierarchy in gcp the top level item is called an",
    "start": "464000",
    "end": "470639"
  },
  {
    "text": "organization so this is similar to the concept in g suite of a domain",
    "start": "470639",
    "end": "475919"
  },
  {
    "text": "so if i have netscope.com that will be my organization and then under that i can",
    "start": "475919",
    "end": "482720"
  },
  {
    "text": "create folders and folders could represent anything from different geographies",
    "start": "482720",
    "end": "488000"
  },
  {
    "text": "different teams or business units within your organization",
    "start": "488000",
    "end": "493120"
  },
  {
    "text": "and as shown here folders can actually be embedded within other folders so you can have quite a",
    "start": "493120",
    "end": "500000"
  },
  {
    "text": "big sort of tree next we have projects",
    "start": "500000",
    "end": "505199"
  },
  {
    "text": "and projects are used to group resources together so as we see here in this example you",
    "start": "505199",
    "end": "511120"
  },
  {
    "text": "can have dev test and prod in different projects and so that way there's a boundary between these things so that",
    "start": "511120",
    "end": "518000"
  },
  {
    "text": "you don't have um you know production data in a dev environment for example",
    "start": "518000",
    "end": "525760"
  },
  {
    "text": "and then last we have the resource level and these are individual virtual machines buckets databases anything like that",
    "start": "525760",
    "end": "532720"
  },
  {
    "text": "that you're going to be creating and those always have to exist in a project",
    "start": "532720",
    "end": "538639"
  },
  {
    "text": "so now that we've covered both the i am structure and then the hierarchy in gcp let's put",
    "start": "539760",
    "end": "545680"
  },
  {
    "text": "these two things together so this slide shows a diagram on the left side we see",
    "start": "545680",
    "end": "551760"
  },
  {
    "text": "the i am policy and on the right side we see the hierarchy in gcp",
    "start": "551760",
    "end": "557440"
  },
  {
    "text": "and what we're trying to show here is the relationship between the two and what this is showing is that you can",
    "start": "557440",
    "end": "564560"
  },
  {
    "text": "basically assign permissions at any level in the hierarchy within gcp",
    "start": "564560",
    "end": "570399"
  },
  {
    "text": "so i could assign a user permissions at the organization level but i have to know that those",
    "start": "570399",
    "end": "576800"
  },
  {
    "text": "permissions are going to be inherited all the way through the organization so",
    "start": "576800",
    "end": "582399"
  },
  {
    "text": "any folder that gets created any project and any resource in the entire environment will inherit",
    "start": "582399",
    "end": "589120"
  },
  {
    "text": "those permissions from the organization there's no inherent way within iam and",
    "start": "589120",
    "end": "594399"
  },
  {
    "text": "gcp to deny access that's already been granted so you have to think about this and plan",
    "start": "594399",
    "end": "601279"
  },
  {
    "text": "ahead when you're provisioning your permissions in a gcp environment so that you don't get caught up",
    "start": "601279",
    "end": "607120"
  },
  {
    "text": "in an unexpected scenario of having a top level entity be able to operate on",
    "start": "607120",
    "end": "613519"
  },
  {
    "text": "resources you don't want them to have access to",
    "start": "613519",
    "end": "619839"
  },
  {
    "text": "so now that we've covered some of those concepts at a high level let's dive a little bit deeper into",
    "start": "620079",
    "end": "625360"
  },
  {
    "text": "service accounts the reason why i'm going to talk about that is that this is directly applicable",
    "start": "625360",
    "end": "631200"
  },
  {
    "text": "to our project and they're kind of unique in gcp because they're both identities and resources",
    "start": "631200",
    "end": "638720"
  },
  {
    "text": "and since they're resources they must be created in a project in gcp just like any other resource",
    "start": "638720",
    "end": "647279"
  },
  {
    "text": "so here's an example where we have a project that has several service accounts in it",
    "start": "647279",
    "end": "652880"
  },
  {
    "text": "and then we have a user that we want to give access to be able to use a service account now what this means is that the user",
    "start": "652880",
    "end": "659279"
  },
  {
    "text": "will be able to actually activate that service account which means the user will be able to assume",
    "start": "659279",
    "end": "666000"
  },
  {
    "text": "the identity of the service account and be able to use its permissions to conduct some api",
    "start": "666000",
    "end": "672240"
  },
  {
    "text": "calls so here i'm showing the i am binding at just one service account",
    "start": "672240",
    "end": "677839"
  },
  {
    "text": "so this red box is just telling us that hey he can't see",
    "start": "677839",
    "end": "685680"
  },
  {
    "text": "or activate any other service account in the project it's just this one",
    "start": "685680",
    "end": "691920"
  },
  {
    "text": "however if i put an i am binding for the user at the project level now that user can enumerate and activate",
    "start": "691920",
    "end": "700160"
  },
  {
    "text": "any service account in that project",
    "start": "700160",
    "end": "704480"
  },
  {
    "text": "so let's go through a real example in gcp to make this even more concrete",
    "start": "705680",
    "end": "711519"
  },
  {
    "text": "so here i'm showing a gcp environment and this is a real example in a",
    "start": "711519",
    "end": "716560"
  },
  {
    "text": "production environment so i mentioned folders earlier but you don't really need to have",
    "start": "716560",
    "end": "722560"
  },
  {
    "text": "folders if you don't want to you can have an organization node and then you could have a bunch of projects under the organization directly",
    "start": "722560",
    "end": "729440"
  },
  {
    "text": "so in this particular case we had a project under the organization directly and the project had some pretty normal",
    "start": "729440",
    "end": "736399"
  },
  {
    "text": "stuff going on it had compute engine instances kubernetes",
    "start": "736399",
    "end": "741440"
  },
  {
    "text": "and a bigquery instance and the admins decided to create a",
    "start": "741440",
    "end": "746959"
  },
  {
    "text": "service account within this project and then they went and created a binding",
    "start": "746959",
    "end": "753040"
  },
  {
    "text": "but that binding was what they call an owner role this is a basic role provided by gcp",
    "start": "753040",
    "end": "759760"
  },
  {
    "text": "again this is not recommended unless you really understand what's happening here and it was bound at the organization",
    "start": "759760",
    "end": "766720"
  },
  {
    "text": "level so this was at the highest level in the environment",
    "start": "766720",
    "end": "772320"
  },
  {
    "text": "so why is this a problem well the owner role has full access to all resources as we",
    "start": "772320",
    "end": "779040"
  },
  {
    "text": "can see in the description this is a screenshot i took from the gcp console",
    "start": "779040",
    "end": "784320"
  },
  {
    "text": "so when you look at the role in the console you can see this that it says it's got full access to all",
    "start": "784320",
    "end": "790240"
  },
  {
    "text": "resources and it's got over 3 400 api calls that it can make successfully",
    "start": "790240",
    "end": "796959"
  },
  {
    "text": "now these api calls include logging creating users changing permissions",
    "start": "796959",
    "end": "803040"
  },
  {
    "text": "destroying and adding resources so it's basically a full admin",
    "start": "803040",
    "end": "810320"
  },
  {
    "text": "so next in the same environment we have a user come along who needs to be able to do a few things they need to be able",
    "start": "810880",
    "end": "817279"
  },
  {
    "text": "to create and delete some resources they need to be able to query data and",
    "start": "817279",
    "end": "822639"
  },
  {
    "text": "they're going to be doing a wide ar a wide variety of things in the project so the administrators just decided to",
    "start": "822639",
    "end": "829920"
  },
  {
    "text": "give this user the editor role at the project level and again the editor role is another",
    "start": "829920",
    "end": "837519"
  },
  {
    "text": "basic role that is very broad so from the gcp",
    "start": "837519",
    "end": "842560"
  },
  {
    "text": "console if we look at it we can see over 3 100 permissions allowed by this role and it has edited access to",
    "start": "842560",
    "end": "850240"
  },
  {
    "text": "all resources so that means that whatever level you apply this at it will have edit access to any resource",
    "start": "850240",
    "end": "858000"
  },
  {
    "text": "under that level so this user has edit access to everything in the project",
    "start": "858000",
    "end": "864560"
  },
  {
    "text": "and that includes the surface account resource that exists in the project",
    "start": "864560",
    "end": "870079"
  },
  {
    "text": "since he has the editor role he can actually go in and look at every single service account",
    "start": "870079",
    "end": "876000"
  },
  {
    "text": "in the project and activate them so now he has a route to",
    "start": "876000",
    "end": "881519"
  },
  {
    "text": "escalate his privileges up from just being in that one project to the overall organization and have",
    "start": "881519",
    "end": "887839"
  },
  {
    "text": "full administrator permissions throughout the entire environment",
    "start": "887839",
    "end": "893759"
  },
  {
    "text": "so why is this such a problem to track down well a lot of people attending this talk",
    "start": "894560",
    "end": "901680"
  },
  {
    "text": "or watching this talk might have their own tooling already that looks at gcp environments by making api calls",
    "start": "901680",
    "end": "909040"
  },
  {
    "text": "but if you don't have some sort of a custom tool that you created or you found then",
    "start": "909040",
    "end": "916320"
  },
  {
    "text": "looking in the console you're not going to be able to tell this very easily there's various different consoles to",
    "start": "916320",
    "end": "922880"
  },
  {
    "text": "look in and uh you need to sort of piece the things together on your own",
    "start": "922880",
    "end": "927920"
  },
  {
    "text": "so here i'm looking at the service account console in in gcp and i'm looking at this",
    "start": "927920",
    "end": "934560"
  },
  {
    "text": "one service account that i created to sort of model what we found in the production environment",
    "start": "934560",
    "end": "940639"
  },
  {
    "text": "so this service account has that full ownership permissions at the organization level and on the right side of the screenshot",
    "start": "940639",
    "end": "948240"
  },
  {
    "text": "i can see a bunch of things that have permissions over this service account that have been inherited down",
    "start": "948240",
    "end": "955519"
  },
  {
    "text": "you know from some point in the organization but looking at the service account itself i",
    "start": "955519",
    "end": "962560"
  },
  {
    "text": "can't tell that this carries with it any sort of great risk you know compared",
    "start": "962560",
    "end": "967920"
  },
  {
    "text": "to any other service account i have in this project so just looking at this i kind of don't have a clue",
    "start": "967920",
    "end": "974079"
  },
  {
    "text": "i have to go back and look in the i am console and see what permissions are assigned to this",
    "start": "974079",
    "end": "979199"
  },
  {
    "text": "thing as an identity and then sort of piece it together",
    "start": "979199",
    "end": "984480"
  },
  {
    "text": "so that's where our permission mining solution comes into play we really want to make this easier to to",
    "start": "984480",
    "end": "990079"
  },
  {
    "text": "visualize so what does our solution do basically it's",
    "start": "990079",
    "end": "996480"
  },
  {
    "text": "it's just making api calls to see what your current configuration is and by doing this you can actually use",
    "start": "996480",
    "end": "1004079"
  },
  {
    "text": "it to continually monitor the environment so you could run our tool once a month",
    "start": "1004079",
    "end": "1009600"
  },
  {
    "text": "or you could run it once an hour whatever you deem appropriate for your environment",
    "start": "1009600",
    "end": "1015680"
  },
  {
    "text": "once it grabs all the data from these api calls it actually uses a graph to find",
    "start": "1015680",
    "end": "1021279"
  },
  {
    "text": "privilege escalation potential and it provides you a report containing",
    "start": "1021279",
    "end": "1026640"
  },
  {
    "text": "the direct and indirect permissions for every member in your environment",
    "start": "1026640",
    "end": "1031839"
  },
  {
    "text": "so this way users of the tool can monitor and mitigate these risks in real time",
    "start": "1031839",
    "end": "1039600"
  },
  {
    "text": "so let's kind of walk through what it's doing what is the tool really doing",
    "start": "1039600",
    "end": "1045280"
  },
  {
    "text": "first it needs to take an inventory of the hierarchy in the particular environment it's running in",
    "start": "1045280",
    "end": "1051840"
  },
  {
    "text": "because every environment is different there could be folders there could be no folders there could be",
    "start": "1051840",
    "end": "1057600"
  },
  {
    "text": "500 projects or there could be one project so first we go through and we take an",
    "start": "1057600",
    "end": "1063520"
  },
  {
    "text": "inventory of of the whole structure of the hierarchy and figure out where the folders are",
    "start": "1063520",
    "end": "1068960"
  },
  {
    "text": "where the projects are and group the service accounts under the correct projects",
    "start": "1068960",
    "end": "1076399"
  },
  {
    "text": "then what we do is we compile the direct bindings for every member so in",
    "start": "1077120",
    "end": "1083600"
  },
  {
    "text": "what i'm showing here is an example of what we found in the production environment where i'm modeling it in my test",
    "start": "1083600",
    "end": "1090000"
  },
  {
    "text": "environment so i have a member called cstep and i gave him editor permissions at the",
    "start": "1090000",
    "end": "1097120"
  },
  {
    "text": "project level and within that project i have a service account that's got some higher level permissions below this",
    "start": "1097120",
    "end": "1104880"
  },
  {
    "text": "i'm showing another member that has different permissions that does not imply any sort of way of",
    "start": "1104880",
    "end": "1110960"
  },
  {
    "text": "impersonating a service account but we want to compile all the direct permissions",
    "start": "1110960",
    "end": "1116000"
  },
  {
    "text": "so that in our report we get a full view of what's going on",
    "start": "1116000",
    "end": "1122000"
  },
  {
    "text": "so once we have all the direct permissions that's when we can start to figure out who are our impersonators meaning who",
    "start": "1122000",
    "end": "1128240"
  },
  {
    "text": "are the members who are capable of impersonating a service account",
    "start": "1128240",
    "end": "1133280"
  },
  {
    "text": "and doing something in our environment and that really comes down to these five main roles and i've grouped them here",
    "start": "1133280",
    "end": "1141120"
  },
  {
    "text": "in order of most permissive with owner at the top and then least permissive with service",
    "start": "1141120",
    "end": "1146240"
  },
  {
    "text": "account user at the bottom and you'll see the screenshot here from the console again",
    "start": "1146240",
    "end": "1151440"
  },
  {
    "text": "showing service account user with only five permissions assigned to it even though",
    "start": "1151440",
    "end": "1157200"
  },
  {
    "text": "it only has these five permissions it's very powerful because it enables whoever has this",
    "start": "1157200",
    "end": "1163039"
  },
  {
    "text": "permission whoever has this role assigned can enumerate and impersonate any",
    "start": "1163039",
    "end": "1169280"
  },
  {
    "text": "service accounts in their scope [Music] so finally once we have that information",
    "start": "1169280",
    "end": "1176720"
  },
  {
    "text": "we construct a graph and we chose the graph data structure because it's really great for",
    "start": "1176720",
    "end": "1182720"
  },
  {
    "text": "modeling entities and relationships which is what this environment really is is you know",
    "start": "1182720",
    "end": "1188720"
  },
  {
    "text": "finding who has permissions and at what level so what we start doing is laying out the",
    "start": "1188720",
    "end": "1195200"
  },
  {
    "text": "impersonators and creating the bindings that give them some impersonation capability",
    "start": "1195200",
    "end": "1202000"
  },
  {
    "text": "at the right position in the hierarchy since we have the hierarchy and we have an inventory of the service accounts",
    "start": "1202000",
    "end": "1209120"
  },
  {
    "text": "this will enable us to effectively traverse the graph and find out what the scope is for each member",
    "start": "1209120",
    "end": "1216880"
  },
  {
    "text": "so like i mentioned once we have the graph constructed we can find potential privilege escalation by traversing the graph",
    "start": "1218240",
    "end": "1226240"
  },
  {
    "text": "and this will tell us every service account that they have in their scope and then we can compile",
    "start": "1226240",
    "end": "1233200"
  },
  {
    "text": "the permissions assigned to those service accounts and say that this member actually has an indirect",
    "start": "1233200",
    "end": "1239679"
  },
  {
    "text": "permission or what we call an extended binding to be able to do something else",
    "start": "1239679",
    "end": "1248159"
  },
  {
    "text": "so now that i described what we're doing in the solution let's see what does this kind of look",
    "start": "1248159",
    "end": "1253360"
  },
  {
    "text": "like so the results we get from the solution will include a report for every member",
    "start": "1253360",
    "end": "1261120"
  },
  {
    "text": "and i've made it sort of uh easy to look at for this presentation but here you'll get an idea",
    "start": "1261120",
    "end": "1267760"
  },
  {
    "text": "of what it's giving us so here i'm showing an excerpt of a report for my user cstep and it shows that he has",
    "start": "1267760",
    "end": "1275600"
  },
  {
    "text": "direct bindings and there are project bindings and so i see the name of the project here",
    "start": "1275600",
    "end": "1281440"
  },
  {
    "text": "called sifsec gcp dev and at that level cstep has",
    "start": "1281440",
    "end": "1288000"
  },
  {
    "text": "the role editor assigned to him then under that i'm showing the extended",
    "start": "1288000",
    "end": "1293679"
  },
  {
    "text": "bindings so these are bindings that we recovered from service accounts that cstep can",
    "start": "1293679",
    "end": "1299520"
  },
  {
    "text": "actually impersonate and it's showing that within those extended bindings there are some",
    "start": "1299520",
    "end": "1304880"
  },
  {
    "text": "at the organization level and i see the name of the organization node here",
    "start": "1304880",
    "end": "1310240"
  },
  {
    "text": "called sifsac.com and then i have an array of roles at that level and the one highlighted in",
    "start": "1310240",
    "end": "1317280"
  },
  {
    "text": "yellow is the owner roll which is our full admin uh permissions so that's really",
    "start": "1317280",
    "end": "1323840"
  },
  {
    "text": "important to be able to see that cstep although we think he may only have",
    "start": "1323840",
    "end": "1329039"
  },
  {
    "text": "permissions over one project that's not really the case if he makes use of the service accounts",
    "start": "1329039",
    "end": "1335039"
  },
  {
    "text": "in his scope and here's what it would look like in a",
    "start": "1335039",
    "end": "1340480"
  },
  {
    "text": "graph the graph that i'm constructing in the project is not meant as a ui",
    "start": "1340480",
    "end": "1346720"
  },
  {
    "text": "but i thought it'd be useful to show it here so just quickly the legend for the graph",
    "start": "1346720",
    "end": "1354080"
  },
  {
    "text": "the blue node is our organization node the green nodes are our members light pink is the",
    "start": "1354080",
    "end": "1361840"
  },
  {
    "text": "project and you'll see the project associated with the organization and then the dark pink or more reddish",
    "start": "1361840",
    "end": "1369120"
  },
  {
    "text": "nodes are the service accounts located within the project",
    "start": "1369120",
    "end": "1375120"
  },
  {
    "text": "and as you'll see here i have my surface account that i set up as the admin in the organization it actually",
    "start": "1375120",
    "end": "1382320"
  },
  {
    "text": "has two different nodes to represent one account and that's because a service account is a resource",
    "start": "1382320",
    "end": "1388080"
  },
  {
    "text": "and an identity so in order to be able to traverse the graph effectively",
    "start": "1388080",
    "end": "1393200"
  },
  {
    "text": "i want to i want to represent that state in both ways so i can show the service account that's",
    "start": "1393200",
    "end": "1399679"
  },
  {
    "text": "in scope under the project and then i can show its binding at some level in the hierarchy",
    "start": "1399679",
    "end": "1406480"
  },
  {
    "text": "next i have the impersonator associated to the project so again i can see what he has the",
    "start": "1407120",
    "end": "1414320"
  },
  {
    "text": "capability to do and that's how we created our report",
    "start": "1414320",
    "end": "1420559"
  },
  {
    "text": "so what does this look like for real well when we run the tool in a production environment",
    "start": "1420559",
    "end": "1426559"
  },
  {
    "text": "it can get pretty hairy the graph here has over 500 projects several hundred",
    "start": "1426559",
    "end": "1433279"
  },
  {
    "text": "members and so it's no wonder that this is really hard to keep track of",
    "start": "1433279",
    "end": "1439120"
  },
  {
    "text": "unless you have a tool that's actively monitoring the situation",
    "start": "1439120",
    "end": "1444400"
  },
  {
    "text": "it's going to be hard for anyone to manually understand what every single user is capable of in",
    "start": "1444400",
    "end": "1450080"
  },
  {
    "text": "the environment so now that we've gone through what the",
    "start": "1450080",
    "end": "1456080"
  },
  {
    "text": "tool produces what's its value well some of the remediation that we've",
    "start": "1456080",
    "end": "1461760"
  },
  {
    "text": "seen happen as a result of this has been the following um bringing",
    "start": "1461760",
    "end": "1467200"
  },
  {
    "text": "service account bindings down the hierarchy is one way to to deal with this so you",
    "start": "1467200",
    "end": "1472400"
  },
  {
    "text": "might look at the result and say well you know what the service account needs to have owner permissions for whatever reason",
    "start": "1472400",
    "end": "1479520"
  },
  {
    "text": "but maybe we don't need it at the organization level maybe we should create a folder and put it there and",
    "start": "1479520",
    "end": "1487200"
  },
  {
    "text": "that'll limit the range here or we see that hey the service account",
    "start": "1487200",
    "end": "1494159"
  },
  {
    "text": "doesn't need a basic role we should really apply more granular permissions to limit its scope",
    "start": "1494159",
    "end": "1500640"
  },
  {
    "text": "and so people do that as well and then lastly you know sometimes you set up a new",
    "start": "1500640",
    "end": "1506960"
  },
  {
    "text": "environment and you do some testing and you just set up some quick things",
    "start": "1506960",
    "end": "1513440"
  },
  {
    "text": "you put some permissions in place just to quickly evaluate something but then you didn't go back and clean it",
    "start": "1513440",
    "end": "1518960"
  },
  {
    "text": "up and so in some cases you don't need the binding at all and you can just remove it",
    "start": "1518960",
    "end": "1524880"
  },
  {
    "text": "the idea is that we want to proactively reduce the risk in the environment without waiting for a compromise",
    "start": "1524880",
    "end": "1531039"
  },
  {
    "text": "you know we want to have a smart way to audit everything and view that risk and make",
    "start": "1531039",
    "end": "1537679"
  },
  {
    "text": "smart decisions about where we're going to take that risk whereas maybe we need to reduce friction",
    "start": "1537679",
    "end": "1544240"
  },
  {
    "text": "but the idea is that we need to have all the information available to make the right call",
    "start": "1544240",
    "end": "1551440"
  },
  {
    "text": "so our first version of the tool that's going to be open sourced i think is a good start but there's",
    "start": "1552159",
    "end": "1558880"
  },
  {
    "text": "definitely some things that that could be added to it so i just want to go through",
    "start": "1558880",
    "end": "1563919"
  },
  {
    "text": "a few things that we could add to the project going forward and just in case anybody's seen this",
    "start": "1563919",
    "end": "1569840"
  },
  {
    "text": "talk and is interested in contributing um i just wanted to share this part",
    "start": "1569840",
    "end": "1575120"
  },
  {
    "text": "because maybe you'd find it interesting and want to add",
    "start": "1575120",
    "end": "1579759"
  },
  {
    "text": "so the first thing that came to mind was the compute engine so when you have compute engine",
    "start": "1580159",
    "end": "1585200"
  },
  {
    "text": "instances running um you're going to want to allow in most cases you're going to want to allow your",
    "start": "1585200",
    "end": "1591279"
  },
  {
    "text": "users to ssh into them and have shell access to be able to do what they need to do",
    "start": "1591279",
    "end": "1599200"
  },
  {
    "text": "you know in a lot of cases there's going to be service accounts associated to",
    "start": "1599200",
    "end": "1604240"
  },
  {
    "text": "these instances and so even if your user doesn't have",
    "start": "1604240",
    "end": "1609760"
  },
  {
    "text": "the permission to access a service account directly this is a way that they could actually get into",
    "start": "1609760",
    "end": "1615600"
  },
  {
    "text": "an instance and use their shell access to make api calls as that service account so this is",
    "start": "1615600",
    "end": "1621440"
  },
  {
    "text": "another path for privilege escalation that is not currently handled in our solution",
    "start": "1621440",
    "end": "1627840"
  },
  {
    "text": "another one that's interesting are within cloud functions what i'm showing here is another",
    "start": "1629200",
    "end": "1634720"
  },
  {
    "text": "screenshot from the console and this is a cloud functions developer role it's only",
    "start": "1634720",
    "end": "1640000"
  },
  {
    "text": "got 16 assigned permissions but the idea of it is to allow someone to deploy and",
    "start": "1640000",
    "end": "1646080"
  },
  {
    "text": "update code for a cloud function for anyone who's not aware a cloud function is",
    "start": "1646080",
    "end": "1651600"
  },
  {
    "text": "similar to like a lambda function in aws where you're just deploying code and letting the cloud platform run it for",
    "start": "1651600",
    "end": "1659120"
  },
  {
    "text": "you so you don't have to maintain a compute instance or something like that",
    "start": "1659120",
    "end": "1665760"
  },
  {
    "text": "so in this case of gcp cloud functions by default use the app engine default service",
    "start": "1665840",
    "end": "1671840"
  },
  {
    "text": "account and that app engine default service account is in the second screenshot on",
    "start": "1671840",
    "end": "1676880"
  },
  {
    "text": "this slide and that shows that it's using the editor role which is again that basic role that has over 3",
    "start": "1676880",
    "end": "1683440"
  },
  {
    "text": "100 permissions associated with it so the point here is that you could have",
    "start": "1683440",
    "end": "1688880"
  },
  {
    "text": "a user that has very granular permissions but needs to be able to update cloud",
    "start": "1688880",
    "end": "1694159"
  },
  {
    "text": "functions and they could actually deploy code that would allow them to escalate their privileges and",
    "start": "1694159",
    "end": "1700240"
  },
  {
    "text": "make changes in the environment that may have been unintended because that app engine",
    "start": "1700240",
    "end": "1705360"
  },
  {
    "text": "service account has way more permissions associated with it",
    "start": "1705360",
    "end": "1711120"
  },
  {
    "text": "then lastly organization policies these are separate from identity and",
    "start": "1711120",
    "end": "1717360"
  },
  {
    "text": "access management in gcp but they do have an effect on what people can do in the environment so this",
    "start": "1717360",
    "end": "1724480"
  },
  {
    "text": "is something i think we need to take into account and despite the name policies",
    "start": "1724480",
    "end": "1729679"
  },
  {
    "text": "organization policies don't have to be associated at the organization level they can be associated to projects",
    "start": "1729679",
    "end": "1737760"
  },
  {
    "text": "so here i'm showing a screenshot for a project a test project that i have and",
    "start": "1737760",
    "end": "1743919"
  },
  {
    "text": "there are some service account related constraints and these constraints if they're enabled",
    "start": "1743919",
    "end": "1749919"
  },
  {
    "text": "can prevent people from creating their own service accounts or creating keys for service accounts",
    "start": "1749919",
    "end": "1756320"
  },
  {
    "text": "that would allow them to impersonate them so we should really take that into account as a mitigation",
    "start": "1756320",
    "end": "1762399"
  },
  {
    "text": "if these policies are in place because we don't see that at all in the i am policies if these are",
    "start": "1762399",
    "end": "1768960"
  },
  {
    "text": "turned on so it's just another service that we'll have to check and take into account if we want to",
    "start": "1768960",
    "end": "1774799"
  },
  {
    "text": "present some really accurate risk information in our reporting",
    "start": "1774799",
    "end": "1781840"
  },
  {
    "text": "so with that i just want to say thank you for your time if you found this helpful or interesting",
    "start": "1782159",
    "end": "1788480"
  },
  {
    "text": "please go visit our netskope threat labs blog we're always posting things there as we find",
    "start": "1788480",
    "end": "1794480"
  },
  {
    "text": "them and things that we think the community should know about uh i have my twitter handle here my",
    "start": "1794480",
    "end": "1800559"
  },
  {
    "text": "linkedin if you'd like to to reach out and talk about this i'm more than happy to do that",
    "start": "1800559",
    "end": "1806720"
  },
  {
    "text": "and then also here's our open source url for the project that we're releasing",
    "start": "1806720",
    "end": "1812320"
  },
  {
    "text": "along with the talk it's called ias permission mining and under it you'll see a gcp folder for",
    "start": "1812320",
    "end": "1819360"
  },
  {
    "text": "uh the code related to this particular talk so thank you again and i hope to hear",
    "start": "1819360",
    "end": "1825600"
  },
  {
    "text": "from people who are interested in participating thank you",
    "start": "1825600",
    "end": "1834158"
  }
]