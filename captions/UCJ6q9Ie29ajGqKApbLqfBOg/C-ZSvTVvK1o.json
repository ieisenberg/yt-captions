[
  {
    "text": "[Music]",
    "start": "1700",
    "end": "4810"
  },
  {
    "text": "now it's my pleasure to Welcome to the",
    "start": "7340",
    "end": "9960"
  },
  {
    "text": "stage uh piano Trooper Royal and Martin",
    "start": "9960",
    "end": "12660"
  },
  {
    "text": "shortlaw",
    "start": "12660",
    "end": "15500"
  },
  {
    "text": "thank you for this nice introduction so",
    "start": "16320",
    "end": "18960"
  },
  {
    "text": "hi and welcome to this talk about custom",
    "start": "18960",
    "end": "21000"
  },
  {
    "text": "Processing Unit tracing and patching",
    "start": "21000",
    "end": "23160"
  },
  {
    "text": "intellectual microcode I'm Martin and",
    "start": "23160",
    "end": "25859"
  },
  {
    "text": "I'm Pedro so today you will we will",
    "start": "25859",
    "end": "28619"
  },
  {
    "text": "present you the first study can Dynamic",
    "start": "28619",
    "end": "30779"
  },
  {
    "text": "analysis framework for CPU microcode all",
    "start": "30779",
    "end": "33660"
  },
  {
    "text": "done via software yeah so we give the",
    "start": "33660",
    "end": "36660"
  },
  {
    "text": "people a short outline now so we first",
    "start": "36660",
    "end": "39180"
  },
  {
    "text": "start off with a deep dive on CPU",
    "start": "39180",
    "end": "41879"
  },
  {
    "text": "microcode especially the atom microcode",
    "start": "41879",
    "end": "44879"
  },
  {
    "text": "then we'll present you a the first",
    "start": "44879",
    "end": "47780"
  },
  {
    "text": "static and analysis software framework",
    "start": "47780",
    "end": "50520"
  },
  {
    "text": "for microcode then based on that we show",
    "start": "50520",
    "end": "53399"
  },
  {
    "text": "you how you can use the framework to",
    "start": "53399",
    "end": "55199"
  },
  {
    "text": "reverse engineer the microcode update",
    "start": "55199",
    "end": "58140"
  },
  {
    "text": "algorithm",
    "start": "58140",
    "end": "59760"
  },
  {
    "text": "and and then we will end up with some",
    "start": "59760",
    "end": "62460"
  },
  {
    "text": "bonus content so first of all a",
    "start": "62460",
    "end": "64799"
  },
  {
    "text": "disclaimer this is based on like our",
    "start": "64799",
    "end": "66960"
  },
  {
    "text": "understanding of CPU micro code So in",
    "start": "66960",
    "end": "69360"
  },
  {
    "text": "theory it would be all wrong but in",
    "start": "69360",
    "end": "71580"
  },
  {
    "text": "practice we will see that a lot seems",
    "start": "71580",
    "end": "73500"
  },
  {
    "text": "right so but before we get into the deep",
    "start": "73500",
    "end": "76799"
  },
  {
    "text": "dive we will go to like an high level",
    "start": "76799",
    "end": "80280"
  },
  {
    "text": "view on how CPUs works so at the",
    "start": "80280",
    "end": "82680"
  },
  {
    "text": "University most people learn you have",
    "start": "82680",
    "end": "84960"
  },
  {
    "text": "like this fetch decode execute right",
    "start": "84960",
    "end": "88020"
  },
  {
    "text": "back steps and yeah basically we can see",
    "start": "88020",
    "end": "90780"
  },
  {
    "text": "it in this high level view there is this",
    "start": "90780",
    "end": "92460"
  },
  {
    "text": "front-end doing a fetching decode stage",
    "start": "92460",
    "end": "95159"
  },
  {
    "text": "and then there are the out of order",
    "start": "95159",
    "end": "96960"
  },
  {
    "text": "engine and somewhere there is the memory",
    "start": "96960",
    "end": "98880"
  },
  {
    "text": "subsystem in between where it tries to",
    "start": "98880",
    "end": "101460"
  },
  {
    "text": "speed up things using caches and all",
    "start": "101460",
    "end": "103380"
  },
  {
    "text": "this stuff yes but it is not that simple",
    "start": "103380",
    "end": "105900"
  },
  {
    "text": "obviously and x86 instructions like to",
    "start": "105900",
    "end": "109259"
  },
  {
    "text": "be executed effectively they get",
    "start": "109259",
    "end": "111240"
  },
  {
    "text": "translated into micro operations and",
    "start": "111240",
    "end": "113460"
  },
  {
    "text": "okay most of them are like really simple",
    "start": "113460",
    "end": "115020"
  },
  {
    "text": "instructions so like they have one or",
    "start": "115020",
    "end": "116939"
  },
  {
    "text": "two micro operations like think about if",
    "start": "116939",
    "end": "118619"
  },
  {
    "text": "you access memory or like you are to",
    "start": "118619",
    "end": "120720"
  },
  {
    "text": "like to register for example but like",
    "start": "120720",
    "end": "123360"
  },
  {
    "text": "some instructions need some more complex",
    "start": "123360",
    "end": "125939"
  },
  {
    "text": "logic like think about CPU ID where you",
    "start": "125939",
    "end": "127979"
  },
  {
    "text": "have like multiple leaves and you have",
    "start": "127979",
    "end": "129780"
  },
  {
    "text": "like conditional execution based on the",
    "start": "129780",
    "end": "132000"
  },
  {
    "text": "input that you do so there is a",
    "start": "132000",
    "end": "133920"
  },
  {
    "text": "component called the macro code",
    "start": "133920",
    "end": "135060"
  },
  {
    "text": "sequencer that takes care of like",
    "start": "135060",
    "end": "138060"
  },
  {
    "text": "emitting a stream of micro operations",
    "start": "138060",
    "end": "140099"
  },
  {
    "text": "that implement the logic of complex",
    "start": "140099",
    "end": "142800"
  },
  {
    "text": "instructions yeah but before we go",
    "start": "142800",
    "end": "145680"
  },
  {
    "text": "deeper into that",
    "start": "145680",
    "end": "147000"
  },
  {
    "text": "we'll have to",
    "start": "147000",
    "end": "148680"
  },
  {
    "text": "talk about the preliminary thing and",
    "start": "148680",
    "end": "151200"
  },
  {
    "text": "that's the red unlock finding from",
    "start": "151200",
    "end": "154140"
  },
  {
    "text": "positive Technologies from Mark amoloff",
    "start": "154140",
    "end": "156360"
  },
  {
    "text": "and his team so they basically found on",
    "start": "156360",
    "end": "159360"
  },
  {
    "text": "an exploit in the smm engine and they",
    "start": "159360",
    "end": "162720"
  },
  {
    "text": "basically managed to Red unlock the CPU",
    "start": "162720",
    "end": "165120"
  },
  {
    "text": "into a special State such that they can",
    "start": "165120",
    "end": "167340"
  },
  {
    "text": "debug it and read out special",
    "start": "167340",
    "end": "170160"
  },
  {
    "text": "um buffers like caches or staging",
    "start": "170160",
    "end": "172980"
  },
  {
    "text": "buffers similar things and based on that",
    "start": "172980",
    "end": "175379"
  },
  {
    "text": "they managed to extract and reverse",
    "start": "175379",
    "end": "177720"
  },
  {
    "text": "engineer the gold mode u-code format",
    "start": "177720",
    "end": "180420"
  },
  {
    "text": "they presented a disassembler for that",
    "start": "180420",
    "end": "183540"
  },
  {
    "text": "and based on the reverse engineering",
    "start": "183540",
    "end": "185580"
  },
  {
    "text": "they discovered new undocumented",
    "start": "185580",
    "end": "187860"
  },
  {
    "text": "instructions which basically allow it to",
    "start": "187860",
    "end": "190319"
  },
  {
    "text": "con control the access to internal",
    "start": "190319",
    "end": "192900"
  },
  {
    "text": "buffers yes but like to understand what",
    "start": "192900",
    "end": "195840"
  },
  {
    "text": "can we do based on this work we have to",
    "start": "195840",
    "end": "198239"
  },
  {
    "text": "understand first like how does the like",
    "start": "198239",
    "end": "200459"
  },
  {
    "text": "magical stuff work and we're talking",
    "start": "200459",
    "end": "203340"
  },
  {
    "text": "about this magical sequencer you like",
    "start": "203340",
    "end": "205739"
  },
  {
    "text": "let's assume that you have an",
    "start": "205739",
    "end": "206760"
  },
  {
    "text": "instruction like CPU ID that needs a",
    "start": "206760",
    "end": "208739"
  },
  {
    "text": "stream of micro operations you have like",
    "start": "208739",
    "end": "211260"
  },
  {
    "text": "a translation table where like the",
    "start": "211260",
    "end": "213120"
  },
  {
    "text": "instruction gets matched and you will",
    "start": "213120",
    "end": "216000"
  },
  {
    "text": "jump to the microcode ROM where the CPU",
    "start": "216000",
    "end": "218519"
  },
  {
    "text": "will takes micro instructions and",
    "start": "218519",
    "end": "220620"
  },
  {
    "text": "execute them to implement the complex",
    "start": "220620",
    "end": "222540"
  },
  {
    "text": "Logic the micro instructions are like",
    "start": "222540",
    "end": "225180"
  },
  {
    "text": "organizing Triads and every single",
    "start": "225180",
    "end": "227159"
  },
  {
    "text": "Triads as a sequence word Associated to",
    "start": "227159",
    "end": "229379"
  },
  {
    "text": "it like a sequence rule effect of maybe",
    "start": "229379",
    "end": "231659"
  },
  {
    "text": "affects some synchronization during the",
    "start": "231659",
    "end": "233519"
  },
  {
    "text": "micro operations like think about like",
    "start": "233519",
    "end": "235200"
  },
  {
    "text": "elephants like stuff or even the Contour",
    "start": "235200",
    "end": "237599"
  },
  {
    "text": "flow while executing this so obviously",
    "start": "237599",
    "end": "240239"
  },
  {
    "text": "if it was like that you have a ROM and",
    "start": "240239",
    "end": "242519"
  },
  {
    "text": "the CPU code will be fixed so what if",
    "start": "242519",
    "end": "244620"
  },
  {
    "text": "you have like to patch some bug like",
    "start": "244620",
    "end": "246299"
  },
  {
    "text": "epic click for example and you have to",
    "start": "246299",
    "end": "248459"
  },
  {
    "text": "fix that so CPU like also supports a ram",
    "start": "248459",
    "end": "252739"
  },
  {
    "text": "like kind of internal memory where you",
    "start": "252739",
    "end": "255360"
  },
  {
    "text": "can like edit and Patch the microphone",
    "start": "255360",
    "end": "257699"
  },
  {
    "text": "there but how can you pass between those",
    "start": "257699",
    "end": "260040"
  },
  {
    "text": "two internal buffers there is a",
    "start": "260040",
    "end": "261660"
  },
  {
    "text": "component called the match and patch",
    "start": "261660",
    "end": "262919"
  },
  {
    "text": "that every time you execute an",
    "start": "262919",
    "end": "265199"
  },
  {
    "text": "instruction if the destruction is like",
    "start": "265199",
    "end": "267419"
  },
  {
    "text": "programmed to jump so to their arm the",
    "start": "267419",
    "end": "269820"
  },
  {
    "text": "matching patch will redirect to the",
    "start": "269820",
    "end": "271320"
  },
  {
    "text": "control flow to the RAM and execute the",
    "start": "271320",
    "end": "273360"
  },
  {
    "text": "new instruction that are passed there",
    "start": "273360",
    "end": "276000"
  },
  {
    "text": "so um now I I managed to look into the",
    "start": "276000",
    "end": "279360"
  },
  {
    "text": "disassembly and I found this Triads here",
    "start": "279360",
    "end": "281639"
  },
  {
    "text": "we're managing so we have these three",
    "start": "281639",
    "end": "283080"
  },
  {
    "text": "operations the fourth one was always a",
    "start": "283080",
    "end": "284940"
  },
  {
    "text": "knob operation and then we have this",
    "start": "284940",
    "end": "287040"
  },
  {
    "text": "sequence words you mentioned which are",
    "start": "287040",
    "end": "288900"
  },
  {
    "text": "basically properties about the current",
    "start": "288900",
    "end": "290880"
  },
  {
    "text": "microcode instructions but if you look",
    "start": "290880",
    "end": "292800"
  },
  {
    "text": "at that it's like you cannot really read",
    "start": "292800",
    "end": "295020"
  },
  {
    "text": "that so we use the disassembler",
    "start": "295020",
    "end": "297120"
  },
  {
    "text": "obviously and then we see like the",
    "start": "297120",
    "end": "299940"
  },
  {
    "text": "microcode has a similar structure to x86",
    "start": "299940",
    "end": "302759"
  },
  {
    "text": "yeah it's really similar so you have",
    "start": "302759",
    "end": "304740"
  },
  {
    "text": "branching instructions you have internal",
    "start": "304740",
    "end": "306840"
  },
  {
    "text": "temporary registers and the things in",
    "start": "306840",
    "end": "309540"
  },
  {
    "text": "blue if you see them there are these",
    "start": "309540",
    "end": "312060"
  },
  {
    "text": "sequence word instructions so they're",
    "start": "312060",
    "end": "314400"
  },
  {
    "text": "for instance the last line shows the",
    "start": "314400",
    "end": "316680"
  },
  {
    "text": "next",
    "start": "316680",
    "end": "317840"
  },
  {
    "text": "microcode instruction being X yes and",
    "start": "317840",
    "end": "320340"
  },
  {
    "text": "every sequence word is associated to all",
    "start": "320340",
    "end": "322199"
  },
  {
    "text": "the three micro instructions that you",
    "start": "322199",
    "end": "323940"
  },
  {
    "text": "have there but if we look at the",
    "start": "323940",
    "end": "326639"
  },
  {
    "text": "microcode we can see that it's highly",
    "start": "326639",
    "end": "328979"
  },
  {
    "text": "optimized so in the CPU we have like a",
    "start": "328979",
    "end": "331139"
  },
  {
    "text": "small buffer we have to like pack all",
    "start": "331139",
    "end": "333240"
  },
  {
    "text": "the instructions that you want to like",
    "start": "333240",
    "end": "334560"
  },
  {
    "text": "to use to implement the functionalities",
    "start": "334560",
    "end": "336419"
  },
  {
    "text": "that you want to microcode there",
    "start": "336419",
    "end": "338580"
  },
  {
    "text": "so the market is highly Tangled you have",
    "start": "338580",
    "end": "341580"
  },
  {
    "text": "like blocks of code that are shared",
    "start": "341580",
    "end": "343320"
  },
  {
    "text": "between multiple functions so it's",
    "start": "343320",
    "end": "344880"
  },
  {
    "text": "really hard to like analyze it and I",
    "start": "344880",
    "end": "347880"
  },
  {
    "text": "mean it would be cool to have like a",
    "start": "347880",
    "end": "349800"
  },
  {
    "text": "high level view of the microcode but",
    "start": "349800",
    "end": "352199"
  },
  {
    "text": "unfortunately like at the compiler for",
    "start": "352199",
    "end": "354360"
  },
  {
    "text": "example for this doesn't exist since",
    "start": "354360",
    "end": "355800"
  },
  {
    "text": "it's like it was undocumented so we",
    "start": "355800",
    "end": "357960"
  },
  {
    "text": "brought one",
    "start": "357960",
    "end": "359340"
  },
  {
    "text": "so you see here this is a guitar",
    "start": "359340",
    "end": "361699"
  },
  {
    "text": "decompiler it actually looks cool and",
    "start": "361699",
    "end": "365400"
  },
  {
    "text": "you can for instance see the rc4 decrypt",
    "start": "365400",
    "end": "368400"
  },
  {
    "text": "function which is later on as we will",
    "start": "368400",
    "end": "370620"
  },
  {
    "text": "show used in the update algorithm and",
    "start": "370620",
    "end": "373320"
  },
  {
    "text": "you see clearly that's like beautiful C",
    "start": "373320",
    "end": "375300"
  },
  {
    "text": "code and you can work on that and start",
    "start": "375300",
    "end": "377400"
  },
  {
    "text": "your reverse engineering with that",
    "start": "377400",
    "end": "379560"
  },
  {
    "text": "so when I was going through this whole",
    "start": "379560",
    "end": "381900"
  },
  {
    "text": "thing I saw like there was a special",
    "start": "381900",
    "end": "383699"
  },
  {
    "text": "interaction always with with a certain",
    "start": "383699",
    "end": "386280"
  },
  {
    "text": "component and this one was called the CR",
    "start": "386280",
    "end": "388319"
  },
  {
    "text": "paths yes so to understand better like",
    "start": "388319",
    "end": "390900"
  },
  {
    "text": "what when you do this we have to",
    "start": "390900",
    "end": "393000"
  },
  {
    "text": "understand what is the control register",
    "start": "393000",
    "end": "394500"
  },
  {
    "text": "bus and this is like the bus that the",
    "start": "394500",
    "end": "397259"
  },
  {
    "text": "CPU uses to interact with its internal",
    "start": "397259",
    "end": "399360"
  },
  {
    "text": "components so for example like msrs are",
    "start": "399360",
    "end": "402539"
  },
  {
    "text": "mapped into sierbassadors some of them",
    "start": "402539",
    "end": "405300"
  },
  {
    "text": "actually and also also like control",
    "start": "405300",
    "end": "408000"
  },
  {
    "text": "status registers are effectively like",
    "start": "408000",
    "end": "410639"
  },
  {
    "text": "addresses in this year bus where the CPU",
    "start": "410639",
    "end": "412919"
  },
  {
    "text": "access them to implement the",
    "start": "412919",
    "end": "414060"
  },
  {
    "text": "functionality that you want like system",
    "start": "414060",
    "end": "415919"
  },
  {
    "text": "management mode configuration is mapped",
    "start": "415919",
    "end": "417780"
  },
  {
    "text": "to this earbuds system management mode",
    "start": "417780",
    "end": "419520"
  },
  {
    "text": "is like this ring -2 mode in the CPU",
    "start": "419520",
    "end": "422160"
  },
  {
    "text": "that is like really like lockdown that",
    "start": "422160",
    "end": "425100"
  },
  {
    "text": "you should never access that and the",
    "start": "425100",
    "end": "426360"
  },
  {
    "text": "configuration for that is in the CR bus",
    "start": "426360",
    "end": "428400"
  },
  {
    "text": "and also like interesting look also the",
    "start": "428400",
    "end": "430500"
  },
  {
    "text": "L that is mapped into the CR bus so what",
    "start": "430500",
    "end": "433500"
  },
  {
    "text": "what is that ldot so I guess yeah so the",
    "start": "433500",
    "end": "436500"
  },
  {
    "text": "ldot is this like really interesting",
    "start": "436500",
    "end": "438900"
  },
  {
    "text": "component in like Intel CPUs that is",
    "start": "438900",
    "end": "441599"
  },
  {
    "text": "used for like post silicon validation",
    "start": "441599",
    "end": "443639"
  },
  {
    "text": "and it's a component that has access to",
    "start": "443639",
    "end": "445979"
  },
  {
    "text": "like all the internal buffers of the CPU",
    "start": "445979",
    "end": "448080"
  },
  {
    "text": "like let's think about for example the",
    "start": "448080",
    "end": "450000"
  },
  {
    "text": "tlb or like load and store buffers so",
    "start": "450000",
    "end": "452940"
  },
  {
    "text": "through the ldot you can check that this",
    "start": "452940",
    "end": "455520"
  },
  {
    "text": "component actually work",
    "start": "455520",
    "end": "458039"
  },
  {
    "text": "that's awesome so yes and also for",
    "start": "458039",
    "end": "460500"
  },
  {
    "text": "example you have access to the microcode",
    "start": "460500",
    "end": "462419"
  },
  {
    "text": "sequencers here to the ldot so the",
    "start": "462419",
    "end": "465240"
  },
  {
    "text": "microcode sequence as you already",
    "start": "465240",
    "end": "466560"
  },
  {
    "text": "mentioned that so what does it exactly",
    "start": "466560",
    "end": "469259"
  },
  {
    "text": "do so yeah like as we say the multiple",
    "start": "469259",
    "end": "471780"
  },
  {
    "text": "sequencer is the component that has",
    "start": "471780",
    "end": "474060"
  },
  {
    "text": "access to the microcode in the CPU both",
    "start": "474060",
    "end": "476400"
  },
  {
    "text": "to the ROM and to the ROM and",
    "start": "476400",
    "end": "478139"
  },
  {
    "text": "interestingly you had access it has",
    "start": "478139",
    "end": "480060"
  },
  {
    "text": "bright access to the ram so leveraging",
    "start": "480060",
    "end": "482400"
  },
  {
    "text": "the macro sequencer you have access to",
    "start": "482400",
    "end": "484259"
  },
  {
    "text": "the microcode and to like modify it so",
    "start": "484259",
    "end": "487560"
  },
  {
    "text": "here we can I would say let's have an",
    "start": "487560",
    "end": "490139"
  },
  {
    "text": "idea we know that the ldot can access",
    "start": "490139",
    "end": "493620"
  },
  {
    "text": "the microcode sequencer and that the",
    "start": "493620",
    "end": "496139"
  },
  {
    "text": "ldap is can be accessed through the CR",
    "start": "496139",
    "end": "499440"
  },
  {
    "text": "bus all right so if we now access the CR",
    "start": "499440",
    "end": "504000"
  },
  {
    "text": "bus we can basically control the",
    "start": "504000",
    "end": "506699"
  },
  {
    "text": "microcode yes basically if you can",
    "start": "506699",
    "end": "508500"
  },
  {
    "text": "access this your bus then you have",
    "start": "508500",
    "end": "510060"
  },
  {
    "text": "Microsoft control okay but we need one",
    "start": "510060",
    "end": "512580"
  },
  {
    "text": "more building block oh yeah so you were",
    "start": "512580",
    "end": "514860"
  },
  {
    "text": "talking about or I was talking actually",
    "start": "514860",
    "end": "517500"
  },
  {
    "text": "about this undocumented instructions so",
    "start": "517500",
    "end": "519839"
  },
  {
    "text": "let's take a look on how those work and",
    "start": "519839",
    "end": "522180"
  },
  {
    "text": "what we can access with them yeah so",
    "start": "522180",
    "end": "524520"
  },
  {
    "text": "like one of the discoveries of positive",
    "start": "524520",
    "end": "526260"
  },
  {
    "text": "technology guys was this existence of",
    "start": "526260",
    "end": "529019"
  },
  {
    "text": "this and documented destruction that has",
    "start": "529019",
    "end": "530640"
  },
  {
    "text": "access with like a few internal",
    "start": "530640",
    "end": "532740"
  },
  {
    "text": "components of the CPU among those that's",
    "start": "532740",
    "end": "535380"
  },
  {
    "text": "the sheer bus awesome so we have our",
    "start": "535380",
    "end": "537959"
  },
  {
    "text": "primitive too so yeah we can leverage",
    "start": "537959",
    "end": "539940"
  },
  {
    "text": "this primitive as an easy way to access",
    "start": "539940",
    "end": "542820"
  },
  {
    "text": "this year bus for red unlocked CPUs like",
    "start": "542820",
    "end": "545580"
  },
  {
    "text": "the government but the problem is that",
    "start": "545580",
    "end": "547800"
  },
  {
    "text": "okay but what can we do with this how",
    "start": "547800",
    "end": "550560"
  },
  {
    "text": "can we access the ldot like how does it",
    "start": "550560",
    "end": "552720"
  },
  {
    "text": "work and here like our the compiler came",
    "start": "552720",
    "end": "555660"
  },
  {
    "text": "handy since we can analyze what the CPU",
    "start": "555660",
    "end": "558600"
  },
  {
    "text": "does with the CR bus to access the ldot",
    "start": "558600",
    "end": "561120"
  },
  {
    "text": "to modify the microbot sequencer and",
    "start": "561120",
    "end": "563580"
  },
  {
    "text": "just copy that yes we know that the CPU",
    "start": "563580",
    "end": "565800"
  },
  {
    "text": "knows how to do that so we can just do",
    "start": "565800",
    "end": "567660"
  },
  {
    "text": "the same thing and we can Define like",
    "start": "567660",
    "end": "569880"
  },
  {
    "text": "easy wrappers around this where you can",
    "start": "569880",
    "end": "572339"
  },
  {
    "text": "like access the microcode sequencer and",
    "start": "572339",
    "end": "575160"
  },
  {
    "text": "for example with these wrappers that's",
    "start": "575160",
    "end": "577440"
  },
  {
    "text": "like just copy what the CPU are doing",
    "start": "577440",
    "end": "579720"
  },
  {
    "text": "and access the like ldot ports you can",
    "start": "579720",
    "end": "582660"
  },
  {
    "text": "like access the microcode access the",
    "start": "582660",
    "end": "585120"
  },
  {
    "text": "sequence word and even the matching",
    "start": "585120",
    "end": "586500"
  },
  {
    "text": "patch yeah so we have arbitrary written",
    "start": "586500",
    "end": "589019"
  },
  {
    "text": "right and you already mentioned that",
    "start": "589019",
    "end": "591720"
  },
  {
    "text": "match and fetch mechanism so we were",
    "start": "591720",
    "end": "593700"
  },
  {
    "text": "thinking about it like maybe to a",
    "start": "593700",
    "end": "595800"
  },
  {
    "text": "similar extent as like software hooking",
    "start": "595800",
    "end": "598320"
  },
  {
    "text": "where you say like I want to overwrite",
    "start": "598320",
    "end": "600720"
  },
  {
    "text": "this function and point redirect it to",
    "start": "600720",
    "end": "603779"
  },
  {
    "text": "the other one so is it is it really that",
    "start": "603779",
    "end": "605820"
  },
  {
    "text": "simple in the microcode yeah so we can",
    "start": "605820",
    "end": "608100"
  },
  {
    "text": "still leverage our the compiler to",
    "start": "608100",
    "end": "609839"
  },
  {
    "text": "understand how the CPU uses the machine",
    "start": "609839",
    "end": "611580"
  },
  {
    "text": "patch and device like the simple formula",
    "start": "611580",
    "end": "614160"
  },
  {
    "text": "that the CPU uses to like program this",
    "start": "614160",
    "end": "617399"
  },
  {
    "text": "machine parts so every time we want to",
    "start": "617399",
    "end": "619800"
  },
  {
    "text": "hook something or pass something we can",
    "start": "619800",
    "end": "622320"
  },
  {
    "text": "program the address to the matching",
    "start": "622320",
    "end": "623820"
  },
  {
    "text": "patch to just jump to the instruction",
    "start": "623820",
    "end": "625620"
  },
  {
    "text": "that we want",
    "start": "625620",
    "end": "627060"
  },
  {
    "text": "awesome so if we sum that up this is",
    "start": "627060",
    "end": "630180"
  },
  {
    "text": "like I can hook a microcode update and",
    "start": "630180",
    "end": "632880"
  },
  {
    "text": "override it with my own code so it's",
    "start": "632880",
    "end": "634980"
  },
  {
    "text": "super custom now yes and this brings to",
    "start": "634980",
    "end": "637440"
  },
  {
    "text": "our framework we can leverage this",
    "start": "637440",
    "end": "639959"
  },
  {
    "text": "undocumented instruction to patch the",
    "start": "639959",
    "end": "642240"
  },
  {
    "text": "microcode Via software this allows us to",
    "start": "642240",
    "end": "644880"
  },
  {
    "text": "observe completely the CPU Behavior but",
    "start": "644880",
    "end": "647399"
  },
  {
    "text": "also to completely control their",
    "start": "647399",
    "end": "649560"
  },
  {
    "text": "behavior and all of this via software",
    "start": "649560",
    "end": "651959"
  },
  {
    "text": "like either with a custom bios like a",
    "start": "651959",
    "end": "654240"
  },
  {
    "text": "ufi application or a kernel module so",
    "start": "654240",
    "end": "657480"
  },
  {
    "text": "summing up the framework I think we can",
    "start": "657480",
    "end": "659579"
  },
  {
    "text": "now patch code we can hook code run our",
    "start": "659579",
    "end": "662339"
  },
  {
    "text": "own custom code and I think we can even",
    "start": "662339",
    "end": "665040"
  },
  {
    "text": "do more right we can yes we can trace",
    "start": "665040",
    "end": "667440"
  },
  {
    "text": "the code and we will see how but let's",
    "start": "667440",
    "end": "669060"
  },
  {
    "text": "start first from patching code",
    "start": "669060",
    "end": "671160"
  },
  {
    "text": "so with you got Patches we can change",
    "start": "671160",
    "end": "673860"
  },
  {
    "text": "the CPU behavior and notice that usually",
    "start": "673860",
    "end": "677040"
  },
  {
    "text": "only Intel is allowed to do that since",
    "start": "677040",
    "end": "679019"
  },
  {
    "text": "microgot patches are signed and you're",
    "start": "679019",
    "end": "681240"
  },
  {
    "text": "not supposed to load your patches but",
    "start": "681240",
    "end": "683640"
  },
  {
    "text": "with our framework we can inject",
    "start": "683640",
    "end": "685500"
  },
  {
    "text": "microcode patches to change completely",
    "start": "685500",
    "end": "687959"
  },
  {
    "text": "CPU Behavior like we can change",
    "start": "687959",
    "end": "690120"
  },
  {
    "text": "microcoded instructions with this or",
    "start": "690120",
    "end": "692220"
  },
  {
    "text": "even add functionalities to the CPU",
    "start": "692220",
    "end": "694440"
  },
  {
    "text": "so maybe we go up a step back I think",
    "start": "694440",
    "end": "698279"
  },
  {
    "text": "it's too complicated here at the moment",
    "start": "698279",
    "end": "700200"
  },
  {
    "text": "let's do a simple program maybe",
    "start": "700200",
    "end": "702360"
  },
  {
    "text": "something like Hello World in microcode",
    "start": "702360",
    "end": "704399"
  },
  {
    "text": "yes so let me present you the first",
    "start": "704399",
    "end": "707100"
  },
  {
    "text": "microcode part shallow world so I was",
    "start": "707100",
    "end": "709680"
  },
  {
    "text": "thinking what can we do with an L word",
    "start": "709680",
    "end": "711180"
  },
  {
    "text": "and like let's pick the art Duran",
    "start": "711180",
    "end": "713459"
  },
  {
    "text": "Destruction for example so rdrand is",
    "start": "713459",
    "end": "715200"
  },
  {
    "text": "supposed to provide you a",
    "start": "715200",
    "end": "716640"
  },
  {
    "text": "cryptographically strong random number",
    "start": "716640",
    "end": "719040"
  },
  {
    "text": "so let's piss off some cryptographers",
    "start": "719040",
    "end": "721500"
  },
  {
    "text": "and let's make it return hello world",
    "start": "721500",
    "end": "724140"
  },
  {
    "text": "with our framework",
    "start": "724140",
    "end": "726420"
  },
  {
    "text": "you can select what do we want to eat to",
    "start": "726420",
    "end": "729420"
  },
  {
    "text": "hook and then where do you want to jump",
    "start": "729420",
    "end": "731700"
  },
  {
    "text": "for the instruction and you can see",
    "start": "731700",
    "end": "733980"
  },
  {
    "text": "there we have two micro operations that",
    "start": "733980",
    "end": "736560"
  },
  {
    "text": "load hello world to the registers so",
    "start": "736560",
    "end": "738959"
  },
  {
    "text": "that you will not have random numbers",
    "start": "738959",
    "end": "740160"
  },
  {
    "text": "but hello order and then you just end",
    "start": "740160",
    "end": "743459"
  },
  {
    "text": "the instruction stream and tell the CPU",
    "start": "743459",
    "end": "745500"
  },
  {
    "text": "okay you're done but I think you left",
    "start": "745500",
    "end": "749160"
  },
  {
    "text": "out one point we kind of need to",
    "start": "749160",
    "end": "750720"
  },
  {
    "text": "assemble this stuff yes so we brought an",
    "start": "750720",
    "end": "753180"
  },
  {
    "text": "assembler for the microcode so that our",
    "start": "753180",
    "end": "755519"
  },
  {
    "text": "framework translates from a textual",
    "start": "755519",
    "end": "757440"
  },
  {
    "text": "representation of the macro code to the",
    "start": "757440",
    "end": "759779"
  },
  {
    "text": "interactions that you need to do to the",
    "start": "759779",
    "end": "761519"
  },
  {
    "text": "macrobot sequencer to actually patch the",
    "start": "761519",
    "end": "763860"
  },
  {
    "text": "micro code so we assemble the microcode",
    "start": "763860",
    "end": "766079"
  },
  {
    "text": "write it to the address that we set in",
    "start": "766079",
    "end": "768180"
  },
  {
    "text": "this case 730 that is just the like",
    "start": "768180",
    "end": "770940"
  },
  {
    "text": "starting address of the UVO drum and",
    "start": "770940",
    "end": "773399"
  },
  {
    "text": "then we set up the matching patch so",
    "start": "773399",
    "end": "775380"
  },
  {
    "text": "that every time you execute our Durand",
    "start": "775380",
    "end": "777180"
  },
  {
    "text": "you actually return L word so I think",
    "start": "777180",
    "end": "780180"
  },
  {
    "text": "the example is kind of nice and handy",
    "start": "780180",
    "end": "782339"
  },
  {
    "text": "but I think the people here want to see",
    "start": "782339",
    "end": "784440"
  },
  {
    "text": "something more yeah it easier so let's",
    "start": "784440",
    "end": "787500"
  },
  {
    "text": "do something more interest",
    "start": "787500",
    "end": "789240"
  },
  {
    "text": "we can okay we know that Rd running",
    "start": "789240",
    "end": "791459"
  },
  {
    "text": "returns like randomly though so like",
    "start": "791459",
    "end": "794459"
  },
  {
    "text": "let's change this I don't like random",
    "start": "794459",
    "end": "796079"
  },
  {
    "text": "data I want to look something",
    "start": "796079",
    "end": "797279"
  },
  {
    "text": "interesting so let's make cardi run",
    "start": "797279",
    "end": "799320"
  },
  {
    "text": "return system management mode memory so",
    "start": "799320",
    "end": "802019"
  },
  {
    "text": "system management mode is this caged",
    "start": "802019",
    "end": "804120"
  },
  {
    "text": "environment in the CPO is like this ring",
    "start": "804120",
    "end": "806519"
  },
  {
    "text": "-2 mode where you are not obviously",
    "start": "806519",
    "end": "808680"
  },
  {
    "text": "supposed to access it but we can change",
    "start": "808680",
    "end": "810839"
  },
  {
    "text": "the microcode for the algebra",
    "start": "810839",
    "end": "812160"
  },
  {
    "text": "instruction to just load the SM ROM",
    "start": "812160",
    "end": "814980"
  },
  {
    "text": "address for example but what happens if",
    "start": "814980",
    "end": "817200"
  },
  {
    "text": "you now read from this so yeah this is",
    "start": "817200",
    "end": "819420"
  },
  {
    "text": "like a cage memory so if you do this you",
    "start": "819420",
    "end": "821760"
  },
  {
    "text": "will read a bunch of F's like if you",
    "start": "821760",
    "end": "823440"
  },
  {
    "text": "access for example Enclave memory from",
    "start": "823440",
    "end": "825420"
  },
  {
    "text": "outside on Enclave the CPU protects",
    "start": "825420",
    "end": "827639"
  },
  {
    "text": "sorry the mmu protects that region so",
    "start": "827639",
    "end": "830279"
  },
  {
    "text": "you will not able to access it but we",
    "start": "830279",
    "end": "832440"
  },
  {
    "text": "are in the microcode so we can change",
    "start": "832440",
    "end": "834000"
  },
  {
    "text": "this and leveraging our framework we can",
    "start": "834000",
    "end": "836579"
  },
  {
    "text": "understand where the configuration for",
    "start": "836579",
    "end": "839100"
  },
  {
    "text": "the SM ROM is like located in the CR bus",
    "start": "839100",
    "end": "841620"
  },
  {
    "text": "and actually zero it out",
    "start": "841620",
    "end": "843720"
  },
  {
    "text": "so that this SM room will not be",
    "start": "843720",
    "end": "846000"
  },
  {
    "text": "protected anymore yes but then you break",
    "start": "846000",
    "end": "848160"
  },
  {
    "text": "the CPU right yeah so the CPU will not",
    "start": "848160",
    "end": "850260"
  },
  {
    "text": "be happy about this since you're like",
    "start": "850260",
    "end": "851579"
  },
  {
    "text": "just disabling smm so you can save and",
    "start": "851579",
    "end": "854519"
  },
  {
    "text": "restore the smm configuration but just",
    "start": "854519",
    "end": "857339"
  },
  {
    "text": "after you're dumping that oh that's",
    "start": "857339",
    "end": "859019"
  },
  {
    "text": "really nice so but I think the people",
    "start": "859019",
    "end": "861899"
  },
  {
    "text": "might not believe us so let's show them",
    "start": "861899",
    "end": "864600"
  },
  {
    "text": "a demo yeah like let's show something",
    "start": "864600",
    "end": "866760"
  },
  {
    "text": "cool so here for example we have a",
    "start": "866760",
    "end": "869519"
  },
  {
    "text": "simple program in our ufi application",
    "start": "869519",
    "end": "871260"
  },
  {
    "text": "where you just dump like the ardu and",
    "start": "871260",
    "end": "873779"
  },
  {
    "text": "others like they are their results with",
    "start": "873779",
    "end": "876600"
  },
  {
    "text": "random data here but we can program the",
    "start": "876600",
    "end": "879540"
  },
  {
    "text": "CPU with our patches to change it and",
    "start": "879540",
    "end": "882180"
  },
  {
    "text": "actually return L word to that so that",
    "start": "882180",
    "end": "884699"
  },
  {
    "text": "with this with our CPU framework with",
    "start": "884699",
    "end": "886920"
  },
  {
    "text": "our custom Processing Unit framework we",
    "start": "886920",
    "end": "889079"
  },
  {
    "text": "hook the patch and the next time that",
    "start": "889079",
    "end": "891000"
  },
  {
    "text": "you execute rd-ron you have L word wow",
    "start": "891000",
    "end": "893519"
  },
  {
    "text": "that's super cool and about the system",
    "start": "893519",
    "end": "895920"
  },
  {
    "text": "management yes so let's go there more",
    "start": "895920",
    "end": "898320"
  },
  {
    "text": "cool stuff yeah and we still have like a",
    "start": "898320",
    "end": "900660"
  },
  {
    "text": "simple program that dumps a bunch of",
    "start": "900660",
    "end": "903000"
  },
  {
    "text": "buffer filled with on our Duran content",
    "start": "903000",
    "end": "905160"
  },
  {
    "text": "and it's obviously random since random",
    "start": "905160",
    "end": "907860"
  },
  {
    "text": "data but let's apply our fetch the patch",
    "start": "907860",
    "end": "910860"
  },
  {
    "text": "that you've seen before just modify to",
    "start": "910860",
    "end": "912540"
  },
  {
    "text": "like dump different addresses and not",
    "start": "912540",
    "end": "914639"
  },
  {
    "text": "only one and we can apply our patch and",
    "start": "914639",
    "end": "917220"
  },
  {
    "text": "the next time we execute the program",
    "start": "917220",
    "end": "918540"
  },
  {
    "text": "that dumps memory they already around",
    "start": "918540",
    "end": "921000"
  },
  {
    "text": "you actually dump system management mode",
    "start": "921000",
    "end": "923100"
  },
  {
    "text": "memory you can see the header of system",
    "start": "923100",
    "end": "925019"
  },
  {
    "text": "management mode there oh yeah awesome",
    "start": "925019",
    "end": "928260"
  },
  {
    "text": "so",
    "start": "928260",
    "end": "929579"
  },
  {
    "text": "going further so now we can do something",
    "start": "929579",
    "end": "932579"
  },
  {
    "text": "more you already mentioned it what",
    "start": "932579",
    "end": "934560"
  },
  {
    "text": "happens if we now set up this match and",
    "start": "934560",
    "end": "936600"
  },
  {
    "text": "Patch mechanism",
    "start": "936600",
    "end": "938160"
  },
  {
    "text": "and execute custom microcode at certain",
    "start": "938160",
    "end": "941279"
  },
  {
    "text": "events right yeah and resume the",
    "start": "941279",
    "end": "943740"
  },
  {
    "text": "execution we basically don't need to",
    "start": "943740",
    "end": "945959"
  },
  {
    "text": "fetch stuff but we actually find",
    "start": "945959",
    "end": "947579"
  },
  {
    "text": "something out about it yeah so we we",
    "start": "947579",
    "end": "949680"
  },
  {
    "text": "don't have to like stop an instruction",
    "start": "949680",
    "end": "951540"
  },
  {
    "text": "after the rooking that you can simple",
    "start": "951540",
    "end": "953459"
  },
  {
    "text": "continue the execution and this brings",
    "start": "953459",
    "end": "955560"
  },
  {
    "text": "to like microcode hooks where you can",
    "start": "955560",
    "end": "957779"
  },
  {
    "text": "execute more code and extend the",
    "start": "957779",
    "end": "960060"
  },
  {
    "text": "functionalities of something or for",
    "start": "960060",
    "end": "962040"
  },
  {
    "text": "example observe stuff",
    "start": "962040",
    "end": "964199"
  },
  {
    "text": "so after executing an instruction if you",
    "start": "964199",
    "end": "966720"
  },
  {
    "text": "resolve the execution on the CPU will",
    "start": "966720",
    "end": "968160"
  },
  {
    "text": "like not even notice that you like",
    "start": "968160",
    "end": "969779"
  },
  {
    "text": "hijack that and for example here we can",
    "start": "969779",
    "end": "973459"
  },
  {
    "text": "like make our own performance counters",
    "start": "973459",
    "end": "976800"
  },
  {
    "text": "so let's assume that you want to observe",
    "start": "976800",
    "end": "978300"
  },
  {
    "text": "something in sapu but like the CPU is",
    "start": "978300",
    "end": "981660"
  },
  {
    "text": "not nice enough to already have that",
    "start": "981660",
    "end": "984180"
  },
  {
    "text": "performance counter that you want to",
    "start": "984180",
    "end": "985560"
  },
  {
    "text": "observe set up for you and let's assume",
    "start": "985560",
    "end": "988380"
  },
  {
    "text": "that you want to observe I don't know",
    "start": "988380",
    "end": "989940"
  },
  {
    "text": "every time the vert W extraction is",
    "start": "989940",
    "end": "992040"
  },
  {
    "text": "executed you know it Intel uses a lot",
    "start": "992040",
    "end": "994139"
  },
  {
    "text": "this instruction to like a patch like",
    "start": "994139",
    "end": "997500"
  },
  {
    "text": "vulnerability is there to flush internal",
    "start": "997500",
    "end": "999600"
  },
  {
    "text": "buffers for example for MDS mitigation",
    "start": "999600",
    "end": "1001820"
  },
  {
    "text": "so maybe you want to understand okay but",
    "start": "1001820",
    "end": "1003740"
  },
  {
    "text": "okay given a full system let me know how",
    "start": "1003740",
    "end": "1006199"
  },
  {
    "text": "many times you you did that actually",
    "start": "1006199",
    "end": "1008120"
  },
  {
    "text": "exactly and we can leverage our hooks to",
    "start": "1008120",
    "end": "1011360"
  },
  {
    "text": "hook the entry point of the instruction",
    "start": "1011360",
    "end": "1013399"
  },
  {
    "text": "that we want to trace so so that we want",
    "start": "1013399",
    "end": "1015560"
  },
  {
    "text": "to hook and then continue with after and",
    "start": "1015560",
    "end": "1017899"
  },
  {
    "text": "in our hook we can just Implement a",
    "start": "1017899",
    "end": "1019519"
  },
  {
    "text": "simple counter that will be incremented",
    "start": "1019519",
    "end": "1021680"
  },
  {
    "text": "every time the instruction is executed",
    "start": "1021680",
    "end": "1023839"
  },
  {
    "text": "so you will effectively have defined",
    "start": "1023839",
    "end": "1026600"
  },
  {
    "text": "your own performance counter that's",
    "start": "1026600",
    "end": "1028938"
  },
  {
    "text": "awesome but I guess you can even do more",
    "start": "1028939",
    "end": "1031220"
  },
  {
    "text": "with that yes we can be smarter with the",
    "start": "1031220",
    "end": "1033319"
  },
  {
    "text": "hooks if we Define a hook that every",
    "start": "1033319",
    "end": "1035660"
  },
  {
    "text": "time it gets triggered like it just",
    "start": "1035660",
    "end": "1037760"
  },
  {
    "text": "dumps the timestamp when it got",
    "start": "1037760",
    "end": "1039740"
  },
  {
    "text": "triggered you can then like program this",
    "start": "1039740",
    "end": "1042980"
  },
  {
    "text": "hook for every single micro operation in",
    "start": "1042980",
    "end": "1045500"
  },
  {
    "text": "the CPU and every time an a micro",
    "start": "1045500",
    "end": "1047959"
  },
  {
    "text": "operation will be executed you will dump",
    "start": "1047959",
    "end": "1049880"
  },
  {
    "text": "the timestamp where that micro operation",
    "start": "1049880",
    "end": "1051980"
  },
  {
    "text": "is executed in the end you will have all",
    "start": "1051980",
    "end": "1055039"
  },
  {
    "text": "the timestamp that got triggered by this",
    "start": "1055039",
    "end": "1057440"
  },
  {
    "text": "hook and then you can reorder them so",
    "start": "1057440",
    "end": "1059900"
  },
  {
    "text": "that effectively you can obtain a trace",
    "start": "1059900",
    "end": "1061580"
  },
  {
    "text": "of the micro operations that are",
    "start": "1061580",
    "end": "1063620"
  },
  {
    "text": "executed in the CPU and this basically",
    "start": "1063620",
    "end": "1065960"
  },
  {
    "text": "leads to a microcode control flow red",
    "start": "1065960",
    "end": "1068600"
  },
  {
    "text": "you exactly know what's going on inside",
    "start": "1068600",
    "end": "1070460"
  },
  {
    "text": "you you are effectively doing a dynamic",
    "start": "1070460",
    "end": "1072679"
  },
  {
    "text": "trace of the microcode that is executed",
    "start": "1072679",
    "end": "1074900"
  },
  {
    "text": "in the CPU so now we have all the",
    "start": "1074900",
    "end": "1077240"
  },
  {
    "text": "building blocks to look at the microcode",
    "start": "1077240",
    "end": "1079220"
  },
  {
    "text": "update routine yeah so what can we do",
    "start": "1079220",
    "end": "1081679"
  },
  {
    "text": "with these phrases for example we can",
    "start": "1081679",
    "end": "1083480"
  },
  {
    "text": "apply these traces so you can observe",
    "start": "1083480",
    "end": "1085340"
  },
  {
    "text": "like literally everything the CPU is",
    "start": "1085340",
    "end": "1087140"
  },
  {
    "text": "doing with the macro code and we did",
    "start": "1087140",
    "end": "1089000"
  },
  {
    "text": "that for microgrid updates so so if you",
    "start": "1089000",
    "end": "1091340"
  },
  {
    "text": "look at the mcgregate updates statically",
    "start": "1091340",
    "end": "1092960"
  },
  {
    "text": "you will find a huge amount of code that",
    "start": "1092960",
    "end": "1095059"
  },
  {
    "text": "will be like really hard to reverse",
    "start": "1095059",
    "end": "1096260"
  },
  {
    "text": "engineering even with our decompiler but",
    "start": "1096260",
    "end": "1099380"
  },
  {
    "text": "with traces it gets much better since",
    "start": "1099380",
    "end": "1101299"
  },
  {
    "text": "you can observe exactly which control",
    "start": "1101299",
    "end": "1103340"
  },
  {
    "text": "flow inside the microwave updates is",
    "start": "1103340",
    "end": "1106220"
  },
  {
    "text": "taken so now we can trigger microcode",
    "start": "1106220",
    "end": "1108799"
  },
  {
    "text": "update for instance then Trace if a",
    "start": "1108799",
    "end": "1111860"
  },
  {
    "text": "micro instruction is executed and then",
    "start": "1111860",
    "end": "1114140"
  },
  {
    "text": "repeat for all the possible micro call",
    "start": "1114140",
    "end": "1117140"
  },
  {
    "text": "instructions and then we just restore",
    "start": "1117140",
    "end": "1119660"
  },
  {
    "text": "the order again check out the timestamps",
    "start": "1119660",
    "end": "1121700"
  },
  {
    "text": "and we see exactly which microcode",
    "start": "1121700",
    "end": "1124400"
  },
  {
    "text": "instructions were accessed are so you",
    "start": "1124400",
    "end": "1126799"
  },
  {
    "text": "effectively reverse engineer the",
    "start": "1126799",
    "end": "1128179"
  },
  {
    "text": "microbial update algorithm that is",
    "start": "1128179",
    "end": "1129740"
  },
  {
    "text": "always being kept secrets by Intel so",
    "start": "1129740",
    "end": "1131960"
  },
  {
    "text": "here we like analyze what is happening",
    "start": "1131960",
    "end": "1133940"
  },
  {
    "text": "during a microcode update and a",
    "start": "1133940",
    "end": "1136100"
  },
  {
    "text": "microcode update is usually triggered by",
    "start": "1136100",
    "end": "1138500"
  },
  {
    "text": "a bright MSR and the first thing that",
    "start": "1138500",
    "end": "1140660"
  },
  {
    "text": "the CPU does is okay you have to apply",
    "start": "1140660",
    "end": "1143179"
  },
  {
    "text": "this update and encrypt it so it first",
    "start": "1143179",
    "end": "1145640"
  },
  {
    "text": "moves the update to a secret location",
    "start": "1145640",
    "end": "1147740"
  },
  {
    "text": "there is no more secret but it's like",
    "start": "1147740",
    "end": "1150140"
  },
  {
    "text": "fpv zero one thousand for example in",
    "start": "1150140",
    "end": "1152360"
  },
  {
    "text": "Goldman CPUs and these are special",
    "start": "1152360",
    "end": "1154220"
  },
  {
    "text": "physical address where the CPU puts the",
    "start": "1154220",
    "end": "1156200"
  },
  {
    "text": "microcode of date and we can look at the",
    "start": "1156200",
    "end": "1158240"
  },
  {
    "text": "format of the magical date that we",
    "start": "1158240",
    "end": "1159860"
  },
  {
    "text": "reverse engineered at the beginning we",
    "start": "1159860",
    "end": "1161660"
  },
  {
    "text": "have like some metadata that is like the",
    "start": "1161660",
    "end": "1163280"
  },
  {
    "text": "date where the microbial date was",
    "start": "1163280",
    "end": "1164720"
  },
  {
    "text": "published the security version number of",
    "start": "1164720",
    "end": "1166640"
  },
  {
    "text": "the CPU ID that the microgridize is for",
    "start": "1166640",
    "end": "1169880"
  },
  {
    "text": "and then you have like a nouns we will",
    "start": "1169880",
    "end": "1172640"
  },
  {
    "text": "like focus on that later but it's used",
    "start": "1172640",
    "end": "1174799"
  },
  {
    "text": "to like generate the decryption key for",
    "start": "1174799",
    "end": "1177020"
  },
  {
    "text": "the motherboard update and then you have",
    "start": "1177020",
    "end": "1178700"
  },
  {
    "text": "the RSA signature stuff so that you can",
    "start": "1178700",
    "end": "1181880"
  },
  {
    "text": "like this CPU can verify that the macro",
    "start": "1181880",
    "end": "1184400"
  },
  {
    "text": "got a date was actually from Intel and",
    "start": "1184400",
    "end": "1187340"
  },
  {
    "text": "it was signed so the first thing that",
    "start": "1187340",
    "end": "1189440"
  },
  {
    "text": "happens at the micrograph date is okay",
    "start": "1189440",
    "end": "1192020"
  },
  {
    "text": "you have to check that the signature is",
    "start": "1192020",
    "end": "1194780"
  },
  {
    "text": "what you expect for so the CPU has a",
    "start": "1194780",
    "end": "1196880"
  },
  {
    "text": "white list of the modulus and the",
    "start": "1196880",
    "end": "1198860"
  },
  {
    "text": "exponents that you can accept so that he",
    "start": "1198860",
    "end": "1201260"
  },
  {
    "text": "knows that he don't didn't go tempered",
    "start": "1201260",
    "end": "1204140"
  },
  {
    "text": "then you then you have to generate the",
    "start": "1204140",
    "end": "1206240"
  },
  {
    "text": "key to decrypt the update and the CPU",
    "start": "1206240",
    "end": "1208760"
  },
  {
    "text": "does this with two different Secrets One",
    "start": "1208760",
    "end": "1211340"
  },
  {
    "text": "secret is the notes and it's embedded in",
    "start": "1211340",
    "end": "1213980"
  },
  {
    "text": "every single macro called update and is",
    "start": "1213980",
    "end": "1215720"
  },
  {
    "text": "always different per update then we have",
    "start": "1215720",
    "end": "1218000"
  },
  {
    "text": "another secret that is Percival and",
    "start": "1218000",
    "end": "1220400"
  },
  {
    "text": "every CPU has this like in like uh",
    "start": "1220400",
    "end": "1223280"
  },
  {
    "text": "secret and random number that he uses in",
    "start": "1223280",
    "end": "1226220"
  },
  {
    "text": "combination with the nodes to generate",
    "start": "1226220",
    "end": "1228440"
  },
  {
    "text": "and to like do a case function algorithm",
    "start": "1228440",
    "end": "1230900"
  },
  {
    "text": "based on shock to generate the",
    "start": "1230900",
    "end": "1232640"
  },
  {
    "text": "decryption key",
    "start": "1232640",
    "end": "1234260"
  },
  {
    "text": "the rc4 key then is generated so that we",
    "start": "1234260",
    "end": "1236960"
  },
  {
    "text": "can like use rc4 to decrypt and as a",
    "start": "1236960",
    "end": "1241160"
  },
  {
    "text": "best practice and they do that they",
    "start": "1241160",
    "end": "1243140"
  },
  {
    "text": "eliminate the first Ox 200 bytes since",
    "start": "1243140",
    "end": "1245539"
  },
  {
    "text": "they were like too tight with the like",
    "start": "1245539",
    "end": "1247280"
  },
  {
    "text": "key bytes",
    "start": "1247280",
    "end": "1248720"
  },
  {
    "text": "so now I guess that after generating the",
    "start": "1248720",
    "end": "1250940"
  },
  {
    "text": "key we can go to the Crypt the update",
    "start": "1250940",
    "end": "1254660"
  },
  {
    "text": "obviously after having to decrypt the",
    "start": "1254660",
    "end": "1256820"
  },
  {
    "text": "update you have to check that the grid",
    "start": "1256820",
    "end": "1259039"
  },
  {
    "text": "adapted the decrypted update was",
    "start": "1259039",
    "end": "1261620"
  },
  {
    "text": "actually signed correctly so the shot",
    "start": "1261620",
    "end": "1264559"
  },
  {
    "text": "256 of the update is calculated which is",
    "start": "1264559",
    "end": "1267500"
  },
  {
    "text": "computed combining with the metadata and",
    "start": "1267500",
    "end": "1269900"
  },
  {
    "text": "the nuns so that you cannot tamper with",
    "start": "1269900",
    "end": "1271580"
  },
  {
    "text": "that and if the verification succeeds",
    "start": "1271580",
    "end": "1275600"
  },
  {
    "text": "then you finally can pass the microgrid",
    "start": "1275600",
    "end": "1278419"
  },
  {
    "text": "of days",
    "start": "1278419",
    "end": "1279559"
  },
  {
    "text": "awesome so I was wondering you are",
    "start": "1279559",
    "end": "1282620"
  },
  {
    "text": "mentioning this weird address here at",
    "start": "1282620",
    "end": "1285200"
  },
  {
    "text": "the beginning so what is that yeah so",
    "start": "1285200",
    "end": "1287960"
  },
  {
    "text": "it's so interesting to try to deepen",
    "start": "1287960",
    "end": "1290240"
  },
  {
    "text": "okay what is this address",
    "start": "1290240",
    "end": "1292580"
  },
  {
    "text": "this address is like this special",
    "start": "1292580",
    "end": "1294440"
  },
  {
    "text": "physical location that the CPU uses to",
    "start": "1294440",
    "end": "1297140"
  },
  {
    "text": "save the microphone update to move the",
    "start": "1297140",
    "end": "1299539"
  },
  {
    "text": "macro code update there so if we query",
    "start": "1299539",
    "end": "1301580"
  },
  {
    "text": "the operating system the poor operating",
    "start": "1301580",
    "end": "1303200"
  },
  {
    "text": "system will have no idea what this this",
    "start": "1303200",
    "end": "1305059"
  },
  {
    "text": "other is for and we can also try to dump",
    "start": "1305059",
    "end": "1307400"
  },
  {
    "text": "this address and we will only read apps",
    "start": "1307400",
    "end": "1310039"
  },
  {
    "text": "like if you access an enclave or SSM",
    "start": "1310039",
    "end": "1312679"
  },
  {
    "text": "memory without unprotecting it so it",
    "start": "1312679",
    "end": "1314720"
  },
  {
    "text": "must be something special yes so we",
    "start": "1314720",
    "end": "1317299"
  },
  {
    "text": "should further investigate that maybe",
    "start": "1317299",
    "end": "1318799"
  },
  {
    "text": "like using our framework to see what's",
    "start": "1318799",
    "end": "1321200"
  },
  {
    "text": "going on right yes so we can see what",
    "start": "1321200",
    "end": "1323120"
  },
  {
    "text": "this the CPU is doing with this address",
    "start": "1323120",
    "end": "1324799"
  },
  {
    "text": "and we can see that this address is",
    "start": "1324799",
    "end": "1326960"
  },
  {
    "text": "dynamically enabled by the CPU every",
    "start": "1326960",
    "end": "1329120"
  },
  {
    "text": "time the microcode update is performed",
    "start": "1329120",
    "end": "1330860"
  },
  {
    "text": "the CPU of rights to the CR bus like a",
    "start": "1330860",
    "end": "1333799"
  },
  {
    "text": "bit that enables this address and we can",
    "start": "1333799",
    "end": "1336500"
  },
  {
    "text": "poke around this address so we can like",
    "start": "1336500",
    "end": "1339020"
  },
  {
    "text": "measure the access time when this",
    "start": "1339020",
    "end": "1340520"
  },
  {
    "text": "address is enabled and this is",
    "start": "1340520",
    "end": "1341960"
  },
  {
    "text": "surprising it's only 20 Cycles so mmio",
    "start": "1341960",
    "end": "1344840"
  },
  {
    "text": "usually is really slow and this address",
    "start": "1344840",
    "end": "1346460"
  },
  {
    "text": "is surprisingly fast",
    "start": "1346460",
    "end": "1348080"
  },
  {
    "text": "but we can also observe that the content",
    "start": "1348080",
    "end": "1351559"
  },
  {
    "text": "of this address is not shared between",
    "start": "1351559",
    "end": "1353600"
  },
  {
    "text": "the CPUs it's like the CPUs has local",
    "start": "1353600",
    "end": "1355880"
  },
  {
    "text": "view on this address and we can only fit",
    "start": "1355880",
    "end": "1358700"
  },
  {
    "text": "a small amount of relatively small",
    "start": "1358700",
    "end": "1361220"
  },
  {
    "text": "amount of data even if the mapped area",
    "start": "1361220",
    "end": "1363440"
  },
  {
    "text": "is much bigger and then with Observer",
    "start": "1363440",
    "end": "1366140"
  },
  {
    "text": "replacement policy on the address while",
    "start": "1366140",
    "end": "1368720"
  },
  {
    "text": "we write them we lose the data sometimes",
    "start": "1368720",
    "end": "1370640"
  },
  {
    "text": "okay that that reminds me of something",
    "start": "1370640",
    "end": "1373100"
  },
  {
    "text": "you have 20 Cycles it's super fast then",
    "start": "1373100",
    "end": "1376220"
  },
  {
    "text": "it's not shared between cores it fits to",
    "start": "1376220",
    "end": "1379460"
  },
  {
    "text": "a certain size",
    "start": "1379460",
    "end": "1380600"
  },
  {
    "text": "and then you have replacement policies",
    "start": "1380600",
    "end": "1382520"
  },
  {
    "text": "so this kind of indicates that it's kind",
    "start": "1382520",
    "end": "1384919"
  },
  {
    "text": "of a cache right yeah so our worry about",
    "start": "1384919",
    "end": "1386720"
  },
  {
    "text": "this is is that the CPU through this",
    "start": "1386720",
    "end": "1388580"
  },
  {
    "text": "physical address has a special view on",
    "start": "1388580",
    "end": "1390980"
  },
  {
    "text": "the L2 cache that is like Frozen and",
    "start": "1390980",
    "end": "1394039"
  },
  {
    "text": "used for the Micro World updates so that",
    "start": "1394039",
    "end": "1395780"
  },
  {
    "text": "they have so the CPU as like a private",
    "start": "1395780",
    "end": "1398480"
  },
  {
    "text": "buffer that is not accessible or",
    "start": "1398480",
    "end": "1400400"
  },
  {
    "text": "tamperable from for example other course",
    "start": "1400400",
    "end": "1403480"
  },
  {
    "text": "so let's look at the decrypted microcode",
    "start": "1403480",
    "end": "1406640"
  },
  {
    "text": "up there yeah so finally we got the",
    "start": "1406640",
    "end": "1408140"
  },
  {
    "text": "magical decrypted and you can look at",
    "start": "1408140",
    "end": "1410179"
  },
  {
    "text": "the structure oh yeah so you see some",
    "start": "1410179",
    "end": "1412340"
  },
  {
    "text": "kind of structure here again but yeah it",
    "start": "1412340",
    "end": "1414799"
  },
  {
    "text": "looks like a byte code maybe so what",
    "start": "1414799",
    "end": "1416720"
  },
  {
    "text": "yeah so you can still use our decompiler",
    "start": "1416720",
    "end": "1419419"
  },
  {
    "text": "to try to understand okay what is the",
    "start": "1419419",
    "end": "1421520"
  },
  {
    "text": "CPU doing with this update and it turns",
    "start": "1421520",
    "end": "1423440"
  },
  {
    "text": "out that I'm aggregate is actually by",
    "start": "1423440",
    "end": "1425900"
  },
  {
    "text": "its code it's interpreted by the CPU",
    "start": "1425900",
    "end": "1427820"
  },
  {
    "text": "it's like if you download an installer",
    "start": "1427820",
    "end": "1430460"
  },
  {
    "text": "that tells you how to update the CPU and",
    "start": "1430460",
    "end": "1433460"
  },
  {
    "text": "you have different comments that the CPU",
    "start": "1433460",
    "end": "1435380"
  },
  {
    "text": "that like the CPU follows while updating",
    "start": "1435380",
    "end": "1437659"
  },
  {
    "text": "for example resetting internal buffers",
    "start": "1437659",
    "end": "1440000"
  },
  {
    "text": "writing the microcode for the update",
    "start": "1440000",
    "end": "1441860"
  },
  {
    "text": "setting the match and Patch hooks or",
    "start": "1441860",
    "end": "1444980"
  },
  {
    "text": "even control flow directives so during",
    "start": "1444980",
    "end": "1447320"
  },
  {
    "text": "the update you can have like conditional",
    "start": "1447320",
    "end": "1449299"
  },
  {
    "text": "parts of the update based on different",
    "start": "1449299",
    "end": "1451280"
  },
  {
    "text": "conditions so this basically allows you",
    "start": "1451280",
    "end": "1454159"
  },
  {
    "text": "to deprecate things enable things this",
    "start": "1454159",
    "end": "1456500"
  },
  {
    "text": "is yeah like dynamically wow that's nice",
    "start": "1456500",
    "end": "1459380"
  },
  {
    "text": "so we should put all this together to",
    "start": "1459380",
    "end": "1462140"
  },
  {
    "text": "build a decrypto yeah so we created a",
    "start": "1462140",
    "end": "1464720"
  },
  {
    "text": "parser for microcode update collected",
    "start": "1464720",
    "end": "1466700"
  },
  {
    "text": "all the Microsoft",
    "start": "1466700",
    "end": "1468760"
  },
  {
    "text": "now in the CPU secrets so Goldman CPUs",
    "start": "1468760",
    "end": "1472039"
  },
  {
    "text": "and we decrypted all of them and we",
    "start": "1472039",
    "end": "1474679"
  },
  {
    "text": "released them publicly so that you can",
    "start": "1474679",
    "end": "1477080"
  },
  {
    "text": "look at that",
    "start": "1477080",
    "end": "1478520"
  },
  {
    "text": "all right that's super nice",
    "start": "1478520",
    "end": "1481460"
  },
  {
    "text": "uh one thing to mention also the",
    "start": "1481460",
    "end": "1483500"
  },
  {
    "text": "decompiler is like referred to in the in",
    "start": "1483500",
    "end": "1486320"
  },
  {
    "text": "the repository we don't it's a separate",
    "start": "1486320",
    "end": "1488720"
  },
  {
    "text": "GitHub yeah but and the compiler",
    "start": "1488720",
    "end": "1491000"
  },
  {
    "text": "supports macro updates so that you can",
    "start": "1491000",
    "end": "1492860"
  },
  {
    "text": "observe an eye level view of what the",
    "start": "1492860",
    "end": "1495080"
  },
  {
    "text": "macrocodile place actually purchased",
    "start": "1495080",
    "end": "1497600"
  },
  {
    "text": "but you already also mentioned at the",
    "start": "1497600",
    "end": "1499700"
  },
  {
    "text": "beginning that there's some more some",
    "start": "1499700",
    "end": "1501140"
  },
  {
    "text": "bonus content yeah okay let's look at",
    "start": "1501140",
    "end": "1502940"
  },
  {
    "text": "something cooler",
    "start": "1502940",
    "end": "1504320"
  },
  {
    "text": "and okay all this talk was about Goldman",
    "start": "1504320",
    "end": "1506900"
  },
  {
    "text": "CPUs but does this generalize so it's",
    "start": "1506900",
    "end": "1510440"
  },
  {
    "text": "really hard to say how much this",
    "start": "1510440",
    "end": "1511940"
  },
  {
    "text": "generalizes but we can hear for example",
    "start": "1511940",
    "end": "1514220"
  },
  {
    "text": "use a cool technique by Brandon Fork to",
    "start": "1514220",
    "end": "1517400"
  },
  {
    "text": "trace their performance counters during",
    "start": "1517400",
    "end": "1519620"
  },
  {
    "text": "the macro code update so the whole world",
    "start": "1519620",
    "end": "1522080"
  },
  {
    "text": "stops during the macro code updates but",
    "start": "1522080",
    "end": "1524000"
  },
  {
    "text": "not the performance counters so if we",
    "start": "1524000",
    "end": "1526100"
  },
  {
    "text": "trace the load sorry the execution ports",
    "start": "1526100",
    "end": "1529100"
  },
  {
    "text": "usage during the update we can try to",
    "start": "1529100",
    "end": "1531380"
  },
  {
    "text": "infer what is happening during the",
    "start": "1531380",
    "end": "1533360"
  },
  {
    "text": "update and we can see okay like",
    "start": "1533360",
    "end": "1535220"
  },
  {
    "text": "sometimes load and store ports are used",
    "start": "1535220",
    "end": "1537740"
  },
  {
    "text": "a lot so like this is like memory bounce",
    "start": "1537740",
    "end": "1540080"
  },
  {
    "text": "stuff maybe like meme copying around",
    "start": "1540080",
    "end": "1542179"
  },
  {
    "text": "maybe arithmetic stuff is used more so",
    "start": "1542179",
    "end": "1544279"
  },
  {
    "text": "you have a face where the macro is",
    "start": "1544279",
    "end": "1545900"
  },
  {
    "text": "decrypted so you can kind of try to",
    "start": "1545900",
    "end": "1547820"
  },
  {
    "text": "guess what is happening there and maybe",
    "start": "1547820",
    "end": "1549620"
  },
  {
    "text": "a machine learning guy will be handy",
    "start": "1549620",
    "end": "1551240"
  },
  {
    "text": "here to understand what it's doing yes",
    "start": "1551240",
    "end": "1553400"
  },
  {
    "text": "maybe",
    "start": "1553400",
    "end": "1554299"
  },
  {
    "text": "is there some machine learning guy here",
    "start": "1554299",
    "end": "1557200"
  },
  {
    "text": "but then let's go to some more bonuses",
    "start": "1557200",
    "end": "1560120"
  },
  {
    "text": "oh yes yeah",
    "start": "1560120",
    "end": "1561380"
  },
  {
    "text": "you you were mentioning like yesterday",
    "start": "1561380",
    "end": "1563419"
  },
  {
    "text": "the Epic league and I think you we can",
    "start": "1563419",
    "end": "1567980"
  },
  {
    "text": "kind of use the Epic yeah so we still",
    "start": "1567980",
    "end": "1570679"
  },
  {
    "text": "have a special address and the CPU wants",
    "start": "1570679",
    "end": "1572539"
  },
  {
    "text": "to access that address yesterday we were",
    "start": "1572539",
    "end": "1574760"
  },
  {
    "text": "talking about epic mmio and we can take",
    "start": "1574760",
    "end": "1577279"
  },
  {
    "text": "inspiration from a really cool exploit",
    "start": "1577279",
    "end": "1579200"
  },
  {
    "text": "by Chris Tomas where this called memory",
    "start": "1579200",
    "end": "1582440"
  },
  {
    "text": "sinkhole where you can move the Epic to",
    "start": "1582440",
    "end": "1584840"
  },
  {
    "text": "Shadow different things so original the",
    "start": "1584840",
    "end": "1587059"
  },
  {
    "text": "exploit was doing was like leveraged to",
    "start": "1587059",
    "end": "1589580"
  },
  {
    "text": "like break system management mode but",
    "start": "1589580",
    "end": "1591799"
  },
  {
    "text": "here we can move the Epic mmao region",
    "start": "1591799",
    "end": "1594020"
  },
  {
    "text": "over the L2 cache view of the processor",
    "start": "1594020",
    "end": "1597380"
  },
  {
    "text": "so that the processor actually access",
    "start": "1597380",
    "end": "1599179"
  },
  {
    "text": "the Epic and not the macro update",
    "start": "1599179",
    "end": "1601340"
  },
  {
    "text": "content so this is actually a failed",
    "start": "1601340",
    "end": "1603679"
  },
  {
    "text": "exploit unfortunately but we tried both",
    "start": "1603679",
    "end": "1607220"
  },
  {
    "text": "to move the Epic mmio over for example",
    "start": "1607220",
    "end": "1609620"
  },
  {
    "text": "the shot tables that the micro code",
    "start": "1609620",
    "end": "1611419"
  },
  {
    "text": "update is like using to compute the shot",
    "start": "1611419",
    "end": "1613220"
  },
  {
    "text": "so that we can like for example generate",
    "start": "1613220",
    "end": "1615260"
  },
  {
    "text": "a wrong shot that is not",
    "start": "1615260",
    "end": "1616580"
  },
  {
    "text": "cryptographically secure to like bypass",
    "start": "1616580",
    "end": "1618860"
  },
  {
    "text": "the signatures and even we try to like",
    "start": "1618860",
    "end": "1621020"
  },
  {
    "text": "play",
    "start": "1621020",
    "end": "1623200"
  },
  {
    "text": "buffer when is decrypted to lick that",
    "start": "1623200",
    "end": "1625940"
  },
  {
    "text": "but the complexities of the microgrid",
    "start": "1625940",
    "end": "1627919"
  },
  {
    "text": "update algorithm prevented us to exploit",
    "start": "1627919",
    "end": "1630260"
  },
  {
    "text": "it further but I think that's a cool",
    "start": "1630260",
    "end": "1631580"
  },
  {
    "text": "like future direction to look into",
    "start": "1631580",
    "end": "1633320"
  },
  {
    "text": "definitely so um concluding our talk so",
    "start": "1633320",
    "end": "1636860"
  },
  {
    "text": "you saw",
    "start": "1636860",
    "end": "1638720"
  },
  {
    "text": "or learned a bit about microcode today",
    "start": "1638720",
    "end": "1641000"
  },
  {
    "text": "and we deepen our understanding but",
    "start": "1641000",
    "end": "1643880"
  },
  {
    "text": "using the framework you can even like go",
    "start": "1643880",
    "end": "1646640"
  },
  {
    "text": "further and learn more about the micro",
    "start": "1646640",
    "end": "1648320"
  },
  {
    "text": "code",
    "start": "1648320",
    "end": "1649279"
  },
  {
    "text": "using our decompiler assembler aperture",
    "start": "1649279",
    "end": "1652279"
  },
  {
    "text": "and tracer and so our framework is open",
    "start": "1652279",
    "end": "1656299"
  },
  {
    "text": "source you can start hacking around your",
    "start": "1656299",
    "end": "1658580"
  },
  {
    "text": "CPU also",
    "start": "1658580",
    "end": "1659960"
  },
  {
    "text": "thank you very much thank you very much",
    "start": "1659960",
    "end": "1662610"
  },
  {
    "text": "[Applause]",
    "start": "1662610",
    "end": "1664590"
  },
  {
    "text": "[Music]",
    "start": "1664590",
    "end": "1667700"
  },
  {
    "text": "[Music]",
    "start": "1671540",
    "end": "1674650"
  }
]