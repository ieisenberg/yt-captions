[
  {
    "text": "so imagine the scenario your organization is hit by some e crime group they drop Ransom more in your",
    "start": "2320",
    "end": "8240"
  },
  {
    "text": "environment and business comes to a screeching home your team works all night and you've gotten them out of your systems",
    "start": "8240",
    "end": "14480"
  },
  {
    "text": "you're all good there but now leadership says that Ransom payment is not an option so you have to restore and",
    "start": "14480",
    "end": "21320"
  },
  {
    "text": "quickly you get to your backups nothing they're not there they can't be accessed the servers can't be seen they were",
    "start": "21320",
    "end": "27760"
  },
  {
    "text": "supposed to be immutable so what happened business can't continue your boss is breathing down your neck customers are",
    "start": "27760",
    "end": "34520"
  },
  {
    "text": "panicking and you get a call from KBS so what are we going to talk about today is data mutability we'll give you",
    "start": "34520",
    "end": "41760"
  },
  {
    "text": "some background on it some vendor case studies and recommendations for securing the environments also why you might want",
    "start": "41760",
    "end": "49079"
  },
  {
    "text": "to include them in your testing landscape I'm Ryan Kane I've been at Northwestern Mutual for about 9 years",
    "start": "49079",
    "end": "56399"
  },
  {
    "text": "I'm a pentester red teamer and a volunteer at cyphercon and Milwaukee",
    "start": "56399",
    "end": "61519"
  },
  {
    "text": "Wisconsin and I'm rashan I work with Ryan at Northwestern Mutual where I spend my time doing pen testing red",
    "start": "61519",
    "end": "67240"
  },
  {
    "text": "teaming purple teaming and some security research this is my first time presenting at blackhead and also my first time attending",
    "start": "67240",
    "end": "73240"
  },
  {
    "text": "blackhead so let's go over why did we select immutable backups or backups in general as a target for our security",
    "start": "73240",
    "end": "79320"
  },
  {
    "text": "research we noticed a trend that Ransom groups were on the rise and they would",
    "start": "79320",
    "end": "84479"
  },
  {
    "text": "go after specifically they would specifically go after immutable backups or just backups and the idea idea behind",
    "start": "84479",
    "end": "90360"
  },
  {
    "text": "them going after them is pretty straightforward because if a ransom group or a threat actor is able to prevent an organization from restoring",
    "start": "90360",
    "end": "96640"
  },
  {
    "text": "their backups it's easier for them to force payment out of them and as far as",
    "start": "96640",
    "end": "101960"
  },
  {
    "text": "uh an example goes we point out this intelligence report from crowd strike where they call out Alpha spider which",
    "start": "101960",
    "end": "107799"
  },
  {
    "text": "uses the alpha ransomware to destroy backups now let's go over some concepts of data immutability that's going to be",
    "start": "107799",
    "end": "114200"
  },
  {
    "text": "relevant for the rest of the talk the first one is write once read many also known as worm so worm devices or the",
    "start": "114200",
    "end": "121280"
  },
  {
    "text": "wendor case studies that we're going to see the three devices are classified as worm devices and by that I mean these",
    "start": "121280",
    "end": "127280"
  },
  {
    "text": "devices let you write data to it once lock it with an immutability flag and from that point onwards you can only",
    "start": "127280",
    "end": "133520"
  },
  {
    "text": "read from that data set and the uh why worm devices are",
    "start": "133520",
    "end": "139360"
  },
  {
    "text": "necessary because now you have a clean data set that's locked it's locked in and you can use it to recover from a",
    "start": "139360",
    "end": "145280"
  },
  {
    "text": "potentially dangerous situation like a ransomware attack or just your you know day-to-day Disaster Recovery operations",
    "start": "145280",
    "end": "150480"
  },
  {
    "text": "and the way these worm devices work is through something called as a retention lock or a volt lock and with retention",
    "start": "150480",
    "end": "157440"
  },
  {
    "text": "lock you can define an upper limit of exper time expiration so one of the one",
    "start": "157440",
    "end": "163120"
  },
  {
    "text": "of the vendor devices we'll see lets you set a time limit of 70 years so you can make your data immutable immutable for",
    "start": "163120",
    "end": "169239"
  },
  {
    "text": "70 years that's 70 years just imagine that and the way this retention Lock Works is in two different modes the",
    "start": "169239",
    "end": "175120"
  },
  {
    "text": "first one is governance mode which is the less stricter of the two and you can still undo the immutability flag before",
    "start": "175120",
    "end": "181040"
  },
  {
    "text": "the time period expires when it's set to governance mode if certain conditions are met and the second mode which",
    "start": "181040",
    "end": "187080"
  },
  {
    "text": "happens to be the much stricter of the two and also happens to be the current industry standard is compliance mode",
    "start": "187080",
    "end": "192840"
  },
  {
    "text": "where once you set your data with retention law compliance mode enabled it is locked till the time period expires",
    "start": "192840",
    "end": "198440"
  },
  {
    "text": "doesn't matter you can't do anything short of just wiping the entire device down and starting all from scratch not",
    "start": "198440",
    "end": "204200"
  },
  {
    "text": "even like root or admin uh privileges can help you out with that",
    "start": "204200",
    "end": "209959"
  },
  {
    "text": "so why is this testing needed our organization uses this for ransom resilience but also just general",
    "start": "209959",
    "end": "217439"
  },
  {
    "text": "Disaster Recovery scenarios we rely on these solutions to give us access to our backups and",
    "start": "217439",
    "end": "224120"
  },
  {
    "text": "restore in a timely fashion if if it comes to it if we need it so our expectations going in were that we",
    "start": "224120",
    "end": "230400"
  },
  {
    "text": "needed to learn about these the solutions and the concepts that we just described we didn't really know anything",
    "start": "230400",
    "end": "236879"
  },
  {
    "text": "about them going in so we had to learn a lot of it um we pretty quickly realized that attacking the immutability itself",
    "start": "236879",
    "end": "243920"
  },
  {
    "text": "was pretty pointless that's what these Solutions do right you had one job they do it really well so attacking the",
    "start": "243920",
    "end": "250040"
  },
  {
    "text": "mutability didn't make a lot of sense to us instead we thought we'd just attack the servers and infrastructure hosting",
    "start": "250040",
    "end": "256320"
  },
  {
    "text": "the data that might be a lot more productive so the solutions that we",
    "start": "256320",
    "end": "261600"
  },
  {
    "text": "tested uh two physical and then one in the cloud were data domain from dellemc",
    "start": "261600",
    "end": "267400"
  },
  {
    "text": "and ds8000 from IBM for the physical devices and AWS",
    "start": "267400",
    "end": "273759"
  },
  {
    "text": "backup so let's go over our first vendor case study that's data domain operating system from Delhi MC which is also known",
    "start": "273759",
    "end": "280000"
  },
  {
    "text": "as DDOS um at the time of testing this was set up with version 7.7 with the",
    "start": "280000",
    "end": "285800"
  },
  {
    "text": "retention lock compliance mode enabl so as You' recall it's the much stricter and the current industry standard so we",
    "start": "285800",
    "end": "291440"
  },
  {
    "text": "we began our security research looking at some of the pre-existing work out there from other researchers and the",
    "start": "291440",
    "end": "296759"
  },
  {
    "text": "research on this particular device was pretty thin at the time of when we were looking at it we saw one cve for a local",
    "start": "296759",
    "end": "304280"
  },
  {
    "text": "pesque but apart from that there wasn't much information on it and when we tried to get more information on it by reaching out to our contacts and Del",
    "start": "304280",
    "end": "310880"
  },
  {
    "text": "there was nothing it's pretty thin so we had to learn about this device from",
    "start": "310880",
    "end": "316160"
  },
  {
    "text": "scratch so we interact with uh with DDOS through the DD shell they do have a web",
    "start": "316240",
    "end": "322240"
  },
  {
    "text": "interface we didn't spend a lot of time looking at that we mostly focused on the DD shell it's in a NYX environment it's",
    "start": "322240",
    "end": "329160"
  },
  {
    "text": "a lock down shell that's got a lot of options a lot of different commands that you can run but nothing that can really",
    "start": "329160",
    "end": "336560"
  },
  {
    "text": "uh impact anything outside of this jailed session you're very locked down",
    "start": "336560",
    "end": "341960"
  },
  {
    "text": "um we did spend a lot of time looking at that and there are hundreds of commands but it's it's all very uh very locked",
    "start": "341960",
    "end": "348479"
  },
  {
    "text": "onto the shell to the point maybe outside of the shell you could read a file that might be about it it was hard",
    "start": "348479",
    "end": "354120"
  },
  {
    "text": "to tell there was a lot to it there is a system systems engineer mode or SE mode",
    "start": "354120",
    "end": "360000"
  },
  {
    "text": "that lets you do a little bit more on the system side like setting up protocols setting up users things like",
    "start": "360000",
    "end": "366160"
  },
  {
    "text": "that we interact with it through vaed ad accounts those were given to us by the",
    "start": "366160",
    "end": "371840"
  },
  {
    "text": "backup team they had admin level access so we started with admin uh but there",
    "start": "371840",
    "end": "377120"
  },
  {
    "text": "were local accounts in the system that also had admin level rights but we were not given those",
    "start": "377120",
    "end": "385080"
  },
  {
    "text": "accounts or access to those accounts we had to get those ourselves there is a bash shell in inside it that you can get",
    "start": "385080",
    "end": "390479"
  },
  {
    "text": "to through the DD shell and we'll show that here so you would run system bash",
    "start": "390479",
    "end": "396360"
  },
  {
    "text": "enter with an admin set of creds it will then prompt you for a second set of",
    "start": "396360",
    "end": "401919"
  },
  {
    "text": "creds for a security role for the security role user somebody with that set of uh those",
    "start": "401919",
    "end": "408479"
  },
  {
    "text": "rights ideally they should be different people or or different vaed creds but in this case we're just showing this",
    "start": "408479",
    "end": "415240"
  },
  {
    "text": "example there are a lot of commands that require both sets of credentials but in this case not just both sets of",
    "start": "415240",
    "end": "420960"
  },
  {
    "text": "credentials you also need the Bash Key you would get The Bash Key say being on",
    "start": "420960",
    "end": "426400"
  },
  {
    "text": "a support call with Dell they would give you the key that will last for a few hours and that gets you into bash to do",
    "start": "426400",
    "end": "432520"
  },
  {
    "text": "whatever you might need to do to support the system in bash kind of works like this the scene in war games where both",
    "start": "432520",
    "end": "438240"
  },
  {
    "text": "users have to turn their key at the same time to launch the nukes they both have to agree to it but if SEC user doesn't",
    "start": "438240",
    "end": "443960"
  },
  {
    "text": "agree then CIS admin has to use more persuasive means so we spent a lot of time in DD",
    "start": "443960",
    "end": "451039"
  },
  {
    "text": "shell viewing options reading documentation looking at the help help docs on in the in the Shell itself we",
    "start": "451039",
    "end": "458440"
  },
  {
    "text": "tried all sorts of attacks overwriting the data which we knew wasn't going to work unmounting the file system Rogue",
    "start": "458440",
    "end": "464400"
  },
  {
    "text": "ntp server we'll get to those later we spent a lot of time trying all sorts of things and failing all over the place",
    "start": "464400",
    "end": "471080"
  },
  {
    "text": "Dell had thought of everything we we thought we could do eventually we found",
    "start": "471080",
    "end": "477159"
  },
  {
    "text": "an undocumented command and some knowledge based article online somewhere called regge and it's like a registry",
    "start": "477159",
    "end": "483159"
  },
  {
    "text": "command so you would run reg show config and it'll give you a huge list of",
    "start": "483159",
    "end": "488560"
  },
  {
    "text": "configurations and some of them were cron jobs running as root that looks like this we would run reg set this DB",
    "start": "488560",
    "end": "496840"
  },
  {
    "text": "Handler config we'd set it to run as root to touch a file in the Ryan",
    "start": "496840",
    "end": "502759"
  },
  {
    "text": "home directory we just set up a local account just to test with so we didn't damage anything real to touch a file in",
    "start": "502759",
    "end": "509879"
  },
  {
    "text": "the Ryan home directory you just call it Ryan was here. text wait about a minute and the file shows up in the home",
    "start": "509879",
    "end": "516200"
  },
  {
    "text": "directory and is created by root so now we know we have some control over the",
    "start": "516200",
    "end": "521560"
  },
  {
    "text": "underlying operating system we can use that in the next steps all right so to",
    "start": "521560",
    "end": "526640"
  },
  {
    "text": "convert file writing file to a disk as rout is pretty cool right but what's even better a reverse shell so we modify",
    "start": "526640",
    "end": "533160"
  },
  {
    "text": "the DB Handler Cron job that Ryan mentioned before and we replace it with a an interactive bat shell that connects",
    "start": "533160",
    "end": "539519"
  },
  {
    "text": "back to our attacker control machine where we are just running a simple vanilla vanilla net Catal listener just looking for incoming connections on the",
    "start": "539519",
    "end": "546480"
  },
  {
    "text": "left hand side you can see us setting this malicious CR job and on the right hand side on our tag box we are able to",
    "start": "546480",
    "end": "553760"
  },
  {
    "text": "catch the incoming reverse shell on the right hand side I want you to pay attention to two things first is the",
    "start": "553760",
    "end": "559000"
  },
  {
    "text": "prompt of the shell that's received it no longer says SE at the host name which is the standard prompt for DDOS server",
    "start": "559000",
    "end": "565720"
  },
  {
    "text": "that you can see on the left hand side but now it says bash 4.2 which indicates to us as attackers that we have",
    "start": "565720",
    "end": "571399"
  },
  {
    "text": "successfully broken out of Dell's restricted jail environment and on top of that the output of who am I now says",
    "start": "571399",
    "end": "577120"
  },
  {
    "text": "root so we are no longer pent test user on the left hand side we are rote we have pretty much broken out of all the restrictions that's needed for us to",
    "start": "577120",
    "end": "583160"
  },
  {
    "text": "work as attackers so at this point now now that",
    "start": "583160",
    "end": "588720"
  },
  {
    "text": "we have completely compromised this DDOS machine our goal was to try attempting deleting uh to delete the immutable data",
    "start": "588720",
    "end": "594680"
  },
  {
    "text": "set that was set up for us so here I want to call out two two attacks that Ryan GL went over the first one was O",
    "start": "594680",
    "end": "602120"
  },
  {
    "text": "dropping the or overwriting the file system or dropping the file system so we identified that our data set was",
    "start": "602120",
    "end": "608600"
  },
  {
    "text": "actually mounted using a proprietary file system called Data domain file system or ddfs so our idea was what if",
    "start": "608600",
    "end": "616040"
  },
  {
    "text": "we just use our root permissions and just unmount the file system you know what would happen then turns out nothing",
    "start": "616040",
    "end": "622480"
  },
  {
    "text": "happens the device functions as you know as expected because we used a backup and restoration software by Veritas called",
    "start": "622480",
    "end": "628279"
  },
  {
    "text": "net backup to check if the connection was working and surprisingly net backup was still able to communicate with this",
    "start": "628279",
    "end": "633720"
  },
  {
    "text": "D machine even after dropping the file system and function uh as as expected",
    "start": "633720",
    "end": "639120"
  },
  {
    "text": "and the second attack that I want to call out which sounds really cool in theory is a rogue ntp server attack so",
    "start": "639120",
    "end": "644360"
  },
  {
    "text": "as I mentioned earlier retention log is time bound so you have to set a time period of expiration so that's after",
    "start": "644360",
    "end": "650440"
  },
  {
    "text": "that time period is reached your immutable data is no longer immutable it's normal now it can be overwritten so our idea was to use our root privileges",
    "start": "650440",
    "end": "656760"
  },
  {
    "text": "on this box to modify its ntp server uh ntp configuration to point to our Rogue",
    "start": "656760",
    "end": "662399"
  },
  {
    "text": "ntp server and when the time sync would happen our device would respond with a Time way ahead in the future which would",
    "start": "662399",
    "end": "668760"
  },
  {
    "text": "in theory unlock the retention log turns out Dell also thought about this HK scenario because on this Dell machine",
    "start": "668760",
    "end": "674880"
  },
  {
    "text": "you can only increment time in Period of 2 hours so like I said this machine supports an upper limit of 70 years for",
    "start": "674880",
    "end": "680279"
  },
  {
    "text": "retention log no attacker is going to sit there and do it possibly if that's the last option but we wanted something",
    "start": "680279",
    "end": "685720"
  },
  {
    "text": "simpler and much easier to exploit so we tried to figure out how this backup",
    "start": "685720",
    "end": "691560"
  },
  {
    "text": "restoration operation works or how the accessibility of this data is handled and what we found out was the way this",
    "start": "691560",
    "end": "698160"
  },
  {
    "text": "net backup device was able to restore by using this Dell machine was through a propriety protocol called DD boost DD",
    "start": "698160",
    "end": "705519"
  },
  {
    "text": "boost is Dell's implementation of net backups uh open storage apis which in",
    "start": "705519",
    "end": "711040"
  },
  {
    "text": "simpler terms just means that it's a way for these two competing solutions to talk to each other and for the DD boost",
    "start": "711040",
    "end": "716920"
  },
  {
    "text": "protocol to work a local user has to exist on this Del machine so we used our root privileges",
    "start": "716920",
    "end": "723760"
  },
  {
    "text": "and just new tdd Boost users password from ET Shadow and when you do that on a next system it effectively deletes the",
    "start": "723760",
    "end": "729440"
  },
  {
    "text": "user altogether to take it a step further we also rotated the passwords",
    "start": "729440",
    "end": "735079"
  },
  {
    "text": "where of the local accounts that Ryan mentioned earlier the CIS admin and SEC user and also deleted the ldap",
    "start": "735079",
    "end": "743079"
  },
  {
    "text": "connection that was set up on this D machine that would prevent let's say a strong domain account from logging in",
    "start": "743079",
    "end": "748839"
  },
  {
    "text": "like a in admin and undoing our malicious changes now as a result of that at this point this Dell machine is",
    "start": "748839",
    "end": "756399"
  },
  {
    "text": "completely compromised first of all also legitimate access has been cut off so no one can use the data set on this and no",
    "start": "756399",
    "end": "762760"
  },
  {
    "text": "one can talk to this machine no one can use the immutable data that's still immutable and sitting on this machine",
    "start": "762760",
    "end": "768639"
  },
  {
    "text": "for Disaster Recovery operations this is what an an attack",
    "start": "768639",
    "end": "773720"
  },
  {
    "text": "would look like you would use a simple said oneliner look for the pattern DD boost and UK it from ety Shadow",
    "start": "773720",
    "end": "779680"
  },
  {
    "text": "and this is the console uh screenshot from net backup where you inquiry the status of the Dell machine from net",
    "start": "779680",
    "end": "785199"
  },
  {
    "text": "backup it says the machine ending in 06 is marked us down so Ned backham can no longer talk to this machine no more",
    "start": "785199",
    "end": "791040"
  },
  {
    "text": "disaster recovery so we reported this finding toell and they rolled out a fix as part",
    "start": "791040",
    "end": "797959"
  },
  {
    "text": "of this DSA uh the fix is that se mode is now completely deprecated so you can",
    "start": "797959",
    "end": "803760"
  },
  {
    "text": "no longer change or exploit the crown jobs the way we just demonstrated so the lockdown shell is is even more lockedown",
    "start": "803760",
    "end": "810199"
  },
  {
    "text": "than it was before our next solution was IBM's",
    "start": "810199",
    "end": "816000"
  },
  {
    "text": "ds8000 that's comprised of three applications the HMC Hardware Management console the data storage of ds8000",
    "start": "816000",
    "end": "823160"
  },
  {
    "text": "itself and the copy services manager or CSM they all live on the same physical",
    "start": "823160",
    "end": "829199"
  },
  {
    "text": "device and same under underlying operating system um the HMC from what we",
    "start": "829199",
    "end": "834880"
  },
  {
    "text": "can tell handles a lot of the well obviously Hardware management uh set up things like users and and different",
    "start": "834880",
    "end": "841560"
  },
  {
    "text": "protocols and SSH stuff like that the ds8000 I think sets up your",
    "start": "841560",
    "end": "848240"
  },
  {
    "text": "partitions or some of the the storage infrastructure it was hard to tell um and then",
    "start": "848240",
    "end": "854079"
  },
  {
    "text": "CSM handles from again from what we can tell the backup and restoration",
    "start": "854079",
    "end": "859199"
  },
  {
    "text": "process so that our targets were the URLs provided to us by the backup team",
    "start": "859199",
    "end": "865759"
  },
  {
    "text": "but no credentials this was production they said get access to the applications that's your whole goal if you get access",
    "start": "865759",
    "end": "871959"
  },
  {
    "text": "to the applications that can do a lot of damage so that's your your target we took this",
    "start": "871959",
    "end": "877959"
  },
  {
    "text": "to our leadership they they did tell us it is prod only so if you do get access you can't do anything you can't break it",
    "start": "877959",
    "end": "884040"
  },
  {
    "text": "make changes it's it's all production so walk on eggshells yeah we took this to",
    "start": "884040",
    "end": "890040"
  },
  {
    "text": "our leadership and said this doesn't feel like it's in the spirit of testing mutable backups this feels like a web",
    "start": "890040",
    "end": "896000"
  },
  {
    "text": "app test it's not really what we should be spending our time doing he said well",
    "start": "896000",
    "end": "901040"
  },
  {
    "text": "just take a little time give it your best shot see what you can do so you know grumbling we go back to our desks",
    "start": "901040",
    "end": "907160"
  },
  {
    "text": "and 5 minutes later we had access to two of the three applications with default credentials these are the creds they've",
    "start": "907160",
    "end": "913279"
  },
  {
    "text": "been rotated in our environment but use those as you will so we now had access to two of the",
    "start": "913279",
    "end": "920519"
  },
  {
    "text": "three applications with our ultimate goal being to access CSM spoiler alert we never did but we had to now learn",
    "start": "920519",
    "end": "928000"
  },
  {
    "text": "these environments without making any changes we could do things like creating local users but nothing that was",
    "start": "928000",
    "end": "935120"
  },
  {
    "text": "enabling some feature that we shouldn't be doing because it's in use it's it's backing up real data one of the things",
    "start": "935120",
    "end": "941959"
  },
  {
    "text": "we saw was this login screen for the HMC that if you used one of the legitimate",
    "start": "941959",
    "end": "948079"
  },
  {
    "text": "default credentials of CE it would tell you C is not allowed to log on remotely cool it's enforced by disabling the log",
    "start": "948079",
    "end": "955519"
  },
  {
    "text": "on button I think you can probably see where this is going you use your hacking tools of developer tools remove the",
    "start": "955519",
    "end": "961639"
  },
  {
    "text": "disabled flag click log on and you're in so cool this is",
    "start": "961639",
    "end": "967839"
  },
  {
    "text": "HMC I'd love to show you more it's huge there's hundreds of pages every one of these menu options",
    "start": "967839",
    "end": "974560"
  },
  {
    "text": "has dozens and dozens of of sub Pages it's enormous one of the common things you would see a lot in HMC though is",
    "start": "974560",
    "end": "982199"
  },
  {
    "text": "pages to view log files lots of log files most of them are drop downs to select the log file you want to view but",
    "start": "982199",
    "end": "988399"
  },
  {
    "text": "this one is free form you just enter the login the log file location you want to",
    "start": "988399",
    "end": "993639"
  },
  {
    "text": "view so if you give it ety password is a log file it gives you an error that there was an error processing the",
    "start": "993639",
    "end": "999319"
  },
  {
    "text": "request because Etsy password isn't a valid log file but if you give it Etsy",
    "start": "999319",
    "end": "1004440"
  },
  {
    "text": "not a real file it gives you a different error that the file doesn't exist so now you can use that to start mapping out",
    "start": "1004440",
    "end": "1010920"
  },
  {
    "text": "all the files that might exist on the operating system like maybe the uh the",
    "start": "1010920",
    "end": "1016279"
  },
  {
    "text": "application files that are running these systems we can use these in the next few",
    "start": "1016279",
    "end": "1021839"
  },
  {
    "text": "steps all right so after looking at the HMC web application we set our sides on",
    "start": "1021839",
    "end": "1027038"
  },
  {
    "text": "the DS uh ds8000 web application and once we logged in we quickly noticed there was this small shell utility",
    "start": "1027039",
    "end": "1032558"
  },
  {
    "text": "inside in the web UI called dsli which happens to be IBM's implementation of its own jailed jailed environment like",
    "start": "1032559",
    "end": "1039079"
  },
  {
    "text": "Del has right so we had to look at it at this point DLI functions with in two modes",
    "start": "1039079",
    "end": "1044558"
  },
  {
    "text": "the first one is single command mode where you type in the command and you get the output we didn't have much success abusing that mode so we moved on",
    "start": "1044559",
    "end": "1050919"
  },
  {
    "text": "to the second one which is the file upload mode where you upload a valid script file for containing DLI commands",
    "start": "1050919",
    "end": "1058080"
  },
  {
    "text": "and it functions in three steps the first step is the file gets uploaded to the temp directory Second Step an execute method is called on the file in",
    "start": "1058080",
    "end": "1064559"
  },
  {
    "text": "the temp directory and it's executed line by line and finally the cleanup step happens so let's look at each one of them and see if we can explore it so",
    "start": "1064559",
    "end": "1071919"
  },
  {
    "text": "the first one is the file upload mode uh here you can see we are uploading a file that is not a valid dsli F because a",
    "start": "1071919",
    "end": "1077559"
  },
  {
    "text": "shebang points to bin Bash and also ID and who Ami are not valid dsli",
    "start": "1077559",
    "end": "1082600"
  },
  {
    "text": "commands but the application doesn't care it doesn't validate it lets you just upload the file in the temp",
    "start": "1082600",
    "end": "1088559"
  },
  {
    "text": "directory no exploit over here you can't really abuse the step to break out of the stem directory so it's fine we can",
    "start": "1088559",
    "end": "1093919"
  },
  {
    "text": "just move on to the next step in the next step the execute method is called on the file that was previously uploaded in the temp directory and here I want",
    "start": "1093919",
    "end": "1100600"
  },
  {
    "text": "you to pay close attention to the response it says it first of all it errors out but the error message is",
    "start": "1100600",
    "end": "1106360"
  },
  {
    "text": "interesting it says ID was not found enter help for list of available commands so first of all the ID command since it's not a valid dsli command it",
    "start": "1106360",
    "end": "1113320"
  },
  {
    "text": "errors out right and the command itself the command name in this case ID was printed on the screen that's an",
    "start": "1113320",
    "end": "1118840"
  },
  {
    "text": "important piece of information second who am I was never executed right so now we know that the",
    "start": "1118840",
    "end": "1126000"
  },
  {
    "text": "way this feature works is it executes a file top to bottom it whenever it encounters an error it will stop the",
    "start": "1126000",
    "end": "1132000"
  },
  {
    "text": "execution of the file print print the command that errored out on the screen and that discard the rest of the file",
    "start": "1132000",
    "end": "1138120"
  },
  {
    "text": "sweet so now we know that we can potentially leak contents out a file in a very restricted fashion possibly just",
    "start": "1138120",
    "end": "1145760"
  },
  {
    "text": "the first line of a file that is not a valid DLI file so this is where you give up this is you can't do much with this",
    "start": "1145760",
    "end": "1152320"
  },
  {
    "text": "restricted file read turns out this application runs his root and what can root read Etsy Shadow and what's the",
    "start": "1152320",
    "end": "1159640"
  },
  {
    "text": "first line of ety Shadow when it errors out it's the root password hash so we were able to leak the root password hash",
    "start": "1159640",
    "end": "1165559"
  },
  {
    "text": "with this execute method and also turns out this happens to be another default gred so we were able to crack it locally",
    "start": "1165559",
    "end": "1171960"
  },
  {
    "text": "on our laptops in like less than 20 minutes it's a dictionary word now for the final step the cleanup",
    "start": "1171960",
    "end": "1178240"
  },
  {
    "text": "this is where once the execution is done the remove script method is called and deletes the file on disk so we were also",
    "start": "1178240",
    "end": "1185080"
  },
  {
    "text": "able to abuse this me method by targeting a non file that is not in the temp directory so we created a new user",
    "start": "1185080",
    "end": "1192080"
  },
  {
    "text": "on the ds8000 web application and when you do that it creates a default uh by default it creates a bashrc file for you",
    "start": "1192080",
    "end": "1199080"
  },
  {
    "text": "so we use the remote script method targeted The Bash RC file that was just created successfully deleted it with",
    "start": "1199080",
    "end": "1204280"
  },
  {
    "text": "root privileges and when we use the execute method from the previous step to check the existence of the file the",
    "start": "1204280",
    "end": "1210240"
  },
  {
    "text": "output changes it says script file is not found successfully deleting the",
    "start": "1210240",
    "end": "1215640"
  },
  {
    "text": "file so the impact of this is that we could access two of the three applications with default credentials",
    "start": "1215640",
    "end": "1222200"
  },
  {
    "text": "enumerate all the files on the file of the operating system read the first line of any of those files as rout and delete",
    "start": "1222200",
    "end": "1228159"
  },
  {
    "text": "any of the f files's Ro this is all implied but surely if we found the right files for the applications or Etsy",
    "start": "1228159",
    "end": "1234480"
  },
  {
    "text": "Shadow we deleted them we should be able to cause some sort of system outage we couldn't do that because this was",
    "start": "1234480",
    "end": "1240200"
  },
  {
    "text": "production but it's an implied impact we think we could probably take the system down that way so our challenges were",
    "start": "1240200",
    "end": "1247880"
  },
  {
    "text": "again we didn't have non-prod environment to test against we didn't feel that this was comprehensive if you",
    "start": "1247880",
    "end": "1253480"
  },
  {
    "text": "have access to a DSA DSA 000 in nonpr that you can safely test against we think there's possibility for a lot more",
    "start": "1253480",
    "end": "1260480"
  },
  {
    "text": "findings here uh we did report these four findings to IBM's pser and they rolled out a fix early March of this",
    "start": "1260480",
    "end": "1268159"
  },
  {
    "text": "year we then moved on to AWS which the AWS backup that uses the industry",
    "start": "1268159",
    "end": "1275279"
  },
  {
    "text": "standard of compliance mode and retention lock we use AWS organizations",
    "start": "1275279",
    "end": "1281279"
  },
  {
    "text": "which if you don't know is just comprised of many accounts in AWS all rolled up under one organization account",
    "start": "1281279",
    "end": "1289400"
  },
  {
    "text": "that sort of maintains the rest of them it's like a billing account it can pay for all the other accounts so you don't",
    "start": "1289400",
    "end": "1295600"
  },
  {
    "text": "have to have every department or every team paying for their own our backup team set up an account for us with data",
    "start": "1295600",
    "end": "1302039"
  },
  {
    "text": "in it that was set to a mutable and and it was just test garbage data but that way we could use that as our Target the",
    "start": "1302039",
    "end": "1308480"
  },
  {
    "text": "pocc backup account that's what our goal was was to get access and and",
    "start": "1308480",
    "end": "1313520"
  },
  {
    "text": "potentially take that account down Okay so let's talk talk about the",
    "start": "1313520",
    "end": "1319080"
  },
  {
    "text": "methodology when it comes to testing Cloud backups so if people in the audience if you have tested AWS you know",
    "start": "1319080",
    "end": "1325559"
  },
  {
    "text": "that very rarely will you be in a situation where you can just run and exploit and gain access and reach your goal in AWS in reality what it's going",
    "start": "1325559",
    "end": "1332640"
  },
  {
    "text": "to look like is going to start with either no creds or a low privilege crits you're going to from there you're going",
    "start": "1332640",
    "end": "1338240"
  },
  {
    "text": "to crit Shuffle by that I mean you're going to enumerate your permissions escalate privileges keep assuming roles till you reach a Target in this case our",
    "start": "1338240",
    "end": "1345159"
  },
  {
    "text": "Target was reaching the PC backup account so that's exactly what we did we start started from a perspective of an unauthenticated attacker inside an",
    "start": "1345159",
    "end": "1351279"
  },
  {
    "text": "organization's Network and we quickly came across this container registry that didn't support",
    "start": "1351279",
    "end": "1357400"
  },
  {
    "text": "authentication since it didn't support authentication we were able to pull out pull down a container that contained",
    "start": "1357400",
    "end": "1364039"
  },
  {
    "text": "that that housed clear Tex credentials for a very privileged account called gitlab admin but clear Tex I mean b 64",
    "start": "1364039",
    "end": "1370080"
  },
  {
    "text": "encoded but it's B 64 you can just reverse it so once so now at this point we",
    "start": "1370080",
    "end": "1375120"
  },
  {
    "text": "started with no credentials to some sort of credentials but we still don't have foothold and AWS so we just went with",
    "start": "1375120",
    "end": "1381400"
  },
  {
    "text": "what we had we targeted gitlab gitlab with our gitlab admin credentials and logged into the admin area on our",
    "start": "1381400",
    "end": "1387799"
  },
  {
    "text": "company's gitlab so this admin area is a special area which is not accessible to normal devs and gitlab you have to have",
    "start": "1387799",
    "end": "1393520"
  },
  {
    "text": "some kind of privileges in gitlab to interact with it and inside this admin area is this Runners section which",
    "start": "1393520",
    "end": "1398799"
  },
  {
    "text": "houses the shared Runners as well as private Runners shared runners in in gitlab is an is available to all devs so",
    "start": "1398799",
    "end": "1405400"
  },
  {
    "text": "you can just anyone in your organization can use it to execute code on it via cicd whereas private Runners are",
    "start": "1405400",
    "end": "1411360"
  },
  {
    "text": "reserved for special groups the group in question that we wanted to go after was the AWS team because our train of",
    "start": "1411360",
    "end": "1416640"
  },
  {
    "text": "thought was since it's a big organization there is a good chance the aw's team uses some kind of automation",
    "start": "1416640",
    "end": "1422159"
  },
  {
    "text": "right it could be terraform cloud formation jobs or even just plain all cicd pipelines and our theory was right the",
    "start": "1422159",
    "end": "1429400"
  },
  {
    "text": "description of this Runner was a dead giveaway and also here comes uh here's another thing that I want you to uh pay",
    "start": "1429400",
    "end": "1436360"
  },
  {
    "text": "attention to is the runner tag so when it comes to private Runners you can't even though you have even though for us",
    "start": "1436360",
    "end": "1443720"
  },
  {
    "text": "since we have the gitlab admin access we still can't execute code on this Runner",
    "start": "1443720",
    "end": "1449360"
  },
  {
    "text": "by default we still we have to use we have to meet two conditions the first condition is we have to create a repo",
    "start": "1449360",
    "end": "1455240"
  },
  {
    "text": "inside the inside the AWS teams group and second is to in our CI",
    "start": "1455240",
    "end": "1464159"
  },
  {
    "text": "file we have to mention this tag so we did that and you can see in the on the screen it took us like five attempts to",
    "start": "1464159",
    "end": "1469600"
  },
  {
    "text": "find the right right Runner and once we did we realized this this Runner was an in fact an ec2 instance so when it comes",
    "start": "1469600",
    "end": "1475000"
  },
  {
    "text": "to ec2 instances you just query the metadata endpoint that's exactly what we did and we were able to leak the temporary credentials for that ec2",
    "start": "1475000",
    "end": "1481279"
  },
  {
    "text": "instance via job logs use those in our aw CLI file and assume role as the",
    "start": "1481279",
    "end": "1486440"
  },
  {
    "text": "runner now at this point we come from completely unauthenticated user to have",
    "start": "1486440",
    "end": "1492039"
  },
  {
    "text": "some kind of foothold outside of AWS and now finally compromising and getting credentials to interact with AWS",
    "start": "1492039",
    "end": "1499600"
  },
  {
    "text": "when we enumerate so now we retry the cred shuffling method and we realized",
    "start": "1499600",
    "end": "1505080"
  },
  {
    "text": "that we were in fact in a separate account in our AWS organizations so this account in question was the",
    "start": "1505080",
    "end": "1510640"
  },
  {
    "text": "infrastructure prod or the infr proda account and we are still far away from a",
    "start": "1510640",
    "end": "1515720"
  },
  {
    "text": "goal for the P to get into the P backup account so again we do the we try to enumerate our permissions and we quickly",
    "start": "1515720",
    "end": "1522559"
  },
  {
    "text": "came across this management account in our POC backup account that has an assume role policy that lets our runner",
    "start": "1522559",
    "end": "1528960"
  },
  {
    "text": "in question that we compromised in the previous step assume assume roll into this management account sweet now we",
    "start": "1528960",
    "end": "1534520"
  },
  {
    "text": "just one step away from getting into the management account but it turns out Lu luck was on our side in this case and this",
    "start": "1534520",
    "end": "1541760"
  },
  {
    "text": "management account has the administrator access access policy attached to it which if you have worked on AWS you know",
    "start": "1541760",
    "end": "1547960"
  },
  {
    "text": "that it's a default admin access policy that AWS provides to you but that lets you do any action on any resource",
    "start": "1547960",
    "end": "1554960"
  },
  {
    "text": "effectively compromising the account if you assume roll into it so now I know that was a lot of steps when it comes to",
    "start": "1554960",
    "end": "1560480"
  },
  {
    "text": "compromising AWS and it's different for different organizations but this is what it looks like from a high level view you",
    "start": "1560480",
    "end": "1565880"
  },
  {
    "text": "come from outside of AWS you compromise an a Docker container that doesn't support authentication you comp you get",
    "start": "1565880",
    "end": "1572279"
  },
  {
    "text": "clear credentials in this case it turns out to be gitlab admin compromise a gitlab runner pivot into AWS in the info",
    "start": "1572279",
    "end": "1578880"
  },
  {
    "text": "prod account and from there on assume rooll and get into the PSC backup account now let's talk about possible",
    "start": "1578880",
    "end": "1584520"
  },
  {
    "text": "ramifications of this entire exploit chain can we stop backups turns out we can",
    "start": "1584520",
    "end": "1591880"
  },
  {
    "text": "because this management account since it has wild card on all actions and wild card on all resources you can use that",
    "start": "1591880",
    "end": "1597080"
  },
  {
    "text": "to assume role into a special role in AWS backups called the backup policy deployer that name might be different",
    "start": "1597080",
    "end": "1603480"
  },
  {
    "text": "for different organizations but the role functions in a pretty simple way it has to exist it lets you define the source",
    "start": "1603480",
    "end": "1609440"
  },
  {
    "text": "of the backups the T the destination of the backups and the frequency of the backups so targeting that role you can",
    "start": "1609440",
    "end": "1615679"
  },
  {
    "text": "modify those policies you can delete those policies you can override those policies you can do whatever you want with it you can effectively stop backups",
    "start": "1615679",
    "end": "1621799"
  },
  {
    "text": "and if no one is monitoring it in our case no one was it's pretty good fine but we wanted to take it a step further",
    "start": "1621799",
    "end": "1627600"
  },
  {
    "text": "we wanted to cut off legitimate access like we did in our previous two case studies so we I we tried to figure out",
    "start": "1627600",
    "end": "1634760"
  },
  {
    "text": "how does the admin access for our AWS team work and again this is out of scope",
    "start": "1634760",
    "end": "1640440"
  },
  {
    "text": "but I still want to mention it because it's different different organizations manage it differently but if your organizations manages it using SSO this",
    "start": "1640440",
    "end": "1647320"
  },
  {
    "text": "is a pretty good pth where we found out that they were using SSO in to handle their admin assignments",
    "start": "1647320",
    "end": "1655600"
  },
  {
    "text": "so to Target that we again went back to our step with a privilege Runner that we compromised and started Reen numerating",
    "start": "1655600",
    "end": "1661279"
  },
  {
    "text": "our Privileges and we eventually came across a Lambda job that was handling the admin assignments so just assuming",
    "start": "1661279",
    "end": "1666880"
  },
  {
    "text": "all into that account targeting that Lambda job you could you could cause re Rec Havoc",
    "start": "1666880",
    "end": "1672440"
  },
  {
    "text": "right the other potential paths that you can explore we didn't because we",
    "start": "1672440",
    "end": "1677840"
  },
  {
    "text": "couldn't you couldn't get the credentials to get there but you can is attacking the root principle root",
    "start": "1677840",
    "end": "1683039"
  },
  {
    "text": "principle for AWS is the account uh is the first account that you get when you set up a brand new account and with the",
    "start": "1683039",
    "end": "1689679"
  },
  {
    "text": "root principle you can delete the AWS account for the for those backups but there are some checks and balances in",
    "start": "1689679",
    "end": "1695080"
  },
  {
    "text": "place by AWS it lets you it gives you a grace period of like 90 days to recover",
    "start": "1695080",
    "end": "1700360"
  },
  {
    "text": "from or undo undo your",
    "start": "1700360",
    "end": "1703720"
  },
  {
    "text": "changes so in all three of these Solutions Solutions we worked with a backup teams and they told us yeah your",
    "start": "1705640",
    "end": "1712200"
  },
  {
    "text": "attacks might have worked but recovery would probably be possible maybe with a vendor help and our Point all along was",
    "start": "1712200",
    "end": "1718519"
  },
  {
    "text": "that's great we weren't touching the immutable data so recovery should be possible but how long is that going to",
    "start": "1718519",
    "end": "1723840"
  },
  {
    "text": "take if it's going to take too long your only option to get business back up and running might be to pay that Ransom and",
    "start": "1723840",
    "end": "1730360"
  },
  {
    "text": "then what's the point to having it a mle solution so recommendations for all of the solutions change your default creds",
    "start": "1730360",
    "end": "1736960"
  },
  {
    "text": "it's common sense right Vault your creds and limit access to who should have those MFA all the things",
    "start": "1736960",
    "end": "1744080"
  },
  {
    "text": "alerting and monitoring is a big one most of these backup teams might not be large teams and so if it's only a few",
    "start": "1744080",
    "end": "1750360"
  },
  {
    "text": "people having some alert when an account gets used to log in so that the maybe",
    "start": "1750360",
    "end": "1755480"
  },
  {
    "text": "three people on that team know that somebody just used an account to log in to the to the immutable backup solution",
    "start": "1755480",
    "end": "1762279"
  },
  {
    "text": "but two of them are on vacation now we know something is wrong so good to have alerts for that sort of thing keeping",
    "start": "1762279",
    "end": "1768799"
  },
  {
    "text": "your software up to date obviously off-site backups 321 rule allowing your",
    "start": "1768799",
    "end": "1774760"
  },
  {
    "text": "security researchers to test giving us a non-prod environment to hit so we can safely make sure that these are Secure",
    "start": "1774760",
    "end": "1781480"
  },
  {
    "text": "Solutions in our own environment why you might want to include attacking immutable Solutions in",
    "start": "1781480",
    "end": "1789080"
  },
  {
    "text": "in your attack landscape well if you're using immutable solutions for Disaster Recovery scenarios and not concerned",
    "start": "1789080",
    "end": "1795640"
  },
  {
    "text": "about ransomware maybe it's not a big deal if you're using this for attack protection it's probably a good idea to",
    "start": "1795640",
    "end": "1801679"
  },
  {
    "text": "make sure that the servers can't be rendered inaccessible as we've been saying if the data is not accessible can",
    "start": "1801679",
    "end": "1808200"
  },
  {
    "text": "you really call it immutable you shouldn't rely on your vendors to do all of the testing for you if it's in your",
    "start": "1808200",
    "end": "1813559"
  },
  {
    "text": "own environment they may be resting on their Laurels and and testing periodically but if it's in your",
    "start": "1813559",
    "end": "1820120"
  },
  {
    "text": "environment you just want to make sure that it's it's as secure as you expect it to be ultimately these Solutions are",
    "start": "1820120",
    "end": "1827320"
  },
  {
    "text": "just computers they're built for one specific thing and they do it really well but they're just computers with the same problems as any other",
    "start": "1827320",
    "end": "1835759"
  },
  {
    "text": "systems a five- minute Google search just gave us a bunch of other immutable solutions that are advertised right",
    "start": "1835840",
    "end": "1842279"
  },
  {
    "text": "Azure and Google Cloud Storage all these others they all advertise some form of immutability in their in their offerings",
    "start": "1842279",
    "end": "1849640"
  },
  {
    "text": "if organizations are relying on them to protect their data and and recover from ransomware Attack they should probably",
    "start": "1849640",
    "end": "1855840"
  },
  {
    "text": "be tested too there's no reason they may not also be vulnerable to the same same",
    "start": "1855840",
    "end": "1861039"
  },
  {
    "text": "uh techniques that we just demonstrated here quick timeline for Dell we reported",
    "start": "1861039",
    "end": "1866480"
  },
  {
    "text": "to them in September of last year they rolled out a fix uh that DSA in December",
    "start": "1866480",
    "end": "1871760"
  },
  {
    "text": "granting one cve and then for IBM we reported to them in October and they",
    "start": "1871760",
    "end": "1878000"
  },
  {
    "text": "fixed the the four issues in March of this year granting four cves including",
    "start": "1878000",
    "end": "1884080"
  },
  {
    "text": "the one for developer tools so to sum it up as we've been saying your data may be",
    "start": "1884080",
    "end": "1890159"
  },
  {
    "text": "immutable but the servers hosting it might not be so you should probably make sure that they are if if you want to",
    "start": "1890159",
    "end": "1896039"
  },
  {
    "text": "make sure they're as secure as you expect them to be you can increase ransomware resilience by testing your",
    "start": "1896039",
    "end": "1901600"
  },
  {
    "text": "vendors immutability solution make sure that they don't have the same vulnerabilities that can render them",
    "start": "1901600",
    "end": "1907480"
  },
  {
    "text": "inaccessible because affecting the accessibility of backups May coers payment for ransomware which in our",
    "start": "1907480",
    "end": "1913880"
  },
  {
    "text": "opinion is another form of holding the data Ransom so thanks and with that we can take questions",
    "start": "1913880",
    "end": "1922840"
  },
  {
    "text": "[Applause]",
    "start": "1922840",
    "end": "1930029"
  }
]