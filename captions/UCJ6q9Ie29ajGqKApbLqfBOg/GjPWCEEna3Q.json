[
  {
    "start": "0",
    "end": "300000"
  },
  {
    "text": "hi everyone thank you for coming to my talk my name is ukin I'm a security",
    "start": "5720",
    "end": "12679"
  },
  {
    "text": "researcher at Cyber Quin uh which is a startup security company in China but I",
    "start": "12679",
    "end": "19480"
  },
  {
    "text": "have exploited multiple tets at font and the tm4 carb and I've also been the",
    "start": "19480",
    "end": "25960"
  },
  {
    "text": "first place on msrc most relable security Searchers for four years uh I",
    "start": "25960",
    "end": "32920"
  },
  {
    "text": "also want to py Awards uh for best RC and epic",
    "start": "32920",
    "end": "38960"
  },
  {
    "text": "achievement I have found some Barks in different vendors products including",
    "start": "38960",
    "end": "44239"
  },
  {
    "text": "Microsoft Google uh Apple Adobe this session is a work through of",
    "start": "44239",
    "end": "51960"
  },
  {
    "text": "our research project on Windows remote access Service uh we will go through",
    "start": "51960",
    "end": "57840"
  },
  {
    "text": "different Windows RS Components analyze their preos attack surfaces and",
    "start": "57840",
    "end": "63800"
  },
  {
    "text": "share sound parks with fun we will also share our thoughts and approaches when",
    "start": "63800",
    "end": "69240"
  },
  {
    "text": "doing the research we will not talk about the exploit details of this works",
    "start": "69240",
    "end": "75640"
  },
  {
    "text": "today if you're interested in BS in Windows remote protocols or in Windows B",
    "start": "75640",
    "end": "82240"
  },
  {
    "text": "Bounty welcome to joining the session here's our agenda today uh first",
    "start": "82240",
    "end": "88759"
  },
  {
    "text": "we will have a brief background introduction and then we will go through each Windows is component finally we",
    "start": "88759",
    "end": "96840"
  },
  {
    "text": "will have a summary now let's start uh so why we",
    "start": "96840",
    "end": "102040"
  },
  {
    "text": "decided to research Windows R in April last year we read a Blog",
    "start": "102040",
    "end": "108280"
  },
  {
    "text": "shared by security researcher adex Nichols which described a remote now",
    "start": "108280",
    "end": "114360"
  },
  {
    "text": "Point deny of service BG in Windows pttp Server uh this B seems very interesting",
    "start": "114360",
    "end": "121439"
  },
  {
    "text": "to us because of several reasons uh first we have never seen a windows pptp",
    "start": "121439",
    "end": "128080"
  },
  {
    "text": "barg before uh which seems it is Blue Ocean and the second the bar seems very",
    "start": "128080",
    "end": "135319"
  },
  {
    "text": "simple which means the related code quality is not so good and next also",
    "start": "135319",
    "end": "142400"
  },
  {
    "text": "most important this SP is preos and no user interaction which means this may be El",
    "start": "142400",
    "end": "150280"
  },
  {
    "text": "for the attack scenario Awards in Windows WIP Bounty",
    "start": "150280",
    "end": "156239"
  },
  {
    "text": "program if you're interested in B Bounty program but never tried WIP Bounty uh",
    "start": "156239",
    "end": "162560"
  },
  {
    "text": "here is an introduction WIP Bounty is one of Microsoft Bounty B Bounty programs uh it",
    "start": "162560",
    "end": "171120"
  },
  {
    "text": "works for BS that can be triggered in Windows inside the preview build there",
    "start": "171120",
    "end": "176239"
  },
  {
    "text": "are two types of awards uh General Awards and and the attack scenario",
    "start": "176239",
    "end": "181440"
  },
  {
    "text": "Awards the attack scenario Awards is much more interesting it Awards bugs for",
    "start": "181440",
    "end": "188120"
  },
  {
    "text": "particular scenarios um currently only for preos remote bugs and sandbox",
    "start": "188120",
    "end": "194640"
  },
  {
    "text": "escaping bugs it pays much higher than normal bugs the max payout is 100,000",
    "start": "194640",
    "end": "202319"
  },
  {
    "text": "for a single free off RCB very nice payment so if you are interested in the",
    "start": "202319",
    "end": "209920"
  },
  {
    "text": "tax scenar award and I want to have a try yourself and before you stting we",
    "start": "209920",
    "end": "215360"
  },
  {
    "text": "suggest you to read the Bounty rules carefully checks up to dat out of scope",
    "start": "215360",
    "end": "221400"
  },
  {
    "text": "list and fully understand the attack scenarios for example for the below",
    "start": "221400",
    "end": "227519"
  },
  {
    "text": "scenarios do you think they're in scope let see uh first web browser no because",
    "start": "227519",
    "end": "234040"
  },
  {
    "text": "it requires user interaction Office document no for same",
    "start": "234040",
    "end": "239200"
  },
  {
    "text": "reason the domain user to DC no because domain user request",
    "start": "239200",
    "end": "246439"
  },
  {
    "text": "authentication and a non default configuration uh it depends which is the",
    "start": "246439",
    "end": "251760"
  },
  {
    "text": "most tricky type so we to find the preos targets and",
    "start": "251760",
    "end": "258199"
  },
  {
    "text": "an important way is to learn from other researchers and you can also exp Windows",
    "start": "258199",
    "end": "264360"
  },
  {
    "text": "features one by one with patience for example you can check the feature list",
    "start": "264360",
    "end": "269440"
  },
  {
    "text": "uh a Windows Server finally a good temper is a very",
    "start": "269440",
    "end": "275960"
  },
  {
    "text": "important one doing bu Bounty program always remember that the vendor can",
    "start": "275960",
    "end": "281720"
  },
  {
    "text": "reject a bug Bounty at any stage with no reason uh if you insist to have a reason",
    "start": "281720",
    "end": "289160"
  },
  {
    "text": "there's no problem uh they can just make up a reason for you uh so it's very tough right as tough",
    "start": "289160",
    "end": "297400"
  },
  {
    "text": "as our life yeah now let's start exploring Windows R",
    "start": "297400",
    "end": "304080"
  },
  {
    "start": "300000",
    "end": "789000"
  },
  {
    "text": "Windows R provides remote access to clients it contains multiple chal",
    "start": "304080",
    "end": "309840"
  },
  {
    "text": "drivers and user mode Services first let's look at",
    "start": "309840",
    "end": "315280"
  },
  {
    "text": "pptp pptp is an old VPN protocol it uses two channels a control Channel using TCP",
    "start": "315280",
    "end": "323280"
  },
  {
    "text": "part 1723 and a data Channel using the GI protocol here's a typical pppp session",
    "start": "323280",
    "end": "331720"
  },
  {
    "text": "as the client sends a Start Control connection request to establish the",
    "start": "331720",
    "end": "337199"
  },
  {
    "text": "control Channel and then it sends a new call request to create a new call after",
    "start": "337199",
    "end": "342759"
  },
  {
    "text": "that the client sends GI packets to the data Channel and a g package carry PPP",
    "start": "342759",
    "end": "349880"
  },
  {
    "text": "protocol and the PPP protocol carries other protocols like LCP NCP and",
    "start": "349880",
    "end": "356560"
  },
  {
    "text": "authentication protocols like APAP Chap and",
    "start": "356560",
    "end": "362120"
  },
  {
    "text": "so let's analyze the pros attack surface in pbtp the first is the Kel driver it",
    "start": "362120",
    "end": "369240"
  },
  {
    "text": "contains code for the control channel it's pre o second is the user mod PPP",
    "start": "369240",
    "end": "376280"
  },
  {
    "text": "engine it contains multiple protocols and all preos part of these Protocols",
    "start": "376280",
    "end": "382960"
  },
  {
    "text": "are preos attack surfaces and finally uh also obiously uh",
    "start": "382960",
    "end": "389160"
  },
  {
    "text": "all authentication Protocols are preos attack surfaces so let's look at the kernel",
    "start": "389160",
    "end": "395840"
  },
  {
    "text": "driver first the kernel driver register two callbacks one for the control",
    "start": "395840",
    "end": "401319"
  },
  {
    "text": "Channel and one for the data channel uh there are some uh important",
    "start": "401319",
    "end": "408479"
  },
  {
    "text": "data structures in the driver uh the first is a control structure it",
    "start": "408479",
    "end": "413560"
  },
  {
    "text": "represents a control channel the second is a core structure which represents a",
    "start": "413560",
    "end": "419759"
  },
  {
    "text": "pptp core and next is ND VC handle pptp",
    "start": "419759",
    "end": "425160"
  },
  {
    "text": "driver uses ndis framework and for core management so each pptp core contains an",
    "start": "425160",
    "end": "432800"
  },
  {
    "text": "ND handle here is a relationship between them uh you can see the client connects",
    "start": "432800",
    "end": "439560"
  },
  {
    "text": "to the server by TCP port and a control object will be created and then the",
    "start": "439560",
    "end": "446120"
  },
  {
    "text": "client can create multiple core objects under a same control object and there",
    "start": "446120",
    "end": "451280"
  },
  {
    "text": "are Link in a link list and also each core object contains an ndis handle",
    "start": "451280",
    "end": "458720"
  },
  {
    "text": "here so we're to look for bars in the driver uh first we can try packet and",
    "start": "458720",
    "end": "464000"
  },
  {
    "text": "the message personing and hander and the PPP sta machine and the second we",
    "start": "464000",
    "end": "470199"
  },
  {
    "text": "noticed the objects have complex Bross references between each other and they",
    "start": "470199",
    "end": "476759"
  },
  {
    "text": "can be accessed from both the kernel and the user Mood by multiple threats at the",
    "start": "476759",
    "end": "482400"
  },
  {
    "text": "same time for such design we'd also like to try us it free and risk",
    "start": "482400",
    "end": "488840"
  },
  {
    "text": "condition risk condition are tough Bo to developers they occur while multiple",
    "start": "488840",
    "end": "494879"
  },
  {
    "text": "processes or threats attempt to access the same resource at the same time well",
    "start": "494879",
    "end": "501120"
  },
  {
    "text": "I used to be a developer for years so I understand how difficult it is to write",
    "start": "501120",
    "end": "506879"
  },
  {
    "text": "thre save code using CN C Plus+ this is because I also messed things",
    "start": "506879",
    "end": "514800"
  },
  {
    "text": "up so we started with a simple fer uh this fer use multiple strats and it just",
    "start": "514800",
    "end": "521959"
  },
  {
    "text": "randomly send pptp message to the server it's quite simple so we didn't expect",
    "start": "521959",
    "end": "528800"
  },
  {
    "text": "too much however uh the fer found the multiple pressures uh with UF and now",
    "start": "528800",
    "end": "537480"
  },
  {
    "text": "point the reference all the are preos uh so next uh I switch to manure",
    "start": "537480",
    "end": "545720"
  },
  {
    "text": "auditing and sign the more BS we didn't choose to uh rely on other F because we",
    "start": "545720",
    "end": "552839"
  },
  {
    "text": "want to find most of the bars as soon as possible this is because the original",
    "start": "552839",
    "end": "558680"
  },
  {
    "text": "pptp Barb is published and we our prediction is that",
    "start": "558680",
    "end": "564760"
  },
  {
    "text": "we will have more anal competitors soon so Speedy is very important for this",
    "start": "564760",
    "end": "574120"
  },
  {
    "text": "project let's see some examples this is a qu use of the free the client sends a",
    "start": "574120",
    "end": "580000"
  },
  {
    "text": "disconnect request to the control Channel and the function ctrp engine",
    "start": "580000",
    "end": "585279"
  },
  {
    "text": "accesses the core object the problem is that when accessing the core object",
    "start": "585279",
    "end": "590720"
  },
  {
    "text": "there is no Lo protection no reference counter production so another thread can",
    "start": "590720",
    "end": "596839"
  },
  {
    "text": "just free this call object by by closing mattion resting",
    "start": "596839",
    "end": "602480"
  },
  {
    "text": "UF next is a control object res the threee uh in the dis map callback",
    "start": "602480",
    "end": "608760"
  },
  {
    "text": "function uh the function accesses the control object without any protection so",
    "start": "608760",
    "end": "615200"
  },
  {
    "text": "another thread sends a stop control request to the control channel the control object will be freed resting",
    "start": "615200",
    "end": "623920"
  },
  {
    "text": "UF next is an ndvc handle the free uh the client sends a new call request to",
    "start": "623920",
    "end": "631399"
  },
  {
    "text": "the server and the server will creat a new NIS handle that sucess is a handle",
    "start": "631399",
    "end": "638480"
  },
  {
    "text": "without any protection so another thre can free this ND Handle by Closing",
    "start": "638480",
    "end": "647320"
  },
  {
    "text": "Connection this one is a little bit more complicated it's a risk condition",
    "start": "647320",
    "end": "652560"
  },
  {
    "text": "between the data Channel and is a control channel the first thread sends a",
    "start": "652560",
    "end": "657680"
  },
  {
    "text": "GI packet to the the control a data Channel and the Callback function will",
    "start": "657680",
    "end": "663000"
  },
  {
    "text": "access a core object without log or reference counter protection select",
    "start": "663000",
    "end": "669200"
  },
  {
    "text": "another thread closes control channel uh the core object will be free resulting",
    "start": "669200",
    "end": "678000"
  },
  {
    "text": "UF next let's analyze the user mode Service uh PRACK",
    "start": "678000",
    "end": "683720"
  },
  {
    "text": "surfaces uh including the PPP engine and authentication protocols see examples",
    "start": "683720",
    "end": "690079"
  },
  {
    "text": "for them but for PPP we will use LCP as an",
    "start": "690079",
    "end": "695279"
  },
  {
    "text": "example RCP is used to configure parameters and the later protocols in",
    "start": "695279",
    "end": "700839"
  },
  {
    "text": "PPP it's a preos protocol uh this is a hep buff or be",
    "start": "700839",
    "end": "706800"
  },
  {
    "text": "read write Val ability uh in LCP server uh it occurs one server handles a",
    "start": "706800",
    "end": "714040"
  },
  {
    "text": "malformed LCP make config uh malformed configure",
    "start": "714040",
    "end": "720920"
  },
  {
    "text": "request a RCP configure request contains multiple RCP options as defined the up",
    "start": "720920",
    "end": "728680"
  },
  {
    "text": "right here you can see the minimal size of a RCP option is two bytes and the",
    "start": "728680",
    "end": "735240"
  },
  {
    "text": "vulnerable code just simply copies all LCP options in the input packet to the",
    "start": "735240",
    "end": "741160"
  },
  {
    "text": "destination buffer so uh where is the problem here the problem is that one",
    "start": "741160",
    "end": "747120"
  },
  {
    "text": "copy is the option uh it does not correctly validate the lens field of",
    "start": "747120",
    "end": "752800"
  },
  {
    "text": "option so if the lens field is less than the minimum size of a LCP option for",
    "start": "752800",
    "end": "759680"
  },
  {
    "text": "example if it is one then the memory copy here will only copy one bite to the",
    "start": "759680",
    "end": "766040"
  },
  {
    "text": "destination option then in such case the L field of the destination option will",
    "start": "766040",
    "end": "772199"
  },
  {
    "text": "be un initialized and this uninitialized lens will used here to advance the",
    "start": "772199",
    "end": "779120"
  },
  {
    "text": "destination option to next position which can go beyond the end of the destination buffer resulting or be read",
    "start": "779120",
    "end": "787320"
  },
  {
    "text": "and write next let's analyze authentication protocols Windows RS supports multiple",
    "start": "787320",
    "end": "794880"
  },
  {
    "start": "789000",
    "end": "882000"
  },
  {
    "text": "authentication protocols which can be negotiated between the client and the server by default EAP protocol is used",
    "start": "794880",
    "end": "803480"
  },
  {
    "text": "for buing Windows VPN types it supports username password when the slogun",
    "start": "803480",
    "end": "809560"
  },
  {
    "text": "credential or certificat or other methods but we will not go through each",
    "start": "809560",
    "end": "817360"
  },
  {
    "text": "Authentication Protocol here instead we will use paap as an example paap is",
    "start": "817360",
    "end": "823480"
  },
  {
    "text": "protected EAP it supports TRS and is more secure it's implemented in EAP",
    "start": "823480",
    "end": "833000"
  },
  {
    "text": "TRS uh this is a hep buff FL right B uh in P fragrance ation feature P supports",
    "start": "833000",
    "end": "841600"
  },
  {
    "text": "packet fragmentation and each time when a new fragment packet comes the function store",
    "start": "841600",
    "end": "848440"
  },
  {
    "text": "the next fragment where append the packet data to a fixed size buffer",
    "start": "848440",
    "end": "855120"
  },
  {
    "text": "here and the root course is that there's simply just no boundary check when",
    "start": "855120",
    "end": "861680"
  },
  {
    "text": "adding the data very cool so whenever you see a protocal that support",
    "start": "861680",
    "end": "868800"
  },
  {
    "text": "fragmentation feature make sure you check the impl uh implementation",
    "start": "868800",
    "end": "873959"
  },
  {
    "text": "carefully this is because there are many uh in fragmentation feature in the",
    "start": "873959",
    "end": "881399"
  },
  {
    "text": "past uh besides Windows authentication uh Windows RS also supports radi",
    "start": "881399",
    "end": "887839"
  },
  {
    "start": "882000",
    "end": "1031000"
  },
  {
    "text": "authentication uh Windows uh window Microsoft implementation of the rce",
    "start": "887839",
    "end": "894480"
  },
  {
    "text": "protocol is called Network policy server or MP s for",
    "start": "894480",
    "end": "899839"
  },
  {
    "text": "shot it uses UDP port and is implemented in",
    "start": "899839",
    "end": "906440"
  },
  {
    "text": "isida here's the example is a preos information leak work in Windows radio",
    "start": "907079",
    "end": "913639"
  },
  {
    "text": "server the server tries to read a 16 by signature from the signature attribute",
    "start": "913639",
    "end": "920440"
  },
  {
    "text": "in the packet without validating the length of the attribute so if the",
    "start": "920440",
    "end": "926360"
  },
  {
    "text": "attribute length is zero it will with out of BS this is a Pros Doos B in radius proxy",
    "start": "926360",
    "end": "936199"
  },
  {
    "text": "server uh the loop here simply calculates the count of attributes in",
    "start": "936199",
    "end": "941800"
  },
  {
    "text": "the input packet uh can you see where the bar is simple uh if the L field of attribute",
    "start": "941800",
    "end": "950839"
  },
  {
    "text": "is zero then this Loop becomes a dead Loop and will never",
    "start": "950839",
    "end": "957319"
  },
  {
    "text": "exit while do B counting we tend to focus on RC bgs but ignore the best C be",
    "start": "957600",
    "end": "965319"
  },
  {
    "text": "BG types uh like deny of service or information leak but when you play with",
    "start": "965319",
    "end": "971600"
  },
  {
    "text": "Windows Bounty uh the preos remote D or information information lead par are",
    "start": "971600",
    "end": "977759"
  },
  {
    "text": "also verifi cost performance and you shouldn't Miss just",
    "start": "977759",
    "end": "983240"
  },
  {
    "text": "image a 30,000 for a single preos deny of service",
    "start": "983240",
    "end": "990519"
  },
  {
    "text": "okay so uh before we finished our pptp research we started to have positions",
    "start": "990959",
    "end": "997959"
  },
  {
    "text": "with other researchers but we are lucky that we started earlier so uh most of the time",
    "start": "997959",
    "end": "1004759"
  },
  {
    "text": "our bug was the first even one bug Collis happened so our experience is that you",
    "start": "1004759",
    "end": "1013279"
  },
  {
    "text": "don't often find such high cost performance party in your B count in",
    "start": "1013279",
    "end": "1018759"
  },
  {
    "text": "career so they are very precious make sure you catch the chance when such",
    "start": "1018759",
    "end": "1025760"
  },
  {
    "text": "targets comes okay",
    "start": "1025760",
    "end": "1031640"
  },
  {
    "start": "1031000",
    "end": "1199000"
  },
  {
    "text": "so uh the results of our pptp bar hting we find many freeos books most of them",
    "start": "1031640",
    "end": "1039558"
  },
  {
    "text": "are risk condition books and now we have enough motivation and confidence for the",
    "start": "1039559",
    "end": "1046038"
  },
  {
    "text": "next Windows R protocol which is sstp satp transfers the PPP traffic over",
    "start": "1046039",
    "end": "1056320"
  },
  {
    "text": "https it is invented by Microsoft it's also used in a 0.2 site",
    "start": "1056320",
    "end": "1065000"
  },
  {
    "text": "VPN uh like pptp sstp server also contains both colel driver and the user",
    "start": "1065000",
    "end": "1071480"
  },
  {
    "text": "mode Service uh sstp package first reaches the user model service sstp",
    "start": "1071480",
    "end": "1078919"
  },
  {
    "text": "psvc and then is dispatched to the Kel driver I sstp",
    "start": "1078919",
    "end": "1085640"
  },
  {
    "text": "dois uh let's analyze the preos attack surfaces in sstp the first attack",
    "start": "1085640",
    "end": "1091840"
  },
  {
    "text": "surface is a kernel driver it handles sstp package and maintains the life",
    "start": "1091840",
    "end": "1098120"
  },
  {
    "text": "cycle a sstp car the next surface is the",
    "start": "1098120",
    "end": "1103320"
  },
  {
    "text": "user mode service it maintains communication over https between between",
    "start": "1103320",
    "end": "1108640"
  },
  {
    "text": "the client and the server so um let's check the kernel",
    "start": "1108640",
    "end": "1114960"
  },
  {
    "text": "driver first it handles sstp messages there are two type of sstp packets the",
    "start": "1114960",
    "end": "1121720"
  },
  {
    "text": "data packets and the control packets they are functionally similar to the PPP",
    "start": "1121720",
    "end": "1127400"
  },
  {
    "text": "data packets and the control packets the most important data structure in the",
    "start": "1127400",
    "end": "1133039"
  },
  {
    "text": "driver is sstp contest it represents a sstp",
    "start": "1133039",
    "end": "1139840"
  },
  {
    "text": "session and also uh the same it to uses ndis framework for core",
    "start": "1139840",
    "end": "1146280"
  },
  {
    "text": "management so uh we to look for BS but first we can try the sstp packet",
    "start": "1146280",
    "end": "1153320"
  },
  {
    "text": "personing and message handing and the sstp statea Machine and the second uh",
    "start": "1153320",
    "end": "1159919"
  },
  {
    "text": "because the sstp server has many similar designs with a pptp server so uh we also",
    "start": "1159919",
    "end": "1167520"
  },
  {
    "text": "want to try use of the free and the risk condition so we developed the most",
    "start": "1167520",
    "end": "1174840"
  },
  {
    "text": "simple but uh fer we have ever developed it just uh simply send a",
    "start": "1174840",
    "end": "1181520"
  },
  {
    "text": "connect package to the server and sleep for some time and then close naion it",
    "start": "1181520",
    "end": "1187640"
  },
  {
    "text": "uses multiple threats we also bought a lottery ticket",
    "start": "1187640",
    "end": "1192760"
  },
  {
    "text": "before starting the fer because the fer is too simple",
    "start": "1192760",
    "end": "1199240"
  },
  {
    "text": "so want do counting we sometimes we will make uh some negative assumptions such",
    "start": "1199240",
    "end": "1206840"
  },
  {
    "text": "as this is farther is too simple no way to find a real b or such simple type of",
    "start": "1206840",
    "end": "1213840"
  },
  {
    "text": "BG shouldn't exist in this material product our experience is that we should",
    "start": "1213840",
    "end": "1221240"
  },
  {
    "text": "avoid such assumption uh before we actually looked into the details as a",
    "start": "1221240",
    "end": "1227760"
  },
  {
    "text": "example our super simple Father F crashes uh which seems",
    "start": "1227760",
    "end": "1234200"
  },
  {
    "text": "exploitable and by the way I didn't win the lottery so uh next I improved the sstp",
    "start": "1234200",
    "end": "1243360"
  },
  {
    "text": "fer me wire switch to man reverse engineering and find some Rob bus let's",
    "start": "1243360",
    "end": "1249760"
  },
  {
    "text": "see some of them this is a sstp Contex user the",
    "start": "1249760",
    "end": "1255919"
  },
  {
    "text": "three uh this Cod pattern is very Quon in sstp driver it retrieves a sstp",
    "start": "1255919",
    "end": "1263320"
  },
  {
    "text": "contest by handle and then add a reference counter to it to avoid",
    "start": "1263320",
    "end": "1269320"
  },
  {
    "text": "U however uh the problem is that when adding the reference counter uh there is",
    "start": "1269320",
    "end": "1274960"
  },
  {
    "text": "no lock protection so another thread can fre this sstp contest before the",
    "start": "1274960",
    "end": "1281720"
  },
  {
    "text": "reference counter is successfully added okay uh next this is a ndis handle",
    "start": "1281720",
    "end": "1290200"
  },
  {
    "text": "us set free uh we have seen similar BS in pptp server and the cross is also the",
    "start": "1290200",
    "end": "1296360"
  },
  {
    "text": "same no look protection while accessing ND handle so another threat can fre",
    "start": "1296360",
    "end": "1303279"
  },
  {
    "text": "handle at the same time uh this one is interesting because",
    "start": "1303279",
    "end": "1309240"
  },
  {
    "text": "it does not happen seeing uh the sstp driver itself instead it exists in the",
    "start": "1309240",
    "end": "1316480"
  },
  {
    "text": "nd1 driver andis1 processes PPP package and for",
    "start": "1316480",
    "end": "1322640"
  },
  {
    "text": "each package it will create a receive description structure which contains a",
    "start": "1322640",
    "end": "1328600"
  },
  {
    "text": "ndis handle for current core these uh received descriptions are inserted into",
    "start": "1328600",
    "end": "1335720"
  },
  {
    "text": "a list waiting for the user service for receiving and processing the user mode",
    "start": "1335720",
    "end": "1342480"
  },
  {
    "text": "service course iio receive packet to receive a packet it simply pops the",
    "start": "1342480",
    "end": "1348279"
  },
  {
    "text": "receive description and then copy the packet data to user mode buffer then",
    "start": "1348279",
    "end": "1354159"
  },
  {
    "text": "free the receive description structure the problem is that one free the receive",
    "start": "1354159",
    "end": "1360520"
  },
  {
    "text": "discretion structure uh there's no lock protection so another Cal pH ND handle",
    "start": "1360520",
    "end": "1367480"
  },
  {
    "text": "inside it at the same time resting U next let's check the user mode sorry",
    "start": "1367480",
    "end": "1376240"
  },
  {
    "start": "1373000",
    "end": "1516000"
  },
  {
    "text": "uh this one is signed by Our Father uh by our super simple father the root CA",
    "start": "1376240",
    "end": "1382880"
  },
  {
    "text": "is that lack of multi thread proection on a global timer",
    "start": "1382880",
    "end": "1390080"
  },
  {
    "text": "R next let's analyze the user mod service it's relatively simple compared",
    "start": "1390080",
    "end": "1396720"
  },
  {
    "text": "to K driver so actually not too much to analyze but anyway let's still give it a",
    "start": "1396720",
    "end": "1404159"
  },
  {
    "text": "try this is a risk condition you have by worker threat for each packet from the",
    "start": "1404159",
    "end": "1411799"
  },
  {
    "text": "client service will create a received buffer structure and Link it to a",
    "start": "1411799",
    "end": "1418640"
  },
  {
    "text": "list the the package will not be processed by the M instead a worker",
    "start": "1418640",
    "end": "1424640"
  },
  {
    "text": "thread is responsible for processing this package this design is common in",
    "start": "1424640",
    "end": "1430600"
  },
  {
    "text": "Windows Server program the worker thre simply uh processes the received buff",
    "start": "1430600",
    "end": "1437159"
  },
  {
    "text": "for one by one the problem here is that if another thre close the session at the",
    "start": "1437159",
    "end": "1444080"
  },
  {
    "text": "same time and there are stilled buffers in the list then all",
    "start": "1444080",
    "end": "1450400"
  },
  {
    "text": "received buffers will be fre together without any protection even uh some of the received",
    "start": "1450400",
    "end": "1458159"
  },
  {
    "text": "buffers are still being accessed by the workers right resting the user the",
    "start": "1458159",
    "end": "1465159"
  },
  {
    "text": "free so one looking for risk condition bgs in Windows uh our suggesting our",
    "start": "1465159",
    "end": "1471559"
  },
  {
    "text": "suggestion is that we can focus on important resources you can draw a",
    "start": "1471559",
    "end": "1477120"
  },
  {
    "text": "picture of the life cycle of the resource like where it is created where",
    "start": "1477120",
    "end": "1483159"
  },
  {
    "text": "it is used and where it is deleted and check the conditions for each access uh",
    "start": "1483159",
    "end": "1489559"
  },
  {
    "text": "for example uh is there any spin lock protection or is there any reference",
    "start": "1489559",
    "end": "1495360"
  },
  {
    "text": "counter protection the there access happens in a callback or worker threat",
    "start": "1495360",
    "end": "1502320"
  },
  {
    "text": "what dispatch level it is when accessing the resource and after that you can try to",
    "start": "1502320",
    "end": "1509039"
  },
  {
    "text": "find the risk conditions between the different access",
    "start": "1509039",
    "end": "1514840"
  },
  {
    "text": "points so uh the results of our SSP bar counting is quite good uh we find a lot",
    "start": "1514880",
    "end": "1521760"
  },
  {
    "start": "1516000",
    "end": "1735000"
  },
  {
    "text": "of bus and the RIS condition rocks again and we are already fre to H for the next",
    "start": "1521760",
    "end": "1529679"
  },
  {
    "text": "Windows RS protocol which is",
    "start": "1529679",
    "end": "1535000"
  },
  {
    "text": "l2tp r2tp a pctel to be established first and",
    "start": "1535279",
    "end": "1542600"
  },
  {
    "text": "it uses UDP Port ltp package is sent through the IDP",
    "start": "1542600",
    "end": "1550159"
  },
  {
    "text": "section to the kernel driver I l2p",
    "start": "1550159",
    "end": "1555960"
  },
  {
    "text": "doist uh lessen analyze pre Pros Tex surfaces in l2tp uh in l2tp there are",
    "start": "1556080",
    "end": "1564000"
  },
  {
    "text": "two authentications the first is one establishing the IPS channel it's a",
    "start": "1564000",
    "end": "1571200"
  },
  {
    "text": "partial authentication and a pre-shared key is often used in this authentication and",
    "start": "1571200",
    "end": "1578320"
  },
  {
    "text": "the second authentication is a full authentication to fully authenticates",
    "start": "1578320",
    "end": "1583600"
  },
  {
    "text": "the VPN user so uh one talking about restricted",
    "start": "1583600",
    "end": "1590000"
  },
  {
    "text": "fros attack surfaces than the only freeos attack surface in l2tp is ipack",
    "start": "1590000",
    "end": "1597679"
  },
  {
    "text": "including the I protocol which we will discuss later however uh since a pre-shared key",
    "start": "1597679",
    "end": "1605960"
  },
  {
    "text": "is often shared among a large group of users so it is not considered as a",
    "start": "1605960",
    "end": "1612840"
  },
  {
    "text": "strong secret so it is also useful if we can find bar",
    "start": "1612840",
    "end": "1618200"
  },
  {
    "text": "after the partial authentication and before the full authentication in such case the kernel",
    "start": "1618200",
    "end": "1625600"
  },
  {
    "text": "driver2 TP is also tax surface now let's",
    "start": "1625600",
    "end": "1630840"
  },
  {
    "text": "analyze the kernel driver by uh starting by introducing two important data",
    "start": "1630840",
    "end": "1637360"
  },
  {
    "text": "structures in the driver the first is a tal object it represents a r2tp tunnel",
    "start": "1637360",
    "end": "1645480"
  },
  {
    "text": "uh it's similar to a pptp control structure and the next is the",
    "start": "1645480",
    "end": "1651520"
  },
  {
    "text": "vccb which represents a l2tp core is similar to a core object in",
    "start": "1651520",
    "end": "1659720"
  },
  {
    "text": "pbtp the entry point of l2tp package in the current office l2tp receive uh it",
    "start": "1660360",
    "end": "1667799"
  },
  {
    "text": "processes two types of l2tp messages control message and the data",
    "start": "1667799",
    "end": "1675279"
  },
  {
    "text": "message so uh we to look for bar see the driver uh first we can try message",
    "start": "1675279",
    "end": "1681000"
  },
  {
    "text": "personing and handling uh including the l2tp Stater",
    "start": "1681000",
    "end": "1687000"
  },
  {
    "text": "machine and the second uh based on review experience uh with also like to",
    "start": "1687000",
    "end": "1694760"
  },
  {
    "text": "try UF and risk condition as usual we develop a simple",
    "start": "1694760",
    "end": "1701919"
  },
  {
    "text": "fer for starting it uses multiple threats and it Comm mutates l2tp",
    "start": "1701919",
    "end": "1709279"
  },
  {
    "text": "messages based on coverage and it sends messages randomly to the",
    "start": "1709279",
    "end": "1715760"
  },
  {
    "text": "server while fing I uh sorry while fing l2tp kernel driver uh there is a use for",
    "start": "1715760",
    "end": "1723480"
  },
  {
    "text": "TP shared by Alex nich and you can disable the IP",
    "start": "1723480",
    "end": "1728640"
  },
  {
    "text": "sack by modifying the r tree",
    "start": "1728640",
    "end": "1734159"
  },
  {
    "text": "entry uh so our fer got a few few presses include UF and the now point the",
    "start": "1734600",
    "end": "1740880"
  },
  {
    "text": "reference and then we switch to Manu reverse engineering and find some other",
    "start": "1740880",
    "end": "1746880"
  },
  {
    "text": "books Let's see some examples uh this one is Found book by",
    "start": "1746880",
    "end": "1753519"
  },
  {
    "text": "bar passer uh it's a UF in control message once the server received a",
    "start": "1753519",
    "end": "1760919"
  },
  {
    "text": "control message that is out of sequence it will make a Shanel copy of the",
    "start": "1760919",
    "end": "1766320"
  },
  {
    "text": "message the problem is that after return the from l2tp receive uh the original",
    "start": "1766320",
    "end": "1773880"
  },
  {
    "text": "UDP packet will be fre while the shallow copied message still contains pointers",
    "start": "1773880",
    "end": "1781240"
  },
  {
    "text": "to the original UDP message resulting",
    "start": "1781240",
    "end": "1786600"
  },
  {
    "text": "UF uh this is a tal UF C by timer callback in the cor function you can see",
    "start": "1786600",
    "end": "1794120"
  },
  {
    "text": "a Turnal object is accessed with without any protection so another threat can",
    "start": "1794120",
    "end": "1800360"
  },
  {
    "text": "simply bre the external object at the same",
    "start": "1800360",
    "end": "1805399"
  },
  {
    "text": "time this is a vccp UF and the client sends a new Cod request to the server",
    "start": "1805399",
    "end": "1813120"
  },
  {
    "text": "and a new vccb will be created and inserted into the Turnal vccb",
    "start": "1813120",
    "end": "1820080"
  },
  {
    "text": "list uh then uh the function accesses a vccb without any",
    "start": "1820080",
    "end": "1826039"
  },
  {
    "text": "protection so another thread can close the Chunnel which will free all vccb in",
    "start": "1826039",
    "end": "1832519"
  },
  {
    "text": "the Channel's VC list including this one regarding",
    "start": "1832519",
    "end": "1838720"
  },
  {
    "text": "U next uh yet another ND handle us in",
    "start": "1838720",
    "end": "1844720"
  },
  {
    "text": "yet another protocol and the root course is also the same and lack of protection when",
    "start": "1844720",
    "end": "1852279"
  },
  {
    "text": "accessing an ndi handal",
    "start": "1852279",
    "end": "1858600"
  },
  {
    "text": "okay uh so if you remember the ndis UF we introduced in the sstp session now",
    "start": "1858600",
    "end": "1867279"
  },
  {
    "text": "for short uh we just find exactly the same but this time in",
    "start": "1867279",
    "end": "1873519"
  },
  {
    "text": "l2tp very easy bug so uh the results of our r2tp bar",
    "start": "1873519",
    "end": "1880320"
  },
  {
    "text": "counting uh we found some bugs being a 2tp kernel driver and all bugs are",
    "start": "1880320",
    "end": "1886519"
  },
  {
    "text": "triggered after the IP sa channel is established so our first uh window SI",
    "start": "1886519",
    "end": "1895039"
  },
  {
    "start": "1892000",
    "end": "2229000"
  },
  {
    "text": "protocol to discuss today is ik ik is an Authentication Protocol to",
    "start": "1895039",
    "end": "1902880"
  },
  {
    "text": "establish security Turnal for ipac the two versions of I I version one",
    "start": "1902880",
    "end": "1910399"
  },
  {
    "text": "and version two a Windows l2tp Server uses version one and there is also a in",
    "start": "1910399",
    "end": "1917600"
  },
  {
    "text": "bpn type in Windows based on IQ version two it uses UDP port and is implemented",
    "start": "1917600",
    "end": "1927000"
  },
  {
    "text": "in I ex the pre all attack services are I",
    "start": "1927000",
    "end": "1933360"
  },
  {
    "text": "package passing and the processing and also we'd like to try UF and the risk",
    "start": "1933360",
    "end": "1940360"
  },
  {
    "text": "condition so we start to learn the spec of I protocol and uh this often happen the",
    "start": "1940360",
    "end": "1948200"
  },
  {
    "text": "when we research complex protocols we just get tired and just want to start",
    "start": "1948200",
    "end": "1954159"
  },
  {
    "text": "fing first so we developed a mutation base fer it uh it FES ik version one and",
    "start": "1954159",
    "end": "1963760"
  },
  {
    "text": "the version two messages and it also use M multiple threats to uh see if we can",
    "start": "1963760",
    "end": "1970639"
  },
  {
    "text": "find many use after threee or R condition BS the father finds some C bres mostly",
    "start": "1970639",
    "end": "1978320"
  },
  {
    "text": "are a l point the reference work so it seems the result is not so good so",
    "start": "1978320",
    "end": "1985399"
  },
  {
    "text": "switch to manure reverse engineering and find some other BS let's see some",
    "start": "1985399",
    "end": "1992799"
  },
  {
    "text": "example this one is a b in I version one fragmentation feature and if you if you",
    "start": "1992799",
    "end": "2000159"
  },
  {
    "text": "still remember the P fragmentation book uh we introduced before uh we have said",
    "start": "2000159",
    "end": "2006840"
  },
  {
    "text": "that at the fragmentation feature often leads to buxs and this is yet another",
    "start": "2006840",
    "end": "2014799"
  },
  {
    "text": "example and I packet starts with a Isa KMP header and in noral COD pass the",
    "start": "2014799",
    "end": "2022639"
  },
  {
    "text": "server check the packet to make sure it contains a valid ismp header however in",
    "start": "2022639",
    "end": "2030240"
  },
  {
    "text": "this recommentation pass the assembled packet just skips the header check so an",
    "start": "2030240",
    "end": "2038320"
  },
  {
    "text": "invalid invalid i p header can go through to the",
    "start": "2038320",
    "end": "2044279"
  },
  {
    "text": "later code pass which can cause various",
    "start": "2044279",
    "end": "2049880"
  },
  {
    "text": "problems okay x uh this one is a typical integer",
    "start": "2049960",
    "end": "2055599"
  },
  {
    "text": "overflow but which can lead to O right it occurs when the server tries to",
    "start": "2055599",
    "end": "2061480"
  },
  {
    "text": "decrypt an encrypted ik packet the one",
    "start": "2061480",
    "end": "2066960"
  },
  {
    "text": "Computing the size to decrypt there is an integer overflow",
    "start": "2066960",
    "end": "2073878"
  },
  {
    "text": "here this is another similar B uh like previous one uh it's also an integer",
    "start": "2074359",
    "end": "2081358"
  },
  {
    "text": "flow B which can lead to obr it also occurs when the server tries to decrypt",
    "start": "2081359",
    "end": "2088760"
  },
  {
    "text": "ik package uh next uh this is a Pros do in",
    "start": "2088760",
    "end": "2097880"
  },
  {
    "text": "I version two uh this B can be triggered by sending a I package with a zero sized",
    "start": "2097880",
    "end": "2107520"
  },
  {
    "text": "vendor ID payload which can crash this",
    "start": "2107520",
    "end": "2112960"
  },
  {
    "text": "server and the next uh this is yet another ND handle",
    "start": "2112960",
    "end": "2119520"
  },
  {
    "text": "you Ser to free in I V2 VN uh by finding this work uh we we",
    "start": "2119520",
    "end": "2127079"
  },
  {
    "text": "unlock the achievement that we have found in the is handle use after freeb",
    "start": "2127079",
    "end": "2134040"
  },
  {
    "text": "in every Windows CPM protocol we researched very",
    "start": "2134040",
    "end": "2141359"
  },
  {
    "text": "cool so the results of our ik accounting uh we find fros RC and the deny of",
    "start": "2141359",
    "end": "2149280"
  },
  {
    "text": "service BS in ik protocol but not so many books but not as many books as",
    "start": "2149280",
    "end": "2155880"
  },
  {
    "text": "other protocol especially we didn't find many RIS condition bugs like other protocols so",
    "start": "2155880",
    "end": "2163200"
  },
  {
    "text": "it seems to us that I is more secure than other protocols so choose ik",
    "start": "2163200",
    "end": "2169760"
  },
  {
    "text": "version two if you must use a Windows",
    "start": "2169760",
    "end": "2174760"
  },
  {
    "text": "VPN okay uh All Good Things uh must come to an end where we believe there are",
    "start": "2174960",
    "end": "2182000"
  },
  {
    "text": "still uh many windows RS bugs yet to be discovered",
    "start": "2182000",
    "end": "2187319"
  },
  {
    "text": "Microsoft has changed the Bounty rule uh and added R to out of scope list for",
    "start": "2187319",
    "end": "2195119"
  },
  {
    "text": "attack scenario Earth uh we are already familiar with such P changes it just",
    "start": "2195119",
    "end": "2203359"
  },
  {
    "text": "means to us that it's time to uh find a new",
    "start": "2203359",
    "end": "2208720"
  },
  {
    "text": "Target so uh question I do know the similarities between a productive but",
    "start": "2208720",
    "end": "2215599"
  },
  {
    "text": "Hunter and the Playboy the answer is say to next Target",
    "start": "2215599",
    "end": "2224119"
  },
  {
    "text": "pass yeah okay um last part so for future work uh we",
    "start": "2224119",
    "end": "2233000"
  },
  {
    "start": "2229000",
    "end": "2324000"
  },
  {
    "text": "believe a Windows 3 allbooks are still very high cost performance and a good",
    "start": "2233000",
    "end": "2239839"
  },
  {
    "text": "choice when we try when we select uh targets Al so we will continue to to",
    "start": "2239839",
    "end": "2246800"
  },
  {
    "text": "shave up the preos attack surfaces in Windows and there are pretty much stuffs",
    "start": "2246800",
    "end": "2253160"
  },
  {
    "text": "to look like authentication protocols Network protocols and domain services",
    "start": "2253160",
    "end": "2260680"
  },
  {
    "text": "and so on uh all are waiting for your",
    "start": "2260680",
    "end": "2266359"
  },
  {
    "text": "exploring okay uh a summary for our session today uh we introduced the",
    "start": "2266359",
    "end": "2272480"
  },
  {
    "text": "implementation of Windows RSV protocols and they complex with both Cal drivers",
    "start": "2272480",
    "end": "2279560"
  },
  {
    "text": "and the user mode Services making them good targets for remote free",
    "start": "2279560",
    "end": "2285119"
  },
  {
    "text": "ects and don't forget to try risk condition when researching Windows",
    "start": "2285119",
    "end": "2290280"
  },
  {
    "text": "remote protocols use both fing and manure auditing avoid only relying on one",
    "start": "2290280",
    "end": "2298880"
  },
  {
    "text": "method but be smart eager and greedy in back",
    "start": "2298880",
    "end": "2304359"
  },
  {
    "text": "counting and finally uh we wish everyone a big success in your home accounting",
    "start": "2304359",
    "end": "2312599"
  },
  {
    "text": "Journey that's all for our session today uh thank you again for listening should",
    "start": "2312599",
    "end": "2318440"
  },
  {
    "text": "you have any questions you can find me on Twitter thank you again",
    "start": "2318440",
    "end": "2326280"
  }
]