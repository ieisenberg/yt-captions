[
  {
    "text": "folks good morning thank you for coming out welcome to the session Defending Off the Land i'm Mark this is my colleague",
    "start": "2960",
    "end": "8880"
  },
  {
    "text": "Jacob uh and we're from Thinst um we're going to be talking Defending of the Land today we're a security product",
    "start": "8880",
    "end": "14639"
  },
  {
    "text": "company uh we're founded on the back of our in the trenches pentesting experience uh Jacob runs labs and I run",
    "start": "14639",
    "end": "20800"
  },
  {
    "text": "the engineering side in fact though our names are on the slide on the title slide several other team members have",
    "start": "20800",
    "end": "26720"
  },
  {
    "text": "also contributed towards this talk in various ways collaboration is how we built the talk it's also how we build",
    "start": "26720",
    "end": "32160"
  },
  {
    "text": "tools that help defenders win we've also relied on several open source projects we'll call them out as we get to those",
    "start": "32160",
    "end": "38640"
  },
  {
    "text": "slides we've got a bunch of content to get through today so this is the broad outline we're going to look at the",
    "start": "38640",
    "end": "43920"
  },
  {
    "text": "background and our context for defending off the land we're then going to introduce and go through 11 + one",
    "start": "43920",
    "end": "49840"
  },
  {
    "text": "techniques for some of them are new some of them are a new twist on older ideas um and after that we'll hit the last few",
    "start": "49840",
    "end": "57360"
  },
  {
    "text": "slides before we get there let's tackle that main question that no doubt is brewing in your minds already i'm saying",
    "start": "57360",
    "end": "64080"
  },
  {
    "text": "defending off the land why should you care and it's a question you you should always ask of course and here's the",
    "start": "64080",
    "end": "70159"
  },
  {
    "text": "bottom line we're going to be showing you 11 + 1 techniques that are going to help detect threat actors without",
    "start": "70159",
    "end": "76400"
  },
  {
    "text": "installing any additional software right and so this talk is for folks who protect networks it's for CIS admins",
    "start": "76400",
    "end": "83040"
  },
  {
    "text": "worrying about the gaps in their networks where EDR can't or won't provide visibility before we get there",
    "start": "83040",
    "end": "89520"
  },
  {
    "text": "let's look at some of the background to this work because it's going to explain how we got into it and what led up to it",
    "start": "89520",
    "end": "96159"
  },
  {
    "text": "we make tools that help defenders win most of them are free we make Canary tokens uh and on canary tokens.org",
    "start": "96159",
    "end": "102240"
  },
  {
    "text": "millions of tokens have been minted we put out open canary which is our open source honeypot deployed around the",
    "start": "102240",
    "end": "107439"
  },
  {
    "text": "world our labs team headed by Jacob puts out research every quarter and they spend many hours summarizing reviewing",
    "start": "107439",
    "end": "113840"
  },
  {
    "text": "uh and publishing that that uh these research summaries um and that's all on the free side the commercial side is",
    "start": "113840",
    "end": "120159"
  },
  {
    "text": "we've got some commercial honeypot and canary token stuff we've been doing deception for a decade now and in fact",
    "start": "120159",
    "end": "126880"
  },
  {
    "text": "in 2015 we uh put out a talk at Blackhat USA entitled bring back the honeypotss",
    "start": "126880",
    "end": "132160"
  },
  {
    "text": "and that talk introduced open canary it introduced Canary tokens um and Canary",
    "start": "132160",
    "end": "137680"
  },
  {
    "text": "tokens specifically was this novel twist on the older honey tokens idea we liked that idea and two years later in 2017 we",
    "start": "137680",
    "end": "144959"
  },
  {
    "text": "put out another talk which really expanded on this idea of Canary tokens and we've spent the time since then",
    "start": "144959",
    "end": "150800"
  },
  {
    "text": "building on tokens building on honeypot technology the point is we've been immersed in this now for almost or",
    "start": "150800",
    "end": "156879"
  },
  {
    "text": "actually more than a decade and so we've got thoughts on the usefulness and design of deception products for one we",
    "start": "156879",
    "end": "163040"
  },
  {
    "text": "think it's a chronically underutilized technique for detecting breaches honeypotss the original deception uh",
    "start": "163040",
    "end": "169280"
  },
  {
    "text": "technique that we know about it's a decades old idea at this point we think they're super useful for detecting",
    "start": "169280",
    "end": "174640"
  },
  {
    "text": "breaches when they're installed internally and something to note about honeypotss is that they are parallel or",
    "start": "174640",
    "end": "180879"
  },
  {
    "text": "adjacent infrastructure you don't install honeypot software on your production systems you have your production systems the honeypot sits",
    "start": "180879",
    "end": "187360"
  },
  {
    "text": "next to it and that's great for detecting lateral movement through your network attack is moving from one system",
    "start": "187360",
    "end": "192480"
  },
  {
    "text": "to the other but what can you do when the attacker directly compromises the asset that they're interested in there",
    "start": "192480",
    "end": "198159"
  },
  {
    "text": "is no lateral movement how do you detect them in that instance and that took us directly into honey to Canary tokens",
    "start": "198159",
    "end": "204720"
  },
  {
    "text": "rather because these are intended to be deployed on your production systems but with minimal risk because canary tokens",
    "start": "204720",
    "end": "211440"
  },
  {
    "text": "don't run any actual code instead what they do is they're going to trigger some sort of network traffic maybe a web",
    "start": "211440",
    "end": "217680"
  },
  {
    "text": "query maybe a DNS query some other network packet um and there's a good chance some of you have heard of canary",
    "start": "217680",
    "end": "223360"
  },
  {
    "text": "tokens but if you haven't I will give you a short example to explain it we think of them as little bits of data or",
    "start": "223360",
    "end": "229680"
  },
  {
    "text": "information or configuration files that when you put these on an endpoint and an attacker discovers them they use them in",
    "start": "229680",
    "end": "235599"
  },
  {
    "text": "their expected way and that causes one of these network signals so I'm going to give you an example here one of the",
    "start": "235599",
    "end": "240720"
  },
  {
    "text": "popular ones is a decoy Microsoft Word document and the way it works is pretty straightforward you go to canary",
    "start": "240720",
    "end": "247040"
  },
  {
    "text": "tokens.org uh you give us an email address you give us a little reminder of where you put this particular file we're",
    "start": "247040",
    "end": "253360"
  },
  {
    "text": "going to let you download a word document and that word document is uh going to be a unique word document uh",
    "start": "253360",
    "end": "259680"
  },
  {
    "text": "only uh you would get and you then put it on say your desktop folder uh and you",
    "start": "259680",
    "end": "265120"
  },
  {
    "text": "give it a juicy sounding name like journal.docex or passwords.docex right and you leave it there you know what",
    "start": "265120",
    "end": "270880"
  },
  {
    "text": "that thing is you're not going to touch it but if that machine is ever breached and an attacker breaks in they go looking around for things that look",
    "start": "270880",
    "end": "277040"
  },
  {
    "text": "interesting if they find passwords.docex of course they're going to open it and inside that file is a web bug it's going",
    "start": "277040",
    "end": "282880"
  },
  {
    "text": "to call back to us we see that and we send you an alert simple idea it's been out there for a decade all right but we",
    "start": "282880",
    "end": "289919"
  },
  {
    "text": "think of Canary tokens as a much broader idea than just web bugs in Word documents um this definition that we've",
    "start": "289919",
    "end": "295919"
  },
  {
    "text": "got is purposefully broad on the left hand side there we've got what we call the AWS API key canary token and we give",
    "start": "295919",
    "end": "303440"
  },
  {
    "text": "you valid AWS API credentials that's five lines of text you put five lines of",
    "start": "303440",
    "end": "308960"
  },
  {
    "text": "text on an asset could be a server could be the environment variables for a lambda for example but if that resource",
    "start": "308960",
    "end": "314720"
  },
  {
    "text": "is ever breached and an attack is poking around they find these credentials they're going to try them those are defang credentials they belong to an",
    "start": "314720",
    "end": "321120"
  },
  {
    "text": "account that we control we monitoring the logs when we see activity on those credentials we send you an alert super",
    "start": "321120",
    "end": "326560"
  },
  {
    "text": "simple idea or what about a Canary token mobile phone app right that app on the",
    "start": "326560",
    "end": "332560"
  },
  {
    "text": "phone there says PayPal but it's not PayPal that's a that's a simple bookmark with an icon right and if that if that",
    "start": "332560",
    "end": "339600"
  },
  {
    "text": "app is tapped and opened we'll see it we'll send you an alert the point is we can give you this detection mechanism",
    "start": "339600",
    "end": "345759"
  },
  {
    "text": "but without installing anything that's not an installation of software that's simply creating a bookmark and so this",
    "start": "345759",
    "end": "352160"
  },
  {
    "text": "idea of Canary tokens is one that we've been working on for quite a while the issue in terms of detecting breaches is",
    "start": "352160",
    "end": "358639"
  },
  {
    "text": "that time and time again as defenders we want to install tools that we think are going to catch attackers but the tools",
    "start": "358639",
    "end": "364800"
  },
  {
    "text": "often are not thinking about where the attackers are they have the sort of wish casting or normative idea of what",
    "start": "364800",
    "end": "370400"
  },
  {
    "text": "attackers should do instead of what attackers actually are doing but we need to find ways to get in front of the",
    "start": "370400",
    "end": "376000"
  },
  {
    "text": "attackers not put them in front of us we've seen some missteps in some sense",
    "start": "376000",
    "end": "381440"
  },
  {
    "text": "for uh in the security industry early IPS was an example of this we thought that we could just run Grep across all",
    "start": "381440",
    "end": "387600"
  },
  {
    "text": "of our network traffic and it turns out that as much as we wanted that to work it didn't work scale was one reason as",
    "start": "387600",
    "end": "394479"
  },
  {
    "text": "soon as we started uh encrypting all internal traffic uh GP also became useless in this in this uh example and",
    "start": "394479",
    "end": "401360"
  },
  {
    "text": "so we wanted IPS to work but it was not putting uh it was not getting in front of attackers another example for this is",
    "start": "401360",
    "end": "408960"
  },
  {
    "text": "uh seams where and so this is a very unscientific poll on uh X formerly known",
    "start": "408960",
    "end": "414319"
  },
  {
    "text": "as Twitter um but a well-known seam analyst asked the question folks who have seams did it ever catch at least",
    "start": "414319",
    "end": "420240"
  },
  {
    "text": "one attack and like 50% of the respondents said it hasn't caught an attack now seams are not for the small",
    "start": "420240",
    "end": "426479"
  },
  {
    "text": "the shy or the skint they're really going to be in organizations that typically will be targeted and only half",
    "start": "426479",
    "end": "432639"
  },
  {
    "text": "of them have even caught a single incident right so it seems uh their value is somewhat questionable i'll do a",
    "start": "432639",
    "end": "438319"
  },
  {
    "text": "quick shout out there somebody thought that there was a product that did work but I'll say no more about that in",
    "start": "438319",
    "end": "443759"
  },
  {
    "text": "thinking about breach detection EDR seems like the obvious solution here and we're not knocking EDR we think EDR has",
    "start": "443759",
    "end": "450080"
  },
  {
    "text": "an important role to play but malicious actors expect EDR and they do work to bypass EDR and not only that we know",
    "start": "450080",
    "end": "457280"
  },
  {
    "text": "that EDR can't be installed in many locations maybe those assets are too old maybe they're too weird or maybe they",
    "start": "457280",
    "end": "464080"
  },
  {
    "text": "don't actually belong to you the point is you can't get EDR across your fleet",
    "start": "464080",
    "end": "469120"
  },
  {
    "text": "and so in that instance how can we start implementing detections well let's take a leaf out of the book of threat actors",
    "start": "469120",
    "end": "475440"
  },
  {
    "text": "where they go when we're presented with a bunch of constraints how do we work around them um and you know it's easy to",
    "start": "475440",
    "end": "482000"
  },
  {
    "text": "think of attackers as this genius level strategists when they try when they when they're confronted by challenges where",
    "start": "482000",
    "end": "488639"
  },
  {
    "text": "you know they're always trying to play 4D chess and targeting only those systems with national security importance or they're genius level",
    "start": "488639",
    "end": "495680"
  },
  {
    "text": "vulnerability uh finders and exploit writers who you know they can always uncover brand new",
    "start": "495680",
    "end": "501319"
  },
  {
    "text": "exploits but sometimes they're not looking for a better mousetrap sometimes they're really just happy to reach for",
    "start": "501319",
    "end": "507039"
  },
  {
    "text": "those tools that are there and we call that living off the land right for attackers now since 2015 there's been",
    "start": "507039",
    "end": "514159"
  },
  {
    "text": "this public rise in the idea of attackers living off the land the first talk that we know of and we track talks",
    "start": "514159",
    "end": "520080"
  },
  {
    "text": "is in 2013 and in 2015 there did seem to be a shift because Windows 10 was released in",
    "start": "520080",
    "end": "526959"
  },
  {
    "text": "2015 it came with this vastly increased set of capabilities that attackers could use but it also limited attackers in",
    "start": "526959",
    "end": "534560"
  },
  {
    "text": "terms of running untrusted binaries and so we saw more research into this idea of living off the land because it means",
    "start": "534560",
    "end": "541040"
  },
  {
    "text": "using those capabilities of the legitimate tools already built into the system uh instead of the attackers",
    "start": "541040",
    "end": "546640"
  },
  {
    "text": "having to carry their own tools onto that and they realized there are a bunch of benefits there right they didn't have to worry about DL hells or version",
    "start": "546640",
    "end": "553839"
  },
  {
    "text": "dependencies or language pack support they didn't have to worry so much about the idea of being discovered because you",
    "start": "553839",
    "end": "560160"
  },
  {
    "text": "know they're not running mimikats.exe they can run tools that blend in with regular uh regular CIS admin uh behavior",
    "start": "560160",
    "end": "567360"
  },
  {
    "text": "and they also had less chance of being attributed um because they're not deploying custom implants these are",
    "start": "567360",
    "end": "573360"
  },
  {
    "text": "again off-the-shelf tools so I do want to take a quick look at a few of these techniques because we are going to call",
    "start": "573360",
    "end": "578959"
  },
  {
    "text": "back to this you know one common attacker living off the land technique is the idea of instead of read or",
    "start": "578959",
    "end": "584480"
  },
  {
    "text": "writing custom network traffic redirection you can you just use Windows built-in netsh port",
    "start": "584480",
    "end": "590519"
  },
  {
    "text": "proxy instead of building fancy persistence you can just use schedule tasks right and let Windows worry about",
    "start": "590519",
    "end": "597519"
  },
  {
    "text": "the problem of leap days and leap seconds which it turns out may turn negative uh",
    "start": "597519",
    "end": "603399"
  },
  {
    "text": "shortly instead of worrying about building DL loaders and trying to figure out how to parse PE files you could just",
    "start": "603399",
    "end": "608880"
  },
  {
    "text": "use rundl32.exe and when it comes to privilege escalation you know instead of",
    "start": "608880",
    "end": "614240"
  },
  {
    "text": "an attacker having to find some novel vulnerability a kernel level vulnerability just bring along a",
    "start": "614240",
    "end": "619920"
  },
  {
    "text": "vulnerable driver that's already signed that will be loaded and you've got an off-the-shelf exploit you know these techniques",
    "start": "619920",
    "end": "627040"
  },
  {
    "text": "there's nothing new in what I'm saying there around those techniques and at this point you're probably thinking this is a talk about defending why are we",
    "start": "627040",
    "end": "633600"
  },
  {
    "text": "talking about attackers well living off the land largely works because the attackers goals run if not",
    "start": "633600",
    "end": "640880"
  },
  {
    "text": "directly parallel well at least in the same rough direction as that of regular CIS admin tasks and for threat actors",
    "start": "640880",
    "end": "647760"
  },
  {
    "text": "those CIS admin tools are often enough to get by without needing to install additional tools let she who has never",
    "start": "647760",
    "end": "653839"
  },
  {
    "text": "added no password to a pseudo file or set all permissions on a file system or",
    "start": "653839",
    "end": "660240"
  },
  {
    "text": "granted admin on a GitHub repo to help a developer get past some obstacle past the first stone those are CIS admin",
    "start": "660240",
    "end": "667040"
  },
  {
    "text": "tasks but they are also the sorts of things that attackers might do for persistence and we think defenders can",
    "start": "667040",
    "end": "672880"
  },
  {
    "text": "learn lots from attackers in this regard of reusing the capabilities already present on your systems and that's the",
    "start": "672880",
    "end": "678880"
  },
  {
    "text": "essence of what we're saying with defending off the land we love flipping the script on attackers",
    "start": "678880",
    "end": "684560"
  },
  {
    "text": "and using their techniques against them at things with deception we think there's lots of scope for subverting",
    "start": "684560",
    "end": "690240"
  },
  {
    "text": "those attackers expectations we can learn from attackers living off the land and build deceptive detections using the",
    "start": "690240",
    "end": "696880"
  },
  {
    "text": "functionality and tools already present so we think it's about leveraging the capabilities already there it gives us",
    "start": "696880",
    "end": "703200"
  },
  {
    "text": "this defensive tooling without needing to install additional software it might require some scripting from time to time",
    "start": "703200",
    "end": "710079"
  },
  {
    "text": "again like any decent CIS admin would um and we're going to be laying traps and",
    "start": "710079",
    "end": "715760"
  },
  {
    "text": "we're not going to be installing additional software to detect the attackers as we mentioned earlier a big",
    "start": "715760",
    "end": "721680"
  },
  {
    "text": "driver for this is the idea that EDR doesn't give you 100% visibility we can't get EDR AC across every asset in",
    "start": "721680",
    "end": "728880"
  },
  {
    "text": "our estate and these sorts of techniques become options for when we can't now a legit question you might be thinking is",
    "start": "728880",
    "end": "735680"
  },
  {
    "text": "is any of this actually new and arguably the concept isn't new right clever CIS",
    "start": "735680",
    "end": "741040"
  },
  {
    "text": "admins have been doing this forever laying environment specific traps um a couple of years ago there was this idea",
    "start": "741040",
    "end": "747120"
  },
  {
    "text": "that you could install cerillic keyboards on your endpoints because Russian malware when it saw the or",
    "start": "747120",
    "end": "752880"
  },
  {
    "text": "certain Russian malware when it saw the presence of cerillic keyboards would just exit because it didn't want to",
    "start": "752880",
    "end": "757920"
  },
  {
    "text": "target uh Russian systems right and so that's not installing any software to defend those systems you're making a",
    "start": "757920",
    "end": "763760"
  },
  {
    "text": "config change and that's part of this defending off the land but we want to be clear we think this is deeply rooted in",
    "start": "763760",
    "end": "769920"
  },
  {
    "text": "the idea of CIS admins doing their their job and we do think it deserves this label defending off the land it can also",
    "start": "769920",
    "end": "776079"
  },
  {
    "text": "be combined with deception moving deception not just from the network but into the OS itself presenting threat",
    "start": "776079",
    "end": "781600"
  },
  {
    "text": "actors with fake but juicy looking files config data or commands if this sounds like work yes we",
    "start": "781600",
    "end": "790160"
  },
  {
    "text": "say it's work like this is not a product class that is going to save you um and by definition we're giving you",
    "start": "790160",
    "end": "795920"
  },
  {
    "text": "techniques not an entire new product we're also only focusing on Windows in this talk we think that there's scope in",
    "start": "795920",
    "end": "802399"
  },
  {
    "text": "other in other platforms but for this one we're only hitting Windows and in terms of where we get our ideas from",
    "start": "802399",
    "end": "807760"
  },
  {
    "text": "John Lambert said it best 10 years ago defense is led by offense we have to look and see what the attackers are",
    "start": "807760",
    "end": "813120"
  },
  {
    "text": "doing if we want to get in front of them and so for this we're reading the DFIR reports we are reading papers that we",
    "start": "813120",
    "end": "818959"
  },
  {
    "text": "collect at citation.thinks.com thinks.com and we're looking for those visibility gaps so with that the",
    "start": "818959",
    "end": "824560"
  },
  {
    "text": "background is done it's going to be time to dive into the techniques um this is an overview of where we're going to go",
    "start": "824560",
    "end": "829839"
  },
  {
    "text": "with this we're going to talk about some of the primitives uh that we use throughout the techniques we're then going to look at ways to detect local",
    "start": "829839",
    "end": "836720"
  },
  {
    "text": "thread actors we're then going to look at ways to detect remote thread actors and we're going to finish off with a",
    "start": "836720",
    "end": "841920"
  },
  {
    "text": "cloud technique and with that I'm going to hand over to Jacob",
    "start": "841920",
    "end": "847560"
  },
  {
    "text": "thank you Mark just like attackers living off the land defenders have to examine the raw materials available to",
    "start": "848560",
    "end": "855199"
  },
  {
    "text": "them so to speak the next few slides we're going to look at a few exemplar primitives that we're going to be using",
    "start": "855199",
    "end": "860720"
  },
  {
    "text": "time and time again in some of our specific capabilities and then you can kind of see this as the raw materials",
    "start": "860720",
    "end": "866320"
  },
  {
    "text": "that you're able to manipulate or tweak to your environment so we're going to start off just for context with the kind",
    "start": "866320",
    "end": "873360"
  },
  {
    "text": "of popular Canary tokens on canary tokens.org or which is where we give you either a web bug so a URL or a custom",
    "start": "873360",
    "end": "880480"
  },
  {
    "text": "domain name and if those are ever accessed or resolved we send you an email or we fire off a web hook and",
    "start": "880480",
    "end": "886639"
  },
  {
    "text": "since this is such an easy way you can pretty easily resolve a domain name from PowerShell or from Bash it's an easy way",
    "start": "886639",
    "end": "893279"
  },
  {
    "text": "to get that alert off of that system and back to where you can action off of it um we do want to note that there is uh",
    "start": "893279",
    "end": "900399"
  },
  {
    "text": "kind of a balance between the two so HTTP request the client is directly connecting to our server they can put",
    "start": "900399",
    "end": "906959"
  },
  {
    "text": "arbitrary data in that request so we get the IP address we get whatever other information we can contextualize that",
    "start": "906959",
    "end": "912880"
  },
  {
    "text": "with DNS you only get the IP address of kind of the resolving DNS server um you",
    "start": "912880",
    "end": "919120"
  },
  {
    "text": "don't get to put extra information in there usually um but it works even in highly restricted environments you don't",
    "start": "919120",
    "end": "925440"
  },
  {
    "text": "need to worry about what your proxy settings are or what your firewall or WAFT rules are um so our Canary product",
    "start": "925440",
    "end": "931680"
  },
  {
    "text": "actually uses DNS to communicate with our servers so that you never need to muck with that and so if you can resolve",
    "start": "931680",
    "end": "938560"
  },
  {
    "text": "a host name in your network you can get this alert out and so we use that kind of interchangeably depending on your",
    "start": "938560",
    "end": "943839"
  },
  {
    "text": "environment you're going to put these in that can kind of be the the trade space you're going to evaluate so with that context in mind",
    "start": "943839",
    "end": "950240"
  },
  {
    "text": "we're going to move to our first primitive that is more specific to defending off the land and that's the Windows crypto API um so within that",
    "start": "950240",
    "end": "958240"
  },
  {
    "text": "crypto API there's this field um that is accessed called the authority information access field or the AIA and",
    "start": "958240",
    "end": "965920"
  },
  {
    "text": "that's a URL that when you're using TLS kind of how you're supposed to rather than shipping the entire chain of",
    "start": "965920",
    "end": "972399"
  },
  {
    "text": "certificates you just point a URL to the kind of issuing certificate authority and you can kind of go up that way and",
    "start": "972399",
    "end": "978000"
  },
  {
    "text": "so if your client has already seen that CA they don't need to go and you know waste this bandwidth um what's really",
    "start": "978000",
    "end": "984800"
  },
  {
    "text": "cute is is you can just shove a Canary token URL in there and then when that certificate is validated on the endpoint",
    "start": "984800",
    "end": "990240"
  },
  {
    "text": "it goes and reaches out for Canary tokens and then that triggers the alert and so we'll see that this is a a",
    "start": "990240",
    "end": "995519"
  },
  {
    "text": "primitive we use for a couple of our tokens to get information on the attacker side on the endpoint itself uh",
    "start": "995519",
    "end": "1002959"
  },
  {
    "text": "PowerShell has become a very powerful first class language in Windows for all types of CIS admin tasks and beyond um",
    "start": "1002959",
    "end": "1009680"
  },
  {
    "text": "it does have this other feature that I do want to highlight the add type feature which allows you to dynamically",
    "start": "1009680",
    "end": "1014880"
  },
  {
    "text": "generate a string of C or other.NET code which gives you full access to the",
    "start": "1014880",
    "end": "1020720"
  },
  {
    "text": "wind32 or then the .NET APIs and then you just invoke that string as an",
    "start": "1020720",
    "end": "1025918"
  },
  {
    "text": "instantiated object so without having to worry about compiling to libraries shipping out making sure you have the",
    "start": "1025919",
    "end": "1032199"
  },
  {
    "text": "right.net this is all built in you don't need Visual Studio you can just write some C and say I want to run that C#",
    "start": "1032199",
    "end": "1038959"
  },
  {
    "text": "within the context of PowerShell and so this is a very powerful primitive to access those lower level system APIs",
    "start": "1038959",
    "end": "1045438"
  },
  {
    "text": "from a nice highle scripting language and so now that we have that",
    "start": "1045439",
    "end": "1050799"
  },
  {
    "text": "primitive to run a lot of interesting things on the endpoint how do we trigger that how do we kind of see when badness",
    "start": "1050799",
    "end": "1056720"
  },
  {
    "text": "is occurring and that's where we use a lot of Windows events and then you can actually trigger off of specific events",
    "start": "1056720",
    "end": "1061919"
  },
  {
    "text": "so there's thousands of events out there that Windows is tracking and you can create things that happen when those",
    "start": "1061919",
    "end": "1066960"
  },
  {
    "text": "events are seen many of them need to be enabled either through some registry change or configuration change but once",
    "start": "1066960",
    "end": "1073200"
  },
  {
    "text": "that's enabled then you have a really good way to kind of say this is the condition I'm looking for and now I want to run some",
    "start": "1073200",
    "end": "1079240"
  },
  {
    "text": "action and then finally to get that alert to the defender you'll see some of our demo videos it's a lot easier to",
    "start": "1079240",
    "end": "1085039"
  },
  {
    "text": "show a little popup or a little toast in the notification bar so you'll see that pop up um and that's kind of handy if",
    "start": "1085039",
    "end": "1091120"
  },
  {
    "text": "you are for example on your laptop in a coffee shop and as someone is browsing your Canary file share you get a little",
    "start": "1091120",
    "end": "1096880"
  },
  {
    "text": "note hey someone just tried to open your files on your computer canary tokens.org we're going to use as well using that",
    "start": "1096880",
    "end": "1103280"
  },
  {
    "text": "easy DNS resolution or web lookup to be able to get that alert off the system so",
    "start": "1103280",
    "end": "1109039"
  },
  {
    "text": "you may not be sitting in front of your computer at all hours of the day and so this is a nice way where it buzzes your",
    "start": "1109039",
    "end": "1114400"
  },
  {
    "text": "phone saying \"Hey someone's on my computer i should go check that out.\" And it's really important to remember that these are just the primitives we're",
    "start": "1114400",
    "end": "1120720"
  },
  {
    "text": "talking about right now and you'll see them put into specific capabilities but in a way that you can go in and change",
    "start": "1120720",
    "end": "1126640"
  },
  {
    "text": "them out it's just kind of a an exemplar an illustrative capability um to show",
    "start": "1126640",
    "end": "1131760"
  },
  {
    "text": "the power of these primitives so with that out of the way let's look at these",
    "start": "1131760",
    "end": "1137200"
  },
  {
    "text": "11 plus one Canary tokens that we've built some of these are now live as of the last day or so on canary tokens.org",
    "start": "1137200",
    "end": "1144400"
  },
  {
    "text": "you can go check them out you can play with them um others are either not quite mature enough or don't have that simple",
    "start": "1144400",
    "end": "1151760"
  },
  {
    "text": "set it and forget it maybe they require kind of a more nuance deployment that ties closer to your environment or has",
    "start": "1151760",
    "end": "1158640"
  },
  {
    "text": "other types of kind of um you know little bit more configuration that might be needed and so in those ones they",
    "start": "1158640",
    "end": "1164559"
  },
  {
    "text": "might not make the bar for canary tokens.org but everything will be released open source um in a defending",
    "start": "1164559",
    "end": "1170320"
  },
  {
    "text": "off the land uh repo that we put up and the slides are going to have either an Octo GitHub logo if it's on the repo or",
    "start": "1170320",
    "end": "1177520"
  },
  {
    "text": "a Canary tokens logo if you can go and play with it right now so we're going to run through these pretty quickly because",
    "start": "1177520",
    "end": "1183039"
  },
  {
    "text": "we do have 11 plus one of them uh some of them are pretty similar or they use the same primitive so I'll spend a",
    "start": "1183039",
    "end": "1188720"
  },
  {
    "text": "little bit more time talking about the first one and then the subsequent ones i'll hope you just get the idea kind of show a demo and then we'll move on all",
    "start": "1188720",
    "end": "1195280"
  },
  {
    "text": "of our slides are going to be published with links and everything so don't worry about taking notes or getting a picture",
    "start": "1195280",
    "end": "1200559"
  },
  {
    "text": "of each one you'll be able to grab all this off the internet later so now we're",
    "start": "1200559",
    "end": "1205919"
  },
  {
    "text": "going to start with capabilities that detect badness on your local system um I personally run a few of these because",
    "start": "1205919",
    "end": "1212240"
  },
  {
    "text": "EDR on my home environment is a little bit overkill and these provide really powerful capabilities that help me know",
    "start": "1212240",
    "end": "1217600"
  },
  {
    "text": "okay maybe something's going ary um so we're going to start with the sensitive command token and this was actually the",
    "start": "1217600",
    "end": "1224080"
  },
  {
    "text": "impetus at least in my mind to think about this concept of defending off the land um so we released this last year",
    "start": "1224080",
    "end": "1231039"
  },
  {
    "text": "this one is not uh is not brand new essentially it's a registry key that configures the Windows debugging system",
    "start": "1231039",
    "end": "1237760"
  },
  {
    "text": "to run a process whenever another process is run or a command is run and when we were reading these DFIR reports",
    "start": "1237760",
    "end": "1245120"
  },
  {
    "text": "we saw time and time again that attackers or malware would land on a system and then it would orient itself",
    "start": "1245120",
    "end": "1250480"
  },
  {
    "text": "to figure out where am I in this network by running commands that I'm not a Windows guy but I'd never heard of right",
    "start": "1250480",
    "end": "1256080"
  },
  {
    "text": "so they run who am I to figure out where they are they run tools like kylist which dump a bunch of keraros tickets",
    "start": "1256080",
    "end": "1262240"
  },
  {
    "text": "you know for ID authentication or NL test and so thinking these are very run rarely run benignely it would be really",
    "start": "1262240",
    "end": "1269840"
  },
  {
    "text": "nice to know hey someone in your organization is running these commands um and so real quick you see just you",
    "start": "1269840",
    "end": "1276400"
  },
  {
    "text": "import this registry file and if that command in this case NL test is ever run it dynamically encodes the canary uh",
    "start": "1276400",
    "end": "1283880"
  },
  {
    "text": "token the username and the computer name into that DNS resolution And so you can",
    "start": "1283880",
    "end": "1289280"
  },
  {
    "text": "put this one registry key and you can push it out across your whole fleet with SECM or GPO or any other kind of",
    "start": "1289280",
    "end": "1295280"
  },
  {
    "text": "management system and then anytime someone runs with this command in your fleet you get an alert saying \"Hey Casey",
    "start": "1295280",
    "end": "1302559"
  },
  {
    "text": "on Casey's desktop just ran this bad command.\" Another cute trick I know we're talking about living off the land",
    "start": "1302559",
    "end": "1308080"
  },
  {
    "text": "is you can actually flag executables that don't exist or shouldn't exist so if an attacker does ship mimicats.exe",
    "start": "1308080",
    "end": "1314799"
  },
  {
    "text": "exe over and then they run it if they haven't changed the name you get the alert anyways and so it's kind of a a",
    "start": "1314799",
    "end": "1320880"
  },
  {
    "text": "nice way to think about this is a point on this spectrum of defending off the land and again now the attacker is met",
    "start": "1320880",
    "end": "1328400"
  },
  {
    "text": "where they are on this end point that they are and it really helps you pinpoint that in your organization and",
    "start": "1328400",
    "end": "1333679"
  },
  {
    "text": "act very quickly before they get super entrenched so we're going to move to another favorite for offensive living",
    "start": "1333679",
    "end": "1339679"
  },
  {
    "text": "off the land scheduled tasks you remember seeing that uh you know this sack of using scheduled tasks for",
    "start": "1339679",
    "end": "1345440"
  },
  {
    "text": "persistence um they are a very popular persistence technique it's well documented online if you just search",
    "start": "1345440",
    "end": "1351360"
  },
  {
    "text": "scheduled task living off the land you'll get a whole bunch of tutorials for how to do this um and you can use it",
    "start": "1351360",
    "end": "1356480"
  },
  {
    "text": "to run your malware reverse shells whatnot and so for this capability we created ourselves a scheduled task that",
    "start": "1356480",
    "end": "1362720"
  },
  {
    "text": "is triggered by the creation of scheduled tasks and then evaluates what this new task is doing to see is this a",
    "start": "1362720",
    "end": "1369360"
  },
  {
    "text": "normal system behavior or is this running PowerShell CMD something suspicious like run DL so to sum it up",
    "start": "1369360",
    "end": "1377039"
  },
  {
    "text": "it is very much like this yo dog I heard you like scheduled task so I made a scheduled task to look for new scheduled",
    "start": "1377039",
    "end": "1382919"
  },
  {
    "text": "tasks so real quickly jokes aside this quick demo shows me as an admin now",
    "start": "1382919",
    "end": "1388240"
  },
  {
    "text": "creating a scheduled task so this is post exploitation i'm running this new task that says command.exe and you'll",
    "start": "1388240",
    "end": "1394720"
  },
  {
    "text": "notice this little toast pops up that says \"hm this command is this task is suspicious and you should go check that",
    "start": "1394720",
    "end": "1400480"
  },
  {
    "text": "out.\" And so very simple thing very simple capability but gives you visibility and this can obviously all go",
    "start": "1400480",
    "end": "1405840"
  },
  {
    "text": "out to canary tokens.org as well if you want to get this remotely so moving to another hotspot of",
    "start": "1405840",
    "end": "1412640"
  },
  {
    "text": "malicious activity um the registry so the registry in Windows is used for a host of attacker living off the land",
    "start": "1412640",
    "end": "1418960"
  },
  {
    "text": "reasons um you can either weaken the system so you can open up more ports you can disable firewall rules um or you can",
    "start": "1418960",
    "end": "1426640"
  },
  {
    "text": "just get persistence both on disk and off- disk and so this capability we built is a very simple PowerShell script",
    "start": "1426640",
    "end": "1432640"
  },
  {
    "text": "that runs periodically and looks for changes to the specific registry keys that attackers love to manipulate and so",
    "start": "1432640",
    "end": "1438559"
  },
  {
    "text": "we have about 80 keys that are used in this attacker living off the land if any of those start to change we let you know",
    "start": "1438559",
    "end": "1445440"
  },
  {
    "text": "and so you'll see here super simple if I change the startup folder just one that",
    "start": "1445440",
    "end": "1450559"
  },
  {
    "text": "you know maybe has some payload on there as soon as I save that within a few seconds you're going to get both an",
    "start": "1450559",
    "end": "1456799"
  },
  {
    "text": "email alert saying these keys have changed or you get the little pop-up toast saying \"Hey this key has changed",
    "start": "1456799",
    "end": "1462559"
  },
  {
    "text": "you should go check that out.\" Again very straightforward very simple but it",
    "start": "1462559",
    "end": "1467760"
  },
  {
    "text": "helps us catch people who are trying to live off the land uh next we have another very popular post exploitation",
    "start": "1467760",
    "end": "1474320"
  },
  {
    "text": "target the Windows service directory so if you look at malware campaign analyses",
    "start": "1474320",
    "end": "1479760"
  },
  {
    "text": "very commonly once they land on a system they disable either defensive software or if it's ransomware they disable",
    "start": "1479760",
    "end": "1485760"
  },
  {
    "text": "backup services and other types of things because if they are going to bring something you know a unique",
    "start": "1485760",
    "end": "1490880"
  },
  {
    "text": "payload or new capability they don't want to have to worry about defender or some of these other services and so uh",
    "start": "1490880",
    "end": "1497200"
  },
  {
    "text": "basically what we were able to do is building off some work from JF Lavar we can build in PowerShell a Windows",
    "start": "1497200",
    "end": "1503440"
  },
  {
    "text": "service that registers and it by default looks looks like malware bites anti-malware and if that service has",
    "start": "1503440",
    "end": "1508960"
  },
  {
    "text": "ever manually stopped or stopped from the command line it triggers an alert so very simple someone is in there trying",
    "start": "1508960",
    "end": "1514240"
  },
  {
    "text": "to make themselves comfortable in your environment and they stop it you get an alert so very simple to understand",
    "start": "1514240",
    "end": "1519520"
  },
  {
    "text": "you'll see here there's the malware bytes anti-malware system i click stop and then you'll notice that when I",
    "start": "1519520",
    "end": "1525919"
  },
  {
    "text": "refresh the Canary tokens you'll see that it has caught that and now they've",
    "start": "1525919",
    "end": "1532320"
  },
  {
    "text": "alerted us that they're on that system this is the service they've stopped so very",
    "start": "1532320",
    "end": "1538039"
  },
  {
    "text": "straightforward so the next two capabilities are for monitoring file access so we're gonna spend a little bit more time on the first one the subsystem",
    "start": "1538039",
    "end": "1545360"
  },
  {
    "text": "is more complicated and I think is underappreciated and then the second one is a different way to get to the same",
    "start": "1545360",
    "end": "1552039"
  },
  {
    "text": "thing so we really wanted to nail this capability where you can have a folder tree either on a server or on an",
    "start": "1552039",
    "end": "1558159"
  },
  {
    "text": "endpoint where you know not to go in there and and poke around but it might look really juicy um so if someone is on",
    "start": "1558159",
    "end": "1565279"
  },
  {
    "text": "that server and they go into any file and they open any file under that route you get an alert so we spent a lot of",
    "start": "1565279",
    "end": "1571679"
  },
  {
    "text": "time looking at the different kind of living off the land primitives for this uh projected file system is the one we",
    "start": "1571679",
    "end": "1576880"
  },
  {
    "text": "ended up chose on the top but we also looked at file system watchers um object",
    "start": "1576880",
    "end": "1581919"
  },
  {
    "text": "uh auditing and controlled folder access and for us projectfest despite being not very wellnown is a pretty powerful",
    "start": "1581919",
    "end": "1588559"
  },
  {
    "text": "primitive and so you can think of projects or projected file system as",
    "start": "1588559",
    "end": "1593760"
  },
  {
    "text": "essentially fuse for Windows so it's a user space API where you can project files essentially out of thin air um and",
    "start": "1593760",
    "end": "1601279"
  },
  {
    "text": "then Windows itself will handle the messy filter driver handling and so if",
    "start": "1601279",
    "end": "1606320"
  },
  {
    "text": "your code crashes you don't blue screen the box just those files from the root just kind of disappear until you reload",
    "start": "1606320",
    "end": "1613200"
  },
  {
    "text": "um what's really cool about this is that you can run it in C PowerShell even Python and so you can use it to create",
    "start": "1613200",
    "end": "1620000"
  },
  {
    "text": "you know essentially a mythical file system it's used by Microsoft to browse",
    "start": "1620000",
    "end": "1625039"
  },
  {
    "text": "git repositories so you can switch branches and then the files all change um and also they have a demo of",
    "start": "1625039",
    "end": "1630159"
  },
  {
    "text": "projecting the registry from regedit into explore so you can browse into your trees that way um it's been used in the",
    "start": "1630159",
    "end": "1637679"
  },
  {
    "text": "past by others to look at tarpets um so basically creating file systems that malware gets stuck into and we verified",
    "start": "1637679",
    "end": "1644640"
  },
  {
    "text": "that actually it's pretty fun um if you return a bite at a time of a file it really does slow down ransomware um or",
    "start": "1644640",
    "end": "1651760"
  },
  {
    "text": "if you say \"Oh I'm busy right now and here's the first of you know 3,000 files in this directory come back to me in a",
    "start": "1651760",
    "end": "1658080"
  },
  {
    "text": "few seconds.\" Uh it really does kind of muck up the works um and so it's pretty",
    "start": "1658080",
    "end": "1663360"
  },
  {
    "text": "complicated but we made it really straightforward you go to canary tokens.org you click it you give an",
    "start": "1663360",
    "end": "1668480"
  },
  {
    "text": "email address you kind of select what kind of files you want um you can choose from our chat GPT generated uh file",
    "start": "1668480",
    "end": "1675440"
  },
  {
    "text": "structures you know for your personal finance your home network whatnot it just generates a CSV you can edit that",
    "start": "1675440",
    "end": "1681120"
  },
  {
    "text": "yourself and then you run this and it'll be projected so now it looks like those files really exist and if you go in",
    "start": "1681120",
    "end": "1688159"
  },
  {
    "text": "regardless of how you go in there and try to look at them you get the alert saying \"Hey PowerShell just opened up",
    "start": "1688159",
    "end": "1693840"
  },
  {
    "text": "this file go check that out.\" And so this right here you'll notice is on",
    "start": "1693840",
    "end": "1699520"
  },
  {
    "text": "canary tokens.org but we went one step beyond this which something we thought maybe was a little bit more risky but",
    "start": "1699520",
    "end": "1705360"
  },
  {
    "text": "maybe more fun especially if you're doing it you know cognizant of that um and so this is on our our open source",
    "start": "1705360",
    "end": "1711640"
  },
  {
    "text": "repository there it automatically will also create a file share so it makes it look like you've been sharing your",
    "start": "1711640",
    "end": "1717360"
  },
  {
    "text": "personal documents open to everyone and so if you're at a co-working space or you're at a coffee shop you can see if",
    "start": "1717360",
    "end": "1723120"
  },
  {
    "text": "there are people perhaps a little bit more snoopy than they should be and so we wanted to make sure this",
    "start": "1723120",
    "end": "1728720"
  },
  {
    "text": "worked before we released it and so we did find actually it works really well with Windows search indexing and like defensive tools they kind of just run",
    "start": "1728720",
    "end": "1735520"
  },
  {
    "text": "through it and doesn't cause any problem we get the process um that's triggering the alert and so we can kind of ignore",
    "start": "1735520",
    "end": "1741840"
  },
  {
    "text": "certain processes or we can you know flag or behave differently depending so we can say ah that's not explorer let's",
    "start": "1741840",
    "end": "1748640"
  },
  {
    "text": "make a 3se secondond wait um and then we did run uh both a standin for ransomware",
    "start": "1748640",
    "end": "1753840"
  },
  {
    "text": "so f ransom and so that's how we evaluated this tarpit idea as well as snafler which is a red team tool that",
    "start": "1753840",
    "end": "1759679"
  },
  {
    "text": "looks for credentials passwords other kind of sensitive data on a system and helps attackers kind of coalate that to",
    "start": "1759679",
    "end": "1765279"
  },
  {
    "text": "then figure out where they're going to go Next so we think it's a very powerful",
    "start": "1765279",
    "end": "1770559"
  },
  {
    "text": "capability we're really excited about it but it is heavyweight in the sense that you are kind of deploying the script and",
    "start": "1770559",
    "end": "1776399"
  },
  {
    "text": "turning on this subsystem so it might be something a little bit more than what you'd want to deploy at scale and so for",
    "start": "1776399",
    "end": "1783039"
  },
  {
    "text": "that we built the network mount token so it's very similar capability but a heck of a lot simpler uh basically we host a",
    "start": "1783039",
    "end": "1790799"
  },
  {
    "text": "network drive um and we provide credentials unique credentials for that network drive again you can choose the",
    "start": "1790799",
    "end": "1797120"
  },
  {
    "text": "chat GPT generated file structure you want and then you mount that using webdav or you know to your network",
    "start": "1797120",
    "end": "1803120"
  },
  {
    "text": "drives and if an attacker lands on that system they're probably going to be curious to see what's in z corp um so we",
    "start": "1803120",
    "end": "1809520"
  },
  {
    "text": "wrote this all as a cloudflare worker so it's uh very scalable very fast and it runs globally um and again if any of the",
    "start": "1809520",
    "end": "1816000"
  },
  {
    "text": "contents of that file is ever accessed you get the alert and I know Marco did say that this was a Windows specific",
    "start": "1816000",
    "end": "1821919"
  },
  {
    "text": "talk but there is webdev connectors both on Mac OS and in Linux so this is a cool",
    "start": "1821919",
    "end": "1826960"
  },
  {
    "text": "crossplatform capability um it's very straightforward so on this computer right here there's a pretty juicy",
    "start": "1826960",
    "end": "1833520"
  },
  {
    "text": "looking network mount called Corp It and it's got some stuff in there that maybe an attacker might want to look and if",
    "start": "1833520",
    "end": "1838720"
  },
  {
    "text": "they open any of those files bam I get an alert",
    "start": "1838720",
    "end": "1843760"
  },
  {
    "text": "so now we're going to move from the local access and the local attacker techniques to ones that are going to",
    "start": "1843760",
    "end": "1848960"
  },
  {
    "text": "catch remote attackers and starting with remote desktop or RDP so Windows ships built in with Windows uh remote desktop",
    "start": "1848960",
    "end": "1856480"
  },
  {
    "text": "or RDP both as a client which is pretty commonly used on endpoints as well as a server um and it's very popular lateral",
    "start": "1856480",
    "end": "1863600"
  },
  {
    "text": "movement technique both for CISADs admins and thread actors right this is an easy way to get around in your",
    "start": "1863600",
    "end": "1868720"
  },
  {
    "text": "network and so we basically created a simple script that creates a token certificate using that AIA trick I",
    "start": "1868720",
    "end": "1875760"
  },
  {
    "text": "talked about before and it installs that as the server certificate on whichever",
    "start": "1875760",
    "end": "1881200"
  },
  {
    "text": "system you're tokening you can optionally then just deny all access to RDP session so even",
    "start": "1881200",
    "end": "1887520"
  },
  {
    "text": "if an admin or an attacker gets admin credentials you haven't weakened your system they'll go log in it'll trip the",
    "start": "1887520",
    "end": "1893840"
  },
  {
    "text": "token and it will say \"Sorry you're not permitted to access an RDP session.\" Um or you can leave it on if you actually",
    "start": "1893840",
    "end": "1899600"
  },
  {
    "text": "want to RDP in for some legitimate reason and when an attacker tries to RDP to that token system their client will",
    "start": "1899600",
    "end": "1905840"
  },
  {
    "text": "validate the TLSert because that's just what they do and then they trigger it from the attackers's machine so we get",
    "start": "1905840",
    "end": "1910960"
  },
  {
    "text": "the attacker IP we get the attacker information um from that side because they're the ones that reached out to canary tokens.org or looking for that",
    "start": "1910960",
    "end": "1917679"
  },
  {
    "text": "root certificate so here's a real quick demo on the left is the defended system on the right is the attacker one so I'm",
    "start": "1917679",
    "end": "1924240"
  },
  {
    "text": "logging in with valid credentials as Savvy Defender and you'll notice that",
    "start": "1924240",
    "end": "1930399"
  },
  {
    "text": "when I click okay it's going to pop up something and saying this is a suspicious certificate even if they say",
    "start": "1930399",
    "end": "1935840"
  },
  {
    "text": "no and they get wary it's already tried to validate at that point and it's already tripped our alert and so even if",
    "start": "1935840",
    "end": "1942240"
  },
  {
    "text": "the attacker starts thinking this is really weird and backs out it's too late even if an attacker is trying to be more",
    "start": "1942240",
    "end": "1948720"
  },
  {
    "text": "circumspect so they're trying to use like util or some of the tools built in that aren't necessarily you know using",
    "start": "1948720",
    "end": "1954480"
  },
  {
    "text": "RDP directly those use the crypto API and those trip the token too so we were",
    "start": "1954480",
    "end": "1959519"
  },
  {
    "text": "trying to find a clever way i mean maybe if you bring it off onto Linux or whatnot you might be able to analyze it but yeah pretty much touching that",
    "start": "1959519",
    "end": "1965840"
  },
  {
    "text": "certificate from Windows will cause a lookup and trip the alert another popular living off the land as an",
    "start": "1965840",
    "end": "1972320"
  },
  {
    "text": "attacker is uh WinRM or PS remoting PS exec um and these management tools",
    "start": "1972320",
    "end": "1978320"
  },
  {
    "text": "empower you to run your PowerShell or your commands kind of across a larger organization but it's also very common",
    "start": "1978320",
    "end": "1985120"
  },
  {
    "text": "for attackers to use to move laterally through a network and so this token script almost exactly the same it",
    "start": "1985120",
    "end": "1991519"
  },
  {
    "text": "generates one of those token TLSerts it sets it as the certificate that's offered for the WinRM HTTPS service and",
    "start": "1991519",
    "end": "1999120"
  },
  {
    "text": "then it opens it up but actually denies any actual commands to be executed so it does the TLS handshake the token",
    "start": "1999120",
    "end": "2005919"
  },
  {
    "text": "triggers and then it says sorry you don't have permission to do that even as a local admin or a global admin and so",
    "start": "2005919",
    "end": "2011760"
  },
  {
    "text": "just like in that RDP token left side is the defended system me trying to run a command on the right it says the",
    "start": "2011760",
    "end": "2018080"
  },
  {
    "text": "certificate is invalid but it doesn't actually run and immediately you'll see I've got the attacker's IP address and",
    "start": "2018080",
    "end": "2024559"
  },
  {
    "text": "see that they were coming in over WinRM so now I'm going to hand it back over to Marco to finish the last few",
    "start": "2024559",
    "end": "2032240"
  },
  {
    "text": "capabilities excellent so uh for this next one we're going to be talking about another way to detect lateral movement",
    "start": "2032240",
    "end": "2038480"
  },
  {
    "text": "and this time we're going to say run a local honeypot on every endpoint now I say that and you're going to be thinking",
    "start": "2038480",
    "end": "2044640"
  },
  {
    "text": "hey that's cheating because you told me I don't have to install any additional software how am I going to run an",
    "start": "2044640",
    "end": "2049919"
  },
  {
    "text": "additional honeypot and I am going to cheat a little bit here but I'm not going to say install software i'm going to say run a VM and I think I'm going to",
    "start": "2049919",
    "end": "2056240"
  },
  {
    "text": "argue there's a slight difference there um because here's the beautiful thing uh Windows 11 for certain versions comes",
    "start": "2056240",
    "end": "2062878"
  },
  {
    "text": "built in with HyperV by default and we can leverage this thing we can take this window we can take HyperV and run a VM",
    "start": "2062879",
    "end": "2069919"
  },
  {
    "text": "there which is not going to pose any risk now to the actual host itself uh",
    "start": "2069919",
    "end": "2075118"
  },
  {
    "text": "and so we give you a HyperV VM which is and inside it is open canary our open source honeypot we actually give you a",
    "start": "2075119",
    "end": "2082800"
  },
  {
    "text": "uh PowerShell script as well which is on the repo um which will manage this VM for you um it's going to set up the the",
    "start": "2082800",
    "end": "2089040"
  },
  {
    "text": "network uh rules which I'll talk about and it's going to manage the alerts as well now I'm calling back here to our",
    "start": "2089040",
    "end": "2094398"
  },
  {
    "text": "slide and living off the land with netsh and that's because like attackers can use it defenders can also use it to",
    "start": "2094399",
    "end": "2100079"
  },
  {
    "text": "redirect traffic we're going to be redirecting traffic that's coming into the Windows host pushing it forward to",
    "start": "2100079",
    "end": "2105200"
  },
  {
    "text": "the honeypot attackers think that they're trying to break into the Windows host but actually what they're hitting is the honeypot that is running under",
    "start": "2105200",
    "end": "2112320"
  },
  {
    "text": "HyperV we also had to build in birectional communication between the VM and the host uh so that we could show",
    "start": "2112320",
    "end": "2118000"
  },
  {
    "text": "the alerts and push uh the events into the Windows event log so this is what it looks like we've got a config file here",
    "start": "2118000",
    "end": "2124480"
  },
  {
    "text": "i'm just doing some open canary uh configuration if you can't see the file that's a bit of JSON it just says which services need to run we're then going to",
    "start": "2124480",
    "end": "2131119"
  },
  {
    "text": "tell the the host which ports to forward from the host into the VM um and so this is some basic setup we're then going to",
    "start": "2131119",
    "end": "2137680"
  },
  {
    "text": "run a PowerShell script here which is going to run the VM set up that network traffic forwarding and it's going to uh",
    "start": "2137680",
    "end": "2144480"
  },
  {
    "text": "also start listening for the alerts and at this point offscreen I'm trying to now as an attacker SSH into this Windows",
    "start": "2144480",
    "end": "2151119"
  },
  {
    "text": "host i'm just picking SSH as one of the services that traffic gets forwarded into the honeypot the honeypot sees it",
    "start": "2151119",
    "end": "2156880"
  },
  {
    "text": "but it sends the alert out to the Windows host the Windows host shows you the little uh toast there but of course",
    "start": "2156880",
    "end": "2162079"
  },
  {
    "text": "if you're not at your desktop at that time you might miss it and so it also gets pushed into the event log so you",
    "start": "2162079",
    "end": "2167520"
  },
  {
    "text": "can come back at a later time and find it in the event log um the next",
    "start": "2167520",
    "end": "2172720"
  },
  {
    "text": "technique that we're going to talk about is this idea that attackers one of the things that they do uh on a on an estate",
    "start": "2172720",
    "end": "2178240"
  },
  {
    "text": "is they're going to be looking for credentials that they can find around the network and the question becomes well how can we detect that sort of",
    "start": "2178240",
    "end": "2183520"
  },
  {
    "text": "activity and we give you this AD login uh token and the idea is quite straightforward again lots of these",
    "start": "2183520",
    "end": "2188880"
  },
  {
    "text": "techniques are CIS admin techniques on every endpoint drop a text file with a unique username in that text file so one",
    "start": "2188880",
    "end": "2194880"
  },
  {
    "text": "unique username per endpoint and then basically we give you another living off the land technique that schedule task",
    "start": "2194880",
    "end": "2201359"
  },
  {
    "text": "let's have a schedule task just comb through our event logs looking for these names it's a straightforward technique",
    "start": "2201359",
    "end": "2207839"
  },
  {
    "text": "but it's the sort of thing that you can get to with a bit of scripting and no additional uh software installation",
    "start": "2207839",
    "end": "2213760"
  },
  {
    "text": "and so in this case that one and we've given you a PowerShell script which will set up the schedule task for you it's also tied into Canary token so you can",
    "start": "2213760",
    "end": "2220640"
  },
  {
    "text": "get an email or a web hook uh we handle the alerting for you the last one that I want to talk about is this threat actor",
    "start": "2220640",
    "end": "2228160"
  },
  {
    "text": "uh compromise or detection rather up in the cloud so not local or remote but up in the cloud and for this one it's a",
    "start": "2228160",
    "end": "2234480"
  },
  {
    "text": "departure from the previous ones because instead of trying to detect the compromise of a machine or an asset",
    "start": "2234480",
    "end": "2239599"
  },
  {
    "text": "we're trying to detect here the compromise of an identity you know they say identity is the new X um and in this",
    "start": "2239599",
    "end": "2245440"
  },
  {
    "text": "case it could be via credential theft cookie theft it doesn't matter you have an octa you have an entra ID attackers",
    "start": "2245440",
    "end": "2251839"
  },
  {
    "text": "love to breach those systems because obviously they get access to whatever those users have access to and so as",
    "start": "2251839",
    "end": "2258720"
  },
  {
    "text": "network protectors we want to know when those systems have been compromised this token gives you that ability and the way",
    "start": "2258720",
    "end": "2264720"
  },
  {
    "text": "that we're going to do it is we're going to give you the ability to deploy a fake app panel on your uh cloud SSO provider",
    "start": "2264720",
    "end": "2273040"
  },
  {
    "text": "and in order to do that we're going to be talking SAML saml if you know a little bit about SAML they're going to",
    "start": "2273040",
    "end": "2278480"
  },
  {
    "text": "be the IDP we have to imple implement the reliant party aspect of SAML canary tokens.org uh today is a SAML reliant",
    "start": "2278480",
    "end": "2286800"
  },
  {
    "text": "party so you can go to tokens.org select which fake app you want to deploy into your SSO we're going to give you the",
    "start": "2286800",
    "end": "2292800"
  },
  {
    "text": "sample uh the the entity ids and the URLs and that sort of stuff you set it",
    "start": "2292800",
    "end": "2298079"
  },
  {
    "text": "up in your octa or enter ID or one login whatever your provider is um and so when",
    "start": "2298079",
    "end": "2303119"
  },
  {
    "text": "an attacker actually breaches the system what they see is something like that one of those is a fake app right the",
    "start": "2303119",
    "end": "2309680"
  },
  {
    "text": "attacker doesn't know which one they breach they're going to be clicking through those to just see what sort of access they have they have they're going",
    "start": "2309680",
    "end": "2315599"
  },
  {
    "text": "to hit that SAP panel that's going to call through to canary tokens.org you're going to get an alert",
    "start": "2315599",
    "end": "2322079"
  },
  {
    "text": "so that takes us to the end of these techniques that we've shown we've covered them in terms of what sort of",
    "start": "2322079",
    "end": "2327359"
  },
  {
    "text": "attackers that they can uncover but it's also possible to view them in terms of their intrusiveness to deploy we kind of",
    "start": "2327359",
    "end": "2333839"
  },
  {
    "text": "give you a qualitative scale there from the most easy to deploy to the ones that require the most uh uh intrusiveness",
    "start": "2333839",
    "end": "2340480"
  },
  {
    "text": "like deploying a VM but the point is you've got a wide range of options here depending on your appetite we want to",
    "start": "2340480",
    "end": "2346400"
  },
  {
    "text": "touch a little bit on the sort of directions that didn't pan out for us and so we explored the Windows Sandbox",
    "start": "2346400",
    "end": "2351680"
  },
  {
    "text": "but in the end we didn't find uh it was going to work the startup times were too high we also dived into Windows DP API",
    "start": "2351680",
    "end": "2358800"
  },
  {
    "text": "um but we in the end we felt it wasn't up to the task of being a canary token as we envision them and of course",
    "start": "2358800",
    "end": "2364800"
  },
  {
    "text": "there's always going to be some caveats to this kind of work uh PowerShell we rely heavily on it if it's restricted or",
    "start": "2364800",
    "end": "2370640"
  },
  {
    "text": "heavily restricted um it's not going to be as useful here um we do uh note that",
    "start": "2370640",
    "end": "2375839"
  },
  {
    "text": "some of these audit log events that we enable can affect log retention um and",
    "start": "2375839",
    "end": "2380960"
  },
  {
    "text": "the one that's I guess most notable here is we do rely on system behaviors that",
    "start": "2380960",
    "end": "2386079"
  },
  {
    "text": "sometimes can change under your feet so like Jacob uh found that Adobe changed",
    "start": "2386079",
    "end": "2391440"
  },
  {
    "text": "their their reading of that AIA field in certificates and so if they change that",
    "start": "2391440",
    "end": "2396720"
  },
  {
    "text": "under your feet then that technique obviously falls away these are techniques to to use we also found desktop.ini I got uh the way that",
    "start": "2396720",
    "end": "2404720"
  },
  {
    "text": "Windows in uh basically handled that file changed uh in the last several years which affected some of our tokens",
    "start": "2404720",
    "end": "2411839"
  },
  {
    "text": "and most of these capabilities do have some fingerprints that attackers can use can look for we don't deny it but our",
    "start": "2411839",
    "end": "2417520"
  },
  {
    "text": "point there is that they're not looking for that stuff and if you can get attackers to the point where they actually are scared and worried and are",
    "start": "2417520",
    "end": "2424240"
  },
  {
    "text": "looking for things you're already slowing them down you've already uh impacted them there so future directions",
    "start": "2424240",
    "end": "2430880"
  },
  {
    "text": "here we think that there are more primitives to be explored we haven't touched any of that stuff on the right and well we've touched some of those",
    "start": "2430880",
    "end": "2436960"
  },
  {
    "text": "things on the right but there's a bunch of things we haven't yet looked at there's lots of options there so to wrap",
    "start": "2436960",
    "end": "2442480"
  },
  {
    "text": "up our talk these are the takeaways we introduced this idea of defending off the land as uh a concept this",
    "start": "2442480",
    "end": "2448160"
  },
  {
    "text": "repurposing of the built-in OS functionality um we've showed you 11 plus one techniques a few you might have",
    "start": "2448160",
    "end": "2454160"
  },
  {
    "text": "seen before but there should be several novel ones in there four of them are immediately available on tokens.org",
    "start": "2454160",
    "end": "2459359"
  },
  {
    "text": "seven of them are up on our GitHub and that stuff's all live uh right now and uh lastly defending of the land it's an",
    "start": "2459359",
    "end": "2465839"
  },
  {
    "text": "inherently active defense it takes empowered and motivated CIS admins celebrate them let them do their thing",
    "start": "2465839",
    "end": "2472560"
  },
  {
    "text": "thank you very",
    "start": "2472560",
    "end": "2475119"
  },
  {
    "text": "much we're not going to have time for questions but of course we're here and we'll be in the hallway thank you",
    "start": "2480119",
    "end": "2487960"
  }
]