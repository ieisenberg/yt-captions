[
  {
    "text": "foreign",
    "start": "1979",
    "end": "4159"
  },
  {
    "text": "and today I'm going to show you how I managed to turn edrs into malicious wipers using zero day vulnerabilities",
    "start": "14280",
    "end": "22140"
  },
  {
    "text": "I named This research Aikido and I'll soon explain exactly why",
    "start": "22140",
    "end": "28380"
  },
  {
    "text": "so as I mentioned this is me I'm a security researcher in safe bridge I'm",
    "start": "28380",
    "end": "34260"
  },
  {
    "text": "23 years old and I've been in the cyber security industry for around five years now",
    "start": "34260",
    "end": "40020"
  },
  {
    "text": "I've started my way in the IDF I've done a lot of Linux and embedded research",
    "start": "40020",
    "end": "45960"
  },
  {
    "text": "along with some Android research as well and for the last two years I've been experiencing a lot of Windows internal",
    "start": "45960",
    "end": "52920"
  },
  {
    "text": "internals research in saybridge and I really really enjoy it so far but what are we going to talk about",
    "start": "52920",
    "end": "59100"
  },
  {
    "text": "today so I I will start with presenting you my",
    "start": "59100",
    "end": "64140"
  },
  {
    "text": "initial thought when I started this research my initial research goal then we'll talk a bit about wipers in",
    "start": "64140",
    "end": "71220"
  },
  {
    "text": "general we'll see what they are how do they work and what they're used for",
    "start": "71220",
    "end": "76380"
  },
  {
    "text": "then we'll Deep dive into the technical aspects of the research process itself",
    "start": "76380",
    "end": "81600"
  },
  {
    "text": "and see how I managed to find zero day vulnerabilities that allowed me",
    "start": "81600",
    "end": "86640"
  },
  {
    "text": "to create the Next Generation Aikido wiper so as I just mentioned my initial",
    "start": "86640",
    "end": "94020"
  },
  {
    "text": "research goal was to create some sort of a Next Generation wiper",
    "start": "94020",
    "end": "99420"
  },
  {
    "text": "but in order to do that I first needed to understand exactly how wipers work nowadays",
    "start": "99420",
    "end": "107520"
  },
  {
    "text": "so let's talk a bit about wipers in general and the first need the first thing that",
    "start": "107520",
    "end": "113579"
  },
  {
    "text": "I did of course when I started this is that I went to Wikipedia to see what's the actual definition of a wiper and",
    "start": "113579",
    "end": "121560"
  },
  {
    "text": "when I looked up in Wikipedia I saw that according to Wikipedia a wiper is a",
    "start": "121560",
    "end": "126659"
  },
  {
    "text": "device used to remove rains no ice worship fluid water or the breeze from a vehicle's front window but that is not",
    "start": "126659",
    "end": "134280"
  },
  {
    "text": "the wiper that we're going to talk about today um and we're going to talk about the",
    "start": "134280",
    "end": "139379"
  },
  {
    "text": "wiper malware and according to Wikipedia again in computer security a wiper is a",
    "start": "139379",
    "end": "144480"
  },
  {
    "text": "class of malware intended to erase the hard drive of the computer it infects maliciously",
    "start": "144480",
    "end": "150239"
  },
  {
    "text": "deleting data and programs now I'm sure that's no surprise to any of you if you came here but I just wanted to make this",
    "start": "150239",
    "end": "156780"
  },
  {
    "text": "clear um but what are wipers why are wipers",
    "start": "156780",
    "end": "162000"
  },
  {
    "text": "even used so there are mainly used for some kind of offensive acts",
    "start": "162000",
    "end": "169140"
  },
  {
    "text": "um so let's say a war and a very good example for a war that we currently see is the war between Russia and Ukraine",
    "start": "169140",
    "end": "177840"
  },
  {
    "text": "um so in detachments I added here we can see that both Russia and Ukraine were",
    "start": "177840",
    "end": "183599"
  },
  {
    "text": "attacked by wipers recently and we can also see that both Iran and Israel were attacked by wipers and so basically",
    "start": "183599",
    "end": "190500"
  },
  {
    "text": "everything that we hear on the news between um about rivalry between countries is",
    "start": "190500",
    "end": "196080"
  },
  {
    "text": "also expressed in the cyber warfare but let's start talking about the",
    "start": "196080",
    "end": "201360"
  },
  {
    "text": "technical aspects of how wipers nowaday works so I know that many of you probably want",
    "start": "201360",
    "end": "208620"
  },
  {
    "text": "you hear the word wiper you also think about the word deletion",
    "start": "208620",
    "end": "213959"
  },
  {
    "text": "but there is actually a crucial difference between the two",
    "start": "213959",
    "end": "219060"
  },
  {
    "text": "um so let's take a look at the default deletion process in Windows to understand that let's say that the certain process calls",
    "start": "219060",
    "end": "225840"
  },
  {
    "text": "the delete file API function for a certain file then this function",
    "start": "225840",
    "end": "230879"
  },
  {
    "text": "asks the kernel to delete that file and then the kernel goes to a certain place that is called the mft which stands for",
    "start": "230879",
    "end": "237959"
  },
  {
    "text": "the master file table in the NTFS file system and there the kernel just marks a",
    "start": "237959",
    "end": "244980"
  },
  {
    "text": "certain entry as free now this entry is just a pointer to do to the actual file",
    "start": "244980",
    "end": "250980"
  },
  {
    "text": "content and so the actual file content is not really being erased so that is",
    "start": "250980",
    "end": "257400"
  },
  {
    "text": "the difference between a wipe and a deletion when we wipe something it means that we also really make it not",
    "start": "257400",
    "end": "265440"
  },
  {
    "text": "restorable and we actually erase the file content",
    "start": "265440",
    "end": "270919"
  },
  {
    "text": "now a deletion can be escalated to a wipe",
    "start": "271500",
    "end": "277620"
  },
  {
    "text": "and that is because once um mft entries are marked as free then they may be",
    "start": "277620",
    "end": "284460"
  },
  {
    "text": "reused again so when we create a new file it can potentially receive the free MFD entry",
    "start": "284460",
    "end": "292380"
  },
  {
    "text": "and then we when we write that file then the new content that we write",
    "start": "292380",
    "end": "298460"
  },
  {
    "text": "overrides basically the content which was left on the disk after the file was deleted",
    "start": "298460",
    "end": "305419"
  },
  {
    "text": "but when I try to understand how do wipers nowadays overcome this gap",
    "start": "305759",
    "end": "311520"
  },
  {
    "text": "between deletion and wipe I saw that most that a lot of them do",
    "start": "311520",
    "end": "317160"
  },
  {
    "text": "not actually delete files instead they just go ahead and straight",
    "start": "317160",
    "end": "323699"
  },
  {
    "text": "um override the files that they want to wipe by that they make sure that the",
    "start": "323699",
    "end": "328860"
  },
  {
    "text": "actual file content is being erased and and replace and by that white and",
    "start": "328860",
    "end": "335520"
  },
  {
    "text": "unrestorable and we can see that really we um we know a lot of wipers a lot of",
    "start": "335520",
    "end": "343020"
  },
  {
    "text": "famous wipers some from the very recent years that are using this technique",
    "start": "343020",
    "end": "349919"
  },
  {
    "text": "um and so that's something that now exists out there in the wild and of course this technique requires",
    "start": "349919",
    "end": "357360"
  },
  {
    "text": "admin privileges because when a wiper runs it probably wants to wipe some",
    "start": "357360",
    "end": "363060"
  },
  {
    "text": "files that an unprivileged user cannot access such as file in the default",
    "start": "363060",
    "end": "369900"
  },
  {
    "text": "libraries of the administrator or system files and so on",
    "start": "369900",
    "end": "375840"
  },
  {
    "text": "another technique that we see in the wild in a lot of wipers is the drive",
    "start": "375840",
    "end": "381240"
  },
  {
    "text": "destruction technique this technique basically means that the wiper writes to the physical hard drive",
    "start": "381240",
    "end": "390660"
  },
  {
    "text": "um and by that it can override the MBR it can override",
    "start": "390660",
    "end": "396840"
  },
  {
    "text": "structures that belong to the NTFS file system or file contents and we can also see again that a lot of",
    "start": "396840",
    "end": "403979"
  },
  {
    "text": "famous wipers are using this technique and again wipers from the very recent",
    "start": "403979",
    "end": "409500"
  },
  {
    "text": "years and this um and this technique also of course requires admin privileges",
    "start": "409500",
    "end": "416160"
  },
  {
    "text": "because no unprivileged user should be able to ruin the disk in such a way",
    "start": "416160",
    "end": "423860"
  },
  {
    "text": "but I do want you to um to notice something something important that I",
    "start": "423960",
    "end": "429960"
  },
  {
    "text": "noticed after I got to know these techniques or any other technique that",
    "start": "429960",
    "end": "436139"
  },
  {
    "text": "the wiper uses and that is that each of these techniques are obviously initiated by",
    "start": "436139",
    "end": "443580"
  },
  {
    "text": "the process of the wiper itself so that means that if for example we have a certain wiper that uses the file",
    "start": "443580",
    "end": "450360"
  },
  {
    "text": "override technique then we can just open up proc1 and we'll see that there is a",
    "start": "450360",
    "end": "455699"
  },
  {
    "text": "process that opens and writes to a lot of files now this",
    "start": "455699",
    "end": "462180"
  },
  {
    "text": "um got me thinking and I thought to myself what if just what if",
    "start": "462180",
    "end": "468720"
  },
  {
    "text": "I could create some sort of a Next Generation wiper that would be able to",
    "start": "468720",
    "end": "475800"
  },
  {
    "text": "wipe all of these files without calling these obvious API calls",
    "start": "475800",
    "end": "481440"
  },
  {
    "text": "and what if this very same wiper would also be able to do all that as a",
    "start": "481440",
    "end": "487860"
  },
  {
    "text": "non-privileged user um this got me thinking about Aikido",
    "start": "487860",
    "end": "496080"
  },
  {
    "text": "Aikido is a martial art that specializes in using the power of the opponents",
    "start": "496080",
    "end": "501599"
  },
  {
    "text": "against them but why is that even relevant for this stock it's relevant because edrs have a",
    "start": "501599",
    "end": "508919"
  },
  {
    "text": "very special superpower and this superpower is the ability to delete any file on the system no matter the",
    "start": "508919",
    "end": "515940"
  },
  {
    "text": "Privileges required to delete that file and edrs must have this ability because",
    "start": "515940",
    "end": "522000"
  },
  {
    "text": "potentially any file on the system can be malicious but before we understand how exactly",
    "start": "522000",
    "end": "529500"
  },
  {
    "text": "we're going to aikido idios and antiviruses into deleting Target files",
    "start": "529500",
    "end": "535200"
  },
  {
    "text": "for an unprivileged user we first must understand when do edrs even choose to",
    "start": "535200",
    "end": "542160"
  },
  {
    "text": "delete or quarantine a certain file so on on most edrs that I researched I",
    "start": "542160",
    "end": "548940"
  },
  {
    "text": "saw that of course it depends on the configuration but the most default configuration that I saw",
    "start": "548940",
    "end": "555240"
  },
  {
    "text": "was that edors choose to delete surely malicious files that they detect",
    "start": "555240",
    "end": "561300"
  },
  {
    "text": "automatically so some edrs detect these files when they",
    "start": "561300",
    "end": "567420"
  },
  {
    "text": "are open sometimes sometimes some idiots detect on these files when they are",
    "start": "567420",
    "end": "573600"
  },
  {
    "text": "closed after they were reading to and mostly most cdrs suggest an option for a",
    "start": "573600",
    "end": "579060"
  },
  {
    "text": "scan whether it's a custom scan or just a general system scan",
    "start": "579060",
    "end": "585140"
  },
  {
    "text": "so with that said we can start thinking about how we're going to aikido ddrs to",
    "start": "585779",
    "end": "593160"
  },
  {
    "text": "delete our own Target files and a very crucial thing to understand at that",
    "start": "593160",
    "end": "598260"
  },
  {
    "text": "point is that even as an unprivileged user we still have a certain amount of",
    "start": "598260",
    "end": "603779"
  },
  {
    "text": "control over the EDR and that is because as an unprivileged user we are able to",
    "start": "603779",
    "end": "610260"
  },
  {
    "text": "create a malicious file and so we are triggering the EDR to delete that file and all that we are left with at this",
    "start": "610260",
    "end": "616680"
  },
  {
    "text": "point is that we somehow still need to trigger the deletion for the wrong file so of course the first idea that popped",
    "start": "616680",
    "end": "623640"
  },
  {
    "text": "up in my head was that I should just maybe write some malicious content to an",
    "start": "623640",
    "end": "629399"
  },
  {
    "text": "innocent file and then wait for the EDR to delete it but of course this is very problematic because a lot of files that",
    "start": "629399",
    "end": "635760"
  },
  {
    "text": "I will want to delete require privileges that as an unprivileged user I don't",
    "start": "635760",
    "end": "641279"
  },
  {
    "text": "have and using this idea also um it seems very similar to the file",
    "start": "641279",
    "end": "649980"
  },
  {
    "text": "override technique if we look at the API calls so I needed to think of another idea and the second idea was",
    "start": "649980",
    "end": "657720"
  },
  {
    "text": "um that I should probably just somehow Point DDR towards a different path to",
    "start": "657720",
    "end": "662820"
  },
  {
    "text": "delete while it still thinks that it deletes the original path these vulnerabilities are usually achieved",
    "start": "662820",
    "end": "669120"
  },
  {
    "text": "using links and in the service security industry we are familiar with a lot of Link",
    "start": "669120",
    "end": "675600"
  },
  {
    "text": "vulnerabilities that is not something new and this category is called cwe 59",
    "start": "675600",
    "end": "682339"
  },
  {
    "text": "and we know so much vulnerabilities of that type that Microsoft has realized",
    "start": "682339",
    "end": "688800"
  },
  {
    "text": "that they of course need to have a special user right for creating a symbolic link and that",
    "start": "688800",
    "end": "695760"
  },
  {
    "text": "userite is called the create symbolic links user right and the only users that get this",
    "start": "695760",
    "end": "702779"
  },
  {
    "text": "permission by default are administrators but what was surprising for me is that",
    "start": "702779",
    "end": "710459"
  },
  {
    "text": "if we'll think about the difference between a junction point which is another type of link that we can create",
    "start": "710459",
    "end": "717540"
  },
  {
    "text": "on the NTFS file system then there is actually no difference at all in a high level perspective between",
    "start": "717540",
    "end": "725100"
  },
  {
    "text": "a junction point and a local directory signaling so I realized that if I want to do",
    "start": "725100",
    "end": "731160"
  },
  {
    "text": "something as an unprivileged user I should probably use Junctions",
    "start": "731160",
    "end": "736680"
  },
  {
    "text": "but even knowing that I'm going to use Junction ice Junctions I still needed to understand when exactly is my window of",
    "start": "736680",
    "end": "744540"
  },
  {
    "text": "opportunity to use them and exactly how am I going to use them and",
    "start": "744540",
    "end": "750360"
  },
  {
    "text": "two very uh important events to understand in the process of malicious",
    "start": "750360",
    "end": "755640"
  },
  {
    "text": "file deletion by the edrs are the time in which the file is being",
    "start": "755640",
    "end": "760740"
  },
  {
    "text": "detected as malicious and the file in which the fa in and the time in which the file is really being deleted",
    "start": "760740",
    "end": "768839"
  },
  {
    "text": "so if maybe I will be able to to do something with the junction between",
    "start": "768839",
    "end": "775019"
  },
  {
    "text": "these two events I will maybe be able to point the EDR or the antivirus towards a",
    "start": "775019",
    "end": "781500"
  },
  {
    "text": "different path this kind of vulnerabilities are usually called talk to vulnerabilities which",
    "start": "781500",
    "end": "787200"
  },
  {
    "text": "stands for time of check and time of use or in this case something more suitable would be time of check and time of",
    "start": "787200",
    "end": "793260"
  },
  {
    "text": "deletion and here in this example we can understand",
    "start": "793260",
    "end": "798720"
  },
  {
    "text": "how we can potentially point a privileged program using a junction",
    "start": "798720",
    "end": "804060"
  },
  {
    "text": "Point towards a different path to the lead so let's say that we're running as an",
    "start": "804060",
    "end": "810660"
  },
  {
    "text": "unprivileged user and we want to delete the andis.sys file",
    "start": "810660",
    "end": "816899"
  },
  {
    "text": "this file is a driver in the operating system and it's contained inside C",
    "start": "816899",
    "end": "822420"
  },
  {
    "text": "Windows system 32 drivers so if we can create a specially crafted",
    "start": "822420",
    "end": "829680"
  },
  {
    "text": "path which is very very similar to the path that we want to delete just with one main difference that is that",
    "start": "829680",
    "end": "837720"
  },
  {
    "text": "um that temp directory that you see there and we created it as an unprivileged user so it's under our",
    "start": "837720",
    "end": "844500"
  },
  {
    "text": "control and we just created an end this file in the deepest folder which is",
    "start": "844500",
    "end": "849720"
  },
  {
    "text": "drivers so if we can potentially cause a privileged program in our case it's the",
    "start": "849720",
    "end": "855420"
  },
  {
    "text": "EDR or the antivirus to try and delete this path but then just right before the deletion",
    "start": "855420",
    "end": "863579"
  },
  {
    "text": "we can delete everything from the temp directory make it to be a junction towards the C drive then the same path",
    "start": "863579",
    "end": "870899"
  },
  {
    "text": "that the EDR is trying to delete actually leads to the original and the status file",
    "start": "870899",
    "end": "876899"
  },
  {
    "text": "so that is exactly what I try to do I knew that mini cats is a file that the",
    "start": "876899",
    "end": "882600"
  },
  {
    "text": "EDR wants to delete and so I created mini cats in the path",
    "start": "882600",
    "end": "888620"
  },
  {
    "text": "c-temp Windows system 32 drivers and distances then right after the creation I um I",
    "start": "888620",
    "end": "896820"
  },
  {
    "text": "deleted the file with the temp directory created The Junction instead and waited for the EDR to delete my target file but",
    "start": "896820",
    "end": "903600"
  },
  {
    "text": "that did not work and I had a few failed attempts with this um with this method",
    "start": "903600",
    "end": "908699"
  },
  {
    "text": "and the two primary behaviors that I saw were that some edrs just had a very good",
    "start": "908699",
    "end": "915180"
  },
  {
    "text": "grip on the file once I created it and I was not able to delete the file and so I",
    "start": "915180",
    "end": "921420"
  },
  {
    "text": "all I was also not able to delete the temp directory and make it to be a junction",
    "start": "921420",
    "end": "926880"
  },
  {
    "text": "and the other behavior that I saw was that some ideas just gave up on the",
    "start": "926880",
    "end": "932459"
  },
  {
    "text": "deletion once I deleted the malicious file because they understood that there is no longer a threat",
    "start": "932459",
    "end": "938699"
  },
  {
    "text": "so at that point I understood that it's probably somehow need to change a bit my window of opportunity or expend it",
    "start": "938699",
    "end": "945180"
  },
  {
    "text": "somehow and what I thought about was that I maybe should force the edrs and and the",
    "start": "945180",
    "end": "951240"
  },
  {
    "text": "antiviruses to be forced to be to do a reboot",
    "start": "951240",
    "end": "958199"
  },
  {
    "text": "now as you probably know when we create or open a file on Windows we need to",
    "start": "958199",
    "end": "964079"
  },
  {
    "text": "give to give the file sharing mode so all I did was just to create the",
    "start": "964079",
    "end": "970320"
  },
  {
    "text": "miniket file without the file sharing mode Flags while still keeping the file",
    "start": "970320",
    "end": "976620"
  },
  {
    "text": "open and then the EDR started to pop up messages that tell me that that I need",
    "start": "976620",
    "end": "983820"
  },
  {
    "text": "to reboot my computer in order to fully remediate the thread so let's see how they do that",
    "start": "983820",
    "end": "991680"
  },
  {
    "text": "some edrs use the default Windows API for postponing a deletion",
    "start": "991680",
    "end": "997980"
  },
  {
    "text": "some other and a good example for a meteor that does it is Sentinel one and",
    "start": "997980",
    "end": "1003440"
  },
  {
    "text": "some other edrs just implement this feature by their own so that means that they keep a list of the paths to delete",
    "start": "1003440",
    "end": "1011540"
  },
  {
    "text": "after the reboot somewhere and then after the reboot they just delete these files",
    "start": "1011540",
    "end": "1016880"
  },
  {
    "text": "but if we'll um talk about the windows API for",
    "start": "1016880",
    "end": "1023180"
  },
  {
    "text": "um do for postponing deletion of a file to after the next reboot",
    "start": "1023180",
    "end": "1028520"
  },
  {
    "text": "which is done via calling the move file ex function with the flag move file the",
    "start": "1028520",
    "end": "1035360"
  },
  {
    "text": "land till reboot and by the way this flag requires administrator privileges",
    "start": "1035360",
    "end": "1041660"
  },
  {
    "text": "it will it requires these privileges because when you call this function with",
    "start": "1041660",
    "end": "1046760"
  },
  {
    "text": "this flag then this function goes to a certain registry value that is called the pending file random operations",
    "start": "1046760",
    "end": "1054980"
  },
  {
    "text": "in this value it just adds a certain path to delete after the reboot and then",
    "start": "1054980",
    "end": "1061039"
  },
  {
    "text": "Windows automatically when it boots after the reboot it deletes all the paths that are contained inside of this",
    "start": "1061039",
    "end": "1067640"
  },
  {
    "text": "registry value but the most surprising thing that I saw in this feature when I try to combine it",
    "start": "1067640",
    "end": "1074600"
  },
  {
    "text": "with the previous method that we talked about is this is that pending far random",
    "start": "1074600",
    "end": "1080299"
  },
  {
    "text": "operations blindly follows Junctions and so do other self-implementations of",
    "start": "1080299",
    "end": "1087740"
  },
  {
    "text": "edrs and antiviruses so overall this has led me to create one complete process",
    "start": "1087740",
    "end": "1094160"
  },
  {
    "text": "that I could delete almost any file that I want on the system",
    "start": "1094160",
    "end": "1099559"
  },
  {
    "text": "um and this process was um was created after I combined the um",
    "start": "1099559",
    "end": "1105500"
  },
  {
    "text": "the method that I talked about earlier with creating the junction between these two events",
    "start": "1105500",
    "end": "1111140"
  },
  {
    "text": "and forcing a reboot so overall if we'll take a look at the previous example with",
    "start": "1111140",
    "end": "1116660"
  },
  {
    "text": "the ndis.sys file in order to achieve a deletion of the original and this.sys",
    "start": "1116660",
    "end": "1122059"
  },
  {
    "text": "file what we need to do is to create the path c-temp Windows system 32 drivers",
    "start": "1122059",
    "end": "1128960"
  },
  {
    "text": "and distances then hold the handle to the end this.sys file that we that we created and force the EDR to postpone",
    "start": "1128960",
    "end": "1136460"
  },
  {
    "text": "the deletion to after the next reboot then when the EDR gave up we can delete",
    "start": "1136460",
    "end": "1142520"
  },
  {
    "text": "on the ctemp directory with the mimicus file inside and instead create the",
    "start": "1142520",
    "end": "1148700"
  },
  {
    "text": "junction towards the C drive reboot the computer and the end this.s file will be gone",
    "start": "1148700",
    "end": "1154940"
  },
  {
    "text": "by that we've achieved our two what-ifs in the beginning and any edge cases that",
    "start": "1154940",
    "end": "1160760"
  },
  {
    "text": "you come up with um and after noticing that will be answered in the rest of the talk",
    "start": "1160760",
    "end": "1168140"
  },
  {
    "text": "so overall this has led me to find four different zero days",
    "start": "1168140",
    "end": "1173480"
  },
  {
    "text": "and six different vulnerable products the products are Microsoft Defender",
    "start": "1173480",
    "end": "1178640"
  },
  {
    "text": "Defender for endpoint sentinel1 EDR Trend Mark Trend Micro Optics one avast",
    "start": "1178640",
    "end": "1184880"
  },
  {
    "text": "antivirus and AVG Antivirus now if we'll take a look at Gardner's",
    "start": "1184880",
    "end": "1190039"
  },
  {
    "text": "graph on the right for the endpoint protector protection Platforms in 2021",
    "start": "1190039",
    "end": "1195080"
  },
  {
    "text": "we'll see that actually three out of the five vendors that I just listed are are",
    "start": "1195080",
    "end": "1200480"
  },
  {
    "text": "high up in the leader Square so that's also huge",
    "start": "1200480",
    "end": "1205760"
  },
  {
    "text": "and these are the cve so um so far I got",
    "start": "1205760",
    "end": "1211820"
  },
  {
    "text": "um three cves 46 vulnerable products Microsoft said that the um Defender",
    "start": "1211820",
    "end": "1217940"
  },
  {
    "text": "products are using the same engine so it's the same code which is vulnerable that is true for avas and AVG as well",
    "start": "1217940",
    "end": "1226660"
  },
  {
    "text": "they have a mutual vendor which which is Gen and",
    "start": "1226660",
    "end": "1232400"
  },
  {
    "text": "um Sentinel one did um send me um a fixed version to test but I was",
    "start": "1232400",
    "end": "1237860"
  },
  {
    "text": "currently unable to get a response for them from them about the cve number or the fixed version",
    "start": "1237860",
    "end": "1245200"
  },
  {
    "text": "and I do need to give a little disclaimer about the Windows Defender vulnerabilities and that is that",
    "start": "1245419",
    "end": "1253039"
  },
  {
    "text": "um I was not able to do arbitrary file deletion against Windows Defender or Defender for endpoint but I was able",
    "start": "1253039",
    "end": "1261320"
  },
  {
    "text": "to achieve arbitrary directory deletion and as we know a wiper does not really care about deleting a few extra files on",
    "start": "1261320",
    "end": "1268880"
  },
  {
    "text": "the way so that was not a major issue for my wiper and now to the first ever demo presented",
    "start": "1268880",
    "end": "1276380"
  },
  {
    "text": "in public with this vulnerability against the Windows Defender antivirus this demo includes an attempt",
    "start": "1276380",
    "end": "1284900"
  },
  {
    "text": "of deletion of all the drivers from the drivers directory running as an",
    "start": "1284900",
    "end": "1290059"
  },
  {
    "text": "unprivileged user we will not see the wiper running yet but we will have another demo with the demonstrate with",
    "start": "1290059",
    "end": "1296299"
  },
  {
    "text": "the demonstration of the wiper itself so let's take a look",
    "start": "1296299",
    "end": "1301580"
  },
  {
    "text": "so here we can see all the drivers in the driver's directory they just exist there",
    "start": "1301580",
    "end": "1309440"
  },
  {
    "text": "now we can see there I'm running as a user called Limited",
    "start": "1309440",
    "end": "1314960"
  },
  {
    "text": "and limited belongs to the regular unprivileged users group",
    "start": "1314960",
    "end": "1320900"
  },
  {
    "text": "now we create we are creating this specially crafted path temp window system 32. and inside we're creating a",
    "start": "1320900",
    "end": "1328820"
  },
  {
    "text": "malicious file named drivers and we we are keeping the handle to it",
    "start": "1328820",
    "end": "1334280"
  },
  {
    "text": "open now we're asking from Windows Defender to scan that path just to rush",
    "start": "1334280",
    "end": "1340580"
  },
  {
    "text": "the process and then remove the file Windows Defender tries to delete that",
    "start": "1340580",
    "end": "1347179"
  },
  {
    "text": "file and soon it will give up you can see it gave up and now we're",
    "start": "1347179",
    "end": "1353780"
  },
  {
    "text": "safe to close the handle um delete the team the temp directory",
    "start": "1353780",
    "end": "1359299"
  },
  {
    "text": "and instead create the junction now we can reboot the computer and let's",
    "start": "1359299",
    "end": "1364580"
  },
  {
    "text": "see what happens",
    "start": "1364580",
    "end": "1367179"
  },
  {
    "text": "so we can see that most of the drivers are gone because Windows Defender iterated through all the drivers until",
    "start": "1381440",
    "end": "1387500"
  },
  {
    "text": "it encountered a driver which was probably open and it could not be deleted and so it stopped at that point",
    "start": "1387500",
    "end": "1394580"
  },
  {
    "text": "and on the next reboot we can see that the operating system is no longer",
    "start": "1394580",
    "end": "1399620"
  },
  {
    "text": "bootable foreign [Applause]",
    "start": "1399620",
    "end": "1409450"
  },
  {
    "text": "so this exploit is effective against um another scenario in which we want to",
    "start": "1410720",
    "end": "1416600"
  },
  {
    "text": "bypass a ransomware protection feature which is called the controlled folder",
    "start": "1416600",
    "end": "1421700"
  },
  {
    "text": "axis basically this feature prevents untrusted processes from modifying or",
    "start": "1421700",
    "end": "1427400"
  },
  {
    "text": "deleting any file that is contained inside one of the protected folders",
    "start": "1427400",
    "end": "1434000"
  },
  {
    "text": "but if we are causing the most trusted entity on the system whether it's",
    "start": "1434000",
    "end": "1440419"
  },
  {
    "text": "Windows Defender or other EDR antiviruses products to delete these",
    "start": "1440419",
    "end": "1446840"
  },
  {
    "text": "files or directories then the control folder access is not going to stop them from doing that because they are the",
    "start": "1446840",
    "end": "1453440"
  },
  {
    "text": "most trusted process on the system so again this exploit is relevant to",
    "start": "1453440",
    "end": "1458480"
  },
  {
    "text": "bypass this feature as well overall I tested 11 different products",
    "start": "1458480",
    "end": "1464299"
  },
  {
    "text": "and six of them were vulnerable so that means that more than 50 percent of the",
    "start": "1464299",
    "end": "1470059"
  },
  {
    "text": "tested products were found vulnerable and not only that",
    "start": "1470059",
    "end": "1475340"
  },
  {
    "text": "I was just unable to force the other products to um to postpone the deletion",
    "start": "1475340",
    "end": "1480440"
  },
  {
    "text": "to after the next reboot so if you find a way to do to do that I guess they will",
    "start": "1480440",
    "end": "1486919"
  },
  {
    "text": "be Pro uh they will probably be vulnerable too so I really encourage you to try and find more vulnerabilities of",
    "start": "1486919",
    "end": "1494000"
  },
  {
    "text": "that kind before real attackers do and now to the actual Aikido tool we've",
    "start": "1494000",
    "end": "1501380"
  },
  {
    "text": "been waiting for so I implemented it just for um Sentinel one Defender and",
    "start": "1501380",
    "end": "1506960"
  },
  {
    "text": "Defender for endpoint just because they were the most consistent with the exploit and easiest to implement all age",
    "start": "1506960",
    "end": "1513919"
  },
  {
    "text": "all I needed is just a POC um the wiper is able to make the system",
    "start": "1513919",
    "end": "1520580"
  },
  {
    "text": "unbootable just like we saw in the previous demo the wiper is fully undetectable because",
    "start": "1520580",
    "end": "1528380"
  },
  {
    "text": "again it deletes files on the system using the most trusted entity on the",
    "start": "1528380",
    "end": "1533779"
  },
  {
    "text": "system which is in our case the EDR on the antivirus and the EDR or the antivirus",
    "start": "1533779",
    "end": "1540380"
  },
  {
    "text": "is not going to prevent itself from deleting any file",
    "start": "1540380",
    "end": "1546620"
  },
  {
    "text": "um and in order to minimize the noise of creating of the creation of a malicious file the wiper also uses a car which is",
    "start": "1546620",
    "end": "1554419"
  },
  {
    "text": "a test file which is not really malicious um in order to execute the exploit and that works the same",
    "start": "1554419",
    "end": "1563200"
  },
  {
    "text": "um now um as we saw the wiper um is also able to run as an unprivileged user",
    "start": "1564140",
    "end": "1572620"
  },
  {
    "text": "and the wiper of course is able to wipe important data on the computer and we'll",
    "start": "1572900",
    "end": "1578600"
  },
  {
    "text": "soon see a second demo as I promised you with the wiper itself running against",
    "start": "1578600",
    "end": "1585320"
  },
  {
    "text": "the Sentinel one EDR with an attempt of deleting a whole administrator directory",
    "start": "1585320",
    "end": "1590960"
  },
  {
    "text": "running as an unprivileged user but if you're if you remember in the beginning of the talk I mentioned that",
    "start": "1590960",
    "end": "1598220"
  },
  {
    "text": "there is actually a crucial difference between a deletion and a wipe so I still needed to overcome this Gap",
    "start": "1598220",
    "end": "1605360"
  },
  {
    "text": "somehow and basically what I did is just is that I just implemented a feature in",
    "start": "1605360",
    "end": "1611059"
  },
  {
    "text": "the wiper that after the exploits are exploited and the reboot occurs then the",
    "start": "1611059",
    "end": "1618140"
  },
  {
    "text": "wiper fills up the disk to no space with random bytes for a few times and by that",
    "start": "1618140",
    "end": "1623419"
  },
  {
    "text": "the wiper makes sure that the file contents which were left on the disk are",
    "start": "1623419",
    "end": "1630320"
  },
  {
    "text": "overwritten and I also try to find two popular tools online to do file recovery",
    "start": "1630320",
    "end": "1636679"
  },
  {
    "text": "in order to make sure that this feature actually works so I try to run the wiper without",
    "start": "1636679",
    "end": "1643760"
  },
  {
    "text": "testing um the file recovery I try to sorry test",
    "start": "1643760",
    "end": "1649220"
  },
  {
    "text": "the wiper without implementing this feature and then test the file recovery tools",
    "start": "1649220",
    "end": "1654860"
  },
  {
    "text": "and they were able to recover some of the files but after implementing this feature they were not able to recover",
    "start": "1654860",
    "end": "1661520"
  },
  {
    "text": "any file whatsoever and I'm sure you also asked yourself but",
    "start": "1661520",
    "end": "1667460"
  },
  {
    "text": "what about the quarantine directory what if the default configuration is to move",
    "start": "1667460",
    "end": "1673100"
  },
  {
    "text": "the files to the quarantine directory so in this case the wiper is also able to",
    "start": "1673100",
    "end": "1679159"
  },
  {
    "text": "mark the quarantine directory for deletion and the EDR is not able to quarantine the quarantine folder so",
    "start": "1679159",
    "end": "1686900"
  },
  {
    "text": "it's deleted as well um and regarding the code of the repo",
    "start": "1686900",
    "end": "1694039"
  },
  {
    "text": "itself I didn't write it like a buggy script so I really want you to",
    "start": "1694039",
    "end": "1700279"
  },
  {
    "text": "um download it learn from it expand it find more vulnerabilities before real attackers do so I invested a bit of time",
    "start": "1700279",
    "end": "1708080"
  },
  {
    "text": "in the design and undocumented all the functions so you really have my invitation to download the repo use it",
    "start": "1708080",
    "end": "1716720"
  },
  {
    "text": "and again find more vulnerabilities you can have a moment to scan the QR",
    "start": "1716720",
    "end": "1723440"
  },
  {
    "text": "code or take a picture of the link the repository is currently private but it",
    "start": "1723440",
    "end": "1729440"
  },
  {
    "text": "will be published today after the talk",
    "start": "1729440",
    "end": "1734080"
  },
  {
    "text": "so I'll just give you another moment okay",
    "start": "1734779",
    "end": "1742700"
  },
  {
    "text": "so here is this second demo that I promised you with the attempt to delete",
    "start": "1743539",
    "end": "1749419"
  },
  {
    "text": "a whole administrator directory running as a non-privileged user with the wipers",
    "start": "1749419",
    "end": "1754520"
  },
  {
    "text": "let's take a look so here we are logged in as admin and we",
    "start": "1754520",
    "end": "1760460"
  },
  {
    "text": "can see that the administrator has a lot of files in its default libraries you can say that you can see that this is",
    "start": "1760460",
    "end": "1766399"
  },
  {
    "text": "really the admin and this admin user belongs to the privileged administrator group",
    "start": "1766399",
    "end": "1772640"
  },
  {
    "text": "now we're switching to a user named limited again",
    "start": "1772640",
    "end": "1777399"
  },
  {
    "text": "so yeah this is limited and limited belongs again to the",
    "start": "1778880",
    "end": "1785000"
  },
  {
    "text": "unprivileged users group now we are running the wiper with the",
    "start": "1785000",
    "end": "1791720"
  },
  {
    "text": "mode of proxy deletion with um the request of deleting all user data of the user admin",
    "start": "1791720",
    "end": "1798799"
  },
  {
    "text": "now we can see that the admin directory exists in the user's directory",
    "start": "1798799",
    "end": "1803840"
  },
  {
    "text": "and after running the wiper the wiper marks the quarantine and the admin directory for deletion",
    "start": "1803840",
    "end": "1810860"
  },
  {
    "text": "reboots the computer exploits the right vulnerability for the EDR that is installed and then after the reboot",
    "start": "1810860",
    "end": "1818480"
  },
  {
    "text": "we can see that the admin directory is missing from the users directory",
    "start": "1818480",
    "end": "1825320"
  },
  {
    "text": "and the disk is starting to fill up with random bytes and just to finish I wanted to show you",
    "start": "1825320",
    "end": "1832940"
  },
  {
    "text": "in task manager that the wiper really runs after the reboot so we can see that",
    "start": "1832940",
    "end": "1839600"
  },
  {
    "text": "it was started silently yep",
    "start": "1839600",
    "end": "1845500"
  },
  {
    "text": "Okay so to sum it all up today we learned that a wiper can be",
    "start": "1846820",
    "end": "1853940"
  },
  {
    "text": "much much more dangerous if it uses the most trusted entity on the system to do",
    "start": "1853940",
    "end": "1859279"
  },
  {
    "text": "its malicious actions by proxy in our case it's the EDR or the antivirus",
    "start": "1859279",
    "end": "1865820"
  },
  {
    "text": "now for these thousand times having security controls does not mean that you",
    "start": "1865820",
    "end": "1871279"
  },
  {
    "text": "are secure so please keep that in mind every day when you're trying to secure your organization",
    "start": "1871279",
    "end": "1877940"
  },
  {
    "text": "lastly security control might also be a very preferred Target for an attacker",
    "start": "1877940",
    "end": "1883940"
  },
  {
    "text": "because they have very high Privileges and very high trust level",
    "start": "1883940",
    "end": "1889820"
  },
  {
    "text": "now I do have two vendors responses in here um I won't read them",
    "start": "1889820",
    "end": "1895880"
  },
  {
    "text": "um I won't read them of course because they're allowed but they are in the presentation so you can later download",
    "start": "1895880",
    "end": "1901640"
  },
  {
    "text": "the presentation and see the comments if this is interesting for you overall they",
    "start": "1901640",
    "end": "1907880"
  },
  {
    "text": "were very cooperative and I thank them for that there were now there were no issues",
    "start": "1907880",
    "end": "1914480"
  },
  {
    "text": "these are the versions that you need to update you in order to be safe um so you can see Microsoft and Avast",
    "start": "1914480",
    "end": "1921980"
  },
  {
    "text": "and AVG it's a version twin micro it's a patch and Sentinel one did send me a",
    "start": "1921980",
    "end": "1927500"
  },
  {
    "text": "fixed version to test but I was still unable to get a response from them regarding the specific number of the",
    "start": "1927500",
    "end": "1934640"
  },
  {
    "text": "fixed version I want to thank shmuelcoin which is a team member of mine for the assistance",
    "start": "1934640",
    "end": "1941120"
  },
  {
    "text": "with testing my different exploits against um other edrs",
    "start": "1941120",
    "end": "1948080"
  },
  {
    "text": "and basically this is it we can move on to the Q a session",
    "start": "1948080",
    "end": "1953419"
  },
  {
    "text": "so you have two microphones you can use if somebody would like to ask questions",
    "start": "1953419",
    "end": "1961120"
  },
  {
    "text": "so this is it no questions okay so we're done",
    "start": "1962360",
    "end": "1968200"
  },
  {
    "text": "[Applause] [Music]",
    "start": "1968200",
    "end": "1973339"
  },
  {
    "text": "[Music]",
    "start": "1977190",
    "end": "1980289"
  }
]