[
  {
    "text": "welcome to Black Cat 2015 I got a couple of quick announcements here uh there's going to be a reception tonight in the",
    "start": "160",
    "end": "5879"
  },
  {
    "text": "business Hall at 5:30 p.m. that's located in Shoreline a uh there's maps running around if you need to find out",
    "start": "5879",
    "end": "11960"
  },
  {
    "text": "where that's at the uh the pony Awards also will take place tonight in manderlay BCD room at 600",
    "start": "11960",
    "end": "18439"
  },
  {
    "text": "p.m. um if you haven't already turned your phone off please do that now nobody else wants to hear your ringtone no",
    "start": "18439",
    "end": "24039"
  },
  {
    "text": "matter how cool you think it is and uh you're in Jasmine Ballroom so if that's not where you're intended to be that's",
    "start": "24039",
    "end": "29640"
  },
  {
    "text": "where you are this is the session serers side template injection rce for the modern web app with James Kettle James",
    "start": "29640",
    "end": "39280"
  },
  {
    "text": "what thanks thank you welcome can you hear",
    "start": "39280",
    "end": "47519"
  },
  {
    "text": "me is the mic working I can't tell from here okay great sorry welcome good",
    "start": "49320",
    "end": "56480"
  },
  {
    "text": "morning this is this is server side template injection and you may be",
    "start": "56480",
    "end": "62879"
  },
  {
    "text": "familiar with being so focused on exploiting a particular vulnerability",
    "start": "62879",
    "end": "69360"
  },
  {
    "text": "that you missed something that was staring you in the face or with feeling tired of seeing",
    "start": "69360",
    "end": "75280"
  },
  {
    "text": "report after report after Report with nothing better than cross-site scripting in it or with simply really wanting to get",
    "start": "75280",
    "end": "84079"
  },
  {
    "text": "a shell on a box in this session I'll introduce to you a vulnerability that can easily be",
    "start": "84079",
    "end": "90799"
  },
  {
    "text": "mistaken for cross-site scripting but isn't and share with you a six-step",
    "start": "90799",
    "end": "95840"
  },
  {
    "text": "process for hijacking template engines and getting shelves on",
    "start": "95840",
    "end": "102200"
  },
  {
    "text": "boxes my first encounter with template injection was around 18 months ago on a",
    "start": "102200",
    "end": "108479"
  },
  {
    "text": "client on a client engagement and it was quite a stressful environment we were",
    "start": "108479",
    "end": "113719"
  },
  {
    "text": "all crammed into this tiny room and there was a whiteboard up with a tally of the number of shelves that each",
    "start": "113719",
    "end": "120200"
  },
  {
    "text": "person had got within the last few weeks I'm sure you can imagine how that felt and the application that I was",
    "start": "120200",
    "end": "126799"
  },
  {
    "text": "testing had some quite strange Behavior it let you customize emails that would",
    "start": "126799",
    "end": "132360"
  },
  {
    "text": "be Mass sent out to users and these emails contained some Dynamic content so",
    "start": "132360",
    "end": "138519"
  },
  {
    "text": "where the template that I could edit said dear user. first name the the email that the user saw",
    "start": "138519",
    "end": "145920"
  },
  {
    "text": "would contain their actual name and I thought well that's interesting I wonder how I can",
    "start": "145920",
    "end": "152920"
  },
  {
    "text": "abuse this I know what to do I'll change it from user. first name to user.",
    "start": "152920",
    "end": "160120"
  },
  {
    "text": "password and it will tell me everybody's passwords brilliant so I tried that and",
    "start": "160120",
    "end": "166000"
  },
  {
    "text": "it failed completely but what it did do was tell me that this input was being processed",
    "start": "166000",
    "end": "172920"
  },
  {
    "text": "by the server as a free market template so I looked up the free market",
    "start": "172920",
    "end": "178319"
  },
  {
    "text": "template documentation and in the frequently Asked question section it said something like is it a safe is a",
    "start": "178319",
    "end": "186000"
  },
  {
    "text": "safe to allow users to submit templates if they're untrusted and the answer it gave was no and it went on to list all",
    "start": "186000",
    "end": "194080"
  },
  {
    "text": "the terrible things that someone can do to your server with a malicious",
    "start": "194080",
    "end": "199760"
  },
  {
    "text": "template and this led me on a trail of breadcrumbs through the documentation to",
    "start": "199760",
    "end": "205560"
  },
  {
    "text": "an exploit that got me a full shell on the server and access to healthy amount",
    "start": "205560",
    "end": "210640"
  },
  {
    "text": "of sensitive financial information which was",
    "start": "210640",
    "end": "215439"
  },
  {
    "text": "great it was really just a one-off event though it was quite lucky that the",
    "start": "215920",
    "end": "221879"
  },
  {
    "text": "server made it really obvious that this input was being processed as a template and it was also lucky that the",
    "start": "221879",
    "end": "228760"
  },
  {
    "text": "free market documentation was so forthcoming to hackers about how dangerous it",
    "start": "228760",
    "end": "234840"
  },
  {
    "text": "was 9 months ago though at portswigger we receiv received a report that burp",
    "start": "234840",
    "end": "240760"
  },
  {
    "text": "Suite was failing to find a blatant cross-site scripting vulnerability which isn't something which happens every day",
    "start": "240760",
    "end": "247640"
  },
  {
    "text": "so I investigated manually and found once again the server was behaving in",
    "start": "247640",
    "end": "253200"
  },
  {
    "text": "quite an odd way that's why we'd missed the cross-site scripting and thanks to my prior encounter with template",
    "start": "253200",
    "end": "260359"
  },
  {
    "text": "injection I saw the issue for what it really was which was template",
    "start": "260359",
    "end": "265440"
  },
  {
    "text": "injection so the client thought they had a maybe a med severity cross-site",
    "start": "265440",
    "end": "270600"
  },
  {
    "text": "scripting issue on their site but they had something that was potentially a lot more",
    "start": "270600",
    "end": "276840"
  },
  {
    "text": "serious this left me with a couple of questions exactly how common is template",
    "start": "276840",
    "end": "283280"
  },
  {
    "text": "injection how many times has someone found cross-site scripting and not",
    "start": "283280",
    "end": "288360"
  },
  {
    "text": "realize that it's actually a symptom of a much more serious issue and",
    "start": "288360",
    "end": "296320"
  },
  {
    "text": "secondly how serious is template injection is it only free marker that",
    "start": "296440",
    "end": "301520"
  },
  {
    "text": "can be used to get shell on a server quite easily or are other template engines also quite",
    "start": "301520",
    "end": "308800"
  },
  {
    "text": "exploitable so I decided to investigate and got some quite interesting results",
    "start": "308800",
    "end": "316720"
  },
  {
    "text": "that I'll share with you now first I'll just introduce template",
    "start": "316720",
    "end": "323280"
  },
  {
    "text": "injection talk about what it is how it happens and then I'll walk through this",
    "start": "323280",
    "end": "328520"
  },
  {
    "text": "process for identifying and building a working exploit for whatever template",
    "start": "328520",
    "end": "333800"
  },
  {
    "text": "Eng engine you found in whatever environment it is and then I'll show",
    "start": "333800",
    "end": "339039"
  },
  {
    "text": "this process being applied to five of the most popular template engines to see",
    "start": "339039",
    "end": "345360"
  },
  {
    "text": "how they hold up and these engines have been selected because they show the",
    "start": "345360",
    "end": "350600"
  },
  {
    "text": "different things that happen when you when you apply the exploit development process to",
    "start": "350600",
    "end": "356120"
  },
  {
    "text": "them then I'll demonstrate remote code execution zero days in a couple of real",
    "start": "356120",
    "end": "362560"
  },
  {
    "text": "web applications that you may have heard of but hopefully don't have instilled on your",
    "start": "362560",
    "end": "367840"
  },
  {
    "text": "networks and then take five minutes of questions and wrap",
    "start": "367840",
    "end": "373360"
  },
  {
    "text": "up what is template injection it's simply when user input is unsafely",
    "start": "373360",
    "end": "378520"
  },
  {
    "text": "embedded into a template like this example here if you look at the first",
    "start": "378520",
    "end": "384400"
  },
  {
    "text": "argument to this to the render function uh you've got user input being concat",
    "start": "384400",
    "end": "389639"
  },
  {
    "text": "ated into this template and that means that if the user input contains a",
    "start": "389639",
    "end": "395199"
  },
  {
    "text": "template expression that will be evaluated by the server that's the core",
    "start": "395199",
    "end": "400720"
  },
  {
    "text": "of this vulnerability just to be absolutely clear this second example here is not",
    "start": "400720",
    "end": "407000"
  },
  {
    "text": "vulnerable to to template injection you still have user input with in the first name variable being passed into a",
    "start": "407000",
    "end": "413560"
  },
  {
    "text": "template but it isn't being put into the template itself it's just being passed",
    "start": "413560",
    "end": "418840"
  },
  {
    "text": "in as an argument if a user were to embed a template expression inside that",
    "start": "418840",
    "end": "424560"
  },
  {
    "text": "variable it would just be ignored and as with all vulnerabilities",
    "start": "424560",
    "end": "430199"
  },
  {
    "text": "this can happen by accident however I've also seen it happen through developers intentionally",
    "start": "430199",
    "end": "437280"
  },
  {
    "text": "letting users edit templates in quite a few different circumstances because they",
    "start": "437280",
    "end": "442960"
  },
  {
    "text": "want to offer this functionality to users and they maybe don't realize quite how dangerous it",
    "start": "442960",
    "end": "448319"
  },
  {
    "text": "is on a high level to prove that this issue",
    "start": "448319",
    "end": "456360"
  },
  {
    "text": "is serious first you need to find that there's some kind of template injection happening then you need to figure out",
    "start": "456360",
    "end": "462720"
  },
  {
    "text": "you need to identify what the template engine in use is exactly then simply",
    "start": "462720",
    "end": "468680"
  },
  {
    "text": "build an exploit for it which is where things get really involved so how do you recognize",
    "start": "468680",
    "end": "477080"
  },
  {
    "text": "template injection given that there are scores of different template engines out there and they're all slightly",
    "start": "477080",
    "end": "483879"
  },
  {
    "text": "different well the way to do it is to embed a",
    "start": "483879",
    "end": "489000"
  },
  {
    "text": "template expression and if you use something really really simple like 7 time 7 then",
    "start": "489000",
    "end": "497960"
  },
  {
    "text": "you've got a piece of syntax there which will be supported by almost all template",
    "start": "497960",
    "end": "503039"
  },
  {
    "text": "engines so if you send that payload uh highlighted in green and look the output",
    "start": "503039",
    "end": "509960"
  },
  {
    "text": "you can tell whether it's been evaluated by the server or not and you can just",
    "start": "509960",
    "end": "515200"
  },
  {
    "text": "repeat this for the for the various different common types of syntax that",
    "start": "515200",
    "end": "520800"
  },
  {
    "text": "the template engines offer which are listed on the bottom of the",
    "start": "520800",
    "end": "526680"
  },
  {
    "text": "slide there's actually a second way in which template injection can happen the",
    "start": "526680",
    "end": "532480"
  },
  {
    "text": "user input might not being input directly into the template it might be being placed inside a template expr",
    "start": "532480",
    "end": "540160"
  },
  {
    "text": "pression and this this is even harder to spot it often won't result in crossy",
    "start": "540160",
    "end": "545839"
  },
  {
    "text": "scripting because the user input is just like a variable name and if you make any",
    "start": "545839",
    "end": "551360"
  },
  {
    "text": "change to to this input or any naive change like not realizing what's going",
    "start": "551360",
    "end": "556920"
  },
  {
    "text": "on on the server then you'll get an error message back or you'll just get the empty",
    "start": "556920",
    "end": "562760"
  },
  {
    "text": "string so in order to recognize this we need to we need to safely close the",
    "start": "562760",
    "end": "568760"
  },
  {
    "text": "template expression and then embed something after it if you get input if",
    "start": "568760",
    "end": "575279"
  },
  {
    "text": "you don't get input reflection straight off but you do when you try to close a",
    "start": "575279",
    "end": "580760"
  },
  {
    "text": "template then that suggests there's some kind of template injection happening and then you can follow up by Trying by",
    "start": "580760",
    "end": "587519"
  },
  {
    "text": "trying to embed simple mathematical expressions and the",
    "start": "587519",
    "end": "592480"
  },
  {
    "text": "like so now you know there's some kind of template injection happening how you build an exploit for",
    "start": "594640",
    "end": "601200"
  },
  {
    "text": "it you can start off with a really simple payload like this that just",
    "start": "601200",
    "end": "607399"
  },
  {
    "text": "confirms that there is some kind of evaluation happening and then you can",
    "start": "607399",
    "end": "613160"
  },
  {
    "text": "build a decision tree based on the behavior of different template engines",
    "start": "613160",
    "end": "618800"
  },
  {
    "text": "so if that 7 x 7 syntax works we know that the server must be using one of a",
    "start": "618800",
    "end": "624640"
  },
  {
    "text": "specific set of template engines which support that syntax uh one of which is Smarty so if",
    "start": "624640",
    "end": "632519"
  },
  {
    "text": "we send smarty comment syntax and that payload works as well we've confirmed that the server is running Smarty And if",
    "start": "632519",
    "end": "639360"
  },
  {
    "text": "that fails then we can try some some different syntax which is attuned to a different engine and so on so using this",
    "start": "639360",
    "end": "647399"
  },
  {
    "text": "strategy without without relying on something like paing error messages that might have any kind of format we can",
    "start": "647399",
    "end": "654800"
  },
  {
    "text": "easily automate how to figure out exactly which template engine is in",
    "start": "654800",
    "end": "660079"
  },
  {
    "text": "use this is a sub tree of the strategy used by burp Suite to identify serice",
    "start": "660079",
    "end": "666880"
  },
  {
    "text": "side template injection so if you're a burp site user then at the end of this",
    "start": "666880",
    "end": "671920"
  },
  {
    "text": "presentation you'll find an update waiting for you that will automate these",
    "start": "671920",
    "end": "677000"
  },
  {
    "text": "two steps it will detect template injection and it will try to identify which template engine is in",
    "start": "677000",
    "end": "684440"
  },
  {
    "text": "use well once you know which the template engine is things get a bit more interesting you need to so what you",
    "start": "687800",
    "end": "694800"
  },
  {
    "text": "found so far is not necessarily a security issue or not necessarily more",
    "start": "694800",
    "end": "699880"
  },
  {
    "text": "serious than cross-site scripting what you need to prove is that you can do something uniquely evil on the server",
    "start": "699880",
    "end": "707279"
  },
  {
    "text": "with the template and the first key step to that is simply to read the",
    "start": "707279",
    "end": "714120"
  },
  {
    "text": "documentation that might sound really quite lame but often if you read the",
    "start": "714120",
    "end": "720040"
  },
  {
    "text": "documentation you will find everything you need to build a fully working exploit and get a shell on the server as",
    "start": "720040",
    "end": "727399"
  },
  {
    "text": "we'll see shortly the key areas of interest within the documentation are well the four",
    "start": "727399",
    "end": "735399"
  },
  {
    "text": "template author section will tell you what the basic syntax of the template is so how to do things like Loop which is",
    "start": "735399",
    "end": "742959"
  },
  {
    "text": "going to be really useful when you're looping around all the passwords that you've stolen from the server or whatever",
    "start": "742959",
    "end": "749399"
  },
  {
    "text": "if you're lucky then the template engine will also have a security consideration",
    "start": "749399",
    "end": "755199"
  },
  {
    "text": "section and this will list all of the most dangerous functions which which are",
    "start": "755199",
    "end": "761040"
  },
  {
    "text": "clearly the ones that you need to pay attention to if there isn't such a list well there's pretty much guaranteed to",
    "start": "761040",
    "end": "767199"
  },
  {
    "text": "be a list of built-in functions built-in variables and extensions and plugins that might be enabled by default so",
    "start": "767199",
    "end": "774040"
  },
  {
    "text": "those make up the core attack surface the next step is to find out",
    "start": "774040",
    "end": "781000"
  },
  {
    "text": "exactly what you have access to within the template execution",
    "start": "781000",
    "end": "786079"
  },
  {
    "text": "environment most template engines have some kind of self object and this will",
    "start": "786079",
    "end": "792639"
  },
  {
    "text": "contain everything that's in scope so if you can find out what the name of this is and find a way to loop around the",
    "start": "792639",
    "end": "800680"
  },
  {
    "text": "attributes and methods of this object then you can you can iteratively",
    "start": "800680",
    "end": "806600"
  },
  {
    "text": "identify everything you've got access to some template engines don't have a self",
    "start": "806600",
    "end": "812920"
  },
  {
    "text": "object or they don't have a documented self object but they may still have one for internal use for this use case I've",
    "start": "812920",
    "end": "821240"
  },
  {
    "text": "built a word list by crawlin GitHub of the most popular variable names so you",
    "start": "821240",
    "end": "827079"
  },
  {
    "text": "can run you can run a word list of variable names to Brute Force potential",
    "start": "827079",
    "end": "832920"
  },
  {
    "text": "variables I've I've released this word list in the B Intruder and it's also being added to fuz DB surely it's",
    "start": "832920",
    "end": "842040"
  },
  {
    "text": "free now once you know exactly what you have access to it's just a case of",
    "start": "842040",
    "end": "847880"
  },
  {
    "text": "trying to exploit it which is your standard web application attack like you you might be",
    "start": "847880",
    "end": "856639"
  },
  {
    "text": "able to exploit one of any number of common vulnerabilities is it's just that the way you're calling into them is slightly",
    "start": "856639",
    "end": "863000"
  },
  {
    "text": "different it's a it's a bit like it's a bit like building an exploit for php's unserialized function",
    "start": "863000",
    "end": "869240"
  },
  {
    "text": "so you may be able to call some methods you may have access to some methods but not be able to call them unless you use",
    "start": "869240",
    "end": "875240"
  },
  {
    "text": "other methods to get the right object references and so",
    "start": "875240",
    "end": "880320"
  },
  {
    "text": "on this presentation is focused on getting code execution however I should",
    "start": "883759",
    "end": "889519"
  },
  {
    "text": "mention that information the template engines are brilliant vectors for",
    "start": "889519",
    "end": "894560"
  },
  {
    "text": "information disclosure because they're being executed right in the heart part",
    "start": "894560",
    "end": "899759"
  },
  {
    "text": "of the application they often have access to things like environment variables which may contain really",
    "start": "899759",
    "end": "906120"
  },
  {
    "text": "sensitive stuff like Amazon secret keys for example and to get access to those",
    "start": "906120",
    "end": "913320"
  },
  {
    "text": "you don't have to do anything fancy just use a loop and print out the value of all of all the variables it's really",
    "start": "913320",
    "end": "919880"
  },
  {
    "text": "really easy okay so that's the theory of this",
    "start": "919880",
    "end": "926320"
  },
  {
    "text": "exploit process now let's see how template engines actually hold up in real",
    "start": "926320",
    "end": "932240"
  },
  {
    "text": "life firstly free marker so this is the one that I already mentioned and the",
    "start": "932240",
    "end": "938040"
  },
  {
    "text": "documentation says it lists the most dangerous functions and one of these functions is the new",
    "start": "938040",
    "end": "944079"
  },
  {
    "text": "function and the documentation for it contains some uh not that useful stuff but the key point is that this new",
    "start": "944079",
    "end": "952120"
  },
  {
    "text": "function can be used to create arbitrary objects provided that they implement the",
    "start": "952120",
    "end": "957959"
  },
  {
    "text": "template the template model interface so let's have a look at",
    "start": "957959",
    "end": "963360"
  },
  {
    "text": "template model and see what classes implement",
    "start": "963360",
    "end": "968639"
  },
  {
    "text": "it now that's only maybe a third of the a third of the classes they were quite a",
    "start": "968639",
    "end": "974880"
  },
  {
    "text": "few and you might find that one of these classes jumps out at you slightly it",
    "start": "974880",
    "end": "981360"
  },
  {
    "text": "sounds quite promising any ideas ex yes exactly",
    "start": "981360",
    "end": "986800"
  },
  {
    "text": "execute I wonder what execute does well it executes the show command",
    "start": "986800",
    "end": "992480"
  },
  {
    "text": "on the server and it gives us the output perfect exactly what we",
    "start": "992480",
    "end": "997720"
  },
  {
    "text": "need so here uh the show command is highlighted in blue and it's really",
    "start": "997720",
    "end": "1003360"
  },
  {
    "text": "really simple to just execute a a shell command with free marker on the server",
    "start": "1003360",
    "end": "1008880"
  },
  {
    "text": "and get the output now the brilliant thing about that is it's clearly intended",
    "start": "1008880",
    "end": "1015079"
  },
  {
    "text": "functionality it is never going to get patched it's just just it's just sitting",
    "start": "1015079",
    "end": "1020519"
  },
  {
    "text": "there as a kind of a a trap for developers who don't read the documentation and find out how dangerous",
    "start": "1020519",
    "end": "1026000"
  },
  {
    "text": "free Mark",
    "start": "1026000",
    "end": "1028640"
  },
  {
    "text": "is that said you can't fault the developers of free market for not making it obvious that these are dangerous I'm",
    "start": "1032720",
    "end": "1039038"
  },
  {
    "text": "not saying this is their fault in the slightest okay next up velocity which is",
    "start": "1039039",
    "end": "1045480"
  },
  {
    "text": "another popular Java template engine and I found the documentation here to be",
    "start": "1045480",
    "end": "1051320"
  },
  {
    "text": "a lot less forthcoming uh it didn't list any any exploitable sounding methods and I",
    "start": "1051320",
    "end": "1057240"
  },
  {
    "text": "couldn't even find a self object so I ran a brute force with of of variable",
    "start": "1057240",
    "end": "1064440"
  },
  {
    "text": "names with my word list and I found something quite interesting if you send",
    "start": "1064440",
    "end": "1069840"
  },
  {
    "text": "the the the class variable then the output from the server looks like a",
    "start": "1069840",
    "end": "1076000"
  },
  {
    "text": "generic Java object so I thought well that's cool uh let's Google this and find out what's going on it turns out",
    "start": "1076000",
    "end": "1083880"
  },
  {
    "text": "there's an extension for velocity which I think is not part of core velocity but",
    "start": "1083880",
    "end": "1089520"
  },
  {
    "text": "it is enabled by default and bundled with it so that's why I didn't find it",
    "start": "1089520",
    "end": "1095120"
  },
  {
    "text": "originally and the purpose of this extension is for the use of Java",
    "start": "1095120",
    "end": "1100200"
  },
  {
    "text": "Reflection In templates now so using a couple of",
    "start": "1100200",
    "end": "1106520"
  },
  {
    "text": "methods uh of this object we can easily get an arbitrary Java object and therefore it's just a matter",
    "start": "1106520",
    "end": "1113760"
  },
  {
    "text": "of taking standard one-",
    "start": "1113760",
    "end": "1116799"
  },
  {
    "text": "of-the-month to get references to the objects so we can call them so this",
    "start": "1121200",
    "end": "1127280"
  },
  {
    "text": "command here will simply make the server sleep for 5 seconds using that shell",
    "start": "1127280",
    "end": "1132440"
  },
  {
    "text": "command and we can verify that it's executed by seeing how long it takes the server to respond great",
    "start": "1132440",
    "end": "1139880"
  },
  {
    "text": "but what we really want is the output of the shell Command right unfortunately because this is Java it takes quite a",
    "start": "1139880",
    "end": "1146720"
  },
  {
    "text": "lot more code to get there not that this isn't exactly Java",
    "start": "1146720",
    "end": "1152720"
  },
  {
    "text": "this is velocity you you have to use the syntax of whatever the template engine is and find out like what the velocity",
    "start": "1152720",
    "end": "1158840"
  },
  {
    "text": "way of looping around something is but anyway once again like there's no",
    "start": "1158840",
    "end": "1164840"
  },
  {
    "text": "exploits and that that weren't on the last slide it's just a way of getting that output to to us in a nice easy way",
    "start": "1164840",
    "end": "1173039"
  },
  {
    "text": "and once again we have an exploit that is pretty much using intended",
    "start": "1173039",
    "end": "1179880"
  },
  {
    "text": "functionality it isn't a really a vulnerability within velocity although",
    "start": "1179880",
    "end": "1185159"
  },
  {
    "text": "it could perhaps be better",
    "start": "1185159",
    "end": "1188280"
  },
  {
    "text": "documented this one's a bit different third one uh smarty is a popular PHP",
    "start": "1192520",
    "end": "1197840"
  },
  {
    "text": "template engine and by default it's so trivial to execute arbitary code with it that I'm not going to talk about",
    "start": "1197840",
    "end": "1204440"
  },
  {
    "text": "it but it offers a secure mode and the purpose of this mode is to let untrusted",
    "start": "1204440",
    "end": "1212960"
  },
  {
    "text": "users edit templates I it's for intentionally making your application vulnerable to template in injection and",
    "start": "1212960",
    "end": "1221480"
  },
  {
    "text": "then it uses this kind of sandboxy thing to try and stop the templates from doing anything bad to the",
    "start": "1221480",
    "end": "1226760"
  },
  {
    "text": "server this is implemented using a white list of PHP functions so I can't for example Just",
    "start": "1226760",
    "end": "1234080"
  },
  {
    "text": "Call php's Exec or or system function to execute an arbitary shell",
    "start": "1234080",
    "end": "1240000"
  },
  {
    "text": "command however smarty has a self object and the self object has a method called",
    "start": "1240000",
    "end": "1246760"
  },
  {
    "text": "get stream variable uh which I think is for internal use but we can easily use it to",
    "start": "1246760",
    "end": "1252039"
  },
  {
    "text": "read in an arbitary file from the server which is a nice start so that command",
    "start": "1252039",
    "end": "1258640"
  },
  {
    "text": "just reads in self log your login your ID to find out the idea of the current process",
    "start": "1258640",
    "end": "1265200"
  },
  {
    "text": "cool even better smarty lets us in the secure mode invoke arbitrary methods on",
    "start": "1265200",
    "end": "1271799"
  },
  {
    "text": "static classes so provided they've been imported and smarty by default Imports",
    "start": "1271799",
    "end": "1278960"
  },
  {
    "text": "this class called smarty internal right file with a method called Write file and",
    "start": "1278960",
    "end": "1285799"
  },
  {
    "text": "what this method does is write files writes arbitary contents to arbitary",
    "start": "1285799",
    "end": "1291880"
  },
  {
    "text": "locations it can also be used to overwrite files the only catch here is",
    "start": "1291880",
    "end": "1296960"
  },
  {
    "text": "that the third argument to this method has to be of type smarty fortunately we",
    "start": "1296960",
    "end": "1302720"
  },
  {
    "text": "can get a handle on an object of type smarty using the clear config method of",
    "start": "1302720",
    "end": "1308000"
  },
  {
    "text": "the self object so by chaining these two together we can do this the script name",
    "start": "1308000",
    "end": "1316760"
  },
  {
    "text": "variable uh is a ailable by default and contains the location on the file system",
    "start": "1316760",
    "end": "1321960"
  },
  {
    "text": "of the current PHP file so what this does is it overwrites",
    "start": "1321960",
    "end": "1327080"
  },
  {
    "text": "the current PHP file with our back door easily letting us execute arbitary shell",
    "start": "1327080",
    "end": "1332520"
  },
  {
    "text": "commands on the server so this one is pretty clearly a",
    "start": "1332520",
    "end": "1338880"
  },
  {
    "text": "vulnerability with Smarty And I I have I have reported it",
    "start": "1338880",
    "end": "1344919"
  },
  {
    "text": "and it has been fixed but you might be thinking well that actually",
    "start": "1344919",
    "end": "1350240"
  },
  {
    "text": "wasn't very difficult to do and I would agree I I get the impression",
    "start": "1350240",
    "end": "1356240"
  },
  {
    "text": "that with a lot of these kind of sandbox modes these secure modes they haven't been audited by anybody",
    "start": "1356240",
    "end": "1362840"
  },
  {
    "text": "ever so this isn't something like Chrome sandbox",
    "start": "1362840",
    "end": "1369039"
  },
  {
    "text": "right so if you are going to use the the secure mode of a template",
    "start": "1369039",
    "end": "1374960"
  },
  {
    "text": "language I would say is worth doing it is going to make a hacker's life harder but don't rely on",
    "start": "1374960",
    "end": "1381960"
  },
  {
    "text": "it twig is another popular PHP template engine and it's used by the symphony",
    "start": "1382279",
    "end": "1388760"
  },
  {
    "text": "framework I think and it's actually by default more secure than smarty secure mode so in addition to there being a",
    "start": "1388760",
    "end": "1396039"
  },
  {
    "text": "white list of PHP functions uh we can't invoke any static methods and we also can't get object",
    "start": "1396039",
    "end": "1404000"
  },
  {
    "text": "references out of functions cuz they just get battered into",
    "start": "1404000",
    "end": "1409600"
  },
  {
    "text": "however as ever there is a self object I think this one isn't actually documented",
    "start": "1409600",
    "end": "1414960"
  },
  {
    "text": "anywhere but you can find it with a variable named Ro forcing and this doesn't have any",
    "start": "1414960",
    "end": "1421000"
  },
  {
    "text": "directly exploitable methods but it does have an attribute called EnV which is an",
    "start": "1421000",
    "end": "1426279"
  },
  {
    "text": "instance of twig environment and Twig environment has some quite cool",
    "start": "1426279",
    "end": "1431600"
  },
  {
    "text": "methods such as one of them which contains a call to php's call user funk",
    "start": "1431600",
    "end": "1438960"
  },
  {
    "text": "uh which is a built-in PHP function where if you control the arguments to it you can invoke arbitrary functions with",
    "start": "1438960",
    "end": "1446440"
  },
  {
    "text": "arbitrary arguments and here the name variable which is the argument to the",
    "start": "1446440",
    "end": "1452440"
  },
  {
    "text": "function is being passed in as a parameter to that function so we we we have control over that the Callback",
    "start": "1452440",
    "end": "1459400"
  },
  {
    "text": "variable comes from the filter callbacks attribute of this object which we can",
    "start": "1459400",
    "end": "1465520"
  },
  {
    "text": "set using the register undefined coolback method so once again by",
    "start": "1465520",
    "end": "1470960"
  },
  {
    "text": "combining two methods chaining them onto each other we can call one method to set",
    "start": "1470960",
    "end": "1476120"
  },
  {
    "text": "that attribute and then call the next method and then call the other method to",
    "start": "1476120",
    "end": "1481320"
  },
  {
    "text": "invoke the call user Funk with with exec and ID and execute ARB shell commands on",
    "start": "1481320",
    "end": "1488399"
  },
  {
    "text": "the server and once again this isn't this",
    "start": "1488399",
    "end": "1494039"
  },
  {
    "text": "one is not really intended functionality or it doesn't look like it right uh but",
    "start": "1494039",
    "end": "1502039"
  },
  {
    "text": "I wouldn't say this is a vulnerability in twig because twig actually has a sandbox",
    "start": "1502039",
    "end": "1509080"
  },
  {
    "text": "mode for the sole purpose of letting users submit untrusted templates and",
    "start": "1509080",
    "end": "1514440"
  },
  {
    "text": "this is where things get really quite tricky so in addition to all the previous restrictions we've also got we",
    "start": "1514440",
    "end": "1521880"
  },
  {
    "text": "also can't retrieve attributes so I can I can no longer get hold of self. N and",
    "start": "1521880",
    "end": "1527799"
  },
  {
    "text": "there's a white list of method calls so even if a developer passes in an object",
    "start": "1527799",
    "end": "1534000"
  },
  {
    "text": "with a vulnerable method we can't invoke that method on that object unless it's been wh",
    "start": "1534000",
    "end": "1542200"
  },
  {
    "text": "listed that might sound like you can't get anywhere right that's what I thought at first however when I read the code",
    "start": "1542720",
    "end": "1548799"
  },
  {
    "text": "that implements the white list I found a bit of a floor right at the start of it",
    "start": "1548799",
    "end": "1554520"
  },
  {
    "text": "so actually we can call arbitrary methods on any object that implements one of",
    "start": "1554520",
    "end": "1560720"
  },
  {
    "text": "these two interfaces right and guess what implements one of these two interfaces the self object so we can go",
    "start": "1560720",
    "end": "1568679"
  },
  {
    "text": "arbitary methods on the self on the on the self object which is quite nice and",
    "start": "1568679",
    "end": "1574679"
  },
  {
    "text": "now I as I said the self object doesn't have any directly exploitable methods",
    "start": "1574679",
    "end": "1580559"
  },
  {
    "text": "but it does have this one method for internal use only uh which contains a",
    "start": "1580559",
    "end": "1586600"
  },
  {
    "text": "line which which contains this Co whatever the block variable method is on whatever the",
    "start": "1586600",
    "end": "1593679"
  },
  {
    "text": "template object is so if we control these variables which we do because they all come from the",
    "start": "1593679",
    "end": "1600279"
  },
  {
    "text": "argument we can use this method as a proxy or a gadget of sorts to to invoke",
    "start": "1600279",
    "end": "1608120"
  },
  {
    "text": "arbitrary methods on any object that we can get a reference to so here uh the user has passed in a I",
    "start": "1608120",
    "end": "1617799"
  },
  {
    "text": "mean the developer has passed in an object called Dev object with a method called vulnerable method and we can't",
    "start": "1617799",
    "end": "1623640"
  },
  {
    "text": "call it directly but using this method as a proxy we can invoke that argument we can",
    "start": "1623640",
    "end": "1631000"
  },
  {
    "text": "invoke that method which is which could be quite nice now you might have noticed that I",
    "start": "1631000",
    "end": "1637640"
  },
  {
    "text": "haven't got a shell here actually uh that's because by default twig doesn't",
    "start": "1637640",
    "end": "1642720"
  },
  {
    "text": "offer any references to to exploitable objects",
    "start": "1642720",
    "end": "1648919"
  },
  {
    "text": "however developers can pass in objects and will pass in objects to to templates",
    "start": "1648919",
    "end": "1655159"
  },
  {
    "text": "and they may have methods which are vulnerable to all your standard uh",
    "start": "1655159",
    "end": "1661200"
  },
  {
    "text": "attacks something worth noting here is that different instances of template",
    "start": "1661200",
    "end": "1666760"
  },
  {
    "text": "injection within a single application may have different objects",
    "start": "1666760",
    "end": "1671880"
  },
  {
    "text": "passed in so it's worth auditing all of them until you get get code",
    "start": "1671880",
    "end": "1679840"
  },
  {
    "text": "execution okay finally this one's a bit different this is codeen a publicly",
    "start": "1681880",
    "end": "1687600"
  },
  {
    "text": "accessible website which by Design lets users submit templates in a variety of",
    "start": "1687600",
    "end": "1693200"
  },
  {
    "text": "different languages now I I've chosen the Jade language uh because why not and you can",
    "start": "1693200",
    "end": "1700960"
  },
  {
    "text": "see the input up the top and then the output from the server in white down the",
    "start": "1700960",
    "end": "1707000"
  },
  {
    "text": "bottom and you can easily see you've got cross-site scripting uh but they've",
    "start": "1707000",
    "end": "1712320"
  },
  {
    "text": "actually mitigated that using a Sandbox domain so you can't do anything bad with that and you can also confirm you can",
    "start": "1712320",
    "end": "1719360"
  },
  {
    "text": "execute commands on you can execute mathematical Expressions on on the server pretty easily so now it's just a",
    "start": "1719360",
    "end": "1727919"
  },
  {
    "text": "matter of following the explo process but in this case it's a completely blackbox thing so",
    "start": "1727919",
    "end": "1735200"
  },
  {
    "text": "Jade's a node.js template engine and I didn't really know I don't know no JS",
    "start": "1735200",
    "end": "1742200"
  },
  {
    "text": "it's just this is how you do it with having no idea what's going on so first off you find the the self object in this",
    "start": "1742200",
    "end": "1750039"
  },
  {
    "text": "case it's called root and then you find a way to loop around this object and find out all of the attributes and",
    "start": "1750039",
    "end": "1756120"
  },
  {
    "text": "methods and then you just kind of go hunting for interesting sounding",
    "start": "1756120",
    "end": "1761279"
  },
  {
    "text": "things and eventually I ran into this which is",
    "start": "1761279",
    "end": "1766840"
  },
  {
    "text": "quite promising really so codepen has recognized that I'm trying to do something that might do bad things to",
    "start": "1766840",
    "end": "1772679"
  },
  {
    "text": "their server cool okay but they blocked it however if you look carefully at the",
    "start": "1772679",
    "end": "1779559"
  },
  {
    "text": "phrasing of this uh warning you might have a suspicion that",
    "start": "1779559",
    "end": "1785399"
  },
  {
    "text": "this defense is implemented with a regular expression and it actually is so",
    "start": "1785399",
    "end": "1790640"
  },
  {
    "text": "all we have to do is take that Top Line which is what's which is what has triggered this method and split it into",
    "start": "1790640",
    "end": "1796720"
  },
  {
    "text": "two statements okay so this executes exactly the same",
    "start": "1796720",
    "end": "1803760"
  },
  {
    "text": "command on the server wonderful so now I've got access to require so I can",
    "start": "1803760",
    "end": "1810559"
  },
  {
    "text": "import external module things which can be used to execute shell commands on the",
    "start": "1810559",
    "end": "1816120"
  },
  {
    "text": "server all right so I couldn't get the output of this shell command because",
    "start": "1816120",
    "end": "1821279"
  },
  {
    "text": "node is asynchronous and I don't understand asynchronous things uh but so what this does is it",
    "start": "1821279",
    "end": "1828000"
  },
  {
    "text": "ID and it pipes the output of that to my server with netcat so you can you can",
    "start": "1828000",
    "end": "1833640"
  },
  {
    "text": "see the output on on the bottom half cool okay I think I've answered the",
    "start": "1833640",
    "end": "1841640"
  },
  {
    "text": "question how serious is template injection right it's it can often be",
    "start": "1841640",
    "end": "1848799"
  },
  {
    "text": "used to get a sh on the server not always but within pretty much any template engine depending on what",
    "start": "1848799",
    "end": "1855120"
  },
  {
    "text": "developer objects are passed in you might find that they've introduced a code",
    "start": "1855120",
    "end": "1861639"
  },
  {
    "text": "execution vulnerability so now that leaves the question of exactly how common template",
    "start": "1861639",
    "end": "1868399"
  },
  {
    "text": "injection is right and the true answer is I don't know for certain right but",
    "start": "1868399",
    "end": "1873440"
  },
  {
    "text": "what I do know is I've run into quite a few and it's quite easy to miss and I've",
    "start": "1873440",
    "end": "1879399"
  },
  {
    "text": "had no trouble finding a couple of applications to demonstrate zero days in for",
    "start": "1879399",
    "end": "1886159"
  },
  {
    "text": "you",
    "start": "1886159",
    "end": "1889159"
  },
  {
    "text": "so this is al fresco which is a Content management system and great thing about this",
    "start": "1895679",
    "end": "1903840"
  },
  {
    "text": "content management system is that it implements some of the pages using free market templates which",
    "start": "1903840",
    "end": "1911559"
  },
  {
    "text": "you can see here right however I'm as a low privilege user here here cuz you",
    "start": "1911559",
    "end": "1917880"
  },
  {
    "text": "might as well start from as low privilege as possible uh I'm not allowed to edit this template so this template",
    "start": "1917880",
    "end": "1924440"
  },
  {
    "text": "makes this page but I can't edit it however",
    "start": "1924440",
    "end": "1929880"
  },
  {
    "text": "administrators can edit that page and in al fresco there's I found quite a serious",
    "start": "1929880",
    "end": "1938279"
  },
  {
    "text": "stored crossy scripting vulnerability in the comment system so that's the cross-site",
    "start": "1938279",
    "end": "1946200"
  },
  {
    "text": "scripting payload that I've used there uh it isn't that relevant but so alesco",
    "start": "1946200",
    "end": "1952159"
  },
  {
    "text": "tries to allow safe HTML and they allow the image tag and",
    "start": "1952159",
    "end": "1957480"
  },
  {
    "text": "they think that this is an attribute with a name of the empty string right",
    "start": "1957480",
    "end": "1962919"
  },
  {
    "text": "but what a browser sees is an image tag some random crap closing tag and then an SVG thing with an event handler and",
    "start": "1962919",
    "end": "1968960"
  },
  {
    "text": "executes it right and this is the free marker back door that I want the",
    "start": "1968960",
    "end": "1974320"
  },
  {
    "text": "administrator to inject for me so all I have to do is write some",
    "start": "1974320",
    "end": "1981960"
  },
  {
    "text": "JavaScript that does some cross-site request fory to overwrite that file that I showed with",
    "start": "1981960",
    "end": "1988519"
  },
  {
    "text": "the with the back door so it looks kind of messy but all it does is grab the users cross site request 4G token and",
    "start": "1988519",
    "end": "1994919"
  },
  {
    "text": "then uses it to make a same origin request to inject the back dot right",
    "start": "1994919",
    "end": "2001559"
  },
  {
    "text": "great and when encoded it looks like that so let's look at what happens when",
    "start": "2001559",
    "end": "2007720"
  },
  {
    "text": "an",
    "start": "2007720",
    "end": "2009919"
  },
  {
    "text": "administrator views a page with a comment on it with",
    "start": "2012799",
    "end": "2018200"
  },
  {
    "text": "this payload in so this just does alert one and this has the full",
    "start": "2018200",
    "end": "2024840"
  },
  {
    "text": "payload now we shouldn't see anything out of the ordinary right blank document uh there's like a random character down",
    "start": "2024840",
    "end": "2031159"
  },
  {
    "text": "there I'm not sure how I've got there but whatever nothing much but now if as the low privileg user",
    "start": "2031159",
    "end": "2037120"
  },
  {
    "text": "I look at what the contents of this file are I see oh look my back door's there all right so all I've got to do is put",
    "start": "2037120",
    "end": "2044639"
  },
  {
    "text": "like a nice shell command here and we've got the output all right cool it's worth",
    "start": "2044639",
    "end": "2052320"
  },
  {
    "text": "mentioning thank",
    "start": "2052320",
    "end": "2055480"
  },
  {
    "text": "you I spotted something interesting in the Alfresco documentation when I was trying to get the server working",
    "start": "2057639",
    "end": "2063040"
  },
  {
    "text": "actually it says the Linux installer uh decide to disable SE Linux systemwide",
    "start": "2063040",
    "end": "2070079"
  },
  {
    "text": "permanently when you run it so that's another bonus I guess uh I should also mention Alfresco",
    "start": "2070079",
    "end": "2077839"
  },
  {
    "text": "isn't an application like WordPress where any old admin can Reas can easily",
    "start": "2077839",
    "end": "2084079"
  },
  {
    "text": "execute arbitary code right there I couldn't find any other ways to execute arbitary code from being an",
    "start": "2084079",
    "end": "2090800"
  },
  {
    "text": "administrator and alesco is available as a cloud service which suggests the same",
    "start": "2090800",
    "end": "2096240"
  },
  {
    "text": "thing okay okay cool This Server goes down yeah right",
    "start": "2096240",
    "end": "2103200"
  },
  {
    "text": "okay this server goes down randomly but I have a counter",
    "start": "2103200",
    "end": "2108440"
  },
  {
    "text": "measure all right this is XY you might have heard of this one uh",
    "start": "2118320",
    "end": "2124440"
  },
  {
    "text": "it's one of the most popular media it's one of the most popular Wiki applications after media Wiki I think",
    "start": "2124440",
    "end": "2132160"
  },
  {
    "text": "and it's quite feature heavy a great thing about xrey is anyone who encounters like by default anyone can",
    "start": "2132160",
    "end": "2138800"
  },
  {
    "text": "just run up and register their own account on it all you need is access to it and you can register an account",
    "start": "2138800",
    "end": "2145119"
  },
  {
    "text": "obviously it won't have very many PRI very many privileges so I'm doing everything here with a self-registered",
    "start": "2145119",
    "end": "2151160"
  },
  {
    "text": "account and if we edit any old page we quickly see that in might support",
    "start": "2151160",
    "end": "2157599"
  },
  {
    "text": "velocity and we've got a payload for velocity so let's see what",
    "start": "2157599",
    "end": "2165119"
  },
  {
    "text": "happens hopefully it won't go down okay so it's failed and that's",
    "start": "2166280",
    "end": "2172720"
  },
  {
    "text": "because the class variable has been quite wisely removed by the xwi de developers so there's no uh Java",
    "start": "2172720",
    "end": "2181599"
  },
  {
    "text": "Reflection available unfortunately so what's left to do but",
    "start": "2181599",
    "end": "2187680"
  },
  {
    "text": "to read the documentation well the key things about velocity are it doesn't require special",
    "start": "2187680",
    "end": "2196000"
  },
  {
    "text": "privileges anyone can run it but it's run inside a sandbox with only access to Safe objects right cool sounds promising",
    "start": "2196000",
    "end": "2203880"
  },
  {
    "text": "and also there are some other scripting languages but you need programming rights to execute them but they're not",
    "start": "2203880",
    "end": "2211440"
  },
  {
    "text": "sandboxed so let me show you what I mean so this is a nice python back door",
    "start": "2211440",
    "end": "2218480"
  },
  {
    "text": "and I can try to inject this but because I don't",
    "start": "2218480",
    "end": "2225400"
  },
  {
    "text": "have privileges it fails right because I don't have programming rights so let's have a look at these",
    "start": "2225400",
    "end": "2232200"
  },
  {
    "text": "safe apis that we've got access to right the first thing you'll notice",
    "start": "2232200",
    "end": "2237520"
  },
  {
    "text": "is that uh they're really enormous there's tons and tons of",
    "start": "2237520",
    "end": "2242640"
  },
  {
    "text": "stuff and the first cool thing that I found is there's this document class which refers to the current document so",
    "start": "2242640",
    "end": "2249800"
  },
  {
    "text": "using a method of this document you can make a Wiki page make an editor itself and then save",
    "start": "2249800",
    "end": "2257319"
  },
  {
    "text": "it and there's something quite interesting here you might notice it yourself uh there's a method called save",
    "start": "2257640",
    "end": "2265000"
  },
  {
    "text": "and there's another method called save as author bearing in mind that the author of a Wiki page is the last person",
    "start": "2265000",
    "end": "2271960"
  },
  {
    "text": "who edited it in other words me so the presence of of the save as",
    "start": "2271960",
    "end": "2277200"
  },
  {
    "text": "author method makes me wonder who the save method might save as perhaps it's the user who's currently",
    "start": "2277200",
    "end": "2283760"
  },
  {
    "text": "viewing the document in fact perhaps it gets the Privileges of the user who's currently",
    "start": "2283760",
    "end": "2289079"
  },
  {
    "text": "viewing the document so what I've done here is taken",
    "start": "2289079",
    "end": "2294200"
  },
  {
    "text": "my nice python back door and I've wrapped it in some velocity which says",
    "start": "2294200",
    "end": "2299839"
  },
  {
    "text": "does the user viewing this page have programming rights if they do okay cool",
    "start": "2299839",
    "end": "2306079"
  },
  {
    "text": "now get to inject this back door and save it",
    "start": "2306079",
    "end": "2313040"
  },
  {
    "text": "so let's just drop this into place",
    "start": "2313880",
    "end": "2319440"
  },
  {
    "text": "and see what happens okay so nothing's happening",
    "start": "2319440",
    "end": "2326200"
  },
  {
    "text": "there because I'm viewing it I don't have I don't have programming rights",
    "start": "2326200",
    "end": "2332560"
  },
  {
    "text": "but if a user if an admin happens to view this page which because I've edited",
    "start": "2332560",
    "end": "2338960"
  },
  {
    "text": "the homepage uh is going to happen pretty promptly I think they don't see anything out of the",
    "start": "2338960",
    "end": "2345440"
  },
  {
    "text": "ordinary either but now my back door has been injected by them",
    "start": "2345440",
    "end": "2351400"
  },
  {
    "text": "unknowingly so if I happen to put a shell command here",
    "start": "2351400",
    "end": "2356760"
  },
  {
    "text": "then and wait for a bit then drum roll yeah all right we've",
    "start": "2356760",
    "end": "2363839"
  },
  {
    "text": "got a show on the server",
    "start": "2363839",
    "end": "2368440"
  },
  {
    "text": "[Applause]",
    "start": "2370150",
    "end": "2375650"
  },
  {
    "text": "cool okay so far I've been kind of a little bit focused on the offense side",
    "start": "2382160",
    "end": "2388319"
  },
  {
    "text": "slightly so let's have a look at what to do if your application has to let users",
    "start": "2388319",
    "end": "2394680"
  },
  {
    "text": "edit templates say it's a business business requirement right the core defense is Simplicity it's using a",
    "start": "2394680",
    "end": "2401960"
  },
  {
    "text": "really simple template engine something like like mustache or Python's built-in",
    "start": "2401960",
    "end": "2409160"
  },
  {
    "text": "template something that basically just does variable substitution is going to offer very little attack surface it'll",
    "start": "2409160",
    "end": "2416480"
  },
  {
    "text": "be really hard to hack okay let's if you have to offer",
    "start": "2416480",
    "end": "2421960"
  },
  {
    "text": "something a bit more advanced than that well",
    "start": "2421960",
    "end": "2427560"
  },
  {
    "text": "you're going to you're going to have a fun time but you can minimize the you",
    "start": "2427560",
    "end": "2432640"
  },
  {
    "text": "can minimize the attack Surface by using a sandbox mode if one is available thoroughly reading the documentation to",
    "start": "2432640",
    "end": "2439200"
  },
  {
    "text": "find out if there's any like secret third party plugins that really code execution really",
    "start": "2439200",
    "end": "2444520"
  },
  {
    "text": "easy uh and yeah only passing the minimum number",
    "start": "2444520",
    "end": "2450800"
  },
  {
    "text": "of attribute the minimum objects like just passing the exact data you need the template to have",
    "start": "2450800",
    "end": "2458318"
  },
  {
    "text": "one method that I've seen used quite effectively as far as I could tell is the approach used by media Wiki and thus",
    "start": "2458520",
    "end": "2465880"
  },
  {
    "text": "Wikipedia so Wikipedia actually lets you embed arbitrary lure code in Wiki Pages",
    "start": "2465880",
    "end": "2471720"
  },
  {
    "text": "which is something I had no idea of over and I had a little bit of a celebration when I found out uh but",
    "start": "2471720",
    "end": "2477960"
  },
  {
    "text": "actually this lure is executed inside a really heavily sandboxed environment so",
    "start": "2477960",
    "end": "2484200"
  },
  {
    "text": "like on the API level all the all the methods and modules that could be used",
    "start": "2484200",
    "end": "2489960"
  },
  {
    "text": "to do anything dangerous have just been removed so it's actually really hard to do something bad with media Wiki sandbox",
    "start": "2489960",
    "end": "2498640"
  },
  {
    "text": "lure even though you can do quite a few things uh I say that not just because",
    "start": "2498640",
    "end": "2505240"
  },
  {
    "text": "I've failed to hack it but because as far as I know no one else has got a shell on Wikipedia",
    "start": "2505240",
    "end": "2510920"
  },
  {
    "text": "recently if your code pen then you need to allow quite a few different template",
    "start": "2513960",
    "end": "2519760"
  },
  {
    "text": "engines and it might not really be feasible to manually sandbox each",
    "start": "2519760",
    "end": "2525119"
  },
  {
    "text": "individual one so what you can fool back to then which is what they've done is",
    "start": "2525119",
    "end": "2531440"
  },
  {
    "text": "using is you is sandboxing the operating system environment using something like",
    "start": "2531440",
    "end": "2537200"
  },
  {
    "text": "Docker and then heavily locking it down so using things like kernel capabilities",
    "start": "2537200",
    "end": "2542440"
  },
  {
    "text": "to prevent the the template from doing things like opening any file handles or",
    "start": "2542440",
    "end": "2549040"
  },
  {
    "text": "accessing the network or and like turning off Set uh set u ID and making",
    "start": "2549040",
    "end": "2554200"
  },
  {
    "text": "the file system read read only and so on so by combining loads of measures like",
    "start": "2554200",
    "end": "2560240"
  },
  {
    "text": "that you can make a Sandbox that's maybe not impossible to break out of uh but",
    "start": "2560240",
    "end": "2566480"
  },
  {
    "text": "it's certainly a huge amount of work please don't think that I'm",
    "start": "2566480",
    "end": "2572319"
  },
  {
    "text": "saying you should just put something in Docker and then forget about it without doing any configuration cuz that won't",
    "start": "2572319",
    "end": "2577559"
  },
  {
    "text": "get you very far okay now I've",
    "start": "2577559",
    "end": "2583200"
  },
  {
    "text": "got five minutes for questions I believe you go back your",
    "start": "2583200",
    "end": "2592240"
  },
  {
    "text": "seven the oh uh so that's part of a word list of 2,000 variable names uh which is",
    "start": "2592880",
    "end": "2600160"
  },
  {
    "text": "available in burp Suite in both versions and it will and I've submitted it to fuz",
    "start": "2600160",
    "end": "2605280"
  },
  {
    "text": "DB but they haven't released it yet so that word list is very much is is is is",
    "start": "2605280",
    "end": "2611680"
  },
  {
    "text": "is very much available yeah does that answer your question",
    "start": "2611680",
    "end": "2617200"
  },
  {
    "text": "Cool okay I'm going to wrap up in several minutes after these questions okay cool",
    "start": "2617200",
    "end": "2626160"
  },
  {
    "text": "y so he said the check is available in burp Suite is it available in the other big players or will it be uh I expect it",
    "start": "2628040",
    "end": "2635119"
  },
  {
    "text": "will be fairly soon I've showed how to automate it it isn't that",
    "start": "2635119",
    "end": "2641838"
  },
  {
    "text": "difficult okay any other questions all right great so the key",
    "start": "2642960",
    "end": "2652079"
  },
  {
    "text": "things to remember are template engines are server side sandboxes if you view",
    "start": "2652079",
    "end": "2657599"
  },
  {
    "text": "them as that you realize how challenging it is to make a template engine that actually holds up template injection is",
    "start": "2657599",
    "end": "2664640"
  },
  {
    "text": "there if you look for it and read explore attack finally I'm I'll be at the back",
    "start": "2664640",
    "end": "2672160"
  },
  {
    "text": "for more questions uh or you can send me an email don't forget to follow me on Twitter thank you for",
    "start": "2672160",
    "end": "2679920"
  },
  {
    "text": "listening",
    "start": "2679920",
    "end": "2682920"
  }
]