[
  {
    "text": "[Music]",
    "start": "860",
    "end": "9200"
  },
  {
    "text": "hello everybody welcome to the ven innovidinovici attacks on etw blind ddrs",
    "start": "9200",
    "end": "14559"
  },
  {
    "text": "presentation by the binary team event tracing for windows or etw",
    "start": "14559",
    "end": "19680"
  },
  {
    "text": "is one of the windows technologies that provide support for various security tools and edr solutions",
    "start": "19680",
    "end": "25439"
  },
  {
    "text": "however attacks on this technology can blind the whole class of security solutions that rely on telemetry from",
    "start": "25439",
    "end": "31439"
  },
  {
    "text": "etw this topic is very important for all the experts dealing with windows security",
    "start": "31439",
    "end": "37120"
  },
  {
    "text": "malware detection and incident response",
    "start": "37120",
    "end": "42120"
  },
  {
    "text": "binary is a former security startup focus on detecting threat originating below the operating system in the",
    "start": "46719",
    "end": "52399"
  },
  {
    "text": "firmware and understand how they moved up the stack into the os kernel and user land to deploy the next stage components",
    "start": "52399",
    "end": "60000"
  },
  {
    "text": "one such component can implement an attack on etw to disable or send bogus events to the os level sensors",
    "start": "60000",
    "end": "67119"
  },
  {
    "text": "as you'll see through this presentation there are plenty of attacks to pick from i'm claudia tortoresco cto and",
    "start": "67119",
    "end": "74400"
  },
  {
    "text": "co-founder of binary thanks to matt driver i have a nickname and as you can see you can use it to call me by my last",
    "start": "74400",
    "end": "81280"
  },
  {
    "text": "name i have great expertise in digital forensic reverse engineering malware and",
    "start": "81280",
    "end": "86479"
  },
  {
    "text": "program analysis to name a few i've been instructor for special topics of moderate analysis at black hat",
    "start": "86479",
    "end": "92720"
  },
  {
    "text": "speaker at multiple security conferences first time speaking at black",
    "start": "92720",
    "end": "98479"
  },
  {
    "text": "i am igor corking i'm just a window security guy who is always looking for",
    "start": "98479",
    "end": "104560"
  },
  {
    "text": "new challenges and discovering new attacks on windows kernel and find the",
    "start": "104560",
    "end": "109680"
  },
  {
    "text": "ways to present them my blog is here please continue",
    "start": "109680",
    "end": "116640"
  },
  {
    "text": "also meet andrei red plate golchikov an expert in windows internals and windows",
    "start": "116640",
    "end": "122000"
  },
  {
    "text": "security has more than 20 years experience researching low level operating system",
    "start": "122000",
    "end": "128239"
  },
  {
    "text": "internals unfortunately andrei lost the coin toss and he will sit out this presentation",
    "start": "128239",
    "end": "134560"
  },
  {
    "text": "agenda modern windows based endpoint detection and response solutions cdrs",
    "start": "134560",
    "end": "140800"
  },
  {
    "text": "leverage etw to detect and mitigate cyber threats and computer issues researchers",
    "start": "140800",
    "end": "147760"
  },
  {
    "text": "are finding ways to disable etw and is of critical importance given that these attacks can blind a whole set of",
    "start": "147760",
    "end": "154800"
  },
  {
    "text": "edr solutions that focus uh and rely on etw for visit visibility into host events",
    "start": "154800",
    "end": "161680"
  },
  {
    "text": "even more important is researching and developing ways to detect if etw has been tampered with and notified the",
    "start": "161680",
    "end": "168239"
  },
  {
    "text": "security solutions in place we'll start our presentation by going over the architecture and features of",
    "start": "168239",
    "end": "174319"
  },
  {
    "text": "ctw next we'll touch on the current state of edw research both in cyber security and",
    "start": "174319",
    "end": "179840"
  },
  {
    "text": "academic space we'll switch our attention to attacks on etw to blind security solutions",
    "start": "179840",
    "end": "185760"
  },
  {
    "text": "we'll go over the published methods of disabling etw and introduce two new",
    "start": "185760",
    "end": "190800"
  },
  {
    "text": "attacks that blind process monitor and windows defender last but not the least we'll introduce",
    "start": "190800",
    "end": "196159"
  },
  {
    "text": "etw check and memory ranger two solutions that can reveal and",
    "start": "196159",
    "end": "201360"
  },
  {
    "text": "prevent attacks on etw",
    "start": "201360",
    "end": "205440"
  },
  {
    "text": "now a little bit about event tracing for windows what it is and what are his components",
    "start": "207120",
    "end": "212959"
  },
  {
    "text": "event tracing for window or shortly etw is a built-in windows login mechanism designed to observe and analyze",
    "start": "212959",
    "end": "219519"
  },
  {
    "text": "application behavior etw was introduced quite a while ago in windows xp as a framework implemented in",
    "start": "219519",
    "end": "226560"
  },
  {
    "text": "the kernel to troubleshoot os components behavior and performance issues since then it has",
    "start": "226560",
    "end": "232319"
  },
  {
    "text": "been expanded and improved significantly for example in windows 11 etw can produce more than 50 000",
    "start": "232319",
    "end": "239680"
  },
  {
    "text": "different event types coming from around the thousand ftp providers",
    "start": "239680",
    "end": "246400"
  },
  {
    "text": "etw has the following advantages it's available system-wide in all recent windows",
    "start": "246400",
    "end": "252319"
  },
  {
    "text": "operating systems without having to be installed loading a kernel driver or os rebooting",
    "start": "252319",
    "end": "258560"
  },
  {
    "text": "supports a standardized framework to produce and consume logging events and also supports high speed logging and",
    "start": "258560",
    "end": "265360"
  },
  {
    "text": "lets application consume events in real time or coming from this file",
    "start": "265360",
    "end": "271680"
  },
  {
    "text": "let's focus a little bit on the etw framework and it's three distinct components first the",
    "start": "271680",
    "end": "277199"
  },
  {
    "text": "controllers which are application that can enable providers and control the lifespan of a session",
    "start": "277199",
    "end": "283360"
  },
  {
    "text": "then providers which are applications that contain event tracing instrumentation and produce events if",
    "start": "283360",
    "end": "289360"
  },
  {
    "text": "enabled by a controller and consumers which are applications that select one or more",
    "start": "289360",
    "end": "294800"
  },
  {
    "text": "event tracing sessions as a source for events they can receive events stored in the log files or from sessions that",
    "start": "294800",
    "end": "302000"
  },
  {
    "text": "send events in real time etw is used to collect events in large-scale business solutions such as",
    "start": "302000",
    "end": "309520"
  },
  {
    "text": "docker or amazon cloudwatch microsoft sql server has been using etw",
    "start": "309520",
    "end": "315600"
  },
  {
    "text": "for more than 10 years",
    "start": "315600",
    "end": "318639"
  },
  {
    "text": "etw providers as you can see in the picture there are myriad of os components that",
    "start": "322080",
    "end": "327600"
  },
  {
    "text": "are supplying atow events from applications services dlls to os kernel",
    "start": "327600",
    "end": "333919"
  },
  {
    "text": "components and drivers i'll now go i'll not go into details everybody can recognize in this table",
    "start": "333919",
    "end": "340240"
  },
  {
    "text": "multiple core components of the windows operating system",
    "start": "340240",
    "end": "345600"
  },
  {
    "text": "using etw for moderate hunting one of the first examples of using atw",
    "start": "350400",
    "end": "355759"
  },
  {
    "text": "tools to reveal and analyze malicious behavior was presented by mark kucinovich in his",
    "start": "355759",
    "end": "362319"
  },
  {
    "text": "top malware hunting with sis internal tools about 10 years ago",
    "start": "362319",
    "end": "368319"
  },
  {
    "text": "since then developers of other ers have leveraged ew to monitor security related events",
    "start": "368319",
    "end": "374000"
  },
  {
    "text": "and to successfully detect and respond to cutting edge malware this internal tool uh process monitor is",
    "start": "374000",
    "end": "381039"
  },
  {
    "text": "leveraging etw for network tracing this late its latest version still",
    "start": "381039",
    "end": "387120"
  },
  {
    "text": "relies on etw for such visibility will demonstrate attack on",
    "start": "387120",
    "end": "392840"
  },
  {
    "text": "etw on process monitor in the in a demo and and technical details will",
    "start": "392840",
    "end": "400000"
  },
  {
    "text": "be provided as well as well a little bit later uh also network shell and packet monitor",
    "start": "400000",
    "end": "406639"
  },
  {
    "text": "windows windows tools provides network troubleshooting diagnostic and the",
    "start": "406639",
    "end": "412000"
  },
  {
    "text": "packets need for functionalities using etw providers such as microsoft windows and this packet capture and microsoft",
    "start": "412000",
    "end": "419039"
  },
  {
    "text": "windows pk team on ew has become a common signal provider",
    "start": "419039",
    "end": "426080"
  },
  {
    "text": "for edr and antivirus solutions to reveal malicious activity and in 2021",
    "start": "426080",
    "end": "431360"
  },
  {
    "text": "there are more than 10 leading market edr solutions that use etw for",
    "start": "431360",
    "end": "437360"
  },
  {
    "text": "threat hunting",
    "start": "437360",
    "end": "440080"
  },
  {
    "text": "etw is on twitter from alex linux providing insight into how to build an edr based",
    "start": "447520",
    "end": "453680"
  },
  {
    "text": "on microsoft threat intelligence etw provider matt graber creating a dynamic analysis",
    "start": "453680",
    "end": "460639"
  },
  {
    "text": "tool based on etw for fun nazaridin informing us how symantec uses ctw to detect",
    "start": "460639",
    "end": "467919"
  },
  {
    "text": "malicious activity or robert demonstrating his edr tools based on etw at this year's black hat",
    "start": "467919",
    "end": "474560"
  },
  {
    "text": "europe arsenal",
    "start": "474560",
    "end": "478039"
  },
  {
    "text": "there are plenty of practical research projects demonstrating the ability of edw to capture malicious activity and",
    "start": "482560",
    "end": "488720"
  },
  {
    "text": "perform threat research and reverse engineering for example zach brown and his dad become presentation showcased",
    "start": "488720",
    "end": "495440"
  },
  {
    "text": "how etw helps office 365 red teams to answer forensic questions",
    "start": "495440",
    "end": "501520"
  },
  {
    "text": "such as uh who's the user that launched the evil process and where the",
    "start": "501520",
    "end": "507120"
  },
  {
    "text": "data has been exponentiated to to monitor dns uh resolutions the author",
    "start": "507120",
    "end": "513120"
  },
  {
    "text": "is leveraging uh microsoft windows dns client etw provider",
    "start": "513120",
    "end": "519039"
  },
  {
    "text": "also darva has sponsored several etw based monitoring systems for malware detection",
    "start": "519039",
    "end": "525760"
  },
  {
    "text": "uh the project windows low-level system monitoring data collection obtains data from many etw",
    "start": "525760",
    "end": "532320"
  },
  {
    "text": "providers including andy uh including from the anti-kerner logger",
    "start": "532320",
    "end": "537600"
  },
  {
    "text": "session to reveal reconstruct various attacks like uh browse exploits and uh",
    "start": "537600",
    "end": "543440"
  },
  {
    "text": "malicious file downloads project marple for forces on hardening enterprise security by automating the",
    "start": "543440",
    "end": "550160"
  },
  {
    "text": "detection of apt uh threats one of its uh pro modules homes collects host telemetry",
    "start": "550160",
    "end": "556880"
  },
  {
    "text": "using etw to produce detection signals for apt campaigns",
    "start": "556880",
    "end": "564480"
  },
  {
    "text": "also apt shell project uses etw for logging system called routines this key",
    "start": "564480",
    "end": "570320"
  },
  {
    "text": "scheme helps detecting remote access trojans by analyzing malicious",
    "start": "570320",
    "end": "576800"
  },
  {
    "text": "behaviors such as key logging screen grabbing remote shell audio recording",
    "start": "576800",
    "end": "582160"
  },
  {
    "text": "and registry uh key manipulation mitral also uh",
    "start": "582160",
    "end": "588959"
  },
  {
    "text": "developed a new etw based security sensor security experts from mitre built a",
    "start": "588959",
    "end": "594800"
  },
  {
    "text": "custom etw based sensor to detect process injection uh capture approach process creation and",
    "start": "594800",
    "end": "601200"
  },
  {
    "text": "termination file creation or deletion with the help of etw providers",
    "start": "601200",
    "end": "607600"
  },
  {
    "text": "research for rnw contracted by german federal office for information security as part",
    "start": "607600",
    "end": "613519"
  },
  {
    "text": "of the ccfos project perform the technical analysis of windows 10 logging capabilities",
    "start": "613519",
    "end": "619279"
  },
  {
    "text": "providing insights and on how etw helps windows telemetry capturing",
    "start": "619279",
    "end": "626800"
  },
  {
    "text": "etw is also in academic papers etw is a hot topic in academic media",
    "start": "631519",
    "end": "639760"
  },
  {
    "text": "papers focused mostly on detecting malicious behavior some examples include malware",
    "start": "639760",
    "end": "645920"
  },
  {
    "text": "characterization using behavioral components from george mason university detecting file as malicious behavior of",
    "start": "645920",
    "end": "652720"
  },
  {
    "text": "dot net c2 agents using etw from university of amsterdam or tactical",
    "start": "652720",
    "end": "657760"
  },
  {
    "text": "provenance analysis for edrs from university of illinois",
    "start": "657760",
    "end": "664000"
  },
  {
    "text": "according to miter cv database in 2021 there is an explanation rising the number of btw related vulnerabilities",
    "start": "668160",
    "end": "675200"
  },
  {
    "text": "that receive the cve number so it is safe to assume that etw has caught the attention of bug hunters",
    "start": "675200",
    "end": "682880"
  },
  {
    "text": "etw is helpful for defenses but it has drawbacks let's look a little bit into that",
    "start": "686560",
    "end": "693600"
  },
  {
    "text": "one of the most important drawback is that etw being implemented being released to be an intern as an internal",
    "start": "697839",
    "end": "704320"
  },
  {
    "text": "tool at the beginning as an opaque structure including undocumented providers and providers that issue",
    "start": "704320",
    "end": "710399"
  },
  {
    "text": "undocumented events etw event templates are stored into the pe resource section under webt",
    "start": "710399",
    "end": "717839"
  },
  {
    "text": "underscore template resource id also etw can be used and leveraged by",
    "start": "717839",
    "end": "723760"
  },
  {
    "text": "living of the land malware because it provides provides a sniffer functionality for file and registry",
    "start": "723760",
    "end": "729839"
  },
  {
    "text": "operations process thread and network activity also you can provide the key logging",
    "start": "729839",
    "end": "734959"
  },
  {
    "text": "functionality since events can be logged to disk in in log files etw can float the hard drive",
    "start": "734959",
    "end": "741680"
  },
  {
    "text": "in a ddos attack also malware can use etw to detect sandbox detonations",
    "start": "741680",
    "end": "748320"
  },
  {
    "text": "and some etw providers are only available in ppl processes",
    "start": "748320",
    "end": "754240"
  },
  {
    "text": "but malware can disable ppl for targeted processes via kernel mode driver without",
    "start": "754240",
    "end": "760800"
  },
  {
    "text": "causing the sod and next disable the hidden etw providers",
    "start": "760800",
    "end": "767639"
  },
  {
    "text": "etw can be bypassed",
    "start": "772240",
    "end": "775760"
  },
  {
    "text": "ways to disable etw logging are widely discussed on twitter from passing a true boolean parameter",
    "start": "778639",
    "end": "785120"
  },
  {
    "text": "into etwp stop trace kernel function to finding an etw specific structure and",
    "start": "785120",
    "end": "791920"
  },
  {
    "text": "dynamically modifying it or patching etw event right user land api to return immediately thus",
    "start": "791920",
    "end": "799120"
  },
  {
    "text": "stopping the user mode loggers",
    "start": "799120",
    "end": "802720"
  },
  {
    "text": "let's look let's look next at some other examples that are using etw to evade the",
    "start": "806320",
    "end": "812000"
  },
  {
    "text": "detection so in march 2018 kaspersky released the report on slingshot a complex and",
    "start": "812000",
    "end": "817920"
  },
  {
    "text": "unknown cyber is fiona platform targeting african and middle east countries",
    "start": "817920",
    "end": "823680"
  },
  {
    "text": "slingshot the first start stage loader renames the etw logs by appending.tmp",
    "start": "823680",
    "end": "830399"
  },
  {
    "text": "extension to avoid leaving traces of its activity mini sling a module in the platform uses",
    "start": "830399",
    "end": "836639"
  },
  {
    "text": "microsoft windows kernel general etw provider to obtain the last reboot time and",
    "start": "836639",
    "end": "842240"
  },
  {
    "text": "microsoft windows kernel power etw provider to obtain the last unsuccessful",
    "start": "842240",
    "end": "847440"
  },
  {
    "text": "attempt attempt to shut down the machine in 2019 local google ransomware",
    "start": "847440",
    "end": "854160"
  },
  {
    "text": "implemented functionality to disable edw by turning off the signals from",
    "start": "854160",
    "end": "859519"
  },
  {
    "text": "microsoft windows wmi activity etw provider via wevt util",
    "start": "859519",
    "end": "866000"
  },
  {
    "text": "tool in august 2021 trend micro researchers published the",
    "start": "866000",
    "end": "872639"
  },
  {
    "text": "details of a new campaign from apt-41 targeting south china sea countries",
    "start": "872639",
    "end": "879199"
  },
  {
    "text": "the researchers mentioned the use of two shellcode launchers that can run payloads uninstall themselves disable",
    "start": "879199",
    "end": "885519"
  },
  {
    "text": "etw to evade detection and also try out credentials in terms of post exploitation",
    "start": "885519",
    "end": "893120"
  },
  {
    "text": "frameworks to disable or bypass edw we can mention sharp point",
    "start": "893120",
    "end": "899839"
  },
  {
    "text": "sharps floyd sorry disable etw monitoring for current process",
    "start": "899839",
    "end": "905440"
  },
  {
    "text": "scrap scarecrow payload creation framework to bypass vrs an idia revision which has around 10",
    "start": "905440",
    "end": "913040"
  },
  {
    "text": "examples of blocking etw locking",
    "start": "913040",
    "end": "916959"
  },
  {
    "text": "in 2020 miter attack framework has introduced the indicator blocking and disable cloud logs sub techniques to",
    "start": "921199",
    "end": "927680"
  },
  {
    "text": "impair defense's technique to describe attacks that maliciously redirect or disable host based sensors",
    "start": "927680",
    "end": "934079"
  },
  {
    "text": "etw included",
    "start": "934079",
    "end": "937800"
  },
  {
    "text": "now let's focus on the big picture of etw attacks",
    "start": "942160",
    "end": "947360"
  },
  {
    "text": "as can be seen in the diagram there are five types of attacks each designated by",
    "start": "953279",
    "end": "958399"
  },
  {
    "text": "a different color targeting each component of the atw architecture",
    "start": "958399",
    "end": "964079"
  },
  {
    "text": "red shows attacks on etw from inside an evil process",
    "start": "964079",
    "end": "969519"
  },
  {
    "text": "light blue shows attacks on etw by modifying the environment variables registry and log files",
    "start": "969519",
    "end": "977040"
  },
  {
    "text": "orange shows attacks on user mode etw providers dark blue shows attacks on kernel mode",
    "start": "977040",
    "end": "983839"
  },
  {
    "text": "edw providers and purple shows attacks on etw sessions",
    "start": "983839",
    "end": "989600"
  },
  {
    "text": "next igor will go over each type and later introduce and demo two brand new attacks on etw",
    "start": "989600",
    "end": "997040"
  },
  {
    "text": "thank you very much it's my turn let me briefly describe attacks on etw",
    "start": "997040",
    "end": "1004240"
  },
  {
    "text": "inside the aerial process as we mentioned before etw provides",
    "start": "1004240",
    "end": "1010000"
  },
  {
    "text": "providers can be loaded in process memory as dlls which implement logging",
    "start": "1010000",
    "end": "1016160"
  },
  {
    "text": "events using event write routine attackers can modify the control flow",
    "start": "1016160",
    "end": "1022800"
  },
  {
    "text": "so that the events won't be locked look at the numbers 1 3 and 5.",
    "start": "1022800",
    "end": "1028880"
  },
  {
    "text": "attackers can directly patch the etw providers functions with supply events",
    "start": "1028880",
    "end": "1035438"
  },
  {
    "text": "see number 2. attackers can send the bogus events by calling event write function",
    "start": "1035439",
    "end": "1042558"
  },
  {
    "text": "finally attackers can modify the internal structure such as process",
    "start": "1042559",
    "end": "1047600"
  },
  {
    "text": "environment block as a result the fake process image file will be locked",
    "start": "1047600",
    "end": "1054480"
  },
  {
    "text": "we can specify one more vector of attacks which includes modifying it w",
    "start": "1054480",
    "end": "1060559"
  },
  {
    "text": "environment variables etw registry settings and log files",
    "start": "1060559",
    "end": "1065760"
  },
  {
    "text": "attackers can disable etw for dotnet applications by zeroing etw environment",
    "start": "1065760",
    "end": "1072400"
  },
  {
    "text": "variables using cmd or registry see number one",
    "start": "1072400",
    "end": "1077440"
  },
  {
    "text": "we have revealed that some utw providers save their settings in registry and",
    "start": "1077440",
    "end": "1083440"
  },
  {
    "text": "these utility providers can be disabled by patching the registry keys",
    "start": "1083440",
    "end": "1088960"
  },
  {
    "text": "see number two finally attackers can manipulate with etw log files to hide their footprints",
    "start": "1088960",
    "end": "1097679"
  },
  {
    "text": "see number three attackers app can disable etw providers",
    "start": "1097679",
    "end": "1104640"
  },
  {
    "text": "running in other user remote processes attackers can disable itw provider",
    "start": "1104640",
    "end": "1111280"
  },
  {
    "text": "globally by locating the corresponding etw data structures such as etw handles",
    "start": "1111280",
    "end": "1119200"
  },
  {
    "text": "trace levels and zeroing their values see number one",
    "start": "1119200",
    "end": "1124480"
  },
  {
    "text": "attackers can disable etw providers for the target processes using three",
    "start": "1124480",
    "end": "1130480"
  },
  {
    "text": "approaches by patching itself data see numbers two frame 4 by patching it will",
    "start": "1130480",
    "end": "1136799"
  },
  {
    "text": "be functions responsible for logging events c numbers 5 6 and 7",
    "start": "1136799",
    "end": "1142799"
  },
  {
    "text": "by calling functions to unregister and disable etw providers as well as",
    "start": "1142799",
    "end": "1148559"
  },
  {
    "text": "terminate it w3s see numbers 8 9 10 and",
    "start": "1148559",
    "end": "1153679"
  },
  {
    "text": "11. finally malware can block logging only for specific events without stopping",
    "start": "1153679",
    "end": "1160720"
  },
  {
    "text": "provider completely see number seven this helps to hide the attack on etw",
    "start": "1160720",
    "end": "1169039"
  },
  {
    "text": "another class of attacks bypasses etw providers using kernel mode driver",
    "start": "1169039",
    "end": "1175440"
  },
  {
    "text": "attackers can disable it w by locating kernel handles and modifying the",
    "start": "1175440",
    "end": "1180960"
  },
  {
    "text": "corresponding data structures c numbers 1 2 3 and 4.",
    "start": "1180960",
    "end": "1186640"
  },
  {
    "text": "another example of globally disabling etw is hooking into trace event",
    "start": "1186640",
    "end": "1193520"
  },
  {
    "text": "see number six here the offer leverages infinity hook",
    "start": "1193520",
    "end": "1199600"
  },
  {
    "text": "which works well on all windows versions from 7 to 10 but due to updates it won't work on used",
    "start": "1199600",
    "end": "1207760"
  },
  {
    "text": "windows releases finally attackers can call custom syscalls which doesn't include etw",
    "start": "1207760",
    "end": "1215679"
  },
  {
    "text": "instrumentation and information about this call won't be locked",
    "start": "1215679",
    "end": "1221039"
  },
  {
    "text": "the final class of attacks is focusing on etw sessions attacker can stop and start italian",
    "start": "1221039",
    "end": "1228320"
  },
  {
    "text": "sessions using etw api as well as built-in tools c number one and two",
    "start": "1228320",
    "end": "1236960"
  },
  {
    "text": "attacker can remove or disable providers from active sessions see number three",
    "start": "1236960",
    "end": "1243840"
  },
  {
    "text": "finally attackers can patch the kernel data structures in order to change the",
    "start": "1243840",
    "end": "1248960"
  },
  {
    "text": "configurations see numbers 7 8 and 9. today we will use",
    "start": "1248960",
    "end": "1255760"
  },
  {
    "text": "these techniques to show you two attacks on etw",
    "start": "1255760",
    "end": "1262000"
  },
  {
    "text": "let's summarize attacks on etw all in all there are 36 different techniques to",
    "start": "1262000",
    "end": "1269360"
  },
  {
    "text": "disable and bypass etw and this number is likely to increase",
    "start": "1269360",
    "end": "1276880"
  },
  {
    "text": "some more details about itw sessions the in the number of running",
    "start": "1276880",
    "end": "1283440"
  },
  {
    "text": "etvw sessions is limited the default maximum number of simultaneously running sessions is 64.",
    "start": "1283440",
    "end": "1292240"
  },
  {
    "text": "users cannot run more sessions than this number the nt kernel supports a maximum of 8",
    "start": "1292240",
    "end": "1300320"
  },
  {
    "text": "system logging sessions with fixed session names one of them",
    "start": "1300320",
    "end": "1305440"
  },
  {
    "text": "is nt kernel logger session it collects various internal events and",
    "start": "1305440",
    "end": "1311520"
  },
  {
    "text": "it is very helpful for edrs however users",
    "start": "1311520",
    "end": "1317760"
  },
  {
    "text": "aren't able to start the nt kernel logger session twice so they need to",
    "start": "1317760",
    "end": "1323679"
  },
  {
    "text": "stop the previously session first before trying another command variation",
    "start": "1323679",
    "end": "1329520"
  },
  {
    "text": "this is a key point for the attack as an example we will look at process",
    "start": "1329520",
    "end": "1336400"
  },
  {
    "text": "monitor which uses absolutely the same technology as many edrs",
    "start": "1336400",
    "end": "1342799"
  },
  {
    "text": "process monitor is free and very popular for malware analysis",
    "start": "1342799",
    "end": "1348640"
  },
  {
    "text": "we choose process monitor to be neutral process monitor launches an etw session",
    "start": "1348640",
    "end": "1356880"
  },
  {
    "text": "to receive network events we have revealed that process monitor version up to 3.60",
    "start": "1356880",
    "end": "1364799"
  },
  {
    "text": "use in t kernel logger newly issued process monitor version",
    "start": "1364799",
    "end": "1370200"
  },
  {
    "text": "3.85 uses session called progmontrace",
    "start": "1370200",
    "end": "1376000"
  },
  {
    "text": "this is the way how process monitor receives network events",
    "start": "1376000",
    "end": "1381760"
  },
  {
    "text": "attackers can stop the running session using session names and start take ones",
    "start": "1381760",
    "end": "1389360"
  },
  {
    "text": "as a result process monitor stops receiving network events",
    "start": "1389360",
    "end": "1394960"
  },
  {
    "text": "even relaunching process monitor doesn't help to continue collecting events",
    "start": "1394960",
    "end": "1401600"
  },
  {
    "text": "let me show you how it works",
    "start": "1401600",
    "end": "1406200"
  },
  {
    "text": "okay let me briefly explain you how etv hijacker works",
    "start": "1696640",
    "end": "1703200"
  },
  {
    "text": "first it stops the target session and starts it and starts its own with the",
    "start": "1703200",
    "end": "1708960"
  },
  {
    "text": "same name then it checks the status of the created session if the malware session has been",
    "start": "1708960",
    "end": "1715600"
  },
  {
    "text": "terminated it repeats from the beginning as long as the malware session is active",
    "start": "1715600",
    "end": "1722159"
  },
  {
    "text": "malware sleeps for a few seconds and then checks the malware session",
    "start": "1722159",
    "end": "1727600"
  },
  {
    "text": "is still active let me briefly tell you about etw check",
    "start": "1727600",
    "end": "1734960"
  },
  {
    "text": "it is a powerful tool developed by red plate to extract various kernel data",
    "start": "1734960",
    "end": "1741200"
  },
  {
    "text": "here you can see bits of information that can be gained and an example of",
    "start": "1741200",
    "end": "1746480"
  },
  {
    "text": "output fragment with vmi logger contacts",
    "start": "1746480",
    "end": "1752480"
  },
  {
    "text": "now let's move on to the secure tv session running by windows defender",
    "start": "1752480",
    "end": "1758100"
  },
  {
    "text": "[Music] windows defender uses two etw sessions",
    "start": "1758100",
    "end": "1764559"
  },
  {
    "text": "defender api logger and defender audit logger both of them are running on a",
    "start": "1764559",
    "end": "1770399"
  },
  {
    "text": "startup as an auto logger so they can be disabled by modifying the startup",
    "start": "1770399",
    "end": "1775520"
  },
  {
    "text": "setting located in registry each etw session has a security",
    "start": "1775520",
    "end": "1780720"
  },
  {
    "text": "descriptor which is located in registry here you can see the value of security descriptor for defender api logger from",
    "start": "1780720",
    "end": "1788559"
  },
  {
    "text": "registry and dumped from the corresponding kernel structure by patching these values you can change",
    "start": "1788559",
    "end": "1796080"
  },
  {
    "text": "the security descriptor now let's move on on",
    "start": "1796080",
    "end": "1801679"
  },
  {
    "text": "querying information about secure etv sessions",
    "start": "1801679",
    "end": "1808200"
  },
  {
    "text": "windows provides a query all trace w api to get",
    "start": "1808960",
    "end": "1814240"
  },
  {
    "text": "information about etw after calling this function the control",
    "start": "1814240",
    "end": "1819440"
  },
  {
    "text": "goes to the kernel and finally to the each wp query trace",
    "start": "1819440",
    "end": "1825760"
  },
  {
    "text": "in the right you can see the cuda code or this function",
    "start": "1825760",
    "end": "1832640"
  },
  {
    "text": "the function includes several security checks that prevent returning information about this session",
    "start": "1832640",
    "end": "1839840"
  },
  {
    "text": "first it checks access rights by comparing access security descriptor and process token",
    "start": "1839840",
    "end": "1846399"
  },
  {
    "text": "second it checks whether the session is marked as security and implemented one",
    "start": "1846399",
    "end": "1852159"
  },
  {
    "text": "more check based on ppl mechanisms by default users cannot query info about",
    "start": "1852159",
    "end": "1859760"
  },
  {
    "text": "defender it adobe sessions because they are running with high privilege with enable security trays",
    "start": "1859760",
    "end": "1867360"
  },
  {
    "text": "both these parameters are located in their my lawyer contact structure",
    "start": "1867360",
    "end": "1873039"
  },
  {
    "text": "these data values are read for each call on this function",
    "start": "1873039",
    "end": "1878559"
  },
  {
    "text": "so malware can load its driver to patch the values inside the target dmi logger",
    "start": "1878559",
    "end": "1886080"
  },
  {
    "text": "contact structure so that the function will always return information about this etw session",
    "start": "1886080",
    "end": "1895039"
  },
  {
    "text": "to query information about security session malware driver has to patch",
    "start": "1895039",
    "end": "1901120"
  },
  {
    "text": "security descriptor and clear security trace flag",
    "start": "1901120",
    "end": "1907120"
  },
  {
    "text": "now let's move on to stopping cq etw sessions",
    "start": "1907120",
    "end": "1912799"
  },
  {
    "text": "windows provides stop trace api to terminate a running",
    "start": "1912799",
    "end": "1917919"
  },
  {
    "text": "session after calling this function the control goes to the kernel and finally to the",
    "start": "1917919",
    "end": "1924559"
  },
  {
    "text": "ewp stop trace in the right you can see",
    "start": "1924559",
    "end": "1929840"
  },
  {
    "text": "see the code of this function the function includes several security",
    "start": "1929840",
    "end": "1936720"
  },
  {
    "text": "checks that prevent stopping the session first it checks where the session can be",
    "start": "1936720",
    "end": "1942480"
  },
  {
    "text": "stopped until stopped using internal flag",
    "start": "1942480",
    "end": "1948640"
  },
  {
    "text": "second it checks access rights by comparing session security descriptor and process token",
    "start": "1948640",
    "end": "1955440"
  },
  {
    "text": "by default users cannot stop defender ety sessions because they are running with high",
    "start": "1955440",
    "end": "1961440"
  },
  {
    "text": "privilege and are not stoppable both these parameters are also located",
    "start": "1961440",
    "end": "1968559"
  },
  {
    "text": "in the mi logger context structure these data values are read for each call",
    "start": "1968559",
    "end": "1974720"
  },
  {
    "text": "of this function so malware can load its driver to patch",
    "start": "1974720",
    "end": "1979760"
  },
  {
    "text": "these values inside the target the my logger cost structure so that the function will always call",
    "start": "1979760",
    "end": "1987600"
  },
  {
    "text": "the function hwp stop logger instance which terminates the session without",
    "start": "1987600",
    "end": "1994080"
  },
  {
    "text": "additional security checks to stop secure utw session malware",
    "start": "1994080",
    "end": "1999679"
  },
  {
    "text": "driver has to patch both security script and logger mode",
    "start": "1999679",
    "end": "2006080"
  },
  {
    "text": "here is the summary of both attacks to query information about the target",
    "start": "2006080",
    "end": "2011679"
  },
  {
    "text": "secure etw session and stop it malware driver has to patch three fields",
    "start": "2011679",
    "end": "2018880"
  },
  {
    "text": "in the corresponding the mi logger content structure in memory",
    "start": "2018880",
    "end": "2025600"
  },
  {
    "text": "let me show you how it works",
    "start": "2025600",
    "end": "2029960"
  },
  {
    "text": "so windows patch guard is a software",
    "start": "2198160",
    "end": "2203520"
  },
  {
    "text": "protection utility designed to forbid the kernel from being patched in order to prevent root kit infections",
    "start": "2203520",
    "end": "2210960"
  },
  {
    "text": "however we can see that patch guard doesn't protect kernel itw structures",
    "start": "2210960",
    "end": "2216320"
  },
  {
    "text": "from illegal right access this is crucial to deal with this issue we can use",
    "start": "2216320",
    "end": "2222880"
  },
  {
    "text": "memory ranger which is a hypervisor based utility that are designed to prevent attacks on",
    "start": "2222880",
    "end": "2228960"
  },
  {
    "text": "kernel memory after loading memorandum allocates a default enclave for the waste and",
    "start": "2228960",
    "end": "2235040"
  },
  {
    "text": "previously loaded drivers memorangic traps loading etw blender",
    "start": "2235040",
    "end": "2240560"
  },
  {
    "text": "driver and moves it to the isolated kernel enclave in runtime with different",
    "start": "2240560",
    "end": "2246880"
  },
  {
    "text": "memory access restrictions using ept memoranger can trap access to",
    "start": "2246880",
    "end": "2252800"
  },
  {
    "text": "the sensitive data and foist the fake null data to the attacker instead of the",
    "start": "2252800",
    "end": "2258160"
  },
  {
    "text": "real one memorandum is a proof of concept that can be customized for solving various",
    "start": "2258160",
    "end": "2264400"
  },
  {
    "text": "security tasks let me show you how it works",
    "start": "2264400",
    "end": "2271160"
  },
  {
    "text": "[Music]",
    "start": "2411560",
    "end": "2414750"
  },
  {
    "text": "so operating system is protected etw was originally designed to perform",
    "start": "2426400",
    "end": "2433119"
  },
  {
    "text": "software diagnostics and nowadays it is widely used by various edrs and cyber",
    "start": "2433119",
    "end": "2439200"
  },
  {
    "text": "security solutions it is crucial to understand the attacks on etw because",
    "start": "2439200",
    "end": "2444640"
  },
  {
    "text": "these attacks can disable the whole class of security solutions",
    "start": "2444640",
    "end": "2449920"
  },
  {
    "text": "etw includes some design issues which makes it possible to bypass it",
    "start": "2449920",
    "end": "2456640"
  },
  {
    "text": "we've presented a new tool called etv check that can detect etw attacks",
    "start": "2456640",
    "end": "2463280"
  },
  {
    "text": "memorandum can be customized to prevent patching sensitive kernel etw data",
    "start": "2463280",
    "end": "2470720"
  },
  {
    "text": "claudio can i ask you to go on please as a conclusion to conclusion i want to",
    "start": "2470720",
    "end": "2476079"
  },
  {
    "text": "leave the audience with a possible scenario let's assume that an attacks originating the former",
    "start": "2476079",
    "end": "2481599"
  },
  {
    "text": "says persistence executes the next stage payload to move up in the kernel where it can implement one of the attacks",
    "start": "2481599",
    "end": "2487920"
  },
  {
    "text": "showcased in this presentation this will be devastating due to its stealth net and resilience to os",
    "start": "2487920",
    "end": "2493760"
  },
  {
    "text": "reinstallation and hard drive replacing that's why today security solutions",
    "start": "2493760",
    "end": "2498800"
  },
  {
    "text": "might resist must receive signals from below and above the operating system to",
    "start": "2498800",
    "end": "2504640"
  },
  {
    "text": "be able to respond effectively to such threats thank you and see you next time",
    "start": "2504640",
    "end": "2512279"
  }
]