[
  {
    "text": "good afternoon everyone welcome to PLC blaster a worm living solely in the PLC",
    "start": "30",
    "end": "5040"
  },
  {
    "text": "we are currently in South Seas I J with Mike Brueggemann before we begin a few",
    "start": "5040",
    "end": "13530"
  },
  {
    "text": "brief notes be sure to stop by the business hall located in Bayside a/b also the black head Arsenal is on in the",
    "start": "13530",
    "end": "21480"
  },
  {
    "text": "palm foyer on level 3 and the Arsenal reception is at 1700 also if you haven't",
    "start": "21480",
    "end": "26670"
  },
  {
    "text": "picked up your merchandise today it is your last chance so visit the black hat swag and bookstore and also visit the",
    "start": "26670",
    "end": "33809"
  },
  {
    "text": "Kali Linux lab and Mandalay Bay a and thank you all for putting your phones on",
    "start": "33809",
    "end": "39000"
  },
  {
    "text": "vibrate got further ado Mikey thank you very much so",
    "start": "39000",
    "end": "50940"
  },
  {
    "text": "my name is Mike and I'm going to present our research on industrial control systems now before I start I would like",
    "start": "50940",
    "end": "58980"
  },
  {
    "text": "to give a short introduction about who we are I work in a small company called",
    "start": "58980",
    "end": "64619"
  },
  {
    "text": "open source security and we are located in Germany we are mainly focused on",
    "start": "64619",
    "end": "70710"
  },
  {
    "text": "Linux security but a few years ago we started to pentest",
    "start": "70710",
    "end": "76320"
  },
  {
    "text": "embedded devices and related technology for example IFI DS systems in addition",
    "start": "76320",
    "end": "82799"
  },
  {
    "text": "we do pen testing and research on industrial control systems and that is",
    "start": "82799",
    "end": "89939"
  },
  {
    "text": "the reason why I'm here today we developed a warm which is able to spread over PLC's our research was",
    "start": "89939",
    "end": "97619"
  },
  {
    "text": "motivated by the Stuxnet worm Stuxnet was a warm that attacks demons PLC's it",
    "start": "97619",
    "end": "106170"
  },
  {
    "text": "uses windows box and windows to spread and that means it requires Windows to",
    "start": "106170",
    "end": "112290"
  },
  {
    "text": "spread starting from this assumption we were wondering if it's possible to",
    "start": "112290",
    "end": "117780"
  },
  {
    "text": "create a warm that is able to spread with out any external heart or software",
    "start": "117780",
    "end": "124680"
  },
  {
    "text": "support and the answer is yes it is possible before I show you how you how",
    "start": "124680",
    "end": "131580"
  },
  {
    "text": "we implemented the warm I we'll give you some background information on the PLC we chose for our",
    "start": "131580",
    "end": "138420"
  },
  {
    "text": "work we chose PLC called s7 1200 it's a Siemens PLC and it's",
    "start": "138420",
    "end": "146579"
  },
  {
    "text": "built for a small application we chose this one because it's cheap it costs",
    "start": "146579",
    "end": "152069"
  },
  {
    "text": "about $150 it has 50 kilobytes of RAM and one megabyte of person persistent",
    "start": "152069",
    "end": "160049"
  },
  {
    "text": "memory it has built-in Ethernet and we looked at it in firmware version 3 and",
    "start": "160049",
    "end": "167370"
  },
  {
    "text": "we looked at CI a portal in version 11 the TRA portal is a software that is",
    "start": "167370",
    "end": "173939"
  },
  {
    "text": "used to program the plc compared to usual computers the system works",
    "start": "173939",
    "end": "182790"
  },
  {
    "text": "different it works in cycles each cycle will start with reading the inputs and",
    "start": "182790",
    "end": "188819"
  },
  {
    "text": "writing the outputs after that the user program is executed the user program is",
    "start": "188819",
    "end": "194700"
  },
  {
    "text": "a piece of software that is written by an engineer and controls the machine for",
    "start": "194700",
    "end": "200069"
  },
  {
    "text": "example a traffic light or an assembly line or what machine ever after that",
    "start": "200069",
    "end": "206239"
  },
  {
    "text": "there are other tasks taking place for example communication with other PLC's",
    "start": "206239",
    "end": "212340"
  },
  {
    "text": "each cycle has a time limit and Siemens Piercy's it's usually 150 milliseconds",
    "start": "212340",
    "end": "221040"
  },
  {
    "text": "if one cycle takes longer than 150 milliseconds the PLC will stop the",
    "start": "221040",
    "end": "227489"
  },
  {
    "text": "execution and switch and to an error mode and the cycle is controlled by the",
    "start": "227489",
    "end": "233040"
  },
  {
    "text": "firmware the the program that you can",
    "start": "233040",
    "end": "238530"
  },
  {
    "text": "write for the PLC is structured in so called program blocks there are six",
    "start": "238530",
    "end": "244680"
  },
  {
    "text": "different types of program blocks the first is called organization block it's the entry point of the program and can",
    "start": "244680",
    "end": "252689"
  },
  {
    "text": "be seen as a main function known from see there are function blocks it's",
    "start": "252689",
    "end": "257970"
  },
  {
    "text": "basically it's basically classes and on from object orientated programming",
    "start": "257970",
    "end": "263510"
  },
  {
    "text": "languages and there are functions functions similar to",
    "start": "263510",
    "end": "271740"
  },
  {
    "text": "normal functions known from C there are system function blocks and system",
    "start": "271740",
    "end": "277230"
  },
  {
    "text": "functions this is a library which is delivered by the vendor and in the end",
    "start": "277230",
    "end": "283770"
  },
  {
    "text": "we have data blocks data blocks are some kind of global memory you can access it",
    "start": "283770",
    "end": "290400"
  },
  {
    "text": "from everywhere in your program and can store any data in it these program",
    "start": "290400",
    "end": "295980"
  },
  {
    "text": "blocks are programmed and different can be programmed in different programming languages for example letter diagram",
    "start": "295980",
    "end": "302750"
  },
  {
    "text": "here or function function block diagram and this is our graphical based",
    "start": "302750",
    "end": "310710"
  },
  {
    "text": "programming languages and they are used by electricians who are familiar with",
    "start": "310710",
    "end": "316830"
  },
  {
    "text": "this kind of diagrams they're also text-based programming languages for",
    "start": "316830",
    "end": "322260"
  },
  {
    "text": "example structured text we choose chose this one to implement the warm yes if",
    "start": "322260",
    "end": "330750"
  },
  {
    "text": "you want to implement it appear you see only warm you have to do it in the programming language of the PLC what",
    "start": "330750",
    "end": "339090"
  },
  {
    "text": "parts you have to to implement the first part is the target discovery because",
    "start": "339090",
    "end": "345360"
  },
  {
    "text": "warm has to find its targets by its own after that the warm wants to copy itself",
    "start": "345360",
    "end": "353280"
  },
  {
    "text": "to the target system so we need to carry a mechanism after that is a copy and",
    "start": "353280",
    "end": "359400"
  },
  {
    "text": "needs to be activated so the execution of the copy needs to be started and in",
    "start": "359400",
    "end": "366300"
  },
  {
    "text": "the end an attacker wants to have payloads to do some evil stuff on the PLC we implemented all four parts and",
    "start": "366300",
    "end": "373919"
  },
  {
    "text": "I'm going to show you how we did so step-by-step I will start with target discovery the first thing you need if",
    "start": "373919",
    "end": "382800"
  },
  {
    "text": "you want to find pocs on your network is characteristics that allows us allows",
    "start": "382800",
    "end": "388410"
  },
  {
    "text": "you to identify them all cement species have an open TCP port 102 so if you find",
    "start": "388410",
    "end": "396690"
  },
  {
    "text": "an open TCP port 102 and Network the probability is high that you",
    "start": "396690",
    "end": "401760"
  },
  {
    "text": "found a Siemens PLC our basic idea here was to implement a port scanner in the",
    "start": "401760",
    "end": "408270"
  },
  {
    "text": "programming language of the PLC we have two system function blocks that helped",
    "start": "408270",
    "end": "414060"
  },
  {
    "text": "us the first is called t-con it opens a new TCP connection and T disk on and",
    "start": "414060",
    "end": "419820"
  },
  {
    "text": "closes a TCP connection on this slide we can see as a call of the Deacon Deacon",
    "start": "419820",
    "end": "427980"
  },
  {
    "text": "function as a a lot of parameters that are passed to the function the most important as IP address and support you",
    "start": "427980",
    "end": "435720"
  },
  {
    "text": "want to connect to after the first call of this function the firmware will",
    "start": "435720",
    "end": "441870"
  },
  {
    "text": "process this function in background and in the next cycle we come back to this",
    "start": "441870",
    "end": "447090"
  },
  {
    "text": "part of the code and cause a function again and now the function will tell us",
    "start": "447090",
    "end": "453300"
  },
  {
    "text": "if the connection was established successfully if yes we found a new plc",
    "start": "453300",
    "end": "458400"
  },
  {
    "text": "and can continue with our infection if not we have a little problem because",
    "start": "458400",
    "end": "464000"
  },
  {
    "text": "this function does not implement a timeout so we have to do it by ourself we simply count the cycles in which we",
    "start": "464000",
    "end": "472920"
  },
  {
    "text": "failed to establish to establish a new connection and if we hit a upper limit",
    "start": "472920",
    "end": "479130"
  },
  {
    "text": "we go cause the T discount function the",
    "start": "479130",
    "end": "484200"
  },
  {
    "text": "function will fail because you cannot close connections that was never established but it frees the resources",
    "start": "484200",
    "end": "491580"
  },
  {
    "text": "for the next IP address we want to try and the bottom corner you can see how we select the IP address as the next IP",
    "start": "491580",
    "end": "499290"
  },
  {
    "text": "address we simply count up the last byte of a four byte IP address and that means",
    "start": "499290",
    "end": "505320"
  },
  {
    "text": "we are scan and slash 24 subnet for an open TCP what 102 okay that is a target",
    "start": "505320",
    "end": "513599"
  },
  {
    "text": "discovery the next thing is the carrier mechanism normally user programs",
    "start": "513600",
    "end": "520370"
  },
  {
    "text": "transferred with the help of the TI a portal via TCP to the PLC and our basic",
    "start": "520370",
    "end": "528570"
  },
  {
    "text": "idea here was to implement this protocol in the PLC programming line which again we have two functions T sent",
    "start": "528570",
    "end": "535980"
  },
  {
    "text": "and T receive you can send and receive any TCP data with them that had to us",
    "start": "535980",
    "end": "543450"
  },
  {
    "text": "with this task the hard part here was to understand the protocol that is used to",
    "start": "543450",
    "end": "550500"
  },
  {
    "text": "download or to transfer programs between the PSC and the TI a Porter it is called",
    "start": "550500",
    "end": "558210"
  },
  {
    "text": "protocol is called s7 com+ it is a binary protocol and there is no public",
    "start": "558210",
    "end": "566030"
  },
  {
    "text": "documentation available on how the protocol is working see a huge difference compared to the old protocol",
    "start": "566030",
    "end": "573450"
  },
  {
    "text": "used with s7 300/400 PLC's it was",
    "start": "573450",
    "end": "579360"
  },
  {
    "text": "slightly modified in the new former version or in the 7500 devices and it",
    "start": "579360",
    "end": "587130"
  },
  {
    "text": "allows us to transfer programs to the PLC or back into the TI Porter you can",
    "start": "587130",
    "end": "594630"
  },
  {
    "text": "do other things for example start or stop the CPU you can change the outputs with the help of this protocol now I'm",
    "start": "594630",
    "end": "603810"
  },
  {
    "text": "going to show you what we found out about this protocol on this slide you can see the first message that is sent",
    "start": "603810",
    "end": "611490"
  },
  {
    "text": "from the TI a portal to the PLC if it wants to establish a new connection the",
    "start": "611490",
    "end": "618420"
  },
  {
    "text": "protocol will start with a magic byte 7 - after that there's a version field",
    "start": "618420",
    "end": "625310"
  },
  {
    "text": "there's a length field which tells us how many data is transferred in this",
    "start": "625310",
    "end": "631470"
  },
  {
    "text": "message we have a type field which tells us something about the intention of the",
    "start": "631470",
    "end": "637410"
  },
  {
    "text": "message for example request error response as a reserved field we have a",
    "start": "637410",
    "end": "642630"
  },
  {
    "text": "subtype which tells us something about the intention of the message in more",
    "start": "642630",
    "end": "648540"
  },
  {
    "text": "detail and we have a sequence number the sequence number is simply incremented in",
    "start": "648540",
    "end": "654600"
  },
  {
    "text": "every message in the end we have a frame and delimiter and if this frame and delimiter is missing it simply means",
    "start": "654600",
    "end": "661950"
  },
  {
    "text": "that the message is continued in the next message and between between the message shed and",
    "start": "661950",
    "end": "674790"
  },
  {
    "text": "the prime enter limiter say a lot of a lot of more bytes and in the beginning",
    "start": "674790",
    "end": "679860"
  },
  {
    "text": "of our analyst we had problems to find any structure in these bytes but if you",
    "start": "679860",
    "end": "686339"
  },
  {
    "text": "look close enough you will find a lot of a three bytes this is a three bytes",
    "start": "686339",
    "end": "691759"
  },
  {
    "text": "introduce a so called attribute block attribute blocks structures the data",
    "start": "691759",
    "end": "698490"
  },
  {
    "text": "that is actually transferred with this protocol like the whole message is",
    "start": "698490",
    "end": "705829"
  },
  {
    "text": "attribute block as a basic layout it starts with a three bite there's an",
    "start": "705829",
    "end": "711389"
  },
  {
    "text": "ID field which tells us which value is transferred in this example it's some",
    "start": "711389",
    "end": "717540"
  },
  {
    "text": "kind of service session there's a field which is usually 0 it's maybe some kind",
    "start": "717540",
    "end": "724410"
  },
  {
    "text": "of format there's a data type field in this case it's a spring a string has a",
    "start": "724410",
    "end": "730379"
  },
  {
    "text": "lengths field and in the end the actual value is placed it's a beginning our",
    "start": "730379",
    "end": "738029"
  },
  {
    "text": "analysts we had problems to pass this attribute correctly because all the lengths value the lengths fields",
    "start": "738029",
    "end": "745769"
  },
  {
    "text": "contained wrong values and this is because numbers have a dynamic size in",
    "start": "745769",
    "end": "753299"
  },
  {
    "text": "this protocol you can see in the first example it starts with it starts with a",
    "start": "753299",
    "end": "759089"
  },
  {
    "text": "1 bit and that means there's a following byte which also belongs to this number",
    "start": "759089",
    "end": "764100"
  },
  {
    "text": "in contrast to that as a 16 it starts with a 0 and that means there is no byte",
    "start": "764100",
    "end": "770879"
  },
  {
    "text": "following after that we were able to pass the blocks correctly on this slide",
    "start": "770879",
    "end": "781019"
  },
  {
    "text": "you can see the second message the second message is replayed by the plc is",
    "start": "781019",
    "end": "789029"
  },
  {
    "text": "yes it's an empty reply protection in this message we are only interested in",
    "start": "789029",
    "end": "795720"
  },
  {
    "text": "one bite and as a bread frame to bite and what you have to do is that you need",
    "start": "795720",
    "end": "803010"
  },
  {
    "text": "to flip the first bit of this byte and put the result and all your messages",
    "start": "803010",
    "end": "809130"
  },
  {
    "text": "that you are going to send to the PLC so you can see the result in the third",
    "start": "809130",
    "end": "815340"
  },
  {
    "text": "message here you need to place a result here and this is a certain message and",
    "start": "815340",
    "end": "822150"
  },
  {
    "text": "the third message completes the connection setup there's another",
    "start": "822150",
    "end": "827300"
  },
  {
    "text": "interesting message that is a program transfer message the header has two or",
    "start": "827300",
    "end": "835500"
  },
  {
    "text": "more interesting fields the first is a block type it defines program it defines",
    "start": "835500",
    "end": "841380"
  },
  {
    "text": "the type of the program block we want to download for example function block data",
    "start": "841380",
    "end": "846960"
  },
  {
    "text": "block so the ones I mentioned before and as a block number the block number is a",
    "start": "846960",
    "end": "852420"
  },
  {
    "text": "place where it's a the program block is taught on the PSC after that say a lot",
    "start": "852420",
    "end": "860460"
  },
  {
    "text": "of attribute blocks which transfer a lot of values for example is a modification",
    "start": "860460",
    "end": "866610"
  },
  {
    "text": "time of the program block the source code of the program block is taught on",
    "start": "866610",
    "end": "872880"
  },
  {
    "text": "the PSC is a byte code that is actually executed by the plc is taught on the plc",
    "start": "872880",
    "end": "880140"
  },
  {
    "text": "and some of these values are only used by the plc for example the byte code and others are only used by the TI portal in",
    "start": "880140",
    "end": "888210"
  },
  {
    "text": "case you want to receive your program back out of the plc okay at this point",
    "start": "888210",
    "end": "897030"
  },
  {
    "text": "we knew enough to create own messages and to download or transfer own programs",
    "start": "897030",
    "end": "905400"
  },
  {
    "text": "and we started to play with the protocol and we found some security flaws that",
    "start": "905400",
    "end": "911400"
  },
  {
    "text": "are interesting if you want to implement one the first problem is a problem with",
    "start": "911400",
    "end": "917040"
  },
  {
    "text": "data redundancy as I mentioned before the block number is a place where as a",
    "start": "917040",
    "end": "924960"
  },
  {
    "text": "block is taught on the plc and it's transferred in the message head but it's",
    "start": "924960",
    "end": "930930"
  },
  {
    "text": "also transferred later in the message attribute block so the question is which",
    "start": "930930",
    "end": "936959"
  },
  {
    "text": "of this values is evaluated by Siemens and the answer is both of them the first",
    "start": "936959",
    "end": "943230"
  },
  {
    "text": "is only evaluated or used by the PSE and the second soin used by the TI a portal",
    "start": "943230",
    "end": "950220"
  },
  {
    "text": "now consider the following situation you create a new program transfer message",
    "start": "950220",
    "end": "956910"
  },
  {
    "text": "and choose a free number in the message head which is used by the PSE but you",
    "start": "956910",
    "end": "962910"
  },
  {
    "text": "choose a number that is already existing on the plc in the in the attribute block",
    "start": "962910",
    "end": "970139"
  },
  {
    "text": "that is only used by the TI a Porter now you transfer this message to the PLC and",
    "start": "970139",
    "end": "976439"
  },
  {
    "text": "the PLC will check the message chat and we'll place the program block to a free",
    "start": "976439",
    "end": "981989"
  },
  {
    "text": "slot and we'll start the execution if later an engineer wants to check the",
    "start": "981989",
    "end": "987809"
  },
  {
    "text": "program maybe he recognizes strange behavior in his industrial network he",
    "start": "987809",
    "end": "994079"
  },
  {
    "text": "will use the TI a portal and the TI portal will download all program blocks that are on the PLC now the PLC will get",
    "start": "994079",
    "end": "1003649"
  },
  {
    "text": "in trouble because it sees that there are two blocks with the same number but",
    "start": "1003649",
    "end": "1009040"
  },
  {
    "text": "that is not possible so the TI a portal will solve this problem by only displaying one of the",
    "start": "1009040",
    "end": "1017600"
  },
  {
    "text": "program blocks and this allows us to hide parts of our code in front of the eyes of the engineer but this is not",
    "start": "1017600",
    "end": "1026839"
  },
  {
    "text": "working with data blocks there's another problem with data redundancy the code",
    "start": "1026839",
    "end": "1034188"
  },
  {
    "text": "stored tries it's stored as XML source a source code the source code is only",
    "start": "1034189",
    "end": "1041178"
  },
  {
    "text": "displayed by the TI portal and the byte code so byte code is executed by the PLC",
    "start": "1041179",
    "end": "1048048"
  },
  {
    "text": "and if you want to create a Misha Misha Misha Lee's program you just write it",
    "start": "1048049",
    "end": "1055940"
  },
  {
    "text": "and then you remove malicious commands from the source code and download",
    "start": "1055940",
    "end": "1061639"
  },
  {
    "text": "everything to the PLC if if an engineer will later check the program",
    "start": "1061639",
    "end": "1067610"
  },
  {
    "text": "is running on the PSC he onlywill sees a clean source code and thinks that",
    "start": "1067610",
    "end": "1073040"
  },
  {
    "text": "everything is okay but the bytecode will actually execute the malicious commands",
    "start": "1073040",
    "end": "1081160"
  },
  {
    "text": "yes and you can leave out blocks that",
    "start": "1081160",
    "end": "1086210"
  },
  {
    "text": "are only used by the TI portal at all and this helps us to reduce the size of",
    "start": "1086210",
    "end": "1091940"
  },
  {
    "text": "the bomb okay at this point we knew a",
    "start": "1091940",
    "end": "1097010"
  },
  {
    "text": "lot about the protocol we knew how to set up a new connection we knew how to",
    "start": "1097010",
    "end": "1102160"
  },
  {
    "text": "overcome the anti replay protection and we implemented everything with the help",
    "start": "1102160",
    "end": "1108770"
  },
  {
    "text": "of the TI a portal so messages messages that I used to transfer as a warm",
    "start": "1108770",
    "end": "1115220"
  },
  {
    "text": "program stored in data blocks the problem here is that you cannot create",
    "start": "1115220",
    "end": "1121640"
  },
  {
    "text": "the data blocks with the help of the TI a portal because you only know the exact",
    "start": "1121640",
    "end": "1128600"
  },
  {
    "text": "content of the messages when you finish programming what we what you have to do",
    "start": "1128600",
    "end": "1134299"
  },
  {
    "text": "is that you create the blocks manually you just download the warm with the help",
    "start": "1134299",
    "end": "1141140"
  },
  {
    "text": "of the TI portal we will capture all messages receive the messages from the",
    "start": "1141140",
    "end": "1147410"
  },
  {
    "text": "dumps and create the messages by your",
    "start": "1147410",
    "end": "1152660"
  },
  {
    "text": "own and then in the end you can inject everything with your own tool okay that",
    "start": "1152660",
    "end": "1158570"
  },
  {
    "text": "is a carrier the next thing is the activation function so this is very",
    "start": "1158570",
    "end": "1164330"
  },
  {
    "text": "simple because you need to know that as",
    "start": "1164330",
    "end": "1170330"
  },
  {
    "text": "I mentioned before organization blocks the entry point of the program but you",
    "start": "1170330",
    "end": "1176179"
  },
  {
    "text": "need to know that on PCs you can have more than one main function and you",
    "start": "1176179",
    "end": "1181910"
  },
  {
    "text": "simply add an additional organization block and the plc will start the",
    "start": "1181910",
    "end": "1187610"
  },
  {
    "text": "execution of this block so it's built-in and we have to do nothing in the end we",
    "start": "1187610",
    "end": "1196550"
  },
  {
    "text": "want to create some payloads and because we are part of the normal human",
    "start": "1196550",
    "end": "1201580"
  },
  {
    "text": "user program we can do whatever a normal user program can do for example we can",
    "start": "1201580",
    "end": "1207669"
  },
  {
    "text": "stop the execution of the plc we can manipulate the outputs we have the TCP",
    "start": "1207669",
    "end": "1213580"
  },
  {
    "text": "functions to to implement a command and control server or proxy or whatever we",
    "start": "1213580",
    "end": "1219549"
  },
  {
    "text": "like yes so we implemented all four parts and now I have a little demo what",
    "start": "1219549",
    "end": "1229570"
  },
  {
    "text": "you will see is that there's an attacker the attacker will in fact the first PLC",
    "start": "1229570",
    "end": "1235179"
  },
  {
    "text": "and after that as a warm we'll spread over the PLC's and in the end as a warm",
    "start": "1235179",
    "end": "1242499"
  },
  {
    "text": "as the warms connect back to our command and control server which is running on",
    "start": "1242499",
    "end": "1248470"
  },
  {
    "text": "the attackers computer so ok I created a movie here you can see our small example",
    "start": "1248470",
    "end": "1259119"
  },
  {
    "text": "of factory the factory is controlled by 4 Siemens PLC so you can see as I'm in",
    "start": "1259119",
    "end": "1265450"
  },
  {
    "text": "the top corner and the different parts of the fabric are controlled by",
    "start": "1265450",
    "end": "1271899"
  },
  {
    "text": "different PLC's and this example our machine produces little yellow things",
    "start": "1271899",
    "end": "1278080"
  },
  {
    "text": "and yeah everything is working normally",
    "start": "1278080",
    "end": "1284159"
  },
  {
    "text": "what you will see next is that I connect disconnect 3 PLC's from the network",
    "start": "1284159",
    "end": "1291940"
  },
  {
    "text": "because I want to prevent the warm from spreading too fast ok I think this will",
    "start": "1291940",
    "end": "1302139"
  },
  {
    "text": "happen now",
    "start": "1302139",
    "end": "1305609"
  },
  {
    "text": "okay now as three EPs seats are disconnected and on the right side you",
    "start": "1313290",
    "end": "1319020"
  },
  {
    "text": "can see the attacker screen the attacker will start a command and control server now it's a little pison script written",
    "start": "1319020",
    "end": "1324900"
  },
  {
    "text": "by us and the command and control server waits for new connections now the",
    "start": "1324900",
    "end": "1331530"
  },
  {
    "text": "attacker will infect the first PLC again a little pison script written by us and",
    "start": "1331530",
    "end": "1337410"
  },
  {
    "text": "now you will see that the infection is in progress it takes some seconds and now the first",
    "start": "1337410",
    "end": "1348960"
  },
  {
    "text": "PLC is infected now I will reconnect the three PLC so you see as a first warm",
    "start": "1348960",
    "end": "1357660"
  },
  {
    "text": "already connected to our romantic control server and now the warm will",
    "start": "1357660",
    "end": "1362880"
  },
  {
    "text": "start to spread over the other PLC's you",
    "start": "1362880",
    "end": "1369150"
  },
  {
    "text": "can see that the factory are still working normally but there's a short",
    "start": "1369150",
    "end": "1377100"
  },
  {
    "text": "moment during the infection and I think it's right now the yellow piece is not",
    "start": "1377100",
    "end": "1382830"
  },
  {
    "text": "moving and whereas our original user program is interrupted so now the second",
    "start": "1382830",
    "end": "1390990"
  },
  {
    "text": "PLC connected and after this short period of time the PC works as usually",
    "start": "1390990",
    "end": "1401450"
  },
  {
    "text": "now I think the other two are infected so we have the same problem with this",
    "start": "1401450",
    "end": "1406950"
  },
  {
    "text": "little yellow piece again and you can see all pcs are connected now after",
    "start": "1406950",
    "end": "1414330"
  },
  {
    "text": "after that as a factory works normally again so there's no way to see that that",
    "start": "1414330",
    "end": "1421950"
  },
  {
    "text": "they are infected now what I'm going to",
    "start": "1421950",
    "end": "1426960"
  },
  {
    "text": "show you now is that you can control the PLC's with the help of the chromatic",
    "start": "1426960",
    "end": "1434250"
  },
  {
    "text": "control service for example we can switch the outputs to values we like you",
    "start": "1434250",
    "end": "1441600"
  },
  {
    "text": "will see that as a slider on the left side will move but there's no yet",
    "start": "1441600",
    "end": "1446790"
  },
  {
    "text": "peace okay now it's moving so you can control the PLC's with the help of the",
    "start": "1446790",
    "end": "1456060"
  },
  {
    "text": "kamati control service you can start the assembly lines we can start the next",
    "start": "1456060",
    "end": "1464160"
  },
  {
    "text": "assembly line okay now both of them are",
    "start": "1464160",
    "end": "1473580"
  },
  {
    "text": "moving and we can stop everything again we can set the outputs to random values",
    "start": "1473580",
    "end": "1480120"
  },
  {
    "text": "for example in all the fabric is out of control and it is broken now in this",
    "start": "1480120",
    "end": "1489930"
  },
  {
    "text": "example it's it's very easy to repair it you will see that I have to repair it",
    "start": "1489930",
    "end": "1495540"
  },
  {
    "text": "and if you're saying so I stopped everything now so slightly is not moving",
    "start": "1495540",
    "end": "1503040"
  },
  {
    "text": "but now it's fixed in this case it's",
    "start": "1503040",
    "end": "1508380"
  },
  {
    "text": "very easy it's a it's a small factory but if it's a real factory will speak an",
    "start": "1508380",
    "end": "1513810"
  },
  {
    "text": "expensive machines Yama machines are broken now maybe so the next I'll slider",
    "start": "1513810",
    "end": "1520170"
  },
  {
    "text": "is also broken I fix it too now all the factories working again what",
    "start": "1520170",
    "end": "1528780"
  },
  {
    "text": "I'm going to show you next is that we implemented a proxy server and what you",
    "start": "1528780",
    "end": "1535860"
  },
  {
    "text": "can do is that the PLC connects to us to the command and control server and we",
    "start": "1535860",
    "end": "1541860"
  },
  {
    "text": "can use this connection to connect back into the industrial network and can reach targets in this network with the",
    "start": "1541860",
    "end": "1549690"
  },
  {
    "text": "help of the proxy server so the proxy server is charted and now I will do an",
    "start": "1549690",
    "end": "1555420"
  },
  {
    "text": "nmap scan with of one PLC with the help of another PSC okay I think the scan",
    "start": "1555420",
    "end": "1564330"
  },
  {
    "text": "will start in a few seconds yeah okay",
    "start": "1564330",
    "end": "1570150"
  },
  {
    "text": "now it starts to scan so the the proxies",
    "start": "1570150",
    "end": "1576240"
  },
  {
    "text": "changed comma command in front of the nmap command and just makes nmap to use a proxy server",
    "start": "1576240",
    "end": "1584129"
  },
  {
    "text": "you can see that the factory is to working normally you will not recognize",
    "start": "1584129",
    "end": "1590129"
  },
  {
    "text": "that something strange is happening I think it will take some time at some",
    "start": "1590129",
    "end": "1596309"
  },
  {
    "text": "time because nmap will scan I don't know two thousand ports we will see the",
    "start": "1596309",
    "end": "1609330"
  },
  {
    "text": "result in a few seconds everything still",
    "start": "1609330",
    "end": "1617609"
  },
  {
    "text": "working and now where's the result out",
    "start": "1617609",
    "end": "1624029"
  },
  {
    "text": "there okay we have to import a tea and four four three there's a web server",
    "start": "1624029",
    "end": "1630149"
  },
  {
    "text": "running on the PLC so now we are able to connect to this web server for example",
    "start": "1630149",
    "end": "1636779"
  },
  {
    "text": "and can transfer that data but this is not part of the deme demo because I",
    "start": "1636779",
    "end": "1642570"
  },
  {
    "text": "think you got the point that we can create TCP connections to all devices",
    "start": "1642570",
    "end": "1649440"
  },
  {
    "text": "that are in the industrial network the last thing I want to show a secure",
    "start": "1649440",
    "end": "1654600"
  },
  {
    "text": "function you can simply shut down the factory by typing and kill and you will",
    "start": "1654600",
    "end": "1661289"
  },
  {
    "text": "see that in a few seconds I think right now okay you see the PSC sub blinking",
    "start": "1661289",
    "end": "1672239"
  },
  {
    "text": "and the yellow police stopped to move and all peers he's disconnected that is",
    "start": "1672239",
    "end": "1679799"
  },
  {
    "text": "because POC switched into an error mode and an engineer has to reset the devices",
    "start": "1679799",
    "end": "1686249"
  },
  {
    "text": "device by device to making the factory work again okay that was the demo now",
    "start": "1686249",
    "end": "1694009"
  },
  {
    "text": "back to the slides okay we saw that the original user",
    "start": "1694009",
    "end": "1702509"
  },
  {
    "text": "program was interrupted for 10 seconds and this also generates a log entry in",
    "start": "1702509",
    "end": "1710129"
  },
  {
    "text": "the plc but this an improvement you can so we need to stop as the",
    "start": "1710129",
    "end": "1717900"
  },
  {
    "text": "original user program because we add a new organization block and as this only",
    "start": "1717900",
    "end": "1724320"
  },
  {
    "text": "possible if the execution is stopped but as a improvement is that you can patch",
    "start": "1724320",
    "end": "1731300"
  },
  {
    "text": "existing obese online you just can add new code to them this was already shown",
    "start": "1731300",
    "end": "1739560"
  },
  {
    "text": "at blackhat 2015 in the talk the talk was called internet facing pcs this will",
    "start": "1739560",
    "end": "1747660"
  },
  {
    "text": "work here too but the warm will and get more complex so warm uses memory a",
    "start": "1747660",
    "end": "1755940"
  },
  {
    "text": "nearly 40 kilobytes of RAM and to under 20 kilobyte of persistent memory now you",
    "start": "1755940",
    "end": "1764730"
  },
  {
    "text": "can reduce this by for example by creating a more specific payload but",
    "start": "1764730",
    "end": "1770040"
  },
  {
    "text": "it's already small enough to fit in or different as 7,500 models the cycle time",
    "start": "1770040",
    "end": "1777900"
  },
  {
    "text": "is important the cycle time is a time which which you in which you can execute",
    "start": "1777900",
    "end": "1784380"
  },
  {
    "text": "a user program without interruption and it's usually 150 milliseconds and our",
    "start": "1784380",
    "end": "1791070"
  },
  {
    "text": "warm the longest cycle we could measure during the infection process was 7",
    "start": "1791070",
    "end": "1797550"
  },
  {
    "text": "milliseconds and that matches our assumptions because we use communication",
    "start": "1797550",
    "end": "1803610"
  },
  {
    "text": "for functions as the most of the time and these function are processed in the",
    "start": "1803610",
    "end": "1808890"
  },
  {
    "text": "background by the firmware yes the",
    "start": "1808890",
    "end": "1814290"
  },
  {
    "text": "warmest part of the normal user program so as warm will survive a code restart",
    "start": "1814290",
    "end": "1819480"
  },
  {
    "text": "if you want to remove the warm you can do a factory reset which deletes the",
    "start": "1819480",
    "end": "1825150"
  },
  {
    "text": "complete user program or you can override the program block that is used",
    "start": "1825150",
    "end": "1832290"
  },
  {
    "text": "by the warm the t-i portal is able to recognize the warm you can see that on",
    "start": "1832290",
    "end": "1839460"
  },
  {
    "text": "this slide in the upper corner we have green program blocks this blocks as a",
    "start": "1839460",
    "end": "1845010"
  },
  {
    "text": "block certain engineer to have on the PRC but in the bottom",
    "start": "1845010",
    "end": "1850380"
  },
  {
    "text": "corner you see program blocks that are",
    "start": "1850380",
    "end": "1855600"
  },
  {
    "text": "not green that are new program blocks and an engineer maybe starts to reserve engineers these",
    "start": "1855600",
    "end": "1863760"
  },
  {
    "text": "blocks now but what you can do is you can create strange attribute blocks and",
    "start": "1863760",
    "end": "1870720"
  },
  {
    "text": "place them on the plc and it's a TI a port to download our program blocks it",
    "start": "1870720",
    "end": "1878850"
  },
  {
    "text": "will crash because of this strange attribute blocks and an engineer is not able to to to check the plc to check the",
    "start": "1878850",
    "end": "1887400"
  },
  {
    "text": "program that is running on the plc this means that gif water is not a good tool",
    "start": "1887400",
    "end": "1894090"
  },
  {
    "text": "to analyze malware on PCs on Siemens pcs",
    "start": "1894090",
    "end": "1901250"
  },
  {
    "text": "protection and as s7 provides three different protection mechanisms the",
    "start": "1901250",
    "end": "1908400"
  },
  {
    "text": "first is called in our projection and the whole protection protects",
    "start": "1908400",
    "end": "1913410"
  },
  {
    "text": "unauthorized reading or modification of the code if you enable this protection",
    "start": "1913410",
    "end": "1919980"
  },
  {
    "text": "there is an attribute block you can see it here in the bottom corner that is added to the program transfer message",
    "start": "1919980",
    "end": "1927540"
  },
  {
    "text": "and there is basically an enable flag which tells us if certain protection is",
    "start": "1927540",
    "end": "1933810"
  },
  {
    "text": "enabled or not and there is a sha-1 hash of the password you have to provide a",
    "start": "1933810",
    "end": "1939420"
  },
  {
    "text": "password when you enable this protection in addition the source code is AES",
    "start": "1939420",
    "end": "1946590"
  },
  {
    "text": "encrypted now if you want to disable this protection what you have to do you",
    "start": "1946590",
    "end": "1954480"
  },
  {
    "text": "simply download this block with your own tool then you change the flag to zero",
    "start": "1954480",
    "end": "1960330"
  },
  {
    "text": "and upload everything again and the protection is disabled the problem here",
    "start": "1960330",
    "end": "1966300"
  },
  {
    "text": "is that the source code is to AES encrypted and the question is how is the",
    "start": "1966300",
    "end": "1973350"
  },
  {
    "text": "AES key generated as I mentioned earlier the this attribute block you can",
    "start": "1973350",
    "end": "1980129"
  },
  {
    "text": "you can download it simply by asking the PRC please give me the program block and",
    "start": "1980129",
    "end": "1985229"
  },
  {
    "text": "you will get this sha-1 hash because it's part of the program block and now",
    "start": "1985229",
    "end": "1993119"
  },
  {
    "text": "how the ASP generated it is calculated from this hash you simply truncate the",
    "start": "1993119",
    "end": "2000409"
  },
  {
    "text": "hash to 128 bit and ex-ored with M the",
    "start": "2000409",
    "end": "2006019"
  },
  {
    "text": "problem is that M is displayed on the slide and so you are able to calculate",
    "start": "2006019",
    "end": "2011869"
  },
  {
    "text": "the key by own so that means that this protection is in effect ineffective",
    "start": "2011869",
    "end": "2018799"
  },
  {
    "text": "because it's broken and it only protects existing code but our warm ads only new",
    "start": "2018799",
    "end": "2026539"
  },
  {
    "text": "code and this is fixed by Simmons in the newest TI a portal version there's",
    "start": "2026539",
    "end": "2033349"
  },
  {
    "text": "another protection called copy protection and this allows you to bind",
    "start": "2033349",
    "end": "2039499"
  },
  {
    "text": "your program to specific PLC UK you need to enter a serial number of the PLC and",
    "start": "2039499",
    "end": "2046299"
  },
  {
    "text": "the TI portal will only transfer your program to that specific PLC the problem",
    "start": "2046299",
    "end": "2055069"
  },
  {
    "text": "here is that you can simply change the serial number but if you have own donut upload tool or you just can download",
    "start": "2055069",
    "end": "2066250"
  },
  {
    "text": "whatever a serial number to whatever PLC because this number is only checked by the TI a portal and not by the PLC so",
    "start": "2066250",
    "end": "2074179"
  },
  {
    "text": "that means it's a client-side protection so it's not affected there's the last",
    "start": "2074179",
    "end": "2079429"
  },
  {
    "text": "protection which is called access protection and this protection does not",
    "start": "2079429",
    "end": "2086898"
  },
  {
    "text": "protect the program but it limits the features that I can used without the",
    "start": "2086899",
    "end": "2094250"
  },
  {
    "text": "without providing a password so the",
    "start": "2094250",
    "end": "2100069"
  },
  {
    "text": "features of the protocol used to transfer as the program the warm and",
    "start": "2100069",
    "end": "2109059"
  },
  {
    "text": "basically two different protection levels the first is called white protection the segment is called read",
    "start": "2109059",
    "end": "2115820"
  },
  {
    "text": "and write protection and if you enable this protection you have to provide a",
    "start": "2115820",
    "end": "2121760"
  },
  {
    "text": "password before you can download programs to the PSC and this is an",
    "start": "2121760",
    "end": "2127220"
  },
  {
    "text": "effective protection until the warm knows the password it works but it is",
    "start": "2127220",
    "end": "2134680"
  },
  {
    "text": "disabled by default so it's a very good idea to activate this protection on your",
    "start": "2134680",
    "end": "2140420"
  },
  {
    "text": "pure C's then you know we looked at",
    "start": "2140420",
    "end": "2146720"
  },
  {
    "text": "other windows because we were wondering if it's a cement specific problem or if",
    "start": "2146720",
    "end": "2152570"
  },
  {
    "text": "maybe other windows are infected too",
    "start": "2152570",
    "end": "2158470"
  },
  {
    "text": "there are three main features we use to implement the warm the first is industrial Ethernet then we need a way",
    "start": "2158470",
    "end": "2167690"
  },
  {
    "text": "to transfer our program via TCP to the PLC and in the end we need programmable",
    "start": "2167690",
    "end": "2175730"
  },
  {
    "text": "TCP functions and on this slide you can see a list of leading vendors for",
    "start": "2175730",
    "end": "2181670"
  },
  {
    "text": "example Siemens with submission Ida rockwell automation and we checked the",
    "start": "2181670",
    "end": "2189770"
  },
  {
    "text": "PLC's simply for this three features and there's only one Piercy's that is not",
    "start": "2189770",
    "end": "2196010"
  },
  {
    "text": "able to yeah you cannot program it's via",
    "start": "2196010",
    "end": "2202040"
  },
  {
    "text": "TCP and there are some more appeared C's that are not able or that not have",
    "start": "2202040",
    "end": "2208720"
  },
  {
    "text": "programmable TCP functions but you can see there are still a lot of windows",
    "start": "2208720",
    "end": "2216230"
  },
  {
    "text": "left so those pcs might be infected by warm stew so it's not a cement specific",
    "start": "2216230",
    "end": "2223880"
  },
  {
    "text": "problem the problem is that you can't change user programs without without the",
    "start": "2223880",
    "end": "2231290"
  },
  {
    "text": "need to to provide and password in the default configuration so we use no buck",
    "start": "2231290",
    "end": "2237290"
  },
  {
    "text": "or exploit to implement as warm everything works as expected so it's",
    "start": "2237290",
    "end": "2243890"
  },
  {
    "text": "just implemented everything implementing everything in the peers programming language yes and that's the",
    "start": "2243890",
    "end": "2251400"
  },
  {
    "text": "end of my talk and I thank you for attention [Applause]",
    "start": "2251400",
    "end": "2264380"
  }
]