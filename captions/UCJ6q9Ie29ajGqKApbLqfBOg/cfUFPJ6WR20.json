[
  {
    "text": "[Music]",
    "start": "5200",
    "end": "16039"
  },
  {
    "text": "welcome to black hat Windows 2K security held February 14th through the 15th 2001",
    "start": "26480",
    "end": "32200"
  },
  {
    "text": "in Las Vegas Nevada the following videotape was recorded live at the conference and produced by the sound of",
    "start": "32200",
    "end": "38000"
  },
  {
    "text": "knowledge Incorporated this is videotape number nine technical track remote web",
    "start": "38000",
    "end": "43760"
  },
  {
    "text": "application disassembly with odbc error",
    "start": "43760",
    "end": "48718"
  },
  {
    "text": "messages we'll start with the speech um okay brief introductions first",
    "start": "50879",
    "end": "57719"
  },
  {
    "text": "off welcome we've already been there my name is David litfield and this is Mark Mark litfield my brother we uh both",
    "start": "57719",
    "end": "66000"
  },
  {
    "text": "work for ant stake out of the UK office today we're going to talk about",
    "start": "66000",
    "end": "72600"
  },
  {
    "text": "remote web application disassembly through odbc eror messages we're going to cover what the",
    "start": "72600",
    "end": "78759"
  },
  {
    "text": "basic issue is what web application disassembly is all",
    "start": "78759",
    "end": "84560"
  },
  {
    "text": "about then go on to uh certain issues with temporary stored procedures",
    "start": "84560",
    "end": "90479"
  },
  {
    "text": "on Microsoft SQL server and then risk prevention how are we going to stop all of these",
    "start": "90479",
    "end": "97439"
  },
  {
    "text": "attacks so moving on what is SQL SQL stands for structured query language um",
    "start": "97439",
    "end": "104840"
  },
  {
    "text": "it's the language that basically allows us to communicate with database servers",
    "start": "104840",
    "end": "109960"
  },
  {
    "text": "um it has a a simple format uh we will get to that shortly for",
    "start": "109960",
    "end": "117360"
  },
  {
    "text": "example we have at the bottom on my right hand side of of the screen select",
    "start": "117360",
    "end": "123560"
  },
  {
    "text": "star from table where name equals string that's an example of a simple SQL query",
    "start": "123560",
    "end": "130720"
  },
  {
    "text": "now hopefully you can see and it's um not too bad around here this is a a user",
    "start": "130720",
    "end": "138000"
  },
  {
    "text": "supplied string basically um and it's embedded in single quotes So strings are",
    "start": "138000",
    "end": "145000"
  },
  {
    "text": "embedded in single quotes in SQL now that's crucial to um our talk",
    "start": "145000",
    "end": "151680"
  },
  {
    "text": "so what we what we have here is a a simple setup and I'm sure we're having",
    "start": "151680",
    "end": "157040"
  },
  {
    "text": "some technical difficulties at the moment on on my left we're going to have my laptop here is a is a web server",
    "start": "157040",
    "end": "163680"
  },
  {
    "text": "essentially we have a client on my left we're running internet information server with an asp",
    "start": "163680",
    "end": "169840"
  },
  {
    "text": "application which feeds into a SQL Server now it just so happens the SQL Server is on the same boxes as the",
    "start": "169840",
    "end": "176080"
  },
  {
    "text": "internet information server often you'll find them separated although in terms of what we're going to do here today it it",
    "start": "176080",
    "end": "181840"
  },
  {
    "text": "doesn't make a difference um as long as the is box is using an asp application",
    "start": "181840",
    "end": "186920"
  },
  {
    "text": "feeding into internet sorry feeding into SQL Server",
    "start": "186920",
    "end": "193599"
  },
  {
    "text": "so yeah things totally died power button work okay we we we can make a okay so",
    "start": "193920",
    "end": "202239"
  },
  {
    "text": "today we have a client here as well as the server um",
    "start": "202239",
    "end": "208519"
  },
  {
    "text": "so let look at a uh a SQL",
    "start": "208519",
    "end": "213680"
  },
  {
    "text": "query select star from table where name equals Fu we were to enter from a a",
    "start": "213680",
    "end": "220799"
  },
  {
    "text": "login page let's go to this okay simple login page welcome to",
    "start": "220799",
    "end": "227400"
  },
  {
    "text": "paper.in please log in if we uh entered a single quote",
    "start": "227400",
    "end": "235959"
  },
  {
    "text": "here and logged in or attempted to we would get an odbc error message back",
    "start": "235959",
    "end": "241360"
  },
  {
    "text": "saying there was an unclosed quotation mark before the character string and password we'll come to that and password",
    "start": "241360",
    "end": "248239"
  },
  {
    "text": "shortly but just note we have an odbc error message back this tells us a number of things one we can basically",
    "start": "248239",
    "end": "256519"
  },
  {
    "text": "insert our own insert our own SQL queries and I'll get into that more uh",
    "start": "256519",
    "end": "261919"
  },
  {
    "text": "later on but let me explain why imagine we have the ASP application that for the",
    "start": "261919",
    "end": "269320"
  },
  {
    "text": "login page says select star from table users where username equals Fu and",
    "start": "269320",
    "end": "275199"
  },
  {
    "text": "password equals bar that would populate a record set which the SP application",
    "start": "275199",
    "end": "280320"
  },
  {
    "text": "would then read through looking to see if it's actually been populated or not now if we actually as we've just done",
    "start": "280320",
    "end": "286400"
  },
  {
    "text": "entered a single quote what we have now is Select star from table where name equals single",
    "start": "286400",
    "end": "293759"
  },
  {
    "text": "quote fo single quote o single quote so that is not actually valid SQL and",
    "start": "293759",
    "end": "299880"
  },
  {
    "text": "that's going to turn out this error message that we've received um unclosed single",
    "start": "299880",
    "end": "305240"
  },
  {
    "text": "quote what we can do after we have entered our single quote in there is place an arbitrary SQL query of our",
    "start": "305240",
    "end": "313120"
  },
  {
    "text": "choosing for example select star from table two now at the end you'll be able",
    "start": "313120",
    "end": "319360"
  },
  {
    "text": "to see here we have tacked on a minus minus",
    "start": "319360",
    "end": "324840"
  },
  {
    "text": "that basically tells Microsoft SQL Server that everything thereafter is a comment so just ignore it so if we were",
    "start": "324840",
    "end": "330600"
  },
  {
    "text": "to do this this time we would not get an error message chaned",
    "start": "330600",
    "end": "335880"
  },
  {
    "text": "out so web application disassembly um what's it all about we're",
    "start": "335880",
    "end": "342400"
  },
  {
    "text": "going to look at this login page um work out from the obbc error messages the",
    "start": "342400",
    "end": "347680"
  },
  {
    "text": "actual structure of the database behind the web server we're going to learn table names",
    "start": "347680",
    "end": "354000"
  },
  {
    "text": "columns the data types that are expected by those columns so let's start",
    "start": "354000",
    "end": "361199"
  },
  {
    "text": "first off and you'll have to excuse the switching between the two we've entered a single quote now as you can see this",
    "start": "361199",
    "end": "369520"
  },
  {
    "text": "part here where it says unclosed quotation mark before the character string and password that's actually given us a slight portion of the ASP",
    "start": "369520",
    "end": "377919"
  },
  {
    "text": "it's telling us that our user ID and password is being inserted into a SQL",
    "start": "377919",
    "end": "384240"
  },
  {
    "text": "query basically and by actually putting the the single quote in it's screwed",
    "start": "384240",
    "end": "390039"
  },
  {
    "text": "screwed uh screwed the actual query so we're actually getting revealed part of the query that's going across to the SQL",
    "start": "390039",
    "end": "396160"
  },
  {
    "text": "Server so and password now we can make the Assumption um that they are saying",
    "start": "396160",
    "end": "403240"
  },
  {
    "text": "select star from table where user ID equals Fu and password equals bar so and",
    "start": "403240",
    "end": "410039"
  },
  {
    "text": "this verifies this by the fact that there's and password so now we know password when you select",
    "start": "410039",
    "end": "419039"
  },
  {
    "text": "something from um a table where with a conditional where you say where username",
    "start": "419039",
    "end": "425599"
  },
  {
    "text": "and password it is X and Y so the the username and password as in this",
    "start": "425599",
    "end": "432479"
  },
  {
    "text": "password Here is actually a column within the table now because we're disassembling the application this is",
    "start": "432479",
    "end": "438879"
  },
  {
    "text": "our first stage we've now got a column name within the table we still don't know what the table is and we don't know",
    "start": "438879",
    "end": "444840"
  },
  {
    "text": "anything else other than that we have a column name which is password so using",
    "start": "444840",
    "end": "451120"
  },
  {
    "text": "that we can then actually start evaluating the rest of the column names",
    "start": "451120",
    "end": "457919"
  },
  {
    "text": "so we would say single quote Group by bracket",
    "start": "457919",
    "end": "465080"
  },
  {
    "text": "password minus minus remember minus minus cuts off the",
    "start": "465080",
    "end": "470159"
  },
  {
    "text": "edge actually before we even get that far I'm going to show you a a simple",
    "start": "470159",
    "end": "476039"
  },
  {
    "text": "login page uh then we'll go to a more complex login page and this is why we'll need to disassemble the application if",
    "start": "476039",
    "end": "483120"
  },
  {
    "text": "we wanted to go and log in here basically this is just doing a Select Staff from table where user is Fu and",
    "start": "483120",
    "end": "490440"
  },
  {
    "text": "password is bar that would populate the record set if the user entered um",
    "start": "490440",
    "end": "495479"
  },
  {
    "text": "correct information and uh we would be logged in so just showing the site quickly if we",
    "start": "495479",
    "end": "502840"
  },
  {
    "text": "logged in as Mark with the password of past WD we're taken to the welcome login",
    "start": "502840",
    "end": "508879"
  },
  {
    "text": "success page if however we entered incorrect information such as Fu and",
    "start": "508879",
    "end": "516080"
  },
  {
    "text": "bar we would get oops login failed click here to login again so we follow that",
    "start": "516080",
    "end": "522159"
  },
  {
    "text": "now this kind of login page is easy to bypass simple simple quote Yeah single",
    "start": "522159",
    "end": "528720"
  },
  {
    "text": "quote um which can now allow us to bed our own arbitrary SQL so if we assume",
    "start": "528720",
    "end": "536040"
  },
  {
    "text": "that they're saying Select Staff from table where username equals food what we can say is single quote or 1",
    "start": "536040",
    "end": "542839"
  },
  {
    "text": "equals 1 which is always going to evaluate to true so the condition is always true and the record set is",
    "start": "542839",
    "end": "548600"
  },
  {
    "text": "actually populated so we say or 1al 1 minus minus and as you can see um that's taken",
    "start": "548600",
    "end": "556800"
  },
  {
    "text": "us to welcome login successful explaining that again our query that's going to the web",
    "start": "556800",
    "end": "562920"
  },
  {
    "text": "from the web server to the SQL Server is Select star from table where username equals whatever the user enter and",
    "start": "562920",
    "end": "570000"
  },
  {
    "text": "password whatever the uh user answers but by chopping off the um the rest with",
    "start": "570000",
    "end": "576680"
  },
  {
    "text": "the minus minus our our SQL query now goes across as select star from table",
    "start": "576680",
    "end": "582480"
  },
  {
    "text": "where username equals single quote single quote or 1 equals 1 and of course all 1 equals 1 is always going to",
    "start": "582480",
    "end": "588839"
  },
  {
    "text": "evaluate to true so our record set is populated if on the other hand we had a",
    "start": "588839",
    "end": "594680"
  },
  {
    "text": "slightly more complex login page essentially welcome to. ASP does exactly",
    "start": "594680",
    "end": "599839"
  },
  {
    "text": "the same although once the person has logged in they then do an update it's an audit Trail basically after this",
    "start": "599839",
    "end": "605240"
  },
  {
    "text": "person's logged in update this particular table and say um this user logged in at this",
    "start": "605240",
    "end": "612240"
  },
  {
    "text": "particular time and here was his user ID here was his password so if we try it",
    "start": "612240",
    "end": "617399"
  },
  {
    "text": "here or 1al 1 minus- we actually get this error",
    "start": "617399",
    "end": "622519"
  },
  {
    "text": "message back now when you play with SQL enough when you see incorrect syntax",
    "start": "622519",
    "end": "627640"
  },
  {
    "text": "near the keyword or that tell tells us there's something fundamentally wrong with our SQL statement",
    "start": "627640",
    "end": "634760"
  },
  {
    "text": "so as I said when you do it enough uh we can generally guess that they're probably doing either an update uh or an",
    "start": "634760",
    "end": "643079"
  },
  {
    "text": "exec because an or a condition uh a conditional statement is not acceptable",
    "start": "643079",
    "end": "648360"
  },
  {
    "text": "in an update or a um an exact uh stored",
    "start": "648360",
    "end": "653399"
  },
  {
    "text": "procedure basically so we know something is going wrong and we can't use the simple technique to actually get ACC to",
    "start": "653399",
    "end": "659560"
  },
  {
    "text": "the restricted site so we're going to have to disassemble the application and",
    "start": "659560",
    "end": "665920"
  },
  {
    "text": "so let's start we enter our single quote",
    "start": "665920",
    "end": "672519"
  },
  {
    "text": "here and we get the this s message we've already seen back which says unclosed quotation mark before the character",
    "start": "672519",
    "end": "678680"
  },
  {
    "text": "string and password as I said earlier that's given us a tiny portion of the",
    "start": "678680",
    "end": "684480"
  },
  {
    "text": "whole application and this is our foothold this is where we're going to start disassembling the application as I",
    "start": "684480",
    "end": "690880"
  },
  {
    "text": "as I uh said earlier we're going to work out table names column names and the",
    "start": "690880",
    "end": "696160"
  },
  {
    "text": "data types expected by those so using the and password we simply say",
    "start": "696160",
    "end": "703320"
  },
  {
    "text": "Group by password now group buy is used uh when",
    "start": "703320",
    "end": "713320"
  },
  {
    "text": "playing around with Aggregates and stuff um and this will actually cause an obbc error message that will come out column",
    "start": "713320",
    "end": "721240"
  },
  {
    "text": "TBL users. username is invalid in the select list because it is not contained",
    "start": "721240",
    "end": "726639"
  },
  {
    "text": "in either an aggregate function or the group by Clause so as you can see here",
    "start": "726639",
    "end": "732720"
  },
  {
    "text": "we have tuble users that tells us it's the table name which is crucial if we're",
    "start": "732720",
    "end": "738199"
  },
  {
    "text": "going to be creating our own account and at the end of the day that's what we're going to be doing to to actually log",
    "start": "738199",
    "end": "743720"
  },
  {
    "text": "into this site um we have the table name and what's more here we have a second",
    "start": "743720",
    "end": "749920"
  },
  {
    "text": "column name we can basically iterate through through the whole of this table now substituting like password with",
    "start": "749920",
    "end": "756880"
  },
  {
    "text": "username and so on until we have basically evaluated every single um column type uh column name",
    "start": "756880",
    "end": "764880"
  },
  {
    "text": "rather in this table so we have now column names and crucially the table",
    "start": "764880",
    "end": "771320"
  },
  {
    "text": "name once we have sure go ahead",
    "start": "771320",
    "end": "776800"
  },
  {
    "text": "um could you tell me how tools",
    "start": "781279",
    "end": "785639"
  },
  {
    "text": "tools I'm not an ie man",
    "start": "788000",
    "end": "793320"
  },
  {
    "text": "um whereabouts sorry oh fonts yeah of",
    "start": "793320",
    "end": "799199"
  },
  {
    "text": "course can we change the size",
    "start": "801880",
    "end": "806720"
  },
  {
    "text": "cancel from him sorry could you view",
    "start": "810680",
    "end": "817720"
  },
  {
    "text": "right oh yeah is that",
    "start": "817720",
    "end": "825120"
  },
  {
    "text": "clear okay so the slide on the CD you have um unfortunately um there is a",
    "start": "825120",
    "end": "833279"
  },
  {
    "text": "white paper that came with this um this um has basically just been put together",
    "start": "833279",
    "end": "838759"
  },
  {
    "text": "um what I will do is um make sure this goes up on the black cat site so it's unfortunately not on the CD um so I'm",
    "start": "838759",
    "end": "847839"
  },
  {
    "text": "going to switch between the two um we have catastrophic failure with uh this Micron PC over here um so I'm just going",
    "start": "847839",
    "end": "855120"
  },
  {
    "text": "to have to switch between the two unfortunately at the moment so it it will be available great sure",
    "start": "855120",
    "end": "861600"
  },
  {
    "text": "can I just one brief question about the single quote um you say that the minus minus is is that specific to Microsoft",
    "start": "861600",
    "end": "867880"
  },
  {
    "text": "SQL ser um SQL in some SQL servers it",
    "start": "867880",
    "end": "873000"
  },
  {
    "text": "has meaning earlier versions of for example my SQL comments were like uh a pound sign hash yeah but now I believe",
    "start": "873000",
    "end": "880880"
  },
  {
    "text": "uh if you configure it in a certain way it will support minus minus um it really depends on on the um the the database",
    "start": "880880",
    "end": "888880"
  },
  {
    "text": "server type and if we just switch the quar identifier we just change the logic on this side",
    "start": "888880",
    "end": "894240"
  },
  {
    "text": "correct exactly so if exactly if quot identifier was uh something else instead",
    "start": "894240",
    "end": "900360"
  },
  {
    "text": "of using a single quote we would use whatever it was exactly correct so we have group bu so single quote gives us",
    "start": "900360",
    "end": "909480"
  },
  {
    "text": "the we portion of the the SQL statement that's going across from the web server to the to the to the Microsoft SQL",
    "start": "909480",
    "end": "915880"
  },
  {
    "text": "Server Group by allows us to iterate through the T it gives us the table name and allows us to iterate through the",
    "start": "915880",
    "end": "922040"
  },
  {
    "text": "table getting the other column names you another column name unfortunately I've only got two columns in this table",
    "start": "922040",
    "end": "930839"
  },
  {
    "text": "um it's uh can I if if you can't see clearly",
    "start": "930839",
    "end": "937839"
  },
  {
    "text": "I've got it more clear on here if you need some clarification no cool the next",
    "start": "937839",
    "end": "944040"
  },
  {
    "text": "one would be um we need to work out the data type that it expects for example we would use",
    "start": "944040",
    "end": "952680"
  },
  {
    "text": "compute sum now sum requires an in data type so if we're supplying",
    "start": "952680",
    "end": "959480"
  },
  {
    "text": "something which is say uh nvarchar data type or varar data type um it's going to",
    "start": "959480",
    "end": "966160"
  },
  {
    "text": "basically turn out another error message for us kindly so for example if we put password in here minus minus we now get",
    "start": "966160",
    "end": "972920"
  },
  {
    "text": "the error whoops we now get the error the sum or",
    "start": "972920",
    "end": "979519"
  },
  {
    "text": "average aggregate operation cannot take a nvard data type as an argument so now",
    "start": "979519",
    "end": "986680"
  },
  {
    "text": "we have the table name the column name and the data type it expects now on on",
    "start": "986680",
    "end": "992759"
  },
  {
    "text": "large tables unfortunately mine's only two two columns big um you you can iterate through the whole lot you know",
    "start": "992759",
    "end": "999240"
  },
  {
    "text": "working out what takes an INT what takes out an narar what takes um time and and",
    "start": "999240",
    "end": "1004600"
  },
  {
    "text": "stuff like that so we would basically do this go through the whole lot and drop",
    "start": "1004600",
    "end": "1010639"
  },
  {
    "text": "this down on a note bit of notepad so once we have this",
    "start": "1010639",
    "end": "1016120"
  },
  {
    "text": "information obviously comput some I've just demonstrated that's going to give us back the um the data type that it",
    "start": "1016279",
    "end": "1022000"
  },
  {
    "text": "expects so now we can go about creating an actual account for ourselves we would",
    "start": "1022000",
    "end": "1027839"
  },
  {
    "text": "use the insert SQL command to do this we",
    "start": "1027839",
    "end": "1034000"
  },
  {
    "text": "have the table name insert into tubble",
    "start": "1034000",
    "end": "1038918"
  },
  {
    "text": "users um the column names username",
    "start": "1039319",
    "end": "1045798"
  },
  {
    "text": "password values um let's say",
    "start": "1045799",
    "end": "1051520"
  },
  {
    "text": "FU and bar now before I actually do",
    "start": "1051520",
    "end": "1058160"
  },
  {
    "text": "this I'm going to go back and show",
    "start": "1058160",
    "end": "1062840"
  },
  {
    "text": "you this loging in as F and bar",
    "start": "1063320",
    "end": "1068360"
  },
  {
    "text": "failing so we say F here bar here login failed okay now just check the syntax",
    "start": "1070360",
    "end": "1078480"
  },
  {
    "text": "here and turn to table users yep right this will actually create an account called f and bar for us we get that",
    "start": "1078480",
    "end": "1085280"
  },
  {
    "text": "error message but if we go back here and now log in login successful yeah so",
    "start": "1085280",
    "end": "1091960"
  },
  {
    "text": "we've actually disassembled their application and gone ahead and going just created our own account so imagine",
    "start": "1091960",
    "end": "1099080"
  },
  {
    "text": "you know you had to go through through some lengthy process before these guys would even give you account well we've just done one in about five minutes",
    "start": "1099080",
    "end": "1106559"
  },
  {
    "text": "um so this is um certainly a problem and we'll get to",
    "start": "1106559",
    "end": "1113080"
  },
  {
    "text": "uh actually solving issues like this shortly that there is the string we",
    "start": "1113080",
    "end": "1118679"
  },
  {
    "text": "would use to enter the um the uh create our account obviously for every um column that existed in in",
    "start": "1118679",
    "end": "1127080"
  },
  {
    "text": "in the table we would do that you know add that into our SQL query and our",
    "start": "1127080",
    "end": "1133440"
  },
  {
    "text": "account creation was successful now the whole basic issue here is we can",
    "start": "1133440",
    "end": "1138880"
  },
  {
    "text": "run arbitrary SQL queries um Ms",
    "start": "1138880",
    "end": "1145440"
  },
  {
    "text": "00 um 048 actually talked about a problem where by if you as a normal user created",
    "start": "1145440",
    "end": "1153200"
  },
  {
    "text": "a temporary stored procedure we could actually bypass permission checking and gain access to Extended store procedures",
    "start": "1153200",
    "end": "1160400"
  },
  {
    "text": "or stored procedures that we had to be sa in other words super super access or CIS admin um basically to to get access",
    "start": "1160400",
    "end": "1169559"
  },
  {
    "text": "so we can actually bypass permission checking and gain access now why is this a problem xpor CMD shell this basically",
    "start": "1169559",
    "end": "1176679"
  },
  {
    "text": "gives us a remote uh shell prompt well it's not interactive basically we Supply",
    "start": "1176679",
    "end": "1181880"
  },
  {
    "text": "a command but it will go off and run that command for us",
    "start": "1181880",
    "end": "1187360"
  },
  {
    "text": "now previously there was no way to actually do this from a web server and",
    "start": "1187360",
    "end": "1192840"
  },
  {
    "text": "I'll show you why if we tried the command crate",
    "start": "1192840",
    "end": "1199320"
  },
  {
    "text": "remember we have the the facility to be able to run arbitrary SQL queries crate proc I say percent 23 here by the way uh",
    "start": "1199320",
    "end": "1207600"
  },
  {
    "text": "simply because if I said hash um Internet Explorer would not pass that information on it would translate it",
    "start": "1207600",
    "end": "1214240"
  },
  {
    "text": "locally so I say perent 23 Internet Explorer will pass that on as a hash sh that's hex for a hash and let's say our",
    "start": "1214240",
    "end": "1221720"
  },
  {
    "text": "quer is called AAA create procedure #",
    "start": "1221720",
    "end": "1227080"
  },
  {
    "text": "AAA as X exac XP actually we'll need to say",
    "start": "1227080",
    "end": "1234400"
  },
  {
    "text": "master dot dot XP uncore CMD",
    "start": "1234400",
    "end": "1239919"
  },
  {
    "text": "shell single quote di single quote minus minus this is going to give us an error",
    "start": "1239919",
    "end": "1245600"
  },
  {
    "text": "message create procedure must be the first statement in a query batch",
    "start": "1245600",
    "end": "1251200"
  },
  {
    "text": "damn this beautiful bug is not going to allow us to do it but of course there is",
    "start": "1251200",
    "end": "1256840"
  },
  {
    "text": "a way to do it um um so moving on I'm",
    "start": "1256840",
    "end": "1262520"
  },
  {
    "text": "going to demonstrate this bug in action actually let me just go to query",
    "start": "1262520",
    "end": "1267919"
  },
  {
    "text": "analyzer query analyzer is uh a simple tool that we would use to query SQL",
    "start": "1267919",
    "end": "1273440"
  },
  {
    "text": "Server so if I said um I'm logged in as a simple user David uh as you can see up",
    "start": "1273440",
    "end": "1280200"
  },
  {
    "text": "here that's the user login excuse me sorry create",
    "start": "1280200",
    "end": "1286520"
  },
  {
    "text": "proc um hash as",
    "start": "1286520",
    "end": "1291760"
  },
  {
    "text": "exec XP actually Master do do xpor",
    "start": "1291760",
    "end": "1299039"
  },
  {
    "text": "CMD shell di if we play that and then execute it",
    "start": "1299039",
    "end": "1306760"
  },
  {
    "text": "hash what did I say FK J",
    "start": "1306760",
    "end": "1313000"
  },
  {
    "text": "KF we get incorrect syntax oops because",
    "start": "1314720",
    "end": "1320440"
  },
  {
    "text": "I'm being silly we get this message back saying um cannot ad R sister pens fair",
    "start": "1320440",
    "end": "1328400"
  },
  {
    "text": "enough but if we then execute you can see we've got a",
    "start": "1328400",
    "end": "1334360"
  },
  {
    "text": "directory listing that's because we've created a temporary stored procedure and SQL does not check permissions on uh",
    "start": "1334360",
    "end": "1340120"
  },
  {
    "text": "temporary stored procedures so we have our directory listing",
    "start": "1340120",
    "end": "1345520"
  },
  {
    "text": "now what I'm going to do and save typing is",
    "start": "1345520",
    "end": "1351039"
  },
  {
    "text": "basically show you this I'll break it",
    "start": "1351039",
    "end": "1356880"
  },
  {
    "text": "down okay we do exactly the same yeah but we're actually going to embedd it um",
    "start": "1358120",
    "end": "1364960"
  },
  {
    "text": "the crate proc temp procedure within an execute statement itself moving down um",
    "start": "1364960",
    "end": "1371559"
  },
  {
    "text": "let me see if I can uh put this in bigger text",
    "start": "1371559",
    "end": "1376880"
  },
  {
    "text": "okay so can you guys see that over there yeah",
    "start": "1396760",
    "end": "1402279"
  },
  {
    "text": "okay so here we're saying execute bracket single quote create Croc",
    "start": "1402279",
    "end": "1409240"
  },
  {
    "text": "hash Fubar as exec master. xpor CMD",
    "start": "1409240",
    "end": "1414520"
  },
  {
    "text": "shell Echo I was here yeah and redirect that to default.asp um note the placement of the",
    "start": "1414520",
    "end": "1422000"
  },
  {
    "text": "single quotes um we have to have two here and three at the end basically",
    "start": "1422000",
    "end": "1428600"
  },
  {
    "text": "because um execute bracket single quote um",
    "start": "1428600",
    "end": "1435640"
  },
  {
    "text": "requires actually what we're executing requires lots of single quotes in it so",
    "start": "1435640",
    "end": "1440960"
  },
  {
    "text": "um you just have to play around with the the location of the single quotes until you get it right so if I demonstrate",
    "start": "1440960",
    "end": "1450158"
  },
  {
    "text": "this remember that's our default page pressing enter here",
    "start": "1451279",
    "end": "1458840"
  },
  {
    "text": "refresh and learn behold something",
    "start": "1458840",
    "end": "1464120"
  },
  {
    "text": "failed let me just see why",
    "start": "1464240",
    "end": "1469080"
  },
  {
    "text": "create BR Fubar as execute master dot",
    "start": "1489919",
    "end": "1494960"
  },
  {
    "text": "dot it should have done let me just put uh profiler on and just see if it got",
    "start": "1495720",
    "end": "1503440"
  },
  {
    "text": "through enas that is my local machine so but I think you mayed after you",
    "start": "1514000",
    "end": "1520159"
  },
  {
    "text": "already is in the beginning of um",
    "start": "1520159",
    "end": "1526480"
  },
  {
    "text": "execute create proc hash V bar as",
    "start": "1534360",
    "end": "1538158"
  },
  {
    "text": "ex let me just change the I I know what's wrong I've already",
    "start": "1549039",
    "end": "1555480"
  },
  {
    "text": "created a temporary stored procedure called that and so that's going to fail I think anyway so let's go a",
    "start": "1555480",
    "end": "1563880"
  },
  {
    "text": "there and exec a",
    "start": "1563880",
    "end": "1569919"
  },
  {
    "text": "there don't you just wish you had one of those like musac things temporary failure of you know",
    "start": "1575960",
    "end": "1582960"
  },
  {
    "text": "like um",
    "start": "1582960",
    "end": "1586960"
  },
  {
    "text": "right has anyone whil I get this working has anyone got any uh questions at",
    "start": "1590039",
    "end": "1595120"
  },
  {
    "text": "all you the the the which",
    "start": "1595120",
    "end": "1602360"
  },
  {
    "text": "one sure so you're actually just redirecting the output to that file and overwriting",
    "start": "1602360",
    "end": "1608720"
  },
  {
    "text": "the file correct yeah is that",
    "start": "1608720",
    "end": "1613919"
  },
  {
    "text": "a yeah Internet Explorer should actually pad that out to to uh a perent 20 when it gets sent",
    "start": "1615240",
    "end": "1623120"
  },
  {
    "text": "across these these will actually be um in there you'll see my arbitary SQL",
    "start": "1641960",
    "end": "1647480"
  },
  {
    "text": "queries going cross",
    "start": "1647480",
    "end": "1651240"
  },
  {
    "text": "um usid us it should be user ID yeah was that",
    "start": "1656279",
    "end": "1663000"
  },
  {
    "text": "username no user ided",
    "start": "1663000",
    "end": "1667240"
  },
  {
    "text": "own by the dbo it does xpor CMD shell is is owned by sa which is dbo",
    "start": "1678240",
    "end": "1686720"
  },
  {
    "text": "uh now I'm just wondering whether it's internet information server caching the ASP page let me just",
    "start": "1686720",
    "end": "1695919"
  },
  {
    "text": "uh no well what I'll do is continue for the",
    "start": "1697320",
    "end": "1705799"
  },
  {
    "text": "minute",
    "start": "1705799",
    "end": "1708799"
  },
  {
    "text": "query batch completed with errors I tell you what I'll transplant",
    "start": "1711320",
    "end": "1717559"
  },
  {
    "text": "that in and uh sorry I was just saying who would have right access",
    "start": "1717559",
    "end": "1724720"
  },
  {
    "text": "on um too many people unfortunately yeah um I'm just doing it as a a",
    "start": "1725000",
    "end": "1732080"
  },
  {
    "text": "demonstration so there's some something visible basically okay so the purpose is actually redirect the output to our",
    "start": "1732080",
    "end": "1740039"
  },
  {
    "text": "yeah what I'm going to do is this will give me",
    "start": "1741799",
    "end": "1750720"
  },
  {
    "text": "a if there's any error message coming back",
    "start": "1753399",
    "end": "1759240"
  },
  {
    "text": "yeah h may you don't have right access maybe I",
    "start": "1794480",
    "end": "1801760"
  },
  {
    "text": "don't have right access let me try that to a u just a a simple",
    "start": "1801760",
    "end": "1808039"
  },
  {
    "text": "file um f.txt",
    "start": "1808679",
    "end": "1814279"
  },
  {
    "text": "access is denied I'm sorry you know what I think I've done",
    "start": "1817039",
    "end": "1824200"
  },
  {
    "text": "I've actually I think I've installed the patch the command",
    "start": "1824200",
    "end": "1831640"
  },
  {
    "text": "Su notepad secon back f.txt",
    "start": "1833880",
    "end": "1840360"
  },
  {
    "text": "yeah okay it's worked finally what I'll do just to to demonstrate this actually working",
    "start": "1840360",
    "end": "1847200"
  },
  {
    "text": "via is um someone give me the name of a a",
    "start": "1847200",
    "end": "1853600"
  },
  {
    "text": "file any file any file like f.txt on the RO the C driver or I've just created",
    "start": "1853600",
    "end": "1861880"
  },
  {
    "text": "actually that was f.txt yeah so let's",
    "start": "1861880",
    "end": "1867279"
  },
  {
    "text": "do that it should now say I was here um let me just write",
    "start": "1867279",
    "end": "1875200"
  },
  {
    "text": "f.txt I was here yeah",
    "start": "1875200",
    "end": "1883519"
  },
  {
    "text": "so um sorry about that um I wonder if I've got default ASP open somewhere um",
    "start": "1883519",
    "end": "1890320"
  },
  {
    "text": "so it's locked for exclusive use well whatever reason anyway let's move",
    "start": "1890320",
    "end": "1896840"
  },
  {
    "text": "on I'm sorry um I I think one of these may have",
    "start": "1896840",
    "end": "1904440"
  },
  {
    "text": "it locked",
    "start": "1904440",
    "end": "1909519"
  },
  {
    "text": "yeah actually as a um good example of why this could be um",
    "start": "1911639",
    "end": "1919840"
  },
  {
    "text": "problem yeah so uh we could run any command we",
    "start": "1921279",
    "end": "1927000"
  },
  {
    "text": "want here for example copy uh C back winnt back system32 back cmd.exe to the",
    "start": "1927000",
    "end": "1933480"
  },
  {
    "text": "scripts directory and then we can rather than playing with SQL queries just have raw access sure does it matter which",
    "start": "1933480",
    "end": "1940679"
  },
  {
    "text": "volume you're on or which volume uh not really um for example",
    "start": "1940679",
    "end": "1946200"
  },
  {
    "text": "let's say the SQL box and the um internet information server",
    "start": "1946200",
    "end": "1951840"
  },
  {
    "text": "box were on the same machine physically but the is inall was on the D drive and",
    "start": "1951840",
    "end": "1957200"
  },
  {
    "text": "say the scripts directory existed I could just try copy cmd.exe to C colum",
    "start": "1957200",
    "end": "1962960"
  },
  {
    "text": "back assign Pub scripts and if it wasn't there try Dum back slash and eolm and",
    "start": "1962960",
    "end": "1968360"
  },
  {
    "text": "once I've got cmd.exe there you know I I I don't need to do that um because I've",
    "start": "1968360",
    "end": "1974200"
  },
  {
    "text": "got uh access to a command prompt this way um this will remember give me access",
    "start": "1974200",
    "end": "1980120"
  },
  {
    "text": "to a command prompt on the actual SQL server not on the web server unless they're actually Shar the same box um",
    "start": "1980120",
    "end": "1987399"
  },
  {
    "text": "doing it this way all my commands will run a system yeah um copying cmd.exe to",
    "start": "1987399",
    "end": "1993159"
  },
  {
    "text": "the scripts directory will run as iwam or I USR uh the that account question",
    "start": "1993159",
    "end": "2000240"
  },
  {
    "text": "sure that cre command It First Command correct if if my arbitary query",
    "start": "2000240",
    "end": "2007600"
  },
  {
    "text": "was was for example single quote create proc hash Fu as whatever yeah create",
    "start": "2007600",
    "end": "2013240"
  },
  {
    "text": "proced in a in a in a batch a query batch in other words when you're runting several queries together they will have",
    "start": "2013240",
    "end": "2019000"
  },
  {
    "text": "to uh they have to be in a certain order now remember we've already got the select sta from table users where",
    "start": "2019000",
    "end": "2027200"
  },
  {
    "text": "already so our first in the batch is actually a select we have no control over that we can't edit the source how",
    "start": "2027200",
    "end": "2033000"
  },
  {
    "text": "you do because we've embedded it in an execute statement now because",
    "start": "2033000",
    "end": "2038399"
  },
  {
    "text": "execute this create proc yeah is not a create proc we can actually bypass that",
    "start": "2038399",
    "end": "2045399"
  },
  {
    "text": "so it's basically uh messing around with the order in which it's passed uh par",
    "start": "2045399",
    "end": "2051358"
  },
  {
    "text": "pared so temporary store procedures unfortunately what we see is um too many",
    "start": "2051359",
    "end": "2057720"
  },
  {
    "text": "people are like well we know they can't get to our web server uh sorry our SQL Server through this way um and they",
    "start": "2057720",
    "end": "2065200"
  },
  {
    "text": "don't apply this particular patch so if you you've got a SQL server with an internet information server an asp",
    "start": "2065200",
    "end": "2070919"
  },
  {
    "text": "application apply this patch it's um it should go on uh because we can get",
    "start": "2070919",
    "end": "2077839"
  },
  {
    "text": "access just by screwing with the the SQL uh query we can get access to it as you",
    "start": "2077839",
    "end": "2083440"
  },
  {
    "text": "as as you've seen even though it took me like was on a SE SE only correct but",
    "start": "2083440",
    "end": "2091679"
  },
  {
    "text": "that's often where the crown jewels are see if if you've got a like a a script Kitty sure he wants to def def your site",
    "start": "2091679",
    "end": "2098920"
  },
  {
    "text": "cuz he's going to say like Elite hacka was here kind of thing and he'll go around boasting to his friends look that",
    "start": "2098920",
    "end": "2104960"
  },
  {
    "text": "was me kind of thing uh a determined attacker someone who is I don't know industrial aspion involved in industrial",
    "start": "2104960",
    "end": "2112119"
  },
  {
    "text": "Espionage they're not going over a defacement they're looking for the crown Jews which is actually in your database",
    "start": "2112119",
    "end": "2117280"
  },
  {
    "text": "server um so risk prevention what what can we do",
    "start": "2117280",
    "end": "2124720"
  },
  {
    "text": "okay obviously the first Port of Call is the ASP application any user",
    "start": "2124720",
    "end": "2130720"
  },
  {
    "text": "input call replace on it um if it's if it's string if it's a uh a string for",
    "start": "2130720",
    "end": "2137640"
  },
  {
    "text": "example um I will show you what I mean by",
    "start": "2137640",
    "end": "2145240"
  },
  {
    "text": "that this is the actual ASP code okay now here we're requesting from the query",
    "start": "2146240",
    "end": "2153599"
  },
  {
    "text": "string user ID then calling replace What in the other Pages they're fa to do is",
    "start": "2153599",
    "end": "2159480"
  },
  {
    "text": "actually call replace okay so it's just pulling it directly from the query string plunking it straight into the",
    "start": "2159480",
    "end": "2164839"
  },
  {
    "text": "query and that is uh packed off to the SQL Server instead if we call replace",
    "start": "2164839",
    "end": "2171040"
  },
  {
    "text": "and substitute a single quote with two single",
    "start": "2171040",
    "end": "2177319"
  },
  {
    "text": "quotes that therefore becomes valid SQL so for every single quote they put in if",
    "start": "2177319",
    "end": "2182800"
  },
  {
    "text": "we put two in there's not a problem we're saved um we could simply",
    "start": "2182800",
    "end": "2188200"
  },
  {
    "text": "like say replace it with nothing in know other strip them out um the only difficulty with that is if their names O",
    "start": "2188200",
    "end": "2196119"
  },
  {
    "text": "Apostrophe Brian you know um or if they want a strong password and they want a single quote in their password um",
    "start": "2196119",
    "end": "2203760"
  },
  {
    "text": "stripping it out could cause issues so sometimes it's best to put two replace",
    "start": "2203760",
    "end": "2209440"
  },
  {
    "text": "it with two quotes um sometimes it's best just to strip them out you could just parse it for certain keywords that",
    "start": "2209440",
    "end": "2215319"
  },
  {
    "text": "are not um well the it's the single quotes or or the",
    "start": "2215319",
    "end": "2220800"
  },
  {
    "text": "whatever they're using is the quote identify that's the danger um if if they've got well actually no that's not",
    "start": "2220800",
    "end": "2227319"
  },
  {
    "text": "true if for example you were had you had a specific query that did like um you",
    "start": "2227319",
    "end": "2233440"
  },
  {
    "text": "know called um select star from table um like and then string if we could embed",
    "start": "2233440",
    "end": "2239440"
  },
  {
    "text": "percents in there or something we could perhaps do weird stuff with that so",
    "start": "2239440",
    "end": "2246240"
  },
  {
    "text": "I you may want to uh be careful of things like that anything which has",
    "start": "2246240",
    "end": "2251680"
  },
  {
    "text": "meaning to the SQL Server um you might want to assess your risk we're not using",
    "start": "2251680",
    "end": "2256760"
  },
  {
    "text": "like statements so we don't care about percent signs you know um or if you are",
    "start": "2256760",
    "end": "2262040"
  },
  {
    "text": "then you maybe want to validate you know what's actually going through um if it's",
    "start": "2262040",
    "end": "2267640"
  },
  {
    "text": "numeric we don't actually have to play with quotes by the way um we just simply",
    "start": "2267640",
    "end": "2272800"
  },
  {
    "text": "say for example let's say you had a site that had um news stories and selected",
    "start": "2272800",
    "end": "2277880"
  },
  {
    "text": "news stories from a a SQL server and it was select star from news stories where",
    "start": "2277880",
    "end": "2283359"
  },
  {
    "text": "news ID equals one or two we would just say where new store equals one space you",
    "start": "2283359",
    "end": "2290280"
  },
  {
    "text": "know Select Staff or Union Select Staff from whatever table and join them together kind of thing and we would",
    "start": "2290280",
    "end": "2296200"
  },
  {
    "text": "actually have that uh result set returned back to us now if it's numeric input you still have to validate it and",
    "start": "2296200",
    "end": "2303040"
  },
  {
    "text": "you would use things like is numeric if you're using uh V B script for your ASP",
    "start": "2303040",
    "end": "2308839"
  },
  {
    "text": "application or um Nan or is Nan uh if",
    "start": "2308839",
    "end": "2314119"
  },
  {
    "text": "you're using jscript so replace and uh is numeric and and Nan use those",
    "start": "2314119",
    "end": "2323000"
  },
  {
    "text": "all the time never accept user input even with cookies because I've often seen people pull in a cookie plunk that",
    "start": "2323000",
    "end": "2329680"
  },
  {
    "text": "straight into a um a request and uh again we can get access using the",
    "start": "2329680",
    "end": "2336640"
  },
  {
    "text": "same just by manipul ating our cookie now further to this we can actually use",
    "start": "2336640",
    "end": "2343680"
  },
  {
    "text": "the um properties defense and depth is always a good thing so imagine you have",
    "start": "2343680",
    "end": "2350720"
  },
  {
    "text": "used replace in everywhere you can think of but let's say you've missed one small",
    "start": "2350720",
    "end": "2356640"
  },
  {
    "text": "place um what we can do is configure internet information server by the way I'm although I'm using nt4 here the same",
    "start": "2356640",
    "end": "2364000"
  },
  {
    "text": "exactly the same including the the temporary stored procedures issue is in SQL 2000 and the same with internet",
    "start": "2364000",
    "end": "2370200"
  },
  {
    "text": "information server 5 uh as well is with four so under here we would change the I",
    "start": "2370200",
    "end": "2376680"
  },
  {
    "text": "app properties I'm going to do this real time so you can actually see the",
    "start": "2376680",
    "end": "2382560"
  },
  {
    "text": "difference um home directory configuration app debugging send",
    "start": "2382560",
    "end": "2389319"
  },
  {
    "text": "detailed ASP error message to client that is default it's so much better to",
    "start": "2389319",
    "end": "2394599"
  },
  {
    "text": "send a text message to the client you can modify the the message if you want an error occurred on the the server when",
    "start": "2394599",
    "end": "2400800"
  },
  {
    "text": "processing the URL um if we apply that and go back and try any of these",
    "start": "2400800",
    "end": "2406960"
  },
  {
    "text": "things we tried earlier for example just a single quote",
    "start": "2406960",
    "end": "2412079"
  },
  {
    "text": "an error occurred on the server we don't get any of this information back so there's there's two areas we can play",
    "start": "2412079",
    "end": "2418640"
  },
  {
    "text": "with this um one fix your ASP code to configure the internet information server to give very little information",
    "start": "2418640",
    "end": "2425400"
  },
  {
    "text": "out as you can see error information can lead to a downfall basically so",
    "start": "2425400",
    "end": "2430800"
  },
  {
    "text": "that's the other one and of course in terms of the temporary stor procedure apply that patch and of course apply",
    "start": "2430800",
    "end": "2436839"
  },
  {
    "text": "every patch when and when one comes as when as and when one comes",
    "start": "2436839",
    "end": "2443680"
  },
  {
    "text": "out okay so are there any questions at",
    "start": "2443680",
    "end": "2449119"
  },
  {
    "text": "all sure is this related only well what you have is actually",
    "start": "2449119",
    "end": "2457480"
  },
  {
    "text": "going down through the different layers um Ado um will speak to the next level",
    "start": "2457480",
    "end": "2463680"
  },
  {
    "text": "down um which is oedb olb speaks down to odbc so even though we're using Ado",
    "start": "2463680",
    "end": "2471800"
  },
  {
    "text": "you're still actually using oedb and and so on so um if you're using um different",
    "start": "2471800",
    "end": "2478440"
  },
  {
    "text": "SQL servers whether it be Oracle there are still possible ways to do this um",
    "start": "2478440",
    "end": "2483560"
  },
  {
    "text": "it's just I've tailored this talk specifically to SQL so m moft SQL server and internet information server and it's",
    "start": "2483560",
    "end": "2489720"
  },
  {
    "text": "a whole different story when you're talking about things like Oracle or MySQL and so on actually MySQL um is is",
    "start": "2489720",
    "end": "2496599"
  },
  {
    "text": "the best because it has very little functionality there are no such concept as um nested SQL queries",
    "start": "2496599",
    "end": "2505640"
  },
  {
    "text": "um you know batching or anything like that there are no stored procedures um",
    "start": "2505640",
    "end": "2511280"
  },
  {
    "text": "so it it's good that way um I suppose you could uh write your own function um",
    "start": "2511280",
    "end": "2517520"
  },
  {
    "text": "um now this is working off the seats of my pants I don't know this but for example assume we could create our own",
    "start": "2517520",
    "end": "2524040"
  },
  {
    "text": "function that pointed it into lib c um and we C actually no it wouldn't work because of the arguments the way the",
    "start": "2524040",
    "end": "2529240"
  },
  {
    "text": "arguments are being passed to to the to the function I was just thinking that if we you know created a a function called",
    "start": "2529240",
    "end": "2535560"
  },
  {
    "text": "system you know we we just specify uh the PA to Theo file for lib for libc and",
    "start": "2535560",
    "end": "2541640"
  },
  {
    "text": "then call system which would give us xpor CMD shell but I think they're actually passing a structure before any",
    "start": "2541640",
    "end": "2548400"
  },
  {
    "text": "uh before passing whatever we pass as our user input you know to to the function so I don't think that would",
    "start": "2548400",
    "end": "2554440"
  },
  {
    "text": "work there's about five arguments so no that won't work um any other",
    "start": "2554440",
    "end": "2560200"
  },
  {
    "text": "questions sure given that the uh command sh you had on the SQL box the SQL box",
    "start": "2560200",
    "end": "2567359"
  },
  {
    "text": "and the Web Box AR the same box are there any comments or techniques or um",
    "start": "2567359",
    "end": "2573160"
  },
  {
    "text": "other than being able to drop files how do you actually get input get command back if you don't have a web",
    "start": "2573160",
    "end": "2579559"
  },
  {
    "text": "server to serve it back right um there's a number of ways we could do it for",
    "start": "2579559",
    "end": "2585880"
  },
  {
    "text": "example um we could redirect it to a file yeah and then create a new file",
    "start": "2585880",
    "end": "2593359"
  },
  {
    "text": "that um basically runs FTP commands and then use the FTP client to drop us that",
    "start": "2593359",
    "end": "2600440"
  },
  {
    "text": "far back out basically um you could do it that way um you could you sometimes",
    "start": "2600440",
    "end": "2607240"
  },
  {
    "text": "don't need the results uh back on what you're doing um what suggest what I suggested about",
    "start": "2607240",
    "end": "2614280"
  },
  {
    "text": "the FTP um client you know we we obviously just provide scon uh path to",
    "start": "2614280",
    "end": "2620119"
  },
  {
    "text": "to. txt file um but then if they fire will if they indeed they have one if that's rejecting outgoing on Port 20 uh",
    "start": "2620119",
    "end": "2628040"
  },
  {
    "text": "21 rather um and rejecting incoming on Port 20 then there's that that would",
    "start": "2628040",
    "end": "2633240"
  },
  {
    "text": "fail uh there are ways to do it um but often you don't need the results back",
    "start": "2633240",
    "end": "2640440"
  },
  {
    "text": "anyway any other questions sure remove",
    "start": "2641440",
    "end": "2647640"
  },
  {
    "text": "procedures right you can remove extended storage procedures basically with Enterprise Manager um if you if if you",
    "start": "2647640",
    "end": "2657079"
  },
  {
    "text": "did then it's using the same Technique we can just put it back on again using uh Spore ad extended proc the only safe",
    "start": "2657079",
    "end": "2664800"
  },
  {
    "text": "way to do it is to delete xsql 70. DL",
    "start": "2664800",
    "end": "2670119"
  },
  {
    "text": "unfortunately that breaks the replication service within SQL so you",
    "start": "2670119",
    "end": "2675319"
  },
  {
    "text": "then got the other option which is opening it up in a hex editor and actually because SQL actually will call",
    "start": "2675319",
    "end": "2681640"
  },
  {
    "text": "load Library xsql 70. DL and then do a get proc address on uh xpor CMD shell",
    "start": "2681640",
    "end": "2689359"
  },
  {
    "text": "because that's the actual function exports yeah so we could edit that in a hex editor um but then you might like if",
    "start": "2689359",
    "end": "2696599"
  },
  {
    "text": "you ever had had problems with it Microsoft would say nope I'm not helping you with that you've you know you've mod modified the binary so",
    "start": "2696599",
    "end": "2704160"
  },
  {
    "text": "it's you have to assess your risk see if you have a good strong ASP application",
    "start": "2704160",
    "end": "2709599"
  },
  {
    "text": "anyway then you're not going to have this problem but if you then want layer",
    "start": "2709599",
    "end": "2714720"
  },
  {
    "text": "security which is obviously the best way to do it for example someone makes a quick modification later on because uh",
    "start": "2714720",
    "end": "2721599"
  },
  {
    "text": "something may have been broken somewhere and they forgot all about that um this era might",
    "start": "2721599",
    "end": "2727520"
  },
  {
    "text": "this this um vulnerability might creep in at some stage so the best thing to do is is have layer security um apply the",
    "start": "2727520",
    "end": "2733680"
  },
  {
    "text": "patch that way you know no one's going to be able to get access to xpor cmdshell anyway um so there's a number",
    "start": "2733680",
    "end": "2741280"
  },
  {
    "text": "of different defense strategies you you can uh take and obviously you have to assess the risk to say how far you want",
    "start": "2741280",
    "end": "2747559"
  },
  {
    "text": "to go if you don't use replication for example who cares we don't need you know XP SQL 70. dll just whack it off the",
    "start": "2747559",
    "end": "2754440"
  },
  {
    "text": "system um and actually delete it you know um as opposed to uh sending it to the recycle bin",
    "start": "2754440",
    "end": "2761200"
  },
  {
    "text": "because there will be a way to to to bring it back again kind of thing if it's still somewhere on the file system",
    "start": "2761200",
    "end": "2767359"
  },
  {
    "text": "you know even in the recycle bin so sure if there no more I was wondering",
    "start": "2767359",
    "end": "2773200"
  },
  {
    "text": "if you could uh do the field enumeration again that field by field that you were doing only but I didn't see",
    "start": "2773200",
    "end": "2780920"
  },
  {
    "text": "exactly right let me just um go and put this back the way it was",
    "start": "2780920",
    "end": "2787760"
  },
  {
    "text": "you didn't know the field your I didn't at the time the by entering the single",
    "start": "2788079",
    "end": "2793160"
  },
  {
    "text": "quote first off I got a portion yeah I got and you know and password which gave",
    "start": "2793160",
    "end": "2799040"
  },
  {
    "text": "me you know the First Column now once we have that column we can",
    "start": "2799040",
    "end": "2805760"
  },
  {
    "text": "then so doing this again single quote perent 27 is a single quote by the way",
    "start": "2805760",
    "end": "2811240"
  },
  {
    "text": "we get unclosed quotation mark before the character string and password so we have password we would then say Group",
    "start": "2811240",
    "end": "2819200"
  },
  {
    "text": "by password minus minus and then we get",
    "start": "2820280",
    "end": "2825800"
  },
  {
    "text": "column table users. username yeah now because I've only got two here if I put",
    "start": "2825800",
    "end": "2832520"
  },
  {
    "text": "username in here you know we've worked out the other",
    "start": "2832520",
    "end": "2839040"
  },
  {
    "text": "one so we Ste through if was a third one you put put that one in and exactly you",
    "start": "2839040",
    "end": "2845559"
  },
  {
    "text": "put password the next one y sometimes um",
    "start": "2845559",
    "end": "2851559"
  },
  {
    "text": "you may miss one I I think it's based on the the the the order of uh it comes in",
    "start": "2851559",
    "end": "2857200"
  },
  {
    "text": "the alphabet basically so sometimes you may miss one and you can verify that by simply saying um do a union select yeah",
    "start": "2857200",
    "end": "2864800"
  },
  {
    "text": "um now if we said select star um and the two didn't balance you would get a me",
    "start": "2864800",
    "end": "2869839"
  },
  {
    "text": "error message back saying um you have to have the equal number of uh operators on",
    "start": "2869839",
    "end": "2876280"
  },
  {
    "text": "either side of the the union yeah so we just go name comma name comma name until",
    "start": "2876280",
    "end": "2881960"
  },
  {
    "text": "we hit you know the point where we no longer get the error message that then tells us that providing they are doing a",
    "start": "2881960",
    "end": "2888000"
  },
  {
    "text": "select star that then tells us they have 17 columns in you know if there's 17 it",
    "start": "2888000",
    "end": "2893520"
  },
  {
    "text": "iterations of name in the um in our arbit SQL",
    "start": "2893520",
    "end": "2900558"
  },
  {
    "text": "statement if we're having a record set displayed back to us yes I could the way this um is is set up we're not actually",
    "start": "2903280",
    "end": "2911319"
  },
  {
    "text": "being displayed the results for example if if we had a a book site that said select star from authors where author",
    "start": "2911319",
    "end": "2918599"
  },
  {
    "text": "name equals um Heming Hemingway yeah um and that basically brought us back a",
    "start": "2918599",
    "end": "2924800"
  },
  {
    "text": "list of books written by anest Hemingway yeah what we could say is author name you know equals Hemingway single quote",
    "start": "2924800",
    "end": "2932720"
  },
  {
    "text": "Union select um sta from or or like",
    "start": "2932720",
    "end": "2938200"
  },
  {
    "text": "whatever we wanted to select from from the given table and that would be returned in our record set",
    "start": "2938200",
    "end": "2943359"
  },
  {
    "text": "so insert correct oh well um you say at",
    "start": "2943359",
    "end": "2953000"
  },
  {
    "text": "best I think that's a major problem um we can delete we can up we we can",
    "start": "2953000",
    "end": "2959920"
  },
  {
    "text": "just do a select star from I us on the backend of that guy",
    "start": "2959920",
    "end": "2967200"
  },
  {
    "text": "um I I could do but we're we're not going to get the no I can't unfortunately select star",
    "start": "2967200",
    "end": "2975680"
  },
  {
    "text": "from um tble users that's all if the the query Works",
    "start": "2975680",
    "end": "2983119"
  },
  {
    "text": "we're just going to be um redirected to either the login succeeded or the login",
    "start": "2983119",
    "end": "2988960"
  },
  {
    "text": "failed because we're not actually getting whatever the results Set uh back is I'm sorry you don't have a way of",
    "start": "2988960",
    "end": "2996079"
  },
  {
    "text": "returning to the web server the the record set is being returned to the web",
    "start": "2996079",
    "end": "3001119"
  },
  {
    "text": "server but the the the result of that record set is not being displayed in in the ASP page so",
    "start": "3001119",
    "end": "3008200"
  },
  {
    "text": "that's correct yeah theat that you said to put on is prevent",
    "start": "3008200",
    "end": "3014119"
  },
  {
    "text": "x correct the um Ms 0048 prevents the",
    "start": "3014119",
    "end": "3020000"
  },
  {
    "text": "the temporary stored procedures issue um using replace or is numeric on your ASP",
    "start": "3020000",
    "end": "3026319"
  },
  {
    "text": "pages on all user supplied input uh whether it be even a cookie um make sure",
    "start": "3026319",
    "end": "3032240"
  },
  {
    "text": "you're stripping out all all the dangerous stuff um and of course you can configure internet information server to",
    "start": "3032240",
    "end": "3038400"
  },
  {
    "text": "limit extended error information error information is a godsend if you're trying to break into a site basically",
    "start": "3038400",
    "end": "3045559"
  },
  {
    "text": "the patch just fixes the no check on permissions on the temp store procedure doesn't keep you from creating one um",
    "start": "3045559",
    "end": "3052520"
  },
  {
    "text": "correct um but we we can create a temporary storage procedure but you can actually configure um take an account and say I",
    "start": "3052520",
    "end": "3060599"
  },
  {
    "text": "don't want this person to create a temporary stor procedure you can do that as well I just think if you could then just redirect the temporary store",
    "start": "3060599",
    "end": "3066799"
  },
  {
    "text": "procedure that did do the select Splat from table name just to get the lid then to return the record set rather than",
    "start": "3066799",
    "end": "3073440"
  },
  {
    "text": "executing the command shell like you did well the the record set is always being returned it it's whether the ASP",
    "start": "3073440",
    "end": "3081200"
  },
  {
    "text": "page yeah if if it wants to show you the the result set for example if we're doing a search it of course is going to",
    "start": "3081200",
    "end": "3087880"
  },
  {
    "text": "show us the the record St because we've just searched for that that's not a helpful search page if they don't show",
    "start": "3087880",
    "end": "3093280"
  },
  {
    "text": "as being redirected yeah um we wouldn't be able to unless we",
    "start": "3093280",
    "end": "3101040"
  },
  {
    "text": "would had access to xpor CMD shell we wouldn't be able to overwrite files",
    "start": "3101040",
    "end": "3106640"
  },
  {
    "text": "um is that correct using bulk insert and bulk copy",
    "start": "3106640",
    "end": "3114359"
  },
  {
    "text": "um we might be able to do some stuff with that although I don't know um or",
    "start": "3114359",
    "end": "3120000"
  },
  {
    "text": "Echo well Echo would rely on xpor CMD shell but using bulk iner and",
    "start": "3120000",
    "end": "3126079"
  },
  {
    "text": "bulk we might be able to uh do some stuff there I'll have to think about that",
    "start": "3126079",
    "end": "3131839"
  },
  {
    "text": "further any other questions no well last",
    "start": "3131839",
    "end": "3138200"
  },
  {
    "text": "one sorry you you a paper this yes it should be in your",
    "start": "3138200",
    "end": "3144760"
  },
  {
    "text": "folders and that relieves me today thank [Applause]",
    "start": "3144760",
    "end": "3155179"
  },
  {
    "text": "you",
    "start": "3175440",
    "end": "3178440"
  },
  {
    "text": "e for",
    "start": "3205440",
    "end": "3209480"
  }
]