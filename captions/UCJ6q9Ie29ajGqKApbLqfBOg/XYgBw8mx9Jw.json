[
  {
    "start": "0",
    "end": "29000"
  },
  {
    "text": "welcome to my talk wi-fi brokering uh this is a talk for those who don't want to spend time",
    "start": "1839",
    "end": "7680"
  },
  {
    "text": "cracking hashes and probably want to connect to some people's wi-fi uh or trick people into connecting to you",
    "start": "7680",
    "end": "13280"
  },
  {
    "text": "so you can do horrible things to them or give them free internet depending uh who am i i'm michael kruger i'm",
    "start": "13280",
    "end": "18960"
  },
  {
    "text": "underscore cable thief on twitter i've been four years at sensepost which is now orange cyberdefence",
    "start": "18960",
    "end": "24400"
  },
  {
    "text": "and i've been dabbling in wi-fi attacks for about two years of those so what i'm going to discuss in this",
    "start": "24400",
    "end": "30480"
  },
  {
    "text": "talk uh the current attacks are available to us around what we're going to be talking",
    "start": "30480",
    "end": "35520"
  },
  {
    "text": "about so specifically peep new attacks that i've now created and presenting to you",
    "start": "35520",
    "end": "42239"
  },
  {
    "text": "building this thing so the problems i encountered other things we can relay using this new",
    "start": "42239",
    "end": "48640"
  },
  {
    "text": "capability that this enables you to do and then defending against it which might interest some people",
    "start": "48640",
    "end": "55520"
  },
  {
    "start": "55000",
    "end": "114000"
  },
  {
    "text": "so to start things off i just want to give uh an overview of what peep is so peep is protected eep but some sort",
    "start": "55520",
    "end": "62719"
  },
  {
    "text": "of microsoft thing and what it means is it's essentially",
    "start": "62719",
    "end": "68479"
  },
  {
    "text": "an eep authentication within a tls tunnel so the first thing that happens is the client device will set up a tls",
    "start": "68479",
    "end": "74640"
  },
  {
    "text": "tunnel with the access point and then provided it accepts the certificate that the access point presents",
    "start": "74640",
    "end": "80000"
  },
  {
    "text": "so kind of how websites work it will then within that tunnel do a ms chap challenge response",
    "start": "80000",
    "end": "88240"
  },
  {
    "text": "ms chap challenge response we'll go into a bit more detail just now but basically it can prove both sides",
    "start": "88240",
    "end": "95360"
  },
  {
    "text": "proves to both sides that the server knows the password and the client knows the password without actually passing",
    "start": "95360",
    "end": "101200"
  },
  {
    "text": "the password over and then the four-way handshake happens the",
    "start": "101200",
    "end": "106640"
  },
  {
    "text": "four-way handshake is then uses a key created from the previous steps so that's what finally connects",
    "start": "106640",
    "end": "112720"
  },
  {
    "text": "you to the wi-fi network cool so challenge response thus now being the thing that happens inside the",
    "start": "112720",
    "end": "118799"
  },
  {
    "start": "114000",
    "end": "182000"
  },
  {
    "text": "tls tunnel consists of first you send along your identity so this is typically sort of",
    "start": "118799",
    "end": "124320"
  },
  {
    "text": "your domain name so mine would be michael kruger the access point will then send along a",
    "start": "124320",
    "end": "130640"
  },
  {
    "text": "challenge which is 16 random bytes you as the client will take that",
    "start": "130640",
    "end": "136560"
  },
  {
    "text": "challenge you'll generate your own challenge put them together and calculate a response using the",
    "start": "136560",
    "end": "142319"
  },
  {
    "text": "password that you know you then send that response as well as your challenge over to the access point",
    "start": "142319",
    "end": "148000"
  },
  {
    "text": "access point does the same thing and if it gets the same result so it gets your response then it",
    "start": "148000",
    "end": "154239"
  },
  {
    "text": "knows that you know the password it will then do a similar thing and send its own response to you",
    "start": "154239",
    "end": "160160"
  },
  {
    "text": "as well as the success saying okay we validated your password it's correct you are allowed to connect to us at",
    "start": "160160",
    "end": "166080"
  },
  {
    "text": "which point the client will say okay cool i can connect but let's make sure that the server knows our password correctly first",
    "start": "166080",
    "end": "172400"
  },
  {
    "text": "and it will compare the response and do the whole thing again so once again both sides",
    "start": "172400",
    "end": "178800"
  },
  {
    "text": "know whether the password is correct or not so the current attack",
    "start": "178800",
    "end": "184000"
  },
  {
    "start": "182000",
    "end": "342000"
  },
  {
    "text": "on this involves standing up a rogue access point uh the victim typically a rogue access",
    "start": "184000",
    "end": "191360"
  },
  {
    "text": "point with the same name a victim will come along and connect to it they will have to accept your certificate so that you get into the",
    "start": "191360",
    "end": "197440"
  },
  {
    "text": "inner the inner phase so phase two uh the challenge response will be",
    "start": "197440",
    "end": "203040"
  },
  {
    "text": "performed in phase two the result of that challenge response is a hash which as you saw when you are the",
    "start": "203040",
    "end": "208640"
  },
  {
    "text": "access point you get a piece of information",
    "start": "208640",
    "end": "214239"
  },
  {
    "text": "uh so you get two challenges you get the piece of information with all those things if you keep pumping uh passwords into it",
    "start": "214239",
    "end": "220720"
  },
  {
    "text": "you can calculate the thing and you can validate it against that response that the server sent over so it gives you a way to guess passwords",
    "start": "220720",
    "end": "228640"
  },
  {
    "text": "offline and eventually you can crash the hash and connect to the network",
    "start": "228640",
    "end": "233760"
  },
  {
    "text": "so this cracking is done with typically i would do it with hashcat but",
    "start": "233760",
    "end": "239680"
  },
  {
    "text": "there are lots of other tools in hashcat you use the the hashtype net10tlm v1 which is 5500.",
    "start": "239680",
    "end": "247040"
  },
  {
    "text": "this is important later when i discussed some other ideas that i had but for now cracking ms chap",
    "start": "247040",
    "end": "253920"
  },
  {
    "text": "v2 is the same as cracking ntlm v1 here we have",
    "start": "253920",
    "end": "258959"
  },
  {
    "text": "just an example of the output so we have the username we have the response so this is the bit",
    "start": "258959",
    "end": "264880"
  },
  {
    "text": "that's calculated using the the two challenges from both sides we have that eight we have an eight octet",
    "start": "264880",
    "end": "270320"
  },
  {
    "text": "challenge uh and then we have the cracked password at the end",
    "start": "270320",
    "end": "276080"
  },
  {
    "text": "so uh this this is pretty much the state of things now and",
    "start": "276080",
    "end": "282800"
  },
  {
    "text": "that's great so you can get crack hashes and things for users you can then go use those hash those",
    "start": "282800",
    "end": "288800"
  },
  {
    "text": "passwords and things on mail and things like that uh in the wired world there's a second attack",
    "start": "288800",
    "end": "294160"
  },
  {
    "text": "available that's not available in the wireless world so the second attack is a relay attack",
    "start": "294160",
    "end": "301680"
  },
  {
    "text": "so what a relay attack is is you position yourself between the client and the server",
    "start": "301680",
    "end": "308000"
  },
  {
    "text": "you trick the client into connecting to you much like we were doing before but rather than handling that",
    "start": "308000",
    "end": "313440"
  },
  {
    "text": "authentication yourself so for example um calculating the response and all those things",
    "start": "313440",
    "end": "318720"
  },
  {
    "text": "instead of doing that you hand it off to a server that you know that you would like to authenticate",
    "start": "318720",
    "end": "323759"
  },
  {
    "text": "against so you can see in this diagram the identity comes in",
    "start": "323759",
    "end": "329680"
  },
  {
    "text": "rather than handling the identity we pass it directly off to a server the server sends back a challenge rather than handling that we once again just",
    "start": "329680",
    "end": "335360"
  },
  {
    "text": "send it to the client so on so forth so this allows us to connect to the server",
    "start": "335360",
    "end": "344320"
  },
  {
    "start": "342000",
    "end": "430000"
  },
  {
    "text": "while abusing someone else's authentication attempt there are two tools that we would use to",
    "start": "344320",
    "end": "349600"
  },
  {
    "text": "do this well that i personally use to do this there's probably much more the one is responder which is a great",
    "start": "349600",
    "end": "355680"
  },
  {
    "text": "tool for tricking people especially on windows networks interconnecting to you and then the other is multi-relay which",
    "start": "355680",
    "end": "362800"
  },
  {
    "text": "comes with responder or ntlm relay x which comes with the impact suite of tools which is is very nice",
    "start": "362800",
    "end": "370800"
  },
  {
    "text": "so the responder bit tricks people into connecting to you the relay bit the ntlm relay bit for example",
    "start": "370800",
    "end": "376240"
  },
  {
    "text": "relays to another host so you you trick the person connecting to the um the service and then rather than",
    "start": "376240",
    "end": "382560"
  },
  {
    "text": "handling that yourself possible the other host is the gist of it so here's just an example of what",
    "start": "382560",
    "end": "387600"
  },
  {
    "text": "that would look like responder calling out to people tricking them into connecting to you",
    "start": "387600",
    "end": "393199"
  },
  {
    "text": "the person will then start connecting you and they're actually talking to now ntlm relay x which in essence is them talking to a",
    "start": "393199",
    "end": "399840"
  },
  {
    "text": "server in the back end uh but at the final stage when the server says success you're allowed to",
    "start": "399840",
    "end": "404960"
  },
  {
    "text": "authenticate we tell the client you're not authenticating you got things wrong try",
    "start": "404960",
    "end": "410560"
  },
  {
    "text": "again later they go off and hopefully connect to whatever they wanted to connect to in the first place without causing too much",
    "start": "410560",
    "end": "416240"
  },
  {
    "text": "disruption to the user but meanwhile we've piggybacked off their authentication attempt and are now",
    "start": "416240",
    "end": "421680"
  },
  {
    "text": "authenticated against the server to do whatever they want to do for example access file share or do some administrative action or",
    "start": "421680",
    "end": "427919"
  },
  {
    "text": "something like that so in the wi-fi world we have that first portion we can trick people into",
    "start": "427919",
    "end": "433599"
  },
  {
    "start": "430000",
    "end": "532000"
  },
  {
    "text": "connecting to us this is basically what a rogue access point is uh just standing something up",
    "start": "433599",
    "end": "438639"
  },
  {
    "text": "with the same name and but we don't have the ability to sort of handle that authentication",
    "start": "438639",
    "end": "445199"
  },
  {
    "text": "or at least not handle that authentication and pass it off to someone else to handle for us so that's what i created so what do we",
    "start": "445199",
    "end": "452800"
  },
  {
    "text": "need to do this well we need to be able to handle this whole peep exchange and that means handling not",
    "start": "452800",
    "end": "460160"
  },
  {
    "text": "only that that relay in the middle but also the two other bits which is the four-way",
    "start": "460160",
    "end": "465360"
  },
  {
    "text": "handshake as well as the the outer tls tunnel so",
    "start": "465360",
    "end": "472960"
  },
  {
    "text": "you can see here i've i've kind of shown that we've got two two separate tls tunnels being set up",
    "start": "473039",
    "end": "478479"
  },
  {
    "text": "where as we are only relaying that inner ms chap thing and then we are setting up a different",
    "start": "478479",
    "end": "484479"
  },
  {
    "text": "four-way handshake at the end this is done using two components",
    "start": "484479",
    "end": "489520"
  },
  {
    "text": "so we'll see here that i have an evil server which in this instance i chose to use hosts apd mana which is",
    "start": "489520",
    "end": "496000"
  },
  {
    "text": "got all sorts of other wi-fi attacks built into it as well and that makes up this portion which is",
    "start": "496000",
    "end": "501759"
  },
  {
    "text": "the client being tricked it's connecting to us and we're handling that tls tunnel and that",
    "start": "501759",
    "end": "506879"
  },
  {
    "text": "four-way handshake but rather than handling that challenge response we pass it down to the",
    "start": "506879",
    "end": "512320"
  },
  {
    "text": "second portion which is the sick event which is a modified version of wpa",
    "start": "512320",
    "end": "517518"
  },
  {
    "text": "supplicant and that is handling its own separate tls tunnel and four-way handshake",
    "start": "517519",
    "end": "522959"
  },
  {
    "text": "so these two things work together to sort of ferry across that challenge response and then at the end hopefully we get a",
    "start": "522959",
    "end": "529519"
  },
  {
    "text": "success from the server and we can connect so building this thing as you saw i chose to use host apd",
    "start": "529519",
    "end": "536000"
  },
  {
    "start": "532000",
    "end": "638000"
  },
  {
    "text": "mana which is a modified version of host apd as well as wpa supplicant which is also very very popular and it",
    "start": "536000",
    "end": "543360"
  },
  {
    "text": "is the supplicant that is used or at least a modified version of it is probably used in android and",
    "start": "543360",
    "end": "551680"
  },
  {
    "text": "as i say very popular and also makes a really good thing to edit given how well supported is across",
    "start": "551680",
    "end": "557200"
  },
  {
    "text": "everything so we now have the two different separate",
    "start": "557200",
    "end": "562959"
  },
  {
    "text": "programs they need to be able to talk to each other i had a very complex system involving a",
    "start": "562959",
    "end": "568720"
  },
  {
    "text": "state file and files to go back and forth simplifies that for you into sycophant writes to file",
    "start": "568720",
    "end": "577279"
  },
  {
    "text": "mana picks up from file there's a state file which keeps track of where in the interaction",
    "start": "577279",
    "end": "584720"
  },
  {
    "text": "each of the ones is so if mana is in the challenge phase it knows",
    "start": "584720",
    "end": "590880"
  },
  {
    "text": "that it needs to inform a second fan that needs a challenge once it has that it",
    "start": "590880",
    "end": "596480"
  },
  {
    "text": "can say okay sycophant here's a response and it just uses files to do that the primary reason for files was that i",
    "start": "596480",
    "end": "602959"
  },
  {
    "text": "didn't want to learn how to do c uh inter process communications and things like that uh the the excuse i gave as to why",
    "start": "602959",
    "end": "610880"
  },
  {
    "text": "i'm using files is that it would allow me to easily do it over long distances",
    "start": "610880",
    "end": "616720"
  },
  {
    "text": "so for example you can synchronize a file using all sorts of different tools uh one on the server one in the client",
    "start": "616720",
    "end": "624079"
  },
  {
    "text": "and you can do this you can separate these things a lot better using the internet for",
    "start": "624079",
    "end": "629760"
  },
  {
    "text": "example however as you'll see later i found a way to do that that doesn't involve the files so it kind of",
    "start": "629760",
    "end": "635920"
  },
  {
    "text": "invalidates that point so here we have a demo so put all that together and this is",
    "start": "635920",
    "end": "642079"
  },
  {
    "start": "638000",
    "end": "831000"
  },
  {
    "text": "what we get so you can see here i have an interface",
    "start": "642079",
    "end": "648399"
  },
  {
    "text": "called wlan1 and it doesn't have an ip address i then use aerodump to",
    "start": "648399",
    "end": "655600"
  },
  {
    "text": "show what's around us there's an ssid called black cell and it's of type mash which means it's an eep server",
    "start": "655600",
    "end": "660720"
  },
  {
    "text": "i'm going to tell you now it's a peep server because i set it up there is a client as well so i'm going",
    "start": "660720",
    "end": "666640"
  },
  {
    "text": "to now cut the supplicant config file that we're going to be using you'll see there all we",
    "start": "666640",
    "end": "671839"
  },
  {
    "text": "needed to do is put in the ssid and you'll also note that the identity and the passwords are blank",
    "start": "671839",
    "end": "678000"
  },
  {
    "text": "cool on the and then we just run it so sycophant we give it the interface",
    "start": "678000",
    "end": "685360"
  },
  {
    "text": "this is the same interface i showed you earlier which doesn't have an ip address and then we give it that config file",
    "start": "685360",
    "end": "691360"
  },
  {
    "text": "that i showed as well",
    "start": "691360",
    "end": "694640"
  },
  {
    "text": "cool now it's waiting for mana to give it the identity of someone so it can start connecting as well",
    "start": "698320",
    "end": "703839"
  },
  {
    "text": "but on them on the client on the server side sorry we have mana we're using it on a",
    "start": "703839",
    "end": "709360"
  },
  {
    "text": "different interface we set the ssid to black cell and we tell it that we don't want you to handle the authentication instead you",
    "start": "709360",
    "end": "715120"
  },
  {
    "text": "want we want you to write it down to files and communicate with this other program",
    "start": "715120",
    "end": "720639"
  },
  {
    "text": "and then we just run it using that config file",
    "start": "720639",
    "end": "725279"
  },
  {
    "text": "so ep enabled right so now we have the evil client and the evil server they're both waiting",
    "start": "726160",
    "end": "732160"
  },
  {
    "text": "for someone to connect i'm just going to force that client to de-authenticate from the network it is on using a",
    "start": "732160",
    "end": "738399"
  },
  {
    "text": "de-authenticated frame and just setting it to black cell so this sends the authentication",
    "start": "738399",
    "end": "745360"
  },
  {
    "text": "on the same interface we ran uh error dump and then you can see that hopefully the",
    "start": "745360",
    "end": "750880"
  },
  {
    "text": "guy disconnects cool and you can see phase one stanley jobson phase two",
    "start": "750880",
    "end": "756639"
  },
  {
    "text": "so obviously they've now accepted our certificate you can see in the middle there there's a hash that came through",
    "start": "756639",
    "end": "762560"
  },
  {
    "text": "i've highlighted there and then another thing to note is that the at the end the client didn't fully like",
    "start": "762560",
    "end": "768639"
  },
  {
    "text": "they didn't finish connecting to us so they didn't perform the four-way handshake on the sycophant",
    "start": "768639",
    "end": "773680"
  },
  {
    "text": "side you can see we got the identity from mana and we began this whole process we got a challenge we sent it through",
    "start": "773680",
    "end": "780000"
  },
  {
    "text": "and then we got the response from the client finally getting an eep success from the the server itself and then doing the",
    "start": "780000",
    "end": "786399"
  },
  {
    "text": "four-way handshake so now i'll show you that we have gotten ourselves a ip address of 10-0-40-77",
    "start": "786399",
    "end": "794720"
  },
  {
    "text": "and then i have set up an web server on the gateway uh to just show that we have",
    "start": "794720",
    "end": "802079"
  },
  {
    "text": "internet access well internet internal network access cool success we can connect to",
    "start": "802079",
    "end": "809360"
  },
  {
    "text": "arbitrary wi-fi networks and we don't have to crack the the handshake well the past the hash which is which is very",
    "start": "809360",
    "end": "815360"
  },
  {
    "text": "nice uh something worth mentioning that the hash can be cracked in a reasonable time it's just a bunch of",
    "start": "815360",
    "end": "821199"
  },
  {
    "text": "it's three dezzes and you can go through the entire key space but it's still a lot of processing and a bit of a pain",
    "start": "821199",
    "end": "827760"
  },
  {
    "text": "so you won't be doing it on a pie or anything like that so why does this work once again we have",
    "start": "827760",
    "end": "834320"
  },
  {
    "start": "831000",
    "end": "911000"
  },
  {
    "text": "two separate tls tunnels and we have two separate four-way handshakes",
    "start": "834320",
    "end": "840399"
  },
  {
    "text": "whereas we have one uh challenge response so the reason this works is the four-way",
    "start": "840399",
    "end": "847519"
  },
  {
    "text": "handshake is the bit that actually connects you to the network in the at the end of all this right and the",
    "start": "847519",
    "end": "853600"
  },
  {
    "text": "values that go into that four-way handshake are calculated beforehand through the",
    "start": "853600",
    "end": "860240"
  },
  {
    "text": "the other interactions we've had now so unfortunately the four-way handshake by default is",
    "start": "860240",
    "end": "866480"
  },
  {
    "text": "only relying on the tls portion which we did ourselves meaning we have the information to do the four-way",
    "start": "866480",
    "end": "872079"
  },
  {
    "text": "handshake we just need a way to trick the server into accepting us using that four-way",
    "start": "872079",
    "end": "878240"
  },
  {
    "text": "handshake so the way to fix this is to use something called cryptobinding which",
    "start": "878240",
    "end": "883440"
  },
  {
    "text": "takes that outer authentication the tls and the inner authentication which is the ms",
    "start": "883440",
    "end": "888720"
  },
  {
    "text": "chap combines them together and uses them in the former handshake making it so that the same person has to do the both the",
    "start": "888720",
    "end": "896480"
  },
  {
    "text": "tls and the ms chat but as in that current situation uh we only need to perform the tls but",
    "start": "896480",
    "end": "903199"
  },
  {
    "text": "and we can get any other third party to do the other bit for us and we don't need that to finally connect",
    "start": "903199",
    "end": "911120"
  },
  {
    "start": "911000",
    "end": "955000"
  },
  {
    "text": "cool so the problems that i had while making this thing so there's a lot of time that i could",
    "start": "911120",
    "end": "917600"
  },
  {
    "text": "have saved by just reading the the rfc i would recommend that everyone reads the rfc",
    "start": "917600",
    "end": "922800"
  },
  {
    "text": "um i'll go over some of those just now and then the other problem was uh using only one platform so i was",
    "start": "922800",
    "end": "930000"
  },
  {
    "text": "testing against host apd all the time and then when i finally tested against a windows server it kind of",
    "start": "930000",
    "end": "937920"
  },
  {
    "text": "threw a hissy but that was because i was accidentally overwriting one or two bytes too many and then",
    "start": "937920",
    "end": "945839"
  },
  {
    "text": "what i've mentioned already is just doing things in c is always a it's always a mission and that's the",
    "start": "945839",
    "end": "951839"
  },
  {
    "text": "reason why i did things in the file system essentially cool so first problem with the rfc well",
    "start": "951839",
    "end": "958720"
  },
  {
    "start": "955000",
    "end": "1037000"
  },
  {
    "text": "the one that i had from not reading the rfc was the literature review so when i first had this idea i thought it",
    "start": "958720",
    "end": "965040"
  },
  {
    "text": "was a very obvious idea and i thought it must be done i asked some of the people",
    "start": "965040",
    "end": "970320"
  },
  {
    "text": "and no one knew anything about it and so i went looking i found like some slides",
    "start": "970320",
    "end": "976240"
  },
  {
    "text": "it wasn't very it was a bit vague it said it was possible there was definitely no tool to do it",
    "start": "976240",
    "end": "981930"
  },
  {
    "text": "[Music] and so searching around didn't find much essentially",
    "start": "981930",
    "end": "987680"
  },
  {
    "text": "after i'd finished everything made it it all works perfectly i go look at the bottom of the rfc",
    "start": "987680",
    "end": "993120"
  },
  {
    "text": "it's pretty much written in plain english you can see in 7.4 section about man in the middle attacks",
    "start": "993120",
    "end": "998240"
  },
  {
    "text": "explicitly says that where eep is tunneled with another protocol uh that emits pure authentication",
    "start": "998240",
    "end": "1004399"
  },
  {
    "text": "there's a potential vulnerability to man in the middle you can see for details see binding and mitum",
    "start": "1004399",
    "end": "1011120"
  },
  {
    "text": "i've already mentioned binding as a defense against this and mitum as",
    "start": "1011120",
    "end": "1018079"
  },
  {
    "text": "you'll see now with attack number two but yeah so beforehand before i made everything",
    "start": "1018079",
    "end": "1024160"
  },
  {
    "text": "put in all sorts of work things i thought i was revolutionary afterwards turns out it was just there in the rfc all along",
    "start": "1024160",
    "end": "1031839"
  },
  {
    "text": "so the second tack that this enables is the ability to attack clients so",
    "start": "1032079",
    "end": "1038319"
  },
  {
    "start": "1037000",
    "end": "1107000"
  },
  {
    "text": "previously what we would do is something called crack and add so essentially what that is trick someone is connecting to you you",
    "start": "1038319",
    "end": "1044319"
  },
  {
    "text": "get their hash you crack them you crack the hash and then you put that in your eep file",
    "start": "1044319",
    "end": "1049520"
  },
  {
    "text": "your ep users found and then when the client comes around a second time hopefully you get such an",
    "start": "1049520",
    "end": "1056000"
  },
  {
    "text": "opportunity they will connect you will be able to",
    "start": "1056000",
    "end": "1062480"
  },
  {
    "text": "validate the that final response given that you now know the password and they will connect to you with ios",
    "start": "1062480",
    "end": "1070960"
  },
  {
    "text": "devices which is now fixed by them um you would you could do the same thing",
    "start": "1070960",
    "end": "1076880"
  },
  {
    "text": "and ios was not validating that final part of the challenge response so ios mac whatever",
    "start": "1076880",
    "end": "1083760"
  },
  {
    "text": "the this lets you",
    "start": "1083760",
    "end": "1090000"
  },
  {
    "text": "return only just an eep success and then you can send along an invalid response and the ios device",
    "start": "1090080",
    "end": "1095520"
  },
  {
    "text": "would not check it and they would just end up connecting so that allows you it allows ios to get",
    "start": "1095520",
    "end": "1101280"
  },
  {
    "text": "more internet but you don't know where you're getting that internet from essentially",
    "start": "1101280",
    "end": "1106559"
  },
  {
    "text": "so just going through the current attack not against the ios you would stand up a rogue access point",
    "start": "1106559",
    "end": "1111600"
  },
  {
    "start": "1107000",
    "end": "1135000"
  },
  {
    "text": "you trick victims into connecting once again they'd have to accept your certificate uh you would perform the challenge",
    "start": "1111600",
    "end": "1117120"
  },
  {
    "text": "response capture that hash you would then go",
    "start": "1117120",
    "end": "1122160"
  },
  {
    "text": "crack that hash and then try and get the client to connect again so it's not very real time",
    "start": "1122160",
    "end": "1127200"
  },
  {
    "text": "unless they have a really really bad password which you can always hope for as well",
    "start": "1127200",
    "end": "1133919"
  },
  {
    "text": "so here's an example of what that sort of interaction would look like the client would send along this",
    "start": "1133919",
    "end": "1140320"
  },
  {
    "start": "1135000",
    "end": "1584000"
  },
  {
    "text": "identity server sends a challenge client calculates own challenge calculates response",
    "start": "1140320",
    "end": "1145760"
  },
  {
    "text": "sends it along server sends a bogus response as well as a success saying yes you can connect to me you've",
    "start": "1145760",
    "end": "1151760"
  },
  {
    "text": "authenticated please trust this response but the client of course in general won't trust",
    "start": "1151760",
    "end": "1157200"
  },
  {
    "text": "that response it would try and verify it it would fail and then the client wouldn't connect",
    "start": "1157200",
    "end": "1162840"
  },
  {
    "text": "so you'd kind of be stuck unless you had the client's password which is where the kraken ad comes in",
    "start": "1162840",
    "end": "1169039"
  },
  {
    "text": "so with relaying you can prove that you know the password or at least you can prove that somebody knows the password",
    "start": "1169039",
    "end": "1175360"
  },
  {
    "text": "not necessarily you so once again you set up your tls tunnel trick the person into connecting to you",
    "start": "1175360",
    "end": "1180799"
  },
  {
    "text": "they initiate the tls you start authenticating to a random server somewhere that doesn't know the",
    "start": "1180799",
    "end": "1185840"
  },
  {
    "text": "password the challenge response ensues the server",
    "start": "1185840",
    "end": "1190960"
  },
  {
    "text": "will send back a correct response because it knows the password you can then pass that to the user",
    "start": "1190960",
    "end": "1196240"
  },
  {
    "text": "and then once again because the four-way handshake is calculated using only stuff",
    "start": "1196240",
    "end": "1201280"
  },
  {
    "text": "from the tls tunnel you can",
    "start": "1201280",
    "end": "1206799"
  },
  {
    "text": "then uh both sides have all the information needed to set up the the forward handshake and connect",
    "start": "1206799",
    "end": "1213200"
  },
  {
    "text": "finally so that means uh the user can connect as well as",
    "start": "1213200",
    "end": "1218559"
  },
  {
    "text": "you just connecting to the access point as previously discussed so demo time let's go again",
    "start": "1218559",
    "end": "1226400"
  },
  {
    "text": "okay cool so once again i'm showing you that wlan1 doesn't have any ip address",
    "start": "1226400",
    "end": "1233520"
  },
  {
    "text": "and then i'm going to run aerodump and see that black cell is still there type managed",
    "start": "1233520",
    "end": "1239039"
  },
  {
    "text": "which is eep and there's a client connected once again we set up a sycophant the same way so no password or",
    "start": "1239039",
    "end": "1246000"
  },
  {
    "text": "anything setting the ssid typically you'd want to set the ssid",
    "start": "1246000",
    "end": "1251200"
  },
  {
    "text": "to something that the client is connected to already and then we run mana so now i'm using a",
    "start": "1251200",
    "end": "1260000"
  },
  {
    "text": "tool called berate app i've just given it some flags so berate ap is a tool i wrote to",
    "start": "1260000",
    "end": "1266080"
  },
  {
    "text": "sort of dynamically generate mana configs because i got tired of writing them so",
    "start": "1266080",
    "end": "1271760"
  },
  {
    "text": "the things to point out here is that we're once again passing it the sycophant flag saying that we want",
    "start": "1271760",
    "end": "1277200"
  },
  {
    "text": "it to relay the authentication rather than to calculate things itself we want it to return an eep success so",
    "start": "1277200",
    "end": "1283120"
  },
  {
    "text": "it's going to regardless of what it thinks is going to send it back in each success and then in combination with the",
    "start": "1283120",
    "end": "1288840"
  },
  {
    "text": "supplicant the sticker fan flag it's going to send a correct one once again we give it the",
    "start": "1288840",
    "end": "1295039"
  },
  {
    "text": "search we say run it on the second interface and run it on the first interface and call it black cell",
    "start": "1295039",
    "end": "1302159"
  },
  {
    "text": "okay once again we're gonna have to send a deal authentication frame to get the the user to disconnect",
    "start": "1302159",
    "end": "1310480"
  },
  {
    "text": "in this instance the user is a bit stubborn so it's time for my water break",
    "start": "1310480",
    "end": "1318960"
  },
  {
    "text": "and then now we wait once again we're just waiting for the",
    "start": "1318960",
    "end": "1324240"
  },
  {
    "text": "user to connect to us so that we can perform the tls they accept our certificate",
    "start": "1324240",
    "end": "1330000"
  },
  {
    "text": "send us all the things we need",
    "start": "1330000",
    "end": "1333840"
  },
  {
    "text": "cool send another the authentication and now the user comes through so you can see the identity came through",
    "start": "1336159",
    "end": "1342799"
  },
  {
    "text": "and then you see the same hash hashes as you saw before but at the end is different you'll see that an",
    "start": "1342799",
    "end": "1348480"
  },
  {
    "text": "accounting session started and there's a authentication the four-way handshake was performed and the user actually connected to us",
    "start": "1348480",
    "end": "1354640"
  },
  {
    "text": "on the supplicant side the sycophant side it's the same as before we also successfully connecting to the",
    "start": "1354640",
    "end": "1360400"
  },
  {
    "text": "access point cool so success validation that's the validation that was sent back to the",
    "start": "1360400",
    "end": "1366640"
  },
  {
    "text": "correctly computed one once again i run t-shock just on the the interface for the access point",
    "start": "1366640",
    "end": "1373440"
  },
  {
    "text": "and you can see that there's an apple device sending app requests so showing that they've properly",
    "start": "1373440",
    "end": "1380159"
  },
  {
    "text": "connected to us and yep cool",
    "start": "1380159",
    "end": "1386640"
  },
  {
    "text": "right so success again we can randomly trick people into connecting to us",
    "start": "1386640",
    "end": "1392080"
  },
  {
    "text": "and this allows us to do all sorts of crazy things so the nice thing about this is we can trick them into connecting to us while",
    "start": "1392080",
    "end": "1398640"
  },
  {
    "text": "using their authentication to connect to the legitimate server and that's what berate was providing me",
    "start": "1398640",
    "end": "1404480"
  },
  {
    "text": "in that instance was it was setting up all the networking between those two interfaces for me",
    "start": "1404480",
    "end": "1410559"
  },
  {
    "text": "so that a user the person that we've now tricked into connecting to us can still reach things",
    "start": "1410559",
    "end": "1416480"
  },
  {
    "text": "on the the legitimate access point so very nice",
    "start": "1416480",
    "end": "1423520"
  },
  {
    "text": "so i discussed distances before the reason i put things on a file system",
    "start": "1423919",
    "end": "1430640"
  },
  {
    "text": "but turns out uh host apd and by extension host apd mana has its own built-in radius server now",
    "start": "1430640",
    "end": "1437600"
  },
  {
    "text": "radius allows you to eap things over the network so that the thing that",
    "start": "1437600",
    "end": "1443039"
  },
  {
    "text": "you're authenticating to doesn't necessarily have to do all the authenticating so it sends along it talks radius to",
    "start": "1443039",
    "end": "1451039"
  },
  {
    "text": "another server so to do this over a long distance you set mana or host apd mana as a radius server",
    "start": "1451039",
    "end": "1458000"
  },
  {
    "text": "along with a sycophant so they need to still talk together using the file system but you can set up",
    "start": "1458000",
    "end": "1465520"
  },
  {
    "text": "an access point to use your radius server and point it at the radius server",
    "start": "1465520",
    "end": "1471120"
  },
  {
    "text": "obviously so provided these two things have a network connection between them you will be able to to do this attack over a long distance",
    "start": "1471120",
    "end": "1479200"
  },
  {
    "text": "uh the idea behind this was that you can while someone's sleeping for example you can go through a raspberry pi in their",
    "start": "1479200",
    "end": "1485200"
  },
  {
    "text": "garden and hopefully if they have a phone or their laptop it'll automatically try and connect your",
    "start": "1485200",
    "end": "1491919"
  },
  {
    "text": "thing your device and you can relay that while you are on site at a",
    "start": "1491919",
    "end": "1498559"
  },
  {
    "text": "near the corporate access point and so then you can connect to it the other thing that this lets you do is",
    "start": "1498559",
    "end": "1504559"
  },
  {
    "text": "you don't obviously you don't have to be near the access point so things like um sort of rogue access point protection",
    "start": "1504559",
    "end": "1511760"
  },
  {
    "text": "and you're not competing against a corporate access point which has probably much better signal than your little alpha card so you don't",
    "start": "1511760",
    "end": "1519120"
  },
  {
    "text": "have to go through all that trouble that was the idea behind that so it is possible the next idea i had",
    "start": "1519120",
    "end": "1525600"
  },
  {
    "text": "was given that netantlem v1 and ms chat v2 crack the",
    "start": "1525600",
    "end": "1532240"
  },
  {
    "text": "same with hash cut so they both use hashtag 5500 can't we relay from",
    "start": "1532240",
    "end": "1538400"
  },
  {
    "text": "the wireless world to the wired world so once again using the idea of throwing a",
    "start": "1538400",
    "end": "1543520"
  },
  {
    "text": "raspberry pi and a sysadmins garden you trick their device into authenticating to your",
    "start": "1543520",
    "end": "1549600"
  },
  {
    "text": "access point you relay that authentication and you pass it off to an smb server",
    "start": "1549600",
    "end": "1555520"
  },
  {
    "text": "which will let you authentic write their authentication so how we did it on the wired world but sort of going from",
    "start": "1555520",
    "end": "1561760"
  },
  {
    "text": "wireless to white so very cool idea this was actually the original plan i had when i first thought",
    "start": "1561760",
    "end": "1569279"
  },
  {
    "text": "of this idea given that at the time i thought okay i can relay people but the client doesn't want to give me",
    "start": "1569279",
    "end": "1575200"
  },
  {
    "text": "wi-fi so maybe i can do something with this but",
    "start": "1575200",
    "end": "1580799"
  },
  {
    "text": "you'll see why i can't so i compared the hashes they look the same",
    "start": "1580799",
    "end": "1586640"
  },
  {
    "start": "1584000",
    "end": "1601000"
  },
  {
    "text": "challenge eight octets response 24 octets uh you'll see in the ntl mv11",
    "start": "1586640",
    "end": "1591840"
  },
  {
    "text": "there's an lm response here you can safely throw that away but the nt response 24 octets challenge",
    "start": "1591840",
    "end": "1597200"
  },
  {
    "text": "8 octets as well so they line up and so once here we get to the point",
    "start": "1597200",
    "end": "1603440"
  },
  {
    "start": "1601000",
    "end": "1648000"
  },
  {
    "text": "where the iris not reading the rfc bit me again in that i did not read through it so",
    "start": "1603440",
    "end": "1611440"
  },
  {
    "text": "i immediately went into implementation i grabbed impact the same people the same project that",
    "start": "1611440",
    "end": "1616799"
  },
  {
    "text": "gave us that nice ntlm relay x i mentioned earlier so i programmed it to use ntlm1 all the time",
    "start": "1616799",
    "end": "1623360"
  },
  {
    "text": "as well as my whole complicated state file and challenge response file structure and",
    "start": "1623360",
    "end": "1629840"
  },
  {
    "text": "then it turns out looking through the code reading from the file my file for the challenge had 16 bytes",
    "start": "1629840",
    "end": "1636320"
  },
  {
    "text": "in it whereas i was only looking for eight bytes so this was a bit of a problem as i",
    "start": "1636320",
    "end": "1642640"
  },
  {
    "text": "can't fit 16 bytes into eight bytes so then i started investigating",
    "start": "1642640",
    "end": "1648080"
  },
  {
    "start": "1648000",
    "end": "1700000"
  },
  {
    "text": "and if i had read the rfc i could have seen at the bottom there's all sorts of pseudo code provided and",
    "start": "1648080",
    "end": "1654799"
  },
  {
    "text": "let me simplify this for you ms chap takes two 16 octet challenges",
    "start": "1654799",
    "end": "1659840"
  },
  {
    "text": "combines them together in a sha and takes eight characters and well eight bytes from there and then ntlmv1 kind of just passes over",
    "start": "1659840",
    "end": "1666720"
  },
  {
    "text": "eight bytes so given that what they're passing over the wire is different",
    "start": "1666720",
    "end": "1671760"
  },
  {
    "text": "you can't relay what they're passing over the wire from one to the other because the one would be expecting eight octets",
    "start": "1671760",
    "end": "1678480"
  },
  {
    "text": "while the other is only while the other is providing 16 octanes so that's sort of ruined my idea wasted a day doing all that",
    "start": "1678480",
    "end": "1684240"
  },
  {
    "text": "implementation and things like that and if you remember my complicated state file diagram before i simplified it for",
    "start": "1684240",
    "end": "1690720"
  },
  {
    "text": "you it was a bit of a pain re-working out how i did all this stuff so the takeaway read the rfc very",
    "start": "1690720",
    "end": "1698320"
  },
  {
    "text": "helpful so now we go into the defense",
    "start": "1698320",
    "end": "1703360"
  },
  {
    "start": "1700000",
    "end": "1899000"
  },
  {
    "text": "so the main thing here i think that you should take away is you should probably not use peep",
    "start": "1703360",
    "end": "1710720"
  },
  {
    "text": "so given its very nature users are able to set it up themselves",
    "start": "1710720",
    "end": "1716399"
  },
  {
    "text": "given that they know their passwords so a user has always wanted to going to want to get internet and get onto the",
    "start": "1716399",
    "end": "1722240"
  },
  {
    "text": "network where that might not be ideal because when they're setting up their",
    "start": "1722240",
    "end": "1729279"
  },
  {
    "text": "own wireless devices they're more likely to click don't validate the certificate because",
    "start": "1729279",
    "end": "1736559"
  },
  {
    "text": "it might be that they don't have the certificate on hand and they just really want wifi so that's the first the first failing",
    "start": "1736559",
    "end": "1744559"
  },
  {
    "text": "second thing is using a single strong method is preferable once again talking to",
    "start": "1744559",
    "end": "1752080"
  },
  {
    "text": "peep if you use purely certificates so for example eeptls a",
    "start": "1752080",
    "end": "1758559"
  },
  {
    "text": "user is not going to be getting that certificate and setting it up and things like that they're probably going to have to go to",
    "start": "1758559",
    "end": "1764320"
  },
  {
    "text": "their it team and and get that sorted so if you really really want to use peep",
    "start": "1764320",
    "end": "1771279"
  },
  {
    "text": "and you don't mind that you'll be giving away your hash you can enable cryptographic binding",
    "start": "1771279",
    "end": "1778080"
  },
  {
    "text": "so this defense steps in when people aren't validating their certificates and maybe your users have really strong",
    "start": "1778080",
    "end": "1784720"
  },
  {
    "text": "passwords that people aren't going to be able to crack but once again i said that ms chap",
    "start": "1784720",
    "end": "1790000"
  },
  {
    "text": "you can go through the entire key space so still not really good but if you enable",
    "start": "1790000",
    "end": "1797760"
  },
  {
    "text": "cryptogram binding at least people can't relay uh arbitrarily to your things and they",
    "start": "1797760",
    "end": "1802880"
  },
  {
    "text": "would then be forced to go through that sort of that mission of cracking the hashes cryptographic binding once again",
    "start": "1802880",
    "end": "1808880"
  },
  {
    "text": "just sort of binding the tls layer to the ms chat player and requiring that the same",
    "start": "1808880",
    "end": "1814000"
  },
  {
    "text": "person did the same did the authentication here we have an example of a windows",
    "start": "1814000",
    "end": "1820840"
  },
  {
    "text": "server uh where you can enable uh crypto binding so disconnect the",
    "start": "1820840",
    "end": "1826320"
  },
  {
    "text": "clients if they're not wanting to do it so that stops uh stops people authenticating unless",
    "start": "1826320",
    "end": "1832240"
  },
  {
    "text": "they're crypto bind and then here we have the client perspective where",
    "start": "1832240",
    "end": "1839200"
  },
  {
    "text": "uh disconnect if the server isn't presenting it's uh tls is not crypto binding so you have to",
    "start": "1839200",
    "end": "1844960"
  },
  {
    "text": "enable this on both sides so the person that's enabling it is the one that's protecting themselves so bear this in mind",
    "start": "1844960",
    "end": "1851919"
  },
  {
    "text": "so if only the server is crypto binding you can attack the client so the client",
    "start": "1851919",
    "end": "1857519"
  },
  {
    "text": "will still connect to you because when they start connecting um you don't have to present crypto binding",
    "start": "1857519",
    "end": "1865120"
  },
  {
    "text": "they you but when you connect to the server you say okay i will crypto bind but you just relay the um the inner",
    "start": "1865120",
    "end": "1872000"
  },
  {
    "text": "authentication as usual so that gets you the correct responses you need",
    "start": "1872000",
    "end": "1878080"
  },
  {
    "text": "on the client side you uh so the tour of the demand is enabled",
    "start": "1878080",
    "end": "1884320"
  },
  {
    "text": "on the client you can still attack the server so you when you present your rogue access point to the client you say",
    "start": "1884320",
    "end": "1890320"
  },
  {
    "text": "uh don't worry we're using crypto binding while the client won't connect to you you will still then be able to",
    "start": "1890320",
    "end": "1895760"
  },
  {
    "text": "relay the authentication and connect to the server so future work um given covert i've had",
    "start": "1895760",
    "end": "1902799"
  },
  {
    "start": "1899000",
    "end": "1943000"
  },
  {
    "text": "lots of time to work on sort of these sort of things and my idea was looking for more things to",
    "start": "1902799",
    "end": "1909200"
  },
  {
    "text": "relay so uh ms chap is actually quite popular it's used in a lot of things",
    "start": "1909200",
    "end": "1916240"
  },
  {
    "text": "and the next place i found it most widely used is in vpns specifically microsoft's",
    "start": "1916240",
    "end": "1921600"
  },
  {
    "text": "sstp and pptp and i've already sort of begun work into relaying from wi-fi",
    "start": "1921600",
    "end": "1928720"
  },
  {
    "text": "to that so in future you'll be able to trick people into connecting you and then you would then be able to connect",
    "start": "1928720",
    "end": "1934000"
  },
  {
    "text": "to their vpn which gets rid of the sort of locality element where you need to be",
    "start": "1934000",
    "end": "1940080"
  },
  {
    "text": "near the access point to connect to it here's my one meme which i think",
    "start": "1940080",
    "end": "1945679"
  },
  {
    "start": "1943000",
    "end": "1955000"
  },
  {
    "text": "represents a relay attack as you can see they're redirecting the water somewhere else",
    "start": "1945679",
    "end": "1951039"
  },
  {
    "text": "and that is my talk so thank you and any questions",
    "start": "1951039",
    "end": "1956960"
  }
]