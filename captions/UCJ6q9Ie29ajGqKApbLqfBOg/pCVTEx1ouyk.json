[
  {
    "start": "0",
    "end": "49000"
  },
  {
    "text": "so a hello and this talk if that's that's not obvious from from the title",
    "start": "0",
    "end": "6270"
  },
  {
    "text": "this talk is going to be about denial of service attacks and more specifically about defending from them you may ask",
    "start": "6270",
    "end": "13410"
  },
  {
    "text": "okay how should I know anything about that well let me introduce myself my name is Mark and I'm an engineer at a",
    "start": "13410",
    "end": "19710"
  },
  {
    "text": "performance and security company called culture and we provide a reverse proxy",
    "start": "19710",
    "end": "26160"
  },
  {
    "text": "and CDN services too many websites across the world actually operate on a fairly large network and most",
    "start": "26160",
    "end": "34170"
  },
  {
    "text": "importantly we are content neutral if you add that together many customers content-neutral you will see why we are",
    "start": "34170",
    "end": "41280"
  },
  {
    "text": "experienced in handling it now service attacks to give you some some flavor 4chan was one of our early customers and",
    "start": "41280",
    "end": "49550"
  },
  {
    "start": "49000",
    "end": "81000"
  },
  {
    "text": "to add some numbers into it if you haven't seen recent news if that doesn't",
    "start": "49550",
    "end": "54960"
  },
  {
    "text": "convince you that now services a threat here's numbers from us this is a number",
    "start": "54960",
    "end": "60840"
  },
  {
    "text": "of daily events that that are accounted as now service attempts per day over last couple of months the pic is quite",
    "start": "60840",
    "end": "68040"
  },
  {
    "text": "high about about 300 per day but the general trend is between 30 and 100 things we see every day some of them",
    "start": "68040",
    "end": "74340"
  },
  {
    "text": "very small some of them very large it kind of doesn't doesn't correlate that but basically they it happens every",
    "start": "74340",
    "end": "80880"
  },
  {
    "text": "single day and the denial service is generally a hard problem the idea is",
    "start": "80880",
    "end": "88560"
  },
  {
    "start": "81000",
    "end": "128000"
  },
  {
    "text": "that the attacker wants to overwhelm the target internet service with stuff and",
    "start": "88560",
    "end": "94650"
  },
  {
    "text": "this stuff can be either HTTP HTTP requests or DNS requests or just or just",
    "start": "94650",
    "end": "101220"
  },
  {
    "text": "random pockets it kind of doesn't matter what matters is that the resources on",
    "start": "101220",
    "end": "106229"
  },
  {
    "text": "the defender side are always constrained and it's fairly easy to overwhelm them",
    "start": "106229",
    "end": "112079"
  },
  {
    "text": "and defending from now service is particularly hard just because scaling out the attack is actually fairly easy",
    "start": "112079",
    "end": "119219"
  },
  {
    "text": "and it's fairly cheap on the other hand scaling out the infrastructure of the",
    "start": "119219",
    "end": "124530"
  },
  {
    "text": "defender side is usually fairly costly and actually fairly hard a successful",
    "start": "124530",
    "end": "130229"
  },
  {
    "start": "128000",
    "end": "230000"
  },
  {
    "text": "attack can affect the different layers of the applications and it's usually easiest to over them",
    "start": "130229",
    "end": "136980"
  },
  {
    "text": "the end application it's usually you know only few hundred HTTP requests per",
    "start": "136980",
    "end": "142350"
  },
  {
    "text": "second can take down your wordpress blog or or your ruby application and but",
    "start": "142350",
    "end": "148920"
  },
  {
    "text": "there are many other layers as well for example the Linux networking stack is",
    "start": "148920",
    "end": "155220"
  },
  {
    "text": "not fully scalable in turn in some context you can send it some package",
    "start": "155220",
    "end": "161160"
  },
  {
    "text": "that a the basically overwhelm and normal linux box at just about 300,000",
    "start": "161160",
    "end": "167100"
  },
  {
    "text": "package per second rate then there's next layer which is closer to the networking hardware it's more the",
    "start": "167100",
    "end": "172740"
  },
  {
    "text": "firewall layer and that scales very well at least on linux and you can expect to be able to do about 2 million packets",
    "start": "172740",
    "end": "178680"
  },
  {
    "text": "per second to give you some comparison a 10 gigabit network card is able to develop to about 10 million packets and",
    "start": "178680",
    "end": "185010"
  },
  {
    "text": "finally there is always somewhere router and router has also constrained capacity",
    "start": "185010",
    "end": "191550"
  },
  {
    "text": "usually the biggest problem is with just number of connections to the internet just the pipes going connecting q your",
    "start": "191550",
    "end": "198870"
  },
  {
    "text": "router to the internet this presentation will focus mostly on the operating system site and the application site is",
    "start": "198870",
    "end": "205950"
  },
  {
    "text": "way too specific for particle applications on the other hand the networking site is fairly well understood and thoroughly well",
    "start": "205950",
    "end": "211920"
  },
  {
    "text": "documented but I believe that the operating system kind of tweaks and kind of tips are not really well popularized",
    "start": "211920",
    "end": "218370"
  },
  {
    "text": "and and there's there's some really interesting studies you can do there to make your service more resilient so",
    "start": "218370",
    "end": "223980"
  },
  {
    "text": "hopefully by the end of the stock you will know how to make your internet service prepared for denial service and",
    "start": "223980",
    "end": "231120"
  },
  {
    "text": "this talk is structured in roughly five parts and we basically walk up the stock",
    "start": "231120",
    "end": "236820"
  },
  {
    "text": "we start from network and finish at a very large botnet so what about network",
    "start": "236820",
    "end": "242489"
  },
  {
    "start": "240000",
    "end": "256000"
  },
  {
    "text": "this is kind of the the biggest issue usually just because no matter what you",
    "start": "242489",
    "end": "247739"
  },
  {
    "text": "are doing if you just get enough junk packets hitting your services they will",
    "start": "247739",
    "end": "252989"
  },
  {
    "text": "overwhelm the capacity of your physical links and one thing if you can buy more links but this is not really either",
    "start": "252989",
    "end": "259650"
  },
  {
    "start": "256000",
    "end": "345000"
  },
  {
    "text": "cheap or nor and nor you can't do it really on when the attack happens so",
    "start": "259650",
    "end": "265979"
  },
  {
    "text": "what people are doing around the war all these people are using a beach bill now routing beautiful now routing is a special contract between a router and an",
    "start": "265979",
    "end": "274290"
  },
  {
    "text": "ISP router and in between our routing the idea is that your router informs the",
    "start": "274290",
    "end": "279300"
  },
  {
    "text": "internet service provider to basically note route any traffic to some IP addresses so basically you can remove",
    "start": "279300",
    "end": "285960"
  },
  {
    "text": "your IP addresses from the internet this solves the congestion problem because you see no pockets flowing in but",
    "start": "285960",
    "end": "291990"
  },
  {
    "text": "obviously the service will not be available so that now service will be successful so to counter that it's",
    "start": "291990",
    "end": "297870"
  },
  {
    "text": "absolutely critical to be able to move internet services around IP addresses",
    "start": "297870",
    "end": "303210"
  },
  {
    "text": "and in fact this is what we are doing all the time when we see a denial",
    "start": "303210",
    "end": "308639"
  },
  {
    "text": "service hitting one of our HTTP servers then we quite often now route this IP",
    "start": "308639",
    "end": "313979"
  },
  {
    "text": "addresses that are affected and then we move the HTTP servers to different IP addresses and we can do that because we",
    "start": "313979",
    "end": "320820"
  },
  {
    "text": "are fairly well prepared for once we have dns time to lifts values fairly low",
    "start": "320820",
    "end": "326310"
  },
  {
    "text": "and second thing is we are very confident in our DNS infrastructure that we can can actually no propagate the",
    "start": "326310",
    "end": "332970"
  },
  {
    "text": "changes rapidly the big question here is what happens if the now service follows onto the new IP IP addresses and this is",
    "start": "332970",
    "end": "340289"
  },
  {
    "text": "generally a hard problem but some of the floods do not follow some of the acts will not follow into the new IP addresses okay so from now on let's",
    "start": "340289",
    "end": "347699"
  },
  {
    "start": "345000",
    "end": "390000"
  },
  {
    "text": "assume that there is not any problem with a network let's assume that little condition doesn't occur that you have",
    "start": "347699",
    "end": "353340"
  },
  {
    "text": "still some capacity on the network layer available and the rule of thumb is that",
    "start": "353340",
    "end": "358470"
  },
  {
    "text": "you should allow the packets to flow it's it's incorrect in my opinion to null route traffic if it doesn't cost",
    "start": "358470",
    "end": "364650"
  },
  {
    "text": "congestion and it's usually a bit too severe to cut traffic on the router layer just because you can do much",
    "start": "364650",
    "end": "370650"
  },
  {
    "text": "better work at different layers so ideally you would you would allow the packets to flow to the end server so",
    "start": "370650",
    "end": "377880"
  },
  {
    "text": "here's an example of a flood that was hitting at one of our servers and you",
    "start": "377880",
    "end": "383130"
  },
  {
    "text": "can see that there is some normal baseline traffic and then the flood hit and it peaked at about 800,000 packets",
    "start": "383130",
    "end": "388979"
  },
  {
    "text": "per second to the server okay what was in those buckets and here's an example it could have been a UDP DNS flood with",
    "start": "388979",
    "end": "396000"
  },
  {
    "start": "390000",
    "end": "405000"
  },
  {
    "text": "just many many many queries our DNS resolvers there Tydeus alternative servers asking for",
    "start": "396000",
    "end": "402809"
  },
  {
    "text": "resolution of say example.com and actually if you allow those packets to",
    "start": "402809",
    "end": "408599"
  },
  {
    "start": "405000",
    "end": "420000"
  },
  {
    "text": "hit the DNS application the DNS server dinner will not be happy there is no dns",
    "start": "408599",
    "end": "414569"
  },
  {
    "text": "server in the world that can handle a 800,000 requests per second on a single",
    "start": "414569",
    "end": "419639"
  },
  {
    "text": "machine and the big news here is where the pockets are actually coming from and",
    "start": "419639",
    "end": "424679"
  },
  {
    "start": "420000",
    "end": "443000"
  },
  {
    "text": "the big news is they are not legitimate if you see high volume pockets on your network they are not coming from real",
    "start": "424679",
    "end": "431009"
  },
  {
    "text": "applications they are coming from denial of service tools that are just crafted",
    "start": "431009",
    "end": "436619"
  },
  {
    "text": "to send you many millions packets per second they once again do not come from really real users and it's critical",
    "start": "436619",
    "end": "443579"
  },
  {
    "start": "443000",
    "end": "473000"
  },
  {
    "text": "because if they don't come from real users then actually a correct thing to do is to drop the packets if if the",
    "start": "443579",
    "end": "450059"
  },
  {
    "text": "packets are invalid are basically specially crafted there is no reason to even answer them and to give you some",
    "start": "450059",
    "end": "458399"
  },
  {
    "text": "idea of the scale in many of the attacks that we see it's only one in about 10,000 packets on our network that is",
    "start": "458399",
    "end": "465659"
  },
  {
    "text": "legitimate so you can imagine a scale and and and what would be a CPU use if you actually try to handle those all",
    "start": "465659",
    "end": "472469"
  },
  {
    "text": "right so so we define that we want to",
    "start": "472469",
    "end": "477509"
  },
  {
    "start": "473000",
    "end": "537000"
  },
  {
    "text": "drop the invalid packets but how do you know which packets are actually involved and there are many different",
    "start": "477509",
    "end": "482879"
  },
  {
    "text": "characteristics you can use so many people initially look at very simple selectors like packet length in the",
    "start": "482879",
    "end": "488999"
  },
  {
    "text": "flood that I showed you a few slides ago there was a very distinguishing characteristics all the packet has had",
    "start": "488999",
    "end": "494819"
  },
  {
    "text": "exactly 50 bytes of length but unfortunately packet link is not very good sir Ector it can lead to high rate",
    "start": "494819",
    "end": "502589"
  },
  {
    "text": "of false positives there's actually a very high probability there are some real requests of length 50 bytes so a",
    "start": "502589",
    "end": "508709"
  },
  {
    "text": "way better way of dealing with with now service packets is to look at payload",
    "start": "508709",
    "end": "516029"
  },
  {
    "text": "and see what they're actually asking for and in a very many cases i would say in May big majority by inspecting the pale",
    "start": "516029",
    "end": "522929"
  },
  {
    "text": "of pockets you can actually cut the only d but traffic and leave the good traffic",
    "start": "522929",
    "end": "527959"
  },
  {
    "text": "flowing so basically a false positives will be fairly small alright so there",
    "start": "527959",
    "end": "532980"
  },
  {
    "text": "are many ways you cannot the cut buckets in enviro layer the popular ones are string module and the",
    "start": "532980",
    "end": "539130"
  },
  {
    "start": "537000",
    "end": "694000"
  },
  {
    "text": "u32 module but we don't encourage users you use them on the other hand we are extremely enthusiastic about a module",
    "start": "539130",
    "end": "546300"
  },
  {
    "text": "called BPF and hearsay in usage an example use it here you can see in iptables command with some selectors and",
    "start": "546300",
    "end": "552899"
  },
  {
    "text": "then the BPF bytecode command and then a series of numbers those numbers look fairly magical what are those numbers",
    "start": "552899",
    "end": "558899"
  },
  {
    "text": "well those numbers is just another way of representing the same programmers here so this is this is the same program",
    "start": "558899",
    "end": "564630"
  },
  {
    "text": "it is just described as in kind of more mini Monique more assemble like version and you can see here some load",
    "start": "564630",
    "end": "570240"
  },
  {
    "text": "instructions some some arithmetic instructions some jumps so in this bytecode which you are giving type II",
    "start": "570240",
    "end": "576660"
  },
  {
    "text": "tables you can actually describe a fairly rich program it's not actually a full program it's not curing complete",
    "start": "576660",
    "end": "582870"
  },
  {
    "text": "the length is fairly fixed you cannot have more than 60 for instructions and",
    "start": "582870",
    "end": "589589"
  },
  {
    "text": "all you can only also have loops you can only do jumps forward but still you have",
    "start": "589589",
    "end": "594600"
  },
  {
    "text": "gigantic flexibility and actually being able to much based on payload okay well",
    "start": "594600",
    "end": "600000"
  },
  {
    "text": "this is all cool but where it came from and this is an interesting story so the BPF bytecode in the iptables came from",
    "start": "600000",
    "end": "606209"
  },
  {
    "text": "originally from the kids be dumped world if you ever use TCP dump you know that you can select like old gear TCP dump",
    "start": "606209",
    "end": "612540"
  },
  {
    "text": "please give me only UDP packets or only syn packets what actually happens under the hood is TCP dump compiles this",
    "start": "612540",
    "end": "618930"
  },
  {
    "text": "expression and to this vpf bytecode to the series of numbers and then gives those years of numbers to Colonel saying",
    "start": "618930",
    "end": "625140"
  },
  {
    "text": "dear Colonel here's my filtering program please give me only the package that much does this program and this was with",
    "start": "625140",
    "end": "631380"
  },
  {
    "text": "us in the industry for now 20 years I but only recently that was introduced in the 50 layer so this is this is so being",
    "start": "631380",
    "end": "638520"
  },
  {
    "text": "able to run BPF on viral is fairly new the the unfortunate truth is that the tools around DBP write codes are fairly",
    "start": "638520",
    "end": "645450"
  },
  {
    "text": "scarce usually you can only use TCP dump expressions and TCB have expressions are fairly limited you cannot account expose",
    "start": "645450",
    "end": "652320"
  },
  {
    "text": "the full potential of DB PFD kind of the assembly language and so there are some",
    "start": "652320",
    "end": "657630"
  },
  {
    "text": "benefits in hunt crafting the BBS mountain manual and actually it's quite cool to write those those programs so we",
    "start": "657630",
    "end": "664410"
  },
  {
    "text": "open sourced our library our series of small Python programs that generate BPF bytecode and",
    "start": "664410",
    "end": "671170"
  },
  {
    "text": "we were particularly interested in the DNS buckets so with our BPF tools you",
    "start": "671170",
    "end": "676750"
  },
  {
    "text": "can actually help EPF programs that will match on domain names that we can I say",
    "start": "676750",
    "end": "681880"
  },
  {
    "text": "please much on all the DNS requests that go to say all the subdomains of example",
    "start": "681880",
    "end": "687010"
  },
  {
    "text": "com or you can do the same thing a case-insensitive lee or you can try too much based on involved ears packets",
    "start": "687010",
    "end": "692800"
  },
  {
    "text": "things like that this is totally effective against most common now service attacks and on iptables layer",
    "start": "692800",
    "end": "699190"
  },
  {
    "text": "you should be able to do about 2 million packets per second by do I mean drop and end your DNS server will be very happy",
    "start": "699190",
    "end": "705460"
  },
  {
    "text": "because you will drop all the involved packets and only good pockets will flow to the application unfortunately it only",
    "start": "705460",
    "end": "711880"
  },
  {
    "text": "scales up to a moment let's say this two million pockets and above that is your you're very likely to encounter",
    "start": "711880",
    "end": "717490"
  },
  {
    "text": "interrupt storms show you the flood if the DNS flood is bigger then you'd",
    "start": "717490",
    "end": "723160"
  },
  {
    "text": "afresh hold basically all the CPUs and your machine will be busy we'll just",
    "start": "723160",
    "end": "728320"
  },
  {
    "text": "receive packets not doing any real work but just doing head work work use code and drop storms there is a way around it",
    "start": "728320",
    "end": "734770"
  },
  {
    "text": "but let me first speak about network cards so in normal modern network cards",
    "start": "734770",
    "end": "741190"
  },
  {
    "start": "737000",
    "end": "765000"
  },
  {
    "text": "are designed to be able to share the load across multiple sitios how it works internally is that they split the",
    "start": "741190",
    "end": "748540"
  },
  {
    "text": "packets across multiple recipients and then one cpu has exactly one receive queue and receives packets from this",
    "start": "748540",
    "end": "754000"
  },
  {
    "text": "receive queue and then give it to the firewall layer gives it to the networking stuck layer gives it to the",
    "start": "754000",
    "end": "759910"
  },
  {
    "text": "application at the end this is pretty much a lot of work so this is why it's not really that fast in order to make a",
    "start": "759910",
    "end": "766780"
  },
  {
    "start": "765000",
    "end": "797000"
  },
  {
    "text": "packet processing faster and what the established technique is to use colonel",
    "start": "766780",
    "end": "772780"
  },
  {
    "text": "bypass colonel bypass is an idea that you don't actually need the full operating system you can all you can do",
    "start": "772780",
    "end": "778660"
  },
  {
    "text": "all the processing user space and that works both for complications and refusers the colonel package you can get",
    "start": "778660",
    "end": "783820"
  },
  {
    "text": "much better performance mode better throughput but the problem here is that you're a colonel networking stack is",
    "start": "783820",
    "end": "790030"
  },
  {
    "text": "completely disconnected from this flow which may be or may not be what you want if you for example have only single",
    "start": "790030",
    "end": "795310"
  },
  {
    "text": "application on a con server this may be what you want on the other hand if you have a rich and as what we do well you cannot really",
    "start": "795310",
    "end": "802750"
  },
  {
    "start": "797000",
    "end": "832000"
  },
  {
    "text": "afford to give away the whole network card just to the colonel by bus so the way around it is to use a technique",
    "start": "802750",
    "end": "808300"
  },
  {
    "text": "called partial credit card no bypass also known sometimes as before gated driver and the idea here is that most of",
    "start": "808300",
    "end": "813880"
  },
  {
    "text": "the received cues will go normally to the kind of slow puff will go to the Linux kernel and the processing will",
    "start": "813880",
    "end": "819910"
  },
  {
    "text": "follow us usual no changes here but then you can select some of the network flows and select them to the dedicated receive",
    "start": "819910",
    "end": "826450"
  },
  {
    "text": "queue and have a user space program pulling from this receive queue directly and get much better throughput there and",
    "start": "826450",
    "end": "832380"
  },
  {
    "start": "832000",
    "end": "895000"
  },
  {
    "text": "this technique we learned from the ESD I framework which is available on solar flare network cards but we are so",
    "start": "832380",
    "end": "839290"
  },
  {
    "text": "impressed by that that we decided to write an open-source support for that so we wrote a patch to a net map open",
    "start": "839290",
    "end": "846580"
  },
  {
    "text": "source Colonel bypass library network is available on linux and freebsd so if our",
    "start": "846580",
    "end": "852010"
  },
  {
    "text": "part you should be able to do colonel bypass on a number of network cards and",
    "start": "852010",
    "end": "857860"
  },
  {
    "text": "okay so why am I talking about that it's because this is exactly what we are doing to get our IP tables front faster",
    "start": "857860",
    "end": "864760"
  },
  {
    "text": "so what we do is we have a program at looks at IP table statistics in kind of",
    "start": "864760",
    "end": "869770"
  },
  {
    "text": "in background and when it sees that there is a BPF rule or a number of EPF rules that are being heavily hammered by",
    "start": "869770",
    "end": "876160"
  },
  {
    "text": "the attack and there is a high potential of hitting enter up storms then this program will take over one of the",
    "start": "876160",
    "end": "882670"
  },
  {
    "text": "receive cuse will push all the denial service traffic on to that receive queue with and slow steering cruise and then",
    "start": "882670",
    "end": "889540"
  },
  {
    "text": "will basically run the DPF rules very very close to the hardware in user space without any colonel interruption and",
    "start": "889540",
    "end": "894850"
  },
  {
    "text": "interruption and this allows us to get really good performance we can easily get three million packets per second on",
    "start": "894850",
    "end": "900010"
  },
  {
    "start": "895000",
    "end": "903000"
  },
  {
    "text": "just a single core of this offload and it works very well across all our fleet",
    "start": "900010",
    "end": "906310"
  },
  {
    "start": "903000",
    "end": "939000"
  },
  {
    "text": "so here's a graph of number of dropped packets across all our servers and it's",
    "start": "906310",
    "end": "911980"
  },
  {
    "text": "a it's the kind of trend is we are using dropping about 75 million packets per second with some spikes of more than 100",
    "start": "911980",
    "end": "918700"
  },
  {
    "text": "and it's it although it is over all our servers I can I can I can reassure you",
    "start": "918700",
    "end": "924310"
  },
  {
    "text": "many servers were fairly busy during those floods okay so this is all nice",
    "start": "924310",
    "end": "929680"
  },
  {
    "text": "and this is all very very happy and yes are very effective but there are certain types of packet floods that",
    "start": "929680",
    "end": "936970"
  },
  {
    "text": "actually do not cannot be blocked on the PF layer I'll give you an example so here's an example of an aqua flood no",
    "start": "936970",
    "end": "943390"
  },
  {
    "start": "939000",
    "end": "961000"
  },
  {
    "text": "those are packets on too soupy layer with spoofed source IP addresses with spoofed acknowledgement numbers with",
    "start": "943390",
    "end": "950440"
  },
  {
    "text": "just one bit set diac a big bit set and the problem is that DPF cannot really distinguish which pocket here is good",
    "start": "950440",
    "end": "956800"
  },
  {
    "text": "and bad it's totally possible at one of those packets belongs to real connection and to make things even worse normal",
    "start": "956800",
    "end": "963900"
  },
  {
    "start": "961000",
    "end": "977000"
  },
  {
    "text": "Linux is the handling of up flags in particular is pretty weak and all the",
    "start": "963900",
    "end": "969280"
  },
  {
    "text": "acts have to be serialized against a single look in a listen queue data",
    "start": "969280",
    "end": "974740"
  },
  {
    "text": "structure so the performance is pretty weak but the good news is that there is a simple way around it and that's to",
    "start": "974740",
    "end": "981430"
  },
  {
    "start": "977000",
    "end": "1014000"
  },
  {
    "text": "enable a stateful firewall in the Knox called contract here's an example I be able through which basically match all",
    "start": "981430",
    "end": "987460"
  },
  {
    "text": "the packets that don't belong to any valid established TCP IP connections",
    "start": "987460",
    "end": "992790"
  },
  {
    "text": "here's a bit of warning in order for that rule to work you must disable the",
    "start": "992790",
    "end": "998020"
  },
  {
    "text": "TCP lose option on City cccd option C CTL is enabled by default so this is",
    "start": "998020",
    "end": "1004140"
  },
  {
    "text": "very important if you don't disable TCP those option contract will actually create new flows for each of the Act",
    "start": "1004140",
    "end": "1010260"
  },
  {
    "text": "packets which makes three things even worse alright so if properly configured contract you should be able to get about",
    "start": "1010260",
    "end": "1015840"
  },
  {
    "start": "1014000",
    "end": "1033000"
  },
  {
    "text": "2 million packets again and this works fairly effective against number of TCP",
    "start": "1015840",
    "end": "1021150"
  },
  {
    "text": "attacks like our flats or xmas class or I have weird combinations but what about syn floods well Santa's are a bit",
    "start": "1021150",
    "end": "1027870"
  },
  {
    "text": "different just because a contract will actually create you a new flow for each of the incoming syn packets and this",
    "start": "1027870",
    "end": "1034319"
  },
  {
    "start": "1033000",
    "end": "1039000"
  },
  {
    "text": "will actually make things even worse it does because contract will slow down so slow it down a bit and and in normal",
    "start": "1034320",
    "end": "1041100"
  },
  {
    "start": "1039000",
    "end": "1047000"
  },
  {
    "text": "cases linux is not very good at handling a syn floods you should not get through many buckets and it's actually very easy",
    "start": "1041100",
    "end": "1048209"
  },
  {
    "text": "to overwhelm a network service let me explain so if you have a bound socket if you p socket you have an application",
    "start": "1048209",
    "end": "1054240"
  },
  {
    "text": "listening on the circuit under the hood there are two data structures created one is called listen backlog another called sin backlog and cinema cook is",
    "start": "1054240",
    "end": "1060720"
  },
  {
    "text": "the interesting one here and soon but basically saves some data from the incoming syn packet and",
    "start": "1060720",
    "end": "1065970"
  },
  {
    "text": "happens if sin backlog is being is full if the number of Simba cats is",
    "start": "1065970",
    "end": "1070980"
  },
  {
    "text": "increasing and it's basically being over filled and unfortunately old Newsome",
    "start": "1070980",
    "end": "1075990"
  },
  {
    "text": "buckets will get slot dropped and the only way around it is to enable some cookies so if anyone tells you that",
    "start": "1075990",
    "end": "1082460"
  },
  {
    "text": "enabling single case is a bad idea well the counter-argument is that without sin cookies is extremely easy to basically",
    "start": "1082460",
    "end": "1089520"
  },
  {
    "text": "disallow any new connections from coming to your application all right so Cinco case is a kind of crypto technique that",
    "start": "1089520",
    "end": "1095460"
  },
  {
    "text": "allows you to skip the state and sin backlog but because it's it's a kind of a bit hockey a technique it actually",
    "start": "1095460",
    "end": "1101460"
  },
  {
    "text": "doesn't and it doesn't save anything from the original sin pocket some people say it's an it affects the performance",
    "start": "1101460",
    "end": "1107280"
  },
  {
    "text": "for example because the windows scaling a TCP option is not being preserved this",
    "start": "1107280",
    "end": "1112770"
  },
  {
    "text": "is correct well until you use TCP timestamps to exist early a cool and it's a really smart on that and if you",
    "start": "1112770",
    "end": "1119669"
  },
  {
    "text": "enable TCP times x and linux will have few more bits to save some data and we'll be able to then get better",
    "start": "1119669",
    "end": "1126450"
  },
  {
    "text": "performance by using more modern tcp options ok but even with all this magic",
    "start": "1126450",
    "end": "1131580"
  },
  {
    "text": "again the performance is not really very good again Linux is not really able to send more than around 300,000 buckets",
    "start": "1131580",
    "end": "1138539"
  },
  {
    "text": "sim cookies per second just because there is there is this log structure but",
    "start": "1138539",
    "end": "1144750"
  },
  {
    "text": "there is light at the end of the tunnel there is a new sets of patches which will be merged I think there are merged",
    "start": "1144750",
    "end": "1151169"
  },
  {
    "text": "against the new development branch of linux kernel we should be released as for that for hopefully soon and this",
    "start": "1151169",
    "end": "1157559"
  },
  {
    "text": "series of patches remove this listen log so with this new not released yet colonel you should be able to get one to",
    "start": "1157559",
    "end": "1163530"
  },
  {
    "text": "two million copies per second ok so that's that's that's all about the kind of high-volume packet thoughts let's",
    "start": "1163530",
    "end": "1170100"
  },
  {
    "start": "1166000",
    "end": "1203000"
  },
  {
    "text": "move a layer up let's move to Real botnets and the real botnets have a very nice characteristics it is they are",
    "start": "1170100",
    "end": "1177360"
  },
  {
    "text": "usually real devices with real operating systems with real networking stock and",
    "start": "1177360",
    "end": "1182909"
  },
  {
    "text": "this is brilliant because the you will not see high volume pockets and you will",
    "start": "1182909",
    "end": "1189360"
  },
  {
    "text": "see different characteristics but not high volume pockets so you'll see like concurrent connections account growing",
    "start": "1189360",
    "end": "1194490"
  },
  {
    "text": "up or sockets and some states like time weights or orphaned orphan this my my my my preferred",
    "start": "1194490",
    "end": "1201990"
  },
  {
    "text": "sockets eight anyway it's fairly easy to overwhelm and application again just",
    "start": "1201990",
    "end": "1207810"
  },
  {
    "start": "1203000",
    "end": "1211000"
  },
  {
    "text": "with sheer number of concurrent connections or a concurrent requests but the good news is that since the",
    "start": "1207810",
    "end": "1213240"
  },
  {
    "start": "1211000",
    "end": "1293000"
  },
  {
    "text": "connections are real since the bots are actually real devices somewhere you can actually use IP reputation you can",
    "start": "1213240",
    "end": "1218730"
  },
  {
    "text": "actually look at source IP addresses this is very efficient and effective most likely because both botnets",
    "start": "1218730",
    "end": "1225900"
  },
  {
    "text": "actually try to generate us high load as possible from a single IP address so they are easily recognizable by just",
    "start": "1225900",
    "end": "1232230"
  },
  {
    "text": "looking at the source IP addresses so when we see a if a denial service attempt from botnet what we do is the",
    "start": "1232230",
    "end": "1239220"
  },
  {
    "text": "first thing is we enabled a contract con limit a pitch Peter this allows us to limit number of concurrent connections",
    "start": "1239220",
    "end": "1245430"
  },
  {
    "text": "coming from each source IP address which basically makes makes that we are sure that not a single IP address will",
    "start": "1245430",
    "end": "1251670"
  },
  {
    "text": "generate too high load second thing what we are doing is we are rate limit number of syn packets per second and we can do",
    "start": "1251670",
    "end": "1257820"
  },
  {
    "text": "that with with hash limits are limits is extremely powerful iptables module and",
    "start": "1257820",
    "end": "1263660"
  },
  {
    "text": "this is this is done in order to make sure that the even if the body is not",
    "start": "1263660",
    "end": "1270090"
  },
  {
    "text": "able to establish connections to rapidly taller service finally I psets is another very exciting feature of IP",
    "start": "1270090",
    "end": "1275730"
  },
  {
    "text": "labels and it allows you to do a why to this thing called blacklist you collect the addresses more kind of manually if",
    "start": "1275730",
    "end": "1282000"
  },
  {
    "text": "you want to see some examples of IP tables and end users of those techniques at the end download the PDF of this",
    "start": "1282000",
    "end": "1287940"
  },
  {
    "text": "presentation at the end of the PDF there are like 20 slides with with examples I iptables okay and there's one more thing",
    "start": "1287940",
    "end": "1296130"
  },
  {
    "start": "1293000",
    "end": "1324000"
  },
  {
    "text": "i would like to mention which is what we saw is that many bottners just open",
    "start": "1296130",
    "end": "1301920"
  },
  {
    "text": "single TCP connection and send many many HTTP requests one after another so what",
    "start": "1301920",
    "end": "1307560"
  },
  {
    "text": "we are doing to counter that is we are selectively disabling HTTP keeper lives this is a bit more integration with the",
    "start": "1307560",
    "end": "1313260"
  },
  {
    "text": "HTTP server but it basically makes sure that the boat that will need to establish new TCP connection for each",
    "start": "1313260",
    "end": "1319830"
  },
  {
    "text": "request which is brilliant because we are very good at rate limiting syn packets okay this is all very nice and",
    "start": "1319830",
    "end": "1326400"
  },
  {
    "start": "1324000",
    "end": "1388000"
  },
  {
    "text": "very good but it doesn't really work work against very large botnets in the botnets the number of IP addresses that",
    "start": "1326400",
    "end": "1332639"
  },
  {
    "text": "hit you will be very large and basically you can't really afford to even answer few queries from each IP addresses just",
    "start": "1332639",
    "end": "1339599"
  },
  {
    "text": "because it can generate significant load so unfortunately for very large botnets there's not really a nice way of dealing",
    "start": "1339599",
    "end": "1345539"
  },
  {
    "text": "with now services but what we are doing is we are trying to find a distinguishing characteristic on TCP",
    "start": "1345539",
    "end": "1352709"
  },
  {
    "text": "layer and then cut it on IP tables so here's an example here's an example at a",
    "start": "1352709",
    "end": "1358019"
  },
  {
    "text": "get request against one of our customers and this Rick get request is actually very characteristic is because in the",
    "start": "1358019",
    "end": "1363690"
  },
  {
    "text": "host header it contains call 80 no real browser will actually put a port number in the host header so this was very very",
    "start": "1363690",
    "end": "1371089"
  },
  {
    "text": "characteristic for this flood so what we did is we crafted a iptables rule that will basically drove packets with this",
    "start": "1371089",
    "end": "1377849"
  },
  {
    "text": "particular header there this is not very nice and it could leads to many kind of ID link time writing time connections",
    "start": "1377849",
    "end": "1385190"
  },
  {
    "text": "waiting for those timeouts but detective we recently published a blog post about",
    "start": "1385190",
    "end": "1391109"
  },
  {
    "start": "1388000",
    "end": "1405000"
  },
  {
    "text": "a very large denial of service attack against one of our customers it was actually a we think it was done by a",
    "start": "1391109",
    "end": "1398879"
  },
  {
    "text": "mobile browsers so if you wondered what techniques we use to mitigate that well now you know everything okay this is all",
    "start": "1398879",
    "end": "1407219"
  },
  {
    "start": "1405000",
    "end": "1414000"
  },
  {
    "text": "about mitigation but there's much more things around it so for once how do you actually know if the attack is happening",
    "start": "1407219",
    "end": "1412829"
  },
  {
    "text": "how do you know what's happening on network and what we found extremely effective is to use s flow as well as a",
    "start": "1412829",
    "end": "1419309"
  },
  {
    "start": "1414000",
    "end": "1440000"
  },
  {
    "text": "protocol which is usually supported by switches and it basically allows switch to send sampled packets to a central",
    "start": "1419309",
    "end": "1426329"
  },
  {
    "text": "location so with s code configured in a switch will sample every thousand two",
    "start": "1426329",
    "end": "1431999"
  },
  {
    "text": "thousand ten thousand whatever bucket will put it on the UDP payload of the S flow encapsulation and will ship it to",
    "start": "1431999",
    "end": "1437940"
  },
  {
    "text": "central location and then in this central location you can get fairly nice overview of what's happening and network",
    "start": "1437940",
    "end": "1443279"
  },
  {
    "start": "1440000",
    "end": "1472000"
  },
  {
    "text": "this is one of the tools we have internally which allows us to basically run TCP dump across all our data centers",
    "start": "1443279",
    "end": "1450359"
  },
  {
    "text": "and this is very nice it allows us to understand what are the top hitting source IP addresses what are the top it",
    "start": "1450359",
    "end": "1457589"
  },
  {
    "text": "targeted destination IP addresses and SSO also has packet contents so you can inspect and see what our dtcp so",
    "start": "1457589",
    "end": "1463810"
  },
  {
    "text": "or maybe what are the HTTP headers or maybe even what are the DNS queries this",
    "start": "1463810",
    "end": "1470800"
  },
  {
    "text": "is very effective for us if you don't have a hardware support on your switch",
    "start": "1470800",
    "end": "1475870"
  },
  {
    "text": "for SFO fear not there is a software implementation so with a bit of",
    "start": "1475870",
    "end": "1481290"
  },
  {
    "text": "configuration magic and a bit of type II tables magic you can get software implementation of s flow all right thank",
    "start": "1481290",
    "end": "1488410"
  },
  {
    "start": "1487000",
    "end": "1812000"
  },
  {
    "text": "you very much and the general takes the takeaways from this talk are that you will not out sooner or later later this",
    "start": "1488410",
    "end": "1495160"
  },
  {
    "text": "is very often the only way of relieving network congestion and since you will",
    "start": "1495160",
    "end": "1500560"
  },
  {
    "text": "not out you must prepare for that you must reduce your DNS details to reasonable values you must be sure and",
    "start": "1500560",
    "end": "1507490"
  },
  {
    "text": "confident that your DNS infrastructure will be able to update quickly and that you don't have your IP addresses",
    "start": "1507490",
    "end": "1513160"
  },
  {
    "text": "hard-coded anywhere and the second thing is that for high-volume pocket floods the one that you see that here in media",
    "start": "1513160",
    "end": "1519070"
  },
  {
    "text": "about hundreds of gigabytes all the packets are actually involved maybe at all but very large percentage and and",
    "start": "1519070",
    "end": "1526320"
  },
  {
    "text": "remember our our number is that only one in 10,000 packets can be actually valid",
    "start": "1526320",
    "end": "1531700"
  },
  {
    "text": "so this is the scale we are usually drink with and DBP FS are extremely",
    "start": "1531700",
    "end": "1536710"
  },
  {
    "text": "effective against those type of slot type of class and if the performance of normal operating systems is not good",
    "start": "1536710",
    "end": "1542320"
  },
  {
    "text": "enough for you then consider using partial Cardinal bypass to get even better performance finally IP tables are",
    "start": "1542320",
    "end": "1548680"
  },
  {
    "text": "extremely powerful and things like con limits or harsh limits IP sets are extremely worthwhile kind of digging",
    "start": "1548680",
    "end": "1555550"
  },
  {
    "text": "into an understanding you can do much more things than I described here thank",
    "start": "1555550",
    "end": "1561280"
  },
  {
    "text": "you very much and as I mentioned at the end of this PDF there are like 30 more slides with exciting TLS and",
    "start": "1561280",
    "end": "1567430"
  },
  {
    "text": "exciting iptables examples and also please do remember to fill the survey which I think will be sent over email I",
    "start": "1567430",
    "end": "1573340"
  },
  {
    "text": "think later on all right I'm sure there are many questions",
    "start": "1573340",
    "end": "1579870"
  },
  {
    "text": "or not so for user agents the real",
    "start": "1588570",
    "end": "1605769"
  },
  {
    "text": "botnets attacks what we usually see if we see an some simple scripts with",
    "start": "1605769",
    "end": "1610869"
  },
  {
    "text": "randomized user agents so they have a dictionary of top thousand user agents and they picked them at random does make",
    "start": "1610869",
    "end": "1616929"
  },
  {
    "text": "sense any other questions the question",
    "start": "1616929",
    "end": "1631809"
  },
  {
    "text": "is do we use hardware stuff to filter buckets initially we were using router support for flows pick which was one of",
    "start": "1631809",
    "end": "1639369"
  },
  {
    "text": "the kind of more closer to the hardware features but since the partial currently bypass works so efficiently we are now",
    "start": "1639369",
    "end": "1645519"
  },
  {
    "text": "relying mostly on BP FSN done actually expecting the payloads the problem with hardware supports is it usually comes we",
    "start": "1645519",
    "end": "1652599"
  },
  {
    "text": "express the full power of what you want to do with VPS we can actually have fairly significant logic in the bytecode",
    "start": "1652599",
    "end": "1660249"
  },
  {
    "text": "there I can actually pretty much parse DNS pocket and figure out where there is correct or not so the answer is no we",
    "start": "1660249",
    "end": "1667450"
  },
  {
    "text": "don't use much hardware acceleration",
    "start": "1667450",
    "end": "1671190"
  },
  {
    "text": "absolutely the the I would be I'm still waiting for for a hardware FPGA",
    "start": "1672749",
    "end": "1680200"
  },
  {
    "text": "supported can do BBFS but anyway the the partial can i bypass gives us actually",
    "start": "1680200",
    "end": "1686859"
  },
  {
    "text": "very good performance I mentioned that we can do in partial tell me bypass about 3 million packets per second on a",
    "start": "1686859",
    "end": "1692169"
  },
  {
    "text": "single core and this is true in some tests which were a bit simplified we were able to get 10 millions but it kind",
    "start": "1692169",
    "end": "1697419"
  },
  {
    "text": "of doesn't matter at this scale because the 10 gig sport is full anyway so so basically the partial can do bypass is",
    "start": "1697419",
    "end": "1702580"
  },
  {
    "text": "good enough more questions",
    "start": "1702580",
    "end": "1707460"
  },
  {
    "text": "I'm interesting in this size the",
    "start": "1709560",
    "end": "1716800"
  },
  {
    "text": "question was about it packets per second versus versus the size yes this is this is something very much we are operating",
    "start": "1716800",
    "end": "1723820"
  },
  {
    "text": "in I'm very much operating in Pakistan just because the processing is mostly done in at least in my domain in number",
    "start": "1723820",
    "end": "1731290"
  },
  {
    "text": "of packets did that does the interesting bits the packets are usually fairly small they in the flood that I showed",
    "start": "1731290",
    "end": "1737170"
  },
  {
    "text": "you there were about 50 bytes many floods have about 70 bytes so you can do calculation about how many gigabits that",
    "start": "1737170",
    "end": "1742360"
  },
  {
    "text": "would be not much so so the the gigantic does that we see sometimes he'll don't have very many gigabytes or gigabits per",
    "start": "1742360",
    "end": "1749170"
  },
  {
    "text": "second all right any more questions yes",
    "start": "1749170",
    "end": "1755400"
  },
  {
    "text": "so f load so the question is about s",
    "start": "1762529",
    "end": "1770730"
  },
  {
    "text": "flow for Ethel in the SL header there is a sampling rate available so what you",
    "start": "1770730",
    "end": "1777509"
  },
  {
    "text": "can do statistically is you can just multiply each packet you received from s flow by whatever 10,000 or 16,000 and",
    "start": "1777509",
    "end": "1784889"
  },
  {
    "text": "then you can get a statistical over yours happening there is some serious math behind it and but the point is if",
    "start": "1784889",
    "end": "1791759"
  },
  {
    "text": "the attack is big you will see it you will see many samples you will see many signals all right I think it can take",
    "start": "1791759",
    "end": "1798720"
  },
  {
    "text": "one more question or not thank you very",
    "start": "1798720",
    "end": "1804299"
  },
  {
    "text": "much I hope it was useful",
    "start": "1804299",
    "end": "1807830"
  }
]