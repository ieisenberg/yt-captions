[
  {
    "text": "hi everybody uh so today I'll talk about the four zero days I found in open VPN and let's begin uh so this is arinda",
    "start": "3199",
    "end": "11000"
  },
  {
    "text": "she'll help me with the presentation and uh our Story begins one",
    "start": "11000",
    "end": "16480"
  },
  {
    "text": "night Saturday night when I played de Pro Galactic with two of my friends Nicki and Phillip and so philli had some",
    "start": "16480",
    "end": "23800"
  },
  {
    "text": "legs and uh the game wasn't working good for him and so I asked himself what's going on and he said that it installed",
    "start": "23800",
    "end": "31080"
  },
  {
    "text": "Express VPN and so I like started inquiring why it installed that and it said privacy reasons security reasons",
    "start": "31080",
    "end": "38640"
  },
  {
    "text": "all this kind of stuff and so from there I kind of trying to understand why why",
    "start": "38640",
    "end": "44800"
  },
  {
    "text": "he need that and so um uh I tell me that if I don't think this have this benefits",
    "start": "44800",
    "end": "52079"
  },
  {
    "text": "I can sorry I can prove him wrong and he dare me to find some problems in Express",
    "start": "52079",
    "end": "57719"
  },
  {
    "text": "VPN and so uh there I begin just uh looking at exppress VPN binaries and I",
    "start": "57719",
    "end": "63039"
  },
  {
    "text": "started with looking at the top driver and basically the top driver it's uh",
    "start": "63039",
    "end": "68799"
  },
  {
    "text": "what creates the virtual network interface uh with connects to endpoints and so open the binary Ida uh",
    "start": "68799",
    "end": "77119"
  },
  {
    "text": "driver entry function we can see uh miniport driver characteristic file uh structure being uh initialized with a",
    "start": "77119",
    "end": "84119"
  },
  {
    "text": "lot of callbacks and uh one of the interesting callbacks is the mini ports and net buffer lists which basically",
    "start": "84119",
    "end": "89960"
  },
  {
    "text": "will forward data to the driver and so uh this is the function definition first",
    "start": "89960",
    "end": "96439"
  },
  {
    "text": "we have some uh verification and then we will call to top adapter transmit uh in a while loop now this is the top adapter",
    "start": "96439",
    "end": "103880"
  },
  {
    "text": "transmit function and first we can see it got and dis allocate uh memory with",
    "start": "103880",
    "end": "108960"
  },
  {
    "text": "TCH priority then it will uh get this data buffer allocated and will memory",
    "start": "108960",
    "end": "114159"
  },
  {
    "text": "move to it now this is the prefix of it right and so as we can see here we have",
    "start": "114159",
    "end": "120000"
  },
  {
    "text": "the data length plus 24 uh in the location and we can see here in the prefix of the function that we will uh",
    "start": "120000",
    "end": "127520"
  },
  {
    "text": "get this value from RX plus 18 put it into EBP which is a short one and then",
    "start": "127520",
    "end": "133800"
  },
  {
    "text": "pass it forward and so the logic the calculation of the size will be something like that which if we'll pass",
    "start": "133800",
    "end": "140080"
  },
  {
    "text": "enough like a big integer will have an overflow it's an integer overflow a",
    "start": "140080",
    "end": "145360"
  },
  {
    "text": "classical one and so after that we will get the and this data buffer and we'll",
    "start": "145360",
    "end": "150480"
  },
  {
    "text": "memory move it and so but we can notice that it will be moved with the data length the original data length not the",
    "start": "150480",
    "end": "156160"
  },
  {
    "text": "plus 24 and so what we'll get is basically we will move all the big chunk",
    "start": "156160",
    "end": "162159"
  },
  {
    "text": "of memory onto the 70 allocated bytes and it is a wild carel overflow now",
    "start": "162159",
    "end": "167239"
  },
  {
    "text": "exploring while car overflow and achieving code execution it's a it's a hard task it's not something I will talk",
    "start": "167239",
    "end": "173760"
  },
  {
    "text": "about it today but uh basically there are a lot of cool research out there how to do that and so after that I just r a",
    "start": "173760",
    "end": "180879"
  },
  {
    "text": "fast PC to crash the system and actually forgot it for a couple of days and a few",
    "start": "180879",
    "end": "186560"
  },
  {
    "text": "days uh later I uh looked at another VPN at proton VPN and uh so again another",
    "start": "186560",
    "end": "193640"
  },
  {
    "text": "driver another TR driver open the and find the top adapter to smid function",
    "start": "193640",
    "end": "198840"
  },
  {
    "text": "and again it have the same issue the same bug and so asind the say here we",
    "start": "198840",
    "end": "204599"
  },
  {
    "text": "already seen this bug is the the one that we seen an Express VPN and so at this stage and so that probably there",
    "start": "204599",
    "end": "210319"
  },
  {
    "text": "are more out there right because if there's two there will be more and so wrote some yarat rule uh and executed uh",
    "start": "210319",
    "end": "217840"
  },
  {
    "text": "retro hunt uh search in v toal and found around 50 matches and those are part of",
    "start": "217840",
    "end": "224840"
  },
  {
    "text": "the examples and so we can see there are a lot of drivers with the same issue now",
    "start": "224840",
    "end": "230239"
  },
  {
    "text": "at this stage I said okay it got to be something very popular something that everybody uses and just asked CH GPT and",
    "start": "230239",
    "end": "237079"
  },
  {
    "text": "obviously the answer was uh D look at open open VPN it's probably it and so",
    "start": "237079",
    "end": "242200"
  },
  {
    "text": "let's talk a little bit about openvpn now openvpn it's a it's very popular uh",
    "start": "242200",
    "end": "248879"
  },
  {
    "text": "open source code for VPN programs and if you search it on Google you'll find the",
    "start": "248879",
    "end": "253959"
  },
  {
    "text": "first probably result will be the G repo which H which has a lot of different",
    "start": "253959",
    "end": "259120"
  },
  {
    "text": "repositories for a lot of different things open VPN have and basically openvpn like have two meetings today",
    "start": "259120",
    "end": "266880"
  },
  {
    "text": "basically the openvpn binary part or the thing that does the VPN and the um",
    "start": "266880",
    "end": "274000"
  },
  {
    "text": "protocol which used for creating tunneling now uh back to the things that",
    "start": "274000",
    "end": "279960"
  },
  {
    "text": "we found uh I went to look at top Windows 6 which is in git repo for top",
    "start": "279960",
    "end": "285919"
  },
  {
    "text": "driver for of openvpn and found the top top adapter transmit function and found",
    "start": "285919",
    "end": "293160"
  },
  {
    "text": "the same and dis allocate memory with top priority and this is the issue the top packet size macro which adds things",
    "start": "293160",
    "end": "299720"
  },
  {
    "text": "and this is why we have the Overflow and wild Canal overflow and this is like uh",
    "start": "299720",
    "end": "305440"
  },
  {
    "text": "the first base for all this issues is on openvpn top Windows 6 now openvpn as I said has a lot more",
    "start": "305440",
    "end": "313240"
  },
  {
    "text": "things to offer and basically this repo is actually the repo the r that executes",
    "start": "313240",
    "end": "318520"
  },
  {
    "text": "the tunneling and the VPN let's say and it's very popular as we can see here we have another repo which is the openvpn",
    "start": "318520",
    "end": "325840"
  },
  {
    "text": "GUI um which is actually the GUI version of managing open VPN on Windows and we",
    "start": "325840",
    "end": "331840"
  },
  {
    "text": "have the top Windows 6 as we talked about it now openvpn uh basically the",
    "start": "331840",
    "end": "338240"
  },
  {
    "text": "server client architector of that will be we have the open client that will connect to the server over cloud or",
    "start": "338240",
    "end": "344880"
  },
  {
    "text": "network and creating a tunnel with the keys and everything how it should behave",
    "start": "344880",
    "end": "350759"
  },
  {
    "text": "and then we'll pass some data through the tunnel to the openvpn server and back again and the the relevant part is",
    "start": "350759",
    "end": "358120"
  },
  {
    "text": "that uh on endpoints open VPN have two parts the user mode and the Kel mode where the Kel mode basically is the part",
    "start": "358120",
    "end": "365240"
  },
  {
    "text": "that manages the tunnels and the user mod have all the configuration and all the logic for the VPN let's say",
    "start": "365240",
    "end": "371919"
  },
  {
    "text": "definitions now as I said open VPN is also a protocol and so basically",
    "start": "371919",
    "end": "377000"
  },
  {
    "text": "standard packet of open VPN will have the next structure it'll have the packet length and then it will have like the",
    "start": "377000",
    "end": "383840"
  },
  {
    "text": "the P the the op code the kid for instance if you want to soft set the tannel or maybe hard set it maybe start",
    "start": "383840",
    "end": "391000"
  },
  {
    "text": "uh switching Keys stuff like that we will have here the the ID to to identify",
    "start": "391000",
    "end": "397039"
  },
  {
    "text": "that and then the actual payload and so obviously they're like a pick a parcel",
    "start": "397039",
    "end": "403120"
  },
  {
    "text": "like a a wire shock parcel for that and um there are a lot of documentation",
    "start": "403120",
    "end": "408960"
  },
  {
    "text": "about this protocol on W on openvpn page on Wikipedia and a lot more",
    "start": "408960",
    "end": "414360"
  },
  {
    "text": "places um now open VPN because it's uh wildly used by basically",
    "start": "414360",
    "end": "420080"
  },
  {
    "text": "almost all Industries and it has like compatibility for all the main operating",
    "start": "420080",
    "end": "426319"
  },
  {
    "text": "systems today such as Mac iOS Android um Windows Linux and whatnot and so they",
    "start": "426319",
    "end": "433720"
  },
  {
    "text": "achiev that by a number of uh basically techniques they use for instance uh",
    "start": "433720",
    "end": "438879"
  },
  {
    "text": "something that called Data control offload which will basically allow to read and write faster to the kernal",
    "start": "438879",
    "end": "445560"
  },
  {
    "text": "memory for information to pass through the tunnel and they have those for different operating systems and",
    "start": "445560",
    "end": "451280"
  },
  {
    "text": "basically the difference between the data control offload and the top Windows six is that on Windows the top Windows 6",
    "start": "451280",
    "end": "457919"
  },
  {
    "text": "uh is based on endies and the data control offload is doing it faster it's",
    "start": "457919",
    "end": "463400"
  },
  {
    "text": "actually newer uh besides that they have a lot of macros to Define different logic if",
    "start": "463400",
    "end": "470280"
  },
  {
    "text": "you're running specific operating system Al ifs uh includes different includes and",
    "start": "470280",
    "end": "475960"
  },
  {
    "text": "whatnot um another very interesting mechanism of uh openvpn is the plugins",
    "start": "475960",
    "end": "481639"
  },
  {
    "text": "mechanism which allows authentication against Lup and radios uh backends and",
    "start": "481639",
    "end": "486960"
  },
  {
    "text": "servers and how we achieve that basically we can compile an SLO object",
    "start": "486960",
    "end": "493240"
  },
  {
    "text": "shared object or an dll with exported functions and then the openvpn binary will load it and execute it now those",
    "start": "493240",
    "end": "500639"
  },
  {
    "text": "are the function that we need open will be the initialization of this plugin function is the fun will be called every",
    "start": "500639",
    "end": "508000"
  },
  {
    "text": "time we want to execute specific logic of the plugin and then close and aboard our",
    "start": "508000",
    "end": "513919"
  },
  {
    "text": "self-explanatory for instance here we have an example for the uh plugin um",
    "start": "513919",
    "end": "519560"
  },
  {
    "text": "code we have the open function here that will Define the username the password of the context and then in the function we",
    "start": "519560",
    "end": "527160"
  },
  {
    "text": "can see authentication with those uh with those uh Fields stored in the",
    "start": "527160",
    "end": "532320"
  },
  {
    "text": "context and well the underline here is that plugins are pretty cool and allow a",
    "start": "532320",
    "end": "537560"
  },
  {
    "text": "lot more functionality to open VPN now let's talk a little b a little",
    "start": "537560",
    "end": "542839"
  },
  {
    "text": "bit about the security side of open VPN and basically open VN on Windows have",
    "start": "542839",
    "end": "548800"
  },
  {
    "text": "openn serve exit which is the n system service uh and it has a name piped by",
    "start": "548800",
    "end": "555160"
  },
  {
    "text": "the name openvpn service to which when connected uh openvpn EXO will be spawned",
    "start": "555160",
    "end": "560600"
  },
  {
    "text": "for specific client and so how it all works first the system when system",
    "start": "560600",
    "end": "565800"
  },
  {
    "text": "service when it start to run will create the uh pipe and then create a tread to",
    "start": "565800",
    "end": "571560"
  },
  {
    "text": "handle uh queries on that name pipe and so they specifically defined user who",
    "start": "571560",
    "end": "577360"
  },
  {
    "text": "can do that and specifically defined location that they can do that from and",
    "start": "577360",
    "end": "583000"
  },
  {
    "text": "after that um if a client will connect it will get the startup data from the client startup data will look something",
    "start": "583000",
    "end": "589959"
  },
  {
    "text": "like that it will contain the directory in which the configuration for Open VPN is reciting and a path to log for that",
    "start": "589959",
    "end": "598040"
  },
  {
    "text": "as well and after that after the startup dat arrived to the an system service the an system service will impersonate the",
    "start": "598040",
    "end": "605040"
  },
  {
    "text": "name the client that connected to it then it will do all validation for user SIDS and stuff like that checking that",
    "start": "605040",
    "end": "612040"
  },
  {
    "text": "the user actually authorized to connect after it uh another name pipe",
    "start": "612040",
    "end": "618279"
  },
  {
    "text": "will be created a new a new name pipe uh let's call it an inner name pipe and so",
    "start": "618279",
    "end": "625360"
  },
  {
    "text": "uh the handle will be passed to the newly spawn process for the iner named",
    "start": "625360",
    "end": "630519"
  },
  {
    "text": "pipe right after that the actual process of openvpn will be uh created for",
    "start": "630519",
    "end": "637160"
  },
  {
    "text": "actually executing the VPN logic now after that we'll have something like",
    "start": "637160",
    "end": "643000"
  },
  {
    "text": "that we'll have the openvpn service exit system service which uh have two name",
    "start": "643000",
    "end": "648720"
  },
  {
    "text": "pipes first is the openvpn service the outer name pipe and then we have the open VPN X which is the spawn process",
    "start": "648720",
    "end": "655120"
  },
  {
    "text": "and it has the inal name type for instance here by the name service 1 2 3 4 now and why we need this inner pip",
    "start": "655120",
    "end": "661680"
  },
  {
    "text": "because the openvpn process the transun it runs uh in a lower Integrity levels",
    "start": "661680",
    "end": "668399"
  },
  {
    "text": "and so if it want to do some uh elevated Logic for instance adding IPS removing",
    "start": "668399",
    "end": "673880"
  },
  {
    "text": "IPS changing DNS configurations you need to request it from the system service how we'll do that it will do it by",
    "start": "673880",
    "end": "680360"
  },
  {
    "text": "sending specific message through the uh system service of openvpn and then the",
    "start": "680360",
    "end": "685480"
  },
  {
    "text": "openvpn system service as shown here will handle those messages uring now there are a lot of types of messages",
    "start": "685480",
    "end": "691920"
  },
  {
    "text": "for instance messages to address add or removal um route the same and DNS",
    "start": "691920",
    "end": "697240"
  },
  {
    "text": "configuration and even an KN message and so for instance if the openvpn decided",
    "start": "697240",
    "end": "702680"
  },
  {
    "text": "to add some route it will send an route message to the system service the system service will handle this query and then",
    "start": "702680",
    "end": "709720"
  },
  {
    "text": "return back and act indicating if it was successful or not uh for full picture",
    "start": "709720",
    "end": "715160"
  },
  {
    "text": "this is how it will look on uh Windows system we'll have the two already known processes and then we have the open VPN",
    "start": "715160",
    "end": "721920"
  },
  {
    "text": "which will actually create the first uh communication to the system service to the extern outter open VPN service name",
    "start": "721920",
    "end": "729360"
  },
  {
    "text": "pipe and now if we want to look at this at like a network uh Network side will",
    "start": "729360",
    "end": "735199"
  },
  {
    "text": "have it something like that we have the tunnel through which the data will pass to the openvpn exit we have the inner",
    "start": "735199",
    "end": "740680"
  },
  {
    "text": "and outer name pipes and another interesting thing here is that we got the plugin that is previous to the data",
    "start": "740680",
    "end": "746000"
  },
  {
    "text": "going through the channel uh this is about VPN now let's talk a little bit about potatoes everybody loves them uh",
    "start": "746000",
    "end": "753760"
  },
  {
    "text": "specifically dudes from Lord of the Rings and me as well and we'll talk about Windows pril escalation techniques",
    "start": "753760",
    "end": "760160"
  },
  {
    "text": "which called potatoes uh there are few of those hard short and lonely and the idea is there that um through some",
    "start": "760160",
    "end": "767279"
  },
  {
    "text": "trickery and some uh tricks on the operating system on Windows uh provation",
    "start": "767279",
    "end": "773720"
  },
  {
    "text": "will be achieved for instance a hot potato is basically a scenario in which an attacker will will uh wait for for",
    "start": "773720",
    "end": "781160"
  },
  {
    "text": "endpoint to try to update it will then uh send the malitia WPD that file which",
    "start": "781160",
    "end": "787000"
  },
  {
    "text": "will trigger anlm authentication with the attacker and then it will uh relay the nlm attack to the S&B server and",
    "start": "787000",
    "end": "794480"
  },
  {
    "text": "Achieve anti system Authority and which is the P here",
    "start": "794480",
    "end": "799839"
  },
  {
    "text": "and uh now let's get back to openvpn so the second issue I found in open VPN was",
    "start": "799839",
    "end": "806079"
  },
  {
    "text": "here uh this is the while uh while loop that reads uh amount of btes to read",
    "start": "806079",
    "end": "812320"
  },
  {
    "text": "from the name pipe from the inner named pipe from the open VPN exit and then",
    "start": "812320",
    "end": "818320"
  },
  {
    "text": "calls the method call handle messages now this message defines a struct of",
    "start": "818320",
    "end": "824199"
  },
  {
    "text": "message of different types and then basically reads the amount of BU bites",
    "start": "824199",
    "end": "829959"
  },
  {
    "text": "into that message and so obviously it's a stock overflow because if for instance here I have an example of message which",
    "start": "829959",
    "end": "837519"
  },
  {
    "text": "all of them have the message header and then the P the fields of a specific message as for example address message T",
    "start": "837519",
    "end": "844160"
  },
  {
    "text": "will have family add prefix land and if face and so if I'll send an another",
    "start": "844160",
    "end": "849519"
  },
  {
    "text": "message example if I'll send enough data they will overflow all this fields and",
    "start": "849519",
    "end": "855240"
  },
  {
    "text": "go out of the message and this is in stack Overflow and obviously after flow for first exploit we have something like",
    "start": "855240",
    "end": "862120"
  },
  {
    "text": "that fast fa stacky check file here which means we have a c stack here and",
    "start": "862120",
    "end": "867639"
  },
  {
    "text": "so let's uh read a little bit about this SC I understand what we can do with that this is the prefix of the method here we",
    "start": "867639",
    "end": "874040"
  },
  {
    "text": "can see we we throwing the security cook interact and then storing it with RSP and then storing on RSP again and the",
    "start": "874040",
    "end": "883000"
  },
  {
    "text": "security cookie defined as FS but obviously somebody will render it when the program starts running and in the",
    "start": "883000",
    "end": "890120"
  },
  {
    "text": "end of this uh function in the suffix of this function we can see a call to a security check cooked which will",
    "start": "890120",
    "end": "896440"
  },
  {
    "text": "retrieve the cookie from the stack and then calculate it value and check if it's okay if it's okay it won't call",
    "start": "896440",
    "end": "902120"
  },
  {
    "text": "report foler but if it is not a good value report will be called and where fault will execute as we know and so",
    "start": "902120",
    "end": "909880"
  },
  {
    "text": "let's find where this cookie uh defined obviously Security in if cookie now uh",
    "start": "909880",
    "end": "916360"
  },
  {
    "text": "the basic idea here is that we'll regenerate the value of the cookie based on a lot information that we are not as",
    "start": "916360",
    "end": "923120"
  },
  {
    "text": "an attacker not really prevy to and so the idea here is that to successfully exploit this function and this",
    "start": "923120",
    "end": "929480"
  },
  {
    "text": "vulnerability into code execution will need to have a read primitive on the memory on the stack memory to retrieve",
    "start": "929480",
    "end": "936360"
  },
  {
    "text": "it now I haven't found this one and so basically what it leaves us is with a",
    "start": "936360",
    "end": "941560"
  },
  {
    "text": "stacco that will crash the service or crashing the service with staco and where will be executed and um so now",
    "start": "941560",
    "end": "948399"
  },
  {
    "text": "let's talk a little bit about problems in n p in N pipes and basically there are two like very popular ones first",
    "start": "948399",
    "end": "954560"
  },
  {
    "text": "called The Creation um race condition which basically means if I have a server which creates name pipe and then a",
    "start": "954560",
    "end": "961079"
  },
  {
    "text": "client will connect to this name pipe if somebody creates this name pipe before the server the client will connect to",
    "start": "961079",
    "end": "966519"
  },
  {
    "text": "the first instance of this name pipe basically to the malicious app the second issue is the suppl pipe",
    "start": "966519",
    "end": "972360"
  },
  {
    "text": "connectivity issue basically it states that if a client corrects to name pipe it doesn't really know who is this like",
    "start": "972360",
    "end": "979160"
  },
  {
    "text": "the other side of the name pipe and so if it's a bad actor it will have an",
    "start": "979160",
    "end": "984639"
  },
  {
    "text": "issue and now let's connect all those dot into having an LPA which I call the open potato because it's basically based",
    "start": "984639",
    "end": "992079"
  },
  {
    "text": "on potatoes uh family of vulnerabilities and it's open VPN related and obviously",
    "start": "992079",
    "end": "997519"
  },
  {
    "text": "open a good name for that and so we will Begin by um actually crafting malicious",
    "start": "997519",
    "end": "1002639"
  },
  {
    "text": "dll the malicious plugin we'll make the openn ex load it and then through the",
    "start": "1002639",
    "end": "1008319"
  },
  {
    "text": "plugin we will send a malicious uh message to the an system service which will crush it and then it will open a",
    "start": "1008319",
    "end": "1014440"
  },
  {
    "text": "window of time for us uh in which in this time we can reclaim the open PN uh",
    "start": "1014440",
    "end": "1019880"
  },
  {
    "text": "system service uh name name pipe and then everybody that will connect to this",
    "start": "1019880",
    "end": "1025760"
  },
  {
    "text": "uh name pipe unnown only will connect to us and then we can basically wait for a strong connection for a privileged user",
    "start": "1025760",
    "end": "1033160"
  },
  {
    "text": "and then we can basically impersonate him and have an LP and so this is the main of the D to do that and then we",
    "start": "1033160",
    "end": "1041240"
  },
  {
    "text": "have passing of the command line argument that passes the handle then we will duplicate this handle and basically",
    "start": "1041240",
    "end": "1048319"
  },
  {
    "text": "send the pack pack in this case the packet the message will kill it's just enough z uh and it will kill the system",
    "start": "1048319",
    "end": "1055160"
  },
  {
    "text": "service after that we will uh reclaim the openvpn service name pipe and then",
    "start": "1055160",
    "end": "1061440"
  },
  {
    "text": "uh basically we will execute the same flow that openvpn executes right we'll wait for connection if a connection Ur",
    "start": "1061440",
    "end": "1066720"
  },
  {
    "text": "we'll start a new thread to handle it and then we'll like get the start data and imp and then impersonate the name",
    "start": "1066720",
    "end": "1073320"
  },
  {
    "text": "the named pipe client and then we'll check if like the client that we already",
    "start": "1073320",
    "end": "1078559"
  },
  {
    "text": "right now impr personating is a strong one and if it's a strong one we can execute a binary that we want uh for",
    "start": "1078559",
    "end": "1084000"
  },
  {
    "text": "further exploitation and now this is the demo for that right side we can see the",
    "start": "1084000",
    "end": "1089760"
  },
  {
    "text": "user with the SC assign privilege and SE Primal token uh privilege and then we'll",
    "start": "1089760",
    "end": "1096520"
  },
  {
    "text": "execute the exploited we'll wait for the crush of the system service and then on",
    "start": "1096520",
    "end": "1101600"
  },
  {
    "text": "the right side we will connect to it with a stronger user for instance here",
    "start": "1101600",
    "end": "1107159"
  },
  {
    "text": "in the example is the an system and then and stronger uh client will be spawned",
    "start": "1107159",
    "end": "1113919"
  },
  {
    "text": "anti system elevated with all the token with all the Privileges that anti system has and we can see here it's actually",
    "start": "1113919",
    "end": "1121600"
  },
  {
    "text": "anti- system which is uh yeah pretty cool um",
    "start": "1121600",
    "end": "1128919"
  },
  {
    "text": "nice thanks um now okay um so the next stage",
    "start": "1129039",
    "end": "1135080"
  },
  {
    "text": "obviously would be how can we do it remotely and well obviously we can use name pipes remotely just we need to be",
    "start": "1135080",
    "end": "1142640"
  },
  {
    "text": "able to use a sh resources and so those are files folders and printers now basically on windows",
    "start": "1142640",
    "end": "1150039"
  },
  {
    "text": "they're usually shared with SMB or smb2 or their variants and also uh for",
    "start": "1150039",
    "end": "1156039"
  },
  {
    "text": "instance if you want to be able to access server o1 for share folder for file example we'll basically need to use",
    "start": "1156039",
    "end": "1162559"
  },
  {
    "text": "something like net use to be able to access this uh this uh server and so if",
    "start": "1162559",
    "end": "1168240"
  },
  {
    "text": "we do that that we'll obviously need a credentials for that but then we'll see the IPC folder which basically contains",
    "start": "1168240",
    "end": "1174280"
  },
  {
    "text": "all the int process communication things such as name pipes and so we can access",
    "start": "1174280",
    "end": "1180760"
  },
  {
    "text": "remote name pipes but we need credentials for that and for instance if we look on a pickup file with uh this",
    "start": "1180760",
    "end": "1187200"
  },
  {
    "text": "behavor we will see actually the request for IC and the specific uh SMB query for",
    "start": "1187200",
    "end": "1193280"
  },
  {
    "text": "that now basically there are some security mechanisms on Windows that",
    "start": "1193280",
    "end": "1198760"
  },
  {
    "text": "probably won't allow you for instance if you're an anous user to connect to existing name pipes they have specific",
    "start": "1198760",
    "end": "1205880"
  },
  {
    "text": "definition for those and but those aren preventing me as defined user with",
    "start": "1205880",
    "end": "1211120"
  },
  {
    "text": "credentials to connect to them and so as long as I have credentials I can do that and so let's talk a little bit about how",
    "start": "1211120",
    "end": "1217240"
  },
  {
    "text": "can I get credentials now uh basically all modern IPS have a lot tons of credal",
    "start": "1217240",
    "end": "1223840"
  },
  {
    "text": "hijacking stealing techniques um and every time another student new created",
    "start": "1223840",
    "end": "1230000"
  },
  {
    "text": "but the idea is that everybody want to somehow get credentials use them F",
    "start": "1230000",
    "end": "1235080"
  },
  {
    "text": "further for instance the Russians with the goose egg or the Mimi the infamous",
    "start": "1235080",
    "end": "1240480"
  },
  {
    "text": "mimik cats and even some credential stealing from web browsers now a lot of",
    "start": "1240480",
    "end": "1246159"
  },
  {
    "text": "those aiming at and like uh stealing ntlm hashes which is uh ntlm is a net",
    "start": "1246159",
    "end": "1252200"
  },
  {
    "text": "plan manager authentication family of protocols and basically they they are there to manage securely authentication",
    "start": "1252200",
    "end": "1259679"
  },
  {
    "text": "between manage endpoints and for instance the full flow ntlm um nlm H",
    "start": "1259679",
    "end": "1266679"
  },
  {
    "text": "will look something like that we'll first have the an ANL mcsp negotiation then we have the proceed M information",
    "start": "1266679",
    "end": "1274120"
  },
  {
    "text": "required with the ANM servant Challenge and then we have the answer that with ANM proof string and then we have the",
    "start": "1274120",
    "end": "1281240"
  },
  {
    "text": "full um answer with a lot of fields that's stored in the tlmv response V2",
    "start": "1281240",
    "end": "1286919"
  },
  {
    "text": "response and now if we use uh CI and responder will basically be able to capture those if uh sniffing on the",
    "start": "1286919",
    "end": "1294320"
  },
  {
    "text": "network right for instance here we have the username it's Gandalf and then the domain then the int service Challenge",
    "start": "1294320",
    "end": "1301039"
  },
  {
    "text": "and all the ex has p and obviously we would like to craigit it to get the credentials now this can",
    "start": "1301039",
    "end": "1307200"
  },
  {
    "text": "be achieved through tons of ways but uh basically John The Reaper and hashcat are like the prime candidate for those",
    "start": "1307200",
    "end": "1314200"
  },
  {
    "text": "and I proceed with hashad because it's very good with gpus and basically the first attempt was just using my rock",
    "start": "1314200",
    "end": "1320960"
  },
  {
    "text": "streaks with Artic 3070 and it has almost 6,000 C of course",
    "start": "1320960",
    "end": "1326480"
  },
  {
    "text": "and basically installed hash on it and executed which on those uh on on this",
    "start": "1326480",
    "end": "1331799"
  },
  {
    "text": "Hardware can basically break uh 2,800 mega million hashes per second and",
    "start": "1331799",
    "end": "1339120"
  },
  {
    "text": "basically uh first attempt was like break some uh very easy password very",
    "start": "1339120",
    "end": "1344240"
  },
  {
    "text": "short one and obviously it broke it momentarily but then again if I'll try to break a nine chars password it will",
    "start": "1344240",
    "end": "1351799"
  },
  {
    "text": "take me about uh four years or almost five now nobody got time for that and",
    "start": "1351799",
    "end": "1357760"
  },
  {
    "text": "basically the next solution is obviously let's construct a full rock with a lot of uh like gpus myself again I don't",
    "start": "1357760",
    "end": "1365200"
  },
  {
    "text": "really have no time and no uh money for that so this I'll proceed with like uh",
    "start": "1365200",
    "end": "1370840"
  },
  {
    "text": "modern solution vast like a platform on which you can rent uh machines with a lot of uh computing power a lot of gpus",
    "start": "1370840",
    "end": "1378919"
  },
  {
    "text": "and for instance here I rented for n bucks a hour machine with 18 RX 490 and",
    "start": "1378919",
    "end": "1385159"
  },
  {
    "text": "so here I'm selling an image with hashcat on it now let's compare a little",
    "start": "1385159",
    "end": "1390240"
  },
  {
    "text": "bit about the machines uh the 18 uh RTX 490 has basically 15 time more Cuda",
    "start": "1390240",
    "end": "1398039"
  },
  {
    "text": "cores and so the relevant question is uh can we will it like run 50 times faster",
    "start": "1398039",
    "end": "1404840"
  },
  {
    "text": "obviously the answer is not because there are um software optimization CPU",
    "start": "1404840",
    "end": "1410320"
  },
  {
    "text": "Bolton X even like the the the the speed on which it can connect all the cores",
    "start": "1410320",
    "end": "1416000"
  },
  {
    "text": "it's different and so like in theory it could be 50 times faster but it it's not uh for sure it's not given and so after",
    "start": "1416000",
    "end": "1424960"
  },
  {
    "text": "installing the machine I executed uh hashad on the given password from earlier and basically it took me less",
    "start": "1424960",
    "end": "1431880"
  },
  {
    "text": "than three minutes to break it which was pretty cool and here the actual password",
    "start": "1431880",
    "end": "1437600"
  },
  {
    "text": "now if you remember we did it so her Linda would be happy and uh for us to be",
    "start": "1437600",
    "end": "1442679"
  },
  {
    "text": "en able to execute like to connect to remote name pipe and so here we will use the credentials to actually net use on",
    "start": "1442679",
    "end": "1450520"
  },
  {
    "text": "the remote machine after that we will actually uh connect to the name pipe and",
    "start": "1450520",
    "end": "1456120"
  },
  {
    "text": "the second stage of the exploit will be basically telling the N system service of open wepn to load configurations from",
    "start": "1456120",
    "end": "1463360"
  },
  {
    "text": "an attacker managed uh share as shown here and then the configuration for that",
    "start": "1463360",
    "end": "1469039"
  },
  {
    "text": "instance will have the directive to load a plugin which is again located on the uh remote um share of the attacker and",
    "start": "1469039",
    "end": "1477440"
  },
  {
    "text": "then basically First Step will fail because we need to allow access to this share for anonymous users because it",
    "start": "1477440",
    "end": "1484919"
  },
  {
    "text": "will do this uh impr personated and so we need also allow everyone to access to the share after we'll do that we'll",
    "start": "1484919",
    "end": "1491840"
  },
  {
    "text": "actually see uh the access to this share then we'll see the query for the configuration for Open VPN and that's",
    "start": "1491840",
    "end": "1498520"
  },
  {
    "text": "stage uh the N system server will already execute the openvpn xit which will then try to load the simple dll",
    "start": "1498520",
    "end": "1505440"
  },
  {
    "text": "plugin for our mode machine and this is the example for the RC we can see here",
    "start": "1505440",
    "end": "1511440"
  },
  {
    "text": "on the attacker machine uh this attacking script executed which will",
    "start": "1511440",
    "end": "1516720"
  },
  {
    "text": "basically connect to the remote name pipe on the remote name uh endpoint and",
    "start": "1516720",
    "end": "1521799"
  },
  {
    "text": "will execute um the openvpn EXO on its behalf which will then uh query from the",
    "start": "1521799",
    "end": "1528320"
  },
  {
    "text": "share here on this machine uh the dll which in this case will basically drop",
    "start": "1528320",
    "end": "1533480"
  },
  {
    "text": "some files on the desktop uh for some visual effect yeah this is it now now uh let's",
    "start": "1533480",
    "end": "1542279"
  },
  {
    "text": "talk a little bit about how we can chain all of this together and so obviously",
    "start": "1542279",
    "end": "1547360"
  },
  {
    "text": "the the porting of the lp onto the RC which will be pretty easy because all I",
    "start": "1547360",
    "end": "1553080"
  },
  {
    "text": "need to do is like Port all the lp logic into D plugin and I can achieve that by basically adding resources to the plugin",
    "start": "1553080",
    "end": "1560000"
  },
  {
    "text": "and then drop them and execute them now another thing that we need to take account of is that openvpn EX executes",
    "start": "1560000",
    "end": "1566799"
  },
  {
    "text": "in low Integrity level and so we'll have to execute log on user with the stolen",
    "start": "1566799",
    "end": "1572480"
  },
  {
    "text": "credentials to allow us to actually execute the impersonation of a stronger user and now let's say we achiev that",
    "start": "1572480",
    "end": "1580080"
  },
  {
    "text": "what next right and so APS usually using a lot of techniques to attack um the",
    "start": "1580080",
    "end": "1586320"
  },
  {
    "text": "endpoint and then they want to uh make the grip of the endpoint stronger usually usually via techniques such as",
    "start": "1586320",
    "end": "1593520"
  },
  {
    "text": "bring your vulnerable driver in this case we can easily write a script or a code to the plugin and pour it into the",
    "start": "1593520",
    "end": "1599960"
  },
  {
    "text": "plugin that will uh load uh sign but vulnerable third party driver and executed vulnerabilities to achieve",
    "start": "1599960",
    "end": "1606919"
  },
  {
    "text": "redri primitiv into Caron for instance right or maybe ah okay we can do it based on the DB tl2 free system driver",
    "start": "1606919",
    "end": "1614760"
  },
  {
    "text": "or maybe the fox brosies driver showing here um another technique would be the living of the land which again will",
    "start": "1614760",
    "end": "1621080"
  },
  {
    "text": "basically use installed application to achieve same effect and third one uh the",
    "start": "1621080",
    "end": "1626559"
  },
  {
    "text": "one I love the most is the exploiting vulnerable driver that comes with uh Windows installations such as um La",
    "start": "1626559",
    "end": "1634080"
  },
  {
    "text": "project did last this year they actually exploited uh a cool vulnerability in",
    "start": "1634080",
    "end": "1639679"
  },
  {
    "text": "upcs uh which allowed them to change the previous bit of the state and then that",
    "start": "1639679",
    "end": "1645080"
  },
  {
    "text": "allow them to have read right Primitives into the Kel and so usually after that attacker will",
    "start": "1645080",
    "end": "1651080"
  },
  {
    "text": "try to evade or basically kill uh protection mechanisms such as antiviruses Defenders",
    "start": "1651080",
    "end": "1659120"
  },
  {
    "text": "and stuff like that but we all know that those are protected by ppls now ppls are",
    "start": "1659120",
    "end": "1664159"
  },
  {
    "text": "protected process light they came to existence around 2008 uh basically they",
    "start": "1664159",
    "end": "1670000"
  },
  {
    "text": "were created to protect for the RM uh they the idea was let's protect like for",
    "start": "1670000",
    "end": "1675559"
  },
  {
    "text": "instance um Blu-ray U movie we want to be able to play it on the other on one",
    "start": "1675559",
    "end": "1681240"
  },
  {
    "text": "hand but we want um no we want we don't want other process to be able to like",
    "start": "1681240",
    "end": "1686399"
  },
  {
    "text": "copy this it's uh things from the process and so ppls are the newer",
    "start": "1686399",
    "end": "1692000"
  },
  {
    "text": "version of the uh protected process and basically the the difference is that they all have uh signature and in the in",
    "start": "1692000",
    "end": "1700760"
  },
  {
    "text": "the actual binary part of the binary and they uh when they are loaded they are",
    "start": "1700760",
    "end": "1706880"
  },
  {
    "text": "validated and then after they executed uh no usual process can uh touch them",
    "start": "1706880",
    "end": "1712840"
  },
  {
    "text": "but the difference is that ppls have a number of different signers and they have an hierarchy and as higher the the",
    "start": "1712840",
    "end": "1720360"
  },
  {
    "text": "signer is it it is stronger which means it can mandle with all the signos lower",
    "start": "1720360",
    "end": "1725840"
  },
  {
    "text": "than that but for instance uh PS protected authentic code light can't",
    "start": "1725840",
    "end": "1731080"
  },
  {
    "text": "like write or read I'll say light uh memory now if we want to find the",
    "start": "1731080",
    "end": "1736720"
  },
  {
    "text": "definition and the values of the of the actual uh structure that hold us on Windows we can use windbg we can then",
    "start": "1736720",
    "end": "1743640"
  },
  {
    "text": "basically check the PS protection struct and find it has Type audit and signer",
    "start": "1743640",
    "end": "1749080"
  },
  {
    "text": "values and then we can find uh the definition of those ANS to find the",
    "start": "1749080",
    "end": "1754840"
  },
  {
    "text": "values actually mean and for instance if we look at Elsas we can uh find uh the",
    "start": "1754840",
    "end": "1761080"
  },
  {
    "text": "eprocess struct and then but with some offset from that we'll have the field of the PS protect and then we can find that",
    "start": "1761080",
    "end": "1768519"
  },
  {
    "text": "uh in this example Elsas is a PS protected Ty protected which makes sense and it's signed by PS protected signer",
    "start": "1768519",
    "end": "1775559"
  },
  {
    "text": "with when system now for instance if we would like to un p a process for instance here if we want to un PPL win",
    "start": "1775559",
    "end": "1782799"
  },
  {
    "text": "in it we we for instance if we want to kill it on the regular execution of a",
    "start": "1782799",
    "end": "1788600"
  },
  {
    "text": "process Explorer we won't be able to do that because process Explorer isn't the P right but what we can do we can attach",
    "start": "1788600",
    "end": "1795519"
  },
  {
    "text": "Kel debugger with Windows and actually change the like find the PS",
    "start": "1795519",
    "end": "1800880"
  },
  {
    "text": "protect field of Elsas sorry of when in it exit and find it value write it with",
    "start": "1800880",
    "end": "1808120"
  },
  {
    "text": "the zeros and then we can actually kill it uh which is cool now um this actually",
    "start": "1808120",
    "end": "1815000"
  },
  {
    "text": "what uh exactly I have in the next demo I'll have a full chain the chain will start with the RC that we already seen",
    "start": "1815000",
    "end": "1821679"
  },
  {
    "text": "then we'll execute the lp part the stage two that will wait for a stronger user",
    "start": "1821679",
    "end": "1827159"
  },
  {
    "text": "to connect after that after a stronger user connected we will execute stage three in this case stage two will",
    "start": "1827159",
    "end": "1833519"
  },
  {
    "text": "actually exploit the same vulnerability in up IDC which will lend us with",
    "start": "1833519",
    "end": "1838960"
  },
  {
    "text": "Windows uh read and WR Primitives and then with those we will actually find the the PPL process that we want to kill",
    "start": "1838960",
    "end": "1845840"
  },
  {
    "text": "we will find it P protect field override it with zeros and actually kill it so let's watch out the full demo first here",
    "start": "1845840",
    "end": "1853000"
  },
  {
    "text": "is the the part on the attacker will execute the remote code ex the LC",
    "start": "1853000",
    "end": "1858679"
  },
  {
    "text": "um waiting for it to connect and then um",
    "start": "1858679",
    "end": "1863960"
  },
  {
    "text": "it'll take a second we can see the stage number one",
    "start": "1863960",
    "end": "1871399"
  },
  {
    "text": "log been uh dumped on the the attacking uh on the attacker share and the stage",
    "start": "1871399",
    "end": "1876440"
  },
  {
    "text": "number two which means the part that's waiting for the strong connection is already there and then we'll have here",
    "start": "1876440",
    "end": "1881760"
  },
  {
    "text": "administrator connecting to the open VPN and we can see here that it fails to",
    "start": "1881760",
    "end": "1886919"
  },
  {
    "text": "connect because the anti system service is not up and so it fails to do that but then we'll we kill the PPL and then",
    "start": "1886919",
    "end": "1893799"
  },
  {
    "text": "we'll help the classical uh we kill the critical process",
    "start": "1893799",
    "end": "1899279"
  },
  {
    "text": "issue and so mitigation from those are available on a lot of um Windows uh and",
    "start": "1899279",
    "end": "1907399"
  },
  {
    "text": "uh Microsoft products such as MD mdvm Sentinel xdr and the F for iot um sorry",
    "start": "1907399",
    "end": "1913200"
  },
  {
    "text": "about that I have to take yeah now something very cool I want",
    "start": "1913200",
    "end": "1919080"
  },
  {
    "text": "to talk about is that open withan were very cool and very nice on the whole process of those vulnerabilities and the",
    "start": "1919080",
    "end": "1926159"
  },
  {
    "text": "idea is that somewhere on December 20 give or take I found all those vulnerabilities submitting them on",
    "start": "1926159",
    "end": "1932919"
  },
  {
    "text": "February 14th and then like a little bit more than month they released an actual patch to patch all of those now it's",
    "start": "1932919",
    "end": "1939639"
  },
  {
    "text": "pretty crazy because if you think about openvpn it's very popular and used on a",
    "start": "1939639",
    "end": "1944919"
  },
  {
    "text": "lot of locations millions of devices and like release a full version with patches",
    "start": "1944919",
    "end": "1950320"
  },
  {
    "text": "form abilities it's hard and come to think about it it's an it's actually open source and then a lot of like",
    "start": "1950320",
    "end": "1957399"
  },
  {
    "text": "Community folks should go over the patches and like see if they can see that and all of that was done in a month",
    "start": "1957399",
    "end": "1963679"
  },
  {
    "text": "and it was pretty crazy and pretty fast and uh very thankful for that and they",
    "start": "1963679",
    "end": "1968919"
  },
  {
    "text": "did it very fast now the key takeways here today are first use long passwords",
    "start": "1968919",
    "end": "1976080"
  },
  {
    "text": "but not like complicated passwords as uh this x kcd shows just a long password",
    "start": "1976080",
    "end": "1981639"
  },
  {
    "text": "that uh it's easy to remember and another cool thing about it is that",
    "start": "1981639",
    "end": "1986960"
  },
  {
    "text": "sometimes like very complicated issues uh need or have very easy solution in",
    "start": "1986960",
    "end": "1992639"
  },
  {
    "text": "this case openvpn just um uh allowed only executing like uh one directory for",
    "start": "1992639",
    "end": "1999919"
  },
  {
    "text": "the configuration of openvpn per per user and so the lp vector and the remote",
    "start": "1999919",
    "end": "2006159"
  },
  {
    "text": "code execution Vector aren't available from here and the third one is that um all of",
    "start": "2006159",
    "end": "2012440"
  },
  {
    "text": "things that are showed here today are all Concepts there nothing's new here nothing new Under the Sun and yet I",
    "start": "2012440",
    "end": "2019799"
  },
  {
    "text": "still was able to get an full full-blown chain here and so they those things",
    "start": "2019799",
    "end": "2025159"
  },
  {
    "text": "shouldn't be overlooked um and we finished and we have some time for Q&A",
    "start": "2025159",
    "end": "2031460"
  },
  {
    "text": "[Applause]",
    "start": "2031460",
    "end": "2035579"
  }
]