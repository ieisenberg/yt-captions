[
  {
    "start": "0",
    "end": "34000"
  },
  {
    "text": "thanks everyone for coming welcome to the active directory but net",
    "start": "0",
    "end": "5040"
  },
  {
    "text": "so my name's ty Miller I'm the managing director of a security company in Sydney called threat intelligence done a lot of",
    "start": "5040",
    "end": "12150"
  },
  {
    "text": "stuff with blackhat we run the shell code lab training as well as practical",
    "start": "12150",
    "end": "17609"
  },
  {
    "text": "threat intelligence and a number of presentations at blackhat in different conferences over the years Paul helps",
    "start": "17609",
    "end": "25619"
  },
  {
    "text": "out with the practical threat intelligence training as well and is obviously presenting today for the",
    "start": "25619",
    "end": "32250"
  },
  {
    "text": "active directory botnet so what are we going to talk about so we're going to",
    "start": "32250",
    "end": "37800"
  },
  {
    "start": "34000",
    "end": "92000"
  },
  {
    "text": "demonstrate how to exploit a fundamental flaw in the way that you know nearly",
    "start": "37800",
    "end": "43590"
  },
  {
    "text": "every organization implements their Active Directory which is pretty much I",
    "start": "43590",
    "end": "48960"
  },
  {
    "text": "mean a lot of the time you know one big domain with you know a lot of the",
    "start": "48960",
    "end": "54660"
  },
  {
    "text": "systems or authenticating to it and basically that introduces a gaping hole",
    "start": "54660",
    "end": "61410"
  },
  {
    "text": "in our security that allows us to you",
    "start": "61410",
    "end": "67290"
  },
  {
    "text": "know or minimizes the the ability for us to effectively contain security breaches",
    "start": "67290",
    "end": "73400"
  },
  {
    "text": "so this is achieved by turning your Active Directory as the name suggests",
    "start": "73400",
    "end": "78509"
  },
  {
    "text": "into an internal botnet and we're going to demonstrate live a number of features",
    "start": "78509",
    "end": "86549"
  },
  {
    "text": "of this age a botnet including getting some remote control over it so I just",
    "start": "86549",
    "end": "93450"
  },
  {
    "start": "92000",
    "end": "475000"
  },
  {
    "text": "wanted to sort of introduce his talk with sort of the current state of play so the Verizon 2017 data breach",
    "start": "93450",
    "end": "102600"
  },
  {
    "text": "investigations report you know shows that it's not going to be a surprise to everyone here that attacks and breaches",
    "start": "102600",
    "end": "111240"
  },
  {
    "text": "are going crazy these days and when you start having a look at some of the",
    "start": "111240",
    "end": "117509"
  },
  {
    "text": "statistics that they pull out in this and they they categorize it you know there's there's obviously a lot of",
    "start": "117509",
    "end": "123450"
  },
  {
    "text": "stolen credit so we're seeing through dumps coming out pretty much every day a",
    "start": "123450",
    "end": "128610"
  },
  {
    "text": "week but the interesting ones or for us anyway for this talk is the",
    "start": "128610",
    "end": "134250"
  },
  {
    "text": "use of backdoors / command-and-control and you can see on the right-hand side down to the fin column there's 557 so",
    "start": "134250",
    "end": "142650"
  },
  {
    "text": "the red ones they're really the high numbers and that's typically related to",
    "start": "142650",
    "end": "150959"
  },
  {
    "text": "you know things like your malware and also down the bottom there you can see with phishing so we're combining a way",
    "start": "150959",
    "end": "158129"
  },
  {
    "text": "of you know your client side attacks and your commanding control so this is just",
    "start": "158129",
    "end": "166200"
  },
  {
    "text": "to give you an idea of some of the ransomware revenue that has been seen",
    "start": "166200",
    "end": "171540"
  },
  {
    "text": "over the last few years with a lot of",
    "start": "171540",
    "end": "176639"
  },
  {
    "text": "them netting over a hundred million we and the expected or estimated amount in",
    "start": "176639",
    "end": "185250"
  },
  {
    "text": "this year was almost a billion dollars so if there's huge amount of motivation",
    "start": "185250",
    "end": "191099"
  },
  {
    "text": "for these attackers to be you know compromising your internal network get it and setting up a commanding control",
    "start": "191099",
    "end": "198379"
  },
  {
    "text": "environment so some of the primary attack techniques as I was saying is you",
    "start": "198379",
    "end": "206370"
  },
  {
    "text": "can see on the right hand side is the phishing so it's through the social",
    "start": "206370",
    "end": "212430"
  },
  {
    "text": "engineering or phishing with client side exploitation drive-by downloads or just",
    "start": "212430",
    "end": "219419"
  },
  {
    "text": "you know you're lucky HR lady clicking on the attachments so then you can see",
    "start": "219419",
    "end": "229019"
  },
  {
    "text": "that in this second bullet point phishing remains a favorite technique of attackers with payloads commonly",
    "start": "229019",
    "end": "234989"
  },
  {
    "text": "delivered via email seventy-three percent and drive by downloads thirteen percent for that particular category and",
    "start": "234989",
    "end": "242729"
  },
  {
    "text": "if the attachment so in terms of the functionality of what actually happens then if the attachments then opened",
    "start": "242729",
    "end": "250019"
  },
  {
    "text": "it'll drop a command-and-control malware and then obviously set up that backdoor",
    "start": "250019",
    "end": "256650"
  },
  {
    "text": "communication channel back out to the CNC server",
    "start": "256650",
    "end": "262519"
  },
  {
    "text": "so currently attackers still being trying to be pretty stealthy right you",
    "start": "262960",
    "end": "270920"
  },
  {
    "text": "know a lot of this malware tries to hide I tend to suspect that you know with a",
    "start": "270920",
    "end": "278990"
  },
  {
    "text": "lot of push towards automation like in security as we see this big push towards",
    "start": "278990",
    "end": "284450"
  },
  {
    "text": "you know automation and machine learning and those sort of things and certainly a matter of time before the attack is sort",
    "start": "284450",
    "end": "291770"
  },
  {
    "text": "of catch on to that and start automating a lot of these attacks for you know we",
    "start": "291770",
    "end": "297170"
  },
  {
    "text": "sort of or people outside of this room probably got surprised at you know",
    "start": "297170",
    "end": "302870"
  },
  {
    "text": "things like the the big malware hits we've been seeing recently but if we",
    "start": "302870",
    "end": "310970"
  },
  {
    "text": "start sort of if the attackers decide to start removing that stealthy part of it",
    "start": "310970",
    "end": "317120"
  },
  {
    "text": "and just going nuts you know we're in big trouble so you know it's you is",
    "start": "317120",
    "end": "323720"
  },
  {
    "text": "you're starts the open source technologies evolving you know the software and the attack capabilities are",
    "start": "323720",
    "end": "332480"
  },
  {
    "text": "just going to become huge especially as you know the machine learning side of things really matures so the other thing",
    "start": "332480",
    "end": "342200"
  },
  {
    "text": "is that I really find surprising is I mean not surprising that people are moving to the cloud that's obviously a",
    "start": "342200",
    "end": "347540"
  },
  {
    "text": "norm this days but just you know we're really extending the our internal",
    "start": "347540",
    "end": "353240"
  },
  {
    "text": "networks out of the cloud and we tried to take advantage of that within this presentation to leverage the fact that",
    "start": "353240",
    "end": "360740"
  },
  {
    "text": "you know we've we've traditionally built up this hard shell of a traditional security architecture but then cloud has",
    "start": "360740",
    "end": "368180"
  },
  {
    "text": "suddenly just ripped that apart and started throwing it out on the net right which I think a lot of people in this room tend to struggle a bit with so",
    "start": "368180",
    "end": "377330"
  },
  {
    "text": "there's huge potential for attacks to you know break out of your organization go noisy and really perform some fast",
    "start": "377330",
    "end": "385460"
  },
  {
    "text": "get fast escalation and large impact attacks so basically just to summarize",
    "start": "385460",
    "end": "392900"
  },
  {
    "text": "that we're looking at highly motivated threat actors utilizing endpoint exploitation",
    "start": "392900",
    "end": "398690"
  },
  {
    "text": "techniques that connect to command and control servers to launch fast and effective internal attacks so the main",
    "start": "398690",
    "end": "405979"
  },
  {
    "text": "challenge is to really for these attacks is to reliably connect out to these",
    "start": "405979",
    "end": "411229"
  },
  {
    "text": "command and control servers and so what",
    "start": "411229",
    "end": "418009"
  },
  {
    "text": "we're trying to do is sort of make people realize you know what the next generation of attacks might look like so",
    "start": "418009",
    "end": "425360"
  },
  {
    "text": "start thinking about things like what if it command and control server exists",
    "start": "425360",
    "end": "430490"
  },
  {
    "text": "inside your internal network what if the seats reserved exists as a part of your",
    "start": "430490",
    "end": "435500"
  },
  {
    "text": "critical infrastructure you know how are you going to deal with that what if the",
    "start": "435500",
    "end": "440780"
  },
  {
    "text": "command and control servers start using production services via key for their communications rather than trying to",
    "start": "440780",
    "end": "447380"
  },
  {
    "text": "tunnel out by their own connections and what happens when your command and",
    "start": "447380",
    "end": "452449"
  },
  {
    "text": "control servers inside your internal network can bypass all of your firewalls and all your network access controls by",
    "start": "452449",
    "end": "459409"
  },
  {
    "text": "using your production services and the other is as I was saying with the cloud",
    "start": "459409",
    "end": "464780"
  },
  {
    "text": "comments what if your command external servers start tunneling out by your cloud connections which you know we've",
    "start": "464780",
    "end": "471229"
  },
  {
    "text": "just opened up to to allow functionality and flexibility so introducing the",
    "start": "471229",
    "end": "477590"
  },
  {
    "start": "475000",
    "end": "929000"
  },
  {
    "text": "Active Directory botnet we're trying to achieve those things so first of all I",
    "start": "477590",
    "end": "483770"
  },
  {
    "text": "just wanted to start off with having a look at a common Active Directory architecture so this is sort of a",
    "start": "483770",
    "end": "493490"
  },
  {
    "text": "picture of a common organization you know you might have a DMZ you may or may not have a domain controller in there",
    "start": "493490",
    "end": "500349"
  },
  {
    "text": "you've got your clout DC on the right there that may have a cloud domain",
    "start": "500349",
    "end": "506659"
  },
  {
    "text": "controller in there and then you've got your various different security zones",
    "start": "506659",
    "end": "511909"
  },
  {
    "text": "which may be your lands or your various network segments and then that they may",
    "start": "511909",
    "end": "516919"
  },
  {
    "text": "have their own domain controllers in there as well right and you can see each of the domain controllers can talk to",
    "start": "516919",
    "end": "523339"
  },
  {
    "text": "each other as well as out to the cloud and each of these systems",
    "start": "523339",
    "end": "529540"
  },
  {
    "text": "in each of the different security zones can talk to the domain controllers but not talk to each other but the domain",
    "start": "529550",
    "end": "536930"
  },
  {
    "text": "controllers can talk to each other right so let's have a look at a common botnet",
    "start": "536930",
    "end": "543650"
  },
  {
    "text": "architecture wait a minute that looks very familiar Active Directory but net",
    "start": "543650",
    "end": "551510"
  },
  {
    "text": "architecture Active Directory what data architecture so you've got in this case",
    "start": "551510",
    "end": "557690"
  },
  {
    "text": "you've got different organizations as represented by the circles and I mean",
    "start": "557690",
    "end": "563780"
  },
  {
    "text": "you don't necessarily need the command external servers inside the organization's that you know there's",
    "start": "563780",
    "end": "569840"
  },
  {
    "text": "command external systems on the internet and within these different security",
    "start": "569840",
    "end": "574880"
  },
  {
    "text": "zones or organizations these BOTS or communicate with the command and control",
    "start": "574880",
    "end": "580580"
  },
  {
    "text": "systems including you know bots sitting in the cloud right so what we're doing",
    "start": "580580",
    "end": "586220"
  },
  {
    "text": "is combining the two similar concepts for a bot architecture and an AJ",
    "start": "586220",
    "end": "591650"
  },
  {
    "text": "architecture and creating the Active Directory botnet architecture which is",
    "start": "591650",
    "end": "597350"
  },
  {
    "text": "pretty much the same as both right so you've got your domain controllers in",
    "start": "597350",
    "end": "603080"
  },
  {
    "text": "the middle you've got different systems within your environment that have been infected by bots and as we just went",
    "start": "603080",
    "end": "610550"
  },
  {
    "text": "through through the state of play you know a lot of these assists we're seeing",
    "start": "610550",
    "end": "616940"
  },
  {
    "text": "a lot of security breaches and a lot of these breaches are coming through you know your client side attacks and",
    "start": "616940",
    "end": "623120"
  },
  {
    "text": "therefore you it's quite likely that you'll actually get systems spread across multiple security zones getting",
    "start": "623120",
    "end": "630500"
  },
  {
    "text": "breached but they can't necessarily communicate with each other so what the botnet Active Directory botnet",
    "start": "630500",
    "end": "636860"
  },
  {
    "text": "architecture does is actually allows all of those BOTS to talk to each other no matter what security zone they're in",
    "start": "636860",
    "end": "644769"
  },
  {
    "text": "okay so suitability of Active Directory is a command and control channel we've",
    "start": "645250",
    "end": "651170"
  },
  {
    "text": "got it's a central authentication and access control point for organization so you know a lot of organizations will use",
    "start": "651170",
    "end": "658460"
  },
  {
    "text": "ad as the central authentication and there or you know if system administrators want to log into you know a server in",
    "start": "658460",
    "end": "665569"
  },
  {
    "text": "the DMZ then it has to be able to connect to their Active Directory if they want to connect to a system that's",
    "start": "665569",
    "end": "671480"
  },
  {
    "text": "in their corporate VLAN it has to connect to Active Directory right or if they want to connect to",
    "start": "671480",
    "end": "677750"
  },
  {
    "text": "another system in a different security zone has to connect to Active Directory for authentication so all the end-user",
    "start": "677750",
    "end": "684529"
  },
  {
    "text": "devices and a lot of the servers will connect to ad which means that we can",
    "start": "684529",
    "end": "691069"
  },
  {
    "text": "utilize that connection to bypass all of your network access controls and all",
    "start": "691069",
    "end": "696500"
  },
  {
    "text": "your firewall rules because that's got that gaping hole where everything can communicate with this one central place",
    "start": "696500",
    "end": "704319"
  },
  {
    "text": "so the other thing with Active Directory is that any standard user account can",
    "start": "704769",
    "end": "712220"
  },
  {
    "text": "write to their own attributes right so for when we're talking about Active",
    "start": "712220",
    "end": "717889"
  },
  {
    "text": "Directory and its suitability as a command-and-control Channel we need to be able to send and receive data so that",
    "start": "717889",
    "end": "724339"
  },
  {
    "text": "we can get a two-way communication channel so users can write to their own attributes and they can read other users",
    "start": "724339",
    "end": "731300"
  },
  {
    "text": "attributes which means that we can write data and we can also read data from",
    "start": "731300",
    "end": "737209"
  },
  {
    "text": "other BOTS right so that allows a two-way communication channel through",
    "start": "737209",
    "end": "743509"
  },
  {
    "text": "your domain controllers to be able to talk to any other system within your network as well as when you start",
    "start": "743509",
    "end": "749689"
  },
  {
    "text": "looking at you know cloud systems you can communicate out by your through ADT",
    "start": "749689",
    "end": "757610"
  },
  {
    "text": "cloud systems and we're also going to show you how to utilize your cloud",
    "start": "757610",
    "end": "764209"
  },
  {
    "text": "domain controllers to actually export rate data out of your organization so",
    "start": "764209",
    "end": "770089"
  },
  {
    "text": "I'll hand over to Paul he's going to step you through the gruesome details I just like to give credit to Paul he has",
    "start": "770089",
    "end": "777889"
  },
  {
    "text": "been working hard for a long time now he's done about 90% of the code in this",
    "start": "777889",
    "end": "783220"
  },
  {
    "text": "so good work rate all right thanks all right so",
    "start": "783220",
    "end": "789450"
  },
  {
    "text": "as Ty's been saying like one of the interesting things about using Active",
    "start": "789450",
    "end": "795840"
  },
  {
    "text": "Directory for the command and control is that it basically turns whatever network",
    "start": "795840",
    "end": "801420"
  },
  {
    "text": "you've got no matter what segmentation or what network controls you've got in",
    "start": "801420",
    "end": "807030"
  },
  {
    "text": "place it turns it from you know a segmented network into more like a starbase network where you know at the",
    "start": "807030",
    "end": "814260"
  },
  {
    "text": "center of the star you've got the domain controller so basically every every little node",
    "start": "814260",
    "end": "820890"
  },
  {
    "text": "connected to it is able to access and read data from the domain controller and",
    "start": "820890",
    "end": "827640"
  },
  {
    "text": "you know in that manner establish a two-way connection now another",
    "start": "827640",
    "end": "834240"
  },
  {
    "text": "interesting thing about it is that the the kind of traffic that you'll see when",
    "start": "834240",
    "end": "840480"
  },
  {
    "text": "you actually run traffic over it there's really only you've got obviously",
    "start": "840480",
    "end": "846720"
  },
  {
    "text": "Kerberos authentication then all updates to attributes go over the aw8 EWS which",
    "start": "846720",
    "end": "854430"
  },
  {
    "text": "is like you know the Active Directory web service which is encrypted you know SSL and so you know it's not",
    "start": "854430",
    "end": "862080"
  },
  {
    "text": "something that's easily viewable over you know like if you've got like a",
    "start": "862080",
    "end": "868730"
  },
  {
    "text": "intrusion detection system or something like that on your internal network it's not something that's going to be easily",
    "start": "868730",
    "end": "875460"
  },
  {
    "text": "visible on any of your network detection mechanisms the other the other thing is",
    "start": "875460",
    "end": "883740"
  },
  {
    "text": "that the normal default logging windows",
    "start": "883740",
    "end": "889110"
  },
  {
    "text": "in Active Directory typically is not going to detect it either that the kind",
    "start": "889110",
    "end": "894690"
  },
  {
    "text": "of logs which will be generated typically the type of things like active",
    "start": "894690",
    "end": "900600"
  },
  {
    "text": "directory object updates and most people even if it is turned off on initially",
    "start": "900600",
    "end": "907380"
  },
  {
    "text": "will turn turn it off because it's quite a noisy sort of event to be looking at",
    "start": "907380",
    "end": "913830"
  },
  {
    "text": "because like there's so many updates to Active Directory objects so there's just a couple of you know",
    "start": "913830",
    "end": "919890"
  },
  {
    "text": "things just to set the scene about what makes this kind of command and control Network interesting from an attackers",
    "start": "919890",
    "end": "926430"
  },
  {
    "text": "perspective so like there's a lot of",
    "start": "926430",
    "end": "932459"
  },
  {
    "start": "929000",
    "end": "999000"
  },
  {
    "text": "standard user attributes not all of these are a rideable to the average user",
    "start": "932459",
    "end": "940430"
  },
  {
    "text": "but like a subset of these are usable and so like they range in size from",
    "start": "940430",
    "end": "949410"
  },
  {
    "text": "about a megabyte and down to about you know 64 64 bytes or something like that",
    "start": "949410",
    "end": "956370"
  },
  {
    "text": "I can't remember the lowest one but you know like the largest the largest",
    "start": "956370",
    "end": "961410"
  },
  {
    "text": "attributes about a megabyte from memory so basically you know you can use any of",
    "start": "961410",
    "end": "968279"
  },
  {
    "text": "these attributes for establishing you know the communication within the network oh here we go",
    "start": "968279",
    "end": "975750"
  },
  {
    "text": "here's some of the sizes so the largest one is the like the M smq signed",
    "start": "975750",
    "end": "981089"
  },
  {
    "text": "certificates it's around a bit of megabyte and you've got thumbnail photo and a few other ones so basically",
    "start": "981089",
    "end": "987959"
  },
  {
    "text": "they're they're divided into like binary attributes and string attributes in terms of their type so so in terms of",
    "start": "987959",
    "end": "1001880"
  },
  {
    "start": "999000",
    "end": "1260000"
  },
  {
    "text": "establishing our botnet and the way we sort of did it is when like a node or a",
    "start": "1001880",
    "end": "1008899"
  },
  {
    "text": "bot registers one of the first things it does is that each botnets got like a",
    "start": "1008899",
    "end": "1015010"
  },
  {
    "text": "unique gooood and so what it would do is is as part of its initialization routine",
    "start": "1015010",
    "end": "1021730"
  },
  {
    "text": "would would be to update the IP Phone",
    "start": "1021730",
    "end": "1027020"
  },
  {
    "text": "attribute with this good and so what that means is that like when we look at",
    "start": "1027020",
    "end": "1035120"
  },
  {
    "text": "the botnet we can scan the entire Active Directory for that go ahead and look at",
    "start": "1035120",
    "end": "1040790"
  },
  {
    "text": "it look at only those systems in which that gooood matches the botnet good and then we can actually track the nodes",
    "start": "1040790",
    "end": "1047720"
  },
  {
    "text": "that we have actually got infected on the on the domain and so then we know which",
    "start": "1047720",
    "end": "1054779"
  },
  {
    "text": "ones we can you know establish commands and send and send data to receive data from start reverse shells buying shells",
    "start": "1054779",
    "end": "1063210"
  },
  {
    "text": "all that sort of stuff the info attribute is one we chose for a control",
    "start": "1063210",
    "end": "1069809"
  },
  {
    "text": "channel so we sort of established quite a simple protocol and basically when",
    "start": "1069809",
    "end": "1078870"
  },
  {
    "text": "we're looking at differentiating between nodes within this network the main thing",
    "start": "1078870",
    "end": "1085409"
  },
  {
    "text": "we're looking at really is the user account that has been compromised and",
    "start": "1085409",
    "end": "1091070"
  },
  {
    "text": "also the the hostname that it's running on oh one other thing that I forgot to",
    "start": "1091070",
    "end": "1096299"
  },
  {
    "text": "mention before was that before when we're talking about the in terms of why",
    "start": "1096299",
    "end": "1103559"
  },
  {
    "text": "it's a good channel is because we're not actually established any logging events when we're running when a user runs this",
    "start": "1103559",
    "end": "1110000"
  },
  {
    "text": "this bot basically it sort of tags onto their own credentials so you don't get log on events so that's just another",
    "start": "1110000",
    "end": "1115950"
  },
  {
    "text": "thing that's interesting now so the info",
    "start": "1115950",
    "end": "1121110"
  },
  {
    "text": "attribute is what we use to send can command and control and then other",
    "start": "1121110",
    "end": "1126390"
  },
  {
    "text": "attributes we use as data channels so for sending data and such oh here we go",
    "start": "1126390",
    "end": "1134730"
  },
  {
    "text": "bot registration so as I said before you",
    "start": "1134730",
    "end": "1139890"
  },
  {
    "text": "know the you know the Goodes with the IP Phone and the command outputs through",
    "start": "1139890",
    "end": "1146190"
  },
  {
    "text": "other variables okay",
    "start": "1146190",
    "end": "1152570"
  },
  {
    "text": "so there's a graphical and sort of representation of the registration process so you've got the the gooood and",
    "start": "1155419",
    "end": "1163459"
  },
  {
    "text": "the info attribute and it sort of sets itself into like like a waiting State so",
    "start": "1163459",
    "end": "1170719"
  },
  {
    "text": "basically we've tried to make it quite stateful so when when it initially sets",
    "start": "1170719",
    "end": "1176570"
  },
  {
    "text": "itself up it gets into like a wait state waiting for instructions and other nodes",
    "start": "1176570",
    "end": "1182659"
  },
  {
    "text": "can communicate with it when it's in that state but when it's actually",
    "start": "1182659",
    "end": "1187969"
  },
  {
    "text": "operating on an instruction it goes into another state and then the other nodes",
    "start": "1187969",
    "end": "1193969"
  },
  {
    "text": "have to wait until it gets out of that state before it can communicate okay",
    "start": "1193969",
    "end": "1202299"
  },
  {
    "text": "okay you want to do a demo or no yeah okay just keeps going through all right",
    "start": "1205149",
    "end": "1211429"
  },
  {
    "text": "so some of the functionality we've got within the application is like obviously",
    "start": "1211429",
    "end": "1218659"
  },
  {
    "text": "we want to know which nodes we've got infected in the network so like we've",
    "start": "1218659",
    "end": "1224269"
  },
  {
    "text": "got like a controller which we can set up which can actually deliver commands throughout the network and so we one of",
    "start": "1224269",
    "end": "1235429"
  },
  {
    "text": "the things we can do is actually list all the nodes in the network who are actually infected so that we can then",
    "start": "1235429",
    "end": "1243529"
  },
  {
    "text": "direct commands to them so we can yeah",
    "start": "1243529",
    "end": "1250940"
  },
  {
    "text": "we can display the the username and the the host name and stuff of the of the",
    "start": "1250940",
    "end": "1256149"
  },
  {
    "text": "systems which are infected so basically",
    "start": "1256149",
    "end": "1262099"
  },
  {
    "start": "1260000",
    "end": "1506000"
  },
  {
    "text": "this is really what what happens you know like we've got numbers of different hosts on the network which might be",
    "start": "1262099",
    "end": "1268249"
  },
  {
    "text": "infected and there might be all in different security zones and we can see",
    "start": "1268249",
    "end": "1274009"
  },
  {
    "text": "from our perspective of the the control panel we get a listing of",
    "start": "1274009",
    "end": "1280290"
  },
  {
    "text": "each of the nodes the user accounts which are you know affected and also the",
    "start": "1280290",
    "end": "1285360"
  },
  {
    "text": "the host name of the box that they're running at we really we've got that there because obviously with multi-user",
    "start": "1285360",
    "end": "1291690"
  },
  {
    "text": "systems you could have multiple users on the same box which are infected as well",
    "start": "1291690",
    "end": "1297769"
  },
  {
    "text": "so I guess the initial the initial stage is when we started testing this the",
    "start": "1300020",
    "end": "1305670"
  },
  {
    "text": "first thing we obviously did was to set up functionality to send commands to the",
    "start": "1305670",
    "end": "1311059"
  },
  {
    "text": "to the bots so from the controller we",
    "start": "1311059",
    "end": "1317010"
  },
  {
    "text": "can we can actually control that and send numbers of commands I mean the way",
    "start": "1317010",
    "end": "1325679"
  },
  {
    "text": "that it kind of works is we've got like the protocol we've got like the the username host name we've got then the",
    "start": "1325679",
    "end": "1333000"
  },
  {
    "text": "type of command that what needs to be run and then we've got the the destination user and host that the",
    "start": "1333000",
    "end": "1341040"
  },
  {
    "text": "system is going to be run on so what happens is that each each you like node",
    "start": "1341040",
    "end": "1349520"
  },
  {
    "text": "can only really write to its own properties but what it does it writes to",
    "start": "1349520",
    "end": "1354600"
  },
  {
    "text": "its own command can control attribute which is the info attribute and it says you know this is like the destination",
    "start": "1354600",
    "end": "1361890"
  },
  {
    "text": "host that I want to run the command on each of the other nodes will be polling ad looking for commands which are being",
    "start": "1361890",
    "end": "1370679"
  },
  {
    "text": "directed towards them and if it sees within somebody else's info attribute",
    "start": "1370679",
    "end": "1375870"
  },
  {
    "text": "that it's saying look I want you to run a command and on you then it will grab",
    "start": "1375870",
    "end": "1382380"
  },
  {
    "text": "the command from that other attribute it will run it and then send the command",
    "start": "1382380",
    "end": "1388200"
  },
  {
    "text": "attribute or the command output sorry to that node so that's basically what",
    "start": "1388200",
    "end": "1393240"
  },
  {
    "text": "happens",
    "start": "1393240",
    "end": "1395600"
  },
  {
    "text": "so yeah basically you know all of the output and commands are all encoded in",
    "start": "1401060",
    "end": "1407070"
  },
  {
    "text": "base64 just to make it safer and you know prevent you know issues in the",
    "start": "1407070",
    "end": "1416010"
  },
  {
    "text": "delivery of the the data yeah so then",
    "start": "1416010",
    "end": "1422790"
  },
  {
    "text": "basically we've got the initial the initial sort of commands are just like",
    "start": "1422790",
    "end": "1428460"
  },
  {
    "text": "running a single command we've got like a simulated shell which is just basically just the same command with",
    "start": "1428460",
    "end": "1434130"
  },
  {
    "text": "that loops around and just allows you to simulate you know a shell on the remote",
    "start": "1434130",
    "end": "1439440"
  },
  {
    "text": "system this just steps you through it",
    "start": "1439440",
    "end": "1453210"
  },
  {
    "text": "just graphically each of the different steps and the type of data that is being passed through the attributes for the",
    "start": "1453210",
    "end": "1459390"
  },
  {
    "text": "commands to be run yep",
    "start": "1459390",
    "end": "1463700"
  },
  {
    "text": "so then the next the next sort of commands we sort of looked at because we",
    "start": "1466340",
    "end": "1472530"
  },
  {
    "text": "we thought you know you know people put security boundaries in place to stop you know files being uploaded and downloaded",
    "start": "1472530",
    "end": "1479390"
  },
  {
    "text": "from systems within the network you know because you might have highly sensitive information you know you know highly",
    "start": "1479390",
    "end": "1485880"
  },
  {
    "text": "segmented network so what we then did was we set up a functionality so that we",
    "start": "1485880",
    "end": "1491700"
  },
  {
    "text": "could do file transfers using the attributes so basically it's just",
    "start": "1491700",
    "end": "1498300"
  },
  {
    "text": "basically another type of command within the control commander control channel",
    "start": "1498300",
    "end": "1504810"
  },
  {
    "text": "and it just uses different attributes normally large wrapped tributes the the",
    "start": "1504810",
    "end": "1511470"
  },
  {
    "text": "ones that are you know the larger in size like the M sqm",
    "start": "1511470",
    "end": "1517309"
  },
  {
    "text": "science certificates is a good one for delivering files and stuff because it's",
    "start": "1517309",
    "end": "1523070"
  },
  {
    "text": "you know one megabyte in size and so basically it just works by in the same",
    "start": "1523070",
    "end": "1529100"
  },
  {
    "text": "way just by cutting the file into the",
    "start": "1529100",
    "end": "1534919"
  },
  {
    "text": "chunks which are the you know the size of the attribute and sending them",
    "start": "1534919",
    "end": "1540169"
  },
  {
    "text": "through the node on the other side will receive a packet then it'll knowledge",
    "start": "1540169",
    "end": "1546649"
  },
  {
    "text": "the packet the like the note on the other side will not send the next packet",
    "start": "1546649",
    "end": "1553460"
  },
  {
    "text": "until it receives an acknowledgment and then it goes like that until basically the entire files being sent through all",
    "start": "1553460",
    "end": "1562879"
  },
  {
    "start": "1561000",
    "end": "1806000"
  },
  {
    "text": "right okay so we'll do a bit of a demo",
    "start": "1562879",
    "end": "1567039"
  },
  {
    "text": "so so this one he is like the",
    "start": "1580820",
    "end": "1587630"
  },
  {
    "text": "command-and-control okay",
    "start": "1587630",
    "end": "1600490"
  },
  {
    "text": "how because they don't put on so",
    "start": "1601420",
    "end": "1606670"
  },
  {
    "text": "basically what we can do we can as I said before we can list the members of",
    "start": "1606670",
    "end": "1612880"
  },
  {
    "text": "the the botnet so you can sort of see there that we've got like like a few",
    "start": "1612880",
    "end": "1620800"
  },
  {
    "text": "users there staff one on win whatever that is we've got staff two and staff",
    "start": "1620800",
    "end": "1626290"
  },
  {
    "text": "three and start four so each of those",
    "start": "1626290",
    "end": "1632260"
  },
  {
    "text": "you know systems has got you know I bought running on it so now that we know",
    "start": "1632260",
    "end": "1640030"
  },
  {
    "text": "which ones are effective we can actually send a command through to one of the nodes so these systems are actually on",
    "start": "1640030",
    "end": "1647020"
  },
  {
    "text": "different in different security zones and they can't communicate with each other directly so they have to go via ad",
    "start": "1647020",
    "end": "1653470"
  },
  {
    "text": "yep so then what we can do I can select",
    "start": "1653470",
    "end": "1659160"
  },
  {
    "text": "one of the exact bots to be sending commands to so we'll select the second",
    "start": "1659160",
    "end": "1664750"
  },
  {
    "text": "one and we'll enter the commands so we can see that the the users called staff",
    "start": "1664750",
    "end": "1670960"
  },
  {
    "text": "too so what we can do we can enter a command we can say look I want to get a listing of this users downloads",
    "start": "1670960",
    "end": "1680530"
  },
  {
    "text": "directory",
    "start": "1680530",
    "end": "1682770"
  },
  {
    "text": "and you can see this is the sort of commands that are sort of going through in the protocol we sort of printed them",
    "start": "1690910",
    "end": "1699410"
  },
  {
    "text": "out so you could see it and although it's hard to see and all that sort of command output there you can see that in",
    "start": "1699410",
    "end": "1705890"
  },
  {
    "text": "the in the users directory just here there's a couple of files ones like credit card text and so what we can do",
    "start": "1705890",
    "end": "1713809"
  },
  {
    "text": "now I'll download that into my download directories on this machine using the",
    "start": "1713809",
    "end": "1722210"
  },
  {
    "text": "functionality within the within the bot",
    "start": "1722210",
    "end": "1728530"
  },
  {
    "text": "so we want to grab it from staff too",
    "start": "1728530",
    "end": "1733929"
  },
  {
    "text": "and we'll just stick it in our downloads directory",
    "start": "1752660",
    "end": "1756850"
  },
  {
    "text": "so basically that will go away and upload the file that should pop up in",
    "start": "1771600",
    "end": "1776909"
  },
  {
    "text": "this directory hopefully",
    "start": "1776909",
    "end": "1781190"
  },
  {
    "text": "there we go so you can see you know through the network boundaries we can",
    "start": "1788600",
    "end": "1794300"
  },
  {
    "text": "you know upload upload and download files and and do all that sort of stuff",
    "start": "1794300",
    "end": "1799510"
  },
  {
    "text": "through that yeah choke on to the next part",
    "start": "1799510",
    "end": "1806350"
  },
  {
    "start": "1806000",
    "end": "1961000"
  },
  {
    "text": "alright thanks mate so now you can see that we can bypass all the network",
    "start": "1817900",
    "end": "1824570"
  },
  {
    "text": "access controls any firewall rules just by tunneling everything through ad",
    "start": "1824570",
    "end": "1829730"
  },
  {
    "text": "attributes and be able to even transfer files around the network we also looked",
    "start": "1829730",
    "end": "1836840"
  },
  {
    "text": "at trying to see what options we have with Azua ad which microsoft provide and",
    "start": "1836840",
    "end": "1847010"
  },
  {
    "text": "ZOA cloud-hosted api into your active directory which is known as graph api so",
    "start": "1847010",
    "end": "1855800"
  },
  {
    "text": "this basically lets you interact from the internet through an API directly to",
    "start": "1855800",
    "end": "1862880"
  },
  {
    "text": "your active directory so that basically exposes your ad to the Internet and you",
    "start": "1862880",
    "end": "1868930"
  },
  {
    "text": "can access that as any standard user within your organization which means",
    "start": "1868930",
    "end": "1875600"
  },
  {
    "text": "that we were obviously looking at a trying to get a two-way communication",
    "start": "1875600",
    "end": "1880850"
  },
  {
    "text": "channel from the Internet via this unfortunately a couple of years ago they disabled the user attributes sinking",
    "start": "1880850",
    "end": "1888170"
  },
  {
    "text": "from Azur back to your on-premise environment so that unfortunately stopped us from getting the two-way",
    "start": "1888170",
    "end": "1894470"
  },
  {
    "text": "communication channel through that however it does obviously allow on-premise ad attributes to be synced to",
    "start": "1894470",
    "end": "1901700"
  },
  {
    "text": "the Azua ad and then accessed through the graph api which means that if you",
    "start": "1901700",
    "end": "1908780"
  },
  {
    "text": "get your internal ad botnet you can then have your botnets start grabbing data",
    "start": "1908780",
    "end": "1915170"
  },
  {
    "text": "such as these files pushing them into particular what we call exfiltration",
    "start": "1915170",
    "end": "1921050"
  },
  {
    "text": "attributes they get synced up to Azur ad and then we can as a standard user account just",
    "start": "1921050",
    "end": "1927990"
  },
  {
    "text": "start extracting those directly from the internet via graph API so we've got a",
    "start": "1927990",
    "end": "1935280"
  },
  {
    "text": "feature called XML trade data so as I said the button air pushes data into an",
    "start": "1935280",
    "end": "1941670"
  },
  {
    "text": "attribute sinks into ad your authenticators a standard user to graph API you list out the user attributes and",
    "start": "1941670",
    "end": "1949740"
  },
  {
    "text": "then you can grab the values from those to basically keep pulling all your data",
    "start": "1949740",
    "end": "1955050"
  },
  {
    "text": "out so you can see the export rate data option there so this is just a graphical",
    "start": "1955050",
    "end": "1963300"
  },
  {
    "start": "1961000",
    "end": "2121000"
  },
  {
    "text": "representation of that so you can see that the bots can obviously communicate with the domain controller and it sends",
    "start": "1963300",
    "end": "1969900"
  },
  {
    "text": "it out via razaw and then the attacker pretty guy in the top left-hand corner",
    "start": "1969900",
    "end": "1975210"
  },
  {
    "text": "there can obviously connect to graph api and then and then pull that out so since",
    "start": "1975210",
    "end": "1985020"
  },
  {
    "text": "our two-way communication channel god shut down through Azur ad we then wanted",
    "start": "1985020",
    "end": "1991950"
  },
  {
    "text": "to have other command and control options so we implemented an ad bot net",
    "start": "1991950",
    "end": "1999210"
  },
  {
    "text": "reverse tcp Handler and basically what this does is it allows you to have we go",
    "start": "1999210",
    "end": "2008780"
  },
  {
    "text": "back to I guess this you could have for example your bot on the left hand side",
    "start": "2008780",
    "end": "2016150"
  },
  {
    "text": "issue the command that he wants to establish a connection back to our",
    "start": "2016150",
    "end": "2023120"
  },
  {
    "text": "attacker out on the internet by a TCP channel at that point on the on the bot",
    "start": "2023120",
    "end": "2029510"
  },
  {
    "text": "on the left hand side he basically sets up a socket and he can say I want to port forward this socket",
    "start": "2029510",
    "end": "2039290"
  },
  {
    "text": "through Active Directory to the bot on the right hand side as if it's just a",
    "start": "2039290",
    "end": "2046220"
  },
  {
    "text": "TCP connection and then can issue that but on the right hand side to start",
    "start": "2046220",
    "end": "2051830"
  },
  {
    "text": "connecting to any other system in network so basically bypasses not just",
    "start": "2051830",
    "end": "2058050"
  },
  {
    "text": "your internal access network access controls but basically exposes a socket",
    "start": "2058050",
    "end": "2063260"
  },
  {
    "text": "from the guy out on the Internet through to a socket on your internal",
    "start": "2063260",
    "end": "2069570"
  },
  {
    "text": "network through different machines and through your Active Directory the other",
    "start": "2069570",
    "end": "2077460"
  },
  {
    "text": "one is the reverse so you've got your buy-in tcp handler so they connect back",
    "start": "2077460",
    "end": "2083878"
  },
  {
    "text": "obviously connects to the internet if you've got out down firewall rules preventing that from connecting out but",
    "start": "2083879",
    "end": "2090960"
  },
  {
    "text": "you might have for example a bot within your dmz that's compromised and you have",
    "start": "2090960",
    "end": "2096060"
  },
  {
    "text": "a not open port through your firewall which is quite common you know if you're under their maps can you get a closed",
    "start": "2096060",
    "end": "2102210"
  },
  {
    "text": "port then obviously the bots can set up a bind port on there so that you can",
    "start": "2102210",
    "end": "2107970"
  },
  {
    "text": "establish a TCP connection from the internet to your bite and again that",
    "start": "2107970",
    "end": "2113820"
  },
  {
    "text": "basically just pour forwards that socket to any system on your internal network",
    "start": "2113820",
    "end": "2120080"
  },
  {
    "text": "so let's try and do that live alright so",
    "start": "2120080",
    "end": "2127020"
  },
  {
    "start": "2121000",
    "end": "2494000"
  },
  {
    "text": "we've got our bot here and sorry about",
    "start": "2127020",
    "end": "2134400"
  },
  {
    "text": "the size I won't mess with it right now it's not it's not overly important but there's basically two options there one",
    "start": "2134400",
    "end": "2141450"
  },
  {
    "text": "is the that we're talking about one is the bind handler and one is the reverse",
    "start": "2141450",
    "end": "2146910"
  },
  {
    "text": "TCP handler so we're going to start with the reverse TCP handler which is number",
    "start": "2146910",
    "end": "2153600"
  },
  {
    "text": "seven here it again lists out the bots and says which bots do you want me to",
    "start": "2153600",
    "end": "2158760"
  },
  {
    "text": "forward this TCP channel through ad to so it lists out your bots and I'm going",
    "start": "2158760",
    "end": "2165330"
  },
  {
    "text": "to say I think it was number one",
    "start": "2165330",
    "end": "2172760"
  },
  {
    "text": "remember we were logged in er yeah let's go with number one all right so then we",
    "start": "2172760",
    "end": "2179580"
  },
  {
    "text": "want it asks us for our controller IP so where do you want to connect back to",
    "start": "2179580",
    "end": "2186050"
  },
  {
    "text": "and it's called control it well port do you want to connect back to on the",
    "start": "2186550",
    "end": "2191810"
  },
  {
    "text": "controller so in this case we're going to do 4 4 4 4 so the target IP is so",
    "start": "2191810",
    "end": "2199790"
  },
  {
    "text": "we've already said that we want to open up port forward this socket through ad 2",
    "start": "2199790",
    "end": "2206420"
  },
  {
    "text": "this bot number 1 which is in a completely different security zone right",
    "start": "2206420",
    "end": "2211940"
  },
  {
    "text": "so our target IP can either be a listener on that machine or it can be in",
    "start": "2211940",
    "end": "2221630"
  },
  {
    "text": "another IP address within that network so we're just going to do on that machine itself so we'll do 1 27001 which",
    "start": "2221630",
    "end": "2230300"
  },
  {
    "text": "is the local host of the remote bot and the port that it's going to be on which",
    "start": "2230300",
    "end": "2237920"
  },
  {
    "text": "is 4 4 4 4 before we kick this off we want to obviously on our controller on",
    "start": "2237920",
    "end": "2244940"
  },
  {
    "text": "the internet we want to set up a listener so we're gonna use Metasploit for that oops",
    "start": "2244940",
    "end": "2253180"
  },
  {
    "text": "options there we go so we're going to set up use the Metasploit multi handler",
    "start": "2253180",
    "end": "2259250"
  },
  {
    "text": "to set up a 64-bit reverse TCP handle",
    "start": "2259250",
    "end": "2266180"
  },
  {
    "text": "and that's basically just going to accept our TCP connection drop us to a",
    "start": "2266180",
    "end": "2271460"
  },
  {
    "text": "Metasploit session so we've started up",
    "start": "2271460",
    "end": "2278510"
  },
  {
    "text": "Metasploit listener we then it's okay",
    "start": "2278510",
    "end": "2286210"
  },
  {
    "text": "we've now established a connection to a",
    "start": "2286210",
    "end": "2291339"
  },
  {
    "text": "remote attacker from our internal botnet if we then type a command you'll see",
    "start": "2291339",
    "end": "2298550"
  },
  {
    "text": "same sort of thing as Paul was demonstrating all the different pieces of communication going past and there's",
    "start": "2298550",
    "end": "2309829"
  },
  {
    "text": "our shell right so you can basically that's a full shell that you can just",
    "start": "2309829",
    "end": "2315069"
  },
  {
    "text": "keep interacting with over the internet via an internal bot via ad to any system",
    "start": "2315069",
    "end": "2324050"
  },
  {
    "text": "on your internal network and again that'll just be throwing the data back",
    "start": "2324050",
    "end": "2330230"
  },
  {
    "text": "and forth and there we go so we kill that connection now our block",
    "start": "2330230",
    "end": "2340400"
  },
  {
    "text": "controller then drops back to you know wanting to ask what we want to do so in",
    "start": "2340400",
    "end": "2346099"
  },
  {
    "text": "this case we're going to now set up a bind Handler and this is to demonstrate the DN Baron connection so if we type",
    "start": "2346099",
    "end": "2354650"
  },
  {
    "text": "number six which is launch ID botnet by an handler again we're going to select",
    "start": "2354650",
    "end": "2360740"
  },
  {
    "text": "bot 1 we're going to bind to I mean this would be the port that you know if",
    "start": "2360740",
    "end": "2366770"
  },
  {
    "text": "you've done a port scan against your external IP address and you find a closed port on one of your BOTS then you",
    "start": "2366770",
    "end": "2375140"
  },
  {
    "text": "can get it to set up a bot active directory botnet by and handle on that",
    "start": "2375140",
    "end": "2380540"
  },
  {
    "text": "port and then we can basically as I'm saying that basically opens up your",
    "start": "2380540",
    "end": "2386930"
  },
  {
    "text": "internal network to any of your hosts so again we're going to do 4 4 4 4",
    "start": "2386930",
    "end": "2392660"
  },
  {
    "text": "hopefully you guys don't open your firewalls up on the 4 4 4 4 again we're",
    "start": "2392660",
    "end": "2399410"
  },
  {
    "text": "going to use the same host and the same listener so we set the target IP which",
    "start": "2399410",
    "end": "2407540"
  },
  {
    "text": "is the remote bot internal to the organization somewhere set up the listener on its its own",
    "start": "2407540",
    "end": "2414520"
  },
  {
    "text": "network and it's now sitting there saying accepting connections from the",
    "start": "2414520",
    "end": "2421599"
  },
  {
    "text": "internet basically so if we go back and we set the payload to be a bind TCP and",
    "start": "2421599",
    "end": "2436579"
  },
  {
    "text": "type again there we go so we're going to connect",
    "start": "2436579",
    "end": "2442000"
  },
  {
    "text": "from the Internet to our Active Directory botnet on the port that we've specified so it's just going to",
    "start": "2442000",
    "end": "2449080"
  },
  {
    "text": "establish a TCP connection to it immediately drops us to a prompt what",
    "start": "2449080",
    "end": "2457360"
  },
  {
    "text": "every attacker does they type dir because they want to see the listing right that's the most valuable thing",
    "start": "2457360",
    "end": "2464050"
  },
  {
    "text": "inside our organizations so you can see that again it's made that connection",
    "start": "2464050",
    "end": "2469330"
  },
  {
    "text": "that's going through ad to the X the internal bots somewhere we don't even",
    "start": "2469330",
    "end": "2474940"
  },
  {
    "text": "know where it is from the from the internal attackers are from many BOTS controllers perspective and you can see",
    "start": "2474940",
    "end": "2482110"
  },
  {
    "text": "the big dump of data up there and again we've got a remote shell through ad 2",
    "start": "2482110",
    "end": "2488290"
  },
  {
    "text": "somewhere on our internal network no matter what your network access controls are ok so how do we actually go about",
    "start": "2488290",
    "end": "2500920"
  },
  {
    "start": "2494000",
    "end": "2603000"
  },
  {
    "text": "mitigating the Active Directory botnet so as Paul was mentioning before in",
    "start": "2500920",
    "end": "2506710"
  },
  {
    "text": "terms of logging there's there's basically zero you know by default it",
    "start": "2506710",
    "end": "2512020"
  },
  {
    "text": "doesn't log updating at you know your standard user attributes because there's bet there'd be a lot of logs right so I",
    "start": "2512020",
    "end": "2520960"
  },
  {
    "text": "mean setting those that sort of logging is obviously an option separating your",
    "start": "2520960",
    "end": "2527110"
  },
  {
    "text": "domains into different security zones which I know that you know a lot of organizations especially with critical",
    "start": "2527110",
    "end": "2533920"
  },
  {
    "text": "infrastructure have multiple domains for the different critical security zones",
    "start": "2533920",
    "end": "2539050"
  },
  {
    "text": "but I've even spoken to some of them recently and they're looking at collapsing it just for management",
    "start": "2539050",
    "end": "2544630"
  },
  {
    "text": "reasons so hopefully to stop them from doing that and obviously noticing odd",
    "start": "2544630",
    "end": "2550060"
  },
  {
    "text": "values that are being pushed into your standard user attributes so you know you",
    "start": "2550060",
    "end": "2555490"
  },
  {
    "text": "start seeing your IP Phone with goods in it or your notes which is the info",
    "start": "2555490",
    "end": "2561850"
  },
  {
    "text": "attribute you know with these command and control data then that's obviously a",
    "start": "2561850",
    "end": "2568830"
  },
  {
    "text": "sign the other is that you can actually lock down your permissions for standard",
    "start": "2568830",
    "end": "2577290"
  },
  {
    "text": "users to actually update their own attributes whether you actually want to",
    "start": "2577290",
    "end": "2582570"
  },
  {
    "text": "do that or not that I don't often go and change my name in AD so thank you very",
    "start": "2582570",
    "end": "2590550"
  },
  {
    "text": "much for coming if you have any questions we're we're keen to hear your thoughts thank you",
    "start": "2590550",
    "end": "2596760"
  },
  {
    "text": "[Applause]",
    "start": "2596760",
    "end": "2605309"
  }
]