[
  {
    "start": "0",
    "end": "44000"
  },
  {
    "text": "I'm gonna go through pretty quickly because we've got a lot of content to try to chunk through we almost certainly",
    "start": "0",
    "end": "5250"
  },
  {
    "text": "won't get through it all so I'll just pump through it really quickly who we",
    "start": "5250",
    "end": "10469"
  },
  {
    "text": "are we a company called think'st for the most part people will know us because we the team behind canary and Canadian",
    "start": "10469",
    "end": "17400"
  },
  {
    "text": "oaken's I won't talk much about canary during the talk but we will touch quite a bit on Canadians because it pops up",
    "start": "17400",
    "end": "24590"
  },
  {
    "text": "something else to know is that this talk is almost entirely not my work Mako's done a huge chunk of it most of",
    "start": "24590",
    "end": "32488"
  },
  {
    "text": "the other guys at the company so other Jason Nick and Max have done the work",
    "start": "32489",
    "end": "37829"
  },
  {
    "text": "for the most part they were just kind enough to let the old guy show up and and talk about it in terms of why we",
    "start": "37829",
    "end": "45239"
  },
  {
    "start": "44000",
    "end": "152000"
  },
  {
    "text": "here there's there's a few reasons but probably the main one goes back to 2009",
    "start": "45239",
    "end": "52020"
  },
  {
    "text": "and in 2009 the big thing for us wasn't so much the inauguration of Obama it was",
    "start": "52020",
    "end": "58829"
  },
  {
    "text": "a talk we gave called clobbering the cloud and and the reason we said we were giving this talk in 2009 was I'm not",
    "start": "58829",
    "end": "66330"
  },
  {
    "text": "sure how many if you remember but back in 2009 there was a lot of cold hype and there were a lot of NT Hyper's saying",
    "start": "66330",
    "end": "72750"
  },
  {
    "text": "there's nothing new about this cloud stuff and so we were saying hey there's some stuff you should be paying",
    "start": "72750",
    "end": "78570"
  },
  {
    "text": "attention to here and and we did a whole bunch of attacks like we attacked salesforce.com and we attacked Microsoft",
    "start": "78570",
    "end": "85229"
  },
  {
    "text": "me a whole bunch of players in the space and I won't go through all of it but",
    "start": "85229",
    "end": "90360"
  },
  {
    "text": "most of it is held up pretty well so if you go to the blackhat archives it's worth checking out um I want to touch on",
    "start": "90360",
    "end": "96720"
  },
  {
    "text": "two attacks that we did what you see here if you've ever used Amazon was we",
    "start": "96720",
    "end": "102240"
  },
  {
    "text": "went through a lot of effort to try to children an ec2 instance and the reason",
    "start": "102240",
    "end": "108210"
  },
  {
    "text": "we did this in the end it required multiple attacks so we'd package up an ami and then we do something like racing",
    "start": "108210",
    "end": "114840"
  },
  {
    "text": "a.m. eyes so that it would get a low enough ami number and then we named it on s3 so it had an attractive name but",
    "start": "114840",
    "end": "121799"
  },
  {
    "text": "the end result was when someone went to Amazon's marketplace one of the first few ec2 instances they'd see would be",
    "start": "121799",
    "end": "129690"
  },
  {
    "text": "our ec2 instance and it would be an evil ec2 instance so ostensibly what would happen is you'd",
    "start": "129690",
    "end": "135349"
  },
  {
    "text": "have all these people booting up images but there were our images and part of the reason we were doing this was to say",
    "start": "135349",
    "end": "141650"
  },
  {
    "text": "that in the error of the cloud Trojans won't be Trojans Trojans could be entire",
    "start": "141650",
    "end": "147019"
  },
  {
    "text": "machines or entire systems the concept of the Trojan ship needed to change and",
    "start": "147019",
    "end": "152209"
  },
  {
    "start": "152000",
    "end": "290000"
  },
  {
    "text": "then we looked at DDoS because at the time Amazon had this thing up on their",
    "start": "152209",
    "end": "158180"
  },
  {
    "text": "screen saying they cater for dos dos attacks and instead what we did is we",
    "start": "158180",
    "end": "164299"
  },
  {
    "text": "found out that when you signed up for Amazon they'd limit you to just 20 machines but what they didn't do was",
    "start": "164299",
    "end": "171170"
  },
  {
    "text": "make sure that you couldn't use the same credit card on multiple machines so so",
    "start": "171170",
    "end": "176299"
  },
  {
    "text": "essentially what we did was we took one account and registered 20 machines and then using those 20 machines each",
    "start": "176299",
    "end": "182989"
  },
  {
    "text": "machine registered 20 machines and then just grew exponentially and you can see",
    "start": "182989",
    "end": "188510"
  },
  {
    "text": "how this works right like with even simple growth in six minutes you've got that many machines three minutes later",
    "start": "188510",
    "end": "195890"
  },
  {
    "text": "you've got that many if you're looking at about the ninth iteration you're looking at something like 800 billion",
    "start": "195890",
    "end": "202519"
  },
  {
    "text": "machines just thanks to thanks to growth but again the important thing that we",
    "start": "202519",
    "end": "209150"
  },
  {
    "text": "were going for was that you can't take AWS and say we cater for volumetric dos",
    "start": "209150",
    "end": "215030"
  },
  {
    "text": "it's a whole new system and attacks would look entirely different so",
    "start": "215030",
    "end": "220130"
  },
  {
    "text": "essentially back then what we were saying was this cloud thing is a little different and it needs slightly",
    "start": "220130",
    "end": "226310"
  },
  {
    "text": "different thinking and so now it's almost 10 years later and so we're doing a talk that says this cloud thing is",
    "start": "226310",
    "end": "233180"
  },
  {
    "text": "different and we'll need kind of different thinking and part of the",
    "start": "233180",
    "end": "238370"
  },
  {
    "text": "reason we feel we need to give this talk is you see lots of people looking at",
    "start": "238370",
    "end": "244190"
  },
  {
    "text": "cloud store and and guys look at SAS and kind of look at it as just another web",
    "start": "244190",
    "end": "249260"
  },
  {
    "text": "app or they look at infrastructure as a service and they kind of look at it as hosted Linux servers in the cloud and if",
    "start": "249260",
    "end": "256519"
  },
  {
    "text": "you're doing this you missing a whole bunch if you a defender and you still think of ec2 as hosted Linux boxes but",
    "start": "256519",
    "end": "263780"
  },
  {
    "text": "cheap or hosted Linux boxes you must huge parts of attack surface and if",
    "start": "263780",
    "end": "269150"
  },
  {
    "text": "you're an attacker if you're a pen tester and you're not spending time understanding AWS s guts there's a whole",
    "start": "269150",
    "end": "275480"
  },
  {
    "text": "bunch of fun that you're missing out on because there's a whole bunch of new opportunities and and so really quickly",
    "start": "275480",
    "end": "282710"
  },
  {
    "text": "I'm gonna blitz through some of the differences we see footprinting exploitation post exploitation and",
    "start": "282710",
    "end": "288650"
  },
  {
    "text": "persistence footprinting has almost always been undervalued and both of us",
    "start": "288650",
    "end": "294530"
  },
  {
    "start": "290000",
    "end": "372000"
  },
  {
    "text": "worked for a pentest company for a ridiculously long time and if we had a four-week pentest engagement we probably",
    "start": "294530",
    "end": "302390"
  },
  {
    "text": "spent a week and a half to two weeks just on foot printing and and that's because a large number of the companies",
    "start": "302390",
    "end": "310460"
  },
  {
    "text": "that we compromised well because we'd find that one box on a network segment that nobody was taking",
    "start": "310460",
    "end": "316520"
  },
  {
    "text": "care of or that people had forgotten and what we saying is with the current",
    "start": "316520",
    "end": "321680"
  },
  {
    "text": "layout with the current paradigm with micro services things are getting much",
    "start": "321680",
    "end": "328010"
  },
  {
    "text": "much harder to footprint and it's not just hard of to footprint the responsibility lines are gonna make",
    "start": "328010",
    "end": "334730"
  },
  {
    "text": "things ridiculously tricky so you find organizations and they might still be",
    "start": "334730",
    "end": "340070"
  },
  {
    "text": "running an exchange server they might be running office 365 or something like that in the cloud but when last when",
    "start": "340070",
    "end": "347300"
  },
  {
    "text": "last of you guys set up send mail or set set up Exim ok by and large people just",
    "start": "347300",
    "end": "353030"
  },
  {
    "text": "don't do it anymore but you can bet your developers are writing code that's sending out email notifications or",
    "start": "353030",
    "end": "359540"
  },
  {
    "text": "people are writing code that sends off sms's and text messages and all of this is happening through micro services they",
    "start": "359540",
    "end": "366560"
  },
  {
    "text": "hooked up to Tory or they hooked up to MailChimp or SendGrid or something like that and all of those micro services now",
    "start": "366560",
    "end": "374140"
  },
  {
    "start": "372000",
    "end": "480000"
  },
  {
    "text": "extend your attack surface okay and it becomes really tricky because you're not",
    "start": "374140",
    "end": "379160"
  },
  {
    "text": "really sure where the responsibility for those things live and probably the best",
    "start": "379160",
    "end": "385280"
  },
  {
    "text": "example of this or one of the really nice examples of this happened last year I'm not sure how many of you saw this so",
    "start": "385280",
    "end": "391670"
  },
  {
    "text": "white hats Anna Paul which is a white hats group in Nepal who knew uhm claimed",
    "start": "391670",
    "end": "396950"
  },
  {
    "text": "a bug bounty from uber for being able to uber emails okay and if you get a chance",
    "start": "396950",
    "end": "403040"
  },
  {
    "text": "you should go read this write-up because the guy also posted a video on how he",
    "start": "403040",
    "end": "408410"
  },
  {
    "text": "was able to read ubers mail the short version is uber were using SendGrid for",
    "start": "408410",
    "end": "415130"
  },
  {
    "text": "for their mail sending and so they see named a couple of their domains to send read and inside of SendGrid",
    "start": "415130",
    "end": "422330"
  },
  {
    "text": "they didn't claim those subdomains so another send good customer could go in and say I am that subdomain here's a web",
    "start": "422330",
    "end": "430340"
  },
  {
    "text": "hook send me those mails and send me those mail responses and SendGrid would",
    "start": "430340",
    "end": "435500"
  },
  {
    "text": "do it now it's interesting because you have to ask yourself if this was happening to your organization whether",
    "start": "435500",
    "end": "441560"
  },
  {
    "text": "you'd know about it like first would you know the stuff was leaking second whose responsibility was it to check SendGrid",
    "start": "441560",
    "end": "448550"
  },
  {
    "text": "and the easy knee-jerk answer is to say well we test all the stuff we integrate with but I'm willing to bet you can't",
    "start": "448550",
    "end": "455240"
  },
  {
    "text": "like most people find it hard enough to test all the code being dead in house now you're gonna div every API that your",
    "start": "455240",
    "end": "462380"
  },
  {
    "text": "guys interact to it um it's it's gonna be a nightmare um the video is super interesting",
    "start": "462380",
    "end": "467390"
  },
  {
    "text": "because the guy spends about half the time in the video explaining how he cut and paste to get a incoming web hook",
    "start": "467390",
    "end": "474080"
  },
  {
    "text": "walking like he clearly wasn't super sophisticated but he was reading all of opers mail um and and so the question",
    "start": "474080",
    "end": "480980"
  },
  {
    "start": "480000",
    "end": "563000"
  },
  {
    "text": "comes up would you know if it was being attacked would you know if it was compromised at this point already I want",
    "start": "480980",
    "end": "487280"
  },
  {
    "text": "to take a brief interlude to talk about something called canary tokens so canary",
    "start": "487280",
    "end": "492410"
  },
  {
    "text": "tokens is a framework a tool that we released in 2015 here at blackhat and",
    "start": "492410",
    "end": "497450"
  },
  {
    "text": "the short version is canary tokens you've been hearing about honey tokens for years canary tokens is a framework",
    "start": "497450",
    "end": "504590"
  },
  {
    "text": "to make honey tokens easy and workable essentially you go to canary tokens you",
    "start": "504590",
    "end": "509780"
  },
  {
    "text": "say here's the type of token I want I want a web bug I want a DNS bug you say",
    "start": "509780",
    "end": "515870"
  },
  {
    "text": "here's my email address not because we care about your email address you're essentially saying when you get an alert",
    "start": "515870",
    "end": "521479"
  },
  {
    "text": "send it to me at this email address and then you put in um some kind of reminder so if I was creating a web bug that I",
    "start": "521479",
    "end": "528800"
  },
  {
    "text": "wanted to hide in SendGrid somewhere I'd say send good bug it would give me a token I put it",
    "start": "528800",
    "end": "535490"
  },
  {
    "text": "into SendGrid somewhere and when an attacker tripped on it I'd get a notification saying send good web bug",
    "start": "535490",
    "end": "541520"
  },
  {
    "text": "and I'd know that there was a problem um the reason I bring up canary tokens on the one hand because more people should",
    "start": "541520",
    "end": "547970"
  },
  {
    "text": "be using it literally thousands of people use canary tokens lots of them",
    "start": "547970",
    "end": "553700"
  },
  {
    "text": "figure out they've been owned because of canary tokens it costs you nothing it's painless you really should be using it",
    "start": "553700",
    "end": "560090"
  },
  {
    "text": "and we'll give you a few instances of why you should so if we go back to this question of footprinting and go back to",
    "start": "560090",
    "end": "566330"
  },
  {
    "start": "563000",
    "end": "669000"
  },
  {
    "text": "the question of would you know you were attacked um would you know if you are compromised something that's interesting",
    "start": "566330",
    "end": "572270"
  },
  {
    "text": "is how many people today run stuff like salesforce.com and again in the old days if I was targeting your organization I'd",
    "start": "572270",
    "end": "579410"
  },
  {
    "text": "spend a lot of time trying to find out what your finance guys were running what type of OS they were running where their",
    "start": "579410",
    "end": "585770"
  },
  {
    "text": "servers were now if those guys are running on salesforce.com that's almost",
    "start": "585770",
    "end": "591860"
  },
  {
    "text": "the footprinting direction that I need to go in because if I can compromise them compromise their accounts for",
    "start": "591860",
    "end": "597590"
  },
  {
    "text": "salesforce.com I don't even need to break into your organization I get the stuff that I want off their accounts in",
    "start": "597590",
    "end": "605090"
  },
  {
    "text": "salesforce.com and the question is would you know if they were being attacked um in the cloud or on these apps and a part",
    "start": "605090",
    "end": "613160"
  },
  {
    "text": "of the reason we showed the canary token stuff is canary tokens gives you an obvious way to play with this so if you",
    "start": "613160",
    "end": "619220"
  },
  {
    "text": "look at salesforce.com and we took a really stupid example signing up for the default package you can go in and",
    "start": "619220",
    "end": "626060"
  },
  {
    "text": "customize your own home page and so all we do is we go to the Canadian site we",
    "start": "626060",
    "end": "632030"
  },
  {
    "text": "say we setting up a trap for ends salesforce.com Canary tokens gives you a",
    "start": "632030",
    "end": "638630"
  },
  {
    "text": "URL or trap URL we then go to her salesforce.com home page and create a",
    "start": "638630",
    "end": "645050"
  },
  {
    "text": "little subsection that's export all customer data export all sales data and",
    "start": "645050",
    "end": "650390"
  },
  {
    "text": "leave it there and the simple thing is that n shouldn't be touching that or ends not going to be touching that",
    "start": "650390",
    "end": "656090"
  },
  {
    "text": "because she's not exporting data but when N is compromised that's the first thing that an attack is going to do and",
    "start": "656090",
    "end": "661880"
  },
  {
    "text": "the moment they hit that link you get your canary token notification that tells you",
    "start": "661880",
    "end": "666890"
  },
  {
    "text": "something's gone wrong here so we're gonna go quickly because I see Marco",
    "start": "666890",
    "end": "672320"
  },
  {
    "start": "669000",
    "end": "869000"
  },
  {
    "text": "making a huge eyes at me for time into exploitation we're not going to touch on",
    "start": "672320",
    "end": "678200"
  },
  {
    "text": "lots of exploitation Marco we'll bump into it again but something that's interesting with the new types of",
    "start": "678200",
    "end": "683600"
  },
  {
    "text": "frameworks that we're looking at is that attacks and exploits don't look like they used to um you are seeing devices",
    "start": "683600",
    "end": "691160"
  },
  {
    "text": "getting harder but boundaries are getting fuzzier and fuzzier um we gave a talk a few years back where we spoke",
    "start": "691160",
    "end": "697070"
  },
  {
    "text": "about the Bob Eppolito problem which essentially is the fact that there's a guy called Bobby Polito who is the",
    "start": "697070",
    "end": "704390"
  },
  {
    "text": "author and maintainer of simple Jason and so he logs him to the Python repository using his single factor",
    "start": "704390",
    "end": "710810"
  },
  {
    "text": "authentication and makes a change to simple jason and literally squillions of people around the world all depend on",
    "start": "710810",
    "end": "717170"
  },
  {
    "text": "that simple json package it's a dependency that most people have that they don't know they have and for",
    "start": "717170",
    "end": "722420"
  },
  {
    "text": "those of you who remember the left pad problem which killed so many JavaScript and node repositories you know the",
    "start": "722420",
    "end": "729740"
  },
  {
    "text": "effects of that so what we did was we started looking at on for tools we were",
    "start": "729740",
    "end": "735260"
  },
  {
    "text": "using that had strange vulnerabilities like this how many of you here use Atem as an editor there's a few hands so we",
    "start": "735260",
    "end": "743750"
  },
  {
    "text": "use atom pretty heavily at the office people like it because if using Chromebooks you can run it with crouton",
    "start": "743750",
    "end": "749540"
  },
  {
    "text": "it's made by the guys at github so it's all new age but what's interesting about",
    "start": "749540",
    "end": "754870"
  },
  {
    "text": "Adam is Adams got a plug-in architecture okay so guys write plugins put these",
    "start": "754870",
    "end": "761180"
  },
  {
    "text": "plugins up on github this work by the way is done by the good-looking guy in the bottom corner so so next the one who",
    "start": "761180",
    "end": "767420"
  },
  {
    "text": "owned Adam so Adam allows you to run plug-ins guys write plugins put them on github you",
    "start": "767420",
    "end": "773990"
  },
  {
    "text": "also notice some sort of social feature there so it tells you how many times this plug-in has been installed and of",
    "start": "773990",
    "end": "781010"
  },
  {
    "text": "course the easy answer is you can just write evil plugins and put them up and",
    "start": "781010",
    "end": "786050"
  },
  {
    "text": "wait till people download them plugins can be non-trivial and completely ridiculously trivial so there's a",
    "start": "786050",
    "end": "792770"
  },
  {
    "text": "plug-in that allows you to cut and paste straight from Stack Overflow so if you don't know what you're doing you can",
    "start": "792770",
    "end": "798560"
  },
  {
    "text": "have your editor read Stack Overflow of for you but in our case what we did is we went for to show that two things were",
    "start": "798560",
    "end": "805640"
  },
  {
    "text": "possible and what you see here is with this with this plug-in running an atom",
    "start": "805640",
    "end": "811430"
  },
  {
    "text": "everything that the guy writes essentially gets ferreted off via this plug in to one of our servers now the",
    "start": "811430",
    "end": "818450"
  },
  {
    "text": "thing the reason we bring this up the the the thing that you should be pondering is there's no memory corruption exploit there's no attack on",
    "start": "818450",
    "end": "825560"
  },
  {
    "text": "the underlying OS essentially his editor is the thing that's causing him to be",
    "start": "825560",
    "end": "830660"
  },
  {
    "text": "compromised in this instance and if you are stealing the guy's keystrokes you",
    "start": "830660",
    "end": "836960"
  },
  {
    "text": "can just as easily go to the next point and actually still have him execute code",
    "start": "836960",
    "end": "843740"
  },
  {
    "text": "so on our server we can put down commands his plug-in pulls down the command runs it locally and then sends",
    "start": "843740",
    "end": "850610"
  },
  {
    "text": "you back the data um the atom guys don't curate these plugins at all so the",
    "start": "850610",
    "end": "856970"
  },
  {
    "text": "plugins that your users run are almost completely arbitrary and I'm guessing you've got no way to restrict them um",
    "start": "856970",
    "end": "862880"
  },
  {
    "text": "the fact that atom runs on Chromebook with a little bit of effort is also interesting post exploitation I'll move",
    "start": "862880",
    "end": "870980"
  },
  {
    "start": "869000",
    "end": "1039000"
  },
  {
    "text": "to really quickly something that happens a lot someone compromises someone then uses",
    "start": "870980",
    "end": "876530"
  },
  {
    "text": "that compromise to read all the emails it's interesting because pen testers do it a little bit but in the wild",
    "start": "876530",
    "end": "882500"
  },
  {
    "text": "attackers do it a lot like I've seen organizations that get completely undone because someone was able to read their",
    "start": "882500",
    "end": "888560"
  },
  {
    "text": "mail and essentially that's just a login to OA and again it's one of those things that people don't know how to defend or",
    "start": "888560",
    "end": "895370"
  },
  {
    "text": "detect against again we pitch for canary tokens again using the web bug so a",
    "start": "895370",
    "end": "901310"
  },
  {
    "text": "really simple one is create a token create an email or have someone send you an email saying hey the passwords are",
    "start": "901310",
    "end": "908270"
  },
  {
    "text": "here or the server is here leave it in your inbox and the day that goes wrong you're getting it an email telling you",
    "start": "908270",
    "end": "914420"
  },
  {
    "text": "somebody's looked at this um if you guys haven't looked at it there's a really nice Twitter account called tabletop",
    "start": "914420",
    "end": "920780"
  },
  {
    "text": "scenarios where Ryan McGeehan essentially puts out puts out scenarios",
    "start": "920780",
    "end": "926180"
  },
  {
    "text": "to check whether for you to check whether you'd be able to handle that in your org and Ryan put this one out a",
    "start": "926180",
    "end": "932090"
  },
  {
    "text": "little while back saying you I mean some sort of chat which I guess you can infer to be IRC slack or hip",
    "start": "932090",
    "end": "938660"
  },
  {
    "text": "chat and he says you notice that messages are disappearing or getting sucked up by an attacker from your slack",
    "start": "938660",
    "end": "944779"
  },
  {
    "text": "how would you respond to that and most of you who are running slack or HipChat should go a little cold here because",
    "start": "944779",
    "end": "950660"
  },
  {
    "text": "almost no one I know has a good solution for it but Allen Jones then reached out to him with the question saying how",
    "start": "950660",
    "end": "957260"
  },
  {
    "text": "would you detect that someone was doing this to your slack and between the both of them they agreed that actually",
    "start": "957260",
    "end": "963110"
  },
  {
    "text": "there's no way that they can think of to do this which of course is a perfect segue for me to say canary tokens again",
    "start": "963110",
    "end": "970519"
  },
  {
    "text": "and essentially what we do here is aside",
    "start": "970519",
    "end": "975529"
  },
  {
    "text": "from just getting a URL from Canadia tokens you can upload an image to us and say give me this image as a token which",
    "start": "975529",
    "end": "983269"
  },
  {
    "text": "is what we're doing there we've uploaded one called my password we mention it in the chatroom and essentially every time",
    "start": "983269",
    "end": "989959"
  },
  {
    "text": "someone accesses my password we'll get a message telling us that it's been accessed but what you would have seen in",
    "start": "989959",
    "end": "996769"
  },
  {
    "text": "that picture the stupid thing is if I post it today I've got to tell everyone today hey please don't click on this and",
    "start": "996769",
    "end": "1003279"
  },
  {
    "text": "it's kind of purpose defeating so what you can do just as easily is go into your own history going to three months",
    "start": "1003279",
    "end": "1010540"
  },
  {
    "text": "ago and put in some sort of key word so go in there and say 2018 projections or",
    "start": "1010540",
    "end": "1016000"
  },
  {
    "text": "2018 salaries there's no reason for somebody to go back and read that stuff but what happens is when an attacker",
    "start": "1016000",
    "end": "1022990"
  },
  {
    "text": "compromises someone in your org he now searches for that key word so he",
    "start": "1022990",
    "end": "1028178"
  },
  {
    "text": "searches for passwords or searches for 2018 projections finds the URL and you",
    "start": "1028179",
    "end": "1034390"
  },
  {
    "text": "get your message to tell you that bad stuff is happening so when we talk about",
    "start": "1034390",
    "end": "1040209"
  },
  {
    "start": "1039000",
    "end": "1134000"
  },
  {
    "text": "persistence what we're seeing a lot over where we think the stuff is going to go is lots of this is going to be localized",
    "start": "1040209",
    "end": "1046600"
  },
  {
    "text": "to the app itself meaning if I compromised your Gmail I set up a gmail forwarding rule so that the stuff comes",
    "start": "1046600",
    "end": "1053590"
  },
  {
    "text": "to me I enable API access and then access you via the API afterwards and",
    "start": "1053590",
    "end": "1059679"
  },
  {
    "text": "the last thing that we think is interesting is almost the revival of self XSS for those of you are doing pen",
    "start": "1059679",
    "end": "1066820"
  },
  {
    "text": "testing you know if you can find XSS it's an okay finding but if",
    "start": "1066820",
    "end": "1071870"
  },
  {
    "text": "the guy can only XSS himself it's kind of weak and we when we did our",
    "start": "1071870",
    "end": "1077960"
  },
  {
    "text": "presentation in 2009 we showed an instance where self XSS is actually useful so what we did is we compromised",
    "start": "1077960",
    "end": "1085130"
  },
  {
    "text": "someone's MobileMe account and what we found is if I compromised your mobile me",
    "start": "1085130",
    "end": "1090290"
  },
  {
    "text": "I could then register my iPhone to your mobile me which sounds pretty stupid but",
    "start": "1090290",
    "end": "1097700"
  },
  {
    "text": "what's interesting is we could name our iPhone JavaScript and then register our",
    "start": "1097700",
    "end": "1103580"
  },
  {
    "text": "iPhone with your mobile me which means that every time you log in to your mobile me it tries to show you my iPhone",
    "start": "1103580",
    "end": "1110120"
  },
  {
    "text": "runs my JavaScript and my JavaScript effectively controls what you see in",
    "start": "1110120",
    "end": "1115550"
  },
  {
    "text": "your mobile me it's interesting just because it moves persistence and",
    "start": "1115550",
    "end": "1120950"
  },
  {
    "text": "rootkits to app specific app specific stuff you",
    "start": "1120950",
    "end": "1126110"
  },
  {
    "text": "can't talk about cloud stuff without talking about the gorilla in the room so I will leave you with our gorilla in the",
    "start": "1126110",
    "end": "1131990"
  },
  {
    "text": "room so the obvious gorilla in the room is gonna be AWS Amazon Web Services one",
    "start": "1131990",
    "end": "1140390"
  },
  {
    "start": "1134000",
    "end": "1183000"
  },
  {
    "text": "of the reasons we looked at it is we use it heavily and and so a large part of what I'm gonna talk about now is things",
    "start": "1140390",
    "end": "1146390"
  },
  {
    "text": "that really occupied our thought because we based a large part of our business on AWS and it really frightens it frightens",
    "start": "1146390",
    "end": "1153980"
  },
  {
    "text": "me a lot to think how we might get taken so looking back at 2009 as H was saying",
    "start": "1153980",
    "end": "1159290"
  },
  {
    "text": "we used to think of at least our view and that previous talk was a bunch of hosted virtual machines and a bunch of",
    "start": "1159290",
    "end": "1166910"
  },
  {
    "text": "hosted virtual machines is quite similar to a data center full of actual hardware and you kind of know how to protect that",
    "start": "1166910",
    "end": "1173180"
  },
  {
    "text": "stuff and so you can just distribute honey pods for example if that's your thing but we know how to handle actual",
    "start": "1173180",
    "end": "1179860"
  },
  {
    "text": "data centers but sort of with Amazon and with actual cloud-based services things",
    "start": "1179860",
    "end": "1187130"
  },
  {
    "text": "have changed so it's not just about hosted virtual machines obviously this is Amazon's reference implementation to",
    "start": "1187130",
    "end": "1193520"
  },
  {
    "text": "deploy WordPress in AWS and it touches nine different AWS services one of which",
    "start": "1193520",
    "end": "1200450"
  },
  {
    "text": "is a virtual machine so there's a whole bunch of complexity that's coming to the fore and if you thought that Active",
    "start": "1200450",
    "end": "1206390"
  },
  {
    "text": "Directory was complex and if you sort of wrapping your mind around ad security now this AWS right is just getting",
    "start": "1206390",
    "end": "1214760"
  },
  {
    "text": "started and there's a whole bunch of complexity here to give you a sense of that complexity we thought we'd measure",
    "start": "1214760",
    "end": "1221299"
  },
  {
    "start": "1219000",
    "end": "1238000"
  },
  {
    "text": "it in terms of function so if you take G Lipsy so the new let's see the number of",
    "start": "1221299",
    "end": "1226850"
  },
  {
    "text": "exported functions is roughly about 800 the same thing on AWS in terms of public",
    "start": "1226850",
    "end": "1233000"
  },
  {
    "text": "APRs you're looking at over 3,000 so there's a big jump in the complexity there we can do something similar if we",
    "start": "1233000",
    "end": "1239419"
  },
  {
    "start": "1238000",
    "end": "1290000"
  },
  {
    "text": "look at permissions on Windows or on Linux you're going to look at permissions across file systems and",
    "start": "1239419",
    "end": "1245270"
  },
  {
    "text": "processes in the order of tens of permissions in AWS you're looking at almost two and a half thousand different",
    "start": "1245270",
    "end": "1251299"
  },
  {
    "text": "permissions that can be assigned so this really is a different kind of thing it's a different beast so I might even say",
    "start": "1251299",
    "end": "1257440"
  },
  {
    "text": "fantastic beasts so this needs fresh look and similar to those steps that",
    "start": "1257440",
    "end": "1264559"
  },
  {
    "text": "húrin went through I'm gonna go through some of these but specifically on AWS I want to mention Daniel Griz lack if I",
    "start": "1264559",
    "end": "1272450"
  },
  {
    "text": "pronounced that right who's done a bunch of work in this space before but he's one of the few people looking at AWS and",
    "start": "1272450",
    "end": "1279320"
  },
  {
    "text": "AWS security and there's not a lot of other work that's happening in this space and so we'll go through a few of",
    "start": "1279320",
    "end": "1285470"
  },
  {
    "text": "these phases and look at options that we are afraid of that places that we might get taken and the first one is recon or",
    "start": "1285470",
    "end": "1292309"
  },
  {
    "text": "footprint team it's the thing that hirin spoke about has been primarily not",
    "start": "1292309",
    "end": "1299299"
  },
  {
    "text": "addressed and so it's the thing that we're going to start with the first part",
    "start": "1299299",
    "end": "1306260"
  },
  {
    "text": "of this if you're going to be conducting recon is to find account IDs alright and this is really the basis so an Amazon",
    "start": "1306260",
    "end": "1312649"
  },
  {
    "text": "account ID is quite key to lots of the types of attacks that we think about and",
    "start": "1312649",
    "end": "1318169"
  },
  {
    "text": "these account IDs are they're not considered secret but they are considered private so Amazon doesn't",
    "start": "1318169",
    "end": "1323899"
  },
  {
    "text": "suggest that you share them necessarily the numbers just a 12 digit number so there's a trillion of them and so",
    "start": "1323899",
    "end": "1329899"
  },
  {
    "text": "there's a very simple enumeration attack right so you can start incrementing your you can start incrementing those account",
    "start": "1329899",
    "end": "1337100"
  },
  {
    "text": "numbers if you choose and you can find valid account numbers but the way that that's gonna work is we would start with",
    "start": "1337100",
    "end": "1347120"
  },
  {
    "text": "a an API call that will basically let us detective and account number is valid or",
    "start": "1347120",
    "end": "1353210"
  },
  {
    "text": "not and so this is pretty basic enumeration stuff this is one particular call there's a bunch of them if you make",
    "start": "1353210",
    "end": "1358909"
  },
  {
    "text": "this call with an invalid account ID you get a response like that the same call with a valid account ID you get a",
    "start": "1358909",
    "end": "1364879"
  },
  {
    "text": "different response so based on that one distinguish a we can figure out if account IDs are valid or not and that",
    "start": "1364879",
    "end": "1373009"
  },
  {
    "start": "1373000",
    "end": "1409000"
  },
  {
    "text": "totally works but it's just really slow right there's a search space of a trillion Possible's and so we started at",
    "start": "1373009",
    "end": "1380750"
  },
  {
    "text": "1 we were trying to get a sense of the the spread of account IDs we started with one which was valid we incremented",
    "start": "1380750",
    "end": "1386389"
  },
  {
    "text": "it and so we found the next valid one and the gap there was about 32 okay so there are large gaps it's what you would",
    "start": "1386389",
    "end": "1392870"
  },
  {
    "text": "expect if it's randomly distributed and we pulled if we created a bunch of accounts and sort of couldn't see any",
    "start": "1392870",
    "end": "1399399"
  },
  {
    "text": "correlation between the IDS so if we agree then that it's going to be really slow to enumerate all those account IDs",
    "start": "1399399",
    "end": "1407179"
  },
  {
    "text": "how else might we find some and like it's the internet there developers and",
    "start": "1407179",
    "end": "1412190"
  },
  {
    "start": "1409000",
    "end": "1460000"
  },
  {
    "text": "other folks in general you'll find that stuff if you just go looking for it right so on the AWS forums people post",
    "start": "1412190",
    "end": "1419240"
  },
  {
    "text": "their account IDs all the time you'll find them in github repo Stack Overflow posts there on paceman in general people",
    "start": "1419240",
    "end": "1426379"
  },
  {
    "text": "don't seem to hold on to those account IDs particularly tightly and it's not that surprising and as I said Amazon",
    "start": "1426379",
    "end": "1433070"
  },
  {
    "text": "advised you to not post these on their forums but in the Amazon in their UI and",
    "start": "1433070",
    "end": "1440360"
  },
  {
    "text": "also through the API you can list EMIs and amazon will show you the account IDs who owned all of those a.m.",
    "start": "1440360",
    "end": "1447110"
  },
  {
    "text": "eyes so it's it's it's quite easy to pull out lists of those account owners",
    "start": "1447110",
    "end": "1452779"
  },
  {
    "text": "so that gets us access to a whole pile of account IDs somewhere in the order of about 3000 there's another option for",
    "start": "1452779",
    "end": "1459950"
  },
  {
    "text": "this which is interesting and it's something that we've only hit very recently so it's a thread that still",
    "start": "1459950",
    "end": "1465830"
  },
  {
    "text": "needs pulling but you can set up an three bucket which has both logging",
    "start": "1465830",
    "end": "1471290"
  },
  {
    "text": "enabled and it's limited to AWS users and for an s3 bucket in that state if",
    "start": "1471290",
    "end": "1477680"
  },
  {
    "text": "you can get someone to browse the bucket through the Amazon console you'll get access to their account ID and actually",
    "start": "1477680",
    "end": "1484100"
  },
  {
    "text": "their username as well but that's something that needs more pulling I'm just going to mention it there so if",
    "start": "1484100",
    "end": "1491690"
  },
  {
    "start": "1490000",
    "end": "1519000"
  },
  {
    "text": "we're talking about s3 the there's a well-known insecurity and s3 which is s3",
    "start": "1491690",
    "end": "1497600"
  },
  {
    "text": "buckets discovery so the idea here is that there are a bunch of s3 buckets and",
    "start": "1497600",
    "end": "1503210"
  },
  {
    "text": "one of the features of s3 buckets s3 is Amazon storage service and it's a place",
    "start": "1503210",
    "end": "1508790"
  },
  {
    "text": "that you can dump files effectively and have them referenced from other web sites plus a whole bunch of other things",
    "start": "1508790",
    "end": "1515900"
  },
  {
    "text": "but that's the essence of it and say if people store files on s3 they can't",
    "start": "1515900",
    "end": "1522110"
  },
  {
    "start": "1519000",
    "end": "1582000"
  },
  {
    "text": "store them in a way that the files are accessible to anyone on the internet so",
    "start": "1522110",
    "end": "1527270"
  },
  {
    "text": "they're not protected and they don't require authentication and if that's the case that files aren't protected then",
    "start": "1527270",
    "end": "1535160"
  },
  {
    "text": "you can basically go looking for open buckets and download lots and lots of content and those buckets are just they",
    "start": "1535160",
    "end": "1541790"
  },
  {
    "text": "have a unique name assigned to them so it's a question of guessing possible bucket names which you can start with",
    "start": "1541790",
    "end": "1548090"
  },
  {
    "text": "domain names or you can look on websites to see if they're referenced a s3 buckets and as I said this has got a",
    "start": "1548090",
    "end": "1553850"
  },
  {
    "text": "whole bunch of attention so recently there was a case where a defense contractor left a whole bunch of",
    "start": "1553850",
    "end": "1559190"
  },
  {
    "text": "classified info on an open s3 bucket I managed to embarrass his company and",
    "start": "1559190",
    "end": "1564340"
  },
  {
    "text": "this has been like there's a whole bunch of work that's already been done in this space the reason that I'm touching on",
    "start": "1564340",
    "end": "1570680"
  },
  {
    "text": "the s3 bucket the open s3 buckets is because there are similar services in",
    "start": "1570680",
    "end": "1575720"
  },
  {
    "text": "Amazon that can also be left in an open State I'm similar to the s3 bucket and one of",
    "start": "1575720",
    "end": "1580850"
  },
  {
    "text": "those is the sqs service the simple the simple queue service on AWS",
    "start": "1580850",
    "end": "1587450"
  },
  {
    "start": "1582000",
    "end": "1611000"
  },
  {
    "text": "so SQS allows you to create a queue a programmatic queue the thing that you put objects on and take objects off your",
    "start": "1587450",
    "end": "1594140"
  },
  {
    "text": "an API and the queue is addressed via a URL like it's a web access of",
    "start": "1594140",
    "end": "1599640"
  },
  {
    "text": "or URL and these cues can be configured to be open to the world so there's like",
    "start": "1599640",
    "end": "1605190"
  },
  {
    "text": "a checkbox that you hit and now anyone can hit anyone can access that queue and",
    "start": "1605190",
    "end": "1611160"
  },
  {
    "start": "1611000",
    "end": "1651000"
  },
  {
    "text": "what makes you a queue URL unique is a combination of the account ID plus the",
    "start": "1611160",
    "end": "1617310"
  },
  {
    "text": "name that's been given to that queue by the account owner we already have a bunch of account IDs right so we've",
    "start": "1617310",
    "end": "1622500"
  },
  {
    "text": "already got our 3,000 account IDs in terms of queue names what we need to do",
    "start": "1622500",
    "end": "1628620"
  },
  {
    "text": "here is we need to start guessing queue names and our options are we can guess names like test test queue look at",
    "start": "1628620",
    "end": "1634350"
  },
  {
    "text": "various samples of code and see if people are cutting and pasting code they're likely to keep queue names or",
    "start": "1634350",
    "end": "1640770"
  },
  {
    "text": "again you can head to the AWS forums and see what people are posting there and",
    "start": "1640770",
    "end": "1646860"
  },
  {
    "text": "you'll find reference to queue URLs that look quite quite useful so a potential",
    "start": "1646860",
    "end": "1652230"
  },
  {
    "start": "1651000",
    "end": "1707000"
  },
  {
    "text": "queue URL might look something like this and as you can see so the whole row of",
    "start": "1652230",
    "end": "1657810"
  },
  {
    "text": "X's on the second row on the Left that that's where you would put an account ID and after that comes the",
    "start": "1657810",
    "end": "1664380"
  },
  {
    "text": "queue name and again this is a pretty basic enumeration attack we went through",
    "start": "1664380",
    "end": "1669810"
  },
  {
    "text": "this we found open queues we found queues referenced in AWS forums that will also",
    "start": "1669810",
    "end": "1675540"
  },
  {
    "text": "open queues and at that point if those queues are production queues you've now got you've got insight into production",
    "start": "1675540",
    "end": "1683040"
  },
  {
    "text": "data I will point out that we didn't find a lot of it so it's not it's not an",
    "start": "1683040",
    "end": "1688110"
  },
  {
    "text": "issue with the same prevalence as open s3 buckets but the question for you is if you're running sqs how are you going",
    "start": "1688110",
    "end": "1695460"
  },
  {
    "text": "to figure out whether your queues are open it's that it's that part of the",
    "start": "1695460",
    "end": "1700500"
  },
  {
    "text": "cloud stuff that becomes for me quite frightening given that we run some of these services and we don't have a",
    "start": "1700500",
    "end": "1705720"
  },
  {
    "text": "handle on it so if we then turn our attention to compromise again this has received a bunch of attention one of the",
    "start": "1705720",
    "end": "1711840"
  },
  {
    "start": "1707000",
    "end": "1788000"
  },
  {
    "text": "main ones has been around credentials and API keys so I'm going to go through it pretty quickly credentials often get",
    "start": "1711840",
    "end": "1718050"
  },
  {
    "text": "or if you're going to steal root credentials it's an email address and a password that's a phishing attack the",
    "start": "1718050",
    "end": "1723570"
  },
  {
    "text": "API keys are the more interesting one and it's the thing you've probably seen before so the idea here is that someone",
    "start": "1723570",
    "end": "1729870"
  },
  {
    "text": "takes an API key which gives you access to as an API and the keys are left either",
    "start": "1729870",
    "end": "1735390"
  },
  {
    "text": "in a github repo or they're embedded in a mobile application which gets",
    "start": "1735390",
    "end": "1740670"
  },
  {
    "text": "disassembled and the key gets recovered so the idea of these long-lived API keys",
    "start": "1740670",
    "end": "1745830"
  },
  {
    "text": "is problematic an ape and Amazon looked to address it through temporary keys so",
    "start": "1745830",
    "end": "1751050"
  },
  {
    "text": "the idea here with temporary keys is that your keys are only going to be valid for some fixed period of time so",
    "start": "1751050",
    "end": "1756750"
  },
  {
    "text": "that could be six hours or a few days at most and the way that those keys get used is",
    "start": "1756750",
    "end": "1762390"
  },
  {
    "text": "that you would take an ec2 instance and assign a role to it right but this means",
    "start": "1762390",
    "end": "1767520"
  },
  {
    "text": "that you can't embed keys inside of an application or you can't embed them inside of your source code so this is",
    "start": "1767520",
    "end": "1773160"
  },
  {
    "text": "definitely a step up the one thing to point out with the temporary keys though is that there's nothing that ties a temporary key to the instance that was",
    "start": "1773160",
    "end": "1781110"
  },
  {
    "text": "granted the key so if you can steal those keys that can be used elsewhere there's no limitation on how the keys",
    "start": "1781110",
    "end": "1786510"
  },
  {
    "text": "are used and there's one other aspect of authorizer or authentication that I'll",
    "start": "1786510",
    "end": "1792360"
  },
  {
    "start": "1788000",
    "end": "1818000"
  },
  {
    "text": "touch on which is identity documents and this is something I haven't seen referenced previously but there is a way",
    "start": "1792360",
    "end": "1798570"
  },
  {
    "text": "that you can authenticate to the Amazon API using a particular authentication token called an identity document it",
    "start": "1798570",
    "end": "1805230"
  },
  {
    "text": "does only work in cloud formation so if you know AWS you'll know cloud formation but it is just a sort of an curiosity",
    "start": "1805230",
    "end": "1812700"
  },
  {
    "text": "you don't always need aid API keys to hit the API so if we're still looking at",
    "start": "1812700",
    "end": "1819720"
  },
  {
    "start": "1818000",
    "end": "1869000"
  },
  {
    "text": "the ways that we might be compromised and and this is one of the ways that concerns me you can share without too",
    "start": "1819720",
    "end": "1826800"
  },
  {
    "text": "many restrictions resources between particular resources between Amazon accounts and one of those are am i right",
    "start": "1826800",
    "end": "1834030"
  },
  {
    "text": "so the actual the image of a virtual machine which you would boot up so typically you would create an ami that",
    "start": "1834030",
    "end": "1840140"
  },
  {
    "text": "captures the kind of instance that you'll run frequently and you you can",
    "start": "1840140",
    "end": "1846150"
  },
  {
    "text": "have a library of those a mis but you can also share those a mis with other people and Amazon places no limits on",
    "start": "1846150",
    "end": "1852720"
  },
  {
    "text": "who you share worth or from what we've seen how many times you can share an ami",
    "start": "1852720",
    "end": "1857970"
  },
  {
    "text": "so we've got a mis we've shared with our 3,000 accounts haven't hit any limits",
    "start": "1857970",
    "end": "1863550"
  },
  {
    "text": "there and the thing that concerns me with with the shared a.m. eyes is that from a victim's perspective the ami",
    "start": "1863550",
    "end": "1871700"
  },
  {
    "start": "1869000",
    "end": "1908000"
  },
  {
    "text": "shows up in their private lists and they've got no way of removing it from that list so that ami once it's there",
    "start": "1871700",
    "end": "1877970"
  },
  {
    "text": "you can't remove it you don't get notified that it was put there and you don't get you don't have to accept it so",
    "start": "1877970",
    "end": "1883070"
  },
  {
    "text": "the attacker can effectively either target you specifically with a name that",
    "start": "1883070",
    "end": "1888470"
  },
  {
    "text": "is you get to name the ami sand so they can provide a name that's particular to your organization or they can provide a",
    "start": "1888470",
    "end": "1895130"
  },
  {
    "text": "generic name like Amazon Linux Preview 2018 or something like that and hope someone runs it and at that",
    "start": "1895130",
    "end": "1902060"
  },
  {
    "text": "point they've got code running in your organization your organization but with",
    "start": "1902060",
    "end": "1909380"
  },
  {
    "text": "code running in an organization one of the questions that will occur is what permissions does any given set of",
    "start": "1909380",
    "end": "1914660"
  },
  {
    "text": "credentials have and as I said there's two and a half thousand almost two and a",
    "start": "1914660",
    "end": "1920600"
  },
  {
    "text": "half thousand permissions 3,000 API calls determining if a particular key",
    "start": "1920600",
    "end": "1926120"
  },
  {
    "text": "has got access to all of those calls is easy if you've got access to the call which is show me my policy so if you can",
    "start": "1926120",
    "end": "1933440"
  },
  {
    "text": "list your policy which is effectively your permissions then it's easy to determine what you can and can't do but",
    "start": "1933440",
    "end": "1940070"
  },
  {
    "text": "if you don't have access to that all is not lost the simple approach here in the",
    "start": "1940070",
    "end": "1945170"
  },
  {
    "text": "I'm gonna give you the sort of run-through of the approach which is let's try all 3,000 API calls and see",
    "start": "1945170",
    "end": "1950660"
  },
  {
    "text": "which one succeed and if they don't succeed well we know we don't have access and if they do succeed we have access so it's quite easy to also",
    "start": "1950660",
    "end": "1956510"
  },
  {
    "text": "enumerate the permissions even if you don't have access to the policy document",
    "start": "1956510",
    "end": "1962200"
  },
  {
    "start": "1962000",
    "end": "1988000"
  },
  {
    "text": "the one thing I'll point out here is that when we when we do that permissions enumeration lots of those calls actually",
    "start": "1962200",
    "end": "1969830"
  },
  {
    "text": "have side effects so you can't call terminate instance or delete s3 bucket",
    "start": "1969830",
    "end": "1974840"
  },
  {
    "text": "because you're going to be wiping stuff that may be sensitive instead what we do",
    "start": "1974840",
    "end": "1980450"
  },
  {
    "text": "is we limit it to any of those api's that don't have any side effects there's there's some particulars about the tool",
    "start": "1980450",
    "end": "1986060"
  },
  {
    "text": "where we brute force parameters which make it interesting to write but the some of it is we call 888",
    "start": "1986060",
    "end": "1994900"
  },
  {
    "start": "1988000",
    "end": "2006000"
  },
  {
    "text": "is curious right so the next step then",
    "start": "1998780",
    "end": "2009490"
  },
  {
    "start": "2006000",
    "end": "2033000"
  },
  {
    "text": "is going to be lateral movement again Daniel drew zelich had some work on",
    "start": "2009490",
    "end": "2015030"
  },
  {
    "text": "running scripts inside of instances but the the some of it of his particular",
    "start": "2015030",
    "end": "2021490"
  },
  {
    "text": "approach was that you have to stop and start instances in order to run shell script on those instances we took a stab",
    "start": "2021490",
    "end": "2027730"
  },
  {
    "text": "at seeing if we could make this happen without having to stop and start instances and the answer is you can so",
    "start": "2027730",
    "end": "2033490"
  },
  {
    "start": "2033000",
    "end": "2070000"
  },
  {
    "text": "does anyone here use cloud formation by any chance show hands so there's people here who are using cloud formation if",
    "start": "2033490",
    "end": "2040180"
  },
  {
    "text": "you using cloud formation the thing that it turns out so cloud formation real quickly is Amazon's one of the",
    "start": "2040180",
    "end": "2045940"
  },
  {
    "text": "orchestration technologies you can set up a template file which has a whole bunch of resources in it and then deploy",
    "start": "2045940",
    "end": "2052840"
  },
  {
    "text": "it as a chunk so you can say deploy WordPress with a security group and an elastic IP and all of these other",
    "start": "2052840",
    "end": "2059350"
  },
  {
    "text": "resources in one go and you can back them out at the same time so you can delete a stack and have all of that",
    "start": "2059350",
    "end": "2065110"
  },
  {
    "text": "stuff removed in one shot and so what it means is that these things all happen",
    "start": "2065110",
    "end": "2071169"
  },
  {
    "start": "2070000",
    "end": "2120000"
  },
  {
    "text": "through these cloud formation templates and it turns out that those template files can be easily modified so if you",
    "start": "2071169",
    "end": "2079120"
  },
  {
    "text": "have a run in cloud formation stack you can take you can pull down the template file for that stack modify it redeploy",
    "start": "2079120",
    "end": "2085540"
  },
  {
    "text": "the template and the whole thing executes again and that includes in this",
    "start": "2085540",
    "end": "2091030"
  },
  {
    "text": "example we've included some shell script that runs from the template in order to",
    "start": "2091030",
    "end": "2096220"
  },
  {
    "text": "do this you need to have permission to reapply a CloudFormation template but",
    "start": "2096220",
    "end": "2102460"
  },
  {
    "text": "it's not different from actually to point a new template so again coming back to how would you figure this out if",
    "start": "2102460",
    "end": "2107860"
  },
  {
    "text": "you're looking in your logs in your cloud trail logs there's not going to be a big sign saying someone's change of",
    "start": "2107860",
    "end": "2114490"
  },
  {
    "text": "cloud formation you're just gonna see a new change set which is what you would see on a fresh deploy as well but",
    "start": "2114490",
    "end": "2120850"
  },
  {
    "start": "2120000",
    "end": "2166000"
  },
  {
    "text": "there's more to cloud formation and so if we so what I've just spoken about is actually modifying a template itself but",
    "start": "2120850",
    "end": "2129490"
  },
  {
    "text": "there's because cloud formation is now a new this orchestration layer with a new template in language we have to see if",
    "start": "2129490",
    "end": "2136569"
  },
  {
    "text": "this template in language also has potential issues and what we've got here is Facebook's default app there the",
    "start": "2136569",
    "end": "2144280"
  },
  {
    "text": "sample app for cloud formation and this thing is basically trivially vulnerable to injection if you allow untrusted",
    "start": "2144280",
    "end": "2152020"
  },
  {
    "text": "parameters into the template note I'm not saying if you allow someone to change the template itself just if you",
    "start": "2152020",
    "end": "2157089"
  },
  {
    "text": "allow untrusted parameters into the template this particular CloudFormation file and will leave you vulnerable and",
    "start": "2157089",
    "end": "2163569"
  },
  {
    "text": "again how are you going to know about this in terms of lateral movement I'll talk about one other option which is",
    "start": "2163569",
    "end": "2169359"
  },
  {
    "start": "2166000",
    "end": "2189000"
  },
  {
    "text": "simple system management SSM in short this lets you well this is Amazon",
    "start": "2169359",
    "end": "2175240"
  },
  {
    "text": "solution for monitoring multiple servers across data centers not just an ec2 so",
    "start": "2175240",
    "end": "2180369"
  },
  {
    "text": "if you're a pen tester and you see SSM enabled like happy days you can enjoy it by design it lets you run commands on",
    "start": "2180369",
    "end": "2186790"
  },
  {
    "text": "the machines that it manages so we then look at privilege escalation I'm gonna",
    "start": "2186790",
    "end": "2192210"
  },
  {
    "start": "2189000",
    "end": "2198000"
  },
  {
    "text": "not talk too much about I am like I am if you've got access to it you can do anything in an account the same for",
    "start": "2192210",
    "end": "2199510"
  },
  {
    "text": "roles so like there's a whole separate discussion on roles which we're not going to include here but roles are",
    "start": "2199510",
    "end": "2204670"
  },
  {
    "text": "always useful the one thing that I want to touch on with privilege escalation is the idea of tag creation so there's this",
    "start": "2204670",
    "end": "2210760"
  },
  {
    "text": "pattern in I am policy's permission building in which resources get tags so",
    "start": "2210760",
    "end": "2216640"
  },
  {
    "text": "you can tag an instance with the dev environment tag or you can give it an owner tag or something like that and you",
    "start": "2216640",
    "end": "2222880"
  },
  {
    "text": "can then build your policies around those tags but if you rely if you're relying on tags for building your",
    "start": "2222880",
    "end": "2229089"
  },
  {
    "text": "policies then the permission to create tags becomes a very important permission and so then that thing if you do see a",
    "start": "2229089",
    "end": "2236859"
  },
  {
    "text": "tag based policies create tags users with create tags become much more important than you would have thought",
    "start": "2236859",
    "end": "2242410"
  },
  {
    "text": "otherwise so if we turn to persistence there is some previous work in this",
    "start": "2242410",
    "end": "2247690"
  },
  {
    "start": "2243000",
    "end": "2260000"
  },
  {
    "text": "space our take on this thing was we use Amazon lambda or AWS lambda and in short",
    "start": "2247690",
    "end": "2254170"
  },
  {
    "text": "lambda lets you execute a chunk of code python or whatever in response to particular events and so the way we",
    "start": "2254170",
    "end": "2261310"
  },
  {
    "start": "2260000",
    "end": "2315000"
  },
  {
    "text": "persist in an account here and this is a toy example which shows the idea we have a lambda and we have an instance",
    "start": "2261310",
    "end": "2267920"
  },
  {
    "text": "and they monitor each other all right so the instance is seeing whether the lambdas been deleted the lambdas seen",
    "start": "2267920",
    "end": "2272990"
  },
  {
    "text": "whether the instance has been terminated and so when that happens what we've got on the left is a lambda that is being",
    "start": "2272990",
    "end": "2283100"
  },
  {
    "text": "deleted and one you'll see we refresh the page after it's been deleted and it's recreated and on the right hand",
    "start": "2283100",
    "end": "2290150"
  },
  {
    "text": "side we've got our instance which were going to try and terminate so we terminate the instance but the lambda at",
    "start": "2290150",
    "end": "2297140"
  },
  {
    "text": "this point picks up the terminate event and we'll restart the instance so you've got the symbiotic relationship between",
    "start": "2297140",
    "end": "2302990"
  },
  {
    "text": "the lambda in the instance when the ones removed the other one restarts it there's some technicalities to get that right which make it cute but you can",
    "start": "2302990",
    "end": "2309260"
  },
  {
    "text": "take that you can extend that idea to multiple lambdas multiple instances and",
    "start": "2309260",
    "end": "2314270"
  },
  {
    "text": "so on but the one that really scares me is the idea of subverting lambdas that",
    "start": "2314270",
    "end": "2319760"
  },
  {
    "start": "2315000",
    "end": "2355000"
  },
  {
    "text": "are already in place so we don't create a new lambda what we do is we take a lambda that's already there that",
    "start": "2319760",
    "end": "2325220"
  },
  {
    "text": "responds to events we compromise an account we look for the alarmed the lambdas that are in place and we just",
    "start": "2325220",
    "end": "2331190"
  },
  {
    "text": "modify that lambda so we change it so instead of just returning the original hello world what this lambda will do is",
    "start": "2331190",
    "end": "2337130"
  },
  {
    "text": "it will write out a set of temporary credentials to an s3 bucket under our control and then return hello world so",
    "start": "2337130",
    "end": "2343700"
  },
  {
    "text": "from the user's perspective from the system perspective it behaves completely as it used to behave except from our",
    "start": "2343700",
    "end": "2350120"
  },
  {
    "text": "perspective we also get credentials whenever the slammd is triggered and as",
    "start": "2350120",
    "end": "2355850"
  },
  {
    "start": "2355000",
    "end": "2378000"
  },
  {
    "text": "someone who uses AWS like how do we know that that's happened like good luck with that you're there's no code signing there's",
    "start": "2355850",
    "end": "2362120"
  },
  {
    "text": "no ability to detect that those lambdas have changed except if you are pulling",
    "start": "2362120",
    "end": "2367880"
  },
  {
    "text": "down the lambda code and if if you're monitoring cloud trail you'll see that there are there are events that happen",
    "start": "2367880",
    "end": "2374840"
  },
  {
    "text": "but if you're deploying lambdas frequently you expect to see those events I'll touch on lock out as a",
    "start": "2374840",
    "end": "2381110"
  },
  {
    "start": "2378000",
    "end": "2408000"
  },
  {
    "text": "persistence mechanism you can it's possible to create policies that prevent the admins from accessing their own",
    "start": "2381110",
    "end": "2387590"
  },
  {
    "text": "resources and that's not a permanent solution to persistence but it can buy you time so a policy like this will",
    "start": "2387590",
    "end": "2394670"
  },
  {
    "text": "prevent someone with full admin access from actually accessing",
    "start": "2394670",
    "end": "2399770"
  },
  {
    "text": "from accessing the instances that you care about to recover from that you're going to need to go to root account",
    "start": "2399770",
    "end": "2405800"
  },
  {
    "text": "credentials which may take a while to get so the option of but the thing I",
    "start": "2405800",
    "end": "2412670"
  },
  {
    "start": "2408000",
    "end": "2443000"
  },
  {
    "text": "guess which is more interesting for me in terms of persistence is the idea of Federation so Amazon lets you set up",
    "start": "2412670",
    "end": "2417740"
  },
  {
    "text": "trust relationships between accounts so it and again this has been done some of this has been done before but we can set",
    "start": "2417740",
    "end": "2424100"
  },
  {
    "text": "up a relationship between two accounts that gives the attackers account access",
    "start": "2424100",
    "end": "2430100"
  },
  {
    "text": "to the victims account so even after the attack is gone they still have this trust relationship in place and that",
    "start": "2430100",
    "end": "2436400"
  },
  {
    "text": "would give them then access they'd be able to assume a role in the victim",
    "start": "2436400",
    "end": "2441740"
  },
  {
    "text": "account there's the slight twist to that is you can reuse an existing role so it just",
    "start": "2441740",
    "end": "2447590"
  },
  {
    "start": "2443000",
    "end": "2462000"
  },
  {
    "text": "means that things don't show up as cleanly so you can take a current role add a trust relationship to that role",
    "start": "2447590",
    "end": "2452960"
  },
  {
    "text": "and then continue from there so all that you'll see here is a modification but",
    "start": "2452960",
    "end": "2458150"
  },
  {
    "text": "you won't see a new role being created or a new user being created but the one for me which is the most powerful from a",
    "start": "2458150",
    "end": "2464300"
  },
  {
    "start": "2462000",
    "end": "2530000"
  },
  {
    "text": "persistence perspective is organizations which are the thing that amazon have added most recently in November last",
    "start": "2464300",
    "end": "2471200"
  },
  {
    "text": "year so organizations allow you to create a sub account and what makes this",
    "start": "2471200",
    "end": "2477350"
  },
  {
    "text": "I guess a little bit funny is if an attacker compromises your AWS account they create a sub account from it they",
    "start": "2477350",
    "end": "2484040"
  },
  {
    "text": "have full access to the sub account so even if they have limited access in the primary account the parent in the sub",
    "start": "2484040",
    "end": "2489500"
  },
  {
    "text": "account they have full access so they get to they get to launch whatever services they want but the thing that",
    "start": "2489500",
    "end": "2495230"
  },
  {
    "text": "makes it particularly tricky is that in the sub account the the parents of the",
    "start": "2495230",
    "end": "2501230"
  },
  {
    "text": "owners of the parent account can't remove the sub account at all like they can't you have to contact AWS support in",
    "start": "2501230",
    "end": "2507500"
  },
  {
    "text": "order to remove that sub account so the attacker creates a sub account does whatever they want to do and the owner",
    "start": "2507500",
    "end": "2514130"
  },
  {
    "text": "of the main account is helpless until they get assistance from the AWS support",
    "start": "2514130",
    "end": "2520730"
  },
  {
    "text": "and the reason for that is there's no payment mechanism set up in the parent the sub account rather and so AWS won't",
    "start": "2520730",
    "end": "2527630"
  },
  {
    "text": "let you disconnect and you'll just get an error and then the last thing we'll talk about is login disruption and there's been",
    "start": "2527630",
    "end": "2533820"
  },
  {
    "start": "2530000",
    "end": "2548000"
  },
  {
    "text": "some previous work on this the one twist will add to this is what we found is that it's possible to modify the logs",
    "start": "2533820",
    "end": "2540300"
  },
  {
    "text": "and not have the validation completely screen so you get a small warning but not not a cry that things have gone",
    "start": "2540300",
    "end": "2547650"
  },
  {
    "text": "completely pear-shaped and the basis of this is effectively when you set up a",
    "start": "2547650",
    "end": "2552930"
  },
  {
    "text": "cloud trail logging and you set up validation on those logs those logs get they get validate where they get hooked",
    "start": "2552930",
    "end": "2560580"
  },
  {
    "text": "together through digest files and those digest files are chained together cryptographically what we can do is we",
    "start": "2560580",
    "end": "2566880"
  },
  {
    "text": "can modify some of those logs after they've been written of course this changes that digest so this means the",
    "start": "2566880",
    "end": "2572190"
  },
  {
    "text": "digest shouldn't validate any longer but at that point we modify the cloud trail to no longer validate and that creates a",
    "start": "2572190",
    "end": "2579480"
  },
  {
    "text": "break in the chain and so there's a new chain that gets created and with a break in the chain we're not able to delete",
    "start": "2579480",
    "end": "2586230"
  },
  {
    "text": "the old digest chain and so from the validation perspective what you see is",
    "start": "2586230",
    "end": "2593099"
  },
  {
    "text": "there was effectively a stop start stop start in the log in but you don't see that the logs were modified so these are",
    "start": "2593099",
    "end": "2603810"
  },
  {
    "text": "the services that we touched on ec2 these are the services that we haven't",
    "start": "2603810",
    "end": "2608849"
  },
  {
    "text": "touched on easy to like there's a whole lot of fiddling that still is left to be done here and there's the sort of",
    "start": "2608849",
    "end": "2615930"
  },
  {
    "text": "question around what's an alternative way to deal with this complexity we did",
    "start": "2615930",
    "end": "2621089"
  },
  {
    "text": "a whole bunch of work on beyond cope for this but clearly we're not that's not going to be included in this talk but",
    "start": "2621089",
    "end": "2627660"
  },
  {
    "text": "there is a whole bunch of stuff that I think can happen also on the beyond Corp side so we'll include the bianco stuff",
    "start": "2627660",
    "end": "2635339"
  },
  {
    "text": "in the slides we're just not going to have a chance to go through it now at this point the question is whether we're",
    "start": "2635339",
    "end": "2642570"
  },
  {
    "text": "saying that all the stuff is gloomy and hopeless and for the most part we're saying no what what the cloud and what",
    "start": "2642570",
    "end": "2650070"
  },
  {
    "text": "this type of paradigm does give us is a concentration of skills and a whole bunch of instrumentation there's a whole",
    "start": "2650070",
    "end": "2657750"
  },
  {
    "text": "bunch of useful signals coming out of this the problem is most of us are not aware of them and",
    "start": "2657750",
    "end": "2663390"
  },
  {
    "text": "most of us are not looking at them we big proponents of simple dirty tricks to",
    "start": "2663390",
    "end": "2670200"
  },
  {
    "text": "detect attackers in your network it's one of the reasons we like Canadian and tokens but but for example if you're not",
    "start": "2670200",
    "end": "2676650"
  },
  {
    "text": "talking about cloudy infrastructure like something I always talk about is saying to guys write a throwaway piece of",
    "start": "2676650",
    "end": "2683700"
  },
  {
    "text": "PowerShell that tells you when new admins are added to the admin group like",
    "start": "2683700",
    "end": "2689220"
  },
  {
    "text": "like we've done pen tests for years we're only after the report goes into",
    "start": "2689220",
    "end": "2694260"
  },
  {
    "text": "people know that you added yourself to domain admin it's ridiculous and and what we're saying is once you start",
    "start": "2694260",
    "end": "2700799"
  },
  {
    "text": "looking out for those tricks in the cloud you should be able to do pretty much the same thing so two examples that",
    "start": "2700799",
    "end": "2708569"
  },
  {
    "text": "we look at super quickly a both done by some of our guys are drive watch and AWS",
    "start": "2708569",
    "end": "2714930"
  },
  {
    "text": "ID tokens drive watch is fairly simple if you're running Google Drive in your",
    "start": "2714930",
    "end": "2721140"
  },
  {
    "text": "organization there's a whole bunch of docks that are living in your Drive Google instruments access to that drive",
    "start": "2721140",
    "end": "2727920"
  },
  {
    "text": "pretty richly so if you tap into the API what you can get an idea of is bob has",
    "start": "2727920",
    "end": "2734849"
  },
  {
    "text": "access or bob has his Google Drive Bob has a hundred docs in his Google Drive today Bob read all 100 of his Doc's",
    "start": "2734849",
    "end": "2743130"
  },
  {
    "text": "okay that sort of behavior is gonna happen when Bob gets compromised so if",
    "start": "2743130",
    "end": "2748380"
  },
  {
    "text": "you go to github you'll be able to pull a drive watch which essentially has two",
    "start": "2748380",
    "end": "2753569"
  },
  {
    "text": "ways of working if I skip really quickly there's the simple mode which says watch",
    "start": "2753569",
    "end": "2759180"
  },
  {
    "text": "this G Drive and tell me when a file is accessed a certain number of times but",
    "start": "2759180",
    "end": "2764970"
  },
  {
    "text": "the other one that's more interesting is called threshold mode where a drive will",
    "start": "2764970",
    "end": "2770130"
  },
  {
    "text": "keep a hundred and eighty days worth of history for people accessing their drive",
    "start": "2770130",
    "end": "2775170"
  },
  {
    "text": "so what the script will do is access that history and say on average Marco",
    "start": "2775170",
    "end": "2781140"
  },
  {
    "text": "accesses 20 files a day today Marco's gone 20% above his threshold for file",
    "start": "2781140",
    "end": "2788069"
  },
  {
    "text": "handling in Google in Drive so right now it'll spit out to console it'll kick an",
    "start": "2788069",
    "end": "2794279"
  },
  {
    "text": "alert to you via syslog and again much like the powershell script to tell you that someone's been added to",
    "start": "2794279",
    "end": "2800549"
  },
  {
    "text": "the admin group you will get a false positive with it occasionally it's fine like if you can account for the fact",
    "start": "2800549",
    "end": "2806880"
  },
  {
    "text": "that Marcos got a big project on or someone occasionally does it it's not a big deal what you want to know is when",
    "start": "2806880",
    "end": "2813930"
  },
  {
    "text": "someone's being compromised and they about someone's about to walk out of the door with all of your data Marco's spoke",
    "start": "2813930",
    "end": "2821130"
  },
  {
    "text": "a lot about AWS ID tokens if someone's got your tokens they've got access to",
    "start": "2821130",
    "end": "2827520"
  },
  {
    "text": "your essentially to your data center in the cloud again Daniel grizzly and Denbo",
    "start": "2827520",
    "end": "2833480"
  },
  {
    "text": "from Atlassian about to release a tool that allows you to create a honey token",
    "start": "2833480",
    "end": "2839760"
  },
  {
    "text": "AWS IDs what you're going to end up doing so they'll release it in the next few weeks essentially they give you",
    "start": "2839760",
    "end": "2846660"
  },
  {
    "text": "cloud formation you create an AWS account it then stands up in your AWS",
    "start": "2846660",
    "end": "2852539"
  },
  {
    "text": "account you ask for IDs it gives you ideas and the logic is that you see these IDs up so that you can know when",
    "start": "2852539",
    "end": "2859559"
  },
  {
    "text": "you've been compromised we've done pretty much the same thing and thrown it into our canary tokens framework which",
    "start": "2859559",
    "end": "2867630"
  },
  {
    "text": "is live now um I say we loosely it's done by Jay they're trying to show that",
    "start": "2867630",
    "end": "2873289"
  },
  {
    "text": "hacksaws don't have to be soft but essentially if you go to canary tokens",
    "start": "2873289",
    "end": "2878609"
  },
  {
    "text": "you can choose AWS ID follows the same principle put in an email address to be",
    "start": "2878609",
    "end": "2885359"
  },
  {
    "text": "reminded put in a memo that says here's where I'm leaving this AWS ID it then",
    "start": "2885359",
    "end": "2892349"
  },
  {
    "text": "gives you AWS ID credentials and the moment someone tries to use those",
    "start": "2892349",
    "end": "2897720"
  },
  {
    "text": "credentials using some sort of AWS call you get your canary token alert that",
    "start": "2897720",
    "end": "2903599"
  },
  {
    "text": "tells you that those I that ID has been compromised the the guys from Atlassian",
    "start": "2903599",
    "end": "2908910"
  },
  {
    "text": "have found huge compromises of third-party providers using exactly this",
    "start": "2908910",
    "end": "2915900"
  },
  {
    "text": "so they've put AWS IDs out in the wild and found that the AWS ID that they",
    "start": "2915900",
    "end": "2921299"
  },
  {
    "text": "stored with provider a has now been accessed giving them a good indication that provider a is actually compromised",
    "start": "2921299",
    "end": "2928579"
  },
  {
    "text": "so a really quick wrap up something we should know despite doing this for years Marco and I are",
    "start": "2928579",
    "end": "2934950"
  },
  {
    "text": "still really bad at managing our time um sorry but sorry about that the tax office in the cloud is not just",
    "start": "2934950",
    "end": "2942170"
  },
  {
    "text": "equal to machines that are hosted far away from you there's a fair amount of",
    "start": "2942170",
    "end": "2948480"
  },
  {
    "text": "signal for you to work with but there's also a really a large amount of noise you'll notice for almost everything",
    "start": "2948480",
    "end": "2954870"
  },
  {
    "text": "marco said he said well you'll see this in your logs and you'll see that in your logs but realistically most of the guys",
    "start": "2954870",
    "end": "2962010"
  },
  {
    "text": "who I know like it with a few exceptions don't even pick up start stop instances",
    "start": "2962010",
    "end": "2967020"
  },
  {
    "text": "in their cloud so in Marcos doing the testing it was like but you'll see a stop event and in truth for a long time",
    "start": "2967020",
    "end": "2972450"
  },
  {
    "text": "we wouldn't have picked up machine starting and stopping in our cloud because we've got hundreds of machines",
    "start": "2972450",
    "end": "2977550"
  },
  {
    "text": "and they do it all the time there's lots of fun for both red and blue teams if",
    "start": "2977550",
    "end": "2983850"
  },
  {
    "text": "you a blue team err go check out Scott Piper's flaws dot cloud it'll teach you",
    "start": "2983850",
    "end": "2989190"
  },
  {
    "text": "a whole bunch of stuff if you are red teamer you should be spending time here because",
    "start": "2989190",
    "end": "2994590"
  },
  {
    "text": "there's a whole lot of ownage just waiting to happen the we've been told we don't have time",
    "start": "2994590",
    "end": "3000350"
  },
  {
    "text": "for questions shout at us on Twitter tell us why we wrong thanks a lot for for your time",
    "start": "3000350",
    "end": "3006590"
  },
  {
    "text": "[Applause]",
    "start": "3006590",
    "end": "3012169"
  }
]